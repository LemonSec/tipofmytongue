1
00:00:00,000 --> 00:00:02,190
this is going to be a discussion about

2
00:00:02,190 --> 00:00:04,589
attacking containers some of my most

3
00:00:04,589 --> 00:00:07,140
favorite things to attack why because

4
00:00:07,140 --> 00:00:08,760
they work just like anything else and

5
00:00:08,760 --> 00:00:10,889
they're just as vulnerable and Moses is

6
00:00:10,889 --> 00:00:12,900
gonna give us all the deets on how to go

7
00:00:12,900 --> 00:00:15,000
through and destroy these things just

8
00:00:15,000 --> 00:00:16,890
like every every other opportunity that

9
00:00:16,890 --> 00:00:19,470
we have out there so without further ado

10
00:00:19,470 --> 00:00:22,230
let me pass it over to my friend and get

11
00:00:22,230 --> 00:00:27,420
us going thanks face so yeah look at

12
00:00:27,420 --> 00:00:28,760
that people are just chuckling in so I

13
00:00:28,760 --> 00:00:31,790
hey everybody

14
00:00:31,790 --> 00:00:35,010
man I've been on I've been on video all

15
00:00:35,010 --> 00:00:37,590
day in one form or another so this is

16
00:00:37,590 --> 00:00:39,690
gonna be there's gonna be interesting

17
00:00:39,690 --> 00:00:41,550
and I haven't had a drink yet so I'm

18
00:00:41,550 --> 00:00:43,980
still like pretty sober so this might

19
00:00:43,980 --> 00:00:48,870
actually work kind of well so well this

20
00:00:48,870 --> 00:00:51,750
is our jungle event I guess it's kind of

21
00:00:51,750 --> 00:00:54,449
crazy probably not what we thought of

22
00:00:54,449 --> 00:00:59,219
when we're talking about summer so first

23
00:00:59,219 --> 00:01:02,219
of all before we start there is a

24
00:01:02,219 --> 00:01:04,920
repository out there where you can get

25
00:01:04,920 --> 00:01:06,210
stuff act you know what I should make

26
00:01:06,210 --> 00:01:07,890
this a bitly link I just realized that I

27
00:01:07,890 --> 00:01:10,500
should probably make that a bit like go

28
00:01:10,500 --> 00:01:13,680
ahead and do that just because if I put

29
00:01:13,680 --> 00:01:16,170
this huge URL there and all these people

30
00:01:16,170 --> 00:01:18,090
are gonna be trying to get it thinking

31
00:01:18,090 --> 00:01:22,080
like what is that so for those that do

32
00:01:22,080 --> 00:01:27,140
not want to type that big monster thing

33
00:01:27,140 --> 00:01:29,159
I'm going to really quickly create a

34
00:01:29,159 --> 00:01:33,150
short URL and you can trust me and as

35
00:01:33,150 --> 00:01:35,400
the web app dude that it's not it's

36
00:01:35,400 --> 00:01:37,979
totally safe it's totally safe and

37
00:01:37,979 --> 00:01:40,350
nothing nothing bad should happen that

38
00:01:40,350 --> 00:01:45,090
I'm aware of they both do the same thing

39
00:01:45,090 --> 00:01:49,009
so let's see that's done that updates it

40
00:01:49,009 --> 00:01:51,509
and do I need to like refresh this page

41
00:01:51,509 --> 00:01:53,250
there we go

42
00:01:53,250 --> 00:01:58,520
so this is a bitly link so bit ly and

43
00:01:58,520 --> 00:02:01,409
that I'll also put it in the chat

44
00:02:01,409 --> 00:02:04,049
channel so that people that are

45
00:02:04,049 --> 00:02:06,509
struggling in if they want to follow

46
00:02:06,509 --> 00:02:09,929
along they can actually do that from the

47
00:02:09,929 --> 00:02:13,680
repo let's go over here

48
00:02:13,680 --> 00:02:17,280
oh no that's not right - I don't know I

49
00:02:17,280 --> 00:02:18,150
don't know if I can send that's

50
00:02:18,150 --> 00:02:20,519
everybody I'll put it in the discord

51
00:02:20,519 --> 00:02:22,620
how's that here I'll go ahead and take

52
00:02:22,620 --> 00:02:23,939
it over for you bro I've got it in the

53
00:02:23,939 --> 00:02:26,150
chat and I'm gonna put it in discord

54
00:02:26,150 --> 00:02:30,689
perfect thank you thank you so Wow

55
00:02:30,689 --> 00:02:32,930
that's going a little bit about myself

56
00:02:32,930 --> 00:02:35,790
you'll see me on discord as the renegade

57
00:02:35,790 --> 00:02:40,519
chemist you know red team persona and

58
00:02:40,519 --> 00:02:44,909
you know see is hard so stir coffee and

59
00:02:44,909 --> 00:02:47,579
mem copy your way through life without

60
00:02:47,579 --> 00:02:52,019
bounds checking so enjoy and if you get

61
00:02:52,019 --> 00:02:53,370
the funny joke there at the end and

62
00:02:53,370 --> 00:02:57,090
kudos to you I Google Image Search

63
00:02:57,090 --> 00:02:59,639
jingle while making this presentation

64
00:02:59,639 --> 00:03:03,150
this really amazing visually stunning

65
00:03:03,150 --> 00:03:06,329
presentation for you today this was

66
00:03:06,329 --> 00:03:08,400
actually one of the image search items

67
00:03:08,400 --> 00:03:10,500
that came back when you actually Google

68
00:03:10,500 --> 00:03:13,049
search Google Image Search jingle I

69
00:03:13,049 --> 00:03:17,940
don't know why I'm not exactly sure how

70
00:03:17,940 --> 00:03:21,209
Google comes up with that but this is

71
00:03:21,209 --> 00:03:23,370
what comes back so that's a little fun

72
00:03:23,370 --> 00:03:25,609
fact for you if you really like

73
00:03:25,609 --> 00:03:27,659
searching on the internet and finding

74
00:03:27,659 --> 00:03:28,440
out what comes up

75
00:03:28,440 --> 00:03:31,229
there you go okay so let me give you a

76
00:03:31,229 --> 00:03:32,939
little bit of background on this talk so

77
00:03:32,939 --> 00:03:34,260
if you've never seen me give a

78
00:03:34,260 --> 00:03:37,199
presentation before you'll be better off

79
00:03:37,199 --> 00:03:40,470
for it I'm sure it basically worked like

80
00:03:40,470 --> 00:03:42,090
this hey do you want do something on

81
00:03:42,090 --> 00:03:47,099
Saturday night and I'm like okay and

82
00:03:47,099 --> 00:03:49,949
they're like great next weekend Saturday

83
00:03:49,949 --> 00:03:54,769
night you're gonna do a talk right okay

84
00:03:54,769 --> 00:03:57,599
but I'm running out I'm doing some doing

85
00:03:57,599 --> 00:03:58,799
things all week I'm really not gonna

86
00:03:58,799 --> 00:04:02,009
have time to prepare I just may be a

87
00:04:02,009 --> 00:04:04,079
couple of hours before like I give the

88
00:04:04,079 --> 00:04:05,280
talk I can put something together

89
00:04:05,280 --> 00:04:06,659
awesome

90
00:04:06,659 --> 00:04:08,280
put it together oh and by the way

91
00:04:08,280 --> 00:04:11,310
there's a competing talk with Jake

92
00:04:11,310 --> 00:04:14,549
Williams oh that's great so for the

93
00:04:14,549 --> 00:04:16,320
seven people that are out there here we

94
00:04:16,320 --> 00:04:19,829
go all right so and because of the time

95
00:04:19,829 --> 00:04:22,529
that it took me to put this together I

96
00:04:22,529 --> 00:04:26,460
made a really bad presentation for you

97
00:04:26,460 --> 00:04:27,639
all it's a really cool

98
00:04:27,639 --> 00:04:32,560
pick one and so enjoy my awesome

99
00:04:32,560 --> 00:04:35,349
PowerPoint skills while I'm doing this

100
00:04:35,349 --> 00:04:37,060
actually Google Doc whatever you didn't

101
00:04:37,060 --> 00:04:38,050
you have to worry about that you have to

102
00:04:38,050 --> 00:04:39,729
worry about my present-day I shared it

103
00:04:39,729 --> 00:04:43,360
with you so you can actually bask in all

104
00:04:43,360 --> 00:04:44,249
of its glory

105
00:04:44,249 --> 00:04:49,960
so with that said uh uh yeah let's go

106
00:04:49,960 --> 00:04:52,749
right let's go for a zombie run okay so

107
00:04:52,749 --> 00:04:53,860
and for those I don't know what a

108
00:04:53,860 --> 00:04:56,080
container is how do I make it like what

109
00:04:56,080 --> 00:04:57,759
is a container how does it work and

110
00:04:57,759 --> 00:04:58,930
we're gonna I'm gonna show all the great

111
00:04:58,930 --> 00:05:02,259
fun details all the fun details right um

112
00:05:02,259 --> 00:05:05,919
so make a directory move your userland

113
00:05:05,919 --> 00:05:09,430
binaries over to that directory create a

114
00:05:09,430 --> 00:05:11,919
control group and basically the control

115
00:05:11,919 --> 00:05:13,779
group has an allocation of like CPU and

116
00:05:13,779 --> 00:05:16,090
memory and then use the control group

117
00:05:16,090 --> 00:05:20,349
execution command to execute stuff and

118
00:05:20,349 --> 00:05:24,189
remount the /do using a chroot boom

119
00:05:24,189 --> 00:05:27,069
container like you don't need that

120
00:05:27,069 --> 00:05:29,789
that's it I hate that I thought is

121
00:05:29,789 --> 00:05:35,919
theoretically right so why are they like

122
00:05:35,919 --> 00:05:38,650
so hard like why is they cut cachet how

123
00:05:38,650 --> 00:05:40,270
can I break them like what is this all

124
00:05:40,270 --> 00:05:42,339
about right so we're gonna show you like

125
00:05:42,339 --> 00:05:44,889
container attack 101 right so first of

126
00:05:44,889 --> 00:05:48,219
all control groups are something of the

127
00:05:48,219 --> 00:05:49,990
links that is inside the Linux kernel

128
00:05:49,990 --> 00:05:52,949
and it's been that way for at least I

129
00:05:52,949 --> 00:05:58,479
don't know like at least like 10 years

130
00:05:58,479 --> 00:06:00,310
right so the next two for Linux to six

131
00:06:00,310 --> 00:06:02,199
in that timeframe that's when you

132
00:06:02,199 --> 00:06:04,620
started looking at Linux kernel and

133
00:06:04,620 --> 00:06:08,050
doing namespace work and C group work

134
00:06:08,050 --> 00:06:11,349
whatever right you know CH roots been

135
00:06:11,349 --> 00:06:13,330
there forever so how does it work how

136
00:06:13,330 --> 00:06:15,699
does docker for OS X work or darker for

137
00:06:15,699 --> 00:06:17,199
Mac OS or whatever you want to call it

138
00:06:17,199 --> 00:06:19,930
work they virtualize a Linux environment

139
00:06:19,930 --> 00:06:22,139
okay so how does it work in Windows

140
00:06:22,139 --> 00:06:26,229
hyper-v technically in Windows 2019 it's

141
00:06:26,229 --> 00:06:28,719
a siloed process but it's super

142
00:06:28,719 --> 00:06:31,089
bastardized to make it work like a

143
00:06:31,089 --> 00:06:34,569
container okay so that's some magic of

144
00:06:34,569 --> 00:06:36,370
containers you'll you'll see this why

145
00:06:36,370 --> 00:06:37,800
this is important here in a minute

146
00:06:37,800 --> 00:06:40,599
now all the bits and pieces of a

147
00:06:40,599 --> 00:06:41,529
container just

148
00:06:41,529 --> 00:06:43,599
you know how it works darker

149
00:06:43,599 --> 00:06:45,369
open-sourced the core of its

150
00:06:45,369 --> 00:06:47,199
infrastructure they were gonna make some

151
00:06:47,199 --> 00:06:49,359
money basically building container

152
00:06:49,359 --> 00:06:53,709
Orchestrator that is until kubernetes

153
00:06:53,709 --> 00:06:55,749
came out and then their business model

154
00:06:55,749 --> 00:06:58,269
basically exploded but anyway before

155
00:06:58,269 --> 00:07:02,559
that darker they created this big open

156
00:07:02,559 --> 00:07:05,049
source a bunch of stuff run C is what

157
00:07:05,049 --> 00:07:07,449
runs a container and actually does all

158
00:07:07,449 --> 00:07:10,209
the the kernel work container D manages

159
00:07:10,209 --> 00:07:12,789
the containers themselves and uses runs

160
00:07:12,789 --> 00:07:15,069
here to run the container and then you

161
00:07:15,069 --> 00:07:17,739
have these two other processes that one

162
00:07:17,739 --> 00:07:19,719
you may know of darker but there's a

163
00:07:19,719 --> 00:07:24,159
darker daemon darker d daemon that

164
00:07:24,159 --> 00:07:26,619
actually controls how the darker D

165
00:07:26,619 --> 00:07:29,409
operates by default it's bound to a UNIX

166
00:07:29,409 --> 00:07:32,489
socket talk about that here in a minute

167
00:07:32,489 --> 00:07:35,319
so we forgot to play around with docker

168
00:07:35,319 --> 00:07:38,709
let's go ahead and actually get some

169
00:07:38,709 --> 00:07:43,269
stuff going in here okay if you haven't

170
00:07:43,269 --> 00:07:45,939
got darker installed and you're brave

171
00:07:45,939 --> 00:07:47,889
enough to like you know download a

172
00:07:47,889 --> 00:07:49,149
script you can actually read the script

173
00:07:49,149 --> 00:07:52,959
and it's on like a a bun to baste debian

174
00:07:52,959 --> 00:07:55,869
based distribution you can go ahead and

175
00:07:55,869 --> 00:07:58,360
use that script that I provided to

176
00:07:58,360 --> 00:08:03,549
actually go get your darker installed

177
00:08:03,549 --> 00:08:05,439
and it takes maybe all of five minutes

178
00:08:05,439 --> 00:08:08,829
ten minutes whatever okay I'm gonna go

179
00:08:08,829 --> 00:08:10,509
ahead and put this in the discord as

180
00:08:10,509 --> 00:08:12,159
well just so that people have the

181
00:08:12,159 --> 00:08:14,739
install script for a darker but you do

182
00:08:14,739 --> 00:08:17,889
need darker either darker desktop or

183
00:08:17,889 --> 00:08:20,889
darker darker running right whether you

184
00:08:20,889 --> 00:08:22,989
do it now or later that's just gonna be

185
00:08:22,989 --> 00:08:35,099
a prerequisite step okay so let's see

186
00:08:35,099 --> 00:08:37,110
now

187
00:08:37,110 --> 00:08:39,188
Yukie already called the repo that's

188
00:08:39,188 --> 00:08:42,909
cool so lab 0 is making sure things are

189
00:08:42,909 --> 00:08:44,620
running okay and i just wanted to give

190
00:08:44,620 --> 00:08:48,040
you a quick tour of docker right just

191
00:08:48,040 --> 00:08:52,689
101 tour ok so let's go ahead and real

192
00:08:52,689 --> 00:08:55,480
quick i'm a cessation to limit my

193
00:08:55,480 --> 00:08:59,730
host actually let's go ahead and docker

194
00:08:59,730 --> 00:09:03,220
run hello world if you don't have the

195
00:09:03,220 --> 00:09:06,279
hello world container it's going to pull

196
00:09:06,279 --> 00:09:09,300
it down and run it

197
00:09:13,440 --> 00:09:16,269
so hey you've gotten your darker

198
00:09:16,269 --> 00:09:18,040
installation correctly that's what

199
00:09:18,040 --> 00:09:21,160
happens if you don't give you some magic

200
00:09:21,160 --> 00:09:23,320
here if like I already have it I have a

201
00:09:23,320 --> 00:09:24,670
few containers that I built out of my

202
00:09:24,670 --> 00:09:28,600
system let me see if hello world is

203
00:09:28,600 --> 00:09:31,140
still in there

204
00:09:31,350 --> 00:09:38,440
darker PS stalker image hello let's see

205
00:09:38,440 --> 00:09:42,209
is it grip hello Oh Emma jealous

206
00:09:42,209 --> 00:09:47,920
sorry so let's see yep let's go and kill

207
00:09:47,920 --> 00:09:51,850
that oh so somebody said somebody has

208
00:09:51,850 --> 00:09:54,880
question real quick for Callie can you

209
00:09:54,880 --> 00:09:58,779
run darker in Callie you can run darker

210
00:09:58,779 --> 00:10:00,810
on almost any distribution of Linux and

211
00:10:00,810 --> 00:10:06,310
on almost any OS really I mean it's very

212
00:10:06,310 --> 00:10:08,230
portable you can even run Linux

213
00:10:08,230 --> 00:10:11,500
containers inside of windows docker and

214
00:10:11,500 --> 00:10:14,760
the reason you can do that hyper-v so

215
00:10:14,760 --> 00:10:17,410
you know it's gonna require resources

216
00:10:17,410 --> 00:10:18,820
cuz it's gonna boot up a window

217
00:10:18,820 --> 00:10:20,320
environment make a Windows environment I

218
00:10:20,320 --> 00:10:23,350
repeat change it and in Kali yes it

219
00:10:23,350 --> 00:10:25,060
might even be natively installed it

220
00:10:25,060 --> 00:10:26,770
depends on the Kali build not sure what

221
00:10:26,770 --> 00:10:27,790
they're doing yet but I wouldn't be

222
00:10:27,790 --> 00:10:30,910
surprised if it's natively installed I'm

223
00:10:30,910 --> 00:10:33,040
gonna go ahead and delete this container

224
00:10:33,040 --> 00:10:38,050
just so you can see what happens - hello

225
00:10:38,050 --> 00:10:42,399
- world oh I have to destroy this

226
00:10:42,399 --> 00:10:44,410
container that references it so if you

227
00:10:44,410 --> 00:10:45,850
get that error like hey how do I delete

228
00:10:45,850 --> 00:10:49,510
this container do you do a darker RM the

229
00:10:49,510 --> 00:10:53,410
container and then you kill her oh man

230
00:10:53,410 --> 00:10:54,550
look how many containers I have

231
00:10:54,550 --> 00:10:58,660
referencing hello world oh boy I hope I

232
00:10:58,660 --> 00:11:00,820
don't have too many let's see you might

233
00:11:00,820 --> 00:11:03,959
run into this by the way any others you

234
00:11:03,959 --> 00:11:06,610
know just shows you how many times

235
00:11:06,610 --> 00:11:08,980
you've wrecked you run containers let's

236
00:11:08,980 --> 00:11:09,279
see

237
00:11:09,279 --> 00:11:10,959
I may have to clean this up later I want

238
00:11:10,959 --> 00:11:12,790
to show you what a fresh container pool

239
00:11:12,790 --> 00:11:16,750
would do there we go so when you want to

240
00:11:16,750 --> 00:11:18,820
run it for the first time you're gonna

241
00:11:18,820 --> 00:11:22,149
see something like this it's can't find

242
00:11:22,149 --> 00:11:24,750
it local

243
00:11:27,630 --> 00:11:30,370
okay I'm gonna go run

244
00:11:30,370 --> 00:11:32,500
you know I've pulled this image down and

245
00:11:32,500 --> 00:11:37,170
I'm gonna go run hello world okay now I

246
00:11:37,170 --> 00:11:39,220
told you you can do some other things

247
00:11:39,220 --> 00:11:40,870
okay but I've shown you a few commands

248
00:11:40,870 --> 00:11:44,500
so let's do one real quick just so you

249
00:11:44,500 --> 00:11:46,090
can see you don't have to do this with

250
00:11:46,090 --> 00:11:47,620
me we're gonna do a lot of these over

251
00:11:47,620 --> 00:11:49,600
time but as an example let's just say

252
00:11:49,600 --> 00:11:56,340
that we did docker run busybox been SH

253
00:11:56,340 --> 00:11:58,570
alright you know maybe something more

254
00:11:58,570 --> 00:12:02,590
fancy docker run so I is interactive T

255
00:12:02,590 --> 00:12:04,540
is tagging it

256
00:12:04,540 --> 00:12:07,150
we're demonizing nginx real quick I just

257
00:12:07,150 --> 00:12:08,590
wanted to kind of show you how this

258
00:12:08,590 --> 00:12:17,170
would work okay

259
00:12:17,170 --> 00:12:20,140
justin is demon eyes like this what you

260
00:12:20,140 --> 00:12:23,710
can do to kind of make sure that things

261
00:12:23,710 --> 00:12:26,230
stay functional or mirror to attach to

262
00:12:26,230 --> 00:12:28,150
it I guess is you can do a few ways you

263
00:12:28,150 --> 00:12:32,350
can attach to it by name just this

264
00:12:32,350 --> 00:12:33,580
doesn't have a name so I'm you have to

265
00:12:33,580 --> 00:12:36,670
attach to it like this all on darker

266
00:12:36,670 --> 00:12:48,140
attach so now I'm at

267
00:12:48,140 --> 00:12:49,910
container the container is kind of

268
00:12:49,910 --> 00:12:51,380
running in genetics so there's nothing

269
00:12:51,380 --> 00:12:53,779
really no logs nothing really going on

270
00:12:53,779 --> 00:12:56,529
so

271
00:12:59,410 --> 00:13:04,660
look I can do a doctor hey Moses yeah

272
00:13:04,660 --> 00:13:07,299
it's a your bandwidth you're having some

273
00:13:07,299 --> 00:13:09,129
some clip outs so I don't know if you've

274
00:13:09,129 --> 00:13:10,299
got some stuff running that you could

275
00:13:10,299 --> 00:13:13,199
maybe shut off

276
00:13:14,379 --> 00:13:15,369
looks like you're lucky you're locking

277
00:13:15,369 --> 00:13:17,679
up a bit video maybe turn your video off

278
00:13:17,679 --> 00:13:21,299
and see if it keeps the audio going ah

279
00:13:21,539 --> 00:13:25,329
yeah maybe hold on let's see I'd love to

280
00:13:25,329 --> 00:13:29,349
see you man but you know yeah yeah don't

281
00:13:29,349 --> 00:13:33,519
work better well we'll see yeah yeah we

282
00:13:33,519 --> 00:13:36,220
don't know okay yeah especially isn't

283
00:13:36,220 --> 00:13:38,949
gonna be like restarting stuff a lot you

284
00:13:38,949 --> 00:13:40,989
know it's always good to keep the host

285
00:13:40,989 --> 00:13:42,489
nice and fresh so if anything I can go

286
00:13:42,489 --> 00:13:43,629
to another machine and I can do this

287
00:13:43,629 --> 00:13:48,220
remotely too so but hey you know the fun

288
00:13:48,220 --> 00:13:50,229
of doing the live demos right all right

289
00:13:50,229 --> 00:13:53,289
so darker exact if you want to run

290
00:13:53,289 --> 00:13:55,149
something fun right like like something

291
00:13:55,149 --> 00:13:58,389
more interesting docker PS oh actually I

292
00:13:58,389 --> 00:14:10,479
don't see the nginx container so docker

293
00:14:10,479 --> 00:14:12,609
PS Hey look at this

294
00:14:12,609 --> 00:14:14,529
so here's a container here's the image

295
00:14:14,529 --> 00:14:16,449
here's the actually this right now is

296
00:14:16,449 --> 00:14:19,209
gonna be as close to the image name as

297
00:14:19,209 --> 00:14:21,549
you can get the reference name you know

298
00:14:21,549 --> 00:14:23,409
the name of the container it's actually

299
00:14:23,409 --> 00:14:25,839
called focus something or another right

300
00:14:25,839 --> 00:14:26,979
that's actually the name of the

301
00:14:26,979 --> 00:14:30,309
container let's do this again focus cart

302
00:14:30,309 --> 00:14:31,869
right because I didn't name it it comes

303
00:14:31,869 --> 00:14:35,399
up with its own name for now just for

304
00:14:35,399 --> 00:14:37,779
for grins ready to make this easier for

305
00:14:37,779 --> 00:14:39,879
everybody to kind of work with you can

306
00:14:39,879 --> 00:14:43,419
just grab this and do docker run so I'm

307
00:14:43,419 --> 00:14:45,220
running something in this container

308
00:14:45,220 --> 00:14:47,369
right you have to run it like this

309
00:14:47,369 --> 00:14:50,079
running something in this container what

310
00:14:50,079 --> 00:14:52,839
am I gonna run bin bash so - I is

311
00:14:52,839 --> 00:14:56,019
Interactive tag I'm tagging the

312
00:14:56,019 --> 00:14:57,970
container with the container ID bin bash

313
00:14:57,970 --> 00:15:04,359
I'm maybe just friend like this that's

314
00:15:04,359 --> 00:15:04,959
weird

315
00:15:04,959 --> 00:15:08,619
am I not well I may have to run it with

316
00:15:08,619 --> 00:15:12,329
the name range

317
00:15:13,020 --> 00:15:19,610
did it quick boom

318
00:15:19,610 --> 00:15:23,130
that is really weird like oh sorry

319
00:15:23,130 --> 00:15:24,080
everybody

320
00:15:24,080 --> 00:15:26,610
docker run it's been a long day I've

321
00:15:26,610 --> 00:15:29,510
only been doing this for 10 or 12 hours

322
00:15:29,510 --> 00:15:33,440
sorry that's how you do it

323
00:15:33,440 --> 00:15:36,330
so we're executing pin bash in the

324
00:15:36,330 --> 00:15:39,480
container so now notice the prompt we're

325
00:15:39,480 --> 00:15:40,800
gonna get more on this in a minute

326
00:15:40,800 --> 00:15:42,990
because this is important but basically

327
00:15:42,990 --> 00:15:45,090
the container is an interesting beast

328
00:15:45,090 --> 00:15:48,650
because PS isn't on here as an example

329
00:15:48,650 --> 00:15:50,850
depending on the container your system

330
00:15:50,850 --> 00:15:53,190
binaries might not be there you have to

331
00:15:53,190 --> 00:15:55,050
go look in bin to see what's there

332
00:15:55,050 --> 00:15:57,690
way less binaries that you used to so if

333
00:15:57,690 --> 00:15:59,610
you're used to like packing in a box and

334
00:15:59,610 --> 00:16:01,890
saying oh you know I'm used to neck hair

335
00:16:01,890 --> 00:16:03,990
I'm used to curl I'm used to all this

336
00:16:03,990 --> 00:16:05,880
stuff being there it's out there now you

337
00:16:05,880 --> 00:16:07,320
can't install it you can actually do

338
00:16:07,320 --> 00:16:08,760
apps and some of the containers you can

339
00:16:08,760 --> 00:16:10,530
do like I have to update and then you

340
00:16:10,530 --> 00:16:12,810
can actually like install a package

341
00:16:12,810 --> 00:16:13,890
manager

342
00:16:13,890 --> 00:16:16,650
but containers are basically userland

343
00:16:16,650 --> 00:16:19,760
binaries okay so this container might be

344
00:16:19,760 --> 00:16:23,840
Ubuntu let's see and let's be release

345
00:16:23,840 --> 00:16:30,230
nope it could be Red Hat nope

346
00:16:30,260 --> 00:16:37,160
Debian so this this this particular

347
00:16:38,510 --> 00:16:41,850
container right is actually doing a

348
00:16:41,850 --> 00:16:44,430
pretty you know stay is doing a debian

349
00:16:44,430 --> 00:16:49,580
type of process so pretty cool right so

350
00:16:49,580 --> 00:16:52,710
a couple of other things that we can

351
00:16:52,710 --> 00:16:54,600
take a look at with a container is

352
00:16:54,600 --> 00:16:56,790
container networking real quick if we

353
00:16:56,790 --> 00:16:59,250
have access to it we don't have access

354
00:16:59,250 --> 00:17:03,020
so we don't have even if config right so

355
00:17:03,020 --> 00:17:05,849
we might be able to do env and get it

356
00:17:05,849 --> 00:17:07,589
this way nope

357
00:17:07,589 --> 00:17:09,900
so how do I find out what the heck the

358
00:17:09,900 --> 00:17:12,660
container network is if it Haven has one

359
00:17:12,660 --> 00:17:15,959
well if the container is running you can

360
00:17:15,959 --> 00:17:19,260
do a container inspect ok and then you

361
00:17:19,260 --> 00:17:20,790
can do a container inspect of the

362
00:17:20,790 --> 00:17:23,459
container itself I figure out what's

363
00:17:23,459 --> 00:17:26,160
going on in the container right so you

364
00:17:26,160 --> 00:17:26,940
can see

365
00:17:26,940 --> 00:17:29,370
everything about this container how it

366
00:17:29,370 --> 00:17:31,620
started what's running it notice that

367
00:17:31,620 --> 00:17:34,440
nginx is running in the foreground not

368
00:17:34,440 --> 00:17:36,390
in daemon mode you need to be able to

369
00:17:36,390 --> 00:17:39,200
run in the foreground sure what a minute

370
00:17:39,200 --> 00:17:41,900
this is all the different container

371
00:17:41,900 --> 00:17:45,840
bounds capabilities of the kernel CPU

372
00:17:45,840 --> 00:17:49,110
capabilities paths and more importantly

373
00:17:49,110 --> 00:17:50,790
you're gonna see the container

374
00:17:50,790 --> 00:17:53,400
networking information here okay and

375
00:17:53,400 --> 00:17:55,470
this is what darker orchestrates for you

376
00:17:55,470 --> 00:17:59,780
okay now what that said that's like

377
00:17:59,780 --> 00:18:02,790
level zero right so we got to go faster

378
00:18:02,790 --> 00:18:04,350
if we want to get through this all right

379
00:18:04,350 --> 00:18:06,840
it's a lab one so where did I put all my

380
00:18:06,840 --> 00:18:08,640
lab stuff I put it in the jungle

381
00:18:08,640 --> 00:18:12,660
directory in the jungle container

382
00:18:12,660 --> 00:18:18,690
directory so here's a lab one lab one

383
00:18:18,690 --> 00:18:21,890
we've have a docker file the docker file

384
00:18:21,890 --> 00:18:25,770
basically says how you're going to build

385
00:18:25,770 --> 00:18:27,480
things right or how you're gonna run

386
00:18:27,480 --> 00:18:30,060
things okay so here's an example of what

387
00:18:30,060 --> 00:18:31,740
you would do to build a docker file

388
00:18:31,740 --> 00:18:34,920
you'd say hey darker I want you to build

389
00:18:34,920 --> 00:18:38,690
a container I want you to tag it

390
00:18:38,690 --> 00:18:42,600
sorry not I I want you to tag it we're

391
00:18:42,600 --> 00:18:48,240
gonna call it jingle labs lab 1 and

392
00:18:48,240 --> 00:18:50,280
where do we want to build it from this

393
00:18:50,280 --> 00:18:55,350
directory here dot ok you hit go and it

394
00:18:55,350 --> 00:18:57,150
builds the container

395
00:18:57,150 --> 00:19:00,090
alright yours is gonna build slower than

396
00:19:00,090 --> 00:19:02,490
mine because I've already downloaded the

397
00:19:02,490 --> 00:19:03,630
layers ok

398
00:19:03,630 --> 00:19:06,030
so yours is gonna take a water pull down

399
00:19:06,030 --> 00:19:10,140
a bun to build the container and if you

400
00:19:10,140 --> 00:19:13,260
notice the container has one job to run

401
00:19:13,260 --> 00:19:15,720
pin bash okay that's all the containers

402
00:19:15,720 --> 00:19:19,170
doing bin bash right so we're gonna go

403
00:19:19,170 --> 00:19:26,480
ahead and do a darker run of the jungle

404
00:19:26,480 --> 00:19:30,890
lab one in bash

405
00:19:31,800 --> 00:19:39,210
oh it did work it's doing that weird

406
00:19:39,210 --> 00:19:44,610
it's doing it's weird self Helen gotta

407
00:19:44,610 --> 00:19:46,140
run it in interactive mode if not it

408
00:19:46,140 --> 00:19:48,090
ends up being idle being weird

409
00:19:48,090 --> 00:19:50,100
alright hold on let me I'm gonna have to

410
00:19:50,100 --> 00:19:55,790
kill it you have to kill that container

411
00:19:55,910 --> 00:19:59,100
it's not in interactive mode so it's

412
00:19:59,100 --> 00:20:05,810
doing the word shell thing ah come on

413
00:20:08,120 --> 00:20:13,189
always have a second window open ah oh

414
00:20:15,080 --> 00:20:19,610
caps lock on top of everything else

415
00:20:19,790 --> 00:20:28,740
okay so docker PS darker kill laughing

416
00:20:28,740 --> 00:20:42,809
Borg oh man it hung up the

417
00:20:42,809 --> 00:20:47,940
okay reset so if you want to run this

418
00:20:47,940 --> 00:20:49,710
container you'd probably have to run it

419
00:20:49,710 --> 00:20:52,139
with the I in it for interactive mode

420
00:20:52,139 --> 00:21:02,519
there we go so now you could see in here

421
00:21:02,519 --> 00:21:05,190
that the container is in a bunch of

422
00:21:05,190 --> 00:21:06,570
container okay

423
00:21:06,570 --> 00:21:08,879
however edit Cinnabun 220 it's the

424
00:21:08,879 --> 00:21:10,710
latest container okay which or the

425
00:21:10,710 --> 00:21:11,970
latest version of Ubuntu

426
00:21:11,970 --> 00:21:14,730
you can't version these things okay but

427
00:21:14,730 --> 00:21:19,649
this is just a bash prompt right and you

428
00:21:19,649 --> 00:21:22,320
know it's running in a certain way we

429
00:21:22,320 --> 00:21:23,940
haven't gotten to the to this part yet

430
00:21:23,940 --> 00:21:25,889
but just understand that this is just

431
00:21:25,889 --> 00:21:28,679
how the containers operate right so you

432
00:21:28,679 --> 00:21:31,110
run a container you build it great so

433
00:21:31,110 --> 00:21:38,279
what can I do with it I believe the eggs

434
00:21:38,279 --> 00:21:39,869
in the container will kill the container

435
00:21:39,869 --> 00:21:44,309
and it does let me actually exit this

436
00:21:44,309 --> 00:21:50,928
container as well Cartwright okay

437
00:21:53,480 --> 00:21:57,299
they're pretty they're pretty simplistic

438
00:21:57,299 --> 00:22:00,869
kind of beasts right so let me show you

439
00:22:00,869 --> 00:22:01,980
how we're gonna run a different

440
00:22:01,980 --> 00:22:07,289
container so if you've got a lab to lab

441
00:22:07,289 --> 00:22:12,749
to is gonna have a docker file that has

442
00:22:12,749 --> 00:22:15,869
nmap as the execution path so what

443
00:22:15,869 --> 00:22:17,909
happens when we build that one right

444
00:22:17,909 --> 00:22:19,619
because first of all we have something

445
00:22:19,619 --> 00:22:22,110
called entry point and this is a special

446
00:22:22,110 --> 00:22:24,480
command in darker that basically says

447
00:22:24,480 --> 00:22:26,700
when you run the container this is the

448
00:22:26,700 --> 00:22:30,119
command that you're gonna run so let's

449
00:22:30,119 --> 00:22:32,190
kind of just see how this works so so

450
00:22:32,190 --> 00:22:35,340
here's darker build right and you want

451
00:22:35,340 --> 00:22:36,840
to build and map by the way this works

452
00:22:36,840 --> 00:22:39,389
for anything r8 meterpreter this works

453
00:22:39,389 --> 00:22:41,490
for Metasploit wix4 everything right so

454
00:22:41,490 --> 00:22:42,720
you build an entry point you build a

455
00:22:42,720 --> 00:22:45,379
container say hey I want to build a

456
00:22:45,379 --> 00:22:47,249
container called

457
00:22:47,249 --> 00:22:54,460
jungle lab - it builds it notice that

458
00:22:54,460 --> 00:22:56,620
that it sends the bill to the demon and

459
00:22:56,620 --> 00:22:59,020
it says great I'm gonna build this out

460
00:22:59,020 --> 00:23:01,450
and now I've got a docker container

461
00:23:01,450 --> 00:23:04,840
called jungle lab - when I go to run it

462
00:23:04,840 --> 00:23:08,590
in an interactive mode jungle will have

463
00:23:08,590 --> 00:23:18,880
to the end map prompt because nmap was

464
00:23:18,880 --> 00:23:21,730
the entry point so that means that i can

465
00:23:21,730 --> 00:23:25,930
actually run uh and map from my bar from

466
00:23:25,930 --> 00:23:28,690
my container right so let's do a quick

467
00:23:28,690 --> 00:23:32,550
check a map local hose

468
00:23:37,940 --> 00:23:43,110
and it says everything is closed huh

469
00:23:43,110 --> 00:23:45,660
well I know I have stuff opened to

470
00:23:45,660 --> 00:23:49,950
myself so why does nmap say that

471
00:23:49,950 --> 00:23:53,130
everything is closed right and by the

472
00:23:53,130 --> 00:23:58,430
way this is what we did here um well

473
00:23:58,430 --> 00:24:03,240
nmap did it say that everything was

474
00:24:03,240 --> 00:24:06,120
closed to your host and that said

475
00:24:06,120 --> 00:24:09,660
everything was closed to the local host

476
00:24:09,660 --> 00:24:12,210
of the container and the containers

477
00:24:12,210 --> 00:24:16,950
local host is only running nmap right so

478
00:24:16,950 --> 00:24:18,680
if you want to scan something you could

479
00:24:18,680 --> 00:24:21,470
you'd have to do it by my IP address

480
00:24:21,470 --> 00:24:24,559
[Music]

481
00:24:26,090 --> 00:24:29,280
that's right and and it shows you I mean

482
00:24:29,280 --> 00:24:31,130
this is a map running in a container

483
00:24:31,130 --> 00:24:34,320
outputting the commands um now the other

484
00:24:34,320 --> 00:24:35,670
problem you're gonna have though you're

485
00:24:35,670 --> 00:24:37,200
gonna have a couple of questions I know

486
00:24:37,200 --> 00:24:40,190
that okay so like if I write out a file

487
00:24:40,190 --> 00:24:43,280
like temp scanner

488
00:24:43,280 --> 00:24:46,349
[Music]

489
00:24:47,900 --> 00:24:52,980
Wow the temps can but the containers are

490
00:24:52,980 --> 00:24:56,700
not persisting any of the data so the

491
00:24:56,700 --> 00:24:59,400
container is gonna discard whatever was

492
00:24:59,400 --> 00:25:03,990
written in temp and that's it it's gone

493
00:25:03,990 --> 00:25:06,900
right so you need to actually do

494
00:25:06,900 --> 00:25:09,240
something to make the container not

495
00:25:09,240 --> 00:25:12,090
discard the data sets that you're

496
00:25:12,090 --> 00:25:14,520
putting in it okay now from the

497
00:25:14,520 --> 00:25:15,930
containers point of view it just says

498
00:25:15,930 --> 00:25:19,380
hey I don't I just don't have any data

499
00:25:19,380 --> 00:25:21,630
that's because the containers network is

500
00:25:21,630 --> 00:25:22,920
almost like a bridging network it's

501
00:25:22,920 --> 00:25:25,200
almost like a internal network to itself

502
00:25:25,200 --> 00:25:28,400
right so that's the problem there so

503
00:25:28,400 --> 00:25:31,950
with that said there's another thing you

504
00:25:31,950 --> 00:25:33,570
should know about which is can you

505
00:25:33,570 --> 00:25:36,990
change the entry point so nmap when you

506
00:25:36,990 --> 00:25:40,080
compile it it compiles with other things

507
00:25:40,080 --> 00:25:43,940
like and ping right which is nmf some

508
00:25:43,940 --> 00:25:46,440
pair like H ping it's a packet crafter

509
00:25:46,440 --> 00:25:49,140
so you could say okay and

510
00:25:49,140 --> 00:25:52,230
I want to run a container and I want the

511
00:25:52,230 --> 00:26:02,420
entry point to be anything vivianne ping

512
00:26:05,330 --> 00:26:08,179
that's another example of the container

513
00:26:08,179 --> 00:26:11,429
running a different binary right and

514
00:26:11,429 --> 00:26:13,559
then discarding itself so these things

515
00:26:13,559 --> 00:26:17,640
are basically designed to help package

516
00:26:17,640 --> 00:26:22,290
software right now this is what what's

517
00:26:22,290 --> 00:26:24,780
interesting so what if you wanted to

518
00:26:24,780 --> 00:26:26,790
persist data right cuz you saw the data

519
00:26:26,790 --> 00:26:31,830
gets discarded right so you can discard

520
00:26:31,830 --> 00:26:34,410
or you can persist data you can actually

521
00:26:34,410 --> 00:26:39,929
mount a host volume inside of the

522
00:26:39,929 --> 00:26:42,179
container this is gonna be critical all

523
00:26:42,179 --> 00:26:47,240
right so here's an example in lab 3

524
00:26:47,240 --> 00:26:51,390
we're gonna go ahead and run well we're

525
00:26:51,390 --> 00:26:52,679
gonna go ahead and build it first you

526
00:26:52,679 --> 00:26:54,150
got actually builds up three so if you

527
00:26:54,150 --> 00:26:55,740
don't have blood three you gotta go

528
00:26:55,740 --> 00:27:05,309
darker - die yeah Jun goal lab 3 just

529
00:27:05,309 --> 00:27:07,860
build it real quick just like we've been

530
00:27:07,860 --> 00:27:11,940
doing all along something like this if

531
00:27:11,940 --> 00:27:14,700
you build it they will come now if you

532
00:27:14,700 --> 00:27:16,440
build it then you can run it with this

533
00:27:16,440 --> 00:27:18,450
tag right that's really what you can do

534
00:27:18,450 --> 00:27:21,679
if you didn't build it it'll just

535
00:27:21,679 --> 00:27:25,140
download the Maria DB binary which isn't

536
00:27:25,140 --> 00:27:26,640
a big deal

537
00:27:26,640 --> 00:27:28,080
um because what I really want to show

538
00:27:28,080 --> 00:27:30,840
you was you build a container like this

539
00:27:30,840 --> 00:27:34,429
with a MySQL root password sort of runs

540
00:27:34,429 --> 00:27:38,460
okay and you tell it you want to run in

541
00:27:38,460 --> 00:27:41,309
daemon mode so it's gonna run as a

542
00:27:41,309 --> 00:27:44,970
daemon okay you say that you want a

543
00:27:44,970 --> 00:27:48,660
volume mount and you want to mount data

544
00:27:48,660 --> 00:27:55,559
the data directory into var Lib MySQL

545
00:27:55,559 --> 00:28:02,690
right and jingle lab 3

546
00:28:02,690 --> 00:28:13,609
yeah hopefully yep

547
00:28:13,609 --> 00:28:15,979
it's running in the background awesome

548
00:28:15,979 --> 00:28:19,249
so it's running and if you want to

549
00:28:19,249 --> 00:28:24,049
interact with it you can okay but it's

550
00:28:24,049 --> 00:28:25,729
running a volume mount and if you do a

551
00:28:25,729 --> 00:28:28,009
dot so if you do a darker inspect of

552
00:28:28,009 --> 00:28:30,649
either the container ID or the container

553
00:28:30,649 --> 00:28:33,919
name does it really matter which it

554
00:28:33,919 --> 00:28:35,479
gives you a bunch of stuff and what I

555
00:28:35,479 --> 00:28:42,769
want you to key in on is this this

556
00:28:42,769 --> 00:28:46,039
volume mount so it says that the

557
00:28:46,039 --> 00:28:48,409
internal data directory is mounted to

558
00:28:48,409 --> 00:28:53,599
the host is this volume right so you can

559
00:28:53,599 --> 00:28:55,519
go there and take a look you can go into

560
00:28:55,519 --> 00:28:59,599
var lib darker oh sorry

561
00:28:59,599 --> 00:29:06,349
CD var Lib darker darker Oh permission

562
00:29:06,349 --> 00:29:10,539
denied huh so maybe I have to be rude

563
00:29:10,539 --> 00:29:16,419
okay so you say all right you be route

564
00:29:16,419 --> 00:29:20,590
bar Lib docker

565
00:29:21,369 --> 00:29:24,369
ah

566
00:29:27,710 --> 00:29:34,190
Oh about that stop weird oh there it is

567
00:29:34,190 --> 00:29:40,879
the bottom volumes data data right so

568
00:29:40,879 --> 00:29:44,570
right now there's nothing okay but you

569
00:29:44,570 --> 00:29:45,950
could see that this thing is running

570
00:29:45,950 --> 00:29:50,330
system D right and if you look you've

571
00:29:50,330 --> 00:29:53,299
got all of these volume mounts in here

572
00:29:53,299 --> 00:29:57,169
right so let's talk about what overlay

573
00:29:57,169 --> 00:30:01,879
FS is so when you build a container and

574
00:30:01,879 --> 00:30:03,559
especially when you name a container

575
00:30:03,559 --> 00:30:07,999
right when you build a container you

576
00:30:07,999 --> 00:30:12,080
actually start to build layers in the

577
00:30:12,080 --> 00:30:15,070
continued operating system okay and

578
00:30:15,070 --> 00:30:16,690
basically

579
00:30:16,690 --> 00:30:18,820
what happens is when you look at the

580
00:30:18,820 --> 00:30:20,140
dockerfile

581
00:30:20,140 --> 00:30:22,300
whichever darker file you want to look

582
00:30:22,300 --> 00:30:24,790
at and let me exit here real quick so I

583
00:30:24,790 --> 00:30:32,790
could show you a docker file projects

584
00:30:33,360 --> 00:30:40,420
junghwa ah when you look at a darker

585
00:30:40,420 --> 00:30:43,120
file right each one of the entries in

586
00:30:43,120 --> 00:30:46,420
the darker file is a different overlay

587
00:30:46,420 --> 00:30:49,450
file system setting and what happens is

588
00:30:49,450 --> 00:30:51,520
when you start with a base image like a

589
00:30:51,520 --> 00:30:52,870
bun - right

590
00:30:52,870 --> 00:30:54,850
it doesn't go and download it again it

591
00:30:54,850 --> 00:30:57,670
said oh the in Boonton lay a base image

592
00:30:57,670 --> 00:31:01,390
was sha-256 of this do you have it yes

593
00:31:01,390 --> 00:31:04,540
okay from that shot 256 I'm gonna do a

594
00:31:04,540 --> 00:31:09,520
diff of that layer with this command and

595
00:31:09,520 --> 00:31:12,460
it stores the diff and then you do

596
00:31:12,460 --> 00:31:15,010
another diff of that layer with the next

597
00:31:15,010 --> 00:31:17,680
command and so the overlays when you

598
00:31:17,680 --> 00:31:19,080
start think and eating them all together

599
00:31:19,080 --> 00:31:22,780
or overlay FS does is it equals the

600
00:31:22,780 --> 00:31:26,380
actual container that you're in so quite

601
00:31:26,380 --> 00:31:29,470
literally if you want to go and navigate

602
00:31:29,470 --> 00:31:33,790
a container you can't go into VAR Lib

603
00:31:33,790 --> 00:31:37,690
darker volumes you can go into one of

604
00:31:37,690 --> 00:31:42,610
these shot 256 is and depending on which

605
00:31:42,610 --> 00:31:45,340
one you pick you're gonna have a file

606
00:31:45,340 --> 00:31:48,730
system right and so some of the earlier

607
00:31:48,730 --> 00:31:52,090
ones may show you some of the bases and

608
00:31:52,090 --> 00:31:55,320
you could tie these together you know

609
00:31:55,320 --> 00:31:59,189
let's see if I can find one

610
00:32:00,809 --> 00:32:05,739
about ah that's pretty old that's one of

611
00:32:05,739 --> 00:32:15,129
these no it's just data that's just data

612
00:32:15,129 --> 00:32:19,749
also those are databases not having an

613
00:32:19,749 --> 00:32:21,519
easy one today I thought we just had one

614
00:32:21,519 --> 00:32:24,899
earlier oh sorry

615
00:32:24,899 --> 00:32:30,909
let's try this one I could do the work

616
00:32:30,909 --> 00:32:33,129
and actually try to find it now let me

617
00:32:33,129 --> 00:32:40,119
see if I can find the word DIF fine dot

618
00:32:40,119 --> 00:32:46,599
slash - named if oh there we go oh it's

619
00:32:46,599 --> 00:32:50,609
an overly - my bad - no really - sorry

620
00:32:50,609 --> 00:32:53,649
they get the wrong place there we go

621
00:32:53,649 --> 00:32:56,529
so here's a diff in the file system for

622
00:32:56,529 --> 00:32:59,289
overly - right so depending on the OS

623
00:32:59,289 --> 00:33:00,639
depending on what you're trying to do

624
00:33:00,639 --> 00:33:03,099
you may have different always look this

625
00:33:03,099 --> 00:33:05,559
one is Alpine Linux right so this is

626
00:33:05,559 --> 00:33:08,320
actually the the what's running in that

627
00:33:08,320 --> 00:33:11,320
container for that image right so with

628
00:33:11,320 --> 00:33:13,210
that said you know where the things are

629
00:33:13,210 --> 00:33:15,399
in the image lets it know what happens

630
00:33:15,399 --> 00:33:19,210
when you want to run the containers so

631
00:33:19,210 --> 00:33:24,309
Who am I Moses my ID is 1000 so I'm the

632
00:33:24,309 --> 00:33:26,649
first user on the system but I am in the

633
00:33:26,649 --> 00:33:32,879
darker group okay so when you run a

634
00:33:32,879 --> 00:33:37,149
that's it when you run something so

635
00:33:37,149 --> 00:33:39,729
running let's do dart let's do lab for

636
00:33:39,729 --> 00:33:42,279
real quick I've given you the command

637
00:33:42,279 --> 00:33:49,090
line docker run itd the PWD temp temp

638
00:33:49,090 --> 00:33:54,489
nginx when you run this okay you run

639
00:33:54,489 --> 00:33:59,129
this you run this white give the

640
00:34:02,149 --> 00:34:05,789
go in the container or you run let's say

641
00:34:05,789 --> 00:34:11,119
darker exec let's see docker PS docker

642
00:34:11,119 --> 00:34:12,389
exec

643
00:34:12,389 --> 00:34:22,220
this all right when you touch this file

644
00:34:24,589 --> 00:34:28,168
right what do you touch it as so I

645
00:34:28,168 --> 00:34:35,819
remember I am user I am you ID ID 1000

646
00:34:35,819 --> 00:34:38,849
my user name is Moses when I go into

647
00:34:38,849 --> 00:34:41,550
temp because I mounted so notice that

648
00:34:41,550 --> 00:34:45,089
this temp was mounted into the container

649
00:34:45,089 --> 00:34:47,869
that's what I did

650
00:34:48,409 --> 00:34:52,619
did I actually do that maybe I didn't do

651
00:34:52,619 --> 00:35:01,980
that docker PS let's look at that today

652
00:35:01,980 --> 00:35:07,740
actually Monta the right volume uh mount

653
00:35:07,740 --> 00:35:22,200
my mount mount then you know what I

654
00:35:22,200 --> 00:35:23,369
probably picked the wrong one

655
00:35:23,369 --> 00:35:26,010
oh yeah I didn't pick the engine x1

656
00:35:26,010 --> 00:35:28,520
sorry did I pick the nginx one

657
00:35:28,520 --> 00:35:34,190
that's why that didn't work this one

658
00:35:34,190 --> 00:35:38,640
when I mount the right volume here my

659
00:35:38,640 --> 00:35:51,540
mistake ah like this okay I'm going to

660
00:35:51,540 --> 00:35:55,349
temp and there is my haha right but if I

661
00:35:55,349 --> 00:35:58,710
do it'll SLA that file was written as

662
00:35:58,710 --> 00:36:06,060
root so wait a minute I executed a task

663
00:36:06,060 --> 00:36:09,839
as a lower privileged user but I wrote a

664
00:36:09,839 --> 00:36:13,050
roo file onto the host hold on a second

665
00:36:13,050 --> 00:36:19,069
how so this is how you run a container

666
00:36:19,069 --> 00:36:23,970
the container runs a daemon that Daymond

667
00:36:23,970 --> 00:36:27,750
has elevated privileges can actually be

668
00:36:27,750 --> 00:36:31,619
root and it runs whatever you want as

669
00:36:31,619 --> 00:36:36,500
root but it runs it in a container okay

670
00:36:36,500 --> 00:36:39,720
that's what it does so you're like oh

671
00:36:39,720 --> 00:36:42,030
man I got root but i got root in a

672
00:36:42,030 --> 00:36:45,000
container how can i leverage this to my

673
00:36:45,000 --> 00:36:46,369
advantage

674
00:36:46,369 --> 00:36:53,579
Stoke Red Hat calls these things super

675
00:36:53,579 --> 00:36:58,950
privileged containers alright super

676
00:36:58,950 --> 00:37:00,990
private containers are nothing more than

677
00:37:00,990 --> 00:37:02,609
a container that is running is a

678
00:37:02,609 --> 00:37:04,950
privileged mode remember containers are

679
00:37:04,950 --> 00:37:06,750
for operations and software packaging

680
00:37:06,750 --> 00:37:09,869
they're not for security right so Red

681
00:37:09,869 --> 00:37:12,569
Hat packaged all of its tools for

682
00:37:12,569 --> 00:37:14,450
administrators kind of like the windows

683
00:37:14,450 --> 00:37:17,609
are Sat tools right the remote system

684
00:37:17,609 --> 00:37:20,280
administration tools right have packaged

685
00:37:20,280 --> 00:37:21,960
them as a container because it makes

686
00:37:21,960 --> 00:37:24,180
sense and to run it you need to have

687
00:37:24,180 --> 00:37:26,339
privileges on the host so let me explain

688
00:37:26,339 --> 00:37:29,760
what this command does this command what

689
00:37:29,760 --> 00:37:35,640
it does is it runs this IPC right

690
00:37:35,640 --> 00:37:37,440
actually I wish I could draw on this

691
00:37:37,440 --> 00:37:37,829
thing

692
00:37:37,829 --> 00:37:41,790
it runs this IPC it basically mounts the

693
00:37:41,790 --> 00:37:44,609
hosts inter-process communication the

694
00:37:44,609 --> 00:37:46,829
host networking the host pidz

695
00:37:46,829 --> 00:37:50,579
as a privileged container and mounts the

696
00:37:50,579 --> 00:37:54,000
host file system into the container so

697
00:37:54,000 --> 00:37:56,609
basically you run the container as if

698
00:37:56,609 --> 00:37:57,830
you're on the host

699
00:37:57,830 --> 00:38:03,950
so if so the point of this process is if

700
00:38:03,950 --> 00:38:11,130
you have a user that is running as a non

701
00:38:11,130 --> 00:38:14,730
root user but they can run a darker

702
00:38:14,730 --> 00:38:17,070
daemon right there in the darker group

703
00:38:17,070 --> 00:38:21,030
and then just in that group they can run

704
00:38:21,030 --> 00:38:23,330
a container as root as a privileged user

705
00:38:23,330 --> 00:38:25,950
right in the tea and its default setting

706
00:38:25,950 --> 00:38:29,490
right and getting and basically doing

707
00:38:29,490 --> 00:38:37,130
Purvis okay um like a boss all right so

708
00:38:37,130 --> 00:38:40,860
let's and by the way if you want to see

709
00:38:40,860 --> 00:38:43,710
this running right if you really want to

710
00:38:43,710 --> 00:38:47,490
kind of play around with this we're

711
00:38:47,490 --> 00:38:48,690
gonna do this in a second but I'm gonna

712
00:38:48,690 --> 00:38:49,980
give you a kind of a sneak peek here

713
00:38:49,980 --> 00:38:54,870
sneak peek here go to lab 5 lab 5 has

714
00:38:54,870 --> 00:38:57,890
got this so if you wanted to run this

715
00:38:57,890 --> 00:39:01,200
right if we just literally copied this

716
00:39:01,200 --> 00:39:06,930
out and said you know paste your Oh

717
00:39:06,930 --> 00:39:08,340
hopefully get the container running let

718
00:39:08,340 --> 00:39:13,010
me let me delete the container all right

719
00:39:13,010 --> 00:39:15,210
you're gonna run and by the way it's

720
00:39:15,210 --> 00:39:17,010
centos right you saw that I went from a

721
00:39:17,010 --> 00:39:19,350
boon to the CentOS and the reason I went

722
00:39:19,350 --> 00:39:20,760
from a bunch of the CentOS is because

723
00:39:20,760 --> 00:39:22,740
what is a container it's a bunch of

724
00:39:22,740 --> 00:39:26,280
userland binaries married to the Linux

725
00:39:26,280 --> 00:39:31,100
kernel ok and so now if I go to host

726
00:39:31,100 --> 00:39:34,200
this is my host OS and how do I know

727
00:39:34,200 --> 00:39:36,720
it's my host OS because I can go into

728
00:39:36,720 --> 00:39:39,210
Etsy I can cat LSB release and it's

729
00:39:39,210 --> 00:39:41,700
running pop OS and I can cut the host

730
00:39:41,700 --> 00:39:46,410
name and I know the host name so I'm

731
00:39:46,410 --> 00:39:50,670
running as root using that command so

732
00:39:50,670 --> 00:39:52,440
I'm gonna pause for a second because

733
00:39:52,440 --> 00:39:55,110
they're like 40 min like 40 minutes I

734
00:39:55,110 --> 00:39:56,340
gave you a lot of things to think about

735
00:39:56,340 --> 00:40:01,250
before I go on are there any questions

736
00:40:29,790 --> 00:40:41,850
I think David that's a new I am yeah all

737
00:40:41,850 --> 00:40:50,180
right cool so now before I ran into this

738
00:40:50,180 --> 00:40:54,960
thing this conference I looked at showed

739
00:40:54,960 --> 00:40:58,830
an and I went ok so I'm gonna show

740
00:40:58,830 --> 00:41:02,550
people how they can do this through a

741
00:41:02,550 --> 00:41:05,550
network daemon right which is possible

742
00:41:05,550 --> 00:41:07,170
which is possible okay

743
00:41:07,170 --> 00:41:11,370
however how many people are not just

744
00:41:11,370 --> 00:41:14,850
crazy enough to run docker host daemon

745
00:41:14,850 --> 00:41:18,330
on zero zero zero zero because you've

746
00:41:18,330 --> 00:41:21,750
got to actually like work at this you

747
00:41:21,750 --> 00:41:23,550
gotta actually have effort to do this

748
00:41:23,550 --> 00:41:25,710
right how many people have actually done

749
00:41:25,710 --> 00:41:29,340
darker hoe zero zero zero and then how

750
00:41:29,340 --> 00:41:32,430
many people have exposed the docker port

751
00:41:32,430 --> 00:41:35,100
to the Internet to the freaking Internet

752
00:41:35,100 --> 00:41:38,130
and how many of them have the word

753
00:41:38,130 --> 00:41:40,980
darker in it right which would give you

754
00:41:40,980 --> 00:41:42,240
more of an indication that the type of

755
00:41:42,240 --> 00:41:44,850
the port that's running is darker and it

756
00:41:44,850 --> 00:41:46,650
turns out that it's about six thousand

757
00:41:46,650 --> 00:41:48,840
hosts on the internet that may or may

758
00:41:48,840 --> 00:41:52,850
not be running in this mode all right so

759
00:41:52,850 --> 00:41:57,360
so this is pretty kind of wild right

760
00:41:57,360 --> 00:41:59,040
that there's actually people that do

761
00:41:59,040 --> 00:42:00,450
this but it turns out there might

762
00:42:00,450 --> 00:42:02,040
actually be which is like this is like

763
00:42:02,040 --> 00:42:03,900
super bad like do not run it this way

764
00:42:03,900 --> 00:42:08,280
right so to be safer okay I'm gonna show

765
00:42:08,280 --> 00:42:09,960
you how we're gonna just show you what

766
00:42:09,960 --> 00:42:13,290
this does so what this does is is darker

767
00:42:13,290 --> 00:42:17,910
has the ability to to bind itself to a

768
00:42:17,910 --> 00:42:20,970
socket okay and it can do this in a

769
00:42:20,970 --> 00:42:24,900
secure and insecure way and because

770
00:42:24,900 --> 00:42:28,530
darker is just an API to run stuff you

771
00:42:28,530 --> 00:42:30,060
can do this on Windows you could do this

772
00:42:30,060 --> 00:42:33,240
on Mac users pretty crazy so what do you

773
00:42:33,240 --> 00:42:35,040
could do is you could stop your darker

774
00:42:35,040 --> 00:42:37,790
process all right which I'm gonna do now

775
00:42:37,790 --> 00:42:41,330
I'm just gonna

776
00:42:46,520 --> 00:42:50,250
okay and on top of stopping my darker

777
00:42:50,250 --> 00:42:53,520
process I'm gonna restart it here in the

778
00:42:53,520 --> 00:42:55,500
foreground of arching your sword in the

779
00:42:55,500 --> 00:42:57,480
other wind in the foreground we're

780
00:42:57,480 --> 00:42:59,280
starting the foreground but I'm gonna

781
00:42:59,280 --> 00:43:02,490
bind it to my local host as well so it's

782
00:43:02,490 --> 00:43:05,430
gonna be running on a on the UNIX socket

783
00:43:05,430 --> 00:43:08,089
and it's gonna also be listening on a

784
00:43:08,089 --> 00:43:12,150
local host okay so you know if you do

785
00:43:12,150 --> 00:43:16,880
that here or actually it's this command

786
00:43:16,940 --> 00:43:21,150
so if you do that here know know why

787
00:43:21,150 --> 00:43:25,349
it's not copying and pasting there we go

788
00:43:25,349 --> 00:43:32,640
uh that is root it's gonna be root you

789
00:43:32,640 --> 00:43:34,410
could see that it says alright I'm

790
00:43:34,410 --> 00:43:37,530
listening on this port and I'm listening

791
00:43:37,530 --> 00:43:41,700
in sock right so you know to test it you

792
00:43:41,700 --> 00:43:45,390
could say darker - H it may even be yeah

793
00:43:45,390 --> 00:43:50,640
- h1 27001 PS run the PS command

794
00:43:50,640 --> 00:43:56,160
so maybe it's capital H yeah its capital

795
00:43:56,160 --> 00:43:58,079
H I'm sorry it's not the case H capital

796
00:43:58,079 --> 00:44:03,319
H darker capital h1 2701 the PS command

797
00:44:03,319 --> 00:44:07,529
that seems to work so you know if we did

798
00:44:07,529 --> 00:44:08,880
some of the old you know some of the

799
00:44:08,880 --> 00:44:10,859
legacy ones like run a daemon

800
00:44:10,859 --> 00:44:14,309
right so that's just one is a quick

801
00:44:14,309 --> 00:44:25,819
daemon here yep great

802
00:44:28,890 --> 00:44:31,569
and you can see that it says well it's

803
00:44:31,569 --> 00:44:38,650
not running yet did it why bring it

804
00:44:38,650 --> 00:44:42,130
locally so yeah let's see yeah it's not

805
00:44:42,130 --> 00:44:44,640
really updating this it will okay well

806
00:44:44,640 --> 00:44:50,010
let's go ahead and go in there docker

807
00:44:50,010 --> 00:44:59,260
exec frosty Kirin in bash right this is

808
00:44:59,260 --> 00:45:01,690
running over localhost and if you

809
00:45:01,690 --> 00:45:02,890
wouldn't want to prove it you can

810
00:45:02,890 --> 00:45:05,220
actually do a you can go into your box

811
00:45:05,220 --> 00:45:10,150
you can do a sudo TCP dump on that box

812
00:45:10,150 --> 00:45:15,150
and you can actually you know look at

813
00:45:17,730 --> 00:45:21,940
two three some five and you know because

814
00:45:21,940 --> 00:45:24,730
it's not encrypted you'll probably see

815
00:45:24,730 --> 00:45:32,710
the the the bin wait okay exactly when

816
00:45:32,710 --> 00:45:37,390
you say T the bash shell right yeah so

817
00:45:37,390 --> 00:45:39,119
there it is right so here you are

818
00:45:39,119 --> 00:45:42,040
interacting with that bash shell all

819
00:45:42,040 --> 00:45:45,010
right and so if this was bound to port 0

820
00:45:45,010 --> 00:45:47,710
like we're seeing on the internet that's

821
00:45:47,710 --> 00:45:49,680
kind of crazy right because this is a

822
00:45:49,680 --> 00:45:52,710
command execution basically but worse

823
00:45:52,710 --> 00:45:58,240
okay because you know if you wanted to

824
00:45:58,240 --> 00:46:00,430
do something really evil to these boxes

825
00:46:00,430 --> 00:46:02,680
that are running in this way and they're

826
00:46:02,680 --> 00:46:05,050
running in a default somewhat default

827
00:46:05,050 --> 00:46:07,270
fashion right you could do something

828
00:46:07,270 --> 00:46:10,329
pretty crazy you could say hey darker I

829
00:46:10,329 --> 00:46:15,150
want you to connect to that host on one

830
00:46:15,150 --> 00:46:18,730
27001 i want to run a container you can

831
00:46:18,730 --> 00:46:21,069
call the container whatever you want so

832
00:46:21,069 --> 00:46:22,270
you can if they're already running an

833
00:46:22,270 --> 00:46:23,710
engine x container you could call it

834
00:46:23,710 --> 00:46:24,339
nginx

835
00:46:24,339 --> 00:46:25,990
where you could kind of fool them to

836
00:46:25,990 --> 00:46:28,450
call it something else you can then say

837
00:46:28,450 --> 00:46:31,030
i want to do a privilege pod with all

838
00:46:31,030 --> 00:46:33,250
the privileged stuff and i want to go

839
00:46:33,250 --> 00:46:35,770
ahead and mount the host i want to run a

840
00:46:35,770 --> 00:46:40,310
busy box shell and it will

841
00:46:40,310 --> 00:46:42,920
basically run it let's call this one I

842
00:46:42,920 --> 00:46:49,490
don't know apache2 or something right

843
00:46:49,490 --> 00:46:52,910
and now I've got a root shell remotely

844
00:46:52,910 --> 00:46:54,680
on a box right if you wanted like did

845
00:46:54,680 --> 00:46:57,140
you get detached this you could kind of

846
00:46:57,140 --> 00:46:58,400
detach it and just see it running

847
00:46:58,400 --> 00:47:00,080
somewhere else but now I've got a root

848
00:47:00,080 --> 00:47:02,630
shell you know running on this box and

849
00:47:02,630 --> 00:47:13,900
you know if you really - vv7 get more

850
00:47:13,900 --> 00:47:16,280
packages to go actually - X would be

851
00:47:16,280 --> 00:47:27,950
best - X and s 0 right and here's the

852
00:47:27,950 --> 00:47:30,650
host run again right so once again you

853
00:47:30,650 --> 00:47:33,020
could do that remotely right you can see

854
00:47:33,020 --> 00:47:37,040
that I'm interacting with the Box kind

855
00:47:37,040 --> 00:47:38,300
of remotely you can see my root

856
00:47:38,300 --> 00:47:40,730
directories here with all the terminal

857
00:47:40,730 --> 00:47:43,250
escape characters and everything so

858
00:47:43,250 --> 00:47:44,930
pretty pretty crazy like you could do

859
00:47:44,930 --> 00:47:48,290
this now there are people that actually

860
00:47:48,290 --> 00:47:51,890
do if you don't know that there's

861
00:47:51,890 --> 00:47:54,010
actually a witkin's find this in like

862
00:47:54,010 --> 00:47:56,480
kubernetes so if you're running

863
00:47:56,480 --> 00:47:59,030
kubernetes there is something called a

864
00:47:59,030 --> 00:48:05,480
pod security policy that if you for a

865
00:48:05,480 --> 00:48:08,390
privilege pod great so you know

866
00:48:08,390 --> 00:48:10,790
hopefully if you are running a

867
00:48:10,790 --> 00:48:12,890
kubernetes environment which runs

868
00:48:12,890 --> 00:48:16,070
containers there actually is a way to do

869
00:48:16,070 --> 00:48:20,030
a pod security or yeah pod security

870
00:48:20,030 --> 00:48:23,660
policy that restricts the privileged

871
00:48:23,660 --> 00:48:26,920
accent you know the privilege pods so

872
00:48:26,920 --> 00:48:31,220
yeah see allow privacy right or do not

873
00:48:31,220 --> 00:48:33,770
allow privacy or default allow prevx or

874
00:48:33,770 --> 00:48:38,030
you know allow for privilege pods to be

875
00:48:38,030 --> 00:48:41,480
started right so that you can't you know

876
00:48:41,480 --> 00:48:44,990
create a privilege pod right so you can

877
00:48:44,990 --> 00:48:48,460
actually set your pod security policy to

878
00:48:48,460 --> 00:48:54,300
deny and I believe by default this is

879
00:48:54,300 --> 00:49:00,060
on so you may want to consider enabling

880
00:49:00,060 --> 00:49:01,380
this right so what would end up

881
00:49:01,380 --> 00:49:03,960
happening there is somebody finds a

882
00:49:03,960 --> 00:49:07,890
kubernetes host that is open and

883
00:49:07,890 --> 00:49:11,220
available to the to the world and you

884
00:49:11,220 --> 00:49:12,600
know just like you saw the container

885
00:49:12,600 --> 00:49:16,140
that I ran that was a bash shell over

886
00:49:16,140 --> 00:49:19,080
the darker API you could do the same

887
00:49:19,080 --> 00:49:22,650
thing over the kubernetes api and kind

888
00:49:22,650 --> 00:49:25,890
of hose things right so with that said I

889
00:49:25,890 --> 00:49:27,570
kind of want to show you that yeah

890
00:49:27,570 --> 00:49:31,070
containers are not magical right

891
00:49:31,070 --> 00:49:33,690
actually they could lead to prevents

892
00:49:33,690 --> 00:49:36,450
kink in certain cases right so they're

893
00:49:36,450 --> 00:49:38,340
made for software packaging they're not

894
00:49:38,340 --> 00:49:40,380
they're made for ops right they're not

895
00:49:40,380 --> 00:49:42,990
made necessarily for security so be

896
00:49:42,990 --> 00:49:45,300
careful don't expose these things you

897
00:49:45,300 --> 00:49:46,860
know don't have your developers expose

898
00:49:46,860 --> 00:49:48,240
these things if you find this thing

899
00:49:48,240 --> 00:49:49,950
you've got another way of getting root

900
00:49:49,950 --> 00:49:53,850
now on a on a Linux box and by the way

901
00:49:53,850 --> 00:49:56,400
you there's a potential that this could

902
00:49:56,400 --> 00:49:57,930
have believed' escalations and Windows

903
00:49:57,930 --> 00:49:59,610
as well kind of still playing around

904
00:49:59,610 --> 00:50:03,870
with that and that's all I got so I'm

905
00:50:03,870 --> 00:50:11,370
open for questions and the like hey

906
00:50:11,370 --> 00:50:14,190
thanks a lot there was just if anybody

907
00:50:14,190 --> 00:50:16,380
that has any questions please put those

908
00:50:16,380 --> 00:50:17,670
from a chat or you can post them to the

909
00:50:17,670 --> 00:50:26,850
track one team and disk were yeah yeah

910
00:50:26,850 --> 00:50:28,560
and I did I didn't actually mention this

911
00:50:28,560 --> 00:50:32,010
but um for people who run like you know

912
00:50:32,010 --> 00:50:34,410
framework like if you actually run the

913
00:50:34,410 --> 00:50:37,740
Metasploit framework we didn't get into

914
00:50:37,740 --> 00:50:40,820
it today but if you go into the github

915
00:50:40,820 --> 00:50:45,390
you will see that there is a docker file

916
00:50:45,390 --> 00:50:49,200
in here with like a darker ignore and so

917
00:50:49,200 --> 00:50:50,430
here's a docker file and a docker

918
00:50:50,430 --> 00:50:53,670
compose as well so you can actually use

919
00:50:53,670 --> 00:50:58,410
darker compose to build your Metasploit

920
00:50:58,410 --> 00:51:00,900
framework and as a container with you

921
00:51:00,900 --> 00:51:03,510
know Postgres and the like and you don't

922
00:51:03,510 --> 00:51:05,280
have to fiddle with doing all the

923
00:51:05,280 --> 00:51:06,960
dependencies of getting framework to

924
00:51:06,960 --> 00:51:08,069
fire

925
00:51:08,069 --> 00:51:14,640
um I I think it's probably reasonable to

926
00:51:14,640 --> 00:51:17,509
run it in this way

927
00:51:34,660 --> 00:51:39,490
Oh which by the way I saw it doctor

928
00:51:39,490 --> 00:51:41,680
requires a reboot is that on Windows or

929
00:51:41,680 --> 00:52:09,220
Mac I should have asked all right if

930
00:52:09,220 --> 00:52:11,910
there's nothing if there's no questions

931
00:52:11,910 --> 00:52:16,080
then I think we're good

932
00:52:16,830 --> 00:52:19,570
awesome well thank you so much Moses for

933
00:52:19,570 --> 00:52:22,330
dropping this knowledge on everybody you

934
00:52:22,330 --> 00:52:24,250
know feel free if you want to to just

935
00:52:24,250 --> 00:52:26,350
hang out a little bit into a disk or if

936
00:52:26,350 --> 00:52:28,630
you might have any questions but have a

937
00:52:28,630 --> 00:52:30,580
great rest of your day and we'll see you

938
00:52:30,580 --> 00:52:33,330
guys in the next sessions

939
00:52:45,980 --> 00:52:48,040
you

