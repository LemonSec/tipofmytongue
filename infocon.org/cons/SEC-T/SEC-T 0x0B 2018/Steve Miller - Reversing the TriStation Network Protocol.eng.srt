1
00:00:04,920 --> 00:00:13,740
hello<font color="#CCCCCC"> I'm Steven or</font><font color="#E5E5E5"> the title of my talk</font>

2
00:00:09,690 --> 00:00:16,230
today<font color="#E5E5E5"> is reversing the reversing of the</font>

3
00:00:13,740 --> 00:00:19,020
<font color="#CCCCCC">tri station protocol it's mostly a story</font>

4
00:00:16,230 --> 00:00:22,980
<font color="#CCCCCC">about me learning</font><font color="#E5E5E5"> about industrial</font>

5
00:00:19,020 --> 00:00:25,019
control systems ICS<font color="#E5E5E5"> security which I had</font>

6
00:00:22,980 --> 00:00:28,019
you know a<font color="#E5E5E5"> couple months ago</font><font color="#CCCCCC"> know</font>

7
00:00:25,019 --> 00:00:32,070
<font color="#E5E5E5">nothing about and three T's in</font>

8
00:00:28,019 --> 00:00:33,899
particular<font color="#CCCCCC"> triton try connects and try</font>

9
00:00:32,070 --> 00:00:37,710
station<font color="#E5E5E5"> I'll explain what</font><font color="#CCCCCC"> all of</font><font color="#E5E5E5"> those</font>

10
00:00:33,899 --> 00:00:41,340
are shortly<font color="#CCCCCC"> a little bit about me Steve</font>

11
00:00:37,710 --> 00:00:43,440
<font color="#E5E5E5">Miller I am</font><font color="#CCCCCC"> a researcher at</font><font color="#E5E5E5"> fire I slash</font>

12
00:00:41,340 --> 00:00:46,280
mandiant<font color="#CCCCCC"> I used to do</font><font color="#E5E5E5"> host-based</font>

13
00:00:43,440 --> 00:00:50,610
forensics now I do<font color="#E5E5E5"> network stuff and</font>

14
00:00:46,280 --> 00:00:53,610
dabbling in ICS stuff<font color="#CCCCCC"> I live in the u.s.</font>

15
00:00:50,610 --> 00:00:56,489
in central New<font color="#E5E5E5"> York New York is a big</font>

16
00:00:53,610 --> 00:00:59,550
<font color="#CCCCCC">state I live in a little tiny town</font><font color="#E5E5E5"> right</font>

17
00:00:56,489 --> 00:01:02,879
in the middle<font color="#CCCCCC"> I've been playing the</font>

18
00:00:59,550 --> 00:01:05,880
battlefield<font color="#CCCCCC"> 5 open beta</font><font color="#E5E5E5"> know if anybody</font>

19
00:01:02,879 --> 00:01:07,679
plays that<font color="#E5E5E5"> but my grandma thinks I play</font>

20
00:01:05,880 --> 00:01:11,640
video games for<font color="#CCCCCC"> a living</font><font color="#E5E5E5"> so it's</font>

21
00:01:07,680 --> 00:01:14,790
suitable<font color="#E5E5E5"> and that's a picture of my</font>

22
00:01:11,640 --> 00:01:17,850
<font color="#E5E5E5">motorcycle BMW f800r yes when I was</font>

23
00:01:14,790 --> 00:01:21,390
<font color="#E5E5E5">riding through Northern California about</font>

24
00:01:17,850 --> 00:01:24,330
<font color="#CCCCCC">a year ago</font><font color="#E5E5E5"> I am on fire eyes advanced</font>

25
00:01:21,390 --> 00:01:28,740
<font color="#E5E5E5">practices team we have a cool logo</font><font color="#CCCCCC"> it's</font>

26
00:01:24,330 --> 00:01:31,770
an eagle<font color="#E5E5E5"> shooting</font><font color="#CCCCCC"> to desert</font><font color="#E5E5E5"> Eagles</font><font color="#CCCCCC"> so we</font>

27
00:01:28,740 --> 00:01:35,220
think<font color="#E5E5E5"> we have a pretty cool logo anyway</font>

28
00:01:31,770 --> 00:01:38,158
<font color="#E5E5E5">that's a little bit about me</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> is a</font>

29
00:01:35,220 --> 00:01:40,829
just<font color="#E5E5E5"> to get you into why I became</font>

30
00:01:38,159 --> 00:01:43,320
<font color="#CCCCCC">interested in security it wasn't this</font>

31
00:01:40,829 --> 00:01:45,960
but when I was<font color="#E5E5E5"> traveling I was living in</font>

32
00:01:43,320 --> 00:01:48,380
Australia and my mom<font color="#E5E5E5"> received a letter</font>

33
00:01:45,960 --> 00:01:52,798
<font color="#E5E5E5">of mail from the US Office of Personnel</font>

34
00:01:48,380 --> 00:01:55,890
<font color="#CCCCCC">Management and</font><font color="#E5E5E5"> it was about a year after</font>

35
00:01:52,799 --> 00:01:58,320
<font color="#CCCCCC">the OPM</font><font color="#E5E5E5"> hack went public they decided to</font>

36
00:01:55,890 --> 00:02:04,259
send mail<font color="#E5E5E5"> to everyone which was nice of</font>

37
00:01:58,320 --> 00:02:06,169
them<font color="#CCCCCC"> but the US OPM is manages the</font>

38
00:02:04,259 --> 00:02:10,318
records of<font color="#E5E5E5"> all</font><font color="#CCCCCC"> the government</font><font color="#E5E5E5"> employees</font>

39
00:02:06,170 --> 00:02:13,050
so my entire security clearance and

40
00:02:10,318 --> 00:02:13,790
everything I ever the government ever

41
00:02:13,050 --> 00:02:16,909
knew about

42
00:02:13,790 --> 00:02:18,890
is now owned<font color="#CCCCCC"> by China you could probably</font>

43
00:02:16,909 --> 00:02:21,590
look it up on<font color="#E5E5E5"> the dark web</font><font color="#CCCCCC"> if you're</font>

44
00:02:18,890 --> 00:02:24,470
interested<font color="#CCCCCC"> but anyway that's kind of why</font>

45
00:02:21,590 --> 00:02:26,420
I'm into security<font color="#CCCCCC"> and for</font><font color="#E5E5E5"> the next about</font>

46
00:02:24,470 --> 00:02:30,409
<font color="#CCCCCC">20</font><font color="#E5E5E5"> minutes</font><font color="#CCCCCC"> I'll talk to you about</font><font color="#E5E5E5"> Triton</font>

47
00:02:26,420 --> 00:02:35,750
which is a malware framework<font color="#CCCCCC"> try konnex</font>

48
00:02:30,409 --> 00:02:38,899
which is an ICS<font color="#E5E5E5"> PLC programmable logic</font>

49
00:02:35,750 --> 00:02:42,739
controller and<font color="#CCCCCC"> tri station which until</font>

50
00:02:38,900 --> 00:02:45,140
recently was<font color="#CCCCCC"> a undocumented proprietary</font>

51
00:02:42,739 --> 00:02:47,540
<font color="#E5E5E5">network protocol so this is really</font><font color="#CCCCCC"> just</font>

52
00:02:45,140 --> 00:02:50,659
<font color="#E5E5E5">my interest in these subjects</font><font color="#CCCCCC"> and I kind</font>

53
00:02:47,540 --> 00:02:53,030
of<font color="#E5E5E5"> poked at them for a little</font><font color="#CCCCCC"> bit</font><font color="#E5E5E5"> and I</font>

54
00:02:50,659 --> 00:02:54,138
hope you will<font color="#E5E5E5"> learn something I'm not</font>

55
00:02:53,030 --> 00:02:55,549
<font color="#E5E5E5">sure what you all have different</font>

56
00:02:54,139 --> 00:02:56,780
<font color="#CCCCCC">backgrounds in different interests I'm</font>

57
00:02:55,549 --> 00:02:58,489
not sure what you'll take away<font color="#E5E5E5"> from this</font>

58
00:02:56,780 --> 00:03:04,549
<font color="#E5E5E5">but we will see</font>

59
00:02:58,489 --> 00:03:07,810
so<font color="#E5E5E5"> Triton</font><font color="#CCCCCC"> sometime around December 2017</font>

60
00:03:04,549 --> 00:03:11,780
I think<font color="#CCCCCC"> fireEye released a blog about</font>

61
00:03:07,810 --> 00:03:14,840
the Triton<font color="#E5E5E5"> malware framework</font><font color="#CCCCCC"> it was</font>

62
00:03:11,780 --> 00:03:18,919
written in Python it was found at a

63
00:03:14,840 --> 00:03:20,810
customer site<font color="#E5E5E5"> in the Middle East</font><font color="#CCCCCC"> it was</font>

64
00:03:18,919 --> 00:03:23,930
compiled in PI<font color="#CCCCCC"> 2 Exe</font>

65
00:03:20,810 --> 00:03:27,440
<font color="#E5E5E5">and it was designed</font><font color="#CCCCCC"> to interact</font><font color="#E5E5E5"> with</font><font color="#CCCCCC"> try</font>

66
00:03:23,930 --> 00:03:29,780
<font color="#CCCCCC">connects controllers this is the first</font>

67
00:03:27,440 --> 00:03:32,000
of<font color="#E5E5E5"> its</font><font color="#CCCCCC"> kind we live in an industry where</font>

68
00:03:29,780 --> 00:03:34,190
everything's like a total<font color="#E5E5E5"> GameChanger</font>

69
00:03:32,000 --> 00:03:37,010
<font color="#CCCCCC">but</font><font color="#E5E5E5"> I think</font><font color="#CCCCCC"> this was this</font><font color="#E5E5E5"> is kind of a</font>

70
00:03:34,190 --> 00:03:38,629
<font color="#E5E5E5">game</font><font color="#CCCCCC"> changer so it's designed to</font>

71
00:03:37,010 --> 00:03:41,269
<font color="#E5E5E5">interact with try connect controllers</font>

72
00:03:38,629 --> 00:03:43,518
this is what a<font color="#E5E5E5"> try connects controller</font>

73
00:03:41,269 --> 00:03:47,510
looks<font color="#E5E5E5"> like</font><font color="#CCCCCC"> there's like three of</font>

74
00:03:43,519 --> 00:03:51,680
<font color="#E5E5E5">everything</font><font color="#CCCCCC"> triple redundancy</font><font color="#E5E5E5"> controller</font>

75
00:03:47,510 --> 00:03:54,620
<font color="#CCCCCC">Tricon</font><font color="#E5E5E5"> very clever</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> it's a</font><font color="#CCCCCC"> plc and</font>

76
00:03:51,680 --> 00:03:56,629
this is a particular<font color="#CCCCCC"> type of PLC which</font>

77
00:03:54,620 --> 00:03:59,180
is designed<font color="#E5E5E5"> for</font><font color="#CCCCCC"> safety systems so it</font>

78
00:03:56,629 --> 00:04:02,030
connects<font color="#E5E5E5"> to sensors and if the sensors</font>

79
00:03:59,180 --> 00:04:05,000
see something they have logic that turns

80
00:04:02,030 --> 00:04:07,449
a gizmo<font color="#E5E5E5"> or a motor or a widget</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> you</font>

81
00:04:05,000 --> 00:04:10,250
know controls some industrial process

82
00:04:07,449 --> 00:04:13,760
<font color="#CCCCCC">for safety reasons so that things like</font>

83
00:04:10,250 --> 00:04:15,799
oil<font color="#E5E5E5"> refineries don't explode</font><font color="#CCCCCC"> which is</font>

84
00:04:13,760 --> 00:04:16,599
you know I think<font color="#E5E5E5"> we can all see some</font>

85
00:04:15,799 --> 00:04:21,459
<font color="#CCCCCC">value in that</font>

86
00:04:16,599 --> 00:04:24,010
<font color="#CCCCCC">so petrochemicals oil and gas</font><font color="#E5E5E5"> power</font>

87
00:04:21,459 --> 00:04:27,710
<font color="#E5E5E5">pharmaceuticals anybody with a</font>

88
00:04:24,010 --> 00:04:30,020
<font color="#E5E5E5">industrial plant that wants to</font>

89
00:04:27,710 --> 00:04:32,570
have safety systems in a plant you might

90
00:04:30,020 --> 00:04:33,799
<font color="#E5E5E5">have hundreds of these literally</font>

91
00:04:32,570 --> 00:04:36,130
hundreds and<font color="#E5E5E5"> they could be all</font><font color="#CCCCCC"> over the</font>

92
00:04:33,800 --> 00:04:41,419
<font color="#E5E5E5">place and they are networked of course</font>

93
00:04:36,130 --> 00:04:46,610
<font color="#CCCCCC">try station is for the purpose of this</font>

94
00:04:41,419 --> 00:04:50,539
<font color="#E5E5E5">talk will be</font><font color="#CCCCCC"> the in protocol the</font><font color="#E5E5E5"> binary</font>

95
00:04:46,610 --> 00:04:54,290
protocol that allows<font color="#E5E5E5"> a PC running some</font>

96
00:04:50,540 --> 00:04:57,500
software<font color="#CCCCCC"> to communicate</font><font color="#E5E5E5"> with the Tricon</font>

97
00:04:54,290 --> 00:04:59,630
<font color="#E5E5E5">or try connects controller so everybody</font>

98
00:04:57,500 --> 00:05:02,240
got<font color="#E5E5E5"> their try contract connects try</font>

99
00:04:59,630 --> 00:05:04,909
<font color="#E5E5E5">Triton try station we got a lot</font><font color="#CCCCCC"> of</font>

100
00:05:02,240 --> 00:05:09,169
buzzwords<font color="#E5E5E5"> here so I will try not</font><font color="#CCCCCC"> to mix</font>

101
00:05:04,910 --> 00:05:11,810
them<font color="#CCCCCC"> up so sometime earlier this year it</font>

102
00:05:09,169 --> 00:05:14,539
was<font color="#E5E5E5"> like probably May</font><font color="#CCCCCC"> somebody was like</font>

103
00:05:11,810 --> 00:05:15,950
you<font color="#E5E5E5"> should look at the Triton malware</font><font color="#CCCCCC"> I</font>

104
00:05:14,540 --> 00:05:17,150
was like wow that's cool

105
00:05:15,950 --> 00:05:19,099
I didn't have anything to do with it

106
00:05:17,150 --> 00:05:20,929
when<font color="#E5E5E5"> my company responded in the</font>

107
00:05:19,100 --> 00:05:25,340
incident response<font color="#CCCCCC"> and somebody was like</font>

108
00:05:20,930 --> 00:05:26,960
it uses a proprietary protocol<font color="#CCCCCC"> I was</font>

109
00:05:25,340 --> 00:05:28,789
like what is proprietary mean I don't

110
00:05:26,960 --> 00:05:31,010
<font color="#CCCCCC">know it there's</font><font color="#E5E5E5"> like it's undocumented</font>

111
00:05:28,790 --> 00:05:34,070
and I'm awesome<font color="#CCCCCC"> undocumented things are</font>

112
00:05:31,010 --> 00:05:36,800
my favorite things<font color="#E5E5E5"> so</font><font color="#CCCCCC"> I thought to</font>

113
00:05:34,070 --> 00:05:39,020
myself<font color="#E5E5E5"> I became really like curious</font><font color="#CCCCCC"> how</font>

114
00:05:36,800 --> 00:05:41,180
<font color="#E5E5E5">does this malware framework use the</font>

115
00:05:39,020 --> 00:05:43,280
protocol<font color="#CCCCCC"> what does the protocol look</font>

116
00:05:41,180 --> 00:05:46,490
like<font color="#E5E5E5"> I asked around nobody had any pcap</font>

117
00:05:43,280 --> 00:05:49,489
which<font color="#E5E5E5"> is my worst case scenario there's</font>

118
00:05:46,490 --> 00:05:51,050
no<font color="#CCCCCC"> pee cap so the big questions for</font><font color="#E5E5E5"> me</font>

119
00:05:49,490 --> 00:05:54,020
and<font color="#CCCCCC"> this</font><font color="#E5E5E5"> was you</font><font color="#CCCCCC"> know part</font><font color="#E5E5E5"> of my job</font>

120
00:05:51,050 --> 00:05:55,729
<font color="#CCCCCC">right was to you know</font><font color="#E5E5E5"> what the hell what</font>

121
00:05:54,020 --> 00:05:57,409
<font color="#CCCCCC">the hell's</font><font color="#E5E5E5"> going on</font><font color="#CCCCCC"> how does the try</font>

122
00:05:55,729 --> 00:06:00,590
station protocol work what does it look

123
00:05:57,410 --> 00:06:03,320
<font color="#E5E5E5">like</font><font color="#CCCCCC"> to what extent did the malware</font>

124
00:06:00,590 --> 00:06:05,539
<font color="#E5E5E5">authors</font><font color="#CCCCCC"> reverse-engineer the protocol</font>

125
00:06:03,320 --> 00:06:09,320
<font color="#E5E5E5">yeah how</font><font color="#CCCCCC"> did they do that</font><font color="#E5E5E5"> and how did</font>

126
00:06:05,539 --> 00:06:11,240
they build a malware<font color="#CCCCCC"> family that spoke</font>

127
00:06:09,320 --> 00:06:14,210
with this protocol<font color="#CCCCCC"> and then to what</font>

128
00:06:11,240 --> 00:06:17,810
extent did they implement the protocol

129
00:06:14,210 --> 00:06:20,359
network stack into the malware<font color="#CCCCCC"> these are</font>

130
00:06:17,810 --> 00:06:22,940
important<font color="#CCCCCC"> questions because if what I've</font>

131
00:06:20,360 --> 00:06:26,660
observed in looking at a lot of malware

132
00:06:22,940 --> 00:06:28,850
<font color="#E5E5E5">is that when you</font><font color="#CCCCCC"> implement a protocol</font>

133
00:06:26,660 --> 00:06:33,560
you<font color="#E5E5E5"> have a very good chance of doing it</font>

134
00:06:28,850 --> 00:06:35,810
wrong<font color="#E5E5E5"> and if they did it wrong if there</font>

135
00:06:33,560 --> 00:06:37,820
was any sort of error<font color="#E5E5E5"> in their</font>

136
00:06:35,810 --> 00:06:41,040
implementation<font color="#CCCCCC"> then we would be</font><font color="#E5E5E5"> able to</font>

137
00:06:37,820 --> 00:06:43,080
detect<font color="#E5E5E5"> that right that was a kind of</font>

138
00:06:41,040 --> 00:06:44,940
yes and that<font color="#CCCCCC"> is true for</font><font color="#E5E5E5"> a lot</font><font color="#CCCCCC"> of other</font>

139
00:06:43,080 --> 00:06:47,159
protocols<font color="#CCCCCC"> I was kind of hoping it was</font>

140
00:06:44,940 --> 00:06:48,960
true<font color="#CCCCCC"> for this one</font><font color="#E5E5E5"> so I wanted to poke at</font>

141
00:06:47,160 --> 00:06:52,550
that<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is kind of what it looked like</font>

142
00:06:48,960 --> 00:06:57,989
in practice<font color="#CCCCCC"> I stole this from the</font><font color="#E5E5E5"> fire I</font>

143
00:06:52,550 --> 00:07:01,050
<font color="#CCCCCC">blog but you have a</font><font color="#E5E5E5"> PC over there and</font>

144
00:06:57,990 --> 00:07:05,750
that's<font color="#E5E5E5"> running some sort of you know</font>

145
00:07:01,050 --> 00:07:10,890
special<font color="#CCCCCC"> software the try log exe is</font><font color="#E5E5E5"> the</font>

146
00:07:05,750 --> 00:07:13,860
<font color="#E5E5E5">PI to exe compiled malware and inside</font><font color="#CCCCCC"> of</font>

147
00:07:10,890 --> 00:07:16,409
<font color="#CCCCCC">that</font><font color="#E5E5E5"> it has a bunch</font><font color="#CCCCCC"> of scripts and it</font>

148
00:07:13,860 --> 00:07:20,040
talks to<font color="#E5E5E5"> the controller and</font><font color="#CCCCCC"> the purpose</font>

149
00:07:16,410 --> 00:07:23,700
of<font color="#E5E5E5"> the malware was</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> communicate with</font>

150
00:07:20,040 --> 00:07:26,640
the controller the Tricon controller<font color="#E5E5E5"> so</font>

151
00:07:23,700 --> 00:07:28,920
<font color="#E5E5E5">I had to talk</font><font color="#CCCCCC"> to it</font><font color="#E5E5E5"> had to reprogram it</font>

152
00:07:26,640 --> 00:07:31,349
or manipulate it and<font color="#CCCCCC"> ultimately</font><font color="#E5E5E5"> exploit</font>

153
00:07:28,920 --> 00:07:34,530
it<font color="#E5E5E5"> and the purpose of this was to inject</font>

154
00:07:31,350 --> 00:07:36,360
<font color="#E5E5E5">a custom binary backdoor the controller</font>

155
00:07:34,530 --> 00:07:39,539
<font color="#E5E5E5">does not run Windows it does not run</font>

156
00:07:36,360 --> 00:07:41,940
Linux<font color="#E5E5E5"> it has its own custom Orca texture</font>

157
00:07:39,540 --> 00:07:44,670
and firmware<font color="#E5E5E5"> I'm not qualified to talk</font>

158
00:07:41,940 --> 00:07:48,380
about<font color="#E5E5E5"> any of</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> so I decided to kind</font>

159
00:07:44,670 --> 00:07:51,900
of focus<font color="#E5E5E5"> on the the networking protocol</font>

160
00:07:48,380 --> 00:07:53,159
so try logged<font color="#E5E5E5"> exe to break it down</font><font color="#CCCCCC"> a</font>

161
00:07:51,900 --> 00:07:55,140
<font color="#E5E5E5">little bit anything that's written in</font>

162
00:07:53,160 --> 00:07:58,350
<font color="#E5E5E5">Python and compiled with PI</font><font color="#CCCCCC"> THC</font><font color="#E5E5E5"> can</font>

163
00:07:55,140 --> 00:08:00,390
actually be uncompelled<font color="#CCCCCC"> when you compile</font>

164
00:07:58,350 --> 00:08:06,300
you have the option of specifying some

165
00:08:00,390 --> 00:08:08,880
zip files but<font color="#E5E5E5"> you know developers and</font>

166
00:08:06,300 --> 00:08:11,670
malware authors being lazy like me<font color="#CCCCCC"> used</font>

167
00:08:08,880 --> 00:08:14,670
all the defaults<font color="#E5E5E5"> so all the scripts</font><font color="#CCCCCC"> were</font>

168
00:08:11,670 --> 00:08:16,260
you know<font color="#CCCCCC"> just compiled there</font><font color="#E5E5E5"> and inside</font>

169
00:08:14,670 --> 00:08:19,470
<font color="#CCCCCC">of the</font><font color="#E5E5E5"> main executable stored inside a</font>

170
00:08:16,260 --> 00:08:21,719
zip file called library dot zip and this

171
00:08:19,470 --> 00:08:26,310
is what when we uncle pile it<font color="#E5E5E5"> kind of</font>

172
00:08:21,720 --> 00:08:27,510
breaks out<font color="#CCCCCC"> pyc is a Python bytecode but</font>

173
00:08:26,310 --> 00:08:32,820
that's actually pretty<font color="#E5E5E5"> easy to</font>

174
00:08:27,510 --> 00:08:35,760
<font color="#CCCCCC">uncompelled</font><font color="#E5E5E5"> to break down the the plain</font>

175
00:08:32,820 --> 00:08:37,919
<font color="#E5E5E5">text scripts so untidy</font><font color="#CCCCCC"> Exe</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> nun</font>

176
00:08:35,760 --> 00:08:40,650
compiled<font color="#CCCCCC"> six these</font><font color="#E5E5E5"> are on</font><font color="#CCCCCC"> github you can</font>

177
00:08:37,919 --> 00:08:43,710
go download them and do this<font color="#CCCCCC"> yourself</font><font color="#E5E5E5"> so</font>

178
00:08:40,650 --> 00:08:47,490
this<font color="#E5E5E5"> is kind of what the logic looked</font>

179
00:08:43,710 --> 00:08:48,750
<font color="#E5E5E5">like so back in this one</font><font color="#CCCCCC"> I looked at all</font>

180
00:08:47,490 --> 00:08:51,480
<font color="#CCCCCC">these so it's like two hundred and forty</font>

181
00:08:48,750 --> 00:08:54,450
Python<font color="#E5E5E5"> scripts in here</font><font color="#CCCCCC"> most of them are</font>

182
00:08:51,480 --> 00:08:56,730
<font color="#CCCCCC">just default Python stuff</font>

183
00:08:54,450 --> 00:08:57,600
support<font color="#E5E5E5"> different types</font><font color="#CCCCCC"> functions but</font>

184
00:08:56,730 --> 00:09:00,149
<font color="#E5E5E5">there were a bunch of them</font><font color="#CCCCCC"> that</font>

185
00:08:57,600 --> 00:09:01,529
obviously seemed very specific to the

186
00:09:00,149 --> 00:09:04,440
malware<font color="#E5E5E5"> and specific to the</font>

187
00:09:01,529 --> 00:09:08,130
implementation<font color="#E5E5E5"> of</font><font color="#CCCCCC"> tri station so these</font>

188
00:09:04,440 --> 00:09:10,709
are the<font color="#E5E5E5"> ones</font><font color="#CCCCCC"> evil</font><font color="#E5E5E5"> evil stuff dot</font><font color="#CCCCCC"> PI</font>

189
00:09:08,130 --> 00:09:13,550
<font color="#E5E5E5">that's the main routine the malware</font><font color="#CCCCCC"> that</font>

190
00:09:10,709 --> 00:09:17,399
<font color="#CCCCCC">was what was</font><font color="#E5E5E5"> going</font><font color="#CCCCCC"> to inject the</font>

191
00:09:13,550 --> 00:09:19,260
controller with the<font color="#E5E5E5"> backdoor</font><font color="#CCCCCC"> and then we</font>

192
00:09:17,399 --> 00:09:22,410
had all these<font color="#E5E5E5"> other</font><font color="#CCCCCC"> things but you</font><font color="#E5E5E5"> could</font>

193
00:09:19,260 --> 00:09:24,389
see it's a very<font color="#CCCCCC"> nice cascading logic</font>

194
00:09:22,410 --> 00:09:27,689
evil stuff imports<font color="#E5E5E5"> TS hi</font>

195
00:09:24,389 --> 00:09:29,850
TSI imports TS base and so forth<font color="#E5E5E5"> and so</font>

196
00:09:27,690 --> 00:09:32,070
all the<font color="#E5E5E5"> way down that chain</font><font color="#CCCCCC"> was where</font><font color="#E5E5E5"> I</font>

197
00:09:29,850 --> 00:09:35,130
decided to start looking<font color="#E5E5E5"> at the plain</font>

198
00:09:32,070 --> 00:09:36,720
text content of these<font color="#E5E5E5"> scripts so I'm</font>

199
00:09:35,130 --> 00:09:38,790
looking for the implementation of<font color="#CCCCCC"> try</font>

200
00:09:36,720 --> 00:09:40,440
station when<font color="#E5E5E5"> you look and you want to</font>

201
00:09:38,790 --> 00:09:42,120
document<font color="#E5E5E5"> an undocumented protocol there</font>

202
00:09:40,440 --> 00:09:43,589
a couple<font color="#CCCCCC"> things</font><font color="#E5E5E5"> you gotta look for you</font>

203
00:09:42,120 --> 00:09:45,180
want to<font color="#E5E5E5"> look for magic values you want</font>

204
00:09:43,589 --> 00:09:48,750
to look for counters you want to look

205
00:09:45,180 --> 00:09:50,790
for timestamps padding<font color="#CCCCCC"> there are a lot</font>

206
00:09:48,750 --> 00:09:53,579
of different things<font color="#E5E5E5"> but when you want to</font>

207
00:09:50,790 --> 00:09:55,260
<font color="#E5E5E5">document a protocol you want to look for</font>

208
00:09:53,579 --> 00:09:56,370
the structures the major structures and

209
00:09:55,260 --> 00:09:58,380
there's a lot of<font color="#CCCCCC"> other things but</font><font color="#E5E5E5"> those</font>

210
00:09:56,370 --> 00:10:01,320
are<font color="#CCCCCC"> kind of the basics</font><font color="#E5E5E5"> that you go</font><font color="#CCCCCC"> into</font>

211
00:09:58,380 --> 00:10:02,449
and this all turned<font color="#E5E5E5"> out to be much</font>

212
00:10:01,320 --> 00:10:05,640
easier<font color="#E5E5E5"> than I thought</font>

213
00:10:02,449 --> 00:10:09,839
so when I opened up<font color="#CCCCCC"> see</font><font color="#E5E5E5"> names</font>

214
00:10:05,640 --> 00:10:12,510
<font color="#CCCCCC">TSC names pi what was apparent it was</font>

215
00:10:09,839 --> 00:10:15,360
that it was just<font color="#E5E5E5"> basically a bunch of a</font>

216
00:10:12,510 --> 00:10:17,160
race with string<font color="#CCCCCC"> text and these string</font>

217
00:10:15,360 --> 00:10:19,470
<font color="#CCCCCC">texts were attached to kind of integer</font>

218
00:10:17,160 --> 00:10:22,010
values<font color="#E5E5E5"> and you get the sense that it</font>

219
00:10:19,470 --> 00:10:24,750
serves as a library for<font color="#E5E5E5"> something else</font>

220
00:10:22,010 --> 00:10:26,670
<font color="#CCCCCC">but</font><font color="#E5E5E5"> then</font><font color="#CCCCCC"> when I want to go look at where</font>

221
00:10:24,750 --> 00:10:29,040
these arrays are referenced and some of

222
00:10:26,670 --> 00:10:32,490
the other scripts<font color="#CCCCCC"> we kind</font><font color="#E5E5E5"> of have</font><font color="#CCCCCC"> to</font>

223
00:10:29,040 --> 00:10:35,939
dive into<font color="#E5E5E5"> some</font><font color="#CCCCCC"> of the functions so</font><font color="#E5E5E5"> we</font>

224
00:10:32,490 --> 00:10:43,079
can see that this is an array called<font color="#E5E5E5"> TS</font>

225
00:10:35,940 --> 00:10:45,959
<font color="#E5E5E5">c st and that t sc/st</font><font color="#CCCCCC"> is referenced</font><font color="#E5E5E5"> as a</font>

226
00:10:43,079 --> 00:10:49,739
it's a dictionary<font color="#E5E5E5"> result so used as a</font>

227
00:10:45,959 --> 00:10:50,910
library<font color="#E5E5E5"> of strings for TCM result and so</font>

228
00:10:49,740 --> 00:10:54,060
that was the<font color="#CCCCCC"> function i wanted to go</font>

229
00:10:50,910 --> 00:10:56,100
look at<font color="#CCCCCC"> next so we look at</font><font color="#E5E5E5"> that and</font>

230
00:10:54,060 --> 00:10:58,949
<font color="#CCCCCC">that's actually in a different</font><font color="#E5E5E5"> python</font>

231
00:10:56,100 --> 00:11:00,990
file and right here we're already seeing

232
00:10:58,949 --> 00:11:03,750
that<font color="#E5E5E5"> they're breaking</font><font color="#CCCCCC"> down the try</font>

233
00:11:00,990 --> 00:11:06,990
station protocol in some way when we

234
00:11:03,750 --> 00:11:08,240
<font color="#CCCCCC">have a bunch</font><font color="#E5E5E5"> of UDP data coming</font><font color="#CCCCCC"> back we</font>

235
00:11:06,990 --> 00:11:11,720
see that the

236
00:11:08,240 --> 00:11:14,300
first four<font color="#E5E5E5"> bytes are broken into type</font>

237
00:11:11,720 --> 00:11:16,610
and size<font color="#CCCCCC"> so pretty pretty</font>

238
00:11:14,300 --> 00:11:20,300
<font color="#CCCCCC">straightforward</font><font color="#E5E5E5"> and then the last two</font>

239
00:11:16,610 --> 00:11:22,010
bytes are a CRC<font color="#CCCCCC"> so it's right there</font><font color="#E5E5E5"> it's</font>

240
00:11:20,300 --> 00:11:24,469
really<font color="#E5E5E5"> easy we didn't have to do any</font>

241
00:11:22,010 --> 00:11:25,279
reverse engineering we did it the easy

242
00:11:24,470 --> 00:11:28,160
way

243
00:11:25,279 --> 00:11:30,140
<font color="#E5E5E5">so that that's pretty cool</font><font color="#CCCCCC"> and if you</font>

244
00:11:28,160 --> 00:11:33,410
want to<font color="#CCCCCC"> document a protocol you can do</font>

245
00:11:30,140 --> 00:11:35,449
it in the you know<font color="#E5E5E5"> kind of</font><font color="#CCCCCC"> C structure I</font>

246
00:11:33,410 --> 00:11:38,930
call this the<font color="#E5E5E5"> the pretentious way I just</font>

247
00:11:35,450 --> 00:11:41,330
kind of penciled it down on a napkin<font color="#CCCCCC"> and</font>

248
00:11:38,930 --> 00:11:43,849
then<font color="#E5E5E5"> what I wanted to do is is dive in a</font>

249
00:11:41,330 --> 00:11:49,220
little<font color="#CCCCCC"> bit further and then going into</font>

250
00:11:43,850 --> 00:11:51,890
TS result<font color="#CCCCCC"> we also saw that the next</font>

251
00:11:49,220 --> 00:11:56,300
bytes<font color="#E5E5E5"> after those first four bytes</font>

252
00:11:51,890 --> 00:11:59,209
this is packet type<font color="#E5E5E5"> five and in that</font>

253
00:11:56,300 --> 00:12:01,699
first array I showed you<font color="#CCCCCC"> type</font><font color="#E5E5E5"> five was a</font>

254
00:11:59,209 --> 00:12:04,819
command reply so just for command reply

255
00:12:01,700 --> 00:12:08,750
packets<font color="#CCCCCC"> we now have these</font><font color="#E5E5E5"> additional</font>

256
00:12:04,820 --> 00:12:12,860
fields broken out in<font color="#E5E5E5"> the data so one two</font>

257
00:12:08,750 --> 00:12:18,290
three<font color="#CCCCCC"> four five six seven</font><font color="#E5E5E5"> eight nine ten</font>

258
00:12:12,860 --> 00:12:21,079
more bytes are unpacked there<font color="#CCCCCC"> so now</font><font color="#E5E5E5"> our</font>

259
00:12:18,290 --> 00:12:23,089
<font color="#CCCCCC">understanding of the of the protocol has</font>

260
00:12:21,079 --> 00:12:25,670
grown a little<font color="#E5E5E5"> bit</font><font color="#CCCCCC"> and we</font><font color="#E5E5E5"> can document</font>

261
00:12:23,089 --> 00:12:27,470
<font color="#CCCCCC">that and</font><font color="#E5E5E5"> just based on the variables in</font>

262
00:12:25,670 --> 00:12:30,349
the in the code we could get the sense

263
00:12:27,470 --> 00:12:34,730
that you<font color="#E5E5E5"> know this stands for something</font>

264
00:12:30,350 --> 00:12:36,980
or the other you<font color="#E5E5E5"> know</font><font color="#CCCCCC"> size and checksum</font>

265
00:12:34,730 --> 00:12:41,720
<font color="#CCCCCC">or unknown you</font><font color="#E5E5E5"> know anybody label</font>

266
00:12:36,980 --> 00:12:44,570
anything unknown<font color="#CCCCCC"> probably probably not</font>

267
00:12:41,720 --> 00:12:47,000
<font color="#E5E5E5">maybe but anyway so this is</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> command</font>

268
00:12:44,570 --> 00:12:49,339
<font color="#E5E5E5">type structure and that's all well and</font>

269
00:12:47,000 --> 00:12:52,070
<font color="#CCCCCC">good Oh what was that</font>

270
00:12:49,339 --> 00:12:55,970
<font color="#E5E5E5">oh and okay the commands and then so</font>

271
00:12:52,070 --> 00:12:58,880
that<font color="#E5E5E5"> particular byte was referencing a</font>

272
00:12:55,970 --> 00:13:02,149
different array in that first<font color="#CCCCCC"> python</font>

273
00:12:58,880 --> 00:13:04,070
file and it has all these you<font color="#CCCCCC"> know all</font>

274
00:13:02,149 --> 00:13:06,770
these like<font color="#E5E5E5"> different about all these</font>

275
00:13:04,070 --> 00:13:09,770
different strings<font color="#E5E5E5"> for what the command</font>

276
00:13:06,770 --> 00:13:12,410
reply is so<font color="#E5E5E5"> that's really cool we're</font>

277
00:13:09,770 --> 00:13:13,579
seeing<font color="#E5E5E5"> that the malware authors had a</font>

278
00:13:12,410 --> 00:13:15,620
pretty good<font color="#CCCCCC"> understanding of this</font>

279
00:13:13,579 --> 00:13:19,579
protocol they have all these message

280
00:13:15,620 --> 00:13:21,920
types<font color="#CCCCCC"> yadda yadda yadda right so I</font>

281
00:13:19,579 --> 00:13:24,920
wanted<font color="#CCCCCC"> to validate</font>

282
00:13:21,920 --> 00:13:27,229
that the structure<font color="#CCCCCC"> of</font><font color="#E5E5E5"> tri station that</font>

283
00:13:24,920 --> 00:13:28,819
they they knew was actually true<font color="#CCCCCC"> I want</font>

284
00:13:27,230 --> 00:13:31,339
to see if they made any<font color="#CCCCCC"> errors</font><font color="#E5E5E5"> or</font>

285
00:13:28,820 --> 00:13:33,800
anything so obviously I googled<font color="#E5E5E5"> arounds</font>

286
00:13:31,339 --> 00:13:36,769
<font color="#CCCCCC">my ask people for p-cad nobody had pcap</font>

287
00:13:33,800 --> 00:13:39,529
for me<font color="#E5E5E5"> it was a sad day</font><font color="#CCCCCC"> I found</font><font color="#E5E5E5"> a paper</font>

288
00:13:36,769 --> 00:13:40,850
by<font color="#E5E5E5"> the coordinated science laboratory at</font>

289
00:13:39,529 --> 00:13:44,630
the University of Illinois

290
00:13:40,850 --> 00:13:47,269
<font color="#E5E5E5">urbana-champaign</font><font color="#CCCCCC"> that's a mouthful this</font>

291
00:13:44,630 --> 00:13:49,430
is a really cool paper<font color="#CCCCCC"> it was behind</font><font color="#E5E5E5"> a</font>

292
00:13:47,269 --> 00:13:52,040
paywall<font color="#CCCCCC"> I did</font><font color="#E5E5E5"> Google long enough and</font>

293
00:13:49,430 --> 00:13:53,810
found like one of those PDF<font color="#CCCCCC"> reproduction</font>

294
00:13:52,040 --> 00:13:55,880
sites where they try<font color="#E5E5E5"> to sell</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> to you</font>

295
00:13:53,810 --> 00:13:59,300
<font color="#CCCCCC">for</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> dollar but you can take the screen</font>

296
00:13:55,880 --> 00:14:00,920
cap of all the all this stuff<font color="#CCCCCC"> and</font><font color="#E5E5E5"> I read</font>

297
00:13:59,300 --> 00:14:03,050
the paper and there were a<font color="#E5E5E5"> couple of</font>

298
00:14:00,920 --> 00:14:06,410
things<font color="#CCCCCC"> that these</font><font color="#E5E5E5"> researchers did</font><font color="#CCCCCC"> one</font>

299
00:14:03,050 --> 00:14:10,790
the<font color="#CCCCCC"> Tri Station protocol which is</font>

300
00:14:06,410 --> 00:14:13,939
<font color="#E5E5E5">undocumented is similar to a documented</font>

301
00:14:10,790 --> 00:14:17,839
protocol by the same protocol<font color="#E5E5E5"> author</font>

302
00:14:13,940 --> 00:14:20,060
called<font color="#CCCCCC"> tsaa and the researchers used one</font>

303
00:14:17,839 --> 00:14:22,250
protocol to make<font color="#CCCCCC"> inferences about how</font>

304
00:14:20,060 --> 00:14:24,859
the other protocol worked<font color="#E5E5E5"> and they also</font>

305
00:14:22,250 --> 00:14:26,510
were able<font color="#E5E5E5"> and they did that and then</font>

306
00:14:24,860 --> 00:14:29,630
they did some testing of<font color="#E5E5E5"> their own and</font>

307
00:14:26,510 --> 00:14:31,370
they documented<font color="#E5E5E5"> the</font><font color="#CCCCCC"> Tri station basic</font>

308
00:14:29,630 --> 00:14:32,149
structure<font color="#E5E5E5"> and so this is what it was</font>

309
00:14:31,370 --> 00:14:34,459
<font color="#E5E5E5">like</font>

310
00:14:32,149 --> 00:14:37,220
which validated a lot of what<font color="#E5E5E5"> I saw and</font>

311
00:14:34,459 --> 00:14:39,018
<font color="#E5E5E5">the</font><font color="#CCCCCC"> Triton framework and what do you do</font>

312
00:14:37,220 --> 00:14:41,180
with a protocol structure like once

313
00:14:39,019 --> 00:14:44,029
you've got it<font color="#CCCCCC"> first thing</font><font color="#E5E5E5"> that I want to</font>

314
00:14:41,180 --> 00:14:48,709
do is<font color="#E5E5E5"> is dissect some pcap but I didn't</font>

315
00:14:44,029 --> 00:14:52,070
have any<font color="#CCCCCC"> pcap</font><font color="#E5E5E5"> but they printed out some</font>

316
00:14:48,709 --> 00:14:54,050
bytes<font color="#CCCCCC"> in</font><font color="#E5E5E5"> their paper so I kind of</font>

317
00:14:52,070 --> 00:14:56,029
noticed I was like<font color="#E5E5E5"> okay if that's a real</font>

318
00:14:54,050 --> 00:15:01,130
<font color="#E5E5E5">try station packet from their</font>

319
00:14:56,029 --> 00:15:03,649
experiments<font color="#CCCCCC"> and I also</font><font color="#E5E5E5"> noticed that we</font>

320
00:15:01,130 --> 00:15:06,740
were<font color="#E5E5E5"> talking</font><font color="#CCCCCC"> about command Type O 5 and</font>

321
00:15:03,649 --> 00:15:11,269
<font color="#CCCCCC">I noticed that everything</font><font color="#E5E5E5"> before the o 5</font>

322
00:15:06,740 --> 00:15:15,440
was actually probably UDP header data<font color="#CCCCCC"> so</font>

323
00:15:11,269 --> 00:15:17,630
I tried<font color="#CCCCCC"> to OCR it but when you take a</font>

324
00:15:15,440 --> 00:15:21,170
<font color="#CCCCCC">screencap</font><font color="#E5E5E5"> of this you get a lot of</font><font color="#CCCCCC"> oohs</font>

325
00:15:17,630 --> 00:15:23,839
instead of<font color="#E5E5E5"> zeros in an OCR so I typed</font>

326
00:15:21,170 --> 00:15:26,510
<font color="#E5E5E5">all of this into a hex editor very</font>

327
00:15:23,839 --> 00:15:29,120
slowly<font color="#CCCCCC"> I know it's terrible if I'm</font>

328
00:15:26,510 --> 00:15:33,290
embarrassed that I<font color="#E5E5E5"> had to do that but I</font>

329
00:15:29,120 --> 00:15:35,720
<font color="#E5E5E5">did and I stripped off the the UDP</font>

330
00:15:33,290 --> 00:15:37,910
header bytes<font color="#E5E5E5"> and then I used</font>

331
00:15:35,720 --> 00:15:41,029
some cyber<font color="#E5E5E5"> chef to print it out to like</font>

332
00:15:37,910 --> 00:15:44,750
<font color="#CCCCCC">a fancy text file and then</font><font color="#E5E5E5"> I used text</font>

333
00:15:41,029 --> 00:15:46,670
to pcap to generate my own pcap<font color="#CCCCCC"> and then</font>

334
00:15:44,750 --> 00:15:48,680
I went<font color="#E5E5E5"> on a journey</font><font color="#CCCCCC"> of opening it and</font>

335
00:15:46,670 --> 00:15:51,649
Wireshark there's no parser<font color="#E5E5E5"> no parser</font>

336
00:15:48,680 --> 00:15:58,069
existed for this publicly<font color="#E5E5E5"> no dissector</font><font color="#CCCCCC"> I</font>

337
00:15:51,649 --> 00:16:01,579
created a really terrible<font color="#CCCCCC"> Lua dissector</font>

338
00:15:58,069 --> 00:16:04,009
<font color="#CCCCCC">mess</font><font color="#E5E5E5"> up on my github</font><font color="#CCCCCC"> it's awful but you</font>

339
00:16:01,579 --> 00:16:06,109
<font color="#CCCCCC">can go look</font><font color="#E5E5E5"> at that and dissect that</font>

340
00:16:04,009 --> 00:16:08,120
<font color="#E5E5E5">pcap and then about a month later the</font>

341
00:16:06,110 --> 00:16:12,230
news<font color="#CCCCCC"> Oh me guys really showed me up and</font>

342
00:16:08,120 --> 00:16:14,029
they produced<font color="#E5E5E5"> a totally badass dissector</font>

343
00:16:12,230 --> 00:16:16,160
for this protocol<font color="#E5E5E5"> I recommend you you</font>

344
00:16:14,029 --> 00:16:17,420
you go check it out<font color="#E5E5E5"> but that's</font><font color="#CCCCCC"> one thing</font>

345
00:16:16,160 --> 00:16:20,029
<font color="#E5E5E5">you could do once you understand the</font>

346
00:16:17,420 --> 00:16:23,719
structure<font color="#CCCCCC"> of</font><font color="#E5E5E5"> a protocol</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> is that</font>

347
00:16:20,029 --> 00:16:26,810
same key cap<font color="#E5E5E5"> that</font><font color="#CCCCCC"> I typed out but</font>

348
00:16:23,720 --> 00:16:28,540
dissected by<font color="#CCCCCC"> the</font><font color="#E5E5E5"> Nozomi try station</font>

349
00:16:26,810 --> 00:16:32,680
dissectors as you can see it breaks down

350
00:16:28,540 --> 00:16:36,019
<font color="#CCCCCC">the protocol into you know the channels</font>

351
00:16:32,680 --> 00:16:37,878
<font color="#CCCCCC">you</font><font color="#E5E5E5"> know the data length</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> is the</font>

352
00:16:36,019 --> 00:16:41,569
results of a custom protocol they put

353
00:16:37,879 --> 00:16:43,459
the data length<font color="#E5E5E5"> twice</font><font color="#CCCCCC"> I don't know why I</font>

354
00:16:41,569 --> 00:16:46,819
<font color="#E5E5E5">probably wouldn't do that if I were</font>

355
00:16:43,459 --> 00:16:48,649
<font color="#CCCCCC">designing one</font><font color="#E5E5E5"> anyway there are a lot of</font>

356
00:16:46,819 --> 00:16:49,399
a lot of<font color="#E5E5E5"> things about this protocol that</font>

357
00:16:48,649 --> 00:16:51,170
<font color="#E5E5E5">are weird</font>

358
00:16:49,399 --> 00:16:54,920
but we also have to<font color="#E5E5E5"> remember it was</font>

359
00:16:51,170 --> 00:16:55,849
<font color="#E5E5E5">written probably like 20 years ago</font><font color="#CCCCCC"> what</font>

360
00:16:54,920 --> 00:16:57,319
else can you do with<font color="#E5E5E5"> a protocol</font>

361
00:16:55,850 --> 00:16:59,480
structure you can observe the traffic in

362
00:16:57,319 --> 00:17:02,809
<font color="#CCCCCC">real time if you know kind of</font><font color="#E5E5E5"> what it</font>

363
00:16:59,480 --> 00:17:05,870
looks<font color="#CCCCCC"> like I</font><font color="#E5E5E5"> tend to favor snort because</font>

364
00:17:02,809 --> 00:17:09,230
all my sensors<font color="#E5E5E5"> use snort</font><font color="#CCCCCC"> and it's really</font>

365
00:17:05,869 --> 00:17:13,789
easy language<font color="#CCCCCC"> to kind of write in for</font>

366
00:17:09,230 --> 00:17:16,849
packet matching<font color="#E5E5E5"> so if we knew that value</font>

367
00:17:13,789 --> 00:17:19,569
one type<font color="#E5E5E5"> you know the first two bytes if</font>

368
00:17:16,849 --> 00:17:22,250
the type was<font color="#E5E5E5"> one the connection</font><font color="#CCCCCC"> request</font>

369
00:17:19,569 --> 00:17:25,908
<font color="#CCCCCC">and we also know that</font><font color="#E5E5E5"> the you know the</font>

370
00:17:22,250 --> 00:17:29,630
<font color="#E5E5E5">probably the smallest size packet is six</font>

371
00:17:25,909 --> 00:17:32,539
bytes<font color="#CCCCCC"> we can kind of guess that type</font>

372
00:17:29,630 --> 00:17:35,200
size<font color="#E5E5E5"> and a CRC</font><font color="#CCCCCC"> and because we</font><font color="#E5E5E5"> don't know</font>

373
00:17:32,539 --> 00:17:38,809
<font color="#E5E5E5">CRC we could pretty much calculate that</font>

374
00:17:35,200 --> 00:17:40,940
CRC 16 and then we<font color="#CCCCCC"> could write</font><font color="#E5E5E5"> a very</font>

375
00:17:38,809 --> 00:17:44,678
simple<font color="#CCCCCC"> snort rule that does a Content</font>

376
00:17:40,940 --> 00:17:47,090
match for that<font color="#CCCCCC"> looking</font><font color="#E5E5E5"> for UDP traffic</font>

377
00:17:44,679 --> 00:17:48,690
<font color="#CCCCCC">so what this would do if you push this</font>

378
00:17:47,090 --> 00:17:50,549
out<font color="#E5E5E5"> to a sensor it would you know do</font>

379
00:17:48,690 --> 00:17:53,340
<font color="#CCCCCC">TEKT</font><font color="#E5E5E5"> you know if there were a</font><font color="#CCCCCC"> tri</font>

380
00:17:50,549 --> 00:17:56,730
station connection<font color="#E5E5E5"> requests on UDP on</font>

381
00:17:53,340 --> 00:18:00,120
the default port<font color="#CCCCCC"> and snort rules are</font>

382
00:17:56,730 --> 00:18:05,070
<font color="#E5E5E5">really good for identifying traffic that</font>

383
00:18:00,120 --> 00:18:07,799
you want to observe BSI in<font color="#CCCCCC"> Germany they</font>

384
00:18:05,070 --> 00:18:10,379
did some awesome research on the Tri

385
00:18:07,799 --> 00:18:13,289
<font color="#E5E5E5">Station protocol</font><font color="#CCCCCC"> this guy Thomas Schmidt</font>

386
00:18:10,379 --> 00:18:15,600
led to charge in creating a snort rule

387
00:18:13,289 --> 00:18:18,240
set for you know intrusion detection

388
00:18:15,600 --> 00:18:21,178
systems it's free it's accessible<font color="#E5E5E5"> to</font>

389
00:18:18,240 --> 00:18:23,070
<font color="#E5E5E5">everyone and again</font><font color="#CCCCCC"> you know before a</font>

390
00:18:21,179 --> 00:18:24,960
<font color="#E5E5E5">couple months ago nobody had any</font>

391
00:18:23,070 --> 00:18:28,529
<font color="#E5E5E5">visibility into this traffic so this is</font>

392
00:18:24,960 --> 00:18:30,629
like a super awesome<font color="#CCCCCC"> research project</font>

393
00:18:28,529 --> 00:18:35,549
that<font color="#CCCCCC"> actually delivered some value to</font>

394
00:18:30,629 --> 00:18:37,559
<font color="#CCCCCC">anybody who owns</font><font color="#E5E5E5"> Tricon controllers</font><font color="#CCCCCC"> this</font>

395
00:18:35,549 --> 00:18:38,789
is what that<font color="#CCCCCC"> snort step looks like and</font>

396
00:18:37,559 --> 00:18:40,769
<font color="#CCCCCC">it depends on</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> bunch of configuration</font>

397
00:18:38,789 --> 00:18:43,860
stuff<font color="#E5E5E5"> but it's out there you can google</font>

398
00:18:40,769 --> 00:18:45,570
<font color="#CCCCCC">for it it's pretty straightforward um so</font>

399
00:18:43,860 --> 00:18:48,320
how was<font color="#CCCCCC"> triton developed now that we</font>

400
00:18:45,570 --> 00:18:51,799
kind<font color="#CCCCCC"> of like looked</font><font color="#E5E5E5"> at all that stuff</font>

401
00:18:48,320 --> 00:18:55,408
when we<font color="#E5E5E5"> D compiled the Python</font><font color="#CCCCCC"> bytecode</font>

402
00:18:51,799 --> 00:18:57,840
<font color="#E5E5E5">on</font><font color="#CCCCCC"> compile six kind of gives us a guess</font>

403
00:18:55,409 --> 00:18:59,429
at the compile time<font color="#CCCCCC"> I'm not sure a</font>

404
00:18:57,840 --> 00:19:02,639
hundred percent how accurate this is<font color="#E5E5E5"> I</font>

405
00:18:59,429 --> 00:19:06,000
assume<font color="#E5E5E5"> it's accurate</font><font color="#CCCCCC"> but there are</font><font color="#E5E5E5"> about</font>

406
00:19:02,639 --> 00:19:09,240
two hundred<font color="#E5E5E5"> and two hundred or so</font>

407
00:19:06,000 --> 00:19:13,620
<font color="#E5E5E5">Python</font><font color="#CCCCCC"> bytecode files in librarianship</font>

408
00:19:09,240 --> 00:19:16,799
<font color="#E5E5E5">and we my boss</font><font color="#CCCCCC"> was my boss now he</font>

409
00:19:13,620 --> 00:19:18,750
tweeted out this picture<font color="#CCCCCC"> I tried to</font><font color="#E5E5E5"> make</font>

410
00:19:16,799 --> 00:19:21,360
a graph and<font color="#E5E5E5"> I was like you know what he</font>

411
00:19:18,750 --> 00:19:24,779
already did it<font color="#CCCCCC"> so but this is what the</font>

412
00:19:21,360 --> 00:19:27,209
timestamps on the<font color="#E5E5E5"> Python byte code</font>

413
00:19:24,779 --> 00:19:28,679
inside library dot zip<font color="#E5E5E5"> kind told us and</font>

414
00:19:27,210 --> 00:19:31,679
what's interesting<font color="#CCCCCC"> is you can see that</font>

415
00:19:28,679 --> 00:19:34,139
<font color="#CCCCCC">there</font><font color="#E5E5E5"> are a bunch</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> were in June 2016</font>

416
00:19:31,679 --> 00:19:39,799
and that<font color="#CCCCCC"> what we see were a couple</font><font color="#E5E5E5"> of</font>

417
00:19:34,139 --> 00:19:42,299
edits<font color="#CCCCCC"> later in</font><font color="#E5E5E5"> 2016 of November and then</font>

418
00:19:39,799 --> 00:19:45,840
2017 we started to see some<font color="#CCCCCC"> more stuff</font>

419
00:19:42,299 --> 00:19:48,029
in 20 August 2017 is when we started<font color="#E5E5E5"> to</font>

420
00:19:45,840 --> 00:19:49,820
see<font color="#E5E5E5"> the last modified times of the Tri</font>

421
00:19:48,029 --> 00:19:53,879
<font color="#E5E5E5">Station implementation so we know that</font>

422
00:19:49,820 --> 00:19:57,119
<font color="#E5E5E5">this malware framework they spent like a</font>

423
00:19:53,879 --> 00:20:00,719
good<font color="#E5E5E5"> solid year on it maybe more I would</font>

424
00:19:57,119 --> 00:20:02,610
guess more and we<font color="#E5E5E5"> can tell that from</font><font color="#CCCCCC"> the</font>

425
00:20:00,720 --> 00:20:05,309
<font color="#E5E5E5">Python metadata</font>

426
00:20:02,610 --> 00:20:08,039
there are some discrepancies<font color="#E5E5E5"> in the</font>

427
00:20:05,309 --> 00:20:12,690
Triton malware code<font color="#E5E5E5"> and I became really</font>

428
00:20:08,039 --> 00:20:15,059
fixated<font color="#CCCCCC"> for no</font><font color="#E5E5E5"> good reason on this</font><font color="#CCCCCC"> there</font>

429
00:20:12,690 --> 00:20:19,110
were a couple of misspellings<font color="#CCCCCC"> in that</font>

430
00:20:15,059 --> 00:20:20,908
first library<font color="#E5E5E5"> of arrays that made me</font>

431
00:20:19,110 --> 00:20:22,649
very<font color="#CCCCCC"> curious and there also</font><font color="#E5E5E5"> a bunch of</font>

432
00:20:20,909 --> 00:20:25,020
strings in there and I was googling<font color="#CCCCCC"> for</font>

433
00:20:22,650 --> 00:20:27,210
them everywhere<font color="#CCCCCC"> and I couldn't find any</font>

434
00:20:25,020 --> 00:20:30,059
trace<font color="#CCCCCC"> of any of this</font>

435
00:20:27,210 --> 00:20:33,390
there were most of the<font color="#E5E5E5"> train code is Mad</font>

436
00:20:30,059 --> 00:20:35,340
Decent<font color="#E5E5E5"> yo</font><font color="#CCCCCC"> it's pretty solid has nice</font>

437
00:20:33,390 --> 00:20:37,919
cascading logic there's good annotations

438
00:20:35,340 --> 00:20:41,789
<font color="#E5E5E5">everything the variables seem well named</font>

439
00:20:37,919 --> 00:20:43,980
so like to look at that<font color="#E5E5E5"> library of weird</font>

440
00:20:41,789 --> 00:20:48,539
misspellings<font color="#E5E5E5"> and then the rest of the</font>

441
00:20:43,980 --> 00:20:50,190
code<font color="#E5E5E5"> seems to be pretty solid</font><font color="#CCCCCC"> it was</font>

442
00:20:48,539 --> 00:20:53,460
really<font color="#CCCCCC"> inconsistent there's nothing that</font>

443
00:20:50,190 --> 00:20:55,820
drives me<font color="#E5E5E5"> more insane inconsistencies</font><font color="#CCCCCC"> so</font>

444
00:20:53,460 --> 00:20:58,980
like here's an example of some of<font color="#E5E5E5"> the</font>

445
00:20:55,820 --> 00:21:02,100
some of the arrays that<font color="#CCCCCC"> I was talking</font>

446
00:20:58,980 --> 00:21:05,640
about you know<font color="#CCCCCC"> Alec a label here's one</font>

447
00:21:02,100 --> 00:21:06,860
that just<font color="#CCCCCC"> driving</font><font color="#E5E5E5"> crazy is just a case</font>

448
00:21:05,640 --> 00:21:08,970
inconsistency

449
00:21:06,860 --> 00:21:10,879
these are small things<font color="#CCCCCC"> that I've become</font>

450
00:21:08,970 --> 00:21:14,159
<font color="#CCCCCC">very fixated</font><font color="#E5E5E5"> on and I'm wondering why</font>

451
00:21:10,880 --> 00:21:17,610
these arrays are so<font color="#CCCCCC"> different from</font><font color="#E5E5E5"> the</font>

452
00:21:14,159 --> 00:21:20,640
rest of<font color="#E5E5E5"> the code reponse</font><font color="#CCCCCC"> there were</font>

453
00:21:17,610 --> 00:21:22,370
probably a bunch of these and<font color="#E5E5E5"> I</font><font color="#CCCCCC"> don't</font>

454
00:21:20,640 --> 00:21:25,649
know<font color="#CCCCCC"> there were probably maybe 10 or</font><font color="#E5E5E5"> 12</font>

455
00:21:22,370 --> 00:21:27,779
misspellings<font color="#E5E5E5"> so I'm like googling around</font>

456
00:21:25,649 --> 00:21:31,020
<font color="#E5E5E5">for these and I couldn't</font><font color="#CCCCCC"> find anything</font>

457
00:21:27,779 --> 00:21:33,890
so<font color="#E5E5E5"> obviously I have access to virustotal</font>

458
00:21:31,020 --> 00:21:37,649
<font color="#E5E5E5">intelligence does anybody use virustotal</font>

459
00:21:33,890 --> 00:21:38,730
<font color="#E5E5E5">intelligence</font><font color="#CCCCCC"> a couple people there's a</font>

460
00:21:37,649 --> 00:21:42,299
<font color="#E5E5E5">reason that I go to virustotal</font>

461
00:21:38,730 --> 00:21:46,169
intelligence<font color="#E5E5E5"> and we heard from the virus</font>

462
00:21:42,299 --> 00:21:49,110
<font color="#CCCCCC">bay guys earlier is that a lot of</font><font color="#E5E5E5"> people</font>

463
00:21:46,169 --> 00:21:52,679
a lot<font color="#CCCCCC"> of</font><font color="#E5E5E5"> products will submit files</font>

464
00:21:49,110 --> 00:21:54,870
willy-nilly<font color="#E5E5E5"> to different types of things</font>

465
00:21:52,679 --> 00:21:57,059
<font color="#E5E5E5">and I basically</font><font color="#CCCCCC"> look</font><font color="#E5E5E5"> at this as a file</font>

466
00:21:54,870 --> 00:21:59,489
repository for both good and bad<font color="#CCCCCC"> it</font>

467
00:21:57,059 --> 00:22:01,320
<font color="#E5E5E5">stores everything I'm expecting</font><font color="#CCCCCC"> that a</font>

468
00:21:59,490 --> 00:22:02,789
bunch of people submitted some stuff<font color="#E5E5E5"> and</font>

469
00:22:01,320 --> 00:22:04,408
I want to try to look in there and<font color="#E5E5E5"> see</font>

470
00:22:02,789 --> 00:22:07,379
<font color="#CCCCCC">if there's anything that relates to the</font>

471
00:22:04,409 --> 00:22:09,600
<font color="#E5E5E5">Triton malware inside a virus</font><font color="#CCCCCC"> total so I</font>

472
00:22:07,380 --> 00:22:11,010
go on<font color="#CCCCCC"> a retro hunt</font><font color="#E5E5E5"> and a retro hunt has</font>

473
00:22:09,600 --> 00:22:12,750
its limitations<font color="#CCCCCC"> because it only goes</font>

474
00:22:11,010 --> 00:22:14,879
back<font color="#E5E5E5"> on</font><font color="#CCCCCC"> files submitted</font><font color="#E5E5E5"> within the last</font>

475
00:22:12,750 --> 00:22:16,149
six months<font color="#CCCCCC"> so I came</font><font color="#E5E5E5"> up</font><font color="#CCCCCC"> with a big fat</font>

476
00:22:14,880 --> 00:22:18,039
<font color="#CCCCCC">zero</font>

477
00:22:16,149 --> 00:22:20,020
which is an extremely disappointing

478
00:22:18,039 --> 00:22:22,149
result for me<font color="#E5E5E5"> because I wanted</font><font color="#CCCCCC"> to find</font>

479
00:22:20,020 --> 00:22:24,639
something<font color="#E5E5E5"> and to work around the</font>

480
00:22:22,149 --> 00:22:27,820
<font color="#CCCCCC">limitations of virustotal we have a tool</font>

481
00:22:24,640 --> 00:22:30,480
called<font color="#CCCCCC"> awesome possum awesome possum is</font>

482
00:22:27,820 --> 00:22:32,439
an internal tool<font color="#E5E5E5"> we take all</font><font color="#CCCCCC"> virustotal</font>

483
00:22:30,480 --> 00:22:35,620
<font color="#E5E5E5">submissions and we index all the</font>

484
00:22:32,440 --> 00:22:37,840
<font color="#CCCCCC">metadata because we can search back</font>

485
00:22:35,620 --> 00:22:40,809
forever<font color="#E5E5E5"> and we throw in a big log a big</font>

486
00:22:37,840 --> 00:22:43,389
log and<font color="#CCCCCC"> elasticsearch and all that</font><font color="#E5E5E5"> but</font>

487
00:22:40,809 --> 00:22:46,559
one<font color="#CCCCCC"> of the interesting things</font><font color="#E5E5E5"> an awesome</font>

488
00:22:43,390 --> 00:22:49,390
possum<font color="#CCCCCC"> is that I can search by</font>

489
00:22:46,559 --> 00:22:52,750
submission names<font color="#E5E5E5"> back</font><font color="#CCCCCC"> for ever all time</font>

490
00:22:49,390 --> 00:22:55,390
<font color="#E5E5E5">so anyway</font><font color="#CCCCCC"> I got a sense</font><font color="#E5E5E5"> in documentation</font>

491
00:22:52,750 --> 00:22:57,700
<font color="#CCCCCC">that I would be</font><font color="#E5E5E5"> searching for</font><font color="#CCCCCC"> TS 1131</font>

492
00:22:55,390 --> 00:23:00,390
<font color="#E5E5E5">exe and awesome possum</font>

493
00:22:57,700 --> 00:23:02,380
that is awesome<font color="#E5E5E5"> presented a bunch of</font>

494
00:23:00,390 --> 00:23:04,120
<font color="#E5E5E5">results for me and we can track the</font>

495
00:23:02,380 --> 00:23:06,100
submitters<font color="#CCCCCC"> and see all</font><font color="#E5E5E5"> that stuff</font><font color="#CCCCCC"> so</font>

496
00:23:04,120 --> 00:23:08,439
<font color="#CCCCCC">that was pretty</font><font color="#E5E5E5"> cool</font><font color="#CCCCCC"> so I went on this</font>

497
00:23:06,100 --> 00:23:10,299
kind<font color="#CCCCCC"> of hunt</font><font color="#E5E5E5"> to look for source files</font>

498
00:23:08,440 --> 00:23:12,309
<font color="#E5E5E5">and first thing I did</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> try to run it</font>

499
00:23:10,299 --> 00:23:14,440
in a VM and I obviously<font color="#E5E5E5"> see that I'm</font>

500
00:23:12,309 --> 00:23:17,010
missing<font color="#E5E5E5"> all these kind of dependencies</font>

501
00:23:14,440 --> 00:23:19,450
<font color="#E5E5E5">and I did this for a while I just like</font>

502
00:23:17,010 --> 00:23:20,890
kept looking an awesome possum to see

503
00:23:19,450 --> 00:23:22,659
files submitted<font color="#E5E5E5"> with that name I</font>

504
00:23:20,890 --> 00:23:25,690
download them<font color="#E5E5E5"> and I try to reconstruct</font>

505
00:23:22,659 --> 00:23:28,360
<font color="#E5E5E5">this package</font><font color="#CCCCCC"> eventually I went</font><font color="#E5E5E5"> to</font>

506
00:23:25,690 --> 00:23:32,529
dependency Walker<font color="#CCCCCC"> and got a</font><font color="#E5E5E5"> huge list of</font>

507
00:23:28,360 --> 00:23:35,020
<font color="#CCCCCC">DLLs</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> I thought were related to the</font>

508
00:23:32,529 --> 00:23:37,210
legitimate<font color="#E5E5E5"> try station software</font><font color="#CCCCCC"> so all</font>

509
00:23:35,020 --> 00:23:40,539
along we had this narrative<font color="#E5E5E5"> that the</font>

510
00:23:37,210 --> 00:23:43,120
<font color="#E5E5E5">Triton malware was built with</font>

511
00:23:40,539 --> 00:23:47,669
understanding based on<font color="#E5E5E5"> reversing</font>

512
00:23:43,120 --> 00:23:49,799
legitimate<font color="#E5E5E5"> try connects software</font><font color="#CCCCCC"> and</font>

513
00:23:47,669 --> 00:23:52,450
that<font color="#E5E5E5"> was a narrative and nobody had any</font>

514
00:23:49,799 --> 00:23:55,570
any proof<font color="#E5E5E5"> of that and I wanted</font><font color="#CCCCCC"> to go</font>

515
00:23:52,450 --> 00:23:58,809
find some proof so anyway a bunch<font color="#CCCCCC"> of</font>

516
00:23:55,570 --> 00:24:01,889
things that<font color="#CCCCCC"> I didn't</font><font color="#E5E5E5"> have and I was able</font>

517
00:23:58,809 --> 00:24:05,020
<font color="#E5E5E5">to finally get</font><font color="#CCCCCC"> to a file called lag evn</font>

518
00:24:01,890 --> 00:24:07,480
<font color="#E5E5E5">DOL that</font><font color="#CCCCCC"> had a parent</font><font color="#E5E5E5"> file data 1 dot</font>

519
00:24:05,020 --> 00:24:10,750
cab<font color="#E5E5E5"> that had a parent file and now I'm</font>

520
00:24:07,480 --> 00:24:14,559
<font color="#E5E5E5">into some like juicy data right</font>

521
00:24:10,750 --> 00:24:17,529
<font color="#CCCCCC">try log V 4.1</font><font color="#E5E5E5"> and if you remember</font><font color="#CCCCCC"> the</font>

522
00:24:14,559 --> 00:24:20,428
<font color="#E5E5E5">original Triton malware file mimicked</font>

523
00:24:17,529 --> 00:24:24,850
<font color="#E5E5E5">trilogue it was named try log dot exe</font>

524
00:24:20,429 --> 00:24:27,520
<font color="#CCCCCC">presumably this</font><font color="#E5E5E5"> is related</font><font color="#CCCCCC"> to the</font><font color="#E5E5E5"> Tricon</font>

525
00:24:24,850 --> 00:24:28,760
controller<font color="#E5E5E5"> type of software so anyway I</font>

526
00:24:27,520 --> 00:24:31,040
opened this<font color="#E5E5E5"> up</font>

527
00:24:28,760 --> 00:24:32,660
I start poking around in<font color="#E5E5E5"> dataone cab and</font>

528
00:24:31,040 --> 00:24:34,129
I<font color="#E5E5E5"> look</font><font color="#CCCCCC"> through</font><font color="#E5E5E5"> all these</font><font color="#CCCCCC"> dll's</font><font color="#E5E5E5"> and</font>

529
00:24:32,660 --> 00:24:36,890
there's obviously<font color="#E5E5E5"> one I'm interested</font><font color="#CCCCCC"> in</font>

530
00:24:34,130 --> 00:24:40,640
<font color="#E5E5E5">the communications</font><font color="#CCCCCC"> so this one</font><font color="#E5E5E5"> really</font>

531
00:24:36,890 --> 00:24:42,850
stood out to<font color="#CCCCCC"> me calm anything calm</font><font color="#E5E5E5"> DLL</font>

532
00:24:40,640 --> 00:24:45,500
<font color="#E5E5E5">named very cleverly</font>

533
00:24:42,850 --> 00:24:48,740
<font color="#CCCCCC">but you could see it's a</font><font color="#E5E5E5"> DLL</font><font color="#CCCCCC"> that</font>

534
00:24:45,500 --> 00:24:55,480
supports<font color="#E5E5E5"> Tricon communications interface</font>

535
00:24:48,740 --> 00:24:58,220
<font color="#CCCCCC">this</font><font color="#E5E5E5"> is a written in Visual C++ and</font>

536
00:24:55,480 --> 00:24:59,570
started dumping<font color="#E5E5E5"> string tables and I'm</font>

537
00:24:58,220 --> 00:25:02,860
starting<font color="#CCCCCC"> to</font><font color="#E5E5E5"> see things that are pretty</font>

538
00:24:59,570 --> 00:25:06,530
<font color="#E5E5E5">familiar to</font><font color="#CCCCCC"> me you know all of</font><font color="#E5E5E5"> these</font>

539
00:25:02,860 --> 00:25:09,229
<font color="#E5E5E5">like okay that looks like kind of like a</font>

540
00:25:06,530 --> 00:25:12,260
thing and<font color="#E5E5E5"> then here we go is like we can</font>

541
00:25:09,230 --> 00:25:14,240
see the inconsistencies<font color="#CCCCCC"> all these same</font>

542
00:25:12,260 --> 00:25:16,730
strings and if you looked I probably

543
00:25:14,240 --> 00:25:19,160
spent a<font color="#CCCCCC"> hundred hours looking at</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> Tri</font>

544
00:25:16,730 --> 00:25:21,140
station or the<font color="#E5E5E5"> Tri Triton strings and</font>

545
00:25:19,160 --> 00:25:23,420
the moment I was able<font color="#E5E5E5"> to look at this I</font>

546
00:25:21,140 --> 00:25:26,210
was<font color="#E5E5E5"> like okay</font><font color="#CCCCCC"> 100%</font><font color="#E5E5E5"> know that all of</font>

547
00:25:23,420 --> 00:25:31,130
<font color="#CCCCCC">these strings in this string table</font><font color="#E5E5E5"> came</font>

548
00:25:26,210 --> 00:25:33,550
from a legitimate<font color="#CCCCCC"> try connects</font><font color="#E5E5E5"> DLL so I</font>

549
00:25:31,130 --> 00:25:36,800
was like pretty happy with<font color="#E5E5E5"> this result</font>

550
00:25:33,550 --> 00:25:39,889
<font color="#CCCCCC">and everything everything is in there</font>

551
00:25:36,800 --> 00:25:41,840
<font color="#E5E5E5">and it</font><font color="#CCCCCC"> just goes it</font><font color="#E5E5E5"> goes backwards start</font>

552
00:25:39,890 --> 00:25:44,390
download chain start download change all

553
00:25:41,840 --> 00:25:46,659
that all the typos are in there<font color="#CCCCCC"> and so</font>

554
00:25:44,390 --> 00:25:51,230
then I went and collected a bunch of

555
00:25:46,660 --> 00:25:56,420
<font color="#CCCCCC">DLLs</font><font color="#E5E5E5"> and I could see that</font><font color="#CCCCCC"> where was</font><font color="#E5E5E5"> it</font>

556
00:25:51,230 --> 00:25:58,970
<font color="#CCCCCC">try comm</font><font color="#E5E5E5"> DLL</font><font color="#CCCCCC"> they had these</font><font color="#E5E5E5"> C++ string</font>

557
00:25:56,420 --> 00:26:02,140
tables in there<font color="#E5E5E5"> all of these dated back</font>

558
00:25:58,970 --> 00:26:04,900
<font color="#E5E5E5">like decades</font><font color="#CCCCCC"> right so I'm looking at</font>

559
00:26:02,140 --> 00:26:09,440
some library it<font color="#E5E5E5"> was written ages ago</font>

560
00:26:04,900 --> 00:26:12,590
<font color="#CCCCCC">never updated never maybe not Qaid to</font>

561
00:26:09,440 --> 00:26:15,230
well I don't know<font color="#CCCCCC"> and</font><font color="#E5E5E5"> I was trying to</font>

562
00:26:12,590 --> 00:26:18,679
figure<font color="#CCCCCC"> out exactly what software package</font>

563
00:26:15,230 --> 00:26:20,960
was probably<font color="#CCCCCC"> reverse engineered I don't</font>

564
00:26:18,680 --> 00:26:24,170
<font color="#E5E5E5">think I had any really good results from</font>

565
00:26:20,960 --> 00:26:26,540
this<font color="#CCCCCC"> but there is an older version of</font><font color="#E5E5E5"> a</font>

566
00:26:24,170 --> 00:26:29,510
<font color="#E5E5E5">Tricon controller called a trident</font><font color="#CCCCCC"> and</font>

567
00:26:26,540 --> 00:26:32,270
these both have you know<font color="#CCCCCC"> different</font>

568
00:26:29,510 --> 00:26:35,030
branches of software<font color="#E5E5E5"> that we're</font>

569
00:26:32,270 --> 00:26:38,090
supporting the communications for these

570
00:26:35,030 --> 00:26:39,350
controllers<font color="#CCCCCC"> in any case there's a couple</font>

571
00:26:38,090 --> 00:26:41,370
of things<font color="#E5E5E5"> that are still interesting</font>

572
00:26:39,350 --> 00:26:44,429
about this is<font color="#E5E5E5"> that</font>

573
00:26:41,370 --> 00:26:48,959
this is from the Triton<font color="#CCCCCC"> malware</font><font color="#E5E5E5"> code</font>

574
00:26:44,430 --> 00:26:52,800
<font color="#E5E5E5">there were some annotations in the in</font>

575
00:26:48,960 --> 00:26:55,290
the Triton Python scripts that<font color="#E5E5E5"> were</font>

576
00:26:52,800 --> 00:27:01,169
above what they had<font color="#CCCCCC"> reverse engineered</font>

577
00:26:55,290 --> 00:27:03,120
<font color="#E5E5E5">from the Tricon libraries</font><font color="#CCCCCC"> and you can</font>

578
00:27:01,170 --> 00:27:05,130
see that like these unknown values in

579
00:27:03,120 --> 00:27:07,919
this string<font color="#E5E5E5"> here in</font><font color="#CCCCCC"> particular are</font>

580
00:27:05,130 --> 00:27:10,500
pretty different from you<font color="#CCCCCC"> know the</font><font color="#E5E5E5"> angle</font>

581
00:27:07,920 --> 00:27:14,850
brackets kind of<font color="#E5E5E5"> characterization for</font>

582
00:27:10,500 --> 00:27:17,550
maybe unused<font color="#CCCCCC"> integers in particular</font>

583
00:27:14,850 --> 00:27:21,689
places<font color="#E5E5E5"> so it became</font><font color="#CCCCCC"> apparent to</font><font color="#E5E5E5"> me</font><font color="#CCCCCC"> that</font>

584
00:27:17,550 --> 00:27:23,100
<font color="#E5E5E5">the Triton malware developers although</font>

585
00:27:21,690 --> 00:27:24,840
they reverse engineered some of the

586
00:27:23,100 --> 00:27:28,469
legitimate software<font color="#E5E5E5"> they still had to do</font>

587
00:27:24,840 --> 00:27:30,720
a lot<font color="#CCCCCC"> of experimentation to figure out</font>

588
00:27:28,470 --> 00:27:32,760
the<font color="#E5E5E5"> network protocol</font><font color="#CCCCCC"> and we know</font><font color="#E5E5E5"> that</font>

589
00:27:30,720 --> 00:27:36,570
because<font color="#E5E5E5"> not only did their malware</font>

590
00:27:32,760 --> 00:27:38,400
framework take so long to<font color="#E5E5E5"> develop</font><font color="#CCCCCC"> they</font>

591
00:27:36,570 --> 00:27:40,409
had a really hard<font color="#E5E5E5"> time using it in the</font>

592
00:27:38,400 --> 00:27:42,690
wild<font color="#E5E5E5"> and they ultimately got caught</font>

593
00:27:40,410 --> 00:27:45,330
<font color="#E5E5E5">before they were able</font><font color="#CCCCCC"> to do too much</font>

594
00:27:42,690 --> 00:27:48,240
<font color="#CCCCCC">damage so you know again</font><font color="#E5E5E5"> six months</font><font color="#CCCCCC"> ago</font>

595
00:27:45,330 --> 00:27:51,720
<font color="#E5E5E5">or</font><font color="#CCCCCC"> a year ago</font><font color="#E5E5E5"> we only had like the</font>

596
00:27:48,240 --> 00:27:54,059
suspicion that they<font color="#E5E5E5"> reverse</font><font color="#CCCCCC"> engineered</font>

597
00:27:51,720 --> 00:27:55,920
<font color="#E5E5E5">something we're able to finally provide</font>

598
00:27:54,059 --> 00:27:58,230
some kind of conclusive<font color="#CCCCCC"> evidence</font><font color="#E5E5E5"> to</font>

599
00:27:55,920 --> 00:28:00,570
support that<font color="#CCCCCC"> um so that</font><font color="#E5E5E5"> was kind of a</font>

600
00:27:58,230 --> 00:28:03,480
win for me and then a year ago we<font color="#E5E5E5"> had no</font>

601
00:28:00,570 --> 00:28:05,040
<font color="#CCCCCC">the world had no</font><font color="#E5E5E5"> visibility into the Tri</font>

602
00:28:03,480 --> 00:28:07,140
Station protocol was a black box

603
00:28:05,040 --> 00:28:08,820
<font color="#E5E5E5">protocol undocumented</font><font color="#CCCCCC"> we have some</font>

604
00:28:07,140 --> 00:28:10,980
<font color="#CCCCCC">documentation</font><font color="#E5E5E5"> of it</font>

605
00:28:08,820 --> 00:28:15,389
the<font color="#E5E5E5"> nozomi guys probably know more</font><font color="#CCCCCC"> than</font>

606
00:28:10,980 --> 00:28:16,470
anybody<font color="#E5E5E5"> about this protocol</font><font color="#CCCCCC"> we know that</font>

607
00:28:15,390 --> 00:28:19,440
they had a<font color="#E5E5E5"> hard time using it in the</font>

608
00:28:16,470 --> 00:28:21,630
wild<font color="#CCCCCC"> because when we went to the</font>

609
00:28:19,440 --> 00:28:25,530
engineering<font color="#CCCCCC"> workstations that was</font>

610
00:28:21,630 --> 00:28:28,290
launching the Triton malware<font color="#CCCCCC"> we could</font>

611
00:28:25,530 --> 00:28:30,570
see from<font color="#CCCCCC"> the user Journal</font><font color="#E5E5E5"> which is also</font>

612
00:28:28,290 --> 00:28:33,750
<font color="#CCCCCC">our USM</font><font color="#E5E5E5"> Journal also called the change</font>

613
00:28:30,570 --> 00:28:37,100
<font color="#CCCCCC">journal I think Universal</font><font color="#E5E5E5"> sequence</font>

614
00:28:33,750 --> 00:28:40,620
number this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> an NTFS feature that logs</font>

615
00:28:37,100 --> 00:28:42,449
<font color="#E5E5E5">file names and change time but we could</font>

616
00:28:40,620 --> 00:28:44,010
see they uploaded like a hundred

617
00:28:42,450 --> 00:28:45,960
different versions of the<font color="#CCCCCC"> Tri</font><font color="#E5E5E5"> and</font>

618
00:28:44,010 --> 00:28:47,640
malware<font color="#E5E5E5"> and they</font><font color="#CCCCCC"> also uploaded like a</font>

619
00:28:45,960 --> 00:28:49,200
hundred different<font color="#E5E5E5"> other scripts and a</font>

620
00:28:47,640 --> 00:28:52,230
hundred<font color="#CCCCCC"> different other utilities</font><font color="#E5E5E5"> they</font>

621
00:28:49,200 --> 00:28:54,840
had a hard ass time getting there<font color="#E5E5E5"> and</font>

622
00:28:52,230 --> 00:28:55,260
then making this work and I think<font color="#E5E5E5"> the</font>

623
00:28:54,840 --> 00:28:57,230
<font color="#E5E5E5">expiry</font>

624
00:28:55,260 --> 00:28:59,520
imitation that<font color="#E5E5E5"> they were doing</font>

625
00:28:57,230 --> 00:29:02,700
<font color="#E5E5E5">ultimately led to the outcome which is</font>

626
00:28:59,520 --> 00:29:05,910
<font color="#E5E5E5">they caused one</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> Tricon</font>

627
00:29:02,700 --> 00:29:09,210
controllers to enter a<font color="#CCCCCC"> failed state</font><font color="#E5E5E5"> that</font>

628
00:29:05,910 --> 00:29:11,220
<font color="#CCCCCC">fails state which is monitored by the</font>

629
00:29:09,210 --> 00:29:14,220
industrial control systems monitoring

630
00:29:11,220 --> 00:29:17,520
software<font color="#CCCCCC"> induced a shutdown of this</font>

631
00:29:14,220 --> 00:29:18,960
entire industrial process and as you can

632
00:29:17,520 --> 00:29:21,030
imagine if you run a big industrial

633
00:29:18,960 --> 00:29:22,170
plant<font color="#CCCCCC"> you're like losing a million</font>

634
00:29:21,030 --> 00:29:24,240
dollars a<font color="#E5E5E5"> minute</font>

635
00:29:22,170 --> 00:29:27,140
every time<font color="#E5E5E5"> your industrial processes go</font>

636
00:29:24,240 --> 00:29:29,160
down<font color="#E5E5E5"> so that's what got them caught and</font>

637
00:29:27,140 --> 00:29:31,650
last but<font color="#E5E5E5"> not least it's really important</font>

638
00:29:29,160 --> 00:29:33,150
to acknowledge all<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the public</font>

639
00:29:31,650 --> 00:29:35,040
research that was done<font color="#CCCCCC"> on</font><font color="#E5E5E5"> this I think</font><font color="#CCCCCC"> I</font>

640
00:29:33,150 --> 00:29:37,380
read<font color="#E5E5E5"> everything for the most part</font>

641
00:29:35,040 --> 00:29:40,649
<font color="#CCCCCC">there's a couple of good fireEye blogs</font>

642
00:29:37,380 --> 00:29:42,720
<font color="#E5E5E5">on this the zombie networks guys did a</font>

643
00:29:40,650 --> 00:29:45,750
<font color="#E5E5E5">lot of research they purchased</font><font color="#CCCCCC"> the</font>

644
00:29:42,720 --> 00:29:47,790
controller<font color="#E5E5E5"> on eBay</font><font color="#CCCCCC"> and reverse</font>

645
00:29:45,750 --> 00:29:50,790
engineered some of the<font color="#CCCCCC"> try station</font>

646
00:29:47,790 --> 00:29:52,920
<font color="#CCCCCC">software as well I think</font><font color="#E5E5E5"> doing may be</font>

647
00:29:50,790 --> 00:29:55,470
exactly<font color="#E5E5E5"> what</font><font color="#CCCCCC"> the Triton malware</font>

648
00:29:52,920 --> 00:29:57,600
developers did dragos guys have a<font color="#E5E5E5"> lot</font><font color="#CCCCCC"> of</font>

649
00:29:55,470 --> 00:29:59,970
good stuff Accenture has<font color="#E5E5E5"> an awesome</font>

650
00:29:57,600 --> 00:30:03,689
white paper on<font color="#E5E5E5"> this</font><font color="#CCCCCC"> the guy behind</font>

651
00:29:59,970 --> 00:30:05,370
midnight blue<font color="#E5E5E5"> labs ics-cert CSL at</font>

652
00:30:03,690 --> 00:30:08,490
<font color="#E5E5E5">University of Illinois</font><font color="#CCCCCC"> there's a github</font>

653
00:30:05,370 --> 00:30:11,010
repo<font color="#CCCCCC"> with all of the malware and all the</font>

654
00:30:08,490 --> 00:30:13,410
decompiled scripts and then all<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the</font>

655
00:30:11,010 --> 00:30:15,390
resources and all of this is important

656
00:30:13,410 --> 00:30:18,390
because ICS if you think<font color="#E5E5E5"> everything is</font>

657
00:30:15,390 --> 00:30:21,180
<font color="#E5E5E5">broken IT you got to you got</font><font color="#CCCCCC"> to check</font>

658
00:30:18,390 --> 00:30:24,870
out ICS<font color="#CCCCCC"> it's it's a different world</font>

659
00:30:21,180 --> 00:30:26,910
everything's like<font color="#E5E5E5"> 20 years old</font><font color="#CCCCCC"> and so a</font>

660
00:30:24,870 --> 00:30:29,250
lot<font color="#CCCCCC"> of that's just</font><font color="#E5E5E5"> hanging out</font><font color="#CCCCCC"> there and</font>

661
00:30:26,910 --> 00:30:31,260
<font color="#E5E5E5">if you're interested in ICS there's no</font>

662
00:30:29,250 --> 00:30:35,010
better time<font color="#CCCCCC"> than right now to get</font><font color="#E5E5E5"> into</font>

663
00:30:31,260 --> 00:30:36,240
<font color="#E5E5E5">ICS security and with that I will take</font>

664
00:30:35,010 --> 00:30:38,660
any<font color="#CCCCCC"> questions I think</font><font color="#E5E5E5"> we got like a</font>

665
00:30:36,240 --> 00:30:38,660
minute<font color="#E5E5E5"> left</font>

666
00:30:43,040 --> 00:30:48,000
yeah thank you<font color="#E5E5E5"> like you said you have</font>

667
00:30:45,060 --> 00:30:51,389
<font color="#CCCCCC">one minute</font><font color="#E5E5E5"> left so there's at least one</font>

668
00:30:48,000 --> 00:30:54,440
question<font color="#CCCCCC"> right don't</font><font color="#E5E5E5"> ask me who it</font><font color="#CCCCCC"> was</font>

669
00:30:51,390 --> 00:30:54,440
<font color="#CCCCCC">because I can't say</font>

