1
00:00:01,190 --> 00:00:06,359
thank you very<font color="#CCCCCC"> much</font>

2
00:00:04,230 --> 00:00:07,710
so<font color="#E5E5E5"> all right my name is Daniel Bohannon</font>

3
00:00:06,359 --> 00:00:09,540
<font color="#E5E5E5">and today we're gonna be</font><font color="#CCCCCC"> looking at</font>

4
00:00:07,710 --> 00:00:11,040
invoke<font color="#CCCCCC"> Cradle crafter which is a</font>

5
00:00:09,540 --> 00:00:13,079
<font color="#E5E5E5">PowerShell</font><font color="#CCCCCC"> off--you station framework</font>

6
00:00:11,040 --> 00:00:15,750
that<font color="#E5E5E5"> I released just a few</font><font color="#CCCCCC"> months</font><font color="#E5E5E5"> ago a</font>

7
00:00:13,080 --> 00:00:17,190
<font color="#E5E5E5">little bit about myself I work with</font>

8
00:00:15,750 --> 00:00:19,859
<font color="#CCCCCC">mandiant out of the Washington DC area</font>

9
00:00:17,190 --> 00:00:21,420
this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> my first time</font><font color="#E5E5E5"> in Sweden and you</font>

10
00:00:19,859 --> 00:00:23,010
guys have amazing<font color="#E5E5E5"> coffee shops here I</font>

11
00:00:21,420 --> 00:00:24,359
can't just say that<font color="#CCCCCC"> I</font><font color="#E5E5E5"> think I've</font><font color="#CCCCCC"> hit at</font>

12
00:00:23,010 --> 00:00:26,279
<font color="#E5E5E5">least three or four coffee shops in the</font>

13
00:00:24,359 --> 00:00:29,220
past 24 hours<font color="#CCCCCC"> so really beautiful city</font>

14
00:00:26,279 --> 00:00:30,570
<font color="#E5E5E5">I'm really happy to be here</font><font color="#CCCCCC"> so for the</font>

15
00:00:29,220 --> 00:00:32,668
<font color="#E5E5E5">past two years I've been doing Incident</font>

16
00:00:30,570 --> 00:00:33,719
Response consulting with mandiant<font color="#E5E5E5"> and</font>

17
00:00:32,668 --> 00:00:35,790
then the past several months have

18
00:00:33,719 --> 00:00:38,040
actually transitioned into more of<font color="#E5E5E5"> a</font>

19
00:00:35,790 --> 00:00:39,780
research position<font color="#E5E5E5"> so I do a lot</font><font color="#CCCCCC"> of</font>

20
00:00:38,040 --> 00:00:41,640
detection<font color="#E5E5E5"> apply to</font><font color="#CCCCCC"> research with a</font>

21
00:00:39,780 --> 00:00:44,670
couple guys they're really really having

22
00:00:41,640 --> 00:00:45,960
a good time<font color="#CCCCCC"> so a quick outline</font><font color="#E5E5E5"> this is</font>

23
00:00:44,670 --> 00:00:48,329
only<font color="#CCCCCC"> thirty minutes</font><font color="#E5E5E5"> I'll be moving very</font>

24
00:00:45,960 --> 00:00:50,250
<font color="#E5E5E5">quickly</font><font color="#CCCCCC"> the slides are available online</font>

25
00:00:48,329 --> 00:00:52,079
and that<font color="#E5E5E5"> we'll see we'll see</font><font color="#CCCCCC"> what we can</font>

26
00:00:50,250 --> 00:00:53,399
get through<font color="#CCCCCC"> so first of all kind of</font>

27
00:00:52,079 --> 00:00:55,649
motivation why I started this research

28
00:00:53,399 --> 00:00:57,930
<font color="#E5E5E5">and</font><font color="#CCCCCC"> then</font><font color="#E5E5E5"> we'll look at kind</font><font color="#CCCCCC"> of the</font>

29
00:00:55,649 --> 00:00:59,340
current<font color="#E5E5E5"> state</font><font color="#CCCCCC"> of PowerShell detection</font>

30
00:00:57,930 --> 00:01:01,859
particularly<font color="#CCCCCC"> to off you skated</font>

31
00:00:59,340 --> 00:01:03,629
PowerShell<font color="#CCCCCC"> and then we'll look at the</font>

32
00:01:01,859 --> 00:01:05,280
<font color="#CCCCCC">new techniques introduced in invoke</font>

33
00:01:03,629 --> 00:01:06,929
<font color="#E5E5E5">Cradle crafter particularly that when I</font>

34
00:01:05,280 --> 00:01:08,640
use the word<font color="#E5E5E5"> Cradle it's looking</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> set</font>

35
00:01:06,930 --> 00:01:10,560
a very simple one-liner command<font color="#E5E5E5"> to</font>

36
00:01:08,640 --> 00:01:12,960
download a remote resource and execute

37
00:01:10,560 --> 00:01:14,070
<font color="#E5E5E5">it in memory which is</font><font color="#CCCCCC"> oftentimes what we</font>

38
00:01:12,960 --> 00:01:15,689
see attackers do when they use

39
00:01:14,070 --> 00:01:17,130
PowerShell<font color="#CCCCCC"> then we're going</font><font color="#E5E5E5"> to look at</font>

40
00:01:15,689 --> 00:01:19,289
detecting these<font color="#E5E5E5"> cradles so I'm a</font><font color="#CCCCCC"> Blue</font>

41
00:01:17,130 --> 00:01:21,270
<font color="#CCCCCC">Timur so</font><font color="#E5E5E5"> whenever I look in research</font>

42
00:01:19,290 --> 00:01:22,799
these areas of<font color="#E5E5E5"> occupation and</font><font color="#CCCCCC"> offensive</font>

43
00:01:21,270 --> 00:01:24,030
tooling<font color="#E5E5E5"> I'm looking at it</font><font color="#CCCCCC"> from the</font>

44
00:01:22,799 --> 00:01:25,770
perspective<font color="#E5E5E5"> of what can</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> learn as a</font>

45
00:01:24,030 --> 00:01:27,900
defender what artifacts are left<font color="#CCCCCC"> behind</font>

46
00:01:25,770 --> 00:01:29,399
<font color="#E5E5E5">so</font><font color="#CCCCCC"> that in both</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> real-time and a</font>

47
00:01:27,900 --> 00:01:31,259
forensic perspective how can we<font color="#E5E5E5"> detect</font>

48
00:01:29,400 --> 00:01:32,909
this activity happened<font color="#E5E5E5"> and as you'll see</font>

49
00:01:31,259 --> 00:01:34,650
<font color="#CCCCCC">in the tool I put all the information</font>

50
00:01:32,909 --> 00:01:36,119
<font color="#CCCCCC">into</font><font color="#E5E5E5"> the tool itself so</font><font color="#CCCCCC"> that as about</font>

51
00:01:34,650 --> 00:01:37,530
<font color="#E5E5E5">the red teamer and a blue Timur when you</font>

52
00:01:36,119 --> 00:01:39,329
go through the tool<font color="#E5E5E5"> and look at the</font>

53
00:01:37,530 --> 00:01:41,040
techniques then all the information is

54
00:01:39,329 --> 00:01:43,079
<font color="#E5E5E5">there as to</font><font color="#CCCCCC"> what it's doing what</font>

55
00:01:41,040 --> 00:01:44,610
<font color="#E5E5E5">artifacts are left</font><font color="#CCCCCC"> behind so</font><font color="#E5E5E5"> hopefully</font>

56
00:01:43,079 --> 00:01:46,520
that's<font color="#CCCCCC"> useful</font><font color="#E5E5E5"> and then at the end we'll</font>

57
00:01:44,610 --> 00:01:48,060
<font color="#E5E5E5">go through a quick</font><font color="#CCCCCC"> demo of</font><font color="#E5E5E5"> the tool</font><font color="#CCCCCC"> so</font>

58
00:01:46,520 --> 00:01:50,039
<font color="#CCCCCC">my disclaimer</font>

59
00:01:48,060 --> 00:01:51,540
whenever I talk about PowerShell I

60
00:01:50,040 --> 00:01:52,500
typically get<font color="#E5E5E5"> a few questions afterwards</font>

61
00:01:51,540 --> 00:01:53,520
and so I just want to<font color="#E5E5E5"> answer those</font>

62
00:01:52,500 --> 00:01:56,040
<font color="#E5E5E5">upfront</font><font color="#CCCCCC"> um</font>

63
00:01:53,520 --> 00:01:58,079
blocking PowerShell<font color="#E5E5E5"> this is not really a</font>

64
00:01:56,040 --> 00:02:00,210
realistic<font color="#E5E5E5"> option and the reason this</font>

65
00:01:58,079 --> 00:02:02,189
PowerShell is not just PowerShell<font color="#CCCCCC"> DXE</font>

66
00:02:00,210 --> 00:02:03,990
<font color="#E5E5E5">that's the most common host application</font>

67
00:02:02,189 --> 00:02:06,479
but it's actually the<font color="#E5E5E5"> system management</font>

68
00:02:03,990 --> 00:02:07,949
automation<font color="#CCCCCC"> DLL and there's a ton of ways</font>

69
00:02:06,479 --> 00:02:09,508
<font color="#E5E5E5">you can load that</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> shoot PowerShell</font>

70
00:02:07,950 --> 00:02:12,780
commands<font color="#CCCCCC"> without power shell that</font><font color="#E5E5E5"> XE</font>

71
00:02:09,508 --> 00:02:13,819
ever running<font color="#E5E5E5"> and so why is blocking</font>

72
00:02:12,780 --> 00:02:16,040
PowerShell<font color="#CCCCCC"> 2xe</font>

73
00:02:13,819 --> 00:02:17,390
<font color="#E5E5E5">you know really not a great solution in</font>

74
00:02:16,040 --> 00:02:20,420
my opinion well that leads to the second

75
00:02:17,390 --> 00:02:22,849
point<font color="#E5E5E5"> noted blue teamers</font><font color="#CCCCCC"> jared hate</font><font color="#E5E5E5"> once</font>

76
00:02:20,420 --> 00:02:25,280
said in a conference<font color="#CCCCCC"> powershell is not</font>

77
00:02:22,849 --> 00:02:26,899
<font color="#E5E5E5">special and what he meant by that was as</font>

78
00:02:25,280 --> 00:02:29,299
<font color="#E5E5E5">hackers often will use PowerShell just</font>

79
00:02:26,900 --> 00:02:30,409
to download<font color="#CCCCCC"> a stupid binary to run</font><font color="#E5E5E5"> so</font>

80
00:02:29,299 --> 00:02:32,510
<font color="#E5E5E5">people are worried about this is a</font>

81
00:02:30,409 --> 00:02:34,909
PowerShell problem it's<font color="#E5E5E5"> like no this</font><font color="#CCCCCC"> is</font>

82
00:02:32,510 --> 00:02:36,409
a problem<font color="#CCCCCC"> of</font><font color="#E5E5E5"> your user you know opened</font>

83
00:02:34,909 --> 00:02:38,689
<font color="#E5E5E5">up a macro and</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> loud code to execute</font>

84
00:02:36,409 --> 00:02:40,548
power shell just<font color="#CCCCCC"> happened to be what it</font>

85
00:02:38,689 --> 00:02:43,069
was used<font color="#E5E5E5"> to</font><font color="#CCCCCC"> download something</font><font color="#E5E5E5"> else</font>

86
00:02:40,549 --> 00:02:44,870
and third is<font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> five that</font><font color="#E5E5E5"> I was</font>

87
00:02:43,069 --> 00:02:46,608
our new best<font color="#CCCCCC"> friends</font><font color="#E5E5E5"> the PowerShell team</font>

88
00:02:44,870 --> 00:02:50,810
at Microsoft has introduced<font color="#E5E5E5"> an</font>

89
00:02:46,609 --> 00:02:53,209
incredible security<font color="#CCCCCC"> developments into a</font>

90
00:02:50,810 --> 00:02:55,280
PowerShell<font color="#CCCCCC"> five and there's a</font><font color="#E5E5E5"> two links</font>

91
00:02:53,209 --> 00:02:56,750
<font color="#E5E5E5">here looking at from</font><font color="#CCCCCC"> a login perspective</font>

92
00:02:55,280 --> 00:02:58,219
<font color="#E5E5E5">all the advantages you get with</font>

93
00:02:56,750 --> 00:03:00,199
PowerShell<font color="#E5E5E5"> five and then a lot more</font>

94
00:02:58,219 --> 00:03:01,459
<font color="#CCCCCC">preventive measures such as gyah just</font>

95
00:03:00,199 --> 00:03:05,419
enough administration and stuff<font color="#E5E5E5"> like</font>

96
00:03:01,459 --> 00:03:06,889
that<font color="#E5E5E5"> so my motivation</font><font color="#CCCCCC"> as an</font><font color="#E5E5E5"> IR person</font>

97
00:03:05,419 --> 00:03:08,569
that mandiant we see PowerShell being

98
00:03:06,889 --> 00:03:10,359
used at literally almost every

99
00:03:08,569 --> 00:03:12,948
<font color="#E5E5E5">investigation that we get our hands</font><font color="#CCCCCC"> on</font>

100
00:03:10,359 --> 00:03:15,829
<font color="#E5E5E5">the reason is it's a</font><font color="#CCCCCC"> Windows sign native</font>

101
00:03:12,949 --> 00:03:17,959
binary available by<font color="#CCCCCC"> default Windows 7</font>

102
00:03:15,829 --> 00:03:19,579
and later<font color="#E5E5E5"> and you can execute</font><font color="#CCCCCC"> remote</font>

103
00:03:17,959 --> 00:03:22,519
code in memory without<font color="#E5E5E5"> anything hitting</font>

104
00:03:19,579 --> 00:03:24,439
disk which attackers like<font color="#CCCCCC"> a lot</font><font color="#E5E5E5"> now</font><font color="#CCCCCC"> it's</font>

105
00:03:22,519 --> 00:03:26,599
basically<font color="#E5E5E5"> impossible to detect</font><font color="#CCCCCC"> unless</font>

106
00:03:24,439 --> 00:03:27,978
you have it<font color="#CCCCCC"> a bare minimum</font><font color="#E5E5E5"> command-line</font>

107
00:03:26,599 --> 00:03:30,228
argument logging and that will capture

108
00:03:27,979 --> 00:03:31,609
some stuff<font color="#E5E5E5"> but</font><font color="#CCCCCC"> really PowerShell logging</font>

109
00:03:30,229 --> 00:03:33,590
is what you want to get to specifically

110
00:03:31,609 --> 00:03:38,209
script lock logging in addition to

111
00:03:33,590 --> 00:03:40,579
module and transcription logging so some

112
00:03:38,209 --> 00:03:41,930
<font color="#E5E5E5">of my colleagues asked me why do I</font>

113
00:03:40,579 --> 00:03:43,459
continue<font color="#CCCCCC"> researching more ways to</font>

114
00:03:41,930 --> 00:03:46,009
<font color="#CCCCCC">authenticate powershell because it makes</font>

115
00:03:43,459 --> 00:03:47,419
our jobs incredibly more difficult the

116
00:03:46,009 --> 00:03:49,819
<font color="#E5E5E5">more of</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> stuff that's out there when</font>

117
00:03:47,419 --> 00:03:52,280
the<font color="#E5E5E5"> answer is that attackers are getting</font>

118
00:03:49,819 --> 00:03:53,869
more<font color="#E5E5E5"> and more</font><font color="#CCCCCC"> creative as well</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> feel</font>

119
00:03:52,280 --> 00:03:55,069
like<font color="#E5E5E5"> it's important to try to stay ahead</font>

120
00:03:53,870 --> 00:03:57,049
<font color="#CCCCCC">of</font><font color="#E5E5E5"> them and enumerate all these</font>

121
00:03:55,069 --> 00:03:58,399
possibilities and then share that<font color="#E5E5E5"> openly</font>

122
00:03:57,049 --> 00:04:00,290
with the community so<font color="#CCCCCC"> that we can all</font>

123
00:03:58,400 --> 00:04:04,370
get<font color="#E5E5E5"> better together</font><font color="#CCCCCC"> especially from a</font>

124
00:04:00,290 --> 00:04:05,599
defensive perspective<font color="#CCCCCC"> so ya invoke</font>

125
00:04:04,370 --> 00:04:07,549
<font color="#E5E5E5">cradle crafter is kind of a living</font>

126
00:04:05,599 --> 00:04:09,469
library<font color="#E5E5E5"> of all the different ways</font><font color="#CCCCCC"> that</font>

127
00:04:07,549 --> 00:04:12,919
<font color="#E5E5E5">you can use PowerShell to download</font>

128
00:04:09,469 --> 00:04:14,120
content<font color="#E5E5E5"> either in memory or</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> disk so</font>

129
00:04:12,919 --> 00:04:16,310
the<font color="#E5E5E5"> current state of PowerShell</font><font color="#CCCCCC"> off you</font>

130
00:04:14,120 --> 00:04:18,978
<font color="#CCCCCC">see a ssin there's a lot of it</font><font color="#E5E5E5"> out</font><font color="#CCCCCC"> there</font>

131
00:04:16,310 --> 00:04:21,320
so exactly one year ago<font color="#E5E5E5"> I released</font><font color="#CCCCCC"> this</font>

132
00:04:18,978 --> 00:04:22,789
tool<font color="#E5E5E5"> called invoke</font><font color="#CCCCCC"> efficient and which</font>

133
00:04:21,320 --> 00:04:24,349
basically automates<font color="#CCCCCC"> I'm a lot of</font>

134
00:04:22,789 --> 00:04:25,729
different layers for in particular<font color="#CCCCCC"> of</font>

135
00:04:24,349 --> 00:04:26,960
power shut<font color="#CCCCCC"> off you station you have the</font>

136
00:04:25,729 --> 00:04:30,139
token layer

137
00:04:26,960 --> 00:04:31,520
lair encoding and launcher<font color="#CCCCCC"> and so again</font>

138
00:04:30,139 --> 00:04:32,690
this is only a<font color="#CCCCCC"> 30-minute talks I'm</font><font color="#E5E5E5"> not</font>

139
00:04:31,520 --> 00:04:34,669
gonna dive into this too<font color="#CCCCCC"> deeply but</font>

140
00:04:32,690 --> 00:04:36,979
basically you<font color="#CCCCCC"> can have</font><font color="#E5E5E5"> a remote download</font>

141
00:04:34,669 --> 00:04:38,258
<font color="#CCCCCC">cradle like this at the top</font><font color="#E5E5E5"> and in</font><font color="#CCCCCC"> BO</font>

142
00:04:36,979 --> 00:04:40,550
<font color="#CCCCCC">coffee station</font><font color="#E5E5E5"> will do things like</font>

143
00:04:38,259 --> 00:04:42,979
concatenate strings<font color="#CCCCCC"> with single quotes</font>

144
00:04:40,550 --> 00:04:44,930
<font color="#E5E5E5">double quotes</font><font color="#CCCCCC"> white space they can</font><font color="#E5E5E5"> take</font>

145
00:04:42,979 --> 00:04:47,539
<font color="#E5E5E5">something like download string and this</font>

146
00:04:44,930 --> 00:04:50,810
is<font color="#E5E5E5"> just one method of the.net</font><font color="#CCCCCC"> what the</font>

147
00:04:47,539 --> 00:04:51,979
dot<font color="#E5E5E5"> the net dot web client net class</font><font color="#CCCCCC"> and</font>

148
00:04:50,810 --> 00:04:53,090
but there's a lot<font color="#E5E5E5"> of other ones that a</font>

149
00:04:51,979 --> 00:04:54,620
lot<font color="#CCCCCC"> of defenders aren't looking for</font>

150
00:04:53,090 --> 00:04:56,690
<font color="#E5E5E5">download string is the most common but</font>

151
00:04:54,620 --> 00:04:57,949
<font color="#CCCCCC">you have a lot more and this</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> where</font>

152
00:04:56,690 --> 00:04:59,990
<font color="#CCCCCC">invoked cradle cracker</font><font color="#E5E5E5"> will actually</font>

153
00:04:57,949 --> 00:05:02,120
<font color="#E5E5E5">take advantage of this because these all</font>

154
00:04:59,990 --> 00:05:03,560
return different formats and results<font color="#CCCCCC"> in</font>

155
00:05:02,120 --> 00:05:04,880
the cradle crafter can actually take

156
00:05:03,560 --> 00:05:07,400
that<font color="#CCCCCC"> and swap them out which we'll see</font>

157
00:05:04,880 --> 00:05:08,930
<font color="#CCCCCC">later</font><font color="#E5E5E5"> but</font><font color="#CCCCCC"> in both off you station will</font>

158
00:05:07,400 --> 00:05:11,120
say I don't<font color="#E5E5E5"> care what the method is I</font>

159
00:05:08,930 --> 00:05:12,380
can put<font color="#E5E5E5"> single quotes around it</font><font color="#CCCCCC"> I can</font>

160
00:05:11,120 --> 00:05:15,020
<font color="#E5E5E5">put double</font><font color="#CCCCCC"> quotes around it</font><font color="#E5E5E5"> and it all</font>

161
00:05:12,380 --> 00:05:17,210
still runs fine<font color="#CCCCCC"> I can put a tick mark in</font>

162
00:05:15,020 --> 00:05:18,530
<font color="#CCCCCC">it</font><font color="#E5E5E5"> I put a lot of tick marks in it</font><font color="#CCCCCC"> um in</font>

163
00:05:17,210 --> 00:05:20,180
this persist both in<font color="#E5E5E5"> command line</font>

164
00:05:18,530 --> 00:05:21,770
<font color="#E5E5E5">logging as well as all the way in the</font>

165
00:05:20,180 --> 00:05:23,539
<font color="#CCCCCC">PowerShell script block</font><font color="#E5E5E5"> logging as well</font>

166
00:05:21,770 --> 00:05:25,250
so as defenders if we're looking<font color="#CCCCCC"> for</font>

167
00:05:23,539 --> 00:05:27,050
download string<font color="#E5E5E5"> and logs</font><font color="#CCCCCC"> we're gonna get</font>

168
00:05:25,250 --> 00:05:29,330
burned this way<font color="#E5E5E5"> now this will show</font><font color="#CCCCCC"> up</font>

169
00:05:27,050 --> 00:05:31,250
correctly<font color="#CCCCCC"> in PowerShell</font><font color="#E5E5E5"> module logs but</font>

170
00:05:29,330 --> 00:05:33,710
there's a module log for every single

171
00:05:31,250 --> 00:05:35,539
parameter binding and<font color="#E5E5E5"> stuff like that</font>

172
00:05:33,710 --> 00:05:37,280
for a single<font color="#E5E5E5"> script so one script you</font>

173
00:05:35,539 --> 00:05:39,380
could have hundreds or<font color="#E5E5E5"> even thousands of</font>

174
00:05:37,280 --> 00:05:40,580
module<font color="#E5E5E5"> logs</font><font color="#CCCCCC"> all the</font><font color="#E5E5E5"> information is</font><font color="#CCCCCC"> there</font>

175
00:05:39,380 --> 00:05:42,949
it's just spread out<font color="#E5E5E5"> in a lot of</font>

176
00:05:40,580 --> 00:05:46,099
<font color="#E5E5E5">different</font><font color="#CCCCCC"> pieces you can put tick marks</font>

177
00:05:42,949 --> 00:05:47,750
in front<font color="#CCCCCC"> of arguments</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> new</font><font color="#E5E5E5"> object new</font>

178
00:05:46,099 --> 00:05:49,219
object is a command list so invoke<font color="#E5E5E5"> off</font>

179
00:05:47,750 --> 00:05:50,810
<font color="#E5E5E5">you</font><font color="#CCCCCC"> station will treat any command line</font>

180
00:05:49,219 --> 00:05:52,580
<font color="#CCCCCC">it'll do</font><font color="#E5E5E5"> things like options one two</font><font color="#CCCCCC"> and</font>

181
00:05:50,810 --> 00:05:55,009
<font color="#E5E5E5">three put tick marks</font>

182
00:05:52,580 --> 00:05:56,359
it'll concatenate<font color="#CCCCCC"> it and</font><font color="#E5E5E5"> invoke it</font><font color="#CCCCCC"> or</font>

183
00:05:55,009 --> 00:05:58,550
the number option number three is

184
00:05:56,360 --> 00:06:00,860
<font color="#CCCCCC">actually</font><font color="#E5E5E5"> reordering with that - F format</font>

185
00:05:58,550 --> 00:06:03,139
operator now<font color="#E5E5E5"> in</font><font color="#CCCCCC"> both cradle craft are</font>

186
00:06:00,860 --> 00:06:04,729
introduces<font color="#CCCCCC"> two more techniques so invoke</font>

187
00:06:03,139 --> 00:06:06,770
off<font color="#CCCCCC"> Yusuke shion's office kitchen</font><font color="#E5E5E5"> is</font>

188
00:06:04,729 --> 00:06:08,870
completely different<font color="#E5E5E5"> from</font><font color="#CCCCCC"> that of invoke</font>

189
00:06:06,770 --> 00:06:10,909
cradle<font color="#E5E5E5"> crafter cradle crafter will go</font>

190
00:06:08,870 --> 00:06:12,380
and say<font color="#E5E5E5"> okay well let me let</font><font color="#CCCCCC"> me just say</font>

191
00:06:10,909 --> 00:06:14,120
get command for new object and<font color="#E5E5E5"> then</font>

192
00:06:12,380 --> 00:06:15,889
invoke the string that comes<font color="#E5E5E5"> back</font><font color="#CCCCCC"> i'm or</font>

193
00:06:14,120 --> 00:06:17,690
let me use<font color="#CCCCCC"> number</font><font color="#E5E5E5"> five as the powershell</font>

194
00:06:15,889 --> 00:06:19,940
one<font color="#E5E5E5"> dodo syntax to do that but instead</font>

195
00:06:17,690 --> 00:06:21,560
of<font color="#E5E5E5"> specifying</font><font color="#CCCCCC"> new object we can</font><font color="#E5E5E5"> do that</font>

196
00:06:19,940 --> 00:06:23,360
and use wildcards<font color="#E5E5E5"> and that will return</font>

197
00:06:21,560 --> 00:06:25,190
<font color="#E5E5E5">new</font><font color="#CCCCCC"> object</font><font color="#E5E5E5"> and allow us to invoke it and</font>

198
00:06:23,360 --> 00:06:27,050
instead<font color="#E5E5E5"> of get command in that execution</font>

199
00:06:25,190 --> 00:06:27,770
<font color="#E5E5E5">context we could actually off you skate</font>

200
00:06:27,050 --> 00:06:29,570
that<font color="#E5E5E5"> as well</font>

201
00:06:27,770 --> 00:06:31,340
and all these components<font color="#CCCCCC"> that</font><font color="#E5E5E5"> can be</font>

202
00:06:29,570 --> 00:06:33,590
<font color="#E5E5E5">swapped around and little cradle</font><font color="#CCCCCC"> traps</font>

203
00:06:31,340 --> 00:06:35,750
will randomly off you skate<font color="#E5E5E5"> each of</font>

204
00:06:33,590 --> 00:06:37,130
those for you<font color="#E5E5E5"> and</font><font color="#CCCCCC"> actually</font><font color="#E5E5E5"> i designed</font>

205
00:06:35,750 --> 00:06:39,710
the tool to give you a lot<font color="#CCCCCC"> more</font><font color="#E5E5E5"> control</font>

206
00:06:37,130 --> 00:06:41,830
<font color="#CCCCCC">over which parts you swap and so we'll</font>

207
00:06:39,710 --> 00:06:45,530
see<font color="#CCCCCC"> that</font><font color="#E5E5E5"> in</font><font color="#CCCCCC"> the demo</font>

208
00:06:41,830 --> 00:06:47,390
so<font color="#CCCCCC"> invoke expression as crazy as the</font>

209
00:06:45,530 --> 00:06:48,830
obfuscation got in in vogue off<font color="#CCCCCC"> mutation</font>

210
00:06:47,390 --> 00:06:50,599
<font color="#CCCCCC">this</font><font color="#E5E5E5"> is the only overlap between the two</font>

211
00:06:48,830 --> 00:06:53,539
projects and<font color="#E5E5E5"> that is</font><font color="#CCCCCC"> off you scanning</font>

212
00:06:50,600 --> 00:06:55,370
<font color="#CCCCCC">the string ie X which is the alias for</font>

213
00:06:53,540 --> 00:06:57,320
invoke expression so in this example

214
00:06:55,370 --> 00:06:59,060
shell ID is an automatic variable in

215
00:06:57,320 --> 00:07:01,580
<font color="#E5E5E5">PowerShell</font><font color="#CCCCCC"> it resolves</font><font color="#E5E5E5"> to the string</font>

216
00:06:59,060 --> 00:07:03,200
<font color="#E5E5E5">Microsoft PowerShell so if we just take</font>

217
00:07:01,580 --> 00:07:05,240
<font color="#E5E5E5">the index</font><font color="#CCCCCC"> one in thirteen</font><font color="#E5E5E5"> that's</font><font color="#CCCCCC"> the</font>

218
00:07:03,200 --> 00:07:07,880
letters<font color="#E5E5E5"> I in the</font><font color="#CCCCCC"> e</font><font color="#E5E5E5"> and then we add an X</font>

219
00:07:05,240 --> 00:07:09,130
and invoke it that's now I X so<font color="#CCCCCC"> invoke</font>

220
00:07:07,880 --> 00:07:11,270
cradle crafter has<font color="#E5E5E5"> over 10 different</font>

221
00:07:09,130 --> 00:07:12,980
<font color="#E5E5E5">invocation options than these</font>

222
00:07:11,270 --> 00:07:14,960
concatenated ones<font color="#E5E5E5"> just being one</font><font color="#CCCCCC"> of</font>

223
00:07:12,980 --> 00:07:15,740
<font color="#E5E5E5">those options so that was token layer</font>

224
00:07:14,960 --> 00:07:17,599
obfuscation

225
00:07:15,740 --> 00:07:18,740
<font color="#E5E5E5">I'm string layer off you station you can</font>

226
00:07:17,600 --> 00:07:21,170
take the whole<font color="#E5E5E5"> command and concatenate</font>

227
00:07:18,740 --> 00:07:22,400
<font color="#CCCCCC">it reorder it completely reverse the</font>

228
00:07:21,170 --> 00:07:24,860
command and then reverse<font color="#E5E5E5"> it again in</font>

229
00:07:22,400 --> 00:07:27,169
memory<font color="#E5E5E5"> the third option is encoding</font>

230
00:07:24,860 --> 00:07:29,510
<font color="#E5E5E5">there's</font><font color="#CCCCCC"> eight encoding options two of</font>

231
00:07:27,170 --> 00:07:32,600
the last two just released<font color="#E5E5E5"> at at</font>

232
00:07:29,510 --> 00:07:34,099
<font color="#E5E5E5">blackhat a month ago using 100% special</font>

233
00:07:32,600 --> 00:07:38,030
characters and<font color="#CCCCCC"> then also white space and</font>

234
00:07:34,100 --> 00:07:40,490
<font color="#CCCCCC">happen coding and we'll actually look</font><font color="#E5E5E5"> at</font>

235
00:07:38,030 --> 00:07:43,369
this just very very<font color="#E5E5E5"> briefly</font><font color="#CCCCCC"> on Friday as</font>

236
00:07:40,490 --> 00:07:44,900
well and the fourth one<font color="#E5E5E5"> that's off you</font>

237
00:07:43,370 --> 00:07:47,990
skated launchers basically how can you

238
00:07:44,900 --> 00:07:49,340
<font color="#E5E5E5">even still using PowerShell dot XE how</font>

239
00:07:47,990 --> 00:07:50,570
can you launch your code in such a way

240
00:07:49,340 --> 00:07:52,130
<font color="#CCCCCC">that it doesn't even show up</font><font color="#E5E5E5"> on the</font>

241
00:07:50,570 --> 00:07:53,780
command line<font color="#CCCCCC"> for</font><font color="#E5E5E5"> PowerShell to</font><font color="#CCCCCC"> EXCI</font>

242
00:07:52,130 --> 00:07:57,440
<font color="#E5E5E5">using things like standard input</font>

243
00:07:53,780 --> 00:07:58,669
clipboard stuff like that so the current

244
00:07:57,440 --> 00:08:02,960
state of<font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> office</font><font color="#E5E5E5"> kitchen</font>

245
00:07:58,670 --> 00:08:04,970
<font color="#E5E5E5">detection it's not great a</font><font color="#CCCCCC"> V</font><font color="#E5E5E5"> is still</font>

246
00:08:02,960 --> 00:08:07,310
<font color="#E5E5E5">catching up Windows Defender is doing</font>

247
00:08:04,970 --> 00:08:09,680
some really<font color="#E5E5E5"> cool stuff</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> that front but</font>

248
00:08:07,310 --> 00:08:11,420
in general I've still not seen<font color="#CCCCCC"> AV</font><font color="#E5E5E5"> really</font>

249
00:08:09,680 --> 00:08:13,370
catch and<font color="#CCCCCC"> bow confiscation at a text</font>

250
00:08:11,420 --> 00:08:15,470
level<font color="#E5E5E5"> now office</font><font color="#CCCCCC"> Gatien is</font><font color="#E5E5E5"> affecting</font>

251
00:08:13,370 --> 00:08:17,210
static analysis the heuristic<font color="#E5E5E5"> based</font>

252
00:08:15,470 --> 00:08:18,530
detection czar still in effect<font color="#CCCCCC"> so for</font>

253
00:08:17,210 --> 00:08:20,030
<font color="#E5E5E5">example if you're running invoke</font>

254
00:08:18,530 --> 00:08:22,669
mimikatz<font color="#CCCCCC"> powershell still gonna be</font>

255
00:08:20,030 --> 00:08:24,289
running accessing else ass off<font color="#E5E5E5"> u s-- k</font>

256
00:08:22,670 --> 00:08:26,270
<font color="#CCCCCC">ssin doesn't change that at all but with</font>

257
00:08:24,290 --> 00:08:28,280
that in mind<font color="#E5E5E5"> from</font><font color="#CCCCCC"> a static perspective</font>

258
00:08:26,270 --> 00:08:31,250
still not<font color="#E5E5E5"> seeing good detection is for</font>

259
00:08:28,280 --> 00:08:34,159
invoke<font color="#E5E5E5"> off you</font><font color="#CCCCCC"> stationed some thread</font>

260
00:08:31,250 --> 00:08:36,350
actors really like using it<font color="#CCCCCC"> apt 32 which</font>

261
00:08:34,159 --> 00:08:38,659
is<font color="#CCCCCC"> also known as ocean</font><font color="#E5E5E5"> lotus vietnamese</font>

262
00:08:36,350 --> 00:08:40,460
apt group they use it a lot so my

263
00:08:38,659 --> 00:08:42,500
colleagues<font color="#E5E5E5"> really like that and they</font>

264
00:08:40,460 --> 00:08:45,230
send me those samples to<font color="#E5E5E5"> decode for them</font>

265
00:08:42,500 --> 00:08:47,870
so<font color="#E5E5E5"> payback</font>

266
00:08:45,230 --> 00:08:49,910
AMS<font color="#E5E5E5"> ir</font><font color="#CCCCCC"> am's the anti-malware scan</font>

267
00:08:47,870 --> 00:08:51,590
interface this<font color="#CCCCCC"> is available in</font>

268
00:08:49,910 --> 00:08:53,000
<font color="#E5E5E5">powershell 5 and it's it's much more</font>

269
00:08:51,590 --> 00:08:54,529
than<font color="#E5E5E5"> just powershell but a really cool</font>

270
00:08:53,000 --> 00:08:56,749
feature that<font color="#CCCCCC"> microsoft</font>

271
00:08:54,529 --> 00:08:59,029
<font color="#CCCCCC">Abel's registered AV vendors to tap into</font>

272
00:08:56,749 --> 00:09:00,199
<font color="#E5E5E5">some really cool opportunities</font><font color="#CCCCCC"> they're</font>

273
00:08:59,029 --> 00:09:02,060
basically<font color="#E5E5E5"> giving you visibility into</font>

274
00:09:00,199 --> 00:09:03,859
<font color="#E5E5E5">exactly what</font><font color="#CCCCCC"> you see in script walk logs</font>

275
00:09:02,060 --> 00:09:05,029
<font color="#CCCCCC">so you still took taken to account that</font>

276
00:09:03,860 --> 00:09:06,829
first<font color="#E5E5E5"> option that token layer</font>

277
00:09:05,029 --> 00:09:09,499
obfuscation because that's not resolved

278
00:09:06,829 --> 00:09:12,079
in script block logs<font color="#CCCCCC"> and</font><font color="#E5E5E5"> then frequency</font>

279
00:09:09,499 --> 00:09:13,009
analysis and vector similarity<font color="#CCCCCC"> so Lee</font>

280
00:09:12,079 --> 00:09:16,040
<font color="#CCCCCC">holmes</font><font color="#E5E5E5"> was one of the original</font>

281
00:09:13,009 --> 00:09:17,930
<font color="#E5E5E5">developers on the PowerShell team</font><font color="#CCCCCC"> and he</font>

282
00:09:16,040 --> 00:09:19,490
actually<font color="#E5E5E5"> wrote a blog post</font><font color="#CCCCCC"> on last year</font>

283
00:09:17,930 --> 00:09:20,899
after<font color="#CCCCCC"> our</font><font color="#E5E5E5"> least</font><font color="#CCCCCC"> Invo confiscation</font>

284
00:09:19,490 --> 00:09:22,999
highlighting how you could detect that

285
00:09:20,899 --> 00:09:25,100
<font color="#CCCCCC">kind of</font><font color="#E5E5E5"> off you skating with frequency</font>

286
00:09:22,999 --> 00:09:26,569
analysis<font color="#E5E5E5"> and this actually led</font><font color="#CCCCCC"> to some</font>

287
00:09:25,100 --> 00:09:28,610
good conversations<font color="#E5E5E5"> between me and him</font>

288
00:09:26,569 --> 00:09:31,459
and eventually<font color="#CCCCCC"> turned into</font><font color="#E5E5E5"> a proposal</font>

289
00:09:28,610 --> 00:09:33,350
for a<font color="#E5E5E5"> project</font><font color="#CCCCCC"> that we actually</font><font color="#E5E5E5"> did and</font>

290
00:09:31,459 --> 00:09:35,388
put together and release<font color="#CCCCCC"> just a month</font>

291
00:09:33,350 --> 00:09:37,160
ago<font color="#E5E5E5"> at black hat</font><font color="#CCCCCC"> and DEF CON</font><font color="#E5E5E5"> called repo</font>

292
00:09:35,389 --> 00:09:42,319
<font color="#E5E5E5">confiscation which I'll be talking about</font>

293
00:09:37,160 --> 00:09:44,269
on<font color="#E5E5E5"> Friday so the new stuff more cryptic</font>

294
00:09:42,319 --> 00:09:45,800
cradles first of all this is the

295
00:09:44,269 --> 00:09:47,329
<font color="#E5E5E5">spelling of more I guess it's a more</font>

296
00:09:45,800 --> 00:09:49,248
<font color="#E5E5E5">plush</font><font color="#CCCCCC"> drawer</font><font color="#E5E5E5"> I didn't know that when I</font>

297
00:09:47,329 --> 00:09:51,290
first<font color="#E5E5E5"> came</font><font color="#CCCCCC"> across it so</font><font color="#E5E5E5"> also a good</font>

298
00:09:49,249 --> 00:09:52,490
excuse<font color="#CCCCCC"> to put a</font><font color="#E5E5E5"> cat picture in there um</font>

299
00:09:51,290 --> 00:09:55,219
so the kind<font color="#CCCCCC"> of</font><font color="#E5E5E5"> three things we'll look</font>

300
00:09:52,490 --> 00:09:58,160
at first is um<font color="#E5E5E5"> in security by obscurity</font>

301
00:09:55,220 --> 00:10:01,009
I say so<font color="#CCCCCC"> they're</font><font color="#E5E5E5"> obscured download</font>

302
00:09:58,160 --> 00:10:02,240
cradles syntax that without off you see

303
00:10:01,009 --> 00:10:04,910
<font color="#CCCCCC">Asian that</font><font color="#E5E5E5"> a lot of defenders</font><font color="#CCCCCC"> aren't</font>

304
00:10:02,240 --> 00:10:05,990
looking<font color="#CCCCCC"> for like IWR</font><font color="#E5E5E5"> which is an alias</font>

305
00:10:04,910 --> 00:10:07,939
for<font color="#E5E5E5"> in both web</font><font color="#CCCCCC"> request</font>

306
00:10:05,990 --> 00:10:09,439
now<font color="#CCCCCC"> I'm granted it's only PowerShell</font>

307
00:10:07,939 --> 00:10:11,809
<font color="#CCCCCC">three and</font><font color="#E5E5E5"> later but attackers are</font>

308
00:10:09,439 --> 00:10:13,670
already<font color="#E5E5E5"> using this next we'll look at</font>

309
00:10:11,809 --> 00:10:15,290
obscure<font color="#CCCCCC"> token office casein so again</font>

310
00:10:13,670 --> 00:10:17,149
<font color="#E5E5E5">invoke</font><font color="#CCCCCC"> cradle crafter a few</font><font color="#E5E5E5"> skates</font>

311
00:10:15,290 --> 00:10:18,559
entirely differently<font color="#CCCCCC"> than a mocha coffee</font>

312
00:10:17,149 --> 00:10:20,839
station and we'll<font color="#E5E5E5"> take a command like</font>

313
00:10:18,559 --> 00:10:23,059
this and turn it<font color="#E5E5E5"> into something</font><font color="#CCCCCC"> like</font>

314
00:10:20,839 --> 00:10:26,509
<font color="#CCCCCC">that all without</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> single tick</font><font color="#E5E5E5"> Mart</font>

315
00:10:23,059 --> 00:10:28,279
without a single concatenation<font color="#CCCCCC"> and then</font>

316
00:10:26,509 --> 00:10:31,100
obscure invocation<font color="#CCCCCC"> syntaxes</font><font color="#E5E5E5"> we'll take a</font>

317
00:10:28,279 --> 00:10:32,899
look at that<font color="#E5E5E5"> as well so I've broken</font><font color="#CCCCCC"> out</font>

318
00:10:31,100 --> 00:10:35,029
the cradles<font color="#E5E5E5"> into</font><font color="#CCCCCC"> disc based and memory</font>

319
00:10:32,899 --> 00:10:36,920
base and this base is often overlooked

320
00:10:35,029 --> 00:10:38,269
<font color="#E5E5E5">because I'm usually it's stupid</font>

321
00:10:36,920 --> 00:10:39,439
commodity malware<font color="#CCCCCC"> that's downloading</font>

322
00:10:38,269 --> 00:10:41,360
stuff<font color="#E5E5E5"> to app data it's just an</font>

323
00:10:39,439 --> 00:10:42,589
executable<font color="#E5E5E5"> but there's some</font><font color="#CCCCCC"> interesting</font>

324
00:10:41,360 --> 00:10:44,569
places<font color="#E5E5E5"> you could download something to</font>

325
00:10:42,589 --> 00:10:45,709
disk and<font color="#E5E5E5"> get some benefit out of like if</font>

326
00:10:44,569 --> 00:10:47,959
you're downloading power code and

327
00:10:45,709 --> 00:10:50,479
download<font color="#E5E5E5"> it to</font><font color="#CCCCCC"> the profile just the</font>

328
00:10:47,959 --> 00:10:52,699
thought<font color="#E5E5E5"> so download file bits admin and</font>

329
00:10:50,480 --> 00:10:55,040
the start bits transfer<font color="#CCCCCC"> was</font><font color="#E5E5E5"> the three</font>

330
00:10:52,699 --> 00:10:56,359
<font color="#E5E5E5">options currently in there bits</font><font color="#CCCCCC"> you</font>

331
00:10:55,040 --> 00:10:57,649
might want to keep in<font color="#CCCCCC"> mind there are</font>

332
00:10:56,360 --> 00:10:58,970
certain settings on the server you're

333
00:10:57,649 --> 00:11:00,649
downloading from it has to return<font color="#CCCCCC"> the</font>

334
00:10:58,970 --> 00:11:03,139
size of the file just<font color="#CCCCCC"> because of how</font>

335
00:11:00,649 --> 00:11:04,370
bits works<font color="#E5E5E5"> so sometimes you'll get an</font>

336
00:11:03,139 --> 00:11:05,360
error<font color="#CCCCCC"> like this depending on where</font>

337
00:11:04,370 --> 00:11:06,950
you're hosting your<font color="#E5E5E5"> payload to</font>

338
00:11:05,360 --> 00:11:08,720
definitely<font color="#E5E5E5"> want to check</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> out</font>

339
00:11:06,950 --> 00:11:10,910
fun fact about bits and you'll see the

340
00:11:08,720 --> 00:11:12,889
clm shield<font color="#E5E5E5"> that stands for constrained</font>

341
00:11:10,910 --> 00:11:14,420
language mode which is<font color="#E5E5E5"> option you can</font>

342
00:11:12,889 --> 00:11:16,519
have in later<font color="#E5E5E5"> versions of</font><font color="#CCCCCC"> powershell to</font>

343
00:11:14,420 --> 00:11:18,740
basically<font color="#E5E5E5"> lock down the available</font>

344
00:11:16,519 --> 00:11:21,950
commands<font color="#E5E5E5"> and these both work and</font>

345
00:11:18,740 --> 00:11:24,290
<font color="#E5E5E5">constrain language mode so it's again</font>

346
00:11:21,950 --> 00:11:25,850
even though you have<font color="#E5E5E5"> CLM in place let's</font>

347
00:11:24,290 --> 00:11:29,540
say<font color="#CCCCCC"> there still</font><font color="#E5E5E5"> ways to download content</font>

348
00:11:25,850 --> 00:11:32,449
in PowerShell<font color="#E5E5E5"> and</font><font color="#CCCCCC"> now these</font><font color="#E5E5E5"> are</font><font color="#CCCCCC"> the</font>

349
00:11:29,540 --> 00:11:33,709
memory<font color="#CCCCCC"> based cradles so download string</font>

350
00:11:32,449 --> 00:11:36,399
again this is the<font color="#E5E5E5"> most common one that</font>

351
00:11:33,709 --> 00:11:38,268
we see<font color="#E5E5E5"> attackers using it returns the</font>

352
00:11:36,399 --> 00:11:39,860
<font color="#E5E5E5">returns the remote payload as an</font>

353
00:11:38,269 --> 00:11:42,290
expression<font color="#E5E5E5"> typically to be invoked</font><font color="#CCCCCC"> in</font>

354
00:11:39,860 --> 00:11:44,089
memory download data and open<font color="#CCCCCC"> to read</font>

355
00:11:42,290 --> 00:11:46,189
these<font color="#CCCCCC"> return as a byte array</font><font color="#E5E5E5"> and then a</font>

356
00:11:44,089 --> 00:11:49,430
byte stream and so those will<font color="#CCCCCC"> work just</font>

357
00:11:46,190 --> 00:11:52,339
<font color="#CCCCCC">fine in in memory you just</font><font color="#E5E5E5"> have to</font>

358
00:11:49,430 --> 00:11:53,779
convert them<font color="#E5E5E5"> appropriately invoke web</font>

359
00:11:52,339 --> 00:11:55,639
<font color="#CCCCCC">requests and invoke rest method these</font>

360
00:11:53,779 --> 00:11:56,899
<font color="#CCCCCC">are both PowerShell 300 and later and</font>

361
00:11:55,639 --> 00:11:58,850
you'll see<font color="#CCCCCC"> on the tool anything that has</font>

362
00:11:56,899 --> 00:12:00,740
stipulations like<font color="#E5E5E5"> PowerShell 3 or later</font>

363
00:11:58,850 --> 00:12:03,320
<font color="#CCCCCC">I haven't like bright red letter so that</font>

364
00:12:00,740 --> 00:12:05,329
you know<font color="#CCCCCC"> exactly where</font><font color="#E5E5E5"> it won't work if</font>

365
00:12:03,320 --> 00:12:07,459
you<font color="#CCCCCC"> want to use that option</font><font color="#E5E5E5"> but these</font>

366
00:12:05,329 --> 00:12:09,138
are both also functioning a hundred

367
00:12:07,459 --> 00:12:12,229
percent<font color="#E5E5E5"> in</font><font color="#CCCCCC"> constrained language mode as</font>

368
00:12:09,139 --> 00:12:13,940
well you can<font color="#E5E5E5"> also just</font><font color="#CCCCCC"> straight-up call</font>

369
00:12:12,230 --> 00:12:15,740
dotnet classes in PowerShell so the net

370
00:12:13,940 --> 00:12:18,170
HTTP web request that's an option<font color="#E5E5E5"> I have</font>

371
00:12:15,740 --> 00:12:20,510
in there<font color="#E5E5E5"> sim keys so if you're an</font>

372
00:12:18,170 --> 00:12:21,979
attacker<font color="#E5E5E5"> and you open up notepad then</font>

373
00:12:20,510 --> 00:12:22,760
<font color="#E5E5E5">you go to open a file and</font><font color="#CCCCCC"> instead of</font>

374
00:12:21,980 --> 00:12:25,550
<font color="#CCCCCC">putting a file name</font>

375
00:12:22,760 --> 00:12:27,709
you just put a URL<font color="#E5E5E5"> say</font><font color="#CCCCCC"> to like github</font>

376
00:12:25,550 --> 00:12:29,990
<font color="#CCCCCC">mini cats um</font><font color="#E5E5E5"> it'll actually go fetch</font>

377
00:12:27,709 --> 00:12:32,329
your payload for you<font color="#CCCCCC"> and</font><font color="#E5E5E5"> this is really</font>

378
00:12:29,990 --> 00:12:32,480
any Windows application that has you

379
00:12:32,329 --> 00:12:34,819
know

380
00:12:32,480 --> 00:12:36,649
file open<font color="#CCCCCC"> GUI and so you can automate</font>

381
00:12:34,820 --> 00:12:38,480
<font color="#E5E5E5">that with a</font><font color="#CCCCCC"> sync ease class</font><font color="#E5E5E5"> and actually</font>

382
00:12:36,649 --> 00:12:41,329
have it<font color="#CCCCCC"> open up</font><font color="#E5E5E5"> notepad send control o</font>

383
00:12:38,480 --> 00:12:42,980
to open control or you know type of keys

384
00:12:41,329 --> 00:12:44,510
<font color="#E5E5E5">or URL hit enter wait a few seconds</font>

385
00:12:42,980 --> 00:12:46,130
control a to select all<font color="#CCCCCC"> control C to</font>

386
00:12:44,510 --> 00:12:47,810
copy and then<font color="#E5E5E5"> back in PowerShell rip it</font>

387
00:12:46,130 --> 00:12:49,250
out of<font color="#E5E5E5"> the clipboard</font><font color="#CCCCCC"> and invoke it</font><font color="#E5E5E5"> in</font>

388
00:12:47,810 --> 00:12:54,229
PowerShell never makes a network

389
00:12:49,250 --> 00:12:56,630
connection notepad does<font color="#CCCCCC"> calm objects</font><font color="#E5E5E5"> so</font>

390
00:12:54,230 --> 00:12:58,160
I'm more like<font color="#E5E5E5"> you hope that</font><font color="#CCCCCC"> most users</font>

391
00:12:56,630 --> 00:12:59,959
<font color="#E5E5E5">would see if notepads flying up even</font>

392
00:12:58,160 --> 00:13:02,000
though this code actually<font color="#E5E5E5"> pushes it off</font>

393
00:12:59,959 --> 00:13:03,529
the screen<font color="#CCCCCC"> the file open prop will still</font>

394
00:13:02,000 --> 00:13:04,730
pop up so hopefully<font color="#E5E5E5"> users would</font><font color="#CCCCCC"> see this</font>

395
00:13:03,529 --> 00:13:06,560
is weird<font color="#CCCCCC"> like maybe I should do</font>

396
00:13:04,730 --> 00:13:08,060
<font color="#E5E5E5">something about this so a clear way</font><font color="#CCCCCC"> to</font>

397
00:13:06,560 --> 00:13:09,560
do this<font color="#CCCCCC"> to</font><font color="#E5E5E5"> push off your remote</font>

398
00:13:08,060 --> 00:13:10,699
connections to another binary<font color="#E5E5E5"> would be</font>

399
00:13:09,560 --> 00:13:12,138
through something like<font color="#E5E5E5"> calm objects</font>

400
00:13:10,699 --> 00:13:14,300
where<font color="#E5E5E5"> you can push it off</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> win</font><font color="#CCCCCC"> Word</font>

401
00:13:12,139 --> 00:13:15,470
<font color="#CCCCCC">Excel internet explorer so notepad</font><font color="#E5E5E5"> in</font>

402
00:13:14,300 --> 00:13:18,199
making a network<font color="#E5E5E5"> connection should</font><font color="#CCCCCC"> be</font>

403
00:13:15,470 --> 00:13:19,550
like a pretty big red flag but what

404
00:13:18,199 --> 00:13:20,089
about<font color="#CCCCCC"> Internet Explorer making</font><font color="#E5E5E5"> in</font><font color="#CCCCCC"> that</font>

405
00:13:19,550 --> 00:13:22,550
<font color="#E5E5E5">work connects</font>

406
00:13:20,090 --> 00:13:24,080
that's par<font color="#CCCCCC"> for the course</font><font color="#E5E5E5"> so there's a</font>

407
00:13:22,550 --> 00:13:25,370
lot of sneaky ways that you can use

408
00:13:24,080 --> 00:13:27,050
other binaries to do your dirty<font color="#CCCCCC"> work for</font>

409
00:13:25,370 --> 00:13:29,480
you

410
00:13:27,050 --> 00:13:32,449
<font color="#E5E5E5">inline scripting so PowerShell supports</font>

411
00:13:29,480 --> 00:13:34,220
inline scripts primarily c-sharp<font color="#E5E5E5"> visual</font>

412
00:13:32,450 --> 00:13:36,650
basic<font color="#E5E5E5"> and jscript and a few versions of</font>

413
00:13:34,220 --> 00:13:39,350
<font color="#E5E5E5">c-sharp</font><font color="#CCCCCC"> so what that means is that you</font>

414
00:13:36,650 --> 00:13:42,230
can<font color="#E5E5E5"> just put in c-sharp code</font><font color="#CCCCCC"> as a string</font>

415
00:13:39,350 --> 00:13:44,240
let's say and then<font color="#E5E5E5"> use this</font><font color="#CCCCCC"> add type now</font>

416
00:13:42,230 --> 00:13:45,320
this is actually<font color="#CCCCCC"> quite noisy</font><font color="#E5E5E5"> but I don't</font>

417
00:13:44,240 --> 00:13:46,940
know if attackers just don't know that

418
00:13:45,320 --> 00:13:48,710
<font color="#CCCCCC">or if they just don't</font><font color="#E5E5E5"> care because they</font>

419
00:13:46,940 --> 00:13:50,690
use<font color="#E5E5E5"> it a lot particularly attackers will</font>

420
00:13:48,710 --> 00:13:53,180
use they'll basically<font color="#E5E5E5"> create a c-sharp</font>

421
00:13:50,690 --> 00:13:55,520
<font color="#E5E5E5">shell code loader</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> then just compile</font>

422
00:13:53,180 --> 00:13:57,469
it on<font color="#E5E5E5"> the fly now what this does is it</font>

423
00:13:55,520 --> 00:13:59,210
<font color="#CCCCCC">actually</font><font color="#E5E5E5"> PowerShell when it when you run</font>

424
00:13:57,470 --> 00:14:01,430
the ad type command<font color="#E5E5E5"> on your target</font>

425
00:13:59,210 --> 00:14:03,860
system it will then run<font color="#CCCCCC"> CSE to</font><font color="#E5E5E5"> Kampala</font>

426
00:14:01,430 --> 00:14:05,239
<font color="#CCCCCC">and then that will call CBT res and</font>

427
00:14:03,860 --> 00:14:06,380
<font color="#E5E5E5">there's a lot of artifacts that are</font><font color="#CCCCCC"> left</font>

428
00:14:05,240 --> 00:14:09,530
behind<font color="#E5E5E5"> which we'll talk</font><font color="#CCCCCC"> about in the</font>

429
00:14:06,380 --> 00:14:11,210
<font color="#CCCCCC">next section</font><font color="#E5E5E5"> Visual Basic is very</font>

430
00:14:09,530 --> 00:14:15,770
similar<font color="#CCCCCC"> it'll launch of BBC instead of</font>

431
00:14:11,210 --> 00:14:16,940
CSE which is a lot less<font color="#E5E5E5"> common</font><font color="#CCCCCC"> or if you</font>

432
00:14:15,770 --> 00:14:18,079
don't<font color="#CCCCCC"> want all</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> stuff happening on</font>

433
00:14:16,940 --> 00:14:19,640
<font color="#E5E5E5">your target system if you</font><font color="#CCCCCC"> want to be a</font>

434
00:14:18,080 --> 00:14:22,040
little cleaner<font color="#E5E5E5"> you can</font><font color="#CCCCCC"> just</font><font color="#E5E5E5"> on your</font>

435
00:14:19,640 --> 00:14:23,990
attacker system do the<font color="#CCCCCC"> exact same</font><font color="#E5E5E5"> thing</font>

436
00:14:22,040 --> 00:14:25,370
and<font color="#CCCCCC"> just compile that</font><font color="#E5E5E5"> sucker and then</font>

437
00:14:23,990 --> 00:14:26,690
take<font color="#E5E5E5"> it in</font><font color="#CCCCCC"> a byte stream and then run</font>

438
00:14:25,370 --> 00:14:30,500
that<font color="#E5E5E5"> byte stream and load it directly</font>

439
00:14:26,690 --> 00:14:33,380
using using this reflection assembly

440
00:14:30,500 --> 00:14:35,090
load method<font color="#E5E5E5"> and then none of</font><font color="#CCCCCC"> that noisy</font>

441
00:14:33,380 --> 00:14:37,580
stuff happens<font color="#E5E5E5"> on the target system now</font>

442
00:14:35,090 --> 00:14:38,660
the interesting<font color="#CCCCCC"> thing is that</font><font color="#E5E5E5"> so if</font>

443
00:14:37,580 --> 00:14:40,580
you've played<font color="#E5E5E5"> around with</font><font color="#CCCCCC"> powershell</font>

444
00:14:38,660 --> 00:14:42,709
<font color="#E5E5E5">blogging you do things like creating</font>

445
00:14:40,580 --> 00:14:45,050
that net<font color="#CCCCCC"> dot web client class and run</font>

446
00:14:42,710 --> 00:14:48,050
<font color="#CCCCCC">download string</font><font color="#E5E5E5"> then that will show up</font>

447
00:14:45,050 --> 00:14:50,510
in<font color="#CCCCCC"> PowerShell</font><font color="#E5E5E5"> logs however if you</font><font color="#CCCCCC"> are</font>

448
00:14:48,050 --> 00:14:52,310
doing<font color="#E5E5E5"> that from a C sharp</font><font color="#CCCCCC"> or</font><font color="#E5E5E5"> VB script</font>

449
00:14:50,510 --> 00:14:55,100
application even<font color="#E5E5E5"> if it's running inside</font>

450
00:14:52,310 --> 00:14:57,199
<font color="#E5E5E5">of PowerShell that logging never happens</font>

451
00:14:55,100 --> 00:14:58,820
in PowerShell logs<font color="#E5E5E5"> so there are some</font>

452
00:14:57,200 --> 00:15:01,160
advantages<font color="#CCCCCC"> as some attackers to do that</font>

453
00:14:58,820 --> 00:15:03,200
<font color="#E5E5E5">so again</font><font color="#CCCCCC"> I say this</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> word offenders</font>

454
00:15:01,160 --> 00:15:04,790
for perspective don't<font color="#E5E5E5"> count on those</font>

455
00:15:03,200 --> 00:15:06,620
<font color="#E5E5E5">always showing up in logs because if an</font>

456
00:15:04,790 --> 00:15:10,030
attacker is hosting inside of PowerShell

457
00:15:06,620 --> 00:15:13,040
<font color="#E5E5E5">in another application</font><font color="#CCCCCC"> then you're hosed</font>

458
00:15:10,030 --> 00:15:14,209
<font color="#E5E5E5">so how is the office station and cradle</font>

459
00:15:13,040 --> 00:15:19,670
<font color="#CCCCCC">craft are different than</font><font color="#E5E5E5"> in</font><font color="#CCCCCC"> BO coffee</font>

460
00:15:14,210 --> 00:15:22,520
<font color="#CCCCCC">station so</font><font color="#E5E5E5"> download string</font><font color="#CCCCCC"> one way</font><font color="#E5E5E5"> that</font>

461
00:15:19,670 --> 00:15:24,140
we can<font color="#E5E5E5"> basically there's ways an</font>

462
00:15:22,520 --> 00:15:25,730
<font color="#E5E5E5">invocation that all you need to do is</font>

463
00:15:24,140 --> 00:15:27,380
treat that as a string<font color="#E5E5E5"> and that's how we</font>

464
00:15:25,730 --> 00:15:29,360
do<font color="#E5E5E5"> the concatenation</font><font color="#CCCCCC"> and reordering and</font>

465
00:15:27,380 --> 00:15:31,490
stuff like<font color="#E5E5E5"> that well there's other ways</font>

466
00:15:29,360 --> 00:15:33,310
<font color="#CCCCCC">to get the string download string</font>

467
00:15:31,490 --> 00:15:34,840
<font color="#CCCCCC">without ever specifying it so</font>

468
00:15:33,310 --> 00:15:36,760
for example we can just<font color="#E5E5E5"> say new object</font>

469
00:15:34,840 --> 00:15:38,710
<font color="#CCCCCC">net-net</font><font color="#E5E5E5"> web plant show me all the</font>

470
00:15:36,760 --> 00:15:40,060
objects<font color="#E5E5E5"> that are out there dot PS object</font>

471
00:15:38,710 --> 00:15:41,529
dot methods or show me all the<font color="#E5E5E5"> methods</font>

472
00:15:40,060 --> 00:15:42,939
<font color="#CCCCCC">that</font><font color="#E5E5E5"> are</font><font color="#CCCCCC"> out there for</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> object</font><font color="#E5E5E5"> you</font>

473
00:15:41,529 --> 00:15:44,470
<font color="#CCCCCC">can do something similar with get member</font>

474
00:15:42,940 --> 00:15:45,730
when both of<font color="#CCCCCC"> those are options on</font><font color="#E5E5E5"> the</font>

475
00:15:44,470 --> 00:15:47,500
tool that<font color="#E5E5E5"> will just stick with the first</font>

476
00:15:45,730 --> 00:15:49,630
<font color="#E5E5E5">one for now and see I'll see it has all</font>

477
00:15:47,500 --> 00:15:51,790
the overloaded definitions<font color="#E5E5E5"> what we can</font>

478
00:15:49,630 --> 00:15:53,020
do is we can<font color="#CCCCCC"> just say yeah I just only</font>

479
00:15:51,790 --> 00:15:55,569
care<font color="#CCCCCC"> about the one where the name</font><font color="#E5E5E5"> is</font>

480
00:15:53,020 --> 00:15:58,029
light download string and then we can

481
00:15:55,570 --> 00:15:59,740
just<font color="#CCCCCC"> use wildcards</font><font color="#E5E5E5"> or don't grab the</font>

482
00:15:58,029 --> 00:16:02,050
name<font color="#CCCCCC"> out of that to get</font><font color="#E5E5E5"> that string</font><font color="#CCCCCC"> so</font>

483
00:15:59,740 --> 00:16:03,730
<font color="#E5E5E5">we can also just use wildcards like this</font>

484
00:16:02,050 --> 00:16:05,620
this is a screenshot of<font color="#CCCCCC"> some of the code</font>

485
00:16:03,730 --> 00:16:09,460
any of those<font color="#E5E5E5"> wildcards will work they</font>

486
00:16:05,620 --> 00:16:10,810
will only return<font color="#E5E5E5"> download string so this</font>

487
00:16:09,460 --> 00:16:13,660
<font color="#E5E5E5">is now gonna return the string download</font>

488
00:16:10,810 --> 00:16:15,520
string so<font color="#E5E5E5"> we plug that in and</font><font color="#CCCCCC"> that dot</font>

489
00:16:13,660 --> 00:16:17,230
invoke is<font color="#E5E5E5"> only necessary</font><font color="#CCCCCC"> and PowerShell</font>

490
00:16:15,520 --> 00:16:18,279
<font color="#CCCCCC">too but I include it in there so it</font>

491
00:16:17,230 --> 00:16:21,100
works on whatever<font color="#CCCCCC"> PowerShell version</font>

492
00:16:18,279 --> 00:16:23,290
you're running<font color="#CCCCCC"> this payload on next is</font>

493
00:16:21,100 --> 00:16:25,390
new object and<font color="#E5E5E5"> so again we can say get</font>

494
00:16:23,290 --> 00:16:26,980
<font color="#E5E5E5">command new object</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> get command</font>

495
00:16:25,390 --> 00:16:30,730
<font color="#E5E5E5">actually has PowerShell object being</font>

496
00:16:26,980 --> 00:16:33,130
returned but you can invoke it<font color="#E5E5E5"> with a</font>

497
00:16:30,730 --> 00:16:35,410
dot or ampersand and it will<font color="#CCCCCC"> actually</font>

498
00:16:33,130 --> 00:16:38,080
invoke<font color="#CCCCCC"> that object</font><font color="#E5E5E5"> which is the same as</font>

499
00:16:35,410 --> 00:16:39,880
<font color="#E5E5E5">running new object and so we can</font>

500
00:16:38,080 --> 00:16:42,220
<font color="#CCCCCC">rainwear random</font><font color="#E5E5E5"> would shoes get</font>

501
00:16:39,880 --> 00:16:44,200
commander one<font color="#E5E5E5"> of its aliases</font><font color="#CCCCCC"> it'll see</font>

502
00:16:42,220 --> 00:16:45,940
use<font color="#CCCCCC"> a command because</font><font color="#E5E5E5"> PowerShell</font>

503
00:16:44,200 --> 00:16:47,770
automatically<font color="#CCCCCC"> prepends get -</font><font color="#E5E5E5"> to anything</font>

504
00:16:45,940 --> 00:16:50,260
if it's also a<font color="#E5E5E5"> command line name fun</font>

505
00:16:47,770 --> 00:16:51,730
fact<font color="#CCCCCC"> for</font><font color="#E5E5E5"> a new object will</font><font color="#CCCCCC"> defer and we</font>

506
00:16:50,260 --> 00:16:54,220
select one of these<font color="#E5E5E5"> wild carded fields</font>

507
00:16:51,730 --> 00:16:55,870
<font color="#E5E5E5">and now this is a new object now</font>

508
00:16:54,220 --> 00:16:57,490
interesting part is since we off<font color="#CCCCCC"> use get</font>

509
00:16:55,870 --> 00:16:59,620
a<font color="#E5E5E5"> download string we also introduced a</font>

510
00:16:57,490 --> 00:17:02,200
second new object into our command<font color="#CCCCCC"> so</font>

511
00:16:59,620 --> 00:17:03,940
<font color="#CCCCCC">i've handled all these via tags</font><font color="#E5E5E5"> in the</font>

512
00:17:02,200 --> 00:17:05,860
code<font color="#E5E5E5"> so</font><font color="#CCCCCC"> that now</font><font color="#E5E5E5"> whenever you update a</font>

513
00:17:03,940 --> 00:17:08,290
new<font color="#CCCCCC"> object</font><font color="#E5E5E5"> it'll up</font><font color="#CCCCCC"> lit it'll</font><font color="#E5E5E5"> update</font><font color="#CCCCCC"> all</font>

514
00:17:05,859 --> 00:17:12,069
the<font color="#CCCCCC"> new objects in</font><font color="#E5E5E5"> the code even if one</font>

515
00:17:08,290 --> 00:17:13,449
is introduced<font color="#E5E5E5"> later this is also just a</font>

516
00:17:12,069 --> 00:17:16,688
random<font color="#CCCCCC"> powershell one that</font><font color="#E5E5E5"> has syntax</font>

517
00:17:13,449 --> 00:17:18,550
for also running<font color="#E5E5E5"> new object and it's</font>

518
00:17:16,689 --> 00:17:20,740
it's<font color="#E5E5E5"> pretty crazy you can see this</font>

519
00:17:18,550 --> 00:17:23,980
bottom<font color="#E5E5E5"> part is aji this is actually</font><font color="#CCCCCC"> i'm</font>

520
00:17:20,740 --> 00:17:27,220
get command name and this in<font color="#CCCCCC"> astro CT is</font>

521
00:17:23,980 --> 00:17:28,900
a new object now there are a<font color="#E5E5E5"> lot of</font>

522
00:17:27,220 --> 00:17:30,010
<font color="#CCCCCC">pieces that</font><font color="#E5E5E5"> I just randomly choose</font>

523
00:17:28,900 --> 00:17:33,790
behind the scenes<font color="#E5E5E5"> and there's not as</font>

524
00:17:30,010 --> 00:17:35,950
much access<font color="#CCCCCC"> to</font><font color="#E5E5E5"> change like where object</font>

525
00:17:33,790 --> 00:17:36,940
where question mark stuff like that but

526
00:17:35,950 --> 00:17:38,650
<font color="#CCCCCC">again it's the fenders if you're only</font>

527
00:17:36,940 --> 00:17:41,020
<font color="#E5E5E5">looking for -</font><font color="#CCCCCC"> light there's also</font><font color="#E5E5E5"> see</font>

528
00:17:38,650 --> 00:17:43,270
like and I like for case insensitive<font color="#CCCCCC"> for</font>

529
00:17:41,020 --> 00:17:45,250
case sensitive and case insensitive<font color="#E5E5E5"> so</font>

530
00:17:43,270 --> 00:17:46,379
as you're writing triggers as a defender

531
00:17:45,250 --> 00:17:49,020
make sure you're taking<font color="#CCCCCC"> into</font>

532
00:17:46,380 --> 00:17:50,010
<font color="#E5E5E5">all these options</font><font color="#CCCCCC"> dollars on the</font>

533
00:17:49,020 --> 00:17:51,540
underscore<font color="#E5E5E5"> this is just the current</font>

534
00:17:50,010 --> 00:17:53,790
variable<font color="#E5E5E5"> but as you can see there are a</font>

535
00:17:51,540 --> 00:17:55,920
lot<font color="#CCCCCC"> of ways you can get a variable</font><font color="#E5E5E5"> value</font>

536
00:17:53,790 --> 00:17:57,300
dollar sign underscore is a great

537
00:17:55,920 --> 00:17:59,460
indicator in a lot<font color="#E5E5E5"> of cases but there's</font>

538
00:17:57,300 --> 00:18:02,280
totally waste<font color="#E5E5E5"> around</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> and these are</font>

539
00:17:59,460 --> 00:18:04,890
all options in the tool<font color="#E5E5E5"> invoke</font>

540
00:18:02,280 --> 00:18:06,720
expression<font color="#E5E5E5"> leads to our third section</font>

541
00:18:04,890 --> 00:18:09,300
all<font color="#CCCCCC"> the obscure</font><font color="#E5E5E5"> implications and taxes</font>

542
00:18:06,720 --> 00:18:09,750
so IX<font color="#E5E5E5"> everyone uses that won't talk</font>

543
00:18:09,300 --> 00:18:12,780
about<font color="#CCCCCC"> it</font>

544
00:18:09,750 --> 00:18:15,690
um you can get<font color="#E5E5E5"> IEX through get alias</font><font color="#CCCCCC"> or</font>

545
00:18:12,780 --> 00:18:17,430
get<font color="#E5E5E5"> command like you see here</font><font color="#CCCCCC"> powershell</font>

546
00:18:15,690 --> 00:18:19,800
<font color="#E5E5E5">one that</font><font color="#CCCCCC"> oh we</font><font color="#E5E5E5"> also have get commandlets</font>

547
00:18:17,430 --> 00:18:21,210
<font color="#CCCCCC">two basically</font><font color="#E5E5E5"> also get invoke expression</font>

548
00:18:19,800 --> 00:18:23,060
or<font color="#E5E5E5"> we can just use the invoke script</font>

549
00:18:21,210 --> 00:18:26,310
<font color="#CCCCCC">method which will handle both</font>

550
00:18:23,060 --> 00:18:27,990
expressions<font color="#E5E5E5"> or script</font><font color="#CCCCCC"> blocks um</font>

551
00:18:26,310 --> 00:18:29,399
invoke command which requires script

552
00:18:27,990 --> 00:18:30,900
blocks not an<font color="#E5E5E5"> expression but we can</font>

553
00:18:29,400 --> 00:18:33,240
convert expressions<font color="#E5E5E5"> to script blocks</font>

554
00:18:30,900 --> 00:18:34,890
which is all handled<font color="#E5E5E5"> in the project</font><font color="#CCCCCC"> you</font>

555
00:18:33,240 --> 00:18:36,930
<font color="#CCCCCC">can</font><font color="#E5E5E5"> also just create a PS run space add</font>

556
00:18:34,890 --> 00:18:38,430
your code then<font color="#E5E5E5"> invoke it i'm</font>

557
00:18:36,930 --> 00:18:40,140
concatenated<font color="#E5E5E5"> IX</font><font color="#CCCCCC"> this is definitely</font><font color="#E5E5E5"> the</font>

558
00:18:38,430 --> 00:18:42,150
craziest<font color="#E5E5E5"> one so let me come back</font><font color="#CCCCCC"> to it</font>

559
00:18:40,140 --> 00:18:43,470
in<font color="#CCCCCC"> just one second</font><font color="#E5E5E5"> the last three invoke</font>

560
00:18:42,150 --> 00:18:44,910
its workflow<font color="#E5E5E5"> this is introduced in</font>

561
00:18:43,470 --> 00:18:47,100
powershell<font color="#CCCCCC"> 3</font><font color="#E5E5E5"> i've actually never seen</font>

562
00:18:44,910 --> 00:18:48,510
this one used in the<font color="#CCCCCC"> wild but i'm hoping</font>

563
00:18:47,100 --> 00:18:50,909
one day<font color="#CCCCCC"> i will because it's kind of</font>

564
00:18:48,510 --> 00:18:53,370
fascinating<font color="#CCCCCC"> the last</font><font color="#E5E5E5"> two are only for</font>

565
00:18:50,910 --> 00:18:56,280
<font color="#CCCCCC">web-based or not web-based disk based</font>

566
00:18:53,370 --> 00:18:58,919
cradles<font color="#E5E5E5"> just</font><font color="#CCCCCC"> dot sourcing</font><font color="#E5E5E5"> your script</font>

567
00:18:56,280 --> 00:19:01,710
<font color="#CCCCCC">more import module which will just</font><font color="#E5E5E5"> run</font>

568
00:18:58,920 --> 00:19:04,710
that code concatenate<font color="#E5E5E5"> an IX so again</font>

569
00:19:01,710 --> 00:19:06,330
this is what this<font color="#E5E5E5"> is as far as</font><font color="#CCCCCC"> i took</font>

570
00:19:04,710 --> 00:19:08,220
this<font color="#E5E5E5"> in invoke off you station</font><font color="#CCCCCC"> before</font>

571
00:19:06,330 --> 00:19:09,659
this<font color="#E5E5E5"> project but another thing</font><font color="#CCCCCC"> that we</font>

572
00:19:08,220 --> 00:19:11,880
<font color="#E5E5E5">can do is instead</font><font color="#CCCCCC"> of always</font><font color="#E5E5E5"> saying</font>

573
00:19:09,660 --> 00:19:13,260
dollar sign<font color="#E5E5E5"> in</font><font color="#CCCCCC"> calm spec</font><font color="#E5E5E5"> we can do</font>

574
00:19:11,880 --> 00:19:16,320
<font color="#E5E5E5">something like this and start</font><font color="#CCCCCC"> to use</font>

575
00:19:13,260 --> 00:19:19,129
these<font color="#CCCCCC"> asterisks to basically retrieve</font>

576
00:19:16,320 --> 00:19:21,689
those<font color="#E5E5E5"> variable values now the last thing</font>

577
00:19:19,130 --> 00:19:23,070
<font color="#E5E5E5">let's</font><font color="#CCCCCC"> say that we take a string in this</font>

578
00:19:21,690 --> 00:19:24,900
<font color="#E5E5E5">case is an empty string it's just two</font>

579
00:19:23,070 --> 00:19:25,980
ticks<font color="#E5E5E5"> and let's pipe it to get member</font>

580
00:19:24,900 --> 00:19:29,160
and say what are all<font color="#E5E5E5"> the members</font><font color="#CCCCCC"> of a</font>

581
00:19:25,980 --> 00:19:31,470
string<font color="#CCCCCC"> one of these is</font><font color="#E5E5E5"> called index of</font>

582
00:19:29,160 --> 00:19:33,990
and conveniently<font color="#CCCCCC"> that name has the</font>

583
00:19:31,470 --> 00:19:37,170
letters<font color="#E5E5E5"> IE and x in it this</font><font color="#CCCCCC"> is looking</font>

584
00:19:33,990 --> 00:19:39,540
interesting so what if what if<font color="#E5E5E5"> i just</font>

585
00:19:37,170 --> 00:19:41,790
<font color="#CCCCCC">say okay string index</font><font color="#E5E5E5"> what are all your</font>

586
00:19:39,540 --> 00:19:44,879
definitions<font color="#E5E5E5"> there's lots of ease lots of</font>

587
00:19:41,790 --> 00:19:46,230
eyes lots of<font color="#CCCCCC"> x's so what i can do is</font><font color="#E5E5E5"> i</font>

588
00:19:44,880 --> 00:19:49,530
can just cast<font color="#E5E5E5"> that to a string now it's</font>

589
00:19:46,230 --> 00:19:51,360
one long string then<font color="#E5E5E5"> i can just</font><font color="#CCCCCC"> say okay</font>

590
00:19:49,530 --> 00:19:53,370
<font color="#CCCCCC">this</font><font color="#E5E5E5"> is 0 with the 7th and the 8th index</font>

591
00:19:51,360 --> 00:19:55,169
is the<font color="#E5E5E5"> letters</font><font color="#CCCCCC"> IE and the</font><font color="#E5E5E5"> x let me grab</font>

592
00:19:53,370 --> 00:19:57,239
those join them back together<font color="#E5E5E5"> and i get</font>

593
00:19:55,170 --> 00:19:58,650
the string<font color="#CCCCCC"> ie x and so then all i have</font>

594
00:19:57,240 --> 00:19:59,760
<font color="#CCCCCC">to</font><font color="#E5E5E5"> do is invoke it and that's invoke</font>

595
00:19:58,650 --> 00:20:01,740
expression and

596
00:19:59,760 --> 00:20:04,200
this is a screenshot of<font color="#E5E5E5"> the code</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> lot</font>

597
00:20:01,740 --> 00:20:06,450
of different methods<font color="#E5E5E5"> index index of any</font>

598
00:20:04,200 --> 00:20:07,830
all that stuff and<font color="#E5E5E5"> then all the random</font>

599
00:20:06,450 --> 00:20:09,270
options that works across all versions

600
00:20:07,830 --> 00:20:11,490
of PowerShell<font color="#E5E5E5"> to produce the strings</font>

601
00:20:09,270 --> 00:20:13,200
<font color="#E5E5E5">eyes and</font><font color="#CCCCCC"> knees and</font><font color="#E5E5E5"> X and again I don't</font>

602
00:20:11,490 --> 00:20:14,490
<font color="#CCCCCC">reduce</font><font color="#E5E5E5"> to be cruel to defenders but I</font>

603
00:20:13,200 --> 00:20:16,620
don't want people<font color="#E5E5E5"> including myself</font>

604
00:20:14,490 --> 00:20:18,930
writing signatures<font color="#CCCCCC"> just looking for 0</font>

605
00:20:16,620 --> 00:20:21,870
comma 7 comma 8 because there's tons<font color="#E5E5E5"> of</font>

606
00:20:18,930 --> 00:20:25,590
<font color="#CCCCCC">different options</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> can use so</font>

607
00:20:21,870 --> 00:20:27,239
how do we<font color="#E5E5E5"> detect this stuff well for</font>

608
00:20:25,590 --> 00:20:28,500
<font color="#E5E5E5">starters we need to think</font><font color="#CCCCCC"> more than just</font>

609
00:20:27,240 --> 00:20:30,030
<font color="#E5E5E5">PowerShell right just look for network</font>

610
00:20:28,500 --> 00:20:31,740
connections in general and a lot<font color="#CCCCCC"> of</font>

611
00:20:30,030 --> 00:20:33,030
<font color="#E5E5E5">these cradles are casting off network</font>

612
00:20:31,740 --> 00:20:36,510
connections for other binaries to do

613
00:20:33,030 --> 00:20:40,440
like<font color="#CCCCCC"> it's</font><font color="#E5E5E5"> bits admin which use</font><font color="#CCCCCC"> SVC</font><font color="#E5E5E5"> host</font>

614
00:20:36,510 --> 00:20:43,110
<font color="#CCCCCC">Windward etc for sim</font><font color="#E5E5E5"> keys a notepad</font>

615
00:20:40,440 --> 00:20:44,460
notepad and SVC host make a lot of

616
00:20:43,110 --> 00:20:46,709
<font color="#E5E5E5">network connections depending on the</font>

617
00:20:44,460 --> 00:20:49,140
size of the<font color="#CCCCCC"> payload parent-child</font>

618
00:20:46,710 --> 00:20:50,820
relationships<font color="#E5E5E5"> um this is still</font><font color="#CCCCCC"> really</font>

619
00:20:49,140 --> 00:20:52,170
valuable<font color="#CCCCCC"> but there's totally</font><font color="#E5E5E5"> tons of</font>

620
00:20:50,820 --> 00:20:53,700
ways to get<font color="#CCCCCC"> around this just from the</font>

621
00:20:52,170 --> 00:20:56,790
<font color="#E5E5E5">simplest one being if an attacker</font>

622
00:20:53,700 --> 00:20:58,020
<font color="#CCCCCC">renamed</font><font color="#E5E5E5"> PowerShell dot XE to food XE and</font>

623
00:20:56,790 --> 00:21:00,180
then runs whatever they want

624
00:20:58,020 --> 00:21:01,770
<font color="#CCCCCC">will your detection is to capture that</font>

625
00:21:00,180 --> 00:21:03,420
<font color="#CCCCCC">they'll all hit the</font><font color="#E5E5E5"> PowerShell logs</font>

626
00:21:01,770 --> 00:21:04,800
<font color="#CCCCCC">depending on the versions</font><font color="#E5E5E5"> of PowerShell</font>

627
00:21:03,420 --> 00:21:06,450
and<font color="#E5E5E5"> if you have that stuff enabled but a</font>

628
00:21:04,800 --> 00:21:08,399
lot<font color="#CCCCCC"> of people are</font><font color="#E5E5E5"> just looking for</font><font color="#CCCCCC"> Excel</font>

629
00:21:06,450 --> 00:21:10,140
spawning<font color="#E5E5E5"> process named</font><font color="#CCCCCC"> powershell</font><font color="#E5E5E5"> exe</font>

630
00:21:08,400 --> 00:21:11,550
and that's<font color="#E5E5E5"> gonna burn you and attackers</font>

631
00:21:10,140 --> 00:21:14,850
are totally renaming stuff before<font color="#CCCCCC"> they'd</font>

632
00:21:11,550 --> 00:21:16,409
run it event logs<font color="#E5E5E5"> besides everything in</font>

633
00:21:14,850 --> 00:21:18,810
<font color="#CCCCCC">powershell</font><font color="#E5E5E5"> and your command line stuff</font>

634
00:21:16,410 --> 00:21:21,050
<font color="#CCCCCC">for example bits has a default it's</font>

635
00:21:18,810 --> 00:21:23,810
actually enabled by default

636
00:21:21,050 --> 00:21:27,240
<font color="#CCCCCC">event logs here you can look look for</font>

637
00:21:23,810 --> 00:21:28,919
<font color="#CCCCCC">dll's being loaded when something's</font>

638
00:21:27,240 --> 00:21:31,110
loading<font color="#E5E5E5"> internet</font><font color="#CCCCCC"> explorer with the com</font>

639
00:21:28,920 --> 00:21:32,910
object<font color="#E5E5E5"> that actually loads ie proxy DLL</font>

640
00:21:31,110 --> 00:21:35,699
<font color="#E5E5E5">which is somewhat usual depending on</font>

641
00:21:32,910 --> 00:21:38,850
your environment<font color="#CCCCCC"> powershell loading</font>

642
00:21:35,700 --> 00:21:40,860
<font color="#CCCCCC">Rassman and razz</font><font color="#E5E5E5"> api 32</font><font color="#CCCCCC"> dll these have</font>

643
00:21:38,850 --> 00:21:42,810
been really really<font color="#E5E5E5"> helpful in some</font>

644
00:21:40,860 --> 00:21:44,370
investigations especially over the<font color="#CCCCCC"> past</font>

645
00:21:42,810 --> 00:21:46,770
year<font color="#E5E5E5"> because what's interesting is that</font>

646
00:21:44,370 --> 00:21:48,600
when<font color="#CCCCCC"> powershell loads these which is the</font>

647
00:21:46,770 --> 00:21:50,250
remote access connection manager<font color="#E5E5E5"> you'll</font>

648
00:21:48,600 --> 00:21:53,250
also see that<font color="#E5E5E5"> in prefetch files but the</font>

649
00:21:50,250 --> 00:21:55,260
coolest<font color="#CCCCCC"> part is that</font><font color="#E5E5E5"> whenever a binary</font>

650
00:21:53,250 --> 00:21:56,790
loads these dll's to make a<font color="#E5E5E5"> network a</font>

651
00:21:55,260 --> 00:21:58,560
successful network<font color="#E5E5E5"> connection it will</font>

652
00:21:56,790 --> 00:22:00,629
<font color="#E5E5E5">create these registry keys these tracing</font>

653
00:21:58,560 --> 00:22:02,190
registry keys which is<font color="#E5E5E5"> just there so you</font>

654
00:22:00,630 --> 00:22:03,540
can basically update information<font color="#E5E5E5"> so</font><font color="#CCCCCC"> I</font>

655
00:22:02,190 --> 00:22:05,700
want to<font color="#E5E5E5"> do full-blown tracing on this</font>

656
00:22:03,540 --> 00:22:08,070
sucker<font color="#E5E5E5"> but what's great is it also shows</font>

657
00:22:05,700 --> 00:22:10,020
<font color="#E5E5E5">the first time that</font><font color="#CCCCCC"> that binary name</font>

658
00:22:08,070 --> 00:22:11,310
made that network connection so in

659
00:22:10,020 --> 00:22:13,340
environments where PowerShell is not

660
00:22:11,310 --> 00:22:15,889
being<font color="#CCCCCC"> used much to download</font><font color="#E5E5E5"> stuff you</font>

661
00:22:13,340 --> 00:22:17,270
these<font color="#E5E5E5"> dll's</font><font color="#CCCCCC"> when</font><font color="#E5E5E5"> certain financial throw</font>

662
00:22:15,890 --> 00:22:19,070
actors go in and that's<font color="#E5E5E5"> basically</font>

663
00:22:17,270 --> 00:22:20,330
exactly<font color="#E5E5E5"> what they use we</font><font color="#CCCCCC"> just start</font>

664
00:22:19,070 --> 00:22:21,740
looking<font color="#CCCCCC"> for systems that</font><font color="#E5E5E5"> have these reg</font>

665
00:22:20,330 --> 00:22:23,419
keys created by a binary called

666
00:22:21,740 --> 00:22:25,580
<font color="#E5E5E5">PowerShell now you could totally rename</font>

667
00:22:23,420 --> 00:22:26,810
PowerShell and<font color="#E5E5E5"> get around this but a lot</font>

668
00:22:25,580 --> 00:22:28,010
<font color="#CCCCCC">of attackers</font><font color="#E5E5E5"> are lazy so this is</font>

669
00:22:26,810 --> 00:22:29,270
actually a really<font color="#E5E5E5"> cool indicator that</font>

670
00:22:28,010 --> 00:22:30,950
<font color="#E5E5E5">we've used in a lot of engagements</font>

671
00:22:29,270 --> 00:22:32,510
remember I was<font color="#E5E5E5"> talking about when</font>

672
00:22:30,950 --> 00:22:35,750
PowerShell load c-sharp<font color="#E5E5E5"> it's really</font>

673
00:22:32,510 --> 00:22:37,760
noisy<font color="#CCCCCC"> it spawns CSC and CBT res those</font>

674
00:22:35,750 --> 00:22:39,950
are all<font color="#E5E5E5"> gonna show up in app compat</font><font color="#CCCCCC"> or</font>

675
00:22:37,760 --> 00:22:41,540
one after<font color="#CCCCCC"> the other so in the same</font>

676
00:22:39,950 --> 00:22:43,400
<font color="#E5E5E5">investigations will see these attackers</font>

677
00:22:41,540 --> 00:22:45,350
happen to use PowerShell<font color="#E5E5E5"> but the first</font>

678
00:22:43,400 --> 00:22:47,120
<font color="#E5E5E5">thing they do is compile c-sharp code</font>

679
00:22:45,350 --> 00:22:48,409
for the<font color="#E5E5E5"> shell code loader so we'll look</font>

680
00:22:47,120 --> 00:22:51,100
for systems where they have at compat

681
00:22:48,410 --> 00:22:54,680
values of<font color="#E5E5E5"> powershell</font><font color="#CCCCCC"> CS c and c bt res</font>

682
00:22:51,100 --> 00:22:56,629
<font color="#E5E5E5">and cache temporary internet files a lot</font>

683
00:22:54,680 --> 00:22:58,640
of these a lot<font color="#CCCCCC"> of these memory cradles</font>

684
00:22:56,630 --> 00:23:00,320
<font color="#E5E5E5">actually do have content hit discs</font>

685
00:22:58,640 --> 00:23:02,420
<font color="#E5E5E5">differ typically in temporary internet</font>

686
00:23:00,320 --> 00:23:04,669
files so it's something to<font color="#E5E5E5"> be mindful of</font>

687
00:23:02,420 --> 00:23:06,890
as defenders it's a good place<font color="#CCCCCC"> to look</font>

688
00:23:04,670 --> 00:23:09,410
<font color="#CCCCCC">especially</font><font color="#E5E5E5"> if you're easily able to run</font>

689
00:23:06,890 --> 00:23:10,550
your<font color="#E5E5E5"> rules or stuff like</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> it's a lot</font>

690
00:23:09,410 --> 00:23:15,440
of attackers aren't going and cleaning

691
00:23:10,550 --> 00:23:18,110
up what hits<font color="#E5E5E5"> disk so I have seven</font>

692
00:23:15,440 --> 00:23:19,520
<font color="#CCCCCC">minutes</font><font color="#E5E5E5"> left for demo my only disclaimer</font>

693
00:23:18,110 --> 00:23:21,110
is that<font color="#CCCCCC"> you please do not</font><font color="#E5E5E5"> use this tool</font>

694
00:23:19,520 --> 00:23:24,520
<font color="#E5E5E5">for evil this is for educational</font>

695
00:23:21,110 --> 00:23:26,750
<font color="#CCCCCC">purposes and if</font><font color="#E5E5E5"> you have consent</font>

696
00:23:24,520 --> 00:23:28,730
<font color="#E5E5E5">explicit</font><font color="#CCCCCC"> written consent</font><font color="#E5E5E5"> from a client</font>

697
00:23:26,750 --> 00:23:30,590
<font color="#CCCCCC">to destroy their environment</font><font color="#E5E5E5"> then</font>

698
00:23:28,730 --> 00:23:32,630
hopefully this<font color="#E5E5E5"> will help you in in your</font>

699
00:23:30,590 --> 00:23:35,090
red team<font color="#E5E5E5"> and hopefully the</font><font color="#CCCCCC"> information</font>

700
00:23:32,630 --> 00:23:36,410
in here<font color="#E5E5E5"> will help you</font><font color="#CCCCCC"> be</font><font color="#E5E5E5"> able to provide</font>

701
00:23:35,090 --> 00:23:40,429
back<font color="#CCCCCC"> to the client to say hey here's</font>

702
00:23:36,410 --> 00:23:44,780
some stuff<font color="#E5E5E5"> you could be looking</font><font color="#CCCCCC"> for so</font>

703
00:23:40,430 --> 00:23:47,570
this<font color="#E5E5E5"> is again all you have to do is just</font>

704
00:23:44,780 --> 00:23:50,020
run import module and then we'll run

705
00:23:47,570 --> 00:23:52,250
<font color="#E5E5E5">into a cradle crafter I like ASCII art</font>

706
00:23:50,020 --> 00:23:54,170
so<font color="#E5E5E5"> this is just a little little fun</font>

707
00:23:52,250 --> 00:23:59,630
sample of actually off you skating<font color="#CCCCCC"> one</font>

708
00:23:54,170 --> 00:24:03,670
of the cradles is<font color="#E5E5E5"> this too</font><font color="#CCCCCC"> big is the</font>

709
00:23:59,630 --> 00:24:03,670
text too big it's a little<font color="#E5E5E5"> large</font>

710
00:24:07,660 --> 00:24:16,090
is that better<font color="#E5E5E5"> all right perfect</font>

711
00:24:12,610 --> 00:24:18,580
so<font color="#E5E5E5"> beyond all the ASCII art stuff</font><font color="#CCCCCC"> I</font>

712
00:24:16,090 --> 00:24:19,990
really like<font color="#E5E5E5"> colors</font><font color="#CCCCCC"> and my projects</font><font color="#E5E5E5"> and</font>

713
00:24:18,580 --> 00:24:22,899
so I try to<font color="#E5E5E5"> make</font><font color="#CCCCCC"> it as</font><font color="#E5E5E5"> user friendly as</font>

714
00:24:19,990 --> 00:24:24,820
<font color="#E5E5E5">possible</font><font color="#CCCCCC"> so anything in yellow</font><font color="#E5E5E5"> will take</font>

715
00:24:22,900 --> 00:24:26,230
you to new<font color="#E5E5E5"> menu so our menu</font><font color="#CCCCCC"> options</font><font color="#E5E5E5"> down</font>

716
00:24:24,820 --> 00:24:27,580
at the bottom memory and disk<font color="#E5E5E5"> but you</font>

717
00:24:26,230 --> 00:24:29,140
can see if you<font color="#CCCCCC"> just type help at any</font>

718
00:24:27,580 --> 00:24:32,649
point you'll come back<font color="#E5E5E5"> here</font><font color="#CCCCCC"> so for</font>

719
00:24:29,140 --> 00:24:33,610
<font color="#E5E5E5">example we have a tutorial so if we just</font>

720
00:24:32,650 --> 00:24:35,530
<font color="#E5E5E5">go to that</font><font color="#CCCCCC"> I'll kind of give you a</font>

721
00:24:33,610 --> 00:24:37,750
walkthrough so basically for<font color="#CCCCCC"> invoke</font>

722
00:24:35,530 --> 00:24:39,970
<font color="#CCCCCC">Cradle crafter all you do is supply the</font>

723
00:24:37,750 --> 00:24:42,430
<font color="#E5E5E5">URL of</font><font color="#CCCCCC"> your payload</font><font color="#E5E5E5"> that you want the</font>

724
00:24:39,970 --> 00:24:46,600
actual result<font color="#E5E5E5"> to go</font><font color="#CCCCCC"> download from you</font>

725
00:24:42,430 --> 00:24:48,130
can<font color="#E5E5E5"> also set</font><font color="#CCCCCC"> it to to a path</font><font color="#E5E5E5"> or you</font><font color="#CCCCCC"> can</font>

726
00:24:46,600 --> 00:24:49,629
also do a post cradle command and<font color="#E5E5E5"> that's</font>

727
00:24:48,130 --> 00:24:51,040
only that becomes important<font color="#CCCCCC"> for certain</font>

728
00:24:49,630 --> 00:24:53,530
invocation options where let's say<font color="#CCCCCC"> if</font>

729
00:24:51,040 --> 00:24:55,389
you want to remotely download invoke

730
00:24:53,530 --> 00:24:57,850
mimikatz<font color="#E5E5E5"> and then run invoke mimikatz</font>

731
00:24:55,390 --> 00:24:59,650
dump creds etc then<font color="#CCCCCC"> you might have to</font>

732
00:24:57,850 --> 00:25:00,969
<font color="#CCCCCC">actually</font><font color="#E5E5E5"> have that put in the same piece</font>

733
00:24:59,650 --> 00:25:03,370
<font color="#E5E5E5">if you have</font><font color="#CCCCCC"> you're</font><font color="#E5E5E5"> using some of the</font>

734
00:25:00,970 --> 00:25:04,840
workflow invocation options<font color="#E5E5E5"> so that's</font>

735
00:25:03,370 --> 00:25:10,270
that's<font color="#E5E5E5"> something you can configure as</font>

736
00:25:04,840 --> 00:25:19,209
well but let's just set a URL and I have

737
00:25:10,270 --> 00:25:22,180
a little<font color="#E5E5E5"> something</font><font color="#CCCCCC"> localhost so we'll</font>

738
00:25:19,210 --> 00:25:25,570
set<font color="#CCCCCC"> that and so if we go into</font><font color="#E5E5E5"> disk</font><font color="#CCCCCC"> we'll</font>

739
00:25:22,180 --> 00:25:27,460
see these are our<font color="#E5E5E5"> disk cradles here</font><font color="#CCCCCC"> but</font>

740
00:25:25,570 --> 00:25:29,770
memory<font color="#CCCCCC"> is more fun so we'll just go</font><font color="#E5E5E5"> back</font>

741
00:25:27,460 --> 00:25:31,660
and go there so these are all the

742
00:25:29,770 --> 00:25:33,610
cradles<font color="#E5E5E5"> all the memory</font><font color="#CCCCCC"> base cradles that</font>

743
00:25:31,660 --> 00:25:35,350
<font color="#E5E5E5">are available</font><font color="#CCCCCC"> and as you</font><font color="#E5E5E5"> can</font><font color="#CCCCCC"> see the</font>

744
00:25:33,610 --> 00:25:36,250
ones that are PowerShell<font color="#E5E5E5"> 3 oh very</font>

745
00:25:35,350 --> 00:25:39,250
explicitly say so

746
00:25:36,250 --> 00:25:40,510
<font color="#CCCCCC">so PS</font><font color="#E5E5E5"> web string this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> the net that</font>

747
00:25:39,250 --> 00:25:42,270
web client downloads string again the

748
00:25:40,510 --> 00:25:44,890
most common thing we<font color="#CCCCCC"> see attackers using</font>

749
00:25:42,270 --> 00:25:46,060
so let's just go into<font color="#CCCCCC"> that one and as</font>

750
00:25:44,890 --> 00:25:48,250
you can see<font color="#CCCCCC"> whenever you</font><font color="#E5E5E5"> enter a new</font>

751
00:25:46,060 --> 00:25:50,530
cradle it gives you<font color="#E5E5E5"> information about it</font>

752
00:25:48,250 --> 00:25:52,900
<font color="#CCCCCC">a compatibility dependencies footprints</font>

753
00:25:50,530 --> 00:25:55,270
<font color="#E5E5E5">but again indicators hey this happens to</font>

754
00:25:52,900 --> 00:25:57,520
load rasma and<font color="#E5E5E5"> dll and razz</font><font color="#CCCCCC"> api 30</font>

755
00:25:55,270 --> 00:25:59,560
<font color="#E5E5E5">studio l artifacts where could I</font><font color="#CCCCCC"> find</font>

756
00:25:57,520 --> 00:26:01,570
this how<font color="#E5E5E5"> about the</font><font color="#CCCCCC"> PowerShell prefetch</font>

757
00:25:59,560 --> 00:26:02,919
file<font color="#E5E5E5"> or these registry keys these</font>

758
00:26:01,570 --> 00:26:04,030
tracing reg keys so again for each

759
00:26:02,920 --> 00:26:05,800
<font color="#E5E5E5">cradle and some of them have a lot</font><font color="#CCCCCC"> more</font>

760
00:26:04,030 --> 00:26:07,330
artifacts I want to make it as easy as

761
00:26:05,800 --> 00:26:09,100
<font color="#E5E5E5">possible to understand what's happening</font>

762
00:26:07,330 --> 00:26:11,260
<font color="#CCCCCC">behind the scenes where</font><font color="#E5E5E5"> evidence may be</font>

763
00:26:09,100 --> 00:26:13,209
<font color="#E5E5E5">left behind and how we can as defenders</font>

764
00:26:11,260 --> 00:26:16,600
become better and as red teamers become

765
00:26:13,210 --> 00:26:19,810
more particular in which cradles you use

766
00:26:16,600 --> 00:26:20,560
in which situations so here<font color="#E5E5E5"> are options</font>

767
00:26:19,810 --> 00:26:22,480
here

768
00:26:20,560 --> 00:26:25,059
<font color="#E5E5E5">rearranged is the</font>

769
00:26:22,480 --> 00:26:27,940
and so what we can<font color="#E5E5E5"> do is right</font><font color="#CCCCCC"> now it's</font>

770
00:26:25,059 --> 00:26:30,490
just<font color="#E5E5E5"> a single one-liner or we can</font>

771
00:26:27,940 --> 00:26:33,220
actually<font color="#E5E5E5"> break that up into practically</font>

772
00:26:30,490 --> 00:26:35,889
named<font color="#E5E5E5"> variables like</font><font color="#CCCCCC"> WC for</font><font color="#E5E5E5"> web client</font>

773
00:26:33,220 --> 00:26:37,750
URL or we can do random variables with

774
00:26:35,889 --> 00:26:39,699
<font color="#E5E5E5">the random set variable get variable</font>

775
00:26:37,750 --> 00:26:41,679
syntax like you see here now<font color="#CCCCCC"> anything</font>

776
00:26:39,700 --> 00:26:43,750
<font color="#E5E5E5">that you'll notice the command anything</font>

777
00:26:41,679 --> 00:26:46,059
that you've<font color="#CCCCCC"> entered it shows up</font><font color="#E5E5E5"> in blue</font>

778
00:26:43,750 --> 00:26:48,340
and then<font color="#E5E5E5"> the things that just changed in</font>

779
00:26:46,059 --> 00:26:50,080
the last off eustachian round are set in

780
00:26:48,340 --> 00:26:51,939
yellow so you<font color="#E5E5E5"> can very</font><font color="#CCCCCC"> easily</font><font color="#E5E5E5"> see what</font>

781
00:26:50,080 --> 00:26:52,899
has changed<font color="#CCCCCC"> and so you can</font><font color="#E5E5E5"> just keep</font>

782
00:26:51,940 --> 00:26:54,250
<font color="#CCCCCC">running this until you get something</font>

783
00:26:52,899 --> 00:26:54,760
<font color="#CCCCCC">that you really like and say okay that</font>

784
00:26:54,250 --> 00:26:56,860
looks good

785
00:26:54,760 --> 00:26:59,200
we can go back<font color="#E5E5E5"> i'm command what is the</font>

786
00:26:56,860 --> 00:27:01,990
<font color="#E5E5E5">next one so again by</font><font color="#CCCCCC"> default it's just</font>

787
00:26:59,200 --> 00:27:06,880
the plain<font color="#CCCCCC"> all a new object what we can</font>

788
00:27:01,990 --> 00:27:10,809
do is we<font color="#E5E5E5"> can do the git</font><font color="#CCCCCC"> command actually</font>

789
00:27:06,880 --> 00:27:12,549
<font color="#E5E5E5">this is right off the screen yeah</font><font color="#CCCCCC"> or we</font>

790
00:27:10,809 --> 00:27:15,820
can do the<font color="#E5E5E5"> PowerShell one that Oh syntax</font>

791
00:27:12,549 --> 00:27:18,158
so we'll<font color="#E5E5E5"> just go with that one method</font>

792
00:27:15,820 --> 00:27:20,350
<font color="#CCCCCC">for download string</font><font color="#E5E5E5"> instead</font><font color="#CCCCCC"> of just</font>

793
00:27:18,159 --> 00:27:22,120
download string we could enumerate all

794
00:27:20,350 --> 00:27:26,949
<font color="#CCCCCC">the objects and then</font><font color="#E5E5E5"> this is now</font>

795
00:27:22,120 --> 00:27:28,539
download string and then for<font color="#E5E5E5"> invoke you</font>

796
00:27:26,950 --> 00:27:30,639
<font color="#CCCCCC">say</font><font color="#E5E5E5"> we have</font><font color="#CCCCCC"> ten</font><font color="#E5E5E5"> options here really nine</font>

797
00:27:28,539 --> 00:27:31,870
one is no invoke this<font color="#E5E5E5"> is really if you</font>

798
00:27:30,639 --> 00:27:33,459
want to basically<font color="#E5E5E5"> off</font><font color="#CCCCCC"> use get everything</font>

799
00:27:31,870 --> 00:27:34,899
<font color="#E5E5E5">and then</font><font color="#CCCCCC"> just run it locally just</font><font color="#E5E5E5"> to</font>

800
00:27:33,460 --> 00:27:35,830
download<font color="#CCCCCC"> the contents</font><font color="#E5E5E5"> to make sure it's</font>

801
00:27:34,899 --> 00:27:37,928
<font color="#E5E5E5">actually working you don't necessarily</font>

802
00:27:35,830 --> 00:27:39,699
<font color="#CCCCCC">want to run beacon on your system as</font>

803
00:27:37,929 --> 00:27:43,539
you're testing your payload<font color="#E5E5E5"> but we have</font>

804
00:27:39,700 --> 00:27:46,720
the<font color="#E5E5E5"> the regular ie X we can use get</font>

805
00:27:43,539 --> 00:27:49,419
alias<font color="#E5E5E5"> this is off the screen</font><font color="#CCCCCC"> so that's</font><font color="#E5E5E5"> a</font>

806
00:27:46,720 --> 00:27:52,419
get alias right there<font color="#CCCCCC"> nine is</font>

807
00:27:49,419 --> 00:27:54,730
concatenated<font color="#E5E5E5"> IX which is I</font><font color="#CCCCCC"> think</font><font color="#E5E5E5"> the</font>

808
00:27:52,419 --> 00:27:57,700
most fun<font color="#E5E5E5"> so again the environment</font>

809
00:27:54,730 --> 00:27:58,779
variables<font color="#E5E5E5"> hi this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> public so</font><font color="#CCCCCC"> that</font>

810
00:27:57,700 --> 00:28:00,190
using<font color="#E5E5E5"> the environment variable called</font>

811
00:27:58,779 --> 00:28:01,720
public and grabbing the<font color="#CCCCCC"> thirteenth</font><font color="#E5E5E5"> and</font>

812
00:28:00,190 --> 00:28:04,299
<font color="#E5E5E5">the fifth and then adding an X after</font>

813
00:28:01,720 --> 00:28:08,289
<font color="#E5E5E5">that</font><font color="#CCCCCC"> so after you've done all this you</font>

814
00:28:04,299 --> 00:28:10,470
can do is<font color="#E5E5E5"> just run tests or exec and it</font>

815
00:28:08,289 --> 00:28:10,470
works

816
00:28:15,580 --> 00:28:19,399
so now you've gone through all<font color="#E5E5E5"> these</font>

817
00:28:17,510 --> 00:28:20,930
options<font color="#E5E5E5"> and maybe you want to say hey I</font>

818
00:28:19,400 --> 00:28:22,790
really<font color="#CCCCCC"> like this set</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> combinations I</font>

819
00:28:20,930 --> 00:28:24,200
did<font color="#E5E5E5"> at any</font><font color="#CCCCCC"> point you</font><font color="#E5E5E5"> can</font><font color="#CCCCCC"> just go to show</font>

820
00:28:22,790 --> 00:28:25,850
or show options and they'll give you<font color="#CCCCCC"> all</font>

821
00:28:24,200 --> 00:28:27,590
the information<font color="#E5E5E5"> again yellow is a stuff</font>

822
00:28:25,850 --> 00:28:29,810
you've actually inputted<font color="#E5E5E5"> and</font><font color="#CCCCCC"> then you</font>

823
00:28:27,590 --> 00:28:31,490
have here's all that<font color="#CCCCCC"> here's all the</font>

824
00:28:29,810 --> 00:28:32,870
execution<font color="#CCCCCC"> options or</font><font color="#E5E5E5"> the obfuscation</font>

825
00:28:31,490 --> 00:28:34,430
options that you ran here's your final

826
00:28:32,870 --> 00:28:35,629
result<font color="#E5E5E5"> here's the length which is</font>

827
00:28:34,430 --> 00:28:36,980
important depending<font color="#E5E5E5"> on where you want to</font>

828
00:28:35,630 --> 00:28:38,900
<font color="#E5E5E5">put it and you</font><font color="#CCCCCC"> also have this command</font>

829
00:28:36,980 --> 00:28:40,280
<font color="#E5E5E5">line syntax so you can always just run</font>

830
00:28:38,900 --> 00:28:43,010
this<font color="#CCCCCC"> non interactively if you want to</font>

831
00:28:40,280 --> 00:28:44,420
set it<font color="#CCCCCC"> up in some</font><font color="#E5E5E5"> other framework or</font>

832
00:28:43,010 --> 00:28:46,310
project<font color="#E5E5E5"> now if you don't want to go</font>

833
00:28:44,420 --> 00:28:47,330
through<font color="#E5E5E5"> all these</font><font color="#CCCCCC"> options and let's just</font>

834
00:28:46,310 --> 00:28:49,280
<font color="#E5E5E5">remove</font><font color="#CCCCCC"> the on</font><font color="#E5E5E5"> fuse kitchen you could</font>

835
00:28:47,330 --> 00:28:50,689
just go to<font color="#E5E5E5"> this all one it'll</font><font color="#CCCCCC"> randomly</font>

836
00:28:49,280 --> 00:28:52,550
<font color="#CCCCCC">choose the order</font><font color="#E5E5E5"> and choose a lot of</font>

837
00:28:50,690 --> 00:28:54,440
<font color="#E5E5E5">stuff and</font><font color="#CCCCCC"> you'll</font><font color="#E5E5E5"> get something a bit</font>

838
00:28:52,550 --> 00:28:56,149
different<font color="#E5E5E5"> every</font><font color="#CCCCCC"> single time and the very</font>

839
00:28:54,440 --> 00:28:58,010
<font color="#E5E5E5">last thing I'll</font><font color="#CCCCCC"> show</font><font color="#E5E5E5"> you my last minute</font>

840
00:28:56,150 --> 00:29:01,160
here<font color="#CCCCCC"> if some</font><font color="#E5E5E5"> of these get really crazy</font>

841
00:28:58,010 --> 00:29:02,750
like PS<font color="#E5E5E5"> comm ie using Internet Explorer</font>

842
00:29:01,160 --> 00:29:04,670
<font color="#E5E5E5">again</font><font color="#CCCCCC"> a lot</font><font color="#E5E5E5"> more information here of</font>

843
00:29:02,750 --> 00:29:07,160
what's happening behind<font color="#E5E5E5"> the scenes</font><font color="#CCCCCC"> and</font>

844
00:29:04,670 --> 00:29:08,300
<font color="#E5E5E5">this is the the default cradle is</font>

845
00:29:07,160 --> 00:29:09,440
already that large<font color="#E5E5E5"> you can see all</font>

846
00:29:08,300 --> 00:29:11,600
<font color="#CCCCCC">there's four options</font><font color="#E5E5E5"> that you can go</font>

847
00:29:09,440 --> 00:29:13,100
<font color="#E5E5E5">into and so again if I</font><font color="#CCCCCC"> just go</font><font color="#E5E5E5"> to all</font><font color="#CCCCCC"> at</font>

848
00:29:11,600 --> 00:29:14,629
over them through all those and<font color="#E5E5E5"> now this</font>

849
00:29:13,100 --> 00:29:16,010
is a<font color="#E5E5E5"> cradle that we use silently</font>

850
00:29:14,630 --> 00:29:18,590
Internet Explorer to download the

851
00:29:16,010 --> 00:29:20,690
<font color="#CCCCCC">content and run it the last ones that</font><font color="#E5E5E5"> I</font>

852
00:29:18,590 --> 00:29:23,270
added are actually<font color="#E5E5E5"> c-sharp so you can do</font>

853
00:29:20,690 --> 00:29:26,840
<font color="#CCCCCC">inline C sharp or PS compiled C sharp</font>

854
00:29:23,270 --> 00:29:28,490
<font color="#CCCCCC">and</font><font color="#E5E5E5"> this is all regex accessible so</font><font color="#CCCCCC"> you</font>

855
00:29:26,840 --> 00:29:30,290
<font color="#E5E5E5">can just do</font><font color="#CCCCCC"> foot</font><font color="#E5E5E5"> one reg</font><font color="#CCCCCC"> X's to</font><font color="#E5E5E5"> navigate</font>

856
00:29:28,490 --> 00:29:31,520
the menus and stuff<font color="#E5E5E5"> like that and this</font>

857
00:29:30,290 --> 00:29:33,170
<font color="#E5E5E5">one's</font><font color="#CCCCCC"> really</font><font color="#E5E5E5"> cool because what it's</font>

858
00:29:31,520 --> 00:29:34,879
<font color="#CCCCCC">actually gonna do is it's gonna</font><font color="#E5E5E5"> generate</font>

859
00:29:33,170 --> 00:29:43,210
the<font color="#CCCCCC"> inline c-sharp</font><font color="#E5E5E5"> and then compile</font><font color="#CCCCCC"> it</font>

860
00:29:34,880 --> 00:29:45,920
on<font color="#E5E5E5"> your system oh wait</font><font color="#CCCCCC"> I did</font><font color="#E5E5E5"> PS compiled</font>

861
00:29:43,210 --> 00:29:47,570
<font color="#E5E5E5">there we go so now it's running</font><font color="#CCCCCC"> CSC on</font>

862
00:29:45,920 --> 00:29:48,830
your<font color="#CCCCCC"> local system compiling it it's</font>

863
00:29:47,570 --> 00:29:51,620
actually<font color="#E5E5E5"> reducing a lot</font><font color="#CCCCCC"> of the adjacent</font>

864
00:29:48,830 --> 00:29:53,689
<font color="#E5E5E5">zeros</font><font color="#CCCCCC"> with something</font><font color="#E5E5E5"> like this they said</font>

865
00:29:51,620 --> 00:29:55,159
<font color="#E5E5E5">hey instead of printing out 360</font><font color="#CCCCCC"> zero so</font>

866
00:29:53,690 --> 00:29:56,360
let me<font color="#E5E5E5"> just do this on the fly</font><font color="#CCCCCC"> and now</font>

867
00:29:55,160 --> 00:29:58,160
there's your payload and again<font color="#CCCCCC"> this is</font>

868
00:29:56,360 --> 00:29:59,629
<font color="#E5E5E5">gonna access system net dot web client</font>

869
00:29:58,160 --> 00:30:01,250
and it can even invoke commands inside

870
00:29:59,630 --> 00:30:03,140
<font color="#E5E5E5">of there but that'll never show up in</font>

871
00:30:01,250 --> 00:30:04,790
<font color="#E5E5E5">PowerShell logs the loading of that DLL</font>

872
00:30:03,140 --> 00:30:07,310
because it's all<font color="#E5E5E5"> done in the context of</font>

873
00:30:04,790 --> 00:30:09,170
c-sharp<font color="#CCCCCC"> so as a defender you definitely</font>

874
00:30:07,310 --> 00:30:10,580
want<font color="#CCCCCC"> to be looking</font><font color="#E5E5E5"> for this but there's</font>

875
00:30:09,170 --> 00:30:16,190
<font color="#E5E5E5">tons of ways you can off you skate even</font>

876
00:30:10,580 --> 00:30:17,840
that<font color="#E5E5E5"> so it's not all doom and gloom do</font>

877
00:30:16,190 --> 00:30:19,670
not run away<font color="#E5E5E5"> from</font><font color="#CCCCCC"> powershell PowerShell</font>

878
00:30:17,840 --> 00:30:22,970
is incredibly useful<font color="#E5E5E5"> and it is not going</font>

879
00:30:19,670 --> 00:30:24,890
<font color="#CCCCCC">away anytime soon upgrade to</font><font color="#E5E5E5"> powershell</font>

880
00:30:22,970 --> 00:30:26,809
<font color="#CCCCCC">v as soon as possible enable</font><font color="#E5E5E5"> those logs</font>

881
00:30:24,890 --> 00:30:28,220
<font color="#E5E5E5">expand your detection to</font>

882
00:30:26,809 --> 00:30:30,529
additional artifacts not just what you

883
00:30:28,220 --> 00:30:31,820
see on<font color="#E5E5E5"> the command line as the defenders</font>

884
00:30:30,529 --> 00:30:33,379
we need to be<font color="#E5E5E5"> breaking our assumptions</font>

885
00:30:31,820 --> 00:30:34,820
of<font color="#CCCCCC"> what we</font><font color="#E5E5E5"> think and know to be possible</font>

886
00:30:33,379 --> 00:30:36,559
<font color="#E5E5E5">because</font><font color="#CCCCCC"> there's always more that you</font><font color="#E5E5E5"> can</font>

887
00:30:34,820 --> 00:30:39,309
do and we<font color="#E5E5E5"> need to be aware</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> that so we</font>

888
00:30:36,559 --> 00:30:41,990
<font color="#CCCCCC">can more robustly</font><font color="#E5E5E5"> set up our detection</font>

889
00:30:39,309 --> 00:30:44,149
<font color="#CCCCCC">and hunt not just</font><font color="#E5E5E5"> from known bad syntax</font>

890
00:30:41,990 --> 00:30:46,159
<font color="#CCCCCC">of things that attackers are actually</font>

891
00:30:44,149 --> 00:30:47,870
using but also<font color="#E5E5E5"> looking for indicators of</font>

892
00:30:46,159 --> 00:30:49,490
off<font color="#CCCCCC"> Yusuke ssin</font><font color="#E5E5E5"> again how many tick</font>

893
00:30:47,870 --> 00:30:51,620
marks are common in a command line for

894
00:30:49,490 --> 00:30:52,909
<font color="#CCCCCC">powershell</font><font color="#E5E5E5"> or how many asterisks things</font>

895
00:30:51,620 --> 00:30:54,879
like that<font color="#CCCCCC"> and we'll</font><font color="#E5E5E5"> talk more</font><font color="#CCCCCC"> about that</font>

896
00:30:52,909 --> 00:30:57,590
<font color="#CCCCCC">on Friday with</font><font color="#E5E5E5"> Revo</font><font color="#CCCCCC"> coffee</font><font color="#E5E5E5"> station</font>

897
00:30:54,879 --> 00:30:59,509
except<font color="#E5E5E5"> that you're gonna miss stuff</font><font color="#CCCCCC"> no</font>

898
00:30:57,590 --> 00:31:00,918
one's perfect<font color="#E5E5E5"> we all fail every day and</font>

899
00:30:59,509 --> 00:31:01,999
hopefully<font color="#E5E5E5"> we're seeing those failures</font>

900
00:31:00,919 --> 00:31:03,590
<font color="#E5E5E5">and learning</font><font color="#CCCCCC"> from them</font><font color="#E5E5E5"> but the most</font>

901
00:31:01,999 --> 00:31:05,269
important thing is<font color="#E5E5E5"> to learn from</font><font color="#CCCCCC"> our</font>

902
00:31:03,590 --> 00:31:07,850
<font color="#CCCCCC">mistakes</font><font color="#E5E5E5"> and then share the community</font>

903
00:31:05,269 --> 00:31:09,320
<font color="#E5E5E5">just like this because we all learn and</font>

904
00:31:07,850 --> 00:31:10,428
<font color="#E5E5E5">are all on the shoulders of other people</font>

905
00:31:09,320 --> 00:31:12,230
<font color="#E5E5E5">so I</font><font color="#CCCCCC"> think it's</font><font color="#E5E5E5"> really important to do</font>

906
00:31:10,429 --> 00:31:13,639
<font color="#E5E5E5">that especially</font><font color="#CCCCCC"> our failures because we</font>

907
00:31:12,230 --> 00:31:16,549
all can<font color="#E5E5E5"> learn from successes and</font>

908
00:31:13,639 --> 00:31:17,719
failures<font color="#CCCCCC"> lastly I just like to say thank</font>

909
00:31:16,549 --> 00:31:19,249
you<font color="#CCCCCC"> to a lot of</font><font color="#E5E5E5"> the awesome colleagues I</font>

910
00:31:17,720 --> 00:31:20,929
get to work with<font color="#CCCCCC"> on a</font><font color="#E5E5E5"> day to</font><font color="#CCCCCC"> day basis</font>

911
00:31:19,249 --> 00:31:22,190
<font color="#E5E5E5">and</font><font color="#CCCCCC"> then especially my wife Paige</font>

912
00:31:20,929 --> 00:31:23,840
<font color="#E5E5E5">because she watches me write a lot of</font>

913
00:31:22,190 --> 00:31:25,610
code<font color="#E5E5E5"> and that's like not the most fun</font>

914
00:31:23,840 --> 00:31:26,600
<font color="#CCCCCC">thing for</font><font color="#E5E5E5"> her to do and so she's</font><font color="#CCCCCC"> been</font>

915
00:31:25,610 --> 00:31:27,830
really supportive<font color="#E5E5E5"> through all this</font>

916
00:31:26,600 --> 00:31:30,799
<font color="#CCCCCC">research and development and</font><font color="#E5E5E5"> so</font>

917
00:31:27,830 --> 00:31:33,789
<font color="#E5E5E5">definitely</font><font color="#CCCCCC"> very appreciative to her so</font>

918
00:31:30,799 --> 00:31:33,789
thank you very<font color="#E5E5E5"> much</font>

919
00:31:39,630 --> 00:31:47,380
thank you very<font color="#E5E5E5"> much that was really</font>

920
00:31:42,120 --> 00:31:48,879
funny<font color="#CCCCCC"> and</font><font color="#E5E5E5"> a bit scary</font><font color="#CCCCCC"> and I have</font><font color="#E5E5E5"> just</font>

921
00:31:47,380 --> 00:31:50,350
<font color="#E5E5E5">one question because when I was kidding</font>

922
00:31:48,880 --> 00:31:52,090
and used to<font color="#CCCCCC"> be</font><font color="#E5E5E5"> pen testing everyone was</font>

923
00:31:50,350 --> 00:31:53,889
popping<font color="#CCCCCC"> in meterpreter shell</font><font color="#E5E5E5"> but</font>

924
00:31:52,090 --> 00:31:55,000
nowadays<font color="#E5E5E5"> it seems like we don't need</font>

925
00:31:53,890 --> 00:31:56,470
them<font color="#CCCCCC"> interpret each</font><font color="#E5E5E5"> other</font><font color="#CCCCCC"> and more</font>

926
00:31:55,000 --> 00:31:58,510
<font color="#E5E5E5">because we can do everything they used</font>

927
00:31:56,470 --> 00:32:00,549
to<font color="#E5E5E5"> do with matter / more or less with</font>

928
00:31:58,510 --> 00:32:02,200
<font color="#CCCCCC">PowerShell and</font><font color="#E5E5E5"> is that</font><font color="#CCCCCC"> how you see</font>

929
00:32:00,549 --> 00:32:04,360
attacks<font color="#E5E5E5"> that you've been</font><font color="#CCCCCC"> investigating</font>

930
00:32:02,200 --> 00:32:06,190
as well that people<font color="#CCCCCC"> are</font><font color="#E5E5E5"> more yeah yeah</font>

931
00:32:04,360 --> 00:32:07,149
absolutely<font color="#E5E5E5"> I mean and the</font><font color="#CCCCCC"> other</font>

932
00:32:06,190 --> 00:32:08,919
interesting<font color="#E5E5E5"> thing is that there's so</font>

933
00:32:07,150 --> 00:32:11,710
many attack frameworks<font color="#E5E5E5"> that</font><font color="#CCCCCC"> are coming</font>

934
00:32:08,919 --> 00:32:13,289
out<font color="#CCCCCC"> with PowerShell that a lot of</font><font color="#E5E5E5"> apt</font>

935
00:32:11,710 --> 00:32:15,549
groups<font color="#E5E5E5"> are actually using off-the-shelf</font>

936
00:32:13,289 --> 00:32:17,440
<font color="#E5E5E5">frameworks like COBOL</font><font color="#CCCCCC"> striker</font><font color="#E5E5E5"> Empire</font>

937
00:32:15,549 --> 00:32:20,080
<font color="#E5E5E5">often to blend in to look like pen</font>

938
00:32:17,440 --> 00:32:21,250
testers and so never<font color="#E5E5E5"> discount</font>

939
00:32:20,080 --> 00:32:22,870
what's publicly available because

940
00:32:21,250 --> 00:32:23,830
attackers are using that<font color="#CCCCCC"> as well but</font>

941
00:32:22,870 --> 00:32:26,199
<font color="#E5E5E5">yeah definitely see an uptick in</font>

942
00:32:23,830 --> 00:32:27,970
PowerShell<font color="#CCCCCC"> if all defenders upgraded</font>

943
00:32:26,200 --> 00:32:29,080
PowerShell<font color="#E5E5E5"> to version 5 and enabled</font>

944
00:32:27,970 --> 00:32:30,549
logging I think we'd<font color="#CCCCCC"> actually see</font>

945
00:32:29,080 --> 00:32:33,639
attackers move away from<font color="#E5E5E5"> it because it's</font>

946
00:32:30,549 --> 00:32:35,470
insanely robust<font color="#E5E5E5"> but most people don't</font>

947
00:32:33,640 --> 00:32:36,880
<font color="#E5E5E5">enable logging in the</font><font color="#CCCCCC"> first</font><font color="#E5E5E5"> place so I</font>

948
00:32:35,470 --> 00:32:39,700
think<font color="#E5E5E5"> we have a long</font><font color="#CCCCCC"> road to go before</font>

949
00:32:36,880 --> 00:32:44,020
it<font color="#E5E5E5"> becomes obsolete but yeah it's it's</font>

950
00:32:39,700 --> 00:32:57,730
<font color="#CCCCCC">it's pretty</font><font color="#E5E5E5"> ugly out there yeah</font><font color="#CCCCCC"> okay any</font>

951
00:32:44,020 --> 00:32:59,440
more<font color="#E5E5E5"> questions from the audience yeah</font>

952
00:32:57,730 --> 00:33:01,150
exactly<font color="#E5E5E5"> the question was</font><font color="#CCCCCC"> PowerShell</font>

953
00:32:59,440 --> 00:33:03,580
provide any<font color="#E5E5E5"> kind of interface API</font>

954
00:33:01,150 --> 00:33:05,230
<font color="#E5E5E5">interface your hooks so AV can basically</font>

955
00:33:03,580 --> 00:33:07,809
<font color="#E5E5E5">integrate with it they absolutely do</font><font color="#CCCCCC"> in</font>

956
00:33:05,230 --> 00:33:09,460
<font color="#E5E5E5">PowerShell</font><font color="#CCCCCC"> v they've introduced a MSI</font>

957
00:33:07,809 --> 00:33:11,350
which is the anti-malware scan interface

958
00:33:09,460 --> 00:33:12,820
and as an AV vendor you can<font color="#E5E5E5"> register to</font>

959
00:33:11,350 --> 00:33:15,658
that to<font color="#E5E5E5"> get</font><font color="#CCCCCC"> access to</font><font color="#E5E5E5"> it and again it's</font>

960
00:33:12,820 --> 00:33:18,610
way more<font color="#CCCCCC"> than</font><font color="#E5E5E5"> PowerShell basically like</font>

961
00:33:15,659 --> 00:33:20,590
<font color="#E5E5E5">JB jscript</font><font color="#CCCCCC"> VB script like all these</font>

962
00:33:18,610 --> 00:33:23,289
interpreted languages you can get access

963
00:33:20,590 --> 00:33:24,610
into into<font color="#E5E5E5"> that data so the thing to keep</font>

964
00:33:23,289 --> 00:33:25,870
in<font color="#CCCCCC"> mind is that for PowerShell you'll</font>

965
00:33:24,610 --> 00:33:28,959
get access<font color="#E5E5E5"> to what are the script block</font>

966
00:33:25,870 --> 00:33:30,840
<font color="#E5E5E5">logs which is Eid 4104 which if you look</font>

967
00:33:28,960 --> 00:33:33,220
at invoke off<font color="#E5E5E5"> you station and even</font><font color="#CCCCCC"> this</font>

968
00:33:30,840 --> 00:33:34,510
all that occupation is still<font color="#CCCCCC"> going to be</font>

969
00:33:33,220 --> 00:33:36,159
there the things that will unravel is

970
00:33:34,510 --> 00:33:38,049
like if you<font color="#E5E5E5"> encrypt it or encode it like</font>

971
00:33:36,159 --> 00:33:39,549
<font color="#E5E5E5">ten</font><font color="#CCCCCC"> different times</font><font color="#E5E5E5"> it'll it'll</font>

972
00:33:38,049 --> 00:33:40,840
basically<font color="#E5E5E5"> show every single</font><font color="#CCCCCC"> one of</font><font color="#E5E5E5"> those</font>

973
00:33:39,549 --> 00:33:43,090
<font color="#E5E5E5">layers and</font><font color="#CCCCCC"> I'll get you</font><font color="#E5E5E5"> down to the last</font>

974
00:33:40,840 --> 00:33:44,770
bit which is huge<font color="#CCCCCC"> like it's insane it's</font>

975
00:33:43,090 --> 00:33:46,330
so cool<font color="#CCCCCC"> that it does</font><font color="#E5E5E5"> that but you still</font>

976
00:33:44,770 --> 00:33:47,679
have to keep in<font color="#E5E5E5"> mind are there</font><font color="#CCCCCC"> tape</font>

977
00:33:46,330 --> 00:33:49,360
marks and<font color="#CCCCCC"> there concatenations that will</font>

978
00:33:47,679 --> 00:33:50,759
throw off<font color="#E5E5E5"> regular string searches but</font>

979
00:33:49,360 --> 00:33:52,379
that's where

980
00:33:50,759 --> 00:33:54,149
that's where more sciency techniques

981
00:33:52,379 --> 00:33:56,369
come into play like Revo<font color="#E5E5E5"> confiscation</font>

982
00:33:54,149 --> 00:34:06,418
<font color="#CCCCCC">where it'll basically</font><font color="#E5E5E5"> just nail that</font>

983
00:33:56,369 --> 00:34:09,149
<font color="#E5E5E5">stuff to the wall</font><font color="#CCCCCC"> actually not not</font>

984
00:34:06,419 --> 00:34:11,039
exactly<font color="#CCCCCC"> yeah I definitely thought that</font>

985
00:34:09,149 --> 00:34:12,960
<font color="#CCCCCC">too and in talking and talking</font><font color="#E5E5E5"> with</font>

986
00:34:11,039 --> 00:34:14,849
<font color="#CCCCCC">people</font><font color="#E5E5E5"> who are much more instantly</font>

987
00:34:12,960 --> 00:34:17,129
<font color="#E5E5E5">familiar with those details than I am</font>

988
00:34:14,849 --> 00:34:19,559
<font color="#E5E5E5">that's all happening</font><font color="#CCCCCC"> after</font><font color="#E5E5E5"> that last</font>

989
00:34:17,129 --> 00:34:21,989
script<font color="#E5E5E5"> block log even if you dump memory</font>

990
00:34:19,559 --> 00:34:23,369
and you'll still see the<font color="#E5E5E5"> off you skated</font>

991
00:34:21,989 --> 00:34:25,258
script which we've which we've<font color="#E5E5E5"> done</font>

992
00:34:23,369 --> 00:34:26,460
<font color="#E5E5E5">quite a bit</font><font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> not a memory expert by</font>

993
00:34:25,259 --> 00:34:27,629
<font color="#CCCCCC">any mean if someone knows how to</font><font color="#E5E5E5"> do that</font>

994
00:34:26,460 --> 00:34:34,949
<font color="#E5E5E5">please talk</font><font color="#CCCCCC"> to me and</font><font color="#E5E5E5"> that would be</font>

995
00:34:27,629 --> 00:34:36,719
really really<font color="#CCCCCC"> cool to see yes</font><font color="#E5E5E5"> yes</font><font color="#CCCCCC"> aam si</font>

996
00:34:34,949 --> 00:34:38,549
<font color="#E5E5E5">will provide access to exactly what you</font>

997
00:34:36,719 --> 00:34:40,408
see in the script block logs which still

998
00:34:38,549 --> 00:34:43,918
has that last bit of token layer off you

999
00:34:40,409 --> 00:34:45,919
<font color="#E5E5E5">station but again that's still huge like</font>

1000
00:34:43,918 --> 00:34:47,940
that that's so much more than than

1001
00:34:45,918 --> 00:34:49,529
anything<font color="#E5E5E5"> else out there so it's really</font>

1002
00:34:47,940 --> 00:34:51,029
<font color="#E5E5E5">cool they do that but there's only I</font>

1003
00:34:49,529 --> 00:34:52,799
<font color="#E5E5E5">think three AV vendors that</font><font color="#CCCCCC"> have</font>

1004
00:34:51,029 --> 00:34:59,490
implemented it and<font color="#E5E5E5"> it's been out for a</font>

1005
00:34:52,799 --> 00:35:02,099
<font color="#E5E5E5">year and a half now to to the best of</font><font color="#CCCCCC"> my</font>

1006
00:34:59,490 --> 00:35:04,288
understanding today yeah<font color="#E5E5E5"> you have to</font><font color="#CCCCCC"> be</font>

1007
00:35:02,099 --> 00:35:06,539
<font color="#CCCCCC">a registered AV vendor but I'm very</font>

1008
00:35:04,289 --> 00:35:08,430
hopeful that<font color="#E5E5E5"> there</font><font color="#CCCCCC"> will be more openness</font>

1009
00:35:06,539 --> 00:35:10,349
to that<font color="#E5E5E5"> going forward</font><font color="#CCCCCC"> so that anyone can</font>

1010
00:35:08,430 --> 00:35:11,519
<font color="#CCCCCC">just</font><font color="#E5E5E5"> implement it for their organization</font>

1011
00:35:10,349 --> 00:35:14,130
because that would be really really<font color="#E5E5E5"> cool</font>

1012
00:35:11,519 --> 00:35:16,200
<font color="#CCCCCC">the craziest</font><font color="#E5E5E5"> part is that that provides</font>

1013
00:35:14,130 --> 00:35:17,640
you<font color="#E5E5E5"> preventative you can</font><font color="#CCCCCC"> actually say go</font>

1014
00:35:16,200 --> 00:35:28,259
or<font color="#CCCCCC"> no go to the</font><font color="#E5E5E5"> code it's not just</font>

1015
00:35:17,640 --> 00:35:29,910
detection<font color="#CCCCCC"> my short comment on bash and</font>

1016
00:35:28,259 --> 00:35:30,720
Linux on Windows is that I don't know

1017
00:35:29,910 --> 00:35:33,930
<font color="#E5E5E5">anything about it</font>

1018
00:35:30,720 --> 00:35:35,700
so not<font color="#CCCCCC"> exactly I think I think it's a</font>

1019
00:35:33,930 --> 00:35:37,140
really cool research<font color="#E5E5E5"> area</font><font color="#CCCCCC"> I don't</font><font color="#E5E5E5"> think</font>

1020
00:35:35,700 --> 00:35:38,939
we're<font color="#E5E5E5"> gonna see attackers really using</font>

1021
00:35:37,140 --> 00:35:40,500
<font color="#E5E5E5">it wide scale until they know it's gonna</font>

1022
00:35:38,940 --> 00:35:42,210
be on every<font color="#E5E5E5"> system that's why PowerShell</font>

1023
00:35:40,500 --> 00:35:43,710
so since it's so ubiquitous attackers

1024
00:35:42,210 --> 00:35:45,000
love it because it's always there<font color="#E5E5E5"> so</font>

1025
00:35:43,710 --> 00:35:48,690
maybe<font color="#E5E5E5"> if there's some kind of like I</font>

1026
00:35:45,000 --> 00:35:50,400
don't know like popular like you know if

1027
00:35:48,690 --> 00:35:51,720
SCCM comes out<font color="#CCCCCC"> and</font><font color="#E5E5E5"> says hey</font><font color="#CCCCCC"> you know we</font>

1028
00:35:50,400 --> 00:35:53,190
<font color="#CCCCCC">want to use you know bash</font><font color="#E5E5E5"> and Linux for</font>

1029
00:35:51,720 --> 00:35:54,689
<font color="#E5E5E5">some reason on Windows like if some if</font>

1030
00:35:53,190 --> 00:35:56,279
some big player in<font color="#E5E5E5"> the game starts to</font>

1031
00:35:54,690 --> 00:35:57,900
use that by<font color="#E5E5E5"> default then I think</font>

1032
00:35:56,279 --> 00:35:59,609
<font color="#E5E5E5">attackers will start to use</font><font color="#CCCCCC"> it there's a</font>

1033
00:35:57,900 --> 00:36:01,589
good<font color="#E5E5E5"> enough chance it'll be there but</font>

1034
00:35:59,609 --> 00:36:03,440
<font color="#E5E5E5">again that that's not my field of</font>

1035
00:36:01,589 --> 00:36:05,570
expertise<font color="#CCCCCC"> so I</font><font color="#E5E5E5"> definitely love</font>

1036
00:36:03,440 --> 00:36:06,950
<font color="#E5E5E5">here otherwise but or I hope I never</font>

1037
00:36:05,570 --> 00:36:18,440
hear about it<font color="#E5E5E5"> cuz I'm attackers aren't</font>

1038
00:36:06,950 --> 00:36:20,390
abusing<font color="#E5E5E5"> it so yes yeah so the</font><font color="#CCCCCC"> question</font>

1039
00:36:18,440 --> 00:36:22,550
<font color="#E5E5E5">was do I know anyone who is basically</font>

1040
00:36:20,390 --> 00:36:25,609
working<font color="#E5E5E5"> on ways</font><font color="#CCCCCC"> to diiie off you skate</font>

1041
00:36:22,550 --> 00:36:27,200
<font color="#E5E5E5">my off you station</font><font color="#CCCCCC"> god I hope so like</font>

1042
00:36:25,610 --> 00:36:30,860
<font color="#CCCCCC">cuz it's awful trying to do it manually</font>

1043
00:36:27,200 --> 00:36:32,990
<font color="#CCCCCC">I do have some really shoddy</font><font color="#E5E5E5"> scripts</font>

1044
00:36:30,860 --> 00:36:35,090
that<font color="#E5E5E5"> I use to reverse a lot of it but</font>

1045
00:36:32,990 --> 00:36:37,220
<font color="#CCCCCC">nothing that I would be willing</font><font color="#E5E5E5"> to put</font>

1046
00:36:35,090 --> 00:36:38,630
my<font color="#CCCCCC"> name on and put out in public so I'm</font>

1047
00:36:37,220 --> 00:36:40,399
really<font color="#E5E5E5"> hopeful</font><font color="#CCCCCC"> that someone</font><font color="#E5E5E5"> out</font><font color="#CCCCCC"> there is</font>

1048
00:36:38,630 --> 00:36:42,050
working<font color="#CCCCCC"> on this or would like to please</font>

1049
00:36:40,400 --> 00:36:43,400
like hit me up<font color="#E5E5E5"> I'll give you a lot</font><font color="#CCCCCC"> of</font>

1050
00:36:42,050 --> 00:36:44,870
<font color="#E5E5E5">information anything I can to help</font>

1051
00:36:43,400 --> 00:36:49,430
<font color="#E5E5E5">because</font><font color="#CCCCCC"> I definitely don't</font><font color="#E5E5E5"> want to try</font>

1052
00:36:44,870 --> 00:36:50,540
to<font color="#E5E5E5"> write</font><font color="#CCCCCC"> that but but</font><font color="#E5E5E5"> yeah today</font><font color="#CCCCCC"> people</font>

1053
00:36:49,430 --> 00:36:52,009
<font color="#E5E5E5">aren't even really detecting</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> the</font>

1054
00:36:50,540 --> 00:36:54,290
first place<font color="#E5E5E5"> that's why myself and Leigh</font>

1055
00:36:52,010 --> 00:36:55,910
Holmes<font color="#E5E5E5"> put together the Revo coffee</font>

1056
00:36:54,290 --> 00:36:57,410
station<font color="#CCCCCC"> project so at least</font><font color="#E5E5E5"> if you can</font>

1057
00:36:55,910 --> 00:36:59,120
detect it<font color="#E5E5E5"> then it doesn't</font><font color="#CCCCCC"> take that long</font>

1058
00:36:57,410 --> 00:37:01,190
<font color="#CCCCCC">to D off you skate it but at least</font><font color="#E5E5E5"> you</font>

1059
00:36:59,120 --> 00:37:02,600
<font color="#CCCCCC">know this is something</font><font color="#E5E5E5"> bad I need</font><font color="#CCCCCC"> to I</font>

1060
00:37:01,190 --> 00:37:06,530
<font color="#E5E5E5">need to be worried about this and look</font>

1061
00:37:02,600 --> 00:37:08,540
at<font color="#CCCCCC"> it so again thank you very much and</font>

1062
00:37:06,530 --> 00:37:11,180
I'm<font color="#E5E5E5"> around all week so please come ask</font>

1063
00:37:08,540 --> 00:37:12,450
me<font color="#E5E5E5"> any questions or say hello</font><font color="#CCCCCC"> thanks</font>

1064
00:37:11,180 --> 00:37:15,899
again

1065
00:37:12,450 --> 00:37:15,899
[Applause]

