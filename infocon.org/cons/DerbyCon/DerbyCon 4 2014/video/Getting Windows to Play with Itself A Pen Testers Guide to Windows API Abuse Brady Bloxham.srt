1
00:00:01,020 --> 00:00:06,509
in

2
00:00:06,509 --> 00:00:10,260
you

3
00:00:10,260 --> 00:00:14,969
in you good

4
00:00:14,969 --> 00:00:19,410
heart all right thank you for

5
00:00:19,410 --> 00:00:23,250
waking up by 10 a.m. Sunday morning it's
not easy

6
00:00:23,250 --> 00:00:26,910
and Ed at Derby Conn is security
conferences

7
00:00:26,910 --> 00:00:30,890
but today we're going to talk a little
bit about a how to do when does the

8
00:00:30,890 --> 00:00:34,800
play with itself a hacker's guide to
Windows API views

9
00:00:34,800 --> 00:00:39,690
my name's Brady black some founder
principal security consultant

10
00:00:39,690 --> 00:00:43,100
at some great security and

11
00:00:43,100 --> 00:00:46,550
real quick a little bit a background on
me I started out the government space

12
00:00:46,550 --> 00:00:47,960
working for your dad

13
00:00:47,960 --> 00:00:51,219
very Street three-letter agencies from

14
00:00:51,219 --> 00:00:55,739
Aaron originally what I saw was I saw
that there is a big gap between

15
00:00:55,739 --> 00:00:58,770
what the private sector considered
penetration test

16
00:00:58,770 --> 00:01:02,540
and you know some other the offense if
attacks there

17
00:01:02,540 --> 00:01:06,540
at you know are performed in in the real
world rank:

18
00:01:06,540 --> 00:01:10,430
so I decided to you know take what I
learned from the private sector and and

19
00:01:10,430 --> 00:01:13,360
apply it to you are sorry the public
sector working for you know the

20
00:01:13,360 --> 00:01:16,240
government and DOD and apply to the
private sector

21
00:01:16,240 --> 00:01:19,300
so that's kinda how it all got started
on

22
00:01:19,300 --> 00:01:22,550
lot of the research you know was done on
my own time

23
00:01:22,550 --> 00:01:26,080
I'm gonna and throw back the toll that
I'll be talking about was

24
00:01:26,080 --> 00:01:29,810
was also developed and is used a lot on
on the water penetration tests

25
00:01:29,810 --> 00:01:34,479
so I'm for anyone that's me with the
phone was project also started that

26
00:01:34,479 --> 00:01:37,940
I am so yeah was going to jump right in

27
00:01:37,940 --> 00:01:43,930
so I first off a little bit a background
check before we get into the danger zone

28
00:01:43,930 --> 00:01:47,369
ever have one race ourselves com the
their

29
00:01:47,369 --> 00:01:51,470
really be alternately that the goal of
the talk is to shorten the gap between

30
00:01:51,470 --> 00:01:54,740
a penetration has an actual attack again
going back to you know what

31
00:01:54,740 --> 00:01:58,240
what motivated I me to leave the
government

32
00:01:58,240 --> 00:02:01,410
I am in the first place so who is heard

33
00:02:01,410 --> 00:02:05,410
a HD Moore's Law 0 you hear that

34
00:02:05,410 --> 00:02:08,619
ido Bryce talked about in his talk
yesterday so

35
00:02:08,619 --> 00:02:13,519
yeah it's it it's basically a phenomenon
that says are the law that says

36
00:02:13,519 --> 00:02:16,680
that the casual attacker will grow at
the rate

37
00:02:16,680 --> 00:02:20,340
up the capabilities behind Metasploit
right so

38
00:02:20,340 --> 00:02:24,130
who in here one step in a drink you know
I do and testing at the rate have a

39
00:02:24,130 --> 00:02:25,900
casual attacker at the rate if you know

40
00:02:25,900 --> 00:02:29,410
like a script getting so the idea then
is to you know

41
00:02:29,410 --> 00:02:33,330
to raise our level sold you know we're
kinda going beyond that level and

42
00:02:33,330 --> 00:02:34,500
applying some custom

43
00:02:34,500 --> 00:02:38,459
custom attacks using custom tools and
doing more advanced stuff

44
00:02:38,459 --> 00:02:42,019
only to provide you know customers
klein's people in the private sector

45
00:02:42,019 --> 00:02:45,310
with the better you know perspectiva how
will they do against

46
00:02:45,310 --> 00:02:49,500
not a casual attacker but more been
targeted type attack I'm

47
00:02:49,500 --> 00:02:53,170
their other project to do this as well I
think a ball strike does a great job a

48
00:02:53,170 --> 00:02:53,570
bit

49
00:02:53,570 --> 00:02:57,049
out a bill framework on you know a lot
of the stuff is coming out for

50
00:02:57,049 --> 00:02:58,640
PowerShell also does

51
00:02:58,640 --> 00:03:02,709
so I am you know what will miss what
does a lot of great things

52
00:03:02,709 --> 00:03:06,230
I i've I think it's always helpful you
know to constantly trying to improve as

53
00:03:06,230 --> 00:03:06,860
well

54
00:03:06,860 --> 00:03:11,570
solo I've also seen that there are very
few

55
00:03:11,570 --> 00:03:15,130
persistence tools open source tools and
techniques

56
00:03:15,130 --> 00:03:20,040
available so as we go throughout this a
lot of this talk will be on persistence

57
00:03:20,040 --> 00:03:20,720
tools

58
00:03:20,720 --> 00:03:24,609
are so hopefully it will be able to use
that in your penetration test

59
00:03:24,609 --> 00:03:30,130
I I've actually been really impressed at
Derby Conn there's been a lot of talk on

60
00:03:30,130 --> 00:03:32,260
red team and I think that's really cool

61
00:03:32,260 --> 00:03:36,160
on you know it is contesting

62
00:03:36,160 --> 00:03:39,389
normal contest is kinda lame right so

63
00:03:39,389 --> 00:03:43,169
are we have a lot to cover first gonna
talk a little bit about deal injection

64
00:03:43,169 --> 00:03:46,959
they're gonna go into some percs
persistence techniques on their number

65
00:03:46,959 --> 00:03:48,160
to overthrow back

66
00:03:48,160 --> 00:03:51,340
how to use throwback and I'll beat and
the demos along the way

67
00:03:51,340 --> 00:03:54,419
so if you have questions comments I

68
00:03:54,419 --> 00:03:58,239
you don't feel free to raise your hand
throughout the presentation

69
00:03:58,239 --> 00:04:02,820
so first ideal injection there's there's
a lot of traditional methods

70
00:04:02,820 --> 00:04:06,650
and Adam all the ones that are listed
there the only one that is actually

71
00:04:06,650 --> 00:04:10,060
documented by Microsoft is career not
read

72
00:04:10,060 --> 00:04:13,350
you know if you going to assist search
for any the others on MSDN

73
00:04:13,350 --> 00:04:18,980
not the other ones will show up I am
there's integrated ready access which

74
00:04:18,980 --> 00:04:22,019
personally I have never had any luck
with that it is like

75
00:04:22,019 --> 00:04:25,169
super sketchy our children users read

76
00:04:25,169 --> 00:04:28,210
thats usually my go to use it works
really well

77
00:04:28,210 --> 00:04:31,260
though the one that is documented cream
own thread

78
00:04:31,260 --> 00:04:35,710
because this document in Microsoft has
put so many protections around it

79
00:04:35,710 --> 00:04:38,790
throughout the different versions of
Windows that you never really know how

80
00:04:38,790 --> 00:04:39,810
it's going to react

81
00:04:39,810 --> 00:04:45,150
and XP or Windows seven like it doesn't
work very well in 107

82
00:04:45,150 --> 00:04:48,630
because if you know different equity
levels and processes but I when does a

83
00:04:48,630 --> 00:04:51,980
I read on Stack Overflow that people are
getting into work fine so

84
00:04:51,980 --> 00:04:55,250
because it is documented you know
there's more protections around there

85
00:04:55,250 --> 00:04:59,010
typically my goto was our children users
thread in the last one in T

86
00:04:59,010 --> 00:05:03,560
cue ABC dread can even blue screen boxed
so

87
00:05:03,560 --> 00:05:07,350
I am would be nice if you know if we had
another technique to use

88
00:05:07,350 --> 00:05:11,210
for code injection are getting our Rd
loaded

89
00:05:11,210 --> 00:05:14,750
there's also code caving Tom which is
also

90
00:05:14,750 --> 00:05:18,760
with it's really awesome techniques may
see where you start a process suspended

91
00:05:18,760 --> 00:05:23,180
you overwrite the IP of that process
with you know the instruction pointer to

92
00:05:23,180 --> 00:05:25,500
wear your show code is in the resume the
process

93
00:05:25,500 --> 00:05:31,500
so it's a really cool technique on but
it's not nearly as easy on 64-bit

94
00:05:31,500 --> 00:05:34,990
I O S is so you're on

95
00:05:34,990 --> 00:05:39,160
that's a huge limitation in my mind soul

96
00:05:39,160 --> 00:05:43,380
the mean the API that I found it's
called add monitor

97
00:05:43,380 --> 00:05:47,720
and personal a little bit a background
on had monitor were already picking on

98
00:05:47,720 --> 00:05:52,490
print spooling a lot today danso add
monitors a function that installs a

99
00:05:52,490 --> 00:05:54,070
local print monitored

100
00:05:54,070 --> 00:05:57,940
and links the configuration so you know
in Windows you have your driver ever

101
00:05:57,940 --> 00:05:59,560
print driver right

102
00:05:59,560 --> 00:06:04,160
and basically what the monitor does it
monitors for you know jobs data whatever

103
00:06:04,160 --> 00:06:08,300
that you know user space needs a pass on
up to the

104
00:06:08,300 --> 00:06:11,320
to the print driver in in kernel space

105
00:06:11,320 --> 00:06:16,160
so there are some limitations behind
this um

106
00:06:16,160 --> 00:06:19,780
the limitations mean that first of all
the I in my mind I think the big one

107
00:06:19,780 --> 00:06:24,460
is the deal almost beyond desk and it
also requires administrator privileges

108
00:06:24,460 --> 00:06:27,780
so if you're you know in a situation
where you can work around those things

109
00:06:27,780 --> 00:06:31,730
and and miners a great alternative to
you know load library or

110
00:06:31,730 --> 00:06:36,850
I'm or with one the other deal injection
techniques we talked about

111
00:06:36,850 --> 00:06:40,080
it injects in this blessed be so you
really don't have a choice somewhat

112
00:06:40,080 --> 00:06:44,090
process your deal gets loaded into but
hey your system so you know you probably

113
00:06:44,090 --> 00:06:45,710
don't really care anyway

114
00:06:45,710 --> 00:06:49,900
on and it also doesn't require macchine
architecture a lot of that you know the

115
00:06:49,900 --> 00:06:51,300
deal injection

116
00:06:51,300 --> 00:06:54,680
techniques the DLL has to match you know
whatever

117
00:06:54,680 --> 00:06:58,050
on has to match the architecture the OS
in this case that

118
00:06:58,050 --> 00:07:01,060
that's not true so it's super easy to
use

119
00:07:01,060 --> 00:07:06,370
I am in fact yeah let's do a demo and

120
00:07:06,370 --> 00:07:11,980
I am City

121
00:07:11,980 --> 00:07:13,080
yam so

122
00:07:13,080 --> 00:07:17,210
this has made a video for because

123
00:07:17,210 --> 00:07:22,240
I'll be honest it's just not as cool as
someone

124
00:07:22,240 --> 00:07:25,530
the persistence techniques so

125
00:07:25,530 --> 00:07:29,780
in you first I just read the

126
00:07:29,780 --> 00:07:33,680
the structure that the argument that it
takes is just the

127
00:07:33,680 --> 00:07:37,150
it's like in LP by her I know it's a
monitor

128
00:07:37,150 --> 00:07:41,360
structure monitor info to structure as I
just have to bill that that structure

129
00:07:41,360 --> 00:07:43,699
with a deal that you wanna injected

130
00:07:43,699 --> 00:07:47,800
whether you want school SB load I am you
know you have to tell whether it's a

131
00:07:47,800 --> 00:07:52,699
6486 are 32-bit and then release is a
matter for calling that

132
00:07:52,699 --> 00:07:57,229
that API so it's super basic I it's not
difficult at all

133
00:07:57,229 --> 00:08:00,509
and then your deal you know this sect in
this blessed be in from there you know

134
00:08:00,509 --> 00:08:01,800
you can do whatever you want your

135
00:08:01,800 --> 00:08:07,110
your system so I'll in the demo

136
00:08:07,110 --> 00:08:11,680
cool and using you know just a a very
basic idea all it does is when he gets

137
00:08:11,680 --> 00:08:12,509
loaded

138
00:08:12,509 --> 00:08:15,789
just as output debug tool are stirring
up you know some

139
00:08:15,789 --> 00:08:19,139
some very a string so what I'm gonna do
them in a start it from the command

140
00:08:19,139 --> 00:08:21,520
prompt so you'll see me type it out

141
00:08:21,520 --> 00:08:24,550
you'll see the deal I'll get loaded
under school SBN

142
00:08:24,550 --> 00:08:29,169
Process Explorer and then I have the
debug view window pulled up see can

143
00:08:29,169 --> 00:08:31,139
simultaneously see that

144
00:08:31,139 --> 00:08:35,000
you know that our dealers loaded and
then it spring teen output there

145
00:08:35,000 --> 00:08:42,000
her so we should see

146
00:08:43,039 --> 00:08:46,220
in Process Explorer that the green one
pop up

147
00:08:46,220 --> 00:08:51,079
there's a DLL inside school SV

148
00:08:51,079 --> 00:08:54,980
and I think I switch to their

149
00:08:54,980 --> 00:08:58,190
debug you in OC can see your

150
00:08:58,190 --> 00:09:02,579
or actually no sorry so in this case
actually I used to it was just a ash

151
00:09:02,579 --> 00:09:04,029
dump deal that I made

152
00:09:04,029 --> 00:09:08,510
that injects into alsace numb so the
ashes so in this case CA you know you

153
00:09:08,510 --> 00:09:08,949
have

154
00:09:08,949 --> 00:09:13,640
on you know your system so from school s
me you can inject in any other process

155
00:09:13,640 --> 00:09:15,250
are migrating any other process

156
00:09:15,250 --> 00:09:18,410
and I just did a I'm has dumped

157
00:09:18,410 --> 00:09:23,850
on that box so

158
00:09:23,850 --> 00:09:28,569
hooker

159
00:09:28,569 --> 00:09:31,960
so

160
00:09:31,960 --> 00:09:37,030
0 let someone persistence on in Windows
what what persistence is everyone use

161
00:09:37,030 --> 00:09:40,360
in Windows if you're on a penetration
test scene persist in 20 years

162
00:09:40,360 --> 00:09:43,860
service

163
00:09:43,860 --> 00:09:48,320
okay out around keys I C H tasks

164
00:09:48,320 --> 00:09:51,980
okay startup folder

165
00:09:51,980 --> 00:09:55,610
okay here so um

166
00:09:55,610 --> 00:09:58,470
you know there's tons a persistence and
when those right now if you want to be

167
00:09:58,470 --> 00:10:00,210
cruel maybe use the app in a

168
00:10:00,210 --> 00:10:03,480
your registry key but even that's been
monitored pretty heavily by

169
00:10:03,480 --> 00:10:06,900
AB's so I am there's

170
00:10:06,900 --> 00:10:09,910
and and to be honest there's still tons
tons define I mean when does this

171
00:10:09,910 --> 00:10:10,630
beloved like

172
00:10:10,630 --> 00:10:14,160
deal hijacking techniques and and things
like that song

173
00:10:14,160 --> 00:10:17,290
com there's all kinds ever

174
00:10:17,290 --> 00:10:20,830
processes techniques and Windows from
and there's

175
00:10:20,830 --> 00:10:24,370
a few that we're gonna be talking about
today that the techniques that i use to

176
00:10:24,370 --> 00:10:28,110
find them was Process Monitor and
hooking the library service startup

177
00:10:28,110 --> 00:10:31,460
I you know windbag me and just took the

178
00:10:31,460 --> 00:10:36,500
the load library API K then every time
any process calls a library now you can

179
00:10:36,500 --> 00:10:37,550
see

180
00:10:37,550 --> 00:10:41,380
what delights trying to load and then
and you know you you can see if

181
00:10:41,380 --> 00:10:45,150
if that deal actually exist in our you
can do this essentially the same thing

182
00:10:45,150 --> 00:10:47,470
through Process Monitor you just can't
do it as well

183
00:10:47,470 --> 00:10:51,900
on bootup so and actually in in a little
bit we're gonna

184
00:10:51,900 --> 00:10:55,300
just real quickly go over Process
Monitor and user

185
00:10:55,300 --> 00:11:00,890
so I this is just a screenshot a process
monitor I know you probably can see that

186
00:11:00,890 --> 00:11:01,480
very well

187
00:11:01,480 --> 00:11:05,080
again we're gonna have a demo of its own
will cover more that then

188
00:11:05,080 --> 00:11:08,550
so the first technique is a

189
00:11:08,550 --> 00:11:12,870
was actually kind of a funny story was a
very funny at the time

190
00:11:12,870 --> 00:11:17,400
but Omkar I I found this

191
00:11:17,400 --> 00:11:21,860
technique using VMware Tools you know I
like I a year or two ago

192
00:11:21,860 --> 00:11:25,580
and basically I have to do is drop
either of those two deals TP Jen liquor

193
00:11:25,580 --> 00:11:26,310
them on

194
00:11:26,310 --> 00:11:30,590
in that directory VMware Tools installed
you know which is on a lot of boxes

195
00:11:30,590 --> 00:11:33,970
you know if any of your organization
runs beady eye

196
00:11:33,970 --> 00:11:37,780
any sort of virtualization these deals
will get loaded on booze

197
00:11:37,780 --> 00:11:42,450
awesome persistence technique right nor
no registry modifications nothing

198
00:11:42,450 --> 00:11:48,200
pretty stealthy so Def Con rolls around
I'm preparing you know my talking decide

199
00:11:48,200 --> 00:11:49,010
hey I bettered

200
00:11:49,010 --> 00:11:52,230
a better test this for the demo and a

201
00:11:52,230 --> 00:11:56,630
VMware patch day nees ex

202
00:11:56,630 --> 00:12:00,000
I 5.5 so I was running around crazy aunt

203
00:12:00,000 --> 00:12:03,040
trying to figure out forget what I was
going to do so

204
00:12:03,040 --> 00:12:06,120
I ended up not being a big deal I just
found another one

205
00:12:06,120 --> 00:12:09,470
you know it within VMware Tools so like
I said there's

206
00:12:09,470 --> 00:12:13,790
a lot of these out there on so did this
is the latest one

207
00:12:13,790 --> 00:12:18,770
and to be honest is probably more it's
just NTDs AP I dot DLL same directory

208
00:12:18,770 --> 00:12:23,090
dropper the lol their VMware Tools
installed this DLL will get loaded

209
00:12:23,090 --> 00:12:26,920
in the VMware Tools the system process
on boot I am

210
00:12:26,920 --> 00:12:31,770
and there's your system a persistence so
%um you know pretty style to the idea is

211
00:12:31,770 --> 00:12:33,800
to be a stealthy in covert is possible

212
00:12:33,800 --> 00:12:37,100
I you know it to emulate I

213
00:12:37,100 --> 00:12:41,820
an actual attacker I guess the only
limitation is that the deal has to

214
00:12:41,820 --> 00:12:44,690
export the same functions as the real in
TDS own

215
00:12:44,690 --> 00:12:48,610
just look at which functions it exports
and Richard expert the same ones

216
00:12:48,610 --> 00:12:52,490
cell harm

217
00:12:52,490 --> 00:12:56,880
yes let's do a demo on this one me this
was kinda cool in

218
00:12:56,880 --> 00:13:00,440
good

219
00:13:00,440 --> 00:13:03,920
so I would see this might be kinda
tricky

220
00:13:03,920 --> 00:13:10,920
pro

221
00:13:12,530 --> 00:13:18,710
ginseng

222
00:13:18,710 --> 00:13:25,710
hunger

223
00:13:34,080 --> 00:13:41,080
so this is the deal

224
00:13:48,850 --> 00:13:55,110
well where when he gets low

225
00:13:55,110 --> 00:13:59,430
it'll just do some output debug strings
so it is gonna drop it into

226
00:13:59,430 --> 00:14:02,519
system 32 to be your

227
00:14:02,519 --> 00:14:09,519
ok diving and cooler and TDS

228
00:14:11,510 --> 00:14:18,510
API so late

229
00:14:23,939 --> 00:14:29,499
p.m. rebooted when the login screen
comes up in a long as fast as I can so

230
00:14:29,499 --> 00:14:32,039
because it's getting loaded the system
right so it is actually wait for the

231
00:14:32,039 --> 00:14:33,220
user to login IDs

232
00:14:33,220 --> 00:14:37,049
loaded up and running within the am IBM
tools the

233
00:14:37,049 --> 00:14:44,009
study XD so the deal only prints

234
00:14:44,009 --> 00:14:47,629
you know like ten strings

235
00:14:47,629 --> 00:14:51,189
you know it only runs for like 10 or 20
seconds so that's why it's kinda a race

236
00:14:51,189 --> 00:14:52,589
condition on login

237
00:14:52,589 --> 00:14:59,589
manage should be loaded

238
00:15:11,629 --> 00:15:15,509
not that

239
00:15:15,509 --> 00:15:22,509
Mary's

240
00:15:28,249 --> 00:15:31,050
so you can see

241
00:15:31,050 --> 00:15:36,600
its it calls the run counter API its
Ryan from process 1180

242
00:15:36,600 --> 00:15:40,740
and then it just does that look like ten
or fifteen seconds officer test manager

243
00:15:40,740 --> 00:15:43,290
and wanna see what process 1180 is

244
00:15:43,290 --> 00:15:46,290
is being tools d

245
00:15:46,290 --> 00:15:51,740
on the only thing to be aware of is that
and sometimes there is a a user process

246
00:15:51,740 --> 00:15:55,240
her you 18 IBM tools the

247
00:15:55,240 --> 00:15:58,320
userspace process so you just want to
add

248
00:15:58,320 --> 00:16:01,500
you know some logic to your DLL that hey
if this is user than just

249
00:16:01,500 --> 00:16:04,529
exit out you know if I don't want
persistence is a user

250
00:16:04,529 --> 00:16:10,240
so so yeah

251
00:16:10,240 --> 00:16:14,779
that's the purse persistence good

252
00:16:14,779 --> 00:16:21,779
I'm gonna delete that beakers

253
00:16:22,640 --> 00:16:25,779
from

254
00:16:25,779 --> 00:16:29,519
answered Paso

255
00:16:29,519 --> 00:16:33,519
want you to leave if I i do. it's being
used but you can rename its own

256
00:16:33,519 --> 00:16:37,490
kinda quarter okay

257
00:16:37,490 --> 00:16:42,500
so here seven hours really what we're
doing here is we're going from good

258
00:16:42,500 --> 00:16:44,360
better best case so

259
00:16:44,360 --> 00:16:47,640
now we're moving on to the best on this
is the

260
00:16:47,640 --> 00:16:53,649
persistence technique and we're still
picking on Prince cooler

261
00:16:53,649 --> 00:16:56,760
and it's actually very similar to the
dealer

262
00:16:56,760 --> 00:17:00,600
to the deal injection technique that
monitor they see what we're doing is

263
00:17:00,600 --> 00:17:01,510
we're

264
00:17:01,510 --> 00:17:01,970
I

265
00:17:01,970 --> 00:17:05,069
I'm adding now a registry key to get our

266
00:17:05,069 --> 00:17:09,049
add monitor deal a loaded on boot miss
an illegal things we

267
00:17:09,049 --> 00:17:12,470
we can do with this game on this is the

268
00:17:12,470 --> 00:17:17,839
the location in the registry and all you
have to do is create a new key

269
00:17:17,839 --> 00:17:22,120
with the new value name driver and then
the name or the

270
00:17:22,120 --> 00:17:25,689
you know the string value have it be
that the name of the deal also the deal

271
00:17:25,689 --> 00:17:27,740
has to be in system32

272
00:17:27,740 --> 00:17:32,179
such we don't have to list the full path
you just say the name in the DLL

273
00:17:32,179 --> 00:17:35,520
the %ah something about this is you can

274
00:17:35,520 --> 00:17:39,100
add as many as you want you want by
persistence techniques

275
00:17:39,100 --> 00:17:42,720
your you know five deals to be loaded at
boot you just add

276
00:17:42,720 --> 00:17:47,049
in all five folder 5 a in our registry
keys and then each of them with with the

277
00:17:47,049 --> 00:17:47,640
value

278
00:17:47,640 --> 00:17:51,110
and I sugar quit Skype some

279
00:17:51,110 --> 00:17:54,909
com so yeah

280
00:17:54,909 --> 00:17:58,340
so let's test this out because this this
honestly is a

281
00:17:58,340 --> 00:18:01,409
approval take me on he

282
00:18:01,409 --> 00:18:08,409
so Notre Dame their

283
00:18:08,789 --> 00:18:15,789
you are acts so we're going to use the
same the loan so it's just gonna do

284
00:18:17,030 --> 00:18:20,200
somehow put the puck strings it you know
not nothing too fancy

285
00:18:20,200 --> 00:18:23,990
but than in a minute we'll test it

286
00:18:23,990 --> 00:18:29,630
with an actual back door and see how it
works so

287
00:18:29,630 --> 00:18:33,190
so I'd could name an air mess a while
ago

288
00:18:33,190 --> 00:18:36,419
so you him hermès

289
00:18:36,419 --> 00:18:42,260
I am and let's see we'll just call it
the

290
00:18:42,260 --> 00:18:49,260
see derby car Oregon not do.

291
00:18:51,049 --> 00:18:56,640
K and then it asks if you wanna load
announce a No

292
00:18:56,640 --> 00:19:01,260
okay so only have to copy the DLL to
system32 answered

293
00:19:01,260 --> 00:19:08,260
you

294
00:19:08,950 --> 00:19:13,780
K so now it's going to the registry and
see what that did

295
00:19:13,780 --> 00:19:18,130
so

296
00:19:18,130 --> 00:19:19,399
the

297
00:19:19,399 --> 00:19:23,450
demo execute what I created he creates
the

298
00:19:23,450 --> 00:19:28,019
ki called fax monitor and there's our
driver and sister be kinda deal also

299
00:19:28,019 --> 00:19:32,669
let's just for the heck of it let's do
another 1k let's do another key and more

300
00:19:32,669 --> 00:19:34,369
call this like a

301
00:19:34,369 --> 00:19:38,789
on which we call

302
00:19:38,789 --> 00:19:43,559
what what we call it

303
00:19:43,559 --> 00:19:48,649
for White Lightning good

304
00:19:48,649 --> 00:19:52,999
okay

305
00:19:52,999 --> 00:19:56,299
right click string value

306
00:19:56,299 --> 00:20:00,340
you have to name a driver and your
caller

307
00:20:00,340 --> 00:20:03,580
way lying and I can do.

308
00:20:03,580 --> 00:20:10,580
K

309
00:20:18,019 --> 00:20:22,269
in alright so now reboot the box

310
00:20:22,269 --> 00:20:28,370
again after

311
00:20:28,370 --> 00:20:32,559
boots ever gonna polity buggy was as
fast as we can so we can see that

312
00:20:32,559 --> 00:20:36,840
bottles de los amo should have to those
deals be loaded onto

313
00:20:36,840 --> 00:20:43,800
and you know have persistence the deals
are still getting over it

314
00:20:43,800 --> 00:20:47,260
in this case within school s being just
like that monitor

315
00:20:47,260 --> 00:20:54,000
your

316
00:20:54,000 --> 00:21:01,000
hand there the poker

317
00:21:31,650 --> 00:21:34,880
white line in that the oh and urban that
beyond book it lowered

318
00:21:34,880 --> 00:21:38,960
an air into their loot ten or fifteen
times and then quick

319
00:21:38,960 --> 00:21:41,940
but denies the you know you can
customize the code to do whatever you

320
00:21:41,940 --> 00:21:43,340
want I am

321
00:21:43,340 --> 00:21:46,860
I get the SE :debug:main privileges to
show you the hey we r system

322
00:21:46,860 --> 00:21:49,960
nese restore name you know basically
means the same thing

323
00:21:49,960 --> 00:21:56,960
sonke opposing her tonight thanks

324
00:21:58,670 --> 00:22:02,340
so yeah I am that is another person's
technique if

325
00:22:02,340 --> 00:22:05,950
if you want to use that instead of you
know just the generic services which is

326
00:22:05,950 --> 00:22:10,179
premature everyone uses on Rach tasks
once they get system

327
00:22:10,179 --> 00:22:13,340
much more stealthy I think

328
00:22:13,340 --> 00:22:16,420
your so

329
00:22:16,420 --> 00:22:20,790
that's good move on before we talk about
and rear

330
00:22:20,790 --> 00:22:24,040
talk about their lease a throwback I
wanted to for school over really quickly

331
00:22:24,040 --> 00:22:26,440
adjust kinda Windows APIs to be

332
00:22:26,440 --> 00:22:31,620
chichi on lot of people back on Windows
program in the Windows API personally I

333
00:22:31,620 --> 00:22:32,590
love it I think

334
00:22:32,590 --> 00:22:36,520
I think it's awesome I am makes you know
doing a lot of

335
00:22:36,520 --> 00:22:40,020
what would be complex tasks you know for
the most part pretty easy

336
00:22:40,020 --> 00:22:43,410
so there's there's two libras

337
00:22:43,410 --> 00:22:47,040
heard to AVI is it that you can use in
Windows the first one is when she to be

338
00:22:47,040 --> 00:22:48,340
the other one is when I net

339
00:22:48,340 --> 00:22:53,020
on for programming in C or I guess
PowerShell erred on it or anything for

340
00:22:53,020 --> 00:22:53,850
that matter

341
00:22:53,850 --> 00:22:59,049
on 3c to be traffic and impose on a
should be because you know if you want

342
00:22:59,049 --> 00:22:59,919
to get out of a network

343
00:22:59,919 --> 00:23:04,429
that's typically how you do it so when
she DP is intended for services

344
00:23:04,429 --> 00:23:09,090
so it doesn't have a lot of the proxy
robustness that when I net hands

345
00:23:09,090 --> 00:23:12,090
it doesn't pull users to use a proxy
settings automatically

346
00:23:12,090 --> 00:23:16,950
I'll however you know since it is a
service that does support impersonation

347
00:23:16,950 --> 00:23:20,220
and you know summer

348
00:23:20,220 --> 00:23:23,960
this this stuff its services would
normally perform

349
00:23:23,960 --> 00:23:28,360
I went on and on the other hand like I
said it is much better for

350
00:23:28,360 --> 00:23:31,590
for proxy for proxy environment on

351
00:23:31,590 --> 00:23:34,660
you know for doing something as complex

352
00:23:34,660 --> 00:23:38,679
as I want to get out of this network
that has NTLM authentication at the

353
00:23:38,679 --> 00:23:39,429
proxy

354
00:23:39,429 --> 00:23:42,520
it's one flag that you set with an API
call

355
00:23:42,520 --> 00:23:46,450
as anybody ever notice that merger
partner has problems with NTLM

356
00:23:46,450 --> 00:23:51,049
proxy authentication I set up a lab in
notice the hey you know i could get a

357
00:23:51,049 --> 00:23:52,299
matter for call back

358
00:23:52,299 --> 00:23:55,820
I you know cuz I set up in Sonoma
authentication at the proxy

359
00:23:55,820 --> 00:23:58,770
and I will look at the interpreter
sources because they're missing that one

360
00:23:58,770 --> 00:23:59,429
flag

361
00:23:59,429 --> 00:24:04,220
so adding something as complex as NTLM
authentication the proxy is as easy as

362
00:24:04,220 --> 00:24:08,010
pay add this one flag to the API call
and boom

363
00:24:08,010 --> 00:24:10,940
in the back and you know behind the
scenes Microsoft will take care the rest

364
00:24:10,940 --> 00:24:11,740
for your

365
00:24:11,740 --> 00:24:16,240
I am so it basically uses the IE
settings

366
00:24:16,240 --> 00:24:21,190
when I nat gas so

367
00:24:21,190 --> 00:24:25,350
I i explain NC your YouTube kinda better
understand I guess

368
00:24:25,350 --> 00:24:29,580
I am I thinking when I when I built
throwback throwback is a

369
00:24:29,580 --> 00:24:34,559
it was written in C plus plus it's an
HTTP HTTPS beginning back toward

370
00:24:34,559 --> 00:24:38,700
with their PHP control panel that's
rating won't yet it's written in

371
00:24:38,700 --> 00:24:44,300
PHP and MySQL on a that runs on Apache
so it was built primarily for stealth

372
00:24:44,300 --> 00:24:47,950
om I'll however don't look at the code
because

373
00:24:47,950 --> 00:24:50,750
you know and then you'll see the pipe I
we only buffer overflows all over the

374
00:24:50,750 --> 00:24:51,250
place

375
00:24:51,250 --> 00:24:55,059
his/her so I

376
00:24:55,059 --> 00:24:58,730
it also has persistence built in the
deal persistence you know it's super

377
00:24:58,730 --> 00:25:01,970
easy to utilize the deal a person so
we've already talked about

378
00:25:01,970 --> 00:25:05,590
and then as an EXE you know it persists
is mostly axes which is

379
00:25:05,590 --> 00:25:10,240
as a serviceable install such as a
service and persist that way on

380
00:25:10,240 --> 00:25:14,120
so let's go a little bit deeper into

381
00:25:14,120 --> 00:25:17,850
throwback I guess I built it you know
just be

382
00:25:17,850 --> 00:25:21,080
again I'm feeling that you know
penetration testing to be modeled after

383
00:25:21,080 --> 00:25:22,380
all the tax

384
00:25:22,380 --> 00:25:27,140
on you know in there really isn't a a
back door out there

385
00:25:27,140 --> 00:25:30,230
that can be used you know for 1st Lt
persistence

386
00:25:30,230 --> 00:25:33,710
on so this is essentially how it works

387
00:25:33,710 --> 00:25:37,240
you can install the throwback LP

388
00:25:37,240 --> 00:25:42,020
as I call it on multiple servers and
then throw back for the infected box in

389
00:25:42,020 --> 00:25:44,340
this case you know the attacker sends an
email

390
00:25:44,340 --> 00:25:49,580
to to the target throwback is embedded
in the e-mail alert you know as we're

391
00:25:49,580 --> 00:25:50,860
we're actually going to do

392
00:25:50,860 --> 00:25:55,710
we're going to infect a box to reflect
to do. injection I use in a I'm

393
00:25:55,710 --> 00:26:00,020
Metasploit export so however you decide
to get throw back on the box

394
00:26:00,020 --> 00:26:03,309
it then Bekins you know through HTTP
HTTPS

395
00:26:03,309 --> 00:26:06,470
out your throwback LP's so that's a at

396
00:26:06,470 --> 00:26:10,230
the most basic level that's how it works
some cool things about it though is

397
00:26:10,230 --> 00:26:14,080
is if you remember I did compared women

398
00:26:14,080 --> 00:26:18,000
when she 2 p.m. when I net when a shitty
P is for services right so

399
00:26:18,000 --> 00:26:21,290
I actually decided to use you can use
when I net

400
00:26:21,290 --> 00:26:25,040
in a service process but you know just
as important proxy settings very well so

401
00:26:25,040 --> 00:26:29,080
the approach that I decided to take was
I'm any use when HTTP

402
00:26:29,080 --> 00:26:32,290
and then if its running within the
service and can't get out you know if

403
00:26:32,290 --> 00:26:34,919
you can get to the internet for whatever
reason maybe they have

404
00:26:34,919 --> 00:26:38,260
you know explicit proxy settings

405
00:26:38,260 --> 00:26:41,419
at the user level and it's not set for
the system

406
00:26:41,419 --> 00:26:45,440
so what throwback does is any memory
it's all the users that have logged into

407
00:26:45,440 --> 00:26:46,550
the box

408
00:26:46,550 --> 00:26:49,590
I have fines their into user got doubt
file

409
00:26:49,590 --> 00:26:54,380
mounts that I manually finds the proxy
settings within the into using right now

410
00:26:54,380 --> 00:26:55,159
file

411
00:26:55,159 --> 00:26:58,370
and then uses those proxy settings to
get out and it will loop through all the

412
00:26:58,370 --> 00:26:59,250
users

413
00:26:59,250 --> 00:27:03,059
essentially Intel Intel can get out I am
so

414
00:27:03,059 --> 00:27:06,940
the areas that when a GDP has lacked in
I you know I tried it

415
00:27:06,940 --> 00:27:11,330
try to add some robustness there another
cool feature is

416
00:27:11,330 --> 00:27:14,830
on the LP side you can add I multiple
LP's

417
00:27:14,830 --> 00:27:18,020
so typically how how we use it on our
penetration test

418
00:27:18,020 --> 00:27:22,950
you know is again going first L will set
up five or six different LP's

419
00:27:22,950 --> 00:27:26,149
I'll throwback LP's and

420
00:27:26,149 --> 00:27:31,010
what throwback will do want to implant a
box on whatever your configurable call

421
00:27:31,010 --> 00:27:32,320
back period is

422
00:27:32,320 --> 00:27:36,350
it will randomly select one of those six
help ease the call back to you

423
00:27:36,350 --> 00:27:40,070
and see if there's any asking for so
it's not always gone back to the same

424
00:27:40,070 --> 00:27:42,149
domain it will randomize that

425
00:27:42,149 --> 00:27:45,000
I'm or if you want to go lay near you
know then you can and then you can

426
00:27:45,000 --> 00:27:47,120
choose to go later

427
00:27:47,120 --> 00:27:50,950
but you can add multiple domains I'm it
also uses a missed your PC

428
00:27:50,950 --> 00:27:55,570
I am braised greens bill to a really
easy to use

429
00:27:55,570 --> 00:27:59,200
some I missed your PC library for PHP

430
00:27:59,200 --> 00:28:02,230
so basically what you do on the LP is

431
00:28:02,230 --> 00:28:06,040
you fire Msgr PC the PHP will interface

432
00:28:06,040 --> 00:28:10,550
where Msgr PC to create Metasploit
payloads the week and then deployed

433
00:28:10,550 --> 00:28:13,720
to your you know to your target through
throwback

434
00:28:13,720 --> 00:28:17,080
and injecting the memory if you want to
get like an interpreter show on the box

435
00:28:17,080 --> 00:28:18,780
ago interactive

436
00:28:18,780 --> 00:28:23,050
comin also has rc4 encryption com so
even if you are using HTTP

437
00:28:23,050 --> 00:28:26,370
on the communications are in cryptid

438
00:28:26,370 --> 00:28:30,350
it implements reflected the low
injection both as a DLL

439
00:28:30,350 --> 00:28:33,640
and as modules that you give it

440
00:28:33,640 --> 00:28:37,770
and is also strong encryption so for
basic reverse engineering

441
00:28:37,770 --> 00:28:41,440
you know I've someone finds a deal on
just one strings on it

442
00:28:41,440 --> 00:28:44,620
then it's not gonna you know dump at all
of your your help ease that have to

443
00:28:44,620 --> 00:28:46,860
reverse engineer

444
00:28:46,860 --> 00:28:50,240
so here's what the interface looks like

445
00:28:50,240 --> 00:28:57,179
Tom so it's going to our let's do it

446
00:28:57,179 --> 00:29:03,610
alright so we have

447
00:29:03,610 --> 00:29:06,659
shared to hear that anymore

448
00:29:06,659 --> 00:29:10,550
and actually before we do this I need to
to leave his other

449
00:29:10,550 --> 00:29:17,550
persistence or a history

450
00:29:36,770 --> 00:29:43,770
her that's right persons are my

451
00:29:54,790 --> 00:30:00,360
and saying whatever name you want under
become concern

452
00:30:00,360 --> 00:30:04,020
fact so right now we don't have any
persons on the box just early

453
00:30:04,020 --> 00:30:04,740
development

454
00:30:04,740 --> 00:30:08,380
rare so for this demo

455
00:30:08,380 --> 00:30:12,500
what we're gonna do is we ever 107 box
here

456
00:30:12,500 --> 00:30:19,300
and here a resistor

457
00:30:19,300 --> 00:30:22,820
group is just a

458
00:30:22,820 --> 00:30:27,779
box o'connor

459
00:30:27,779 --> 00:30:32,090
so I'm in a load here is this

460
00:30:32,090 --> 00:30:37,639
I am resource file this is gonna happen
we have a an internal exploited

461
00:30:37,639 --> 00:30:40,580
basically leverages a a public Boehner
really wish that they did the ROP

462
00:30:40,580 --> 00:30:43,149
gadgets for the Virgin MIA that we're
going to be using

463
00:30:43,149 --> 00:30:46,200
we creatively named two girls one sport

464
00:30:46,200 --> 00:30:49,700
and so we're gonna load that

465
00:30:49,700 --> 00:30:53,480
this resource file I notice for the
payload we're going to use the deal

466
00:30:53,480 --> 00:30:56,649
inject a lot because that's because we
want to use Pro back

467
00:30:56,649 --> 00:31:00,720
with I you know as a paler we don't use
interpreter the temperature for has you

468
00:31:00,720 --> 00:31:02,129
know some niggas restrictions

469
00:31:02,129 --> 00:31:07,049
and on yes let's just say you want to
get persists on the box and said oh

470
00:31:07,049 --> 00:31:10,570
you know just trying to use an
interpreter so

471
00:31:10,570 --> 00:31:13,610
I am as organ is

472
00:31:13,610 --> 00:31:17,559
you'll also notice that even though it's
a 64 bit system I used to be 32

473
00:31:17,559 --> 00:31:21,350
that's the throwback DLL and I did that
because

474
00:31:21,350 --> 00:31:24,350
on it there's no 64-bit

475
00:31:24,350 --> 00:31:31,179
payload a deal inject and he said that I
actually runs a 32-bit processing

476
00:31:31,179 --> 00:31:35,769
so insecurities

477
00:31:35,769 --> 00:31:39,500
Derby your 30 K so there is all over

478
00:31:39,500 --> 00:31:46,500
you know explored case and I will come
back

479
00:31:47,019 --> 00:31:51,370
to this box and here we have our

480
00:31:51,370 --> 00:31:56,720
throwback LP so

481
00:31:56,720 --> 00:32:00,450
says no targets get to work so soon as
we explore some boxes we should see in

482
00:32:00,450 --> 00:32:01,389
pop up there

483
00:32:01,389 --> 00:32:06,409
so let's go in and

484
00:32:06,409 --> 00:32:09,450
which can navigate their

485
00:32:09,450 --> 00:32:14,120
make it easy 29 one tear

486
00:32:14,120 --> 00:32:20,009
K

487
00:32:20,009 --> 00:32:23,950
should be here in the background you saw
the text lie by

488
00:32:23,950 --> 00:32:27,450
setting the stage so at that point and
pushed up the you know the stager for

489
00:32:27,450 --> 00:32:27,789
the

490
00:32:27,789 --> 00:32:32,169
de lo injected which also interpreted to
reflect the deal injection on the

491
00:32:32,169 --> 00:32:33,379
throwback deal I'll

492
00:32:33,379 --> 00:32:37,460
so in a second here

493
00:32:37,460 --> 00:32:41,809
thankfully will see a box pop up there
it is

494
00:32:41,809 --> 00:32:45,299
so I a template on you can see

495
00:32:45,299 --> 00:32:48,350
a few things you know in terms of the
icons his

496
00:32:48,350 --> 00:32:52,879
this icon means that it's running the
system this icon means it is a direct

497
00:32:52,879 --> 00:32:53,490
connection

498
00:32:53,490 --> 00:32:57,409
so it will tell you whether or not
there's a proxy and the icon will change

499
00:32:57,409 --> 00:32:58,389
if it's a proxy

500
00:32:58,389 --> 00:33:02,129
that has your version of the implant are
using united that just because I was

501
00:33:02,129 --> 00:33:03,970
making so many revisions to it

502
00:33:03,970 --> 00:33:07,690
I am target-name: you know she can
change the

503
00:33:07,690 --> 00:33:11,269
the target from you know we can call at
Derby if we were

504
00:33:11,269 --> 00:33:14,889
or whatever the call victory to set to 1
minute

505
00:33:14,889 --> 00:33:18,039
I am that's just the depot call back
that I A

506
00:33:18,039 --> 00:33:21,889
made you know just so we could descend
some close-up look at so in the last

507
00:33:21,889 --> 00:33:23,570
call back was

508
00:33:23,570 --> 00:33:28,059
I you know not very long ago okay so

509
00:33:28,059 --> 00:33:31,440
were on the box well what's the first
thing you want to do when we're on the

510
00:33:31,440 --> 00:33:32,159
box

511
00:33:32,159 --> 00:33:36,570
corners with the person you want to do
we have access to a box

512
00:33:36,570 --> 00:33:39,610
they wanted you want to get a shower I
am wrong

513
00:33:39,610 --> 00:33:43,330
or persistent threats were going to all
those day let's let's get a shell for

514
00:33:43,330 --> 00:33:45,419
start

515
00:33:45,419 --> 00:33:49,840
I am so 42 admitted to go interactive

516
00:33:49,840 --> 00:33:54,619
ish click met creator and this case
world will do reflective

517
00:33:54,619 --> 00:33:58,240
her sorry we're going to show code
injection so we're gonna

518
00:33:58,240 --> 00:34:03,340
lets users reverse HTTPS that's the HTML
file that is going to create

519
00:34:03,340 --> 00:34:08,060
what it does is it on crazy show Conan
Bay 64 encoded

520
00:34:08,060 --> 00:34:13,869
and we were on the IP that is going to
call back to is twenty not one tear

521
00:34:13,869 --> 00:34:20,869
and managed to create payload care

522
00:34:24,310 --> 00:34:29,339
so was successful so it gives you a
little piece double here so

523
00:34:29,339 --> 00:34:36,339
you know free lazy people rice said

524
00:34:37,050 --> 00:34:40,190
a you just come in here

525
00:34:40,190 --> 00:34:44,960
pasted

526
00:34:44,960 --> 00:34:48,240
are and were set up okay and we're gonna
Chi

527
00:34:48,240 --> 00:34:51,899
alright because I don't I mean
technically what you could do is your

528
00:34:51,899 --> 00:34:53,819
like a task list to get the PID

529
00:34:53,819 --> 00:34:57,630
the process you want to inject into by
I'm doing it she

530
00:34:57,630 --> 00:35:01,880
and just look at the kid let's inject
into notepad plus plus

531
00:35:01,880 --> 00:35:07,530
so 2616 so come back in here

532
00:35:07,530 --> 00:35:10,609
this is the HTML file that we needed
tell it to download

533
00:35:10,609 --> 00:35:17,500
for the show code and when Jack choker

534
00:35:17,500 --> 00:35:24,089
and 2616

535
00:35:24,089 --> 00:35:29,200
and just make a bit you know will do i'd
get process list

536
00:35:29,200 --> 00:35:32,799
if you have multiple targets in on any
good at it asked multiple targets

537
00:35:32,799 --> 00:35:36,890
just click each one that you want to add
it to and

538
00:35:36,890 --> 00:35:42,670
to be cool will pop Cal to

539
00:35:42,670 --> 00:35:49,670
and

540
00:35:50,020 --> 00:35:54,220
Germany Japan I'm here how armored
trooper sessions are you there

541
00:35:54,220 --> 00:35:57,750
so what it did in the in the background
and because it calls back

542
00:35:57,750 --> 00:36:01,299
once a minute right now that I was
configured so when that minute hit a

543
00:36:01,299 --> 00:36:02,390
call back

544
00:36:02,390 --> 00:36:07,420
to grab the html file Bay 64 decoded the
HTML learned that the shellcode

545
00:36:07,420 --> 00:36:10,560
and then injected into notepad so if we
do like to get ahead

546
00:36:10,560 --> 00:36:15,030
you know where 2616 how we can now get

547
00:36:15,030 --> 00:36:19,190
prayers and you know essentially do
whatever we want on the box

548
00:36:19,190 --> 00:36:22,369
okay greater so

549
00:36:22,369 --> 00:36:25,380
when the other things we want to do is I
am

550
00:36:25,380 --> 00:36:29,020
you know someone mentioned get
persistence case or so let's do that

551
00:36:29,020 --> 00:36:33,180
so let's down mood

552
00:36:33,180 --> 00:36:40,180
trial I am in this case will call it TV
64 dodi lol

553
00:36:40,470 --> 00:36:44,280
which is just the 64-bit version of the
throwback deal

554
00:36:44,280 --> 00:36:47,530
and we're gonna put in system32

555
00:36:47,530 --> 00:36:51,670
on for callers

556
00:36:51,670 --> 00:36:57,540
for a record deal I'll

557
00:36:57,540 --> 00:37:03,790
her wrong that looks good

558
00:37:03,790 --> 00:37:10,420
are attracts like that her

559
00:37:10,420 --> 00:37:17,420
you

560
00:37:27,770 --> 00:37:31,980
stranded in this text file to make it
easy

561
00:37:31,980 --> 00:37:35,680
this is how you add the home position
and owners don't know

562
00:37:35,680 --> 00:37:38,700
that's right was change it

563
00:37:38,700 --> 00:37:42,829
so this command is basic one at the
registry keys that we need to maintain

564
00:37:42,829 --> 00:37:45,369
persistence

565
00:37:45,369 --> 00:37:50,220
so we called throwback got to go

566
00:37:50,220 --> 00:37:54,130
and again it's in this case it's max
monitor

567
00:37:54,130 --> 00:38:00,319
okay so submit that

568
00:38:00,319 --> 00:38:07,319
here's our cow

569
00:38:07,349 --> 00:38:12,359
you okay and already downloaded are
throwback deal I was right there in

570
00:38:12,359 --> 00:38:14,060
system32

571
00:38:14,060 --> 00:38:17,140
and if it's not here right now it should
be very soon

572
00:38:17,140 --> 00:38:21,400
hope it's not there yet so it must

573
00:38:21,400 --> 00:38:26,060
you can click on history and see the
results so yes who hasn't called back is

574
00:38:26,060 --> 00:38:30,170
waiting for delivery the throwback the
lol download was successful

575
00:38:30,170 --> 00:38:33,200
here's our process last year you can go
back and see the results of all the

576
00:38:33,200 --> 00:38:37,280
tasks that you did you happen and it's
executed

577
00:38:37,280 --> 00:38:41,180
so if you click on history now it's that
should be done when it when it calls

578
00:38:41,180 --> 00:38:41,930
back

579
00:38:41,930 --> 00:38:45,849
once it will call back until all the
tasks that it's called back to complete

580
00:38:45,849 --> 00:38:46,470
our

581
00:38:46,470 --> 00:38:51,760
are done

582
00:38:51,760 --> 00:38:55,130
action I may have mister her

583
00:38:55,130 --> 00:39:00,339
nope there it is so it's gone so if we
go into inner

584
00:39:00,339 --> 00:39:05,099
here there's any registry key with the
driver throwback DLL

585
00:39:05,099 --> 00:39:08,760
correct because they're so just to test
it

586
00:39:08,760 --> 00:39:15,760
that's restart

587
00:39:26,310 --> 00:39:30,799
I would anyone session 0

588
00:39:30,799 --> 00:39:34,130
0

589
00:39:34,130 --> 00:39:37,480
all yet so what it does was like each
time that it

590
00:39:37,480 --> 00:39:41,450
that it calls back it establishes a new
HTTPS session

591
00:39:41,450 --> 00:39:46,599
so it's not like one continuous it
doesn't like maintained HTTPS connection

592
00:39:46,599 --> 00:39:51,299
its you know it the again it's kinda
design for stealth so it's not going to

593
00:39:51,299 --> 00:39:55,200
you know stay connected for lengthy
periods of time army calls back

594
00:39:55,200 --> 00:40:00,410
once however often you tell it to sort
this case I was I said it to a minute

595
00:40:00,410 --> 00:40:03,700
I am and

596
00:40:03,700 --> 00:40:07,859
as long as there's tasking will continue
to to call back and complete each task

597
00:40:07,859 --> 00:40:11,040
if there's nothing that I just called
back once you known for the minute and

598
00:40:11,040 --> 00:40:13,930
then I'll call back in the next minute

599
00:40:13,930 --> 00:40:16,970
so as to call back was 8:39 a.m. obvious

600
00:40:16,970 --> 00:40:21,410
obviously having a call back once a
minute is horrible OPSEC rare

601
00:40:21,410 --> 00:40:25,140
I and it just called you can see just
the last call back was just updated so

602
00:40:25,140 --> 00:40:28,460
we have persistence the targets to
calling back we still have control over

603
00:40:28,460 --> 00:40:29,130
it

604
00:40:29,130 --> 00:40:32,640
it's running the system so yeah if we
want to have better

605
00:40:32,640 --> 00:40:35,480
you know up second you know we're
probably changes depending on whether or

606
00:40:35,480 --> 00:40:37,670
not we wanted to use that are going are
active

607
00:40:37,670 --> 00:40:43,510
you know we can change is delayed you
know sixty sixty minutes

608
00:40:43,510 --> 00:40:48,549
so in a min will call back see that you
want to update their call back time now

609
00:40:48,549 --> 00:40:53,880
you know updated to 60 minutes on a call
back again for an hour

610
00:40:53,880 --> 00:40:57,010
and some the other tasks in the things
you can do with their are up

611
00:40:57,010 --> 00:40:59,960
you know as the upgrade functionality
download an excuse shellcode which were

612
00:40:59,960 --> 00:41:00,839
used

613
00:41:00,839 --> 00:41:04,619
download XQ DLL EXE obviously concerning
the command

614
00:41:04,619 --> 00:41:08,270
netstat do things like that so in terms
of functionality I

615
00:41:08,270 --> 00:41:11,529
it was it was intentionally made you
know to be small

616
00:41:11,529 --> 00:41:15,470
and to be stealthy for functionality you
know typically you want to use

617
00:41:15,470 --> 00:41:19,380
a full-blown Ratna like beginner I'm

618
00:41:19,380 --> 00:41:22,490
interpreter erred you know something
like that so

619
00:41:22,490 --> 00:41:27,400
on I have started to add in you know the
ability to add modules to the LP

620
00:41:27,400 --> 00:41:30,500
so if you have like your own custom
reflected DLL that you want to deploy

621
00:41:30,500 --> 00:41:33,190
the box you know such as like a
keylogger

622
00:41:33,190 --> 00:41:38,170
for a custom back toward that you can
you know that's just a reflective DLL

623
00:41:38,170 --> 00:41:41,890
use that as a module and then you come
here to

624
00:41:41,890 --> 00:41:46,609
deploying module and there's no module
sounds was not going to play it by and

625
00:41:46,609 --> 00:41:49,140
then you can inject that module into a
process

626
00:41:49,140 --> 00:41:54,330
so I'll you know that's probably the
best way to extend functionality in his

627
00:41:54,330 --> 00:41:57,020
sister marshals

628
00:41:57,020 --> 00:42:01,819
so

629
00:42:01,819 --> 00:42:05,349
you so going forward

630
00:42:05,349 --> 00:42:09,010
on your PC to community projects
available now on get higher up

631
00:42:09,010 --> 00:42:12,330
I like I said I've our Easter started to
create some other modules

632
00:42:12,330 --> 00:42:15,470
but you are gonna meet at Ashdown you
know things like that they would be very

633
00:42:15,470 --> 00:42:16,410
hard at all

634
00:42:16,410 --> 00:42:19,960
you just have to recreate them as a
reflective DLL which

635
00:42:19,960 --> 00:42:23,330
I you know is already included in like
them as we project anyways and then you

636
00:42:23,330 --> 00:42:24,980
just did deploy it through

637
00:42:24,980 --> 00:42:28,880
on through the interfaces we saw
additional persistence techniques

638
00:42:28,880 --> 00:42:32,529
I and I think it also be cool &
modification calms

639
00:42:32,529 --> 00:42:36,069
you know I see so if its flag once a
dozen continually be flagged you can

640
00:42:36,069 --> 00:42:39,589
you can make it more malleable on which
is a a cool feature called what's

641
00:42:39,589 --> 00:42:41,609
striking

642
00:42:41,609 --> 00:42:45,240
so I'll the end slashed shame shame as
blood

643
00:42:45,240 --> 00:42:49,260
com if you're interested in writing this
these types the back doors and custom

644
00:42:49,260 --> 00:42:50,020
out where

645
00:42:50,020 --> 00:42:53,569
you know even like taking other peoples
custom code and tweaking it for your own

646
00:42:53,569 --> 00:42:54,779
purposes

647
00:42:54,779 --> 00:42:59,430
and we're I'd will have a training it's
called Dark Side of scutum penetration

648
00:42:59,430 --> 00:43:00,319
testing

649
00:43:00,319 --> 00:43:04,260
it will be a black cat Europe on and
he's coached rains

650
00:43:04,260 --> 00:43:08,799
so a you know and we don't really focus
on

651
00:43:08,799 --> 00:43:12,119
you know you have to be /c expert I'm
different now to see expert

652
00:43:12,119 --> 00:43:14,930
ice just you know a lot of it is just
tweaking what's already out there and

653
00:43:14,930 --> 00:43:15,390
what's

654
00:43:15,390 --> 00:43:18,700
openly available to you to create
something custom

655
00:43:18,700 --> 00:43:22,480
you know I did to use it for you know a
customer that

656
00:43:22,480 --> 00:43:26,630
on you know may want more a real attack

657
00:43:26,630 --> 00:43:30,020
another cool project is black squirrel
I'm involved in that

658
00:43:30,020 --> 00:43:34,460
and again sorry security and we do a lot
of black box much redeeming

659
00:43:34,460 --> 00:43:39,339
happen testing so any without any
questions

660
00:43:39,339 --> 00:43:46,339
yeah or go

661
00:43:49,339 --> 00:43:56,339
for for what

662
00:43:59,000 --> 00:44:02,290
oMG you mean like for persistence like
what I focus on Prince

663
00:44:02,290 --> 00:44:07,589
print spooler arm I focus on print
spooler

664
00:44:07,589 --> 00:44:11,569
on you know I was actually kinda looking
through MSDN

665
00:44:11,569 --> 00:44:14,900
has I like to do in my spare time

666
00:44:14,900 --> 00:44:18,599
I hand I just found your like these

667
00:44:18,599 --> 00:44:21,549
these different add functions in you
know there's like an ad monitored Lee

668
00:44:21,549 --> 00:44:22,549
monitor

669
00:44:22,549 --> 00:44:27,029
and on that's just kind of got what got
me started going down the rabbit hole

670
00:44:27,029 --> 00:44:30,720
and school SV is an older process I
figured hey there's probably a lot a

671
00:44:30,720 --> 00:44:32,299
legacy code in there

672
00:44:32,299 --> 00:44:35,549
you know it's been around for a long
time so you know

673
00:44:35,549 --> 00:44:39,700
printers amending you know since I
windows 3.1 even before that

674
00:44:39,700 --> 00:44:43,480
so I think you know that there might be
a good place to look for persistence and

675
00:44:43,480 --> 00:44:46,000
you know the person MP Isaac could be
abused

676
00:44:46,000 --> 00:44:49,400
sewn that's what initially started
there's no doubt that there's other

677
00:44:49,400 --> 00:44:54,359
you know similar API's within Windows
when is kinda black box when it comes to

678
00:44:54,359 --> 00:45:00,029
a lot of its API's especially
undocumented ones

679
00:45:00,029 --> 00:45:05,400
some rapid go

680
00:45:05,400 --> 00:45:09,190
go

681
00:45:09,190 --> 00:45:12,529
yeah it works there

682
00:45:12,529 --> 00:45:16,250
yeah so there the traffic is all rc4

683
00:45:16,250 --> 00:45:19,250
in cryptid so even though it's been an
SSL tunnel

684
00:45:19,250 --> 00:45:22,859
its rc4 encryption and a 64 encoded as
well

685
00:45:22,859 --> 00:45:26,819
and so they would have to have something
extremely custom to

686
00:45:26,819 --> 00:45:31,660
you know on to detect that that IP
traffic

687
00:45:31,660 --> 00:45:35,920
and it's all done through you known
generic looking posting gets anyways so

688
00:45:35,920 --> 00:45:41,010
it was designed you know to look as as
normal as possible

689
00:45:41,010 --> 00:45:44,750
yeah I mean at in terms of what

690
00:45:44,750 --> 00:45:47,859
you know throwbacks going up against its
gonna be against you know fire I

691
00:45:47,859 --> 00:45:51,080
a lot of you know really expensive you
know

692
00:45:51,080 --> 00:45:54,799
when vendor tools are supposed to catch
this kinda stuff

693
00:45:54,799 --> 00:46:00,690
and it flies right by some we use it on
pretty much every engagement that we do

694
00:46:00,690 --> 00:46:04,700
so it's pretty effective it get into
networks

695
00:46:04,700 --> 00:46:08,849
after said

696
00:46:08,849 --> 00:46:14,869
you'll

697
00:46:14,869 --> 00:46:18,210
in all so the

698
00:46:18,210 --> 00:46:22,240
the last one that we demo the one just
now that works for anything

699
00:46:22,240 --> 00:46:25,750
so that does not that has 0 limitations
it works

700
00:46:25,750 --> 00:46:29,579
I'm interested on 2k12 but I know it
works on Windows 8's on getting worse on

701
00:46:29,579 --> 00:46:30,900
2k12 as well

702
00:46:30,900 --> 00:46:34,430
so I do is install that registry key at
the driver

703
00:46:34,430 --> 00:46:37,849
with a strained you know with the value
pointing to the DLL and you have system

704
00:46:37,849 --> 00:46:39,760
persistence

705
00:46:39,760 --> 00:46:45,170
so there's no limitations on their

706
00:46:45,170 --> 00:46:48,390
any questions alright well thanks guys
for coming

