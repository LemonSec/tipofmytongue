1
00:00:00,000 --> 00:00:04,140
alright cool i think it's about noon

2
00:00:05,069 --> 00:00:12,509
this is anti forensics AF if you're here
for a different talk or something cooler

3
00:00:12,509 --> 00:00:17,070
than anti-french 6af you can go to one
of the other color talks or stay here

4
00:00:17,070 --> 00:00:18,930
choose-your-own-adventure that's cool

5
00:00:18,930 --> 00:00:24,930
my name isn't a TI the rapper in dual
core I've done a number of anti

6
00:00:24,930 --> 00:00:27,630
forensics talks here at Derby condom
very happy to be back

7
00:00:27,630 --> 00:00:31,859
I this is just like a bunch of truly
stuff like I get on the computer and I'm

8
00:00:31,859 --> 00:00:38,520
like what happens if I do this so um so
first we're going to talk about some

9
00:00:38,520 --> 00:00:44,040
memory forensic stuff and basically from
the point of being a malware author or

10
00:00:44,040 --> 00:00:48,239
like an attacker on a system and you've
got your malware running you want to

11
00:00:48,239 --> 00:00:53,370
maintain on the system without being
acquired or analyzed it so to do that

12
00:00:53,370 --> 00:00:57,030
we're gonna use some self-modifying code
and we'll look at an example with the

13
00:00:57,030 --> 00:01:00,359
windows and linux and then i will talk
about some android stuff

14
00:01:00,359 --> 00:01:08,340
Oh which reminds me I might need my
android phone I should have kept that um

15
00:01:08,340 --> 00:01:13,080
and then I got some really cool stuff
we're gonna play CTF CTF with the SD

16
00:01:13,080 --> 00:01:17,729
cards and it's super fun it's like a
really cool trick I found that I don't

17
00:01:17,729 --> 00:01:22,380
think many people have seen oh thank you
shall take you to make noise for you to

18
00:01:22,380 --> 00:01:23,610
please

19
00:01:23,610 --> 00:01:38,189
alright cool so I'm just lots of fun
random stuff so this is my like Who am I

20
00:01:38,189 --> 00:01:42,600
page or whatever I don't do forensics
for a living i'm on a red team i come

21
00:01:42,600 --> 00:01:46,408
from a reverse engineering and malware
background i love to just mess around

22
00:01:46,409 --> 00:01:51,240
and see what happens so it's a troll
part I've had some really interesting

23
00:01:51,240 --> 00:01:55,798
troll experiences with some three-letter
agencies like the FBI and most recently

24
00:01:55,799 --> 00:01:59,850
the NSA if you want to talk to me about
that some other time I'd be happy to

25
00:01:59,850 --> 00:02:03,719
talk about it i'm not an expert at all i
like I said just mess around so your

26
00:02:03,719 --> 00:02:06,658
mileage may vary and pretty much like
all the cool things I've learned to do

27
00:02:06,659 --> 00:02:08,250
with computers are illegal

28
00:02:08,250 --> 00:02:11,250
so do illegal things

29
00:02:12,360 --> 00:02:21,780
ok so are our focus on the memory
friends excited things is that we are an

30
00:02:21,780 --> 00:02:26,580
operator or an attacker on a victim
system we've got our own malware that

31
00:02:26,580 --> 00:02:30,720
we've built so we've invested a lot of
time in our own toolchain customizing

32
00:02:30,720 --> 00:02:34,830
making stuff that's never been seen
before we are potentially apt and we

33
00:02:34,830 --> 00:02:38,490
want to persist in for detection so we
don't want him out where to get picked

34
00:02:38,490 --> 00:02:39,060
up

35
00:02:39,060 --> 00:02:44,220
we don't want to get acquired we don't
want it to get analized so we're going

36
00:02:44,220 --> 00:02:50,370
to work against that and so we all know
like last 10 years or so like the

37
00:02:50,370 --> 00:02:54,150
hottest has been memory forensics write
like this basic forensics is dead so

38
00:02:54,150 --> 00:02:56,940
we're gonna leverage that to our
advantage

39
00:02:56,940 --> 00:02:59,370
alright we're going to take advantage of
the fact that we can do some cool things

40
00:02:59,370 --> 00:03:09,420
in memory on that help us as an attacker
so in the example of malware on disk you

41
00:03:09,420 --> 00:03:13,170
have a bunch of sections in your
executable file and to get from disk

42
00:03:13,170 --> 00:03:17,429
into memory you need all those sections
all the analysis tools also need those

43
00:03:17,430 --> 00:03:21,180
sections but once we're in memory we may
not necessarily need them so we're gonna

44
00:03:21,180 --> 00:03:26,489
we're gonna take advantage of that so
it's pretty cool like by manipulating

45
00:03:26,489 --> 00:03:31,830
our executables in memory we can totally
troll the analysis tools and have a good

46
00:03:31,830 --> 00:03:35,040
time

47
00:03:35,040 --> 00:03:45,149
wha so I this is a program that i made
called the keys are like right next to

48
00:03:45,150 --> 00:03:49,769
each other now it's taken from vascular
quote and actually this is pretty much i

49
00:03:49,769 --> 00:03:53,519
think the last demo that i left off
within my last Derby con talk but I ran

50
00:03:53,519 --> 00:03:56,880
it under XP is a few years ago so i was
just curious to see like does this work

51
00:03:56,880 --> 00:04:01,109
in windows 10 so in this case we're
going to use recall which is a free

52
00:04:01,110 --> 00:04:04,080
framework from google for doing memory
forensics pretty dope if you haven't

53
00:04:04,080 --> 00:04:13,680
checked it out a plus plus plus would
recommend would clone get repository so

54
00:04:13,680 --> 00:04:21,418
let's see we've got on there's our
malware is just running just doing evil

55
00:04:21,418 --> 00:04:24,900
stuff as it does now

56
00:04:25,740 --> 00:04:30,630
oh ok

57
00:04:30,630 --> 00:04:36,060
in a separate tab let's let's run recall
or less

58
00:04:36,060 --> 00:04:43,590
sorry please win p.m. first and this is
gonna do our acquisition of ram and now

59
00:04:43,590 --> 00:04:46,859
this this takes a while so I thought I'd
play video for you guys

60
00:04:46,860 --> 00:04:52,440
while we wait I found this series
recently called you suck at cooking and

61
00:04:52,440 --> 00:04:54,870
it's kinda cool

62
00:04:54,870 --> 00:05:01,650
it's almost like the like howtobasic
videos but like put some dry humor so

63
00:05:01,650 --> 00:05:09,179
without further further ado this is how
to cook corn on the cob chucking it's a

64
00:05:09,180 --> 00:05:13,560
fancy word for peeling and how you suck
as a personal choice the traditional

65
00:05:13,560 --> 00:05:18,090
method is to grab the husk and shutdown
word repeat this motion until the call

66
00:05:18,090 --> 00:05:20,638
this husk free you can also up check it

67
00:05:20,639 --> 00:05:24,000
these methods are hard work and you end
up checking yourself silly so consider

68
00:05:24,000 --> 00:05:29,820
trying the Gulf shock cord or you can
try playing Chuck Benton or you can use

69
00:05:29,820 --> 00:05:34,199
a comprehensive spinning wheel dual
momentum shock system where you can back

70
00:05:34,199 --> 00:05:38,639
a check it you can throw it against a
rock groups don't throw it against a

71
00:05:38,639 --> 00:05:41,960
rock or if you're quick enough you could
do the Falcon Chuck

72
00:05:41,960 --> 00:05:47,659
the Shopatron six is new technology
that's based on particle theory and

73
00:05:47,660 --> 00:05:53,360
magic you just slide it through there
and just make sure to wash the particles

74
00:05:53,360 --> 00:05:57,050
off of your core and after his particles
aren't good for you and if you don't

75
00:05:57,050 --> 00:06:00,979
like corn on the cob you can take a
hammer and get corn off the cob where

76
00:06:00,979 --> 00:06:04,490
you can buy this corn had been
developing with Monsanto it's a complex

77
00:06:04,490 --> 00:06:07,520
corn in the way we make it is through
genetic engineering

78
00:06:07,520 --> 00:06:11,359
it's perfectly healthy and safe we're
pretty sure where you can start scoring

79
00:06:11,360 --> 00:06:14,870
sausage wasn't making it looks and
tastes like real turkey sausage and the

80
00:06:14,870 --> 00:06:20,180
way we make that is by having a turkey
for cob of corn to cook for a lot of

81
00:06:20,180 --> 00:06:23,900
people think you just feel the polit
water boil the water throw in the corn

82
00:06:23,900 --> 00:06:27,349
add some salt let it cook for a few
minutes and then it's done in those

83
00:06:27,349 --> 00:06:32,479
people are correct . buttered corn is
also a personal rookies will use a knife

84
00:06:32,479 --> 00:06:36,020
which is a sloppy way to go about it and
it leaves your corn tasting like butter

85
00:06:36,020 --> 00:06:40,520
and metal this is the classic way just
gently roll your copy the butter until

86
00:06:40,520 --> 00:06:45,169
it's coded more advanced way is to take
a slab of butter and caramel corn hole

87
00:06:45,169 --> 00:06:46,159
and decide

88
00:06:46,159 --> 00:06:49,330
slide your comment to the cornhole and
twist it while moving in

89
00:06:49,330 --> 00:06:53,199
no to your car is completely coated with
butter if your corn hole isn't big

90
00:06:53,199 --> 00:06:53,740
enough

91
00:06:53,740 --> 00:06:57,669
gently twist it with perseverance until
it slides through easily you can also

92
00:06:57,669 --> 00:07:02,020
stick butter on some tongs take those to
a broom handle and butter your corn from

93
00:07:02,020 --> 00:07:02,889
a distance

94
00:07:02,889 --> 00:07:06,879
this is a great technique if you suffer
from a strong fear of corn butter corn

95
00:07:06,879 --> 00:07:10,960
can be slippery so be sure to attach a
handle like this 2.71 a Phillips

96
00:07:10,960 --> 00:07:15,609
screwdriver i just made up the 2.71 a
pursed but yeah that's corn on the cob

97
00:07:15,610 --> 00:07:20,379
and it's more delicious and corn on the
log or corn in the bog or corn on the

98
00:07:20,379 --> 00:07:25,719
saw for corn on the dog or corn in the
fog or corn on the job or corn in the

99
00:07:25,719 --> 00:07:30,280
clog or corn on Bob for corn on the slob
which is the same thing get your shit

100
00:07:30,280 --> 00:07:34,388
together but seriously and it's
obviously best eaten as corn on the cob

101
00:07:34,389 --> 00:07:39,520
and if you're sick a corn consider all
right so that's you suck at cooking

102
00:07:40,779 --> 00:07:56,680
oh good in our acquisitions . in re
alright so let's run recall and let's

103
00:07:56,680 --> 00:08:03,580
pass it is our acquisition file . AFF
for it's like its own format but recall

104
00:08:03,580 --> 00:08:05,258
understands it so it's good

105
00:08:05,259 --> 00:08:08,919
basically what you get is this ipython
notebook workspace right it's pretty

106
00:08:08,919 --> 00:08:13,628
dope like I don't have to anybody's
ipython but it totally changed my life

107
00:08:13,629 --> 00:08:20,830
before it was just me python so what
we're going to do is use a product .

108
00:08:20,830 --> 00:08:26,440
module inside of recall and like if
you've ever used volatility for memory

109
00:08:26,440 --> 00:08:30,129
forensics to extract a process you need
to find them the pit first right

110
00:08:30,129 --> 00:08:33,729
in this case we can just say oh yeah the
process looks something like this

111
00:08:34,240 --> 00:08:39,698
the keys and then we can just specify
the dump directory and all of this is

112
00:08:39,698 --> 00:08:42,880
like to have completed just like ipython
stuff is which is super nice

113
00:08:47,949 --> 00:08:49,459
alright

114
00:08:49,460 --> 00:08:53,930
looks like our directory dumped all
right hope or no did not didn't like

115
00:08:53,930 --> 00:08:58,459
that maybe i should are using tab
completion

116
00:09:04,640 --> 00:09:09,920
I'll come on out totally right did

117
00:09:15,080 --> 00:09:29,180
oh I forgot a comma Shh your shit
together and katie alright cool so I was

118
00:09:29,180 --> 00:09:33,739
doing that let's let's look at what the
original program looks like alright so

119
00:09:33,740 --> 00:09:38,900
hey I'm i found something weird on this
on the system like what you know what's

120
00:09:38,900 --> 00:09:40,970
echo 22 and see what's up

121
00:09:40,970 --> 00:09:47,180
so you know what

122
00:09:48,260 --> 00:09:56,180
so this is you know

123
00:09:56,180 --> 00:10:01,430
normal normal idea pro load the program
in looks legit right you get a cool call

124
00:10:01,430 --> 00:10:04,880
function graph function names are all
all good everything good

125
00:10:05,480 --> 00:10:14,480
alright cool so now let's take a look at
our dumped executable so here's our

126
00:10:14,480 --> 00:10:20,900
dumped executable doesn't doesn't really
like recognize it this let's just go

127
00:10:20,900 --> 00:10:24,980
with the default see what happens at
that doesn't look right

128
00:10:25,610 --> 00:10:31,130
notice we've got like a lot fewer sub
functions on the side these instructions

129
00:10:31,130 --> 00:10:38,060
don't look right there like 16 bit
strange right if you're in our analyst

130
00:10:38,060 --> 00:10:41,000
and this is what you get to to work with
is your starting point you're gonna be

131
00:10:41,000 --> 00:10:42,200
like WTF mate

132
00:10:42,200 --> 00:10:46,730
like what is this i and III don't know
about you guys I don't know any i

133
00:10:46,730 --> 00:10:49,820
personally don't know any forensics
examiner's that no idea well enough to

134
00:10:49,820 --> 00:10:56,990
go through and start marking things code
and put the time in but if we go back to

135
00:10:56,990 --> 00:10:59,750
our original

136
00:10:59,750 --> 00:11:06,140
tab are now we're still running right so
we're so doing evil stuff so we thought

137
00:11:06,140 --> 00:11:13,880
analysis and that's you know it's pretty
cool so yay attackers win and uh let's

138
00:11:13,880 --> 00:11:26,240
let's take a look at the source because
pretty easy so uh this is very like

139
00:11:26,240 --> 00:11:32,420
basic proof-of-concept we get a handle
to the process make sure that we're

140
00:11:32,420 --> 00:11:38,630
dealing with the windows executable here
so here's our checks for 45 AMS . stub

141
00:11:38,630 --> 00:11:47,390
and then 15 all the P header part
process the the sections means virtual

142
00:11:47,390 --> 00:11:52,100
protect to add write permissions on to
the the header of the executable file in

143
00:11:52,100 --> 00:11:56,000
memory and we're going to call Artie l0
memory this is like the thing that does

144
00:11:56,000 --> 00:12:00,920
the special sauce and what it does is it
just writes zeros into the header in

145
00:12:00,920 --> 00:12:05,599
memory so that makes it so that when you
grab the executable out you just get

146
00:12:05,600 --> 00:12:11,300
like no information about what your
rights are we restored the page

147
00:12:11,300 --> 00:12:14,630
permissions with virtual protect and
then here we just loop for

148
00:12:14,630 --> 00:12:21,439
proof-of-concept demo purposes any
questions at all about the keys are like

149
00:12:21,440 --> 00:12:22,640
right next to each other

150
00:12:22,640 --> 00:12:32,780
yes in the back I

151
00:12:33,649 --> 00:12:38,959
I about the question is about volatility
plugins and there is a practical plugin

152
00:12:38,959 --> 00:12:45,559
in volatility when I did it in XP it
also failed and so I recall with the new

153
00:12:45,559 --> 00:12:49,610
hotness and so I just built the demo for
recall in this particular case I haven't

154
00:12:49,610 --> 00:12:54,439
tested it for the if like against New
volatility in windows so it it might

155
00:12:54,439 --> 00:12:57,769
have better success i just tested
against recalls like a google smart pros

156
00:12:57,769 --> 00:13:01,040
like should probably work and then it
didn't sound like a good job me

157
00:13:09,259 --> 00:13:32,059
mhm yeah when I did in in windows in my
last demo like an XP it i won against

158
00:13:32,059 --> 00:13:36,079
volatility and will actually do a demo
against volatility and linux and spoiler

159
00:13:36,079 --> 00:13:47,269
alert when again so yeah so again this
is a we don't need the PE header after

160
00:13:47,269 --> 00:13:50,360
we've loaded we can do whatever we want

161
00:13:50,360 --> 00:13:54,709
if you really want to have some fun try
writing weird values into the PE header

162
00:13:54,709 --> 00:13:59,359
and then loading your dumped executable
into analysis tools you might get some

163
00:13:59,360 --> 00:14:03,829
crashes with some interesting values and
some registers just if you're into that

164
00:14:03,829 --> 00:14:08,689
kind of stuff so pretty neat we win in
this is worked all the way from Windows

165
00:14:08,689 --> 00:14:15,709
XP up into windows 10 for completeness
this is these are the commands that I

166
00:14:15,709 --> 00:14:19,160
that Iran if anybody wants to like take
a picture of the screen but it's pretty

167
00:14:19,160 --> 00:14:23,089
straightforward it's just when p.m. to
acquire the ram and then recall against

168
00:14:23,089 --> 00:14:26,809
the acquisition and then run the
practice module inside of recall

169
00:14:30,200 --> 00:14:40,700
alright so let's write in linux and will
go against volatility and we'll use line

170
00:14:40,700 --> 00:14:43,940
for the acquisition which is an
open-source Colonel Colonel driver

171
00:14:43,940 --> 00:14:51,560
password is my log luggage combination

172
00:14:52,550 --> 00:14:57,829
alright so here's our inexperience so we
found RL fetter this is just debugging

173
00:14:57,830 --> 00:15:02,330
output you could do whatever you want
here so now we're doing evil stuff as we

174
00:15:02,330 --> 00:15:05,600
do

175
00:15:05,600 --> 00:15:17,750
alright so cool

176
00:15:18,380 --> 00:15:21,380
let's go yeah let's get line first

177
00:15:22,910 --> 00:15:34,040
cool we have a build if you want to
build line for your kernel version you

178
00:15:34,040 --> 00:15:39,949
just run make should build straightaway
so I we need to load my lime into memory

179
00:15:39,950 --> 00:15:55,310
so we can do an acquisition and there's
a couple argument specifies so first you

180
00:15:55,310 --> 00:16:00,770
tell it where your path is to store the
acquisition so let's just tell it like a

181
00:16:00,770 --> 00:16:04,670
little outline and under temp and then
you can specify format i think the

182
00:16:04,670 --> 00:16:08,360
options are like climbin draw the
volatility understands the line format

183
00:16:08,360 --> 00:16:10,220
so we'll just do that

184
00:16:10,220 --> 00:16:20,120
5500 from the password is getting ok
cool so we should have our our Ram

185
00:16:20,120 --> 00:16:27,320
acquisition cool and again now we're
still running so now we're should be in

186
00:16:27,320 --> 00:16:28,910
there somewhere we can grab it

187
00:16:28,910 --> 00:16:36,530
so let's see

188
00:16:37,960 --> 00:16:44,410
I'm not gonna go in-depth on showing
slides another there's a caveat with

189
00:16:44,410 --> 00:16:48,760
volatility on linux it doesn't come with
a profile for your build of linux so you

190
00:16:48,760 --> 00:16:51,760
have to build your own profile for any
system that you're going to be doing

191
00:16:51,760 --> 00:16:55,150
memory analysis on a pretty
straightforward process and will cover

192
00:16:55,150 --> 00:16:58,689
it in the slides rather than walking
through here in the demo you just get to

193
00:16:58,690 --> 00:17:06,250
the cool stuff so you can test it if you
got it by doing something like this

194
00:17:06,250 --> 00:17:11,859
use the cash inflow inflow flags and
then just grab for linux and then I'll

195
00:17:11,859 --> 00:17:14,949
tell you gotta show your profile once
you've installed it

196
00:17:14,950 --> 00:17:19,630
alright so let's let's get our malware
program because we know that attackers

197
00:17:19,630 --> 00:17:39,610
are on the system we have to specifier
profile volatility so it knows how to do

198
00:17:39,610 --> 00:17:45,490
the thing and first let's like i said
earlier we have to get the process

199
00:17:45,490 --> 00:17:50,020
listening or the the pit for your target
process that you want to dump so here's

200
00:17:50,020 --> 00:18:04,600
our pick of 22 21 when we use the
product module and specifier pit 21 then

201
00:18:04,600 --> 00:18:09,040
ignore the storm stuff it's just I don't
have those modules installed

202
00:18:09,820 --> 00:18:13,780
ok cool looks like we gotta dump all
right blue team is winning

203
00:18:13,780 --> 00:18:18,610
here we go text dump it

204
00:18:19,120 --> 00:18:29,080
oh we didn't get anything or how big is
that the process that we don't all its 0

205
00:18:29,080 --> 00:18:32,080
bytes want long

206
00:18:32,830 --> 00:18:38,889
empty a and are now we're still doing
evil stuff

207
00:18:39,460 --> 00:18:42,460
good job red team whoo

208
00:18:43,029 --> 00:18:58,539
so basically the same same setup going
on here we basically find our header in

209
00:18:58,539 --> 00:19:03,760
memory the way i do this is really bad
and I should feel bad but it's easy and

210
00:19:03,760 --> 00:19:08,260
it works so i'm just using proc self
maps and you might be on a system that

211
00:19:08,260 --> 00:19:12,460
you don't have access to proc
potentially so don't rely on this but

212
00:19:12,460 --> 00:19:21,429
i'm lazy so using a scan up to find the
entry for my header and uh here we use

213
00:19:21,429 --> 00:19:26,559
and protected whereas in windows we use
virtual protect we set our page right

214
00:19:26,559 --> 00:19:31,000
permissions so we can modify the header
here we use memset instead of RTL zero

215
00:19:31,000 --> 00:19:35,889
memory and then reset the page
permissions using and protect again and

216
00:19:35,889 --> 00:19:40,479
then here's this are debugging stuff
whereas in real life would be catching

217
00:19:40,480 --> 00:19:45,789
shells and exhaling data and getting
bitcoins cool

218
00:19:54,580 --> 00:19:58,269
alright so it was the next one

219
00:19:59,740 --> 00:20:02,740
oh no sorry

220
00:20:09,370 --> 00:20:16,719
ok now we're good forgot about the goats
for a minute okay so I'm say pretty much

221
00:20:16,720 --> 00:20:20,769
same thing that we walk through here we
don't need the elf hunter just like we

222
00:20:20,769 --> 00:20:24,250
didn't need the PE header so we can zero
it out or if you want to you could

223
00:20:24,250 --> 00:20:28,149
tamper it and add in weird values and
get really interesting

224
00:20:28,149 --> 00:20:34,299
register value sometimes and then uh
this is like the full process i can send

225
00:20:34,299 --> 00:20:37,750
you guys slides if you want tho will
come as a PDF no malware I promise

226
00:20:38,500 --> 00:20:43,269
get-get clone a line from github build
it

227
00:20:43,269 --> 00:20:48,399
insert in smart it so you get it running
in the colonel get volatility install it

228
00:20:48,399 --> 00:20:53,979
and then this is the the profile build
stuff so you'll see d into this like to

229
00:20:53,980 --> 00:20:58,059
linux subdirectory and just run make and
that will produce this module . door

230
00:20:58,059 --> 00:21:02,379
file if your own head on that you should
see . debug info the top let you know

231
00:21:02,380 --> 00:21:04,450
that you've got to build correctly

232
00:21:04,450 --> 00:21:11,380
laughs then once you've got your module
. or file you'll need to package it with

233
00:21:11,380 --> 00:21:18,789
your current system . map and place that
zip in the in the directory under

234
00:21:18,789 --> 00:21:23,830
plugins overlays for for volatility and
then at that point you can check that is

235
00:21:23,830 --> 00:21:29,740
installed correctly with that Python .
Popeye info great linux that showed

236
00:21:29,740 --> 00:21:32,200
earlier and then we just did

237
00:21:32,200 --> 00:21:37,840
PS list and practicum and it didn't save
us in this case but that's that's the

238
00:21:37,840 --> 00:21:40,840
completeness

239
00:21:41,530 --> 00:21:50,260
alright uh so Android South any
questions about either the windows or

240
00:21:50,260 --> 00:21:53,020
linux perience for the people like right
next to each other

241
00:21:53,020 --> 00:21:59,590
cool alright and stuff so my girlfriend
were interested about android stuff of a

242
00:21:59,590 --> 00:22:02,590
little while back and we didn't know
anything about forensics for android so

243
00:22:02,590 --> 00:22:05,500
we're like let's figure it out as well
these are some things that we figured

244
00:22:05,500 --> 00:22:09,730
out so all of this is based on the
premise of using encryption encrypting

245
00:22:09,730 --> 00:22:33,970
your device also to quote the group use
tor you signal i'll know this one shows

246
00:22:33,970 --> 00:22:37,360
up as well I want to eat a pint of jerry
garcia ice cream should i use a bowl or

247
00:22:37,360 --> 00:22:43,810
not used to ru signal and then selling
social security numbers for bitcoins

248
00:22:43,810 --> 00:22:46,810
contact me on my xmpp

249
00:22:51,510 --> 00:23:02,790
I i guess i don't know if i should admit
or not but pretty much the reason that i

250
00:23:02,790 --> 00:23:05,639
made this talk was because i had the
idea to use screaming goats for the

251
00:23:05,640 --> 00:23:08,640
slide transitions and I was like what
can I put around that

252
00:23:12,600 --> 00:23:16,740
alright so let's talk about forensics
real quick i'm gonna try to push through

253
00:23:16,740 --> 00:23:19,620
this part pretty quickly and I can talk
more in depth about it afterwards but

254
00:23:19,620 --> 00:23:22,469
really I want to play the ck up with
y'all for the SD card stuff is really

255
00:23:22,470 --> 00:23:25,470
fun so I first android forensics

256
00:23:27,090 --> 00:23:31,830
ok so I android forensics not the
easiest was like a bunch of stuff you

257
00:23:31,830 --> 00:23:35,010
have to have in place also it's like a
weird setup you have to cross-compile

258
00:23:35,010 --> 00:23:39,300
netcat forearm and then load it onto the
device that you're doing an acquisition

259
00:23:39,300 --> 00:23:43,500
from so like if anybody's done like
hardware forensics like hard drive

260
00:23:43,500 --> 00:23:46,020
forensics you're usually use a write
blocker and you don't write anything

261
00:23:46,020 --> 00:23:50,250
onto the device you're firing from in
this case you're pushing a program that

262
00:23:50,250 --> 00:23:53,490
you built onto a target device that
you're about to acquire from really

263
00:23:53,490 --> 00:23:54,990
weird but it works

264
00:23:54,990 --> 00:23:59,370
I you need the device to be powered on
decrypted unlocked rooted and have USB

265
00:23:59,370 --> 00:24:03,449
debugging enabled us quite a lofty kill
chain right stop any one of those things

266
00:24:03,450 --> 00:24:08,700
in forensics fails and then if you want
to do memory forensics you need loadable

267
00:24:08,700 --> 00:24:12,720
kernel modules loadable kernel modules
enabled which on all of the android

268
00:24:12,720 --> 00:24:16,350
devices that I've seen do not have that
enable so good luck

269
00:24:18,300 --> 00:24:22,908
yeah

270
00:24:22,909 --> 00:24:33,649
I guess I could live on a farm as long
as they have internet in goats

271
00:24:34,970 --> 00:24:39,259
ok so basically what you do in an
android forensic acquisition off of the

272
00:24:39,259 --> 00:24:43,999
nan storage is you push your compiled
netcat binary onto your target device

273
00:24:43,999 --> 00:24:50,599
and you set up a port forward and then
you invoke she'll get root and situate

274
00:24:50,599 --> 00:24:53,720
your neck at binary give it executable
permissions you could do you probably

275
00:24:53,720 --> 00:25:00,889
like 75 if you wanted but yellow then UD
d this is all familiar to us right

276
00:25:00,889 --> 00:25:07,879
DeeDee off of the man storage blocksize
64k no big deal and then type that to

277
00:25:07,879 --> 00:25:14,119
netcat and send it across the u.s. be
using netcat on the receiving end on

278
00:25:14,119 --> 00:25:19,668
your on your laptop you'll have a net
kak client that will connect into the

279
00:25:19,669 --> 00:25:23,299
listener on the phone and then you'll
just grab all that data and store it off

280
00:25:23,299 --> 00:25:27,139
into whatever you want to call your file
in this case i call it image . man then

281
00:25:27,139 --> 00:25:30,619
standard forensics stuff checksum it
make a copy checks on the copy etc

282
00:25:37,870 --> 00:25:45,429
I another weird thing i found with the
android stuff is that you'll find the

283
00:25:45,430 --> 00:25:49,300
answer is exposed by a different
interfaces it just varies per device it

284
00:25:49,300 --> 00:25:53,139
seems so I got these are some that i've
seen it under just look at the product

285
00:25:53,140 --> 00:25:56,890
partitions on the system and that will
tell you like where the storage is so it

286
00:25:56,890 --> 00:26:02,650
might be unheard of blocker mt/year vmmc
and then I was just trying to be clever

287
00:26:02,650 --> 00:26:03,340
with that

288
00:26:03,340 --> 00:26:21,490
c++ line at the end haha so ended up in
the situations where you can't like get

289
00:26:21,490 --> 00:26:25,360
rude and you like a full DVD acquisition
of the nand you can get some other

290
00:26:25,360 --> 00:26:29,500
logical acquisitions right atb pole is
basically like trying to do like a cpu /

291
00:26:29,500 --> 00:26:34,540
onto like your local storage so it will
grab whatever it can for you and in this

292
00:26:34,540 --> 00:26:37,240
case we have like a local directory
called dump that we're going to jump

293
00:26:37,240 --> 00:26:39,580
onto on our target on our laptop

294
00:26:39,580 --> 00:26:43,990
there's also just like dumpsters program
there's 80 backup which you have to add

295
00:26:43,990 --> 00:26:48,640
a pin for you have to have the pin for
the phone or the device in order to use

296
00:26:48,640 --> 00:26:53,440
adb backup which then puts it in the
back history so if you're targeting the

297
00:26:53,440 --> 00:26:56,440
forensic investigator can find the pin
at the phone

298
00:27:01,030 --> 00:27:07,240
there's also dumped state bug report
these things get you like logs of like

299
00:27:07,240 --> 00:27:09,700
various radios that are on the device

300
00:27:09,700 --> 00:27:12,910
there's an open source tool called a
logical osc there's a law enforcement

301
00:27:12,910 --> 00:27:17,410
edition of it as well I don't know the
differences between the two but uh there

302
00:27:17,410 --> 00:27:21,580
the open-source edition is out there if
you want to mess around with it so

303
00:27:21,580 --> 00:27:28,840
tldr it sucks like android forensic
sucks would not do again forever and

304
00:27:28,840 --> 00:27:31,720
it's weird that it violates the
traditional forensic methodologies to be

305
00:27:31,720 --> 00:27:35,650
right like your writing onto the device
you're about to acquire from mine equals

306
00:27:35,650 --> 00:27:39,220
blown and then that kill chain we had
things being like powered on decrypted

307
00:27:39,220 --> 00:27:42,220
all that stuff it's super easy to
disrupt

308
00:27:42,880 --> 00:27:46,690
not even a goat

309
00:27:48,400 --> 00:27:53,290
alright so here's our setup is we have
our android device and we're using full

310
00:27:53,290 --> 00:27:58,330
disk encryption and maybe we're out like
in the rated by law enforcement scenario

311
00:27:58,330 --> 00:28:01,629
maybe we're out freedom fighting is a
great cause that route operating

312
00:28:01,630 --> 00:28:03,430
somewhere you always of course

313
00:28:03,430 --> 00:28:07,660
leave your phone at home when you do
that as as my girlfriend has pointed out

314
00:28:07,660 --> 00:28:11,650
to me multiple times and so let's say
you're out operating and you come home

315
00:28:11,650 --> 00:28:14,680
and there's a bunch of police at my
house like what's going on

316
00:28:14,680 --> 00:28:19,870
you don't want the police to acquire
your device at home and then get

317
00:28:19,870 --> 00:28:25,270
evidence off of it so or like is a
separate situation say maybe you're

318
00:28:25,270 --> 00:28:29,650
deploying a hardware implant on an
operation and if blue team or law

319
00:28:29,650 --> 00:28:33,010
enforcement or somebody else it's not
ever supposed to find the device finds

320
00:28:33,010 --> 00:28:38,230
the hardware implant you don't want them
to get any evidence off of it so and

321
00:28:38,230 --> 00:28:41,020
then this last one I was like shrug is
like you know there are other scenarios

322
00:28:41,020 --> 00:28:44,470
but I can't think of any and then I
looked at it and it looks like cause

323
00:28:44,470 --> 00:28:48,400
throwing a phone to me so you know you
want to encrypt your device if it causes

324
00:28:48,400 --> 00:28:51,190
ever touching it don't go never let him
touch your phone

325
00:28:51,190 --> 00:28:56,200
ok so i'm thinking like we're using
solution are using encryption right the

326
00:28:56,200 --> 00:28:59,830
easiest solution is just power down the
devices but if you think you're in

327
00:28:59,830 --> 00:29:00,580
danger

328
00:29:00,580 --> 00:29:04,720
I mean it's not destructive you're using
your data is still intact in the event

329
00:29:04,720 --> 00:29:08,620
that you're not actually being rated by
law enforcement or something and then

330
00:29:08,620 --> 00:29:12,969
you've got everything your evidence is
all encrypted and then of course lawyer

331
00:29:12,970 --> 00:29:16,390
up you know don't don't ever talk to the
police

332
00:29:16,390 --> 00:29:22,600
um so what can we do to leverage their
to see like whether we're being tempered

333
00:29:22,600 --> 00:29:28,300
with we have all these sensors at at our
disposal right but you hear my device

334
00:29:28,300 --> 00:29:32,470
with another device in my house if it
becomes unpaired turn it off

335
00:29:32,470 --> 00:29:36,760
it's encrypted it's on the cell network
if law enforcement comes in and acquires

336
00:29:36,760 --> 00:29:39,340
a device they're probably gonna put it
in a Faraday bag and that's going to

337
00:29:39,340 --> 00:29:43,720
stop any transmission and receiving
right so if it goes off the cell network

338
00:29:43,720 --> 00:29:48,010
power it off its encrypted gps goes
outside the geofence of my property

339
00:29:48,010 --> 00:29:52,420
power it off all this stuff so we can
use all of these two like leverage or

340
00:29:52,420 --> 00:29:54,460
figure out whether we're being tampered
with and

341
00:29:54,460 --> 00:30:03,130
consequently turn the device off to
protect ourselves so i wrote this app

342
00:30:03,130 --> 00:30:10,930
called duck the police and I'd like to
do what I hope will be the worst hacker

343
00:30:10,930 --> 00:30:25,780
con demo ever for you guys so i have
this android device here running duck

344
00:30:25,780 --> 00:30:30,850
the police and we're going to set it for
movement and we're gonna say . the

345
00:30:30,850 --> 00:30:37,000
police and I'm just gonna sit down and
going to pick it up and the phone is off

346
00:30:37,000 --> 00:30:44,800
its encrypted so . the police and i will
accept Tony nominations for worse hacker

347
00:30:44,800 --> 00:30:47,800
conference demo ever

348
00:30:54,240 --> 00:30:57,780
I'll up with the pony award right next
to my other two it'll be in good company

349
00:30:59,550 --> 00:31:05,550
no I was surprised at the lack of duck
the police means that were on the

350
00:31:05,550 --> 00:31:16,710
internet that one I especially like
because i used to work with a guy who's

351
00:31:16,710 --> 00:31:19,500
really good at lock-picking and he was
like oh yeah i can pick the boots on

352
00:31:19,500 --> 00:31:22,530
cars like no problem and he's like the
police charged like a hundred

353
00:31:22,530 --> 00:31:34,139
twenty-five dollars to take those things
off a charge 75 the fifth bubble tape

354
00:31:34,140 --> 00:31:56,850
one just killed me LOL alright so so
yeah we were using encryption and you

355
00:31:56,850 --> 00:32:01,379
know if we leverage like motion sensors
in the air like accelerometers in the

356
00:32:01,380 --> 00:32:05,429
device it it moves if it's like require
recovered by somebody we don't want to

357
00:32:05,429 --> 00:32:08,429
be recovered by powers down we went good
to go

358
00:32:10,740 --> 00:32:17,190
alright SD cards right so if you've seen
this talk previously you're not allowed

359
00:32:17,190 --> 00:32:19,500
to play CTF sorry

360
00:32:19,500 --> 00:32:22,500
let's do SD cards

361
00:32:31,040 --> 00:32:44,030
I'm just I'm just gonna go back and
forth i love that song

362
00:32:46,730 --> 00:32:59,000
okay so have an SD card here and i'm
going to plug it in and we'll take a

363
00:32:59,000 --> 00:33:05,630
look at it goes

364
00:33:16,920 --> 00:33:22,050
alright the rules of the CTF something
something something can read from this

365
00:33:22,050 --> 00:33:26,550
angle because privacy filter on my
screen I enter your name below so

366
00:33:26,550 --> 00:33:30,149
basically the TLDR is we need to add
your name to this txt file we need to

367
00:33:30,150 --> 00:33:35,010
save it we need to unmount the
filesystem remove the SD card at the SD

368
00:33:35,010 --> 00:33:39,180
card back in and make sure that our name
is still in the file seems pretty easy

369
00:33:53,580 --> 00:34:02,820
ok there's my name right everything cool
and dating yeah alright let's mount it

370
00:34:02,820 --> 00:34:18,420
SD cards out SE car going back in there

371
00:34:23,280 --> 00:34:35,370
oh no my name is not there but the file
is ok what we try to what the filesystem

372
00:34:35,370 --> 00:34:50,969
this place look extended to I'm sorry
immutable bit ok so like your name and

373
00:34:50,969 --> 00:34:53,159
then do not change after plus I on it

374
00:34:53,159 --> 00:34:56,159
okay I like that

375
00:35:09,890 --> 00:35:13,819
ok

376
00:35:15,740 --> 00:35:27,229
ok and eighties there are good little
bit is set right there it is

377
00:35:27,230 --> 00:35:40,820
hi mount it SD cards out as he cars back
in challenge that text

378
00:35:45,770 --> 00:35:59,300
oh no my name is not there alright what
else can we try i like like with a

379
00:35:59,300 --> 00:36:04,070
hardware switch or um ok so that the
premises that the hardware switch is off

380
00:36:04,070 --> 00:36:07,190
i guess i should've specified that is
it's not hardware locked

381
00:36:07,190 --> 00:36:18,080
ok sorry I and I heard something over
here yes I which you mount ok so then

382
00:36:18,080 --> 00:36:25,880
you mounted I'm not charging you mount
so its standard email on linux yes I'm

383
00:36:25,880 --> 00:36:28,760
sorry reading the file

384
00:36:28,760 --> 00:36:31,760
yeah let's do that

385
00:36:36,990 --> 00:36:49,618
so adding in a cool guy going to move it

386
00:36:59,460 --> 00:37:16,020
call it pancakes okay pancakes is there
and he's still there

387
00:37:17,220 --> 00:37:23,730
lets you mount it SD card coming out SD
card going back in

388
00:37:29,400 --> 00:37:40,860
oh shit is challenged our texts and my
name is not there still

389
00:37:41,400 --> 00:37:44,400
what else in the back

390
00:37:46,920 --> 00:37:54,390
oh yeah we did which mounts a mount and
it's a standard mountains including the

391
00:37:54,390 --> 00:38:04,560
distro yeah now

392
00:38:04,560 --> 00:38:07,950
didn't-didn't amber that in the back

393
00:38:07,950 --> 00:38:22,200
I yes and now we can we can double check
them out flags so here's rrw so we write

394
00:38:22,200 --> 00:38:32,819
yes we can

395
00:38:32,820 --> 00:38:36,420
I'll go ahead and spoiler alert for you
because it will take longer than is left

396
00:38:36,420 --> 00:38:41,250
in the talk if that doesn't work either
but good good good is another thing that

397
00:38:41,250 --> 00:38:42,000
I tried

398
00:38:42,000 --> 00:38:45,000
yes

399
00:38:52,530 --> 00:38:57,240
no i'm not using any you have gnarliness
or anything like that

400
00:39:03,300 --> 00:39:13,740
sure we cool like that

401
00:39:15,270 --> 00:39:22,470
lost-and-found is a standard directory
on extended Senate file systems

402
00:39:25,230 --> 00:39:37,470
yes yet let's check partitions so this
is our device MMC block 0

403
00:39:39,990 --> 00:39:44,850
nope just the 1v1 yes in the back

404
00:39:45,360 --> 00:39:53,520
i'm not using an overlay on the file
system but good that's a good one

405
00:39:53,520 --> 00:40:09,630
yes in the back ah yes there is
something on the SD card itself

406
00:40:11,520 --> 00:40:14,520
way to go we work our way down the stack
so

407
00:40:23,850 --> 00:40:28,170
there's a program called SD tool which
will allow us to interface with the

408
00:40:28,170 --> 00:40:33,060
firmware on the SD card and we can
change the right state as to whether or

409
00:40:33,060 --> 00:40:37,590
not we can write to the card so what's
awesome is the way that this gets

410
00:40:37,590 --> 00:40:41,130
displayed to the operating system above
is that everything's fine

411
00:40:41,130 --> 00:40:45,660
no errors no permission issues you know
everything looks good we mountain mount

412
00:40:45,660 --> 00:40:49,740
no worries at all and on but under the
hood

413
00:40:49,740 --> 00:40:56,910
we're preventing the rights and this
this tools open-source I don't know if I

414
00:40:56,910 --> 00:41:00,180
mentioned the slides or not we'll see
but basically all I didn't change to

415
00:41:00,180 --> 00:41:12,450
make file to use playing instead of GCC
but yes but it's but the locks which is

416
00:41:12,450 --> 00:41:14,399
set up to like allow rights

417
00:41:14,400 --> 00:41:29,910
yeah I don't know whoever figured this
out just figured out the interface to

418
00:41:29,910 --> 00:41:31,589
make it make it do the thing

419
00:41:31,590 --> 00:41:35,820
so there's a there's a few commands tata
like i said i'm not an expert I just

420
00:41:35,820 --> 00:41:42,390
mess around on computer history so I so
here with the status we can see that the

421
00:41:42,390 --> 00:41:51,810
right state is on temporarily so we can
update the right protection see so now

422
00:41:51,810 --> 00:41:54,810
now the right protections off

423
00:42:07,190 --> 00:42:24,380
so we'll mount it cards out cars going
back in is that boy

424
00:42:25,099 --> 00:42:28,099
oh shit what up

425
00:42:28,609 --> 00:42:35,359
Peppa so I shot the craig smith from
open garages he's kind of the one that

426
00:42:35,359 --> 00:42:40,400
got me on this track and figuring this
stuff out so is really cool trick and

427
00:42:40,400 --> 00:42:43,400
it's pretty thing that I hadn't seen
anywhere else

428
00:42:56,060 --> 00:43:08,720
sagat alright that was just in case I
wasn't paying attention

429
00:43:12,680 --> 00:43:14,680
whoa

430
00:43:14,680 --> 00:43:19,569
oh that was in case you weren't paying
attention

431
00:43:21,550 --> 00:43:25,390
alright so using this open-source LSD
tool were able to lock and unlock the

432
00:43:25,390 --> 00:43:29,859
device and also check its status as well
again the physical lock is disengaged so

433
00:43:29,860 --> 00:43:35,080
to anybody recovering the SD card you
know they're gonna be like yeah you know

434
00:43:35,080 --> 00:43:36,220
it looks fine

435
00:43:36,220 --> 00:43:39,310
I all the stuff happens in memory so
we're good to go

436
00:43:39,310 --> 00:43:45,880
nothing gets right into the device AKA
no logs no crime which is awesome caveat

437
00:43:45,880 --> 00:43:50,620
so USB hub does not present itself in
the same way all the time is an MMC

438
00:43:50,620 --> 00:43:54,759
device so you might need an actual like
SD card reader that's not connected by

439
00:43:54,760 --> 00:43:58,960
USB bridge i think some of them might
work

440
00:43:58,960 --> 00:44:02,410
also I'd like run into just like hit or
miss with certain cards like this micro

441
00:44:02,410 --> 00:44:06,520
SD card inside of the SD adapter works
fine other micro SD cards i tested did

442
00:44:06,520 --> 00:44:13,030
not work so just ask your friends for
some totally safe microsd cards and then

443
00:44:13,030 --> 00:44:16,030
give them back

444
00:44:20,230 --> 00:44:27,670
so my ideas for like the example
scenarios are like you've got like a

445
00:44:27,670 --> 00:44:32,980
hardware implant right you're using on
an active operation I've actually gone

446
00:44:32,980 --> 00:44:36,970
against the Red Team engagement where
they use an android device implanted in

447
00:44:36,970 --> 00:44:41,049
the facility and we recovered the
android device and rhythm our off of it

448
00:44:41,050 --> 00:44:44,200
and I already the malware and then we
were able to pivot off of that and go

449
00:44:44,200 --> 00:44:48,669
find more infected nodes on the network
but how they used a mechanism like the

450
00:44:48,670 --> 00:44:54,609
android stuff or whatever they could
have potentially killed that or like use

451
00:44:54,609 --> 00:44:58,930
that with the sdcard excuse me and I
would have been able to get any anything

452
00:44:58,930 --> 00:45:02,618
good off the SD card also if you guys
like raspberry PI's right like those

453
00:45:02,619 --> 00:45:08,020
runoff of SD cards so totally do this
year SD card put in your Raspberry Pi I

454
00:45:08,020 --> 00:45:12,160
build a portal of pie or whatever you
want and if it ever gets acquired your

455
00:45:12,160 --> 00:45:15,850
good nothing that we got into the device
and then I if you have if you want to

456
00:45:15,850 --> 00:45:19,299
try like running your attack p.m. for
your attack platform off of an SD card

457
00:45:19,300 --> 00:45:23,320
get off of it like nothing gets written
right on a laptop no hard drive no other

458
00:45:23,320 --> 00:45:28,030
persistent storage just an SD card that
also does not do persistent storage kind

459
00:45:28,030 --> 00:45:34,720
of meat is didn't know what this is nice
that what gentleman animalist

