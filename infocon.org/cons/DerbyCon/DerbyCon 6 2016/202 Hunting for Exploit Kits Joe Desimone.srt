1
00:00:00,000 --> 00:00:06,569
you guys ready

2
00:00:08,940 --> 00:00:15,660
I let's get it going so about me i am
joe desimone I've been well currently

3
00:00:15,660 --> 00:00:21,180
i'm a m-male researcher and game and
before that I would in the security

4
00:00:21,180 --> 00:00:26,130
community for about five years most of
that was government and my BS and

5
00:00:26,130 --> 00:00:32,070
masters from RIT and information
security and forensics and my interests

6
00:00:32,070 --> 00:00:37,649
are primarily reverse-engineering threat
intelligence exploit on our end .

7
00:00:37,649 --> 00:00:40,950
hunting and today talk which is going to
be about exploit kit

8
00:00:40,950 --> 00:00:46,770
alright so this is the overview and this
talk is broken down into these sections

9
00:00:46,770 --> 00:00:50,879
so first I'm gonna be a quick primer on
exploit it's going to be pretty high

10
00:00:50,879 --> 00:00:53,218
level because there's a lot of other
really good talks out there they get

11
00:00:53,219 --> 00:00:57,570
really into the weeds but we'll jump
right into Maxwell which is a tool that

12
00:00:57,570 --> 00:01:01,680
we're releasing today which is designed
to crawl through website and basically

13
00:01:01,680 --> 00:01:06,180
report on exploit kit and watering hole
activity so i'll talk about tips for

14
00:01:06,180 --> 00:01:09,330
configuring your virtual machines to
maximize your results they actually want

15
00:01:09,330 --> 00:01:13,470
to go play with this I'll talk about
some and researcher issues that we ran

16
00:01:13,470 --> 00:01:18,658
into and how to overcome them and i'll
talk about how we detect actually

17
00:01:18,659 --> 00:01:23,790
activity with high confidence and then
uh briefly will talk about post

18
00:01:23,790 --> 00:01:29,340
processing and the signature detection
phase of maxwell and then finally we'll

19
00:01:29,340 --> 00:01:32,400
do a demo and i'll tell you where you
can find the code

20
00:01:32,400 --> 00:01:41,790
alright exploit kit so there's basically
two big avenue for criminals you

21
00:01:41,790 --> 00:01:47,220
compromise your system on the first one
is email spam on the second one are

22
00:01:47,220 --> 00:01:52,829
exploit kit basically email infection
vectors they require pretty significant

23
00:01:52,829 --> 00:01:56,460
user interaction so they have to
actually click on your attachment

24
00:01:56,460 --> 00:01:59,759
sometimes they have to open it up and
like click-through like if it's a macro

25
00:01:59,759 --> 00:02:04,619
they have to enable macros but exploit
kits they compromise their victim after

26
00:02:04,619 --> 00:02:09,209
a person simply visit the website maybe
something they routinely go to arm and

27
00:02:09,209 --> 00:02:13,710
also email providers like gmail are
really getting pretty good at it

28
00:02:13,710 --> 00:02:17,580
bring out with an email about you guys
but like I literally cannot remember the

29
00:02:17,580 --> 00:02:21,750
last time i had like spam in my gmail
account like the pretty good a like new

30
00:02:21,750 --> 00:02:28,590
connect though so most of the time
actually kit target patentability so if

31
00:02:28,590 --> 00:02:32,940
you keep your browser and plugins
up-to-date you're mostly ok but every so

32
00:02:32,940 --> 00:02:37,859
often exploit kids will have 20 days and
they can do significant harm in that

33
00:02:37,860 --> 00:02:44,040
short window until people get their
system patch so the typical business

34
00:02:44,040 --> 00:02:50,160
model for exploit kit authors actually
malware as a service so I'm instead of

35
00:02:50,160 --> 00:02:53,340
giving you like the entire code and
Hagel kind of have fun with it

36
00:02:53,340 --> 00:02:57,240
so basically right out like access to
the exploit kit so they'll get a login

37
00:02:57,240 --> 00:03:00,000
where they can go to the control panel
and access it through there they can

38
00:03:00,000 --> 00:03:04,680
upload their malware and like you stats
and stuff like that and typically the

39
00:03:04,680 --> 00:03:08,280
authors were rented out like on average
for like two or three thousand dollars a

40
00:03:08,280 --> 00:03:13,920
month and kiss first you actually got a
nice blog post about their investigation

41
00:03:13,920 --> 00:03:19,739
of a criminal gang behind the alert
Trojan so basically it's like the flirt

42
00:03:19,740 --> 00:03:23,400
guy didn't like a criminal enterprise
they ran like a business and they were

43
00:03:23,400 --> 00:03:27,240
basically owning the hell out of these
like Russian banks and eventually like

44
00:03:27,240 --> 00:03:30,270
their security caught up in it fav they
were probably what they were doing

45
00:03:30,270 --> 00:03:33,960
anymore so they're like hey we had a
great exploit kit let's just go tell it

46
00:03:33,960 --> 00:03:38,430
that was actually the guys behind angler
and in order like saying business

47
00:03:38,430 --> 00:03:43,830
they're like well now we gotta tell our
our next exploit kit and there's a

48
00:03:43,830 --> 00:03:48,300
decent number of exploits in the wild so
i'm sure some of you probably heard of

49
00:03:48,300 --> 00:03:54,480
like angler nuclear neutrino rig
magnitude and sundown but in the last

50
00:03:54,480 --> 00:03:55,410
six months

51
00:03:55,410 --> 00:03:59,640
the two most popular exploit kit
actually went off the market so angler

52
00:03:59,640 --> 00:04:04,079
wrangler nuclear were the two on angular
do to those guys getting arrested

53
00:04:04,080 --> 00:04:08,100
basically the people they were running
the Lord gang and then nuclear I don't

54
00:04:08,100 --> 00:04:10,620
honestly know what the reason was for
that there was a really great paper they

55
00:04:10,620 --> 00:04:15,090
got put out on nuclear so that could be
related but I don't know exactly why do

56
00:04:15,090 --> 00:04:18,209
they want the market but basically
there's a huge hole like in the market

57
00:04:18,209 --> 00:04:23,909
share arm and that resulted recently
like in the last four or five months in

58
00:04:23,910 --> 00:04:27,090
a surge in rig and neutrino exploit kit

59
00:04:27,090 --> 00:04:31,619
activities they're kind of jockeying for
like that pop right now and then so

60
00:04:31,620 --> 00:04:37,050
another piece like the whole exploit kit
puzzle our traffic distribution services

61
00:04:37,050 --> 00:04:41,729
or gate so basically these are like
other groups of criminals sometimes it

62
00:04:41,729 --> 00:04:45,510
can be one in the same but they
basically they go out and try to

63
00:04:45,510 --> 00:04:49,349
compromise as many websites as possible
and once they're compromise they can

64
00:04:49,350 --> 00:04:53,970
inject iframes into the website and they
can basically like if your user of an

65
00:04:53,970 --> 00:04:57,720
exploit kit you can pay these guys say
hey like dr much traffic my exploit kit

66
00:04:57,720 --> 00:05:01,470
so the whole temporarily just you know
start redirecting the compromise website

67
00:05:01,470 --> 00:05:05,460
you get a bunch of traffic in and that
will drive up the number of infections

68
00:05:05,460 --> 00:05:08,460
you're getting like as a the user

69
00:05:10,320 --> 00:05:17,580
alright so talk a little bit about the
infection process right now arm so

70
00:05:17,580 --> 00:05:22,169
basically first thing users they go and
a proud to a widget webpage and

71
00:05:22,169 --> 00:05:26,639
basically the browser is silently
redirected to an exploit kit landing

72
00:05:26,639 --> 00:05:32,729
page for this stage very either of the
website can be compromised like i said

73
00:05:32,729 --> 00:05:39,000
something like the 50's and other types
of players in this arena but it can also

74
00:05:39,000 --> 00:05:44,400
be through mal revising so like the
exploit kit users they can basically

75
00:05:44,400 --> 00:05:49,469
hate advertisements and then you know
they a user will visit that webpage and

76
00:05:49,470 --> 00:05:54,419
they just get redirected through the
advertisement to act like it but after

77
00:05:54,419 --> 00:05:58,289
they get redirected in the third phase
basically exploit will spend their

78
00:05:58,289 --> 00:06:02,190
landing page which basically it contains
usually a whole bunch of JavaScript will

79
00:06:02,190 --> 00:06:05,729
profile at them basically figure out
what browser you're running what plugins

80
00:06:05,729 --> 00:06:09,479
you're running all their version on the
back end they can basically determine

81
00:06:09,479 --> 00:06:12,750
okay we have an exploit that matches
what this guy's running and we're going

82
00:06:12,750 --> 00:06:17,370
to target them so like an example could
be like outdated flash version on

83
00:06:17,370 --> 00:06:20,789
nutrino exploit kit is a little bit
different this regard they don't have

84
00:06:20,789 --> 00:06:23,760
like their own landing page everything
is actually funded a one flash file

85
00:06:23,760 --> 00:06:28,590
which little bit different than most the
other act like it but so the instep for

86
00:06:28,590 --> 00:06:32,489
if the user configuration is don't be
vulnerable still saying whatever exploit

87
00:06:32,490 --> 00:06:37,950
to that particular user and your browser
will go and will download that

88
00:06:38,460 --> 00:06:43,888
so in faith five basically that you know
is that flash silverlight maybe it's not

89
00:06:43,889 --> 00:06:47,310
your ability whatever is that it will
run in game code execution on that box

90
00:06:47,310 --> 00:06:52,650
and the next step would be to actually
download the payload so this would be

91
00:06:52,650 --> 00:06:56,489
kind of the final step after the
activation code execution will go

92
00:06:56,490 --> 00:07:01,289
usually begin back to the exact same
server that did the landing page it's

93
00:07:01,289 --> 00:07:04,139
very rare that would go somewhere out
there basically go back to that server

94
00:07:04,139 --> 00:07:08,759
and say hey give me the payload and
pretty much always obligated in some way

95
00:07:08,759 --> 00:07:15,449
either X order our C chord or some other
technique and that payload can be a

96
00:07:15,449 --> 00:07:19,889
variety of things most commonly now with
ransomware probably by far like the most

97
00:07:19,889 --> 00:07:24,270
commonly used payload for you can also
be like banking Trojans some like click

98
00:07:24,270 --> 00:07:29,099
fraud type or other malware but if
you're interested in like very low level

99
00:07:29,099 --> 00:07:33,449
detail on that paper I kind of mentioned
earlier checkpoint put out like super

100
00:07:33,449 --> 00:07:37,860
in-depth papers actually two part on
nuclear exploit kit so it's 3 & 4 in

101
00:07:37,860 --> 00:07:41,340
their references i would go if you
really want in an outdoor read that

102
00:07:41,340 --> 00:07:44,758
so even though new there like an active
right now it still applies like all the

103
00:07:44,759 --> 00:07:48,000
other act like it's a great paper i
would recommend if you're interested to

104
00:07:48,000 --> 00:07:50,340
read that

105
00:07:50,340 --> 00:07:54,090
alright so here's kind of the problem so
how do we actually collect information

106
00:07:54,090 --> 00:07:57,900
on exactly ticket so let's say you're
interested in actually it's and you want

107
00:07:57,900 --> 00:08:01,409
to track like their latest activity as a
blue team or maybe you want to do it at

108
00:08:01,409 --> 00:08:04,560
your own defensive against like the
latest and greatest threat it in the

109
00:08:04,560 --> 00:08:09,060
wild as a red camer maybe you want to do
adversary emulations you actually want

110
00:08:09,060 --> 00:08:12,449
to like grab on the big-name hit you
want to repurpose it and test it against

111
00:08:12,449 --> 00:08:15,330
your customers but how would you
actually go about collecting the sample

112
00:08:15,330 --> 00:08:19,979
so if you work for like a large
enterprise it's pretty easy your fellow

113
00:08:19,979 --> 00:08:23,159
employees will happily browse the web
and find their way to actually get

114
00:08:23,159 --> 00:08:26,400
activity and as long as you have decent
like North signatures or something at

115
00:08:26,400 --> 00:08:30,989
the gateway you can use your own kind of
fellow employees that you know

116
00:08:30,990 --> 00:08:34,469
collecting samples and do your research
that way now if you're like a navy your

117
00:08:34,469 --> 00:08:38,159
end . company it's also pretty easy you
can collect telemetry and you know

118
00:08:38,159 --> 00:08:40,950
you're gonna know like where the people
are going to and how they're getting

119
00:08:40,950 --> 00:08:44,130
popped you're always collecting stuff
but what about like the rest of us here

120
00:08:44,130 --> 00:08:47,100
like how do we go out how do we collect
it without really knowing much about

121
00:08:47,100 --> 00:08:49,529
like without a signature how do we do
that

122
00:08:49,529 --> 00:08:51,520
loeffler Maxwell can I come in

123
00:08:51,520 --> 00:08:55,480
so it's basically a high interaction
honeypot system and designed to just

124
00:08:55,480 --> 00:08:59,410
continually crawl the web and it will
find active exploit kit or watering hole

125
00:08:59,410 --> 00:09:07,240
activity so this kind of high-level
basically you know Maxwell its automated

126
00:09:07,240 --> 00:09:11,770
it go you basically queue up in many
websites you want and it'll basically

127
00:09:11,770 --> 00:09:16,780
use like full virtualization to open up
Internet Explorer browser you want but

128
00:09:16,780 --> 00:09:20,290
it can detect with high confidence when
which the activity actually occurred and

129
00:09:20,290 --> 00:09:23,860
then it will automatically save off the
pcap is associated and it'll start doing

130
00:09:23,860 --> 00:09:27,520
some like initial automated analysis on
it to figure out which exploit was

131
00:09:27,520 --> 00:09:33,730
responsible like what IP what domains
are involved in more all right now i'm

132
00:09:33,730 --> 00:09:36,640
going to start kind of talk a little
more in the weeds about Maxwell's

133
00:09:36,640 --> 00:09:42,280
architecture so really it's broken down
into these four main components are

134
00:09:42,280 --> 00:09:46,000
basically inside the virtual machine
there are python scripts and

135
00:09:46,000 --> 00:09:50,800
instrumentation library for collecting
data and then outside of the vm there's

136
00:09:50,800 --> 00:09:56,260
some other like there's a controller
script on the managed VM the jobs and

137
00:09:56,260 --> 00:10:00,730
there's also a result collection script
you actually profit the data that comes

138
00:10:00,730 --> 00:10:04,120
out of the vm it's really kind of
purpose-built I didn't want it to be you

139
00:10:04,120 --> 00:10:08,470
know you complicated it's not a whole
lot of lines of code is very specific

140
00:10:08,470 --> 00:10:12,160
for the job so I know there's a lot of
10 blocks out there but you know this is

141
00:10:12,160 --> 00:10:16,510
it easier to understand if you try to
dig into maybe some other exploit kits

142
00:10:16,510 --> 00:10:20,830
that are you know ten thousands of lines
of code and also had some awesome input

143
00:10:20,830 --> 00:10:25,630
so & Game had some like sweet DevOps
engineers and they're like baby when I

144
00:10:25,630 --> 00:10:29,890
started there like a like you know I had
this idea like no no you're doing it all

145
00:10:29,890 --> 00:10:34,990
wrong like you got to bring the dev up
with you so on that kind of bleed fled

146
00:10:34,990 --> 00:10:38,410
into the design and if you really want
like you could scale without the

147
00:10:38,410 --> 00:10:41,860
architecture out to like hundreds or
even thousands of machines no problem

148
00:10:44,380 --> 00:10:48,939
alright so this is kind of a diagram
overall how we design Maxwell it's super

149
00:10:48,940 --> 00:10:53,290
high level but you can kind of see well
first I have like no gift for doing

150
00:10:53,290 --> 00:10:57,730
diagrams it's like literally videostudio
I time from the 9000 basically got the

151
00:10:57,730 --> 00:11:00,850
central server there which is this kind
of like the conductor like the brains of

152
00:11:00,850 --> 00:11:01,840
the operation

153
00:11:01,840 --> 00:11:05,240
so there you have it set up right now
it'll connect

154
00:11:05,240 --> 00:11:10,100
look at the server now you could easily
like drop in other you know you could

155
00:11:10,100 --> 00:11:13,399
modify the code to change that do
virtual box or some other type of

156
00:11:13,399 --> 00:11:17,779
virtualization software but basically it
will connect in there and you have been

157
00:11:17,779 --> 00:11:23,720
up and down vm and then a ventral stream
directly out of the virtual machines

158
00:11:23,720 --> 00:11:28,100
directly to rabbitmq server and then
also in that central server there's

159
00:11:28,100 --> 00:11:32,570
another trip running the baby consume
those event and it'll basically monitor

160
00:11:32,570 --> 00:11:35,600
and wait for something like that to
happen and if it is a little shove off

161
00:11:35,600 --> 00:11:38,060
the elastic search that kind of like the
back end like permanent storage

162
00:11:38,060 --> 00:11:41,060
solutions artifact

163
00:11:42,020 --> 00:11:45,020
alright so inside the virtual machine

164
00:11:45,020 --> 00:11:51,290
we've got some vm agent script so this
is a really small python script

165
00:11:51,290 --> 00:11:54,620
basically just sit there listening to
wait for like a job file to be sent into

166
00:11:54,620 --> 00:11:57,260
the virtual machine and it reads it
basically it's like the high-level

167
00:11:57,260 --> 00:12:00,260
configuration like what is shopping to
do

168
00:12:00,860 --> 00:12:05,000
arm-based I wanted to be really simple
so I have to keep on like three creating

169
00:12:05,000 --> 00:12:07,880
new snapshot in my virtual machines what
I'm doing development I just kind of

170
00:12:07,880 --> 00:12:11,510
want that snapshot to like a more
permanent kind of thing and then like

171
00:12:11,510 --> 00:12:16,339
the more complicated code the headphones
or whatever I can you know he just push

172
00:12:16,339 --> 00:12:20,209
it in at runtime and then there's also a
nameplate server so basically every

173
00:12:20,209 --> 00:12:24,560
prophet that gets like the
instrumentation library arm will connect

174
00:12:24,560 --> 00:12:27,529
its name flight server which basically
just received all the event and then

175
00:12:27,529 --> 00:12:31,550
forwards it directly out of virtual
machine the rabbit few server and

176
00:12:31,550 --> 00:12:35,719
there's also there's a white light thing
there with the the nameplate server

177
00:12:35,720 --> 00:12:39,110
where basically every method that comes
in it'll check it against the whale it

178
00:12:39,110 --> 00:12:42,079
that way you don't get like crazy mad
annoyed like a major problem other

179
00:12:42,079 --> 00:12:45,920
sandboxes it's like a ridiculous amount
of events that happened you kind of

180
00:12:45,920 --> 00:12:49,219
don't know whether or not that like
actually batteries that company normally

181
00:12:49,220 --> 00:12:53,810
happens well we'll get into that little
more later but um it's kind of like who

182
00:12:53,810 --> 00:12:59,479
an example of what the whitelist might
look like so basically arm you know it

183
00:12:59,480 --> 00:13:01,910
didn't fit the weightlifting
configurable to the text file it kind of

184
00:13:01,910 --> 00:13:07,399
looks like JSON so basically so there's
a key value pairs for the event and you

185
00:13:07,399 --> 00:13:12,170
can kind of set up your own rules they
have it matches like this it's a value

186
00:13:12,170 --> 00:13:15,920
for the key matches then you can filter
it out and you can do like 80 with the

187
00:13:15,920 --> 00:13:18,649
string equal a one would be like a
strengthened

188
00:13:18,649 --> 00:13:25,160
and you can even do rejected so are you
can even like to multiple rules like in

189
00:13:25,160 --> 00:13:28,160
one line interface people just and
everything together so like the goals

190
00:13:28,160 --> 00:13:32,240
you want it to be like you don't want to
like white without potential most

191
00:13:32,240 --> 00:13:35,029
activity but you don't want to have to
have like a thousand rules in here to

192
00:13:35,029 --> 00:13:38,089
filter everything you need kind of like
a healthy balance but basically the

193
00:13:38,089 --> 00:13:43,220
first example on there it's like a
filter event where the function name is

194
00:13:43,220 --> 00:13:46,220
NT Wright file and the file name

195
00:13:52,249 --> 00:13:57,860
hi folks I'm get here unfortunately once
again the a medias have caused me more

196
00:13:57,860 --> 00:14:02,809
pain in my life and the bane of my
existence so we were actually audio to

197
00:14:02,809 --> 00:14:05,480
about the twenty one minute thirty
second ball

198
00:14:05,480 --> 00:14:08,959
I apologize for the inconvenience but
the top will resume there

199
00:21:29,799 --> 00:21:33,489
to extricate themselves they have tons
of randomization built-in so like you

200
00:21:33,489 --> 00:21:37,090
look at it and you're like what the hell
is like all these no words are basically

201
00:21:37,090 --> 00:21:41,439
select like from a dictionary of like
500 words in order to randomly generate

202
00:21:41,440 --> 00:21:48,309
their the actual getting to get requests
from the expectation process but I

203
00:21:48,309 --> 00:21:51,820
recommended taking certain samples
across the period of time and just

204
00:21:51,820 --> 00:21:54,519
trying to figure out what common because
they do make mistakes

205
00:21:54,519 --> 00:21:59,080
there are things that are comment and
I'll talk about that a little more um so

206
00:21:59,080 --> 00:22:03,100
basically that that's a you know a
decent way to do it also a lot of people

207
00:22:03,100 --> 00:22:07,149
don't take too much in the bx place
themselves but you cannot like a flash I

208
00:22:07,149 --> 00:22:11,258
like to write my signatures on the
actual flash files so like free flash

209
00:22:11,259 --> 00:22:14,799
decompiler is great I'll just fire that
up i'll take a look at like maybe two

210
00:22:14,799 --> 00:22:18,580
flat file side-by-side and be like oh
that kind of visually looks similar with

211
00:22:18,580 --> 00:22:22,359
like this description routine so I can
kind of look at like that you can select

212
00:22:22,359 --> 00:22:25,539
an output the code white I was like okay
well you know these bites are similar

213
00:22:25,539 --> 00:22:29,230
similar here you can write your
signature and so it proved to be really

214
00:22:29,230 --> 00:22:34,210
valuable and and last for a long period
of time you should definitely also

215
00:22:34,210 --> 00:22:38,980
follow/like these guys on Twitter and
check out our blog so this is what i use

216
00:22:38,980 --> 00:22:43,299
like hey I've got some random activity i
don't know what exploit kit i can go to

217
00:22:43,299 --> 00:22:47,230
be like their website and kind of look
at their samples and compared to what

218
00:22:47,230 --> 00:22:51,190
i'm seeing how this looks like the exact
thing they're calling neutrino or they

219
00:22:51,190 --> 00:22:54,429
were calling rig or magnitude and that's
how you can kind of build out and

220
00:22:54,429 --> 00:22:56,109
understand like what's really happening

221
00:22:56,109 --> 00:23:02,168
alright so putting it all together

222
00:23:02,830 --> 00:23:05,859
um how do you actually take this code
and make some use out of it

223
00:23:06,460 --> 00:23:10,570
basically yeah first step get your
infrastructure up and running so like I

224
00:23:10,570 --> 00:23:14,769
said we use a vsphere there's really no
reason that you can't even like put this

225
00:23:14,769 --> 00:23:18,039
on some cloud architect architecture
somewhere just probably be aware of like

226
00:23:18,039 --> 00:23:23,408
whatever terms of service running for
that cloud provider rabbitmq and last

227
00:23:23,409 --> 00:23:25,480
researcher super easy to set up

228
00:23:25,480 --> 00:23:29,259
I'm not really gonna go into that in the
details i will say that i like 12 I use

229
00:23:29,259 --> 00:23:33,519
that for the controller server but i
guess we should probably talk about like

230
00:23:33,519 --> 00:23:37,749
what websites to actually push into this
thing what to queue up and a

231
00:23:37,749 --> 00:23:42,490
surprisingly effective technique is
actually I pick the like elected top 25

232
00:23:42,490 --> 00:23:43,090
thousand

233
00:23:43,090 --> 00:23:46,540
hundred thousand domain I'll just shove
it in there and you will find that even

234
00:23:46,540 --> 00:23:50,379
if you have like three or four vm
running you can find stuff and a trick

235
00:23:50,380 --> 00:23:54,430
to kind of like accelerate the amount of
websites you can go through it's just

236
00:23:54,430 --> 00:23:58,480
you can do like five websites for each
job you run so instead of just in the

237
00:23:58,480 --> 00:24:01,510
nick of the virtual machine running I
opens up its sitting there for a timeout

238
00:24:01,510 --> 00:24:06,070
. and closeout you can just open up my
website and then you know you're getting

239
00:24:06,070 --> 00:24:10,240
five times basically the throughput on
the number website you can analyze the

240
00:24:10,240 --> 00:24:13,420
only problem that is once you get the
final output you're like okay one of

241
00:24:13,420 --> 00:24:16,690
those five website is bad and you kind
of have to manually go to the pcap

242
00:24:16,690 --> 00:24:20,260
figure it out or if you have a super
good anonymizing service you can just

243
00:24:20,260 --> 00:24:24,040
resubmit each five and then you know
because you get repop with your new IP

244
00:24:24,040 --> 00:24:29,409
but probably also a good idea to like
revisit old websites that like once you

245
00:24:29,410 --> 00:24:33,100
find something that our pops because a
lot of times if their conferences like

246
00:24:33,100 --> 00:24:36,219
they'll keep on serving exploits for
days weeks at a time

247
00:24:36,220 --> 00:24:39,280
I mean like a back-end all the
infrastructure is changing but like what

248
00:24:39,280 --> 00:24:45,310
they have compromised doesn't change all
right now I'm gonna try demo so I do not

249
00:24:45,310 --> 00:24:48,310
believe in the demo God so i did a video

250
00:24:49,000 --> 00:24:54,400
yep

251
00:24:55,360 --> 00:25:08,649
what kind of show you guys what OMI not
mirrored oh yeah they're not a mirror

252
00:25:08,650 --> 00:25:13,570
looking like yes they do

253
00:25:14,170 --> 00:25:35,350
I'm kind of a mag- yet you can leave it
the peaking out

254
00:25:39,940 --> 00:25:47,200
now the problem is I have no idea how
far away is mirrored exactly addresses

255
00:25:47,200 --> 00:25:54,429
mirror displayed as our show mirroring
options in the menu bar when available

256
00:25:54,429 --> 00:26:04,240
available we go look ahead

257
00:26:07,419 --> 00:26:12,580
alright so I'm definitely a preference
this I literally went to w3schools to

258
00:26:12,580 --> 00:26:16,840
develop some of the web front end on
this so like you guys this is my

259
00:26:16,840 --> 00:26:22,779
apologize in advance so basically so
initially I had no results in my little

260
00:26:22,779 --> 00:26:26,379
dashboard that i put together always
this is awful

261
00:26:26,379 --> 00:26:32,168
hold it oh my god so I i do have a
fallback I have some screenshots which

262
00:26:32,169 --> 00:26:36,940
are shitty but I could I could show them
you alive

263
00:26:37,929 --> 00:26:44,769
ya think so basically i'll just kind of
walk through what I did briefly then

264
00:26:44,769 --> 00:26:48,669
also ultrason screenshot basically so on
the Left I had the actual output from

265
00:26:48,669 --> 00:26:54,399
the controller so basically its spitting
up and down virtual machine and then I

266
00:26:54,399 --> 00:26:58,120
had you know queue up probably 50,000
websites but i can go and I can cue a

267
00:26:58,120 --> 00:27:01,629
new website with a higher priority and
will automatically jump right to it so I

268
00:27:01,629 --> 00:27:07,209
just went in I I knew of a compromise
website so i put that in and basically

269
00:27:07,210 --> 00:27:13,210
within probably five seconds of that new
job being executed there was you know

270
00:27:13,210 --> 00:27:17,710
you get all the output from the virtual
machine just being streamed back to the

271
00:27:17,710 --> 00:27:24,039
result council and I just being dumped
into elasticsearch back-end so let's

272
00:27:24,039 --> 00:27:26,440
just skip through all that

273
00:27:26,440 --> 00:27:29,470
alright yeah that's garbage

274
00:27:29,470 --> 00:27:47,530
alright so go into the backup
screenshots here

275
00:27:47,530 --> 00:28:00,399
no thank you i see this party I see this
all right so I'm gonna try to do this

276
00:28:00,400 --> 00:28:06,880
from memory but I can't see at all
especially on the actual start with this

277
00:28:06,880 --> 00:28:11,860
post processing alright alright so this
is kind of like post-processing output

278
00:28:11,860 --> 00:28:17,229
you get on so this one actually hit on a
parade gait signature that I had arm and

279
00:28:17,230 --> 00:28:22,030
it will show you like that the IP that
have received it from our general even i

280
00:28:22,030 --> 00:28:25,750
just kind of like a grouping regex so
afraid it basically they do like a

281
00:28:25,750 --> 00:28:29,679
document right and for whatever reason
like they're iframe they have like a

282
00:28:29,679 --> 00:28:33,340
million i plus frame so i have a
signature written for that so if i ever

283
00:28:33,340 --> 00:28:36,490
see that in the pcap and I just thought
the whole thing and like boom afraid

284
00:28:36,490 --> 00:28:41,710
gate and then for neutrino like they do
for whatever reason they're there user

285
00:28:41,710 --> 00:28:45,669
agents they use are always media center
pc and it's been like that for as long

286
00:28:45,669 --> 00:28:48,880
as I can remember I don't know why you
worried the signature how many people

287
00:28:48,880 --> 00:28:59,770
get to it so well to be honest I haven't
been running this like the last couple

288
00:28:59,770 --> 00:29:04,840
months but i would say like in the top
25 thousand like domains

289
00:29:04,840 --> 00:29:09,520
I'll see at least like maybe two or
three a day or compromise delhi and that

290
00:29:09,520 --> 00:29:12,908
kind of without great like obfuscation
like my IP like I know they're probably

291
00:29:12,909 --> 00:29:17,110
detecting some I activity so it's
probably more than that but I mean

292
00:29:17,110 --> 00:29:21,459
there's pretty popular website sometimes
gift box and they're detected by this so

293
00:29:21,460 --> 00:29:27,510
it's yet they can answer questions are

294
00:29:27,510 --> 00:29:31,020
so it will pull up to get request the
actual payload and you know it's

295
00:29:31,020 --> 00:29:34,740
labelled hate the neutrino because it
requires looks really familiar to me and

296
00:29:34,740 --> 00:29:37,740
you can see there's you know the
hostname in there

297
00:29:38,490 --> 00:29:44,130
oh go back one and then this is kind of
the output of the event so right at the

298
00:29:44,130 --> 00:29:50,520
top you can actually see there's like a
vm detect have in the middle of the top

299
00:29:50,520 --> 00:29:51,600
line so it

300
00:29:51,600 --> 00:29:56,550
this was actually looking for ESET like
nod32 antivirus and we detected that so

301
00:29:56,550 --> 00:29:58,080
that was an event that came right out

302
00:29:58,080 --> 00:30:01,290
so you know if they don't target like
the exploit we have that event like it

303
00:30:01,290 --> 00:30:05,670
will flag on it was also looking for
fiddler and then we have a guard page

304
00:30:05,670 --> 00:30:08,970
violation so you can see what it
basically tells you the source and the

305
00:30:08,970 --> 00:30:12,900
destination module for that guard page
violation basically saying flash was

306
00:30:12,900 --> 00:30:15,960
trying to read from flash which is kind
of weird and it doesn't normally happen

307
00:30:15,960 --> 00:30:18,810
and that's actually because they're read
primitive they're basically going

308
00:30:18,810 --> 00:30:21,810
through memory trying to find like the
target routine if they wanted to locate

309
00:30:21,810 --> 00:30:26,580
so it caught in that regard and then the
the next card page with basically the

310
00:30:26,580 --> 00:30:31,980
show code retain so it kind of looks
like a funky you know I explorer.exe EF

311
00:30:31,980 --> 00:30:35,430
and you know some basically the address
that caught it at all but that gets

312
00:30:35,430 --> 00:30:40,740
saved out and we can run you my demo i
had our rule basically you know you

313
00:30:40,740 --> 00:30:44,910
could you can log on those actual show
good routine even narrow down with the

314
00:30:44,910 --> 00:30:49,110
exploit it and then after that you can
see since this was neutrino what the

315
00:30:49,110 --> 00:30:53,040
neutrino really like to do it will
basically just create a new command

316
00:30:53,040 --> 00:30:58,560
process and the echo like this giant
command to a new script and they

317
00:30:58,560 --> 00:31:01,830
basically xqw script on it and that's
what actually goes out and download the

318
00:31:01,830 --> 00:31:08,129
payload and the payload is also rc4
encrypted so involved that echo event

319
00:31:08,130 --> 00:31:12,900
and in the to create profits before you
can see the RC Porky's actually use and

320
00:31:12,900 --> 00:31:16,530
that the full URL they used to pull down
that payload you can take that you can

321
00:31:16,530 --> 00:31:21,600
decrypt that pay look if you want and
for this was actually like the third

322
00:31:21,600 --> 00:31:25,020
time I ran this and for everything it
like crashing or something but this was

323
00:31:25,020 --> 00:31:28,590
actually lucky ransomware so on the
other two runs when he would run you

324
00:31:28,590 --> 00:31:30,800
basically get there's like 60 event the

325
00:31:30,800 --> 00:31:34,730
that occurred through that but when
locky or something run it just like

326
00:31:34,730 --> 00:31:37,850
hammers the crap out of the vm they're
like 600 rent space that you can see it

327
00:31:37,850 --> 00:31:42,230
going through encrypting all the files
like adding this was except two variants

328
00:31:42,230 --> 00:31:46,040
of it you can see all the filename
extension basically generally you can

329
00:31:46,040 --> 00:31:49,850
tell something went horribly wrong and
it's probably worth mentioning one of

330
00:31:49,850 --> 00:31:55,370
the and I don't mention it but one of
the design decision was not basically

331
00:31:55,370 --> 00:31:59,629
have all the events like accumulate in
the vm and then pull them out after the

332
00:31:59,630 --> 00:32:03,110
job is over because if you have some
really nasty ransomware they like

333
00:32:03,110 --> 00:32:06,830
destroys your vm and it totally happened
to me then you lose like all your

334
00:32:06,830 --> 00:32:11,480
analysis so basically you want to do is
as things are like the events are

335
00:32:11,480 --> 00:32:14,000
happening in the virtual machine you
want to be saving those off and just

336
00:32:14,000 --> 00:32:17,990
streaming them out so even if the whole
thing falls over you totally got up to

337
00:32:17,990 --> 00:32:23,930
that point of event in order to figure
out what the heck happened so yeah I

338
00:32:23,930 --> 00:32:30,890
think that's probably good for the demo
or lack thereof

339
00:32:30,890 --> 00:32:36,560
so kinda in summary so Maxwell so we
presented here take this system allows

340
00:32:36,560 --> 00:32:42,020
you to cross the web and fully automated
way it can do detection is actually its

341
00:32:42,020 --> 00:32:46,010
watering holes too i would say you know
if you're really sophisticated adversary

342
00:32:46,010 --> 00:32:48,530
like you're you're not going to be black
light thing you're going to be white

343
00:32:48,530 --> 00:32:52,100
lifting your target so like you want to
run this on your corporate network or

344
00:32:52,100 --> 00:32:55,429
your route the traffic through it so
that if someone was going after you know

345
00:32:55,430 --> 00:33:02,180
like your enterprise menu you will catch
that activity but also if you know

346
00:33:02,180 --> 00:33:05,390
anyone in the audience like this is cool
have any ideas like how we can improve

347
00:33:05,390 --> 00:33:09,080
it or want to like collaborate and stuff
and hit me up after they talk or send me

348
00:33:09,080 --> 00:33:13,220
a message on Twitter I definitely glad
to hear from you and kind of the red

349
00:33:13,220 --> 00:33:17,150
team and the red team heavy audience if
you don't have like web application your

350
00:33:17,150 --> 00:33:20,870
bag of tools you might want to think
about doing it are you know it could be

351
00:33:20,870 --> 00:33:23,989
a good wake up call it for some of your
customers if they're not the best at

352
00:33:23,990 --> 00:33:28,550
patch management you can catch them off
guard with one of these payloads arm and

353
00:33:28,550 --> 00:33:32,030
you could say hey like we popped you
with you know repurpose neutrino or

354
00:33:32,030 --> 00:33:35,090
refurbished rig like you can pick like
this is like really bad

355
00:33:35,090 --> 00:33:38,120
this could have been walking around
somewhere and you guys have been bone so

356
00:33:38,120 --> 00:33:41,070
it can be like a you know important
thing to show your customers

357
00:33:41,070 --> 00:33:45,029
like you guys should really update your
stuff and the code i'll be posting it

358
00:33:45,029 --> 00:33:49,289
today basically on our end game get hub
account is going to be MIT license you

359
00:33:49,289 --> 00:33:54,389
pretty much do whatever you want with it
and here's some references so definitely

360
00:33:54,389 --> 00:33:57,240
i'm standing on the shoulders of giants
out there there's a lot of really good

361
00:33:57,240 --> 00:34:02,610
work done in this field in palo alto you
notice first even checkpoint malware

362
00:34:02,610 --> 00:34:08,040
don't need coffee hour by trend micro
Twitter guys on there so thank you all

363
00:34:08,040 --> 00:34:22,319
these people they to help me out and to
manage credit questions yes arm so the

364
00:34:22,319 --> 00:34:25,319
question was why am i not running in
several months so I just been really

365
00:34:25,319 --> 00:34:28,079
busy working on their projects this is
like a really fun like research project

366
00:34:28,079 --> 00:34:31,560
and then I kind of just got distracted
and like Oh some other shiny objects are

367
00:34:31,560 --> 00:34:35,310
kinda got me over here so it's just
there's no particular reason other than

368
00:34:35,310 --> 00:34:38,310
that the question yep

369
00:34:40,409 --> 00:34:52,020
yeah yeah actually so I'm you go in the
walk-in big file for like beer you can

370
00:34:52,020 --> 00:34:56,759
actually disable certain things that
they look for like I could probably you

371
00:34:56,760 --> 00:34:59,490
know send it to you but there's like a
list of configuration options that i can

372
00:34:59,490 --> 00:35:04,529
jump into like the vmware config file it
hardens it against the sort of thing but

373
00:35:04,530 --> 00:35:09,270
definitely like no vmware tools like and
keep like security like wireshark

374
00:35:09,270 --> 00:35:13,650
fiddler like I mean if you don't need it
in your vm like don't install it on but

375
00:35:13,650 --> 00:35:17,640
I mean in reality like they they they
really want to catch you they will but

376
00:35:17,640 --> 00:35:21,270
it's at what point do they catch you
like if they are just able to

377
00:35:21,270 --> 00:35:25,020
fingerprint you in JavaScript it's
pretty easy to evade detection for like

378
00:35:25,020 --> 00:35:28,829
oh yeah they're doing like in their
shell code or something that would kind

379
00:35:28,829 --> 00:35:33,359
of suck but yeah hopefully that answers
your question anyone anyone else

380
00:35:33,359 --> 00:35:35,970
yep

381
00:35:35,970 --> 00:35:51,480
yep on the question is how to automate a
whole bunch URL so basically the script

382
00:35:51,480 --> 00:35:55,080
you can literally get a text file and
say hey like here's a text file with

383
00:35:55,080 --> 00:35:58,319
like a list of websites and i'll just
add into the queue and you can have like

384
00:35:58,320 --> 00:36:01,320
your army of like 20 virtual machines
that will start pounding on that

385
00:36:03,119 --> 00:36:07,650
yeah they published its old but they
published their top 1 million domains so

386
00:36:07,650 --> 00:36:11,250
you can go download a some of the
websites like are even legit anymore

387
00:36:11,250 --> 00:36:15,180
like they don't load but if I mean I use
it and it works so yeah it's really

388
00:36:15,180 --> 00:36:16,500
available though

389
00:36:16,500 --> 00:36:20,490
thank you you know you

