1
00:00:00,000 --> 00:00:05,790
right on cue from the video guy this
talk is this talk is so good you want to

2
00:00:05,790 --> 00:00:11,370
miss a second of it for watching you
don't remember i'll let you go so all

3
00:00:11,370 --> 00:00:12,090
right

4
00:00:12,090 --> 00:00:17,460
eleven o'clock sunday der beek on that
the dream time slot for every presenter

5
00:00:17,460 --> 00:00:22,529
now seriously I'm glad to be reminded
Russell betarrini this is fire was

6
00:00:22,529 --> 00:00:26,279
thinking the next-generation firewall so
before we get started how many people

7
00:00:26,279 --> 00:00:30,420
are familiar with or know what I'm
talking about when I say next-generation

8
00:00:30,420 --> 00:00:34,860
firewall ok pretty good amount you know
if you're not or you won't need to

9
00:00:34,860 --> 00:00:39,120
review then we're going to talk about it
and if you already are you can tune out

10
00:00:39,120 --> 00:00:45,209
but cool so we get started I am the pin
test on the tennis team in a large

11
00:00:45,210 --> 00:00:49,079
healthcare company a c-123 of my
co-workers and probably some I haven't

12
00:00:49,079 --> 00:00:50,640
met who are here

13
00:00:50,640 --> 00:00:55,170
anything I say or do in this talk is
representing me and not my employer i

14
00:00:55,170 --> 00:00:58,800
love when you go to security conferences
people won't tell you where they work in

15
00:00:58,800 --> 00:01:01,288
their presentation but then you just go
look at linkedin and find out where they

16
00:01:01,289 --> 00:01:05,460
work afterwards which is pretty awesome
so don't take it out on them

17
00:01:05,459 --> 00:01:11,369
I've been doing I tis fun stuff like
that for 12 years a little bit

18
00:01:11,369 --> 00:01:17,520
everything sysadmin web hacking
pentesting firewall administration ipsa

19
00:01:17,520 --> 00:01:23,729
virus steel p Active Directory grab bag
of stuff up two years ago to recount

20
00:01:23,729 --> 00:01:28,770
visit socal no SQL map which someday i
will work on again maybe if time permits

21
00:01:28,770 --> 00:01:33,810
and on the world's worst powerpoint or
so a protip black text on a white

22
00:01:33,810 --> 00:01:38,100
background works on every projector in
the world and I'm not artistic enough to

23
00:01:38,100 --> 00:01:41,369
find any other color combination that
works so these will be really boring

24
00:01:41,369 --> 00:01:47,909
slides so before you start on give you a
little bit of a disclaimer i am not

25
00:01:47,909 --> 00:01:53,520
going to show you crazy NSA Lee zero-day
firewall hacks in this talk what I'm

26
00:01:53,520 --> 00:01:56,908
going to show you are things that are
fundamental flaws in the way that the

27
00:01:56,909 --> 00:01:59,909
firewall designed and the premises the
products are built on

28
00:02:01,010 --> 00:02:06,650
it is great for us right because that
means this isn't simply a patch in its

29
00:02:06,650 --> 00:02:10,640
fixed or firmware update and it's fixed
these are things that are broken in the

30
00:02:10,639 --> 00:02:13,640
product and probably are not going to be
fixed

31
00:02:14,300 --> 00:02:17,600
there's one particular vendor that you
all recognize as we get into the slides

32
00:02:17,600 --> 00:02:20,480
and make such a next-gen firewall will
recognize that would pick on for the

33
00:02:20,480 --> 00:02:26,480
sake of example but they pretty much all
work the same way and I've talked to

34
00:02:26,480 --> 00:02:29,149
this vendor about these problems the
other people talk to this vendor about

35
00:02:29,150 --> 00:02:32,720
these problems and of interference was
like yeah that's pretty much how it

36
00:02:32,720 --> 00:02:41,870
works not gonna be fixed so so that's
pretty great so little review little

37
00:02:41,870 --> 00:02:46,190
primer for I you are you know new
firewalls a traditional fire all filters

38
00:02:46,190 --> 00:02:49,130
a player 3 and therefore when I sailor
three-layer for who knows what I'm

39
00:02:49,130 --> 00:02:51,260
talking about called ok

40
00:02:51,260 --> 00:02:56,989
OSI model right very good so that means
we're filtering on things like IP poor

41
00:02:56,990 --> 00:03:01,880
things like that maybe depending on your
firewall vendor I know the essay will do

42
00:03:01,880 --> 00:03:06,829
like layer to a little bit do some
limited deep packet inspection for very

43
00:03:06,830 --> 00:03:10,640
specific things that you can figure it
to look for but mostly you're filtering

44
00:03:10,640 --> 00:03:15,738
is going to be alert 3 and therefore
rules are built to you let traffic out

45
00:03:15,739 --> 00:03:18,739
the firewall dynamically open sports
electronic back in based on what

46
00:03:18,739 --> 00:03:23,870
observes in the connection setup and
it's pretty much permit the night um I

47
00:03:23,870 --> 00:03:27,019
think that it's important to remember
too that when you think about

48
00:03:27,019 --> 00:03:33,650
traditional firewalls next-gen firewalls
they're very context-based next part

49
00:03:33,650 --> 00:03:37,459
walls are so in traditional firewalls
traffic always looks the same so things

50
00:03:37,459 --> 00:03:42,170
like IPS ports things that don't change
a lot so the way the traffic appears to

51
00:03:42,170 --> 00:03:46,609
the firewalls very very static and then
of course you get matt and pat and

52
00:03:46,610 --> 00:03:49,730
routing and all the other fun stuff that
you need to stick something in your

53
00:03:49,730 --> 00:03:54,799
network so the advantages quote-unquote
that you'll get with the next-gen

54
00:03:54,800 --> 00:03:59,870
firewall is things like you can filter
layer 2 so this would mean mac address

55
00:03:59,870 --> 00:04:03,290
layer for example all the way into their
seven which is the juicy stuff the

56
00:04:03,290 --> 00:04:08,000
payload the data is being delivered as
the traffic across the wire on the

57
00:04:08,000 --> 00:04:13,609
salespeople tell you I rules and this is
a whole separate talk you have the still

58
00:04:13,609 --> 00:04:14,580
have the principles of

59
00:04:14,580 --> 00:04:19,799
static contact so I peas and subnets and
vlans and ports things like that but you

60
00:04:19,798 --> 00:04:25,440
also have dynamic objects so you take
data from external sources like dns like

61
00:04:25,440 --> 00:04:29,880
Active Directory event logs like
wireless controller analogues I captive

62
00:04:29,880 --> 00:04:35,610
portal authentication you feed it to the
firewall and get ties that data back to

63
00:04:35,610 --> 00:04:40,590
ip-based traffic by parsing out well
this is authentication tip came from Joe

64
00:04:40,590 --> 00:04:45,929
and IP 192 168 1 by 5 protected
directories if I see traffic for from

65
00:04:45,930 --> 00:04:49,200
that IP i'm going to talk to Joe and I
can build rules but Joe can move around

66
00:04:49,200 --> 00:04:55,440
the network a lot right so so you're uh
you're context of a very dynamic I think

67
00:04:55,440 --> 00:04:59,610
connection firewalls as more of a
decision device rather than just a

68
00:04:59,610 --> 00:05:03,540
filtering device because there's a lot
of different things you can do based on

69
00:05:03,540 --> 00:05:07,620
what that package looks like and it
could be something as simple as dlp

70
00:05:07,620 --> 00:05:12,660
could be qos it could be route changes
all kinds of different stuff I'm and

71
00:05:12,660 --> 00:05:16,200
then of course you get the the
salesperson buzzword bingo apt threat

72
00:05:16,200 --> 00:05:23,760
intelligence a threat prevention you
know all that fun stuff cyber SI that so

73
00:05:23,760 --> 00:05:27,210
as security practitioners well they're
like comment and this is awesome I'm

74
00:05:27,210 --> 00:05:31,440
this fire was going to dig down deep
into every packet right and it's going

75
00:05:31,440 --> 00:05:34,200
to look at and it's gonna match very
very specific set of characteristics

76
00:05:34,200 --> 00:05:41,460
that we specify and if it doesn't match
then we're just gonna drop it and if the

77
00:05:41,460 --> 00:05:46,080
real response coming back and if the
responses look like it should drop it

78
00:05:46,080 --> 00:05:49,469
and it's gonna be great and no traffic
going to ever leave the network and you

79
00:05:49,470 --> 00:05:50,550
know it's gonna be awesome

80
00:05:50,550 --> 00:05:57,450
so what I'm going to tell you is that is
not exactly true and some guys and I got

81
00:05:57,450 --> 00:06:00,479
a couple referencing the talk when
action firewalls first sort of started

82
00:06:00,479 --> 00:06:05,099
becoming mainstream back in $MONTH 2012
redwood Berg and Dave lasalle Brad did a

83
00:06:05,100 --> 00:06:10,110
talk on 19 and David a talk at nola sec
and they sort of started to scratch the

84
00:06:10,110 --> 00:06:15,990
surface of these issues and how these a
spirals work but and i'll have the

85
00:06:15,990 --> 00:06:19,080
references bills talk to the end if
you'll check those out as well but they

86
00:06:19,080 --> 00:06:22,800
actually scratch the surface and they
like me talk to the vendor so yeah

87
00:06:22,800 --> 00:06:24,510
that's pretty much how it works

88
00:06:24,510 --> 00:06:28,349
so here we are four five years later
same issue still exists

89
00:06:28,350 --> 00:06:35,700
so why can't we do what the firewall
mentor says this is going to do it's too

90
00:06:35,700 --> 00:06:39,390
expensive computationally and it's too
expensive network latency was right I'm

91
00:06:39,390 --> 00:06:42,690
you can't sit and hold pack indefinitely
while you scroll through a database of

92
00:06:42,690 --> 00:06:48,900
35,000 applications looking for the app
ID signature ok I you know you can't sit

93
00:06:48,900 --> 00:06:52,859
and hold the response today and that
connection the trafficking back inbound

94
00:06:52,860 --> 00:06:55,800
indefinitely while you're looking to
make sure it fits a very particular

95
00:06:55,800 --> 00:06:56,940
pattern

96
00:06:56,940 --> 00:07:00,240
I'm you're going to run that your own
cpu up on management plan the firewall

97
00:07:00,240 --> 00:07:03,990
right and you're also going to introduce
a tremendous amount network latency and

98
00:07:03,990 --> 00:07:08,430
insecurity what wins security or
performance performance always wins

99
00:07:08,430 --> 00:07:09,210
right

100
00:07:09,210 --> 00:07:13,260
the second piece of that is rule
management if you did that would be

101
00:07:13,260 --> 00:07:14,460
insane

102
00:07:14,460 --> 00:07:18,599
so you can be trying to try to permit
just very very specific things and you

103
00:07:18,600 --> 00:07:25,230
have a 10,000 rule base and yeah so the
next firewall take some shortcuts and

104
00:07:25,230 --> 00:07:29,790
first thing it does is it will actually
allow unrestricted traffic flow if

105
00:07:29,790 --> 00:07:33,210
you're using app ID i think other
vendors may call some different app

106
00:07:33,210 --> 00:07:38,039
ideas that layer 7 inspection until the
firewall season of traffic to figure out

107
00:07:38,040 --> 00:07:44,400
what type of app is flowing through the
firewall now the second point is really

108
00:07:44,400 --> 00:07:45,900
really really important

109
00:07:45,900 --> 00:07:50,010
the firewall generally will look at
traffic going out it will not care about

110
00:07:50,010 --> 00:07:52,830
what comes back in and we're gonna have
some fun with that here a little bit

111
00:07:52,830 --> 00:07:58,979
assumptions therefore attributes so a
great example this is this particular

112
00:07:58,980 --> 00:08:01,980
vendors firewall and I've seen some
others to do it as well if you send

113
00:08:01,980 --> 00:08:06,150
something up or 43 and the firewall
can't clearly figure out what it is

114
00:08:06,150 --> 00:08:12,630
it assumes its SL so if you have a rule
that permit SL you want like base64

115
00:08:12,630 --> 00:08:15,570
encoded violence and it out and the
firewall can't read all of this seller's

116
00:08:15,570 --> 00:08:22,830
fine let go and the like we talked about
there's a lot of performance trade-offs

117
00:08:22,830 --> 00:08:29,820
in the NGF w's so if you're trying to
match a nap

118
00:08:29,820 --> 00:08:34,049
it's you can only work on so many
characteristics and there's a couple

119
00:08:34,049 --> 00:08:35,829
reasons that will get into later

120
00:08:35,830 --> 00:08:39,850
so a little more visual example this is
the OSI model thing you'll learn for

121
00:08:39,850 --> 00:08:44,170
CCNA and then probably forgot after you
pass the test but I want you to think

122
00:08:44,169 --> 00:08:48,280
about i like this because it's a top
it's a bottom down application the left

123
00:08:48,280 --> 00:08:53,500
721 and I want you think about those
layers of the bottom in orange one two

124
00:08:53,500 --> 00:08:58,180
three and four you have to build all
that before you get to layer 7 to do the

125
00:08:58,180 --> 00:09:02,469
inspection so I've seen some nodding and
some guy I think you guys kind of scene

126
00:09:02,470 --> 00:09:06,520
where there's going to be some problems
with this right so I'm good example and

127
00:09:06,520 --> 00:09:09,850
for those of you who were connection
firewall trying to exactly what vendor

128
00:09:09,850 --> 00:09:15,940
we're talking about now this is the
skype signature from this this vendors

129
00:09:15,940 --> 00:09:20,440
firewall uh and i won't they be part of
this is I want you to look at the line

130
00:09:20,440 --> 00:09:25,990
the standard ports tcp dynamic and UDP
dynamic that's their code word for any

131
00:09:25,990 --> 00:09:32,740
so if you have a rule that the sky but
there's a number perhaps like that if

132
00:09:32,740 --> 00:09:40,120
you have a rule that allows this app out
the firewall it's going to allow any

133
00:09:40,120 --> 00:09:45,970
traffic out on any port until it sees
enough data to figure out this is or is

134
00:09:45,970 --> 00:09:52,720
not skype so and i said it's not it's
not moving just this app and it's also

135
00:09:52,720 --> 00:09:56,110
the same if you were say have an app
that allows trafficking on a certain

136
00:09:56,110 --> 00:10:01,210
ports that you on facebook photos I
don't know something like that it's

137
00:10:01,210 --> 00:10:05,350
going to allow all the connections out
until it makes the decision on whether

138
00:10:05,350 --> 00:10:10,960
or not it is that app so this is my Tom
Petty reference for some reason I

139
00:10:10,960 --> 00:10:14,170
starting tomm . references and every one
of my talks i realized after for talking

140
00:10:14,170 --> 00:10:16,510
is done I've done and that's just a
tradition now so into the great wide

141
00:10:16,510 --> 00:10:20,740
open all the connections in this video's
firewall start is insufficient data

142
00:10:20,740 --> 00:10:24,820
that's a nap type specified in there
which means i don't know what this axis

143
00:10:24,820 --> 00:10:30,130
and so you can't block it and you have
to allow the full content connection

144
00:10:30,130 --> 00:10:34,300
handshake out you have to pass some data
and this undated of the amount of data

145
00:10:34,300 --> 00:10:38,469
varies perhaps Oh some apps to three
packets

146
00:10:38,470 --> 00:10:43,450
yes it's good it's not this that we want
the next rule some apps it takes 10-12

147
00:10:43,450 --> 00:10:44,560
packets

148
00:10:44,560 --> 00:10:49,959
so I've got some Python code and some
tools for auditing the stuff and playing

149
00:10:49,960 --> 00:10:54,550
with it and i hope you'll enjoy it you
can get it there i'll have to slide at

150
00:10:54,550 --> 00:10:59,020
the end if you wanna just get it off
there in my contact information but it's

151
00:10:59,020 --> 00:11:03,880
a it's a PLC test kit is a client piece
of server keast server piece rather

152
00:11:03,880 --> 00:11:09,130
excuse me called fire is called fire way
and I had intended to a live demo here

153
00:11:09,130 --> 00:11:13,450
and I borrowed a piece of equipment for
my friend I was a pallet of sales guy

154
00:11:13,450 --> 00:11:19,060
and I burned the storage up in two days
and it so we're stuck with screenshots

155
00:11:19,060 --> 00:11:27,010
but I sure you take this it will work so
so the first thing up

156
00:11:27,010 --> 00:11:31,270
what about is testing this principle of
a closed pores and say we have a set of

157
00:11:31,270 --> 00:11:34,750
layer 4 ports that we allow out and we
have other ports but we have other app

158
00:11:34,750 --> 00:11:39,730
ID rules where maybe were allowing some
traffic out and trying to match on a

159
00:11:39,730 --> 00:11:44,260
layer 7 attribute instead of a layer for
their three attribute so you can start

160
00:11:44,260 --> 00:11:48,520
the fire way server on some past the
decision . of the firewall so the

161
00:11:48,520 --> 00:11:52,240
internet if this is your egress firewall
for example and you know it's pretty

162
00:11:52,240 --> 00:11:54,010
simple start up on a report

163
00:11:54,010 --> 00:11:57,700
ok and then the inside the firewall
launched client you pointed at your

164
00:11:57,700 --> 00:12:03,400
server you started up on their to motor
client mode 0 which is just in random

165
00:12:03,400 --> 00:12:09,579
data and incrementally larger chunks per
connection and see how the fire response

166
00:12:09,580 --> 00:12:14,230
and the server will also give you some
feedback as how much data it's a it's

167
00:12:14,230 --> 00:12:18,010
received payment or you can actually
open a file and extract it out the

168
00:12:18,010 --> 00:12:24,400
network on a closed port which is pretty
cool too and you specify the the size of

169
00:12:24,400 --> 00:12:29,920
the chunk so what'd you run your tests
with the mode 0 you can actually specify

170
00:12:29,920 --> 00:12:33,250
like I want to send the file in 200 bite
chunks because I know the firewalls

171
00:12:33,250 --> 00:12:38,560
filtering doesn't kick in until it sees
4k of data something like that so you

172
00:12:38,560 --> 00:12:42,250
basically took the pile up the servery
symbols for you and it's very nice

173
00:12:42,250 --> 00:12:48,070
so yeah it's okay good uh so there's the
syntax of the client so we started mode

174
00:12:48,070 --> 00:12:51,610
0 this is a port it's not allowed out
the firewall we start with safety

175
00:12:51,610 --> 00:12:54,459
testing 50 bytes of data on each new
connection

176
00:12:54,459 --> 00:12:58,180
we're going to five more bytes of data
so 50 55 60

177
00:12:58,180 --> 00:13:06,969
shut up up to 4k and so you see what's
happening on the server

178
00:13:06,970 --> 00:13:10,240
this is the the clients on the left the
servers on the right now what's

179
00:13:10,240 --> 00:13:13,600
happening is the different example but
the client is something about a hundred

180
00:13:13,600 --> 00:13:18,100
bytes of data incrementally the server
is watching and what it's looking for is

181
00:13:18,100 --> 00:13:23,860
if it gets the same or lower amount of
data onto concurrent connections if it

182
00:13:23,860 --> 00:13:28,060
does it warns you there because that way
you know the firewall feel during has

183
00:13:28,060 --> 00:13:30,910
kicked into effect somewhere and it
started to clamp down on your connection

184
00:13:30,910 --> 00:13:37,630
because you sent more data than the app
ID will let you send so what does this

185
00:13:37,630 --> 00:13:42,880
look like while the firewall is is
distracting through the firewall and

186
00:13:42,880 --> 00:13:46,360
what's wonderful are all rights logs out
of order and I'm take something else

187
00:13:46,360 --> 00:13:49,510
really funny about the screenshot 2 so
you see there's actually incremental a

188
00:13:49,510 --> 00:13:52,899
large amounts of data we have the
application type set as insufficient

189
00:13:52,899 --> 00:13:53,709
data

190
00:13:53,709 --> 00:13:57,520
so this is far away i don't want this
now this is really funny i wrote a rule

191
00:13:57,520 --> 00:14:01,689
to allow paying not saying icmp I'm
saying ping so this is an app ID rule

192
00:14:01,690 --> 00:14:06,250
that supposed to allow only echo and
echo reply that app signature will let

193
00:14:06,250 --> 00:14:12,400
you stand up a full TCP handshake
transmit data across it and close it

194
00:14:12,400 --> 00:14:15,550
down and the firewall can't make a
decision whether that is an echo echo

195
00:14:15,550 --> 00:14:16,810
reply packet or not

196
00:14:16,810 --> 00:14:21,489
oh you know you tell me that there
should be like a 1 packet this is but

197
00:14:21,490 --> 00:14:25,990
it's not so so you see what happened we
have it we have an app ID singular seven

198
00:14:25,990 --> 00:14:29,920
signature or a rule rather and we're
getting traffic out that shouldn't be

199
00:14:29,920 --> 00:14:34,630
permitted out because on clothes for now
you see we get runs it's still trying to

200
00:14:34,630 --> 00:14:39,279
size still turn side up to about 4k it's
56 k somewhere in there it says yeah

201
00:14:39,279 --> 00:14:42,459
I've seen more data than I feel
comfortable saying this is a this

202
00:14:42,459 --> 00:14:48,219
matches the ping app signature and I'm
gonna start nine the traffic so but you

203
00:14:48,220 --> 00:14:52,930
still were able to communicate out on a
closed port using small chunks of data

204
00:14:52,930 --> 00:14:59,680
so and then there's just a quick example
of moving a file on clothes port so you

205
00:14:59,680 --> 00:15:04,089
start up the client mode 1 specify the
filename and then your maximum chunk

206
00:15:04,089 --> 00:15:07,660
size based on maybe what you found
running the tests and 10

207
00:15:09,529 --> 00:15:13,339
so that's pretty cool right i mean we
bypass the firewall restrictions we got

208
00:15:13,339 --> 00:15:17,810
in you know we got an appt out or we use
a nap rule to get data out on court but

209
00:15:17,810 --> 00:15:21,349
it's kind of noisy it's not going to fit
in with your regular traffic profiles

210
00:15:21,350 --> 00:15:26,870
I'm sure everybody here has a sock who
very carefully looks at net flow and and

211
00:15:26,870 --> 00:15:30,259
would see instantly that there was
traffic moving on a closed poured and

212
00:15:30,259 --> 00:15:36,199
thereby does right here by clicking on
the net flow so is there a better tactic

213
00:15:36,199 --> 00:15:39,740
can we can we hide you know a little bit
better and take advantage of other

214
00:15:39,740 --> 00:15:44,899
things in the firewall so this I'm going
example with a signature looks like now

215
00:15:44,899 --> 00:15:49,129
as far as i know you can't look at the
this particular vendor which you all

216
00:15:49,129 --> 00:15:54,649
know who it is now but this particular
vendors database but people have written

217
00:15:54,649 --> 00:15:58,670
custom signatures and you can get they
have a forum and this was a signal to

218
00:15:58,670 --> 00:16:02,389
actually block March Madness streaming
basketball which is when Louisville

219
00:16:02,389 --> 00:16:07,759
that's offensive right but that somebody
was a couple years ago you see that the

220
00:16:07,759 --> 00:16:14,089
criteria for a match is very very very
very simple so you have an HTTP method a

221
00:16:14,089 --> 00:16:19,069
URI path and then down there at the
bottom you have a host header that is it

222
00:16:19,069 --> 00:16:23,899
and I'm gonna tell you something all
this 35,000 apps that it's supposedly

223
00:16:23,899 --> 00:16:28,220
matching that's about it I'd say ninety
percent of our web apps and then it

224
00:16:28,220 --> 00:16:31,519
makes sense right because everything on
your network right now looks like a web

225
00:16:31,519 --> 00:16:34,790
app it's either some kind of mobile app
making restful api calls or it's a

226
00:16:34,790 --> 00:16:36,500
webapp or you know everything

227
00:16:36,500 --> 00:16:41,689
HTTP scalable and it's easy to ride and
everybody knows it and everything was

228
00:16:41,689 --> 00:16:47,000
like web so so it's it's fun we can
actually abuse that pretty significantly

229
00:16:47,000 --> 00:16:52,339
so assuming we know that this is the
criteria that the firewall is looking

230
00:16:52,339 --> 00:17:00,079
for to match a particular app signature
what I open a socket when I pio and I

231
00:17:00,079 --> 00:17:03,979
said that something like this and
firewall really don't it could care less

232
00:17:03,980 --> 00:17:08,209
that it's a well-formed HTTP requests or
not so even though this is a get request

233
00:17:08,209 --> 00:17:12,020
we can even stack a little data here on
the bottom now up i found that about

234
00:17:12,020 --> 00:17:17,000
five-and-a-half 6k it'll start saying
yeah this is not exactly right and

235
00:17:17,000 --> 00:17:21,648
dropping the traffic with a get request
but let's just in something and I very

236
00:17:21,648 --> 00:17:23,149
much i don't have a web server mind

237
00:17:23,150 --> 00:17:26,300
have a rocket can work it doesn't really
matter because we're not looking at

238
00:17:26,300 --> 00:17:27,349
what's being sent back

239
00:17:27,349 --> 00:17:32,240
it's a one-way inspection so
www.linkedin.com just requesting the

240
00:17:32,240 --> 00:17:35,240
root page ice like a user agent in there
just for fun

241
00:17:36,110 --> 00:17:40,580
the firewall believes that traffic is
linked in traffic even though i went to

242
00:17:40,580 --> 00:17:44,389
my IP and i stacked your date on the
bottom of it and it just matches an

243
00:17:44,390 --> 00:17:50,060
internal app so what about something
like this what if we just take this is

244
00:17:50,060 --> 00:17:53,990
just some random post crap i pulled out
a facebook api that's pretty cool

245
00:17:53,990 --> 00:17:57,080
we have a little more room to work
because the body of a post request can

246
00:17:57,080 --> 00:18:01,070
look pretty much like anything I mean
you know it can be long sure you know we

247
00:18:01,070 --> 00:18:06,409
have little room to work for what if we
send it something like this where say we

248
00:18:06,410 --> 00:18:11,870
started inspecting your sponsor strict
enforcement of a post request or uh you

249
00:18:11,870 --> 00:18:17,689
know how the bodies both look well just
pack extra craft an HTTP header it the

250
00:18:17,690 --> 00:18:23,360
firewall don't care and that the answer
is the reason for that is it would be

251
00:18:23,360 --> 00:18:27,080
impossible for these apps signature
vendors to get you an appt signature

252
00:18:27,080 --> 00:18:32,270
every time there was a minor change in
the way that app or that that webpage

253
00:18:32,270 --> 00:18:37,340
whatever communicated so if final
facebook changes their api key for

254
00:18:37,340 --> 00:18:42,770
matter their mobile off-key format you
know the Palo Alto or barracuda we're

255
00:18:42,770 --> 00:18:46,430
Fire Warden they can't keep up with that
right they can check that stuff all they

256
00:18:46,430 --> 00:18:51,140
can do is very very basic checks to see
what host are you going to what page

257
00:18:51,140 --> 00:18:58,070
you're requesting what's the method you
know and what are you pushing so fire

258
00:18:58,070 --> 00:19:02,750
will do this for you can pollute up logs
you can it will actually spooking this

259
00:19:02,750 --> 00:19:06,920
is very basic right now just stay then
it looks like they first example should

260
00:19:06,920 --> 00:19:12,650
get request but you can chunk up pieces
of a file send them out spoof as a

261
00:19:12,650 --> 00:19:16,820
different application so this is kind of
forces under the guise of normal user

262
00:19:16,820 --> 00:19:22,159
surfing or activity and yeah I'm
innovated if you're sending the stock

263
00:19:22,160 --> 00:19:24,659
look and it's like someone's browsing
the internet

264
00:19:24,659 --> 00:19:31,320
oh and also I did had this last week so
because we're making requests for dns

265
00:19:31,320 --> 00:19:34,979
name in that hostetter you guys set it
up so you can actually make a DNS

266
00:19:34,979 --> 00:19:38,279
requests in it you know now you have a
DNS requests paired with the web request

267
00:19:38,279 --> 00:19:43,979
that's pretty a pretty slick so that
that's pretty good right i mean it needs

268
00:19:43,979 --> 00:19:47,549
a little work has spent much of requests
and I mean I don't know about your users

269
00:19:47,549 --> 00:19:51,509
but I've seen some users who can surf
the web pretty fast but still it is not

270
00:19:51,509 --> 00:19:55,049
perfect so you need a little more logic
you need to actually maybe have multiple

271
00:19:55,049 --> 00:19:58,559
ip's that you're sending out too so you
know something like to link bitch that

272
00:19:58,559 --> 00:20:01,619
doesn't choke the log that's linked into
a knife in one time like YouTube the

273
00:20:01,619 --> 00:20:06,779
next time something like that or
different type of app and you need to

274
00:20:06,779 --> 00:20:11,220
insert delays so that's all stuff i'm
going to work on talking multiple

275
00:20:11,220 --> 00:20:15,119
servers reassembling files and chunks of
files that have spent multiple servers

276
00:20:15,119 --> 00:20:18,090
those are some things that I'd certainly
like to add one thing i'd also like to

277
00:20:18,090 --> 00:20:23,849
add would be functionality almost like
bittorrent we're pulling random chunks

278
00:20:23,849 --> 00:20:29,789
of a file out instead and transmitting
them instead of you know sequentially

279
00:20:29,789 --> 00:20:33,359
iterating through the file and pulling
pulling the chunks out and the problem

280
00:20:33,359 --> 00:20:37,830
with that is if you have we had about
such a finite amount of space to work

281
00:20:37,830 --> 00:20:43,590
with you know in any spoofed request
that you don't want to have to waste

282
00:20:43,590 --> 00:20:47,158
like a descriptor saying this is peace
48 of a file or whatever so trying to

283
00:20:47,159 --> 00:20:52,169
figure out a workaround for that is
someone working on so it to me I think

284
00:20:52,169 --> 00:20:56,159
it's one last thing that I think it's
important like we talked about you don't

285
00:20:56,159 --> 00:20:59,999
inspect the response if you're only
inspecting outbound and never return

286
00:20:59,999 --> 00:21:03,059
then does this become a commanding
control channel hidden in plain sight

287
00:21:03,570 --> 00:21:08,009
what prevents me from sending requests
that look like legitimate traffic and

288
00:21:08,009 --> 00:21:12,179
some kind of response comes back that's
telling your client on the inside what

289
00:21:12,179 --> 00:21:14,300
to do or contains data

290
00:21:14,300 --> 00:21:17,840
you know as long as kleiner sense how to
parse it you know even if you start

291
00:21:17,840 --> 00:21:23,780
inspecting response like we talked about
it will be impossible for a vendor in

292
00:21:23,780 --> 00:21:28,940
dfw vendor to keep up with every single
app change right so anytime the content

293
00:21:28,940 --> 00:21:33,080
change legs calling the site for the
HTML comment in or something you know

294
00:21:33,080 --> 00:21:37,100
stupid buried in the webpage and it's
not going to be checked for as long as

295
00:21:37,100 --> 00:21:40,459
the client knows how to go get it then
there's no reason that you can't just

296
00:21:40,460 --> 00:21:44,870
continue to send this traffic out and
your layer 7 inspection fail or logging

297
00:21:44,870 --> 00:21:46,760
will look like good apps

298
00:21:46,760 --> 00:21:53,120
yeah so um so we got a few conclusions
and we've got some time I think a little

299
00:21:53,120 --> 00:21:56,600
bit type of questions think the rooms
open to mrs. goon can we use the room

300
00:21:56,600 --> 00:22:00,949
for discussion it because the rooms open
after this if if we need to or do we

301
00:22:00,950 --> 00:22:02,630
need to go on the hall

302
00:22:02,630 --> 00:22:08,870
she's gonna she's going to first let me
finish up all she's checking so uh

303
00:22:08,870 --> 00:22:13,820
listen particles then the next logical
evolution of filtering but understand

304
00:22:13,820 --> 00:22:14,780
what you're getting out of them

305
00:22:14,780 --> 00:22:17,750
I think that's the biggest thing they're
only gives the data they have whether

306
00:22:17,750 --> 00:22:22,130
that's the data from a nap signature
vendor or if its external data if you're

307
00:22:22,130 --> 00:22:26,600
doing some of the user ID rules and
things like that so that's what decision

308
00:22:26,600 --> 00:22:31,850
making is is really it's only gonna be
as good as what it does look for right

309
00:22:31,850 --> 00:22:37,280
anomaly detection flow monitoring net
flow analysis all those things those are

310
00:22:37,280 --> 00:22:41,930
still king and i think personally and
you know you guys worked these five

311
00:22:41,930 --> 00:22:45,950
platforms may have a different opinion I
think rule bases are a lot more complex

312
00:22:45,950 --> 00:22:48,440
in these and it's easier to make
mistakes

313
00:22:48,440 --> 00:22:53,150
ok we do are no problem we'll go on the
hall if there's not time I think it's a

314
00:22:53,150 --> 00:22:59,270
lot easier to make mistakes because your
order of rules if you're blending layer

315
00:22:59,270 --> 00:23:04,100
seven rules and layer 34 rules and
together becomes really really really

316
00:23:04,100 --> 00:23:08,780
important and like we saw if you
actually put a layer 7 rule of higher in

317
00:23:08,780 --> 00:23:12,379
the order above where your layer 3
filtering rules you're there for

318
00:23:12,380 --> 00:23:17,090
filtering rule is that traffic will be
permitted out up to a certain point so

319
00:23:17,090 --> 00:23:22,459
it it's pretty easy to screw up and I
say that from experience and I've been

320
00:23:22,460 --> 00:23:23,840
working with the

321
00:23:23,840 --> 00:23:29,029
particular vendors firewall for five
years and i know that i made a lot of

322
00:23:29,029 --> 00:23:32,270
mistakes along the way like that and we
have two contestants come in and traffic

323
00:23:32,270 --> 00:23:36,230
would bleed out how is traffic going out
and you know that's what it was

324
00:23:36,770 --> 00:23:43,400
so that's basically a guys I think what
22 23 minutes so right comin right about

325
00:23:43,400 --> 00:23:47,750
on x and comments questions there's the
github there's me the other talks i

326
00:23:47,750 --> 00:23:51,020
talked about those references look them
up i talked to Brandon day both before

327
00:23:51,020 --> 00:23:56,510
this talk the great guys and you know
it's cool stuff so many questions feel

328
00:23:56,510 --> 00:23:57,289
free

329
00:23:57,289 --> 00:24:03,230
yes sir 714 yeah

330
00:24:03,919 --> 00:24:13,370
yes sir very much then why yes

331
00:24:13,370 --> 00:24:16,610
yeah I mean there's only so much for the
question was do other app control like

332
00:24:16,610 --> 00:24:21,678
blue coat and you know those things were
pretty same way I they're just you're so

333
00:24:21,679 --> 00:24:25,580
limited because the apps change faster
than the definitions can be updated and

334
00:24:25,580 --> 00:24:29,449
in what you can do and the I think
there's any number of practical

335
00:24:29,450 --> 00:24:34,909
applications because personally whether
it's a dlp bypassing dlp bypassing web

336
00:24:34,909 --> 00:24:38,539
filtering you know any amount of stuff
like that i think that you know it's

337
00:24:38,539 --> 00:24:42,500
great so anybody else have any other any
other questions comments yet

338
00:24:42,500 --> 00:24:46,549
I'm sorry alright let's get started
talking about monday so you go ahead

339
00:24:47,059 --> 00:24:59,029
uh-huh that is

340
00:25:00,020 --> 00:25:06,350
yeah that's a good question the question
is does HCBS and man-in-the-middle type

341
00:25:06,350 --> 00:25:13,730
things to decrypt SL does it affect this
and and the answer that i found is if

342
00:25:13,730 --> 00:25:18,500
the firewall can read it it will make a
decision on it so that's why i say you

343
00:25:18,500 --> 00:25:22,159
like you said you make a rule to make am
making them work over https but you're

344
00:25:22,159 --> 00:25:25,760
doing as a Cell description on an OS for
example

345
00:25:25,760 --> 00:25:31,490
ok the firewall once it decrypts that SL
if it can read what's in it if it looks

346
00:25:31,490 --> 00:25:36,169
like that even it's your bad IP it will
say it's stealing done or whatever

347
00:25:36,679 --> 00:25:41,299
because I mean pretty much anything you
can read it's going to try to make this

348
00:25:41,299 --> 00:25:44,690
app ID decision or some room

349
00:25:44,690 --> 00:25:50,179
yeah no it's not it's just reading
strictly the the body and again it's

350
00:25:50,179 --> 00:25:52,970
there so many things outside the
firewall vendors control i think that

351
00:25:52,970 --> 00:25:54,080
has a lot to do with it

352
00:25:54,080 --> 00:25:59,629
yes God had a couple of those one on top
of that like even if you are doing

353
00:25:59,629 --> 00:26:03,559
content inspection there are certain
size that should not be doing content

354
00:26:03,559 --> 00:26:08,178
specialist me for like sites that are
HIPAA based or you know where you're

355
00:26:08,179 --> 00:26:13,759
doing credit card transaction should not
be encouraging those right channels so

356
00:26:13,759 --> 00:26:18,440
that they wouldn't be able to do that
it's in that role would be set up and so

357
00:26:18,440 --> 00:26:21,139
that could be either way to get the
street with their work they wouldn't be

358
00:26:21,139 --> 00:26:24,619
able to view the content section find
out what you're actually passed is very

359
00:26:24,619 --> 00:26:28,459
true veteran thought I was thinking it
was like you have it at that is

360
00:26:28,460 --> 00:26:33,679
expecting a lot of data in an outright
soon webex or meet murders of them like

361
00:26:33,679 --> 00:26:37,009
that throughout your company allows you
to do the same sort of thing you were

362
00:26:37,009 --> 00:26:41,240
running like a socks proxy and then you
want to talk about all that information

363
00:26:41,240 --> 00:26:46,789
through proxy back to you your hack
station or whatever at your house then

364
00:26:46,789 --> 00:26:51,799
you're setting up your own towel with
internal so that they might use your

365
00:26:51,799 --> 00:26:55,879
time when I guess what they feel is
either that's not the right kind of data

366
00:26:55,879 --> 00:27:01,279
and then it was little yeah and I mean I
think I think that's a good point of it

367
00:27:01,279 --> 00:27:06,409
and i think that if you if you think
about it it's all about how your stock

368
00:27:06,409 --> 00:27:10,190
looks at things i think that and how
you're monitoring works so I mean if se

369
00:27:10,190 --> 00:27:15,350
you see a bunch of traffic linkedin
that's going to China you know that's

370
00:27:15,350 --> 00:27:20,480
probably couldn't be a red flag right i
mean it i think also the cloud makes it

371
00:27:20,480 --> 00:27:25,999
hard what if I stand a bunch of servers
up on AWS and I spoof some app that's

372
00:27:25,999 --> 00:27:31,340
hosted on AWS well when I do my IP
mappings back you know my reverse

373
00:27:31,340 --> 00:27:34,879
lookups or whatever find the song went
home and watched excellence IP always

374
00:27:34,879 --> 00:27:36,320
shows up his 80s

375
00:27:36,320 --> 00:27:40,549
okay well Salesforce from netflix
whatever right that runs on 80s how do I

376
00:27:40,549 --> 00:27:43,580
know whether it's legitimate well now I
gotta call amazon we're gonna tell me I

377
00:27:43,580 --> 00:27:47,120
don't know you know so I mean it makes
it very very difficult for

378
00:27:47,120 --> 00:27:51,770
did you go to the forensic investigation
but yeah so anything else

379
00:27:53,360 --> 00:27:55,969
alright awesome that hey thanks for
showing up on Sunday appreciate

