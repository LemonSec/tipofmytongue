1
00:00:00,000 --> 00:00:04,290
stuff into your logs and alert

2
00:00:01,319 --> 00:00:05,850
accordingly you know you put G keys as a

3
00:00:04,290 --> 00:00:06,930
username and you don't have a Gary keys

4
00:00:05,850 --> 00:00:08,849
working for you

5
00:00:06,930 --> 00:00:10,200
and you know you start seeing alerts

6
00:00:08,849 --> 00:00:12,240
that so much for the logins owner of G

7
00:00:10,200 --> 00:00:13,860
keys you know you you know you have

8
00:00:12,240 --> 00:00:15,480
someone who's actually attacking you

9
00:00:13,860 --> 00:00:18,410
Ryan this isn't just someone running

10
00:00:15,480 --> 00:00:20,490
open vests or discovered in map today

11
00:00:18,410 --> 00:00:21,810
and I'll come back to that here in a

12
00:00:20,490 --> 00:00:25,349
second but I want to talk about a

13
00:00:21,810 --> 00:00:27,479
different way of trying to separate the

14
00:00:25,350 --> 00:00:29,099
cruft from the real stuff so if you've

15
00:00:27,480 --> 00:00:31,050
never heard a port spoof it's a really

16
00:00:29,099 --> 00:00:33,630
cool project and the intended use case

17
00:00:31,050 --> 00:00:36,090
for it is that you take you to say your

18
00:00:33,630 --> 00:00:39,840
web server and say it's looking for port

19
00:00:36,090 --> 00:00:42,059
3 port spoof the idea is you let that

20
00:00:39,840 --> 00:00:43,530
web server listen on all ports and ports

21
00:00:42,059 --> 00:00:45,780
poop will listen on one two four four

22
00:00:43,530 --> 00:00:47,910
two and four forty four to sixty five

23
00:00:45,780 --> 00:00:50,309
thousand five hundred of our and it will

24
00:00:47,910 --> 00:00:52,500
actually respond with fairly bad looking

25
00:00:50,309 --> 00:00:53,750
hand headers and banners when people try

26
00:00:52,500 --> 00:00:55,739
to connect to and the whole idea is

27
00:00:53,750 --> 00:00:57,480
someone's on your network or someone

28
00:00:55,739 --> 00:00:58,919
scanning your perimeter they have no

29
00:00:57,480 --> 00:01:00,180
idea what's legitimate what's not

30
00:00:58,920 --> 00:01:02,219
legitimate from missing point and map

31
00:01:00,180 --> 00:01:03,629
scan I'll be honest I've never been

32
00:01:02,219 --> 00:01:05,339
brave enough to just take up one my

33
00:01:03,629 --> 00:01:07,289
legitimate servers and you know not put

34
00:01:05,339 --> 00:01:09,869
a firewall in front of it and allow all

35
00:01:07,290 --> 00:01:12,119
ports to be open but what I was brave

36
00:01:09,869 --> 00:01:15,240
enough to do is become that's working

37
00:01:12,119 --> 00:01:17,280
for ahead now the thousand IP addresses

38
00:01:15,240 --> 00:01:18,949
externally facing IP addresses that they

39
00:01:17,280 --> 00:01:21,570
weren't using like most older companies

40
00:01:18,950 --> 00:01:24,299
so I took all those IP addresses and I

41
00:01:21,570 --> 00:01:26,070
netted them to a physical box that was

42
00:01:24,299 --> 00:01:29,549
100 isolated from the rest of my network

43
00:01:26,070 --> 00:01:32,610
and she set up port spoof to listen on

44
00:01:29,549 --> 00:01:34,799
all ports and then I used the harvesters

45
00:01:32,610 --> 00:01:36,509
a list of eight records to give them

46
00:01:34,799 --> 00:01:39,600
about DNS entries that I know that

47
00:01:36,509 --> 00:01:42,720
hacker tools are trying to go for the

48
00:01:39,600 --> 00:01:44,490
whole idea was now I have this box that

49
00:01:42,720 --> 00:01:46,079
is listening on a thousand IP addresses

50
00:01:44,490 --> 00:01:47,070
that are associated with my company you

51
00:01:46,079 --> 00:01:48,119
know some goes to errand on that they

52
00:01:47,070 --> 00:01:51,148
can see that my company has these IP

53
00:01:48,119 --> 00:01:52,740
addresses they start scanning it becomes

54
00:01:51,149 --> 00:01:55,049
really really hard for them to detect

55
00:01:52,740 --> 00:01:56,280
what is real and what is fake and you

56
00:01:55,049 --> 00:01:58,799
know the Pandaren map stains it could

57
00:01:56,280 --> 00:02:02,490
take as much as 12 hours per buck per IP

58
00:01:58,799 --> 00:02:04,950
address to to get a good nmap scan so it

59
00:02:02,490 --> 00:02:07,048
starts to get real real messy so to show

60
00:02:04,950 --> 00:02:10,020
you what that looks like this is a spunk

61
00:02:07,049 --> 00:02:11,489
dashboard of this box and this is in

62
00:02:10,020 --> 00:02:13,470
production so what you're seeing there

63
00:02:11,489 --> 00:02:15,750
is four item

64
00:02:13,470 --> 00:02:17,880
for a four-hour period that's thirty

65
00:02:15,750 --> 00:02:20,250
four thousand three hundred unique IPS

66
00:02:17,880 --> 00:02:22,440
that hit this box so to be clear that's

67
00:02:20,250 --> 00:02:24,360
not now thirty four thousand three

68
00:02:22,440 --> 00:02:26,670
hundred connections this is unique IPS

69
00:02:24,360 --> 00:02:28,710
they hit this box in four hours it was

70
00:02:26,670 --> 00:02:30,660
way more active than I thought it would

71
00:02:28,710 --> 00:02:34,350
be and the ports are what you would

72
00:02:30,660 --> 00:02:36,150
expect for four five 2314 3380 3389

73
00:02:34,350 --> 00:02:38,160
for a while there twenty three twenty

74
00:02:36,150 --> 00:02:41,370
three was super popular that was due to

75
00:02:38,160 --> 00:02:42,540
the Mirai botnet and the source

76
00:02:41,370 --> 00:02:44,010
countries are exactly what you would

77
00:02:42,540 --> 00:02:45,480
expect as well strengths of the

78
00:02:44,010 --> 00:02:48,390
Netherlands was winning at that time but

79
00:02:45,480 --> 00:02:49,739
typically this Russia but yeah I mean

80
00:02:48,390 --> 00:02:51,540
this is three four thousand three under

81
00:02:49,740 --> 00:02:53,760
unique IPS over four hours that are

82
00:02:51,540 --> 00:02:56,579
hitting my perimeter trying to find a

83
00:02:53,760 --> 00:02:58,920
way and it's actually it's really funky

84
00:02:56,580 --> 00:03:00,920
like DNS map or shown in for this

85
00:02:58,920 --> 00:03:02,940
company

86
00:03:00,920 --> 00:03:04,350
just so much stuff comes up ever so

87
00:03:02,940 --> 00:03:05,940
often people pop on Twitter going hey

88
00:03:04,350 --> 00:03:08,190
man have a security contact at this

89
00:03:05,940 --> 00:03:12,150
company because they appear to be super

90
00:03:08,190 --> 00:03:13,109
compromised here's a map of where we

91
00:03:12,150 --> 00:03:15,750
were seeing the traffic coming from

92
00:03:13,110 --> 00:03:17,010
again that's just a four-hour window so

93
00:03:15,750 --> 00:03:21,660
I need to take away there is the

94
00:03:17,010 --> 00:03:22,829
Internet's mean and well jerks yeah it's

95
00:03:21,660 --> 00:03:24,890
a super busy

96
00:03:22,830 --> 00:03:27,090
but it's definitely slowing folks down

97
00:03:24,890 --> 00:03:29,640
but it's not really helping us to

98
00:03:27,090 --> 00:03:32,220
isolate the corrupt from the real stuff

99
00:03:29,640 --> 00:03:33,839
so what can we do with this I think the

100
00:03:32,220 --> 00:03:35,640
audit of the obvious idea is to just

101
00:03:33,840 --> 00:03:37,709
automate your blocking right so I've

102
00:03:35,640 --> 00:03:40,440
seen a single source IP that's hitting

103
00:03:37,709 --> 00:03:41,910
twenty of these addresses it's probably

104
00:03:40,440 --> 00:03:43,650
not some damp one talking to me so I can

105
00:03:41,910 --> 00:03:46,019
block it or single source IP that hit

106
00:03:43,650 --> 00:03:47,670
fourteen ports on one IP address to just

107
00:03:46,019 --> 00:03:50,040
block it I have a link up here to Palo

108
00:03:47,670 --> 00:03:51,359
Alto as mind-meld project it's an open

109
00:03:50,040 --> 00:03:53,700
source project that takes in data

110
00:03:51,360 --> 00:03:56,190
sources and threat intelligence sources

111
00:03:53,700 --> 00:03:58,200
and then spits out on a method that it

112
00:03:56,190 --> 00:03:59,820
can easily be ingested by security

113
00:03:58,200 --> 00:04:01,980
appliances such as Palo Alto firewalls

114
00:03:59,820 --> 00:04:03,870
but can work with other stuff but that's

115
00:04:01,980 --> 00:04:08,190
not really cool or deception so instead

116
00:04:03,870 --> 00:04:10,050
of blocking let's have more deception so

117
00:04:08,190 --> 00:04:11,630
a suggestion I'd make is to start

118
00:04:10,050 --> 00:04:14,430
building some fake internet presence

119
00:04:11,630 --> 00:04:15,570
fake sites portals login pages just

120
00:04:14,430 --> 00:04:17,989
stuff that you sit on the public

121
00:04:15,570 --> 00:04:20,010
internet to mess with those attackers

122
00:04:17,988 --> 00:04:23,070
and since your deal has called poor

123
00:04:20,010 --> 00:04:25,440
spoof stuff you could do things like set

124
00:04:23,070 --> 00:04:26,430
up netting to it anytime you see

125
00:04:25,440 --> 00:04:28,020
something that you know is it

126
00:04:26,430 --> 00:04:29,850
illegitimate or actually just blocking

127
00:04:28,020 --> 00:04:31,080
anything that's legitimate blossoms

128
00:04:29,850 --> 00:04:32,460
remember to be able to reach a real

129
00:04:31,080 --> 00:04:33,750
stuff so you know they're sitting there

130
00:04:32,460 --> 00:04:35,940
all day long and they're hitting all of

131
00:04:33,750 --> 00:04:37,470
your deception sites but they never

132
00:04:35,940 --> 00:04:39,900
actually get to see your real stuff or

133
00:04:37,470 --> 00:04:42,600
if you really have a good Network team

134
00:04:39,900 --> 00:04:44,549
get them to net your legitimate sites

135
00:04:42,600 --> 00:04:46,979
over to the deception sites so if you're

136
00:04:44,550 --> 00:04:48,389
you know you have mail company comm and

137
00:04:46,979 --> 00:04:50,960
that's where your actual mail portal is

138
00:04:48,389 --> 00:04:53,220
let that go to a deceptive mail portal

139
00:04:50,960 --> 00:04:55,020
this is tricky to do and depends on your

140
00:04:53,220 --> 00:04:56,160
technology but it's a great dollar to

141
00:04:55,020 --> 00:04:58,139
throw down with your network team like

142
00:04:56,160 --> 00:05:03,780
hey some guys are recon so this is super

143
00:04:58,139 --> 00:05:08,160
easy so if you can't do it so for

144
00:05:03,780 --> 00:05:11,130
example how about a VPN login page so

145
00:05:08,160 --> 00:05:14,310
this is something I set up created a SSL

146
00:05:11,130 --> 00:05:16,349
VPN login page that had a fake natural

147
00:05:14,310 --> 00:05:17,759
harvesting bug so typical would bug I

148
00:05:16,349 --> 00:05:19,620
give you an eval using a man about

149
00:05:17,759 --> 00:05:21,000
password it returns invalid username I

150
00:05:19,620 --> 00:05:22,740
give you a value to same an invalid

151
00:05:21,000 --> 00:05:24,330
password says and that would password so

152
00:05:22,740 --> 00:05:26,220
you know somebody doing harvesting can

153
00:05:24,330 --> 00:05:27,659
easily script that and say oh oh I can

154
00:05:26,220 --> 00:05:30,030
get a list of all your users this way

155
00:05:27,660 --> 00:05:31,380
and I would also allow them occasionally

156
00:05:30,030 --> 00:05:32,609
to have a successful login and then I

157
00:05:31,380 --> 00:05:34,080
would just sent them to a fake MFA

158
00:05:32,610 --> 00:05:36,810
challenge so they would think hey I just

159
00:05:34,080 --> 00:05:39,599
got full credits on this site easily

160
00:05:36,810 --> 00:05:42,000
scriptable I know from at least one pen

161
00:05:39,599 --> 00:05:43,620
test I kept our tests were busy for a

162
00:05:42,000 --> 00:05:47,849
day before I realized he was doing it I

163
00:05:43,620 --> 00:05:49,349
felt real bad you are kind of wasting

164
00:05:47,849 --> 00:05:52,949
your pen testing dollars on that but

165
00:05:49,349 --> 00:05:55,710
it's fun to watch so you know what I did

166
00:05:52,949 --> 00:05:57,120
I brought it back into all this went did

167
00:05:55,710 --> 00:05:58,530
some research said you know what's the

168
00:05:57,120 --> 00:06:01,220
average age of the American worker which

169
00:05:58,530 --> 00:06:03,419
is 41 years of age average names

170
00:06:01,220 --> 00:06:05,610
correlates adjacent myth being the most

171
00:06:03,419 --> 00:06:08,099
obvious name or the most common name so

172
00:06:05,610 --> 00:06:09,900
I made a weighted table of that and then

173
00:06:08,099 --> 00:06:11,789
I went guy you know there's some common

174
00:06:09,900 --> 00:06:13,109
password lists and put a weighted table

175
00:06:11,789 --> 00:06:14,520
of that so it basically worked out that

176
00:06:13,110 --> 00:06:16,830
if you logged in with Jay Smith and

177
00:06:14,520 --> 00:06:18,840
summer 2019 you had about an 18 percent

178
00:06:16,830 --> 00:06:20,550
chance that coming up as a completely

179
00:06:18,840 --> 00:06:21,960
built credential if you just want them

180
00:06:20,550 --> 00:06:24,659
to JCM if you had an 80 percent chance

181
00:06:21,960 --> 00:06:28,229
of that being a valid username and then

182
00:06:24,659 --> 00:06:30,330
going back to those let's take username

183
00:06:28,229 --> 00:06:32,639
so we put in our meta data you know this

184
00:06:30,330 --> 00:06:34,139
would be a great place that make your

185
00:06:32,639 --> 00:06:36,990
all your login sorry 60 there would be

186
00:06:34,139 --> 00:06:38,190
cheeky 270 keys you know that first

187
00:06:36,990 --> 00:06:40,210
initial last name or first initial

188
00:06:38,190 --> 00:06:41,860
period last name so again someone that

189
00:06:40,210 --> 00:06:43,388
attacking your perimeter thinks that

190
00:06:41,860 --> 00:06:45,039
they're getting fake getting your user

191
00:06:43,389 --> 00:06:46,569
name formats sinks are getting real user

192
00:06:45,039 --> 00:06:48,099
names but really they're not getting

193
00:06:46,569 --> 00:06:50,319
anything so the show what that looks

194
00:06:48,100 --> 00:06:52,599
like my company does not have a

195
00:06:50,319 --> 00:06:54,069
SonicWALL so I just stole this from the

196
00:06:52,599 --> 00:06:56,759
show then search found someone sonic

197
00:06:54,069 --> 00:06:58,539
wanting to stole it and to be very clear

198
00:06:56,759 --> 00:06:59,650
SonicWALL does not have this

199
00:06:58,539 --> 00:07:01,120
vulnerability they don't have a

200
00:06:59,650 --> 00:07:04,258
credential harvesting bug I just created

201
00:07:01,120 --> 00:07:06,370
this so here they are adult username

202
00:07:04,259 --> 00:07:08,740
here they are with an invalid password

203
00:07:06,370 --> 00:07:12,190
and man super happy he thinks he's got a

204
00:07:08,740 --> 00:07:14,860
real username or if they get the actual

205
00:07:12,190 --> 00:07:16,840
MFA cred or challenge then he thinks

206
00:07:14,860 --> 00:07:18,070
he's got a full log really has got

207
00:07:16,840 --> 00:07:19,840
nothing but now you know you have

208
00:07:18,070 --> 00:07:22,330
something that is totally worth watching

209
00:07:19,840 --> 00:07:26,440
your internal your interior for your

210
00:07:22,330 --> 00:07:28,210
internal network for and I mean it kind

211
00:07:26,440 --> 00:07:29,710
of separate that cruft from a real

212
00:07:28,210 --> 00:07:31,060
attacker right like someone who made it

213
00:07:29,710 --> 00:07:33,099
this far you know that's a real attacker

214
00:07:31,060 --> 00:07:36,909
this is not someone who's just scanning

215
00:07:33,099 --> 00:07:38,530
your perimeter that's cool oh and one

216
00:07:36,909 --> 00:07:39,969
other thing if you're not from their

217
00:07:38,530 --> 00:07:42,309
honey badger this is a project from

218
00:07:39,970 --> 00:07:44,409
Black Hills and it's a geolocation it's

219
00:07:42,310 --> 00:07:46,570
it's kind of a back sort of thing and

220
00:07:44,409 --> 00:07:48,219
the idea is you know you get them to

221
00:07:46,570 --> 00:07:50,830
execute the attacker to execute some

222
00:07:48,220 --> 00:07:52,060
code on their box and you know the

223
00:07:50,830 --> 00:07:53,650
Google API is the track

224
00:07:52,060 --> 00:07:55,120
where they actually are John strand

225
00:07:53,650 --> 00:07:57,609
showed a bit of this at his his

226
00:07:55,120 --> 00:08:00,009
presentation yesterday the trick with

227
00:07:57,610 --> 00:08:01,210
this has always been trying to get the

228
00:08:00,009 --> 00:08:02,889
attacker to launch something on their

229
00:08:01,210 --> 00:08:04,840
box and you used to be only a Java

230
00:08:02,889 --> 00:08:06,520
applet and trying to get someone in to

231
00:08:04,840 --> 00:08:10,539
launch a Java applet when t19 is real

232
00:08:06,520 --> 00:08:13,719
hard but for an SSL VPN it's totally

233
00:08:10,539 --> 00:08:17,110
legitimate host checkers require Java

234
00:08:13,719 --> 00:08:19,719
typically so this is a really obvious

235
00:08:17,110 --> 00:08:21,580
and completely legitimate way that

236
00:08:19,719 --> 00:08:25,120
sometimes I gotta install that Java

237
00:08:21,580 --> 00:08:26,469
applet and you know your taxes are just

238
00:08:25,120 --> 00:08:28,870
the best you're in usually yeah sure run

239
00:08:26,469 --> 00:08:33,010
out there so that's a cool way of doing

240
00:08:28,870 --> 00:08:34,630
it so this I just open sourced this and

241
00:08:33,010 --> 00:08:38,049
call it the web trolling framework or

242
00:08:34,630 --> 00:08:38,770
WTF so you can go to that github

243
00:08:38,049 --> 00:08:40,120
repository

244
00:08:38,770 --> 00:08:43,059
oh by the way if you work for a company

245
00:08:40,120 --> 00:08:44,740
that refuses to do anything unless

246
00:08:43,059 --> 00:08:47,410
Gartner tells them to or compliance

247
00:08:44,740 --> 00:08:49,839
tells them to or you know it's an

248
00:08:47,410 --> 00:08:51,910
industry best practice we need to get

249
00:08:49,839 --> 00:08:53,510
hub repository industry best practice so

250
00:08:51,910 --> 00:08:55,100
you can tell your employer

251
00:08:53,510 --> 00:08:58,189
no this total great industry best

252
00:08:55,100 --> 00:08:58,660
practice for sample web troll give it a

253
00:08:58,190 --> 00:09:01,490
shot

254
00:08:58,660 --> 00:09:03,170
all right so let's go inside so that's

255
00:09:01,490 --> 00:09:06,010
that's trying to wean stuff off of the

256
00:09:03,170 --> 00:09:08,510
internet so let's take this back inside

257
00:09:06,010 --> 00:09:10,100
so a couple scenarios here let's say you

258
00:09:08,510 --> 00:09:11,900
have a foreign device on your network so

259
00:09:10,100 --> 00:09:13,160
someone tailgate their way in you know

260
00:09:11,900 --> 00:09:14,510
someone from trusts that came in and

261
00:09:13,160 --> 00:09:17,060
dropped the tap on your network or

262
00:09:14,510 --> 00:09:18,050
something like that I know right I just

263
00:09:17,060 --> 00:09:20,300
thought you come into the core my eyes

264
00:09:18,050 --> 00:09:23,000
I'm just going to call you out anyway so

265
00:09:20,300 --> 00:09:23,959
they get a device on your network so

266
00:09:23,000 --> 00:09:24,770
they're gonna start mapping right they

267
00:09:23,960 --> 00:09:26,990
don't know where they're at they don't

268
00:09:24,770 --> 00:09:27,829
know where they landed probably the

269
00:09:26,990 --> 00:09:29,480
first things they're going to do because

270
00:09:27,830 --> 00:09:30,950
it's more or less passive they started

271
00:09:29,480 --> 00:09:33,080
scanning you know doing reverse DNS

272
00:09:30,950 --> 00:09:35,510
lookups and you know you can set your

273
00:09:33,080 --> 00:09:38,810
sim alerts of a single source IP that's

274
00:09:35,510 --> 00:09:40,819
hitting a ton of DNS entries but it's a

275
00:09:38,810 --> 00:09:42,380
race condition and if I have a foothold

276
00:09:40,820 --> 00:09:44,090
on your network I have no reason to rush

277
00:09:42,380 --> 00:09:46,610
I mean which a trace conditioner for

278
00:09:44,090 --> 00:09:48,560
skin or 14's checks and ten minutes I

279
00:09:46,610 --> 00:09:50,000
mean I could wait months on this but

280
00:09:48,560 --> 00:09:51,859
what you can do is just create a bunch

281
00:09:50,000 --> 00:09:53,780
of the fake point of records you know

282
00:09:51,860 --> 00:09:55,600
put something in all subnets just you

283
00:09:53,780 --> 00:09:57,680
know everyone's got unused IP space and

284
00:09:55,600 --> 00:10:00,560
then just put that your send me time you

285
00:09:57,680 --> 00:10:01,849
see someone query that DNS record you

286
00:10:00,560 --> 00:10:04,250
know that's an alert that's you

287
00:10:01,850 --> 00:10:07,700
shouldn't see unless it's true positive

288
00:10:04,250 --> 00:10:10,730
and you can go track them down going

289
00:10:07,700 --> 00:10:12,230
further and that pentesters love their

290
00:10:10,730 --> 00:10:13,970
internet scans they come and go you got

291
00:10:12,230 --> 00:10:15,230
a Palo Alto er and Mexicans go right

292
00:10:13,970 --> 00:10:17,630
around that no problem we're not

293
00:10:15,230 --> 00:10:19,910
concerned but honey pots is where it's

294
00:10:17,630 --> 00:10:21,560
at and most people honeypot state your

295
00:10:19,910 --> 00:10:22,910
money that you're the complexity you

296
00:10:21,560 --> 00:10:24,439
don't need that special early detection

297
00:10:22,910 --> 00:10:26,569
all you need is something that's sitting

298
00:10:24,440 --> 00:10:28,400
on your network and has no restrain

299
00:10:26,570 --> 00:10:29,740
would never interact with it so our

300
00:10:28,400 --> 00:10:32,000
friends over at binary defense have a

301
00:10:29,740 --> 00:10:34,370
really really cool tool called artillery

302
00:10:32,000 --> 00:10:37,880
all this is a Python script that listens

303
00:10:34,370 --> 00:10:39,350
on a set of ports and spits out to a log

304
00:10:37,880 --> 00:10:42,890
file if anyone ever connects to it on

305
00:10:39,350 --> 00:10:44,000
that port it's all it is and what I like

306
00:10:42,890 --> 00:10:45,560
to do with this over what I totally

307
00:10:44,000 --> 00:10:46,240
recommend doing this is grab yourself a

308
00:10:45,560 --> 00:10:49,280
Raspberry Pi

309
00:10:46,240 --> 00:10:51,740
put a ton of IP addresses on it the

310
00:10:49,280 --> 00:10:53,839
research I chose so I saw somebody got

311
00:10:51,740 --> 00:10:54,410
4000 IPS on a single Raspberry Pi before

312
00:10:53,840 --> 00:10:58,100
it exploded

313
00:10:54,410 --> 00:11:00,530
so there's 4,000 honey pots for you but

314
00:10:58,100 --> 00:11:02,720
drop it on your network and let it roll

315
00:11:00,530 --> 00:11:03,520
if anyone scans your network chances are

316
00:11:02,720 --> 00:11:05,140
they're going to hit that

317
00:11:03,520 --> 00:11:07,180
right and we're talking about a $30

318
00:11:05,140 --> 00:11:09,400
solution for four thousand ID or four

319
00:11:07,180 --> 00:11:11,199
thousand honey pots good luck to the

320
00:11:09,400 --> 00:11:14,680
test and to the attackers of avoiding

321
00:11:11,200 --> 00:11:16,510
that and again there should be almost no

322
00:11:14,680 --> 00:11:19,319
false positives of this it's it's a box

323
00:11:16,510 --> 00:11:22,180
in your network that no one uses right

324
00:11:19,320 --> 00:11:23,920
and then the other thing I see people do

325
00:11:22,180 --> 00:11:25,510
all the time is run responder every pen

326
00:11:23,920 --> 00:11:27,490
test I've seen for years the first thing

327
00:11:25,510 --> 00:11:29,980
that the tester does is it comes in

328
00:11:27,490 --> 00:11:31,870
plugged into my network watches terminal

329
00:11:29,980 --> 00:11:35,050
launches responder minimizes it and says

330
00:11:31,870 --> 00:11:38,680
I'll come back to that later so first

331
00:11:35,050 --> 00:11:39,969
thing disable element R please I've done

332
00:11:38,680 --> 00:11:41,680
that myself is still enabling that by

333
00:11:39,970 --> 00:11:43,690
default if anyone's ever had a problem

334
00:11:41,680 --> 00:11:45,689
disabling like it's caused problems come

335
00:11:43,690 --> 00:11:48,010
talk to me because I'd love to hear why

336
00:11:45,690 --> 00:11:49,390
but once you've done that there's a

337
00:11:48,010 --> 00:11:51,490
fantastic open-source tool called

338
00:11:49,390 --> 00:11:53,319
responder all it does is it sends it

339
00:11:51,490 --> 00:11:55,060
along in our request using a random host

340
00:11:53,320 --> 00:11:57,340
name that should not exist in your

341
00:11:55,060 --> 00:11:59,439
network and something responds it lets

342
00:11:57,340 --> 00:12:01,120
you know so you put in a cron job let it

343
00:11:59,440 --> 00:12:02,170
run every minute and just element

344
00:12:01,120 --> 00:12:04,120
requests hello in our request if

345
00:12:02,170 --> 00:12:07,360
something ever responds I guarantee this

346
00:12:04,120 --> 00:12:09,370
responder so again put this on your

347
00:12:07,360 --> 00:12:11,380
Raspberry Pi put on this 4,000 I piece

348
00:12:09,370 --> 00:12:13,870
you know every subnet has responder

349
00:12:11,380 --> 00:12:18,040
running every minute there it's making

350
00:12:13,870 --> 00:12:19,810
it real hard for that attacker so what

351
00:12:18,040 --> 00:12:21,880
you all were watching sublime last night

352
00:12:19,810 --> 00:12:23,260
a couple of friends and I were up late

353
00:12:21,880 --> 00:12:26,650
in our hotel room getting this thing

354
00:12:23,260 --> 00:12:28,420
live so new project called Bootsy which

355
00:12:26,650 --> 00:12:31,120
automates the deployment of artillery

356
00:12:28,420 --> 00:12:33,520
and responder on raspberry PI's does the

357
00:12:31,120 --> 00:12:36,340
IP address configuration for you sets up

358
00:12:33,520 --> 00:12:39,160
syslog and email alerting takes a minute

359
00:12:36,340 --> 00:12:41,560
to create hundreds of honey pots super

360
00:12:39,160 --> 00:12:44,469
super simple I wish I had this three

361
00:12:41,560 --> 00:12:46,359
years ago but please check it out like I

362
00:12:44,470 --> 00:12:47,620
said we just pushed it yesterday this is

363
00:12:46,360 --> 00:12:50,410
an initial release we call it a starting

364
00:12:47,620 --> 00:12:53,950
line love to hear some feedback and what

365
00:12:50,410 --> 00:12:55,360
you guys think of it alright cool all

366
00:12:53,950 --> 00:12:57,040
right so let's say they have it they've

367
00:12:55,360 --> 00:12:59,290
compromised natural trusted system you

368
00:12:57,040 --> 00:13:01,630
know phishing attack what have you so

369
00:12:59,290 --> 00:13:02,770
you think they're gonna start doing is

370
00:13:01,630 --> 00:13:05,170
looking for credentials that are stored

371
00:13:02,770 --> 00:13:06,939
in that box so let's give them some a

372
00:13:05,170 --> 00:13:08,290
couple commands up there are placing

373
00:13:06,940 --> 00:13:10,150
things in the windows credentials store

374
00:13:08,290 --> 00:13:12,910
so you could just put this in your logon

375
00:13:10,150 --> 00:13:14,890
scripts place to place some credentials

376
00:13:12,910 --> 00:13:16,770
that you know about and the description

377
00:13:14,890 --> 00:13:20,040
be seen let's try to login to them

378
00:13:16,770 --> 00:13:21,540
again put in your salmon alert cooler

379
00:13:20,040 --> 00:13:24,329
project down below honey bits and honey

380
00:13:21,540 --> 00:13:25,649
hash give it get a bit more fancy will

381
00:13:24,330 --> 00:13:28,200
actually inject things in else as to

382
00:13:25,649 --> 00:13:30,630
play with the WCE or mini cats again

383
00:13:28,200 --> 00:13:32,160
just put me your login scripts if you

384
00:13:30,630 --> 00:13:34,020
find Ben 10 I'll talk about this a

385
00:13:32,160 --> 00:13:35,339
little bit later - Ben 10 has a new

386
00:13:34,020 --> 00:13:37,500
project that he's building called polar

387
00:13:35,339 --> 00:13:40,380
bear and he's building this in as well

388
00:13:37,500 --> 00:13:41,730
and it looks insanely cool so hit him up

389
00:13:40,380 --> 00:13:43,050
he's walking around right now it's like

390
00:13:41,730 --> 00:13:46,290
three kids you can tell cuz he's about a

391
00:13:43,050 --> 00:13:47,969
foot higher than them look it looks like

392
00:13:46,290 --> 00:13:50,969
a big brother who's having to babysit so

393
00:13:47,970 --> 00:13:52,170
that consider doing this for other

394
00:13:50,970 --> 00:13:54,029
common applications like putting

395
00:13:52,170 --> 00:13:56,849
FileZilla you know put in some saved

396
00:13:54,029 --> 00:13:58,410
logins there's actually some really cool

397
00:13:56,850 --> 00:14:00,180
deceptive SSH servers out there like

398
00:13:58,410 --> 00:14:01,740
calorie you can put in a fake login

399
00:14:00,180 --> 00:14:04,079
someone gains access to your network or

400
00:14:01,740 --> 00:14:05,940
to a box and they try to SSH into these

401
00:14:04,080 --> 00:14:07,500
boxes you can let them play around for a

402
00:14:05,940 --> 00:14:10,740
while while you slowly find them and

403
00:14:07,500 --> 00:14:12,540
tase them so Jon talked a little bit

404
00:14:10,740 --> 00:14:14,160
about this yesterday actually a lot

405
00:14:12,540 --> 00:14:15,599
about this yesterday the another thing

406
00:14:14,160 --> 00:14:17,939
they're very likely disor looking for

407
00:14:15,600 --> 00:14:20,820
juicy files canary tokens

408
00:14:17,940 --> 00:14:21,810
think'st this stuff that's fantastic I'm

409
00:14:20,820 --> 00:14:23,880
not gonna harp on this too long because

410
00:14:21,810 --> 00:14:25,920
Jana I took care of it but really check

411
00:14:23,880 --> 00:14:28,350
out this website there are so many easy

412
00:14:25,920 --> 00:14:29,550
things that you can generate and get

413
00:14:28,350 --> 00:14:31,079
simple alerts you not to build up any

414
00:14:29,550 --> 00:14:32,160
infrastructure for this they took care

415
00:14:31,079 --> 00:14:33,479
of all of it you just have to put the

416
00:14:32,160 --> 00:14:35,160
files in your system

417
00:14:33,480 --> 00:14:37,079
what I like to do is just put these on

418
00:14:35,160 --> 00:14:38,310
like the user profile directory not in

419
00:14:37,079 --> 00:14:41,160
their documents but just in the user

420
00:14:38,310 --> 00:14:45,479
profile directory and wait for someone

421
00:14:41,160 --> 00:14:47,969
to hit it what drives are mapped so this

422
00:14:45,480 --> 00:14:50,100
is really fun so here's the only

423
00:14:47,970 --> 00:14:53,279
honeypot server I recommend inside and

424
00:14:50,100 --> 00:14:55,110
it's just a simple SMB server I use now

425
00:14:53,279 --> 00:14:57,570
you can just run Samba up with an actual

426
00:14:55,110 --> 00:14:58,709
Windows server and then build some fake

427
00:14:57,570 --> 00:15:00,480
with Drive napkins through your logon

428
00:14:58,709 --> 00:15:03,149
scripts so the lower red key hack I have

429
00:15:00,480 --> 00:15:05,339
here just hides the drive letters from

430
00:15:03,149 --> 00:15:06,690
the GUI from Windows Explorer so still

431
00:15:05,339 --> 00:15:08,339
show up if I Monica if I'm on the

432
00:15:06,690 --> 00:15:10,680
command prompt and do it you know Renee

433
00:15:08,339 --> 00:15:12,360
I'll see these drives are mapped but the

434
00:15:10,680 --> 00:15:15,660
end user won't see them so what I like

435
00:15:12,360 --> 00:15:17,250
to do is book in my actual drive memory

436
00:15:15,660 --> 00:15:19,709
so say you know our home drive is mapped

437
00:15:17,250 --> 00:15:22,529
to I so I'll create a fake Drive mapping

438
00:15:19,709 --> 00:15:23,819
to H and J reason B 1 just human nature

439
00:15:22,529 --> 00:15:26,939
an attacker will probably start

440
00:15:23,820 --> 00:15:28,079
alphabetically or also ransomware tends

441
00:15:26,940 --> 00:15:29,200
to sorry either alphabetically or

442
00:15:28,079 --> 00:15:30,370
reverse alphabetical is

443
00:15:29,200 --> 00:15:34,510
I give you some help there if you ever

444
00:15:30,370 --> 00:15:36,280
get stuck in that but so called is is

445
00:15:34,510 --> 00:15:37,930
this registry entry and the way when

446
00:15:36,280 --> 00:15:39,400
this works is it it's all in decimal

447
00:15:37,930 --> 00:15:40,989
values the power of two so if you want

448
00:15:39,400 --> 00:15:44,439
to hide they drive remember show up in

449
00:15:40,990 --> 00:15:49,450
the key that's wine and is 81 92 so 1 2

450
00:15:44,440 --> 00:15:51,790
4 8 16 32 6 to getting some fake drive

451
00:15:49,450 --> 00:15:55,120
mappings out there yeah so just stand up

452
00:15:51,790 --> 00:15:56,410
a simple windows file server and I just

453
00:15:55,120 --> 00:15:58,270
wrote a quick PowerShell script that

454
00:15:56,410 --> 00:16:00,400
cloned all the drive letter or all the

455
00:15:58,270 --> 00:16:02,410
files from my main file a server to my

456
00:16:00,400 --> 00:16:05,410
fake one and just fill them with some

457
00:16:02,410 --> 00:16:07,209
random data to make it look real one

458
00:16:05,410 --> 00:16:10,420
other I have done there is how to create

459
00:16:07,210 --> 00:16:11,740
a recursive directory in windows so the

460
00:16:10,420 --> 00:16:13,780
fun thing to do about this is if I'm on

461
00:16:11,740 --> 00:16:16,000
a box and I do like a dir for size s

462
00:16:13,780 --> 00:16:17,709
don't get stuck in there forever if you

463
00:16:16,000 --> 00:16:19,690
have a mature printer shell on a box and

464
00:16:17,710 --> 00:16:21,310
you do a search from there it'll get

465
00:16:19,690 --> 00:16:23,170
stuck forever and they'll lose their

466
00:16:21,310 --> 00:16:24,969
shell and this day you know kill their

467
00:16:23,170 --> 00:16:26,740
shell it'll keep running so hopefully

468
00:16:24,970 --> 00:16:28,510
your end user will eventually go my

469
00:16:26,740 --> 00:16:30,370
system is running like crap what is

470
00:16:28,510 --> 00:16:34,840
going on so you do some hints so

471
00:16:30,370 --> 00:16:36,400
something strange is going on alright so

472
00:16:34,840 --> 00:16:37,690
what can we learn from ad that's

473
00:16:36,400 --> 00:16:39,760
obviously something they're gonna do

474
00:16:37,690 --> 00:16:43,030
right so they're gonna start querying

475
00:16:39,760 --> 00:16:44,590
Active Directory and this is old classic

476
00:16:43,030 --> 00:16:46,600
stuff that everyone should be doing and

477
00:16:44,590 --> 00:16:48,340
I'm always amazed when people aren't so

478
00:16:46,600 --> 00:16:50,290
Kerberos needs a thing fake SPNs is a

479
00:16:48,340 --> 00:16:52,240
great way of dealing with that so create

480
00:16:50,290 --> 00:16:54,760
some obvious SPS I like to stick with

481
00:16:52,240 --> 00:16:57,010
sequel servers give them admin count of

482
00:16:54,760 --> 00:16:58,840
one and start scanning your logs for

483
00:16:57,010 --> 00:17:01,000
anyone trying to use these things

484
00:16:58,840 --> 00:17:03,220
fake computers users and groups what I

485
00:17:01,000 --> 00:17:05,380
like to do is most organizations have

486
00:17:03,220 --> 00:17:07,839
some sort of standard like yeah ATM

487
00:17:05,380 --> 00:17:09,610
endpoints is the group you have for

488
00:17:07,839 --> 00:17:11,589
local admin rights to your engine for

489
00:17:09,609 --> 00:17:13,089
your endpoints cool create an ADM

490
00:17:11,589 --> 00:17:16,480
underscore endpoints our endpoints

491
00:17:13,089 --> 00:17:18,220
underscore ADM and so an attacker has no

492
00:17:16,480 --> 00:17:19,990
idea which group is right I think you

493
00:17:18,220 --> 00:17:21,490
know if you're doing things right you

494
00:17:19,990 --> 00:17:22,359
have separate accounts for a different

495
00:17:21,490 --> 00:17:23,530
privilege level so you have your

496
00:17:22,359 --> 00:17:26,550
standard user account but then your

497
00:17:23,530 --> 00:17:29,680
admins have like a proven scorer account

498
00:17:26,550 --> 00:17:31,060
also give them user underscore private

499
00:17:29,680 --> 00:17:32,350
cow make those that are deceptive creds

500
00:17:31,060 --> 00:17:34,740
and put those in your deceptive grooves

501
00:17:32,350 --> 00:17:36,760
and the whole point of the game is

502
00:17:34,740 --> 00:17:38,260
trying to get to the point where the

503
00:17:36,760 --> 00:17:39,400
attacker is clearing ad and trying to

504
00:17:38,260 --> 00:17:40,550
figure out what Cal says should go after

505
00:17:39,400 --> 00:17:41,900
have no clue

506
00:17:40,550 --> 00:17:44,570
which ones are the ones are actually in

507
00:17:41,900 --> 00:17:47,210
use and which ones are just there and

508
00:17:44,570 --> 00:17:48,740
then it's simple logging right you know

509
00:17:47,210 --> 00:17:50,540
it's not hard to put all the Splunk rule

510
00:17:48,740 --> 00:17:52,190
for looking for anything that has a user

511
00:17:50,540 --> 00:17:54,190
name underscore Prive when all your

512
00:17:52,190 --> 00:17:56,270
logins are pretty under score user name

513
00:17:54,190 --> 00:17:58,880
so you're just building all these little

514
00:17:56,270 --> 00:18:00,680
traps in here fake domain admins again

515
00:17:58,880 --> 00:18:03,560
John dealt with this yesterday as well

516
00:18:00,680 --> 00:18:04,910
someone to back up what he said make

517
00:18:03,560 --> 00:18:06,830
sure that those accounts can't actually

518
00:18:04,910 --> 00:18:08,570
log on because if a domain admin that's

519
00:18:06,830 --> 00:18:10,550
a natural domain admin an attacker can

520
00:18:08,570 --> 00:18:14,050
use there's not a fake domain admin

521
00:18:10,550 --> 00:18:16,550
that's a domain admin so don't do that I

522
00:18:14,050 --> 00:18:18,350
like to use just old corrupt that you

523
00:18:16,550 --> 00:18:19,430
tend to see in order organizations you

524
00:18:18,350 --> 00:18:20,990
know the first person instead of the

525
00:18:19,430 --> 00:18:22,040
center-back invade a domain admin

526
00:18:20,990 --> 00:18:23,830
because they were lazy and they didn't

527
00:18:22,040 --> 00:18:26,720
know any better and that's just stayed

528
00:18:23,830 --> 00:18:28,760
sequel admins is there a good one but

529
00:18:26,720 --> 00:18:30,320
put them in there and make sure they're

530
00:18:28,760 --> 00:18:32,300
not useful for anything set your logon

531
00:18:30,320 --> 00:18:34,100
hours to zero or some group policies to

532
00:18:32,300 --> 00:18:37,360
prevent login and then start looking for

533
00:18:34,100 --> 00:18:39,530
use then getting back to Ben 10 so his

534
00:18:37,360 --> 00:18:41,929
excuse me his polar-bear

535
00:18:39,530 --> 00:18:43,190
IO project again TCM trekking down and

536
00:18:41,930 --> 00:18:44,930
talked about because it's really cool I

537
00:18:43,190 --> 00:18:46,910
won't get into it because I have limited

538
00:18:44,930 --> 00:18:48,320
time but if you wanted to do something

539
00:18:46,910 --> 00:18:51,290
real fun and create an actual fake

540
00:18:48,320 --> 00:18:53,720
Active Directory domain what you have

541
00:18:51,290 --> 00:18:55,760
been 10 product or project is you can

542
00:18:53,720 --> 00:18:57,980
alter the output of things like Who am I

543
00:18:55,760 --> 00:19:00,680
to change what domain you're logged into

544
00:18:57,980 --> 00:19:02,990
so you're logging into Derby con dot

545
00:19:00,680 --> 00:19:04,970
local you create fake Derby con dot

546
00:19:02,990 --> 00:19:05,510
local I land on your box and I run Who

547
00:19:04,970 --> 00:19:08,740
am I

548
00:19:05,510 --> 00:19:10,580
and it says Oh Victor become dot local

549
00:19:08,740 --> 00:19:12,430
slaps Jane Esther

550
00:19:10,580 --> 00:19:14,810
we're really I'm on every kind of local

551
00:19:12,430 --> 00:19:16,370
you know that attacker now I think

552
00:19:14,810 --> 00:19:17,720
that's the domain that are on and that's

553
00:19:16,370 --> 00:19:19,850
the mandate to be interacting with and

554
00:19:17,720 --> 00:19:21,830
going after and queering meanwhile

555
00:19:19,850 --> 00:19:23,570
they're not actually there so yeah

556
00:19:21,830 --> 00:19:26,179
there's some cool booty and magic that

557
00:19:23,570 --> 00:19:30,110
Benton's doing I fully recommend you go

558
00:19:26,180 --> 00:19:33,560
and talk to them about it sorry just

559
00:19:30,110 --> 00:19:34,790
make sure I got everything all right so

560
00:19:33,560 --> 00:19:37,879
god that went fast I'm sorry

561
00:19:34,790 --> 00:19:39,770
so if you'd like to know more John

562
00:19:37,880 --> 00:19:40,730
strand has a great book offensive

563
00:19:39,770 --> 00:19:42,379
countermeasures

564
00:19:40,730 --> 00:19:43,640
hit him up here over at the Black Hills

565
00:19:42,380 --> 00:19:45,860
booth at least earlier this Monday who

566
00:19:43,640 --> 00:19:47,750
are still handing some out will sign it

567
00:19:45,860 --> 00:19:50,719
for you if you can call that John's

568
00:19:47,750 --> 00:19:53,260
autograph is like three scribbles that's

569
00:19:50,720 --> 00:19:55,330
kinda neat take a gander also at there

570
00:19:53,260 --> 00:19:57,190
ADHD project it's basically Kelly for

571
00:19:55,330 --> 00:19:58,840
defenders who like to deception and it's

572
00:19:57,190 --> 00:20:00,210
a Linux distribution purely built around

573
00:19:58,840 --> 00:20:02,949
deception and it's really really cool

574
00:20:00,210 --> 00:20:05,530
again talk to Ben 10 his polar bear

575
00:20:02,950 --> 00:20:07,150
project is really really cool if you are

576
00:20:05,530 --> 00:20:08,620
rolling in money there are a lot of

577
00:20:07,150 --> 00:20:10,060
companies that are going after this

578
00:20:08,620 --> 00:20:11,350
space now there's some really cool

579
00:20:10,060 --> 00:20:13,960
software out there are some cool

580
00:20:11,350 --> 00:20:16,030
services some companies that are doing

581
00:20:13,960 --> 00:20:17,470
is their core competency other companies

582
00:20:16,030 --> 00:20:21,129
that are just kinda tacking on to other

583
00:20:17,470 --> 00:20:22,540
stuff they're doing come talk to me

584
00:20:21,130 --> 00:20:23,740
after the conference I get to air after

585
00:20:22,540 --> 00:20:25,600
this presentation I'll give you some

586
00:20:23,740 --> 00:20:28,780
suggestions of companies I like in this

587
00:20:25,600 --> 00:20:30,600
base but there's there's some really

588
00:20:28,780 --> 00:20:34,210
really cool stuff going on out there and

589
00:20:30,600 --> 00:20:36,850
I love this stuff deception is probably

590
00:20:34,210 --> 00:20:38,200
the thing I like the most in defensive

591
00:20:36,850 --> 00:20:40,780
security right now it's a place where I

592
00:20:38,200 --> 00:20:43,360
can be creative and get away from the

593
00:20:40,780 --> 00:20:45,820
bore and I love making attackers and pen

594
00:20:43,360 --> 00:20:47,520
testers swear one of my favorite things

595
00:20:45,820 --> 00:20:49,840
I've ever done was a Red Team assessment

596
00:20:47,520 --> 00:20:51,790
with the company that I respect the hell

597
00:20:49,840 --> 00:20:54,699
out of and attacker got on my network

598
00:20:51,790 --> 00:20:58,540
drop to drop the device he was there for

599
00:20:54,700 --> 00:21:00,460
about six months trying to move and head

600
00:20:58,540 --> 00:21:01,960
lateral all shut down after six months

601
00:21:00,460 --> 00:21:04,780
he decide to try to go vertical we had

602
00:21:01,960 --> 00:21:06,490
him in like 20 seconds so I called them

603
00:21:04,780 --> 00:21:10,330
while I was holding their device and he

604
00:21:06,490 --> 00:21:13,420
answered phone with father defender it's

605
00:21:10,330 --> 00:21:15,280
just the greatest thing ever right so

606
00:21:13,420 --> 00:21:19,210
hit me up snorkel 42 I'd love to talk

607
00:21:15,280 --> 00:21:28,270
about it and that's it I'm taking

608
00:21:19,210 --> 00:21:32,190
questions yes sir yeah and I'll get

609
00:21:28,270 --> 00:21:32,190
these slides out help it on SlideShare

610
00:21:36,030 --> 00:21:39,180
thanks guys

611
00:21:39,380 --> 00:21:42,849
[Applause]

