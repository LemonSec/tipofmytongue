1
00:00:15,209 --> 00:00:21,040
this working yeah great okay if this

2
00:00:19,270 --> 00:00:29,230
switch up I think this needs to be my

3
00:00:21,040 --> 00:00:30,060
mic hand let's do it yeah well good

4
00:00:29,230 --> 00:00:37,660
morning everybody

5
00:00:30,060 --> 00:00:39,309
how was sublime my name is Gerren

6
00:00:37,660 --> 00:00:40,449
Rosamond I did not go to sublime someone

7
00:00:39,309 --> 00:00:41,500
told me they're coming on at 11:00 I was

8
00:00:40,450 --> 00:00:42,790
like I'll totally show up at 9:00 and

9
00:00:41,500 --> 00:00:44,290
then my peace out after the first set

10
00:00:42,790 --> 00:00:47,040
and they're like nope that Sublime's not

11
00:00:44,290 --> 00:00:49,210
coming on at 9:00 so that didn't happen

12
00:00:47,040 --> 00:00:50,530
thanks for coming to my talk let's

13
00:00:49,210 --> 00:00:52,990
collect all the data protect all the

14
00:00:50,530 --> 00:00:54,280
things definitely stolen from dual cores

15
00:00:52,990 --> 00:00:56,050
drink all the booze and hack all the

16
00:00:54,280 --> 00:00:57,490
things right except from the blue team

17
00:00:56,050 --> 00:01:06,310
side where we have to be responsible

18
00:00:57,490 --> 00:01:10,180
right I don't know how did it work you

19
00:01:06,310 --> 00:01:12,399
have to turn these on what all right so

20
00:01:10,180 --> 00:01:14,259
I work for Pluralsight as a staff off

21
00:01:12,399 --> 00:01:16,390
their full time they make a bunch of

22
00:01:14,259 --> 00:01:17,350
learning content I make security content

23
00:01:16,390 --> 00:01:20,740
even though they didn't give me the

24
00:01:17,350 --> 00:01:23,050
benefit of having an icon but I do work

25
00:01:20,740 --> 00:01:24,580
specifically on screwed Eve in triage

26
00:01:23,050 --> 00:01:26,890
right now I'm working on pass on that

27
00:01:24,580 --> 00:01:28,929
and there's a bunch of courses in that

28
00:01:26,890 --> 00:01:30,940
area that I've created and worked with

29
00:01:28,930 --> 00:01:32,200
others to create that talk about a lot

30
00:01:30,940 --> 00:01:35,320
of the same concepts that are in this

31
00:01:32,200 --> 00:01:36,670
presentation part-time I worked for the

32
00:01:35,320 --> 00:01:40,029
Florida National Guard depends of cyber

33
00:01:36,670 --> 00:01:41,470
operations and because of that last week

34
00:01:40,030 --> 00:01:43,750
I was on twelve hours standby orders

35
00:01:41,470 --> 00:01:45,190
waiting to go support the hurricane I'm

36
00:01:43,750 --> 00:01:47,470
not really sure what I would do as a

37
00:01:45,190 --> 00:01:48,908
defensive cyber operator to support

38
00:01:47,470 --> 00:01:49,900
hurricane defensives because they're

39
00:01:48,909 --> 00:01:51,640
actually gonna send me to Camp Blanding

40
00:01:49,900 --> 00:01:52,960
so I was gonna have to do anything with

41
00:01:51,640 --> 00:01:54,729
computers just gonna sit on cot for

42
00:01:52,960 --> 00:01:56,740
three days but while I was looking for

43
00:01:54,729 --> 00:01:58,150
how to fight a hurricane I did find this

44
00:01:56,740 --> 00:02:00,189
little picture of Daniel fighting the

45
00:01:58,150 --> 00:02:01,330
hurricane and I decided that if I did go

46
00:02:00,189 --> 00:02:07,179
fight a hurricane I would want to do it

47
00:02:01,330 --> 00:02:08,799
with a tiger just like him so coming up

48
00:02:07,180 --> 00:02:09,369
we're gonna go over all kinds of stuff

49
00:02:08,799 --> 00:02:10,750
in the point

50
00:02:09,369 --> 00:02:12,040
I asked about making sure the slides are

51
00:02:10,750 --> 00:02:13,780
available because there's a ton of

52
00:02:12,040 --> 00:02:15,400
information there's like 90 slides

53
00:02:13,780 --> 00:02:16,659
there's 45 minutes I thought I was going

54
00:02:15,400 --> 00:02:18,220
to do in like 30 ish minutes so I'd

55
00:02:16,659 --> 00:02:19,989
leave time for questions so I'm gonna

56
00:02:18,220 --> 00:02:20,980
try not to go too quickly however don't

57
00:02:19,989 --> 00:02:22,689
worry about writing everything down

58
00:02:20,980 --> 00:02:24,668
right the point is I'm exposing you guys

59
00:02:22,689 --> 00:02:26,590
to a bunch of different things it's all

60
00:02:24,669 --> 00:02:28,220
going to be open source stuff the idea

61
00:02:26,590 --> 00:02:29,690
is that if you have commercial solution

62
00:02:28,220 --> 00:02:32,000
in your environment but you aren't

63
00:02:29,690 --> 00:02:33,829
feeling some data gap or some analysis

64
00:02:32,000 --> 00:02:35,540
hole over something then you can use one

65
00:02:33,830 --> 00:02:37,580
of these tools to fill that gap and then

66
00:02:35,540 --> 00:02:38,600
integrate it into security operations so

67
00:02:37,580 --> 00:02:40,760
we're going to talk about collecting

68
00:02:38,600 --> 00:02:42,109
security data different types of data

69
00:02:40,760 --> 00:02:43,549
different types of tools to do analysis

70
00:02:42,110 --> 00:02:45,950
with that and at the end we're going to

71
00:02:43,550 --> 00:02:47,660
kind of wrap that all up and talk about

72
00:02:45,950 --> 00:02:49,250
holding all that data into a seam and

73
00:02:47,660 --> 00:02:50,840
I'm not going to talk about security

74
00:02:49,250 --> 00:02:52,100
orchestration automation because that's

75
00:02:50,840 --> 00:02:53,780
there's plenty of vendors talking about

76
00:02:52,100 --> 00:02:54,980
that right now but the idea is that

77
00:02:53,780 --> 00:02:57,500
we'll go through the data flow of how

78
00:02:54,980 --> 00:02:59,179
you would use this information to do two

79
00:02:57,500 --> 00:03:00,680
things one we're going to take all these

80
00:02:59,180 --> 00:03:02,600
alerts that we get we're going to take

81
00:03:00,680 --> 00:03:04,130
we're gonna single those alerts out

82
00:03:02,600 --> 00:03:05,570
they're really important alerts those

83
00:03:04,130 --> 00:03:06,709
are the new important alerts and then

84
00:03:05,570 --> 00:03:09,049
we're going to correlate those alerts

85
00:03:06,709 --> 00:03:11,330
and make it we're at the end of the day

86
00:03:09,050 --> 00:03:15,620
we're kind of looking at only things

87
00:03:11,330 --> 00:03:16,730
that are true positives right so the

88
00:03:15,620 --> 00:03:17,900
hurricane thing we're bringing it back

89
00:03:16,730 --> 00:03:19,310
up because it just happened to me it's

90
00:03:17,900 --> 00:03:21,709
important to my life so now you guys

91
00:03:19,310 --> 00:03:23,900
have to listen to me talk about it I was

92
00:03:21,709 --> 00:03:25,580
on 12-hour standby orders last year I

93
00:03:23,900 --> 00:03:27,890
actually live in Panama City Beach it

94
00:03:25,580 --> 00:03:29,450
got hit by a cat5 hurricane hurricane

95
00:03:27,890 --> 00:03:31,850
Michael and then I moved to Jacksonville

96
00:03:29,450 --> 00:03:33,320
Florida and it almost got hit by a

97
00:03:31,850 --> 00:03:34,910
hurricane that was a cat5 so then I'm

98
00:03:33,320 --> 00:03:37,130
like well you know I do a lot of powder

99
00:03:34,910 --> 00:03:38,660
analysis but were my work maybe I need

100
00:03:37,130 --> 00:03:40,430
to figure out if I'm exposing myself to

101
00:03:38,660 --> 00:03:42,079
too much risk by living in Florida I

102
00:03:40,430 --> 00:03:44,720
look up NOAA's data they have a hundred

103
00:03:42,080 --> 00:03:46,489
and fifty years of hurricane data and

104
00:03:44,720 --> 00:03:47,900
this is what that looks like on tracks

105
00:03:46,489 --> 00:03:50,120
thirteen North America and it basically

106
00:03:47,900 --> 00:03:53,900
like blinks out Florida I was like well

107
00:03:50,120 --> 00:03:56,180
that's probably not a great idea but

108
00:03:53,900 --> 00:03:57,920
based on that I was like well I know

109
00:03:56,180 --> 00:03:59,660
that I need to like normalize data and

110
00:03:57,920 --> 00:04:02,268
kind of get a better picture of what's

111
00:03:59,660 --> 00:04:04,040
actually going on so I just made it like

112
00:04:02,269 --> 00:04:05,630
what's my specific threat which is kind

113
00:04:04,040 --> 00:04:08,239
of what we do right so my specific

114
00:04:05,630 --> 00:04:09,620
threat is 200 miles around Jacksonville

115
00:04:08,239 --> 00:04:11,030
Florida cuz I figure you know with the

116
00:04:09,620 --> 00:04:13,010
cone of probability it could really go

117
00:04:11,030 --> 00:04:14,930
anywhere but that still looks pretty

118
00:04:13,010 --> 00:04:16,880
scary I still can't see Florida right

119
00:04:14,930 --> 00:04:18,470
and then I reduced that down we're

120
00:04:16,880 --> 00:04:19,760
looking like let's only talk about cat

121
00:04:18,470 --> 00:04:21,380
four and five hurricanes I don't know

122
00:04:19,760 --> 00:04:23,599
who lives in Florida who's threatened by

123
00:04:21,380 --> 00:04:25,130
hurricanes very often but the cat four

124
00:04:23,600 --> 00:04:26,360
in fives are the really scary ones a cat

125
00:04:25,130 --> 00:04:29,930
three I'm still gonna hang out and just

126
00:04:26,360 --> 00:04:31,340
drink all day so then you sanitize that

127
00:04:29,930 --> 00:04:32,360
data because then the stuff was old and

128
00:04:31,340 --> 00:04:34,190
you only get about like six hurricanes

129
00:04:32,360 --> 00:04:35,540
that's not too bad right so it looked

130
00:04:34,190 --> 00:04:37,340
like really scary now it's not super

131
00:04:35,540 --> 00:04:39,890
scary but I did reduce things to threats

132
00:04:37,340 --> 00:04:40,909
that I'm actually concerned about and

133
00:04:39,890 --> 00:04:41,750
then I graph that because that's what we

134
00:04:40,910 --> 00:04:43,670
do we grab

135
00:04:41,750 --> 00:04:45,770
things and it looks like there is

136
00:04:43,670 --> 00:04:47,390
potentially some sort of trend and I

137
00:04:45,770 --> 00:04:49,010
just use my eyes I'm not using machine

138
00:04:47,390 --> 00:04:50,120
learning I'm just using my eyes identify

139
00:04:49,010 --> 00:04:51,770
there's some sort of clustering on the

140
00:04:50,120 --> 00:04:53,240
right side there and then just because

141
00:04:51,770 --> 00:04:55,330
it's like you know important right now

142
00:04:53,240 --> 00:04:57,380
and the environment let's talk about

143
00:04:55,330 --> 00:04:59,330
temperatures and how they change so this

144
00:04:57,380 --> 00:05:00,830
is the anomalous temperatures over time

145
00:04:59,330 --> 00:05:02,090
is there some sort of trend there maybe

146
00:05:00,830 --> 00:05:03,530
I don't know I'm not a scientist

147
00:05:02,090 --> 00:05:06,409
right but the idea is that there's

148
00:05:03,530 --> 00:05:08,419
patterns everywhere and there's gonna be

149
00:05:06,410 --> 00:05:09,170
a lot of patterns in this talk so some

150
00:05:08,420 --> 00:05:11,660
of the patterns were going to talk about

151
00:05:09,170 --> 00:05:12,950
is how we do security analysis and I

152
00:05:11,660 --> 00:05:15,020
don't care what vendor you talk to what

153
00:05:12,950 --> 00:05:16,520
a product you use but basically all we

154
00:05:15,020 --> 00:05:18,349
ever do is collect things IRA gave them

155
00:05:16,520 --> 00:05:19,880
and searched through right and we do it

156
00:05:18,350 --> 00:05:21,350
over and over and over and over and so

157
00:05:19,880 --> 00:05:22,130
it's going to kind of be a pattern in

158
00:05:21,350 --> 00:05:23,300
this talk when you look at different

159
00:05:22,130 --> 00:05:25,280
data that we're gonna collect the data

160
00:05:23,300 --> 00:05:26,510
we're gonna aggregate it and normalize

161
00:05:25,280 --> 00:05:28,940
it and or like search through it for

162
00:05:26,510 --> 00:05:30,289
stuff we care about we do something

163
00:05:28,940 --> 00:05:31,250
called baselining which is really

164
00:05:30,290 --> 00:05:32,870
important a lot of people talk about

165
00:05:31,250 --> 00:05:34,040
doing base lining with humans we

166
00:05:32,870 --> 00:05:35,360
shouldn't do base line with human skull

167
00:05:34,040 --> 00:05:37,490
there's too much data you do with

168
00:05:35,360 --> 00:05:39,490
computers who identify those deviations

169
00:05:37,490 --> 00:05:41,570
from the baseline and then we leverage

170
00:05:39,490 --> 00:05:43,460
what we call machine learning which is

171
00:05:41,570 --> 00:05:45,650
really just like fancy statistics over

172
00:05:43,460 --> 00:05:47,419
time right you do outliers make that

173
00:05:45,650 --> 00:05:49,570
over a time period and now everybody

174
00:05:47,420 --> 00:05:51,860
calls a machine learning so that's cool

175
00:05:49,570 --> 00:05:54,260
security operations so this is you know

176
00:05:51,860 --> 00:05:56,330
861 or 2 is the NIST document the talks

177
00:05:54,260 --> 00:05:57,800
about Incident Response I'm not basing

178
00:05:56,330 --> 00:05:59,000
on this this is more talking about how

179
00:05:57,800 --> 00:06:00,590
your teams work together in Security

180
00:05:59,000 --> 00:06:03,710
Operations Center right you identify

181
00:06:00,590 --> 00:06:07,159
stuff you spot into the stuff you look

182
00:06:03,710 --> 00:06:08,599
at what the root cause was and then you

183
00:06:07,160 --> 00:06:09,980
use that root cause to fortify your

184
00:06:08,600 --> 00:06:12,170
stuff you either making better detection

185
00:06:09,980 --> 00:06:14,240
or you're securing your network and then

186
00:06:12,170 --> 00:06:15,830
a really important part and probably the

187
00:06:14,240 --> 00:06:16,820
only time I get to talk about this and

188
00:06:15,830 --> 00:06:18,229
this talk because we have a bunch of

189
00:06:16,820 --> 00:06:19,849
stuff to cover is that you got to

190
00:06:18,230 --> 00:06:21,290
emulate that threat to make sure that

191
00:06:19,850 --> 00:06:23,390
with the fortifications that you did

192
00:06:21,290 --> 00:06:24,740
actually worked right so just remember

193
00:06:23,390 --> 00:06:25,909
that for your security operations teams

194
00:06:24,740 --> 00:06:30,890
that's why we have so many teams in

195
00:06:25,910 --> 00:06:32,930
security so mitre I like to use them

196
00:06:30,890 --> 00:06:35,120
because they support things that I think

197
00:06:32,930 --> 00:06:36,920
a lot not on purpose it's just we happen

198
00:06:35,120 --> 00:06:40,010
to think the same thing so it's great I

199
00:06:36,920 --> 00:06:41,390
get to use the leverage their name but

200
00:06:40,010 --> 00:06:42,320
mitre attack everybody likes that

201
00:06:41,390 --> 00:06:44,090
they're saying that we have to collect

202
00:06:42,320 --> 00:06:45,320
all the data too and they have this

203
00:06:44,090 --> 00:06:47,840
really cool graph if you haven't found

204
00:06:45,320 --> 00:06:49,219
it it's on their blog and you can look

205
00:06:47,840 --> 00:06:50,840
at this graphic and identify every

206
00:06:49,220 --> 00:06:52,250
single attack technique or procedure and

207
00:06:50,840 --> 00:06:53,960
how it ties to a data source that you

208
00:06:52,250 --> 00:06:55,460
need to detect it right so it's pretty

209
00:06:53,960 --> 00:06:56,318
neat

210
00:06:55,460 --> 00:06:58,159
and then have to talk about Stuxnet

211
00:06:56,319 --> 00:06:59,389
because it's a security talking

212
00:06:58,160 --> 00:07:02,569
everybody has to talk about Stuxnet at

213
00:06:59,389 --> 00:07:03,979
least once right um this is the only

214
00:07:02,569 --> 00:07:06,080
Stuxnet slide so don't get too concerned

215
00:07:03,979 --> 00:07:07,849
but I really do enjoyed this piece

216
00:07:06,080 --> 00:07:10,729
because the a CDC thing if anyone knows

217
00:07:07,849 --> 00:07:12,289
the reference at notionally around the

218
00:07:10,729 --> 00:07:14,599
third time whoever it was that attacked

219
00:07:12,289 --> 00:07:16,039
the Iranian centrifuge Center did that

220
00:07:14,599 --> 00:07:17,539
they actually played a thunderstruck

221
00:07:16,039 --> 00:07:21,770
over the speakers first which is just

222
00:07:17,539 --> 00:07:24,318
kind of awesome you know if you're that

223
00:07:21,770 --> 00:07:26,419
security operations guy in charge of

224
00:07:24,319 --> 00:07:27,560
that facility and you come into work and

225
00:07:26,419 --> 00:07:31,190
then you start hearing American rock

226
00:07:27,560 --> 00:07:32,690
music over the speaker's like oh no and

227
00:07:31,190 --> 00:07:34,849
then second you're like okay that was

228
00:07:32,690 --> 00:07:36,949
pretty cool and then third you're

229
00:07:34,849 --> 00:07:38,409
prepping your resume right and the only

230
00:07:36,949 --> 00:07:40,430
other reason I bring this up is because

231
00:07:38,410 --> 00:07:41,740
Stuxnet as we know didn't come over the

232
00:07:40,430 --> 00:07:43,970
network it didn't matter how many

233
00:07:41,740 --> 00:07:46,130
security provisions you had at the edge

234
00:07:43,970 --> 00:07:47,330
of your boundary looking at the network

235
00:07:46,130 --> 00:07:48,919
and inspecting the network because a lot

236
00:07:47,330 --> 00:07:50,630
of times where we start it didn't come

237
00:07:48,919 --> 00:07:52,008
that way it came through USB that

238
00:07:50,630 --> 00:07:53,690
someone downloaded something on and then

239
00:07:52,009 --> 00:07:54,860
plugged it into the wrong thing right so

240
00:07:53,690 --> 00:08:00,229
it's important to keep that in mind

241
00:07:54,860 --> 00:08:01,789
because a lot of companies start with

242
00:08:00,229 --> 00:08:03,440
security and start with security

243
00:08:01,789 --> 00:08:05,120
monitoring on the network and we're

244
00:08:03,440 --> 00:08:06,530
gonna start with that too but the idea

245
00:08:05,120 --> 00:08:07,849
is like first you get a firewall and

246
00:08:06,530 --> 00:08:09,138
then you get network monitoring a lot of

247
00:08:07,849 --> 00:08:11,750
times you just keep focusing on your

248
00:08:09,139 --> 00:08:12,560
ingress egress right and when you do

249
00:08:11,750 --> 00:08:13,699
that you're kind of like a chicken

250
00:08:12,560 --> 00:08:15,560
nugget you're really crunchy on the

251
00:08:13,699 --> 00:08:17,120
outside then you have this soft like

252
00:08:15,560 --> 00:08:17,810
unknown quantum realm on the inside

253
00:08:17,120 --> 00:08:20,419
where you don't really know what's

254
00:08:17,810 --> 00:08:21,710
happening but likely the cat's dead

255
00:08:20,419 --> 00:08:23,030
so if you didn't get that trip that's

256
00:08:21,710 --> 00:08:24,560
fine I just assumed we had the same

257
00:08:23,030 --> 00:08:28,940
crowd here that like quantum physics and

258
00:08:24,560 --> 00:08:30,949
like cybersecurity so let's start with

259
00:08:28,940 --> 00:08:32,000
network what do we do this is beyond the

260
00:08:30,949 --> 00:08:33,979
firewall so we're really talking about

261
00:08:32,000 --> 00:08:34,820
security analysis and monitoring so

262
00:08:33,979 --> 00:08:36,079
we're going to start talking about

263
00:08:34,820 --> 00:08:37,339
signatures and they're not my favorite

264
00:08:36,078 --> 00:08:38,598
but we got to talk about it because you

265
00:08:37,339 --> 00:08:40,310
got to do this first you have a big

266
00:08:38,599 --> 00:08:41,779
signature list this is all the stuff

267
00:08:40,309 --> 00:08:42,559
that's known you can use snort and you

268
00:08:41,779 --> 00:08:43,789
sir cata

269
00:08:42,559 --> 00:08:45,319
no one brings up snort anymore after

270
00:08:43,789 --> 00:08:46,790
cisco bought them a lot of the deal is I

271
00:08:45,320 --> 00:08:49,820
get that sir cause multi-threaded but

272
00:08:46,790 --> 00:08:51,860
whatever so when we look at snort rules

273
00:08:49,820 --> 00:08:53,930
something interesting happens so this is

274
00:08:51,860 --> 00:08:57,709
a scan that was sequential in Maps can

275
00:08:53,930 --> 00:08:59,420
just start at 0 into 65535 but what is

276
00:08:57,709 --> 00:09:01,099
peculiar is that the only thing that

277
00:08:59,420 --> 00:09:03,020
alerted is very specific things and

278
00:09:01,100 --> 00:09:05,150
that's how security signatures work

279
00:09:03,020 --> 00:09:06,680
right and we look at that signature is

280
00:09:05,150 --> 00:09:08,959
saying ok we only cared about this port

281
00:09:06,680 --> 00:09:10,550
and TCP connections with a sin

282
00:09:08,960 --> 00:09:12,140
Paquette they have been five times in 60

283
00:09:10,550 --> 00:09:13,939
seconds so it's like the super specific

284
00:09:12,140 --> 00:09:15,230
use case that someone else thought of as

285
00:09:13,940 --> 00:09:17,000
a scan so if you do anything other than

286
00:09:15,230 --> 00:09:19,040
that if you didn't like four times it's

287
00:09:17,000 --> 00:09:21,410
not getting caught right same thing for

288
00:09:19,040 --> 00:09:23,209
this in map OS detection so it's really

289
00:09:21,410 --> 00:09:25,189
cool that this description says in map

290
00:09:23,210 --> 00:09:27,140
OS detection it snorts like really good

291
00:09:25,190 --> 00:09:28,100
this is some guy just wrote this right

292
00:09:27,140 --> 00:09:29,330
like it's all it is it's just a

293
00:09:28,100 --> 00:09:30,980
description that some guy wrote and he

294
00:09:29,330 --> 00:09:31,760
said hey I noticed that when in map does

295
00:09:30,980 --> 00:09:34,220
OS probes

296
00:09:31,760 --> 00:09:36,490
it's full of the letter C like a lot of

297
00:09:34,220 --> 00:09:39,590
C's and so if you see like a lot of C's

298
00:09:36,490 --> 00:09:43,190
that's in Matt right it's like oh that's

299
00:09:39,590 --> 00:09:47,030
good I wonder if a map uses ace I don't

300
00:09:43,190 --> 00:09:48,680
know but there's a reason that's not

301
00:09:47,030 --> 00:09:51,410
good enough right you change that we do

302
00:09:48,680 --> 00:09:53,930
anything else it doesn't get detected so

303
00:09:51,410 --> 00:09:55,610
around that same time for that data set

304
00:09:53,930 --> 00:09:57,050
there was a PowerShell scan done so I

305
00:09:55,610 --> 00:09:59,720
use PowerShell for everything because

306
00:09:57,050 --> 00:10:01,280
it's awesome I do PowerShell scanning it

307
00:09:59,720 --> 00:10:03,260
does like some unique scan behavior so

308
00:10:01,280 --> 00:10:04,699
it's kind of hard to text the detect but

309
00:10:03,260 --> 00:10:06,050
especially internally it's already on

310
00:10:04,700 --> 00:10:07,550
your box right so if you're already

311
00:10:06,050 --> 00:10:10,670
compromised you're inside and this

312
00:10:07,550 --> 00:10:12,229
squishy contem quantum realm you can

313
00:10:10,670 --> 00:10:14,089
laterally move and do lateral

314
00:10:12,230 --> 00:10:15,410
enumeration using PowerShell and one

315
00:10:14,090 --> 00:10:18,320
other find you it's a tool it's already

316
00:10:15,410 --> 00:10:19,670
there it's like a Lal bin right but what

317
00:10:18,320 --> 00:10:21,530
you can do is use bro I love bro I'm

318
00:10:19,670 --> 00:10:23,449
gonna bring it up a bunch you can use

319
00:10:21,530 --> 00:10:25,160
bro it's Zeke now I got it I'm gonna

320
00:10:23,450 --> 00:10:26,900
call it bro when you type it in and you

321
00:10:25,160 --> 00:10:27,530
press it you have to type bro otherwise

322
00:10:26,900 --> 00:10:31,130
it doesn't work

323
00:10:27,530 --> 00:10:33,260
so it's still bro so you can look at

324
00:10:31,130 --> 00:10:34,820
connections that were attempted and you

325
00:10:33,260 --> 00:10:36,410
can look at that internally and you can

326
00:10:34,820 --> 00:10:37,850
do kind of the same idea so it doesn't

327
00:10:36,410 --> 00:10:38,959
matter if it's a syn packet or UDP or

328
00:10:37,850 --> 00:10:40,880
what it is it's just more of a

329
00:10:38,960 --> 00:10:42,680
behavioral analysis of that session

330
00:10:40,880 --> 00:10:45,320
right so this is a bro script that was

331
00:10:42,680 --> 00:10:46,910
written for this and it detects that

332
00:10:45,320 --> 00:10:48,080
internal scanning even from PowerShell

333
00:10:46,910 --> 00:10:50,030
doesn't care what your scanner is

334
00:10:48,080 --> 00:10:51,980
doesn't care what is inside that packet

335
00:10:50,030 --> 00:10:54,829
it'll detect that so that's something

336
00:10:51,980 --> 00:10:57,080
that's important you know also did that

337
00:10:54,830 --> 00:10:58,160
change now it's next slide cool so the

338
00:10:57,080 --> 00:11:00,500
other thing I want to talk about is

339
00:10:58,160 --> 00:11:01,969
interviewing so we're internal endpoints

340
00:11:00,500 --> 00:11:03,440
don't need to talk to endpoints right

341
00:11:01,970 --> 00:11:05,420
unless they do if you have some specific

342
00:11:03,440 --> 00:11:07,400
you say stand great but make that a

343
00:11:05,420 --> 00:11:08,599
whitelist thing right so you get the

344
00:11:07,400 --> 00:11:09,860
segment your network and you look across

345
00:11:08,600 --> 00:11:11,390
the segment's internally and there's

346
00:11:09,860 --> 00:11:13,390
only specific reasons that endpoints

347
00:11:11,390 --> 00:11:16,790
need to be talking to other endpoints

348
00:11:13,390 --> 00:11:19,760
great so then we move to Mal'akh it's

349
00:11:16,790 --> 00:11:22,290
made by AOL like the AOL that we use for

350
00:11:19,760 --> 00:11:25,229
messaging and dial-up they like dude

351
00:11:22,290 --> 00:11:27,449
security now I don't know but malach is

352
00:11:25,229 --> 00:11:28,679
amazing it visualizes all that session

353
00:11:27,449 --> 00:11:29,699
day that we're talking about and this is

354
00:11:28,679 --> 00:11:31,259
the really cool part because if you're

355
00:11:29,699 --> 00:11:33,809
not a security analyst you're about to

356
00:11:31,259 --> 00:11:35,100
become one I hope we'll see so we're

357
00:11:33,809 --> 00:11:36,600
looking at sessions here there's that

358
00:11:35,100 --> 00:11:39,079
graph up there's just the count of the

359
00:11:36,600 --> 00:11:41,369
sessions right not very interesting but

360
00:11:39,079 --> 00:11:42,809
then we can kind of change the view and

361
00:11:41,369 --> 00:11:44,399
now we're changing this graphical view

362
00:11:42,809 --> 00:11:45,660
to show us something else that we can

363
00:11:44,399 --> 00:11:48,089
kind of baseline with their eyes so

364
00:11:45,660 --> 00:11:49,079
everybody do some mental baselining now

365
00:11:48,089 --> 00:11:52,139
and we can see that

366
00:11:49,079 --> 00:11:54,179
yeah it's about 50/50 to output input of

367
00:11:52,139 --> 00:11:56,729
packets in the network right if we

368
00:11:54,179 --> 00:11:58,858
change that and instead we look at data

369
00:11:56,729 --> 00:12:00,629
bytes right we just changed these view a

370
00:11:58,859 --> 00:12:02,309
few times we've now identified a royal

371
00:12:00,629 --> 00:12:03,629
reg actor this is actually actual

372
00:12:02,309 --> 00:12:07,199
instant response row and stuff down

373
00:12:03,629 --> 00:12:08,910
oil-rig does uploads over ssl to Google

374
00:12:07,199 --> 00:12:10,169
Drive right so Google Drive looks

375
00:12:08,910 --> 00:12:11,699
totally legit it's hard to find

376
00:12:10,169 --> 00:12:13,709
companies use Google Drive all the time

377
00:12:11,699 --> 00:12:15,389
but they don't use it this much right

378
00:12:13,709 --> 00:12:17,219
especially in a short period of time so

379
00:12:15,389 --> 00:12:19,769
if you can see that you can see that

380
00:12:17,220 --> 00:12:21,269
bump in red you just detected or

381
00:12:19,769 --> 00:12:24,329
redactor a good job everybody

382
00:12:21,269 --> 00:12:26,809
well done so that's kind of network

383
00:12:24,329 --> 00:12:28,888
stuff and there's tons of ways we can

384
00:12:26,809 --> 00:12:30,358
expand upon that bunch of different use

385
00:12:28,889 --> 00:12:32,489
cases but there's just some tools and

386
00:12:30,359 --> 00:12:34,289
ways to use that right machine data so

387
00:12:32,489 --> 00:12:35,789
I'm kind of definitely arbitrarily

388
00:12:34,289 --> 00:12:37,769
separating the different types of data

389
00:12:35,789 --> 00:12:38,999
types that we use but this is the best

390
00:12:37,769 --> 00:12:40,439
way I could figure out how to do it so

391
00:12:38,999 --> 00:12:42,239
we're talking about network stuff first

392
00:12:40,439 --> 00:12:43,709
and that's own packets flying around on

393
00:12:42,239 --> 00:12:45,899
your network whether it's internal to

394
00:12:43,709 --> 00:12:46,949
external or inside your network and now

395
00:12:45,899 --> 00:12:49,649
we're going to talk about machine data

396
00:12:46,949 --> 00:12:51,389
when she name is any of the devices but

397
00:12:49,649 --> 00:12:52,439
localized to that device so this is

398
00:12:51,389 --> 00:12:53,879
where I kind of drawn the line from

399
00:12:52,439 --> 00:12:55,829
machine data so we're talking about

400
00:12:53,879 --> 00:12:57,660
stuff on that box so it's windows box

401
00:12:55,829 --> 00:12:59,160
the logs for the local devices we're

402
00:12:57,660 --> 00:13:00,988
talking about when Xbox the logs for the

403
00:12:59,160 --> 00:13:05,309
local Linux box if it's a Cisco device

404
00:13:00,989 --> 00:13:07,079
or ESXi or whether you're using juniper

405
00:13:05,309 --> 00:13:09,059
or whatever it is the logs that are

406
00:13:07,079 --> 00:13:11,008
local to that device that are unique to

407
00:13:09,059 --> 00:13:12,389
it so you can log into it as opposed to

408
00:13:11,009 --> 00:13:14,720
logging into a service and that's we're

409
00:13:12,389 --> 00:13:17,549
looking at different things here right

410
00:13:14,720 --> 00:13:19,049
and so here's a great use case I use

411
00:13:17,549 --> 00:13:20,699
elastic for everything to the real stuff

412
00:13:19,049 --> 00:13:22,409
too and it's free and it's part of the

413
00:13:20,699 --> 00:13:24,029
source stack that is starting to be

414
00:13:22,409 --> 00:13:25,470
really common in the community and if

415
00:13:24,029 --> 00:13:26,609
we're looking at a web server whether

416
00:13:25,470 --> 00:13:28,619
you host that in the cloud or you host

417
00:13:26,609 --> 00:13:30,119
it somewhere else and you see different

418
00:13:28,619 --> 00:13:31,649
logins locally so first of all you

419
00:13:30,119 --> 00:13:34,259
should be using RSA keys so if you're

420
00:13:31,649 --> 00:13:36,110
not do that but also root shouldn't be

421
00:13:34,259 --> 00:13:37,940
allowed to log in or SSH so if it is

422
00:13:36,110 --> 00:13:39,380
and that's a policy that you have a good

423
00:13:37,940 --> 00:13:42,050
reason to know your policies then that's

424
00:13:39,380 --> 00:13:43,610
a weird anomaly as well as if you have a

425
00:13:42,050 --> 00:13:44,779
wine account that's supposed to be G

426
00:13:43,610 --> 00:13:46,640
admin but you see a bunch of other

427
00:13:44,779 --> 00:13:48,709
accounts logging in that's also weird

428
00:13:46,640 --> 00:13:50,149
anomaly right and then if all of a

429
00:13:48,709 --> 00:13:52,219
sudden this activity stops they will

430
00:13:50,149 --> 00:13:53,480
they probably succeeded and then what

431
00:13:52,220 --> 00:13:55,100
we'll do after succeeding and this is

432
00:13:53,480 --> 00:13:56,750
some data you can pull out of those logs

433
00:13:55,100 --> 00:13:58,640
cause you can identify that they created

434
00:13:56,750 --> 00:14:01,010
a new user and then they elevated that

435
00:13:58,640 --> 00:14:03,260
user to a pseudo privileges right so

436
00:14:01,010 --> 00:14:05,990
that's another little data point we can

437
00:14:03,260 --> 00:14:10,220
use you can do the same thing with

438
00:14:05,990 --> 00:14:12,100
Windows logs and here's SMB logins

439
00:14:10,220 --> 00:14:14,180
that's not always like really well

440
00:14:12,100 --> 00:14:16,310
tracked and understood be especially the

441
00:14:14,180 --> 00:14:18,439
failures and the top left if you look at

442
00:14:16,310 --> 00:14:19,939
that spike we can tell that that's like

443
00:14:18,440 --> 00:14:21,980
kind of weird right so these are just

444
00:14:19,940 --> 00:14:23,420
general SMB logins and so whether it's

445
00:14:21,980 --> 00:14:26,000
to a shared drive or whatever it is

446
00:14:23,420 --> 00:14:27,140
we're looking at that that that file

447
00:14:26,000 --> 00:14:29,990
share that's where we're looking at

448
00:14:27,140 --> 00:14:32,180
those local logs right and so that SMB

449
00:14:29,990 --> 00:14:34,070
login is kind of normal people maybe

450
00:14:32,180 --> 00:14:35,660
come to work and it bumps in but that

451
00:14:34,070 --> 00:14:37,399
spike is kind of strange now we're gonna

452
00:14:35,660 --> 00:14:39,290
look deeper and which we look in

453
00:14:37,399 --> 00:14:41,390
baseline again with our eyes looking

454
00:14:39,290 --> 00:14:42,740
across saying hey the pattern here is

455
00:14:41,390 --> 00:14:44,050
that there's a really small percentage

456
00:14:42,740 --> 00:14:47,120
of failures that's the blue and

457
00:14:44,050 --> 00:14:48,680
successes are the green right in I typed

458
00:14:47,120 --> 00:14:50,570
my password in wrong all the time and

459
00:14:48,680 --> 00:14:51,979
even with uh if you're using like

460
00:14:50,570 --> 00:14:54,260
two-factor authentication you use your

461
00:14:51,980 --> 00:14:55,850
pin that's that happens wrong a lot too

462
00:14:54,260 --> 00:14:57,050
right so it's okay to have failures you

463
00:14:55,850 --> 00:14:59,000
have to understand that the failure is

464
00:14:57,050 --> 00:15:00,800
not the anomaly the change in the ratio

465
00:14:59,000 --> 00:15:02,959
of failures to successes is an anomaly

466
00:15:00,800 --> 00:15:04,339
especially this large of a change now

467
00:15:02,959 --> 00:15:06,079
this is really easy purse the detect

468
00:15:04,339 --> 00:15:09,920
this was on purpose we simulated this at

469
00:15:06,079 --> 00:15:11,180
age C Hydra and then like the last time

470
00:15:09,920 --> 00:15:13,459
we were looking at malach and we see

471
00:15:11,180 --> 00:15:14,870
that data exfiltration that's cool but

472
00:15:13,459 --> 00:15:16,729
i'm not always just staring at the

473
00:15:14,870 --> 00:15:19,130
screen so i need something to do it for

474
00:15:16,730 --> 00:15:20,839
me I call it AI that's definitely joke

475
00:15:19,130 --> 00:15:22,070
totally not AI that's statistical

476
00:15:20,839 --> 00:15:22,550
regression analysis is what that's

477
00:15:22,070 --> 00:15:25,279
called

478
00:15:22,550 --> 00:15:26,599
again it's outliers over time right so

479
00:15:25,279 --> 00:15:28,640
we're getting a baseline average every

480
00:15:26,600 --> 00:15:29,990
time we're saying oh this is like really

481
00:15:28,640 --> 00:15:32,990
high outside that average that's all it

482
00:15:29,990 --> 00:15:35,600
is it's like X mean so but what this

483
00:15:32,990 --> 00:15:37,010
will do for us automatically is identify

484
00:15:35,600 --> 00:15:39,440
this is anomaly like how much of an

485
00:15:37,010 --> 00:15:40,850
outlier is it and it'll then we can use

486
00:15:39,440 --> 00:15:42,560
this as an alert this is our new alert

487
00:15:40,850 --> 00:15:45,020
that we leverage right so instead of

488
00:15:42,560 --> 00:15:46,279
snort sorcerer kata signatures this is

489
00:15:45,020 --> 00:15:48,550
now an alert that we can use as an

490
00:15:46,279 --> 00:15:49,899
anomaly and

491
00:15:48,550 --> 00:15:51,849
the other thing is I really really like

492
00:15:49,899 --> 00:15:52,240
this type of analysis for the data it's

493
00:15:51,850 --> 00:15:53,950
called

494
00:15:52,240 --> 00:15:57,310
this is really squeaky sorry if it's too

495
00:15:53,950 --> 00:15:58,990
squeaky guys but anyway I relate this

496
00:15:57,310 --> 00:16:01,390
type of data analysis called population

497
00:15:58,990 --> 00:16:02,830
analysis so what we're doing is using

498
00:16:01,390 --> 00:16:04,270
that same data we're still looking at

499
00:16:02,830 --> 00:16:06,459
just local log data right

500
00:16:04,270 --> 00:16:07,930
and we're saying hey well these columns

501
00:16:06,459 --> 00:16:09,729
and here we have like user names and we

502
00:16:07,930 --> 00:16:12,489
have like Auto X excessive failure and

503
00:16:09,730 --> 00:16:13,510
then we have IPS all that so it's nice

504
00:16:12,490 --> 00:16:15,070
that we understood that there's

505
00:16:13,510 --> 00:16:16,240
something weird going on but what we

506
00:16:15,070 --> 00:16:17,440
really need to do is understand who's

507
00:16:16,240 --> 00:16:19,450
doing it and so if we look at a

508
00:16:17,440 --> 00:16:20,589
population we say who's being weird and

509
00:16:19,450 --> 00:16:22,149
referenced to their neighbor is

510
00:16:20,589 --> 00:16:23,709
essentially what we're saying when you

511
00:16:22,149 --> 00:16:26,500
select a key value and that key value is

512
00:16:23,709 --> 00:16:30,640
going to be on it failures so like who

513
00:16:26,500 --> 00:16:32,350
logs in like incorrectly the most in

514
00:16:30,640 --> 00:16:33,670
reference to their neighbor right and

515
00:16:32,350 --> 00:16:35,170
this is what it does it caught Steve

516
00:16:33,670 --> 00:16:35,529
Rogers doing it which is weird for a few

517
00:16:35,170 --> 00:16:37,990
reasons

518
00:16:35,529 --> 00:16:39,730
like the first reason is because it's

519
00:16:37,990 --> 00:16:41,770
bad that he's running TV Hydra it's also

520
00:16:39,730 --> 00:16:43,480
strange because I think based on endgame

521
00:16:41,770 --> 00:16:47,620
he's like 200 years old now and he knows

522
00:16:43,480 --> 00:16:52,180
how to use tht Hydra it's very odd thank

523
00:16:47,620 --> 00:16:53,800
you thank you so the other cool thing

524
00:16:52,180 --> 00:16:55,779
going to talk about is graph theory this

525
00:16:53,800 --> 00:16:57,459
is also available we talk about network

526
00:16:55,779 --> 00:16:59,020
connections and it's really easy imagine

527
00:16:57,459 --> 00:17:00,339
your mind how those nodes connect and we

528
00:16:59,020 --> 00:17:01,750
can draw lines between them and talk

529
00:17:00,339 --> 00:17:03,520
about amount of traffic between them

530
00:17:01,750 --> 00:17:07,150
that kind of stuff you can also do that

531
00:17:03,520 --> 00:17:09,459
with logins and like syslog or security

532
00:17:07,150 --> 00:17:11,079
data on a local device so we're now

533
00:17:09,459 --> 00:17:12,970
taking these columns and what graph

534
00:17:11,079 --> 00:17:15,639
theory essentially says is that records

535
00:17:12,970 --> 00:17:16,990
that are similar will show up as linked

536
00:17:15,640 --> 00:17:18,520
based on their algorithm that's as much

537
00:17:16,990 --> 00:17:21,339
as I know about it right but what ends

538
00:17:18,520 --> 00:17:25,990
up happening is we say we want users and

539
00:17:21,339 --> 00:17:27,490
IPS and usernames and device names

540
00:17:25,990 --> 00:17:28,600
that's what this so if we want all those

541
00:17:27,490 --> 00:17:30,550
things we can get this awesome

542
00:17:28,600 --> 00:17:32,139
connection of users logging into boxes

543
00:17:30,550 --> 00:17:33,700
logging in device names that can start

544
00:17:32,140 --> 00:17:35,290
to give us some more information about

545
00:17:33,700 --> 00:17:36,790
what's happening in our network who's

546
00:17:35,290 --> 00:17:38,080
logging in where if one person's log in

547
00:17:36,790 --> 00:17:40,389
to a bunch of places but they're not an

548
00:17:38,080 --> 00:17:43,419
admin it's kind of strange right so it's

549
00:17:40,390 --> 00:17:44,590
kind of a cool tool to use all right the

550
00:17:43,420 --> 00:17:46,210
next part this is my favorite part

551
00:17:44,590 --> 00:17:48,189
there's a bunch of like proof of concept

552
00:17:46,210 --> 00:17:49,660
here right and this is not something we

553
00:17:48,190 --> 00:17:52,720
get to do a lot as blue team we don't

554
00:17:49,660 --> 00:17:54,250
get a lot of pcs as blue team results

555
00:17:52,720 --> 00:17:56,320
those side-channel stuff here so all of

556
00:17:54,250 --> 00:17:57,700
this stuff is resource usage it's

557
00:17:56,320 --> 00:18:00,428
basically anything you can get from proc

558
00:17:57,700 --> 00:18:02,279
mod on any device as well as Network

559
00:18:00,429 --> 00:18:03,929
Devices have this available as well

560
00:18:02,279 --> 00:18:05,789
right so we're gonna look through all

561
00:18:03,929 --> 00:18:06,960
these things and then here's one so

562
00:18:05,789 --> 00:18:08,580
we're looking at RAM and you can see

563
00:18:06,960 --> 00:18:09,659
that little red spike but we can also

564
00:18:08,580 --> 00:18:11,609
see that the same time that that red

565
00:18:09,659 --> 00:18:13,349
spike happen that Ram was used up in

566
00:18:11,609 --> 00:18:15,418
pool but there's a powershell process

567
00:18:13,349 --> 00:18:16,289
that's using quite a bit of the cpu so

568
00:18:15,419 --> 00:18:18,330
when we cross-referenced that

569
00:18:16,289 --> 00:18:19,769
information maybe that's maybe it's

570
00:18:18,330 --> 00:18:21,539
something interesting maybe it's not but

571
00:18:19,769 --> 00:18:22,340
it's still something we can use as an

572
00:18:21,539 --> 00:18:24,960
anomaly

573
00:18:22,340 --> 00:18:26,580
now here's nick packets out i'm not

574
00:18:24,960 --> 00:18:29,340
monitoring the network i'm just looking

575
00:18:26,580 --> 00:18:31,139
at the device in the resource usage of

576
00:18:29,340 --> 00:18:32,519
that nick of that hardware piece and

577
00:18:31,139 --> 00:18:34,019
it's gonna tell me how many packets are

578
00:18:32,519 --> 00:18:35,580
going out and when i pull that from

579
00:18:34,019 --> 00:18:37,379
multiple devices across the network i

580
00:18:35,580 --> 00:18:38,789
can see if there's a spike here right

581
00:18:37,379 --> 00:18:40,738
and this is another simulation right

582
00:18:38,789 --> 00:18:42,359
proof of concept stuff but when we at

583
00:18:40,739 --> 00:18:44,309
the same time that spike happen we can

584
00:18:42,359 --> 00:18:45,749
again use our friendly AI to detect it

585
00:18:44,309 --> 00:18:49,019
for us and make turn that into anomaly

586
00:18:45,749 --> 00:18:50,549
right and we can at the same time see

587
00:18:49,019 --> 00:18:53,489
that this go cannon executable is run

588
00:18:50,549 --> 00:18:55,710
this is a going dose simulation tool

589
00:18:53,489 --> 00:18:57,719
right I mean what this is doing is

590
00:18:55,710 --> 00:18:59,549
spiking CPU and RAM at the same time

591
00:18:57,719 --> 00:19:01,349
that that network spikes happening so

592
00:18:59,549 --> 00:19:02,249
that is most certainly an anomaly and

593
00:19:01,349 --> 00:19:03,269
something that you can detect your

594
00:19:02,249 --> 00:19:06,059
network and all who are using as

595
00:19:03,269 --> 00:19:07,409
resource usage data now this gets a

596
00:19:06,059 --> 00:19:10,109
little cooler if you're on a Linux

597
00:19:07,409 --> 00:19:12,089
device there's a user space and program

598
00:19:10,109 --> 00:19:13,859
called nice and feel free to correct me

599
00:19:12,089 --> 00:19:16,859
on the exact terminology for this but it

600
00:19:13,859 --> 00:19:20,158
makes CPU syscalls right to prioritize

601
00:19:16,859 --> 00:19:22,559
where there's the queuing of a process

602
00:19:20,159 --> 00:19:24,149
in the CPU and it's generally if you

603
00:19:22,559 --> 00:19:26,219
baseline this across a network it's

604
00:19:24,149 --> 00:19:27,629
generally a very small percentage right

605
00:19:26,219 --> 00:19:28,979
it's not supposed to be that giant blue

606
00:19:27,629 --> 00:19:30,809
thing that you see there I get that the

607
00:19:28,979 --> 00:19:32,940
zeros are up but the blue is showing

608
00:19:30,809 --> 00:19:34,440
nice right and that's that's weird to

609
00:19:32,940 --> 00:19:36,239
have happen in the first place but

610
00:19:34,440 --> 00:19:38,909
that's exactly what happens anytime you

611
00:19:36,239 --> 00:19:40,950
use a CPU crypto minor right it's going

612
00:19:38,909 --> 00:19:43,589
to prioritize the CPU calls to use for

613
00:19:40,950 --> 00:19:45,029
mining so that's crypto jackings when

614
00:19:43,589 --> 00:19:47,099
you visit like a web page and someone's

615
00:19:45,029 --> 00:19:48,629
got some licious code in there and the

616
00:19:47,099 --> 00:19:51,359
malicious code is going to leverage

617
00:19:48,629 --> 00:19:53,279
through your browser the cpu to do

618
00:19:51,359 --> 00:19:55,019
mining right what's interesting about is

619
00:19:53,279 --> 00:19:57,119
it runs under the browser process it's

620
00:19:55,019 --> 00:19:59,279
kind of hard to the detect but this is a

621
00:19:57,119 --> 00:20:03,029
100 cent positive signature for that

622
00:19:59,279 --> 00:20:04,409
activity right now air-gap popping this

623
00:20:03,029 --> 00:20:06,960
is kind of cool wrote a Python program

624
00:20:04,409 --> 00:20:08,820
that takes data so if you imagine you

625
00:20:06,960 --> 00:20:10,349
don't know what air-gap hopping is well

626
00:20:08,820 --> 00:20:12,869
it's Derby con you should know it eric i

627
00:20:10,349 --> 00:20:14,609
popping this but if you don't what

628
00:20:12,869 --> 00:20:16,080
happens is you have isolated networks

629
00:20:14,609 --> 00:20:17,789
that you feel are secure because

630
00:20:16,080 --> 00:20:18,928
connected to the dirty Internet right

631
00:20:17,789 --> 00:20:20,039
but generally anytime you're in a room

632
00:20:18,929 --> 00:20:22,230
with that you also need to watch your

633
00:20:20,039 --> 00:20:23,640
cat videos so you have another device in

634
00:20:22,230 --> 00:20:25,950
the same room attached to the Internet

635
00:20:23,640 --> 00:20:27,750
right and this happens in any like

636
00:20:25,950 --> 00:20:30,419
secured space or any places like

637
00:20:27,750 --> 00:20:32,220
sensitive information and that nonce

638
00:20:30,419 --> 00:20:34,950
that network does not attach the

639
00:20:32,220 --> 00:20:37,799
internet gets updated over like Caesar

640
00:20:34,950 --> 00:20:39,899
not USBs but mostly CDs really and on a

641
00:20:37,799 --> 00:20:42,059
really slow schedule but just like we

642
00:20:39,899 --> 00:20:43,439
know with like CC cleaner you can do

643
00:20:42,059 --> 00:20:44,789
software or supply chain your addiction

644
00:20:43,440 --> 00:20:46,110
and still infect that system so you're

645
00:20:44,789 --> 00:20:47,820
not actually safe but how do you get the

646
00:20:46,110 --> 00:20:49,860
data out well now we have to hop this

647
00:20:47,820 --> 00:20:51,689
air gap back out a lot of things don't

648
00:20:49,860 --> 00:20:52,799
allow things we put on USB drives and

649
00:20:51,690 --> 00:20:55,980
that kind of stuff so we're kind of

650
00:20:52,799 --> 00:20:57,539
limited in that way but here is a set of

651
00:20:55,980 --> 00:20:58,980
like side channel attacks and one of

652
00:20:57,539 --> 00:21:01,230
them is audio so you can actually

653
00:20:58,980 --> 00:21:03,090
manipulate fan speed to transmit binary

654
00:21:01,230 --> 00:21:04,919
data and then have the one that you're

655
00:21:03,090 --> 00:21:06,779
watching cat videos on be compromised

656
00:21:04,919 --> 00:21:08,429
through normal means like fishing and be

657
00:21:06,779 --> 00:21:10,500
listening for that data it'll transmit

658
00:21:08,429 --> 00:21:12,029
this is very slow this is an advanced

659
00:21:10,500 --> 00:21:14,519
threat that's going to take time to

660
00:21:12,029 --> 00:21:16,139
transmit this data out but if this is

661
00:21:14,519 --> 00:21:17,610
the data center it's where someone isn't

662
00:21:16,139 --> 00:21:19,860
then it's not going to be noticed at all

663
00:21:17,610 --> 00:21:22,229
but you can monitor this resource data

664
00:21:19,860 --> 00:21:23,580
usage and understand that this fan speed

665
00:21:22,230 --> 00:21:26,279
shouldn't be active in a binary manner

666
00:21:23,580 --> 00:21:28,260
so that's one way to detect that cool

667
00:21:26,279 --> 00:21:29,820
and here's computer C for supply chain

668
00:21:28,260 --> 00:21:32,639
interdiction this was actually done in

669
00:21:29,820 --> 00:21:34,799
environments like ten years ago

670
00:21:32,639 --> 00:21:37,199
Huawei put Cisco stickers on some stuff

671
00:21:34,799 --> 00:21:39,990
and distributed it through a Canadian

672
00:21:37,200 --> 00:21:41,399
distributor to the DoD and the DoD put

673
00:21:39,990 --> 00:21:42,720
it in all their data networks right so

674
00:21:41,399 --> 00:21:46,110
this is released it's not like secret

675
00:21:42,720 --> 00:21:47,130
stuff and what those were they had extra

676
00:21:46,110 --> 00:21:50,490
chips on them that were seeing stuff

677
00:21:47,130 --> 00:21:54,149
back to OC OCSP responder and

678
00:21:50,490 --> 00:21:55,289
exfiltrating data so it's bad but how do

679
00:21:54,149 --> 00:21:56,850
you figure that out if it looks like

680
00:21:55,289 --> 00:21:58,649
Cisco and acts like Cisco like how do

681
00:21:56,850 --> 00:22:00,149
you really know well if there's extra if

682
00:21:58,649 --> 00:22:02,610
the motherboard is different it's going

683
00:22:00,149 --> 00:22:04,918
to use voltage differently right and

684
00:22:02,610 --> 00:22:06,658
especially in reference to how it load

685
00:22:04,919 --> 00:22:07,889
is applied so if you get enough devices

686
00:22:06,659 --> 00:22:09,750
and this where data is important you can

687
00:22:07,889 --> 00:22:11,490
identify these patterns you get enough

688
00:22:09,750 --> 00:22:13,409
devices and you track what distributors

689
00:22:11,490 --> 00:22:15,179
gave you which devices you can look at

690
00:22:13,409 --> 00:22:17,549
like devices and their power usage and

691
00:22:15,179 --> 00:22:19,799
then map that to the Associated network

692
00:22:17,549 --> 00:22:21,450
load and if they're not moving in kind

693
00:22:19,799 --> 00:22:22,799
if there's we can use that population

694
00:22:21,450 --> 00:22:24,350
analysis to identify that they're

695
00:22:22,799 --> 00:22:26,549
different then that's something that

696
00:22:24,350 --> 00:22:28,350
potentially is hardware supply chain

697
00:22:26,549 --> 00:22:29,970
interdiction right I say potentially

698
00:22:28,350 --> 00:22:32,399
because you then go like really inspect

699
00:22:29,970 --> 00:22:37,259
figure it out but otherwise it's really

700
00:22:32,399 --> 00:22:40,168
difficult to identify cool so let's move

701
00:22:37,259 --> 00:22:41,730
on to in point analysis endpoint

702
00:22:40,169 --> 00:22:42,899
analysis I'm classifying as anything

703
00:22:41,730 --> 00:22:44,549
that's associated like the OS

704
00:22:42,899 --> 00:22:46,379
essentially is where we're looking at

705
00:22:44,549 --> 00:22:48,899
right so we talked about system on

706
00:22:46,379 --> 00:22:50,399
assist internals system on essentially

707
00:22:48,899 --> 00:22:52,080
makes another blog and then logs a whole

708
00:22:50,399 --> 00:22:53,789
bunch of OS activity on Windows devices

709
00:22:52,080 --> 00:22:56,399
and it's a really good

710
00:22:53,789 --> 00:22:58,740
security tool and daily resource for

711
00:22:56,399 --> 00:23:00,120
that PowerShell is awesome soldier we

712
00:22:58,740 --> 00:23:02,820
talked about a lot you can do anything

713
00:23:00,120 --> 00:23:04,258
with it it's also on Linux it's also on

714
00:23:02,820 --> 00:23:08,610
every device so it's this is a part

715
00:23:04,259 --> 00:23:10,019
where I talk about just because you

716
00:23:08,610 --> 00:23:11,729
don't have software doesn't mean you

717
00:23:10,019 --> 00:23:12,720
can't do security right so there's a lot

718
00:23:11,730 --> 00:23:14,039
of environments where you can't it's

719
00:23:12,720 --> 00:23:15,840
really just load stuff you get approval

720
00:23:14,039 --> 00:23:17,610
load things but POW shells already there

721
00:23:15,840 --> 00:23:19,168
users can use PowerShell you don't even

722
00:23:17,610 --> 00:23:20,668
have to be admin right and you can do

723
00:23:19,169 --> 00:23:23,129
stuff like this we'll talk about OS

724
00:23:20,669 --> 00:23:24,840
query later but you can do asset

725
00:23:23,129 --> 00:23:25,769
protection passively because in the

726
00:23:24,840 --> 00:23:27,809
first thing you need to be concerned

727
00:23:25,769 --> 00:23:29,639
about is what stuff you have versus what

728
00:23:27,809 --> 00:23:31,110
stuffs new right so if you're doing like

729
00:23:29,639 --> 00:23:32,189
super advanced security practices but

730
00:23:31,110 --> 00:23:34,019
you don't know what devices are supposed

731
00:23:32,190 --> 00:23:35,850
to be what subnet or like what one

732
00:23:34,019 --> 00:23:37,529
device does versus another then you're

733
00:23:35,850 --> 00:23:38,519
like messing up you need to go back and

734
00:23:37,529 --> 00:23:40,049
you have to do asset detection

735
00:23:38,519 --> 00:23:41,190
understand what is actually in your

736
00:23:40,049 --> 00:23:43,259
environment and understand how that

737
00:23:41,190 --> 00:23:46,230
changes Grass Marlins a tool it's free

738
00:23:43,259 --> 00:23:47,460
it is from the NSA yes that NSA but they

739
00:23:46,230 --> 00:23:50,149
have a whole bunch of other tools right

740
00:23:47,460 --> 00:23:52,110
like Icha who like Sidra I love Gita

741
00:23:50,149 --> 00:23:53,250
but what this does is what passively

742
00:23:52,110 --> 00:23:54,449
listen your network and I'll build an

743
00:23:53,250 --> 00:23:56,100
asset list of stuff that's on each

744
00:23:54,450 --> 00:23:57,870
subnet right and you can export that as

745
00:23:56,100 --> 00:23:59,070
a CSV and use that as intelligence and

746
00:23:57,870 --> 00:24:03,689
add that into the rest of your security

747
00:23:59,070 --> 00:24:04,980
workflow so with PowerShell you can do

748
00:24:03,690 --> 00:24:06,090
all kinds of stuff you can query a bunch

749
00:24:04,980 --> 00:24:08,639
of things we talked about how we can do

750
00:24:06,090 --> 00:24:11,639
scans and that same scan that was used

751
00:24:08,639 --> 00:24:14,070
maliciously to scan stuff internally you

752
00:24:11,639 --> 00:24:16,620
can use to scan your own network to do

753
00:24:14,070 --> 00:24:18,210
asset detection right and so what this

754
00:24:16,620 --> 00:24:19,379
is is just a simple script that's

755
00:24:18,210 --> 00:24:21,990
scanning through some really common

756
00:24:19,379 --> 00:24:24,240
ports on a specific subject and it's

757
00:24:21,990 --> 00:24:26,549
also pulling back TTL so time-to-live

758
00:24:24,240 --> 00:24:27,779
will indicate especially 128 within the

759
00:24:26,549 --> 00:24:30,029
same subnet we're talking about Windows

760
00:24:27,779 --> 00:24:32,039
boxes 64 indicates something that's

761
00:24:30,029 --> 00:24:33,210
probably a UNIX device right which is

762
00:24:32,039 --> 00:24:34,440
interesting because if your entire

763
00:24:33,210 --> 00:24:36,389
sudden is supposed to be Windows and

764
00:24:34,440 --> 00:24:38,190
then you identify a 64 TTL either

765
00:24:36,389 --> 00:24:39,539
somebody's live booting - like Kali

766
00:24:38,190 --> 00:24:40,860
Linux or you have a device like a

767
00:24:39,539 --> 00:24:42,299
Raspberry Pi that shouldn't be there

768
00:24:40,860 --> 00:24:43,679
like there's something interesting going

769
00:24:42,299 --> 00:24:45,750
on that's something that you

770
00:24:43,680 --> 00:24:46,920
you can inspect right other things like

771
00:24:45,750 --> 00:24:49,290
your windows box probably shouldn't be

772
00:24:46,920 --> 00:24:51,300
running as a end point HTTP server so if

773
00:24:49,290 --> 00:24:53,340
that's responding true that's also weird

774
00:24:51,300 --> 00:24:55,320
so you can identify stuff this was brand

775
00:24:53,340 --> 00:24:56,580
as a user right so I didn't need any

776
00:24:55,320 --> 00:24:58,200
special privileges to be able do this

777
00:24:56,580 --> 00:24:59,639
you can do this on any Sun that you're

778
00:24:58,200 --> 00:25:02,610
on you can even map out your entire

779
00:24:59,640 --> 00:25:06,890
network using TTL and you can do this

780
00:25:02,610 --> 00:25:10,679
activity without having any permission

781
00:25:06,890 --> 00:25:12,690
so I want to bring up Sigma Sigma's a

782
00:25:10,680 --> 00:25:15,150
tool that's using stuff like sis mom

783
00:25:12,690 --> 00:25:17,070
like we talked about earlier to give you

784
00:25:15,150 --> 00:25:19,230
essentially XML signatures so we have

785
00:25:17,070 --> 00:25:21,090
like sort insert cause signatures for

786
00:25:19,230 --> 00:25:24,360
Network Sigma is your signature for your

787
00:25:21,090 --> 00:25:26,100
OS logs right so it's gonna identify and

788
00:25:24,360 --> 00:25:27,750
they're totally mapped to like minor

789
00:25:26,100 --> 00:25:29,340
attack techniques and procedures so each

790
00:25:27,750 --> 00:25:30,930
one has like hey this is this minor

791
00:25:29,340 --> 00:25:32,850
attack technique or this is this

792
00:25:30,930 --> 00:25:34,670
potential actor and then here's how we

793
00:25:32,850 --> 00:25:38,429
catch it and it's generally multiple

794
00:25:34,670 --> 00:25:40,890
different anomalies within logs lined up

795
00:25:38,430 --> 00:25:42,180
together right so it's a way it's a

796
00:25:40,890 --> 00:25:43,560
really good like behavioral analysis

797
00:25:42,180 --> 00:25:45,840
tool to identify these different

798
00:25:43,560 --> 00:25:48,600
activities like UAC bypass or Muni cats

799
00:25:45,840 --> 00:25:50,580
running and what it does is it it

800
00:25:48,600 --> 00:25:52,260
generalizes that XML format into a

801
00:25:50,580 --> 00:25:55,710
signature that allows you to convert

802
00:25:52,260 --> 00:25:57,270
that into Splunk or into elastic or

803
00:25:55,710 --> 00:25:58,560
whatever query for what you're using I

804
00:25:57,270 --> 00:26:01,020
think they're expanding into IBM qradar

805
00:25:58,560 --> 00:26:02,760
different things but as you develop

806
00:26:01,020 --> 00:26:04,200
signatures definitely upload it it's the

807
00:26:02,760 --> 00:26:05,700
whole point of having up open source

808
00:26:04,200 --> 00:26:06,840
stuff right and then if you have a scene

809
00:26:05,700 --> 00:26:10,230
that you want to use then you can help

810
00:26:06,840 --> 00:26:11,939
this guy out to Louis cruz awesome

811
00:26:10,230 --> 00:26:13,470
there's a bunch of commercial companies

812
00:26:11,940 --> 00:26:16,410
that use it

813
00:26:13,470 --> 00:26:18,810
Capital y and Adobe lots of people are

814
00:26:16,410 --> 00:26:20,580
using this commercially it's a open

815
00:26:18,810 --> 00:26:21,990
source tool you deploy this as a agent

816
00:26:20,580 --> 00:26:23,909
what's really neat about as it can run

817
00:26:21,990 --> 00:26:25,410
on Mac OS can run on UNIX it can run on

818
00:26:23,910 --> 00:26:27,530
Windows doesn't really matter you can

819
00:26:25,410 --> 00:26:30,480
turns that OS into a relational database

820
00:26:27,530 --> 00:26:32,490
Facebook made it so thanks to them and

821
00:26:30,480 --> 00:26:33,450
then you can query those devices and if

822
00:26:32,490 --> 00:26:34,920
you add that with something called

823
00:26:33,450 --> 00:26:36,990
collide Fleet and then you add that to

824
00:26:34,920 --> 00:26:38,610
the elastic stack so again we like have

825
00:26:36,990 --> 00:26:39,900
the agent to collect the data we're

826
00:26:38,610 --> 00:26:41,340
gonna aggravate that data and then we're

827
00:26:39,900 --> 00:26:43,050
gonna search through that data right and

828
00:26:41,340 --> 00:26:44,370
so when we search through that data we

829
00:26:43,050 --> 00:26:45,930
can identify nifty stuff that you

830
00:26:44,370 --> 00:26:47,100
wouldn't otherwise belie denta file ike

831
00:26:45,930 --> 00:26:48,810
mac OS you don't really think about

832
00:26:47,100 --> 00:26:50,969
searching for malware on it but you can

833
00:26:48,810 --> 00:26:52,830
with OS query and so that github there

834
00:26:50,970 --> 00:26:53,940
actually has a ton of different queries

835
00:26:52,830 --> 00:26:55,379
I think there's like a hundred different

836
00:26:53,940 --> 00:26:57,270
ones that are looking for different

837
00:26:55,380 --> 00:26:58,380
types of things like rootkits and while

838
00:26:57,270 --> 00:26:59,910
we're talking about rootkits

839
00:26:58,380 --> 00:27:01,830
and we're talking about multiple types

840
00:26:59,910 --> 00:27:03,540
of data if you have OS query on a box

841
00:27:01,830 --> 00:27:05,159
you can do something like a net stat and

842
00:27:03,540 --> 00:27:07,080
get back those network connections right

843
00:27:05,160 --> 00:27:08,910
but if you're also listening to the

844
00:27:07,080 --> 00:27:11,100
network traffic that's happening on that

845
00:27:08,910 --> 00:27:13,050
subnet you can say hey there's a traffic

846
00:27:11,100 --> 00:27:14,399
coming from this box that isn't on my

847
00:27:13,050 --> 00:27:16,500
net stack connection so what does that

848
00:27:14,400 --> 00:27:17,340
mean you take those things together you

849
00:27:16,500 --> 00:27:18,840
get a rootkit

850
00:27:17,340 --> 00:27:20,429
right there's something lying to you so

851
00:27:18,840 --> 00:27:25,740
that's that's a pretty important

852
00:27:20,430 --> 00:27:29,630
normally so next we'll talk about

853
00:27:25,740 --> 00:27:29,630
application data and we are almost done

854
00:27:30,230 --> 00:27:35,610
all right so application data now drawn

855
00:27:34,410 --> 00:27:37,050
another arbitrary line this is like

856
00:27:35,610 --> 00:27:38,580
everything else so it's applications

857
00:27:37,050 --> 00:27:40,050
that you make that hopefully have logs

858
00:27:38,580 --> 00:27:41,760
that's important I just talked to

859
00:27:40,050 --> 00:27:43,020
another organization they're like yeah

860
00:27:41,760 --> 00:27:45,150
logs are important right like yeah

861
00:27:43,020 --> 00:27:46,290
totally and if you may I noticed that

862
00:27:45,150 --> 00:27:48,120
your application doesn't generate any

863
00:27:46,290 --> 00:27:49,860
and so you have no idea if anyone's up

864
00:27:48,120 --> 00:27:51,899
using it so you need to make sure that

865
00:27:49,860 --> 00:27:53,909
you're you're generating logs if you are

866
00:27:51,900 --> 00:27:55,980
application developer and then all these

867
00:27:53,910 --> 00:27:57,390
services like DNS TCP l-dub all of those

868
00:27:55,980 --> 00:27:59,850
have logs and those are services running

869
00:27:57,390 --> 00:28:01,590
over the network they're abused all the

870
00:27:59,850 --> 00:28:03,810
time Apache SharePoint

871
00:28:01,590 --> 00:28:05,159
de Jango everything has logs they're

872
00:28:03,810 --> 00:28:06,929
going to be generated that you can use

873
00:28:05,160 --> 00:28:08,640
and you can baseline right so we can

874
00:28:06,930 --> 00:28:10,290
collect it you can normalize that with

875
00:28:08,640 --> 00:28:11,610
log stash log stash is an awesome tool

876
00:28:10,290 --> 00:28:13,230
if you don't have like some sort of

877
00:28:11,610 --> 00:28:15,870
specific parser for your logs you can

878
00:28:13,230 --> 00:28:18,000
use log stash to parse it into a type of

879
00:28:15,870 --> 00:28:19,080
data that's going to work where you can

880
00:28:18,000 --> 00:28:22,350
use that in your seam and you can

881
00:28:19,080 --> 00:28:23,610
correlate with other data as well now I

882
00:28:22,350 --> 00:28:24,870
want to bring up as your sentinel it's

883
00:28:23,610 --> 00:28:26,969
in beta right now if you're using as

884
00:28:24,870 --> 00:28:28,379
your you can add this to your stack for

885
00:28:26,970 --> 00:28:29,580
free and I say for free because it's not

886
00:28:28,380 --> 00:28:31,620
quite for free because everything that

887
00:28:29,580 --> 00:28:34,169
requires data cost money in the cloud

888
00:28:31,620 --> 00:28:36,090
right but it is very cool it's kind of a

889
00:28:34,170 --> 00:28:37,980
seam that can pull in all types of data

890
00:28:36,090 --> 00:28:41,129
like Active Directory ad monitoring and

891
00:28:37,980 --> 00:28:42,540
you can also use it for office 365 and

892
00:28:41,130 --> 00:28:43,920
you can link it in with a whole bunch of

893
00:28:42,540 --> 00:28:45,180
other stuff there's a ton of connectors

894
00:28:43,920 --> 00:28:46,830
for this that they're allowing you to

895
00:28:45,180 --> 00:28:48,240
pull in and you can do the same thing

896
00:28:46,830 --> 00:28:50,129
though we always do collect all the data

897
00:28:48,240 --> 00:28:51,480
we can baseline that data it'll identify

898
00:28:50,130 --> 00:28:52,890
anomalies for you so when we're talking

899
00:28:51,480 --> 00:28:53,190
about log and anomalies it'll do that

900
00:28:52,890 --> 00:28:55,850
too

901
00:28:53,190 --> 00:28:58,680
and here it's using GIP data and

902
00:28:55,850 --> 00:29:00,419
frequency of login to identify anomalies

903
00:28:58,680 --> 00:29:02,700
using some additional statistical

904
00:29:00,420 --> 00:29:04,290
regression analysis as well here but

905
00:29:02,700 --> 00:29:05,490
it's doing the same thing in that cloud

906
00:29:04,290 --> 00:29:07,500
environment so it's a really good way to

907
00:29:05,490 --> 00:29:09,900
be able monitor that stuff and monitor

908
00:29:07,500 --> 00:29:10,559
it in the cloud and the really neat idea

909
00:29:09,900 --> 00:29:12,960
about as your

910
00:29:10,559 --> 00:29:14,100
Sentinel is that it'll scale you don't

911
00:29:12,960 --> 00:29:15,330
worry about building the stuff on the

912
00:29:14,100 --> 00:29:16,830
back end so everything else you have to

913
00:29:15,330 --> 00:29:20,970
build one back end this will scale as

914
00:29:16,830 --> 00:29:23,610
you add in sources automatically and

915
00:29:20,970 --> 00:29:24,720
geoip data and the TTL that we talked

916
00:29:23,610 --> 00:29:27,090
about before that's all protocol

917
00:29:24,720 --> 00:29:28,919
metadata so it's like a story that the

918
00:29:27,090 --> 00:29:30,870
data tells which is is how I like to

919
00:29:28,919 --> 00:29:32,249
envision it and you can make any story

920
00:29:30,870 --> 00:29:34,949
about the data that you want and this is

921
00:29:32,249 --> 00:29:36,749
where we derive the the behavior that

922
00:29:34,950 --> 00:29:38,580
the data is telling us it's doing and

923
00:29:36,749 --> 00:29:40,289
then we identify how that behavior is

924
00:29:38,580 --> 00:29:42,928
different right so when my favorite ones

925
00:29:40,289 --> 00:29:44,879
is DNS entropy uses Shannon entropy it's

926
00:29:42,929 --> 00:29:46,499
actually called string entropy so it's

927
00:29:44,879 --> 00:29:48,869
the randomness of a string is assigned a

928
00:29:46,499 --> 00:29:51,419
number right and you can use guess what

929
00:29:48,869 --> 00:29:53,129
we're gonna use bro is bros awesome so

930
00:29:51,419 --> 00:29:54,929
we use bro and we're gonna identify in

931
00:29:53,129 --> 00:29:56,219
DNS logs places where those strings are

932
00:29:54,929 --> 00:29:57,720
random when we see those random strings

933
00:29:56,220 --> 00:29:59,460
like that in a sub-domain

934
00:29:57,720 --> 00:30:00,119
that means it's encrypted and you same

935
00:29:59,460 --> 00:30:03,360
thing when you're looking through like

936
00:30:00,119 --> 00:30:04,830
executable you look at the entropy of

937
00:30:03,360 --> 00:30:07,769
the data in that executable you can

938
00:30:04,830 --> 00:30:10,230
identify places that are encrypted based

939
00:30:07,769 --> 00:30:12,210
on high entropy same thing with any

940
00:30:10,230 --> 00:30:13,740
string right so we're looking at DNS

941
00:30:12,210 --> 00:30:15,090
queries whether it's with bro or if

942
00:30:13,740 --> 00:30:17,190
you're just pulling those directly from

943
00:30:15,090 --> 00:30:18,480
your DNS server that's fine to use

944
00:30:17,190 --> 00:30:20,909
passive Jean ash to use whatever you

945
00:30:18,480 --> 00:30:23,070
want but you can do this DNS entropy

946
00:30:20,909 --> 00:30:24,629
calculation to kind of baseline what the

947
00:30:23,070 --> 00:30:26,759
average entropy in your environment is

948
00:30:24,629 --> 00:30:28,619
and so here's a sign that is like four

949
00:30:26,759 --> 00:30:30,570
point six so anything rapport point six

950
00:30:28,619 --> 00:30:32,369
ends up being alert this is too random

951
00:30:30,570 --> 00:30:34,439
of a string and it was a hundred percent

952
00:30:32,369 --> 00:30:35,759
positive for a encrypted sub domain

953
00:30:34,440 --> 00:30:37,230
information so this is a DNS

954
00:30:35,759 --> 00:30:40,850
command-and-control going in and out and

955
00:30:37,230 --> 00:30:43,049
or exfiltration or whatever it may be

956
00:30:40,850 --> 00:30:46,110
the next thing i'd like to talk about is

957
00:30:43,049 --> 00:30:48,299
ja3 and salesforce made this what it

958
00:30:46,110 --> 00:30:50,779
does it takes cipher suites and TLS so

959
00:30:48,299 --> 00:30:53,129
just kind of baseline everybody on TLS

960
00:30:50,779 --> 00:30:54,659
essentially if i want to talk to you you

961
00:30:53,129 --> 00:30:56,039
have a certificate we verify

962
00:30:54,659 --> 00:30:57,149
certificates are good but then we also

963
00:30:56,039 --> 00:30:59,039
needed to verify that we're gonna use

964
00:30:57,149 --> 00:31:00,989
the same encryption right so TLS goes

965
00:30:59,039 --> 00:31:02,158
encrypted over the Internet so I'm gonna

966
00:31:00,990 --> 00:31:04,590
say I have these cipher suites available

967
00:31:02,159 --> 00:31:06,179
because me my programming says I have

968
00:31:04,590 --> 00:31:09,529
these libraries available right then

969
00:31:06,179 --> 00:31:13,139
these libraries will say you know I have

970
00:31:09,529 --> 00:31:14,730
yes CD a or whatever that I can talk to

971
00:31:13,139 --> 00:31:16,709
you and you're gonna choose the highest

972
00:31:14,730 --> 00:31:17,580
encryption method that you have as well

973
00:31:16,710 --> 00:31:19,379
and then we're going to decide to

974
00:31:17,580 --> 00:31:21,299
exchange keys over that method and

975
00:31:19,379 --> 00:31:22,649
communicate right so this does it take

976
00:31:21,299 --> 00:31:24,139
all those available cipher suites

977
00:31:22,649 --> 00:31:26,600
from either in the community

978
00:31:24,140 --> 00:31:27,679
and creates a md5 hash out of those

979
00:31:26,600 --> 00:31:30,889
strings that are kind of put together

980
00:31:27,679 --> 00:31:32,870
right and when you do that you get

981
00:31:30,890 --> 00:31:34,340
application signatures based on network

982
00:31:32,870 --> 00:31:36,290
traffic which is really cool so you

983
00:31:34,340 --> 00:31:38,480
can't look inside that encrypted traffic

984
00:31:36,290 --> 00:31:40,040
but what you can do is understand what

985
00:31:38,480 --> 00:31:42,320
application is making that encrypted

986
00:31:40,040 --> 00:31:43,850
traffic so you'll always need to do like

987
00:31:42,320 --> 00:31:45,230
SSL offloading because it's expensive

988
00:31:43,850 --> 00:31:47,270
and hard and you have to put it in the

989
00:31:45,230 --> 00:31:48,770
right place but what you can do is

990
00:31:47,270 --> 00:31:50,540
identify what should be on your network

991
00:31:48,770 --> 00:31:51,799
and whitelist that so we look at three

992
00:31:50,540 --> 00:31:53,840
hours and kind of like a simulated

993
00:31:51,799 --> 00:31:55,730
smaller network of office activity

994
00:31:53,840 --> 00:31:57,470
there's only like 18 different hashes

995
00:31:55,730 --> 00:31:58,760
and so you can whitelist set stuff and

996
00:31:57,470 --> 00:32:00,710
then also it's really important you look

997
00:31:58,760 --> 00:32:02,270
at the least frequent pay so just cuz it

998
00:32:00,710 --> 00:32:04,520
happened one time or four times doesn't

999
00:32:02,270 --> 00:32:05,720
mean it's bad but it may be and so you

1000
00:32:04,520 --> 00:32:07,280
need to go understand and maybe that's a

1001
00:32:05,720 --> 00:32:09,200
specific application for that user

1002
00:32:07,280 --> 00:32:10,639
whitelist it and then now I have to do

1003
00:32:09,200 --> 00:32:13,220
is like look for the next J 3 hash that

1004
00:32:10,640 --> 00:32:14,780
pops up right and malware if you think

1005
00:32:13,220 --> 00:32:16,640
about malware authors they're not

1006
00:32:14,780 --> 00:32:17,870
updating all their cipher suites and

1007
00:32:16,640 --> 00:32:19,160
their libraries very often right it

1008
00:32:17,870 --> 00:32:20,389
takes work it's hard they're not

1009
00:32:19,160 --> 00:32:21,890
Microsoft they don't have a huge

1010
00:32:20,390 --> 00:32:25,750
development team and so they're gonna

1011
00:32:21,890 --> 00:32:25,750
have unique signatures for this as well

1012
00:32:26,770 --> 00:32:31,970
so when you put it all together guess

1013
00:32:30,530 --> 00:32:36,290
who's at the center of it guess whose

1014
00:32:31,970 --> 00:32:37,610
heart it's you and the point is is that

1015
00:32:36,290 --> 00:32:39,918
the analyst you need all this stuff in

1016
00:32:37,610 --> 00:32:43,428
one place right we look at Cubana

1017
00:32:39,919 --> 00:32:45,830
elastic 7.0 came out with a security

1018
00:32:43,429 --> 00:32:47,660
scene which is really great because it's

1019
00:32:45,830 --> 00:32:49,970
going in the perfect correct direction

1020
00:32:47,660 --> 00:32:52,280
and when we look at what that scene what

1021
00:32:49,970 --> 00:32:53,330
sources that seam can take it's it's all

1022
00:32:52,280 --> 00:32:54,980
the sources we talked about it's in

1023
00:32:53,330 --> 00:32:57,110
point data it's net flow it's it's

1024
00:32:54,980 --> 00:32:58,580
Windows Event log Zeke logs they should

1025
00:32:57,110 --> 00:32:59,899
have called it broke still broke it's

1026
00:32:58,580 --> 00:33:02,000
fine

1027
00:32:59,900 --> 00:33:04,309
but it's it's everything that we need

1028
00:33:02,000 --> 00:33:06,290
all in one place but that's still like a

1029
00:33:04,309 --> 00:33:08,330
lot of data so we have to filter that

1030
00:33:06,290 --> 00:33:09,590
data do we need to create out of that

1031
00:33:08,330 --> 00:33:10,668
data just because it's alert doesn't

1032
00:33:09,590 --> 00:33:11,959
mean it's an important learn we take the

1033
00:33:10,669 --> 00:33:14,090
important alerts and we just shove that

1034
00:33:11,960 --> 00:33:15,679
into something kinda categorizes as

1035
00:33:14,090 --> 00:33:17,090
workflow management system right and so

1036
00:33:15,679 --> 00:33:18,530
your workflow management for security

1037
00:33:17,090 --> 00:33:20,299
operations the hive project is an open

1038
00:33:18,530 --> 00:33:22,940
source version of that it's a high

1039
00:33:20,299 --> 00:33:25,010
project we'll take all of those alerts

1040
00:33:22,940 --> 00:33:26,900
that we talked about and you can dump

1041
00:33:25,010 --> 00:33:28,879
them into yet another bucket right so

1042
00:33:26,900 --> 00:33:30,799
we're collecting data but the data now

1043
00:33:28,880 --> 00:33:33,020
is just alert data and we're going to

1044
00:33:30,799 --> 00:33:35,720
analyze that data and correlate it with

1045
00:33:33,020 --> 00:33:37,100
atomic indicators that are similar then

1046
00:33:35,720 --> 00:33:38,059
you can create tasks that go investigate

1047
00:33:37,100 --> 00:33:40,009
that stuff

1048
00:33:38,059 --> 00:33:41,749
and then you can look at trends that

1049
00:33:40,009 --> 00:33:43,429
occur in that atomic data as well as

1050
00:33:41,749 --> 00:33:45,200
your case data and you can manage your

1051
00:33:43,429 --> 00:33:47,899
analyst everybody kind of log in and

1052
00:33:45,200 --> 00:33:50,389
work through this and you can manage how

1053
00:33:47,899 --> 00:33:51,889
you approach different events that

1054
00:33:50,389 --> 00:33:54,998
you're working on that are higher

1055
00:33:51,889 --> 00:33:57,049
likelihood of true positive right and

1056
00:33:54,999 --> 00:33:58,759
then you're generating intelligence so

1057
00:33:57,049 --> 00:34:00,499
the high project the cortex piece of

1058
00:33:58,759 --> 00:34:01,669
that high project can take in like three

1059
00:34:00,499 --> 00:34:03,259
different types intelligence one of

1060
00:34:01,669 --> 00:34:05,539
them's Mis so some malware information

1061
00:34:03,259 --> 00:34:07,759
sharing platform and what that does is

1062
00:34:05,539 --> 00:34:09,589
it takes intelligence and applies it to

1063
00:34:07,759 --> 00:34:11,089
his atomic indicators that you have and

1064
00:34:09,589 --> 00:34:12,859
so intelligence is jeri by anybody else

1065
00:34:11,089 --> 00:34:14,149
it's also generated by you right so when

1066
00:34:12,859 --> 00:34:15,859
you're when you're participating with

1067
00:34:14,149 --> 00:34:17,179
mis you're sharing out your intelligence

1068
00:34:15,859 --> 00:34:18,980
and indicators that you're getting and

1069
00:34:17,179 --> 00:34:20,569
so is everybody else right and so that

1070
00:34:18,980 --> 00:34:23,149
kind of crowdsourcing of information

1071
00:34:20,569 --> 00:34:24,589
allows you to enrich that data then the

1072
00:34:23,149 --> 00:34:26,058
really cool part about threat

1073
00:34:24,589 --> 00:34:27,349
intelligence data is that if you have

1074
00:34:26,059 --> 00:34:28,789
one atomic indicator maybe you're not

1075
00:34:27,349 --> 00:34:30,589
alerting on the rest of what's happening

1076
00:34:28,789 --> 00:34:32,480
but someone else might have seen that so

1077
00:34:30,589 --> 00:34:33,918
what you can get is other indicators

1078
00:34:32,480 --> 00:34:36,469
that may be connected that you can now

1079
00:34:33,918 --> 00:34:38,719
go look for so that enriched data helps

1080
00:34:36,469 --> 00:34:42,649
you like vector your search as you

1081
00:34:38,719 --> 00:34:46,279
triage these events and that kind of

1082
00:34:42,649 --> 00:34:48,168
leads into our operations workflow and

1083
00:34:46,279 --> 00:34:49,429
that which is going to be a high level

1084
00:34:48,168 --> 00:34:51,049
of everything that we just talked about

1085
00:34:49,429 --> 00:34:51,829
right so we kind of went really deep I

1086
00:34:51,049 --> 00:34:54,889
talked about a whole bunch of different

1087
00:34:51,829 --> 00:34:56,089
projects but really here's what we're

1088
00:34:54,889 --> 00:34:58,730
doing we're taking all these different

1089
00:34:56,089 --> 00:35:00,470
like stovepipes of data and we have kind

1090
00:34:58,730 --> 00:35:02,599
of signature analysis we have behavior

1091
00:35:00,470 --> 00:35:03,828
analysis techniques we have machine

1092
00:35:02,599 --> 00:35:05,480
learning alerts all that different stuff

1093
00:35:03,829 --> 00:35:07,099
and we're throwing all of those alerts

1094
00:35:05,480 --> 00:35:10,190
into a seams this is a really really big

1095
00:35:07,099 --> 00:35:12,140
bucket and then with all those alerts in

1096
00:35:10,190 --> 00:35:13,819
that location we're gonna fill through

1097
00:35:12,140 --> 00:35:14,930
those we're gonna filter those on things

1098
00:35:13,819 --> 00:35:16,970
that are important to us with our high

1099
00:35:14,930 --> 00:35:17,960
priority or the unique use cases or

1100
00:35:16,970 --> 00:35:19,819
something that's important to our

1101
00:35:17,960 --> 00:35:21,230
environment or whatever it is we're

1102
00:35:19,819 --> 00:35:22,609
gonna we're gonna tailor those alerts

1103
00:35:21,230 --> 00:35:23,599
down because we're not inspecting all of

1104
00:35:22,609 --> 00:35:26,450
them and this is all going to be done

1105
00:35:23,599 --> 00:35:27,770
you know automatically with queries that

1106
00:35:26,450 --> 00:35:29,210
you develop over time that's your hunt

1107
00:35:27,770 --> 00:35:30,619
team and then we're going to take all of

1108
00:35:29,210 --> 00:35:32,270
those and we're going to shove them into

1109
00:35:30,619 --> 00:35:34,670
that at work workflow management system

1110
00:35:32,270 --> 00:35:37,788
that workflow management system is going

1111
00:35:34,670 --> 00:35:40,549
to take all those alerts and as they pop

1112
00:35:37,789 --> 00:35:41,599
in there slowly I don't really have

1113
00:35:40,549 --> 00:35:44,630
anything to say why this happens I

1114
00:35:41,599 --> 00:35:45,680
should have made that faster as they pop

1115
00:35:44,630 --> 00:35:47,270
in there's going it's going to aggregate

1116
00:35:45,680 --> 00:35:50,450
those right it's going to find things

1117
00:35:47,270 --> 00:35:51,830
that correlate so we just took all the

1118
00:35:50,450 --> 00:35:53,270
logs in the world

1119
00:35:51,830 --> 00:35:56,029
looked at only the ones we cared about

1120
00:35:53,270 --> 00:35:57,830
and then now we're looking at only

1121
00:35:56,030 --> 00:35:59,450
events that correlate so we have a

1122
00:35:57,830 --> 00:36:00,740
really high probability that something's

1123
00:35:59,450 --> 00:36:02,720
happening here so we're not

1124
00:36:00,740 --> 00:36:04,580
interrogating everything we're only

1125
00:36:02,720 --> 00:36:08,629
using our limited work force to look at

1126
00:36:04,580 --> 00:36:11,540
the things that matter so there's a high

1127
00:36:08,630 --> 00:36:13,040
likelihood that these related things are

1128
00:36:11,540 --> 00:36:14,240
going to be something malicious so this

1129
00:36:13,040 --> 00:36:16,340
workflow management systems have been

1130
00:36:14,240 --> 00:36:17,899
combined those indicators for us it's

1131
00:36:16,340 --> 00:36:19,490
gonna run a task that leverages all that

1132
00:36:17,900 --> 00:36:21,290
threat intelligence to enrich that data

1133
00:36:19,490 --> 00:36:25,220
right so we have more information for

1134
00:36:21,290 --> 00:36:28,370
when we go to do that triage and you can

1135
00:36:25,220 --> 00:36:29,779
create cases and they're gonna assign

1136
00:36:28,370 --> 00:36:32,799
tasks to those cases and that can be

1137
00:36:29,780 --> 00:36:35,600
according to a template that can be

1138
00:36:32,800 --> 00:36:37,250
based on the type of alerts that you get

1139
00:36:35,600 --> 00:36:38,299
you can assign different types of tasks

1140
00:36:37,250 --> 00:36:39,860
right so this can also happen

1141
00:36:38,300 --> 00:36:42,740
automatically as like management for

1142
00:36:39,860 --> 00:36:44,960
your team and then here analyze those

1143
00:36:42,740 --> 00:36:45,919
trends over time and then donate back to

1144
00:36:44,960 --> 00:36:48,290
the community with your threat

1145
00:36:45,920 --> 00:36:50,810
intelligence that's the workflow that we

1146
00:36:48,290 --> 00:36:53,120
work through that's a lot and if you

1147
00:36:50,810 --> 00:36:54,830
have some pieces that you want to fit in

1148
00:36:53,120 --> 00:36:57,380
to your commercial applications already

1149
00:36:54,830 --> 00:36:59,000
or if you have nothing and you're

1150
00:36:57,380 --> 00:37:00,740
curious about how to build this yourself

1151
00:36:59,000 --> 00:37:02,390
with all these open-source tools there

1152
00:37:00,740 --> 00:37:04,279
is a github with a team that I worked on

1153
00:37:02,390 --> 00:37:05,540
called identified we call it a Protoss

1154
00:37:04,280 --> 00:37:08,210
because then we get to use the cool unit

1155
00:37:05,540 --> 00:37:10,820
names for different things right yeah

1156
00:37:08,210 --> 00:37:12,410
thanks and the zealot Beal is definitely

1157
00:37:10,820 --> 00:37:14,020
gonna be a laptop that one is a hundred

1158
00:37:12,410 --> 00:37:16,460
percent complete with step-by-step

1159
00:37:14,020 --> 00:37:18,500
commands to run for a Sint OS device

1160
00:37:16,460 --> 00:37:19,910
that leverages all of these data sources

1161
00:37:18,500 --> 00:37:21,950
and then combines them all into one

1162
00:37:19,910 --> 00:37:23,569
place and then runs that entire workflow

1163
00:37:21,950 --> 00:37:25,609
management for you right so that's all

1164
00:37:23,570 --> 00:37:27,710
done the mothership build has the

1165
00:37:25,610 --> 00:37:28,970
concepts there some of it's done it's a

1166
00:37:27,710 --> 00:37:31,160
lot more difficult when you scale this

1167
00:37:28,970 --> 00:37:32,870
out to a data center to like tell you

1168
00:37:31,160 --> 00:37:34,700
how to run different commands on your

1169
00:37:32,870 --> 00:37:35,960
Cisco devices right so that's where

1170
00:37:34,700 --> 00:37:37,100
we're kind of working through some of

1171
00:37:35,960 --> 00:37:38,870
that but there's a lot done there as

1172
00:37:37,100 --> 00:37:41,740
well as well as the way that you can

1173
00:37:38,870 --> 00:37:44,210
scale this stuff across your data center

1174
00:37:41,740 --> 00:37:45,740
and here's a list of super cool projects

1175
00:37:44,210 --> 00:37:47,390
there's some stuff I talked about some

1176
00:37:45,740 --> 00:37:51,049
stuff I didn't I do want to point out EE

1177
00:37:47,390 --> 00:37:54,259
outliers at the bottom left yeah look at

1178
00:37:51,050 --> 00:37:56,030
the bottom left don Aman I met him at

1179
00:37:54,260 --> 00:37:58,040
first Network this year and this guy

1180
00:37:56,030 --> 00:37:59,810
gets it right if you go to that project

1181
00:37:58,040 --> 00:38:02,000
he's looking at outliers and he doesn't

1182
00:37:59,810 --> 00:38:04,190
say machine learning once right so that

1183
00:38:02,000 --> 00:38:05,800
I really like that because it's not he's

1184
00:38:04,190 --> 00:38:07,360
just looking at how it Liars in any

1185
00:38:05,800 --> 00:38:08,920
data set and it's really really

1186
00:38:07,360 --> 00:38:10,540
effective this sits over the top of

1187
00:38:08,920 --> 00:38:12,490
elastic so again we can pull any type of

1188
00:38:10,540 --> 00:38:14,140
data shove that into elastic back in

1189
00:38:12,490 --> 00:38:15,819
we're on EEE outliers at the top of it

1190
00:38:14,140 --> 00:38:18,069
and all identifies testicle outliers

1191
00:38:15,820 --> 00:38:20,230
those least frequent cases which is if

1192
00:38:18,070 --> 00:38:21,730
you've used like elastic screw language

1193
00:38:20,230 --> 00:38:23,530
is kind of difficult to get to the least

1194
00:38:21,730 --> 00:38:25,360
frequent it's not like an easy query to

1195
00:38:23,530 --> 00:38:33,280
do all the time but this will help you

1196
00:38:25,360 --> 00:38:43,630
do that as well cool and that's it thank

1197
00:38:33,280 --> 00:38:44,920
you questions someone asked you at least

1198
00:38:43,630 --> 00:38:50,950
one question I'm gonna be personally

1199
00:38:44,920 --> 00:38:54,790
offended thank you yeah there's a

1200
00:38:50,950 --> 00:38:55,990
project called j-3 ER like j3 ER calm

1201
00:38:54,790 --> 00:38:57,610
it's got sixteen hundred different

1202
00:38:55,990 --> 00:38:59,740
hashes and then actually just update it

1203
00:38:57,610 --> 00:39:02,860
yesterday we did a course site with

1204
00:38:59,740 --> 00:39:03,970
tyler Hudak say hi Tyler there he is we

1205
00:39:02,860 --> 00:39:06,970
did Chris with him yesterday and we

1206
00:39:03,970 --> 00:39:08,560
identified a new J three hash for a trip

1207
00:39:06,970 --> 00:39:10,629
bot client that was updated two weeks

1208
00:39:08,560 --> 00:39:12,880
ago and and donated it to that so that's

1209
00:39:10,630 --> 00:39:15,130
a really good way of doing that but also

1210
00:39:12,880 --> 00:39:16,810
just monitor your network look for

1211
00:39:15,130 --> 00:39:19,180
client side because your server side

1212
00:39:16,810 --> 00:39:20,440
stuffs gonna be really random right and

1213
00:39:19,180 --> 00:39:21,609
just all the servers are gonna be

1214
00:39:20,440 --> 00:39:23,500
different but if you just look client

1215
00:39:21,610 --> 00:39:25,360
side AJ three hashes monitor it and then

1216
00:39:23,500 --> 00:39:27,850
just sort by unique you're going to get

1217
00:39:25,360 --> 00:39:29,350
a pretty good baseline of what should be

1218
00:39:27,850 --> 00:39:30,460
there but then you need to go inspect so

1219
00:39:29,350 --> 00:39:32,080
anything like like when you looked at

1220
00:39:30,460 --> 00:39:33,610
the data that we had it's gonna look way

1221
00:39:32,080 --> 00:39:35,290
different for you have like 10,000 this

1222
00:39:33,610 --> 00:39:37,210
10,000 that but if you have something

1223
00:39:35,290 --> 00:39:39,009
that's like statistically significant in

1224
00:39:37,210 --> 00:39:40,300
a small manner you go find out what that

1225
00:39:39,010 --> 00:39:41,770
is then you just add that to your

1226
00:39:40,300 --> 00:39:44,260
baseline so there's a little bit of work

1227
00:39:41,770 --> 00:39:46,930
to do there right but as you do that

1228
00:39:44,260 --> 00:39:50,280
mainly looking at the smaller cases you

1229
00:39:46,930 --> 00:39:55,169
can develop that whitelist yeah cool

1230
00:39:50,280 --> 00:39:55,170
anybody else yep

1231
00:40:04,130 --> 00:40:14,140
a unique case all right that's like I'm

1232
00:40:08,839 --> 00:40:14,140
not sure I'm gonna remember what you got

1233
00:40:18,279 --> 00:40:24,039
thank you yeah I'm not really sure I'm

1234
00:40:21,019 --> 00:40:24,038
not like a developer

