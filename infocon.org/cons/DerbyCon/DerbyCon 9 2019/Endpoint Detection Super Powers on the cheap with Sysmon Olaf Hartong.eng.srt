1
00:00:00,030 --> 00:00:07,290
yeah oh all right good morning everybody

2
00:00:05,790 --> 00:00:10,320
thanks for skipping lunch for me what

3
00:00:07,290 --> 00:00:14,790
Lisa's sending it and points to put

4
00:00:10,320 --> 00:00:17,510
flowers on cheap is plum so little bit

5
00:00:14,790 --> 00:00:19,859
about myself my name is auto parts all

6
00:00:17,510 --> 00:00:21,480
working for Deloitte as especially as

7
00:00:19,859 --> 00:00:25,170
leader in their blue team I do a lot of

8
00:00:21,480 --> 00:00:28,140
IR forensics hunting whatever I can get

9
00:00:25,170 --> 00:00:30,810
man so I'm basically I also lead a sock

10
00:00:28,140 --> 00:00:33,210
at a financial institution I used to be

11
00:00:30,810 --> 00:00:36,540
a documentary photographer so I'm not

12
00:00:33,210 --> 00:00:38,670
that's cool the nipple check and a voice

13
00:00:36,540 --> 00:00:42,989
which I'll have to base happy to have

14
00:00:38,670 --> 00:00:45,719
them and so talk about today of course

15
00:00:42,989 --> 00:00:47,489
it's a tech related so yeah definitely

16
00:00:45,719 --> 00:00:49,410
aside like that then a little bit about

17
00:00:47,489 --> 00:00:52,169
this one what it is why would you use it

18
00:00:49,410 --> 00:00:53,730
and how would you configure it or how I

19
00:00:52,170 --> 00:00:55,469
prefer to do it and then the three

20
00:00:53,730 --> 00:00:57,480
thousand upon Splunk which I built a

21
00:00:55,469 --> 00:01:01,260
little bit why I built its Weather

22
00:00:57,480 --> 00:01:04,920
Channel what my challenges were and a

23
00:01:01,260 --> 00:01:05,929
demo which is hopefully not too long so

24
00:01:04,920 --> 00:01:08,680
why am I here

25
00:01:05,930 --> 00:01:11,780
well I got accepted right so that's cool

26
00:01:08,680 --> 00:01:14,659
[Music]

27
00:01:11,780 --> 00:01:19,979
first of all how many of ITV's are here

28
00:01:14,659 --> 00:01:21,840
whoo all right couple smart guys so

29
00:01:19,979 --> 00:01:24,090
these guys want to get him right so

30
00:01:21,840 --> 00:01:25,200
first of all they usually get on to the

31
00:01:24,090 --> 00:01:26,729
end points and there's a lot of

32
00:01:25,200 --> 00:01:29,579
solutions some of them are really great

33
00:01:26,729 --> 00:01:31,500
but are costly so a lot of the ers

34
00:01:29,579 --> 00:01:33,089
they're really nice but not everybody

35
00:01:31,500 --> 00:01:35,070
can afford it and it's not always the

36
00:01:33,090 --> 00:01:36,990
quality that you're looking for so I

37
00:01:35,070 --> 00:01:39,979
tried to build an alternative approach

38
00:01:36,990 --> 00:01:44,970
which you can either use coinciding Li

39
00:01:39,979 --> 00:01:46,740
and it allows you to leverage data

40
00:01:44,970 --> 00:01:49,320
platform that you probably already using

41
00:01:46,740 --> 00:01:51,030
is same or in my case plonk

42
00:01:49,320 --> 00:01:52,710
you could also do it or elk but then you

43
00:01:51,030 --> 00:01:54,630
have to do a lot of stuff that I'll show

44
00:01:52,710 --> 00:01:57,990
you later yourself but definitely worth

45
00:01:54,630 --> 00:01:58,890
worth doing so a little disclaimer it's

46
00:01:57,990 --> 00:02:00,420
not a magic bullet

47
00:01:58,890 --> 00:02:03,270
it won't save you you have to do a lot

48
00:02:00,420 --> 00:02:05,740
of stuff yourself it's basically if you

49
00:02:03,270 --> 00:02:07,840
see it as a

50
00:02:05,740 --> 00:02:10,600
that has a lot of tripwires which you

51
00:02:07,840 --> 00:02:13,480
can then use to with us get further and

52
00:02:10,600 --> 00:02:15,609
hopefully find that stuff and so attack

53
00:02:13,480 --> 00:02:17,310
I'm not gonna explain what it is every

54
00:02:15,610 --> 00:02:19,900
but you know super hot right now

55
00:02:17,310 --> 00:02:22,450
everybody's using it every vendors on it

56
00:02:19,900 --> 00:02:22,660
definitely go for it right everybody dig

57
00:02:22,450 --> 00:02:25,329
in

58
00:02:22,660 --> 00:02:27,430
but what I want to say is no not

59
00:02:25,330 --> 00:02:30,160
everybody uses the deck in a way I think

60
00:02:27,430 --> 00:02:31,840
it should be used I think there's three

61
00:02:30,160 --> 00:02:34,900
applications for it so you can use it

62
00:02:31,840 --> 00:02:37,480
for alerts LESBIAN sim EDR whatever kind

63
00:02:34,900 --> 00:02:39,100
of tool there's a hunting capability

64
00:02:37,480 --> 00:02:40,959
that you want to be utilizing and

65
00:02:39,100 --> 00:02:43,320
there's a lot of forensic capability use

66
00:02:40,959 --> 00:02:46,019
so basically it's unbeatable of course

67
00:02:43,320 --> 00:02:48,130
but the darker the color the better your

68
00:02:46,019 --> 00:02:50,800
chances are that you'll find it with

69
00:02:48,130 --> 00:02:53,980
that way and alerting looks a little bit

70
00:02:50,800 --> 00:02:57,030
grim that way doesn't have to be but

71
00:02:53,980 --> 00:02:59,768
this is approximation with yes

72
00:02:57,030 --> 00:03:02,010
so definitely combine these efforts

73
00:02:59,769 --> 00:03:05,560
that's that's all I wanted to make sure

74
00:03:02,010 --> 00:03:07,989
so six month probably most of you know

75
00:03:05,560 --> 00:03:10,470
but anyway it's a free tool it's built

76
00:03:07,989 --> 00:03:13,060
by a couples very small people Microsoft

77
00:03:10,470 --> 00:03:14,950
its release on this is internals license

78
00:03:13,060 --> 00:03:17,470
which is kind of important in a way that

79
00:03:14,950 --> 00:03:19,060
in terms of supports right Microsoft

80
00:03:17,470 --> 00:03:21,280
provides support on all their tools this

81
00:03:19,060 --> 00:03:24,549
one definitely a supports but it's

82
00:03:21,280 --> 00:03:25,989
different whenever you bring mark with

83
00:03:24,549 --> 00:03:28,540
the bar usually with a couple of days

84
00:03:25,989 --> 00:03:31,980
and ethics and he have a really good

85
00:03:28,540 --> 00:03:35,429
version that's using a device driver

86
00:03:31,980 --> 00:03:38,200
which is low on boot time and there's a

87
00:03:35,430 --> 00:03:40,510
process service next to it that writes

88
00:03:38,200 --> 00:03:42,609
I'm going to leave that lock for you and

89
00:03:40,510 --> 00:03:45,310
it is the important part which you have

90
00:03:42,610 --> 00:03:46,420
to configure because if you do it basic

91
00:03:45,310 --> 00:03:49,030
that you don't get the data you're

92
00:03:46,420 --> 00:03:51,518
probably officer so this is an example

93
00:03:49,030 --> 00:03:53,560
offense the gang becomes really but it's

94
00:03:51,519 --> 00:03:55,570
really rich it's really great so that's

95
00:03:53,560 --> 00:03:59,280
why I'm such a fan of it this is an

96
00:03:55,570 --> 00:04:01,900
example process from created by Roberto

97
00:03:59,280 --> 00:04:04,269
which shows all the relationships that

98
00:04:01,900 --> 00:04:06,310
it can have from a process only so

99
00:04:04,269 --> 00:04:09,940
there's deenis stuff there's IP

100
00:04:06,310 --> 00:04:13,329
connections there's files files rates

101
00:04:09,940 --> 00:04:16,630
and and so forth so really really really

102
00:04:13,329 --> 00:04:19,370
which valuable data source so think of

103
00:04:16,630 --> 00:04:21,529
data sources as Jeff mentioned

104
00:04:19,370 --> 00:04:23,600
start this morning there's an admirer

105
00:04:21,529 --> 00:04:27,320
there's a datasource reference and it's

106
00:04:23,600 --> 00:04:30,440
a super useful this is a graph depicting

107
00:04:27,320 --> 00:04:33,979
all the mentions of the data sources so

108
00:04:30,440 --> 00:04:36,919
that Ida spike the more references there

109
00:04:33,979 --> 00:04:39,400
are in attack technique so there's 169

110
00:04:36,919 --> 00:04:41,750
references to process creation events

111
00:04:39,400 --> 00:04:44,239
super nice okay so let's see what's this

112
00:04:41,750 --> 00:04:46,699
month us what is quite a lot it's not

113
00:04:44,240 --> 00:04:48,680
perfect it won't give you every every

114
00:04:46,699 --> 00:04:50,720
data set for that technique but at least

115
00:04:48,680 --> 00:04:55,190
it will provide you with some valuable

116
00:04:50,720 --> 00:04:59,030
metrics so this is a bit of the history

117
00:04:55,190 --> 00:05:01,330
of statements built with some help there

118
00:04:59,030 --> 00:05:04,809
isn't that much supplementation sadly

119
00:05:01,330 --> 00:05:06,859
but this is all accurate so there's this

120
00:05:04,810 --> 00:05:08,840
approximately a new feature release

121
00:05:06,860 --> 00:05:10,760
every six months and then there's some

122
00:05:08,840 --> 00:05:14,119
bug fixes there are some smaller

123
00:05:10,760 --> 00:05:14,930
additions last Thursday evening there

124
00:05:14,120 --> 00:05:17,780
was new

125
00:05:14,930 --> 00:05:19,639
push so in the previous push there was

126
00:05:17,780 --> 00:05:23,000
the original file name added to it which

127
00:05:19,639 --> 00:05:25,010
is awesome whenever an a team or an

128
00:05:23,000 --> 00:05:26,840
attacker renamed binary that is on the

129
00:05:25,010 --> 00:05:28,880
system you'll still get the original

130
00:05:26,840 --> 00:05:32,210
foul man in there so if commander taxi

131
00:05:28,880 --> 00:05:35,120
got renamed to Hello Kitty taxi you can

132
00:05:32,210 --> 00:05:37,760
still see it was it was quartered X

133
00:05:35,120 --> 00:05:39,380
basically sure you can change this but

134
00:05:37,760 --> 00:05:42,349
mostly attacked for lazy so they won't

135
00:05:39,380 --> 00:05:44,210
do this and the dns offense and our new

136
00:05:42,349 --> 00:05:46,520
which are super nice and they're

137
00:05:44,210 --> 00:05:48,080
connected to the process that there is

138
00:05:46,520 --> 00:05:50,990
actually and this is really powerful

139
00:05:48,080 --> 00:05:52,940
because there aren't that many EDRs that

140
00:05:50,990 --> 00:05:56,510
that are able to provide that that data

141
00:05:52,940 --> 00:05:58,880
via version that was pushed on Thursday

142
00:05:56,510 --> 00:06:00,020
you got a couple of new filters which

143
00:05:58,880 --> 00:06:02,030
are really cool if you can see the

144
00:06:00,020 --> 00:06:04,460
bottom if you can read it there's a

145
00:06:02,030 --> 00:06:08,119
contain all which is basically like poor

146
00:06:04,460 --> 00:06:10,909
man's red X so you can submit column

147
00:06:08,120 --> 00:06:15,620
difference or put them in between so you

148
00:06:10,910 --> 00:06:18,410
can get multiple parameters but not

149
00:06:15,620 --> 00:06:20,810
necessarily in the same order so if an

150
00:06:18,410 --> 00:06:24,110
attacker is smart he knows that the

151
00:06:20,810 --> 00:06:26,030
normal order is whatever is there he can

152
00:06:24,110 --> 00:06:27,830
change it up and normal detection won't

153
00:06:26,030 --> 00:06:28,630
see this way you can and the most

154
00:06:27,830 --> 00:06:31,090
important

155
00:06:28,630 --> 00:06:33,909
really really nice one finally we have

156
00:06:31,090 --> 00:06:36,150
Rue group nesting where you can do and

157
00:06:33,910 --> 00:06:38,080
and or combinations so you can do

158
00:06:36,150 --> 00:06:39,969
process where the sure to come online

159
00:06:38,080 --> 00:06:42,010
and only log that and you don't have to

160
00:06:39,970 --> 00:06:44,140
have all that shitty noise that you

161
00:06:42,010 --> 00:06:47,890
probably get from some of the other

162
00:06:44,140 --> 00:06:49,539
things like Alice has being dance you

163
00:06:47,890 --> 00:06:52,599
can have that but you don't have every

164
00:06:49,540 --> 00:06:56,980
every access to lsaps which is really

165
00:06:52,600 --> 00:06:58,870
two and a half so getting your config

166
00:06:56,980 --> 00:07:01,750
this can be complicated especially with

167
00:06:58,870 --> 00:07:04,960
the new stuff you don't want to maintain

168
00:07:01,750 --> 00:07:07,510
a huge blob of config which your end up

169
00:07:04,960 --> 00:07:09,340
loading this is getting messy right so

170
00:07:07,510 --> 00:07:11,530
what I wanted to do is create a modular

171
00:07:09,340 --> 00:07:15,190
approach I wanted to map everything to

172
00:07:11,530 --> 00:07:16,929
attack and maintain it of course so

173
00:07:15,190 --> 00:07:18,750
that's easier and especially me as

174
00:07:16,930 --> 00:07:21,490
consultants I work for a lot of clients

175
00:07:18,750 --> 00:07:23,230
everybody has certain different things

176
00:07:21,490 --> 00:07:25,450
and filtering they have maybe a proxy

177
00:07:23,230 --> 00:07:26,980
that you don't want for all kinds of

178
00:07:25,450 --> 00:07:28,930
other stuff I can basically built a

179
00:07:26,980 --> 00:07:30,850
directory for them flick it in there

180
00:07:28,930 --> 00:07:31,870
generated you can't get it out and I

181
00:07:30,850 --> 00:07:34,000
have my line

182
00:07:31,870 --> 00:07:36,580
neutral neutral base again which is

183
00:07:34,000 --> 00:07:38,470
clickable for everybody so it kind of

184
00:07:36,580 --> 00:07:41,229
looks like this I have a directory

185
00:07:38,470 --> 00:07:44,590
structure basically for every event type

186
00:07:41,230 --> 00:07:45,940
that's there I've merged scripts awesome

187
00:07:44,590 --> 00:07:46,989
effects for Matthias I'm not sure if

188
00:07:45,940 --> 00:07:50,290
he's in the room but he helped me out

189
00:07:46,990 --> 00:07:52,420
building a nice merger script to cobble

190
00:07:50,290 --> 00:07:55,030
everything together in a proper XML

191
00:07:52,420 --> 00:07:57,160
format away and there's a complete

192
00:07:55,030 --> 00:07:58,599
generated config for the people that

193
00:07:57,160 --> 00:08:02,140
still want to be lazy and just use that

194
00:07:58,600 --> 00:08:05,560
perfectly fine by me they work so I use

195
00:08:02,140 --> 00:08:07,960
it a lot and then within every directory

196
00:08:05,560 --> 00:08:10,260
I segregates everything in different

197
00:08:07,960 --> 00:08:13,229
blocks which are the modules so I

198
00:08:10,260 --> 00:08:16,330
segregate the month including excludes

199
00:08:13,230 --> 00:08:19,710
and we didn't every sample there is for

200
00:08:16,330 --> 00:08:22,539
instance one where I excused Splunk

201
00:08:19,710 --> 00:08:25,270
because block is a parent this is noisy

202
00:08:22,540 --> 00:08:29,620
as it can be as Jason mentioned

203
00:08:25,270 --> 00:08:31,690
yesterday so I excluded only for the

204
00:08:29,620 --> 00:08:33,909
process create events right but if he

205
00:08:31,690 --> 00:08:37,059
starts doing some network connections

206
00:08:33,909 --> 00:08:39,370
I'll see you for sure so it's fine it's

207
00:08:37,059 --> 00:08:40,539
a trade-off I don't wanna have as much

208
00:08:39,370 --> 00:08:42,880
thing of wonky Deauville

209
00:08:40,539 --> 00:08:45,970
everything because we got nobody's

210
00:08:42,880 --> 00:08:47,980
millionaire but still you still you want

211
00:08:45,970 --> 00:08:50,259
to have the fatness stuff so yeah if you

212
00:08:47,980 --> 00:08:53,949
have to make decisions sure they can

213
00:08:50,259 --> 00:08:55,779
bite you somehow somewhere but then

214
00:08:53,949 --> 00:08:57,519
hopefully you'll have some other stuff

215
00:08:55,779 --> 00:09:00,029
in place that at least will cover the

216
00:08:57,519 --> 00:09:02,440
rest of it so to say for the includes

217
00:09:00,029 --> 00:09:04,480
and this is nice this is a feature that

218
00:09:02,440 --> 00:09:07,000
was added I think in version 8 where you

219
00:09:04,480 --> 00:09:09,759
have the name annotation so every rule

220
00:09:07,000 --> 00:09:11,709
that is useful for me and where I can

221
00:09:09,759 --> 00:09:14,199
map it to attack I try to map it to the

222
00:09:11,709 --> 00:09:16,719
closest attack technique possible so in

223
00:09:14,199 --> 00:09:19,569
every event log you will see a rule name

224
00:09:16,720 --> 00:09:21,910
fields which has these two parameters in

225
00:09:19,569 --> 00:09:22,870
there so you can also search or laugh so

226
00:09:21,910 --> 00:09:24,880
always accurate

227
00:09:22,870 --> 00:09:27,279
sure but most of the time we will at

228
00:09:24,880 --> 00:09:29,949
least give you a direction to see what

229
00:09:27,279 --> 00:09:33,189
it could be used for so I talked a

230
00:09:29,949 --> 00:09:35,170
little bit about data voyage that's

231
00:09:33,190 --> 00:09:38,500
important especially along canal it's

232
00:09:35,170 --> 00:09:41,139
it's less of a school but you want to

233
00:09:38,500 --> 00:09:42,790
keep this at a certain pace you don't

234
00:09:41,139 --> 00:09:44,529
want to flood yourself with a lot of

235
00:09:42,790 --> 00:09:46,420
data because a you don't wanna use

236
00:09:44,529 --> 00:09:50,079
you're probably not gonna utilize it and

237
00:09:46,420 --> 00:09:53,339
be it's gonna cost you so in this

238
00:09:50,079 --> 00:09:56,290
example this is actually former clients

239
00:09:53,339 --> 00:09:58,870
this is only a server selection and it's

240
00:09:56,290 --> 00:10:01,480
generating about 25 megabytes a day per

241
00:09:58,870 --> 00:10:04,149
server which is fairly acceptable for

242
00:10:01,480 --> 00:10:05,589
any organization clients and

243
00:10:04,149 --> 00:10:08,680
workstations are usually a little bit

244
00:10:05,589 --> 00:10:10,329
less because they have well the most

245
00:10:08,680 --> 00:10:13,899
most of the people are just working in a

246
00:10:10,329 --> 00:10:16,180
browser or in sap or whatever so so then

247
00:10:13,899 --> 00:10:19,449
it's even less so it's actually quite

248
00:10:16,180 --> 00:10:22,060
usable but then you want to do something

249
00:10:19,449 --> 00:10:24,250
with data right so I started building an

250
00:10:22,060 --> 00:10:27,670
app and my goal was to create a

251
00:10:24,250 --> 00:10:31,630
investigative workflow which protects

252
00:10:27,670 --> 00:10:35,079
realizes a lot of stuff for hunters or

253
00:10:31,630 --> 00:10:36,850
whoever red teamers I got a lot of good

254
00:10:35,079 --> 00:10:38,680
stories that people also use it from a

255
00:10:36,850 --> 00:10:42,970
variety perspective where they see noise

256
00:10:38,680 --> 00:10:44,829
EDR which is actually very cool and one

257
00:10:42,970 --> 00:10:46,910
intended I want to work with with

258
00:10:44,829 --> 00:10:50,030
mandatory learning I don't like

259
00:10:46,910 --> 00:10:52,579
that much it has his uses but not for

260
00:10:50,030 --> 00:10:54,680
hunting in my opinion but it will it

261
00:10:52,580 --> 00:10:56,660
will force you to get to know your

262
00:10:54,680 --> 00:11:00,109
environment so definitely if you don't

263
00:10:56,660 --> 00:11:02,540
know your IT team buy them a beer buy

264
00:11:00,110 --> 00:11:04,220
them coffee whatever but these are the

265
00:11:02,540 --> 00:11:05,959
guys that will be able to explain a lot

266
00:11:04,220 --> 00:11:07,850
of things that might stand out to you

267
00:11:05,960 --> 00:11:09,170
which is actually normal in your

268
00:11:07,850 --> 00:11:11,990
environment and it will save you a lot

269
00:11:09,170 --> 00:11:14,420
of time things who we our shell script

270
00:11:11,990 --> 00:11:17,000
that looks weird but actually it's just

271
00:11:14,420 --> 00:11:18,310
I don't know a big 6th edition or

272
00:11:17,000 --> 00:11:21,350
something like that

273
00:11:18,310 --> 00:11:24,020
and there are no no false positive there

274
00:11:21,350 --> 00:11:27,350
are triggers or traps or I want to call

275
00:11:24,020 --> 00:11:30,890
it and there will be a lot of false

276
00:11:27,350 --> 00:11:32,960
positive or worth triggers that are just

277
00:11:30,890 --> 00:11:37,580
common which is fine you'll be able to

278
00:11:32,960 --> 00:11:39,710
whitelist it I'll show you and again no

279
00:11:37,580 --> 00:11:42,590
tech was very useful for me so it's very

280
00:11:39,710 --> 00:11:44,780
easy to correlate in that fashion

281
00:11:42,590 --> 00:11:46,610
so obviously had some challenges Punk

282
00:11:44,780 --> 00:11:49,670
didn't provide me a data model that I

283
00:11:46,610 --> 00:11:51,950
like fortunately Roberto created awesome

284
00:11:49,670 --> 00:11:53,839
so I started integrating that it was

285
00:11:51,950 --> 00:11:56,510
Blanc which is really really nice

286
00:11:53,840 --> 00:11:58,010
because now you can correlate different

287
00:11:56,510 --> 00:12:00,530
kind of events based on the same field

288
00:11:58,010 --> 00:12:02,300
name which everybody that looked at

289
00:12:00,530 --> 00:12:04,579
Windows event logs knows that there

290
00:12:02,300 --> 00:12:09,050
aren't very consistent so thankful Berto

291
00:12:04,580 --> 00:12:10,630
and yeah I want to create a wide leasing

292
00:12:09,050 --> 00:12:12,740
capability so I started out early

293
00:12:10,630 --> 00:12:15,950
started creating white lists for every

294
00:12:12,740 --> 00:12:18,440
shirt serie days and I'm over 50 right

295
00:12:15,950 --> 00:12:21,710
now so it does a skill and it's a mess

296
00:12:18,440 --> 00:12:23,690
so I took me a while to figure out a way

297
00:12:21,710 --> 00:12:26,300
to do this properly which is there now

298
00:12:23,690 --> 00:12:28,280
we works but all these kind of weird

299
00:12:26,300 --> 00:12:30,740
things caused me to basically build the

300
00:12:28,280 --> 00:12:34,939
whole app from scratch because it was

301
00:12:30,740 --> 00:12:37,010
mess and I'm a terrible program so I

302
00:12:34,940 --> 00:12:41,750
call this agile or some people do but

303
00:12:37,010 --> 00:12:45,110
it's really not technical limitation

304
00:12:41,750 --> 00:12:47,480
it's partially my knowledge partially

305
00:12:45,110 --> 00:12:49,010
but because every platform has its

306
00:12:47,480 --> 00:12:51,290
limitations and there was a lot of

307
00:12:49,010 --> 00:12:54,380
evenings for the last two years spent on

308
00:12:51,290 --> 00:12:55,849
this so but that's yeah that's not

309
00:12:54,380 --> 00:12:57,850
really challenges it's a lot of fun

310
00:12:55,850 --> 00:13:00,730
really trust me

311
00:12:57,850 --> 00:13:02,620
so this is kind of overly overlay of how

312
00:13:00,730 --> 00:13:04,960
the app kind of structures so there's

313
00:13:02,620 --> 00:13:06,730
this the threat hunting overview as I

314
00:13:04,960 --> 00:13:08,290
call it it's basically the main

315
00:13:06,730 --> 00:13:11,350
dashboard and from there on out you can

316
00:13:08,290 --> 00:13:13,630
go in to drill down stacking tools there

317
00:13:11,350 --> 00:13:16,270
are some some basic undecayed indicating

318
00:13:13,630 --> 00:13:19,090
shortcuts which are also populating in

319
00:13:16,270 --> 00:13:22,449
the other ones there's all the white

320
00:13:19,090 --> 00:13:24,340
lists that you can add it I got a bit of

321
00:13:22,450 --> 00:13:25,690
an about page where I show you if you

322
00:13:24,340 --> 00:13:28,210
have all the prerequisites set up

323
00:13:25,690 --> 00:13:33,090
properly and so on so this is kind of my

324
00:13:28,210 --> 00:13:36,280
coverage right now this 4450 reports

325
00:13:33,090 --> 00:13:37,660
these rights summary index which is kind

326
00:13:36,280 --> 00:13:40,780
of nice is plunk that you can utilize

327
00:13:37,660 --> 00:13:42,430
that so that it keeps the a bit snappy

328
00:13:40,780 --> 00:13:46,150
so I don't have to deal with rotate the

329
00:13:42,430 --> 00:13:48,069
whole time I search is firing every 15

330
00:13:46,150 --> 00:13:49,780
minutes that correlate aggregates the

331
00:13:48,070 --> 00:13:52,840
results I want to see write them off to

332
00:13:49,780 --> 00:13:54,640
separate separate box query death so

333
00:13:52,840 --> 00:13:57,280
then I can always walk meant this with

334
00:13:54,640 --> 00:13:59,290
real data again but it's just a way to

335
00:13:57,280 --> 00:14:01,120
deal with in a quicker fashion and and a

336
00:13:59,290 --> 00:14:03,819
couple of dashboards that do work with

337
00:14:01,120 --> 00:14:10,360
real time data just because I didn't got

338
00:14:03,820 --> 00:14:11,680
to be able to report yet so equals sees

339
00:14:10,360 --> 00:14:13,240
there we go

340
00:14:11,680 --> 00:14:15,699
so on the top there's a couple of

341
00:14:13,240 --> 00:14:17,550
filters that you can set and then from

342
00:14:15,700 --> 00:14:19,570
left to right there's all the attack

343
00:14:17,550 --> 00:14:22,180
tactics that I've covered for that

344
00:14:19,570 --> 00:14:24,220
actually generated some some data so the

345
00:14:22,180 --> 00:14:25,780
the numbers that you see will be the big

346
00:14:24,220 --> 00:14:29,080
part are the numbers that happened that

347
00:14:25,780 --> 00:14:30,579
day next way this is offset of the day

348
00:14:29,080 --> 00:14:33,190
before and there's a line below that

349
00:14:30,580 --> 00:14:35,020
shows you all the data over the whole

350
00:14:33,190 --> 00:14:37,990
week then there's a top techniques

351
00:14:35,020 --> 00:14:39,460
triggered on left so all the techniques

352
00:14:37,990 --> 00:14:41,080
that are it the most across your whole

353
00:14:39,460 --> 00:14:43,480
network will show up over there and on

354
00:14:41,080 --> 00:14:45,520
the right side there are the hosts that

355
00:14:43,480 --> 00:14:47,530
are impacted the most so this one houses

356
00:14:45,520 --> 00:14:51,310
gives out unless you can read is like

357
00:14:47,530 --> 00:14:53,380
nine ninety K hits so that something you

358
00:14:51,310 --> 00:14:55,089
wanna investigate properly and then

359
00:14:53,380 --> 00:14:56,500
there's also a graph basically showing

360
00:14:55,090 --> 00:14:59,410
the same thing but then on a timescale

361
00:14:56,500 --> 00:15:01,330
and in this case it's a very boring lab

362
00:14:59,410 --> 00:15:03,010
so there's not much going on and then

363
00:15:01,330 --> 00:15:05,710
all of a sudden there's a huge spike so

364
00:15:03,010 --> 00:15:08,020
definitely go there so I just clicked on

365
00:15:05,710 --> 00:15:10,540
the host name of that house that got hit

366
00:15:08,020 --> 00:15:10,939
the most now on top it's a bit unclear

367
00:15:10,540 --> 00:15:13,069
so

368
00:15:10,940 --> 00:15:14,690
but there's a bullet draft that

369
00:15:13,070 --> 00:15:17,180
basically shows you a bullet for every

370
00:15:14,690 --> 00:15:19,220
technique that hates overtime and the

371
00:15:17,180 --> 00:15:21,709
bigger the bullets the more interesting

372
00:15:19,220 --> 00:15:23,840
it might be and I'm going down there's

373
00:15:21,710 --> 00:15:27,530
there's there's all this system on which

374
00:15:23,840 --> 00:15:29,660
data which is nicely structured and then

375
00:15:27,530 --> 00:15:32,420
there's every time there should attack

376
00:15:29,660 --> 00:15:34,430
technique you can click everything it

377
00:15:32,420 --> 00:15:36,170
will take you to the to the miter just

378
00:15:34,430 --> 00:15:38,569
to read up on it if you don't know what

379
00:15:36,170 --> 00:15:41,630
frontier level 32 2 does or what case

380
00:15:38,570 --> 00:15:44,600
you've explained see you and then it

381
00:15:41,630 --> 00:15:46,250
will show you everything that I believe

382
00:15:44,600 --> 00:15:47,840
is useful in investigating this further

383
00:15:46,250 --> 00:15:49,790
so there's their process come online

384
00:15:47,840 --> 00:15:52,550
there's the original file name there's

385
00:15:49,790 --> 00:15:54,410
the parent process there are the process

386
00:15:52,550 --> 00:15:55,849
- it's like the global unique IDs these

387
00:15:54,410 --> 00:15:58,310
are also means it's more because that

388
00:15:55,850 --> 00:16:00,890
allows you to correlate across the whole

389
00:15:58,310 --> 00:16:02,540
the whole three and there's a file hash

390
00:16:00,890 --> 00:16:04,220
so you can click the file hash it will

391
00:16:02,540 --> 00:16:06,439
take you to virustotal in this case it

392
00:16:04,220 --> 00:16:09,580
was called a taxi it's very fast sorry

393
00:16:06,440 --> 00:16:12,620
I want to cram in as much as possible so

394
00:16:09,580 --> 00:16:14,390
going back to that to the global Teddy

395
00:16:12,620 --> 00:16:16,160
so there's one for the parents and one

396
00:16:14,390 --> 00:16:19,160
for the child so you can look up and

397
00:16:16,160 --> 00:16:22,699
down all the way so if you click on the

398
00:16:19,160 --> 00:16:24,230
parent process one you see the global

399
00:16:22,700 --> 00:16:26,540
unique ID and the process that spawned

400
00:16:24,230 --> 00:16:28,130
for it ideally see one here because

401
00:16:26,540 --> 00:16:30,230
otherwise it might be injected or or

402
00:16:28,130 --> 00:16:32,270
tampered with not necessarily bad when

403
00:16:30,230 --> 00:16:34,070
you sit and everything does it but it at

404
00:16:32,270 --> 00:16:35,600
least gives you a way of further

405
00:16:34,070 --> 00:16:38,480
investigating on the right there was the

406
00:16:35,600 --> 00:16:40,490
whole tree that is correlated or related

407
00:16:38,480 --> 00:16:44,120
to it and then there's all the event

408
00:16:40,490 --> 00:16:45,830
types that are generated for that global

409
00:16:44,120 --> 00:16:47,540
unique ID so you saw a lot of sub

410
00:16:45,830 --> 00:16:51,290
processes instead of the one that we

411
00:16:47,540 --> 00:16:53,719
just clicked and there's always that's

412
00:16:51,290 --> 00:16:55,689
if you don't if it doesn't recognize the

413
00:16:53,720 --> 00:16:58,160
fields you always have Google and github

414
00:16:55,690 --> 00:16:59,720
just the useful way if you find a

415
00:16:58,160 --> 00:17:01,910
certain command line you click it you go

416
00:16:59,720 --> 00:17:04,640
to get up maybe maybe somebody wrote a

417
00:17:01,910 --> 00:17:09,710
script for it so it gives you a little

418
00:17:04,640 --> 00:17:10,970
bit more context see right so if there's

419
00:17:09,710 --> 00:17:12,319
something in there that you don't want

420
00:17:10,970 --> 00:17:14,690
to see anymore because it's fine

421
00:17:12,319 --> 00:17:16,220
you could click on the time fields in

422
00:17:14,690 --> 00:17:17,870
anywhere through the app and it will

423
00:17:16,220 --> 00:17:19,819
take you to whitelist editor populate

424
00:17:17,869 --> 00:17:21,649
the whole string for you you only have

425
00:17:19,819 --> 00:17:23,429
to give it a valid reason a better one

426
00:17:21,650 --> 00:17:26,850
and write it there

427
00:17:23,430 --> 00:17:28,590
submitted anyone see anymore and it

428
00:17:26,849 --> 00:17:32,030
won't be hitting the search is either so

429
00:17:28,590 --> 00:17:35,629
it's also better for performance

430
00:17:32,030 --> 00:17:38,070
I'll see what I do now

431
00:17:35,630 --> 00:17:42,450
that's not a recorded demo right so you

432
00:17:38,070 --> 00:17:44,760
forget about what she did right so okay

433
00:17:42,450 --> 00:17:47,160
we're Beauty screen there's some process

434
00:17:44,760 --> 00:17:49,320
access stuff so maybe there's access to

435
00:17:47,160 --> 00:17:51,480
to access might be mimicked ads might be

436
00:17:49,320 --> 00:17:53,879
might be good but you can investigate it

437
00:17:51,480 --> 00:17:55,890
there's files being created there's some

438
00:17:53,880 --> 00:17:58,140
XE files draw up there's DLL oh that's

439
00:17:55,890 --> 00:18:00,540
all kinds of stuff that you might be

440
00:17:58,140 --> 00:18:02,640
might be interested in there's a lot of

441
00:18:00,540 --> 00:18:05,430
network connections as registry access

442
00:18:02,640 --> 00:18:08,430
their some DNS stuff in this case it's

443
00:18:05,430 --> 00:18:10,230
the use of HTTP queries not sure if

444
00:18:08,430 --> 00:18:14,040
anybody wants to have that in English

445
00:18:10,230 --> 00:18:17,040
surprise environment yet but again

446
00:18:14,040 --> 00:18:18,389
something to investigate so on the

447
00:18:17,040 --> 00:18:20,430
network connections I clicked on the

448
00:18:18,390 --> 00:18:23,250
destination IP and then in the middle

449
00:18:20,430 --> 00:18:24,870
you'll get a graph with all IPs

450
00:18:23,250 --> 00:18:28,590
connecting with that IP this is an

451
00:18:24,870 --> 00:18:29,969
external IP maybe interesting right side

452
00:18:28,590 --> 00:18:31,590
there's a Sankey diagram basically

453
00:18:29,970 --> 00:18:33,150
showing the same thing but then also

454
00:18:31,590 --> 00:18:35,090
with the amount of connections or the

455
00:18:33,150 --> 00:18:38,070
more connections the broader the graph

456
00:18:35,090 --> 00:18:40,439
and it will it will at least tell you

457
00:18:38,070 --> 00:18:41,669
something that if you only see one then

458
00:18:40,440 --> 00:18:44,130
it's maybe not interesting but it's not

459
00:18:41,670 --> 00:18:47,040
a pole she is connected to the same

460
00:18:44,130 --> 00:18:48,600
thing with different usernames yeah

461
00:18:47,040 --> 00:18:50,550
might be suspicious so if you click the

462
00:18:48,600 --> 00:18:52,409
IP again it will take you to census but

463
00:18:50,550 --> 00:18:54,870
you can change this for showdown or

464
00:18:52,410 --> 00:18:57,120
whatever you want it will give you some

465
00:18:54,870 --> 00:19:00,149
more contextual info is Amazon so it

466
00:18:57,120 --> 00:19:02,129
could be anything but at least again

467
00:19:00,150 --> 00:19:04,170
some some more context for you that you

468
00:19:02,130 --> 00:19:07,170
are able to to understand what's going

469
00:19:04,170 --> 00:19:08,760
on so I might be interested in in what

470
00:19:07,170 --> 00:19:10,440
happened with this process what what

471
00:19:08,760 --> 00:19:12,780
what started it what's the command line

472
00:19:10,440 --> 00:19:14,580
and there's where the global unique ID

473
00:19:12,780 --> 00:19:16,950
again it's very powerful because if I

474
00:19:14,580 --> 00:19:19,020
click it I now see that there's a

475
00:19:16,950 --> 00:19:23,130
process creation events actually tied to

476
00:19:19,020 --> 00:19:25,710
this and actually nice PowerShell

477
00:19:23,130 --> 00:19:28,020
command when the command line could be

478
00:19:25,710 --> 00:19:30,300
could be could be nothing right maybe

479
00:19:28,020 --> 00:19:33,450
there's not happening we fancy doing

480
00:19:30,300 --> 00:19:36,270
fancy stuff but so if something to

481
00:19:33,450 --> 00:19:37,540
decode or go further so I'll show you

482
00:19:36,270 --> 00:19:39,220
later

483
00:19:37,540 --> 00:19:40,960
there's a couple more drill down so

484
00:19:39,220 --> 00:19:42,820
there's also used to drill down you

485
00:19:40,960 --> 00:19:44,470
could have clicked user name anywhere in

486
00:19:42,820 --> 00:19:45,730
the app will take you there and it will

487
00:19:44,470 --> 00:19:48,070
filter it

488
00:19:45,730 --> 00:19:49,990
I took the lazy one so I now filter on

489
00:19:48,070 --> 00:19:52,320
everybody you should do this in large

490
00:19:49,990 --> 00:19:54,730
environments trust me

491
00:19:52,320 --> 00:19:56,470
but basically what it's doing is it's

492
00:19:54,730 --> 00:20:00,520
populating a dynamic dashboard with all

493
00:19:56,470 --> 00:20:02,800
kinds of stuff all the older tech stuff

494
00:20:00,520 --> 00:20:04,260
that is related to that username if you

495
00:20:02,800 --> 00:20:07,180
filter all my username now you see all

496
00:20:04,260 --> 00:20:10,870
on the left you'll see all the machines

497
00:20:07,180 --> 00:20:13,660
that are connected to it log ons also

498
00:20:10,870 --> 00:20:15,550
where it's kind of useful but also the

499
00:20:13,660 --> 00:20:18,040
successful ones so in this case you see

500
00:20:15,550 --> 00:20:21,879
John Doe connecting through three

501
00:20:18,040 --> 00:20:25,389
machines which is not not the real name

502
00:20:21,880 --> 00:20:26,890
of course and then if you go down which

503
00:20:25,390 --> 00:20:29,950
you probably can't read but you also see

504
00:20:26,890 --> 00:20:32,290
there was an account created it was

505
00:20:29,950 --> 00:20:34,150
enabled there was a password set for it

506
00:20:32,290 --> 00:20:37,570
it was added to the domain I've been

507
00:20:34,150 --> 00:20:39,210
grouped and it was deleted afterwards so

508
00:20:37,570 --> 00:20:43,240
maybe again something suspicious

509
00:20:39,210 --> 00:20:48,400
probably is and then going down further

510
00:20:43,240 --> 00:20:50,740
we also see some some past activity and

511
00:20:48,400 --> 00:20:52,390
then all the process sister are

512
00:20:50,740 --> 00:20:54,040
connected to it's the network

513
00:20:52,390 --> 00:20:59,560
connections that are related to that

514
00:20:54,040 --> 00:21:01,389
same user and so forth so then there is

515
00:20:59,560 --> 00:21:02,649
a couple more days file creation events

516
00:21:01,390 --> 00:21:06,490
there's no connections that you saw

517
00:21:02,650 --> 00:21:08,350
before name pipes all in the same

518
00:21:06,490 --> 00:21:09,820
fashion so everything structures are the

519
00:21:08,350 --> 00:21:11,919
same and then especially in the

520
00:21:09,820 --> 00:21:13,960
beginning once you start you DS that I

521
00:21:11,920 --> 00:21:17,560
got to stacking dashboards because

522
00:21:13,960 --> 00:21:20,020
you'll get swamped with stuff and this

523
00:21:17,560 --> 00:21:22,480
is a quick way to at least correlate a

524
00:21:20,020 --> 00:21:23,920
little bit so it will counts also the

525
00:21:22,480 --> 00:21:25,540
amount of times that it happens in the

526
00:21:23,920 --> 00:21:27,640
time frame that you selected so if

527
00:21:25,540 --> 00:21:29,560
something is very repetitive you know

528
00:21:27,640 --> 00:21:31,630
it's safe you only have to whitelist it

529
00:21:29,560 --> 00:21:33,940
here once instead of having to scroll

530
00:21:31,630 --> 00:21:35,740
through thousands of results so it's

531
00:21:33,940 --> 00:21:37,150
just a quick way of doing this and

532
00:21:35,740 --> 00:21:38,680
instead of clicking on the time frame

533
00:21:37,150 --> 00:21:40,720
you have to click on the own account

534
00:21:38,680 --> 00:21:43,510
number because yeah to remove the time

535
00:21:40,720 --> 00:21:46,900
frames is it it happens oh he wants a

536
00:21:43,510 --> 00:21:48,910
certain time frame there's a thing with

537
00:21:46,900 --> 00:21:50,040
whitelist so you have to make sure that

538
00:21:48,910 --> 00:21:52,170
you

539
00:21:50,040 --> 00:21:53,970
again provide a valid reason but you

540
00:21:52,170 --> 00:21:57,360
should also well card it's on the right

541
00:21:53,970 --> 00:21:59,910
places because some processes use a

542
00:21:57,360 --> 00:22:02,250
unique ID or something else in there you

543
00:21:59,910 --> 00:22:04,380
really don't want to whitelist it every

544
00:22:02,250 --> 00:22:07,020
time and see what it spawns because then

545
00:22:04,380 --> 00:22:10,650
it's again useless useless stuff so I I

546
00:22:07,020 --> 00:22:12,840
have some sorry some small extra

547
00:22:10,650 --> 00:22:15,690
indicators so this is a dashboard that

548
00:22:12,840 --> 00:22:17,340
looks for tampering with this one it

549
00:22:15,690 --> 00:22:19,830
looks for for changes in the config

550
00:22:17,340 --> 00:22:21,810
clouds since a system loads a new config

551
00:22:19,830 --> 00:22:24,540
I will generate ash for it and it will

552
00:22:21,810 --> 00:22:26,340
depict it in the middle it's empty but

553
00:22:24,540 --> 00:22:28,440
if Carlos is playing in your environment

554
00:22:26,340 --> 00:22:31,800
that you'll probably directly go to the

555
00:22:28,440 --> 00:22:33,420
registry you'll see it here because if

556
00:22:31,800 --> 00:22:35,730
somebody is writing to the registry for

557
00:22:33,420 --> 00:22:39,630
system on and it's not says more I don't

558
00:22:35,730 --> 00:22:41,370
trust it and then I have some let's

559
00:22:39,630 --> 00:22:43,700
remove with indicator so if there's some

560
00:22:41,370 --> 00:22:46,620
W my stuff or some WR and stuff that

561
00:22:43,700 --> 00:22:52,770
stands out it will at least be populated

562
00:22:46,620 --> 00:22:54,750
here there is power events and that is

563
00:22:52,770 --> 00:22:58,440
basically what I do here is I look for

564
00:22:54,750 --> 00:23:01,020
base64 blobs or download cradles and I

565
00:22:58,440 --> 00:23:03,450
provide a way to immediately click on

566
00:23:01,020 --> 00:23:09,870
one of these base 64 blobs and I would

567
00:23:03,450 --> 00:23:11,940
take to do sorry chef there decoded so

568
00:23:09,870 --> 00:23:16,379
you don't have to copy paste all kinds

569
00:23:11,940 --> 00:23:17,850
of boring stuff two minutes kids I'll

570
00:23:16,380 --> 00:23:21,390
probably have to skip parts the demo

571
00:23:17,850 --> 00:23:22,830
there I mean it's just a very simple

572
00:23:21,390 --> 00:23:24,480
cope with flag dropper so it's not

573
00:23:22,830 --> 00:23:26,189
nothing special but once you've seen it

574
00:23:24,480 --> 00:23:28,890
once then you'll immediately recognize

575
00:23:26,190 --> 00:23:31,410
it so you go through it I do also do for

576
00:23:28,890 --> 00:23:34,350
macro so if you enable macros even in in

577
00:23:31,410 --> 00:23:36,900
words or in Outlook it will show up here

578
00:23:34,350 --> 00:23:38,669
and what he drilled down and look what

579
00:23:36,900 --> 00:23:42,510
happened afterwards which is actually

580
00:23:38,670 --> 00:23:44,070
more interesting than just a macro and

581
00:23:42,510 --> 00:23:46,560
then there's a couple more overview so

582
00:23:44,070 --> 00:23:50,760
I'll skip those you'll have to play with

583
00:23:46,560 --> 00:23:52,470
the app yourself this time so this is

584
00:23:50,760 --> 00:23:56,370
what it looked like when I deployed it

585
00:23:52,470 --> 00:23:58,890
at the clients first day it looks kind

586
00:23:56,370 --> 00:24:00,840
of scary maybe it's three or forty seven

587
00:23:58,890 --> 00:24:02,659
thousand things but there's a lot of

588
00:24:00,840 --> 00:24:04,820
repetitiveness fact the most

589
00:24:02,659 --> 00:24:06,379
no there's a lot of PowerShell stuff

590
00:24:04,820 --> 00:24:08,389
that's being ran constantly this

591
00:24:06,379 --> 00:24:10,309
constantly the same thing so with the

592
00:24:08,389 --> 00:24:13,668
stacking dashboards it took me probably

593
00:24:10,309 --> 00:24:15,440
two days with three interactions with

594
00:24:13,669 --> 00:24:17,690
ops team and then I already got it down

595
00:24:15,440 --> 00:24:19,399
into the low hundreds instead of Conesus

596
00:24:17,690 --> 00:24:21,139
or hundreds of thousands so it's

597
00:24:19,399 --> 00:24:23,289
relatively easy but it's something that

598
00:24:21,139 --> 00:24:25,549
you have to maintain and keep up with

599
00:24:23,289 --> 00:24:27,950
throughout the day you don't have to be

600
00:24:25,549 --> 00:24:30,049
at it full time but it will take you

601
00:24:27,950 --> 00:24:32,149
some time but it will hopefully provide

602
00:24:30,049 --> 00:24:34,759
you a couple of goods that could do the

603
00:24:32,149 --> 00:24:36,859
indicators one of the best things I had

604
00:24:34,759 --> 00:24:39,499
it was I detected the red team 10

605
00:24:36,859 --> 00:24:44,059
minutes after they got in so like that

606
00:24:39,499 --> 00:24:45,799
it was kind of fun but afterwards we

607
00:24:44,059 --> 00:24:47,330
work together to see okay do you see

608
00:24:45,799 --> 00:24:48,889
this do you see that so we literally

609
00:24:47,330 --> 00:24:51,289
into purple which is actually very very

610
00:24:48,889 --> 00:24:54,408
fit for the clients so a little bit of

611
00:24:51,289 --> 00:24:57,739
roadmap stuff it now does Windows Event

612
00:24:54,409 --> 00:25:00,679
log partially it does everything system

613
00:24:57,739 --> 00:25:02,960
on yeah but I want to keep on adding

614
00:25:00,679 --> 00:25:05,359
stuff to it it doesn't PowerShell basic

615
00:25:02,960 --> 00:25:10,299
stuff but not be the transcripts no no

616
00:25:05,359 --> 00:25:13,908
food WMI so Matthew D is partly there

617
00:25:10,299 --> 00:25:15,859
yeah keep on having speakers it's 115

618
00:25:13,909 --> 00:25:18,080
hours can be five hundreds in a couple

619
00:25:15,859 --> 00:25:21,619
of months probably and if I have time

620
00:25:18,080 --> 00:25:24,460
browse the firewalls forever so that was

621
00:25:21,619 --> 00:25:24,459
me thank you

622
00:25:30,310 --> 00:25:33,310
okay

