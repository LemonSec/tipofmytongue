1
00:00:00,000 --> 00:00:04,730
to blue my name is matyoo Sonia you can

2
00:00:02,250 --> 00:00:07,429
also find me on Twitter at Scooby MTL

3
00:00:04,730 --> 00:00:10,110
here's just a little bit about me I

4
00:00:07,429 --> 00:00:13,290
specialize in adversary' detection and

5
00:00:10,110 --> 00:00:16,049
tread hunting I'm also a DEFCON Blue

6
00:00:13,290 --> 00:00:18,840
Team volunteers since last year at its

7
00:00:16,049 --> 00:00:20,100
creation at this point of the talk you

8
00:00:18,840 --> 00:00:22,109
might already wonder is this guy

9
00:00:20,100 --> 00:00:24,600
mentally challenged or does he have an

10
00:00:22,109 --> 00:00:26,430
accent well according to my doctor it's

11
00:00:24,600 --> 00:00:27,029
because I'm French Canadian and I speak

12
00:00:26,430 --> 00:00:29,939
like this

13
00:00:27,029 --> 00:00:32,430
so you'll so you'll probably notice that

14
00:00:29,939 --> 00:00:34,860
I will or not pronounced h's in front of

15
00:00:32,430 --> 00:00:36,510
word and s's at the end of words or I

16
00:00:34,860 --> 00:00:39,960
might add them where they don't belong

17
00:00:36,510 --> 00:00:41,940
don't worry and Canadian well in general

18
00:00:39,960 --> 00:00:46,800
were nice people until we talk about

19
00:00:41,940 --> 00:00:49,140
hockey so here's the agenda for today so

20
00:00:46,800 --> 00:00:52,620
we're gonna go over an overview of blood

21
00:00:49,140 --> 00:00:54,120
down some basic usage of blood down then

22
00:00:52,620 --> 00:00:56,489
I'm gonna go through an introduction of

23
00:00:54,120 --> 00:00:58,288
the cipher query language then we're

24
00:00:56,489 --> 00:00:59,968
going to use that knowledge to destroy

25
00:00:58,289 --> 00:01:02,609
attack paths and then we're going to

26
00:00:59,969 --> 00:01:06,000
talk about reporting and automation by

27
00:01:02,609 --> 00:01:09,689
show of hands except you two who

28
00:01:06,000 --> 00:01:11,460
actually used blood down before okay a

29
00:01:09,689 --> 00:01:18,199
lot of people who actually build our own

30
00:01:11,460 --> 00:01:20,669
cipher query before Allah you did okay

31
00:01:18,200 --> 00:01:23,340
defenders thinking list attackers

32
00:01:20,670 --> 00:01:25,380
thinking graph as long as this is true

33
00:01:23,340 --> 00:01:26,700
attackers wins this is a very famous

34
00:01:25,380 --> 00:01:28,380
quote from John Lambert that you

35
00:01:26,700 --> 00:01:32,280
probably heard it's also the title of

36
00:01:28,380 --> 00:01:33,990
one of his blog post so when an

37
00:01:32,280 --> 00:01:36,329
adversity lands in your network it

38
00:01:33,990 --> 00:01:38,310
doesn't land in a list it lands in a

39
00:01:36,329 --> 00:01:41,250
graph which is a complex sets of

40
00:01:38,310 --> 00:01:42,720
relationship between objects blood down

41
00:01:41,250 --> 00:01:45,659
is one of the tools that can actually

42
00:01:42,720 --> 00:01:48,780
help you visualize the graph and turn

43
00:01:45,659 --> 00:01:50,880
the table in your favor as a defender so

44
00:01:48,780 --> 00:01:52,619
what do we talk about when when we talk

45
00:01:50,880 --> 00:01:55,710
about lists well this is a good example

46
00:01:52,619 --> 00:01:58,259
a list of assets a list of server names

47
00:01:55,710 --> 00:02:00,000
a lifts those groups a list of serial

48
00:01:58,259 --> 00:02:02,100
number which is extremely useful in

49
00:02:00,000 --> 00:02:05,280
InfoSec and when you dig down you have

50
00:02:02,100 --> 00:02:08,160
more lists a list of open ports install

51
00:02:05,280 --> 00:02:08,669
software compliancy box so on and so

52
00:02:08,160 --> 00:02:11,790
forth

53
00:02:08,669 --> 00:02:13,600
while all what all of those lists won't

54
00:02:11,790 --> 00:02:15,790
tell you that a graph will

55
00:02:13,600 --> 00:02:18,489
is how are those things actually

56
00:02:15,790 --> 00:02:20,739
connected together in other words what

57
00:02:18,490 --> 00:02:22,720
are the relationship that exists that

58
00:02:20,740 --> 00:02:26,040
you know of and especially that you do

59
00:02:22,720 --> 00:02:30,750
not know of between all of your assets

60
00:02:26,040 --> 00:02:34,090
what is a graph well a graph is not

61
00:02:30,750 --> 00:02:35,830
security terror concept per se it can be

62
00:02:34,090 --> 00:02:39,310
used in everyday life like in this

63
00:02:35,830 --> 00:02:42,670
example so you and Alexis are in a

64
00:02:39,310 --> 00:02:46,150
restaurant comes along Taylor and Jordan

65
00:02:42,670 --> 00:02:47,950
you become in fact weighted with Jordan

66
00:02:46,150 --> 00:02:49,540
and you gonna leverage assets of

67
00:02:47,950 --> 00:02:51,850
relationship in order to get what you

68
00:02:49,540 --> 00:02:54,790
want so you're gonna you leverage your

69
00:02:51,850 --> 00:02:57,460
family relationship with Alexis which is

70
00:02:54,790 --> 00:02:59,679
a co-worker of Taylor which is a friend

71
00:02:57,460 --> 00:03:03,370
of Jordan and with that you're gonna

72
00:02:59,680 --> 00:03:05,320
find Jordan phone's number yay and by

73
00:03:03,370 --> 00:03:09,450
the icon I used for a net phone number

74
00:03:05,320 --> 00:03:09,450
you can guess roughly our hold I am I

75
00:03:09,840 --> 00:03:14,650
also hope that you noticed and

76
00:03:12,700 --> 00:03:16,959
appreciate that all the names and

77
00:03:14,650 --> 00:03:19,900
relationship are gender-neutral but a

78
00:03:16,960 --> 00:03:21,490
lot of effort into that now in Active

79
00:03:19,900 --> 00:03:24,010
Directory this is how it actually

80
00:03:21,490 --> 00:03:26,200
translates an attacker will land on your

81
00:03:24,010 --> 00:03:28,480
network maybe by using spearfishing or

82
00:03:26,200 --> 00:03:31,299
password spraying or whatever and from

83
00:03:28,480 --> 00:03:33,940
that user you might have admin to is on

84
00:03:31,300 --> 00:03:35,440
laptop very bad info SEC practice but it

85
00:03:33,940 --> 00:03:38,410
does happen way more than we want to

86
00:03:35,440 --> 00:03:40,750
admit it then from that laptop maybe

87
00:03:38,410 --> 00:03:42,790
that user can RDP to a terminal server

88
00:03:40,750 --> 00:03:44,590
for example and depending on the size of

89
00:03:42,790 --> 00:03:47,140
your organization they might be hundreds

90
00:03:44,590 --> 00:03:51,010
if not thousands of people connected to

91
00:03:47,140 --> 00:03:52,929
that machine and one of these user who

92
00:03:51,010 --> 00:03:55,269
has a session as a lil crown because he

93
00:03:52,930 --> 00:03:59,890
belongs to a group a high-value group

94
00:03:55,270 --> 00:04:01,480
such as domain and men in this

95
00:03:59,890 --> 00:04:03,640
presentation I will use domain admin or

96
00:04:01,480 --> 00:04:06,070
high value group almost interchangeably

97
00:04:03,640 --> 00:04:08,230
but bear in mind that is more groups

98
00:04:06,070 --> 00:04:11,530
than just domain admins that are of high

99
00:04:08,230 --> 00:04:13,299
interest now we're going to go over an

100
00:04:11,530 --> 00:04:14,920
overview of bloodhound I might go a bit

101
00:04:13,300 --> 00:04:17,560
fast because almost everybody raised her

102
00:04:14,920 --> 00:04:19,180
and but what is blood down blood down

103
00:04:17,560 --> 00:04:22,630
use graph theory to reveal the hidden

104
00:04:19,180 --> 00:04:25,479
and often unintended relationship with

105
00:04:22,630 --> 00:04:27,280
in Active Directory and both read the

106
00:04:25,479 --> 00:04:30,010
defenders an attacker can

107
00:04:27,280 --> 00:04:32,080
use those attack paths defenders to

108
00:04:30,010 --> 00:04:34,930
break them and of course attackers to

109
00:04:32,080 --> 00:04:36,609
exploit them here's a very quick history

110
00:04:34,930 --> 00:04:40,750
about blood down it was released at

111
00:04:36,610 --> 00:04:43,090
DEFCON 24 in a cult called a 6-degree of

112
00:04:40,750 --> 00:04:44,830
domain and men here's the link to the

113
00:04:43,090 --> 00:04:46,570
presentation if you haven't seen it you

114
00:04:44,830 --> 00:04:49,419
will actually see row on unlock his

115
00:04:46,570 --> 00:04:52,389
password manager and put the repo live I

116
00:04:49,419 --> 00:04:55,630
was personally introduced to blood down

117
00:04:52,389 --> 00:05:02,020
a year after that at blackhat 2017 in a

118
00:04:55,630 --> 00:05:04,150
talk called the Industrial Revolution of

119
00:05:02,020 --> 00:05:05,680
lateral movement from Tom mehar and tell

120
00:05:04,150 --> 00:05:09,280
Barry where they explain how you can

121
00:05:05,680 --> 00:05:10,870
export adjacent Pat and then use some

122
00:05:09,280 --> 00:05:13,570
powershell script in order to get the

123
00:05:10,870 --> 00:05:14,340
credential automatically last year at

124
00:05:13,570 --> 00:05:17,050
blackhat

125
00:05:14,340 --> 00:05:19,780
2018 and a team released bloodhound

126
00:05:17,050 --> 00:05:20,590
200 at Arsenal and it is developed by

127
00:05:19,780 --> 00:05:23,830
Waldo

128
00:05:20,590 --> 00:05:26,919
captain Jesus and arm joy who are in

129
00:05:23,830 --> 00:05:28,240
this room and they've all worked for

130
00:05:26,919 --> 00:05:32,530
Spectre ups and pre sure your family

131
00:05:28,240 --> 00:05:34,270
with those names so what does blood and

132
00:05:32,530 --> 00:05:36,070
do exactly well it does three very

133
00:05:34,270 --> 00:05:38,260
simple things it queries Active

134
00:05:36,070 --> 00:05:40,450
Directory and imports information in

135
00:05:38,260 --> 00:05:42,430
neo4j back-end database and then it

136
00:05:40,450 --> 00:05:45,430
shows relationship between objects using

137
00:05:42,430 --> 00:05:47,919
a GUI so why should you use bloodhound

138
00:05:45,430 --> 00:05:49,930
well for Red Team you can use the UI to

139
00:05:47,919 --> 00:05:51,820
build attack paths offline and this will

140
00:05:49,930 --> 00:05:54,700
reduce a lot of noise on the network

141
00:05:51,820 --> 00:05:56,680
when you're querying the network every

142
00:05:54,700 --> 00:05:58,419
time you jump on a box if you need to

143
00:05:56,680 --> 00:06:00,100
rescan the network you're gonna do that

144
00:05:58,419 --> 00:06:01,870
a lot of time especially in large

145
00:06:00,100 --> 00:06:04,000
network and when you're running blood

146
00:06:01,870 --> 00:06:06,669
down you'll touch the machine two times

147
00:06:04,000 --> 00:06:10,090
if I'm not wrong for blue teamers well

148
00:06:06,669 --> 00:06:13,630
we can use the query that that I'll show

149
00:06:10,090 --> 00:06:16,690
you to find the paths that give attack

150
00:06:13,630 --> 00:06:18,700
paths or or route to high-value targets

151
00:06:16,690 --> 00:06:21,400
to the most people in your organization

152
00:06:18,700 --> 00:06:23,500
and then you can break those paths and

153
00:06:21,400 --> 00:06:25,690
you can actually test the effect of a

154
00:06:23,500 --> 00:06:28,060
remediation directly in the graph before

155
00:06:25,690 --> 00:06:29,830
you go out and tell your sis and min to

156
00:06:28,060 --> 00:06:31,389
do any modification and that's what we

157
00:06:29,830 --> 00:06:34,628
going to talk about

158
00:06:31,389 --> 00:06:38,379
so now let's go over the basic or what I

159
00:06:34,629 --> 00:06:40,659
like to call the first steps so first of

160
00:06:38,379 --> 00:06:42,580
all you'll need n gesture there's three

161
00:06:40,659 --> 00:06:44,949
main gesture for bloodhound there's char

162
00:06:42,580 --> 00:06:46,628
pound which is a C sharp executable

163
00:06:44,949 --> 00:06:48,729
there's invoke bloodhound that is a

164
00:06:46,629 --> 00:06:51,210
powershell downloads char pound

165
00:06:48,729 --> 00:06:53,318
reflectively and there is peyten

166
00:06:51,210 --> 00:06:55,030
bloodhound Python which is obviously a

167
00:06:53,319 --> 00:06:56,979
Python script that you can run also on

168
00:06:55,030 --> 00:06:58,719
Linux so if you land on a Linux box you

169
00:06:56,979 --> 00:07:01,719
can get all the goodness from blow down

170
00:06:58,719 --> 00:07:03,310
from there on the right side of the

171
00:07:01,719 --> 00:07:07,090
screen you can see a few collection

172
00:07:03,310 --> 00:07:10,120
methods that you might find useful or -

173
00:07:07,090 --> 00:07:12,429
C for short all but be careful that all

174
00:07:10,120 --> 00:07:14,819
does not include logged on because in

175
00:07:12,430 --> 00:07:18,490
Windows 10th 10th anniversary and

176
00:07:14,819 --> 00:07:20,199
Windows 2016 server you need to be local

177
00:07:18,490 --> 00:07:24,219
admin in order to Lea's decesion

178
00:07:20,199 --> 00:07:26,050
then there's also the DC only setting

179
00:07:24,219 --> 00:07:28,210
that will do a lot less noise on the

180
00:07:26,050 --> 00:07:29,620
network as defender we don't really care

181
00:07:28,210 --> 00:07:31,719
about the noise but it's still good to

182
00:07:29,620 --> 00:07:33,699
run it in order to see if your detection

183
00:07:31,719 --> 00:07:37,210
will catch it if it does Loess knows

184
00:07:33,699 --> 00:07:38,979
then there's the max loop time that goes

185
00:07:37,210 --> 00:07:41,859
and to end with the session loop by

186
00:07:38,979 --> 00:07:43,719
default blood and we'll run session 4

187
00:07:41,860 --> 00:07:45,969
well try to get the session for 2 hours

188
00:07:43,719 --> 00:07:48,069
as defender you probably want to run it

189
00:07:45,969 --> 00:07:50,259
a lot longer because if you run it 2

190
00:07:48,069 --> 00:07:52,330
hours during the day you'll catch all

191
00:07:50,259 --> 00:07:55,029
your user activity but a lot of admin

192
00:07:52,330 --> 00:07:58,000
tasks are run only at night so you can

193
00:07:55,029 --> 00:08:00,250
run it for 24 hours 48 hours and you

194
00:07:58,000 --> 00:08:01,960
should also shift when you're running it

195
00:08:00,250 --> 00:08:04,599
from time to time don't always write

196
00:08:01,960 --> 00:08:05,979
monday tuesday run it also sometimes on

197
00:08:04,599 --> 00:08:07,930
the weekend because you might have some

198
00:08:05,979 --> 00:08:08,789
administrative tasks that runs only on

199
00:08:07,930 --> 00:08:11,469
weekends

200
00:08:08,789 --> 00:08:14,349
then there's search for rest if you have

201
00:08:11,469 --> 00:08:16,089
multiple forests and sharpen - a chore

202
00:08:14,349 --> 00:08:18,128
you can go directly in the code to get

203
00:08:16,089 --> 00:08:19,750
all of the other switches it has

204
00:08:18,129 --> 00:08:24,069
happened in the past that the elf file

205
00:08:19,750 --> 00:08:27,339
was not exactly as the new comments just

206
00:08:24,069 --> 00:08:30,639
saying now it's time to go through a

207
00:08:27,339 --> 00:08:32,979
little demo or a tour of the GUI and

208
00:08:30,639 --> 00:08:34,630
please Andy and Rohan don't slow down

209
00:08:32,979 --> 00:08:38,310
the group if you have questions wait

210
00:08:34,630 --> 00:08:38,309
until the end will can do a one-on-one

211
00:08:42,789 --> 00:08:47,980
just mirrors it's gonna be whoops wrong

212
00:08:46,100 --> 00:08:50,569
screen okay

213
00:08:47,980 --> 00:08:52,819
so this is the screen that you see when

214
00:08:50,569 --> 00:08:54,589
you log in blood down so on the right

215
00:08:52,819 --> 00:08:56,479
side you have the domain admin groups

216
00:08:54,589 --> 00:08:59,180
and on the left you have all of your

217
00:08:56,480 --> 00:09:01,189
admins if you click here you get your

218
00:08:59,180 --> 00:09:04,040
database information some note

219
00:09:01,189 --> 00:09:06,439
information and some queries most people

220
00:09:04,040 --> 00:09:08,269
usually run the second query here find

221
00:09:06,439 --> 00:09:10,399
shortest path to domain admin so that's

222
00:09:08,269 --> 00:09:12,290
what we're gonna do right now I'm gonna

223
00:09:10,399 --> 00:09:13,639
quit our database and while the little

224
00:09:12,290 --> 00:09:16,069
dougie does is sting we're gonna

225
00:09:13,639 --> 00:09:18,259
continue our tour down below here are

226
00:09:16,069 --> 00:09:21,589
the custom queries you can click on the

227
00:09:18,259 --> 00:09:23,569
little pen here in order to edit the

228
00:09:21,589 --> 00:09:25,069
query I will give you a link with all of

229
00:09:23,569 --> 00:09:28,639
the query that you see down there that

230
00:09:25,069 --> 00:09:32,660
you can just paste there and here it is

231
00:09:28,639 --> 00:09:33,949
so from here you can select any objects

232
00:09:32,660 --> 00:09:35,839
it's going to bring the information

233
00:09:33,949 --> 00:09:37,189
about that node if you're right click

234
00:09:35,839 --> 00:09:40,850
you have a few things that you can do

235
00:09:37,189 --> 00:09:42,559
mark has owned or edit the node here

236
00:09:40,850 --> 00:09:45,150
you'll see all the information about the

237
00:09:42,559 --> 00:09:47,259
node you can also add some properties

238
00:09:45,150 --> 00:09:50,059
[Music]

239
00:09:47,259 --> 00:09:51,889
another interesting thing you can set as

240
00:09:50,059 --> 00:09:55,579
a starting node and then you can use a

241
00:09:51,889 --> 00:09:57,949
little highway here in order to do just

242
00:09:55,579 --> 00:10:00,199
like in Google Maps so from this user do

243
00:09:57,949 --> 00:10:03,889
we have a path to domain admins and its

244
00:10:00,199 --> 00:10:07,040
autocomplete it's great and then you see

245
00:10:03,889 --> 00:10:12,410
the path from that user here you can

246
00:10:07,040 --> 00:10:14,269
just come back to the previous view so

247
00:10:12,410 --> 00:10:16,009
let's continue the tour so here you can

248
00:10:14,269 --> 00:10:20,660
export the graph as we talked about in

249
00:10:16,009 --> 00:10:22,100
JSON format or in an image you select

250
00:10:20,660 --> 00:10:23,930
took a few minutes but might add about

251
00:10:22,100 --> 00:10:25,699
database is very small if you have a

252
00:10:23,930 --> 00:10:27,679
very large database it can take a few

253
00:10:25,699 --> 00:10:29,209
hours to generate that graph so you

254
00:10:27,679 --> 00:10:30,679
don't want to generate the graph every

255
00:10:29,209 --> 00:10:33,050
time you want to show it to someone in

256
00:10:30,679 --> 00:10:36,350
your organization here you can import

257
00:10:33,050 --> 00:10:38,779
your graph change the layout upload data

258
00:10:36,350 --> 00:10:40,699
and here settings there's a few

259
00:10:38,779 --> 00:10:42,279
interesting thing query debug mode very

260
00:10:40,699 --> 00:10:45,170
important for us when you want to learn

261
00:10:42,279 --> 00:10:47,809
cipher your going to show you the query

262
00:10:45,170 --> 00:10:50,179
that is run every time in the bar here

263
00:10:47,809 --> 00:10:51,980
so you can cut and paste and probably

264
00:10:50,179 --> 00:10:53,870
the most important part of bloodhound

265
00:10:51,980 --> 00:10:56,690
it's the dark team or the

266
00:10:53,870 --> 00:10:58,520
arc mode by the way every time I say

267
00:10:56,690 --> 00:11:01,970
dark mode in its presentation there's a

268
00:10:58,520 --> 00:11:03,470
for ferry that is born why ferry because

269
00:11:01,970 --> 00:11:09,260
I have two daughters and they love

270
00:11:03,470 --> 00:11:11,270
ferries okay some let's let's go over

271
00:11:09,260 --> 00:11:13,790
some things that are maybe less known in

272
00:11:11,270 --> 00:11:15,890
blood down first of all when you have an

273
00:11:13,790 --> 00:11:17,329
edge like this you can right click get

274
00:11:15,890 --> 00:11:19,910
some help so if you don't know how to

275
00:11:17,330 --> 00:11:21,650
abuse an execute D comlink you can go

276
00:11:19,910 --> 00:11:24,140
here in abuse information and you're

277
00:11:21,650 --> 00:11:26,209
gonna see actually what can be how you

278
00:11:24,140 --> 00:11:28,640
can leverage that some object

279
00:11:26,210 --> 00:11:32,870
configuration and also some reference

280
00:11:28,640 --> 00:11:36,710
about this attack you can use the

281
00:11:32,870 --> 00:11:38,750
control key in order to toggle on or off

282
00:11:36,710 --> 00:11:41,089
the label so depending with who you're

283
00:11:38,750 --> 00:11:42,920
sharing your graph or I'll busy the

284
00:11:41,089 --> 00:11:47,510
graph is you might or not want to use

285
00:11:42,920 --> 00:11:50,779
that there is the command control I that

286
00:11:47,510 --> 00:11:52,220
will bring the console so if there's

287
00:11:50,779 --> 00:11:53,930
anything that the console want to tell

288
00:11:52,220 --> 00:11:56,230
you or the the backend database that's

289
00:11:53,930 --> 00:12:01,219
where you're gonna actually see things

290
00:11:56,230 --> 00:12:03,350
and finally yeah here also you have here

291
00:12:01,220 --> 00:12:05,959
you see they give user a little less

292
00:12:03,350 --> 00:12:09,080
known you can also search for GPO using

293
00:12:05,959 --> 00:12:12,829
GPO Colin you can search for oh you and

294
00:12:09,080 --> 00:12:13,390
you can also search for domain that were

295
00:12:12,830 --> 00:12:19,110
queried

296
00:12:13,390 --> 00:12:19,110
[Music]

297
00:12:20,030 --> 00:12:24,579
I told you to wait until the end guys

298
00:12:25,000 --> 00:12:41,810
this is not nice where was I we're sorry

299
00:12:39,100 --> 00:12:44,450
yeah it's over the gpo dun Inanna oh

300
00:12:41,810 --> 00:12:46,430
yeah there's also another we're a key

301
00:12:44,450 --> 00:12:49,220
stroke that you can use it's the

302
00:12:46,430 --> 00:12:51,500
spacebar there so it brings the

303
00:12:49,220 --> 00:12:55,580
spotlight so this will show you all of

304
00:12:51,500 --> 00:12:57,290
the elements in your graph and you can

305
00:12:55,580 --> 00:12:59,210
click on any graph is going to zoom in

306
00:12:57,290 --> 00:13:03,530
and it's going to bring the note

307
00:12:59,210 --> 00:13:05,390
information another key that is not very

308
00:13:03,530 --> 00:13:07,970
well known and I think it's the last key

309
00:13:05,390 --> 00:13:11,090
that I have to show you is command R so

310
00:13:07,970 --> 00:13:14,920
that will log you out refresh log you

311
00:13:11,090 --> 00:13:26,390
back in and then you will have your new

312
00:13:14,920 --> 00:13:32,569
interface just reloaded okay so let's

313
00:13:26,390 --> 00:13:34,520
continue so as I mentioned that's the

314
00:13:32,570 --> 00:13:38,800
first ferry of the talk just have a

315
00:13:34,520 --> 00:13:41,800
little problem with my just a second

316
00:13:38,800 --> 00:13:41,800
Jesus

317
00:13:44,240 --> 00:13:52,620
okay sorry about it so here's the first

318
00:13:51,240 --> 00:13:55,500
theory of the talk because we talked

319
00:13:52,620 --> 00:13:57,390
about the dark team now some

320
00:13:55,500 --> 00:13:59,910
undocumented feature I said they were

321
00:13:57,390 --> 00:14:04,620
undocumented so I've documented them so

322
00:13:59,910 --> 00:14:07,439
now they are a half documented there so

323
00:14:04,620 --> 00:14:09,630
the graph database so behind blood and

324
00:14:07,440 --> 00:14:11,760
there's a new forty database I as I

325
00:14:09,630 --> 00:14:13,470
mentioned you can delete a download the

326
00:14:11,760 --> 00:14:14,910
community edition at that link and

327
00:14:13,470 --> 00:14:18,120
you'll start that just like you would

328
00:14:14,910 --> 00:14:21,510
start any other Linux service using the

329
00:14:18,120 --> 00:14:25,740
Start comment then you can login to the

330
00:14:21,510 --> 00:14:29,790
web console using port 74 74 and some of

331
00:14:25,740 --> 00:14:32,070
you might wonder why use the web console

332
00:14:29,790 --> 00:14:39,180
when you have a GUI well there's a few

333
00:14:32,070 --> 00:14:43,440
reasons for that dude I told you to wait

334
00:14:39,180 --> 00:14:49,609
until the end where's the where's the

335
00:14:43,440 --> 00:14:49,610
key Jesus Christ

336
00:15:02,380 --> 00:15:08,000
thank you thank you thank you thank you

337
00:15:04,670 --> 00:15:10,370
so yeah graph database so one of the

338
00:15:08,000 --> 00:15:11,750
reason why to use the web UI instead of

339
00:15:10,370 --> 00:15:13,430
their console is that if you make a

340
00:15:11,750 --> 00:15:16,010
mistake you'll know right away instead

341
00:15:13,430 --> 00:15:18,020
of the little doggie running forever so

342
00:15:16,010 --> 00:15:20,750
here for example I put the equal sign

343
00:15:18,020 --> 00:15:24,230
instead of a semicolon and the interface

344
00:15:20,750 --> 00:15:28,730
is telling me when I fix my query I get

345
00:15:24,230 --> 00:15:30,560
the actual result you can also return

346
00:15:28,730 --> 00:15:33,770
properties where that you cannot do in

347
00:15:30,560 --> 00:15:36,020
the graph user in the GUI in the blood

348
00:15:33,770 --> 00:15:37,850
and GUI and also while the web console

349
00:15:36,020 --> 00:15:40,420
as you can see as a dart team which

350
00:15:37,850 --> 00:15:43,550
bring us our second fairy of the talk

351
00:15:40,420 --> 00:15:46,040
now that we've done the tour of the tool

352
00:15:43,550 --> 00:15:50,030
we're gonna go into cipher or what I

353
00:15:46,040 --> 00:15:52,099
like to call learning to run so here's

354
00:15:50,030 --> 00:15:54,290
the basic about cipher first of all you

355
00:15:52,100 --> 00:15:56,840
will need a match statement to say what

356
00:15:54,290 --> 00:15:59,660
you want to actually get from from your

357
00:15:56,840 --> 00:16:02,450
query you'll need some objects so here

358
00:15:59,660 --> 00:16:04,640
we're defining a variable you as a user

359
00:16:02,450 --> 00:16:07,430
and if you want to access any properties

360
00:16:04,640 --> 00:16:09,620
of that object you can use user dot name

361
00:16:07,430 --> 00:16:11,750
you'll also need some relationship which

362
00:16:09,620 --> 00:16:13,310
is - - in a pointing arrow in the

363
00:16:11,750 --> 00:16:15,290
direction that you want and if you want

364
00:16:13,310 --> 00:16:17,420
to specify the type of relationship you

365
00:16:15,290 --> 00:16:19,670
can put it in bracket then you'll

366
00:16:17,420 --> 00:16:22,099
probably want to do some point finding

367
00:16:19,670 --> 00:16:25,010
so here you can use shortest path or all

368
00:16:22,100 --> 00:16:27,590
shortest paths and specify the number of

369
00:16:25,010 --> 00:16:34,420
apps between two objects then you can

370
00:16:27,590 --> 00:16:38,420
use where to make a filtering thank you

371
00:16:34,420 --> 00:16:41,300
and then you can use return to return

372
00:16:38,420 --> 00:16:42,770
information that you want to see if you

373
00:16:41,300 --> 00:16:47,660
want to return a path or if you want to

374
00:16:42,770 --> 00:16:50,660
return some properties it's a bit too

375
00:16:47,660 --> 00:16:54,380
hot if you bring me a cold one I'll

376
00:16:50,660 --> 00:16:57,199
drink it filtering there's two ways to

377
00:16:54,380 --> 00:16:58,760
do filter you can use explicit method or

378
00:16:57,200 --> 00:17:01,190
you can use the where clause so here's

379
00:16:58,760 --> 00:17:02,780
an example of the explicit one so here

380
00:17:01,190 --> 00:17:04,970
we're looking for a group name that is

381
00:17:02,780 --> 00:17:07,099
exactly domain user at tests lab dot

382
00:17:04,970 --> 00:17:08,040
local and the second group that we

383
00:17:07,099 --> 00:17:10,198
define

384
00:17:08,040 --> 00:17:11,730
M which is domain admin at this lab

385
00:17:10,199 --> 00:17:13,380
Ludlow goal and we want to find the

386
00:17:11,730 --> 00:17:15,589
shortest path between the first group

387
00:17:13,380 --> 00:17:18,240
and the second group and return the path

388
00:17:15,589 --> 00:17:20,639
we can do that using a where clause and

389
00:17:18,240 --> 00:17:24,329
here it oh you do that so shortest path

390
00:17:20,640 --> 00:17:26,820
and group and group where n name starts

391
00:17:24,329 --> 00:17:30,720
with domain user and M name contains

392
00:17:26,819 --> 00:17:33,750
domain a DM when we run those two query

393
00:17:30,720 --> 00:17:35,370
or here a query side-by-side sorry when

394
00:17:33,750 --> 00:17:37,380
you run those query not surprisingly

395
00:17:35,370 --> 00:17:39,120
they give the same result so you might

396
00:17:37,380 --> 00:17:41,580
wonder why use one instead of the other

397
00:17:39,120 --> 00:17:44,070
well first of all there's the speed it

398
00:17:41,580 --> 00:17:46,290
is a lot faster to use explicit versus a

399
00:17:44,070 --> 00:17:48,240
where Clause bear in mind again my

400
00:17:46,290 --> 00:17:50,159
database is very small so the speed a

401
00:17:48,240 --> 00:17:52,290
difference is not huge but in a larger

402
00:17:50,160 --> 00:17:55,710
database you might see better result or

403
00:17:52,290 --> 00:17:57,240
bigger difference it's better to use

404
00:17:55,710 --> 00:17:58,530
where clause if you have multiple domain

405
00:17:57,240 --> 00:18:00,960
though because you don't want to rewrite

406
00:17:58,530 --> 00:18:02,730
all your query or if you're a consultant

407
00:18:00,960 --> 00:18:06,110
you want to rewrite your query for every

408
00:18:02,730 --> 00:18:09,360
domain or engagement that you're doing

409
00:18:06,110 --> 00:18:11,939
using the web GUI the the web console

410
00:18:09,360 --> 00:18:14,490
sorry will also show you how you can

411
00:18:11,940 --> 00:18:15,930
improve your cipher query and when you

412
00:18:14,490 --> 00:18:18,900
can improve it you'll see those little

413
00:18:15,930 --> 00:18:20,280
exclamation box beside the line when you

414
00:18:18,900 --> 00:18:23,130
click on them you'll get the information

415
00:18:20,280 --> 00:18:26,280
and then you can actually change your

416
00:18:23,130 --> 00:18:28,410
your query so here you'll see the fixed

417
00:18:26,280 --> 00:18:31,050
query and the little explanation points

418
00:18:28,410 --> 00:18:33,120
are I've disappeared here are the two

419
00:18:31,050 --> 00:18:34,680
query side-by-side so if you're looking

420
00:18:33,120 --> 00:18:36,600
at those query you'll see that the

421
00:18:34,680 --> 00:18:38,580
difference between them is that actually

422
00:18:36,600 --> 00:18:40,530
in the first one we are declaring our

423
00:18:38,580 --> 00:18:42,600
variable and then doing the shortest

424
00:18:40,530 --> 00:18:43,830
path whereas in the second one we're

425
00:18:42,600 --> 00:18:45,719
doing a shortest path and we're

426
00:18:43,830 --> 00:18:47,850
declaring our variable right inside that

427
00:18:45,720 --> 00:18:50,570
function which is now the preferred way

428
00:18:47,850 --> 00:18:53,090
for cipher to build your query

429
00:18:50,570 --> 00:18:56,210
it's now time for pro tip number one of

430
00:18:53,090 --> 00:18:58,790
the talk explain and profile if you want

431
00:18:56,210 --> 00:19:00,260
to know how I was Tris fall though your

432
00:18:58,790 --> 00:19:02,360
query are going to be against your

433
00:19:00,260 --> 00:19:05,000
database you can open the word explain

434
00:19:02,360 --> 00:19:06,919
that will do the execution plan but will

435
00:19:05,000 --> 00:19:09,140
not run the statement or the word

436
00:19:06,920 --> 00:19:10,940
profile which actually will run the

437
00:19:09,140 --> 00:19:14,720
statement and you'll see exactly which

438
00:19:10,940 --> 00:19:17,270
operator is taking most of the time so

439
00:19:14,720 --> 00:19:20,180
here is a just a query that touch every

440
00:19:17,270 --> 00:19:22,850
single objects in your database just to

441
00:19:20,180 --> 00:19:25,010
show you a little bit how it works so

442
00:19:22,850 --> 00:19:27,320
here we we do explain match and the same

443
00:19:25,010 --> 00:19:30,379
query that we had before and you can see

444
00:19:27,320 --> 00:19:34,879
up here that it says that it's going to

445
00:19:30,380 --> 00:19:37,640
touch 1600 objects when we run profile

446
00:19:34,880 --> 00:19:39,260
we have similar graph but you'll see

447
00:19:37,640 --> 00:19:44,960
here that the number that actually touch

448
00:19:39,260 --> 00:19:47,900
is over 16,000 objects here are some

449
00:19:44,960 --> 00:19:50,360
useful query that I like to run and here

450
00:19:47,900 --> 00:19:53,120
is the link to the github repo that I've

451
00:19:50,360 --> 00:19:54,590
talked about and the last slide of the

452
00:19:53,120 --> 00:19:57,110
deck is a link where you can download

453
00:19:54,590 --> 00:20:00,260
the whole deck so you don't need really

454
00:19:57,110 --> 00:20:01,550
to take pictures of everything so what I

455
00:20:00,260 --> 00:20:03,980
like to do when I go into a new

456
00:20:01,550 --> 00:20:05,899
organization is run some information

457
00:20:03,980 --> 00:20:08,600
about domain user I like to see where

458
00:20:05,900 --> 00:20:11,600
domain user have local admin rights if

459
00:20:08,600 --> 00:20:13,939
there is any path from domain user to

460
00:20:11,600 --> 00:20:17,149
high value target

461
00:20:13,940 --> 00:20:19,040
if domain user can RDP to any system and

462
00:20:17,150 --> 00:20:22,130
then I want to check all the other

463
00:20:19,040 --> 00:20:24,680
rights that actually domain user could

464
00:20:22,130 --> 00:20:26,720
have after that it's interesting to look

465
00:20:24,680 --> 00:20:28,880
at Kerberos thing for those who have no

466
00:20:26,720 --> 00:20:30,290
idea what Kerberos thing is it's a it's

467
00:20:28,880 --> 00:20:33,530
an attack where you request a weak

468
00:20:30,290 --> 00:20:36,080
cipher of a password in rc4 and you

469
00:20:33,530 --> 00:20:38,030
crack it offline if you want more

470
00:20:36,080 --> 00:20:40,070
information you can go to ad Security

471
00:20:38,030 --> 00:20:41,750
org by Sean McColl you'll get all the

472
00:20:40,070 --> 00:20:43,490
information that you need so you can

473
00:20:41,750 --> 00:20:46,790
easily target only the high value

474
00:20:43,490 --> 00:20:49,100
account first or list all of the the

475
00:20:46,790 --> 00:20:51,170
accounts and those queries as I said are

476
00:20:49,100 --> 00:20:53,360
there and I also brought back the top

477
00:20:51,170 --> 00:20:54,860
ten that were in version one because I

478
00:20:53,360 --> 00:20:56,990
think that as a defender they are a

479
00:20:54,860 --> 00:21:00,000
great place to start hunting in your

480
00:20:56,990 --> 00:21:02,880
environment and exploring what you have

481
00:21:00,000 --> 00:21:04,680
when you get good with cypher you can do

482
00:21:02,880 --> 00:21:07,170
query they look like this

483
00:21:04,680 --> 00:21:10,650
those two query were actually shared by

484
00:21:07,170 --> 00:21:12,390
a nd or Waldo in the bloodhound slack

485
00:21:10,650 --> 00:21:14,550
Channel but just to show you how it can

486
00:21:12,390 --> 00:21:16,620
become complex so here you have optional

487
00:21:14,550 --> 00:21:19,020
match we're collecting variable we're

488
00:21:16,620 --> 00:21:22,260
adding them and then we're reading from

489
00:21:19,020 --> 00:21:24,180
them using unwind we count things we do

490
00:21:22,260 --> 00:21:25,920
this thing count and in the second one

491
00:21:24,180 --> 00:21:27,690
we're actually extracting properties

492
00:21:25,920 --> 00:21:30,000
we're furthering out of them we can do

493
00:21:27,690 --> 00:21:32,040
also some mats you can see your average

494
00:21:30,000 --> 00:21:34,650
and length so it can get pretty complex

495
00:21:32,040 --> 00:21:37,889
if you want to learn more about cipher

496
00:21:34,650 --> 00:21:44,250
there's the neo4j cheat sheet that you

497
00:21:37,890 --> 00:21:46,260
can go and use so now that we know about

498
00:21:44,250 --> 00:21:54,240
cipher we're gonna go and destroy some

499
00:21:46,260 --> 00:21:56,070
paths so I'm just going to explain what

500
00:21:54,240 --> 00:21:58,290
we're trying to do exactly so we're

501
00:21:56,070 --> 00:22:00,540
trying to find the busiest path that

502
00:21:58,290 --> 00:22:02,879
will give most of our user a path to a

503
00:22:00,540 --> 00:22:05,190
high value target then we're going to

504
00:22:02,880 --> 00:22:06,990
test the effect of the remediation that

505
00:22:05,190 --> 00:22:09,390
we want to send to our domain admins

506
00:22:06,990 --> 00:22:12,000
just to make sure that it actually kills

507
00:22:09,390 --> 00:22:14,370
the power destroy the path for real this

508
00:22:12,000 --> 00:22:16,980
way our system in won't work for nothing

509
00:22:14,370 --> 00:22:20,639
and we won't have paths when they're

510
00:22:16,980 --> 00:22:21,990
done fixing the problem so we're going

511
00:22:20,640 --> 00:22:24,870
to try that in a control environment

512
00:22:21,990 --> 00:22:26,550
first so first of all we're going to

513
00:22:24,870 --> 00:22:28,889
create a problem so here's how you would

514
00:22:26,550 --> 00:22:30,928
create a link between two object you use

515
00:22:28,890 --> 00:22:35,040
the merge command between domain user

516
00:22:30,929 --> 00:22:38,550
and a computer that is named 673 and

517
00:22:35,040 --> 00:22:40,559
then you give admin rights from the

518
00:22:38,550 --> 00:22:43,309
group to the computer when you run that

519
00:22:40,559 --> 00:22:46,500
you'll get that one relation is created

520
00:22:43,309 --> 00:22:48,059
now it's time to test your relation so

521
00:22:46,500 --> 00:22:50,760
here all you would test relationships so

522
00:22:48,059 --> 00:22:53,309
you do a match of a path between domain

523
00:22:50,760 --> 00:22:56,010
user and computer 673 and then you

524
00:22:53,309 --> 00:22:58,410
return P or your path and not

525
00:22:56,010 --> 00:23:02,460
surprisingly here is our admin path from

526
00:22:58,410 --> 00:23:05,610
a domain user to computer 673 now we

527
00:23:02,460 --> 00:23:07,110
have two options to filter or to remove

528
00:23:05,610 --> 00:23:09,389
the link first of all we can filter it

529
00:23:07,110 --> 00:23:13,169
out so this is useful when you have only

530
00:23:09,390 --> 00:23:15,330
one link one edge of that type

531
00:23:13,170 --> 00:23:17,520
in the whole path or you could delete

532
00:23:15,330 --> 00:23:19,230
their relationship and this is useful if

533
00:23:17,520 --> 00:23:20,940
you have more than one type of

534
00:23:19,230 --> 00:23:24,270
relationship and I'll show you example

535
00:23:20,940 --> 00:23:26,160
so now this is how you would do the

536
00:23:24,270 --> 00:23:27,690
filter out so it's the same beginning of

537
00:23:26,160 --> 00:23:30,300
the query you we're gonna match a path

538
00:23:27,690 --> 00:23:32,490
between domain user and computer 673 and

539
00:23:30,300 --> 00:23:33,480
we're gonna filter out all relation

540
00:23:32,490 --> 00:23:35,580
we're gonna look at all the

541
00:23:33,480 --> 00:23:38,160
relationships where the relationship

542
00:23:35,580 --> 00:23:40,830
name is different from admin to and then

543
00:23:38,160 --> 00:23:42,390
we're going to return that path if we

544
00:23:40,830 --> 00:23:44,580
want to delete the relationship again

545
00:23:42,390 --> 00:23:47,700
same beginning so we got to match a path

546
00:23:44,580 --> 00:23:50,000
between a domain admin and computer 673

547
00:23:47,700 --> 00:23:52,230
and then we're gonna delete the relation

548
00:23:50,000 --> 00:23:54,540
then we need to print it so we're just

549
00:23:52,230 --> 00:23:56,430
going to return the path here are the

550
00:23:54,540 --> 00:23:59,389
query side by side and again not

551
00:23:56,430 --> 00:24:07,050
surprisingly when you run that you have

552
00:23:59,390 --> 00:24:09,090
no data so it works or does it so I

553
00:24:07,050 --> 00:24:11,730
realize a few days before the

554
00:24:09,090 --> 00:24:16,350
presentation that everything I just said

555
00:24:11,730 --> 00:24:17,940
about this theory is actually wrong so

556
00:24:16,350 --> 00:24:19,050
if everything is wrong till you actually

557
00:24:17,940 --> 00:24:21,690
came here for nothing

558
00:24:19,050 --> 00:24:24,899
I will I'll take you through my thought

559
00:24:21,690 --> 00:24:28,170
process and you'll understand so let's

560
00:24:24,900 --> 00:24:29,610
test it against real data so now we want

561
00:24:28,170 --> 00:24:31,860
to find our target so we're going to do

562
00:24:29,610 --> 00:24:33,840
a shortest path between domain user and

563
00:24:31,860 --> 00:24:36,840
domain admin and we're going to return

564
00:24:33,840 --> 00:24:39,179
that path and here is our path and at

565
00:24:36,840 --> 00:24:41,699
the top here we have execute decom and

566
00:24:39,180 --> 00:24:43,170
as you can see or maybe not I don't know

567
00:24:41,700 --> 00:24:45,420
if it's big enough for you but there's

568
00:24:43,170 --> 00:24:47,130
no other execute decom and a path so

569
00:24:45,420 --> 00:24:50,460
that should be a prime candidate for

570
00:24:47,130 --> 00:24:52,530
filter out so let's go and do that so

571
00:24:50,460 --> 00:24:55,530
we're going to do a match shortest path

572
00:24:52,530 --> 00:24:58,230
from domain user to domain admin where

573
00:24:55,530 --> 00:25:01,920
relationships are different from execute

574
00:24:58,230 --> 00:25:04,970
decom if this mitigation works we should

575
00:25:01,920 --> 00:25:09,150
not have a path anymore to domain admin

576
00:25:04,970 --> 00:25:11,820
what we do but now it's nine ops away so

577
00:25:09,150 --> 00:25:15,120
we didn't removing the execute decom did

578
00:25:11,820 --> 00:25:17,970
not actually fix the problem so we need

579
00:25:15,120 --> 00:25:19,889
to target another link but why is

580
00:25:17,970 --> 00:25:23,100
filtering wrong then because it clearly

581
00:25:19,890 --> 00:25:24,240
kind of worked well if you use all

582
00:25:23,100 --> 00:25:26,189
shortest paths

583
00:25:24,240 --> 00:25:26,620
instead of shortest path you'll see that

584
00:25:26,190 --> 00:25:28,809
there's a

585
00:25:26,620 --> 00:25:32,620
was actually two paths that were that

586
00:25:28,809 --> 00:25:35,260
had six ops but with the interface only

587
00:25:32,620 --> 00:25:39,908
showed one so here down here you have

588
00:25:35,260 --> 00:25:41,860
the execute the comm that we that we

589
00:25:39,909 --> 00:25:44,260
filter out but actually there was

590
00:25:41,860 --> 00:25:46,539
another execute decom in the other

591
00:25:44,260 --> 00:25:49,029
shortest path that was also filtered out

592
00:25:46,539 --> 00:25:50,470
and this is something that I realized

593
00:25:49,029 --> 00:25:54,549
when I was answering a question to

594
00:25:50,470 --> 00:25:55,929
someone on the Bloodhound channel he was

595
00:25:54,549 --> 00:25:58,059
saying how can I filter out a

596
00:25:55,929 --> 00:25:59,860
relationship between two objects and

597
00:25:58,059 --> 00:26:03,549
someone said just going to GUI and

598
00:25:59,860 --> 00:26:05,260
uncheck the the filter that you don't

599
00:26:03,549 --> 00:26:07,299
want and I say no this is wrong because

600
00:26:05,260 --> 00:26:09,279
it's gonna filter that type of

601
00:26:07,299 --> 00:26:11,770
relationship everywhere in your database

602
00:26:09,279 --> 00:26:13,690
so it's wrong and I was very proud of my

603
00:26:11,770 --> 00:26:16,059
answer and then the next morning I said

604
00:26:13,690 --> 00:26:20,470
oh this is exactly what I'm doing

605
00:26:16,059 --> 00:26:22,299
but with cypher so that's when I

606
00:26:20,470 --> 00:26:23,320
realized that I was actually wrong so

607
00:26:22,299 --> 00:26:26,230
this is not a good method

608
00:26:23,320 --> 00:26:29,590
don't use filtering it was a nice it was

609
00:26:26,230 --> 00:26:33,370
very nice in theory but don't use it so

610
00:26:29,590 --> 00:26:36,340
what about deleting a relation because I

611
00:26:33,370 --> 00:26:37,658
said everything was wrong right so let's

612
00:26:36,340 --> 00:26:40,510
go again to our shortest path from

613
00:26:37,659 --> 00:26:43,600
domain user to domain admin and now we

614
00:26:40,510 --> 00:26:48,429
have the label and here is the execute

615
00:26:43,600 --> 00:26:51,279
decom is between the group IT 45 74 and

616
00:26:48,429 --> 00:26:52,899
computer 6 5 - so let's start get that

617
00:26:51,279 --> 00:26:56,140
relationship and let's do it

618
00:26:52,899 --> 00:27:02,260
so we gonna match a path between IT

619
00:26:56,140 --> 00:27:04,630
group 45 74 and a computer named 6 5 -

620
00:27:02,260 --> 00:27:06,399
and we gotta delete our relationship who

621
00:27:04,630 --> 00:27:09,460
you are as you can see in the little

622
00:27:06,399 --> 00:27:16,029
brackets there's our and then you get

623
00:27:09,460 --> 00:27:18,850
this and then I was like this because

624
00:27:16,029 --> 00:27:22,029
this was 36 hour before the presentation

625
00:27:18,850 --> 00:27:24,789
and I was like oh I'm gonna talk in

626
00:27:22,029 --> 00:27:30,580
front of a lot of people and it doesn't

627
00:27:24,789 --> 00:27:34,240
work fortunately enough the solution was

628
00:27:30,580 --> 00:27:37,120
one Google search away so here is the

629
00:27:34,240 --> 00:27:40,029
correct way of deleting a relationship

630
00:27:37,120 --> 00:27:41,559
so you need to specify which

631
00:27:40,029 --> 00:27:43,479
type of relation that you want to delete

632
00:27:41,559 --> 00:27:48,460
and then you delete only one

633
00:27:43,479 --> 00:27:49,869
relationship sorry here it is so now you

634
00:27:48,460 --> 00:27:51,219
see that we want to target a

635
00:27:49,869 --> 00:27:53,590
relationship that is actually named

636
00:27:51,219 --> 00:27:55,570
execute decom and that will delete only

637
00:27:53,590 --> 00:28:00,849
one relationship and then I was

638
00:27:55,570 --> 00:28:03,849
literally like this in my hotel room so

639
00:28:00,849 --> 00:28:07,629
using that technique you'll get from the

640
00:28:03,849 --> 00:28:09,340
filtering that I had nine ops to the the

641
00:28:07,629 --> 00:28:11,468
picture on the right which is actually

642
00:28:09,340 --> 00:28:13,299
the right one and we only deleted one

643
00:28:11,469 --> 00:28:16,089
execute decom and we still have the

644
00:28:13,299 --> 00:28:18,279
other one as a shortest path so we still

645
00:28:16,089 --> 00:28:20,440
know that removing that execute decom

646
00:28:18,279 --> 00:28:22,779
did not fix the link but at least we are

647
00:28:20,440 --> 00:28:26,289
not blind to a lot of paths that might

648
00:28:22,779 --> 00:28:28,690
be shorter so here's a little bit what

649
00:28:26,289 --> 00:28:30,849
happens is that if you run the same

650
00:28:28,690 --> 00:28:34,839
query in the two different GUI

651
00:28:30,849 --> 00:28:37,779
you'll see that in neo4j console you get

652
00:28:34,839 --> 00:28:39,969
you see all the links and in blood down

653
00:28:37,779 --> 00:28:42,249
you see only one links and the reason is

654
00:28:39,969 --> 00:28:44,559
very simple and I had a chat with with

655
00:28:42,249 --> 00:28:46,479
Waldo about this is that when you query

656
00:28:44,559 --> 00:28:48,369
the database it actually returned only

657
00:28:46,479 --> 00:28:51,279
one link and it's gonna return the first

658
00:28:48,369 --> 00:28:54,509
one that it sees alphabetically so if

659
00:28:51,279 --> 00:28:57,249
the most important link starts with Izzy

660
00:28:54,509 --> 00:28:59,830
you won't see it if there's another link

661
00:28:57,249 --> 00:29:00,820
that starts with a lower letter this is

662
00:28:59,830 --> 00:29:04,509
something that you might want to

663
00:29:00,820 --> 00:29:06,189
consider also in the web console for

664
00:29:04,509 --> 00:29:09,460
some reason it also returned only one

665
00:29:06,190 --> 00:29:13,450
path but it shows them all by some black

666
00:29:09,460 --> 00:29:15,999
voodoo magic so let's recap a little bit

667
00:29:13,450 --> 00:29:18,070
what happened first of all a graph is

668
00:29:15,999 --> 00:29:20,440
like a map so it's not because you close

669
00:29:18,070 --> 00:29:21,908
one street between two city that you

670
00:29:20,440 --> 00:29:24,219
cannot reach that city there's always

671
00:29:21,909 --> 00:29:26,830
another book most of the time there's

672
00:29:24,219 --> 00:29:28,749
another way to get there bland will show

673
00:29:26,830 --> 00:29:31,418
only one relationship even if there's

674
00:29:28,749 --> 00:29:33,429
more than one and it is possible to

675
00:29:31,419 --> 00:29:38,200
delete a specific relationship if you

676
00:29:33,429 --> 00:29:41,619
give it a name also be careful when you

677
00:29:38,200 --> 00:29:43,629
start deleting relationship you need

678
00:29:41,619 --> 00:29:45,549
either to recreate them or if you delete

679
00:29:43,629 --> 00:29:47,320
too much and you will use track you can

680
00:29:45,549 --> 00:29:49,580
reinforce your old database and it's

681
00:29:47,320 --> 00:29:52,230
gonna recreate it

682
00:29:49,580 --> 00:29:54,149
so now that we got the right solution

683
00:29:52,230 --> 00:29:57,240
the right solution we can get back to

684
00:29:54,150 --> 00:29:59,880
what the presentation was about and go

685
00:29:57,240 --> 00:30:02,810
for for pro tip number two of the talk

686
00:29:59,880 --> 00:30:07,830
hey Scooby will there be another fairy

687
00:30:02,810 --> 00:30:10,470
subti ah that's lovely Casey I am I

688
00:30:07,830 --> 00:30:16,740
won't spoil it to you but there might be

689
00:30:10,470 --> 00:30:18,930
another one so here by default blood

690
00:30:16,740 --> 00:30:22,140
down only have five groups that are high

691
00:30:18,930 --> 00:30:24,270
value in your environment there might be

692
00:30:22,140 --> 00:30:26,220
more or there probably more so here's a

693
00:30:24,270 --> 00:30:28,410
query that will actually show you all

694
00:30:26,220 --> 00:30:31,140
the groups that have admin in the name

695
00:30:28,410 --> 00:30:35,970
and that have and that don't have the

696
00:30:31,140 --> 00:30:37,860
high value property set to true so in

697
00:30:35,970 --> 00:30:39,990
this fake environment here what we have

698
00:30:37,860 --> 00:30:42,719
we have Asia and men European and North

699
00:30:39,990 --> 00:30:44,910
America and men you can use this query

700
00:30:42,720 --> 00:30:47,790
here's the same beginning but then you

701
00:30:44,910 --> 00:30:49,530
can set the IDI value property of those

702
00:30:47,790 --> 00:30:53,159
group to true and now all of your

703
00:30:49,530 --> 00:30:55,590
important groups are high value so it's

704
00:30:53,160 --> 00:30:57,540
going to change from the five if default

705
00:30:55,590 --> 00:30:59,750
one to the eight groups that are

706
00:30:57,540 --> 00:31:04,080
actually important in your environment

707
00:30:59,750 --> 00:31:05,640
pro tip number three it's nice that you

708
00:31:04,080 --> 00:31:09,149
have all the groups that are high value

709
00:31:05,640 --> 00:31:11,040
but what about their members so this

710
00:31:09,150 --> 00:31:13,920
query will will query all the groups

711
00:31:11,040 --> 00:31:17,550
that have high value and then set the I

712
00:31:13,920 --> 00:31:20,820
value of all of the user to true I'm not

713
00:31:17,550 --> 00:31:24,120
sure why it's not done by default but

714
00:31:20,820 --> 00:31:25,710
it's not for those who have a good eye

715
00:31:24,120 --> 00:31:28,169
you might have noticed that the

716
00:31:25,710 --> 00:31:30,690
relationship in this one is actually

717
00:31:28,170 --> 00:31:31,500
reverse this is just again to show you

718
00:31:30,690 --> 00:31:34,290
how flexible

719
00:31:31,500 --> 00:31:35,910
Seifer can be so it's going to change

720
00:31:34,290 --> 00:31:37,980
verily it's going to change your graph

721
00:31:35,910 --> 00:31:40,620
from this this is domain admin and all

722
00:31:37,980 --> 00:31:43,080
the and ministry domain admins in a

723
00:31:40,620 --> 00:31:44,580
group to this where everyone as is

724
00:31:43,080 --> 00:31:47,220
little diamond meaning that the high

725
00:31:44,580 --> 00:31:48,300
value target when you run this in your

726
00:31:47,220 --> 00:31:50,550
environment what it's going to look like

727
00:31:48,300 --> 00:31:52,530
if you run they're all shortest paths to

728
00:31:50,550 --> 00:31:55,169
high value targets it's going to get

729
00:31:52,530 --> 00:31:56,430
from this originally to this so you can

730
00:31:55,170 --> 00:31:59,160
see that there's actually a lot more

731
00:31:56,430 --> 00:32:00,420
high value targets that exist in your

732
00:31:59,160 --> 00:32:02,309
environment and what was shown

733
00:32:00,420 --> 00:32:04,710
originally

734
00:32:02,309 --> 00:32:06,210
now it's time for pro tip number four

735
00:32:04,710 --> 00:32:09,950
and I know I know

736
00:32:06,210 --> 00:32:13,229
it's not Christmas but I keep on giving

737
00:32:09,950 --> 00:32:17,729
so here is a way to improve some of your

738
00:32:13,229 --> 00:32:18,989
query and this is a tool in the in the

739
00:32:17,729 --> 00:32:20,429
shell as you can see we're going to come

740
00:32:18,989 --> 00:32:22,080
back to that tool later but it's just to

741
00:32:20,429 --> 00:32:25,289
show you exactly how long it takes to

742
00:32:22,080 --> 00:32:28,320
run every query so in the first one you

743
00:32:25,289 --> 00:32:30,779
can see that is slightly longer than the

744
00:32:28,320 --> 00:32:32,489
second one and there's a very slight

745
00:32:30,779 --> 00:32:34,289
difference and the first one you are

746
00:32:32,489 --> 00:32:37,259
returning a path and in the second one

747
00:32:34,289 --> 00:32:39,539
you are returning a property and it is a

748
00:32:37,259 --> 00:32:41,159
lot faster to return properties than it

749
00:32:39,539 --> 00:32:43,649
is to return path so if you don't need

750
00:32:41,159 --> 00:32:46,349
the full path just return the property

751
00:32:43,649 --> 00:32:48,478
that you are interested in again my

752
00:32:46,349 --> 00:32:51,450
database is small on a bigger database

753
00:32:48,479 --> 00:32:54,299
it's gonna make a bigger impact another

754
00:32:51,450 --> 00:32:56,849
pro tip to speed up the process is that

755
00:32:54,299 --> 00:32:59,039
you and is a again a very subtle

756
00:32:56,849 --> 00:33:01,468
difference between those two queries and

757
00:32:59,039 --> 00:33:03,479
it's right here and the first one we are

758
00:33:01,469 --> 00:33:05,789
defining a variable to our relationship

759
00:33:03,479 --> 00:33:07,289
whereas in the second one we do not so

760
00:33:05,789 --> 00:33:09,269
if you do not plan to do anything with

761
00:33:07,289 --> 00:33:11,789
the relationship you don't need to

762
00:33:09,269 --> 00:33:14,669
actually put a variable and I see some

763
00:33:11,789 --> 00:33:17,039
people nodding if you want to learn more

764
00:33:14,669 --> 00:33:18,779
about bloodhound and how to use it as a

765
00:33:17,039 --> 00:33:20,908
defender there was a good talk by the

766
00:33:18,779 --> 00:33:22,919
Specter up screw called operationalizing

767
00:33:20,909 --> 00:33:25,559
bloodhound attack graph for defense this

768
00:33:22,919 --> 00:33:27,359
is the link sad processor also did some

769
00:33:25,559 --> 00:33:30,389
research and the first thing he

770
00:33:27,359 --> 00:33:33,570
explained how he whitelist nodes using

771
00:33:30,389 --> 00:33:35,820
some properties and in the second link

772
00:33:33,570 --> 00:33:39,570
it's actually some cipher queries and

773
00:33:35,820 --> 00:33:41,639
cipher training specifically for blood

774
00:33:39,570 --> 00:33:43,979
down there's also obviously the

775
00:33:41,639 --> 00:33:46,830
bloodhound slack especially the cipher

776
00:33:43,979 --> 00:33:48,389
query channel whereas lots of people are

777
00:33:46,830 --> 00:33:53,668
active and will help you build your

778
00:33:48,389 --> 00:33:55,678
queries now it's time to talk about

779
00:33:53,669 --> 00:33:57,809
reporting because attackers thinks in

780
00:33:55,679 --> 00:34:02,299
graph management thinks in metrics and

781
00:33:57,809 --> 00:34:02,299
as long as this is true Ops will suffer

782
00:34:02,539 --> 00:34:06,829
thank you I want to thank a sad

783
00:34:04,729 --> 00:34:17,480
processor have put for being the

784
00:34:06,829 --> 00:34:19,219
originator of this so so you're an

785
00:34:17,480 --> 00:34:20,750
example of very basic reports that you

786
00:34:19,219 --> 00:34:22,428
could give your organization and I've

787
00:34:20,750 --> 00:34:24,799
highlighted two of the query that we're

788
00:34:22,429 --> 00:34:26,359
going to go a little bit deeper so first

789
00:34:24,799 --> 00:34:28,940
of all the percentage of user with a

790
00:34:26,359 --> 00:34:30,409
path to domain admin let's say the first

791
00:34:28,940 --> 00:34:32,779
time you run this in January you have a

792
00:34:30,409 --> 00:34:36,649
hundred percent then you manage to get

793
00:34:32,779 --> 00:34:40,489
it down to 57 and maybe to 12 percent if

794
00:34:36,649 --> 00:34:42,558
this is not graphical enough or visual

795
00:34:40,489 --> 00:34:47,859
enough sorry for your management you can

796
00:34:42,559 --> 00:34:50,240
always use gages and if this is not

797
00:34:47,859 --> 00:34:51,109
visual enough well honestly I cannot

798
00:34:50,239 --> 00:34:53,508
help you anymore

799
00:34:51,109 --> 00:34:56,719
these ones I've been made very very

800
00:34:53,509 --> 00:34:58,160
easily with Google Docs so here's the

801
00:34:56,719 --> 00:35:00,288
query that you can use to show the

802
00:34:58,160 --> 00:35:03,710
percentage of user who have a path to

803
00:35:00,289 --> 00:35:05,210
domain user so this query goes I'm going

804
00:35:03,710 --> 00:35:07,430
to try to explain it a little bit so

805
00:35:05,210 --> 00:35:09,980
you're doing an optional match where you

806
00:35:07,430 --> 00:35:12,319
are looking for users that have a path

807
00:35:09,980 --> 00:35:13,819
to domain admin then you're doing

808
00:35:12,319 --> 00:35:17,180
another match where you're looking for

809
00:35:13,819 --> 00:35:19,130
the total of user and you count them you

810
00:35:17,180 --> 00:35:20,538
come the distinct number of user you

811
00:35:19,130 --> 00:35:23,990
have and you put that in a variable that

812
00:35:20,539 --> 00:35:27,109
you call you total and then you count

813
00:35:23,990 --> 00:35:29,269
you count also the distinct user that

814
00:35:27,109 --> 00:35:31,190
has a path and then you do some maths

815
00:35:29,269 --> 00:35:33,319
writing your return function so you say

816
00:35:31,190 --> 00:35:35,720
user that has a path divided by my total

817
00:35:33,319 --> 00:35:38,390
user multiplied by 100 percent they will

818
00:35:35,720 --> 00:35:40,730
give me my percent so here you have it

819
00:35:38,390 --> 00:35:44,930
100 percent which is pretty normal

820
00:35:40,730 --> 00:35:47,000
because I've created a link for that and

821
00:35:44,930 --> 00:35:48,500
now the second query that I want to show

822
00:35:47,000 --> 00:35:50,869
and this one I'm also very proud of

823
00:35:48,500 --> 00:35:54,470
because I worked very very hard

824
00:35:50,869 --> 00:35:57,619
Waldo gave me a query that worked in

825
00:35:54,470 --> 00:36:00,078
production using s ID but it didn't work

826
00:35:57,619 --> 00:36:02,869
in my test database because there's no s

827
00:36:00,079 --> 00:36:06,259
ID in the fake database so I have to

828
00:36:02,869 --> 00:36:08,779
work kind of art to make this one so

829
00:36:06,259 --> 00:36:12,049
here I go so you do an optional match

830
00:36:08,779 --> 00:36:14,059
for computer that are not in the domain

831
00:36:12,049 --> 00:36:16,339
controller group so that will give you

832
00:36:14,059 --> 00:36:19,279
all your non domain controller

833
00:36:16,339 --> 00:36:21,619
and you can see it as non DC and then

834
00:36:19,279 --> 00:36:23,839
you're going to do a match from all of

835
00:36:21,619 --> 00:36:26,150
your computer got are not DC and you're

836
00:36:23,839 --> 00:36:29,119
going to search for all the user that

837
00:36:26,150 --> 00:36:31,759
have a session on those machine that are

838
00:36:29,119 --> 00:36:33,950
that are member of the domain and main

839
00:36:31,759 --> 00:36:35,569
groups and then you're going to return

840
00:36:33,950 --> 00:36:37,249
the all the username and you're going to

841
00:36:35,569 --> 00:36:38,569
count out to how many machines they are

842
00:36:37,249 --> 00:36:40,879
connected to when you're going to return

843
00:36:38,569 --> 00:36:43,160
that again for those who have good eyes

844
00:36:40,880 --> 00:36:46,069
you might have noticed that here we have

845
00:36:43,160 --> 00:36:48,109
double relationship again showing how

846
00:36:46,069 --> 00:36:49,549
powerful cypher can be when you start

847
00:36:48,109 --> 00:36:51,469
playing with it and understand how it

848
00:36:49,549 --> 00:36:54,410
works so this will give us something

849
00:36:51,469 --> 00:36:55,819
like this so all the user name and all

850
00:36:54,410 --> 00:36:57,859
the number the number of connection they

851
00:36:55,819 --> 00:36:59,479
have so now you know who you can target

852
00:36:57,859 --> 00:37:02,119
in your organization to give some

853
00:36:59,479 --> 00:37:04,249
training and explain how it works if you

854
00:37:02,119 --> 00:37:06,109
have more cryptic username and this

855
00:37:04,249 --> 00:37:08,058
doesn't mean anything to you there's a

856
00:37:06,109 --> 00:37:09,828
little neat trick here you'll see this

857
00:37:08,059 --> 00:37:12,109
is pretty much the same query that I've

858
00:37:09,829 --> 00:37:14,630
just shown there's a slight difference

859
00:37:12,109 --> 00:37:17,239
is that in there return function we use

860
00:37:14,630 --> 00:37:19,999
brackets and this way we can return more

861
00:37:17,239 --> 00:37:21,559
than one attributes so that will return

862
00:37:19,999 --> 00:37:23,779
something that looks like this so we

863
00:37:21,559 --> 00:37:28,670
have the username and then the display

864
00:37:23,779 --> 00:37:31,059
name from the database now again another

865
00:37:28,670 --> 00:37:34,999
way to be more visual maybe is to use

866
00:37:31,059 --> 00:37:36,529
logarithmic if view or logarithmic bars

867
00:37:34,999 --> 00:37:40,249
this is probably not the best way to

868
00:37:36,529 --> 00:37:41,450
show it but it's difficult because let's

869
00:37:40,249 --> 00:37:43,069
have like if you're looking especially

870
00:37:41,450 --> 00:37:44,779
for Kerberos things you'll have very

871
00:37:43,069 --> 00:37:47,690
large number and for the rest you should

872
00:37:44,779 --> 00:37:49,400
have a very small number but I hope I

873
00:37:47,690 --> 00:37:52,640
get some points because I've used a dark

874
00:37:49,400 --> 00:37:55,910
team how that's hurt thirty of the of

875
00:37:52,640 --> 00:37:59,598
the talk now it's time to talk about

876
00:37:55,910 --> 00:38:01,249
automation because let's be honest we

877
00:37:59,599 --> 00:38:03,499
don't like to do things again and again

878
00:38:01,249 --> 00:38:06,819
and again so here we're back in the

879
00:38:03,499 --> 00:38:09,109
shell and there's this cypher shell

880
00:38:06,819 --> 00:38:11,390
utility that is located in the bin

881
00:38:09,109 --> 00:38:13,788
directory so you can export your

882
00:38:11,390 --> 00:38:16,640
username export your password and then

883
00:38:13,789 --> 00:38:19,670
you can paste your cypher query right in

884
00:38:16,640 --> 00:38:23,170
the shell so this query for example is

885
00:38:19,670 --> 00:38:26,329
actually you're looking for a high value

886
00:38:23,170 --> 00:38:29,200
Kerberos table accounts that are member

887
00:38:26,329 --> 00:38:29,200
of high value groups

888
00:38:29,250 --> 00:38:33,510
when you run that in the shell this is

889
00:38:30,869 --> 00:38:35,790
what you get a very nice graph you can

890
00:38:33,510 --> 00:38:37,410
also pipe that into a CSV and that will

891
00:38:35,790 --> 00:38:39,150
give you something like that so I'm

892
00:38:37,410 --> 00:38:40,759
gonna ask me like the other day why q8

893
00:38:39,150 --> 00:38:45,210
it's just because it's the eighth query

894
00:38:40,760 --> 00:38:48,150
in my graph and then this you can you

895
00:38:45,210 --> 00:38:50,970
can put in a CSV and everybody can open

896
00:38:48,150 --> 00:38:54,990
a CSV even your management so you can

897
00:38:50,970 --> 00:38:56,160
easily pass them around now it's time to

898
00:38:54,990 --> 00:38:58,470
do some alerting

899
00:38:56,160 --> 00:39:01,589
so when oh yeah I forgot a little pro

900
00:38:58,470 --> 00:39:04,020
tip I'm just gonna come back as you can

901
00:39:01,590 --> 00:39:06,300
see here we need to put the query in

902
00:39:04,020 --> 00:39:08,160
single quotes so it's a good habit to

903
00:39:06,300 --> 00:39:10,290
use always double quotes when you're

904
00:39:08,160 --> 00:39:13,170
when you're building your query and use

905
00:39:10,290 --> 00:39:14,730
single quotes in the in the shell or the

906
00:39:13,170 --> 00:39:16,650
other way around you can use single

907
00:39:14,730 --> 00:39:18,540
quotes everywhere but don't mix and

908
00:39:16,650 --> 00:39:20,070
match single quotes and double quotes

909
00:39:18,540 --> 00:39:21,060
when dealing with strings because

910
00:39:20,070 --> 00:39:25,890
otherwise it's going to make your

911
00:39:21,060 --> 00:39:28,529
automation extremely difficult so

912
00:39:25,890 --> 00:39:30,480
alerting so you want to do you want to

913
00:39:28,530 --> 00:39:32,040
build your query as I use as you saw and

914
00:39:30,480 --> 00:39:32,910
then you want to keep the results from

915
00:39:32,040 --> 00:39:34,529
the previous month

916
00:39:32,910 --> 00:39:37,080
and you want to compare the result and

917
00:39:34,530 --> 00:39:38,940
if the number increase you probably want

918
00:39:37,080 --> 00:39:41,910
to generate a ticket to your sock if

919
00:39:38,940 --> 00:39:43,530
there's more kerberos table accounts in

920
00:39:41,910 --> 00:39:45,240
the high value group you want to

921
00:39:43,530 --> 00:39:48,030
investigate why you want to reach out to

922
00:39:45,240 --> 00:39:52,020
the uh the owner of those groups and see

923
00:39:48,030 --> 00:39:58,589
if it's really mandatory that those user

924
00:39:52,020 --> 00:40:02,970
are in I value groups now it's time for

925
00:39:58,589 --> 00:40:05,700
the conclusion so here are the key

926
00:40:02,970 --> 00:40:07,709
takeaways for the talk with a tool like

927
00:40:05,700 --> 00:40:11,910
blood down the offenders can start

928
00:40:07,710 --> 00:40:14,490
thinking in graft to cipher as I think

929
00:40:11,910 --> 00:40:17,279
I've demonstrated is a very flexible and

930
00:40:14,490 --> 00:40:20,250
powerful language it is also important

931
00:40:17,280 --> 00:40:22,770
to test the real impact of a remediation

932
00:40:20,250 --> 00:40:25,260
that you want to do in your in your Tet

933
00:40:22,770 --> 00:40:27,570
or in your in your database this way

934
00:40:25,260 --> 00:40:30,000
you're not going to talk with your admin

935
00:40:27,570 --> 00:40:32,339
tell them a delete this link or remove

936
00:40:30,000 --> 00:40:34,020
this group remove that person from that

937
00:40:32,339 --> 00:40:35,490
group or remove these properties and

938
00:40:34,020 --> 00:40:37,650
then you run it next month and you have

939
00:40:35,490 --> 00:40:39,000
the exact same number of user that have

940
00:40:37,650 --> 00:40:42,120
a path to domain and mem

941
00:40:39,000 --> 00:40:43,590
if you do that one time it's maybe okay

942
00:40:42,120 --> 00:40:46,529
if you do that a second time at third

943
00:40:43,590 --> 00:40:48,240
time your sysadmin will lose faith and

944
00:40:46,530 --> 00:40:50,490
blood down they'll lose faith in the

945
00:40:48,240 --> 00:40:51,450
process and more importantly they might

946
00:40:50,490 --> 00:40:55,709
lose faith in you

947
00:40:51,450 --> 00:40:58,319
so always test the effect also not all

948
00:40:55,710 --> 00:41:00,810
queries are worth automating for example

949
00:40:58,320 --> 00:41:03,750
the first query that we saw was actually

950
00:41:00,810 --> 00:41:05,580
all the domain admins in all the user in

951
00:41:03,750 --> 00:41:06,510
the domain admin groups and this is

952
00:41:05,580 --> 00:41:08,700
something that you should definitely

953
00:41:06,510 --> 00:41:11,010
monitor but you gotta run blood down

954
00:41:08,700 --> 00:41:13,080
maybe once a month once a week if you're

955
00:41:11,010 --> 00:41:15,300
lucky but you probably want to be

956
00:41:13,080 --> 00:41:16,890
informed right away in real time if

957
00:41:15,300 --> 00:41:17,340
there's a new domain admin in your

958
00:41:16,890 --> 00:41:20,009
enterprise

959
00:41:17,340 --> 00:41:22,860
so you're way better using event windows

960
00:41:20,010 --> 00:41:25,980
event ID 4728 instead of law down for

961
00:41:22,860 --> 00:41:28,680
alerting for that it's time for the ten

962
00:41:25,980 --> 00:41:30,330
cues so I want to thank derbycon for

963
00:41:28,680 --> 00:41:32,370
allowing me to be here today

964
00:41:30,330 --> 00:41:34,980
I want to thank Shawn Micallef tell

965
00:41:32,370 --> 00:41:38,040
Barry and grifter for inspiring me to

966
00:41:34,980 --> 00:41:40,110
submit talks and come here today and

967
00:41:38,040 --> 00:41:42,270
talk to you publicly and of course I

968
00:41:40,110 --> 00:41:43,770
want to thank Waldo and Captain Jesus

969
00:41:42,270 --> 00:41:45,690
for the great work they've done to the

970
00:41:43,770 --> 00:41:50,000
community all the support they're giving

971
00:41:45,690 --> 00:41:52,980
every day to everyone so yeah thank you

972
00:41:50,000 --> 00:41:55,410
this is the the link as I promised where

973
00:41:52,980 --> 00:42:01,830
you can download the the whole deck do

974
00:41:55,410 --> 00:42:05,399
we have time for question do we have

975
00:42:01,830 --> 00:42:09,290
time for questions yeah seven minutes so

976
00:42:05,400 --> 00:42:09,290
anyone has a question yes

977
00:42:11,600 --> 00:42:22,250
it's honestly too warm seems like any

978
00:42:19,350 --> 00:42:22,250
other question

979
00:42:32,450 --> 00:42:40,200
okay okay the question was do I found a

980
00:42:38,190 --> 00:42:43,620
need to add stuff in the graph using

981
00:42:40,200 --> 00:42:45,540
merge usually no usually it's you import

982
00:42:43,620 --> 00:42:47,670
the data unless you delete a

983
00:42:45,540 --> 00:42:52,950
relationship and you want to recreate it

984
00:42:47,670 --> 00:42:59,790
then you would use a merge any other

985
00:42:52,950 --> 00:43:02,069
questions yes a protip for running the

986
00:42:59,790 --> 00:43:06,029
ingest er well I would suggest that you

987
00:43:02,070 --> 00:43:08,070
run it as a normal user first just to

988
00:43:06,030 --> 00:43:10,020
get the it's easier to get the buy-in of

989
00:43:08,070 --> 00:43:12,270
your corporation if you run it as a

990
00:43:10,020 --> 00:43:14,700
normal user and once you think you've

991
00:43:12,270 --> 00:43:17,520
reached a point where you cannot improve

992
00:43:14,700 --> 00:43:19,830
anymore then you can ask to to run it as

993
00:43:17,520 --> 00:43:21,240
a local admin all machines and then it's

994
00:43:19,830 --> 00:43:35,340
going to open new doors a new

995
00:43:21,240 --> 00:43:37,770
possibility any other questions yes the

996
00:43:35,340 --> 00:43:40,170
question is when do I think a domain is

997
00:43:37,770 --> 00:43:42,180
too large for blood and Wendell I don't

998
00:43:40,170 --> 00:43:44,100
have the questions but you might ask

999
00:43:42,180 --> 00:43:48,379
these two guys right here they might be

1000
00:43:44,100 --> 00:43:48,380
able to answer yes

1001
00:43:49,920 --> 00:43:53,030
[Music]

1002
00:43:57,720 --> 00:44:00,930
[Music]

1003
00:44:03,240 --> 00:44:06,240
I'm

1004
00:44:07,920 --> 00:44:11,070
[Music]

1005
00:44:16,840 --> 00:44:21,270
one last question maybe before everybody

1006
00:44:19,030 --> 00:44:21,270
leaves

