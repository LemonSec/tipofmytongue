1
00:01:03,640 --> 00:01:25,869
oh yeah we have audio cool welcome to

2
00:01:23,140 --> 00:01:27,580
the last session all day this is called

3
00:01:25,869 --> 00:01:31,240
fishing past male protection controls

4
00:01:27,580 --> 00:01:33,100
using aster information protection so we

5
00:01:31,240 --> 00:01:38,380
will try to be short because we know you

6
00:01:33,100 --> 00:01:40,899
want a party afterwards so so do we okay

7
00:01:38,380 --> 00:01:42,580
cool so my name is Alberto I work as a

8
00:01:40,899 --> 00:01:45,789
red teamer for trusted SEC for doing

9
00:01:42,580 --> 00:01:47,920
that for the last year yeah I blog I

10
00:01:45,789 --> 00:01:48,990
tweet I hacked not necessarily in that

11
00:01:47,920 --> 00:01:51,070
order

12
00:01:48,990 --> 00:01:54,060
yeah so that's my twitter handle and

13
00:01:51,070 --> 00:01:56,710
that's my that's my blog right there

14
00:01:54,060 --> 00:01:59,440
alright my name is Hans Lakhan

15
00:01:56,710 --> 00:02:01,780
that's my bio which is a lot thicker

16
00:01:59,440 --> 00:02:04,030
than what our head but I do basically

17
00:02:01,780 --> 00:02:06,210
the same stuff just not as well as he

18
00:02:04,030 --> 00:02:06,210
does

19
00:02:06,479 --> 00:02:11,620
alright so what do we want to talk about

20
00:02:09,660 --> 00:02:14,470
after information protection in

21
00:02:11,620 --> 00:02:18,070
particular so the reason is because we

22
00:02:14,470 --> 00:02:20,500
had a really tough engagement where we

23
00:02:18,070 --> 00:02:24,820
kind of had trouble getting mails sent

24
00:02:20,500 --> 00:02:27,160
into the organization so I started to to

25
00:02:24,820 --> 00:02:29,500
try to create macros that sent data back

26
00:02:27,160 --> 00:02:30,760
to me so I can like figure out what sort

27
00:02:29,500 --> 00:02:33,850
of sandbox environment that we were

28
00:02:30,760 --> 00:02:35,739
having and in that process I started to

29
00:02:33,850 --> 00:02:37,329
think there should be a way to like do

30
00:02:35,739 --> 00:02:40,030
something that just slipped past

31
00:02:37,329 --> 00:02:41,560
everything so I ended up finding that I

32
00:02:40,030 --> 00:02:44,200
could use a sir information protection

33
00:02:41,560 --> 00:02:46,660
to encrypt files and send it away and

34
00:02:44,200 --> 00:02:48,488
bypass every sandbox every mitigation

35
00:02:46,660 --> 00:02:50,850
they had and it ended up in the inbox to

36
00:02:48,489 --> 00:02:53,110
the user that's the story behind it

37
00:02:50,850 --> 00:02:55,600
we've also written a blog post about it

38
00:02:53,110 --> 00:02:56,980
so if you want to have more details

39
00:02:55,600 --> 00:03:00,340
afterwards there's a blog post at

40
00:02:56,980 --> 00:03:02,260
trusted sitcom so we will quickly cover

41
00:03:00,340 --> 00:03:05,290
what ask your information protection is

42
00:03:02,260 --> 00:03:08,140
go over some of the licensing parts also

43
00:03:05,290 --> 00:03:10,150
the features and then we're going to

44
00:03:08,140 --> 00:03:12,279
cover a little bit about detections and

45
00:03:10,150 --> 00:03:15,819
in the end of course exploits how to use

46
00:03:12,280 --> 00:03:18,739
this to our advantage as attackers

47
00:03:15,819 --> 00:03:22,040
so what is AIP

48
00:03:18,739 --> 00:03:24,799
it's basically a way to label content

49
00:03:22,040 --> 00:03:27,109
and make make things happen

50
00:03:24,799 --> 00:03:29,780
automatically so meaning that if you

51
00:03:27,110 --> 00:03:31,400
label thing confidential you can get as

52
00:03:29,780 --> 00:03:33,950
information protection to automatically

53
00:03:31,400 --> 00:03:39,709
encrypt the files or tag them in a

54
00:03:33,950 --> 00:03:41,420
special way and the mechanisms behind is

55
00:03:39,709 --> 00:03:43,359
called as your rights management service

56
00:03:41,420 --> 00:03:45,530
or as your RMS

57
00:03:43,359 --> 00:03:47,329
back in the days when we didn't have

58
00:03:45,530 --> 00:03:49,760
clouds we had something called Active

59
00:03:47,329 --> 00:03:52,310
Directory RMS that's the same thing just

60
00:03:49,760 --> 00:03:54,560
on pram and the problem with the

61
00:03:52,310 --> 00:03:56,870
unprimed was that in order for me to

62
00:03:54,560 --> 00:04:00,349
share RMS content with another

63
00:03:56,870 --> 00:04:01,970
organization I had to basically set the

64
00:04:00,349 --> 00:04:03,619
rate with them in order to them to

65
00:04:01,970 --> 00:04:05,420
receive the content and decrypt it and

66
00:04:03,620 --> 00:04:07,069
stuff so it was it was really difficult

67
00:04:05,420 --> 00:04:09,679
to like implement this in a good way

68
00:04:07,069 --> 00:04:12,409
back in the days so now we have the

69
00:04:09,680 --> 00:04:14,930
cloud so everything is cloud-based and

70
00:04:12,409 --> 00:04:17,959
it can basically be consumed by everyone

71
00:04:14,930 --> 00:04:20,269
and it's it's free for everyone to

72
00:04:17,959 --> 00:04:22,190
consume or a mess protected content

73
00:04:20,269 --> 00:04:26,479
that's the part of the strategy from

74
00:04:22,190 --> 00:04:28,490
Microsoft so if you send something to an

75
00:04:26,479 --> 00:04:31,250
inducer if the organization or the

76
00:04:28,490 --> 00:04:33,889
receiver has an azure ad account and

77
00:04:31,250 --> 00:04:36,229
most organizations do these days so they

78
00:04:33,889 --> 00:04:39,139
single sign-on and they open the

79
00:04:36,229 --> 00:04:42,080
document it gets a licensing or a

80
00:04:39,139 --> 00:04:44,210
decryption key from from the cloud it

81
00:04:42,080 --> 00:04:45,740
decrypts it and you can open it and it

82
00:04:44,210 --> 00:04:48,799
it doesn't trigger any additional

83
00:04:45,740 --> 00:04:51,919
pop-ups or whatever if he doesn't have

84
00:04:48,800 --> 00:04:56,270
an aster 80 account they are actually

85
00:04:51,919 --> 00:04:58,310
asked to create one and you get a link

86
00:04:56,270 --> 00:04:59,539
you click and you open its su de you

87
00:04:58,310 --> 00:05:03,229
have to create an account in order to

88
00:04:59,539 --> 00:05:05,570
access this content and the last is if

89
00:05:03,229 --> 00:05:09,139
the receiver is on a gmail or a hotmail

90
00:05:05,570 --> 00:05:10,820
or some specific services they need to

91
00:05:09,139 --> 00:05:12,770
go to a special link there's a

92
00:05:10,820 --> 00:05:17,389
cooperation there between Microsoft and

93
00:05:12,770 --> 00:05:19,130
the others to consume RMS content if you

94
00:05:17,389 --> 00:05:20,870
want to know more about how the user

95
00:05:19,130 --> 00:05:25,130
experience this there's there's a link

96
00:05:20,870 --> 00:05:25,590
at the bottom where it shows the

97
00:05:25,130 --> 00:05:28,620
different

98
00:05:25,590 --> 00:05:30,359
types of setups so if you have a nicer

99
00:05:28,620 --> 00:05:31,860
ad account that looks like this if you

100
00:05:30,360 --> 00:05:33,450
if you don't have an accurate account

101
00:05:31,860 --> 00:05:38,460
this is what it what the experience is

102
00:05:33,450 --> 00:05:40,110
like and so on and so forth yes so here

103
00:05:38,460 --> 00:05:41,729
are the different windows you will

104
00:05:40,110 --> 00:05:43,920
encounter when playing with a

105
00:05:41,730 --> 00:05:47,310
information protection it's basically a

106
00:05:43,920 --> 00:05:50,220
client to install then you will get this

107
00:05:47,310 --> 00:05:52,800
little lock pad here where you can

108
00:05:50,220 --> 00:05:55,590
protect the content in any way you want

109
00:05:52,800 --> 00:05:57,990
it could be predefined or it could be

110
00:05:55,590 --> 00:06:01,109
custom and that's mostly what we use we

111
00:05:57,990 --> 00:06:02,670
use custom and here is the labels that I

112
00:06:01,110 --> 00:06:06,180
was talking about that's how you label

113
00:06:02,670 --> 00:06:08,790
content so you can label content either

114
00:06:06,180 --> 00:06:09,920
private or confidential or highly

115
00:06:08,790 --> 00:06:12,330
confidential and it can have

116
00:06:09,920 --> 00:06:15,750
automatically actions based on those

117
00:06:12,330 --> 00:06:17,130
labels but the clue with extra

118
00:06:15,750 --> 00:06:19,050
information protection is of course to

119
00:06:17,130 --> 00:06:21,690
protect content no matter where it is

120
00:06:19,050 --> 00:06:24,420
because like traditionally when we had a

121
00:06:21,690 --> 00:06:28,430
file servers we still do we protect

122
00:06:24,420 --> 00:06:30,870
files by setting ACLs on folders so that

123
00:06:28,430 --> 00:06:33,180
so people doesn't get into the folder

124
00:06:30,870 --> 00:06:35,580
for instance we have an HR folder where

125
00:06:33,180 --> 00:06:38,640
only the group HR is allowed to to get

126
00:06:35,580 --> 00:06:40,770
access to but the problem is when

127
00:06:38,640 --> 00:06:43,260
someone from HR takes that file and

128
00:06:40,770 --> 00:06:44,430
sends it away on the email or tech puts

129
00:06:43,260 --> 00:06:46,680
it on a USB stick

130
00:06:44,430 --> 00:06:49,710
everyone can open it because the D

131
00:06:46,680 --> 00:06:51,060
rights doesn't go with the file so

132
00:06:49,710 --> 00:06:53,370
that's the problem that as your

133
00:06:51,060 --> 00:06:55,140
information protection is solving like

134
00:06:53,370 --> 00:06:56,850
no matter where you open the file it the

135
00:06:55,140 --> 00:07:01,830
protection you set will always be with

136
00:06:56,850 --> 00:07:05,430
that file so that's pretty awesome yeah

137
00:07:01,830 --> 00:07:08,460
so here's a screenshot of the same file

138
00:07:05,430 --> 00:07:11,100
with and without encryption so here's

139
00:07:08,460 --> 00:07:15,539
the size for the first partners you see

140
00:07:11,100 --> 00:07:17,400
the the empty file is like 11k B when

141
00:07:15,540 --> 00:07:19,470
you protect it it increases in size of

142
00:07:17,400 --> 00:07:21,510
course because it embeds a lot of

143
00:07:19,470 --> 00:07:23,010
information and it equips the files so

144
00:07:21,510 --> 00:07:27,300
if you know if you open the files in

145
00:07:23,010 --> 00:07:30,840
7-zip sorry 7-zip you can see that the

146
00:07:27,300 --> 00:07:32,460
content changes so if you open this

147
00:07:30,840 --> 00:07:36,690
information here you won't see anything

148
00:07:32,460 --> 00:07:38,880
it's just random mess basically in an

149
00:07:36,690 --> 00:07:41,450
encrypted file you can still see

150
00:07:38,880 --> 00:07:47,340
content like with a notepad or whatever

151
00:07:41,450 --> 00:07:49,140
so it's really it's a beautiful thing in

152
00:07:47,340 --> 00:07:51,270
terms of the file types that are

153
00:07:49,140 --> 00:07:54,390
supported it's basically all office

154
00:07:51,270 --> 00:07:56,849
files XLS xlsx and so on

155
00:07:54,390 --> 00:08:01,800
it also has support for other extensions

156
00:07:56,850 --> 00:08:02,400
such as PDF txt and the list is yeah you

157
00:08:01,800 --> 00:08:05,280
can see it here

158
00:08:02,400 --> 00:08:08,609
the problem with the other extensions is

159
00:08:05,280 --> 00:08:11,070
that it it changes the name of the file

160
00:08:08,610 --> 00:08:13,170
so if the file is called file dot txt

161
00:08:11,070 --> 00:08:13,860
when you encrypt it with a information

162
00:08:13,170 --> 00:08:17,940
protection

163
00:08:13,860 --> 00:08:20,940
it changes the extension to P txt and

164
00:08:17,940 --> 00:08:23,460
you can only open it using the ass your

165
00:08:20,940 --> 00:08:25,500
information protection client viewer so

166
00:08:23,460 --> 00:08:28,380
that's useless for us as attackers

167
00:08:25,500 --> 00:08:30,450
unless they have the client and you're

168
00:08:28,380 --> 00:08:32,429
not sure so that's yeah you have to be

169
00:08:30,450 --> 00:08:35,429
sure of that at least

170
00:08:32,429 --> 00:08:39,900
PDF is an exception because when you

171
00:08:35,429 --> 00:08:43,919
send a striated PDF document it will

172
00:08:39,900 --> 00:08:45,990
actually show like - like like it looks

173
00:08:43,919 --> 00:08:48,090
like a phishing page where you need to

174
00:08:45,990 --> 00:08:52,050
download an IMSI file in order to enable

175
00:08:48,090 --> 00:08:55,020
a plugin so that's something we we want

176
00:08:52,050 --> 00:08:58,530
to further investigate later on

177
00:08:55,020 --> 00:09:01,560
hopefully all right in terms of

178
00:08:58,530 --> 00:09:04,650
Licensing and costs there are basically

179
00:09:01,560 --> 00:09:09,540
three levels you have the standard you

180
00:09:04,650 --> 00:09:11,550
get bit uh normal office 365 license I'm

181
00:09:09,540 --> 00:09:13,290
not a licensed expert but basically this

182
00:09:11,550 --> 00:09:17,400
is what you get if you have the normal

183
00:09:13,290 --> 00:09:20,839
III license with office 365 you get all

184
00:09:17,400 --> 00:09:23,310
the way up to document tracking and

185
00:09:20,840 --> 00:09:25,860
relocation you don't get those last

186
00:09:23,310 --> 00:09:30,540
features unless you have premium 1 or

187
00:09:25,860 --> 00:09:33,830
premium 2 so if you want tracking you

188
00:09:30,540 --> 00:09:33,829
need the premium editions

189
00:09:34,170 --> 00:09:37,800
there are some details on their blog

190
00:09:36,120 --> 00:09:40,530
it's it's really good document basically

191
00:09:37,800 --> 00:09:42,390
every feature what sort of level you

192
00:09:40,530 --> 00:09:45,120
need a license in order to get the

193
00:09:42,390 --> 00:09:47,699
different features in terms of costs a

194
00:09:45,120 --> 00:09:50,850
normal year 3e license at least when I

195
00:09:47,700 --> 00:09:53,040
checked it was 20 bucks to user and if

196
00:09:50,850 --> 00:09:54,570
you want to premium one it's an

197
00:09:53,040 --> 00:09:56,310
additional six dollars per user

198
00:09:54,570 --> 00:10:01,290
if you want to premium - it's an

199
00:09:56,310 --> 00:10:02,790
additional nine dollars so yeah and as I

200
00:10:01,290 --> 00:10:04,620
said at the bottom here

201
00:10:02,790 --> 00:10:10,490
ask your licensing advisor because I'm

202
00:10:04,620 --> 00:10:13,800
not a licensing adviser i hack stuff

203
00:10:10,490 --> 00:10:16,500
right so features are basically tracking

204
00:10:13,800 --> 00:10:18,060
that's really cool when you send a fish

205
00:10:16,500 --> 00:10:20,520
and you can actually see if someone

206
00:10:18,060 --> 00:10:23,880
tried to open the document we also got a

207
00:10:20,520 --> 00:10:26,490
demo of that in the end so I can see if

208
00:10:23,880 --> 00:10:30,240
the email itself was opened or viewed I

209
00:10:26,490 --> 00:10:33,270
can also see when a user authenticates

210
00:10:30,240 --> 00:10:35,850
and tries to open the payload itself I

211
00:10:33,270 --> 00:10:38,910
can see if it was a success or if it

212
00:10:35,850 --> 00:10:41,220
failed so if someone are from the IRA

213
00:10:38,910 --> 00:10:43,530
response team is trying to reverse it I

214
00:10:41,220 --> 00:10:47,910
can see that they are denied access for

215
00:10:43,530 --> 00:10:51,089
instance that's that's pretty useful and

216
00:10:47,910 --> 00:10:52,920
also of course the main feature that we

217
00:10:51,090 --> 00:10:57,120
use it for is for encryption of payloads

218
00:10:52,920 --> 00:11:03,630
and emails right the girl handed over to

219
00:10:57,120 --> 00:11:07,470
hunts detection I can sorry yeah so in

220
00:11:03,630 --> 00:11:10,620
terms of detection there's a if you

221
00:11:07,470 --> 00:11:12,660
unzip the file there's actually a clue

222
00:11:10,620 --> 00:11:15,720
inside one of the files that will tell

223
00:11:12,660 --> 00:11:16,949
you the tenant ID so that's pretty

224
00:11:15,720 --> 00:11:19,950
useful in terms of when you're

225
00:11:16,950 --> 00:11:24,330
investigating if you get such a document

226
00:11:19,950 --> 00:11:27,180
and you need to further to response on

227
00:11:24,330 --> 00:11:31,980
it you can at least find the the tenant

228
00:11:27,180 --> 00:11:35,699
ID and that's useful yeah in terms of

229
00:11:31,980 --> 00:11:37,560
blocking it or getting an alert you can

230
00:11:35,700 --> 00:11:40,500
in exchange you can create something

231
00:11:37,560 --> 00:11:42,540
called a transport rule and that's

232
00:11:40,500 --> 00:11:45,960
basically all I have found that you can

233
00:11:42,540 --> 00:11:46,620
use so basically there's this option

234
00:11:45,960 --> 00:11:51,690
here

235
00:11:46,620 --> 00:11:54,470
called only it's called content can't be

236
00:11:51,690 --> 00:11:57,210
inspected so you can create an alert if

237
00:11:54,470 --> 00:11:58,560
exchange cannot inspect the content and

238
00:11:57,210 --> 00:12:00,210
that's typical when you have Astra

239
00:11:58,560 --> 00:12:02,790
information protected documents because

240
00:12:00,210 --> 00:12:05,250
it's encrypted so you can get it to

241
00:12:02,790 --> 00:12:07,370
trigger an alert or you can get it to

242
00:12:05,250 --> 00:12:10,710
trigger an action like blocking it or

243
00:12:07,370 --> 00:12:14,610
quarentine it or whatever so that's the

244
00:12:10,710 --> 00:12:17,910
best advice I have at least so yeah cool

245
00:12:14,610 --> 00:12:20,340
one of the things that we didn't mention

246
00:12:17,910 --> 00:12:21,780
too much in here is document revocation

247
00:12:20,340 --> 00:12:24,930
so if you're doing a phishing campaign

248
00:12:21,780 --> 00:12:26,970
and you know it's burned or whatever you

249
00:12:24,930 --> 00:12:29,609
just know that it is you can literally

250
00:12:26,970 --> 00:12:31,050
revoke the documents so that way the no

251
00:12:29,610 --> 00:12:32,850
one else can open it even the legitimate

252
00:12:31,050 --> 00:12:36,089
user who was initially authorized can

253
00:12:32,850 --> 00:12:37,380
open it anymore which is great like say

254
00:12:36,090 --> 00:12:38,780
you land it once you don't need to have

255
00:12:37,380 --> 00:12:41,090
them click it again just revoke it

256
00:12:38,780 --> 00:12:52,829
anyway so we have a few demos here of

257
00:12:41,090 --> 00:12:53,250
what this looks like in action ok so

258
00:12:52,830 --> 00:13:06,870
here we are

259
00:12:53,250 --> 00:13:10,130
nope that's the wrong one I can hold

260
00:13:06,870 --> 00:13:12,480
this for you all day long

261
00:13:10,130 --> 00:13:14,540
alright so here we are have a regular

262
00:13:12,480 --> 00:13:17,640
document in this situation here we've

263
00:13:14,540 --> 00:13:21,930
are logged in to office on a workstation

264
00:13:17,640 --> 00:13:26,640
with an account that has the premium 2

265
00:13:21,930 --> 00:13:29,060
version of AIP and we also and we also

266
00:13:26,640 --> 00:13:32,069
have the client as well the client is

267
00:13:29,060 --> 00:13:34,260
needed in order to install our right

268
00:13:32,070 --> 00:13:37,590
I'll run this action to encrypt the

269
00:13:34,260 --> 00:13:39,530
document so it adds in a function when

270
00:13:37,590 --> 00:13:43,410
you right-click to classify and protect

271
00:13:39,530 --> 00:13:46,949
as oddvar mentioned on the top there you

272
00:13:43,410 --> 00:13:48,839
can set the classification manually if

273
00:13:46,950 --> 00:13:50,610
you want in this case we're not going to

274
00:13:48,840 --> 00:13:53,730
use it but we are going to do is go

275
00:13:50,610 --> 00:13:56,730
protect with custom permissions

276
00:13:53,730 --> 00:13:59,519
in the permissions that we have here our

277
00:13:56,730 --> 00:14:01,859
view reviewer co-author or are you sorry

278
00:13:59,519 --> 00:14:03,239
view edit view only and so forth in our

279
00:14:01,859 --> 00:14:04,980
case we only want them to view the

280
00:14:03,239 --> 00:14:09,179
content we don't want them to do

281
00:14:04,980 --> 00:14:10,410
anything else beyond that and you can

282
00:14:09,179 --> 00:14:11,939
specify the email address that you want

283
00:14:10,410 --> 00:14:16,079
to send to in this case here we just set

284
00:14:11,939 --> 00:14:18,059
up a domain in 365 a IP demo but again

285
00:14:16,079 --> 00:14:19,738
as Ivar mentioned this can be a Gmail

286
00:14:18,059 --> 00:14:21,480
this can be at whatever domain that you

287
00:14:19,739 --> 00:14:25,079
want in this case it's going to be an

288
00:14:21,480 --> 00:14:26,489
office customer attendant last thing

289
00:14:25,079 --> 00:14:29,519
know know is that you can also set the

290
00:14:26,489 --> 00:14:32,069
expiration so that way even if you

291
00:14:29,519 --> 00:14:34,439
yourself forget to revoke the document

292
00:14:32,069 --> 00:14:38,160
you can have it automatically fail to

293
00:14:34,439 --> 00:14:42,929
open at a certain date and that's it so

294
00:14:38,160 --> 00:14:45,868
that's how you encrypt it and this here

295
00:14:42,929 --> 00:14:48,029
is how you would send a document in that

296
00:14:45,869 --> 00:14:49,439
situation so now the documents been

297
00:14:48,029 --> 00:14:51,899
encrypted we're sending it to a guy

298
00:14:49,439 --> 00:14:55,618
named receiver with the convincing open

299
00:14:51,899 --> 00:15:02,970
me you attach the file just fine no

300
00:14:55,619 --> 00:15:05,189
issues whatsoever all right so we have

301
00:15:02,970 --> 00:15:06,389
attached our totally safe doc now one

302
00:15:05,189 --> 00:15:09,089
thing we wanted to point out here is we

303
00:15:06,389 --> 00:15:10,589
have the ability to do not forward which

304
00:15:09,089 --> 00:15:12,569
is great because when you send this fish

305
00:15:10,589 --> 00:15:14,579
to a the target we don't want them

306
00:15:12,569 --> 00:15:16,498
forwarding on to the team that would be

307
00:15:14,579 --> 00:15:18,179
actually doing instant response this

308
00:15:16,499 --> 00:15:21,029
will disable on their client to their

309
00:15:18,179 --> 00:15:23,269
ability to Ford this attached email so

310
00:15:21,029 --> 00:15:23,269
cool

311
00:15:28,339 --> 00:15:34,470
all right so this error message here

312
00:15:32,660 --> 00:15:36,060
it's just talking about the permissions

313
00:15:34,470 --> 00:15:37,260
relate to it's like here's a warning for

314
00:15:36,060 --> 00:15:39,199
it so are you okay you want to do this

315
00:15:37,260 --> 00:15:41,430
yeah we are

316
00:15:39,200 --> 00:15:45,029
and sure enough it goes ahead and sends

317
00:15:41,430 --> 00:15:47,370
it all right so now we have in this demo

318
00:15:45,029 --> 00:15:50,070
here a situation where the document has

319
00:15:47,370 --> 00:15:53,370
been moved from the recipients email

320
00:15:50,070 --> 00:15:55,440
maybe be a USB stick or network share to

321
00:15:53,370 --> 00:15:57,089
the incident response team that doesn't

322
00:15:55,440 --> 00:15:59,760
have the legitimate credentials to open

323
00:15:57,089 --> 00:16:00,990
it what does it look like for them so

324
00:15:59,760 --> 00:16:01,829
they'll open the doc just by

325
00:16:00,990 --> 00:16:03,779
double-clicking on it

326
00:16:01,829 --> 00:16:06,839
Microsoft goes and checks or a result

327
00:16:03,779 --> 00:16:08,519
realizes that it's protected attempts to

328
00:16:06,839 --> 00:16:10,949
communicate with a server saying hey who

329
00:16:08,519 --> 00:16:12,870
has rights to this ass oddvar to enter

330
00:16:10,949 --> 00:16:18,359
his credentials now he's not the

331
00:16:12,870 --> 00:16:20,820
recipient so it's going to fail it's

332
00:16:18,360 --> 00:16:24,930
checking checking and boom you're not

333
00:16:20,820 --> 00:16:27,240
authorized to access this document so

334
00:16:24,930 --> 00:16:28,709
this is what any ir person would receive

335
00:16:27,240 --> 00:16:30,390
when they tried investigating this

336
00:16:28,709 --> 00:16:31,709
document interacting with it normally if

337
00:16:30,390 --> 00:16:32,910
they try to run it through like vipre

338
00:16:31,709 --> 00:16:34,199
monkey or any of those other tools

339
00:16:32,910 --> 00:16:37,310
they're not going to get anything either

340
00:16:34,199 --> 00:16:37,310
because it's again it's encrypted

341
00:16:37,490 --> 00:16:44,699
yep then maybe the legitimate user a

342
00:16:39,870 --> 00:16:45,750
recipient to view it alright so this is

343
00:16:44,699 --> 00:16:48,390
the last one I want to show you guys

344
00:16:45,750 --> 00:16:50,399
here if you do open it legitimately it

345
00:16:48,390 --> 00:16:51,540
just opens like editor doc if they're

346
00:16:50,399 --> 00:16:52,829
logged in if they're not logged in it'll

347
00:16:51,540 --> 00:16:55,170
pump them to log him just like he did

348
00:16:52,829 --> 00:16:57,540
before and then just continue on

349
00:16:55,170 --> 00:17:00,449
forwarded and we have ten minutes left

350
00:16:57,540 --> 00:17:01,439
so this will be quick all right so the

351
00:17:00,449 --> 00:17:03,510
last thing here I want to show you is

352
00:17:01,440 --> 00:17:05,130
that we have two documents and a P demo

353
00:17:03,510 --> 00:17:06,599
message box and a P demo message back

354
00:17:05,130 --> 00:17:09,480
protected these are the exact same

355
00:17:06,599 --> 00:17:11,010
document however one is protected the

356
00:17:09,480 --> 00:17:13,140
other one is not so they had the same

357
00:17:11,010 --> 00:17:17,250
malware or the same VBA in there and

358
00:17:13,140 --> 00:17:19,339
what I wanted to show you guys is what

359
00:17:17,250 --> 00:17:21,869
ends up

360
00:17:19,339 --> 00:17:24,300
happening oh no nope sorry last one

361
00:17:21,869 --> 00:17:28,139
sorry first one the tracking feature

362
00:17:24,300 --> 00:17:30,060
sorry so we have when you right click

363
00:17:28,140 --> 00:17:31,800
and view protect this is the same window

364
00:17:30,060 --> 00:17:34,560
that you saw before with the settings

365
00:17:31,800 --> 00:17:36,570
and and so forth we also have the

366
00:17:34,560 --> 00:17:39,389
ability to view the file permissions

367
00:17:36,570 --> 00:17:40,620
that you currently have set and you can

368
00:17:39,390 --> 00:17:42,060
only do this because you're the owner of

369
00:17:40,620 --> 00:17:44,489
the file other people would not be able

370
00:17:42,060 --> 00:17:46,860
to see this can we see that the owner is

371
00:17:44,490 --> 00:18:01,020
user sender and what rights they have

372
00:17:46,860 --> 00:18:01,979
okay a really awesome all right so but

373
00:18:01,020 --> 00:18:03,840
here's what happens when you actually

374
00:18:01,980 --> 00:18:04,980
true the tracking so we have the

375
00:18:03,840 --> 00:18:06,919
document here it brings it to the

376
00:18:04,980 --> 00:18:09,270
website and you actually see all the

377
00:18:06,920 --> 00:18:11,310
documents owned by this user so I'm

378
00:18:09,270 --> 00:18:13,260
logged in as the sender right now as a

379
00:18:11,310 --> 00:18:15,540
viewer or recipient you do not have

380
00:18:13,260 --> 00:18:18,450
access to this portal only the document

381
00:18:15,540 --> 00:18:20,520
creator has this you can see how many

382
00:18:18,450 --> 00:18:23,460
times it's been views how many times

383
00:18:20,520 --> 00:18:25,080
access has been denied and how long has

384
00:18:23,460 --> 00:18:28,340
it been since the last activity on that

385
00:18:25,080 --> 00:18:28,340
document and so cool

386
00:18:34,070 --> 00:18:39,450
all right so we can see the people who

387
00:18:37,260 --> 00:18:41,250
have attempted to authenticate to this

388
00:18:39,450 --> 00:18:43,049
document and the actual access that's

389
00:18:41,250 --> 00:18:45,600
happened so we can see that oddvar and

390
00:18:43,049 --> 00:18:48,090
his different mailing addresses fail to

391
00:18:45,600 --> 00:18:49,949
open the document and the last one where

392
00:18:48,090 --> 00:18:51,780
it was successful so not only do you get

393
00:18:49,950 --> 00:18:54,440
to see who did it and who opened it and

394
00:18:51,780 --> 00:19:02,789
who failed open it but when it happened

395
00:18:54,440 --> 00:19:04,919
you know you have a new target it also

396
00:19:02,789 --> 00:19:06,360
has a timeline built-in if any of you

397
00:19:04,919 --> 00:19:07,530
guys use Go Fish I mean this is great

398
00:19:06,360 --> 00:19:09,600
it's like how many people have clicked

399
00:19:07,530 --> 00:19:11,639
it over time you even have a map of

400
00:19:09,600 --> 00:19:13,590
where they tried to log in to access it

401
00:19:11,640 --> 00:19:16,799
so we can see oddvar in Norway attempted

402
00:19:13,590 --> 00:19:19,439
to access this document and you also

403
00:19:16,799 --> 00:19:22,379
have the ability to get notified when

404
00:19:19,440 --> 00:19:23,460
people attempt to open the document with

405
00:19:22,380 --> 00:19:24,809
if they were successful open the

406
00:19:23,460 --> 00:19:26,429
document if they failed and open the

407
00:19:24,809 --> 00:19:28,678
document or just not get a notified at

408
00:19:26,429 --> 00:19:36,870
all so you can get notified when someone

409
00:19:28,679 --> 00:19:39,210
actually opens your finish alright so

410
00:19:36,870 --> 00:19:41,309
this last video here what we did is we

411
00:19:39,210 --> 00:19:42,809
took the same document just duplicated

412
00:19:41,309 --> 00:19:44,520
it called one protected one not

413
00:19:42,809 --> 00:19:46,110
protected and what we're gonna do is

414
00:19:44,520 --> 00:19:48,330
we're up load both into virustotal I

415
00:19:46,110 --> 00:19:49,740
want to show you the results just based

416
00:19:48,330 --> 00:19:53,549
up for that litmus test of what you can

417
00:19:49,740 --> 00:19:59,370
expect when doing this so we're going to

418
00:19:53,549 --> 00:20:03,110
go ahead and classify protect I feel

419
00:19:59,370 --> 00:20:03,110
like we're in Norway oh yeah

420
00:20:03,760 --> 00:20:13,180
then we'll be drunk yeah it's good all

421
00:20:10,430 --> 00:20:18,770
right so we protected a document yeah

422
00:20:13,180 --> 00:20:21,230
I'm gonna go ahead and upload it by

423
00:20:18,770 --> 00:20:33,560
trying to drag and drop fails because

424
00:20:21,230 --> 00:20:35,330
they don't know html5 all right so this

425
00:20:33,560 --> 00:20:38,210
is a normal one that will get flagged a

426
00:20:35,330 --> 00:20:44,990
ton and this tab here the second tab is

427
00:20:38,210 --> 00:20:48,790
our protected one so it's going to go

428
00:20:44,990 --> 00:20:50,210
ahead and chew through it on our

429
00:20:48,790 --> 00:20:52,540
malicious one

430
00:20:50,210 --> 00:20:56,060
sure enough it's going to light up I

431
00:20:52,540 --> 00:20:58,010
think we ended up with 31 detections and

432
00:20:56,060 --> 00:21:02,149
this is your basic message box that you

433
00:20:58,010 --> 00:21:10,340
need to see from Metasploit whereas the

434
00:21:02,150 --> 00:21:15,740
protected one nothing there zero

435
00:21:10,340 --> 00:21:19,689
detection x' just fine so that's it

436
00:21:15,740 --> 00:21:19,690
that's our demonstration

437
00:21:25,760 --> 00:21:31,010
if you guys have any questions oh sorry

438
00:21:29,430 --> 00:21:33,960
one last thing we wasn't as I mentioned

439
00:21:31,010 --> 00:21:35,850
competitors so Google has a similar

440
00:21:33,960 --> 00:21:38,160
function they have the ability to send

441
00:21:35,850 --> 00:21:41,070
confidential information it does not

442
00:21:38,160 --> 00:21:42,990
encrypt attachments but it does keep it

443
00:21:41,070 --> 00:21:46,649
so only authorized people can open it

444
00:21:42,990 --> 00:21:50,130
and can't be forwarded it doesn't have a

445
00:21:46,650 --> 00:21:51,660
cool dashboard okay sure yep oh and so

446
00:21:50,130 --> 00:21:54,930
when you do receive it in email what

447
00:21:51,660 --> 00:21:56,730
ends up happening is it's a stupid dude

448
00:21:54,930 --> 00:21:59,970
your email do want to open it yes you

449
00:21:56,730 --> 00:22:01,710
click view and they have the ability to

450
00:21:59,970 --> 00:22:03,150
what ends up happening is that when you

451
00:22:01,710 --> 00:22:06,660
click the link a new window opens up in

452
00:22:03,150 --> 00:22:08,460
the browser and then it proxies the link

453
00:22:06,660 --> 00:22:12,000
that you actually are using as your

454
00:22:08,460 --> 00:22:13,980
phishing campaign so the initial email

455
00:22:12,000 --> 00:22:15,000
doesn't have it the link once you are

456
00:22:13,980 --> 00:22:18,540
authorized you have to kind of go

457
00:22:15,000 --> 00:22:20,340
through step by steps it does have the

458
00:22:18,540 --> 00:22:23,070
ability to go the other direction in the

459
00:22:20,340 --> 00:22:26,240
sense that Gmail can be sent consent to

460
00:22:23,070 --> 00:22:30,450
an op 365 user and it signs in to via

461
00:22:26,240 --> 00:22:32,850
OAuth so you don't have to you know be a

462
00:22:30,450 --> 00:22:34,860
little easier to open a protected

463
00:22:32,850 --> 00:22:47,280
document from Gmail alright that's the

464
00:22:34,860 --> 00:22:49,949
last one and now we have questions okay

465
00:22:47,280 --> 00:22:52,070
is it smart enough to know if I remove

466
00:22:49,950 --> 00:22:55,050
the email from a user's mailbox that

467
00:22:52,070 --> 00:22:56,970
like you said it disables like you can't

468
00:22:55,050 --> 00:22:58,379
forward it so if one of my users

469
00:22:56,970 --> 00:23:01,380
forwarded it to me said hey this looks

470
00:22:58,380 --> 00:23:03,390
wonky and I go in and remove the email

471
00:23:01,380 --> 00:23:06,179
which pulls it out of their mailbox puts

472
00:23:03,390 --> 00:23:06,570
it into a dump mailbox it's still to the

473
00:23:06,179 --> 00:23:09,030
user

474
00:23:06,570 --> 00:23:12,090
would would the security team be able to

475
00:23:09,030 --> 00:23:14,580
open it hold your response so you have

476
00:23:12,090 --> 00:23:16,620
to authenticate as that user in order to

477
00:23:14,580 --> 00:23:18,960
open it at all that's the whole point

478
00:23:16,620 --> 00:23:21,600
so you have to login to the best an

479
00:23:18,960 --> 00:23:23,730
actual user in order to open it that's

480
00:23:21,600 --> 00:23:25,939
the beauty of it because that's how it

481
00:23:23,730 --> 00:23:25,940
works

482
00:23:26,359 --> 00:23:33,869
unauthorized people to open it so I saw

483
00:23:31,229 --> 00:23:35,940
on the on the outlet client you could

484
00:23:33,869 --> 00:23:37,978
click don't forward is there a way to do

485
00:23:35,940 --> 00:23:39,269
this via PowerShell because this makes

486
00:23:37,979 --> 00:23:41,129
sense for like a Red Team engagement

487
00:23:39,269 --> 00:23:42,929
when we're sending just targeted attacks

488
00:23:41,129 --> 00:23:46,949
but if we're sending it to like 50

489
00:23:42,929 --> 00:23:49,739
people sending 50 emails is great

490
00:23:46,950 --> 00:23:50,219
drinking yeah I mean you have you can

491
00:23:49,739 --> 00:23:53,039
initiate

492
00:23:50,219 --> 00:23:55,289
I like calm object for PowerShell that's

493
00:23:53,039 --> 00:23:57,179
a process and you can like create me

494
00:23:55,289 --> 00:23:58,649
emails and put on whatever you want so

495
00:23:57,179 --> 00:24:05,909
yeah you can for sure do that with

496
00:23:58,649 --> 00:24:08,070
PowerShell so you guys showed that all

497
00:24:05,909 --> 00:24:08,969
office Doc's won't get renamed or

498
00:24:08,070 --> 00:24:10,589
anything like that is there any

499
00:24:08,969 --> 00:24:12,179
notification to the users that they've

500
00:24:10,589 --> 00:24:14,460
received an AIP

501
00:24:12,179 --> 00:24:20,789
encrypted attachment other than the

502
00:24:14,460 --> 00:24:22,710
authentication box that pops up so what

503
00:24:20,789 --> 00:24:27,899
you're asking is do you get an alert

504
00:24:22,710 --> 00:24:29,609
that's an admin or oh yes so okay there

505
00:24:27,899 --> 00:24:31,168
are two things that give it away so if

506
00:24:29,609 --> 00:24:35,279
you protect an email there's a padlock

507
00:24:31,169 --> 00:24:37,799
in the inbox as when we send it in fish

508
00:24:35,279 --> 00:24:41,279
it's it makes it more look more legit I

509
00:24:37,799 --> 00:24:43,799
think because it's in the inbox subject

510
00:24:41,279 --> 00:24:47,339
field we don't have a picture of that

511
00:24:43,799 --> 00:24:50,158
sorry so that's the thing that gives it

512
00:24:47,339 --> 00:24:51,690
away and also when you open it it it

513
00:24:50,159 --> 00:24:54,659
starts the pop-up box that sets

514
00:24:51,690 --> 00:24:56,849
configure RMS so that kind of gives it

515
00:24:54,659 --> 00:24:59,580
away and also you cannot preview it in

516
00:24:56,849 --> 00:25:00,989
Outlook so if you if you single click

517
00:24:59,580 --> 00:25:02,519
and try to preview it able say it's

518
00:25:00,989 --> 00:25:12,570
blocked because you need to open it in

519
00:25:02,519 --> 00:25:15,119
order to decrypt it's basically a nice

520
00:25:12,570 --> 00:25:19,499
presentation questions just clarify what

521
00:25:15,119 --> 00:25:22,738
was the content label that that is the

522
00:25:19,499 --> 00:25:25,739
attribute for secure encryption and

523
00:25:22,739 --> 00:25:28,159
that's transmission and storage or one

524
00:25:25,739 --> 00:25:28,159
or the other

525
00:25:28,509 --> 00:25:40,539
here yeah yes yes right there yes so you

526
00:25:38,649 --> 00:25:43,289
want to know if I can't remember the

527
00:25:40,539 --> 00:25:47,349
defaults but I think I think if you use

528
00:25:43,289 --> 00:25:49,269
confidential I think it's better higher

529
00:25:47,349 --> 00:25:51,668
I think it's encrypted both the content

530
00:25:49,269 --> 00:25:53,589
and also in transit if I'm not mistaken

531
00:25:51,669 --> 00:25:55,989
but I'm not an % sure so you have to

532
00:25:53,589 --> 00:25:57,999
look it up but it's it's it's a guide on

533
00:25:55,989 --> 00:26:00,849
Microsoft where you can look it up so it

534
00:25:57,999 --> 00:26:03,459
shouldn't be hard to find so it's great

535
00:26:00,849 --> 00:26:05,948
is once you get the licensing for it you

536
00:26:03,459 --> 00:26:07,779
can create your own and you can create

537
00:26:05,949 --> 00:26:09,369
whatever rules you want to do based off

538
00:26:07,779 --> 00:26:11,619
of that so this is all the stuff that's

539
00:26:09,369 --> 00:26:15,039
baked in but if but if you want to go

540
00:26:11,619 --> 00:26:16,658
overboard you can yeah in addition to

541
00:26:15,039 --> 00:26:18,849
that if you have a file server and you

542
00:26:16,659 --> 00:26:20,589
have premium one or two you can also

543
00:26:18,849 --> 00:26:22,208
automate the labeling and protection on

544
00:26:20,589 --> 00:26:24,158
file servers as well so if someone tries

545
00:26:22,209 --> 00:26:28,169
to steal document it automatically is

546
00:26:24,159 --> 00:26:31,059
protected when someone tries to grab it

547
00:26:28,169 --> 00:26:32,679
know from the file server you establish

548
00:26:31,059 --> 00:26:34,269
an extension on the file server I knew

549
00:26:32,679 --> 00:26:40,119
you were able to protect it from from

550
00:26:34,269 --> 00:26:41,979
within the file server since the

551
00:26:40,119 --> 00:26:44,468
attacker has to have an Outlook account

552
00:26:41,979 --> 00:26:46,329
or Microsoft account how would a threat

553
00:26:44,469 --> 00:26:55,839
hunting team basically report that to

554
00:26:46,329 --> 00:26:58,749
Microsoft and shut them down so how do

555
00:26:55,839 --> 00:27:01,149
you okay I'm not sure you have to let's

556
00:26:58,749 --> 00:27:03,819
say you have to in order to you have to

557
00:27:01,149 --> 00:27:08,879
block it basically that's I'm not sure

558
00:27:03,819 --> 00:27:11,619
how to I would block the count

559
00:27:08,879 --> 00:27:17,168
interesting I'm not sure how would you

560
00:27:11,619 --> 00:27:19,448
respond yeah I mean you can go into the

561
00:27:17,169 --> 00:27:20,499
document and see the tenant ID but I

562
00:27:19,449 --> 00:27:23,589
don't know if you have to decrypt it in

563
00:27:20,499 --> 00:27:24,789
order to see that in the first place and

564
00:27:23,589 --> 00:27:29,480
see the time ID so maybe you could

565
00:27:24,789 --> 00:27:31,650
report it through like an abuse but

566
00:27:29,480 --> 00:27:35,030
yeah I mean it's a phishing email yeah

567
00:27:31,650 --> 00:27:42,420
yeah let them deal they love it

568
00:27:35,030 --> 00:27:44,790
good question up how whoa sorry how

569
00:27:42,420 --> 00:27:46,170
difficult is it to rotate a IP for

570
00:27:44,790 --> 00:27:47,159
different campaigns for different

571
00:27:46,170 --> 00:27:52,800
domains that you're using

572
00:27:47,160 --> 00:27:54,870
oh so that's you have two answers so I

573
00:27:52,800 --> 00:27:56,550
think from an object

574
00:27:54,870 --> 00:27:59,429
perspective I think I would create a new

575
00:27:56,550 --> 00:28:01,860
tenant each time yes but it's a lot of

576
00:27:59,430 --> 00:28:03,990
work but still the tenant ID is in the

577
00:28:01,860 --> 00:28:06,990
emails so if someone snacks that and

578
00:28:03,990 --> 00:28:08,280
reports it it could get blocked if you

579
00:28:06,990 --> 00:28:10,080
want to rotate I think you can bring

580
00:28:08,280 --> 00:28:12,840
your own key so you can like wrote that

581
00:28:10,080 --> 00:28:15,780
the key at least other than that it's

582
00:28:12,840 --> 00:28:19,020
basically just domains that you use or

583
00:28:15,780 --> 00:28:21,180
do you have anything yeah nobody said as

584
00:28:19,020 --> 00:28:23,639
well but from if you've done any

585
00:28:21,180 --> 00:28:25,500
licensing assignment in Xero when you

586
00:28:23,640 --> 00:28:28,410
create a user you can create different

587
00:28:25,500 --> 00:28:32,040
licenses that apply to that user so what

588
00:28:28,410 --> 00:28:33,810
we've done is we'll get a license for

589
00:28:32,040 --> 00:28:35,100
like maybe four or five and then we'll

590
00:28:33,810 --> 00:28:36,540
just unassigned to that user and

591
00:28:35,100 --> 00:28:38,639
reassigned to a new user and so forth

592
00:28:36,540 --> 00:28:42,389
and just reapply the license or the

593
00:28:38,640 --> 00:28:44,970
subscription when needed so you don't

594
00:28:42,390 --> 00:28:47,340
need to get 20 or 40 or 50 user license

595
00:28:44,970 --> 00:28:55,310
just get a small set and just remove one

596
00:28:47,340 --> 00:28:55,310
you need does that change a tenant ID

597
00:28:56,420 --> 00:29:01,830
have you tried to monkey with the tenant

598
00:28:59,430 --> 00:29:07,380
ID or any thing in the file or I'm

599
00:29:01,830 --> 00:29:09,480
assuming it probably would break it that

600
00:29:07,380 --> 00:29:11,280
does a good good thing to investigate

601
00:29:09,480 --> 00:29:12,900
but I think if you manipulate too much

602
00:29:11,280 --> 00:29:15,389
in the file you will invalidate the

603
00:29:12,900 --> 00:29:16,920
signature somehow but that could

604
00:29:15,390 --> 00:29:19,050
possibly be a thing you could do I'll

605
00:29:16,920 --> 00:29:21,650
try I haven't looked at it but that's a

606
00:29:19,050 --> 00:29:23,820
good suggestion Thanks

607
00:29:21,650 --> 00:29:27,830
okay we'll wrap it up if there's any

608
00:29:23,820 --> 00:29:27,830
more questions just grab us Thanks

609
00:29:30,720 --> 00:29:32,920
[Applause]

