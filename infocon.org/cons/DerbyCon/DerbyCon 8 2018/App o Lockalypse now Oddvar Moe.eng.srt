1
00:00:00,000 --> 00:00:08,490
<font color="#E5E5E5">okay arrest okay cool</font><font color="#CCCCCC"> so Wow</font>

2
00:00:04,770 --> 00:00:11,579
big crowd<font color="#E5E5E5"> awesome so my talk is</font><font color="#CCCCCC"> called</font>

3
00:00:08,490 --> 00:00:14,099
<font color="#CCCCCC">app' a palak ellipse</font><font color="#E5E5E5"> now and it's a talk</font>

4
00:00:11,580 --> 00:00:16,948
about different bypasses for<font color="#E5E5E5"> AppLocker</font>

5
00:00:14,099 --> 00:00:19,830
<font color="#E5E5E5">but a not</font><font color="#CCCCCC"> only bypasses but also</font>

6
00:00:16,949 --> 00:00:22,619
mitigations<font color="#E5E5E5"> so hopefully it will enjoy</font>

7
00:00:19,830 --> 00:00:24,479
this tart<font color="#CCCCCC"> I've been excited</font><font color="#E5E5E5"> to to talk</font>

8
00:00:22,619 --> 00:00:28,680
about<font color="#E5E5E5"> this for a long time now</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> yeah</font>

9
00:00:24,480 --> 00:00:33,059
<font color="#E5E5E5">really confirmed to this so briefly</font>

10
00:00:28,680 --> 00:00:36,780
about myself<font color="#CCCCCC"> I</font><font color="#E5E5E5"> am my name is boomer and</font>

11
00:00:33,059 --> 00:00:39,180
I<font color="#CCCCCC"> work</font><font color="#E5E5E5"> with</font><font color="#CCCCCC"> IT since early 99 I</font><font color="#E5E5E5"> took my</font>

12
00:00:36,780 --> 00:00:39,989
first<font color="#E5E5E5"> Microsoft certification when I was</font>

13
00:00:39,180 --> 00:00:43,590
16 years old

14
00:00:39,989 --> 00:00:45,919
<font color="#E5E5E5">that was pretty</font><font color="#CCCCCC"> early in the game</font><font color="#E5E5E5"> the</font>

15
00:00:43,590 --> 00:00:49,230
last six years<font color="#CCCCCC"> are been</font><font color="#E5E5E5"> focusing on</font>

16
00:00:45,920 --> 00:00:51,390
security both<font color="#E5E5E5"> pentesting but also</font>

17
00:00:49,230 --> 00:00:55,038
hardening environments<font color="#E5E5E5"> Windows</font>

18
00:00:51,390 --> 00:00:58,199
environments<font color="#E5E5E5"> so previously I worked as a</font>

19
00:00:55,039 --> 00:01:02,430
Microsoft consultant<font color="#CCCCCC"> I did I'd</font><font color="#E5E5E5"> done a</font>

20
00:00:58,199 --> 00:01:04,559
lot of training<font color="#CCCCCC"> I speak a lot</font><font color="#E5E5E5"> and as a</font>

21
00:01:02,430 --> 00:01:06,810
result<font color="#E5E5E5"> of that</font><font color="#CCCCCC"> I'm also and Microsoft</font>

22
00:01:04,559 --> 00:01:09,030
MVP<font color="#E5E5E5"> within cloud and data center</font>

23
00:01:06,810 --> 00:01:12,360
management<font color="#CCCCCC"> and I've been</font><font color="#E5E5E5"> up for</font><font color="#CCCCCC"> three</font>

24
00:01:09,030 --> 00:01:13,979
years I'm a huge<font color="#E5E5E5"> fan of memes and gifts</font>

25
00:01:12,360 --> 00:01:17,670
so I really love presentation that

26
00:01:13,979 --> 00:01:22,200
includes that and as of this Monday<font color="#E5E5E5"> I</font>

27
00:01:17,670 --> 00:01:27,540
started working at<font color="#CCCCCC"> trusted SEC so Chris</font>

28
00:01:22,200 --> 00:01:30,750
<font color="#CCCCCC">said</font><font color="#E5E5E5"> it okay so I'm from Norway</font><font color="#CCCCCC"> right</font>

29
00:01:27,540 --> 00:01:31,590
and you're probably<font color="#E5E5E5"> thinking oh you live</font>

30
00:01:30,750 --> 00:01:34,409
way up<font color="#E5E5E5"> north</font>

31
00:01:31,590 --> 00:01:37,829
<font color="#E5E5E5">you</font><font color="#CCCCCC"> ride polar bears and</font><font color="#E5E5E5"> kill seals and</font>

32
00:01:34,409 --> 00:01:41,159
<font color="#E5E5E5">other stuff no it's not that</font>

33
00:01:37,829 --> 00:01:43,020
as you can see on the map here<font color="#CCCCCC"> we are</font>

34
00:01:41,159 --> 00:01:46,009
<font color="#CCCCCC">approximately around</font><font color="#E5E5E5"> here somewhere</font>

35
00:01:43,020 --> 00:01:50,520
<font color="#E5E5E5">maybe a little lower I'll leave up there</font>

36
00:01:46,009 --> 00:01:54,509
<font color="#E5E5E5">so that's a great length to swim for</font>

37
00:01:50,520 --> 00:01:57,149
sure<font color="#E5E5E5"> so I don't know if you notice this</font>

38
00:01:54,509 --> 00:01:59,280
<font color="#E5E5E5">but some maps</font><font color="#CCCCCC"> there are different things</font>

39
00:01:57,149 --> 00:02:02,729
like<font color="#E5E5E5"> for instance in Italy they have</font>

40
00:01:59,280 --> 00:02:04,829
<font color="#E5E5E5">this shoe</font><font color="#CCCCCC"> you seen this before</font><font color="#E5E5E5"> yeah and</font>

41
00:02:02,729 --> 00:02:07,429
I heard someone told me that Texas

42
00:02:04,829 --> 00:02:08,728
looked like a finger<font color="#CCCCCC"> it's there correct</font>

43
00:02:07,429 --> 00:02:10,410
yeah

44
00:02:08,729 --> 00:02:12,030
so there<font color="#E5E5E5"> are different</font><font color="#CCCCCC"> maps that come</font>

45
00:02:10,410 --> 00:02:13,709
<font color="#CCCCCC">here you can use</font><font color="#E5E5E5"> your imagination</font><font color="#CCCCCC"> to</font>

46
00:02:12,030 --> 00:02:16,800
<font color="#E5E5E5">like see things we have one in</font>

47
00:02:13,709 --> 00:02:23,400
Scandinavia as well but<font color="#E5E5E5"> we don't brag</font>

48
00:02:16,800 --> 00:02:27,720
<font color="#CCCCCC">about</font><font color="#E5E5E5"> it okay because</font><font color="#CCCCCC"> the Italians okay</font>

49
00:02:23,400 --> 00:02:29,489
<font color="#E5E5E5">so if you're if you're from Russia this</font>

50
00:02:27,720 --> 00:02:32,269
<font color="#CCCCCC">is not meant</font><font color="#E5E5E5"> as an insult</font><font color="#CCCCCC"> that's</font>

51
00:02:29,489 --> 00:02:35,910
important to me okay<font color="#E5E5E5"> this is just a joke</font>

52
00:02:32,269 --> 00:02:38,940
so and when<font color="#E5E5E5"> you first see this you</font>

53
00:02:35,910 --> 00:02:40,620
cannot unsee it<font color="#E5E5E5"> this is just one</font><font color="#CCCCCC"> of</font>

54
00:02:38,940 --> 00:02:42,569
those things<font color="#E5E5E5"> that kind of hit you in the</font>

55
00:02:40,620 --> 00:02:43,640
face<font color="#E5E5E5"> and you can't forget them okay</font>

56
00:02:42,569 --> 00:02:50,880
ready

57
00:02:43,640 --> 00:02:53,369
<font color="#E5E5E5">okay can you see it I'll help you so I</font>

58
00:02:50,880 --> 00:02:56,400
didn't finish<font color="#E5E5E5"> the drawing</font><font color="#CCCCCC"> because I</font>

59
00:02:53,370 --> 00:03:02,060
think<font color="#E5E5E5"> something</font><font color="#CCCCCC"> needs to be</font><font color="#E5E5E5"> like left</font>

60
00:02:56,400 --> 00:03:11,670
for the imagination<font color="#E5E5E5"> yeah funny</font>

61
00:03:02,060 --> 00:03:12,420
it's a pervert why am<font color="#CCCCCC"> i talking</font><font color="#E5E5E5"> about</font>

62
00:03:11,670 --> 00:03:14,910
AppLocker

63
00:03:12,420 --> 00:03:18,089
first of all it's<font color="#CCCCCC"> because</font><font color="#E5E5E5"> I have</font>

64
00:03:14,910 --> 00:03:20,519
<font color="#E5E5E5">implemented that product at several</font>

65
00:03:18,090 --> 00:03:22,650
customers<font color="#E5E5E5"> and I'm also like try to</font>

66
00:03:20,519 --> 00:03:26,670
bypass it<font color="#CCCCCC"> a lot of</font><font color="#E5E5E5"> times in several</font>

67
00:03:22,650 --> 00:03:29,370
environments and to me it's<font color="#CCCCCC"> like</font><font color="#E5E5E5"> a</font>

68
00:03:26,670 --> 00:03:32,790
<font color="#E5E5E5">product that often gets misunderstood</font><font color="#CCCCCC"> on</font>

69
00:03:29,370 --> 00:03:36,000
what it<font color="#E5E5E5"> is and what is it's not so I</font>

70
00:03:32,790 --> 00:03:38,340
want to<font color="#E5E5E5"> like get it out there how it is</font>

71
00:03:36,000 --> 00:03:41,130
<font color="#E5E5E5">and show you how easy it is to</font><font color="#CCCCCC"> get</font>

72
00:03:38,340 --> 00:03:44,220
<font color="#E5E5E5">started and all that stuff</font><font color="#CCCCCC"> so that's</font><font color="#E5E5E5"> one</font>

73
00:03:41,130 --> 00:03:47,670
of<font color="#CCCCCC"> my motivations behind this and as I</font>

74
00:03:44,220 --> 00:03:49,139
said<font color="#E5E5E5"> I have I've heard that it's not</font>

75
00:03:47,670 --> 00:03:52,790
that<font color="#CCCCCC"> common in the</font><font color="#E5E5E5"> States to have a</font>

76
00:03:49,139 --> 00:03:56,209
blocker enabled<font color="#E5E5E5"> a bigger companies so</font>

77
00:03:52,790 --> 00:04:01,069
anyone here use this app Locker wow

78
00:03:56,209 --> 00:04:03,870
that's a<font color="#E5E5E5"> huge bunch ma'am cool</font><font color="#CCCCCC"> okay so</font>

79
00:04:01,069 --> 00:04:06,298
<font color="#E5E5E5">one thing I see is</font><font color="#CCCCCC"> that this product is</font>

80
00:04:03,870 --> 00:04:09,090
often overlooked and many<font color="#E5E5E5"> customers have</font>

81
00:04:06,299 --> 00:04:11,069
<font color="#E5E5E5">like Enterprise licenses and have have</font>

82
00:04:09,090 --> 00:04:12,750
it free they can use it it's just<font color="#E5E5E5"> a</font>

83
00:04:11,069 --> 00:04:16,769
<font color="#E5E5E5">matter of enabling and configuring it</font>

84
00:04:12,750 --> 00:04:20,099
correctly<font color="#E5E5E5"> so people tend to forget this</font>

85
00:04:16,769 --> 00:04:22,580
product and this this<font color="#E5E5E5"> torque is for both</font>

86
00:04:20,099 --> 00:04:24,139
sides so I have<font color="#E5E5E5"> some</font>

87
00:04:22,580 --> 00:04:26,300
stuff<font color="#E5E5E5"> for the red side and</font><font color="#CCCCCC"> hopefully</font>

88
00:04:24,139 --> 00:04:30,650
some cool stuff<font color="#CCCCCC"> for the blue side I hope</font>

89
00:04:26,300 --> 00:04:32,150
<font color="#E5E5E5">you</font><font color="#CCCCCC"> appreciate that</font><font color="#E5E5E5"> right so what I will</font>

90
00:04:30,650 --> 00:04:35,359
cover<font color="#E5E5E5"> I'll give you an overview of app</font>

91
00:04:32,150 --> 00:04:38,568
<font color="#E5E5E5">Locker</font><font color="#CCCCCC"> how you configure it like from a</font>

92
00:04:35,360 --> 00:04:40,819
default perspective<font color="#E5E5E5"> and just go over</font>

93
00:04:38,569 --> 00:04:43,340
<font color="#CCCCCC">some</font><font color="#E5E5E5"> basics like how to configure a rule</font>

94
00:04:40,819 --> 00:04:45,430
and all that stuff<font color="#E5E5E5"> and then I will show</font>

95
00:04:43,340 --> 00:04:49,508
you some different bypass techniques

96
00:04:45,430 --> 00:04:53,840
that are important to<font color="#E5E5E5"> be</font><font color="#CCCCCC"> abwehr up</font>

97
00:04:49,509 --> 00:04:56,659
<font color="#CCCCCC">that's the up all of the lips part and I</font>

98
00:04:53,840 --> 00:04:58,698
will<font color="#CCCCCC"> be</font><font color="#E5E5E5"> dropping on you I'm doing</font>

99
00:04:56,659 --> 00:05:00,830
quotation mark near<font color="#E5E5E5"> because I haven't</font>

100
00:04:58,699 --> 00:05:02,659
seen<font color="#E5E5E5"> it before</font><font color="#CCCCCC"> a constrained language</font>

101
00:05:00,830 --> 00:05:03,109
mode bypass so when you enable app

102
00:05:02,659 --> 00:05:05,509
Locker

103
00:05:03,110 --> 00:05:07,129
it will change<font color="#E5E5E5"> PowerShell from a full</font>

104
00:05:05,509 --> 00:05:09,770
language PowerShell in<font color="#E5E5E5"> Turkish train</font>

105
00:05:07,129 --> 00:05:13,550
mode language<font color="#CCCCCC"> PowerShell</font><font color="#E5E5E5"> so then I have</font>

106
00:05:09,770 --> 00:05:15,409
a<font color="#E5E5E5"> working bypass for for ants</font><font color="#CCCCCC"> and I will</font>

107
00:05:13,550 --> 00:05:18,349
<font color="#E5E5E5">also be releasing a PowerShell module</font>

108
00:05:15,409 --> 00:05:19,849
<font color="#E5E5E5">it's not 100% done but it's good enough</font>

109
00:05:18,349 --> 00:05:24,229
<font color="#CCCCCC">to</font><font color="#E5E5E5"> like release it here</font>

110
00:05:19,849 --> 00:05:28,729
I feel so yeah good enough<font color="#CCCCCC"> for</font><font color="#E5E5E5"> you guys</font>

111
00:05:24,229 --> 00:05:30,469
<font color="#E5E5E5">I'm just</font><font color="#CCCCCC"> kidding</font><font color="#E5E5E5"> nobody works so but I</font>

112
00:05:28,729 --> 00:05:37,878
<font color="#E5E5E5">haven't like polished it hundred percent</font>

113
00:05:30,469 --> 00:05:38,830
then<font color="#CCCCCC"> alright so app Locker</font><font color="#E5E5E5"> it's one of</font>

114
00:05:37,879 --> 00:05:41,750
Microsoft's

115
00:05:38,830 --> 00:05:44,180
<font color="#E5E5E5">whitelisting solutions basically it's a</font>

116
00:05:41,750 --> 00:05:47,569
product you<font color="#CCCCCC"> use to tell what is allowed</font>

117
00:05:44,180 --> 00:05:50,659
<font color="#CCCCCC">to run on the endpoint and not and</font>

118
00:05:47,569 --> 00:05:52,039
instead<font color="#CCCCCC"> of like telling</font><font color="#E5E5E5"> it everything it</font>

119
00:05:50,659 --> 00:05:54,199
should block<font color="#E5E5E5"> you're telling it what it's</font>

120
00:05:52,039 --> 00:05:58,729
supposed to be<font color="#CCCCCC"> allowed to</font><font color="#E5E5E5"> run that's</font>

121
00:05:54,199 --> 00:06:00,949
<font color="#E5E5E5">white listing and it's if you worked</font>

122
00:05:58,729 --> 00:06:04,159
<font color="#CCCCCC">with Microsoft</font><font color="#E5E5E5"> products from back like</font>

123
00:06:00,949 --> 00:06:05,659
XP and 2003 servers<font color="#E5E5E5"> you maybe remember</font>

124
00:06:04,159 --> 00:06:08,419
<font color="#E5E5E5">something</font><font color="#CCCCCC"> called software restriction</font>

125
00:06:05,659 --> 00:06:10,940
policies these are<font color="#CCCCCC"> app Locker it's the</font>

126
00:06:08,419 --> 00:06:12,710
version<font color="#CCCCCC"> to build</font><font color="#E5E5E5"> act so this is like the</font>

127
00:06:10,940 --> 00:06:15,800
next<font color="#E5E5E5"> generation software restriction</font>

128
00:06:12,710 --> 00:06:18,279
policy<font color="#CCCCCC"> the big</font><font color="#E5E5E5"> difference between</font>

129
00:06:15,800 --> 00:06:21,680
software restriction policy<font color="#E5E5E5"> one and two</font>

130
00:06:18,279 --> 00:06:24,889
is that<font color="#E5E5E5"> version</font><font color="#CCCCCC"> one you didn't need like</font>

131
00:06:21,680 --> 00:06:27,080
a special kind<font color="#E5E5E5"> of license but in</font><font color="#CCCCCC"> app</font>

132
00:06:24,889 --> 00:06:29,509
<font color="#CCCCCC">Locker</font><font color="#E5E5E5"> the version</font><font color="#CCCCCC"> two</font><font color="#E5E5E5"> you need</font><font color="#CCCCCC"> to have</font>

133
00:06:27,080 --> 00:06:32,300
an enterprise<font color="#E5E5E5"> or an education school in</font>

134
00:06:29,509 --> 00:06:35,930
your<font color="#CCCCCC"> windows there's a star there</font><font color="#E5E5E5"> and</font>

135
00:06:32,300 --> 00:06:36,170
that's because there is an exception<font color="#CCCCCC"> to</font>

136
00:06:35,930 --> 00:06:40,130
that

137
00:06:36,170 --> 00:06:43,970
and if you use<font color="#E5E5E5"> model management you can</font>

138
00:06:40,130 --> 00:06:46,430
<font color="#CCCCCC">actually enable</font><font color="#E5E5E5"> AppLocker through with</font>

139
00:06:43,970 --> 00:06:47,900
pro additional windows as well but you

140
00:06:46,430 --> 00:06:50,570
have<font color="#CCCCCC"> to configure</font><font color="#E5E5E5"> it differently</font><font color="#CCCCCC"> so you</font>

141
00:06:47,900 --> 00:06:52,219
have to like take<font color="#CCCCCC"> xml files and</font><font color="#E5E5E5"> embed</font>

142
00:06:50,570 --> 00:06:55,040
<font color="#E5E5E5">them in the</font><font color="#CCCCCC"> Intune</font><font color="#E5E5E5"> portal and all that</font>

143
00:06:52,220 --> 00:07:00,290
stuff but I<font color="#E5E5E5"> haven't seen anyone done it</font>

144
00:06:55,040 --> 00:07:02,540
yet but I know<font color="#E5E5E5"> it's possible and our</font>

145
00:07:00,290 --> 00:07:06,680
blocker is a part<font color="#E5E5E5"> of the defense in</font>

146
00:07:02,540 --> 00:07:09,770
depth strategy<font color="#E5E5E5"> to Microsoft so it's just</font>

147
00:07:06,680 --> 00:07:13,880
another<font color="#CCCCCC"> Oh their product to like harden</font>

148
00:07:09,770 --> 00:07:16,190
stuff as much much as<font color="#CCCCCC"> they can and you</font>

149
00:07:13,880 --> 00:07:18,409
<font color="#E5E5E5">can allow and you can deny</font><font color="#CCCCCC"> execution of</font>

150
00:07:16,190 --> 00:07:20,330
stuff<font color="#CCCCCC"> you can base it on</font><font color="#E5E5E5"> the publisher</font>

151
00:07:18,410 --> 00:07:22,520
<font color="#E5E5E5">that's the certificate if you have a</font>

152
00:07:20,330 --> 00:07:24,530
binary that's sign<font color="#E5E5E5"> you can tell it to</font>

153
00:07:22,520 --> 00:07:26,359
<font color="#E5E5E5">either allow it or deny it based on that</font>

154
00:07:24,530 --> 00:07:29,840
certificate<font color="#E5E5E5"> and that's pretty awesome</font>

155
00:07:26,360 --> 00:07:32,630
<font color="#CCCCCC">it's hard to fake or you can base it on</font>

156
00:07:29,840 --> 00:07:39,169
<font color="#E5E5E5">the hash of the file or just a path</font>

157
00:07:32,630 --> 00:07:41,390
where it's located<font color="#E5E5E5"> in the disk</font><font color="#CCCCCC"> ok</font>

158
00:07:39,170 --> 00:07:46,130
what is it what is<font color="#E5E5E5"> it what AppLocker is</font>

159
00:07:41,390 --> 00:07:47,510
not it's<font color="#E5E5E5"> not a security boundary and</font>

160
00:07:46,130 --> 00:07:50,030
there have<font color="#CCCCCC"> been</font><font color="#E5E5E5"> many</font><font color="#CCCCCC"> reports to</font>

161
00:07:47,510 --> 00:07:52,610
Microsoft<font color="#E5E5E5"> where where we have</font>

162
00:07:50,030 --> 00:07:55,609
<font color="#CCCCCC">highlighted like problems with</font><font color="#E5E5E5"> a blocker</font>

163
00:07:52,610 --> 00:07:57,650
but they always<font color="#CCCCCC"> tell this is not a</font>

164
00:07:55,610 --> 00:08:00,530
security<font color="#E5E5E5"> boundary</font><font color="#CCCCCC"> it was</font><font color="#E5E5E5"> designed for</font>

165
00:07:57,650 --> 00:08:04,039
compliance<font color="#E5E5E5"> that's what they're telling</font>

166
00:08:00,530 --> 00:08:07,940
us<font color="#CCCCCC"> but</font><font color="#E5E5E5"> it's but still it's a great</font>

167
00:08:04,040 --> 00:08:13,280
product<font color="#CCCCCC"> that I</font><font color="#E5E5E5"> really feel is new needs</font>

168
00:08:07,940 --> 00:08:15,170
<font color="#E5E5E5">to be deployed</font><font color="#CCCCCC"> more and it's if you</font><font color="#E5E5E5"> see</font>

169
00:08:13,280 --> 00:08:17,690
<font color="#E5E5E5">here this is the latest blog for</font>

170
00:08:15,170 --> 00:08:21,770
Microsoft<font color="#E5E5E5"> the criteria of getting like a</font>

171
00:08:17,690 --> 00:08:25,040
<font color="#E5E5E5">CDE or service it clearly stated here</font>

172
00:08:21,770 --> 00:08:27,049
that<font color="#CCCCCC"> AppLocker is not going to be</font>

173
00:08:25,040 --> 00:08:31,100
serviced<font color="#E5E5E5"> so this is something they don't</font>

174
00:08:27,050 --> 00:08:32,270
like<font color="#E5E5E5"> really care about but if you find a</font>

175
00:08:31,100 --> 00:08:34,220
serious enough bug there<font color="#CCCCCC"> will probably</font>

176
00:08:32,270 --> 00:08:36,228
fix it anyways but yeah it's a<font color="#E5E5E5"> different</font>

177
00:08:34,220 --> 00:08:38,600
<font color="#E5E5E5">story</font>

178
00:08:36,229 --> 00:08:41,780
<font color="#E5E5E5">and it's not</font><font color="#CCCCCC"> a true vitally whitelisting</font>

179
00:08:38,600 --> 00:08:46,340
solution to my opinion<font color="#E5E5E5"> because I try to</font>

180
00:08:41,780 --> 00:08:48,490
take<font color="#E5E5E5"> a pucker and only allow what I want</font>

181
00:08:46,340 --> 00:08:50,080
a<font color="#E5E5E5"> boon of the machine</font><font color="#CCCCCC"> I</font>

182
00:08:48,490 --> 00:08:52,450
like kind<font color="#CCCCCC"> of log what happened</font><font color="#E5E5E5"> during</font>

183
00:08:50,080 --> 00:08:54,340
logon<font color="#E5E5E5"> and I</font><font color="#CCCCCC"> whitelisted all the</font>

184
00:08:52,450 --> 00:08:57,280
different things<font color="#CCCCCC"> that ran and did up</font>

185
00:08:54,340 --> 00:09:00,580
like<font color="#E5E5E5"> 10 times and then</font><font color="#CCCCCC"> I turn on the</font>

186
00:08:57,280 --> 00:09:02,500
policy to<font color="#CCCCCC"> enforce it and it crashed</font><font color="#E5E5E5"> so</font>

187
00:09:00,580 --> 00:09:04,690
that doesn't work<font color="#CCCCCC"> and that's how a white</font>

188
00:09:02,500 --> 00:09:05,860
testing solution should work<font color="#E5E5E5"> right</font><font color="#CCCCCC"> so</font>

189
00:09:04,690 --> 00:09:07,300
there's<font color="#E5E5E5"> something in the operating</font>

190
00:09:05,860 --> 00:09:09,340
<font color="#E5E5E5">system I haven't figured</font><font color="#CCCCCC"> it out I've</font>

191
00:09:07,300 --> 00:09:12,040
reached out to Microsoft about<font color="#E5E5E5"> it but I</font>

192
00:09:09,340 --> 00:09:14,410
didn't<font color="#E5E5E5"> get any help so to me it's</font><font color="#CCCCCC"> not a</font>

193
00:09:12,040 --> 00:09:18,849
true vitalistic solution what's my

194
00:09:14,410 --> 00:09:22,870
opinion<font color="#CCCCCC"> list another</font><font color="#E5E5E5"> important thing</font>

195
00:09:18,850 --> 00:09:25,720
it's not meant to protect admins because

196
00:09:22,870 --> 00:09:30,280
if you're an admin<font color="#E5E5E5"> app Locker is easily</font>

197
00:09:25,720 --> 00:09:31,090
to bypass for real it is<font color="#E5E5E5"> I have a blog</font>

198
00:09:30,280 --> 00:09:33,430
<font color="#CCCCCC">post about it</font>

199
00:09:31,090 --> 00:09:37,240
so if you're interested<font color="#CCCCCC"> in why</font><font color="#E5E5E5"> you can</font>

200
00:09:33,430 --> 00:09:39,339
read about it there<font color="#E5E5E5"> okay so let's go</font>

201
00:09:37,240 --> 00:09:42,850
<font color="#CCCCCC">over some</font><font color="#E5E5E5"> basics let's let's configure</font>

202
00:09:39,340 --> 00:09:46,720
AppLocker policy from the<font color="#CCCCCC"> start up let</font>

203
00:09:42,850 --> 00:09:57,720
<font color="#E5E5E5">me show you how easy it is right</font><font color="#CCCCCC"> let's</font>

204
00:09:46,720 --> 00:09:57,720
see<font color="#CCCCCC"> I think I need to</font><font color="#E5E5E5"> do like duplicate</font>

205
00:09:58,110 --> 00:10:07,740
<font color="#CCCCCC">alright so everyone can see this</font><font color="#E5E5E5"> cool so</font>

206
00:10:04,560 --> 00:10:11,650
<font color="#E5E5E5">so this</font><font color="#CCCCCC"> is the</font><font color="#E5E5E5"> domain controller in</font><font color="#CCCCCC"> my</font>

207
00:10:07,740 --> 00:10:13,750
lab domain maybe it's kind of hard to

208
00:10:11,650 --> 00:10:17,079
see<font color="#CCCCCC"> in the back</font><font color="#E5E5E5"> I'm sorry</font><font color="#CCCCCC"> I don't</font><font color="#E5E5E5"> have</font>

209
00:10:13,750 --> 00:10:21,270
submit or anything so<font color="#E5E5E5"> I will tell you</font>

210
00:10:17,080 --> 00:10:23,740
what I do so I have<font color="#CCCCCC"> a predefined</font>

211
00:10:21,270 --> 00:10:26,500
<font color="#E5E5E5">organizational structure inside Active</font>

212
00:10:23,740 --> 00:10:29,710
Directory<font color="#CCCCCC"> for computers and I've</font><font color="#E5E5E5"> created</font>

213
00:10:26,500 --> 00:10:32,560
<font color="#E5E5E5">a dummy organizational unit called demo</font>

214
00:10:29,710 --> 00:10:34,560
oh you derbycon so we're gonna start

215
00:10:32,560 --> 00:10:36,939
<font color="#E5E5E5">here by just</font><font color="#CCCCCC"> creating a group policy</font>

216
00:10:34,560 --> 00:10:40,060
that<font color="#E5E5E5"> is as easy as</font><font color="#CCCCCC"> just right clicking</font>

217
00:10:36,940 --> 00:10:41,860
<font color="#E5E5E5">create a GPO</font><font color="#CCCCCC"> I'll link it here</font><font color="#E5E5E5"> there we</font>

218
00:10:40,060 --> 00:10:47,650
<font color="#E5E5E5">go just gonna call</font><font color="#CCCCCC"> it like</font><font color="#E5E5E5"> app Locker</font>

219
00:10:41,860 --> 00:10:50,980
policy<font color="#CCCCCC"> oh if I can type what's hard and</font>

220
00:10:47,650 --> 00:10:53,740
then<font color="#E5E5E5"> you just</font><font color="#CCCCCC"> right-click the policy</font><font color="#E5E5E5"> go</font>

221
00:10:50,980 --> 00:10:57,100
into edit and then you browse yourself

222
00:10:53,740 --> 00:11:01,210
down into policies<font color="#CCCCCC"> sorry Windows</font>

223
00:10:57,100 --> 00:11:02,120
settings security settings and<font color="#E5E5E5"> under the</font>

224
00:11:01,210 --> 00:11:05,360
application

225
00:11:02,120 --> 00:11:08,709
<font color="#CCCCCC">twelve settings</font><font color="#E5E5E5"> and this is where you</font>

226
00:11:05,360 --> 00:11:11,569
live<font color="#CCCCCC"> when you configure AppLocker</font>

227
00:11:08,709 --> 00:11:13,489
so here you have different<font color="#E5E5E5"> sections you</font>

228
00:11:11,569 --> 00:11:14,959
<font color="#CCCCCC">have executable rules you have Windows</font>

229
00:11:13,490 --> 00:11:19,339
installer rules you have<font color="#E5E5E5"> script girls</font>

230
00:11:14,959 --> 00:11:22,399
and you have packaged app rules<font color="#E5E5E5"> so what</font>

231
00:11:19,339 --> 00:11:24,860
you normally do<font color="#E5E5E5"> is that when I start up</font>

232
00:11:22,399 --> 00:11:28,059
policy<font color="#CCCCCC"> I just</font><font color="#E5E5E5"> right click every section</font>

233
00:11:24,860 --> 00:11:31,399
<font color="#CCCCCC">and I used to</font><font color="#E5E5E5"> create the default rules</font>

234
00:11:28,059 --> 00:11:33,319
it's a good starting point<font color="#E5E5E5"> because what</font>

235
00:11:31,399 --> 00:11:35,360
it does is that<font color="#CCCCCC"> it says that</font><font color="#E5E5E5"> an</font>

236
00:11:33,319 --> 00:11:37,430
administrator is allowed<font color="#CCCCCC"> to run</font>

237
00:11:35,360 --> 00:11:40,059
everything<font color="#E5E5E5"> on a box right that makes</font>

238
00:11:37,430 --> 00:11:42,378
<font color="#E5E5E5">sense and we have a rule</font><font color="#CCCCCC"> that allows</font>

239
00:11:40,059 --> 00:11:44,449
everything<font color="#E5E5E5"> under the windows folder to</font>

240
00:11:42,379 --> 00:11:47,720
run and<font color="#CCCCCC"> everything under the Program</font>

241
00:11:44,449 --> 00:11:50,870
<font color="#CCCCCC">Files folder</font><font color="#E5E5E5"> to run and the idea behind</font>

242
00:11:47,720 --> 00:11:52,850
this<font color="#E5E5E5"> is that</font><font color="#CCCCCC"> a normal user is not</font>

243
00:11:50,870 --> 00:11:54,079
allowed<font color="#E5E5E5"> to place files within the</font>

244
00:11:52,850 --> 00:11:57,290
<font color="#CCCCCC">Windows folder or the Program Files</font>

245
00:11:54,079 --> 00:11:59,689
folder<font color="#E5E5E5"> so you as an admin allow</font><font color="#CCCCCC"> sit by</font>

246
00:11:57,290 --> 00:12:02,149
installing software<font color="#E5E5E5"> right that make</font>

247
00:11:59,689 --> 00:12:09,259
<font color="#E5E5E5">sense so the default rules are</font><font color="#CCCCCC"> pretty</font>

248
00:12:02,149 --> 00:12:10,189
good<font color="#E5E5E5"> so just go through</font><font color="#CCCCCC"> them and there's</font>

249
00:12:09,259 --> 00:12:13,790
one thing<font color="#E5E5E5"> missing</font>

250
00:12:10,189 --> 00:12:16,759
<font color="#E5E5E5">that I see all the time and I've seen a</font>

251
00:12:13,790 --> 00:12:18,649
<font color="#E5E5E5">lot of claimed bypasses about</font><font color="#CCCCCC"> app Locker</font>

252
00:12:16,759 --> 00:12:21,499
<font color="#E5E5E5">and they haven't like configured</font>

253
00:12:18,649 --> 00:12:23,959
something called dll's<font color="#E5E5E5"> there's a section</font>

254
00:12:21,499 --> 00:12:25,449
<font color="#CCCCCC">for</font><font color="#E5E5E5"> dll's as well an app Locker is a</font>

255
00:12:23,959 --> 00:12:28,069
waste<font color="#E5E5E5"> of time if you don't enable that</font>

256
00:12:25,449 --> 00:12:31,069
so you need<font color="#E5E5E5"> to go to you right click on</font>

257
00:12:28,069 --> 00:12:34,610
<font color="#E5E5E5">app Locker go into properties go into</font>

258
00:12:31,069 --> 00:12:36,290
the advanced advanced tab here on<font color="#E5E5E5"> the</font>

259
00:12:34,610 --> 00:12:39,379
top<font color="#E5E5E5"> but then you need to</font><font color="#CCCCCC"> enable that</font>

260
00:12:36,290 --> 00:12:42,709
<font color="#E5E5E5">enable the</font><font color="#CCCCCC"> dnl rule collection</font><font color="#E5E5E5"> click</font>

261
00:12:39,379 --> 00:12:45,470
<font color="#E5E5E5">apply click</font><font color="#CCCCCC"> OK and then</font><font color="#E5E5E5"> you've got the</font>

262
00:12:42,709 --> 00:12:52,069
<font color="#E5E5E5">dll rules here as well do the same for</font>

263
00:12:45,470 --> 00:12:53,499
them<font color="#CCCCCC"> and they state here</font><font color="#E5E5E5"> that it affects</font>

264
00:12:52,069 --> 00:12:58,279
<font color="#CCCCCC">performance</font>

265
00:12:53,499 --> 00:13:00,740
<font color="#E5E5E5">it does not for real</font><font color="#CCCCCC"> ok maybe back when</font>

266
00:12:58,279 --> 00:13:04,850
we<font color="#E5E5E5"> had like Windows XP and stuff it</font>

267
00:13:00,740 --> 00:13:06,980
<font color="#CCCCCC">could affect</font><font color="#E5E5E5"> a little but today no it</font>

268
00:13:04,850 --> 00:13:11,179
doesn't affect the performance<font color="#E5E5E5"> and even</font>

269
00:13:06,980 --> 00:13:13,279
if it did I would still turn it<font color="#E5E5E5"> on all</font>

270
00:13:11,179 --> 00:13:15,319
<font color="#CCCCCC">right and after you</font><font color="#E5E5E5"> configure all the</font>

271
00:13:13,279 --> 00:13:18,439
<font color="#E5E5E5">rules</font><font color="#CCCCCC"> you need</font>

272
00:13:15,320 --> 00:13:22,040
and force them you can either do it by

273
00:13:18,440 --> 00:13:24,350
<font color="#CCCCCC">starting</font><font color="#E5E5E5"> off by just doing an audit what</font>

274
00:13:22,040 --> 00:13:26,719
will<font color="#E5E5E5"> happen</font><font color="#CCCCCC"> then is that every time a</font>

275
00:13:24,350 --> 00:13:29,209
binary runs on a client<font color="#E5E5E5"> it will log it</font>

276
00:13:26,720 --> 00:13:30,680
to the event log<font color="#E5E5E5"> so you can like take</font><font color="#CCCCCC"> it</font>

277
00:13:29,209 --> 00:13:35,660
out and see what would have been blocked

278
00:13:30,680 --> 00:13:41,620
<font color="#E5E5E5">if the rules were applied</font><font color="#CCCCCC"> and first so I</font>

279
00:13:35,660 --> 00:13:41,620
just<font color="#E5E5E5"> enforce everything like this</font>

280
00:13:42,100 --> 00:13:47,589
<font color="#E5E5E5">already now we have a pretty good</font><font color="#CCCCCC"> decent</font>

281
00:13:44,990 --> 00:13:50,630
protection<font color="#E5E5E5"> on the</font><font color="#CCCCCC"> endpoints for malware</font>

282
00:13:47,589 --> 00:13:52,160
<font color="#E5E5E5">just like that we're</font><font color="#CCCCCC"> done</font><font color="#E5E5E5"> all right</font>

283
00:13:50,630 --> 00:13:56,209
there's one<font color="#E5E5E5"> thing one more thing</font><font color="#CCCCCC"> by the</font>

284
00:13:52,160 --> 00:13:58,939
<font color="#E5E5E5">way we need a service to run that's the</font>

285
00:13:56,209 --> 00:14:01,399
<font color="#E5E5E5">application identity service this needs</font>

286
00:13:58,940 --> 00:14:03,290
also<font color="#E5E5E5"> needs to be turned on it's not on</font>

287
00:14:01,399 --> 00:14:05,959
by default<font color="#CCCCCC"> so you have to go in and</font>

288
00:14:03,290 --> 00:14:09,290
<font color="#E5E5E5">configure it define it hook it on to</font>

289
00:14:05,959 --> 00:14:11,089
automatic and boom<font color="#E5E5E5"> now the application</font>

290
00:14:09,290 --> 00:14:13,459
identity service will<font color="#CCCCCC"> start to run on</font>

291
00:14:11,089 --> 00:14:15,680
the clients and it will apply or enforce

292
00:14:13,459 --> 00:14:18,258
the<font color="#E5E5E5"> AppLocker rules and we're good to go</font>

293
00:14:15,680 --> 00:14:20,870
that's that's<font color="#E5E5E5"> how long it took to apply</font>

294
00:14:18,259 --> 00:14:23,300
of<font color="#CCCCCC"> applica policy a default</font><font color="#E5E5E5"> AppLocker</font>

295
00:14:20,870 --> 00:14:25,220
policy and then you have to deal<font color="#CCCCCC"> with</font>

296
00:14:23,300 --> 00:14:33,069
only<font color="#E5E5E5"> exceptions of course but that's</font><font color="#CCCCCC"> a</font>

297
00:14:25,220 --> 00:14:35,870
<font color="#CCCCCC">little</font><font color="#E5E5E5"> story right and when we have</font>

298
00:14:33,069 --> 00:14:38,990
enforce this policy we can<font color="#E5E5E5"> move over</font><font color="#CCCCCC"> to</font>

299
00:14:35,870 --> 00:14:40,250
a client<font color="#E5E5E5"> run</font><font color="#CCCCCC"> GP update and then you can</font>

300
00:14:38,990 --> 00:14:43,519
test it up by<font color="#E5E5E5"> just trying to run a</font>

301
00:14:40,250 --> 00:14:45,670
binary outside outside<font color="#CCCCCC"> the Program Files</font>

302
00:14:43,519 --> 00:14:47,899
<font color="#CCCCCC">folder or</font><font color="#E5E5E5"> Windows folder and it will say</font>

303
00:14:45,670 --> 00:14:50,000
<font color="#CCCCCC">say</font><font color="#E5E5E5"> that it is blocked by group policy</font>

304
00:14:47,899 --> 00:14:53,060
or you will get<font color="#E5E5E5"> a little</font><font color="#CCCCCC"> bit like this</font>

305
00:14:50,000 --> 00:14:58,639
<font color="#E5E5E5">if you double click it that's how easy</font>

306
00:14:53,060 --> 00:15:02,000
it is<font color="#E5E5E5"> there's this was the default setup</font>

307
00:14:58,639 --> 00:15:05,149
that's the one I prefer<font color="#E5E5E5"> I've tried a lot</font>

308
00:15:02,000 --> 00:15:07,220
of different<font color="#E5E5E5"> setups so you have you can</font>

309
00:15:05,149 --> 00:15:09,620
for<font color="#CCCCCC"> instance only allow different</font>

310
00:15:07,220 --> 00:15:14,300
<font color="#E5E5E5">publishers so everything's signed by</font>

311
00:15:09,620 --> 00:15:16,670
Microsoft by Google by Apple and<font color="#E5E5E5"> all the</font>

312
00:15:14,300 --> 00:15:19,099
other companies<font color="#E5E5E5"> the problem with</font><font color="#CCCCCC"> that</font>

313
00:15:16,670 --> 00:15:21,740
<font color="#E5E5E5">approach is</font><font color="#CCCCCC"> that sooner or later you'll</font>

314
00:15:19,100 --> 00:15:23,680
figure out that a lot of binaries even

315
00:15:21,740 --> 00:15:26,389
<font color="#E5E5E5">from Microsoft isn't signed</font>

316
00:15:23,680 --> 00:15:28,189
especially dll's<font color="#CCCCCC"> so</font><font color="#E5E5E5"> you will end up in a</font>

317
00:15:26,389 --> 00:15:29,089
situation<font color="#E5E5E5"> where</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> need to make</font><font color="#CCCCCC"> a lot</font>

318
00:15:28,189 --> 00:15:32,269
of<font color="#CCCCCC"> exceptions</font>

319
00:15:29,089 --> 00:15:37,069
<font color="#E5E5E5">to that baseball where you allow only</font>

320
00:15:32,269 --> 00:15:39,439
<font color="#E5E5E5">signed binaries so I don't like</font><font color="#CCCCCC"> that</font>

321
00:15:37,069 --> 00:15:40,878
<font color="#CCCCCC">approach so I always</font><font color="#E5E5E5"> end up using the</font>

322
00:15:39,439 --> 00:15:41,300
default rules because I<font color="#E5E5E5"> think that's</font>

323
00:15:40,879 --> 00:15:44,300
better

324
00:15:41,300 --> 00:15:47,599
you also have the<font color="#CCCCCC"> Kaos approach</font><font color="#E5E5E5"> that's</font>

325
00:15:44,300 --> 00:15:49,479
<font color="#E5E5E5">what I call it you can use a Parker to</font>

326
00:15:47,600 --> 00:15:52,699
automatically generate rules for you and

327
00:15:49,480 --> 00:15:55,069
it<font color="#CCCCCC"> will scan Program</font><font color="#E5E5E5"> Files and windows</font>

328
00:15:52,699 --> 00:15:57,349
folder<font color="#E5E5E5"> whatever you choose and it will</font>

329
00:15:55,069 --> 00:16:00,559
calculate the hash or<font color="#E5E5E5"> everything</font><font color="#CCCCCC"> and it</font>

330
00:15:57,350 --> 00:16:02,600
<font color="#E5E5E5">will also create one rule for</font><font color="#CCCCCC"> each file</font>

331
00:16:00,559 --> 00:16:04,699
and<font color="#CCCCCC"> it</font><font color="#E5E5E5"> will create a rule for almost</font>

332
00:16:02,600 --> 00:16:07,309
each publisher<font color="#E5E5E5"> and you end up with our</font>

333
00:16:04,699 --> 00:16:10,729
huge amount of rules<font color="#E5E5E5"> like</font><font color="#CCCCCC"> a couple</font>

334
00:16:07,309 --> 00:16:11,959
hundreds so you lose control<font color="#CCCCCC"> I don't</font>

335
00:16:10,730 --> 00:16:14,899
like that approach<font color="#E5E5E5"> I don't recommend it</font>

336
00:16:11,959 --> 00:16:17,479
at all<font color="#E5E5E5"> and there's a new new boy in</font><font color="#CCCCCC"> town</font>

337
00:16:14,899 --> 00:16:20,360
called<font color="#E5E5E5"> Aaron Locker</font><font color="#CCCCCC"> a guy Packers are</font>

338
00:16:17,480 --> 00:16:22,069
called Aaron ragosa's has created a lot

339
00:16:20,360 --> 00:16:24,769
<font color="#CCCCCC">of great scripts to automate the entire</font>

340
00:16:22,069 --> 00:16:28,040
process<font color="#E5E5E5"> I have played a little with it</font>

341
00:16:24,769 --> 00:16:29,720
<font color="#E5E5E5">and it's it's</font><font color="#CCCCCC"> freaking good so if you're</font>

342
00:16:28,040 --> 00:16:32,599
starting<font color="#E5E5E5"> out</font><font color="#CCCCCC"> with app Locker I need to</font>

343
00:16:29,720 --> 00:16:34,009
maintain<font color="#E5E5E5"> it over time I would start by</font>

344
00:16:32,600 --> 00:16:36,499
<font color="#CCCCCC">looking into Aaron Locker</font>

345
00:16:34,009 --> 00:16:44,209
let's our tip<font color="#CCCCCC"> for me</font><font color="#E5E5E5"> it's it's really</font>

346
00:16:36,499 --> 00:16:47,070
good<font color="#CCCCCC"> ok so I did a lot of</font><font color="#E5E5E5"> work to get</font>

347
00:16:44,209 --> 00:16:49,739
that<font color="#E5E5E5"> background moving</font>

348
00:16:47,070 --> 00:16:57,329
<font color="#CCCCCC">repel that</font><font color="#E5E5E5"> it's like an earthquake</font><font color="#CCCCCC"> it's</font>

349
00:16:49,740 --> 00:16:59,100
the apocalypse<font color="#E5E5E5"> you know okay so the</font>

350
00:16:57,329 --> 00:17:01,349
default<font color="#E5E5E5"> rules</font><font color="#CCCCCC"> so we have the default</font>

351
00:16:59,100 --> 00:17:06,689
<font color="#E5E5E5">path rules</font><font color="#CCCCCC"> that was the one we created</font>

352
00:17:01,350 --> 00:17:10,169
<font color="#E5E5E5">right so the problem with</font><font color="#CCCCCC"> that is there</font>

353
00:17:06,689 --> 00:17:12,120
are exceptions where a user is allowed

354
00:17:10,169 --> 00:17:16,919
<font color="#E5E5E5">to place binaries within the Windows</font>

355
00:17:12,119 --> 00:17:19,649
folder so the default<font color="#E5E5E5"> AC else</font><font color="#CCCCCC"> on Windows</font>

356
00:17:16,919 --> 00:17:21,540
<font color="#E5E5E5">isn't that good</font><font color="#CCCCCC"> so you need to harden</font>

357
00:17:19,650 --> 00:17:25,079
even more<font color="#E5E5E5"> and as you can</font><font color="#CCCCCC"> see in the</font>

358
00:17:21,540 --> 00:17:26,549
bottom<font color="#E5E5E5"> here these are you can download</font>

359
00:17:25,079 --> 00:17:28,500
something called access<font color="#CCCCCC"> check from</font>

360
00:17:26,549 --> 00:17:31,110
sysinternals<font color="#E5E5E5"> and you can run these</font>

361
00:17:28,500 --> 00:17:33,210
commands here to pipe<font color="#CCCCCC"> up every folder</font>

362
00:17:31,110 --> 00:17:35,129
<font color="#E5E5E5">you have write access to as a normal</font>

363
00:17:33,210 --> 00:17:37,410
user and if you need<font color="#E5E5E5"> to do it forever</font>

364
00:17:35,130 --> 00:17:40,190
<font color="#E5E5E5">for users everyone authenticated user</font>

365
00:17:37,410 --> 00:17:42,720
interactive to get all the a sales

366
00:17:40,190 --> 00:17:44,429
that's<font color="#E5E5E5"> an important step there's a link</font>

367
00:17:42,720 --> 00:17:49,380
<font color="#E5E5E5">there if you're too lazy to write this</font>

368
00:17:44,429 --> 00:17:51,179
out<font color="#CCCCCC"> and also third party</font><font color="#E5E5E5"> I've seen a lot</font>

369
00:17:49,380 --> 00:17:53,400
of cases where<font color="#CCCCCC"> you install a software in</font>

370
00:17:51,179 --> 00:17:56,159
Program Files<font color="#E5E5E5"> and the ACLs are all</font>

371
00:17:53,400 --> 00:17:58,080
screwed<font color="#E5E5E5"> up they forget to</font><font color="#CCCCCC"> harden it so</font>

372
00:17:56,159 --> 00:18:02,370
the user<font color="#CCCCCC"> can inject files there that's</font>

373
00:17:58,080 --> 00:18:04,408
<font color="#E5E5E5">not a good</font><font color="#CCCCCC"> thing yeah so do access check</font>

374
00:18:02,370 --> 00:18:07,070
basically<font color="#E5E5E5"> just run it see what you're</font>

375
00:18:04,409 --> 00:18:12,240
allowed<font color="#E5E5E5"> to do and you will discover</font>

376
00:18:07,070 --> 00:18:14,540
something mind-blowing<font color="#E5E5E5"> so what are you</font>

377
00:18:12,240 --> 00:18:18,179
looking<font color="#CCCCCC"> for when you're looking for</font>

378
00:18:14,540 --> 00:18:20,460
exceptions to the default ACLs or the

379
00:18:18,179 --> 00:18:22,620
weaknesses well you're looking<font color="#E5E5E5"> for</font>

380
00:18:20,460 --> 00:18:26,970
<font color="#E5E5E5">places where you can create files write</font>

381
00:18:22,620 --> 00:18:29,489
data or<font color="#E5E5E5"> create folders or append data</font>

382
00:18:26,970 --> 00:18:32,730
list folder read data<font color="#E5E5E5"> that's important</font>

383
00:18:29,490 --> 00:18:34,500
<font color="#CCCCCC">things you look for</font><font color="#E5E5E5"> and also the execute</font>

384
00:18:32,730 --> 00:18:40,710
file permission that's<font color="#CCCCCC"> our that's a good</font>

385
00:18:34,500 --> 00:18:47,730
one okay<font color="#CCCCCC"> so let's go</font><font color="#E5E5E5"> over an</font><font color="#CCCCCC"> example</font>

386
00:18:40,710 --> 00:18:52,020
here in<font color="#E5E5E5"> this example the</font><font color="#CCCCCC"> I'm sorry the</font>

387
00:18:47,730 --> 00:18:56,340
<font color="#CCCCCC">the user is part of the users group and</font>

388
00:18:52,020 --> 00:18:59,600
the<font color="#CCCCCC"> users group has</font><font color="#E5E5E5"> access to the folder</font>

389
00:18:56,340 --> 00:19:02,059
under<font color="#E5E5E5"> the dummy folder called only files</font>

390
00:18:59,600 --> 00:19:04,520
where he<font color="#E5E5E5"> is allowed to only create files</font>

391
00:19:02,059 --> 00:19:08,090
and write data<font color="#E5E5E5"> that's the only</font>

392
00:19:04,520 --> 00:19:09,860
permission<font color="#E5E5E5"> he has right okay so it's not</font>

393
00:19:08,090 --> 00:19:16,340
<font color="#E5E5E5">allowed to execute anything</font><font color="#CCCCCC"> he's only</font>

394
00:19:09,860 --> 00:19:18,649
allowed to write data but there are two

395
00:19:16,340 --> 00:19:22,459
different approaches you<font color="#E5E5E5"> can do to use</font>

396
00:19:18,650 --> 00:19:25,340
this to bypass a blocker<font color="#E5E5E5"> okay you ready</font>

397
00:19:22,460 --> 00:19:27,559
so the just to prove my<font color="#CCCCCC"> point Harris</font>

398
00:19:25,340 --> 00:19:30,230
<font color="#E5E5E5">under under the</font><font color="#CCCCCC"> C tools folder on this</font>

399
00:19:27,559 --> 00:19:32,720
<font color="#E5E5E5">computer</font><font color="#CCCCCC"> you can clearly see that it</font>

400
00:19:30,230 --> 00:19:35,630
AppLocker blocks execution right

401
00:19:32,720 --> 00:19:38,510
even though authenticated user has the

402
00:19:35,630 --> 00:19:40,580
<font color="#CCCCCC">ACLs or read and execute</font><font color="#E5E5E5"> so you can</font>

403
00:19:38,510 --> 00:19:41,179
clearly see<font color="#CCCCCC"> that it's a blocker that is</font>

404
00:19:40,580 --> 00:19:44,720
<font color="#E5E5E5">blocking me</font>

405
00:19:41,179 --> 00:19:47,419
not the ACLs<font color="#CCCCCC"> okay and we know that we</font>

406
00:19:44,720 --> 00:19:51,200
can<font color="#E5E5E5"> create files</font><font color="#CCCCCC"> on into</font><font color="#E5E5E5"> that folder so</font>

407
00:19:47,419 --> 00:19:53,390
normally<font color="#E5E5E5"> you just try to copy the file</font>

408
00:19:51,200 --> 00:19:55,880
<font color="#E5E5E5">into the Program Files folder and try to</font>

409
00:19:53,390 --> 00:19:57,409
execute<font color="#E5E5E5"> it and as you</font><font color="#CCCCCC"> can see I have a</font>

410
00:19:55,880 --> 00:19:59,570
different error message<font color="#E5E5E5"> it's not</font>

411
00:19:57,409 --> 00:20:02,450
<font color="#E5E5E5">AppLocker blocking me now it's</font><font color="#CCCCCC"> DAC else</font>

412
00:19:59,570 --> 00:20:04,789
<font color="#E5E5E5">okay so a</font><font color="#CCCCCC"> procore approved it but the</font>

413
00:20:02,450 --> 00:20:07,580
<font color="#E5E5E5">ACLs blocked me</font><font color="#CCCCCC"> there are two ways</font><font color="#E5E5E5"> for</font>

414
00:20:04,789 --> 00:20:10,309
<font color="#CCCCCC">getting around this so the one I think</font>

415
00:20:07,580 --> 00:20:13,250
it's the coolest<font color="#E5E5E5"> one</font><font color="#CCCCCC"> is to use something</font>

416
00:20:10,309 --> 00:20:15,889
<font color="#E5E5E5">called hard links so instead</font><font color="#CCCCCC"> of copying</font>

417
00:20:13,250 --> 00:20:18,919
a file you can<font color="#CCCCCC"> use</font><font color="#E5E5E5"> either</font><font color="#CCCCCC"> FS you tail or</font>

418
00:20:15,890 --> 00:20:20,990
<font color="#CCCCCC">m'kay link to</font><font color="#E5E5E5"> create the hard link where</font>

419
00:20:18,919 --> 00:20:24,559
<font color="#E5E5E5">you create like a fake file called</font>

420
00:20:20,990 --> 00:20:26,330
something<font color="#E5E5E5"> else whatever linked</font><font color="#CCCCCC"> order</font>

421
00:20:24,559 --> 00:20:28,879
<font color="#CCCCCC">runs</font><font color="#E5E5E5"> and then you link it to the</font>

422
00:20:26,330 --> 00:20:31,939
original<font color="#E5E5E5"> file</font><font color="#CCCCCC"> and when you then try to</font>

423
00:20:28,880 --> 00:20:33,500
execute<font color="#E5E5E5"> the hard link file</font><font color="#CCCCCC"> that blocker</font>

424
00:20:31,940 --> 00:20:35,480
will say<font color="#E5E5E5"> okay you're trying to execute</font>

425
00:20:33,500 --> 00:20:38,390
from Program Files<font color="#CCCCCC"> we're good to go</font>

426
00:20:35,480 --> 00:20:41,299
<font color="#E5E5E5">and then the air it will redirect</font>

427
00:20:38,390 --> 00:20:45,490
execution to<font color="#CCCCCC"> the folder I have execution</font>

428
00:20:41,299 --> 00:20:50,570
rights on so it will pop up<font color="#E5E5E5"> magically</font>

429
00:20:45,490 --> 00:20:53,090
that's pretty cool so another way of

430
00:20:50,570 --> 00:20:56,178
<font color="#CCCCCC">doing this</font><font color="#E5E5E5"> and this example I'm using</font>

431
00:20:53,090 --> 00:20:58,730
folders<font color="#E5E5E5"> but it could be files as well so</font>

432
00:20:56,179 --> 00:21:01,460
in this example I<font color="#E5E5E5"> have the create folder</font>

433
00:20:58,730 --> 00:21:04,370
right and the permission<font color="#E5E5E5"> to read them as</font>

434
00:21:01,460 --> 00:21:08,179
well so<font color="#CCCCCC"> what you can do you can create a</font>

435
00:21:04,370 --> 00:21:12,290
<font color="#E5E5E5">folder um under that folder so</font><font color="#CCCCCC"> we</font><font color="#E5E5E5"> create</font>

436
00:21:08,179 --> 00:21:13,270
a new<font color="#CCCCCC"> folder called create great folders</font>

437
00:21:12,290 --> 00:21:16,300
right

438
00:21:13,270 --> 00:21:19,240
and if I check the<font color="#CCCCCC"> ACLS</font>

439
00:21:16,300 --> 00:21:21,490
<font color="#E5E5E5">afterwards I don't have any rights on</font>

440
00:21:19,240 --> 00:21:22,150
<font color="#E5E5E5">that folder so I'm not allowed to do</font>

441
00:21:21,490 --> 00:21:28,270
anything<font color="#E5E5E5"> with it</font>

442
00:21:22,150 --> 00:21:30,880
<font color="#E5E5E5">right wrong because if</font><font color="#CCCCCC"> I run I cattles</font>

443
00:21:28,270 --> 00:21:37,000
<font color="#E5E5E5">and grant everyone permission</font><font color="#CCCCCC"> I'm</font>

444
00:21:30,880 --> 00:21:41,170
allowed to<font color="#E5E5E5"> actually add rights but</font><font color="#CCCCCC"> it's</font>

445
00:21:37,000 --> 00:21:45,970
<font color="#CCCCCC">not</font><font color="#E5E5E5"> strange it's not it this is by the</font>

446
00:21:41,170 --> 00:21:48,580
<font color="#E5E5E5">sign you may be going like</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> that was</font>

447
00:21:45,970 --> 00:21:51,100
to be reaction I was hoping for<font color="#E5E5E5"> okay so</font>

448
00:21:48,580 --> 00:21:53,919
what is this evil sorcery<font color="#CCCCCC"> it's basically</font>

449
00:21:51,100 --> 00:21:56,530
the thing that in<font color="#E5E5E5"> Windows</font><font color="#CCCCCC"> that you have</font>

450
00:21:53,920 --> 00:21:58,690
<font color="#E5E5E5">something called an owner so every time</font>

451
00:21:56,530 --> 00:22:02,290
<font color="#CCCCCC">our user creates something</font><font color="#E5E5E5"> you become</font>

452
00:21:58,690 --> 00:22:06,460
<font color="#CCCCCC">the owner of</font><font color="#E5E5E5"> that object and if you look</font>

453
00:22:02,290 --> 00:22:09,370
it up on<font color="#CCCCCC"> TechNet it clearly states under</font>

454
00:22:06,460 --> 00:22:11,230
the<font color="#E5E5E5"> how permissions work an owner of an</font>

455
00:22:09,370 --> 00:22:14,889
object<font color="#E5E5E5"> always has the ability</font><font color="#CCCCCC"> to read</font>

456
00:22:11,230 --> 00:22:18,400
<font color="#CCCCCC">and change permissions on the object</font><font color="#E5E5E5"> aha</font>

457
00:22:14,890 --> 00:22:19,930
<font color="#CCCCCC">so I as an owner can actually change</font>

458
00:22:18,400 --> 00:22:20,500
everything<font color="#E5E5E5"> on that</font><font color="#CCCCCC"> object so</font><font color="#E5E5E5"> that's</font>

459
00:22:19,930 --> 00:22:23,980
pretty cool

460
00:22:20,500 --> 00:22:25,450
so I<font color="#E5E5E5"> just as I did I changed the</font><font color="#CCCCCC"> ACLs so</font>

461
00:22:23,980 --> 00:22:28,420
now I can<font color="#E5E5E5"> just copy the file in and</font>

462
00:22:25,450 --> 00:22:31,930
<font color="#E5E5E5">execute it you</font><font color="#CCCCCC"> see the bypass so that's</font>

463
00:22:28,420 --> 00:22:33,820
something<font color="#E5E5E5"> to think of so you might</font><font color="#CCCCCC"> be</font>

464
00:22:31,930 --> 00:22:36,580
<font color="#CCCCCC">going</font><font color="#E5E5E5"> like</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> when you start to look</font>

465
00:22:33,820 --> 00:22:38,350
at<font color="#E5E5E5"> the ACLs on the windows because you</font>

466
00:22:36,580 --> 00:22:40,629
will<font color="#E5E5E5"> find out there's plenty</font><font color="#CCCCCC"> of folders</font>

467
00:22:38,350 --> 00:22:43,719
where a user actually has rights<font color="#CCCCCC"> I have</font>

468
00:22:40,630 --> 00:22:46,990
mapped out most of them and<font color="#E5E5E5"> describe the</font>

469
00:22:43,720 --> 00:22:48,280
different techniques<font color="#E5E5E5"> you can use so</font>

470
00:22:46,990 --> 00:22:52,630
<font color="#E5E5E5">there's a link</font><font color="#CCCCCC"> there at the bottom</font>

471
00:22:48,280 --> 00:22:56,050
I love<font color="#CCCCCC"> Deadpool</font><font color="#E5E5E5"> by the way he's cool</font>

472
00:22:52,630 --> 00:22:58,270
and<font color="#E5E5E5"> to my big surprise</font><font color="#CCCCCC"> that's not the</font>

473
00:22:56,050 --> 00:23:00,450
only place to start<font color="#E5E5E5"> even more if you</font>

474
00:22:58,270 --> 00:23:03,030
have deployed configuration manager

475
00:23:00,450 --> 00:23:08,830
anybody hair<font color="#CCCCCC"> users configuration manager</font>

476
00:23:03,030 --> 00:23:12,850
so cool there's even more folders under

477
00:23:08,830 --> 00:23:15,280
there you<font color="#E5E5E5"> need to protect so it's pretty</font>

478
00:23:12,850 --> 00:23:19,179
easy<font color="#CCCCCC"> to bypass</font><font color="#E5E5E5"> if you like look</font><font color="#CCCCCC"> for the</font>

479
00:23:15,280 --> 00:23:21,670
right things so<font color="#CCCCCC"> yeah SCCM</font><font color="#E5E5E5"> something to</font>

480
00:23:19,180 --> 00:23:24,520
think about<font color="#CCCCCC"> fan when it comes to third</font>

481
00:23:21,670 --> 00:23:26,080
party here's an example of a bypass<font color="#E5E5E5"> I</font>

482
00:23:24,520 --> 00:23:27,580
found<font color="#CCCCCC"> Reese</font>

483
00:23:26,080 --> 00:23:30,879
<font color="#E5E5E5">not that recently like a half year ago</font>

484
00:23:27,580 --> 00:23:33,850
<font color="#CCCCCC">or something around</font><font color="#E5E5E5"> TeamViewer they</font>

485
00:23:30,880 --> 00:23:37,630
screwed up<font color="#CCCCCC"> the rights</font><font color="#E5E5E5"> so they have</font>

486
00:23:33,850 --> 00:23:39,580
actually read and write access to some

487
00:23:37,630 --> 00:23:42,490
large files under<font color="#E5E5E5"> the TeamViewer folder</font>

488
00:23:39,580 --> 00:23:44,649
and you<font color="#CCCCCC"> can either</font><font color="#E5E5E5"> just pipe an exit</font>

489
00:23:42,490 --> 00:23:46,120
file into<font color="#E5E5E5"> that file or you can I used</font>

490
00:23:44,650 --> 00:23:46,780
ultimate data streams because I think

491
00:23:46,120 --> 00:23:49,479
<font color="#E5E5E5">that's cool</font>

492
00:23:46,780 --> 00:23:51,700
so I had a<font color="#CCCCCC"> B gene for hair as an example</font>

493
00:23:49,480 --> 00:23:55,120
into<font color="#E5E5E5"> the stream</font><font color="#CCCCCC"> of that file</font><font color="#E5E5E5"> and then we</font>

494
00:23:51,700 --> 00:23:59,800
can execute it directly<font color="#E5E5E5"> so</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> tweet it</font>

495
00:23:55,120 --> 00:24:01,360
out<font color="#E5E5E5"> and</font><font color="#CCCCCC"> they fixed it so that's cool all</font>

496
00:23:59,800 --> 00:24:06,669
<font color="#CCCCCC">right</font>

497
00:24:01,360 --> 00:24:12,939
let<font color="#E5E5E5"> me quickly show</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> see I can show</font>

498
00:24:06,670 --> 00:24:17,140
you a bypass let's take<font color="#CCCCCC"> look you can</font><font color="#E5E5E5"> use</font>

499
00:24:12,940 --> 00:24:19,150
the older data<font color="#E5E5E5"> stream okay let me just</font>

500
00:24:17,140 --> 00:24:21,310
fire up my<font color="#E5E5E5"> good old friend</font>

501
00:24:19,150 --> 00:24:24,610
<font color="#E5E5E5">come on prompt so I'm logged in as a</font>

502
00:24:21,310 --> 00:24:26,500
normal user here so under the I think

503
00:24:24,610 --> 00:24:30,340
<font color="#E5E5E5">it's the temp folder</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> prepare it yeah</font><font color="#CCCCCC"> I</font>

504
00:24:26,500 --> 00:24:32,590
have<font color="#CCCCCC"> older on sexy right</font><font color="#E5E5E5"> hopefully</font><font color="#CCCCCC"> I'm</font>

505
00:24:30,340 --> 00:24:36,159
not allowed to<font color="#CCCCCC"> run it</font><font color="#E5E5E5"> it's blocked cool</font>

506
00:24:32,590 --> 00:24:37,300
so a cool thing<font color="#CCCCCC"> you can do with all the</font>

507
00:24:36,160 --> 00:24:41,170
data<font color="#CCCCCC"> streams is that you can actually</font>

508
00:24:37,300 --> 00:24:45,360
<font color="#E5E5E5">take take the file and</font><font color="#CCCCCC"> then</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> can pipe</font>

509
00:24:41,170 --> 00:24:53,170
it<font color="#CCCCCC"> to for</font><font color="#E5E5E5"> instance see</font><font color="#CCCCCC"> Windows tracing</font>

510
00:24:45,360 --> 00:24:55,479
or<font color="#E5E5E5"> Excel and now I place the file on the</font>

511
00:24:53,170 --> 00:24:57,640
<font color="#CCCCCC">Steven of tracing</font><font color="#E5E5E5"> but you cannot see it</font>

512
00:24:55,480 --> 00:24:59,530
<font color="#CCCCCC">it's in swim on that folder so it's</font>

513
00:24:57,640 --> 00:25:04,260
pretty<font color="#E5E5E5"> good hidden so if I go into</font>

514
00:24:59,530 --> 00:25:04,260
Explorer<font color="#CCCCCC"> let's see here</font>

515
00:25:06,720 --> 00:25:13,930
there's<font color="#CCCCCC"> no okay</font><font color="#E5E5E5"> so here's</font><font color="#CCCCCC"> our has a</font>

516
00:25:08,980 --> 00:25:15,910
little leftovers<font color="#CCCCCC"> from</font><font color="#E5E5E5"> my playtime</font><font color="#CCCCCC"> but</font>

517
00:25:13,930 --> 00:25:17,950
there's nothing to<font color="#E5E5E5"> see here basically it</font>

518
00:25:15,910 --> 00:25:20,350
it doesn't<font color="#E5E5E5"> state there's a exit file</font>

519
00:25:17,950 --> 00:25:22,600
<font color="#E5E5E5">connected to the folder</font><font color="#CCCCCC"> so the only way</font>

520
00:25:20,350 --> 00:25:25,179
<font color="#E5E5E5">to see it is</font><font color="#CCCCCC"> to do it</font><font color="#E5E5E5"> dear</font><font color="#CCCCCC"> are and</font>

521
00:25:22,600 --> 00:25:26,469
there's probably multiple things into

522
00:25:25,180 --> 00:25:29,350
that folder right now because<font color="#E5E5E5"> I have</font>

523
00:25:26,470 --> 00:25:34,780
used its computer a lot so let's just

524
00:25:29,350 --> 00:25:38,350
look Oh Tracy<font color="#E5E5E5"> so here you can see</font>

525
00:25:34,780 --> 00:25:41,560
the different streams that's<font color="#CCCCCC"> NTFS</font><font color="#E5E5E5"> as a</font>

526
00:25:38,350 --> 00:25:45,270
feature NTFS<font color="#E5E5E5"> so this you can actually</font>

527
00:25:41,560 --> 00:25:58,560
<font color="#E5E5E5">execute</font><font color="#CCCCCC"> you're saying for instance</font>

528
00:25:45,270 --> 00:26:01,379
<font color="#CCCCCC">Viereck its</font><font color="#E5E5E5"> tracing order</font><font color="#CCCCCC"> Lexi</font><font color="#E5E5E5"> and boom</font>

529
00:25:58,560 --> 00:26:05,020
<font color="#E5E5E5">we're running</font><font color="#CCCCCC"> order runs from a</font><font color="#E5E5E5"> folder</font>

530
00:26:01,380 --> 00:26:07,570
<font color="#CCCCCC">that Piazza and the problem is when you</font>

531
00:26:05,020 --> 00:26:09,400
create blocking rules because you want

532
00:26:07,570 --> 00:26:10,810
<font color="#E5E5E5">to block like tracing the tracing Foley</font>

533
00:26:09,400 --> 00:26:12,430
you want to block that<font color="#CCCCCC"> from</font><font color="#E5E5E5"> execution</font>

534
00:26:10,810 --> 00:26:13,750
right<font color="#E5E5E5"> but the problem</font><font color="#CCCCCC"> is you have to</font>

535
00:26:12,430 --> 00:26:15,430
<font color="#CCCCCC">think</font><font color="#E5E5E5"> of the open data streams as well</font>

536
00:26:13,750 --> 00:26:25,930
<font color="#E5E5E5">and this is something people tend to</font>

537
00:26:15,430 --> 00:26:28,240
forget so I will show<font color="#E5E5E5"> you so what I</font>

538
00:26:25,930 --> 00:26:31,690
<font color="#E5E5E5">prefer to do is to instead</font><font color="#CCCCCC"> of having</font>

539
00:26:28,240 --> 00:26:33,670
<font color="#CCCCCC">bung Group Policy</font><font color="#E5E5E5"> where I shove in all</font>

540
00:26:31,690 --> 00:26:35,770
the<font color="#CCCCCC"> whitelisting rules and all the</font>

541
00:26:33,670 --> 00:26:38,920
blocking rules and all that<font color="#E5E5E5"> stuff</font><font color="#CCCCCC"> I like</font>

542
00:26:35,770 --> 00:26:41,230
to create different<font color="#E5E5E5"> group policies so I</font>

543
00:26:38,920 --> 00:26:43,330
create one<font color="#E5E5E5"> on the top that</font><font color="#CCCCCC"> are the</font>

544
00:26:41,230 --> 00:26:46,600
<font color="#CCCCCC">whitelisting rules mostly</font><font color="#E5E5E5"> the default</font>

545
00:26:43,330 --> 00:26:48,100
rules<font color="#E5E5E5"> with some tweaks and then I create</font>

546
00:26:46,600 --> 00:26:50,260
different blocking rules for the

547
00:26:48,100 --> 00:26:53,350
different<font color="#E5E5E5"> things</font><font color="#CCCCCC"> that way I have full</font>

548
00:26:50,260 --> 00:26:56,200
<font color="#E5E5E5">control over each thing so if all that</font>

549
00:26:53,350 --> 00:26:58,030
<font color="#E5E5E5">was a</font><font color="#CCCCCC"> HC path that was blocked</font><font color="#E5E5E5"> okay let</font>

550
00:26:56,200 --> 00:27:00,550
me look<font color="#E5E5E5"> and then I go straightly in here</font>

551
00:26:58,030 --> 00:27:05,399
and I'll<font color="#CCCCCC"> find it easy so that that's a</font>

552
00:27:00,550 --> 00:27:08,790
good practice<font color="#CCCCCC"> at least</font><font color="#E5E5E5"> in my</font><font color="#CCCCCC"> opinion</font><font color="#E5E5E5"> and</font>

553
00:27:05,400 --> 00:27:12,370
<font color="#E5E5E5">so here's an example of blocking rules</font>

554
00:27:08,790 --> 00:27:14,470
<font color="#CCCCCC">and you cannot see it here</font><font color="#E5E5E5"> but because I</font>

555
00:27:12,370 --> 00:27:16,600
have not included<font color="#E5E5E5"> the ultimate data</font>

556
00:27:14,470 --> 00:27:20,380
stream blocking rules yet<font color="#CCCCCC"> so this will</font>

557
00:27:16,600 --> 00:27:23,020
not block the demo I<font color="#CCCCCC"> just showed this</font>

558
00:27:20,380 --> 00:27:26,950
will still allow me to use ultimate<font color="#CCCCCC"> data</font>

559
00:27:23,020 --> 00:27:29,740
stream to execute so what you need<font color="#E5E5E5"> to do</font>

560
00:27:26,950 --> 00:27:33,220
is to block<font color="#CCCCCC"> all potato strips as well</font>

561
00:27:29,740 --> 00:27:35,050
<font color="#E5E5E5">so a normal rule will look like this on</font>

562
00:27:33,220 --> 00:27:38,590
the right<font color="#E5E5E5"> side and on the left</font><font color="#CCCCCC"> side</font><font color="#E5E5E5"> you</font>

563
00:27:35,050 --> 00:27:40,149
can<font color="#CCCCCC"> see I've added a colon and a star so</font>

564
00:27:38,590 --> 00:27:41,889
<font color="#E5E5E5">you need to do that in</font><font color="#CCCCCC"> order to</font><font color="#E5E5E5"> block</font>

565
00:27:40,150 --> 00:27:44,050
alternate data streams for executing<font color="#E5E5E5"> so</font>

566
00:27:41,890 --> 00:27:45,390
that's an important step<font color="#E5E5E5"> so there's a</font>

567
00:27:44,050 --> 00:27:47,340
great block by

568
00:27:45,390 --> 00:27:50,280
<font color="#CCCCCC">geha</font><font color="#E5E5E5"> stinger</font>

569
00:27:47,340 --> 00:27:54,389
about about<font color="#E5E5E5"> this</font><font color="#CCCCCC"> problem</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> I</font>

570
00:27:50,280 --> 00:27:56,250
recommend<font color="#E5E5E5"> that you read</font><font color="#CCCCCC"> okay</font>

571
00:27:54,390 --> 00:27:57,480
when it comes to third<font color="#E5E5E5"> party what I</font>

572
00:27:56,250 --> 00:28:01,350
normally<font color="#E5E5E5"> recommend is that you contact</font>

573
00:27:57,480 --> 00:28:03,720
the developer or<font color="#E5E5E5"> their company in this</font>

574
00:28:01,350 --> 00:28:06,240
<font color="#E5E5E5">case where I had the team here I can</font>

575
00:28:03,720 --> 00:28:08,370
<font color="#E5E5E5">contact them over Twitter and I said all</font>

576
00:28:06,240 --> 00:28:10,980
<font color="#E5E5E5">you have to do</font><font color="#CCCCCC"> their TeamViewer is</font><font color="#E5E5E5"> to</font>

577
00:28:08,370 --> 00:28:14,669
block execution on that<font color="#E5E5E5"> file</font><font color="#CCCCCC"> and we're</font>

578
00:28:10,980 --> 00:28:19,080
good to<font color="#CCCCCC"> go</font><font color="#E5E5E5"> so they did</font><font color="#CCCCCC"> that they added a</font>

579
00:28:14,670 --> 00:28:20,460
specific deny<font color="#E5E5E5"> execution on that</font><font color="#CCCCCC"> pile so</font>

580
00:28:19,080 --> 00:28:23,189
even though you<font color="#CCCCCC"> have write access you</font>

581
00:28:20,460 --> 00:28:28,260
cannot use<font color="#CCCCCC"> it to execute</font><font color="#E5E5E5"> anything so</font>

582
00:28:23,190 --> 00:28:32,400
that's<font color="#E5E5E5"> a proposed fix okay so that was</font>

583
00:28:28,260 --> 00:28:34,020
<font color="#E5E5E5">the</font><font color="#CCCCCC"> default path rules</font><font color="#E5E5E5"> so now you see</font>

584
00:28:32,400 --> 00:28:35,820
<font color="#E5E5E5">the problems with that and what you need</font>

585
00:28:34,020 --> 00:28:39,900
<font color="#E5E5E5">to harden and what you can use to bypass</font>

586
00:28:35,820 --> 00:28:41,879
it<font color="#E5E5E5"> let's skip over to script rules so</font>

587
00:28:39,900 --> 00:28:44,820
what you can do with script rules is

588
00:28:41,880 --> 00:28:46,950
<font color="#CCCCCC">that if you have our environment that</font>

589
00:28:44,820 --> 00:28:49,050
<font color="#E5E5E5">has</font><font color="#CCCCCC"> upgraded from</font><font color="#E5E5E5"> Windows 10 earlier</font>

590
00:28:46,950 --> 00:28:51,780
<font color="#CCCCCC">built to newer builds</font><font color="#E5E5E5"> you will probably</font>

591
00:28:49,050 --> 00:28:53,940
have PowerShell version<font color="#CCCCCC"> 2 meaning</font><font color="#E5E5E5"> that</font>

592
00:28:51,780 --> 00:28:57,780
you can start<font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> attack version</font>

593
00:28:53,940 --> 00:29:00,720
<font color="#E5E5E5">2 and this will bypass an important</font>

594
00:28:57,780 --> 00:29:03,870
function called<font color="#CCCCCC"> constraint language mode</font>

595
00:29:00,720 --> 00:29:05,370
which locks down<font color="#E5E5E5"> PowerShell so if</font><font color="#CCCCCC"> you've</font>

596
00:29:03,870 --> 00:29:07,080
run PowerShell version 2<font color="#CCCCCC"> it will</font>

597
00:29:05,370 --> 00:29:08,729
<font color="#E5E5E5">actually run in full language mode</font>

598
00:29:07,080 --> 00:29:11,240
meaning<font color="#E5E5E5"> that you can add things into</font>

599
00:29:08,730 --> 00:29:13,980
memory and do all<font color="#CCCCCC"> sorts of nasty stuff</font>

600
00:29:11,240 --> 00:29:16,050
so an another cool<font color="#CCCCCC"> thing when you do</font>

601
00:29:13,980 --> 00:29:17,760
this as an attacker is it<font color="#E5E5E5"> doesn't get</font>

602
00:29:16,050 --> 00:29:21,480
<font color="#CCCCCC">logged</font><font color="#E5E5E5"> because PowerShell version 2</font>

603
00:29:17,760 --> 00:29:23,610
didn't have logging so so you need to

604
00:29:21,480 --> 00:29:25,700
you need<font color="#CCCCCC"> to remove</font><font color="#E5E5E5"> that stuff if you</font>

605
00:29:23,610 --> 00:29:27,479
want to be safe

606
00:29:25,700 --> 00:29:30,680
fortunately the newest version of

607
00:29:27,480 --> 00:29:34,860
Windows 10<font color="#E5E5E5"> when you install</font><font color="#CCCCCC"> it you know</font>

608
00:29:30,680 --> 00:29:36,990
<font color="#E5E5E5">18:03 it doesn't include version 2 it's</font>

609
00:29:34,860 --> 00:29:38,340
off by default now<font color="#E5E5E5"> so that that's a good</font>

610
00:29:36,990 --> 00:29:41,280
<font color="#CCCCCC">thing</font><font color="#E5E5E5"> but if you</font><font color="#CCCCCC"> have an environment</font>

611
00:29:38,340 --> 00:29:46,500
<font color="#CCCCCC">that</font><font color="#E5E5E5"> has</font><font color="#CCCCCC"> been upgraded over</font><font color="#E5E5E5"> time you can</font>

612
00:29:41,280 --> 00:29:49,410
<font color="#CCCCCC">still see it so yeah so the proposed</font><font color="#E5E5E5"> fix</font>

613
00:29:46,500 --> 00:29:51,210
<font color="#E5E5E5">is of course to remove it so the coolest</font>

614
00:29:49,410 --> 00:29:53,790
way is to use PowerShell<font color="#E5E5E5"> to remove</font>

615
00:29:51,210 --> 00:29:57,930
version<font color="#CCCCCC"> 2 a PowerShell of course that's</font>

616
00:29:53,790 --> 00:29:59,639
<font color="#E5E5E5">the</font><font color="#CCCCCC"> first</font><font color="#E5E5E5"> fix from a friend</font><font color="#CCCCCC"> mat so yeah</font>

617
00:29:57,930 --> 00:30:00,600
<font color="#E5E5E5">there's</font><font color="#CCCCCC"> plenty of</font><font color="#E5E5E5"> ways to remove it the</font>

618
00:29:59,640 --> 00:30:06,450
important thing is<font color="#E5E5E5"> just</font>

619
00:30:00,600 --> 00:30:08,840
remember to<font color="#E5E5E5"> remove it there was a blog</font>

620
00:30:06,450 --> 00:30:12,240
post like just a couple of<font color="#E5E5E5"> weeks ago</font>

621
00:30:08,840 --> 00:30:15,050
where someone<font color="#E5E5E5"> a brilliant guy called</font>

622
00:30:12,240 --> 00:30:18,480
Adam Chester<font color="#CCCCCC"> found a bypass</font><font color="#E5E5E5"> for</font>

623
00:30:15,050 --> 00:30:21,090
<font color="#E5E5E5">Castilian language mode he did a lot</font><font color="#CCCCCC"> of</font>

624
00:30:18,480 --> 00:30:27,270
stuff I<font color="#E5E5E5"> mean wow it's a really really</font>

625
00:30:21,090 --> 00:30:29,189
good<font color="#E5E5E5"> blog post so it bypasses he managed</font>

626
00:30:27,270 --> 00:30:31,889
<font color="#CCCCCC">to bypass cuz to end language mode in</font>

627
00:30:29,190 --> 00:30:36,210
the environment<font color="#E5E5E5"> he was in and I talked</font>

628
00:30:31,890 --> 00:30:38,970
<font color="#E5E5E5">to him before he published it and one</font>

629
00:30:36,210 --> 00:30:41,550
thing that<font color="#E5E5E5"> maybe it didn't get people</font>

630
00:30:38,970 --> 00:30:45,030
saw was that<font color="#E5E5E5"> if you enable DLL rules</font>

631
00:30:41,550 --> 00:30:47,520
<font color="#E5E5E5">this will actually be blocked</font><font color="#CCCCCC"> so even</font>

632
00:30:45,030 --> 00:30:49,379
though it's a bypass if you correct if

633
00:30:47,520 --> 00:30:51,960
we configure it correctly<font color="#E5E5E5"> this would</font>

634
00:30:49,380 --> 00:30:56,280
have<font color="#E5E5E5"> been blocked because you want the</font><font color="#CCCCCC"> y</font>

635
00:30:51,960 --> 00:30:58,020
<font color="#CCCCCC">ll</font><font color="#E5E5E5"> rules enabled and that's why so what</font>

636
00:30:56,280 --> 00:31:00,420
it could do it could actually load up<font color="#E5E5E5"> a</font>

637
00:30:58,020 --> 00:31:02,820
<font color="#CCCCCC">DLL using</font><font color="#E5E5E5"> PowerShell it from constrained</font>

638
00:31:00,420 --> 00:31:04,500
language mode<font color="#E5E5E5"> we found out it's pretty</font>

639
00:31:02,820 --> 00:31:07,139
<font color="#E5E5E5">it's a</font><font color="#CCCCCC"> pretty clever clever move still</font>

640
00:31:04,500 --> 00:31:09,000
and it's a great<font color="#E5E5E5"> white up so it was just</font>

641
00:31:07,140 --> 00:31:10,700
<font color="#E5E5E5">that I need to highlight that if you</font>

642
00:31:09,000 --> 00:31:16,380
configure<font color="#E5E5E5"> it correctly it will not work</font>

643
00:31:10,700 --> 00:31:19,640
<font color="#E5E5E5">but</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> have something</font><font color="#CCCCCC"> else so I started</font>

644
00:31:16,380 --> 00:31:22,740
to look at<font color="#E5E5E5"> preparing for this session</font>

645
00:31:19,640 --> 00:31:24,720
like early<font color="#CCCCCC"> this</font><font color="#E5E5E5"> summer</font><font color="#CCCCCC"> I was looking at</font>

646
00:31:22,740 --> 00:31:27,030
<font color="#CCCCCC">well every time I start PowerShell</font><font color="#E5E5E5"> when</font>

647
00:31:24,720 --> 00:31:30,900
I have a blocker enabled if there's an

648
00:31:27,030 --> 00:31:33,720
error saying that the PSM one file and

649
00:31:30,900 --> 00:31:36,270
the<font color="#CCCCCC"> ps1 file under</font><font color="#E5E5E5"> the temp folder was</font>

650
00:31:33,720 --> 00:31:41,430
prevented from running and I got curious

651
00:31:36,270 --> 00:31:44,610
<font color="#E5E5E5">what is this</font><font color="#CCCCCC"> so here you</font><font color="#E5E5E5"> can see I'm</font><font color="#CCCCCC"> in</font>

652
00:31:41,430 --> 00:31:47,460
a constrained language mode and what I

653
00:31:44,610 --> 00:31:49,889
found<font color="#E5E5E5"> out is</font><font color="#CCCCCC"> that this</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> the way app</font>

654
00:31:47,460 --> 00:31:54,120
<font color="#CCCCCC">Locker</font><font color="#E5E5E5"> figures out if it's in</font>

655
00:31:49,890 --> 00:32:02,250
constrained language mode or<font color="#E5E5E5"> not so what</font>

656
00:31:54,120 --> 00:32:04,860
you can do is redirect the temp area to

657
00:32:02,250 --> 00:32:09,450
a place where script execution is

658
00:32:04,860 --> 00:32:12,689
allowed<font color="#CCCCCC"> so when you then start</font>

659
00:32:09,450 --> 00:32:13,799
<font color="#E5E5E5">PowerShell it will be in full language</font>

660
00:32:12,690 --> 00:32:17,970
mode

661
00:32:13,799 --> 00:32:20,730
and that's<font color="#E5E5E5"> freaking awesome</font><font color="#CCCCCC"> so I have a</font>

662
00:32:17,970 --> 00:32:21,989
blog post<font color="#CCCCCC"> that I will I have prepared</font>

663
00:32:20,730 --> 00:32:23,730
I haven't<font color="#CCCCCC"> published</font><font color="#E5E5E5"> it yet I will</font>

664
00:32:21,989 --> 00:32:26,279
publish<font color="#E5E5E5"> it later today where I have</font>

665
00:32:23,730 --> 00:32:27,690
details<font color="#CCCCCC"> about this I did contact</font>

666
00:32:26,279 --> 00:32:30,690
<font color="#E5E5E5">Microsoft about it</font>

667
00:32:27,690 --> 00:32:35,700
that didn't wanna fix it because<font color="#E5E5E5"> its</font>

668
00:32:30,690 --> 00:32:38,909
design<font color="#E5E5E5"> so here's</font><font color="#CCCCCC"> this air Stupak strip I</font>

669
00:32:35,700 --> 00:32:40,950
<font color="#E5E5E5">wrote</font><font color="#CCCCCC"> there's a better one in the module</font>

670
00:32:38,909 --> 00:32:43,470
I<font color="#CCCCCC"> will be</font><font color="#E5E5E5"> leasing today but just</font><font color="#CCCCCC"> to show</font>

671
00:32:40,950 --> 00:32:45,109
<font color="#E5E5E5">you what I what I've done so the first</font>

672
00:32:43,470 --> 00:32:50,429
thing is just to<font color="#E5E5E5"> create two variables</font>

673
00:32:45,109 --> 00:32:53,999
<font color="#E5E5E5">setting the existing temp variables</font><font color="#CCCCCC"> and</font>

674
00:32:50,429 --> 00:32:56,700
then I of<font color="#CCCCCC"> course tells it where where</font>

675
00:32:53,999 --> 00:32:58,859
<font color="#E5E5E5">where is the allowed place to execute</font>

676
00:32:56,700 --> 00:33:00,239
scripts and with the default drills<font color="#E5E5E5"> see</font>

677
00:32:58,859 --> 00:33:01,649
<font color="#CCCCCC">Windows temp is allowed because</font>

678
00:33:00,239 --> 00:33:06,330
<font color="#E5E5E5">everything</font><font color="#CCCCCC"> on the</font><font color="#E5E5E5"> windows is allowed</font><font color="#CCCCCC"> to</font>

679
00:33:01,649 --> 00:33:09,238
run<font color="#CCCCCC"> as squares so then I set the</font><font color="#E5E5E5"> new my</font>

680
00:33:06,330 --> 00:33:12,210
current user<font color="#E5E5E5"> temporary balls to these</font>

681
00:33:09,239 --> 00:33:15,359
<font color="#CCCCCC">bypassed paths</font><font color="#E5E5E5"> then I use something</font>

682
00:33:12,210 --> 00:33:17,489
<font color="#CCCCCC">called invoked</font><font color="#E5E5E5"> in vmi method to start</font>

683
00:33:15,359 --> 00:33:18,689
<font color="#E5E5E5">another powershell session because if</font>

684
00:33:17,489 --> 00:33:20,460
you start<font color="#E5E5E5"> powershell by just typing</font>

685
00:33:18,690 --> 00:33:23,669
<font color="#E5E5E5">powershell it doesn't read</font><font color="#CCCCCC"> the temp</font>

686
00:33:20,460 --> 00:33:25,739
variable for some reason and<font color="#E5E5E5"> i tried a</font>

687
00:33:23,669 --> 00:33:28,649
lot of<font color="#CCCCCC"> different things but this</font><font color="#E5E5E5"> works</font>

688
00:33:25,739 --> 00:33:29,909
<font color="#CCCCCC">so you start you just via my method</font><font color="#E5E5E5"> it</font>

689
00:33:28,649 --> 00:33:32,428
really<font color="#E5E5E5"> right</font>

690
00:33:29,909 --> 00:33:35,669
we reads the temporals<font color="#E5E5E5"> and you're good</font>

691
00:33:32,429 --> 00:33:36,960
<font color="#E5E5E5">to go and</font><font color="#CCCCCC"> now i just</font><font color="#E5E5E5"> set it back so when</font>

692
00:33:35,669 --> 00:33:41,669
you do<font color="#E5E5E5"> that you will have a full</font>

693
00:33:36,960 --> 00:33:46,669
language powershell<font color="#E5E5E5"> running so let me</font>

694
00:33:41,669 --> 00:33:46,669
show you you don't believe me

695
00:33:48,460 --> 00:34:00,899
see<font color="#E5E5E5"> just copy this so here we are</font><font color="#CCCCCC"> let's</font>

696
00:33:56,409 --> 00:34:06,820
<font color="#E5E5E5">start PowerShell</font>

697
00:34:00,899 --> 00:34:09,879
so here I am in constrained language

698
00:34:06,820 --> 00:34:17,879
<font color="#CCCCCC">move</font><font color="#E5E5E5"> right so I'll just paste the script</font>

699
00:34:09,879 --> 00:34:17,879
<font color="#CCCCCC">then boom</font><font color="#E5E5E5"> have a full language</font>

700
00:34:21,599 --> 00:34:35,319
<font color="#CCCCCC">aha thank you suppose a quick demo</font>

701
00:34:29,129 --> 00:34:37,029
<font color="#CCCCCC">coolpix</font><font color="#E5E5E5"> a girl</font><font color="#CCCCCC"> yeah so that</font><font color="#E5E5E5"> was the part</font>

702
00:34:35,319 --> 00:34:41,500
<font color="#E5E5E5">of the scripting</font><font color="#CCCCCC"> words now I'm moving</font>

703
00:34:37,030 --> 00:34:43,510
<font color="#CCCCCC">over to the MSI apx</font><font color="#E5E5E5"> rules</font><font color="#CCCCCC"> so as you</font>

704
00:34:41,500 --> 00:34:47,550
<font color="#E5E5E5">probably have figured out I'm covering</font>

705
00:34:43,510 --> 00:34:50,230
each section<font color="#E5E5E5"> so the problem with the MSI</font>

706
00:34:47,550 --> 00:34:54,429
default rules is<font color="#CCCCCC"> that it allows</font>

707
00:34:50,230 --> 00:34:57,119
everything<font color="#E5E5E5"> that is designed everything</font>

708
00:34:54,429 --> 00:35:01,420
that is digitally signed<font color="#E5E5E5"> Wow</font>

709
00:34:57,119 --> 00:35:05,859
same goes for app X and<font color="#E5E5E5"> that's a problem</font>

710
00:35:01,420 --> 00:35:09,339
<font color="#E5E5E5">because</font><font color="#CCCCCC"> getting a code signing cert it's</font>

711
00:35:05,859 --> 00:35:12,609
like 80 bucks<font color="#CCCCCC"> and it's not that</font><font color="#E5E5E5"> hard to</font>

712
00:35:09,339 --> 00:35:15,490
<font color="#E5E5E5">get it and</font><font color="#CCCCCC"> you can</font><font color="#E5E5E5"> use something like</font>

713
00:35:12,609 --> 00:35:17,710
MSF<font color="#E5E5E5"> venom or whatever to create an MSI</font>

714
00:35:15,490 --> 00:35:20,020
file and then<font color="#CCCCCC"> we can</font><font color="#E5E5E5"> just sign it</font>

715
00:35:17,710 --> 00:35:22,990
using a sign<font color="#CCCCCC"> tool and then you just</font>

716
00:35:20,020 --> 00:35:25,589
execute<font color="#E5E5E5"> the payload and it it runs so</font>

717
00:35:22,990 --> 00:35:28,299
that's that's<font color="#E5E5E5"> an easy bypass for cadets</font>

718
00:35:25,589 --> 00:35:33,250
<font color="#CCCCCC">cool so that</font><font color="#E5E5E5"> that needs to</font><font color="#CCCCCC"> be tweaked</font><font color="#E5E5E5"> in</font>

719
00:35:28,299 --> 00:35:35,619
order to harden<font color="#E5E5E5"> it so the mitigation</font><font color="#CCCCCC"> has</font>

720
00:35:33,250 --> 00:35:37,359
to this is the best I've come up with is

721
00:35:35,619 --> 00:35:41,319
<font color="#E5E5E5">to instead</font><font color="#CCCCCC"> of allow everything to run</font>

722
00:35:37,359 --> 00:35:43,720
<font color="#E5E5E5">just allow at</font><font color="#CCCCCC"> least only</font><font color="#E5E5E5"> Microsoft's MSI</font>

723
00:35:41,319 --> 00:35:48,880
<font color="#E5E5E5">files to run you can start there at</font>

724
00:35:43,720 --> 00:35:52,270
least that's better than everything and

725
00:35:48,880 --> 00:35:55,150
<font color="#E5E5E5">also if you if you use SSE em I would</font>

726
00:35:52,270 --> 00:35:57,430
probably<font color="#E5E5E5"> use</font><font color="#CCCCCC"> something called managed</font>

727
00:35:55,150 --> 00:35:59,500
installer that's something you can

728
00:35:57,430 --> 00:36:01,419
enable<font color="#E5E5E5"> in app Locker so everything that</font>

729
00:35:59,500 --> 00:36:02,349
comes from<font color="#E5E5E5"> SCCM will automatically be</font>

730
00:36:01,420 --> 00:36:05,349
<font color="#CCCCCC">whitelisted</font>

731
00:36:02,349 --> 00:36:07,839
that's<font color="#E5E5E5"> also something you</font><font color="#CCCCCC"> can do that's</font>

732
00:36:05,349 --> 00:36:11,829
<font color="#E5E5E5">way beyond the top this</font><font color="#CCCCCC"> they start but</font>

733
00:36:07,839 --> 00:36:17,979
yeah that's also<font color="#CCCCCC"> possible and</font><font color="#E5E5E5"> the same</font>

734
00:36:11,829 --> 00:36:20,619
goes for a<font color="#CCCCCC"> pacts rules</font><font color="#E5E5E5"> changed changed</font>

735
00:36:17,979 --> 00:36:22,058
it to allow<font color="#CCCCCC"> on the DS to to run things</font>

736
00:36:20,619 --> 00:36:23,799
<font color="#E5E5E5">from Microsoft they have different</font>

737
00:36:22,059 --> 00:36:25,989
certificates<font color="#E5E5E5"> I think there's a total of</font>

738
00:36:23,799 --> 00:36:28,150
three basic actually but I've<font color="#E5E5E5"> only</font>

739
00:36:25,989 --> 00:36:30,609
listed to<font color="#E5E5E5"> here but instead</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> allowing</font>

740
00:36:28,150 --> 00:36:37,180
<font color="#E5E5E5">everything to run narrow it down to</font><font color="#CCCCCC"> what</font>

741
00:36:30,609 --> 00:36:39,219
you really want to run cool yes<font color="#E5E5E5"> and then</font>

742
00:36:37,180 --> 00:36:41,680
<font color="#E5E5E5">you have you have something called known</font>

743
00:36:39,219 --> 00:36:43,390
bypasses even though you<font color="#E5E5E5"> configure</font>

744
00:36:41,680 --> 00:36:45,549
everything correctly<font color="#CCCCCC"> there's still a lot</font>

745
00:36:43,390 --> 00:36:48,729
of binaries that<font color="#E5E5E5"> you can use to execute</font>

746
00:36:45,549 --> 00:36:52,900
<font color="#E5E5E5">code to bypass the protection of app</font>

747
00:36:48,729 --> 00:36:55,328
<font color="#E5E5E5">Locker so there's a lot of known</font>

748
00:36:52,900 --> 00:36:58,359
discoveries made by other great people

749
00:36:55,329 --> 00:37:01,029
<font color="#E5E5E5">like</font><font color="#CCCCCC"> Sub</font><font color="#E5E5E5"> T and Matt</font><font color="#CCCCCC"> graver</font><font color="#E5E5E5"> and all those</font>

750
00:36:58,359 --> 00:37:03,640
guys<font color="#CCCCCC"> where you can use install</font><font color="#E5E5E5"> util I</font>

751
00:37:01,029 --> 00:37:07,059
must build MSHDA reg reg<font color="#E5E5E5"> Assam Vegas we</font>

752
00:37:03,640 --> 00:37:09,578
see and<font color="#CCCCCC"> VST o files I have a list I have</font>

753
00:37:07,059 --> 00:37:11,859
up actually our github<font color="#E5E5E5"> repo called the</font>

754
00:37:09,579 --> 00:37:14,799
ultimate<font color="#E5E5E5"> app Locker bypass list and I</font>

755
00:37:11,859 --> 00:37:18,160
try<font color="#CCCCCC"> to update</font><font color="#E5E5E5"> it as much as I can with</font>

756
00:37:14,799 --> 00:37:20,349
new known techniques<font color="#CCCCCC"> so I recommend</font><font color="#E5E5E5"> that</font>

757
00:37:18,160 --> 00:37:22,479
you<font color="#CCCCCC"> check that out when</font><font color="#E5E5E5"> you start to</font>

758
00:37:20,349 --> 00:37:24,910
harden<font color="#E5E5E5"> your app Locker environment or if</font>

759
00:37:22,479 --> 00:37:27,419
you're looking<font color="#CCCCCC"> for</font><font color="#E5E5E5"> a bypass depends on</font>

760
00:37:24,910 --> 00:37:27,420
which side<font color="#E5E5E5"> you're on</font>

761
00:37:28,680 --> 00:37:34,029
<font color="#CCCCCC">if we go beyond the default rules I've</font>

762
00:37:32,199 --> 00:37:35,440
seen<font color="#E5E5E5"> places where they allow everything</font>

763
00:37:34,029 --> 00:37:41,069
<font color="#E5E5E5">from Microsoft to run</font>

764
00:37:35,440 --> 00:37:43,420
that's it helps but it doesn't help

765
00:37:41,069 --> 00:37:45,940
<font color="#E5E5E5">especially</font><font color="#CCCCCC"> when</font><font color="#E5E5E5"> it</font><font color="#CCCCCC"> comes</font><font color="#E5E5E5"> to binaries</font>

766
00:37:43,420 --> 00:37:49,719
like<font color="#CCCCCC"> XE files</font><font color="#E5E5E5"> because there's a lot of</font>

767
00:37:45,940 --> 00:37:54,309
as you saw even though you block these

768
00:37:49,719 --> 00:37:56,199
<font color="#E5E5E5">known bypasses and allow things for</font>

769
00:37:54,309 --> 00:37:58,140
Microsoft<font color="#CCCCCC"> to run</font><font color="#E5E5E5"> you still run into</font>

770
00:37:56,199 --> 00:38:00,789
<font color="#E5E5E5">problems here there's even</font><font color="#CCCCCC"> more to</font><font color="#E5E5E5"> block</font>

771
00:37:58,140 --> 00:38:01,989
<font color="#E5E5E5">because if you allow everything</font><font color="#CCCCCC"> from</font>

772
00:38:00,789 --> 00:38:04,930
Microsoft that<font color="#E5E5E5"> means I can download</font>

773
00:38:01,989 --> 00:38:10,390
things from Microsoft page other tools

774
00:38:04,930 --> 00:38:13,660
and run them<font color="#E5E5E5"> so for instance in this</font>

775
00:38:10,390 --> 00:38:15,670
<font color="#CCCCCC">example here</font><font color="#E5E5E5"> I'm oh I missed up the</font>

776
00:38:13,660 --> 00:38:17,920
<font color="#E5E5E5">slide</font><font color="#CCCCCC"> ok so</font>

777
00:38:15,670 --> 00:38:20,140
when you allow everything from Microsoft

778
00:38:17,920 --> 00:38:23,680
to<font color="#E5E5E5"> run for instance you can download BG</font>

779
00:38:20,140 --> 00:38:25,750
info<font color="#E5E5E5"> or you can download compilers and</font>

780
00:38:23,680 --> 00:38:28,629
such and run code that way

781
00:38:25,750 --> 00:38:29,200
so there's known techniques to bypass

782
00:38:28,630 --> 00:38:30,610
<font color="#CCCCCC">AppLocker</font>

783
00:38:29,200 --> 00:38:33,310
<font color="#CCCCCC">if you allow everything</font><font color="#E5E5E5"> from Microsoft</font>

784
00:38:30,610 --> 00:38:35,110
to<font color="#E5E5E5"> run so that</font><font color="#CCCCCC"> there's a huge</font><font color="#E5E5E5"> amount of</font>

785
00:38:33,310 --> 00:38:38,049
binaries<font color="#E5E5E5"> and that's what I'm trying to</font>

786
00:38:35,110 --> 00:38:39,880
map out<font color="#CCCCCC"> in my AppLocker</font><font color="#E5E5E5"> bypass</font><font color="#CCCCCC"> lists so</font>

787
00:38:38,050 --> 00:38:41,740
check it out

788
00:38:39,880 --> 00:38:44,770
another typical Mis configuration I see

789
00:38:41,740 --> 00:38:47,560
a lot and I<font color="#E5E5E5"> tweet it out like not that</font>

790
00:38:44,770 --> 00:38:51,640
<font color="#CCCCCC">long ago that I I think exceptions are</font>

791
00:38:47,560 --> 00:38:53,470
evil<font color="#CCCCCC"> and</font><font color="#E5E5E5"> Aaron</font><font color="#CCCCCC"> Ragosa started to</font><font color="#E5E5E5"> defend</font>

792
00:38:51,640 --> 00:38:57,520
it<font color="#E5E5E5"> and that's fine</font><font color="#CCCCCC"> they had a good</font><font color="#E5E5E5"> point</font>

793
00:38:53,470 --> 00:38:59,589
<font color="#E5E5E5">but still</font><font color="#CCCCCC"> I I find them evil so in app</font>

794
00:38:57,520 --> 00:39:02,290
<font color="#CCCCCC">Locker you can either create</font><font color="#E5E5E5"> a deny rule</font>

795
00:38:59,590 --> 00:39:04,840
directly<font color="#E5E5E5"> like you create</font><font color="#CCCCCC"> a new rule and</font>

796
00:39:02,290 --> 00:39:08,950
<font color="#CCCCCC">say I'm not</font><font color="#E5E5E5"> allowing this to run or you</font>

797
00:39:04,840 --> 00:39:10,810
<font color="#CCCCCC">can go inside our</font><font color="#E5E5E5"> rule and there's a tab</font>

798
00:39:08,950 --> 00:39:13,299
called exceptions<font color="#E5E5E5"> where you can add</font>

799
00:39:10,810 --> 00:39:15,670
exceptions<font color="#E5E5E5"> so for instance allowing</font>

800
00:39:13,300 --> 00:39:21,040
<font color="#CCCCCC">everything under C winners to run</font><font color="#E5E5E5"> except</font>

801
00:39:15,670 --> 00:39:23,410
for folder<font color="#E5E5E5"> a b c and d right so when you</font>

802
00:39:21,040 --> 00:39:26,830
do<font color="#E5E5E5"> that you can have assumed that you</font>

803
00:39:23,410 --> 00:39:29,230
block execution<font color="#E5E5E5"> from that place right</font><font color="#CCCCCC"> so</font>

804
00:39:26,830 --> 00:39:31,960
a thing<font color="#CCCCCC"> i see like for</font><font color="#E5E5E5"> instance here</font>

805
00:39:29,230 --> 00:39:34,630
<font color="#E5E5E5">you're okay this is a typical</font><font color="#CCCCCC"> set where</font>

806
00:39:31,960 --> 00:39:37,660
you<font color="#E5E5E5"> didn't I I calculate it</font><font color="#CCCCCC"> will block</font>

807
00:39:34,630 --> 00:39:40,570
it<font color="#E5E5E5"> right but when you do when you use an</font>

808
00:39:37,660 --> 00:39:43,779
exception there's a<font color="#E5E5E5"> problem because here</font>

809
00:39:40,570 --> 00:39:46,870
is I'm inside the windows folder<font color="#E5E5E5"> I'm</font>

810
00:39:43,780 --> 00:39:49,540
adding an exception for<font color="#CCCCCC"> I cackles</font><font color="#E5E5E5"> the</font>

811
00:39:46,870 --> 00:39:52,900
problem here is that he has also allowed

812
00:39:49,540 --> 00:39:54,640
everything<font color="#E5E5E5"> from Microsoft to run so the</font>

813
00:39:52,900 --> 00:39:56,980
problem<font color="#E5E5E5"> here</font><font color="#CCCCCC"> is that</font><font color="#E5E5E5"> even</font><font color="#CCCCCC"> though I'm</font>

814
00:39:54,640 --> 00:39:58,600
<font color="#CCCCCC">thinking okay what</font><font color="#E5E5E5"> should happen here in</font>

815
00:39:56,980 --> 00:40:01,840
my head<font color="#CCCCCC"> i</font><font color="#E5E5E5"> cackles shouldn't be allowed</font>

816
00:39:58,600 --> 00:40:03,670
to<font color="#E5E5E5"> run but that's not case it will</font>

817
00:40:01,840 --> 00:40:05,770
<font color="#CCCCCC">actually be allowed to</font><font color="#E5E5E5"> run since we have</font>

818
00:40:03,670 --> 00:40:08,350
this rule here so that's totally

819
00:40:05,770 --> 00:40:13,060
confusing<font color="#E5E5E5"> and</font><font color="#CCCCCC"> i and i see this</font><font color="#E5E5E5"> a lot so</font>

820
00:40:08,350 --> 00:40:14,920
<font color="#E5E5E5">i prefer to keep my hip use strict deny</font>

821
00:40:13,060 --> 00:40:18,070
rules and don't<font color="#E5E5E5"> use exceptions</font><font color="#CCCCCC"> i think</font>

822
00:40:14,920 --> 00:40:22,510
that's easier to<font color="#CCCCCC"> maintain</font><font color="#E5E5E5"> their point</font>

823
00:40:18,070 --> 00:40:25,690
<font color="#CCCCCC">Aaron</font><font color="#E5E5E5"> had was</font><font color="#CCCCCC"> that if you have admins</font><font color="#E5E5E5"> it</font>

824
00:40:22,510 --> 00:40:27,490
makes it makes it hard<font color="#CCCCCC"> for you to kind</font>

825
00:40:25,690 --> 00:40:29,530
of segregate what you allow for<font color="#CCCCCC"> an admin</font>

826
00:40:27,490 --> 00:40:31,689
to<font color="#E5E5E5"> run and a user to run</font>

827
00:40:29,530 --> 00:40:34,450
so that that's<font color="#CCCCCC"> a good</font><font color="#E5E5E5"> point but in my</font>

828
00:40:31,690 --> 00:40:36,390
<font color="#CCCCCC">opinion when I</font><font color="#E5E5E5"> harden clients I will not</font>

829
00:40:34,450 --> 00:40:40,210
allow any admin to log in there at all

830
00:40:36,390 --> 00:40:41,740
<font color="#E5E5E5">they shouldn't like log on ever if you</font>

831
00:40:40,210 --> 00:40:44,470
want to do<font color="#E5E5E5"> something on a client you</font>

832
00:40:41,740 --> 00:40:47,669
push<font color="#E5E5E5"> it to a system SCCM or</font><font color="#CCCCCC"> Altiris or</font>

833
00:40:44,470 --> 00:40:58,750
something else<font color="#CCCCCC"> that's my opinion</font>

834
00:40:47,670 --> 00:41:01,020
yeah sorry<font color="#CCCCCC"> I cattles why have i showing</font>

835
00:40:58,750 --> 00:41:01,020
you this

836
00:41:03,270 --> 00:41:08,170
<font color="#E5E5E5">okay</font><font color="#CCCCCC"> i was i was supposed to</font><font color="#E5E5E5"> okay don't</font>

837
00:41:06,250 --> 00:41:09,460
mind<font color="#CCCCCC"> i went ahead</font><font color="#E5E5E5"> and told you</font>

838
00:41:08,170 --> 00:41:14,020
<font color="#CCCCCC">everything before</font><font color="#E5E5E5"> i</font><font color="#CCCCCC"> had the</font><font color="#E5E5E5"> slides ready</font>

839
00:41:09,460 --> 00:41:15,370
so my bad yeah<font color="#E5E5E5"> so if you open</font><font color="#CCCCCC"> if you as</font>

840
00:41:14,020 --> 00:41:17,830
I said if you<font color="#E5E5E5"> allow</font><font color="#CCCCCC"> everything from</font>

841
00:41:15,370 --> 00:41:20,890
Microsoft<font color="#CCCCCC"> you open the door</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> other</font>

842
00:41:17,830 --> 00:41:23,290
<font color="#E5E5E5">binaries to run such as PG info then you</font>

843
00:41:20,890 --> 00:41:26,529
can use<font color="#E5E5E5"> that to execute code</font><font color="#CCCCCC"> you also</font>

844
00:41:23,290 --> 00:41:29,470
have other binaries such as<font color="#CCCCCC"> c DB and</font>

845
00:41:26,530 --> 00:41:31,480
there's a long<font color="#E5E5E5"> list so just go into the</font>

846
00:41:29,470 --> 00:41:34,779
github repo<font color="#E5E5E5"> and you will you will</font><font color="#CCCCCC"> see</font>

847
00:41:31,480 --> 00:41:37,000
them all<font color="#E5E5E5"> there's a long list and you can</font>

848
00:41:34,780 --> 00:41:39,130
<font color="#CCCCCC">also with</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> lower</font><font color="#E5E5E5"> best project where</font>

849
00:41:37,000 --> 00:41:42,190
you<font color="#CCCCCC"> can see different binaries that can</font>

850
00:41:39,130 --> 00:41:43,350
do other stuff<font color="#E5E5E5"> that's a good resource as</font>

851
00:41:42,190 --> 00:41:47,470
well

852
00:41:43,350 --> 00:41:50,980
okay so hardening rules if<font color="#CCCCCC"> you go into</font>

853
00:41:47,470 --> 00:41:53,439
<font color="#CCCCCC">that</font><font color="#E5E5E5"> github repo I have pre</font><font color="#CCCCCC"> created all</font>

854
00:41:50,980 --> 00:41:57,370
the<font color="#E5E5E5"> routes you need to like totally lock</font>

855
00:41:53,440 --> 00:42:00,640
it down<font color="#E5E5E5"> so I have a default</font><font color="#CCCCCC"> rules</font>

856
00:41:57,370 --> 00:42:02,410
improved that's instead of using the

857
00:42:00,640 --> 00:42:05,020
default<font color="#E5E5E5"> rules you can actually download</font>

858
00:42:02,410 --> 00:42:07,420
<font color="#E5E5E5">that XML and you can</font><font color="#CCCCCC"> right-click inside</font>

859
00:42:05,020 --> 00:42:10,780
where you configure AppLocker<font color="#CCCCCC"> and import</font>

860
00:42:07,420 --> 00:42:13,870
that rule<font color="#E5E5E5"> set</font><font color="#CCCCCC"> and there's</font><font color="#E5E5E5"> instructions</font>

861
00:42:10,780 --> 00:42:16,500
on that<font color="#E5E5E5"> github repo and the improved</font>

862
00:42:13,870 --> 00:42:19,299
thing is that it<font color="#CCCCCC"> doesn't allow</font>

863
00:42:16,500 --> 00:42:21,460
everything<font color="#CCCCCC"> from Microsoft to run smsc</font>

864
00:42:19,300 --> 00:42:23,860
<font color="#E5E5E5">files prints allows everyone to run</font>

865
00:42:21,460 --> 00:42:26,020
signed MSE files<font color="#E5E5E5"> it only allows</font><font color="#CCCCCC"> from</font>

866
00:42:23,860 --> 00:42:27,970
<font color="#E5E5E5">Microsoft's Princeton's so I have pre</font>

867
00:42:26,020 --> 00:42:30,360
created up for you and I also created

868
00:42:27,970 --> 00:42:33,009
all<font color="#CCCCCC"> these blocked rules</font><font color="#E5E5E5"> so this includes</font>

869
00:42:30,360 --> 00:42:35,980
<font color="#CCCCCC">blocking every known binary</font><font color="#E5E5E5"> the dust</font>

870
00:42:33,010 --> 00:42:39,000
<font color="#E5E5E5">evil stuff that I know of</font><font color="#CCCCCC"> and it also</font>

871
00:42:35,980 --> 00:42:40,990
includes ultimate data streams as well

872
00:42:39,000 --> 00:42:43,210
so

873
00:42:40,990 --> 00:42:45,910
feel free to use<font color="#CCCCCC"> them I haven't</font><font color="#E5E5E5"> tested</font>

874
00:42:43,210 --> 00:42:47,110
them a lot so it could break things<font color="#CCCCCC"> so</font>

875
00:42:45,910 --> 00:42:48,910
you need to like test<font color="#E5E5E5"> them in an</font>

876
00:42:47,110 --> 00:42:50,740
environment<font color="#E5E5E5"> before you put it into</font>

877
00:42:48,910 --> 00:42:59,470
production<font color="#CCCCCC"> that's a place</font><font color="#E5E5E5"> by right now</font>

878
00:42:50,740 --> 00:43:02,649
never<font color="#E5E5E5"> it's all good yeah that's correct</font>

879
00:42:59,470 --> 00:43:04,899
<font color="#E5E5E5">that's</font><font color="#CCCCCC"> correct okay so back to Aaron</font>

880
00:43:02,650 --> 00:43:08,250
<font color="#E5E5E5">Locker</font><font color="#CCCCCC"> I started</font><font color="#E5E5E5"> looking into our locker</font>

881
00:43:04,900 --> 00:43:11,170
<font color="#E5E5E5">because I was curious what this was so</font>

882
00:43:08,250 --> 00:43:13,230
it makes<font color="#E5E5E5"> it a lot</font><font color="#CCCCCC"> easier for us as IT</font>

883
00:43:11,170 --> 00:43:16,210
admins<font color="#CCCCCC"> to maintain a bigger rule</font><font color="#E5E5E5"> set</font>

884
00:43:13,230 --> 00:43:18,550
<font color="#E5E5E5">because it can scan the</font><font color="#CCCCCC"> computer and add</font>

885
00:43:16,210 --> 00:43:20,740
things that<font color="#E5E5E5"> are missing in a more</font>

886
00:43:18,550 --> 00:43:23,170
intelligent<font color="#E5E5E5"> way than the default or</font>

887
00:43:20,740 --> 00:43:28,029
create rules based on scanning<font color="#E5E5E5"> from the</font>

888
00:43:23,170 --> 00:43:31,180
<font color="#CCCCCC">Apocrypha</font><font color="#E5E5E5"> the only problem as of today</font>

889
00:43:28,030 --> 00:43:33,970
is<font color="#E5E5E5"> that it's missing</font><font color="#CCCCCC"> rules</font><font color="#E5E5E5"> for alternate</font>

890
00:43:31,180 --> 00:43:37,390
data streams so I reached out<font color="#E5E5E5"> to Aaron</font>

891
00:43:33,970 --> 00:43:40,540
about<font color="#E5E5E5"> this last week no early this week</font>

892
00:43:37,390 --> 00:43:42,400
<font color="#CCCCCC">I can't remember anyways he has said</font>

893
00:43:40,540 --> 00:43:43,990
that he<font color="#CCCCCC"> has he has almost ready to</font>

894
00:43:42,400 --> 00:43:47,470
release his next version of Aaron<font color="#E5E5E5"> Locker</font>

895
00:43:43,990 --> 00:43:48,640
<font color="#E5E5E5">where this is a part of the of the</font>

896
00:43:47,470 --> 00:43:51,089
release

897
00:43:48,640 --> 00:43:53,770
amongst other things so he has fixed<font color="#E5E5E5"> it</font>

898
00:43:51,090 --> 00:43:55,930
<font color="#E5E5E5">and I had prepared this slide to just</font>

899
00:43:53,770 --> 00:43:59,109
show you the problem<font color="#CCCCCC"> and this is an</font>

900
00:43:55,930 --> 00:44:02,589
<font color="#E5E5E5">important rule from Aaron Locker where</font>

901
00:43:59,109 --> 00:44:05,080
he has used exceptions for for<font color="#E5E5E5"> instance</font>

902
00:44:02,590 --> 00:44:07,540
tracing but he has forgot the ultimate

903
00:44:05,080 --> 00:44:10,569
data streams so here you<font color="#E5E5E5"> can just take</font>

904
00:44:07,540 --> 00:44:12,279
in evil<font color="#CCCCCC"> EXCI file pipe it to tracing as</font>

905
00:44:10,570 --> 00:44:15,430
<font color="#E5E5E5">I showed</font><font color="#CCCCCC"> you early in</font><font color="#E5E5E5"> the demo and</font><font color="#CCCCCC"> you</font>

906
00:44:12,280 --> 00:44:16,900
<font color="#E5E5E5">can use either bit admin or there</font>

907
00:44:15,430 --> 00:44:18,549
there's a lot of ways to execute<font color="#E5E5E5"> all the</font>

908
00:44:16,900 --> 00:44:20,200
<font color="#E5E5E5">data streams I have a complete list at</font>

909
00:44:18,550 --> 00:44:23,050
the<font color="#CCCCCC"> bottom if you're interested in</font>

910
00:44:20,200 --> 00:44:28,919
ultimate data streams<font color="#E5E5E5"> so that's a</font><font color="#CCCCCC"> pretty</font>

911
00:44:23,050 --> 00:44:28,920
<font color="#E5E5E5">good resource there so how am I on time</font>

912
00:44:28,960 --> 00:44:37,200
so my recommendation<font color="#CCCCCC"> I prefer the</font>

913
00:44:32,170 --> 00:44:39,210
default rules that's number<font color="#E5E5E5"> one</font><font color="#CCCCCC"> always</font>

914
00:44:37,200 --> 00:44:41,290
<font color="#E5E5E5">enable dll's</font>

915
00:44:39,210 --> 00:44:46,320
even though<font color="#CCCCCC"> it states</font><font color="#E5E5E5"> there's a</font>

916
00:44:41,290 --> 00:44:46,320
performance degrade isn't true

917
00:44:46,590 --> 00:44:51,070
<font color="#E5E5E5">okay this is my recommendation</font><font color="#CCCCCC"> not</font>

918
00:44:49,630 --> 00:44:51,760
everyone<font color="#E5E5E5"> agrees</font><font color="#CCCCCC"> it depends on your</font>

919
00:44:51,070 --> 00:44:53,770
environment

920
00:44:51,760 --> 00:44:55,720
I don't like exceptions because I find

921
00:44:53,770 --> 00:45:00,550
<font color="#E5E5E5">them confusing</font><font color="#CCCCCC"> I would rather prefer</font>

922
00:44:55,720 --> 00:45:04,089
deny rules that's my opinion I'll be

923
00:45:00,550 --> 00:45:08,260
sure<font color="#CCCCCC"> to create</font><font color="#E5E5E5"> deny rules for paths that</font>

924
00:45:04,090 --> 00:45:15,280
users can first write to and also<font color="#E5E5E5"> add</font>

925
00:45:08,260 --> 00:45:17,550
80s for the<font color="#E5E5E5"> same paths</font><font color="#CCCCCC"> create</font><font color="#E5E5E5"> publisher</font>

926
00:45:15,280 --> 00:45:19,410
deny rules for bad by a bad binaries

927
00:45:17,550 --> 00:45:22,120
such as msbuild

928
00:45:19,410 --> 00:45:25,779
<font color="#CCCCCC">PowerShell why would</font><font color="#E5E5E5"> I</font><font color="#CCCCCC"> used to need to</font>

929
00:45:22,120 --> 00:45:31,230
run PowerShell<font color="#CCCCCC"> I don't see the point</font>

930
00:45:25,780 --> 00:45:34,210
<font color="#E5E5E5">so create deny rules to block stuff</font><font color="#CCCCCC"> and</font>

931
00:45:31,230 --> 00:45:37,420
of course as I<font color="#E5E5E5"> said remove all the rules</font>

932
00:45:34,210 --> 00:45:40,690
that<font color="#E5E5E5"> allow every signer</font><font color="#CCCCCC"> I every signed</font>

933
00:45:37,420 --> 00:45:43,180
file to run<font color="#E5E5E5"> that's a bad idea</font><font color="#CCCCCC"> and last</font>

934
00:45:40,690 --> 00:45:46,180
<font color="#E5E5E5">but not least enable central monitoring</font>

935
00:45:43,180 --> 00:45:48,730
<font color="#E5E5E5">it's it's pretty easy actually to enable</font>

936
00:45:46,180 --> 00:45:50,319
event forwarding<font color="#E5E5E5"> in Windows so you can</font>

937
00:45:48,730 --> 00:45:52,420
take all<font color="#E5E5E5"> the events</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> get from every</font>

938
00:45:50,320 --> 00:45:54,190
workstation<font color="#E5E5E5"> and put them into one</font>

939
00:45:52,420 --> 00:45:56,470
central place so you can<font color="#E5E5E5"> see what has</font>

940
00:45:54,190 --> 00:45:58,390
run what has<font color="#E5E5E5"> blocked and what not</font><font color="#CCCCCC"> so</font>

941
00:45:56,470 --> 00:46:00,549
<font color="#CCCCCC">that's something</font><font color="#E5E5E5"> I recommend if you</font>

942
00:45:58,390 --> 00:46:02,020
don't have like a<font color="#CCCCCC"> cm solution</font><font color="#E5E5E5"> or you can</font>

943
00:46:00,550 --> 00:46:02,500
run a<font color="#CCCCCC"> Splunk agent on the host or</font>

944
00:46:02,020 --> 00:46:05,050
<font color="#CCCCCC">something</font>

945
00:46:02,500 --> 00:46:09,370
so yeah that's something<font color="#CCCCCC"> I would</font>

946
00:46:05,050 --> 00:46:11,980
recommend<font color="#E5E5E5"> it yeah so during my prep for</font>

947
00:46:09,370 --> 00:46:14,470
<font color="#E5E5E5">this talk I started earlier this year to</font>

948
00:46:11,980 --> 00:46:16,510
create<font color="#E5E5E5"> something that made it easier for</font>

949
00:46:14,470 --> 00:46:18,669
<font color="#E5E5E5">me</font><font color="#CCCCCC"> to discover this</font><font color="#E5E5E5"> burn abilities</font>

950
00:46:16,510 --> 00:46:22,600
<font color="#E5E5E5">because that's important yeah I don't</font>

951
00:46:18,670 --> 00:46:28,360
<font color="#CCCCCC">wanna</font><font color="#E5E5E5"> use</font><font color="#CCCCCC"> a lot of time so I released it</font>

952
00:46:22,600 --> 00:46:31,509
<font color="#CCCCCC">4:00</font><font color="#E5E5E5"> a.m. tonight or</font><font color="#CCCCCC"> something</font><font color="#E5E5E5"> and the</font>

953
00:46:28,360 --> 00:46:33,460
sweet thing about this is<font color="#E5E5E5"> that it runs</font>

954
00:46:31,510 --> 00:46:34,510
<font color="#E5E5E5">in constrained language mode so you</font>

955
00:46:33,460 --> 00:46:36,250
<font color="#E5E5E5">don't have to have like</font><font color="#CCCCCC"> a full</font>

956
00:46:34,510 --> 00:46:38,590
<font color="#CCCCCC">powershell language mode in order to</font><font color="#E5E5E5"> run</font>

957
00:46:36,250 --> 00:46:40,590
the module<font color="#E5E5E5"> so that's like a big</font><font color="#CCCCCC"> thing</font>

958
00:46:38,590 --> 00:46:43,600
when<font color="#E5E5E5"> you when you like test on</font><font color="#CCCCCC"> AppLocker</font>

959
00:46:40,590 --> 00:46:45,220
<font color="#E5E5E5">and</font><font color="#CCCCCC"> i started out</font><font color="#E5E5E5"> by doing like a lot</font><font color="#CCCCCC"> of</font>

960
00:46:43,600 --> 00:46:46,930
<font color="#CCCCCC">thing like</font><font color="#E5E5E5"> ad type and all that stuff</font>

961
00:46:45,220 --> 00:46:48,879
and it get gets blocked because<font color="#CCCCCC"> of</font>

962
00:46:46,930 --> 00:46:51,819
<font color="#E5E5E5">Christian language mode of course so I</font>

963
00:46:48,880 --> 00:46:54,190
had to rewrite<font color="#CCCCCC"> a couple times</font><font color="#E5E5E5"> and some</font>

964
00:46:51,820 --> 00:46:56,339
of the code is<font color="#CCCCCC"> not</font><font color="#E5E5E5"> beautiful but it</font>

965
00:46:54,190 --> 00:46:59,579
works

966
00:46:56,339 --> 00:47:02,029
and that's mostly<font color="#CCCCCC"> because of</font><font color="#E5E5E5"> constraint</font>

967
00:46:59,579 --> 00:47:06,960
language mode you have<font color="#E5E5E5"> to be like really</font>

968
00:47:02,030 --> 00:47:09,540
figure out<font color="#E5E5E5"> ways to get around it for</font>

969
00:47:06,960 --> 00:47:12,869
<font color="#E5E5E5">instance if you want to like check AC</font>

970
00:47:09,540 --> 00:47:15,359
else you would have<font color="#E5E5E5"> thought that that</font>

971
00:47:12,869 --> 00:47:15,900
should be<font color="#E5E5E5"> easy so you can</font><font color="#CCCCCC"> just get a CL</font>

972
00:47:15,359 --> 00:47:17,549
in PowerShell

973
00:47:15,900 --> 00:47:20,309
<font color="#E5E5E5">and you can get the AC else that's right</font>

974
00:47:17,550 --> 00:47:22,950
but if you want to set them you cannot

975
00:47:20,309 --> 00:47:25,050
do it<font color="#E5E5E5"> in Christian language mode because</font>

976
00:47:22,950 --> 00:47:29,578
you have to have the<font color="#CCCCCC"> ability to use the</font>

977
00:47:25,050 --> 00:47:30,869
<font color="#E5E5E5">ad type who would have figured</font><font color="#CCCCCC"> so i</font>

978
00:47:29,579 --> 00:47:34,140
<font color="#E5E5E5">scratch my head a long time</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> reached</font>

979
00:47:30,869 --> 00:47:36,119
out<font color="#E5E5E5"> to callers and he reached out</font><font color="#CCCCCC"> to Lee</font>

980
00:47:34,140 --> 00:47:39,839
homes<font color="#E5E5E5"> the only way he said it</font><font color="#CCCCCC"> was</font>

981
00:47:36,119 --> 00:47:41,160
<font color="#E5E5E5">possible was to to sign it so that's a</font>

982
00:47:39,839 --> 00:47:44,970
workaround but<font color="#E5E5E5"> I don't want to do this</font>

983
00:47:41,160 --> 00:47:47,848
this project<font color="#CCCCCC"> the first so yeah there are</font>

984
00:47:44,970 --> 00:47:49,319
some<font color="#E5E5E5"> problems along the</font><font color="#CCCCCC"> way so it</font>

985
00:47:47,849 --> 00:47:51,900
automates a lot of the hunting for the

986
00:47:49,319 --> 00:47:56,369
vulnerabilities<font color="#CCCCCC"> I think it's good for</font>

987
00:47:51,900 --> 00:47:58,380
both red and blue<font color="#E5E5E5"> and please note</font><font color="#CCCCCC"> it's</font>

988
00:47:56,369 --> 00:48:01,170
not<font color="#E5E5E5"> feature complete yet it's still</font>

989
00:47:58,380 --> 00:48:04,680
under<font color="#E5E5E5"> progress but but at least have</font>

990
00:48:01,170 --> 00:48:06,089
something<font color="#E5E5E5"> to show for so</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> be quick</font>

991
00:48:04,680 --> 00:48:12,440
demo it<font color="#CCCCCC"> for you</font>

992
00:48:06,089 --> 00:48:17,670
I still have some minutes<font color="#E5E5E5"> left for</font><font color="#CCCCCC"> pool</font>

993
00:48:12,440 --> 00:48:21,299
so on this host<font color="#E5E5E5"> this sister could snap</font>

994
00:48:17,670 --> 00:48:27,359
you just let me<font color="#E5E5E5"> close down some stuff</font>

995
00:48:21,299 --> 00:48:29,579
here so<font color="#CCCCCC"> I have</font><font color="#E5E5E5"> under</font><font color="#CCCCCC"> my temp folder</font><font color="#E5E5E5"> I</font>

996
00:48:27,359 --> 00:48:32,569
have<font color="#CCCCCC"> all the functions so have I have</font>

997
00:48:29,579 --> 00:48:34,740
<font color="#CCCCCC">separated each function into</font><font color="#E5E5E5"> a file</font>

998
00:48:32,569 --> 00:48:38,540
because<font color="#E5E5E5"> I think</font><font color="#CCCCCC"> that's easier to</font>

999
00:48:34,740 --> 00:48:42,029
<font color="#E5E5E5">maintain so first I</font><font color="#CCCCCC"> just run PowerShell</font>

1000
00:48:38,540 --> 00:48:45,089
<font color="#E5E5E5">in an unrestricted mode so that</font><font color="#CCCCCC"> I can</font>

1001
00:48:42,030 --> 00:48:51,420
run scripts and then<font color="#E5E5E5"> I go into my temp</font>

1002
00:48:45,089 --> 00:48:55,589
folder<font color="#CCCCCC"> Parral and then</font><font color="#E5E5E5"> I use import</font>

1003
00:48:51,420 --> 00:48:59,490
module like<font color="#E5E5E5"> this and now all the</font><font color="#CCCCCC"> command</font>

1004
00:48:55,589 --> 00:49:00,960
<font color="#CCCCCC">that's are in my in the</font><font color="#E5E5E5"> memory so I can</font>

1005
00:48:59,490 --> 00:49:03,779
for<font color="#E5E5E5"> instance if I want to list up the</font>

1006
00:49:00,960 --> 00:49:05,490
rules<font color="#CCCCCC"> there are built-in commanders</font><font color="#E5E5E5"> for</font>

1007
00:49:03,780 --> 00:49:07,029
<font color="#E5E5E5">this but I don't like them</font><font color="#CCCCCC"> I think</font>

1008
00:49:05,490 --> 00:49:10,848
<font color="#CCCCCC">they're too</font>

1009
00:49:07,029 --> 00:49:13,190
complex<font color="#E5E5E5"> so I like</font><font color="#CCCCCC"> UDC so</font><font color="#E5E5E5"> if I do</font>

1010
00:49:10,849 --> 00:49:18,980
something<font color="#CCCCCC"> like</font><font color="#E5E5E5"> this</font>

1011
00:49:13,190 --> 00:49:21,410
yet how rules<font color="#CCCCCC"> I can choose what sort of</font>

1012
00:49:18,980 --> 00:49:24,019
<font color="#E5E5E5">rules I want</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> want all rules do I want</font>

1013
00:49:21,410 --> 00:49:27,319
<font color="#CCCCCC">only</font><font color="#E5E5E5"> pass rules path rules publisher</font>

1014
00:49:24,019 --> 00:49:29,328
rules<font color="#E5E5E5"> yeah so I want</font><font color="#CCCCCC"> all</font><font color="#E5E5E5"> done rule</font>

1015
00:49:27,319 --> 00:49:31,119
actions maybe<font color="#E5E5E5"> I want all or maybe I just</font>

1016
00:49:29,329 --> 00:49:36,619
<font color="#E5E5E5">want the allow rules or the deny rules</font>

1017
00:49:31,119 --> 00:49:38,359
<font color="#E5E5E5">so in this case</font><font color="#CCCCCC"> just everything you can</font>

1018
00:49:36,619 --> 00:49:42,529
also<font color="#E5E5E5"> specify</font><font color="#CCCCCC"> sits if you want to search</font>

1019
00:49:38,359 --> 00:49:46,250
<font color="#CCCCCC">for a</font><font color="#E5E5E5"> specific set default</font><font color="#CCCCCC"> it uses</font><font color="#E5E5E5"> like</font>

1020
00:49:42,529 --> 00:49:48,769
everyone<font color="#CCCCCC"> you can also export it</font><font color="#E5E5E5"> to an</font>

1021
00:49:46,250 --> 00:49:51,200
XML and you can take it<font color="#E5E5E5"> offline</font><font color="#CCCCCC"> and use</font>

1022
00:49:48,769 --> 00:49:52,430
the same command that's against XML file

1023
00:49:51,200 --> 00:49:56,689
to<font color="#CCCCCC"> figure it out</font>

1024
00:49:52,430 --> 00:50:00,710
<font color="#CCCCCC">to</font><font color="#E5E5E5"> instruct okay cool yeah</font><font color="#CCCCCC"> so a lot of</font>

1025
00:49:56,690 --> 00:50:03,980
<font color="#E5E5E5">fun stuff so if I run</font><font color="#CCCCCC"> this I can view</font>

1026
00:50:00,710 --> 00:50:08,500
<font color="#CCCCCC">the rules as yes</font><font color="#E5E5E5"> and I can like go into</font>

1027
00:50:03,980 --> 00:50:11,960
each<font color="#CCCCCC"> one of them for instance</font><font color="#E5E5E5"> like this</font>

1028
00:50:08,500 --> 00:50:15,380
and I can use rule<font color="#E5E5E5"> lists and I get all</font>

1029
00:50:11,960 --> 00:50:17,750
the<font color="#E5E5E5"> rules so it's pretty nice and I get</font>

1030
00:50:15,380 --> 00:50:19,339
the path<font color="#E5E5E5"> the original path</font><font color="#CCCCCC"> because</font>

1031
00:50:17,750 --> 00:50:21,980
there's a problem<font color="#E5E5E5"> when you use a proctor</font>

1032
00:50:19,339 --> 00:50:23,000
when you have<font color="#E5E5E5"> a</font><font color="#CCCCCC"> % program files there's</font>

1033
00:50:21,980 --> 00:50:25,369
actually two paths

1034
00:50:23,000 --> 00:50:27,289
<font color="#CCCCCC">it's</font><font color="#E5E5E5"> Program Files and Program Files x86</font>

1035
00:50:25,369 --> 00:50:31,220
<font color="#E5E5E5">so I have to like split them out and</font>

1036
00:50:27,289 --> 00:50:32,990
stuff so yeah that's pretty<font color="#E5E5E5"> awesome yeah</font>

1037
00:50:31,220 --> 00:50:37,009
I don't<font color="#CCCCCC"> have</font><font color="#E5E5E5"> time to show you everything</font>

1038
00:50:32,990 --> 00:50:39,709
<font color="#CCCCCC">but let</font><font color="#E5E5E5"> me show you the constraint</font>

1039
00:50:37,009 --> 00:50:41,480
language mode bypass so this will

1040
00:50:39,710 --> 00:50:43,549
actually<font color="#CCCCCC"> get all</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> script rules</font><font color="#E5E5E5"> it</font>

1041
00:50:41,480 --> 00:50:45,799
will figure out<font color="#E5E5E5"> a path it can use to</font>

1042
00:50:43,549 --> 00:50:47,359
redirect the temp and it doesn't<font color="#E5E5E5"> change</font>

1043
00:50:45,799 --> 00:50:50,029
the<font color="#E5E5E5"> temporary ball it'll actually just</font>

1044
00:50:47,359 --> 00:50:53,509
manipulates how the VMA<font color="#CCCCCC"> vmi method is</font>

1045
00:50:50,029 --> 00:50:57,710
invoked<font color="#E5E5E5"> so this is pretty cool so just</font>

1046
00:50:53,509 --> 00:51:00,559
run it BAM<font color="#E5E5E5"> it figures out finds a</font>

1047
00:50:57,710 --> 00:51:02,960
suitable location<font color="#E5E5E5"> it picks a random path</font>

1048
00:51:00,559 --> 00:51:05,089
out of<font color="#E5E5E5"> the different paths it finds and</font>

1049
00:51:02,960 --> 00:51:07,849
<font color="#E5E5E5">then it's just launched it change the</font>

1050
00:51:05,089 --> 00:51:12,589
temporary<font color="#E5E5E5"> bills and lost</font><font color="#CCCCCC"> PowerShell and</font>

1051
00:51:07,849 --> 00:51:15,859
<font color="#CCCCCC">there's also another cool thing once</font>

1052
00:51:12,589 --> 00:51:18,558
here<font color="#CCCCCC"> bypass spawn</font><font color="#E5E5E5"> you can specify a</font>

1053
00:51:15,859 --> 00:51:20,090
binary<font color="#E5E5E5"> and it will figure out our place</font>

1054
00:51:18,559 --> 00:51:21,860
it<font color="#E5E5E5"> can place the binary and</font>

1055
00:51:20,090 --> 00:51:23,540
<font color="#CCCCCC">secured it and I'm also working on an</font>

1056
00:51:21,860 --> 00:51:27,710
<font color="#CCCCCC">edition where you can use 80s as a</font>

1057
00:51:23,540 --> 00:51:31,150
<font color="#E5E5E5">parameter at the at the</font><font color="#CCCCCC"> end so I can</font><font color="#E5E5E5"> I</font>

1058
00:51:27,710 --> 00:51:31,150
<font color="#E5E5E5">think I have time to show</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> real quick</font>

1059
00:51:32,530 --> 00:51:42,580
<font color="#E5E5E5">I'm sorry</font>

1060
00:51:35,170 --> 00:51:44,360
so yeah something went<font color="#CCCCCC"> wrong okay</font><font color="#E5E5E5"> sorry</font>

1061
00:51:42,580 --> 00:51:55,759
I'll fix that

1062
00:51:44,360 --> 00:51:57,440
but yeah<font color="#E5E5E5"> damn it I'm all out of time</font><font color="#CCCCCC"> if</font>

1063
00:51:55,760 --> 00:51:59,330
you<font color="#E5E5E5"> want to see more please please just</font>

1064
00:51:57,440 --> 00:52:02,350
<font color="#E5E5E5">come grab me</font><font color="#CCCCCC"> and I'll show you</font><font color="#E5E5E5"> more</font>

1065
00:51:59,330 --> 00:52:02,350
sure<font color="#CCCCCC"> thanks</font>

1066
00:52:04,900 --> 00:52:07,059
[Applause]

