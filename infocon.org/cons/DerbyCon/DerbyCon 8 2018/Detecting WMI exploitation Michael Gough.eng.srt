1
00:00:00,000 --> 00:00:05,580
<font color="#CCCCCC">i exploitation I'm Michael</font><font color="#E5E5E5"> Gough I'm the</font>

2
00:00:03,570 --> 00:00:07,350
co-founder of<font color="#CCCCCC"> logon D and how many</font>

3
00:00:05,580 --> 00:00:10,080
<font color="#CCCCCC">people</font><font color="#E5E5E5"> here heard of the windows logging</font>

4
00:00:07,350 --> 00:00:12,660
cheat sheets<font color="#CCCCCC"> oh yeah that's awesome</font>

5
00:00:10,080 --> 00:00:15,570
<font color="#CCCCCC">alright</font><font color="#E5E5E5"> so this whole thing started from</font>

6
00:00:12,660 --> 00:00:17,039
<font color="#E5E5E5">that</font><font color="#CCCCCC"> project which</font><font color="#E5E5E5"> was based off of an</font>

7
00:00:15,570 --> 00:00:19,800
attack from<font color="#E5E5E5"> the winning</font><font color="#CCCCCC"> ta group in</font>

8
00:00:17,039 --> 00:00:21,390
gaming and<font color="#E5E5E5"> it started with</font><font color="#CCCCCC"> one one</font><font color="#E5E5E5"> cheat</font>

9
00:00:19,800 --> 00:00:23,460
sheet there's now<font color="#E5E5E5"> nine if you're unaware</font>

10
00:00:21,390 --> 00:00:25,529
<font color="#CCCCCC">we've released two new cheat sheets the</font>

11
00:00:23,460 --> 00:00:27,390
<font color="#E5E5E5">windows attack logging cheat sheet and</font>

12
00:00:25,529 --> 00:00:29,340
<font color="#E5E5E5">the windows</font><font color="#CCCCCC"> logon D at a</font><font color="#E5E5E5"> clogging cheat</font>

13
00:00:27,390 --> 00:00:32,880
sheet which adds system on and<font color="#CCCCCC"> login D</font>

14
00:00:29,340 --> 00:00:35,160
to the attack matrix<font color="#CCCCCC"> I'm a blue team</font>

15
00:00:32,880 --> 00:00:38,930
defender ninja<font color="#E5E5E5"> incident responder hello</font>

16
00:00:35,160 --> 00:00:38,930
my name<font color="#E5E5E5"> is Michael I'm a</font><font color="#CCCCCC"> logger</font><font color="#E5E5E5"> holic</font>

17
00:00:39,710 --> 00:00:43,290
<font color="#CCCCCC">okay you are awake</font><font color="#E5E5E5"> that see the clapping</font>

18
00:00:42,300 --> 00:00:45,149
work

19
00:00:43,290 --> 00:00:46,410
<font color="#E5E5E5">I am the co-creator along with</font><font color="#CCCCCC"> Brian</font>

20
00:00:45,149 --> 00:00:48,090
<font color="#CCCCCC">Boettcher we are up at the</font><font color="#E5E5E5"> booth we are</font>

21
00:00:46,410 --> 00:00:52,529
sponsors of<font color="#E5E5E5"> Derby con so thank your</font>

22
00:00:48,090 --> 00:00:54,270
sponsors okay you guys are awake<font color="#E5E5E5"> I like</font>

23
00:00:52,530 --> 00:00:55,890
this this is gonna<font color="#E5E5E5"> go good</font><font color="#CCCCCC"> I'm also</font><font color="#E5E5E5"> the</font>

24
00:00:54,270 --> 00:00:57,270
<font color="#E5E5E5">co-host of breaking down</font><font color="#CCCCCC"> incident</font>

25
00:00:55,890 --> 00:00:58,890
<font color="#E5E5E5">response podcast if you're not familiar</font>

26
00:00:57,270 --> 00:01:00,600
with breaking down security<font color="#CCCCCC"> Brian and I</font>

27
00:00:58,890 --> 00:01:02,370
<font color="#E5E5E5">buying</font><font color="#CCCCCC"> Boettcher and I started</font><font color="#E5E5E5"> the</font>

28
00:01:00,600 --> 00:01:04,320
<font color="#E5E5E5">incident response to try to give you</font>

29
00:01:02,370 --> 00:01:06,298
<font color="#E5E5E5">guys a real</font><font color="#CCCCCC"> I can take this</font><font color="#E5E5E5"> back</font><font color="#CCCCCC"> to work</font>

30
00:01:04,319 --> 00:01:09,869
and do kind<font color="#E5E5E5"> of stuff of what we really</font>

31
00:01:06,299 --> 00:01:11,189
see and then I got this yesterday I'm

32
00:01:09,869 --> 00:01:12,960
rather flattered with<font color="#E5E5E5"> this I did not</font>

33
00:01:11,189 --> 00:01:15,539
<font color="#E5E5E5">attend</font><font color="#CCCCCC"> Splunk comp this year I get asked</font>

34
00:01:12,960 --> 00:01:16,740
all<font color="#CCCCCC"> the time</font><font color="#E5E5E5"> but I got this tweet where</font>

35
00:01:15,540 --> 00:01:18,750
it turns out I don't know if<font color="#E5E5E5"> you're</font>

36
00:01:16,740 --> 00:01:20,339
<font color="#E5E5E5">aware that</font><font color="#CCCCCC"> Splunk</font><font color="#E5E5E5"> cough has</font><font color="#CCCCCC"> a boss of</font>

37
00:01:18,750 --> 00:01:22,740
the<font color="#CCCCCC"> NOC</font><font color="#E5E5E5"> and it turns out the winner of</font>

38
00:01:20,340 --> 00:01:24,930
the challenge<font color="#CCCCCC"> named their team hacker</font>

39
00:01:22,740 --> 00:01:26,158
hurricane my<font color="#CCCCCC"> Twitter handle so I guess</font>

40
00:01:24,930 --> 00:01:28,100
one of the<font color="#E5E5E5"> reasons you should listen to</font>

41
00:01:26,159 --> 00:01:30,810
<font color="#E5E5E5">this talk or follow what I preach and</font>

42
00:01:28,100 --> 00:01:33,298
tell<font color="#CCCCCC"> people is</font><font color="#E5E5E5"> because even these</font><font color="#CCCCCC"> guys</font>

43
00:01:30,810 --> 00:01:35,009
they won the boss of the sock contest so

44
00:01:33,299 --> 00:01:36,450
I assume they're using the<font color="#E5E5E5"> food that I I</font>

45
00:01:35,009 --> 00:01:38,159
spread with<font color="#CCCCCC"> the cheat sheets and</font><font color="#E5E5E5"> whatnot</font>

46
00:01:36,450 --> 00:01:39,780
<font color="#E5E5E5">but that's really cool I've</font><font color="#CCCCCC"> never had a</font>

47
00:01:38,159 --> 00:01:43,590
team named after me so I'm happy<font color="#E5E5E5"> about</font>

48
00:01:39,780 --> 00:01:45,540
<font color="#CCCCCC">that one so WMI sudden say</font><font color="#E5E5E5"> whammy</font><font color="#CCCCCC"> ok so</font>

49
00:01:43,590 --> 00:01:48,960
it's either<font color="#E5E5E5"> one</font><font color="#CCCCCC"> whimmy doesn't work when</font>

50
00:01:45,540 --> 00:01:50,909
you<font color="#E5E5E5"> say wmic so women</font><font color="#CCCCCC"> so now it's W make</font>

51
00:01:48,960 --> 00:01:52,289
or<font color="#E5E5E5"> WI from my perspective but you will</font>

52
00:01:50,909 --> 00:01:52,880
hear the word<font color="#CCCCCC"> whimmy that's probably</font>

53
00:01:52,290 --> 00:01:55,049
what<font color="#CCCCCC"> they mean</font>

54
00:01:52,880 --> 00:02:00,270
so<font color="#CCCCCC"> what do we</font><font color="#E5E5E5"> care about</font><font color="#CCCCCC"> this one</font>

55
00:01:55,049 --> 00:02:02,070
<font color="#E5E5E5">because no one wants to be on Brian</font>

56
00:02:00,270 --> 00:02:04,439
Krebs<font color="#CCCCCC"> lists so that's one reason why you</font>

57
00:02:02,070 --> 00:02:06,508
<font color="#E5E5E5">should care about</font><font color="#CCCCCC"> WMI now the other is</font>

58
00:02:04,439 --> 00:02:08,310
the attack<font color="#E5E5E5"> might our attack framework or</font>

59
00:02:06,509 --> 00:02:09,830
a collection of they<font color="#E5E5E5"> don't</font><font color="#CCCCCC"> really</font><font color="#E5E5E5"> want</font>

60
00:02:08,310 --> 00:02:11,910
to<font color="#E5E5E5"> call it a framework anymore the</font>

61
00:02:09,830 --> 00:02:13,050
collection of tactics and<font color="#E5E5E5"> techniques</font>

62
00:02:11,910 --> 00:02:15,810
from<font color="#E5E5E5"> the hacker can</font>

63
00:02:13,050 --> 00:02:17,700
and they've<font color="#CCCCCC"> app these out WMI is</font>

64
00:02:15,810 --> 00:02:20,790
specifically referenced in two of them

65
00:02:17,700 --> 00:02:22,380
and mentioned in 27 other techniques

66
00:02:20,790 --> 00:02:24,660
that<font color="#E5E5E5"> means they're</font><font color="#CCCCCC"> using WMI to query</font>

67
00:02:22,380 --> 00:02:26,579
the<font color="#CCCCCC"> system or get</font><font color="#E5E5E5"> information or do</font>

68
00:02:24,660 --> 00:02:28,680
<font color="#CCCCCC">something and that doesn't include where</font>

69
00:02:26,580 --> 00:02:31,350
<font color="#CCCCCC">WMI is using PowerShell where they've</font>

70
00:02:28,680 --> 00:02:32,820
referenced<font color="#E5E5E5"> PowerShell so</font><font color="#CCCCCC"> WMI</font><font color="#E5E5E5"> is pretty</font>

71
00:02:31,350 --> 00:02:35,850
littered through the attack<font color="#E5E5E5"> mitre</font>

72
00:02:32,820 --> 00:02:37,380
framework<font color="#CCCCCC"> and so I recommend</font><font color="#E5E5E5"> that this</font>

73
00:02:35,850 --> 00:02:39,299
is a good way to map it if you want<font color="#E5E5E5"> to</font>

74
00:02:37,380 --> 00:02:40,680
see this mapping come up to the booth

75
00:02:39,300 --> 00:02:43,200
<font color="#E5E5E5">and you will show it's all</font><font color="#CCCCCC"> color-coded</font>

76
00:02:40,680 --> 00:02:44,100
<font color="#CCCCCC">and whatnot and again they use this</font><font color="#E5E5E5"> for</font>

77
00:02:43,200 --> 00:02:47,070
a<font color="#E5E5E5"> lot of purposes</font>

78
00:02:44,100 --> 00:02:48,510
<font color="#CCCCCC">WMI</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> built-in much like</font><font color="#E5E5E5"> PowerShell but</font>

79
00:02:47,070 --> 00:02:50,850
<font color="#E5E5E5">Windows doesn't lock it very well like</font>

80
00:02:48,510 --> 00:02:52,530
like really<font color="#E5E5E5"> badly so</font><font color="#CCCCCC"> there's a lot</font><font color="#E5E5E5"> of</font>

81
00:02:50,850 --> 00:02:54,329
opportunity<font color="#CCCCCC"> here for</font><font color="#E5E5E5"> pen testers and</font>

82
00:02:52,530 --> 00:02:56,790
hackers<font color="#E5E5E5"> to utilize</font><font color="#CCCCCC"> WMI which has</font>

83
00:02:54,330 --> 00:02:58,320
incredible power for the system queried

84
00:02:56,790 --> 00:02:59,579
system<font color="#CCCCCC"> information right you know who's</font>

85
00:02:58,320 --> 00:03:02,100
logged in who's doing this what's

86
00:02:59,580 --> 00:03:04,020
running<font color="#E5E5E5"> on the</font><font color="#CCCCCC"> box etc remotely</font><font color="#E5E5E5"> execute</font>

87
00:03:02,100 --> 00:03:06,060
payloads<font color="#E5E5E5"> a really bad thing</font>

88
00:03:04,020 --> 00:03:08,100
remotely persists so it even has a

89
00:03:06,060 --> 00:03:10,980
<font color="#E5E5E5">capability of persistence so we need to</font>

90
00:03:08,100 --> 00:03:12,420
understand what<font color="#E5E5E5"> can</font><font color="#CCCCCC"> be done with WMI so</font>

91
00:03:10,980 --> 00:03:14,250
we can stop the<font color="#CCCCCC"> matte</font><font color="#E5E5E5"> gray</font><font color="#CCCCCC"> burs and the</font>

92
00:03:12,420 --> 00:03:16,829
Dave Kennedy's and<font color="#E5E5E5"> the bent ends of the</font>

93
00:03:14,250 --> 00:03:18,570
world<font color="#E5E5E5"> and detect them in regards to</font>

94
00:03:16,830 --> 00:03:20,550
their tests<font color="#E5E5E5"> and/or the hackers bad foo</font>

95
00:03:18,570 --> 00:03:22,320
<font color="#E5E5E5">now much like we see them incur when you</font>

96
00:03:20,550 --> 00:03:24,780
sort from<font color="#E5E5E5"> and</font><font color="#CCCCCC"> Ian</font><font color="#E5E5E5"> doing talks and</font><font color="#CCCCCC"> WMI</font>

97
00:03:22,320 --> 00:03:27,480
and now with<font color="#E5E5E5"> endgame</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> again it's one</font>

98
00:03:24,780 --> 00:03:29,850
<font color="#CCCCCC">reason we</font><font color="#E5E5E5"> created this attack matrix is</font>

99
00:03:27,480 --> 00:03:31,799
because of what<font color="#CCCCCC"> WMI and we added</font><font color="#E5E5E5"> a lot</font>

100
00:03:29,850 --> 00:03:33,780
<font color="#E5E5E5">of updates</font><font color="#CCCCCC"> to login D with the</font><font color="#E5E5E5"> latest</font>

101
00:03:31,800 --> 00:03:35,940
version where<font color="#CCCCCC"> we are</font><font color="#E5E5E5"> probably the only</font>

102
00:03:33,780 --> 00:03:37,950
tool that queries the<font color="#E5E5E5"> WMI namespace not</font>

103
00:03:35,940 --> 00:03:40,350
just the root subscription but all of

104
00:03:37,950 --> 00:03:42,540
the WMI namespace<font color="#E5E5E5"> thanks max graver for</font>

105
00:03:40,350 --> 00:03:45,420
that one<font color="#CCCCCC"> and is blackhat</font><font color="#E5E5E5"> 2018 talk we</font>

106
00:03:42,540 --> 00:03:47,040
went back and filled that hole<font color="#CCCCCC"> so what</font>

107
00:03:45,420 --> 00:03:49,109
is<font color="#CCCCCC"> w mine well it's the windows</font>

108
00:03:47,040 --> 00:03:51,660
<font color="#CCCCCC">management interface think of it as SNMP</font>

109
00:03:49,110 --> 00:03:53,400
on steroids right<font color="#E5E5E5"> SNMP just sends an</font>

110
00:03:51,660 --> 00:03:55,020
informational work out to a system to

111
00:03:53,400 --> 00:03:57,390
collect and tell you hey the routers

112
00:03:55,020 --> 00:03:59,430
down or hey the CPUs hot but this thing

113
00:03:57,390 --> 00:04:02,579
can<font color="#CCCCCC"> actually interact with the system</font>

114
00:03:59,430 --> 00:04:04,530
<font color="#CCCCCC">WMI</font><font color="#E5E5E5"> unlike SNMP you</font><font color="#CCCCCC"> can query</font><font color="#E5E5E5"> all kinds</font>

115
00:04:02,580 --> 00:04:06,270
of information<font color="#E5E5E5"> about</font><font color="#CCCCCC"> the system</font><font color="#E5E5E5"> you can</font>

116
00:04:04,530 --> 00:04:08,550
even write scripts or applications that

117
00:04:06,270 --> 00:04:10,200
<font color="#E5E5E5">can actually do administrative tax tasks</font>

118
00:04:08,550 --> 00:04:12,390
or actions that's stored in the WMI

119
00:04:10,200 --> 00:04:13,859
database and so it's also<font color="#E5E5E5"> part</font><font color="#CCCCCC"> of the</font>

120
00:04:12,390 --> 00:04:16,079
operating system<font color="#CCCCCC"> right living</font><font color="#E5E5E5"> off the</font>

121
00:04:13,860 --> 00:04:17,489
lands a big<font color="#CCCCCC"> thing</font><font color="#E5E5E5"> here this is a</font>

122
00:04:16,079 --> 00:04:18,899
reference<font color="#E5E5E5"> slide this comes from</font><font color="#CCCCCC"> Matt and</font>

123
00:04:17,488 --> 00:04:21,089
<font color="#E5E5E5">other talks where basically all the</font>

124
00:04:18,899 --> 00:04:23,310
components<font color="#E5E5E5"> you got wmic the</font><font color="#CCCCCC"> command-line</font>

125
00:04:21,089 --> 00:04:26,280
utility<font color="#E5E5E5"> there was a recent write-up</font>

126
00:04:23,310 --> 00:04:26,780
about wwic being used<font color="#E5E5E5"> from a dot link</font>

127
00:04:26,280 --> 00:04:28,099
<font color="#E5E5E5">file</font>

128
00:04:26,780 --> 00:04:29,599
go out and fetch a payload from the

129
00:04:28,100 --> 00:04:32,450
<font color="#CCCCCC">internet and</font><font color="#E5E5E5"> again that would bypass</font>

130
00:04:29,600 --> 00:04:35,419
whitelisting because<font color="#CCCCCC"> WIC is</font><font color="#E5E5E5"> a trusted</font>

131
00:04:32,450 --> 00:04:37,820
<font color="#E5E5E5">Microsoft binary you got vbscript you</font>

132
00:04:35,419 --> 00:04:39,200
can use jscript<font color="#CCCCCC"> WBM test is a testing</font>

133
00:04:37,820 --> 00:04:41,630
utility you can<font color="#CCCCCC"> utilize that and</font>

134
00:04:39,200 --> 00:04:44,810
<font color="#CCCCCC">potentially misuse that you got C++ and</font>

135
00:04:41,630 --> 00:04:46,490
<font color="#E5E5E5">comm on demand</font><font color="#CCCCCC"> compiling can happen</font>

136
00:04:44,810 --> 00:04:48,200
you've got win<font color="#E5E5E5"> windows remote management</font>

137
00:04:46,490 --> 00:04:50,240
<font color="#E5E5E5">when are in stuff you've got the windows</font>

138
00:04:48,200 --> 00:04:52,639
remote system stuff you got<font color="#E5E5E5"> the W</font><font color="#CCCCCC"> query</font>

139
00:04:50,240 --> 00:04:54,980
<font color="#E5E5E5">language the whole query system that WI</font>

140
00:04:52,639 --> 00:04:57,080
uses you<font color="#E5E5E5"> got some dll's you got comm and</font>

141
00:04:54,980 --> 00:04:59,090
again you got<font color="#CCCCCC"> wrm with PowerShell</font>

142
00:04:57,080 --> 00:05:00,409
<font color="#CCCCCC">remoting in there so boom use large</font>

143
00:04:59,090 --> 00:05:02,479
<font color="#E5E5E5">PowerShell and</font><font color="#CCCCCC"> I can start removing</font>

144
00:05:00,410 --> 00:05:04,190
around your environment<font color="#CCCCCC"> W my as a</font>

145
00:05:02,480 --> 00:05:06,650
service is<font color="#CCCCCC"> running which means</font><font color="#E5E5E5"> side</font>

146
00:05:04,190 --> 00:05:08,210
<font color="#E5E5E5">loading can occur</font><font color="#CCCCCC"> the same</font><font color="#E5E5E5"> objects which</font>

147
00:05:06,650 --> 00:05:10,099
<font color="#CCCCCC">is the databases where all this stuff is</font>

148
00:05:08,210 --> 00:05:12,950
stored can be used for persistence and

149
00:05:10,100 --> 00:05:14,960
and a way<font color="#E5E5E5"> to store your food</font><font color="#CCCCCC"> PowerShell</font>

150
00:05:12,950 --> 00:05:16,880
scripts<font color="#CCCCCC"> and/or binaries and of course</font>

151
00:05:14,960 --> 00:05:19,989
there's a repo<font color="#CCCCCC"> and you can use</font><font color="#E5E5E5"> ma files</font>

152
00:05:16,880 --> 00:05:22,580
to install this so anybody concerned yet

153
00:05:19,990 --> 00:05:24,140
so where does<font color="#E5E5E5"> it live</font><font color="#CCCCCC"> the first thing we</font>

154
00:05:22,580 --> 00:05:26,210
need to understand is where these<font color="#CCCCCC"> pieces</font>

155
00:05:24,140 --> 00:05:27,800
<font color="#E5E5E5">and parts exist in the system</font><font color="#CCCCCC"> one of the</font>

156
00:05:26,210 --> 00:05:29,479
big ones is wbem

157
00:05:27,800 --> 00:05:32,090
I highly<font color="#E5E5E5"> recommend you monitor this</font>

158
00:05:29,479 --> 00:05:33,710
directory<font color="#CCCCCC"> this</font><font color="#E5E5E5"> is where we NT I dropped</font>

159
00:05:32,090 --> 00:05:35,719
some malicious<font color="#E5E5E5"> DLL</font><font color="#CCCCCC"> 'he's taking</font>

160
00:05:33,710 --> 00:05:37,130
advantage of W my loading on a server

161
00:05:35,720 --> 00:05:39,740
<font color="#E5E5E5">pretty much every five minutes</font>

162
00:05:37,130 --> 00:05:41,630
thus loading the bad<font color="#CCCCCC"> dll</font><font color="#E5E5E5"> which would</font>

163
00:05:39,740 --> 00:05:44,030
then load the good<font color="#E5E5E5"> deals and the box was</font>

164
00:05:41,630 --> 00:05:46,700
infected<font color="#E5E5E5"> no typical auto runs a side</font>

165
00:05:44,030 --> 00:05:49,400
load<font color="#E5E5E5"> scenario</font><font color="#CCCCCC"> you also have to look in</font>

166
00:05:46,700 --> 00:05:51,380
<font color="#CCCCCC">wbm slash repository</font><font color="#E5E5E5"> that's where the</font><font color="#CCCCCC"> W</font>

167
00:05:49,400 --> 00:05:55,099
my databases live and the three

168
00:05:51,380 --> 00:05:57,560
utilities<font color="#E5E5E5"> W my</font><font color="#CCCCCC"> 80 a PW my ap SRV and</font>

169
00:05:55,100 --> 00:05:59,150
specifically<font color="#E5E5E5"> W my PRBS</font><font color="#CCCCCC"> e which you're</font>

170
00:05:57,560 --> 00:06:01,370
going to see used a lot<font color="#E5E5E5"> in</font><font color="#CCCCCC"> espresso</font>

171
00:05:59,150 --> 00:06:02,900
<font color="#E5E5E5">watch the execution of this one that's</font>

172
00:06:01,370 --> 00:06:04,340
<font color="#E5E5E5">really important this is where a lot</font><font color="#CCCCCC"> of</font>

173
00:06:02,900 --> 00:06:06,620
the food<font color="#CCCCCC"> that the pen testers and</font><font color="#E5E5E5"> bad</font>

174
00:06:04,340 --> 00:06:08,780
guys will use to query<font color="#E5E5E5"> your box and do</font>

175
00:06:06,620 --> 00:06:11,390
malicious stuff<font color="#CCCCCC"> and of course the</font>

176
00:06:08,780 --> 00:06:12,830
databases index<font color="#CCCCCC"> PTR at objects data they</font>

177
00:06:11,390 --> 00:06:14,479
<font color="#E5E5E5">are</font><font color="#CCCCCC"> databases but there's a lot</font><font color="#E5E5E5"> of stuff</font>

178
00:06:12,830 --> 00:06:16,520
in<font color="#CCCCCC"> clear-text so you could</font><font color="#E5E5E5"> just string</font>

179
00:06:14,479 --> 00:06:18,770
out these databases or use a tool

180
00:06:16,520 --> 00:06:20,450
<font color="#E5E5E5">whatever scripts a Python whatever you</font>

181
00:06:18,770 --> 00:06:22,070
can<font color="#E5E5E5"> find that</font><font color="#CCCCCC"> will actually</font><font color="#E5E5E5"> query</font>

182
00:06:20,450 --> 00:06:23,900
<font color="#E5E5E5">through the database</font><font color="#CCCCCC"> and report to</font><font color="#E5E5E5"> you</font>

183
00:06:22,070 --> 00:06:26,240
what's in there like it to a like a log

184
00:06:23,900 --> 00:06:28,820
<font color="#E5E5E5">MD</font><font color="#CCCCCC"> or anything else</font><font color="#E5E5E5"> some utilities do</font>

185
00:06:26,240 --> 00:06:30,560
exist<font color="#E5E5E5"> wmic</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> system 32 so you're gonna</font>

186
00:06:28,820 --> 00:06:32,349
watch the execution<font color="#CCCCCC"> of that so there's</font>

187
00:06:30,560 --> 00:06:34,550
lots of<font color="#E5E5E5"> components</font><font color="#CCCCCC"> here that WMI has</font>

188
00:06:32,350 --> 00:06:36,500
tool failures<font color="#CCCCCC"> well laptop</font><font color="#E5E5E5"> and a</font>

189
00:06:34,550 --> 00:06:38,090
dishwasher<font color="#E5E5E5"> isn't one of them and I got</font>

190
00:06:36,500 --> 00:06:38,720
this<font color="#E5E5E5"> on Twitter I just thought this is</font>

191
00:06:38,090 --> 00:06:40,429
<font color="#E5E5E5">awesome</font>

192
00:06:38,720 --> 00:06:42,290
he's clearly<font color="#E5E5E5"> a tool</font>

193
00:06:40,430 --> 00:06:44,870
and so I<font color="#E5E5E5"> just had</font><font color="#CCCCCC"> to include this</font>

194
00:06:42,290 --> 00:06:46,400
<font color="#CCCCCC">because</font><font color="#E5E5E5"> yeah that's he is and as the</font>

195
00:06:44,870 --> 00:06:50,810
Brits and<font color="#CCCCCC"> Aussie say he's clearly pissed</font>

196
00:06:46,400 --> 00:06:53,150
<font color="#E5E5E5">anyway the tool failure number one is</font>

197
00:06:50,810 --> 00:06:55,479
<font color="#CCCCCC">window sysinternals auto</font><font color="#E5E5E5"> runs again</font>

198
00:06:53,150 --> 00:06:58,008
based on<font color="#CCCCCC"> Matt</font><font color="#E5E5E5"> graters talk at blackhat</font>

199
00:06:55,479 --> 00:07:00,229
<font color="#CCCCCC">he found</font><font color="#E5E5E5"> that he can modify other</font>

200
00:06:58,009 --> 00:07:01,370
components within other<font color="#E5E5E5"> namespaces not</font>

201
00:07:00,229 --> 00:07:03,500
just<font color="#CCCCCC"> root subscription</font>

202
00:07:01,370 --> 00:07:05,360
unfortunately the auto runs module

203
00:07:03,500 --> 00:07:07,039
assistant journals<font color="#CCCCCC"> only looks at</font><font color="#E5E5E5"> the</font>

204
00:07:05,360 --> 00:07:09,080
items in the<font color="#E5E5E5"> root subscription so there</font>

205
00:07:07,039 --> 00:07:11,030
is a gap<font color="#CCCCCC"> here I'm so be careful there</font>

206
00:07:09,080 --> 00:07:13,909
<font color="#E5E5E5">and definitely</font><font color="#CCCCCC"> watch Matt and</font><font color="#E5E5E5"> Lee's talk</font>

207
00:07:11,030 --> 00:07:15,979
<font color="#E5E5E5">black hat sis Mons another one similar</font>

208
00:07:13,910 --> 00:07:17,870
<font color="#E5E5E5">scenario it unfortunately only looks at</font>

209
00:07:15,979 --> 00:07:19,190
the<font color="#E5E5E5"> root subscription</font><font color="#CCCCCC"> nobody's really</font>

210
00:07:17,870 --> 00:07:20,780
done a<font color="#E5E5E5"> lot of research</font><font color="#CCCCCC"> and so that's</font>

211
00:07:19,190 --> 00:07:22,310
kind of where we<font color="#E5E5E5"> all</font><font color="#CCCCCC"> stop</font><font color="#E5E5E5"> I even admit</font>

212
00:07:20,780 --> 00:07:24,229
we did that<font color="#CCCCCC"> login D initially because</font>

213
00:07:22,310 --> 00:07:25,970
that's what<font color="#E5E5E5"> everybody else does until of</font>

214
00:07:24,229 --> 00:07:28,400
course Matt<font color="#E5E5E5"> graver talks and we always</font>

215
00:07:25,970 --> 00:07:30,770
<font color="#E5E5E5">have more work</font><font color="#CCCCCC"> to do when he talks</font><font color="#E5E5E5"> and</font>

216
00:07:28,400 --> 00:07:32,419
again<font color="#CCCCCC"> sis Mon does</font><font color="#E5E5E5"> not</font><font color="#CCCCCC"> CW my calls at</font>

217
00:07:30,770 --> 00:07:33,740
all<font color="#E5E5E5"> there's</font><font color="#CCCCCC"> nothing in system on to do</font>

218
00:07:32,419 --> 00:07:34,940
this it doesn't<font color="#CCCCCC"> see remote</font><font color="#E5E5E5"> windows</font>

219
00:07:33,740 --> 00:07:36,710
<font color="#E5E5E5">remote management doesn't see that</font>

220
00:07:34,940 --> 00:07:38,570
<font color="#E5E5E5">doesn't see any authentication and</font>

221
00:07:36,710 --> 00:07:40,190
doesn't see<font color="#E5E5E5"> PowerShell so there's some</font>

222
00:07:38,570 --> 00:07:41,690
<font color="#E5E5E5">things that system on just does not see</font>

223
00:07:40,190 --> 00:07:44,810
that you'll have<font color="#CCCCCC"> to use built-in windows</font>

224
00:07:41,690 --> 00:07:46,219
logs to do<font color="#CCCCCC"> and again do you have a tool</font>

225
00:07:44,810 --> 00:07:47,870
I want<font color="#E5E5E5"> to see her say I want</font><font color="#CCCCCC"> to see some</font>

226
00:07:46,220 --> 00:07:49,880
hands here do you have<font color="#CCCCCC"> a tool that</font>

227
00:07:47,870 --> 00:07:52,310
searches<font color="#E5E5E5"> the</font><font color="#CCCCCC"> WMI database that searches</font>

228
00:07:49,880 --> 00:07:54,050
<font color="#E5E5E5">for W my persistence that searches</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> W</font>

229
00:07:52,310 --> 00:07:55,880
my execution that searches<font color="#CCCCCC"> for W my</font>

230
00:07:54,050 --> 00:07:59,030
authentication<font color="#E5E5E5"> are you</font><font color="#CCCCCC"> catching my drift</font>

231
00:07:55,880 --> 00:08:01,760
<font color="#CCCCCC">I don't see a</font><font color="#E5E5E5"> lot of hands so it's a gap</font>

232
00:07:59,030 --> 00:08:02,929
<font color="#E5E5E5">seriously as a gap</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> is more of a hit</font>

233
00:08:01,760 --> 00:08:04,760
and<font color="#CCCCCC"> miss some eighty yards will do</font>

234
00:08:02,930 --> 00:08:06,650
pieces and parts based on<font color="#E5E5E5"> what execute</font>

235
00:08:04,760 --> 00:08:08,630
<font color="#CCCCCC">sab wmic goes the internet it's probably</font>

236
00:08:06,650 --> 00:08:09,888
gonna flag<font color="#CCCCCC"> and from</font><font color="#E5E5E5"> that perspective but</font>

237
00:08:08,630 --> 00:08:11,630
there's a lot<font color="#E5E5E5"> of gaps here what they do</font>

238
00:08:09,889 --> 00:08:13,460
and do not<font color="#E5E5E5"> look at and so it's the</font>

239
00:08:11,630 --> 00:08:14,719
perfect<font color="#CCCCCC"> opportunity to</font><font color="#E5E5E5"> hunt in your</font>

240
00:08:13,460 --> 00:08:16,909
environment<font color="#CCCCCC"> for</font><font color="#E5E5E5"> these kinds of things</font>

241
00:08:14,720 --> 00:08:19,430
<font color="#E5E5E5">that we're going to talk</font><font color="#CCCCCC"> about that so</font>

242
00:08:16,909 --> 00:08:22,789
how do we<font color="#E5E5E5"> get pwned by</font><font color="#CCCCCC"> WMI well of</font>

243
00:08:19,430 --> 00:08:26,930
course<font color="#CCCCCC"> arnold's you know W my scares me</font>

244
00:08:22,789 --> 00:08:28,940
again<font color="#E5E5E5"> I don't if you detect</font><font color="#CCCCCC"> it well</font><font color="#E5E5E5"> it</font>

245
00:08:26,930 --> 00:08:30,289
there's definitely a challenge here I'm

246
00:08:28,940 --> 00:08:31,820
<font color="#E5E5E5">gonna talk about</font><font color="#CCCCCC"> what those challenges</font>

247
00:08:30,289 --> 00:08:34,159
are<font color="#E5E5E5"> and how you can get better at this</font>

248
00:08:31,820 --> 00:08:36,080
<font color="#CCCCCC">area</font><font color="#E5E5E5"> and I highly</font><font color="#CCCCCC"> recommend</font><font color="#E5E5E5"> you do get</font>

249
00:08:34,159 --> 00:08:37,069
better in this<font color="#E5E5E5"> area or Tyler's</font><font color="#CCCCCC"> gonna</font>

250
00:08:36,080 --> 00:08:42,099
take advantage<font color="#CCCCCC"> of</font><font color="#E5E5E5"> you and</font><font color="#CCCCCC"> as Mauer</font>

251
00:08:37,070 --> 00:08:42,099
<font color="#CCCCCC">analysis class right</font>

252
00:08:42,500 --> 00:08:46,700
<font color="#E5E5E5">it can be very low noise if it's done</font>

253
00:08:44,780 --> 00:08:48,050
well<font color="#E5E5E5"> that's the other really important</font>

254
00:08:46,700 --> 00:08:49,520
point here which I'm<font color="#CCCCCC"> going to point</font><font color="#E5E5E5"> out</font>

255
00:08:48,050 --> 00:08:52,250
<font color="#CCCCCC">to you in</font><font color="#E5E5E5"> regards to how certain things</font>

256
00:08:49,520 --> 00:08:54,050
<font color="#E5E5E5">occur</font><font color="#CCCCCC"> and then what WMI does it's kind</font>

257
00:08:52,250 --> 00:08:56,510
of scary<font color="#CCCCCC"> honestly I think the general</font>

258
00:08:54,050 --> 00:08:58,790
analysts are typical<font color="#E5E5E5"> analysts will blow</font>

259
00:08:56,510 --> 00:09:01,730
this by<font color="#CCCCCC"> WMI naturally occurs a lot in</font>

260
00:08:58,790 --> 00:09:03,020
systems so it<font color="#E5E5E5"> it is a fairly noisy by</font>

261
00:09:01,730 --> 00:09:05,240
default and you have to look<font color="#E5E5E5"> for these</font>

262
00:09:03,020 --> 00:09:07,010
odd nuances to<font color="#CCCCCC"> catch what's going on</font>

263
00:09:05,240 --> 00:09:08,390
and of course<font color="#E5E5E5"> pen testers</font><font color="#CCCCCC"> read tumors</font>

264
00:09:07,010 --> 00:09:11,600
love this<font color="#E5E5E5"> stuff because of the ability</font>

265
00:09:08,390 --> 00:09:13,580
<font color="#CCCCCC">to query a system you know any pen</font>

266
00:09:11,600 --> 00:09:16,400
tester<font color="#CCCCCC"> whether it's</font><font color="#E5E5E5"> callers</font><font color="#CCCCCC"> piraeus</font>

267
00:09:13,580 --> 00:09:17,900
<font color="#E5E5E5">event an or Dave or Matt will use</font><font color="#CCCCCC"> WMI to</font>

268
00:09:16,400 --> 00:09:19,760
find out what the heck's running<font color="#CCCCCC"> in the</font>

269
00:09:17,900 --> 00:09:21,230
<font color="#CCCCCC">box what processes</font><font color="#E5E5E5"> are</font><font color="#CCCCCC"> running</font><font color="#E5E5E5"> which</font>

270
00:09:19,760 --> 00:09:23,150
will tell me what EDR is in a box or

271
00:09:21,230 --> 00:09:24,290
what security<font color="#E5E5E5"> tools are unbox and if you</font>

272
00:09:23,150 --> 00:09:29,840
want to<font color="#CCCCCC"> execute something</font><font color="#E5E5E5"> against the</font>

273
00:09:24,290 --> 00:09:31,250
box<font color="#CCCCCC"> all you need</font><font color="#E5E5E5"> is creds figure you're</font>

274
00:09:29,840 --> 00:09:32,720
a lot better<font color="#E5E5E5"> than cactus</font><font color="#CCCCCC"> card you hear</font>

275
00:09:31,250 --> 00:09:33,530
that cactus<font color="#CCCCCC"> con guys see the thing</font>

276
00:09:32,720 --> 00:09:34,610
<font color="#CCCCCC">nobody they know what do</font><font color="#E5E5E5"> you participate</font>

277
00:09:33,530 --> 00:09:37,430
these guys are fun

278
00:09:34,610 --> 00:09:40,130
I like this<font color="#E5E5E5"> and</font><font color="#CCCCCC"> WMI has tons of</font>

279
00:09:37,430 --> 00:09:42,650
capabilities and a lack of<font color="#E5E5E5"> tools to hunt</font>

280
00:09:40,130 --> 00:09:45,290
for it<font color="#E5E5E5"> so that's the that's</font><font color="#CCCCCC"> the thing</font><font color="#E5E5E5"> so</font>

281
00:09:42,650 --> 00:09:47,180
<font color="#CCCCCC">WMI pwnage</font><font color="#E5E5E5"> again so many ways you can</font>

282
00:09:45,290 --> 00:09:49,219
<font color="#E5E5E5">install a malicious</font><font color="#CCCCCC"> smoth</font><font color="#E5E5E5"> so my</font>

283
00:09:47,180 --> 00:09:51,290
discussions<font color="#E5E5E5"> would have occur</font><font color="#CCCCCC"> I said so</font>

284
00:09:49,220 --> 00:09:53,060
moths<font color="#E5E5E5"> exist in</font><font color="#CCCCCC"> the WBM directory I can</font>

285
00:09:51,290 --> 00:09:55,189
<font color="#CCCCCC">just watch for them to be</font><font color="#E5E5E5"> placed there</font>

286
00:09:53,060 --> 00:09:57,910
and executed no no they can be<font color="#E5E5E5"> executed</font>

287
00:09:55,190 --> 00:10:00,560
<font color="#E5E5E5">anywhere on the box</font><font color="#CCCCCC"> damn</font><font color="#E5E5E5"> it Microsoft</font>

288
00:09:57,910 --> 00:10:02,510
site<font color="#CCCCCC"> loaded malicious DLL when you drop</font>

289
00:10:00,560 --> 00:10:04,939
<font color="#E5E5E5">it in</font><font color="#CCCCCC"> wpm which I saw with the winning</font>

290
00:10:02,510 --> 00:10:06,710
<font color="#CCCCCC">TI group hard thing to detect because</font><font color="#E5E5E5"> on</font>

291
00:10:04,940 --> 00:10:07,910
a server<font color="#CCCCCC"> that behavior looks totally</font>

292
00:10:06,710 --> 00:10:09,589
normal there's nothing weird

293
00:10:07,910 --> 00:10:13,160
other than the<font color="#E5E5E5"> DLL is in the wrong place</font>

294
00:10:09,589 --> 00:10:14,720
<font color="#CCCCCC">and Windows doesn't log PLO loads sis</font>

295
00:10:13,160 --> 00:10:15,740
<font color="#CCCCCC">Mon does</font><font color="#E5E5E5"> so you don't have system on</font>

296
00:10:14,720 --> 00:10:17,210
everywhere which most<font color="#E5E5E5"> of us probably</font>

297
00:10:15,740 --> 00:10:19,970
don't how<font color="#E5E5E5"> many people here running</font>

298
00:10:17,210 --> 00:10:22,160
<font color="#E5E5E5">system on in some capacity that's</font>

299
00:10:19,970 --> 00:10:24,740
actually more<font color="#E5E5E5"> than I thought</font>

300
00:10:22,160 --> 00:10:26,060
<font color="#E5E5E5">but yeah again</font><font color="#CCCCCC"> not a</font><font color="#E5E5E5"> lot here so system</font>

301
00:10:24,740 --> 00:10:27,410
on does give you<font color="#E5E5E5"> DLL this is probably</font>

302
00:10:26,060 --> 00:10:29,750
the number<font color="#E5E5E5"> one reason to use system on</font>

303
00:10:27,410 --> 00:10:32,540
<font color="#CCCCCC">its the DLL loading paja loads ID seven</font>

304
00:10:29,750 --> 00:10:34,490
and<font color="#E5E5E5"> again you can remotely execute</font><font color="#CCCCCC"> WMI</font>

305
00:10:32,540 --> 00:10:37,699
and launch<font color="#CCCCCC"> malicious code an exe a</font>

306
00:10:34,490 --> 00:10:38,930
script whitelist bypass of course exe so

307
00:10:37,700 --> 00:10:40,910
you can launch<font color="#E5E5E5"> any other stuff</font><font color="#CCCCCC"> that</font>

308
00:10:38,930 --> 00:10:43,430
Casey Smith talks about you can remotely

309
00:10:40,910 --> 00:10:45,170
install a task and a service you

310
00:10:43,430 --> 00:10:47,569
remotely launch PowerShell code<font color="#E5E5E5"> yay</font>

311
00:10:45,170 --> 00:10:49,910
<font color="#CCCCCC">parish all has all the</font><font color="#E5E5E5"> power net at its</font>

312
00:10:47,570 --> 00:10:51,920
disposal<font color="#CCCCCC"> you</font><font color="#E5E5E5"> can add</font><font color="#CCCCCC"> coda persistence</font>

313
00:10:49,910 --> 00:10:53,630
<font color="#CCCCCC">into W my database there's lots of</font>

314
00:10:51,920 --> 00:10:56,180
options<font color="#CCCCCC"> here you can kill a running</font>

315
00:10:53,630 --> 00:10:58,040
process<font color="#CCCCCC"> a que your</font><font color="#E5E5E5"> security tools</font>

316
00:10:56,180 --> 00:11:01,579
and just<font color="#E5E5E5"> ask Carlos about what he does</font>

317
00:10:58,040 --> 00:11:03,469
<font color="#E5E5E5">with W my commences</font><font color="#CCCCCC"> his attack</font><font color="#E5E5E5"> and etc</font>

318
00:11:01,580 --> 00:11:05,590
etc etc<font color="#E5E5E5"> I mean</font><font color="#CCCCCC"> the power is almost</font>

319
00:11:03,470 --> 00:11:07,940
<font color="#E5E5E5">endless</font><font color="#CCCCCC"> mas</font><font color="#E5E5E5"> gonna be installed anywhere</font>

320
00:11:05,590 --> 00:11:09,980
<font color="#CCCCCC">so</font><font color="#E5E5E5"> just saying I'm gonna go look</font><font color="#CCCCCC"> for dot</font>

321
00:11:07,940 --> 00:11:12,050
my files for something malicious I think

322
00:11:09,980 --> 00:11:14,690
Devon or Matt gave me a malicious calc

323
00:11:12,050 --> 00:11:15,229
<font color="#CCCCCC">MA file that I used for testing a</font><font color="#E5E5E5"> couple</font>

324
00:11:14,690 --> 00:11:16,700
years<font color="#E5E5E5"> ago</font>

325
00:11:15,230 --> 00:11:19,760
and ya can place it anywhere<font color="#E5E5E5"> and launch</font>

326
00:11:16,700 --> 00:11:21,470
mom<font color="#CCCCCC"> comp space this my file and boom you</font>

327
00:11:19,760 --> 00:11:26,990
<font color="#E5E5E5">get you know basically where</font><font color="#CCCCCC"> it executed</font>

328
00:11:21,470 --> 00:11:29,780
<font color="#CCCCCC">from and</font><font color="#E5E5E5"> that's it</font><font color="#CCCCCC"> W my</font><font color="#E5E5E5"> AP</font><font color="#CCCCCC"> ad AP AP SRV</font>

329
00:11:26,990 --> 00:11:32,420
and specifically<font color="#CCCCCC"> P R vs e start and stop</font>

330
00:11:29,780 --> 00:11:34,730
on systems especially servers<font color="#E5E5E5"> more so in</font>

331
00:11:32,420 --> 00:11:36,469
<font color="#E5E5E5">Windows 10 more so insistence that has</font>

332
00:11:34,730 --> 00:11:39,380
<font color="#CCCCCC">specific hardware like raid controllers</font>

333
00:11:36,470 --> 00:11:40,700
<font color="#E5E5E5">specialized</font><font color="#CCCCCC"> NICs storage etc you'll see</font>

334
00:11:39,380 --> 00:11:42,470
those start and stop like in the gaming

335
00:11:40,700 --> 00:11:43,850
<font color="#E5E5E5">environment</font><font color="#CCCCCC"> hit tons of that it's</font>

336
00:11:42,470 --> 00:11:45,230
constantly starting<font color="#E5E5E5"> stopping starting</font>

337
00:11:43,850 --> 00:11:47,510
and stopping<font color="#E5E5E5"> so you really couldn't</font><font color="#CCCCCC"> pull</font>

338
00:11:45,230 --> 00:11:50,180
out any malicious intent there at all

339
00:11:47,510 --> 00:11:52,460
<font color="#E5E5E5">from just</font><font color="#CCCCCC"> that normal behavior and then</font>

340
00:11:50,180 --> 00:11:54,729
boom once<font color="#CCCCCC"> WMI starts then poof</font><font color="#E5E5E5"> you're</font>

341
00:11:52,460 --> 00:11:57,110
infected if they<font color="#E5E5E5"> side load a bad DLL</font><font color="#CCCCCC"> and</font>

342
00:11:54,730 --> 00:11:58,490
when NT<font color="#CCCCCC"> ID group</font><font color="#E5E5E5"> use this in the gaming</font>

343
00:11:57,110 --> 00:12:00,830
<font color="#E5E5E5">as I pointed out so you can read</font><font color="#CCCCCC"> up more</font>

344
00:11:58,490 --> 00:12:03,650
about that<font color="#E5E5E5"> in reports that have been</font>

345
00:12:00,830 --> 00:12:04,850
<font color="#CCCCCC">issued about Quinn and Ti so some pwnage</font>

346
00:12:03,650 --> 00:12:08,030
tools if you<font color="#E5E5E5"> want to play and do some</font>

347
00:12:04,850 --> 00:12:10,280
research<font color="#CCCCCC"> win a women LM</font><font color="#E5E5E5"> weenie implant</font>

348
00:12:08,030 --> 00:12:12,620
<font color="#CCCCCC">power</font><font color="#E5E5E5"> sploit</font><font color="#CCCCCC"> in PowerShell X Empire I</font>

349
00:12:10,280 --> 00:12:14,420
<font color="#CCCCCC">tested the first two</font><font color="#E5E5E5"> again I tried to</font>

350
00:12:12,620 --> 00:12:16,820
<font color="#E5E5E5">stay away from PowerShell from doing the</font>

351
00:12:14,420 --> 00:12:18,170
testing<font color="#CCCCCC"> that we were doing here</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> so</font>

352
00:12:16,820 --> 00:12:19,040
<font color="#E5E5E5">this</font><font color="#CCCCCC"> is a</font><font color="#E5E5E5"> typical</font><font color="#CCCCCC"> sweet if</font><font color="#E5E5E5"> you want to</font>

353
00:12:18,170 --> 00:12:21,920
do your<font color="#E5E5E5"> own research</font>

354
00:12:19,040 --> 00:12:23,660
so here's<font color="#E5E5E5"> W my implants menu as you can</font>

355
00:12:21,920 --> 00:12:25,430
see it's<font color="#CCCCCC"> pretty extensive there's file</font>

356
00:12:23,660 --> 00:12:27,319
<font color="#CCCCCC">operations you can cat you can copy you</font>

357
00:12:25,430 --> 00:12:29,660
can delete you<font color="#CCCCCC"> can download you can</font><font color="#E5E5E5"> do a</font>

358
00:12:27,320 --> 00:12:32,230
listing and<font color="#E5E5E5"> LS which is pretty funny</font>

359
00:12:29,660 --> 00:12:35,180
because<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> Windows LS anyway a search</font>

360
00:12:32,230 --> 00:12:36,620
<font color="#E5E5E5">upload files so you have total ability</font>

361
00:12:35,180 --> 00:12:39,199
to do and look and read and everything

362
00:12:36,620 --> 00:12:40,670
<font color="#E5E5E5">else you</font><font color="#CCCCCC"> can do</font><font color="#E5E5E5"> lateral movement here</font>

363
00:12:39,200 --> 00:12:44,090
with command execution you can do

364
00:12:40,670 --> 00:12:45,770
<font color="#CCCCCC">disabled wws you can you can disable win</font>

365
00:12:44,090 --> 00:12:47,720
RM<font color="#CCCCCC"> so you break the ability of</font><font color="#E5E5E5"> people</font>

366
00:12:45,770 --> 00:12:49,370
<font color="#E5E5E5">who have win</font><font color="#CCCCCC"> RM</font><font color="#E5E5E5"> to do let's say Konza</font>

367
00:12:47,720 --> 00:12:51,860
you can break that<font color="#E5E5E5"> so now I can't use</font>

368
00:12:49,370 --> 00:12:54,410
<font color="#CCCCCC">konso to go</font><font color="#E5E5E5"> investigate as an example</font><font color="#CCCCCC"> I</font>

369
00:12:51,860 --> 00:12:56,990
<font color="#E5E5E5">can modify the registry so I can turn on</font>

370
00:12:54,410 --> 00:12:59,150
<font color="#CCCCCC">or off</font><font color="#E5E5E5"> the PowerShell logging registry</font>

371
00:12:56,990 --> 00:13:00,440
entries potentially until your GPO kicks

372
00:12:59,150 --> 00:13:01,610
back in and over<font color="#E5E5E5"> writes them because</font>

373
00:13:00,440 --> 00:13:03,800
<font color="#CCCCCC">hopefully you're doing it in GPO and</font>

374
00:13:01,610 --> 00:13:05,930
<font color="#E5E5E5">enforcing them</font><font color="#CCCCCC"> you can do service</font>

375
00:13:03,800 --> 00:13:07,180
modifications creates deletes modify I

376
00:13:05,930 --> 00:13:09,229
mean<font color="#E5E5E5"> a lot of power here</font>

377
00:13:07,180 --> 00:13:09,979
process operations you<font color="#E5E5E5"> can kill</font><font color="#CCCCCC"> a</font>

378
00:13:09,230 --> 00:13:11,900
<font color="#E5E5E5">process</font>

379
00:13:09,980 --> 00:13:13,910
you can also start a<font color="#CCCCCC"> process so kill</font>

380
00:13:11,900 --> 00:13:16,069
security tool<font color="#CCCCCC"> a and start malicious</font>

381
00:13:13,910 --> 00:13:17,390
payload<font color="#E5E5E5"> B and of course you</font><font color="#CCCCCC"> new process</font>

382
00:13:16,070 --> 00:13:19,400
listings you don't know<font color="#E5E5E5"> it kill until</font>

383
00:13:17,390 --> 00:13:20,960
<font color="#E5E5E5">you can list processes right and of</font>

384
00:13:19,400 --> 00:13:22,610
course all<font color="#CCCCCC"> kinds of things</font><font color="#E5E5E5"> about users</font>

385
00:13:20,960 --> 00:13:24,410
and<font color="#E5E5E5"> basic info about the system very</font>

386
00:13:22,610 --> 00:13:28,130
<font color="#E5E5E5">very powerful capability here with this</font>

387
00:13:24,410 --> 00:13:30,199
<font color="#CCCCCC">w my implant tool so let's talk</font><font color="#E5E5E5"> about</font>

388
00:13:28,130 --> 00:13:32,900
<font color="#CCCCCC">some more pwnage</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> w my attacks</font><font color="#E5E5E5"> often</font>

389
00:13:30,200 --> 00:13:34,580
<font color="#E5E5E5">use PowerShell once in</font><font color="#CCCCCC"> my</font><font color="#E5E5E5"> greater said</font>

390
00:13:32,900 --> 00:13:36,290
<font color="#E5E5E5">use of PowerShell</font><font color="#CCCCCC"> and pen testing is</font>

391
00:13:34,580 --> 00:13:37,430
dead because<font color="#E5E5E5"> if you do the logging</font>

392
00:13:36,290 --> 00:13:39,380
that's<font color="#E5E5E5"> in for example</font><font color="#CCCCCC"> the windows</font>

393
00:13:37,430 --> 00:13:40,910
logging<font color="#E5E5E5"> PowerShell logging cheat sheet</font>

394
00:13:39,380 --> 00:13:42,980
<font color="#CCCCCC">you're gonna do a pretty good job of</font>

395
00:13:40,910 --> 00:13:45,589
<font color="#E5E5E5">seeing what's going on with PowerShell</font>

396
00:13:42,980 --> 00:13:47,180
<font color="#E5E5E5">especially if you upload it to a sim so</font>

397
00:13:45,590 --> 00:13:48,980
from<font color="#E5E5E5"> that perspective he's looking at</font>

398
00:13:47,180 --> 00:13:52,089
other ways to exploit the system<font color="#CCCCCC"> whether</font>

399
00:13:48,980 --> 00:13:53,930
<font color="#E5E5E5">it's compiled</font><font color="#CCCCCC"> C or whatnot</font><font color="#E5E5E5"> or this</font>

400
00:13:52,090 --> 00:13:56,000
discussion<font color="#E5E5E5"> that he had a power at</font>

401
00:13:53,930 --> 00:13:57,800
blackhat where he talked<font color="#CCCCCC"> about using</font>

402
00:13:56,000 --> 00:14:03,230
<font color="#E5E5E5">already existing scripts and other</font>

403
00:13:57,800 --> 00:14:05,510
namespaces so common winner<font color="#CCCCCC"> M</font><font color="#E5E5E5"> are also</font>

404
00:14:03,230 --> 00:14:06,680
used a lot<font color="#E5E5E5"> in the attacks in</font><font color="#CCCCCC"> W mine so</font>

405
00:14:05,510 --> 00:14:08,420
you have to pay<font color="#CCCCCC"> attention</font><font color="#E5E5E5"> to that and</font>

406
00:14:06,680 --> 00:14:10,250
<font color="#CCCCCC">Khan doesn't</font><font color="#E5E5E5"> have built-in logging it's</font>

407
00:14:08,420 --> 00:14:11,689
<font color="#E5E5E5">only</font><font color="#CCCCCC"> available on some</font><font color="#E5E5E5"> systems that you</font>

408
00:14:10,250 --> 00:14:13,580
install it on there's nothing<font color="#CCCCCC"> on my</font>

409
00:14:11,690 --> 00:14:16,730
desktop<font color="#E5E5E5"> for</font><font color="#CCCCCC"> example</font><font color="#E5E5E5"> to monitor calm</font>

410
00:14:13,580 --> 00:14:18,380
execution<font color="#E5E5E5"> so how do we detect this how</font>

411
00:14:16,730 --> 00:14:20,810
do<font color="#E5E5E5"> we detect this bad food</font><font color="#CCCCCC"> has spent ten</font>

412
00:14:18,380 --> 00:14:22,610
minutes telling you<font color="#E5E5E5"> about</font><font color="#CCCCCC"> well all os's</font>

413
00:14:20,810 --> 00:14:25,189
are not created equal if you<font color="#CCCCCC"> don't need</font>

414
00:14:22,610 --> 00:14:26,480
<font color="#E5E5E5">another reason to tell your organization</font>

415
00:14:25,190 --> 00:14:28,390
to upgrade to<font color="#CCCCCC"> Windows 10</font>

416
00:14:26,480 --> 00:14:30,680
<font color="#CCCCCC">Devin and</font><font color="#E5E5E5"> I were talking about this at</font>

417
00:14:28,390 --> 00:14:33,560
sans third and Orleans here a few<font color="#E5E5E5"> weeks</font>

418
00:14:30,680 --> 00:14:36,050
<font color="#CCCCCC">back</font><font color="#E5E5E5"> and we both agreed that Windows</font><font color="#CCCCCC"> 10</font>

419
00:14:33,560 --> 00:14:37,819
has added a lot<font color="#CCCCCC"> of capability in</font><font color="#E5E5E5"> regards</font>

420
00:14:36,050 --> 00:14:39,770
to detection or at least the<font color="#CCCCCC"> ability to</font>

421
00:14:37,820 --> 00:14:42,440
collect information from system<font color="#E5E5E5"> to</font>

422
00:14:39,770 --> 00:14:44,090
detect<font color="#E5E5E5"> and so if you're using Windows</font><font color="#CCCCCC"> 7</font>

423
00:14:42,440 --> 00:14:45,500
or 2012<font color="#E5E5E5"> some of the items I'm going</font><font color="#CCCCCC"> to</font>

424
00:14:44,090 --> 00:14:48,290
talk about<font color="#E5E5E5"> are not going to be available</font>

425
00:14:45,500 --> 00:14:50,000
<font color="#CCCCCC">to</font><font color="#E5E5E5"> you so upgrade upgrade upgrade and</font>

426
00:14:48,290 --> 00:14:50,660
<font color="#E5E5E5">also partial</font><font color="#CCCCCC"> five for obvious reasons</font>

427
00:14:50,000 --> 00:14:52,880
better<font color="#CCCCCC"> flogging</font>

428
00:14:50,660 --> 00:14:55,490
so there's<font color="#E5E5E5"> your there's your one point</font>

429
00:14:52,880 --> 00:14:58,310
this is what I want<font color="#E5E5E5"> and what everybody</font>

430
00:14:55,490 --> 00:14:59,510
wants<font color="#CCCCCC"> a typical execution of malware to</font>

431
00:14:58,310 --> 00:15:01,729
look like or any kind of<font color="#E5E5E5"> malicious</font>

432
00:14:59,510 --> 00:15:04,370
activity in this case this is<font color="#CCCCCC"> an Emmitt</font>

433
00:15:01,730 --> 00:15:06,230
<font color="#CCCCCC">at word file that goes ahead and</font>

434
00:15:04,370 --> 00:15:08,810
<font color="#E5E5E5">launches command dot exe another command</font>

435
00:15:06,230 --> 00:15:10,400
box<font color="#CCCCCC"> powershell and then launches the</font>

436
00:15:08,810 --> 00:15:12,500
binaries<font color="#E5E5E5"> and then writes the final</font>

437
00:15:10,400 --> 00:15:14,449
<font color="#E5E5E5">destination</font><font color="#CCCCCC"> SLS key</font><font color="#E5E5E5"> this is a pretty</font>

438
00:15:12,500 --> 00:15:16,070
typical process<font color="#CCCCCC"> treat it's eight deep</font>

439
00:15:14,450 --> 00:15:17,900
<font color="#E5E5E5">okay that's the point I'm trying to</font><font color="#CCCCCC"> make</font>

440
00:15:16,070 --> 00:15:20,210
here there are a<font color="#E5E5E5"> sequence of events that</font>

441
00:15:17,900 --> 00:15:21,829
occur and it's<font color="#E5E5E5"> eight deep so keep in</font>

442
00:15:20,210 --> 00:15:23,270
mind<font color="#CCCCCC"> this is what I wish all malicious</font>

443
00:15:21,830 --> 00:15:24,089
activity look for<font color="#CCCCCC"> cuz</font><font color="#E5E5E5"> that's real</font><font color="#CCCCCC"> easy</font>

444
00:15:23,270 --> 00:15:26,980
to<font color="#E5E5E5"> spot</font>

445
00:15:24,089 --> 00:15:28,990
so let's talk about logging<font color="#E5E5E5"> first thing</font>

446
00:15:26,980 --> 00:15:31,089
you<font color="#E5E5E5"> need to do to catch</font><font color="#CCCCCC"> w my is to</font>

447
00:15:28,990 --> 00:15:32,470
enable process<font color="#CCCCCC"> command line logging if</font>

448
00:15:31,089 --> 00:15:34,000
you look at the windows logging cheat

449
00:15:32,470 --> 00:15:36,640
sheets and<font color="#E5E5E5"> you compare them</font><font color="#CCCCCC"> to the CIS</font>

450
00:15:34,000 --> 00:15:38,950
benchmarks or<font color="#CCCCCC"> USG seabees are obvious</font>

451
00:15:36,640 --> 00:15:40,269
<font color="#CCCCCC">Ozzie's cyber standards they do not</font>

452
00:15:38,950 --> 00:15:43,360
recommend turning<font color="#E5E5E5"> on process</font>

453
00:15:40,269 --> 00:15:45,310
<font color="#CCCCCC">command-line you might catch a password</font>

454
00:15:43,360 --> 00:15:47,500
in the logs<font color="#E5E5E5"> yeah</font><font color="#CCCCCC"> ok I can deal with</font><font color="#E5E5E5"> that</font>

455
00:15:45,310 --> 00:15:49,029
<font color="#E5E5E5">I can stop that collection</font><font color="#CCCCCC"> I can</font>

456
00:15:47,500 --> 00:15:51,010
specifically<font color="#E5E5E5"> exclude that collection</font>

457
00:15:49,029 --> 00:15:53,410
<font color="#CCCCCC">there's lots of ways</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> mitigate that</font>

458
00:15:51,010 --> 00:15:55,899
<font color="#E5E5E5">problem so please turn this on if you</font>

459
00:15:53,410 --> 00:15:57,790
want<font color="#E5E5E5"> to really catch</font><font color="#CCCCCC"> the bad food</font><font color="#E5E5E5"> of</font>

460
00:15:55,899 --> 00:15:59,140
course<font color="#E5E5E5"> you can</font><font color="#CCCCCC"> then</font><font color="#E5E5E5"> see</font><font color="#CCCCCC"> Moff installs so</font>

461
00:15:57,790 --> 00:16:01,360
now instead<font color="#E5E5E5"> of just seeing</font><font color="#CCCCCC"> Mothe comp</font>

462
00:15:59,140 --> 00:16:04,899
dot exe from<font color="#CCCCCC"> a process execution I can</font>

463
00:16:01,360 --> 00:16:07,300
<font color="#CCCCCC">seamoth comp dot exe</font><font color="#E5E5E5"> space malicious</font>

464
00:16:04,899 --> 00:16:08,920
<font color="#CCCCCC">Dartmouth</font><font color="#E5E5E5"> execute so now I can see moths</font>

465
00:16:07,300 --> 00:16:10,930
actually being<font color="#E5E5E5"> used the name of them</font>

466
00:16:08,920 --> 00:16:12,699
which then<font color="#E5E5E5"> I could potentially</font><font color="#CCCCCC"> look for</font>

467
00:16:10,930 --> 00:16:14,920
if it's not on disk that<font color="#E5E5E5"> means somebody</font>

468
00:16:12,700 --> 00:16:17,589
executed them and deleted them<font color="#E5E5E5"> that to</font>

469
00:16:14,920 --> 00:16:18,399
me<font color="#E5E5E5"> so suspicious or the next example</font>

470
00:16:17,589 --> 00:16:20,290
you'll see<font color="#CCCCCC"> in a second</font>

471
00:16:18,399 --> 00:16:22,870
and of course<font color="#CCCCCC"> sis</font><font color="#E5E5E5"> Mon has the event ID</font><font color="#CCCCCC"> 1</font>

472
00:16:20,290 --> 00:16:25,329
which is similar scenario to process 46

473
00:16:22,870 --> 00:16:27,790
88 with process<font color="#E5E5E5"> command line</font><font color="#CCCCCC"> o in</font>

474
00:16:25,329 --> 00:16:30,060
Windows 10 you<font color="#CCCCCC"> do see the parent name in</font>

475
00:16:27,790 --> 00:16:32,770
Windows 7<font color="#E5E5E5"> you</font><font color="#CCCCCC"> see the</font><font color="#E5E5E5"> pit so there's no</font>

476
00:16:30,060 --> 00:16:34,209
<font color="#CCCCCC">Association of what that parent names</font>

477
00:16:32,770 --> 00:16:36,100
name was if you're looking at<font color="#E5E5E5"> Windows</font>

478
00:16:34,209 --> 00:16:37,149
<font color="#E5E5E5">seven logs but</font><font color="#CCCCCC"> at Windows 10 you</font>

479
00:16:36,100 --> 00:16:38,620
actually<font color="#CCCCCC"> get the parent name very</font>

480
00:16:37,149 --> 00:16:40,649
similar to<font color="#CCCCCC"> what's this</font><font color="#E5E5E5"> mom gives you so</font>

481
00:16:38,620 --> 00:16:42,940
another<font color="#E5E5E5"> reason to upgrade to</font><font color="#CCCCCC"> Windows 10</font>

482
00:16:40,649 --> 00:16:44,680
process command line tells all this is

483
00:16:42,940 --> 00:16:47,980
why it's important so here's an<font color="#CCCCCC"> example</font>

484
00:16:44,680 --> 00:16:50,410
of a<font color="#CCCCCC"> pwnage using WMI that's executing</font>

485
00:16:47,980 --> 00:16:51,820
<font color="#E5E5E5">PowerShell doing an</font><font color="#CCCCCC"> OP</font><font color="#E5E5E5"> so no profile so</font>

486
00:16:50,410 --> 00:16:54,339
the stuff and<font color="#E5E5E5"> the chichi for older</font>

487
00:16:51,820 --> 00:16:56,050
<font color="#CCCCCC">versions of PowerShell say</font><font color="#E5E5E5"> yeah</font><font color="#CCCCCC"> don't</font>

488
00:16:54,339 --> 00:16:57,310
read the profile so whatever's<font color="#E5E5E5"> command</font>

489
00:16:56,050 --> 00:16:59,310
line logging is being turned<font color="#E5E5E5"> on there</font>

490
00:16:57,310 --> 00:17:01,270
ignore<font color="#E5E5E5"> it or whatever else that's doing</font>

491
00:16:59,310 --> 00:17:03,459
non-interactive don't show it<font color="#E5E5E5"> to the</font>

492
00:17:01,270 --> 00:17:05,709
<font color="#CCCCCC">user</font><font color="#E5E5E5"> and hidden definitely don't let</font>

493
00:17:03,459 --> 00:17:07,629
<font color="#E5E5E5">anybody see the box and it's doing a</font>

494
00:17:05,709 --> 00:17:09,429
call to<font color="#E5E5E5"> W my class so this would be a</font>

495
00:17:07,630 --> 00:17:10,720
great indication<font color="#E5E5E5"> that yeah somebody's</font>

496
00:17:09,429 --> 00:17:13,419
doing<font color="#CCCCCC"> something they're not supposed to</font>

497
00:17:10,720 --> 00:17:15,370
and you<font color="#CCCCCC"> would catch this</font><font color="#E5E5E5"> with a</font><font color="#CCCCCC"> 40 68 46</font>

498
00:17:13,419 --> 00:17:18,010
<font color="#CCCCCC">88 process command line</font><font color="#E5E5E5"> so there's a</font>

499
00:17:15,369 --> 00:17:20,639
great example<font color="#E5E5E5"> of the power</font><font color="#CCCCCC"> of this</font>

500
00:17:18,010 --> 00:17:20,640
particular<font color="#CCCCCC"> item</font>

501
00:17:21,459 --> 00:17:25,390
be<font color="#E5E5E5"> mine by itself when you execute it as</font>

502
00:17:23,439 --> 00:17:27,490
a query<font color="#E5E5E5"> tool or even exploitation tool</font>

503
00:17:25,390 --> 00:17:29,799
<font color="#CCCCCC">it is not very noisy because</font><font color="#E5E5E5"> each time</font>

504
00:17:27,490 --> 00:17:31,720
<font color="#E5E5E5">it executes it executes individually not</font>

505
00:17:29,799 --> 00:17:33,820
in the series<font color="#E5E5E5"> of a</font><font color="#CCCCCC"> parent/child scenario</font>

506
00:17:31,720 --> 00:17:35,470
that<font color="#CCCCCC"> I showed you</font><font color="#E5E5E5"> initially so for</font>

507
00:17:33,820 --> 00:17:37,029
example here's service host and this<font color="#E5E5E5"> is</font>

508
00:17:35,470 --> 00:17:38,770
what it normally<font color="#E5E5E5"> looks like this is</font>

509
00:17:37,029 --> 00:17:40,960
nothing<font color="#E5E5E5"> here at this point is malicious</font>

510
00:17:38,770 --> 00:17:43,120
looking and here it<font color="#E5E5E5"> is launching on the</font>

511
00:17:40,960 --> 00:17:45,850
left<font color="#E5E5E5"> so service host is is and will be</font>

512
00:17:43,120 --> 00:17:48,250
<font color="#CCCCCC">the parent at all cases</font><font color="#E5E5E5"> and so now that</font>

513
00:17:45,850 --> 00:17:51,549
we<font color="#CCCCCC"> know that</font><font color="#E5E5E5"> we can say</font><font color="#CCCCCC"> okay let's</font><font color="#E5E5E5"> focus</font>

514
00:17:48,250 --> 00:17:52,899
at<font color="#E5E5E5"> W my</font><font color="#CCCCCC"> ap</font><font color="#E5E5E5"> SRV and see what it is it's</font>

515
00:17:51,549 --> 00:17:55,779
<font color="#E5E5E5">doing there okay</font>

516
00:17:52,899 --> 00:17:57,489
typical<font color="#E5E5E5"> normal but bad foo again these</font>

517
00:17:55,779 --> 00:18:00,880
<font color="#E5E5E5">are all single liners right nesting</font>

518
00:17:57,490 --> 00:18:04,059
going on here<font color="#CCCCCC"> W my activity logs there</font>

519
00:18:00,880 --> 00:18:05,860
is a log<font color="#CCCCCC"> it's called a Windows it's in</font>

520
00:18:04,059 --> 00:18:08,830
microsoft windows so that subfolder<font color="#CCCCCC"> of</font>

521
00:18:05,860 --> 00:18:10,240
the event logs<font color="#CCCCCC"> W my activity operational</font>

522
00:18:08,830 --> 00:18:12,760
this<font color="#E5E5E5"> is a log you want to pay</font><font color="#CCCCCC"> attention</font>

523
00:18:10,240 --> 00:18:15,159
to Windows 7<font color="#CCCCCC"> or Windows 10 or later or</font>

524
00:18:12,760 --> 00:18:17,980
<font color="#CCCCCC">Server for sure</font><font color="#E5E5E5"> the event ID you want to</font>

525
00:18:15,159 --> 00:18:20,679
focus<font color="#E5E5E5"> on is 58 61 this is where anything</font>

526
00:18:17,980 --> 00:18:23,140
news created now those fails with<font color="#E5E5E5"> auto</font>

527
00:18:20,679 --> 00:18:25,240
runs and system on<font color="#E5E5E5"> yeah</font>

528
00:18:23,140 --> 00:18:27,279
any<font color="#E5E5E5"> namespace alteration</font><font color="#CCCCCC"> edition will be</font>

529
00:18:25,240 --> 00:18:30,399
<font color="#E5E5E5">in this log so that</font><font color="#CCCCCC"> is something that</font>

530
00:18:27,279 --> 00:18:32,289
Windows<font color="#CCCCCC"> 10 does that the other two tool</font>

531
00:18:30,399 --> 00:18:34,149
failures do not so<font color="#E5E5E5"> Windows logging is</font>

532
00:18:32,289 --> 00:18:36,279
better than the other<font color="#E5E5E5"> sis internal tools</font>

533
00:18:34,149 --> 00:18:37,809
that I<font color="#E5E5E5"> just spoke of but there are other</font>

534
00:18:36,279 --> 00:18:39,549
event IDs<font color="#CCCCCC"> so you can play with those but</font>

535
00:18:37,809 --> 00:18:41,559
this<font color="#CCCCCC"> 58 61 is the one you really want</font><font color="#E5E5E5"> to</font>

536
00:18:39,549 --> 00:18:43,000
pay<font color="#CCCCCC"> attention to and</font><font color="#E5E5E5"> this is the only</font>

537
00:18:41,559 --> 00:18:44,500
<font color="#E5E5E5">one</font><font color="#CCCCCC"> that create again that catches</font>

538
00:18:43,000 --> 00:18:47,620
something<font color="#E5E5E5"> that was added to a namespace</font>

539
00:18:44,500 --> 00:18:49,029
<font color="#CCCCCC">all of them</font><font color="#E5E5E5"> so it addresses</font><font color="#CCCCCC"> Matt graders</font>

540
00:18:47,620 --> 00:18:50,860
talk as well<font color="#E5E5E5"> as what we're doing a</font><font color="#CCCCCC"> login</font>

541
00:18:49,029 --> 00:18:52,450
<font color="#CCCCCC">be but not</font><font color="#E5E5E5"> how you don't know how that</font>

542
00:18:50,860 --> 00:18:53,918
<font color="#E5E5E5">thing got created process command</font>

543
00:18:52,450 --> 00:18:56,529
execution<font color="#E5E5E5"> or other things that I'm gonna</font>

544
00:18:53,919 --> 00:18:58,419
show you will collect<font color="#CCCCCC"> this and again</font><font color="#E5E5E5"> use</font>

545
00:18:56,529 --> 00:18:59,799
that<font color="#E5E5E5"> command line because</font><font color="#CCCCCC"> that is how</font><font color="#E5E5E5"> it</font>

546
00:18:58,419 --> 00:19:01,390
got there<font color="#CCCCCC"> whether</font><font color="#E5E5E5"> it was a moth comp</font>

547
00:18:59,799 --> 00:19:03,520
<font color="#E5E5E5">whether it was a script where there was</font>

548
00:19:01,390 --> 00:19:06,429
<font color="#E5E5E5">PowerShell all that you'll</font><font color="#CCCCCC"> definitely</font>

549
00:19:03,520 --> 00:19:07,929
need<font color="#CCCCCC"> that log enable if you do have the</font>

550
00:19:06,429 --> 00:19:10,330
Windows Microsoft Windows attributed

551
00:19:07,929 --> 00:19:11,830
comm collect it look at it<font color="#CCCCCC"> and look to</font>

552
00:19:10,330 --> 00:19:13,629
see<font color="#CCCCCC"> what</font><font color="#E5E5E5"> comm objects are being called</font>

553
00:19:11,830 --> 00:19:15,129
<font color="#E5E5E5">you won't see</font><font color="#CCCCCC"> to some workstations I've</font>

554
00:19:13,630 --> 00:19:17,110
yet to find<font color="#CCCCCC"> one on a workstation</font><font color="#E5E5E5"> I do</font>

555
00:19:15,130 --> 00:19:18,580
<font color="#E5E5E5">these see this on some servers it's not</font>

556
00:19:17,110 --> 00:19:19,689
in my<font color="#E5E5E5"> personal domain controller so</font>

557
00:19:18,580 --> 00:19:21,309
there's something<font color="#CCCCCC"> you have</font><font color="#E5E5E5"> to add and</font>

558
00:19:19,690 --> 00:19:23,140
install that<font color="#E5E5E5"> I just generally</font><font color="#CCCCCC"> don't do</font>

559
00:19:21,309 --> 00:19:25,059
but<font color="#E5E5E5"> definitely watch out for this</font>

560
00:19:23,140 --> 00:19:28,120
because<font color="#CCCCCC"> comm objects are a</font><font color="#E5E5E5"> big part of W</font>

561
00:19:25,059 --> 00:19:29,700
my so<font color="#CCCCCC"> W my let's look at what it does</font>

562
00:19:28,120 --> 00:19:33,129
when it queries the system

563
00:19:29,700 --> 00:19:34,700
<font color="#CCCCCC">authentication yeh Windows 10</font><font color="#E5E5E5"> and 2016</font>

564
00:19:33,130 --> 00:19:36,740
server to<font color="#E5E5E5"> the rescue for the win</font>

565
00:19:34,700 --> 00:19:38,510
big time<font color="#E5E5E5"> I was real surprised that I</font>

566
00:19:36,740 --> 00:19:40,340
stumbled<font color="#CCCCCC"> across this</font><font color="#E5E5E5"> it turns out there</font>

567
00:19:38,510 --> 00:19:43,640
<font color="#E5E5E5">is a unique authentication that occurs</font>

568
00:19:40,340 --> 00:19:46,970
when<font color="#CCCCCC"> W</font><font color="#E5E5E5"> my talks to a box</font><font color="#CCCCCC"> in Windows 10</font>

569
00:19:43,640 --> 00:19:49,100
and<font color="#E5E5E5"> 2016 server</font><font color="#CCCCCC"> so here's an example</font>

570
00:19:46,970 --> 00:19:50,330
there are debug logs and trace logs so

571
00:19:49,100 --> 00:19:51,889
if you<font color="#E5E5E5"> got a tool that</font><font color="#CCCCCC"> can do that</font><font color="#E5E5E5"> great</font>

572
00:19:50,330 --> 00:19:53,659
you'll get the calls of actually what

573
00:19:51,890 --> 00:19:55,640
<font color="#CCCCCC">WMI is executing</font><font color="#E5E5E5"> but it's not practical</font>

574
00:19:53,660 --> 00:19:57,350
<font color="#E5E5E5">for us to go turn on debug in trace log</font>

575
00:19:55,640 --> 00:19:59,360
<font color="#E5E5E5">hey</font><font color="#CCCCCC"> IT you want to turn on</font><font color="#E5E5E5"> trace and</font>

576
00:19:57,350 --> 00:20:01,459
debug for me everywhere<font color="#E5E5E5"> yeah I think big</font>

577
00:19:59,360 --> 00:20:02,959
answers gonna be no so it's not very

578
00:20:01,460 --> 00:20:04,580
<font color="#CCCCCC">practical for</font><font color="#E5E5E5"> us to rely on that you're</font>

579
00:20:02,960 --> 00:20:08,630
going<font color="#E5E5E5"> to look at an EDR tool that might</font>

580
00:20:04,580 --> 00:20:10,760
do<font color="#E5E5E5"> that or another another solution but</font>

581
00:20:08,630 --> 00:20:12,560
<font color="#E5E5E5">again all you need is creds so you need</font>

582
00:20:10,760 --> 00:20:14,780
a user account<font color="#CCCCCC"> right the bad guys will</font>

583
00:20:12,560 --> 00:20:17,389
have<font color="#E5E5E5"> gotten a cred through a myriad of</font>

584
00:20:14,780 --> 00:20:19,580
ways<font color="#E5E5E5"> right maybe cat scan</font><font color="#CCCCCC"> they can do</font>

585
00:20:17,390 --> 00:20:22,490
Kerberos<font color="#CCCCCC"> sting write responder on then</font>

586
00:20:19,580 --> 00:20:23,929
on the wire keystroke logging<font color="#E5E5E5"> or a fish</font>

587
00:20:22,490 --> 00:20:25,730
where the<font color="#E5E5E5"> user just gives up the creds</font>

588
00:20:23,930 --> 00:20:27,260
<font color="#E5E5E5">somehow away from a manner the bad guys</font>

589
00:20:25,730 --> 00:20:29,600
will get the creds the pen testers will

590
00:20:27,260 --> 00:20:32,210
get the<font color="#CCCCCC"> grits</font><font color="#E5E5E5"> they win almost all the</font>

591
00:20:29,600 --> 00:20:35,060
time<font color="#E5E5E5"> if not all the time right so</font><font color="#CCCCCC"> of</font>

592
00:20:32,210 --> 00:20:36,890
course it<font color="#E5E5E5"> has to be</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> valid user</font><font color="#CCCCCC"> ok</font><font color="#E5E5E5"> so</font>

593
00:20:35,060 --> 00:20:39,260
once they do<font color="#E5E5E5"> that unless</font><font color="#CCCCCC"> of course it's</font>

594
00:20:36,890 --> 00:20:42,170
you know<font color="#CCCCCC"> WMI the clue is what is</font>

595
00:20:39,260 --> 00:20:44,270
launched<font color="#E5E5E5"> so what is</font><font color="#CCCCCC"> WMI actually doing</font>

596
00:20:42,170 --> 00:20:46,670
you saw service host launching<font color="#CCCCCC"> WMI doing</font>

597
00:20:44,270 --> 00:20:48,650
typical<font color="#E5E5E5"> system management stuff but does</font>

598
00:20:46,670 --> 00:20:50,060
<font color="#CCCCCC">WMI then do something</font><font color="#E5E5E5"> else and</font><font color="#CCCCCC"> that's</font>

599
00:20:48,650 --> 00:20:51,770
what we're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> look at and Windows</font>

600
00:20:50,060 --> 00:20:54,050
<font color="#CCCCCC">10</font><font color="#E5E5E5"> definitely shows you some some cool</font>

601
00:20:51,770 --> 00:20:55,760
stuff<font color="#CCCCCC"> so here's an example</font><font color="#E5E5E5"> of the</font>

602
00:20:54,050 --> 00:20:57,530
<font color="#CCCCCC">authentication I was talking about</font><font color="#E5E5E5"> the</font>

603
00:20:55,760 --> 00:20:59,480
unique thing here is there is<font color="#CCCCCC"> actually</font>

604
00:20:57,530 --> 00:21:01,220
an impersonation<font color="#CCCCCC"> and identification</font>

605
00:20:59,480 --> 00:21:03,710
I'm looking at this<font color="#E5E5E5"> from a lateral</font>

606
00:21:01,220 --> 00:21:06,500
movement perspective workstation<font color="#E5E5E5"> to</font>

607
00:21:03,710 --> 00:21:08,690
workstation so<font color="#CCCCCC"> VJs box</font><font color="#E5E5E5"> bad box over</font>

608
00:21:06,500 --> 00:21:11,030
<font color="#E5E5E5">vijay talking to kevin's box you will</font>

609
00:21:08,690 --> 00:21:12,620
<font color="#E5E5E5">see</font><font color="#CCCCCC"> this show up and the local logs</font><font color="#E5E5E5"> this</font>

610
00:21:11,030 --> 00:21:14,270
will not be a potential domain

611
00:21:12,620 --> 00:21:15,800
authentication<font color="#E5E5E5"> unless they crack that</font>

612
00:21:14,270 --> 00:21:17,420
and are using<font color="#CCCCCC"> it but they're gonna use</font>

613
00:21:15,800 --> 00:21:19,340
probably a<font color="#E5E5E5"> local credit they somehow</font>

614
00:21:17,420 --> 00:21:21,320
harvest a local<font color="#CCCCCC"> administrator or your</font>

615
00:21:19,340 --> 00:21:22,399
users or admins<font color="#E5E5E5"> how many people want to</font>

616
00:21:21,320 --> 00:21:24,679
raise their hands and say<font color="#CCCCCC"> they're users</font>

617
00:21:22,400 --> 00:21:26,150
some of their users so admins and you

618
00:21:24,680 --> 00:21:28,010
see this<font color="#CCCCCC"> dual</font><font color="#E5E5E5"> off you will not see this</font>

619
00:21:26,150 --> 00:21:29,900
in<font color="#CCCCCC"> Windows</font><font color="#E5E5E5"> 7 so suddenly there's a</font>

620
00:21:28,010 --> 00:21:33,140
oddity<font color="#CCCCCC"> and authentication</font><font color="#E5E5E5"> that occurs</font>

621
00:21:29,900 --> 00:21:35,690
when<font color="#CCCCCC"> WMI is clearing the box now this is</font>

622
00:21:33,140 --> 00:21:37,400
a real<font color="#E5E5E5"> surprise to me because</font><font color="#CCCCCC"> 4624 is</font>

623
00:21:35,690 --> 00:21:40,310
just off but the fact that there's two

624
00:21:37,400 --> 00:21:43,180
<font color="#CCCCCC">of</font><font color="#E5E5E5"> these is keen and</font><font color="#CCCCCC"> all something you</font>

625
00:21:40,310 --> 00:21:43,179
<font color="#E5E5E5">can definitely focus on</font>

626
00:21:43,440 --> 00:21:47,530
source and destination firewall logs<font color="#E5E5E5"> I</font>

627
00:21:45,970 --> 00:21:50,020
love the<font color="#E5E5E5"> windows firewall logs it's not</font>

628
00:21:47,530 --> 00:21:52,178
just<font color="#E5E5E5"> bad IP one</font><font color="#CCCCCC"> talked to</font><font color="#E5E5E5"> bad IP</font><font color="#CCCCCC"> 2 or</font>

629
00:21:50,020 --> 00:21:54,610
good IP<font color="#E5E5E5"> 2 to try to compromise it it is</font>

630
00:21:52,179 --> 00:21:57,159
that this<font color="#CCCCCC"> application from</font><font color="#E5E5E5"> dot one</font>

631
00:21:54,610 --> 00:21:59,620
<font color="#E5E5E5">talked to this box on dot</font><font color="#CCCCCC"> 2 and also the</font>

632
00:21:57,159 --> 00:22:01,450
<font color="#CCCCCC">port's that</font><font color="#E5E5E5"> it talked on so you get some</font>

633
00:21:59,620 --> 00:22:04,120
more<font color="#CCCCCC"> information</font><font color="#E5E5E5"> that the context</font>

634
00:22:01,450 --> 00:22:05,500
<font color="#E5E5E5">inbound port 137</font><font color="#CCCCCC"> I know a lot of us</font>

635
00:22:04,120 --> 00:22:07,449
don't turn on the<font color="#E5E5E5"> Windows Firewall in</font>

636
00:22:05,500 --> 00:22:09,610
the corporate<font color="#E5E5E5"> world</font><font color="#CCCCCC"> that's ok it will</font>

637
00:22:07,450 --> 00:22:11,440
still log<font color="#E5E5E5"> you do not have to enforce to</font>

638
00:22:09,610 --> 00:22:13,059
get the logging<font color="#E5E5E5"> very cool feature with</font>

639
00:22:11,440 --> 00:22:14,950
<font color="#CCCCCC">Windows in</font><font color="#E5E5E5"> that aspect and so you can</font>

640
00:22:13,059 --> 00:22:18,158
tell what<font color="#E5E5E5"> exactly is happening</font><font color="#CCCCCC"> Service</font>

641
00:22:14,950 --> 00:22:20,110
host is making a connection to the box

642
00:22:18,159 --> 00:22:22,090
<font color="#E5E5E5">ok again ask yourself why should</font>

643
00:22:20,110 --> 00:22:23,678
workstation 1 being talked<font color="#E5E5E5"> to</font><font color="#CCCCCC"> work</font>

644
00:22:22,090 --> 00:22:26,289
<font color="#CCCCCC">station 2 let's</font><font color="#E5E5E5"> look at a typical</font>

645
00:22:23,679 --> 00:22:27,970
ransomware<font color="#CCCCCC"> the podcasts were coming out</font>

646
00:22:26,289 --> 00:22:29,110
with<font color="#E5E5E5"> here after we get back</font><font color="#CCCCCC"> will be</font>

647
00:22:27,970 --> 00:22:31,630
about a breach that<font color="#CCCCCC"> was shared with</font><font color="#E5E5E5"> me</font>

648
00:22:29,110 --> 00:22:33,070
<font color="#E5E5E5">where it was a ransom or attack and they</font>

649
00:22:31,630 --> 00:22:35,500
got in through<font color="#E5E5E5"> RDP on the Internet</font>

650
00:22:33,070 --> 00:22:37,450
yeah well you know that's<font color="#CCCCCC"> the way that</font>

651
00:22:35,500 --> 00:22:39,370
<font color="#E5E5E5">goes and they laterally moved across the</font>

652
00:22:37,450 --> 00:22:41,289
<font color="#CCCCCC">environment 250 machines and</font><font color="#E5E5E5"> affected it</font>

653
00:22:39,370 --> 00:22:43,299
this is where you'll<font color="#E5E5E5"> see that lateral</font>

654
00:22:41,289 --> 00:22:45,220
movement not<font color="#E5E5E5"> in their domain logs for</font>

655
00:22:43,299 --> 00:22:47,470
<font color="#E5E5E5">the most part other than</font><font color="#CCCCCC"> possibly a lot</font>

656
00:22:45,220 --> 00:22:49,000
of logins<font color="#E5E5E5"> but the fact that you can see</font>

657
00:22:47,470 --> 00:22:52,240
what ports and what's not going<font color="#CCCCCC"> on here</font>

658
00:22:49,000 --> 00:22:53,770
is quite valuable<font color="#E5E5E5"> so think about in</font><font color="#CCCCCC"> your</font>

659
00:22:52,240 --> 00:22:55,780
lateral movement workstation<font color="#E5E5E5"> one should</font>

660
00:22:53,770 --> 00:22:58,840
it be talking to workstation<font color="#CCCCCC"> 2 3 4 5 6</font>

661
00:22:55,780 --> 00:23:00,220
<font color="#E5E5E5">150 the parent-child relationship is key</font>

662
00:22:58,840 --> 00:23:03,070
right<font color="#E5E5E5"> server</font><font color="#CCCCCC"> sauce</font><font color="#E5E5E5"> where you talked</font>

663
00:23:00,220 --> 00:23:05,230
<font color="#CCCCCC">about is calling WMI so that in</font><font color="#E5E5E5"> itself</font>

664
00:23:03,070 --> 00:23:07,149
isn't and most of<font color="#E5E5E5"> us will filter this</font>

665
00:23:05,230 --> 00:23:11,320
out and I'll<font color="#E5E5E5"> tell you</font><font color="#CCCCCC"> I have</font><font color="#E5E5E5"> because</font>

666
00:23:07,150 --> 00:23:13,150
this generally has no value<font color="#CCCCCC"> ok but what</font>

667
00:23:11,320 --> 00:23:14,620
<font color="#E5E5E5">if I want to push</font><font color="#CCCCCC"> a payload</font><font color="#E5E5E5"> private any</font>

668
00:23:13,150 --> 00:23:15,330
<font color="#E5E5E5">key</font><font color="#CCCCCC"> to the</font><font color="#E5E5E5"> Box I queried it like I just</font>

669
00:23:14,620 --> 00:23:18,939
<font color="#E5E5E5">showed</font><font color="#CCCCCC"> you</font>

670
00:23:15,330 --> 00:23:23,770
so again lateral movement so here's an

671
00:23:18,940 --> 00:23:25,960
network login<font color="#CCCCCC"> 5</font><font color="#E5E5E5"> 3</font><font color="#CCCCCC"> 2 again ntlm to play</font>

672
00:23:23,770 --> 00:23:27,490
target and a 10 target and hackers the

673
00:23:25,960 --> 00:23:29,830
guy<font color="#E5E5E5"> just connecting</font><font color="#CCCCCC"> to it so in that we</font>

674
00:23:27,490 --> 00:23:31,450
know that<font color="#E5E5E5"> that's happened then again net</font>

675
00:23:29,830 --> 00:23:33,100
used looks like this this is<font color="#CCCCCC"> what a</font>

676
00:23:31,450 --> 00:23:35,799
typical net<font color="#CCCCCC"> used looks like so you</font><font color="#E5E5E5"> could</font>

677
00:23:33,100 --> 00:23:38,260
actually look for again<font color="#E5E5E5"> workstation</font><font color="#CCCCCC"> 1</font>

678
00:23:35,799 --> 00:23:40,510
<font color="#E5E5E5">talking to workstation - a lot /</font><font color="#CCCCCC"> 4</font><font color="#E5E5E5"> 4 5</font>

679
00:23:38,260 --> 00:23:42,520
<font color="#E5E5E5">is not normal behavior your users don't</font>

680
00:23:40,510 --> 00:23:44,710
map drives together<font color="#E5E5E5"> not</font><font color="#CCCCCC"> unleashed</font><font color="#E5E5E5"> to the</font>

681
00:23:42,520 --> 00:23:46,690
<font color="#CCCCCC">IR guys are the IT people</font><font color="#E5E5E5"> that behavior</font>

682
00:23:44,710 --> 00:23:48,100
is pretty<font color="#E5E5E5"> deterministic so I've got to</font>

683
00:23:46,690 --> 00:23:49,840
connect to the share I<font color="#E5E5E5"> want to push my</font>

684
00:23:48,100 --> 00:23:51,189
payload there if I'm gonna<font color="#E5E5E5"> do it the</font>

685
00:23:49,840 --> 00:23:54,010
old-fashioned way<font color="#CCCCCC"> which a</font><font color="#E5E5E5"> lot of bad</font>

686
00:23:51,190 --> 00:23:55,179
guys do or I'll use W my

687
00:23:54,010 --> 00:23:57,490
and of course I want<font color="#E5E5E5"> to execute this</font>

688
00:23:55,179 --> 00:23:59,410
payload so here's<font color="#CCCCCC"> services</font><font color="#E5E5E5"> making</font><font color="#CCCCCC"> the</font>

689
00:23:57,490 --> 00:24:00,520
connection<font color="#E5E5E5"> again nothing too fishy here</font>

690
00:23:59,410 --> 00:24:02,260
<font color="#E5E5E5">right other than</font><font color="#CCCCCC"> the fact that</font>

691
00:24:00,520 --> 00:24:05,770
<font color="#E5E5E5">workstation one's talking to workstation</font>

692
00:24:02,260 --> 00:24:07,990
<font color="#CCCCCC">two but</font><font color="#E5E5E5"> lo and behold what do we see the</font>

693
00:24:05,770 --> 00:24:11,740
new advantage is what did<font color="#CCCCCC"> Maurer dot exe</font>

694
00:24:07,990 --> 00:24:13,929
<font color="#CCCCCC">I renamed</font><font color="#E5E5E5"> putty</font><font color="#CCCCCC"> Maurer dot exe</font><font color="#E5E5E5"> but what</font>

695
00:24:11,740 --> 00:24:17,590
is the parent and again in Windows 10

696
00:24:13,929 --> 00:24:21,130
and system on you'll<font color="#CCCCCC"> see this W my PR</font><font color="#E5E5E5"> B</font>

697
00:24:17,590 --> 00:24:23,678
SC<font color="#E5E5E5"> so now you have W my calling an odd</font>

698
00:24:21,130 --> 00:24:25,240
binary ding-ding-ding-ding-ding we saw

699
00:24:23,679 --> 00:24:27,040
possibly and off we saw<font color="#E5E5E5"> a network</font>

700
00:24:25,240 --> 00:24:29,320
connection<font color="#CCCCCC"> may not</font><font color="#E5E5E5"> have thought</font><font color="#CCCCCC"> that was</font>

701
00:24:27,040 --> 00:24:32,799
malicious but W my calling a payload

702
00:24:29,320 --> 00:24:34,000
focus on this guy right<font color="#CCCCCC"> here this is</font>

703
00:24:32,799 --> 00:24:36,520
<font color="#CCCCCC">your winner winner chicken dinner</font>

704
00:24:34,000 --> 00:24:38,740
<font color="#CCCCCC">alert for sure and you can see it</font><font color="#E5E5E5"> down</font>

705
00:24:36,520 --> 00:24:41,020
<font color="#CCCCCC">here</font><font color="#E5E5E5"> and again there's no parent child</font>

706
00:24:38,740 --> 00:24:42,340
here see how flat it is<font color="#E5E5E5"> so it's gonna be</font>

707
00:24:41,020 --> 00:24:44,799
buried amongst all those other

708
00:24:42,340 --> 00:24:47,590
executions<font color="#E5E5E5"> unless you specifically say I</font>

709
00:24:44,799 --> 00:24:49,690
want to<font color="#E5E5E5"> look for this</font><font color="#CCCCCC"> kind</font><font color="#E5E5E5"> of attack</font><font color="#CCCCCC"> you</font>

710
00:24:47,590 --> 00:24:50,830
<font color="#CCCCCC">can</font><font color="#E5E5E5"> go hunt for this kind of attack by</font>

711
00:24:49,690 --> 00:24:52,780
looking through<font color="#E5E5E5"> the logs or your sim or</font>

712
00:24:50,830 --> 00:24:54,790
<font color="#CCCCCC">whatnot and so again down here you can</font>

713
00:24:52,780 --> 00:24:57,040
see<font color="#CCCCCC"> W my</font><font color="#E5E5E5"> peer</font><font color="#CCCCCC"> V talking to the malware</font>

714
00:24:54,790 --> 00:24:59,620
<font color="#CCCCCC">or launching them</font><font color="#E5E5E5"> our of parent so</font>

715
00:24:57,040 --> 00:25:01,840
<font color="#E5E5E5">parent child here is really key Windows</font>

716
00:24:59,620 --> 00:25:03,699
<font color="#CCCCCC">7 gives</font><font color="#E5E5E5"> you the pit so in Windows</font><font color="#CCCCCC"> 7 on</font>

717
00:25:01,840 --> 00:25:06,100
the<font color="#CCCCCC"> Left you're</font><font color="#E5E5E5"> not gonna see W my</font><font color="#CCCCCC"> prpsc</font>

718
00:25:03,700 --> 00:25:07,780
<font color="#E5E5E5">you're gonna see the pit</font><font color="#CCCCCC"> okay or you'll</font>

719
00:25:06,100 --> 00:25:09,760
see process command line in the standard

720
00:25:07,780 --> 00:25:12,460
46 88 saying hey W<font color="#CCCCCC"> might launch this</font>

721
00:25:09,760 --> 00:25:14,290
thing<font color="#E5E5E5"> that's all you're gonna see so</font>

722
00:25:12,460 --> 00:25:17,770
<font color="#E5E5E5">this is big to be able to see this is a</font>

723
00:25:14,290 --> 00:25:19,600
cool thing<font color="#CCCCCC"> to</font><font color="#E5E5E5"> focus on and here I show</font>

724
00:25:17,770 --> 00:25:20,980
just launching notepad so<font color="#CCCCCC"> I was</font><font color="#E5E5E5"> just</font>

725
00:25:19,600 --> 00:25:23,799
playing to see what else<font color="#E5E5E5"> I could do well</font>

726
00:25:20,980 --> 00:25:26,350
there again<font color="#CCCCCC"> W WMI PR vs e is launching</font>

727
00:25:23,799 --> 00:25:28,418
notepad yeah this is not good<font color="#CCCCCC"> you see</font>

728
00:25:26,350 --> 00:25:31,178
this<font color="#CCCCCC"> behavior</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> should be freaking out</font>

729
00:25:28,419 --> 00:25:33,790
<font color="#CCCCCC">this should be a</font><font color="#E5E5E5"> very high return rate</font>

730
00:25:31,179 --> 00:25:36,100
<font color="#E5E5E5">alert for your environment because this</font>

731
00:25:33,790 --> 00:25:37,870
does<font color="#CCCCCC"> not happen very often unless it's a</font>

732
00:25:36,100 --> 00:25:39,219
management utility that you vetted<font color="#E5E5E5"> and</font>

733
00:25:37,870 --> 00:25:41,678
said yep that's just an HP whatever

734
00:25:39,220 --> 00:25:43,840
<font color="#CCCCCC">adele whatever you know etc</font><font color="#E5E5E5"> or storage</font>

735
00:25:41,679 --> 00:25:45,340
<font color="#CCCCCC">array whatever and Intel whatever but</font>

736
00:25:43,840 --> 00:25:47,379
when you start seeing<font color="#E5E5E5"> odd binaries and</font>

737
00:25:45,340 --> 00:25:50,379
more importantly where that binary

738
00:25:47,380 --> 00:25:52,630
resides the directory is definitely the

739
00:25:50,380 --> 00:25:54,250
key thing here<font color="#E5E5E5"> about where that thing is</font>

740
00:25:52,630 --> 00:25:56,500
<font color="#E5E5E5">I'm just launching notepad</font><font color="#CCCCCC"> so it's in</font>

741
00:25:54,250 --> 00:25:58,929
system 32<font color="#CCCCCC"> the bad payload will probably</font>

742
00:25:56,500 --> 00:26:00,549
be<font color="#E5E5E5"> in a user subdirectory</font><font color="#CCCCCC"> like see users</font>

743
00:25:58,929 --> 00:26:02,140
app<font color="#CCCCCC"> data roaming whatever</font><font color="#E5E5E5"> wherever they</font>

744
00:26:00,549 --> 00:26:03,580
dropped it right<font color="#E5E5E5"> they'll use % temp and</font>

745
00:26:02,140 --> 00:26:05,470
<font color="#E5E5E5">they'll</font><font color="#CCCCCC"> just drop the malware</font><font color="#E5E5E5"> there they</font>

746
00:26:03,580 --> 00:26:07,439
know where it is launched it<font color="#E5E5E5"> at % temp</font>

747
00:26:05,470 --> 00:26:10,660
<font color="#E5E5E5">and bam it goes and finds it in the path</font>

748
00:26:07,440 --> 00:26:13,330
and again<font color="#E5E5E5"> comms happened here so you can</font>

749
00:26:10,660 --> 00:26:14,860
see the 137 135 traffic so you know as

750
00:26:13,330 --> 00:26:17,080
again yep somebody did connect to this

751
00:26:14,860 --> 00:26:19,000
<font color="#CCCCCC">machine</font><font color="#E5E5E5"> and did that thing so now I have</font>

752
00:26:17,080 --> 00:26:21,100
<font color="#E5E5E5">more data so what I showed you</font><font color="#CCCCCC"> initially</font>

753
00:26:19,000 --> 00:26:23,050
<font color="#E5E5E5">was kind of the backup data</font><font color="#CCCCCC"> this guy is</font>

754
00:26:21,100 --> 00:26:24,820
the big one look at look at the<font color="#CCCCCC"> WMI</font>

755
00:26:23,050 --> 00:26:26,530
launching a payload<font color="#E5E5E5"> and now look at the</font>

756
00:26:24,820 --> 00:26:27,820
<font color="#E5E5E5">other data to reinforce which direction</font>

757
00:26:26,530 --> 00:26:29,350
<font color="#E5E5E5">and where it came from</font><font color="#CCCCCC"> because</font>

758
00:26:27,820 --> 00:26:30,850
<font color="#CCCCCC">unfortunately the top one doesn't tell</font>

759
00:26:29,350 --> 00:26:32,500
you where you<font color="#E5E5E5"> got a little looking</font>

760
00:26:30,850 --> 00:26:35,679
<font color="#CCCCCC">Network coms or the authentication</font><font color="#E5E5E5"> to</font>

761
00:26:32,500 --> 00:26:38,410
tell you where and<font color="#CCCCCC"> who</font><font color="#E5E5E5"> W my service</font>

762
00:26:35,680 --> 00:26:39,790
starting yeah this kind of<font color="#E5E5E5"> sucks</font><font color="#CCCCCC"> so one</font>

763
00:26:38,410 --> 00:26:41,110
of the things I noticed in the<font color="#E5E5E5"> course</font>

764
00:26:39,790 --> 00:26:43,090
<font color="#E5E5E5">that</font><font color="#CCCCCC"> win and TI attack is there were</font>

765
00:26:41,110 --> 00:26:44,800
<font color="#E5E5E5">some boxes that did not have</font><font color="#CCCCCC"> WMI there</font>

766
00:26:43,090 --> 00:26:46,510
were dumb servers<font color="#E5E5E5"> there was no W my</font>

767
00:26:44,800 --> 00:26:48,970
there's nothing special about<font color="#E5E5E5"> them and</font>

768
00:26:46,510 --> 00:26:50,560
so seeing W<font color="#CCCCCC"> might start with 70/40 which</font>

769
00:26:48,970 --> 00:26:52,480
<font color="#E5E5E5">is a built-in Microsoft utilities so</font>

770
00:26:50,560 --> 00:26:54,460
you'll see a<font color="#CCCCCC"> 70/40 event for this</font><font color="#E5E5E5"> it</font>

771
00:26:52,480 --> 00:26:55,990
doesn't raise<font color="#CCCCCC"> any flags if all of a</font>

772
00:26:54,460 --> 00:26:57,880
sudden<font color="#E5E5E5"> on workstations it starts up a</font>

773
00:26:55,990 --> 00:26:58,720
hundred<font color="#CCCCCC"> 50 times</font><font color="#E5E5E5"> yeah you might want</font><font color="#CCCCCC"> to</font>

774
00:26:57,880 --> 00:27:00,700
pay attention<font color="#E5E5E5"> to that</font>

775
00:26:58,720 --> 00:27:02,380
it'll be<font color="#E5E5E5"> already running on servers but</font>

776
00:27:00,700 --> 00:27:03,820
not a lot of<font color="#E5E5E5"> workstations won't have it</font>

777
00:27:02,380 --> 00:27:06,070
<font color="#CCCCCC">so of all</font><font color="#E5E5E5"> the sudden you get the spike</font>

778
00:27:03,820 --> 00:27:07,689
<font color="#E5E5E5">and a bunch of W my</font><font color="#CCCCCC"> service is starting</font>

779
00:27:06,070 --> 00:27:10,060
<font color="#CCCCCC">you might want to pay attention to</font><font color="#E5E5E5"> the</font>

780
00:27:07,690 --> 00:27:12,670
<font color="#E5E5E5">1740s and unfortunately if you have</font>

781
00:27:10,060 --> 00:27:14,379
security tools the stoppage<font color="#E5E5E5"> of a service</font>

782
00:27:12,670 --> 00:27:16,930
<font color="#CCCCCC">third-party service will not</font><font color="#E5E5E5"> trigger a</font>

783
00:27:14,380 --> 00:27:18,940
stop<font color="#E5E5E5"> on</font><font color="#CCCCCC"> 70/40 event</font><font color="#E5E5E5"> only</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> microsoft</font>

784
00:27:16,930 --> 00:27:20,890
supported stuff<font color="#E5E5E5"> so your your EDR</font>

785
00:27:18,940 --> 00:27:22,750
solution and or some other solution like

786
00:27:20,890 --> 00:27:24,040
net a<font color="#CCCCCC"> queue</font><font color="#E5E5E5"> or something else will have</font>

787
00:27:22,750 --> 00:27:25,720
<font color="#CCCCCC">to be the</font><font color="#E5E5E5"> thing to tell you that hey</font>

788
00:27:24,040 --> 00:27:27,730
something<font color="#E5E5E5"> stopped or you eat our</font>

789
00:27:25,720 --> 00:27:29,350
solution console will say hey 150 of

790
00:27:27,730 --> 00:27:31,450
these as you'll<font color="#E5E5E5"> hear in</font><font color="#CCCCCC"> the podcast</font>

791
00:27:29,350 --> 00:27:34,209
<font color="#E5E5E5">that's coming out this week 150 of these</font>

792
00:27:31,450 --> 00:27:35,920
<font color="#E5E5E5">workstations</font><font color="#CCCCCC"> EDR just stopped oh oh well</font>

793
00:27:34,210 --> 00:27:37,780
<font color="#E5E5E5">something's wrong here</font><font color="#CCCCCC"> right so you have</font>

794
00:27:35,920 --> 00:27:39,310
to<font color="#E5E5E5"> pay</font><font color="#CCCCCC"> attention to that but</font><font color="#E5E5E5"> again there</font>

795
00:27:37,780 --> 00:27:41,410
is<font color="#E5E5E5"> some noise here and you will have to</font>

796
00:27:39,310 --> 00:27:44,830
understand its context of what's going

797
00:27:41,410 --> 00:27:47,560
<font color="#E5E5E5">on so use W - start at a store service</font>

798
00:27:44,830 --> 00:27:49,629
now we're back to typical logging yeah

799
00:27:47,560 --> 00:27:51,700
<font color="#CCCCCC">unfortunately Microsoft does not enable</font>

800
00:27:49,630 --> 00:27:54,130
the task scheduler<font color="#CCCCCC"> log by default</font><font color="#E5E5E5"> so you</font>

801
00:27:51,700 --> 00:27:56,290
<font color="#E5E5E5">have to go enable it as part</font><font color="#CCCCCC"> of GPO</font><font color="#E5E5E5"> it's</font>

802
00:27:54,130 --> 00:27:58,780
sad<font color="#E5E5E5"> there are other logs in the security</font>

803
00:27:56,290 --> 00:28:00,159
log<font color="#E5E5E5"> which</font><font color="#CCCCCC"> I mention a second</font><font color="#E5E5E5"> but really</font>

804
00:27:58,780 --> 00:28:02,080
this is<font color="#CCCCCC"> the key log</font><font color="#E5E5E5"> because they're</font>

805
00:28:00,160 --> 00:28:03,610
simple messages<font color="#E5E5E5"> they're low noise and</font>

806
00:28:02,080 --> 00:28:05,260
you can literally look<font color="#E5E5E5"> for creates and</font>

807
00:28:03,610 --> 00:28:06,280
starts and<font color="#E5E5E5"> that's it you can filter out</font>

808
00:28:05,260 --> 00:28:08,290
<font color="#E5E5E5">and throw out all the rest</font>

809
00:28:06,280 --> 00:28:09,460
yeah they deleted it<font color="#CCCCCC"> - you'll find that</font>

810
00:28:08,290 --> 00:28:12,460
in your investigation you<font color="#E5E5E5"> don't really</font>

811
00:28:09,460 --> 00:28:13,810
need to<font color="#E5E5E5"> log</font><font color="#CCCCCC"> that now but</font><font color="#E5E5E5"> the 106 and 100</font>

812
00:28:12,460 --> 00:28:16,450
and the<font color="#E5E5E5"> 110 s are really what you're</font>

813
00:28:13,810 --> 00:28:18,340
<font color="#CCCCCC">after</font><font color="#E5E5E5"> and again scheduler operational</font>

814
00:28:16,450 --> 00:28:19,510
log<font color="#E5E5E5"> is not started by default in Windows</font>

815
00:28:18,340 --> 00:28:20,899
please go turn it on<font color="#E5E5E5"> please please</font>

816
00:28:19,510 --> 00:28:23,429
please please<font color="#E5E5E5"> please</font><font color="#CCCCCC"> I big</font>

817
00:28:20,900 --> 00:28:24,809
creating a service<font color="#E5E5E5"> is noisy when you do</font>

818
00:28:23,429 --> 00:28:27,570
create<font color="#E5E5E5"> a service</font><font color="#CCCCCC"> I don't care who made</font>

819
00:28:24,809 --> 00:28:29,309
it you get a<font color="#E5E5E5"> 70 45 event this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> the one</font>

820
00:28:27,570 --> 00:28:32,580
thing that<font color="#E5E5E5"> windows by default does well</font>

821
00:28:29,309 --> 00:28:33,660
<font color="#E5E5E5">it is on</font><font color="#CCCCCC"> on every machine</font><font color="#E5E5E5"> forever for</font>

822
00:28:32,580 --> 00:28:36,120
all versions of Windows<font color="#E5E5E5"> that I can</font>

823
00:28:33,660 --> 00:28:37,350
remember<font color="#E5E5E5"> so you should always look at</font>

824
00:28:36,120 --> 00:28:39,689
new service creations in all

825
00:28:37,350 --> 00:28:40,379
workstations and servers<font color="#CCCCCC"> by far period</font>

826
00:28:39,690 --> 00:28:42,000
<font color="#CCCCCC">in</font><font color="#E5E5E5"> a story</font>

827
00:28:40,380 --> 00:28:45,000
the POS software<font color="#E5E5E5"> the hill the credit</font>

828
00:28:42,000 --> 00:28:47,160
card used this when<font color="#CCCCCC"> nti</font><font color="#E5E5E5"> seriously</font><font color="#CCCCCC"> used</font>

829
00:28:45,000 --> 00:28:49,740
this<font color="#E5E5E5"> so this was a major</font><font color="#CCCCCC"> alert that got</font>

830
00:28:47,160 --> 00:28:51,090
us alerted to<font color="#E5E5E5"> that cheat sheet that I</font>

831
00:28:49,740 --> 00:28:52,860
initially<font color="#E5E5E5"> created this was the big one</font>

832
00:28:51,090 --> 00:28:54,780
<font color="#E5E5E5">this was a really</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> powerful one</font><font color="#CCCCCC"> because</font>

833
00:28:52,860 --> 00:28:56,309
they installed everything<font color="#E5E5E5"> as a service</font>

834
00:28:54,780 --> 00:28:58,168
and they used driver files<font color="#CCCCCC"> because they</font>

835
00:28:56,309 --> 00:29:00,990
don't log anything<font color="#E5E5E5"> so all of a sudden we</font>

836
00:28:58,169 --> 00:29:02,940
had 150 services starting called<font color="#CCCCCC"> Splunk</font>

837
00:29:00,990 --> 00:29:06,270
driver like wait a<font color="#CCCCCC"> minute I know Splunk</font>

838
00:29:02,940 --> 00:29:08,190
it doesn't that no no<font color="#E5E5E5"> no and boom we</font>

839
00:29:06,270 --> 00:29:10,410
found it<font color="#E5E5E5"> unfortunately when they stopped</font>

840
00:29:08,190 --> 00:29:11,970
our big<font color="#CCCCCC"> fake</font><font color="#E5E5E5"> service and found a cave</font>

841
00:29:10,410 --> 00:29:13,980
<font color="#E5E5E5">and infected it and restarted it we</font>

842
00:29:11,970 --> 00:29:15,780
<font color="#E5E5E5">never saw any</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> that and so when big</font>

843
00:29:13,980 --> 00:29:17,520
fix<font color="#E5E5E5"> will start up it would actually read</font>

844
00:29:15,780 --> 00:29:19,530
a payload out of the registry<font color="#E5E5E5"> drop it</font><font color="#CCCCCC"> to</font>

845
00:29:17,520 --> 00:29:21,360
disk<font color="#E5E5E5"> execute and then delete it we never</font>

846
00:29:19,530 --> 00:29:22,500
<font color="#E5E5E5">saw the hundred and fifty workstations</font>

847
00:29:21,360 --> 00:29:24,330
and servers stopping and starting

848
00:29:22,500 --> 00:29:26,820
<font color="#E5E5E5">redoing that that would have stuck out</font>

849
00:29:24,330 --> 00:29:29,460
because Microsoft doesn't log<font color="#E5E5E5"> third</font>

850
00:29:26,820 --> 00:29:31,918
<font color="#E5E5E5">party starts and stops and services but</font>

851
00:29:29,460 --> 00:29:33,720
there's<font color="#E5E5E5"> help so in the more advanced</font>

852
00:29:31,919 --> 00:29:35,250
<font color="#CCCCCC">Windows cheat sheet the</font><font color="#E5E5E5"> windows advance</font>

853
00:29:33,720 --> 00:29:37,049
<font color="#E5E5E5">login cheat</font><font color="#CCCCCC"> sheet</font><font color="#E5E5E5"> shout out to</font><font color="#CCCCCC"> David</font>

854
00:29:35,250 --> 00:29:38,309
<font color="#E5E5E5">longnecker who helped out with this we</font>

855
00:29:37,049 --> 00:29:39,840
published some<font color="#CCCCCC"> of these more advanced</font>

856
00:29:38,309 --> 00:29:42,090
settings<font color="#CCCCCC"> one of which is the forty six</font>

857
00:29:39,840 --> 00:29:44,250
<font color="#CCCCCC">ninety eight ninety nine 4747 of twos</font>

858
00:29:42,090 --> 00:29:46,918
which are security log task scheduler

859
00:29:44,250 --> 00:29:49,320
log events but you have to turn<font color="#E5E5E5"> on some</font>

860
00:29:46,919 --> 00:29:51,809
specific logging additional logging

861
00:29:49,320 --> 00:29:53,340
which can<font color="#E5E5E5"> get</font><font color="#CCCCCC"> quite noisy</font><font color="#E5E5E5"> again original</font>

862
00:29:51,809 --> 00:29:54,690
windows<font color="#CCCCCC"> login</font><font color="#E5E5E5"> cheat sheets try to be as</font>

863
00:29:53,340 --> 00:29:56,668
little<font color="#E5E5E5"> noise as</font><font color="#CCCCCC"> possible to greatest</font>

864
00:29:54,690 --> 00:29:58,110
<font color="#E5E5E5">value but a lot</font><font color="#CCCCCC"> of us want some more</font>

865
00:29:56,669 --> 00:30:00,540
<font color="#E5E5E5">advanced details and that's where we put</font>

866
00:29:58,110 --> 00:30:03,178
it in that<font color="#CCCCCC"> one</font><font color="#E5E5E5"> and again</font><font color="#CCCCCC"> no third</font><font color="#E5E5E5"> party</font>

867
00:30:00,540 --> 00:30:04,620
with<font color="#E5E5E5"> 70</font><font color="#CCCCCC"> 40s so what you have to</font><font color="#E5E5E5"> do is</font>

868
00:30:03,179 --> 00:30:06,540
modify<font color="#E5E5E5"> the</font><font color="#CCCCCC"> tackles</font><font color="#E5E5E5"> that's in the</font>

869
00:30:04,620 --> 00:30:08,309
<font color="#E5E5E5">advanced logging cheat sheet and enable</font>

870
00:30:06,540 --> 00:30:10,230
a couple other audit items<font color="#E5E5E5"> and then you</font>

871
00:30:08,309 --> 00:30:12,178
will actually<font color="#E5E5E5"> see the starting and</font>

872
00:30:10,230 --> 00:30:14,250
stopping<font color="#CCCCCC"> of third-party</font><font color="#E5E5E5"> services so now</font>

873
00:30:12,179 --> 00:30:16,020
you can<font color="#CCCCCC"> monitor</font><font color="#E5E5E5"> the EDR</font><font color="#CCCCCC"> covering black</font>

874
00:30:14,250 --> 00:30:17,850
in game<font color="#CCCCCC"> whatever</font><font color="#E5E5E5"> if they don't have it</font>

875
00:30:16,020 --> 00:30:19,830
<font color="#E5E5E5">built in or the big fixes or whatever</font>

876
00:30:17,850 --> 00:30:21,030
you'll have the ability<font color="#CCCCCC"> to do this if</font>

877
00:30:19,830 --> 00:30:22,740
you want<font color="#CCCCCC"> to</font><font color="#E5E5E5"> turn this on it and hunt for</font>

878
00:30:21,030 --> 00:30:25,500
<font color="#CCCCCC">this</font><font color="#E5E5E5"> item it's pretty</font><font color="#CCCCCC"> powerful to be</font>

879
00:30:22,740 --> 00:30:27,179
<font color="#CCCCCC">able to see that activity</font><font color="#E5E5E5"> system</font><font color="#CCCCCC"> on is</font>

880
00:30:25,500 --> 00:30:29,040
an option<font color="#E5E5E5"> but again if you haven't</font>

881
00:30:27,179 --> 00:30:30,750
<font color="#E5E5E5">listened to Mac ravers talk blackhat</font>

882
00:30:29,040 --> 00:30:32,879
same one for he talks about<font color="#E5E5E5"> how you can</font>

883
00:30:30,750 --> 00:30:34,080
modify it<font color="#CCCCCC"> I know Carlos Perez's talked</font>

884
00:30:32,880 --> 00:30:36,210
about<font color="#E5E5E5"> this and blogged</font><font color="#CCCCCC"> about how</font>

885
00:30:34,080 --> 00:30:38,580
<font color="#CCCCCC">bypass system on just changed the</font>

886
00:30:36,210 --> 00:30:40,799
settings in<font color="#CCCCCC"> a registry you can modify</font>

887
00:30:38,580 --> 00:30:42,840
the config and<font color="#E5E5E5"> reload</font><font color="#CCCCCC"> it so it Bork's it</font>

888
00:30:40,799 --> 00:30:44,129
and<font color="#CCCCCC"> won't load</font><font color="#E5E5E5"> lots of ways</font><font color="#CCCCCC"> you can</font><font color="#E5E5E5"> get</font>

889
00:30:42,840 --> 00:30:46,439
<font color="#E5E5E5">around system on so I would not</font>

890
00:30:44,130 --> 00:30:48,450
<font color="#E5E5E5">recommend being</font><font color="#CCCCCC"> it your</font><font color="#E5E5E5"> being a major</font>

891
00:30:46,440 --> 00:30:50,130
logging device<font color="#CCCCCC"> I would say use built-in</font>

892
00:30:48,450 --> 00:30:51,809
windows logs first<font color="#E5E5E5"> and supplement it</font>

893
00:30:50,130 --> 00:30:53,730
with<font color="#E5E5E5"> the things that</font><font color="#CCCCCC"> sis Mon does</font><font color="#E5E5E5"> really</font>

894
00:30:51,809 --> 00:30:55,889
<font color="#E5E5E5">well and please watch Matt at least talk</font>

895
00:30:53,730 --> 00:30:59,070
for<font color="#E5E5E5"> more on this subject</font><font color="#CCCCCC"> but again you</font>

896
00:30:55,890 --> 00:31:00,330
<font color="#E5E5E5">want event IDs 19 20 and 21 in system on</font>

897
00:30:59,070 --> 00:31:03,779
that will tell you the<font color="#CCCCCC"> new root</font>

898
00:31:00,330 --> 00:31:05,279
subscription<font color="#E5E5E5"> items that were added and</font>

899
00:31:03,779 --> 00:31:08,309
so that's<font color="#CCCCCC"> something to watch</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> if</font>

900
00:31:05,279 --> 00:31:09,750
you're using<font color="#E5E5E5"> sis month how many people</font>

901
00:31:08,309 --> 00:31:11,279
here are familiar with<font color="#CCCCCC"> wls the</font>

902
00:31:09,750 --> 00:31:13,830
government project Jason McCord

903
00:31:11,279 --> 00:31:15,690
<font color="#E5E5E5">this is sis Mon on steroids this is an</font>

904
00:31:13,830 --> 00:31:17,399
actual syslog service developed by the

905
00:31:15,690 --> 00:31:19,950
government<font color="#CCCCCC"> the new people</font><font color="#E5E5E5"> that can't use</font>

906
00:31:17,399 --> 00:31:23,219
third party stuff<font color="#CCCCCC"> and this is a serious</font>

907
00:31:19,950 --> 00:31:24,539
badass logging agent<font color="#CCCCCC"> it sees more stuff</font>

908
00:31:23,220 --> 00:31:26,340
than<font color="#CCCCCC"> you could ever</font><font color="#E5E5E5"> imagine anything</font>

909
00:31:24,539 --> 00:31:28,379
else seeing it doesn't look at<font color="#E5E5E5"> the logs</font>

910
00:31:26,340 --> 00:31:29,820
it writes its own syslog data right

911
00:31:28,380 --> 00:31:33,120
directly<font color="#E5E5E5"> to</font><font color="#CCCCCC"> your</font><font color="#E5E5E5"> to your syslog server</font>

912
00:31:29,820 --> 00:31:34,678
<font color="#CCCCCC">Splunk whatever and it collects</font><font color="#E5E5E5"> just an</font>

913
00:31:33,120 --> 00:31:36,209
amazing amount of<font color="#E5E5E5"> data all the configs</font>

914
00:31:34,679 --> 00:31:39,360
are stored in a registry<font color="#CCCCCC"> I on a personal</font>

915
00:31:36,210 --> 00:31:41,700
copy of it<font color="#E5E5E5"> it's incredibly volumous so</font>

916
00:31:39,360 --> 00:31:43,350
licensing is a concern here<font color="#CCCCCC"> but if you</font>

917
00:31:41,700 --> 00:31:45,179
<font color="#E5E5E5">really want to see stuff there needs to</font>

918
00:31:43,350 --> 00:31:47,719
be some<font color="#E5E5E5"> work on</font><font color="#CCCCCC"> WMI but it does see the</font>

919
00:31:45,179 --> 00:31:49,830
<font color="#E5E5E5">user</font><font color="#CCCCCC"> calls so you can see what dummy my</font>

920
00:31:47,720 --> 00:31:51,330
object call was made and that's that's

921
00:31:49,830 --> 00:31:53,549
<font color="#E5E5E5">what he's logging so some</font><font color="#CCCCCC"> of the trace</font>

922
00:31:51,330 --> 00:31:55,320
log<font color="#E5E5E5"> data here</font><font color="#CCCCCC"> I'm so another</font><font color="#E5E5E5"> option for</font>

923
00:31:53,549 --> 00:31:58,200
you<font color="#CCCCCC"> guys</font><font color="#E5E5E5"> we</font><font color="#CCCCCC"> really are concerned</font><font color="#E5E5E5"> about</font>

924
00:31:55,320 --> 00:32:00,689
<font color="#E5E5E5">the apt scenarios of that</font><font color="#CCCCCC"> wls what can</font>

925
00:31:58,200 --> 00:32:01,620
really<font color="#CCCCCC"> help so look at PowerShell you</font>

926
00:32:00,690 --> 00:32:03,659
can't have double you might have<font color="#CCCCCC"> that</font>

927
00:32:01,620 --> 00:32:05,309
PowerShell in most cases and again don't

928
00:32:03,659 --> 00:32:06,990
<font color="#CCCCCC">forget you have to enable</font><font color="#E5E5E5"> the logging</font>

929
00:32:05,309 --> 00:32:08,399
you gotta<font color="#CCCCCC"> turn on</font><font color="#E5E5E5"> Windows does not turn</font>

930
00:32:06,990 --> 00:32:09,809
<font color="#E5E5E5">this logging on by</font><font color="#CCCCCC"> default so please</font>

931
00:32:08,399 --> 00:32:13,049
follow the cheat sheets and<font color="#E5E5E5"> get that</font>

932
00:32:09,809 --> 00:32:15,720
enabled<font color="#CCCCCC"> and there's a lot</font><font color="#E5E5E5"> to this so</font>

933
00:32:13,049 --> 00:32:18,330
watch my show me<font color="#CCCCCC"> con gracefully recorded</font>

934
00:32:15,720 --> 00:32:19,740
by<font color="#CCCCCC"> Adrian so he posting</font><font color="#E5E5E5"> that has the</font>

935
00:32:18,330 --> 00:32:23,460
ability<font color="#CCCCCC"> for</font><font color="#E5E5E5"> all of you now to see the</font>

936
00:32:19,740 --> 00:32:24,870
<font color="#E5E5E5">PowerShell sister</font><font color="#CCCCCC"> talk</font><font color="#E5E5E5"> about this so I</font>

937
00:32:23,460 --> 00:32:26,850
highly recommend<font color="#E5E5E5"> you go watch this video</font>

938
00:32:24,870 --> 00:32:28,168
because<font color="#CCCCCC"> I share all the interesting</font>

939
00:32:26,850 --> 00:32:31,199
<font color="#CCCCCC">powershell food that you should collect</font>

940
00:32:28,169 --> 00:32:33,510
and again<font color="#E5E5E5"> detect and hunt for powershell</font>

941
00:32:31,200 --> 00:32:36,179
oddball powershell there are two logs

942
00:32:33,510 --> 00:32:39,330
<font color="#E5E5E5">the windows powershell old v2 logs</font>

943
00:32:36,179 --> 00:32:42,450
<font color="#E5E5E5">though still works in</font><font color="#CCCCCC"> 3 4 & 5 & 6</font>

944
00:32:39,330 --> 00:32:43,889
<font color="#E5E5E5">and also specifically</font><font color="#CCCCCC"> the new v4 or</font><font color="#E5E5E5"> five</font>

945
00:32:42,450 --> 00:32:45,929
and six logs<font color="#E5E5E5"> windows powershell</font>

946
00:32:43,889 --> 00:32:47,520
operational this<font color="#E5E5E5"> is where the 4100</font>

947
00:32:45,929 --> 00:32:50,400
series comes into play

948
00:32:47,520 --> 00:32:51,929
the<font color="#CCCCCC"> powershell logs are 200 to 800 so</font>

949
00:32:50,400 --> 00:32:54,630
definitely monitor these logs for

950
00:32:51,929 --> 00:32:55,950
powershell activity heading in process

951
00:32:54,630 --> 00:32:58,890
command line right<font color="#E5E5E5"> I mentioned this</font>

952
00:32:55,950 --> 00:33:00,390
<font color="#E5E5E5">before you'll see the 46 88 but then</font>

953
00:32:58,890 --> 00:33:02,730
when powers shall execute you're gonna

954
00:33:00,390 --> 00:33:07,559
see<font color="#E5E5E5"> PowerShell executing a lot of</font>

955
00:33:02,730 --> 00:33:11,160
duplicate log entries 200 400 600 500

956
00:33:07,559 --> 00:33:12,450
500<font color="#E5E5E5"> ones 800 etc but these you want to</font>

957
00:33:11,160 --> 00:33:14,040
watch<font color="#E5E5E5"> for these as well</font><font color="#CCCCCC"> depending</font><font color="#E5E5E5"> on</font>

958
00:33:12,450 --> 00:33:16,470
<font color="#E5E5E5">your version of PowerShell</font><font color="#CCCCCC"> and of course</font>

959
00:33:14,040 --> 00:33:18,990
<font color="#E5E5E5">if there's any</font><font color="#CCCCCC"> base64 involved or any</font>

960
00:33:16,470 --> 00:33:21,600
odd scripting or<font color="#CCCCCC"> off you station the</font>

961
00:33:18,990 --> 00:33:23,550
4104 will actually decode a lot of that

962
00:33:21,600 --> 00:33:25,469
for you<font color="#E5E5E5"> so that's the cool part you'll</font>

963
00:33:23,550 --> 00:33:28,800
see this big base64<font color="#E5E5E5"> blob show up which</font>

964
00:33:25,470 --> 00:33:30,570
is probably<font color="#CCCCCC"> always</font><font color="#E5E5E5"> bad like 99.9% you</font>

965
00:33:28,800 --> 00:33:32,520
could then go looking<font color="#CCCCCC"> at 4104 and you're</font>

966
00:33:30,570 --> 00:33:34,559
gonna see it<font color="#E5E5E5"> decode it very cool so it</font>

967
00:33:32,520 --> 00:33:38,970
does<font color="#E5E5E5"> that</font><font color="#CCCCCC"> for you</font><font color="#E5E5E5"> so very powerful</font>

968
00:33:34,559 --> 00:33:40,559
<font color="#E5E5E5">feature</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> PowerShell 5 6 etc here's</font>

969
00:33:38,970 --> 00:33:42,540
whom you know so whom he owes a solution

970
00:33:40,559 --> 00:33:44,309
I recommend if you<font color="#CCCCCC"> want a free solution</font>

971
00:33:42,540 --> 00:33:47,520
to work at home in<font color="#CCCCCC"> your lab and your</font>

972
00:33:44,309 --> 00:33:49,440
<font color="#E5E5E5">testing</font><font color="#CCCCCC"> who mios free for</font><font color="#E5E5E5"> 2 terabytes of</font>

973
00:33:47,520 --> 00:33:50,879
data for<font color="#CCCCCC"> seven days and</font><font color="#E5E5E5"> I'm always</font>

974
00:33:49,440 --> 00:33:52,470
<font color="#E5E5E5">looking for something I</font><font color="#CCCCCC"> can recommend to</font>

975
00:33:50,880 --> 00:33:53,790
<font color="#CCCCCC">people that's again completely cloud</font>

976
00:33:52,470 --> 00:33:55,230
they have an<font color="#E5E5E5"> on-prem solution I'm not</font>

977
00:33:53,790 --> 00:33:57,600
here to promote<font color="#E5E5E5"> whom you know they're</font>

978
00:33:55,230 --> 00:33:59,460
<font color="#E5E5E5">sponsored a podcast but I need something</font>

979
00:33:57,600 --> 00:34:00,330
I<font color="#CCCCCC"> can do in</font><font color="#E5E5E5"> lab and at home all my</font>

980
00:33:59,460 --> 00:34:02,460
stuff's monitored

981
00:34:00,330 --> 00:34:03,928
so here's PowerShell<font color="#E5E5E5"> running right so I</font>

982
00:34:02,460 --> 00:34:06,120
now know<font color="#CCCCCC"> that powers will execute it I</font>

983
00:34:03,929 --> 00:34:08,490
now can create<font color="#E5E5E5"> reports and alerts</font><font color="#CCCCCC"> of the</font>

984
00:34:06,120 --> 00:34:11,100
other objects of what executed

985
00:34:08,489 --> 00:34:12,928
so here's PowerShell seeing me execute<font color="#CCCCCC"> W</font>

986
00:34:11,100 --> 00:34:14,879
my implant<font color="#CCCCCC"> alright so here's an example</font>

987
00:34:12,929 --> 00:34:16,230
how at home I can do this research<font color="#E5E5E5"> and</font><font color="#CCCCCC"> I</font>

988
00:34:14,879 --> 00:34:17,580
can monitor<font color="#CCCCCC"> all my stuff make sure</font><font color="#E5E5E5"> you</font>

989
00:34:16,230 --> 00:34:19,080
<font color="#CCCCCC">know your kids your wife</font><font color="#E5E5E5"> don't get</font>

990
00:34:17,580 --> 00:34:21,179
malware<font color="#E5E5E5"> well they'll get malware you</font>

991
00:34:19,080 --> 00:34:23,460
just at<font color="#E5E5E5"> least detect it</font><font color="#CCCCCC"> but very</font>

992
00:34:21,179 --> 00:34:24,899
<font color="#CCCCCC">powerful</font><font color="#E5E5E5"> in regards</font><font color="#CCCCCC"> that aspect</font><font color="#E5E5E5"> and then</font>

993
00:34:23,460 --> 00:34:26,699
you can take what you've learned<font color="#E5E5E5"> to work</font>

994
00:34:24,899 --> 00:34:29,879
and convert that<font color="#E5E5E5"> to your sim of choice</font>

995
00:34:26,699 --> 00:34:32,368
and flavor<font color="#E5E5E5"> and</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> course</font><font color="#CCCCCC"> this was a</font>

996
00:34:29,879 --> 00:34:35,699
base64 blob so it gets<font color="#E5E5E5"> translated into</font>

997
00:34:32,369 --> 00:34:37,889
<font color="#CCCCCC">41 of cores how do I hunt for</font><font color="#E5E5E5"> power show</font>

998
00:34:35,699 --> 00:34:39,899
<font color="#CCCCCC">well I love logon</font><font color="#E5E5E5"> D but I'm biased I'm</font>

999
00:34:37,889 --> 00:34:41,250
co-developer of<font color="#E5E5E5"> it but here's an example</font>

1000
00:34:39,899 --> 00:34:43,500
of<font color="#E5E5E5"> the kinds of stuff</font><font color="#CCCCCC"> you should hunt</font>

1001
00:34:41,250 --> 00:34:45,690
for in PowerShell<font color="#E5E5E5"> though</font><font color="#CCCCCC"> Splunk logging</font>

1002
00:34:43,500 --> 00:34:48,810
cheat sheet has an<font color="#E5E5E5"> example of this kind</font>

1003
00:34:45,690 --> 00:34:50,580
<font color="#E5E5E5">of</font><font color="#CCCCCC"> logic that's on our archaeology so</font>

1004
00:34:48,810 --> 00:34:53,609
again suspicious<font color="#E5E5E5"> artifact so they're</font>

1005
00:34:50,580 --> 00:34:55,049
using<font color="#E5E5E5"> the</font><font color="#CCCCCC"> buzz word - Ian C 4 encoded</font><font color="#E5E5E5"> so</font>

1006
00:34:53,609 --> 00:34:56,429
I know there's<font color="#E5E5E5"> something decoded and</font>

1007
00:34:55,050 --> 00:34:58,500
also<font color="#E5E5E5"> we're</font><font color="#CCCCCC"> bypassed so they're trying to</font>

1008
00:34:56,429 --> 00:35:00,870
bypass something I have seen legitimate

1009
00:34:58,500 --> 00:35:02,850
software<font color="#E5E5E5"> do this but it's rare</font>

1010
00:35:00,870 --> 00:35:04,380
so that in<font color="#CCCCCC"> itself isn't a warning but</font>

1011
00:35:02,850 --> 00:35:07,650
then the<font color="#E5E5E5"> very</font><font color="#CCCCCC"> next thing</font><font color="#E5E5E5"> is there's a</font>

1012
00:35:04,380 --> 00:35:10,800
138 ticks and 264<font color="#E5E5E5"> pluses anybody see</font>

1013
00:35:07,650 --> 00:35:13,050
Daniel<font color="#E5E5E5"> Bohannon's obfuscation talks yeah</font>

1014
00:35:10,800 --> 00:35:14,340
<font color="#CCCCCC">well you</font><font color="#E5E5E5"> just caught it</font><font color="#CCCCCC"> right there this</font>

1015
00:35:13,050 --> 00:35:16,740
<font color="#CCCCCC">blunt query and the cheat sheets</font><font color="#E5E5E5"> will</font>

1016
00:35:14,340 --> 00:35:18,150
have an example<font color="#E5E5E5"> this as well and it's a</font>

1017
00:35:16,740 --> 00:35:20,009
large block size so I know there's a

1018
00:35:18,150 --> 00:35:21,960
big-ass block<font color="#CCCCCC"> and it's got lots of</font>

1019
00:35:20,010 --> 00:35:24,120
special<font color="#E5E5E5"> characters</font><font color="#CCCCCC"> or potential</font><font color="#E5E5E5"> off you</font>

1020
00:35:21,960 --> 00:35:25,290
station so log<font color="#E5E5E5"> MD we have a settings</font>

1021
00:35:24,120 --> 00:35:27,600
file you can configure to<font color="#E5E5E5"> make this</font>

1022
00:35:25,290 --> 00:35:29,520
<font color="#E5E5E5">really stick out the last item is the</font>

1023
00:35:27,600 --> 00:35:31,110
fact that power shell is phoning home to

1024
00:35:29,520 --> 00:35:33,180
somewhere<font color="#CCCCCC"> and so it's making</font><font color="#E5E5E5"> an HTTP web</font>

1025
00:35:31,110 --> 00:35:35,370
client request<font color="#CCCCCC"> these</font><font color="#E5E5E5"> three combinations</font>

1026
00:35:33,180 --> 00:35:37,319
<font color="#CCCCCC">together should say hey somebody's</font>

1027
00:35:35,370 --> 00:35:39,900
infected or the<font color="#E5E5E5"> box is trying to be</font>

1028
00:35:37,320 --> 00:35:41,190
<font color="#E5E5E5">infected by something for somebody and</font>

1029
00:35:39,900 --> 00:35:43,920
again this can be<font color="#E5E5E5"> initiated</font><font color="#CCCCCC"> by a</font>

1030
00:35:41,190 --> 00:35:46,620
PowerShell<font color="#E5E5E5"> wipe our shells</font><font color="#CCCCCC"> with trusted</font>

1031
00:35:43,920 --> 00:35:47,670
binary<font color="#E5E5E5"> it can phone out and your white</font>

1032
00:35:46,620 --> 00:35:49,380
listings<font color="#E5E5E5"> gonna be fine with it</font>

1033
00:35:47,670 --> 00:35:53,070
<font color="#CCCCCC">ADR should be freaking out</font><font color="#E5E5E5"> right now</font><font color="#CCCCCC"> too</font>

1034
00:35:49,380 --> 00:35:55,190
<font color="#E5E5E5">if it doesn't don't buy the EDR or buy a</font>

1035
00:35:53,070 --> 00:35:58,080
different<font color="#E5E5E5"> one</font><font color="#CCCCCC"> or something</font><font color="#E5E5E5"> or complain</font>

1036
00:35:55,190 --> 00:36:00,660
but<font color="#E5E5E5"> yeah so some tools to talk about</font>

1037
00:35:58,080 --> 00:36:01,920
<font color="#CCCCCC">login D we query all the</font><font color="#E5E5E5"> namespaces so</font>

1038
00:36:00,660 --> 00:36:03,029
if you want<font color="#E5E5E5"> to come take a look at our</font>

1039
00:36:01,920 --> 00:36:05,070
booth<font color="#CCCCCC"> while we're up</font><font color="#E5E5E5"> there and</font><font color="#CCCCCC"> I'm here</font>

1040
00:36:03,030 --> 00:36:07,500
<font color="#E5E5E5">to push that I want this to</font><font color="#CCCCCC"> be generic</font>

1041
00:36:05,070 --> 00:36:09,120
for anything<font color="#E5E5E5"> you use and do this</font>

1042
00:36:07,500 --> 00:36:10,440
literally is something you can do with

1043
00:36:09,120 --> 00:36:12,450
with<font color="#CCCCCC"> a myriad of tools scripts</font>

1044
00:36:10,440 --> 00:36:14,520
<font color="#CCCCCC">PowerShell Python</font><font color="#E5E5E5"> whatever you want to</font>

1045
00:36:12,450 --> 00:36:16,890
do<font color="#CCCCCC"> if you do anything interesting let me</font>

1046
00:36:14,520 --> 00:36:18,300
know and<font color="#CCCCCC"> maybe</font><font color="#E5E5E5"> we can help promote that</font>

1047
00:36:16,890 --> 00:36:20,339
<font color="#CCCCCC">in regards to</font><font color="#E5E5E5"> an option for people to</font>

1048
00:36:18,300 --> 00:36:22,710
scan<font color="#E5E5E5"> or if you hear something</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> again</font>

1049
00:36:20,340 --> 00:36:26,430
we do also<font color="#CCCCCC"> have a</font><font color="#E5E5E5"> - W my options so we</font>

1050
00:36:22,710 --> 00:36:27,870
can just scan or hunt for<font color="#E5E5E5"> W my my</font>

1051
00:36:26,430 --> 00:36:29,250
perspective of hunting is a little

1052
00:36:27,870 --> 00:36:31,109
different<font color="#E5E5E5"> a lot of times you hear talks</font>

1053
00:36:29,250 --> 00:36:33,170
<font color="#CCCCCC">if you listen to my sans third talk</font>

1054
00:36:31,110 --> 00:36:35,340
<font color="#CCCCCC">which</font><font color="#E5E5E5"> still publish in three six months</font>

1055
00:36:33,170 --> 00:36:38,130
some random time they<font color="#CCCCCC"> probably</font><font color="#E5E5E5"> tweeted</font>

1056
00:36:35,340 --> 00:36:40,860
out<font color="#CCCCCC"> I say start with excluding what you</font>

1057
00:36:38,130 --> 00:36:43,980
know you don't have before you make a

1058
00:36:40,860 --> 00:36:45,750
theory<font color="#CCCCCC"> or hypothesis meaning</font><font color="#E5E5E5"> when you</font>

1059
00:36:43,980 --> 00:36:47,820
<font color="#E5E5E5">watch my sans talk there are four</font><font color="#CCCCCC"> items</font>

1060
00:36:45,750 --> 00:36:49,560
on there that I've seen a<font color="#E5E5E5"> 95% of all</font>

1061
00:36:47,820 --> 00:36:51,090
malware I've ever seen<font color="#CCCCCC"> so if you can</font>

1062
00:36:49,560 --> 00:36:53,759
hunt for<font color="#CCCCCC"> that</font><font color="#E5E5E5"> and eliminate I know I</font>

1063
00:36:51,090 --> 00:36:55,680
<font color="#E5E5E5">don't have W my going on that's bad</font><font color="#CCCCCC"> I</font>

1064
00:36:53,760 --> 00:36:57,240
know I<font color="#E5E5E5"> don't have large registry keys</font><font color="#CCCCCC"> I</font>

1065
00:36:55,680 --> 00:36:59,069
know I don't<font color="#CCCCCC"> have</font><font color="#E5E5E5"> any</font><font color="#CCCCCC"> no bites I know</font>

1066
00:36:57,240 --> 00:37:01,109
I'm<font color="#CCCCCC"> watching my</font><font color="#E5E5E5"> see users directory</font>

1067
00:36:59,070 --> 00:37:02,580
<font color="#E5E5E5">structure for executions I'm looking at</font>

1068
00:37:01,110 --> 00:37:04,620
my<font color="#E5E5E5"> auto runs that I know I don't have</font>

1069
00:37:02,580 --> 00:37:06,540
<font color="#E5E5E5">any funky autoruns you just eliminated</font>

1070
00:37:04,620 --> 00:37:07,770
like<font color="#CCCCCC"> 99% of all infections right there</font>

1071
00:37:06,540 --> 00:37:10,200
<font color="#E5E5E5">because they all have to</font><font color="#CCCCCC"> do one or more</font>

1072
00:37:07,770 --> 00:37:12,960
of those pieces<font color="#CCCCCC"> so go after</font><font color="#E5E5E5"> what</font><font color="#CCCCCC"> you</font>

1073
00:37:10,200 --> 00:37:14,819
know you don't have<font color="#E5E5E5"> eliminate that then</font>

1074
00:37:12,960 --> 00:37:17,520
build your hypotheses to go hunting

1075
00:37:14,820 --> 00:37:19,890
but<font color="#E5E5E5"> definitely hunt for</font><font color="#CCCCCC"> WMI</font><font color="#E5E5E5"> because this</font>

1076
00:37:17,520 --> 00:37:21,930
stuff is stealthy it's quiet<font color="#E5E5E5"> and it's</font>

1077
00:37:19,890 --> 00:37:23,640
easy<font color="#CCCCCC"> to</font><font color="#E5E5E5"> in effect infect a system with</font>

1078
00:37:21,930 --> 00:37:27,740
house it has lots of power just<font color="#E5E5E5"> need</font>

1079
00:37:23,640 --> 00:37:27,740
user<font color="#E5E5E5"> right because all you need is creds</font>

1080
00:37:28,040 --> 00:37:33,750
still better than cactus going and<font color="#E5E5E5"> again</font>

1081
00:37:31,980 --> 00:37:35,160
you can use<font color="#E5E5E5"> system kernels</font><font color="#CCCCCC"> Auto</font><font color="#E5E5E5"> runs but</font>

1082
00:37:33,750 --> 00:37:37,050
again you're gonna be<font color="#E5E5E5"> limited</font><font color="#CCCCCC"> to root</font>

1083
00:37:35,160 --> 00:37:39,000
subscription so if<font color="#CCCCCC"> Mac graver as a</font>

1084
00:37:37,050 --> 00:37:41,520
contractor you've signed<font color="#E5E5E5"> up for pen test</font>

1085
00:37:39,000 --> 00:37:43,440
yeah he's gonna screw you here<font color="#CCCCCC"> W my</font>

1086
00:37:41,520 --> 00:37:45,060
<font color="#E5E5E5">Explorer will show you all the W my</font>

1087
00:37:43,440 --> 00:37:46,830
stuff but it's way too<font color="#E5E5E5"> complicated but</font>

1088
00:37:45,060 --> 00:37:47,730
<font color="#E5E5E5">you can query every</font><font color="#CCCCCC"> damn thing in the W</font>

1089
00:37:46,830 --> 00:37:49,130
mine but it's huge

1090
00:37:47,730 --> 00:37:51,390
I'm over<font color="#E5E5E5"> talking list this long</font>

1091
00:37:49,130 --> 00:37:52,650
<font color="#E5E5E5">namespaces and subscriptions and whatnot</font>

1092
00:37:51,390 --> 00:37:54,359
it's it's there's a lot<font color="#CCCCCC"> of stuff in</font>

1093
00:37:52,650 --> 00:37:55,980
there<font color="#E5E5E5"> and</font><font color="#CCCCCC"> a server</font><font color="#E5E5E5"> it will</font><font color="#CCCCCC"> be</font><font color="#E5E5E5"> even</font><font color="#CCCCCC"> more</font>

1094
00:37:54,360 --> 00:37:58,740
complicated<font color="#E5E5E5"> with all the hardware from</font>

1095
00:37:55,980 --> 00:38:00,240
<font color="#E5E5E5">storage and whatnot</font><font color="#CCCCCC"> wbm test is a</font>

1096
00:37:58,740 --> 00:38:01,410
<font color="#E5E5E5">diagnostic tool that's built in the box</font>

1097
00:38:00,240 --> 00:38:03,359
so you<font color="#E5E5E5"> can actually play with some</font>

1098
00:38:01,410 --> 00:38:06,810
commands<font color="#E5E5E5"> and whatnot there and you got w</font>

1099
00:38:03,360 --> 00:38:08,400
<font color="#CCCCCC">w make as well so again i'm gonna</font><font color="#E5E5E5"> give</font>

1100
00:38:06,810 --> 00:38:10,500
<font color="#E5E5E5">you the commands</font><font color="#CCCCCC"> i'm you</font><font color="#E5E5E5"> know yeah</font>

1101
00:38:08,400 --> 00:38:12,750
please try<font color="#CCCCCC"> logging d but here's the</font>

1102
00:38:10,500 --> 00:38:14,490
commands to<font color="#E5E5E5"> actually query</font><font color="#CCCCCC"> the command</font>

1103
00:38:12,750 --> 00:38:15,960
line<font color="#E5E5E5"> to see what's in these various</font>

1104
00:38:14,490 --> 00:38:17,819
<font color="#E5E5E5">namespaces so you just have to change</font>

1105
00:38:15,960 --> 00:38:19,170
<font color="#E5E5E5">the name</font><font color="#CCCCCC"> so the appropriate</font><font color="#E5E5E5"> consumers</font>

1106
00:38:17,820 --> 00:38:21,480
and<font color="#E5E5E5"> whatnot</font><font color="#CCCCCC"> and you</font><font color="#E5E5E5"> can actually get</font><font color="#CCCCCC"> a</font>

1107
00:38:19,170 --> 00:38:23,430
dump<font color="#E5E5E5"> of what's out there</font><font color="#CCCCCC"> and again be</font>

1108
00:38:21,480 --> 00:38:24,870
sure<font color="#E5E5E5"> to</font><font color="#CCCCCC"> watch Matt stalk here so you can</font>

1109
00:38:23,430 --> 00:38:26,339
understand what he's<font color="#E5E5E5"> talking about and</font>

1110
00:38:24,870 --> 00:38:28,020
<font color="#E5E5E5">understand all the</font><font color="#CCCCCC"> things you might have</font>

1111
00:38:26,340 --> 00:38:29,580
<font color="#CCCCCC">to change with these queries so yes you</font>

1112
00:38:28,020 --> 00:38:30,690
<font color="#E5E5E5">can make a</font><font color="#CCCCCC"> big-ass</font><font color="#E5E5E5"> script and you kinda</font>

1113
00:38:29,580 --> 00:38:32,850
are<font color="#E5E5E5"> replicating</font><font color="#CCCCCC"> what we're doing with</font>

1114
00:38:30,690 --> 00:38:34,020
<font color="#CCCCCC">log</font><font color="#E5E5E5"> gonna be and again use allow them to</font>

1115
00:38:32,850 --> 00:38:36,720
<font color="#E5E5E5">you to do this it's a lot faster</font><font color="#CCCCCC"> and</font>

1116
00:38:34,020 --> 00:38:38,730
<font color="#E5E5E5">easier dummy</font><font color="#CCCCCC"> M I</font><font color="#E5E5E5"> see so here's an</font>

1117
00:38:36,720 --> 00:38:40,230
<font color="#CCCCCC">example of where wmic would be used and</font>

1118
00:38:38,730 --> 00:38:41,880
I mentioned earlier<font color="#CCCCCC"> that there</font><font color="#E5E5E5"> was a dot</font>

1119
00:38:40,230 --> 00:38:43,380
link malware<font color="#E5E5E5"> that came out if you're not</font>

1120
00:38:41,880 --> 00:38:45,450
<font color="#E5E5E5">blocking dot link at the email gateway</font>

1121
00:38:43,380 --> 00:38:47,340
it really should and then it just uses

1122
00:38:45,450 --> 00:38:48,419
wmic to use one of<font color="#E5E5E5"> the parameters that</font>

1123
00:38:47,340 --> 00:38:49,770
go out<font color="#E5E5E5"> and fetch the stuff from the</font>

1124
00:38:48,420 --> 00:38:51,870
<font color="#E5E5E5">internet</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> bring down and infect the</font>

1125
00:38:49,770 --> 00:38:53,790
<font color="#CCCCCC">machine this</font><font color="#E5E5E5"> is just a query so it's</font>

1126
00:38:51,870 --> 00:38:55,470
those things<font color="#E5E5E5"> I just</font><font color="#CCCCCC"> showed you</font><font color="#E5E5E5"> how being</font>

1127
00:38:53,790 --> 00:38:57,330
executed and again this isn't malicious

1128
00:38:55,470 --> 00:38:59,490
<font color="#CCCCCC">it's just an example of what presses</font>

1129
00:38:57,330 --> 00:39:01,140
<font color="#CCCCCC">command-line gives you all the</font><font color="#E5E5E5"> details</font>

1130
00:38:59,490 --> 00:39:02,700
<font color="#CCCCCC">not if you don't</font><font color="#E5E5E5"> use process</font>

1131
00:39:01,140 --> 00:39:04,020
<font color="#E5E5E5">command-line just do process execution</font>

1132
00:39:02,700 --> 00:39:06,180
you get<font color="#CCCCCC"> double you make dot exe and</font>

1133
00:39:04,020 --> 00:39:07,320
that's it right you<font color="#E5E5E5"> get what's on the</font>

1134
00:39:06,180 --> 00:39:08,850
right but<font color="#CCCCCC"> you won't see what's on the</font>

1135
00:39:07,320 --> 00:39:11,310
<font color="#E5E5E5">left what you need is what's on</font><font color="#CCCCCC"> the Left</font>

1136
00:39:08,850 --> 00:39:13,740
<font color="#CCCCCC">context</font><font color="#E5E5E5"> is king here you really under</font>

1137
00:39:11,310 --> 00:39:15,390
need to understand the context<font color="#E5E5E5"> so mother</font>

1138
00:39:13,740 --> 00:39:17,339
<font color="#CCCCCC">W</font><font color="#E5E5E5"> my tools again if you want to get a</font>

1139
00:39:15,390 --> 00:39:18,810
copy<font color="#CCCCCC"> of the payload</font><font color="#E5E5E5"> here's an example</font><font color="#CCCCCC"> of</font>

1140
00:39:17,340 --> 00:39:21,210
<font color="#E5E5E5">how to</font><font color="#CCCCCC"> harvest it so you can see what's</font>

1141
00:39:18,810 --> 00:39:23,370
in there<font color="#E5E5E5"> if you come across a big base64</font>

1142
00:39:21,210 --> 00:39:24,900
blob<font color="#E5E5E5"> or a big</font><font color="#CCCCCC"> PowerShell blob you got</font>

1143
00:39:23,370 --> 00:39:26,339
some homework<font color="#E5E5E5"> to do</font><font color="#CCCCCC"> alright</font><font color="#E5E5E5"> so you might</font>

1144
00:39:24,900 --> 00:39:27,990
want to<font color="#E5E5E5"> get a copy of it</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> decode it</font>

1145
00:39:26,340 --> 00:39:28,800
<font color="#CCCCCC">and do that</font><font color="#E5E5E5"> sort of stuff</font><font color="#CCCCCC"> here's an</font>

1146
00:39:27,990 --> 00:39:30,870
<font color="#E5E5E5">example</font><font color="#CCCCCC"> right here</font>

1147
00:39:28,800 --> 00:39:33,000
<font color="#CCCCCC">a</font><font color="#E5E5E5"> decoded payload and</font><font color="#CCCCCC"> W mice namespace</font>

1148
00:39:30,870 --> 00:39:34,200
<font color="#E5E5E5">that I got from somebody's report</font><font color="#CCCCCC"> so</font>

1149
00:39:33,000 --> 00:39:36,960
yeah it's actually<font color="#E5E5E5"> down at the bottom</font>

1150
00:39:34,200 --> 00:39:37,319
crypto mining<font color="#CCCCCC"> Mauer</font><font color="#E5E5E5"> using</font><font color="#CCCCCC"> WMI so there</font>

1151
00:39:36,960 --> 00:39:40,350
you go

1152
00:39:37,320 --> 00:39:42,690
hiding base64 in the WMI database this

1153
00:39:40,350 --> 00:39:45,299
<font color="#E5E5E5">is not good</font><font color="#CCCCCC"> so all you have to</font><font color="#E5E5E5"> do is all</font>

1154
00:39:42,690 --> 00:39:46,560
I have to do is see<font color="#CCCCCC"> that go</font><font color="#E5E5E5"> oh okay you</font>

1155
00:39:45,300 --> 00:39:48,060
<font color="#E5E5E5">guys might have to do more</font><font color="#CCCCCC"> research</font><font color="#E5E5E5"> but</font>

1156
00:39:46,560 --> 00:39:49,560
I can<font color="#E5E5E5"> tell you right there oh you should</font>

1157
00:39:48,060 --> 00:39:51,840
<font color="#CCCCCC">never see that</font><font color="#E5E5E5"> in the W mind database</font>

1158
00:39:49,560 --> 00:39:53,790
<font color="#CCCCCC">and again the 4104</font><font color="#E5E5E5"> when</font><font color="#CCCCCC"> PowerShell</font>

1159
00:39:51,840 --> 00:39:56,310
executes this will decode<font color="#E5E5E5"> that for you</font>

1160
00:39:53,790 --> 00:39:58,080
<font color="#E5E5E5">if indeed it it actually ran in the box</font>

1161
00:39:56,310 --> 00:40:00,930
and you<font color="#CCCCCC"> can I give you a link to go to</font>

1162
00:39:58,080 --> 00:40:03,900
<font color="#CCCCCC">decoder if you harvest</font><font color="#E5E5E5"> it so hunting for</font>

1163
00:40:00,930 --> 00:40:06,450
W my pwnage<font color="#E5E5E5"> autoruns so first thing</font>

1164
00:40:03,900 --> 00:40:08,490
logging to eat free as well as<font color="#CCCCCC"> pro will</font>

1165
00:40:06,450 --> 00:40:10,140
let you dump<font color="#E5E5E5"> all the auto runs the pro</font>

1166
00:40:08,490 --> 00:40:11,910
<font color="#CCCCCC">version has a bunch of master digests</font>

1167
00:40:10,140 --> 00:40:13,500
exclusions<font color="#E5E5E5"> of all known</font><font color="#CCCCCC"> good hashes</font><font color="#E5E5E5"> and</font>

1168
00:40:11,910 --> 00:40:15,180
a whitelist to get rid of<font color="#E5E5E5"> all the</font>

1169
00:40:13,500 --> 00:40:16,410
parameter items<font color="#E5E5E5"> that you trust so you</font>

1170
00:40:15,180 --> 00:40:18,240
can very easily hunt your entire

1171
00:40:16,410 --> 00:40:20,250
environment<font color="#E5E5E5"> with just looking</font><font color="#CCCCCC"> at the</font>

1172
00:40:18,240 --> 00:40:21,779
auto runs that do all the WMI<font color="#E5E5E5"> querying</font>

1173
00:40:20,250 --> 00:40:23,220
<font color="#E5E5E5">again</font><font color="#CCCCCC"> watch out</font><font color="#E5E5E5"> for those other</font>

1174
00:40:21,780 --> 00:40:25,140
namespaces so you could start with

1175
00:40:23,220 --> 00:40:26,669
<font color="#E5E5E5">sysinternals or whomever and then go</font>

1176
00:40:25,140 --> 00:40:28,890
through<font color="#CCCCCC"> it</font><font color="#E5E5E5"> and say</font><font color="#CCCCCC"> okay I know I don't</font>

1177
00:40:26,670 --> 00:40:30,030
<font color="#E5E5E5">have</font><font color="#CCCCCC"> any of that</font><font color="#E5E5E5"> it can see now I only</font>

1178
00:40:28,890 --> 00:40:32,250
have<font color="#E5E5E5"> to worry about what</font><font color="#CCCCCC"> mats</font><font color="#E5E5E5"> talk</font>

1179
00:40:30,030 --> 00:40:35,070
talked about and<font color="#E5E5E5"> again look for anything</font>

1180
00:40:32,250 --> 00:40:36,000
<font color="#CCCCCC">new</font><font color="#E5E5E5"> anything weird any</font><font color="#CCCCCC"> base 64</font><font color="#E5E5E5"> any blobs</font>

1181
00:40:35,070 --> 00:40:37,410
any<font color="#CCCCCC"> powershell</font>

1182
00:40:36,000 --> 00:40:39,780
look at all the scripts that<font color="#E5E5E5"> are already</font>

1183
00:40:37,410 --> 00:40:42,540
<font color="#E5E5E5">there</font><font color="#CCCCCC"> anybody's seen Kern VBS Tye VBS</font>

1184
00:40:39,780 --> 00:40:44,370
and there W<font color="#CCCCCC"> mine I put what if I added</font>

1185
00:40:42,540 --> 00:40:46,259
the payload to<font color="#CCCCCC"> the end of</font><font color="#E5E5E5"> that script</font><font color="#CCCCCC"> I</font>

1186
00:40:44,370 --> 00:40:47,520
haven't changed<font color="#E5E5E5"> a W my database but I</font>

1187
00:40:46,260 --> 00:40:49,620
now<font color="#E5E5E5"> have persistence because when that</font>

1188
00:40:47,520 --> 00:40:51,090
script kicks off its added my bad food

1189
00:40:49,620 --> 00:40:53,220
to it so<font color="#E5E5E5"> now you got a hash all the</font>

1190
00:40:51,090 --> 00:40:54,990
scripts<font color="#E5E5E5"> you see in your W my database</font>

1191
00:40:53,220 --> 00:40:56,939
<font color="#E5E5E5">and do a compare against them to see</font><font color="#CCCCCC"> if</font>

1192
00:40:54,990 --> 00:40:59,640
they've been<font color="#E5E5E5"> modified</font><font color="#CCCCCC"> okay</font><font color="#E5E5E5"> so that's</font>

1193
00:40:56,940 --> 00:41:01,290
another tip for those existing and<font color="#E5E5E5"> Devon</font>

1194
00:40:59,640 --> 00:41:03,509
<font color="#E5E5E5">ker confirmed that he sees a lot of this</font>

1195
00:41:01,290 --> 00:41:04,950
in<font color="#E5E5E5"> the</font><font color="#CCCCCC"> field so watch out for</font><font color="#E5E5E5"> those</font>

1196
00:41:03,510 --> 00:41:08,070
<font color="#E5E5E5">already existing entries that are</font>

1197
00:41:04,950 --> 00:41:10,259
<font color="#E5E5E5">modified from the script watch for the</font>

1198
00:41:08,070 --> 00:41:12,510
46<font color="#E5E5E5"> 88 you can</font><font color="#CCCCCC"> actually in</font><font color="#E5E5E5"> sim</font><font color="#CCCCCC"> or log</font>

1199
00:41:10,260 --> 00:41:14,970
management<font color="#E5E5E5"> go search for 46</font><font color="#CCCCCC"> 88 so you</font>

1200
00:41:12,510 --> 00:41:16,670
see any occurrence<font color="#E5E5E5"> of the thing</font><font color="#CCCCCC"> WMI</font><font color="#E5E5E5"> and</font>

1201
00:41:14,970 --> 00:41:19,319
my sands<font color="#CCCCCC"> talk I talk about the</font><font color="#E5E5E5"> three C's</font>

1202
00:41:16,670 --> 00:41:21,510
completeness<font color="#E5E5E5"> coverage and configuration</font>

1203
00:41:19,320 --> 00:41:24,360
so completeness is do I<font color="#E5E5E5"> have this turned</font>

1204
00:41:21,510 --> 00:41:25,800
<font color="#E5E5E5">on everywhere</font><font color="#CCCCCC"> configuration is did I</font>

1205
00:41:24,360 --> 00:41:29,610
turn<font color="#CCCCCC"> on all the logging</font><font color="#E5E5E5"> Michael said</font>

1206
00:41:25,800 --> 00:41:31,080
right and<font color="#E5E5E5"> a coverage is is actually</font><font color="#CCCCCC"> the</font>

1207
00:41:29,610 --> 00:41:32,700
agent collecting running<font color="#E5E5E5"> and doing the</font>

1208
00:41:31,080 --> 00:41:34,650
right things<font color="#E5E5E5"> and ending up where I</font><font color="#CCCCCC"> want</font>

1209
00:41:32,700 --> 00:41:36,390
<font color="#CCCCCC">it</font><font color="#E5E5E5"> to end</font><font color="#CCCCCC"> up</font><font color="#E5E5E5"> like</font><font color="#CCCCCC"> a sim</font><font color="#E5E5E5"> so you have to</font>

1210
00:41:34,650 --> 00:41:37,920
take<font color="#E5E5E5"> that into account and because again</font>

1211
00:41:36,390 --> 00:41:39,299
if<font color="#E5E5E5"> you don't you missed that one box</font>

1212
00:41:37,920 --> 00:41:41,520
that's infected because<font color="#E5E5E5"> they turned off</font>

1213
00:41:39,300 --> 00:41:42,990
your<font color="#E5E5E5"> sim agent your spunk</font><font color="#CCCCCC"> Universal</font>

1214
00:41:41,520 --> 00:41:45,809
<font color="#E5E5E5">order or</font>

1215
00:41:42,990 --> 00:41:47,308
<font color="#CCCCCC">when log beat or an</font><font color="#E5E5E5"> X log then your</font>

1216
00:41:45,809 --> 00:41:49,140
coverage is bad you're missing<font color="#CCCCCC"> something</font>

1217
00:41:47,309 --> 00:41:50,520
<font color="#CCCCCC">it's all configured correctly but it's</font>

1218
00:41:49,140 --> 00:41:52,650
not<font color="#E5E5E5"> sending upstream so you got to look</font>

1219
00:41:50,520 --> 00:41:54,390
<font color="#E5E5E5">for that condition as a part of this and</font>

1220
00:41:52,650 --> 00:41:56,280
watch for<font color="#E5E5E5"> those 46 88 education</font>

1221
00:41:54,390 --> 00:41:58,410
executions they are key<font color="#E5E5E5"> in regards to</font>

1222
00:41:56,280 --> 00:42:01,290
catching some of<font color="#CCCCCC"> this activity check</font>

1223
00:41:58,410 --> 00:42:02,940
<font color="#E5E5E5">your power show logs for base64 base64</font>

1224
00:42:01,290 --> 00:42:06,119
is not used that often<font color="#E5E5E5"> I've seen some</font>

1225
00:42:02,940 --> 00:42:08,760
and<font color="#E5E5E5"> some sequel server more for or doing</font>

1226
00:42:06,119 --> 00:42:10,530
some settings into the registry<font color="#CCCCCC"> but</font><font color="#E5E5E5"> this</font>

1227
00:42:08,760 --> 00:42:11,700
is not a normal<font color="#E5E5E5"> behavior and even</font><font color="#CCCCCC"> though</font>

1228
00:42:10,530 --> 00:42:14,540
it's available<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> not normal behavior</font>

1229
00:42:11,700 --> 00:42:14,540
<font color="#E5E5E5">for the most part</font>

1230
00:42:15,710 --> 00:42:22,200
check your<font color="#CCCCCC"> auth logs</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> 4624 for these</font>

1231
00:42:18,960 --> 00:42:24,270
odd<font color="#CCCCCC"> WMI logins again exclude that you do</font>

1232
00:42:22,200 --> 00:42:25,558
not have them and then<font color="#E5E5E5"> you know</font><font color="#CCCCCC"> yet well</font>

1233
00:42:24,270 --> 00:42:26,970
I<font color="#E5E5E5"> don't have those double logins like</font>

1234
00:42:25,559 --> 00:42:29,190
you talked about<font color="#E5E5E5"> in my</font><font color="#CCCCCC"> wind 10 boxes</font>

1235
00:42:26,970 --> 00:42:30,689
<font color="#E5E5E5">okay I can check that</font><font color="#CCCCCC"> off</font><font color="#E5E5E5"> I don't have</font>

1236
00:42:29,190 --> 00:42:32,790
that<font color="#E5E5E5"> right you're constantly trying to</font>

1237
00:42:30,690 --> 00:42:34,440
eliminate<font color="#E5E5E5"> things because you're not</font>

1238
00:42:32,790 --> 00:42:35,759
<font color="#E5E5E5">really looking for it</font>

1239
00:42:34,440 --> 00:42:37,710
<font color="#CCCCCC">you</font><font color="#E5E5E5"> can say</font><font color="#CCCCCC"> oh</font><font color="#E5E5E5"> I've been hunting for</font>

1240
00:42:35,760 --> 00:42:39,630
<font color="#E5E5E5">months well you didn't find anything</font><font color="#CCCCCC"> no</font>

1241
00:42:37,710 --> 00:42:40,859
<font color="#E5E5E5">but I know for sure I don't have this I</font>

1242
00:42:39,630 --> 00:42:42,089
<font color="#E5E5E5">don't have this I don't</font><font color="#CCCCCC"> have this I</font>

1243
00:42:40,859 --> 00:42:44,308
<font color="#E5E5E5">don't have this and here's reports of</font>

1244
00:42:42,089 --> 00:42:45,750
where all that<font color="#E5E5E5"> got used that's a better</font>

1245
00:42:44,309 --> 00:42:46,710
answer<font color="#E5E5E5"> then yeah you're right I didn't</font>

1246
00:42:45,750 --> 00:42:47,910
find<font color="#E5E5E5"> anything and I've been doing</font><font color="#CCCCCC"> this</font>

1247
00:42:46,710 --> 00:42:49,470
for<font color="#E5E5E5"> 3</font><font color="#CCCCCC"> months what am I paying you for</font>

1248
00:42:47,910 --> 00:42:50,879
<font color="#E5E5E5">well because I don't</font><font color="#CCCCCC"> know I know I don't</font>

1249
00:42:49,470 --> 00:42:52,669
<font color="#CCCCCC">have</font><font color="#E5E5E5"> this and right so it's a totally</font>

1250
00:42:50,880 --> 00:42:55,319
different argument<font color="#E5E5E5"> on how I look</font><font color="#CCCCCC"> at it</font>

1251
00:42:52,670 --> 00:42:57,270
look for those<font color="#CCCCCC"> W my logins and check the</font>

1252
00:42:55,319 --> 00:42:59,190
W my activity logs<font color="#E5E5E5"> right not a lot of</font>

1253
00:42:57,270 --> 00:43:00,780
<font color="#E5E5E5">noise</font><font color="#CCCCCC"> here not a</font><font color="#E5E5E5"> lot of W my being added</font>

1254
00:42:59,190 --> 00:43:03,599
to a system it's definitely powerful<font color="#E5E5E5"> for</font>

1255
00:43:00,780 --> 00:43:05,849
you so some recommendations<font color="#E5E5E5"> hunt</font>

1256
00:43:03,599 --> 00:43:07,980
please<font color="#E5E5E5"> hunt eliminate what you know you</font>

1257
00:43:05,849 --> 00:43:09,900
don't have and that's<font color="#CCCCCC"> a</font><font color="#E5E5E5"> great place</font><font color="#CCCCCC"> to</font>

1258
00:43:07,980 --> 00:43:11,549
start<font color="#E5E5E5"> and then build your hypotheses</font>

1259
00:43:09,900 --> 00:43:13,530
<font color="#E5E5E5">based on that for what everybody else</font>

1260
00:43:11,549 --> 00:43:15,509
talks about I would agree after<font color="#E5E5E5"> that</font><font color="#CCCCCC"> map</font>

1261
00:43:13,530 --> 00:43:17,010
<font color="#CCCCCC">your capabilities to attack start doing</font>

1262
00:43:15,510 --> 00:43:18,930
this<font color="#E5E5E5"> you want to see an example come</font>

1263
00:43:17,010 --> 00:43:20,940
upstairs<font color="#E5E5E5"> will show you or cheat sheets</font>

1264
00:43:18,930 --> 00:43:22,649
and<font color="#E5E5E5"> how that that works the idea there</font>

1265
00:43:20,940 --> 00:43:24,390
is<font color="#E5E5E5"> you're not trying to</font><font color="#CCCCCC"> see how good you</font>

1266
00:43:22,650 --> 00:43:25,470
are<font color="#E5E5E5"> you're trying to see if you as your</font>

1267
00:43:24,390 --> 00:43:26,730
<font color="#E5E5E5">organization as you're trying to</font>

1268
00:43:25,470 --> 00:43:29,308
understand how<font color="#E5E5E5"> good you are at</font><font color="#CCCCCC"> this area</font>

1269
00:43:26,730 --> 00:43:31,440
<font color="#E5E5E5">or bad or non-existent you're just</font>

1270
00:43:29,309 --> 00:43:33,150
trying to<font color="#E5E5E5"> say can I see this item</font><font color="#CCCCCC"> no I</font>

1271
00:43:31,440 --> 00:43:35,099
need a tool<font color="#E5E5E5"> for this hey boss I have</font><font color="#CCCCCC"> to</font>

1272
00:43:33,150 --> 00:43:36,540
<font color="#E5E5E5">budget an item I found a tool and I need</font>

1273
00:43:35,099 --> 00:43:38,609
this much money so<font color="#CCCCCC"> I can cover these</font>

1274
00:43:36,540 --> 00:43:41,339
boxes that<font color="#E5E5E5"> are in red on the attack</font>

1275
00:43:38,609 --> 00:43:42,450
matrix I'm gonna do part of them<font color="#E5E5E5"> and so</font>

1276
00:43:41,339 --> 00:43:44,040
<font color="#E5E5E5">you can use that to</font><font color="#CCCCCC"> your advantage to</font>

1277
00:43:42,450 --> 00:43:45,990
<font color="#CCCCCC">help you kind</font><font color="#E5E5E5"> of justify some budget</font>

1278
00:43:44,040 --> 00:43:48,299
these are real techniques used<font color="#CCCCCC"> by</font>

1279
00:43:45,990 --> 00:43:50,669
hackers<font color="#E5E5E5"> of all these</font><font color="#CCCCCC"> apts</font><font color="#E5E5E5"> we never see</font>

1280
00:43:48,299 --> 00:43:52,980
<font color="#E5E5E5">apt I by the way commodity uses them too</font>

1281
00:43:50,670 --> 00:43:54,960
<font color="#E5E5E5">so argument goes both place for that</font><font color="#CCCCCC"> um</font>

1282
00:43:52,980 --> 00:43:56,220
please look at the<font color="#E5E5E5"> logging cheat sheets</font>

1283
00:43:54,960 --> 00:43:58,859
as<font color="#CCCCCC"> well there's too</font>

1284
00:43:56,220 --> 00:44:02,279
<font color="#CCCCCC">Maur Archaeology calm slash cheek -</font>

1285
00:43:58,859 --> 00:44:04,560
sheets recommendations<font color="#E5E5E5"> process man login</font>

1286
00:44:02,280 --> 00:44:06,660
46<font color="#E5E5E5"> 88 if I say it enough times you guys</font>

1287
00:44:04,560 --> 00:44:09,240
were<font color="#CCCCCC"> member it</font><font color="#E5E5E5"> pay attention</font><font color="#CCCCCC"> to parent</font>

1288
00:44:06,660 --> 00:44:13,140
<font color="#CCCCCC">child executions very important here</font><font color="#E5E5E5"> WMI</font>

1289
00:44:09,240 --> 00:44:15,509
PR<font color="#CCCCCC"> v SEO exe the parents of another</font>

1290
00:44:13,140 --> 00:44:17,549
binary<font color="#E5E5E5"> that's not a true known</font><font color="#CCCCCC"> mount</font>

1291
00:44:15,510 --> 00:44:19,590
<font color="#E5E5E5">management software piece of utility</font>

1292
00:44:17,550 --> 00:44:22,560
<font color="#E5E5E5">yeah you are gonna have some</font>

1293
00:44:19,590 --> 00:44:23,940
investigation to do<font color="#E5E5E5"> monitor</font><font color="#CCCCCC"> these dual</font>

1294
00:44:22,560 --> 00:44:27,029
authentications that<font color="#E5E5E5"> I talked about</font>

1295
00:44:23,940 --> 00:44:29,580
<font color="#E5E5E5">right where</font><font color="#CCCCCC"> WMI is the launcher</font><font color="#E5E5E5"> of that</font>

1296
00:44:27,030 --> 00:44:31,020
because the process<font color="#E5E5E5"> that called the</font>

1297
00:44:29,580 --> 00:44:33,000
authentication<font color="#CCCCCC"> is in there else ass</font>

1298
00:44:31,020 --> 00:44:34,230
whatever<font color="#CCCCCC"> but if you see W my doing it</font>

1299
00:44:33,000 --> 00:44:36,650
you<font color="#E5E5E5"> might</font><font color="#CCCCCC"> want to investigate</font><font color="#E5E5E5"> those as</font>

1300
00:44:34,230 --> 00:44:38,820
well monitor the<font color="#CCCCCC"> windows firewall</font>

1301
00:44:36,650 --> 00:44:40,830
<font color="#E5E5E5">connections or whatever however you get</font>

1302
00:44:38,820 --> 00:44:43,410
that firewall information on the hosts

1303
00:44:40,830 --> 00:44:44,970
<font color="#E5E5E5">to look for</font><font color="#CCCCCC"> lateral movement right the</font>

1304
00:44:43,410 --> 00:44:46,470
pentesters get on one box either<font color="#E5E5E5"> through</font>

1305
00:44:44,970 --> 00:44:48,419
a fish or whatever<font color="#E5E5E5"> and then they're</font>

1306
00:44:46,470 --> 00:44:50,399
gonna<font color="#E5E5E5"> go</font><font color="#CCCCCC"> east-west</font><font color="#E5E5E5"> and that's how you're</font>

1307
00:44:48,420 --> 00:44:52,320
gonna get nailed<font color="#E5E5E5"> in</font><font color="#CCCCCC"> big-time</font><font color="#E5E5E5"> right the</font>

1308
00:44:50,400 --> 00:44:54,359
<font color="#E5E5E5">win</font><font color="#CCCCCC"> nti group got into somebody who</font>

1309
00:44:52,320 --> 00:44:55,830
clicked on a word doc<font color="#E5E5E5"> and then once I</font>

1310
00:44:54,359 --> 00:44:57,240
get<font color="#CCCCCC"> on that box I jump to another one</font>

1311
00:44:55,830 --> 00:44:59,670
they got the creds and<font color="#E5E5E5"> they went east</font>

1312
00:44:57,240 --> 00:45:00,930
west from patient one patient zero they

1313
00:44:59,670 --> 00:45:03,210
never did<font color="#E5E5E5"> anything other than</font><font color="#CCCCCC"> initially</font>

1314
00:45:00,930 --> 00:45:05,160
<font color="#E5E5E5">effect so you definitely</font><font color="#CCCCCC"> have to</font><font color="#E5E5E5"> start</font>

1315
00:45:03,210 --> 00:45:07,260
looking<font color="#CCCCCC"> for lateral movement because WMI</font>

1316
00:45:05,160 --> 00:45:10,109
gives them the power<font color="#E5E5E5"> of query and remote</font>

1317
00:45:07,260 --> 00:45:11,790
executions<font color="#E5E5E5"> very quietly so</font><font color="#CCCCCC"> east-west</font>

1318
00:45:10,109 --> 00:45:14,848
lateral movement is a big component here

1319
00:45:11,790 --> 00:45:16,140
<font color="#E5E5E5">monitor the windows</font><font color="#CCCCCC"> remote so win RM if</font>

1320
00:45:14,849 --> 00:45:18,660
you're not using<font color="#E5E5E5"> it how many</font><font color="#CCCCCC"> people here</font>

1321
00:45:16,140 --> 00:45:21,690
are using<font color="#CCCCCC"> winner m is it</font><font color="#E5E5E5"> heavily used to</font>

1322
00:45:18,660 --> 00:45:23,640
air enough hand so if you do use it

1323
00:45:21,690 --> 00:45:25,109
<font color="#E5E5E5">watch it and figure out what's normal</font>

1324
00:45:23,640 --> 00:45:27,629
and<font color="#CCCCCC"> Splunk you can say oh yeah</font><font color="#E5E5E5"> that's</font>

1325
00:45:25,109 --> 00:45:29,250
that's this<font color="#CCCCCC"> konso stuff not that this is</font>

1326
00:45:27,630 --> 00:45:31,109
yep not that and get it down<font color="#E5E5E5"> to</font><font color="#CCCCCC"> zero</font><font color="#E5E5E5"> and</font>

1327
00:45:29,250 --> 00:45:32,700
<font color="#E5E5E5">then</font><font color="#CCCCCC"> when somebody</font><font color="#E5E5E5"> bad like</font><font color="#CCCCCC"> Menten gets</font>

1328
00:45:31,109 --> 00:45:33,960
on<font color="#E5E5E5"> your box</font><font color="#CCCCCC"> home</font><font color="#E5E5E5"> on a win RM or title</font>

1329
00:45:32,700 --> 00:45:35,549
gets<font color="#E5E5E5"> in a box</font><font color="#CCCCCC"> i'm</font><font color="#E5E5E5"> gonna win RM boom</font>

1330
00:45:33,960 --> 00:45:37,700
you'll catch them<font color="#CCCCCC"> all</font><font color="#E5E5E5"> right that's the</font>

1331
00:45:35,550 --> 00:45:40,530
idea behind filtering out<font color="#E5E5E5"> the known good</font>

1332
00:45:37,700 --> 00:45:43,919
and again windows remote<font color="#E5E5E5"> management</font><font color="#CCCCCC"> /</font>

1333
00:45:40,530 --> 00:45:46,200
operational logs it's a long one please

1334
00:45:43,920 --> 00:45:48,030
<font color="#CCCCCC">upgrade to powershell v my talk from</font>

1335
00:45:46,200 --> 00:45:49,830
show me<font color="#E5E5E5"> con would be a good place to</font>

1336
00:45:48,030 --> 00:45:52,470
start<font color="#E5E5E5"> you understand why</font>

1337
00:45:49,830 --> 00:45:54,060
monitor powershell executions<font color="#E5E5E5"> generally</font>

1338
00:45:52,470 --> 00:45:56,009
there<font color="#CCCCCC"> is now more</font><font color="#E5E5E5"> and more PowerShell if</font>

1339
00:45:54,060 --> 00:45:57,650
you have bamboo puppet chef whatever a

1340
00:45:56,010 --> 00:45:59,849
lot of power shell being used<font color="#CCCCCC"> their</font>

1341
00:45:57,650 --> 00:46:02,609
<font color="#E5E5E5">management utilities are using more</font><font color="#CCCCCC"> and</font>

1342
00:45:59,849 --> 00:46:03,990
<font color="#CCCCCC">more</font><font color="#E5E5E5"> of it Dropbox uses it to update so</font>

1343
00:46:02,609 --> 00:46:05,609
<font color="#E5E5E5">you will have some</font><font color="#CCCCCC"> normal stuff but you</font>

1344
00:46:03,990 --> 00:46:08,160
<font color="#E5E5E5">can take strings out of those blocks</font>

1345
00:46:05,609 --> 00:46:09,808
<font color="#E5E5E5">script</font><font color="#CCCCCC"> blocks</font><font color="#E5E5E5"> and say yeah not that</font><font color="#CCCCCC"> yeah</font>

1346
00:46:08,160 --> 00:46:11,670
not that yeah not that to get

1347
00:46:09,809 --> 00:46:14,099
the noise so that<font color="#E5E5E5"> you can quiet down the</font>

1348
00:46:11,670 --> 00:46:16,739
results and eliminate<font color="#E5E5E5"> that you do not</font>

1349
00:46:14,099 --> 00:46:18,059
have any<font color="#E5E5E5"> base64 if you do then make sure</font>

1350
00:46:16,739 --> 00:46:20,069
<font color="#E5E5E5">you know what the heck</font><font color="#CCCCCC"> is executing and</font>

1351
00:46:18,059 --> 00:46:23,789
why and<font color="#E5E5E5"> then ask the vendor why are you</font>

1352
00:46:20,069 --> 00:46:26,099
using base64<font color="#CCCCCC"> to get by av I mean there</font>

1353
00:46:23,789 --> 00:46:28,559
may be a reason<font color="#CCCCCC"> size of</font><font color="#E5E5E5"> script blocks</font>

1354
00:46:26,099 --> 00:46:30,479
<font color="#E5E5E5">big a script blocks</font><font color="#CCCCCC"> not</font><font color="#E5E5E5"> necessarily</font><font color="#CCCCCC"> good</font>

1355
00:46:28,559 --> 00:46:33,420
<font color="#CCCCCC">thing so the size of script lock is a</font>

1356
00:46:30,479 --> 00:46:35,640
clue<font color="#CCCCCC"> but not uncommon so this is a noisy</font>

1357
00:46:33,420 --> 00:46:37,439
item but it is<font color="#CCCCCC"> combined with the other</font>

1358
00:46:35,640 --> 00:46:39,239
<font color="#E5E5E5">items definitely helps tell you</font>

1359
00:46:37,439 --> 00:46:41,670
something's bad<font color="#E5E5E5"> and obvious</font><font color="#CCCCCC"> keishon</font>

1360
00:46:39,239 --> 00:46:43,109
characters<font color="#E5E5E5"> count them</font><font color="#CCCCCC"> okay once you</font>

1361
00:46:41,670 --> 00:46:44,670
start<font color="#CCCCCC"> counting the normal ones you're</font>

1362
00:46:43,109 --> 00:46:47,788
gonna see what I mean here the pattern

1363
00:46:44,670 --> 00:46:50,069
<font color="#CCCCCC">is 20 25</font><font color="#E5E5E5"> 30 and most of my boxes</font><font color="#CCCCCC"> on my</font>

1364
00:46:47,789 --> 00:46:51,059
<font color="#E5E5E5">labs are set at 20 so I get over 20 and</font>

1365
00:46:50,069 --> 00:46:52,949
occasionally I<font color="#E5E5E5"> get a bunch of dollar</font>

1366
00:46:51,059 --> 00:46:54,599
<font color="#CCCCCC">signs</font><font color="#E5E5E5"> but when there's some off you</font>

1367
00:46:52,949 --> 00:46:55,890
<font color="#E5E5E5">station going on it's in the hundreds</font>

1368
00:46:54,599 --> 00:46:57,229
hundred<font color="#CCCCCC"> thirty-five</font><font color="#E5E5E5"> hundred</font><font color="#CCCCCC"> thirty-eight</font>

1369
00:46:55,890 --> 00:47:00,029
like I showed<font color="#CCCCCC"> you</font><font color="#E5E5E5"> in one of the examples</font>

1370
00:46:57,229 --> 00:47:01,859
<font color="#CCCCCC">and again suspicious words which easily</font>

1371
00:47:00,029 --> 00:47:02,549
can be<font color="#E5E5E5"> broken unfortunately with</font>

1372
00:47:01,859 --> 00:47:05,219
obfuscation

1373
00:47:02,549 --> 00:47:06,689
but after<font color="#CCCCCC"> they're decoded a lot of times</font>

1374
00:47:05,219 --> 00:47:08,459
these words will then show<font color="#E5E5E5"> up</font><font color="#CCCCCC"> in one of</font>

1375
00:47:06,689 --> 00:47:12,989
the other event<font color="#E5E5E5"> IDs right there's a</font><font color="#CCCCCC"> 200</font>

1376
00:47:08,459 --> 00:47:16,649
<font color="#CCCCCC">400</font><font color="#E5E5E5"> a 500 501 a 600 and 800 a</font><font color="#CCCCCC"> 4100 of</font>

1377
00:47:12,989 --> 00:47:18,509
4104 4103<font color="#E5E5E5"> don't do 4105</font><font color="#CCCCCC"> m41 6 please</font>

1378
00:47:16,650 --> 00:47:19,619
turn that off the bad guys<font color="#CCCCCC"> will rotate</font>

1379
00:47:18,509 --> 00:47:22,229
your logs you'll never see anybody

1380
00:47:19,619 --> 00:47:24,029
<font color="#E5E5E5">there's nine of</font><font color="#CCCCCC"> n IDs so</font><font color="#E5E5E5"> that's a lot of</font>

1381
00:47:22,229 --> 00:47:25,769
<font color="#E5E5E5">data here</font><font color="#CCCCCC"> so one of</font><font color="#E5E5E5"> those will</font><font color="#CCCCCC"> probably</font>

1382
00:47:24,029 --> 00:47:27,449
catch these<font color="#CCCCCC"> buzz words</font><font color="#E5E5E5"> and yes they are</font>

1383
00:47:25,769 --> 00:47:28,948
<font color="#CCCCCC">case-sensitive so</font><font color="#E5E5E5"> please upper case</font>

1384
00:47:27,449 --> 00:47:33,420
lower this look for<font color="#E5E5E5"> that especially</font><font color="#CCCCCC"> in</font>

1385
00:47:28,949 --> 00:47:35,519
your your<font color="#CCCCCC"> Sims hunt for</font><font color="#E5E5E5"> W my persistence</font>

1386
00:47:33,420 --> 00:47:37,739
eliminate<font color="#E5E5E5"> that you don't have it be</font>

1387
00:47:35,519 --> 00:47:39,649
confident<font color="#CCCCCC"> that you don't have it hunt</font>

1388
00:47:37,739 --> 00:47:42,569
for<font color="#E5E5E5"> large payloads in the registry</font>

1389
00:47:39,650 --> 00:47:45,809
<font color="#CCCCCC">registry</font><font color="#E5E5E5"> payloads get involved here if I</font>

1390
00:47:42,569 --> 00:47:49,170
want to hide my<font color="#E5E5E5"> binary and not take all</font>

1391
00:47:45,809 --> 00:47:50,729
this file<font color="#E5E5E5"> as now or but</font><font color="#CCCCCC"> okay</font><font color="#E5E5E5"> let's get</font>

1392
00:47:49,170 --> 00:47:51,779
<font color="#E5E5E5">over the file a some our stuff but don't</font>

1393
00:47:50,729 --> 00:47:53,848
take<font color="#E5E5E5"> their binary that they initially</font>

1394
00:47:51,779 --> 00:47:55,349
<font color="#CCCCCC">executed on the</font><font color="#E5E5E5"> disk and then</font><font color="#CCCCCC"> deleted so</font>

1395
00:47:53,849 --> 00:47:57,929
it's not<font color="#CCCCCC"> running right now put it in the</font>

1396
00:47:55,349 --> 00:48:00,479
<font color="#E5E5E5">registry makes a big entry and you</font><font color="#CCCCCC"> know</font>

1397
00:47:57,929 --> 00:48:01,769
we're talking 250 300<font color="#CCCCCC"> K so</font><font color="#E5E5E5"> if I go</font>

1398
00:48:00,479 --> 00:48:03,448
looking<font color="#E5E5E5"> for anything over</font><font color="#CCCCCC"> 20 K you're</font>

1399
00:48:01,769 --> 00:48:05,189
gonna see about<font color="#CCCCCC"> a dozen keys and you'll</font>

1400
00:48:03,449 --> 00:48:07,469
see another<font color="#E5E5E5"> dozen keys under the GUID's</font>

1401
00:48:05,189 --> 00:48:09,089
<font color="#CCCCCC">h key user scenario</font><font color="#E5E5E5"> because there's two</font>

1402
00:48:07,469 --> 00:48:11,670
entries right<font color="#CCCCCC"> HT current user H key</font>

1403
00:48:09,089 --> 00:48:13,109
users go ahead and eliminate<font color="#E5E5E5"> that you</font>

1404
00:48:11,670 --> 00:48:15,390
don't have any large<font color="#E5E5E5"> keys this is</font><font color="#CCCCCC"> where</font>

1405
00:48:13,109 --> 00:48:16,920
<font color="#CCCCCC">Cove tur and when</font><font color="#E5E5E5"> NT I played they</font>

1406
00:48:15,390 --> 00:48:18,660
dumped<font color="#E5E5E5"> all their scripts and all that</font>

1407
00:48:16,920 --> 00:48:20,459
was in<font color="#CCCCCC"> the registry</font><font color="#E5E5E5"> nothing on disk so</font>

1408
00:48:18,660 --> 00:48:23,160
if I did a full<font color="#E5E5E5"> file</font><font color="#CCCCCC"> hash compare I saw</font>

1409
00:48:20,459 --> 00:48:23,770
nothing until<font color="#CCCCCC"> I rebooted and did stuff</font>

1410
00:48:23,160 --> 00:48:26,500
and saw it

1411
00:48:23,770 --> 00:48:28,840
up and got audit entries<font color="#E5E5E5"> but I know</font>

1412
00:48:26,500 --> 00:48:32,680
where they<font color="#E5E5E5"> hit it</font><font color="#CCCCCC"> neither WMI or the</font>

1413
00:48:28,840 --> 00:48:34,390
registry<font color="#E5E5E5"> keys because</font><font color="#CCCCCC"> w mine</font><font color="#E5E5E5"> can call</font>

1414
00:48:32,680 --> 00:48:36,040
registry<font color="#CCCCCC"> to then load said</font><font color="#E5E5E5"> an hour</font>

1415
00:48:34,390 --> 00:48:37,779
<font color="#E5E5E5">because</font><font color="#CCCCCC"> they don't want the W my</font>

1416
00:48:36,040 --> 00:48:39,370
database<font color="#CCCCCC"> to be</font><font color="#E5E5E5"> do clogged</font><font color="#CCCCCC"> with their</font><font color="#E5E5E5"> bad</font>

1417
00:48:37,780 --> 00:48:42,340
<font color="#CCCCCC">poop</font><font color="#E5E5E5"> because</font><font color="#CCCCCC"> you might be</font><font color="#E5E5E5"> looking after</font>

1418
00:48:39,370 --> 00:48:44,830
<font color="#E5E5E5">the start you can also enable file and</font>

1419
00:48:42,340 --> 00:48:47,710
directory<font color="#E5E5E5"> auditing on</font><font color="#CCCCCC"> WBN to look for</font>

1420
00:48:44,830 --> 00:48:49,060
new entries 4663<font color="#E5E5E5"> file out of sitting</font>

1421
00:48:47,710 --> 00:48:50,890
logging<font color="#E5E5E5"> cheat sheet will help you out</font>

1422
00:48:49,060 --> 00:48:53,980
<font color="#E5E5E5">here and in the registry you can watch</font>

1423
00:48:50,890 --> 00:48:55,839
the<font color="#CCCCCC"> wbm key that actually will show you</font>

1424
00:48:53,980 --> 00:48:57,340
all<font color="#E5E5E5"> the new namespace subscription</font>

1425
00:48:55,840 --> 00:48:58,900
thingies<font color="#CCCCCC"> going</font><font color="#E5E5E5"> on that have been added</font>

1426
00:48:57,340 --> 00:49:00,100
to the system<font color="#E5E5E5"> and</font><font color="#CCCCCC"> you can catch those</font>

1427
00:48:58,900 --> 00:49:01,900
with a 46:57

1428
00:49:00,100 --> 00:49:04,029
if you turn on auditing<font color="#E5E5E5"> and you select</font>

1429
00:49:01,900 --> 00:49:06,280
this key and you say everyone new

1430
00:49:04,030 --> 00:49:08,020
created don't do<font color="#CCCCCC"> reads that'll just</font>

1431
00:49:06,280 --> 00:49:10,090
that's<font color="#E5E5E5"> like four to one and noise so</font>

1432
00:49:08,020 --> 00:49:12,090
just<font color="#CCCCCC"> don't</font><font color="#E5E5E5"> do that but that will</font><font color="#CCCCCC"> be a</font>

1433
00:49:10,090 --> 00:49:15,670
way you can also detect<font color="#E5E5E5"> these additions</font>

1434
00:49:12,090 --> 00:49:17,980
monitor<font color="#CCCCCC"> WM i may consider</font><font color="#E5E5E5"> a monitoring</font>

1435
00:49:15,670 --> 00:49:20,110
solution so you<font color="#CCCCCC"> can actually run a</font>

1436
00:49:17,980 --> 00:49:21,280
partial script to look for any additions

1437
00:49:20,110 --> 00:49:22,870
to<font color="#CCCCCC"> w my database</font>

1438
00:49:21,280 --> 00:49:23,920
there's<font color="#E5E5E5"> several projects out there</font><font color="#CCCCCC"> i</font>

1439
00:49:22,870 --> 00:49:26,020
thought<font color="#E5E5E5"> i'd mention</font><font color="#CCCCCC"> that because</font><font color="#E5E5E5"> it's</font>

1440
00:49:23,920 --> 00:49:27,580
kinda<font color="#CCCCCC"> interesting this is a report</font><font color="#E5E5E5"> w my</font>

1441
00:49:26,020 --> 00:49:28,509
<font color="#CCCCCC">versus w</font><font color="#E5E5E5"> mine for him i</font><font color="#CCCCCC"> think man</font><font color="#E5E5E5"> yet</font>

1442
00:49:27,580 --> 00:49:30,759
<font color="#E5E5E5">wrote it</font>

1443
00:49:28,510 --> 00:49:33,880
<font color="#E5E5E5">yes kind</font><font color="#CCCCCC"> shin concept right use W my to</font>

1444
00:49:30,760 --> 00:49:35,080
catch<font color="#E5E5E5"> W mine</font><font color="#CCCCCC"> but yeah so it's an option</font>

1445
00:49:33,880 --> 00:49:36,820
to you if you want to<font color="#E5E5E5"> do that if you're</font>

1446
00:49:35,080 --> 00:49:38,259
in that<font color="#E5E5E5"> boat that that might be</font><font color="#CCCCCC"> valuable</font>

1447
00:49:36,820 --> 00:49:39,640
to you<font color="#E5E5E5"> it is an option and</font><font color="#CCCCCC"> it can write</font>

1448
00:49:38,260 --> 00:49:42,970
an event ID and then boom you can

1449
00:49:39,640 --> 00:49:44,830
trigger<font color="#E5E5E5"> on that so a conclusion W my is</font>

1450
00:49:42,970 --> 00:49:46,870
dangerous it is not very noisy as you

1451
00:49:44,830 --> 00:49:48,730
saw that malware<font color="#CCCCCC"> eight deep is not like</font>

1452
00:49:46,870 --> 00:49:51,009
<font color="#E5E5E5">the</font><font color="#CCCCCC"> amount the WMI queries</font><font color="#E5E5E5"> that I saw</font>

1453
00:49:48,730 --> 00:49:52,660
all one-liners<font color="#E5E5E5"> okay you'll occasionally</font>

1454
00:49:51,010 --> 00:49:54,310
<font color="#E5E5E5">get</font><font color="#CCCCCC"> to depending what the</font><font color="#E5E5E5"> guy</font><font color="#CCCCCC"> did and</font>

1455
00:49:52,660 --> 00:49:55,960
after<font color="#CCCCCC"> I played with his research I</font>

1456
00:49:54,310 --> 00:49:57,910
<font color="#CCCCCC">realize if I do this each one at a time</font>

1457
00:49:55,960 --> 00:49:59,650
I'm only gonna have<font color="#CCCCCC"> one liners</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> guys</font>

1458
00:49:57,910 --> 00:50:01,000
bad<font color="#CCCCCC"> he'll</font><font color="#E5E5E5"> nest</font><font color="#CCCCCC"> this stuff together and</font>

1459
00:49:59,650 --> 00:50:02,770
<font color="#E5E5E5">you might get some</font><font color="#CCCCCC"> parent some</font>

1460
00:50:01,000 --> 00:50:04,900
parent-child relationship<font color="#E5E5E5"> maybe two or</font>

1461
00:50:02,770 --> 00:50:06,190
three<font color="#CCCCCC"> deeded max</font><font color="#E5E5E5"> but for the most part</font>

1462
00:50:04,900 --> 00:50:08,020
<font color="#CCCCCC">if they're good they will make them</font>

1463
00:50:06,190 --> 00:50:09,850
<font color="#CCCCCC">one-liner so you won't see it</font><font color="#E5E5E5"> and again</font>

1464
00:50:08,020 --> 00:50:11,590
it<font color="#E5E5E5"> uses</font><font color="#CCCCCC"> built-in right living</font><font color="#E5E5E5"> off the</font>

1465
00:50:09,850 --> 00:50:13,930
land<font color="#E5E5E5"> built in stuffed upon you and or</font>

1466
00:50:11,590 --> 00:50:15,790
expand so please<font color="#E5E5E5"> enable the logging I</font>

1467
00:50:13,930 --> 00:50:17,919
discussed here definitely<font color="#CCCCCC"> watch for this</font>

1468
00:50:15,790 --> 00:50:20,770
<font color="#E5E5E5">and go hunt and eliminate you do not</font>

1469
00:50:17,920 --> 00:50:22,360
have it some additional<font color="#CCCCCC"> reading put some</font>

1470
00:50:20,770 --> 00:50:24,880
<font color="#E5E5E5">resources in here this will be</font><font color="#CCCCCC"> posted on</font>

1471
00:50:22,360 --> 00:50:26,680
<font color="#E5E5E5">Maori archaeology under the presentation</font>

1472
00:50:24,880 --> 00:50:29,470
<font color="#E5E5E5">information and if you</font><font color="#CCCCCC"> have any</font>

1473
00:50:26,680 --> 00:50:31,450
questions I'm here please<font color="#CCCCCC"> I have some of</font>

1474
00:50:29,470 --> 00:50:32,980
these<font color="#E5E5E5"> pop-ups anybody gets quite good</font>

1475
00:50:31,450 --> 00:50:34,390
question I will give you one and then

1476
00:50:32,980 --> 00:50:35,560
<font color="#E5E5E5">please come chat with us and</font><font color="#CCCCCC"> ask</font><font color="#E5E5E5"> us</font>

1477
00:50:34,390 --> 00:50:37,990
<font color="#E5E5E5">questions</font><font color="#CCCCCC"> in a booth</font>

1478
00:50:35,560 --> 00:50:38,980
about some of<font color="#CCCCCC"> the</font><font color="#E5E5E5"> stuff and continue the</font>

1479
00:50:37,990 --> 00:50:40,450
discussion<font color="#CCCCCC"> because that's what we're</font>

1480
00:50:38,980 --> 00:50:41,980
here<font color="#CCCCCC"> for to share and be part of the</font>

1481
00:50:40,450 --> 00:50:52,240
<font color="#E5E5E5">community so there you go</font>

1482
00:50:41,980 --> 00:50:55,570
and with that<font color="#E5E5E5"> I am done questions we</font>

1483
00:50:52,240 --> 00:50:57,779
have<font color="#E5E5E5"> time for some questions</font><font color="#CCCCCC"> I think</font><font color="#E5E5E5"> or</font>

1484
00:50:55,570 --> 00:50:57,780
not

