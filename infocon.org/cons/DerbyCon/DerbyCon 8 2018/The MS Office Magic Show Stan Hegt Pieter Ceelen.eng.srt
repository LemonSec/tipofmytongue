1
00:00:00,030 --> 00:00:05,130
good afternoon<font color="#CCCCCC"> thank</font><font color="#E5E5E5"> you all for being</font>

2
00:00:01,890 --> 00:00:06,629
here<font color="#E5E5E5"> my name is Stan this is my fellow</font>

3
00:00:05,130 --> 00:00:08,969
magician for today Peter

4
00:00:06,629 --> 00:00:10,950
we are both<font color="#E5E5E5"> red</font><font color="#CCCCCC"> teamers</font><font color="#E5E5E5"> at a company</font>

5
00:00:08,970 --> 00:00:13,049
called outflank<font color="#E5E5E5"> which is a company</font><font color="#CCCCCC"> based</font>

6
00:00:10,950 --> 00:00:15,959
in<font color="#E5E5E5"> the Netherlands and today you are</font>

7
00:00:13,049 --> 00:00:18,060
<font color="#CCCCCC">here</font><font color="#E5E5E5"> at the MS</font><font color="#CCCCCC"> office magic show</font>

8
00:00:15,960 --> 00:00:21,300
so a magic show what are we going<font color="#E5E5E5"> to do</font>

9
00:00:18,060 --> 00:00:25,140
we are<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to show you</font><font color="#E5E5E5"> three illusions</font>

10
00:00:21,300 --> 00:00:27,960
that<font color="#CCCCCC"> build on offensive tricks</font><font color="#E5E5E5"> in Emma's</font>

11
00:00:25,140 --> 00:00:30,900
office<font color="#E5E5E5"> but well since we're hackers</font>

12
00:00:27,960 --> 00:00:33,510
we're actually going to brutally violate

13
00:00:30,900 --> 00:00:35,129
the code of<font color="#CCCCCC"> honor for magicians</font><font color="#E5E5E5"> and</font>

14
00:00:33,510 --> 00:00:37,280
we're actually going to<font color="#E5E5E5"> explain</font><font color="#CCCCCC"> all of</font>

15
00:00:35,130 --> 00:00:40,620
<font color="#CCCCCC">her tricks after showing them</font>

16
00:00:37,280 --> 00:00:42,090
that's my intro<font color="#E5E5E5"> let's dive</font><font color="#CCCCCC"> straight into</font>

17
00:00:40,620 --> 00:00:45,030
<font color="#E5E5E5">the details because it's going to be a</font>

18
00:00:42,090 --> 00:00:46,410
really<font color="#E5E5E5"> fast-paced talk plenty of</font>

19
00:00:45,030 --> 00:00:48,629
material in<font color="#E5E5E5"> here</font>

20
00:00:46,410 --> 00:00:50,760
so if you have any questions<font color="#CCCCCC"> feel free</font>

21
00:00:48,629 --> 00:00:52,680
<font color="#E5E5E5">to come us to</font><font color="#CCCCCC"> cope feel free to come to</font>

22
00:00:50,760 --> 00:00:56,099
us after<font color="#CCCCCC"> the talk</font><font color="#E5E5E5"> or reach out</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> us on</font>

23
00:00:52,680 --> 00:00:59,699
<font color="#E5E5E5">Twitter I'm gonna do the first illusion</font>

24
00:00:56,100 --> 00:01:01,829
<font color="#CCCCCC">and every magician</font><font color="#E5E5E5"> should have a</font>

25
00:00:59,699 --> 00:01:04,619
<font color="#E5E5E5">illusion in his playbook where he makes</font>

26
00:01:01,829 --> 00:01:06,600
<font color="#E5E5E5">things disappear</font><font color="#CCCCCC"> so let's start there</font>

27
00:01:04,619 --> 00:01:08,970
let's make a martyr out let's make<font color="#E5E5E5"> our</font>

28
00:01:06,600 --> 00:01:13,949
evil<font color="#CCCCCC"> coat disappear it's a basic trick</font>

29
00:01:08,970 --> 00:01:18,710
it's a basic trick so what we see here

30
00:01:13,950 --> 00:01:24,600
<font color="#CCCCCC">is demo one the</font><font color="#E5E5E5"> doc it's a word file</font><font color="#CCCCCC"> I</font>

31
00:01:18,710 --> 00:01:26,440
<font color="#E5E5E5">double click it word opens the MS Office</font>

32
00:01:24,600 --> 00:01:29,568
magic show<font color="#E5E5E5"> thanks</font>

33
00:01:26,440 --> 00:01:29,569
[Applause]

34
00:01:30,110 --> 00:01:35,460
there's the famous<font color="#E5E5E5"> yellow bar that says</font>

35
00:01:33,450 --> 00:01:37,409
hey there's<font color="#CCCCCC"> micro contents in here do</font>

36
00:01:35,460 --> 00:01:40,710
you<font color="#E5E5E5"> want to enable this and of</font><font color="#CCCCCC"> course I</font>

37
00:01:37,409 --> 00:01:43,110
want<font color="#E5E5E5"> to</font><font color="#CCCCCC"> enable this and as you</font><font color="#E5E5E5"> can see</font>

38
00:01:40,710 --> 00:01:46,800
<font color="#E5E5E5">macro code runs the calculator pops a</font>

39
00:01:43,110 --> 00:01:48,780
message box shows that's it<font color="#E5E5E5"> okay</font><font color="#CCCCCC"> let's</font>

40
00:01:46,800 --> 00:01:53,298
close this and<font color="#E5E5E5"> now let's first of all</font>

41
00:01:48,780 --> 00:01:53,299
look where's the<font color="#E5E5E5"> macro in the GUI</font><font color="#CCCCCC"> I</font>

42
00:01:55,310 --> 00:02:02,880
<font color="#CCCCCC">haven't seen</font><font color="#E5E5E5"> no markrony GUI it's not</font>

43
00:01:57,869 --> 00:02:04,770
here<font color="#CCCCCC"> but we all know not</font><font color="#E5E5E5"> to rely on the</font>

44
00:02:02,880 --> 00:02:10,549
GUI for this kind of things let's go to

45
00:02:04,770 --> 00:02:14,160
my analyst tools<font color="#CCCCCC"> I just see no code</font>

46
00:02:10,550 --> 00:02:15,690
<font color="#E5E5E5">what's happening here so I hope you're</font>

47
00:02:14,160 --> 00:02:20,370
all Bissell's right now what the

48
00:02:15,690 --> 00:02:22,829
happens if yes<font color="#E5E5E5"> let's start so this</font>

49
00:02:20,370 --> 00:02:25,680
builds on a few offensive tricks the

50
00:02:22,830 --> 00:02:27,120
first one is how do you hide macros from

51
00:02:25,680 --> 00:02:30,660
<font color="#E5E5E5">the GUI</font>

52
00:02:27,120 --> 00:02:33,350
<font color="#E5E5E5">I guess that most of you</font><font color="#CCCCCC"> are familiar</font>

53
00:02:30,660 --> 00:02:35,820
<font color="#E5E5E5">with what they</font><font color="#CCCCCC"> only compound file is</font>

54
00:02:33,350 --> 00:02:38,850
<font color="#E5E5E5">that's what you're seeing</font><font color="#CCCCCC"> here so if you</font>

55
00:02:35,820 --> 00:02:42,390
look<font color="#CCCCCC"> at the office file format for 97 to</font>

56
00:02:38,850 --> 00:02:44,790
2003<font color="#CCCCCC"> it's the only compound file format</font>

57
00:02:42,390 --> 00:02:47,518
which basically consists of storages and

58
00:02:44,790 --> 00:02:51,298
streams<font color="#E5E5E5"> it's like a like a file system</font>

59
00:02:47,519 --> 00:02:54,140
<font color="#E5E5E5">so what you see here</font><font color="#CCCCCC"> is there's</font><font color="#E5E5E5"> this</font>

60
00:02:51,299 --> 00:02:56,910
word<font color="#CCCCCC"> document demo one which has a</font>

61
00:02:54,140 --> 00:02:59,309
storage<font color="#E5E5E5"> called macros which has a</font>

62
00:02:56,910 --> 00:03:04,650
storage called VBA<font color="#E5E5E5"> and within that</font>

63
00:02:59,310 --> 00:03:07,430
<font color="#E5E5E5">storage there are a few streams and the</font>

64
00:03:04,650 --> 00:03:10,620
interesting thing<font color="#CCCCCC"> is that</font><font color="#E5E5E5"> the stream</font>

65
00:03:07,430 --> 00:03:14,700
instructing the GUI what to display<font color="#E5E5E5"> is</font>

66
00:03:10,620 --> 00:03:17,370
in the stream project while the actual

67
00:03:14,700 --> 00:03:19,738
code that<font color="#E5E5E5"> is going to run is in other</font>

68
00:03:17,370 --> 00:03:24,000
streams<font color="#E5E5E5"> in this case in module 1 and</font>

69
00:03:19,739 --> 00:03:26,030
this document<font color="#E5E5E5"> so it's really silly but</font>

70
00:03:24,000 --> 00:03:28,590
<font color="#E5E5E5">hiding from the GUI is as much as</font>

71
00:03:26,030 --> 00:03:31,079
opening the<font color="#E5E5E5"> project stream which is</font>

72
00:03:28,590 --> 00:03:34,260
<font color="#E5E5E5">basically a text file and</font><font color="#CCCCCC"> just removing</font>

73
00:03:31,079 --> 00:03:35,940
your your modules from there<font color="#E5E5E5"> so the line</font>

74
00:03:34,260 --> 00:03:39,030
that<font color="#CCCCCC"> you see highlighted</font><font color="#E5E5E5"> there module is</font>

75
00:03:35,940 --> 00:03:41,280
module 1 if you just remove it then

76
00:03:39,030 --> 00:03:42,370
<font color="#E5E5E5">there by the GUI from Microsoft Word</font>

77
00:03:41,280 --> 00:03:45,760
<font color="#E5E5E5">doesn't know that there</font>

78
00:03:42,370 --> 00:03:48,760
<font color="#CCCCCC">a module to</font><font color="#E5E5E5"> open item from the GUI is as</font>

79
00:03:45,760 --> 00:03:53,649
easy as<font color="#CCCCCC"> that</font><font color="#E5E5E5"> but</font><font color="#CCCCCC"> they</font><font color="#E5E5E5"> say how do we hide</font>

80
00:03:48,760 --> 00:03:56,679
our stuff from<font color="#E5E5E5"> the analyst tools let's</font>

81
00:03:53,650 --> 00:04:01,569
look at<font color="#E5E5E5"> this output output from in this</font>

82
00:03:56,680 --> 00:04:05,260
<font color="#E5E5E5">case only tools with la VBA how does a</font>

83
00:04:01,569 --> 00:04:08,980
tool like this words it opens the

84
00:04:05,260 --> 00:04:11,679
potential malicious document<font color="#E5E5E5"> it sees</font>

85
00:04:08,980 --> 00:04:13,899
that<font color="#CCCCCC"> it is</font><font color="#E5E5E5"> a only compound file so it</font>

86
00:04:11,680 --> 00:04:17,470
will see if there<font color="#E5E5E5"> is a</font><font color="#CCCCCC"> VBA storage in</font>

87
00:04:13,900 --> 00:04:20,048
there yes there is<font color="#CCCCCC"> and then from the</font>

88
00:04:17,470 --> 00:04:23,350
<font color="#E5E5E5">relevant streams like in our case module</font>

89
00:04:20,048 --> 00:04:26,979
<font color="#CCCCCC">1</font><font color="#E5E5E5"> in this document it starts carving out</font>

90
00:04:23,350 --> 00:04:31,479
the relevant<font color="#E5E5E5"> code and it</font><font color="#CCCCCC"> will display</font>

91
00:04:26,979 --> 00:04:33,010
<font color="#E5E5E5">that to the console of the analyst</font><font color="#CCCCCC"> ok so</font>

92
00:04:31,479 --> 00:04:37,090
one of the questions<font color="#CCCCCC"> that we have to ask</font>

93
00:04:33,010 --> 00:04:40,409
is what about<font color="#E5E5E5"> input validation can we</font>

94
00:04:37,090 --> 00:04:43,239
actually<font color="#E5E5E5"> trust a malicious macro well</font>

95
00:04:40,410 --> 00:04:48,039
definitely not so let's see what we can

96
00:04:43,240 --> 00:04:52,710
<font color="#CCCCCC">do here</font><font color="#E5E5E5"> what if we</font><font color="#CCCCCC"> just insert backspace</font>

97
00:04:48,039 --> 00:04:58,030
characters<font color="#E5E5E5"> in comments after our lines</font>

98
00:04:52,710 --> 00:05:00,489
yeah<font color="#E5E5E5"> yep</font><font color="#CCCCCC"> I have tested</font><font color="#E5E5E5"> is only</font><font color="#CCCCCC"> number</font><font color="#E5E5E5"> of</font>

99
00:04:58,030 --> 00:05:02,859
tools<font color="#CCCCCC"> including only tools only dump and</font>

100
00:05:00,490 --> 00:05:05,139
all your<font color="#E5E5E5"> favorite tools and many of them</font>

101
00:05:02,860 --> 00:05:06,789
actually<font color="#CCCCCC"> most</font><font color="#E5E5E5"> of them are vulnerable to</font>

102
00:05:05,139 --> 00:05:08,470
<font color="#E5E5E5">this I've reached out</font><font color="#CCCCCC"> to the most</font>

103
00:05:06,789 --> 00:05:10,539
important ones including our<font color="#CCCCCC"> lead tools</font>

104
00:05:08,470 --> 00:05:13,539
and there will be a fix there<font color="#E5E5E5"> but please</font>

105
00:05:10,539 --> 00:05:16,449
help<font color="#E5E5E5"> us spread this to other tools that</font>

106
00:05:13,539 --> 00:05:19,389
that are<font color="#E5E5E5"> being developed in this area so</font>

107
00:05:16,449 --> 00:05:22,720
this<font color="#E5E5E5"> is fun but in the illusion</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> I</font>

108
00:05:19,389 --> 00:05:25,120
<font color="#CCCCCC">showed you I actually used another trick</font>

109
00:05:22,720 --> 00:05:27,250
and the other trick<font color="#E5E5E5"> that we use there</font><font color="#CCCCCC"> is</font>

110
00:05:25,120 --> 00:05:29,770
what is<font color="#E5E5E5"> called</font><font color="#CCCCCC"> pre code and I guess</font><font color="#E5E5E5"> that</font>

111
00:05:27,250 --> 00:05:31,780
many of you have already seen the

112
00:05:29,770 --> 00:05:35,380
excellent talk by<font color="#E5E5E5"> the guys from</font><font color="#CCCCCC"> Walmart</font>

113
00:05:31,780 --> 00:05:37,419
yesterday<font color="#CCCCCC"> where they</font><font color="#E5E5E5"> looked into what</font>

114
00:05:35,380 --> 00:05:40,300
happens with<font color="#E5E5E5"> peak out especially from a</font>

115
00:05:37,419 --> 00:05:42,580
<font color="#CCCCCC">defense defensive perspective</font><font color="#E5E5E5"> well as we</font>

116
00:05:40,300 --> 00:05:45,430
<font color="#E5E5E5">are red teamers</font><font color="#CCCCCC"> we have looked into</font><font color="#E5E5E5"> it</font>

117
00:05:42,580 --> 00:05:48,130
mostly<font color="#E5E5E5"> from a offensive perspective and</font>

118
00:05:45,430 --> 00:05:50,650
what you<font color="#E5E5E5"> need to know is the following</font>

119
00:05:48,130 --> 00:05:53,560
<font color="#CCCCCC">it's a really quick summary about</font><font color="#E5E5E5"> P code</font>

120
00:05:50,650 --> 00:05:56,260
<font color="#E5E5E5">so if you have a only compound file and</font>

121
00:05:53,560 --> 00:05:58,090
there's a<font color="#CCCCCC"> vba storage in there</font>

122
00:05:56,260 --> 00:06:01,390
and within that<font color="#E5E5E5"> storage there are the</font>

123
00:05:58,090 --> 00:06:04,539
<font color="#CCCCCC">Olay streams</font><font color="#E5E5E5"> that actually contain the</font>

124
00:06:01,390 --> 00:06:06,729
<font color="#CCCCCC">microcode then such</font><font color="#E5E5E5"> an old a stream like</font>

125
00:06:04,540 --> 00:06:09,570
the stream module one consists<font color="#E5E5E5"> of two</font>

126
00:06:06,730 --> 00:06:13,630
parts<font color="#E5E5E5"> the</font><font color="#CCCCCC"> first part is performance cash</font>

127
00:06:09,570 --> 00:06:18,010
which is undocumented<font color="#E5E5E5"> there's hardly</font>

128
00:06:13,630 --> 00:06:20,140
anything<font color="#E5E5E5"> to find about that in the in</font>

129
00:06:18,010 --> 00:06:21,849
the official documentation<font color="#E5E5E5"> Microsoft</font>

130
00:06:20,140 --> 00:06:23,919
actually<font color="#E5E5E5"> says</font><font color="#CCCCCC"> that this part must</font><font color="#E5E5E5"> be</font>

131
00:06:21,850 --> 00:06:26,710
ignored well clearly<font color="#CCCCCC"> it is not ignored</font>

132
00:06:23,920 --> 00:06:30,370
in execution<font color="#E5E5E5"> and the other part is</font><font color="#CCCCCC"> the</font>

133
00:06:26,710 --> 00:06:32,710
<font color="#CCCCCC">compressed source code which is just</font>

134
00:06:30,370 --> 00:06:36,430
compression of<font color="#CCCCCC"> the VBA source code that</font>

135
00:06:32,710 --> 00:06:38,770
you can look at from<font color="#CCCCCC"> the GUI</font><font color="#E5E5E5"> and this</font>

136
00:06:36,430 --> 00:06:42,700
<font color="#E5E5E5">performance cache part of the oldest</font>

137
00:06:38,770 --> 00:06:44,349
tree module contains<font color="#E5E5E5"> what we call</font><font color="#CCCCCC"> P</font>

138
00:06:42,700 --> 00:06:46,450
codes there's much<font color="#E5E5E5"> more in that but part</font>

139
00:06:44,350 --> 00:06:49,780
<font color="#E5E5E5">of the performance</font><font color="#CCCCCC"> cash</font><font color="#E5E5E5"> is P code and</font>

140
00:06:46,450 --> 00:06:51,820
what<font color="#CCCCCC"> P code is it is a VBA version</font>

141
00:06:49,780 --> 00:06:54,250
specific<font color="#E5E5E5"> pseudocode for the VBA stack</font>

142
00:06:51,820 --> 00:06:56,500
machine well that's that that's a whole

143
00:06:54,250 --> 00:06:59,740
mouthful but<font color="#CCCCCC"> what you should know is</font>

144
00:06:56,500 --> 00:07:01,960
<font color="#E5E5E5">that everything from office</font><font color="#CCCCCC"> 2010 onwards</font>

145
00:06:59,740 --> 00:07:06,310
just uses the VBA<font color="#E5E5E5"> seven stack machine</font>

146
00:07:01,960 --> 00:07:08,200
and as dr.<font color="#E5E5E5"> bunch</font><font color="#CCCCCC"> F has done some really</font>

147
00:07:06,310 --> 00:07:09,940
<font color="#E5E5E5">good research into this and he shows</font>

148
00:07:08,200 --> 00:07:12,400
that<font color="#CCCCCC"> on</font><font color="#E5E5E5"> this get up what</font><font color="#CCCCCC"> actually</font>

149
00:07:09,940 --> 00:07:15,580
happens is<font color="#E5E5E5"> following if you open a word</font>

150
00:07:12,400 --> 00:07:21,070
file or a Excel file containing macros

151
00:07:15,580 --> 00:07:24,880
and<font color="#E5E5E5"> both the version in specified in VBA</font>

152
00:07:21,070 --> 00:07:29,710
projects as well<font color="#E5E5E5"> as the architecture x86</font>

153
00:07:24,880 --> 00:07:31,659
or x64<font color="#E5E5E5"> matches the</font><font color="#CCCCCC"> version</font><font color="#E5E5E5"> of Word or</font>

154
00:07:29,710 --> 00:07:33,250
<font color="#E5E5E5">Excel that's running on the host then</font>

155
00:07:31,660 --> 00:07:36,310
this compressed source code the actual

156
00:07:33,250 --> 00:07:37,990
code is<font color="#E5E5E5"> completely ignored and VBA and</font>

157
00:07:36,310 --> 00:07:41,230
<font color="#E5E5E5">sorry I'm sorry any</font><font color="#CCCCCC"> Pico</font><font color="#E5E5E5"> just ran</font>

158
00:07:37,990 --> 00:07:43,540
instead of VBA<font color="#E5E5E5"> so to explain it really</font>

159
00:07:41,230 --> 00:07:45,280
<font color="#CCCCCC">easily again let's open our module</font>

160
00:07:43,540 --> 00:07:47,410
stream what you see on the bottom<font color="#E5E5E5"> is</font><font color="#CCCCCC"> to</font>

161
00:07:45,280 --> 00:07:51,099
compress source code and what you see on

162
00:07:47,410 --> 00:07:54,460
the top<font color="#E5E5E5"> is the</font><font color="#CCCCCC"> P code so what you can do</font>

163
00:07:51,100 --> 00:07:57,040
<font color="#E5E5E5">if you know the exact version of</font><font color="#CCCCCC"> word or</font>

164
00:07:54,460 --> 00:07:58,690
<font color="#E5E5E5">excel that</font><font color="#CCCCCC"> your victim</font><font color="#E5E5E5"> is is using that</font>

165
00:07:57,040 --> 00:08:00,850
you can<font color="#CCCCCC"> just know how to compress source</font>

166
00:07:58,690 --> 00:08:03,760
code<font color="#E5E5E5"> will leave the P code in there</font><font color="#CCCCCC"> and</font>

167
00:08:00,850 --> 00:08:05,980
then actually<font color="#E5E5E5"> the P code runs instead of</font>

168
00:08:03,760 --> 00:08:08,680
the<font color="#E5E5E5"> VBA source code so if you then</font><font color="#CCCCCC"> go</font><font color="#E5E5E5"> to</font>

169
00:08:05,980 --> 00:08:10,790
your analyst tool again<font color="#E5E5E5"> the macro is has</font>

170
00:08:08,680 --> 00:08:13,460
completely disappeared

171
00:08:10,790 --> 00:08:15,560
we're still<font color="#E5E5E5"> looking</font><font color="#CCCCCC"> into fully</font>

172
00:08:13,460 --> 00:08:19,039
weaponizing this<font color="#E5E5E5"> but for the time being</font>

173
00:08:15,560 --> 00:08:23,180
<font color="#E5E5E5">is not that difficult</font><font color="#CCCCCC"> you develop your</font>

174
00:08:19,040 --> 00:08:27,560
malicious document<font color="#E5E5E5"> in two in two</font>

175
00:08:23,180 --> 00:08:30,350
<font color="#CCCCCC">branches x64 and x86</font><font color="#E5E5E5"> then you open your</font>

176
00:08:27,560 --> 00:08:32,570
malicious file<font color="#E5E5E5"> in a compound file editor</font>

177
00:08:30,350 --> 00:08:36,590
like flex<font color="#CCCCCC"> X that I'm using and then you</font>

178
00:08:32,570 --> 00:08:38,930
go<font color="#E5E5E5"> to buy it's 3 and 4 of the VBA</font>

179
00:08:36,590 --> 00:08:40,220
project all a stream<font color="#E5E5E5"> and you just make</font>

180
00:08:38,929 --> 00:08:43,489
<font color="#E5E5E5">sure</font><font color="#CCCCCC"> that the</font><font color="#E5E5E5"> version number that's in</font>

181
00:08:40,220 --> 00:08:45,860
there<font color="#E5E5E5"> matches the</font><font color="#CCCCCC"> version number of your</font>

182
00:08:43,490 --> 00:08:47,630
victim<font color="#E5E5E5"> and will soon publish</font><font color="#CCCCCC"> a small</font>

183
00:08:45,860 --> 00:08:49,730
<font color="#E5E5E5">table with correct version</font><font color="#CCCCCC"> to do</font><font color="#E5E5E5"> that</font>

184
00:08:47,630 --> 00:08:53,120
we're repping it but it definitely can

185
00:08:49,730 --> 00:08:54,920
be<font color="#E5E5E5"> used in in offensive operations</font><font color="#CCCCCC"> ok</font>

186
00:08:53,120 --> 00:08:57,380
that concludes<font color="#CCCCCC"> the explanation of the</font>

187
00:08:54,920 --> 00:08:58,969
first trick<font color="#CCCCCC"> I see some hands being</font>

188
00:08:57,380 --> 00:09:00,860
raised let's do the questions afterwards

189
00:08:58,970 --> 00:09:02,780
if that's<font color="#E5E5E5"> okay</font><font color="#CCCCCC"> with you thanks</font><font color="#E5E5E5"> if you</font>

190
00:09:00,860 --> 00:09:04,880
<font color="#CCCCCC">thought this was fun this was our basic</font>

191
00:09:02,780 --> 00:09:06,800
trick<font color="#E5E5E5"> so I'm going to invite</font><font color="#CCCCCC"> my</font><font color="#E5E5E5"> fellow</font>

192
00:09:04,880 --> 00:09:15,230
magician<font color="#CCCCCC"> Peter to continue with the</font>

193
00:09:06,800 --> 00:09:16,910
second trick so a magic show<font color="#E5E5E5"> should</font>

194
00:09:15,230 --> 00:09:19,480
include cutting<font color="#E5E5E5"> someone in half right</font>

195
00:09:16,910 --> 00:09:22,370
<font color="#E5E5E5">that is the definition of a magic show</font>

196
00:09:19,480 --> 00:09:25,000
<font color="#E5E5E5">well first and luckily I'm</font><font color="#CCCCCC"> not cutting a</font>

197
00:09:22,370 --> 00:09:33,260
<font color="#CCCCCC">man off we're cutting our things in half</font>

198
00:09:25,000 --> 00:09:38,810
let's move<font color="#E5E5E5"> directly towards a demo let's</font>

199
00:09:33,260 --> 00:09:41,110
first close<font color="#CCCCCC"> Stan's instances so suppose</font>

200
00:09:38,810 --> 00:09:44,089
we're sending an email to<font color="#CCCCCC"> our victim a</font>

201
00:09:41,110 --> 00:09:46,460
phishing<font color="#CCCCCC"> email with a link saying here's</font>

202
00:09:44,090 --> 00:09:49,370
an interesting<font color="#CCCCCC"> Word documents please</font>

203
00:09:46,460 --> 00:09:51,680
<font color="#E5E5E5">check it out and that victim would end</font>

204
00:09:49,370 --> 00:09:53,780
on a page like<font color="#CCCCCC"> this well in a real story</font>

205
00:09:51,680 --> 00:09:58,339
it wouldn't be<font color="#E5E5E5"> like this page but let's</font>

206
00:09:53,780 --> 00:10:01,250
click a link demo<font color="#E5E5E5"> - well what we see is</font>

207
00:09:58,340 --> 00:10:03,860
<font color="#E5E5E5">two downloads we can generate it so</font>

208
00:10:01,250 --> 00:10:11,090
let's check our<font color="#E5E5E5"> downloads directory on a</font>

209
00:10:03,860 --> 00:10:12,830
computer and we see two<font color="#CCCCCC"> files being</font>

210
00:10:11,090 --> 00:10:16,490
downloaded from this from this from<font color="#E5E5E5"> this</font>

211
00:10:12,830 --> 00:10:19,670
<font color="#E5E5E5">website</font><font color="#CCCCCC"> I read me dot HTML and a docx</font>

212
00:10:16,490 --> 00:10:21,620
file as we all know<font color="#E5E5E5"> dog x-files</font>

213
00:10:19,670 --> 00:10:25,209
they<font color="#E5E5E5"> call me</font><font color="#CCCCCC"> macros so this leader</font><font color="#E5E5E5"> -</font>

214
00:10:21,620 --> 00:10:28,940
really certainly non-malicious<font color="#E5E5E5"> for</font>

215
00:10:25,210 --> 00:10:31,340
let's open the readme file<font color="#CCCCCC"> to just see</font>

216
00:10:28,940 --> 00:10:33,410
if someone messed with it<font color="#E5E5E5"> no this is a</font>

217
00:10:31,340 --> 00:10:40,070
really an innocent readme file<font color="#E5E5E5"> it states</font>

218
00:10:33,410 --> 00:10:41,630
there so it must<font color="#CCCCCC"> be and then we open</font>

219
00:10:40,070 --> 00:10:44,240
this file which is also named innocent

220
00:10:41,630 --> 00:10:46,610
so that one is probably<font color="#CCCCCC"> innocent and we</font>

221
00:10:44,240 --> 00:10:50,150
downloaded<font color="#E5E5E5"> it so it will open</font><font color="#CCCCCC"> into</font>

222
00:10:46,610 --> 00:10:53,750
protective mode<font color="#E5E5E5"> so in a protected mode</font>

223
00:10:50,150 --> 00:10:58,579
we click enable editing and then<font color="#CCCCCC"> subtly</font>

224
00:10:53,750 --> 00:11:03,320
we get a<font color="#E5E5E5"> security</font><font color="#CCCCCC"> warning for macros and</font>

225
00:10:58,580 --> 00:11:09,040
if we enable<font color="#CCCCCC"> that we just</font><font color="#E5E5E5"> pop the box so</font>

226
00:11:03,320 --> 00:11:11,290
we<font color="#CCCCCC"> did a macro in a docx file hell yeah</font>

227
00:11:09,040 --> 00:11:14,449
[Music]

228
00:11:11,290 --> 00:11:17,290
but this is a magic show<font color="#E5E5E5"> this is this is</font>

229
00:11:14,450 --> 00:11:20,510
<font color="#E5E5E5">not what we</font><font color="#CCCCCC"> did</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> was the illusion I</font>

230
00:11:17,290 --> 00:11:22,370
mean really a<font color="#E5E5E5"> doc</font><font color="#CCCCCC"> and a</font><font color="#E5E5E5"> macro</font><font color="#CCCCCC"> in docx</font>

231
00:11:20,510 --> 00:11:25,670
file no I can't do<font color="#E5E5E5"> that but I can make</font>

232
00:11:22,370 --> 00:11:29,690
<font color="#E5E5E5">the</font><font color="#CCCCCC"> impression I should just saw so how</font>

233
00:11:25,670 --> 00:11:31,400
I did that<font color="#E5E5E5"> so the first step to thing to</font>

234
00:11:29,690 --> 00:11:34,960
<font color="#E5E5E5">learn is about office documents and</font>

235
00:11:31,400 --> 00:11:37,490
templates so<font color="#CCCCCC"> Word documents can have a</font>

236
00:11:34,960 --> 00:11:39,530
template<font color="#CCCCCC"> have you ever refuse to attend</font>

237
00:11:37,490 --> 00:11:41,510
<font color="#CCCCCC">plate file and typically this is</font>

238
00:11:39,530 --> 00:11:44,329
<font color="#CCCCCC">undefined and then your word document</font>

239
00:11:41,510 --> 00:11:45,710
refers to normal dot but you can<font color="#E5E5E5"> make an</font>

240
00:11:44,330 --> 00:11:47,690
explicit template then you can use that

241
00:11:45,710 --> 00:11:50,510
<font color="#E5E5E5">for example in a company if you have</font>

242
00:11:47,690 --> 00:11:52,640
<font color="#E5E5E5">like multiple brands and logos etc you</font>

243
00:11:50,510 --> 00:11:54,860
use explicit templates<font color="#E5E5E5"> to say well use</font>

244
00:11:52,640 --> 00:11:57,319
this found for this document use that on

245
00:11:54,860 --> 00:11:59,060
<font color="#E5E5E5">for</font><font color="#CCCCCC"> that document</font><font color="#E5E5E5"> templates can also</font>

246
00:11:57,320 --> 00:12:01,280
include macros and if you open<font color="#CCCCCC"> a</font>

247
00:11:59,060 --> 00:12:03,140
document and<font color="#E5E5E5"> the template will be loaded</font>

248
00:12:01,280 --> 00:12:06,740
and the mark of events the the<font color="#CCCCCC"> auto open</font>

249
00:12:03,140 --> 00:12:09,319
<font color="#E5E5E5">events will fire and there is a full</font>

250
00:12:06,740 --> 00:12:13,790
path<font color="#E5E5E5"> just somewhere in the XML of a F of</font>

251
00:12:09,320 --> 00:12:15,950
a docx<font color="#E5E5E5"> file in the word else</font>

252
00:12:13,790 --> 00:12:18,520
settings.xml it's just a full path of

253
00:12:15,950 --> 00:12:20,540
this template<font color="#E5E5E5"> file so this is a basic</font>

254
00:12:18,520 --> 00:12:22,220
<font color="#E5E5E5">but there are some properties of</font><font color="#CCCCCC"> these</font>

255
00:12:20,540 --> 00:12:27,770
templates<font color="#CCCCCC"> that we can we can build</font><font color="#E5E5E5"> upon</font>

256
00:12:22,220 --> 00:12:29,750
<font color="#CCCCCC">so if word can't locate the templates</font><font color="#E5E5E5"> it</font>

257
00:12:27,770 --> 00:12:31,760
will start looking<font color="#CCCCCC"> for the templates</font>

258
00:12:29,750 --> 00:12:35,120
<font color="#CCCCCC">just the</font><font color="#E5E5E5"> last part of the file name</font><font color="#CCCCCC"> in</font>

259
00:12:31,760 --> 00:12:37,520
the<font color="#E5E5E5"> current directory</font><font color="#CCCCCC"> and if the</font>

260
00:12:35,120 --> 00:12:40,220
<font color="#E5E5E5">template is</font><font color="#CCCCCC"> not found there was no</font><font color="#E5E5E5"> error</font>

261
00:12:37,520 --> 00:12:41,689
we're just<font color="#E5E5E5"> then points</font><font color="#CCCCCC"> to in the GUI</font><font color="#E5E5E5"> and</font>

262
00:12:40,220 --> 00:12:44,660
the document itself is just rendered

263
00:12:41,690 --> 00:12:46,580
with<font color="#E5E5E5"> a normal adult the temp file this</font>

264
00:12:44,660 --> 00:12:47,959
is kind of intended if you have to a

265
00:12:46,580 --> 00:12:50,930
template<font color="#CCCCCC"> so uh network</font><font color="#E5E5E5"> share and you</font>

266
00:12:47,959 --> 00:12:53,149
have a laptop user then you<font color="#CCCCCC"> still can</font>

267
00:12:50,930 --> 00:12:54,319
open the document no errors<font color="#CCCCCC"> but the</font>

268
00:12:53,149 --> 00:12:58,490
<font color="#E5E5E5">document is just</font><font color="#CCCCCC"> run a</font><font color="#E5E5E5"> little bit</font>

269
00:12:54,320 --> 00:13:01,040
differently interestingly word accepts a

270
00:12:58,490 --> 00:13:03,649
rename of adults file which is the<font color="#E5E5E5"> old</font>

271
00:13:01,040 --> 00:13:07,760
<font color="#E5E5E5">school template</font><font color="#CCCCCC"> you can just rename that</font>

272
00:13:03,649 --> 00:13:15,110
<font color="#E5E5E5">to any extension and we're just accept</font>

273
00:13:07,760 --> 00:13:23,950
stuff no I'm just sorry I mean that

274
00:13:15,110 --> 00:13:28,640
terrible jet lag so<font color="#CCCCCC"> a big</font><font color="#E5E5E5"> excellence</font>

275
00:13:23,950 --> 00:13:31,459
yeah<font color="#E5E5E5"> so we can rename it we can rename</font>

276
00:13:28,640 --> 00:13:32,689
templates<font color="#E5E5E5"> dot templates or no tax or</font><font color="#CCCCCC"> dot</font>

277
00:13:31,459 --> 00:13:33,949
<font color="#CCCCCC">I'm templates</font><font color="#E5E5E5"> with the</font><font color="#CCCCCC"> old school</font>

278
00:13:32,690 --> 00:13:37,450
<font color="#CCCCCC">template</font><font color="#E5E5E5"> we can rename them to any</font>

279
00:13:33,950 --> 00:13:41,209
extension<font color="#E5E5E5"> and it's being accepted so</font>

280
00:13:37,450 --> 00:13:44,510
what you just<font color="#CCCCCC"> saw was a docx file with a</font>

281
00:13:41,209 --> 00:13:46,369
template reference to just<font color="#E5E5E5"> a</font><font color="#CCCCCC"> thought on</font>

282
00:13:44,510 --> 00:13:49,990
<font color="#E5E5E5">a normal computer to a</font><font color="#CCCCCC"> readme</font><font color="#E5E5E5"> a job</font>

283
00:13:46,370 --> 00:13:52,579
which ends on readme dot HTML and then<font color="#CCCCCC"> I</font>

284
00:13:49,990 --> 00:13:55,640
yeah<font color="#CCCCCC"> and then on the computer is this</font>

285
00:13:52,579 --> 00:13:58,160
<font color="#CCCCCC">repeated HTML file was loaded but wait a</font>

286
00:13:55,640 --> 00:14:01,220
minute<font color="#CCCCCC"> I open to read me dot HTML file</font>

287
00:13:58,160 --> 00:14:02,990
<font color="#E5E5E5">and</font><font color="#CCCCCC"> it was an HTML file and now I'm</font>

288
00:14:01,220 --> 00:14:03,560
saying<font color="#E5E5E5"> it's a template for what's going</font>

289
00:14:02,990 --> 00:14:10,550
<font color="#E5E5E5">on here</font>

290
00:14:03,560 --> 00:14:12,649
well this is a polyglot so<font color="#E5E5E5"> the template</font>

291
00:14:10,550 --> 00:14:15,800
is this<font color="#CCCCCC"> binary compound file Stan</font><font color="#E5E5E5"> just</font>

292
00:14:12,649 --> 00:14:17,240
<font color="#CCCCCC">mentions it's just a binary</font><font color="#E5E5E5"> we take the</font>

293
00:14:15,800 --> 00:14:19,310
<font color="#E5E5E5">we leave the header intact and</font>

294
00:14:17,240 --> 00:14:21,950
afterwards<font color="#E5E5E5"> we just insert an HTML</font>

295
00:14:19,310 --> 00:14:24,319
<font color="#CCCCCC">comment stack and at the bottom of</font><font color="#E5E5E5"> the</font>

296
00:14:21,950 --> 00:14:26,390
of the<font color="#CCCCCC"> document</font><font color="#E5E5E5"> we extend it with the</font>

297
00:14:24,320 --> 00:14:28,670
<font color="#CCCCCC">close stack and some HTML</font><font color="#E5E5E5"> with</font>

298
00:14:26,390 --> 00:14:30,500
JavaScript which says well the body of

299
00:14:28,670 --> 00:14:33,800
this document is<font color="#E5E5E5"> just</font><font color="#CCCCCC"> this innocent</font>

300
00:14:30,500 --> 00:14:35,990
message and<font color="#E5E5E5"> we're it accepts this a</font>

301
00:14:33,800 --> 00:14:38,089
<font color="#CCCCCC">divine</font><font color="#E5E5E5"> recompensed file doesn't crash so</font>

302
00:14:35,990 --> 00:14:43,160
as<font color="#E5E5E5"> a crash word so this is just</font>

303
00:14:38,089 --> 00:14:44,540
apparently<font color="#CCCCCC"> interpreted correct so now we</font>

304
00:14:43,160 --> 00:14:46,730
have these two<font color="#CCCCCC"> documents but we need to</font>

305
00:14:44,540 --> 00:14:49,430
<font color="#E5E5E5">kind of deliver them</font><font color="#CCCCCC"> I mean this only</font>

306
00:14:46,730 --> 00:14:51,089
works as<font color="#CCCCCC"> long as this template file and</font>

307
00:14:49,430 --> 00:14:53,670
this<font color="#E5E5E5"> doc</font><font color="#CCCCCC"> x4</font>

308
00:14:51,089 --> 00:14:57,059
<font color="#E5E5E5">are in the same</font><font color="#CCCCCC"> directory so we</font><font color="#E5E5E5"> needed</font>

309
00:14:53,670 --> 00:15:00,209
<font color="#CCCCCC">to bring another trick or step in our</font>

310
00:14:57,059 --> 00:15:02,490
attack<font color="#E5E5E5"> chain and for that we used a</font>

311
00:15:00,209 --> 00:15:06,479
friend<font color="#E5E5E5"> which which is which</font><font color="#CCCCCC"> is called</font>

312
00:15:02,490 --> 00:15:09,269
<font color="#E5E5E5">HTML smuggling HTML smuggling is a</font>

313
00:15:06,480 --> 00:15:11,990
technique we often employ to bypass

314
00:15:09,269 --> 00:15:14,699
proxies<font color="#CCCCCC"> the idea is the following</font>

315
00:15:11,990 --> 00:15:17,459
<font color="#E5E5E5">instead of serving a file on a file</font>

316
00:15:14,699 --> 00:15:19,529
<font color="#CCCCCC">server</font><font color="#E5E5E5"> you serve it</font><font color="#CCCCCC"> you serve an HTML</font>

317
00:15:17,459 --> 00:15:24,329
page<font color="#E5E5E5"> which has some JavaScript code and</font>

318
00:15:19,529 --> 00:15:27,149
the JavaScript codes<font color="#CCCCCC"> takes it has a big</font>

319
00:15:24,329 --> 00:15:30,628
base64 string which is<font color="#E5E5E5"> the</font><font color="#CCCCCC"> real file</font>

320
00:15:27,149 --> 00:15:32,279
you're serving and then you<font color="#CCCCCC"> you you</font>

321
00:15:30,629 --> 00:15:34,230
within the within JavaScript<font color="#E5E5E5"> that</font>

322
00:15:32,279 --> 00:15:36,600
generate binary blobs<font color="#CCCCCC"> and</font><font color="#E5E5E5"> make them</font>

323
00:15:34,230 --> 00:15:39,449
available as a download link<font color="#CCCCCC"> and then</font>

324
00:15:36,600 --> 00:15:41,480
with<font color="#CCCCCC"> JavaScript</font><font color="#E5E5E5"> you click the link this</font>

325
00:15:39,449 --> 00:15:43,740
is something we often<font color="#E5E5E5"> use</font><font color="#CCCCCC"> to bypass</font>

326
00:15:41,480 --> 00:15:45,660
proxies that<font color="#E5E5E5"> do sandboxing because we</font>

327
00:15:43,740 --> 00:15:47,850
don't<font color="#E5E5E5"> have any files over the line but</font>

328
00:15:45,660 --> 00:15:50,249
this is JavaScript<font color="#E5E5E5"> we can use this and</font>

329
00:15:47,850 --> 00:15:56,579
and run<font color="#E5E5E5"> this to just run this twice and</font>

330
00:15:50,249 --> 00:15:57,870
as such<font color="#E5E5E5"> generates two downloads so Stan</font>

331
00:15:56,579 --> 00:15:59,128
made<font color="#CCCCCC"> a made an excellent writable</font>

332
00:15:57,870 --> 00:16:01,439
smuggling it's not something we<font color="#E5E5E5"> invented</font>

333
00:15:59,129 --> 00:16:04,279
<font color="#CCCCCC">but it is really a cool technique</font><font color="#E5E5E5"> just</font>

334
00:16:01,439 --> 00:16:07,349
besides<font color="#CCCCCC"> off of the office stuff so this</font>

335
00:16:04,279 --> 00:16:09,209
completes the<font color="#E5E5E5"> trick so we have a website</font>

336
00:16:07,350 --> 00:16:11,009
<font color="#CCCCCC">which generates two</font><font color="#E5E5E5"> documents the</font>

337
00:16:09,209 --> 00:16:15,599
documents<font color="#E5E5E5"> is one is a readme file which</font>

338
00:16:11,009 --> 00:16:18,929
is a poly polyglots<font color="#E5E5E5"> with a docker with</font>

339
00:16:15,600 --> 00:16:20,309
<font color="#CCCCCC">dots and some HTML content</font><font color="#E5E5E5"> and then the</font>

340
00:16:18,929 --> 00:16:24,540
docx<font color="#E5E5E5"> file that really loads that</font>

341
00:16:20,309 --> 00:16:26,100
template but there's much more<font color="#E5E5E5"> in this</font>

342
00:16:24,540 --> 00:16:29,879
in this line of<font color="#E5E5E5"> field if you look into</font>

343
00:16:26,100 --> 00:16:34,679
the templates we<font color="#E5E5E5"> often employ them for</font>

344
00:16:29,879 --> 00:16:39,929
offensive purposes<font color="#CCCCCC"> so suppose you</font><font color="#E5E5E5"> have a</font>

345
00:16:34,679 --> 00:16:42,529
company<font color="#CCCCCC"> that has configured the</font><font color="#E5E5E5"> trusted</font>

346
00:16:39,929 --> 00:16:46,470
locations in words<font color="#E5E5E5"> for</font><font color="#CCCCCC"> a network</font><font color="#E5E5E5"> share</font>

347
00:16:42,529 --> 00:16:48,179
<font color="#E5E5E5">so companies do</font><font color="#CCCCCC"> that do this</font><font color="#E5E5E5"> so all the</font>

348
00:16:46,470 --> 00:16:49,769
documents on that network<font color="#E5E5E5"> share here are</font>

349
00:16:48,179 --> 00:16:51,870
automatically approved the yellow bar is

350
00:16:49,769 --> 00:16:53,339
<font color="#E5E5E5">no longer needed</font><font color="#CCCCCC"> and there is maybe a</font>

351
00:16:51,870 --> 00:16:54,870
valid<font color="#CCCCCC"> reason for</font><font color="#E5E5E5"> them they won't don't</font>

352
00:16:53,339 --> 00:16:58,350
want to train the users to<font color="#CCCCCC"> click the</font>

353
00:16:54,870 --> 00:17:00,929
<font color="#CCCCCC">yellow bar so they put them on</font><font color="#E5E5E5"> a on a</font>

354
00:16:58,350 --> 00:17:02,970
trip on a trusted location and we see

355
00:17:00,929 --> 00:17:04,920
this<font color="#E5E5E5"> very</font><font color="#CCCCCC"> often and then for us the</font>

356
00:17:02,970 --> 00:17:07,620
trick is to find<font color="#E5E5E5"> someone or</font>

357
00:17:04,920 --> 00:17:09,810
somewhere where<font color="#CCCCCC"> we can write</font><font color="#E5E5E5"> and if we</font>

358
00:17:07,619 --> 00:17:13,169
can<font color="#E5E5E5"> write there we could just drop a</font>

359
00:17:09,810 --> 00:17:16,800
docx file but then we need to lure user

360
00:17:13,170 --> 00:17:19,350
towards that<font color="#CCCCCC"> that's kind of tricky</font><font color="#E5E5E5"> so I</font>

361
00:17:16,800 --> 00:17:21,060
know the other thing is these are<font color="#CCCCCC"> kind</font>

362
00:17:19,349 --> 00:17:22,619
<font color="#E5E5E5">of tricks where we don't know if the</font>

363
00:17:21,060 --> 00:17:24,810
defenders are looking so they may be

364
00:17:22,619 --> 00:17:26,639
doing<font color="#E5E5E5"> periodic checks on these file</font>

365
00:17:24,810 --> 00:17:29,190
shares<font color="#E5E5E5"> is there something happening</font>

366
00:17:26,640 --> 00:17:32,450
there<font color="#E5E5E5"> so one of the tricks we</font><font color="#CCCCCC"> can do</font>

367
00:17:29,190 --> 00:17:35,220
there is we copy just<font color="#E5E5E5"> our evil dot file</font>

368
00:17:32,450 --> 00:17:36,900
but we<font color="#CCCCCC"> now</font><font color="#E5E5E5"> rename it I mean we move it</font>

369
00:17:35,220 --> 00:17:39,930
to<font color="#E5E5E5"> this news network location but we now</font>

370
00:17:36,900 --> 00:17:41,970
rename it<font color="#CCCCCC"> Tim's the VB well that's</font>

371
00:17:39,930 --> 00:17:45,570
certainly not not suspicious<font color="#E5E5E5"> no one will</font>

372
00:17:41,970 --> 00:17:48,270
check the<font color="#CCCCCC"> total VB then in our</font><font color="#E5E5E5"> own lab</font>

373
00:17:45,570 --> 00:17:50,580
we will prep a file which is called

374
00:17:48,270 --> 00:18:01,920
<font color="#E5E5E5">invitation</font><font color="#CCCCCC"> da</font><font color="#E5E5E5"> da</font><font color="#CCCCCC"> packs</font><font color="#E5E5E5"> and we will just</font>

375
00:17:50,580 --> 00:18:05,370
include a full reference<font color="#E5E5E5"> to a pulp no it</font>

376
00:18:01,920 --> 00:18:07,590
should be<font color="#E5E5E5"> doc sorry and then we just</font>

377
00:18:05,370 --> 00:18:10,139
sent<font color="#CCCCCC"> one email</font><font color="#E5E5E5"> to a domain admin saying</font>

378
00:18:07,590 --> 00:18:11,669
new domain admin<font color="#E5E5E5"> there is this event</font>

379
00:18:10,140 --> 00:18:14,370
<font color="#E5E5E5">it's the Christmas</font><font color="#CCCCCC"> event</font>

380
00:18:11,670 --> 00:18:17,010
<font color="#E5E5E5">could you please</font><font color="#CCCCCC"> participate and this</font>

381
00:18:14,370 --> 00:18:19,800
email<font color="#E5E5E5"> will pass the box it will proxy it</font>

382
00:18:17,010 --> 00:18:21,600
will pass<font color="#E5E5E5"> spam filters because it is</font>

383
00:18:19,800 --> 00:18:23,730
kind of a<font color="#E5E5E5"> legit email the document</font>

384
00:18:21,600 --> 00:18:25,439
<font color="#CCCCCC">itself it's it</font><font color="#E5E5E5"> doesn't have any payload</font>

385
00:18:23,730 --> 00:18:29,400
<font color="#E5E5E5">in it because the payload is already on</font>

386
00:18:25,440 --> 00:18:31,230
<font color="#E5E5E5">that work so we can yeah this will most</font>

387
00:18:29,400 --> 00:18:32,790
<font color="#E5E5E5">likely be executed the only thing now</font>

388
00:18:31,230 --> 00:18:34,710
holding<font color="#E5E5E5"> us back is this protected</font><font color="#CCCCCC"> mode</font>

389
00:18:32,790 --> 00:18:36,149
but we have<font color="#E5E5E5"> with</font><font color="#CCCCCC"> some social</font><font color="#E5E5E5"> engineering</font>

390
00:18:34,710 --> 00:18:37,350
<font color="#E5E5E5">the</font><font color="#CCCCCC"> get bigger I will really click I</font>

391
00:18:36,150 --> 00:18:41,400
mean we could<font color="#E5E5E5"> just make the document</font>

392
00:18:37,350 --> 00:18:43,500
convincing<font color="#CCCCCC"> and that brings us so</font><font color="#E5E5E5"> that's</font>

393
00:18:41,400 --> 00:18:46,070
good directly from just one<font color="#E5E5E5"> variable</font>

394
00:18:43,500 --> 00:18:48,510
<font color="#E5E5E5">file access doing an outside email</font>

395
00:18:46,070 --> 00:18:50,370
<font color="#E5E5E5">bring-bring</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> main access credentials</font>

396
00:18:48,510 --> 00:18:53,910
<font color="#E5E5E5">the main</font><font color="#CCCCCC"> illustrator access credentials</font>

397
00:18:50,370 --> 00:18:56,040
in<font color="#E5E5E5"> in our in our in</font><font color="#CCCCCC"> our</font><font color="#E5E5E5"> hands and the</font>

398
00:18:53,910 --> 00:18:58,230
nice<font color="#CCCCCC"> thing is that for</font><font color="#E5E5E5"> an investigation</font>

399
00:18:56,040 --> 00:19:00,780
<font color="#E5E5E5">this is really hard to track because you</font>

400
00:18:58,230 --> 00:19:02,310
see<font color="#E5E5E5"> emails on the outside fire and you</font>

401
00:19:00,780 --> 00:19:04,530
see if<font color="#E5E5E5"> meals dropped on the inside and</font>

402
00:19:02,310 --> 00:19:07,139
<font color="#E5E5E5">somehow they are connected so if you</font>

403
00:19:04,530 --> 00:19:08,580
would if we apply this like the blue

404
00:19:07,140 --> 00:19:10,080
<font color="#CCCCCC">teams they really they don't</font><font color="#E5E5E5"> know where</font>

405
00:19:08,580 --> 00:19:11,460
<font color="#E5E5E5">to look for</font><font color="#CCCCCC"> because it's so hard to</font>

406
00:19:10,080 --> 00:19:14,939
detect<font color="#E5E5E5"> this that this these kind of</font>

407
00:19:11,460 --> 00:19:16,860
tricks<font color="#E5E5E5"> are going on but we're not always</font>

408
00:19:14,940 --> 00:19:18,480
<font color="#CCCCCC">all</font><font color="#E5E5E5"> that lucky I mean we see these</font>

409
00:19:16,860 --> 00:19:20,760
trusted<font color="#CCCCCC"> Network locations in</font>

410
00:19:18,480 --> 00:19:24,960
after half<font color="#E5E5E5"> of our engagements but it's</font>

411
00:19:20,760 --> 00:19:27,000
not always that<font color="#E5E5E5"> kind of luck so then</font>

412
00:19:24,960 --> 00:19:29,340
there's always this idea<font color="#CCCCCC"> of</font><font color="#E5E5E5"> backdooring</font>

413
00:19:27,000 --> 00:19:32,120
legit documents<font color="#E5E5E5"> so just taking a file</font>

414
00:19:29,340 --> 00:19:34,260
share<font color="#E5E5E5"> and backdoor the documents on them</font>

415
00:19:32,120 --> 00:19:36,060
but<font color="#E5E5E5"> if we</font><font color="#CCCCCC"> would just back to our</font>

416
00:19:34,260 --> 00:19:38,910
documents we kind of have problems

417
00:19:36,060 --> 00:19:41,040
<font color="#E5E5E5">people copy</font><font color="#CCCCCC"> I just employees</font><font color="#E5E5E5"> or our</font>

418
00:19:38,910 --> 00:19:42,270
<font color="#E5E5E5">users copy Word documents copy</font><font color="#CCCCCC"> excel</font>

419
00:19:41,040 --> 00:19:42,780
documents and we don't know where they

420
00:19:42,270 --> 00:19:47,220
end<font color="#E5E5E5"> up</font>

421
00:19:42,780 --> 00:19:50,040
so our virus ends up everywhere<font color="#CCCCCC"> so we</font>

422
00:19:47,220 --> 00:19:51,560
want to<font color="#E5E5E5"> have control and if there's</font>

423
00:19:50,040 --> 00:19:54,680
something<font color="#CCCCCC"> suspicious and</font><font color="#E5E5E5"> someone</font>

424
00:19:51,560 --> 00:19:56,700
forwards it<font color="#CCCCCC"> to the blue team or the SAR</font>

425
00:19:54,680 --> 00:19:58,170
we're not really happy<font color="#E5E5E5"> with that</font><font color="#CCCCCC"> we're</font>

426
00:19:56,700 --> 00:20:01,050
<font color="#E5E5E5">that way of working</font><font color="#CCCCCC"> off work back during</font>

427
00:19:58,170 --> 00:20:05,400
<font color="#E5E5E5">a legit file so what we do is</font><font color="#CCCCCC"> another</font>

428
00:20:01,050 --> 00:20:09,690
trick<font color="#E5E5E5"> we copy an empty dot file or go</font>

429
00:20:05,400 --> 00:20:12,030
<font color="#CCCCCC">time to just a random</font><font color="#E5E5E5"> file SIA and on</font>

430
00:20:09,690 --> 00:20:13,980
that random file share we set<font color="#E5E5E5"> the</font>

431
00:20:12,030 --> 00:20:16,110
<font color="#E5E5E5">permissions we uploaded the file so any</font>

432
00:20:13,980 --> 00:20:17,610
user in your<font color="#E5E5E5"> domain can do that</font><font color="#CCCCCC"> he's the</font>

433
00:20:16,110 --> 00:20:19,439
owner of<font color="#E5E5E5"> the file so he can set the</font>

434
00:20:17,610 --> 00:20:21,860
<font color="#E5E5E5">permissions</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> we just say well this</font>

435
00:20:19,440 --> 00:20:24,810
file is open to all<font color="#E5E5E5"> the main users and</font>

436
00:20:21,860 --> 00:20:27,300
in a<font color="#E5E5E5"> typical setup on the network you</font>

437
00:20:24,810 --> 00:20:30,000
have<font color="#E5E5E5"> like two protections on how shares</font>

438
00:20:27,300 --> 00:20:32,310
are secured<font color="#E5E5E5"> and</font><font color="#CCCCCC"> the share level</font><font color="#E5E5E5"> and the</font>

439
00:20:30,000 --> 00:20:34,470
file level of the share level<font color="#E5E5E5"> typical</font>

440
00:20:32,310 --> 00:20:38,810
<font color="#CCCCCC">setup is have all the main users</font><font color="#E5E5E5"> accept</font>

441
00:20:34,470 --> 00:20:41,790
<font color="#E5E5E5">it so everybody can now access this file</font>

442
00:20:38,810 --> 00:20:44,190
then we<font color="#CCCCCC"> start looking for</font><font color="#E5E5E5"> interesting</font>

443
00:20:41,790 --> 00:20:46,020
files<font color="#E5E5E5"> everything there's an</font><font color="#CCCCCC"> interested</font>

444
00:20:44,190 --> 00:20:48,000
<font color="#E5E5E5">in our script find interesting files</font>

445
00:20:46,020 --> 00:20:51,360
<font color="#E5E5E5">we'll just search for files that have</font>

446
00:20:48,000 --> 00:20:54,300
<font color="#CCCCCC">been recently accessed</font><font color="#E5E5E5"> in the last seven</font>

447
00:20:51,360 --> 00:20:56,580
days<font color="#CCCCCC"> and where we</font><font color="#E5E5E5"> have write access so</font>

448
00:20:54,300 --> 00:20:58,530
let's just start looking<font color="#CCCCCC"> for all the</font>

449
00:20:56,580 --> 00:21:01,949
files<font color="#CCCCCC"> that</font><font color="#E5E5E5"> our user has that is</font>

450
00:20:58,530 --> 00:21:07,250
somewhere in use last seven days and

451
00:21:01,950 --> 00:21:09,630
<font color="#CCCCCC">what we do is we just reference all the</font>

452
00:21:07,250 --> 00:21:11,790
<font color="#E5E5E5">all these</font><font color="#CCCCCC"> documents to this</font><font color="#E5E5E5"> empty</font>

453
00:21:09,630 --> 00:21:14,820
<font color="#E5E5E5">Dartford</font><font color="#CCCCCC"> this empty dot file we just</font>

454
00:21:11,790 --> 00:21:16,409
created<font color="#CCCCCC"> so nothing is changing we're</font>

455
00:21:14,820 --> 00:21:18,950
just making references and how we do

456
00:21:16,410 --> 00:21:21,390
this well that's the link there

457
00:21:18,950 --> 00:21:23,460
<font color="#E5E5E5">yesterday I put out put it on github</font>

458
00:21:21,390 --> 00:21:25,050
<font color="#CCCCCC">this is a</font><font color="#E5E5E5"> script free world for doing</font>

459
00:21:23,460 --> 00:21:27,930
<font color="#CCCCCC">this</font><font color="#E5E5E5"> and the script is</font><font color="#CCCCCC"> really simple</font>

460
00:21:25,050 --> 00:21:28,950
<font color="#E5E5E5">unzip this</font><font color="#CCCCCC"> doc this</font><font color="#E5E5E5"> doc file formats</font>

461
00:21:27,930 --> 00:21:31,050
<font color="#E5E5E5">parse</font>

462
00:21:28,950 --> 00:21:32,160
<font color="#CCCCCC">firstly xml's update</font><font color="#E5E5E5"> this template</font>

463
00:21:31,050 --> 00:21:36,180
location<font color="#E5E5E5"> and zip it</font>

464
00:21:32,160 --> 00:21:37,890
back again so there we are we<font color="#E5E5E5"> have a lot</font>

465
00:21:36,180 --> 00:21:41,640
of<font color="#E5E5E5"> files now referencing our</font><font color="#CCCCCC"> template</font>

466
00:21:37,890 --> 00:21:44,430
and then we come with represent

467
00:21:41,640 --> 00:21:47,100
<font color="#E5E5E5">so we place our back door in this file</font>

468
00:21:44,430 --> 00:21:49,740
and<font color="#E5E5E5"> then all over</font><font color="#CCCCCC"> the place people will</font>

469
00:21:47,100 --> 00:21:52,439
get<font color="#CCCCCC"> marker warnings</font><font color="#E5E5E5"> we get a lot of</font>

470
00:21:49,740 --> 00:21:55,110
beacons or whatever we use flying into

471
00:21:52,440 --> 00:21:56,610
<font color="#CCCCCC">our network and if we say well we're now</font>

472
00:21:55,110 --> 00:21:59,189
<font color="#CCCCCC">running this for half an hour this</font><font color="#E5E5E5"> is</font>

473
00:21:56,610 --> 00:22:01,229
sufficient<font color="#E5E5E5"> we just remove this payload</font>

474
00:21:59,190 --> 00:22:04,410
from this at this dot<font color="#CCCCCC"> M file and it's</font>

475
00:22:01,230 --> 00:22:06,120
gone<font color="#CCCCCC"> if people for if M pleased with</font>

476
00:22:04,410 --> 00:22:07,740
<font color="#CCCCCC">forward</font><font color="#E5E5E5"> documents to the shock there's</font>

477
00:22:06,120 --> 00:22:11,159
nothing in these<font color="#E5E5E5"> documents because</font><font color="#CCCCCC"> it's</font>

478
00:22:07,740 --> 00:22:13,950
in the template you<font color="#E5E5E5"> can even go steps</font>

479
00:22:11,160 --> 00:22:16,800
further we can<font color="#E5E5E5"> outer</font><font color="#CCCCCC"> we can control time</font>

480
00:22:13,950 --> 00:22:19,170
<font color="#E5E5E5">by by</font><font color="#CCCCCC"> doing this</font><font color="#E5E5E5"> inserting the</font><font color="#CCCCCC"> preparer</font>

481
00:22:16,800 --> 00:22:22,169
allow it or not<font color="#E5E5E5"> we can also control</font><font color="#CCCCCC"> the</font>

482
00:22:19,170 --> 00:22:23,550
<font color="#CCCCCC">victims</font><font color="#E5E5E5"> I expressly set that all the</font>

483
00:22:22,170 --> 00:22:25,950
main users are allowed to<font color="#E5E5E5"> read this file</font>

484
00:22:23,550 --> 00:22:28,530
<font color="#E5E5E5">what if I say well all the manuals</font>

485
00:22:25,950 --> 00:22:30,660
except for the blue team or maybe I'm

486
00:22:28,530 --> 00:22:32,490
directing this department<font color="#E5E5E5"> let's set</font>

487
00:22:30,660 --> 00:22:34,770
permissions<font color="#E5E5E5"> that only this department or</font>

488
00:22:32,490 --> 00:22:36,420
this guy gets this at this<font color="#E5E5E5"> marker</font>

489
00:22:34,770 --> 00:22:38,160
warning and all other<font color="#E5E5E5"> people who open</font>

490
00:22:36,420 --> 00:22:41,460
this file will just see this normal

491
00:22:38,160 --> 00:22:44,160
<font color="#E5E5E5">though this normal</font><font color="#CCCCCC"> reference so that's</font>

492
00:22:41,460 --> 00:22:45,720
kind of<font color="#E5E5E5"> a nifty</font><font color="#CCCCCC"> trick</font><font color="#E5E5E5"> there's a lot more</font>

493
00:22:44,160 --> 00:22:47,580
work<font color="#CCCCCC"> to be</font><font color="#E5E5E5"> done</font><font color="#CCCCCC"> on these templates we</font>

494
00:22:45,720 --> 00:22:50,100
have a lot of<font color="#CCCCCC"> IDs</font><font color="#E5E5E5"> this research is</font>

495
00:22:47,580 --> 00:22:52,860
certainly not completed I mean including

496
00:22:50,100 --> 00:22:55,560
<font color="#E5E5E5">doing this by combining it with a</font>

497
00:22:52,860 --> 00:22:58,260
responder<font color="#E5E5E5"> and just having air I think</font>

498
00:22:55,560 --> 00:23:00,240
hashes being realized<font color="#E5E5E5"> is also a version</font>

499
00:22:58,260 --> 00:23:02,550
<font color="#E5E5E5">or variant we were thinking about so</font>

500
00:23:00,240 --> 00:23:05,220
there's a lot<font color="#E5E5E5"> of a future work in this</font>

501
00:23:02,550 --> 00:23:08,330
<font color="#E5E5E5">area we</font><font color="#CCCCCC"> think</font><font color="#E5E5E5"> this is already bring some</font>

502
00:23:05,220 --> 00:23:08,330
cool<font color="#CCCCCC"> tricks into</font><font color="#E5E5E5"> our playbook</font>

503
00:23:14,360 --> 00:23:27,600
now let's go<font color="#E5E5E5"> bag very</font><font color="#CCCCCC"> good</font><font color="#E5E5E5"> let's go to</font>

504
00:23:23,160 --> 00:23:31,020
<font color="#E5E5E5">our third and final trick smooth as silk</font>

505
00:23:27,600 --> 00:23:33,419
<font color="#CCCCCC">and</font><font color="#E5E5E5"> it's the oldest trick</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> the magic</font>

506
00:23:31,020 --> 00:23:37,440
book<font color="#E5E5E5"> because with this trick we're only</font>

507
00:23:33,420 --> 00:23:41,880
going<font color="#CCCCCC"> to</font><font color="#E5E5E5"> use technology techniques that</font>

508
00:23:37,440 --> 00:23:45,690
<font color="#CCCCCC">are at least 25 years old</font><font color="#E5E5E5"> so who of you</font>

509
00:23:41,880 --> 00:23:47,250
are younger than<font color="#E5E5E5"> 25 okay so it is</font><font color="#CCCCCC"> stiff</font>

510
00:23:45,690 --> 00:23:48,210
<font color="#CCCCCC">that we're going to</font><font color="#E5E5E5"> use here</font><font color="#CCCCCC"> is older</font>

511
00:23:47,250 --> 00:23:52,710
than<font color="#E5E5E5"> you guys</font><font color="#CCCCCC"> are</font>

512
00:23:48,210 --> 00:23:56,820
and it<font color="#E5E5E5"> actually still works</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> the most</font>

513
00:23:52,710 --> 00:23:57,630
recent office versions so let's see what

514
00:23:56,820 --> 00:23:59,780
I'm talking about

515
00:23:57,630 --> 00:24:01,890
we're going back<font color="#E5E5E5"> to our</font><font color="#CCCCCC"> demo environment</font>

516
00:23:59,780 --> 00:24:13,680
<font color="#E5E5E5">let's clean up the mess</font><font color="#CCCCCC"> that Peter left</font>

517
00:24:01,890 --> 00:24:18,780
<font color="#CCCCCC">just as I did</font><font color="#E5E5E5"> for him</font><font color="#CCCCCC"> I'll browser click</font>

518
00:24:13,680 --> 00:24:21,780
here for<font color="#E5E5E5"> demo tree to download a file do</font>

519
00:24:18,780 --> 00:24:27,980
you want to download demo tree<font color="#CCCCCC"> oh that's</font>

520
00:24:21,780 --> 00:24:31,740
<font color="#CCCCCC">okay</font><font color="#E5E5E5"> wait what 99 bytes just 99 bytes</font>

521
00:24:27,980 --> 00:24:37,680
that's interesting let's<font color="#E5E5E5"> download this</font>

522
00:24:31,740 --> 00:24:40,560
file<font color="#E5E5E5"> okay let's go to</font><font color="#CCCCCC"> disk where it's</font>

523
00:24:37,680 --> 00:24:43,950
been downloaded<font color="#E5E5E5"> now now indeed see demo</font>

524
00:24:40,560 --> 00:24:46,830
<font color="#E5E5E5">trade oh that's</font><font color="#CCCCCC"> okay</font><font color="#E5E5E5"> if i</font><font color="#CCCCCC"> zoom in on</font>

525
00:24:43,950 --> 00:24:57,480
here<font color="#E5E5E5"> I see indeed it's really is 99</font>

526
00:24:46,830 --> 00:24:58,678
bytes let's open the file this is

527
00:24:57,480 --> 00:25:00,870
interesting I'm not sure if you're

528
00:24:58,679 --> 00:25:02,600
<font color="#E5E5E5">noticing but if you look at the warning</font>

529
00:25:00,870 --> 00:25:05,580
as being displayed here

530
00:25:02,600 --> 00:25:08,760
it's a<font color="#CCCCCC"> macro warning immediately</font>

531
00:25:05,580 --> 00:25:10,260
<font color="#E5E5E5">although</font><font color="#CCCCCC"> I've downloaded this file</font><font color="#E5E5E5"> which</font>

532
00:25:08,760 --> 00:25:13,890
<font color="#E5E5E5">means that it should</font><font color="#CCCCCC"> have out within</font>

533
00:25:10,260 --> 00:25:15,780
protected<font color="#E5E5E5"> view right so for one reason</font>

534
00:25:13,890 --> 00:25:18,480
or another I'm not<font color="#E5E5E5"> hitting protected for</font>

535
00:25:15,780 --> 00:25:21,450
you here<font color="#E5E5E5"> but I'm immediately being sent</font>

536
00:25:18,480 --> 00:25:25,200
straight towards the macro warning<font color="#E5E5E5"> but I</font>

537
00:25:21,450 --> 00:25:26,790
don't see any macro<font color="#E5E5E5"> whatever</font><font color="#CCCCCC"> back</font><font color="#E5E5E5"> I'll</font>

538
00:25:25,200 --> 00:25:28,950
click<font color="#E5E5E5"> I don't</font><font color="#CCCCCC"> see anything</font><font color="#E5E5E5"> but I'll</font>

539
00:25:26,790 --> 00:25:33,049
click enable content<font color="#E5E5E5"> and there's my</font>

540
00:25:28,950 --> 00:25:36,090
calculator<font color="#E5E5E5"> 99 bytes</font>

541
00:25:33,049 --> 00:25:43,650
let's see where the macro is go to the

542
00:25:36,090 --> 00:25:47,610
macro editor nothing there<font color="#CCCCCC"> Wow what kind</font>

543
00:25:43,650 --> 00:25:54,570
of file is this it's just<font color="#E5E5E5"> an ASCII text</font>

544
00:25:47,610 --> 00:25:55,260
file<font color="#CCCCCC"> that's</font><font color="#E5E5E5"> Frick free so what happened</font>

545
00:25:54,570 --> 00:25:58,850
here

546
00:25:55,260 --> 00:26:01,590
I see some puzzled faces<font color="#E5E5E5"> which is good</font>

547
00:25:58,850 --> 00:26:05,129
<font color="#CCCCCC">let's let's first of all start with what</font>

548
00:26:01,590 --> 00:26:09,418
a silk file is silk stands for a

549
00:26:05,130 --> 00:26:11,700
symbolic link<font color="#CCCCCC"> it's a file</font><font color="#E5E5E5"> format that</font>

550
00:26:09,419 --> 00:26:16,200
<font color="#CCCCCC">has</font><font color="#E5E5E5"> been developed by Microsoft in</font><font color="#CCCCCC"> the</font>

551
00:26:11,700 --> 00:26:18,750
1980s<font color="#CCCCCC"> I believe it's in</font><font color="#E5E5E5"> red somewhere</font>

552
00:26:16,200 --> 00:26:22,440
around 1984 which means it's<font color="#E5E5E5"> exactly as</font>

553
00:26:18,750 --> 00:26:25,350
old as I am and it<font color="#CCCCCC"> was introduced for</font>

554
00:26:22,440 --> 00:26:28,520
exchanging spreadsheet data with other

555
00:26:25,350 --> 00:26:33,030
programs<font color="#E5E5E5"> than Microsoft Excel programs</font>

556
00:26:28,520 --> 00:26:35,879
it's a completely text-based<font color="#CCCCCC"> sq file</font>

557
00:26:33,030 --> 00:26:39,149
format<font color="#CCCCCC"> there's nothing binary in there</font>

558
00:26:35,880 --> 00:26:43,830
it's<font color="#E5E5E5"> all ASCII and the</font><font color="#CCCCCC"> S okay</font><font color="#E5E5E5"> extension</font>

559
00:26:39,150 --> 00:26:46,679
is associated with<font color="#E5E5E5"> Excel by default Feb</font>

560
00:26:43,830 --> 00:26:50,580
2 and including the latest<font color="#E5E5E5"> office 2016</font>

561
00:26:46,679 --> 00:26:53,790
versions<font color="#CCCCCC"> met Nelson from</font><font color="#E5E5E5"> spectral ops</font>

562
00:26:50,580 --> 00:26:55,350
<font color="#E5E5E5">already showed that</font><font color="#CCCCCC"> this can be can be</font>

563
00:26:53,790 --> 00:26:58,980
weaponized<font color="#E5E5E5"> fire</font><font color="#CCCCCC"> dde</font>

564
00:26:55,350 --> 00:27:01,379
so apparently can you use DD in here and

565
00:26:58,980 --> 00:27:03,630
do execution with that but we go a step

566
00:27:01,380 --> 00:27:07,559
<font color="#CCCCCC">further</font><font color="#E5E5E5"> but what is really</font><font color="#CCCCCC"> interesting</font>

567
00:27:03,630 --> 00:27:10,409
<font color="#CCCCCC">to note is that</font><font color="#E5E5E5"> by design</font><font color="#CCCCCC"> because it is</font>

568
00:27:07,559 --> 00:27:11,190
a<font color="#CCCCCC"> text-based</font><font color="#E5E5E5"> file formats silk files</font>

569
00:27:10,409 --> 00:27:12,690
<font color="#E5E5E5">will</font>

570
00:27:11,190 --> 00:27:16,040
never be opened in the<font color="#E5E5E5"> protected few</font>

571
00:27:12,690 --> 00:27:19,020
sandbox so all text-based files

572
00:27:16,040 --> 00:27:22,200
including CSV etc will never be opened

573
00:27:19,020 --> 00:27:23,610
in<font color="#E5E5E5"> the protected few sandbox by</font><font color="#CCCCCC"> Markus</font>

574
00:27:22,200 --> 00:27:27,450
with office applications so<font color="#CCCCCC"> that also</font>

575
00:27:23,610 --> 00:27:29,939
applies to<font color="#CCCCCC"> Sok files ok this</font><font color="#E5E5E5"> is a little</font>

576
00:27:27,450 --> 00:27:32,880
bit of background on<font color="#E5E5E5"> Sok files but what</font>

577
00:27:29,940 --> 00:27:35,910
can<font color="#E5E5E5"> you put in there</font><font color="#CCCCCC"> in the</font><font color="#E5E5E5"> beginning I</font>

578
00:27:32,880 --> 00:27:37,830
had no clue<font color="#E5E5E5"> so I started looking at</font><font color="#CCCCCC"> some</font>

579
00:27:35,910 --> 00:27:38,280
<font color="#CCCCCC">simple examples that I</font><font color="#E5E5E5"> could find on the</font>

580
00:27:37,830 --> 00:27:42,629
<font color="#E5E5E5">web</font>

581
00:27:38,280 --> 00:27:45,810
this is<font color="#CCCCCC"> a basic silk faux silk works</font>

582
00:27:42,630 --> 00:27:49,440
with lines and each line is called a

583
00:27:45,810 --> 00:27:52,800
record<font color="#E5E5E5"> and it starts with a record type</font>

584
00:27:49,440 --> 00:27:55,080
<font color="#E5E5E5">and then I semicolon and then a number</font>

585
00:27:52,800 --> 00:27:56,940
of<font color="#E5E5E5"> fields that you can use</font><font color="#CCCCCC"> after that</font><font color="#E5E5E5"> so</font>

586
00:27:55,080 --> 00:28:01,500
let's look at this<font color="#E5E5E5"> example</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> first</font>

587
00:27:56,940 --> 00:28:05,610
line<font color="#E5E5E5"> slash ID p ID is obligatory for</font>

588
00:28:01,500 --> 00:28:08,130
<font color="#CCCCCC">every silk file to</font><font color="#E5E5E5"> start with P is the</font>

589
00:28:05,610 --> 00:28:10,050
field where you<font color="#E5E5E5"> can specify the program</font>

590
00:28:08,130 --> 00:28:12,600
that is<font color="#E5E5E5"> used for this silk file but you</font>

591
00:28:10,050 --> 00:28:19,139
<font color="#CCCCCC">can leave it empty and then we see a</font>

592
00:28:12,600 --> 00:28:20,909
<font color="#E5E5E5">number</font><font color="#CCCCCC"> of C C records and let's</font><font color="#E5E5E5"> look at</font>

593
00:28:19,140 --> 00:28:23,820
the first<font color="#E5E5E5"> C record for example it says C</font>

594
00:28:20,910 --> 00:28:28,310
which<font color="#E5E5E5"> means cell this cell is located at</font>

595
00:28:23,820 --> 00:28:31,050
Y<font color="#E5E5E5"> 1</font><font color="#CCCCCC"> X 1</font><font color="#E5E5E5"> which means</font><font color="#CCCCCC"> row 1 column 1 and</font>

596
00:28:28,310 --> 00:28:33,750
<font color="#E5E5E5">then there's the value which is defined</font>

597
00:28:31,050 --> 00:28:38,490
by<font color="#CCCCCC"> K this</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> Row 1</font><font color="#E5E5E5"> so we also specify</font>

598
00:28:33,750 --> 00:28:42,000
Row 2 and Row 3 in in column<font color="#E5E5E5"> 1 and then</font>

599
00:28:38,490 --> 00:28:44,160
we specify numeric values for Row<font color="#E5E5E5"> 1 2</font>

600
00:28:42,000 --> 00:28:46,530
<font color="#CCCCCC">and</font><font color="#E5E5E5"> 3 in column 2 and then at the last</font>

601
00:28:44,160 --> 00:28:49,130
there's the e record which says end of

602
00:28:46,530 --> 00:28:53,220
the silk file<font color="#E5E5E5"> this is a basic silk file</font>

603
00:28:49,130 --> 00:28:55,650
that's pretty easy<font color="#E5E5E5"> but the question is</font>

604
00:28:53,220 --> 00:28:58,680
what<font color="#E5E5E5"> other stuff can I do with a silk</font>

605
00:28:55,650 --> 00:29:00,840
file this took me quite<font color="#CCCCCC"> some time to</font>

606
00:28:58,680 --> 00:29:03,330
<font color="#E5E5E5">figure out</font><font color="#CCCCCC"> I got</font><font color="#E5E5E5"> my hands on an</font>

607
00:29:00,840 --> 00:29:05,939
excellent<font color="#E5E5E5"> book which is called the file</font>

608
00:29:03,330 --> 00:29:09,389
format hands book by<font color="#CCCCCC"> Guntur born is from</font>

609
00:29:05,940 --> 00:29:11,220
1995 and there's there's<font color="#E5E5E5"> there's file</font>

610
00:29:09,390 --> 00:29:13,410
formats in<font color="#E5E5E5"> there that have died long ago</font>

611
00:29:11,220 --> 00:29:15,930
and I've never heard<font color="#E5E5E5"> of it could</font><font color="#CCCCCC"> only I</font>

612
00:29:13,410 --> 00:29:17,610
could only buy it<font color="#E5E5E5"> secondhand it was but</font>

613
00:29:15,930 --> 00:29:19,560
it's a<font color="#E5E5E5"> great book</font><font color="#CCCCCC"> it's</font><font color="#E5E5E5"> really</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> great</font>

614
00:29:17,610 --> 00:29:23,520
<font color="#E5E5E5">book so if you can get it</font><font color="#CCCCCC"> get a copy</font><font color="#E5E5E5"> of</font>

615
00:29:19,560 --> 00:29:26,070
it<font color="#CCCCCC"> and there's also a</font><font color="#E5E5E5"> really answering</font>

616
00:29:23,520 --> 00:29:29,070
vacation<font color="#E5E5E5"> it's a foul called silk simple</font>

617
00:29:26,070 --> 00:29:30,570
<font color="#E5E5E5">silks and</font><font color="#CCCCCC"> duck</font><font color="#E5E5E5"> which has been made by</font>

618
00:29:29,070 --> 00:29:33,360
Microsoft and<font color="#E5E5E5"> it's floating around the</font>

619
00:29:30,570 --> 00:29:34,889
<font color="#CCCCCC">internet there's no really good URL so I</font>

620
00:29:33,360 --> 00:29:36,990
can point to<font color="#E5E5E5"> but if you just Google</font><font color="#CCCCCC"> for</font>

621
00:29:34,890 --> 00:29:38,760
<font color="#E5E5E5">it you will definitely find it it's not</font>

622
00:29:36,990 --> 00:29:40,350
<font color="#CCCCCC">a dog file it's actually an esky text</font>

623
00:29:38,760 --> 00:29:44,400
file that<font color="#CCCCCC"> they</font><font color="#E5E5E5"> named the</font><font color="#CCCCCC"> dog</font><font color="#E5E5E5"> but that's</font>

624
00:29:40,350 --> 00:29:46,439
<font color="#E5E5E5">because this stuff</font><font color="#CCCCCC"> is so old if you look</font>

625
00:29:44,400 --> 00:29:48,780
into silks<font color="#E5E5E5"> and the dog into</font><font color="#CCCCCC"> the</font>

626
00:29:46,440 --> 00:29:51,890
specification<font color="#CCCCCC"> there is this</font><font color="#E5E5E5"> following</font>

627
00:29:48,780 --> 00:29:55,410
line which which<font color="#E5E5E5"> completely caught me</font>

628
00:29:51,890 --> 00:29:56,760
<font color="#E5E5E5">micro</font><font color="#CCCCCC"> executable sheet</font><font color="#E5E5E5"> note that this</font>

629
00:29:55,410 --> 00:29:59,070
should appear before the first

630
00:29:56,760 --> 00:30:01,080
occurrence of G or<font color="#CCCCCC"> F field and an</font><font color="#E5E5E5"> N and</font>

631
00:29:59,070 --> 00:30:03,540
records<font color="#E5E5E5"> although was not enabled</font><font color="#CCCCCC"> in</font>

632
00:30:01,080 --> 00:30:06,060
<font color="#E5E5E5">Excel also before this first C record</font>

633
00:30:03,540 --> 00:30:09,120
which uses a marker only function<font color="#CCCCCC"> I had</font>

634
00:30:06,060 --> 00:30:10,139
no clue what<font color="#CCCCCC"> this was</font><font color="#E5E5E5"> saying</font><font color="#CCCCCC"> but I had</font>

635
00:30:09,120 --> 00:30:12,959
<font color="#CCCCCC">just one question</font>

636
00:30:10,140 --> 00:30:16,620
wait what can I do macros in a plain

637
00:30:12,960 --> 00:30:20,640
<font color="#E5E5E5">text file in a plain text</font><font color="#CCCCCC"> so far and</font>

638
00:30:16,620 --> 00:30:22,889
<font color="#E5E5E5">apparently yes you can so poppy</font>

639
00:30:20,640 --> 00:30:26,880
calculator<font color="#CCCCCC"> in less than 100 bytes</font><font color="#E5E5E5"> you</font>

640
00:30:22,890 --> 00:30:29,220
see it right<font color="#CCCCCC"> here</font><font color="#E5E5E5"> it looks really</font>

641
00:30:26,880 --> 00:30:31,290
<font color="#CCCCCC">trivial but it took</font><font color="#E5E5E5"> me hours</font><font color="#CCCCCC"> and hours</font>

642
00:30:29,220 --> 00:30:33,150
to<font color="#CCCCCC"> find this out actually this is a</font>

643
00:30:31,290 --> 00:30:36,300
shame if<font color="#CCCCCC"> you look at how trivial the</font>

644
00:30:33,150 --> 00:30:39,600
<font color="#E5E5E5">code is so what does it do first line is</font>

645
00:30:36,300 --> 00:30:44,430
every silk file ID with P leaving empty

646
00:30:39,600 --> 00:30:47,280
then there's a<font color="#E5E5E5"> whole record with he</font>

647
00:30:44,430 --> 00:30:48,810
being specified<font color="#E5E5E5"> and this means according</font>

648
00:30:47,280 --> 00:30:54,200
<font color="#E5E5E5">to the specification</font><font color="#CCCCCC"> that I'm</font>

649
00:30:48,810 --> 00:30:57,870
<font color="#CCCCCC">introducing a macro sheet into</font><font color="#E5E5E5"> my file</font>

650
00:30:54,200 --> 00:31:00,990
then<font color="#CCCCCC"> there's a an</font><font color="#E5E5E5"> end record which</font>

651
00:30:57,870 --> 00:31:04,159
specifies that a function named<font color="#CCCCCC"> Auto</font>

652
00:31:00,990 --> 00:31:08,190
<font color="#E5E5E5">open is to</font><font color="#CCCCCC"> be introduced at</font><font color="#E5E5E5"> row-one</font>

653
00:31:04,160 --> 00:31:10,500
column-one<font color="#E5E5E5"> and whatever comes</font><font color="#CCCCCC"> after that</font>

654
00:31:08,190 --> 00:31:12,930
that's just<font color="#E5E5E5"> disregarded so we didn't</font>

655
00:31:10,500 --> 00:31:15,890
care about<font color="#E5E5E5"> that then I introduced a cell</font>

656
00:31:12,930 --> 00:31:21,570
at row-one<font color="#E5E5E5"> column-one</font>

657
00:31:15,890 --> 00:31:26,490
which<font color="#E5E5E5"> says</font><font color="#CCCCCC"> x AK calc go</font><font color="#E5E5E5"> to XE then add</font>

658
00:31:21,570 --> 00:31:29,429
row<font color="#CCCCCC"> to I say halt and then end of the of</font>

659
00:31:26,490 --> 00:31:33,120
the silk file<font color="#E5E5E5"> and if you open this and</font>

660
00:31:29,430 --> 00:31:34,710
execute it<font color="#E5E5E5"> calculator pops after you</font>

661
00:31:33,120 --> 00:31:36,810
enable macros

662
00:31:34,710 --> 00:31:37,360
<font color="#E5E5E5">what I did in my trick is not to</font>

663
00:31:36,810 --> 00:31:40,570
introduce

664
00:31:37,360 --> 00:31:43,030
the macro<font color="#CCCCCC"> code at row-one column-one</font><font color="#E5E5E5"> the</font>

665
00:31:40,570 --> 00:31:46,720
tomorrow<font color="#E5E5E5"> code if</font><font color="#CCCCCC"> I go</font><font color="#E5E5E5"> there let's it's</font>

666
00:31:43,030 --> 00:31:52,350
probably still open<font color="#E5E5E5"> should be somewhere</font>

667
00:31:46,720 --> 00:31:55,330
here<font color="#E5E5E5"> so that's why I didn't see it okay</font>

668
00:31:52,350 --> 00:31:57,370
<font color="#E5E5E5">so for those</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> you are familiar with</font>

669
00:31:55,330 --> 00:31:59,500
VBA and<font color="#E5E5E5"> it's probably almost all of you</font>

670
00:31:57,370 --> 00:32:01,299
<font color="#E5E5E5">this</font><font color="#CCCCCC"> is not VBA it's something</font>

671
00:31:59,500 --> 00:32:03,220
completely<font color="#CCCCCC"> different VBA didn't even</font>

672
00:32:01,299 --> 00:32:04,200
exist by the time the silk files were

673
00:32:03,220 --> 00:32:07,690
introduced

674
00:32:04,200 --> 00:32:11,710
welcome to 92<font color="#E5E5E5"> welcome to the world of</font>

675
00:32:07,690 --> 00:32:15,040
what we call<font color="#E5E5E5"> xlm macros wait what</font>

676
00:32:11,710 --> 00:32:21,970
<font color="#E5E5E5">excellent macros</font><font color="#CCCCCC"> if you have no clue</font>

677
00:32:15,040 --> 00:32:23,860
<font color="#CCCCCC">what are excellent macros excellent</font>

678
00:32:21,970 --> 00:32:25,240
<font color="#E5E5E5">markups are way older than Clippy let's</font>

679
00:32:23,860 --> 00:32:26,049
start with that so if you think<font color="#E5E5E5"> leap</font>

680
00:32:25,240 --> 00:32:29,890
years old

681
00:32:26,049 --> 00:32:32,379
this<font color="#CCCCCC"> step is way older excellent markers</font>

682
00:32:29,890 --> 00:32:35,890
are actually<font color="#E5E5E5"> Excel 4.0 macros in Excel</font>

683
00:32:32,380 --> 00:32:40,179
4.0 was introduced in<font color="#E5E5E5"> 1992 for</font><font color="#CCCCCC"> windows</font>

684
00:32:35,890 --> 00:32:43,809
<font color="#CCCCCC">3.0 3.1 vba was introduced</font><font color="#E5E5E5"> later</font><font color="#CCCCCC"> in 1993</font>

685
00:32:40,179 --> 00:32:46,510
<font color="#E5E5E5">so by this time</font><font color="#CCCCCC"> VBA didn't even exist</font>

686
00:32:43,809 --> 00:32:49,750
<font color="#E5E5E5">forward in Excel but</font><font color="#CCCCCC"> these celeb macros</font>

687
00:32:46,510 --> 00:32:50,669
are still supported in an office 2016<font color="#CCCCCC"> it</font>

688
00:32:49,750 --> 00:32:55,570
gets<font color="#E5E5E5"> even better</font>

689
00:32:50,669 --> 00:32:59,320
they are also supported<font color="#E5E5E5"> on Mac including</font>

690
00:32:55,570 --> 00:33:02,740
in<font color="#CCCCCC"> SLK files so yes you can do a 99</font>

691
00:32:59,320 --> 00:33:08,168
<font color="#E5E5E5">bytes process creation as okay</font><font color="#CCCCCC"> file on</font>

692
00:33:02,740 --> 00:33:10,870
Mac as<font color="#E5E5E5"> well so you can embed Excel</font>

693
00:33:08,169 --> 00:33:13,390
<font color="#E5E5E5">forward</font><font color="#CCCCCC"> 4.0 macros in different file</font>

694
00:33:10,870 --> 00:33:18,040
formats<font color="#E5E5E5"> there's one file</font><font color="#CCCCCC"> format which is</font>

695
00:33:13,390 --> 00:33:19,750
<font color="#E5E5E5">really which was really being developed</font>

696
00:33:18,040 --> 00:33:21,790
to contain this which is excellent files

697
00:33:19,750 --> 00:33:23,799
and they are<font color="#E5E5E5"> actually being blocked by</font>

698
00:33:21,790 --> 00:33:25,540
recent Microsoft Office version but

699
00:33:23,799 --> 00:33:28,960
<font color="#CCCCCC">excel for all markers can still be</font>

700
00:33:25,540 --> 00:33:31,870
embedded in sheets within modern file

701
00:33:28,960 --> 00:33:34,750
formats<font color="#E5E5E5"> like</font><font color="#CCCCCC"> Excel as M</font><font color="#E5E5E5"> XLS or ancient</font>

702
00:33:31,870 --> 00:33:37,000
<font color="#E5E5E5">form file formats</font><font color="#CCCCCC"> like as</font><font color="#E5E5E5"> okay and that</font>

703
00:33:34,750 --> 00:33:40,210
still works<font color="#CCCCCC"> so you're not</font><font color="#E5E5E5"> probably</font>

704
00:33:37,000 --> 00:33:43,690
wondering how do I create<font color="#E5E5E5"> such an</font><font color="#CCCCCC"> Excel</font>

705
00:33:40,210 --> 00:33:50,170
4.0 macro in for<font color="#E5E5E5"> example XLS let's go</font>

706
00:33:43,690 --> 00:33:52,450
back to excel<font color="#E5E5E5"> file new this is Excel</font>

707
00:33:50,170 --> 00:33:56,100
I'm<font color="#E5E5E5"> creating an excel file now not</font><font color="#CCCCCC"> as</font>

708
00:33:52,450 --> 00:34:00,030
<font color="#CCCCCC">easy as okay file right click on sheet1</font>

709
00:33:56,100 --> 00:34:03,909
insert and then there's this<font color="#CCCCCC"> option here</font>

710
00:34:00,030 --> 00:34:07,600
ms excel 4.0 macro<font color="#CCCCCC"> whose you have ever</font>

711
00:34:03,910 --> 00:34:12,280
seen<font color="#CCCCCC"> that</font><font color="#E5E5E5"> a few</font><font color="#CCCCCC"> hands you must</font><font color="#E5E5E5"> be</font><font color="#CCCCCC"> off</font>

712
00:34:07,600 --> 00:34:14,799
just kidding yeah so you say<font color="#E5E5E5"> okay and</font>

713
00:34:12,280 --> 00:34:17,220
<font color="#E5E5E5">now I have another sheet called macro</font>

714
00:34:14,800 --> 00:34:21,460
one right here in the bottom<font color="#E5E5E5"> sorry mark</font>

715
00:34:17,219 --> 00:34:25,168
<font color="#E5E5E5">disappear mark for one it says who</font>

716
00:34:21,460 --> 00:34:29,918
what I can do here<font color="#E5E5E5"> is say</font><font color="#CCCCCC"> exact</font>

717
00:34:25,168 --> 00:34:31,359
character<font color="#CCCCCC"> THC</font><font color="#E5E5E5"> halt</font><font color="#CCCCCC"> this is just how</font>

718
00:34:29,918 --> 00:34:33,940
excellent markers work they always have

719
00:34:31,360 --> 00:34:37,899
<font color="#E5E5E5">to</font><font color="#CCCCCC"> end with halt or return</font><font color="#E5E5E5"> then I can</font>

720
00:34:33,940 --> 00:34:41,010
say let's try<font color="#E5E5E5"> this out run I'm going to</font>

721
00:34:37,899 --> 00:34:44,589
run the macro<font color="#E5E5E5"> at Row one column one and</font>

722
00:34:41,010 --> 00:34:47,649
<font color="#E5E5E5">they're calculated and if I want this to</font>

723
00:34:44,590 --> 00:34:52,899
out of<font color="#E5E5E5"> open</font><font color="#CCCCCC"> I can just name my first</font>

724
00:34:47,649 --> 00:34:55,330
cell<font color="#E5E5E5"> auto in the score open and if I</font>

725
00:34:52,899 --> 00:34:58,359
save<font color="#CCCCCC"> this I have a macro</font><font color="#E5E5E5"> in an excel</font>

726
00:34:55,330 --> 00:35:02,490
file which is not VBA<font color="#CCCCCC"> and if I want</font><font color="#E5E5E5"> to</font>

727
00:34:58,360 --> 00:35:05,820
hide this<font color="#CCCCCC"> I can just say hide the sheet</font>

728
00:35:02,490 --> 00:35:05,819
it's gone

729
00:35:05,970 --> 00:35:10,419
[Applause]

730
00:35:10,980 --> 00:35:20,220
<font color="#E5E5E5">at and it will still run of course</font><font color="#CCCCCC"> so</font>

731
00:35:16,380 --> 00:35:22,770
that<font color="#CCCCCC"> was a basic macro</font><font color="#E5E5E5"> but now you want</font>

732
00:35:20,220 --> 00:35:25,500
<font color="#E5E5E5">to really weaponize this at least we do</font>

733
00:35:22,770 --> 00:35:29,099
and this was a pain in<font color="#CCCCCC"> the</font><font color="#E5E5E5"> ass</font>

734
00:35:25,500 --> 00:35:33,390
but after hours and<font color="#CCCCCC"> hours of figuring</font>

735
00:35:29,099 --> 00:35:36,210
out how<font color="#E5E5E5"> I could map internal window</font>

736
00:35:33,390 --> 00:35:40,740
stuff to data types<font color="#E5E5E5"> that are</font><font color="#CCCCCC"> supported</font>

737
00:35:36,210 --> 00:35:45,260
in<font color="#CCCCCC"> Excel 4.0 I came</font><font color="#E5E5E5"> up with this mantra</font>

738
00:35:40,740 --> 00:35:48,810
<font color="#CCCCCC">this</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> shell code injection in</font><font color="#E5E5E5"> Excel M</font>

739
00:35:45,260 --> 00:35:51,329
<font color="#CCCCCC">I don't have time to explain</font><font color="#E5E5E5"> what's</font>

740
00:35:48,810 --> 00:35:52,980
going<font color="#E5E5E5"> on in</font><font color="#CCCCCC"> this code</font><font color="#E5E5E5"> so if you want to</font>

741
00:35:51,329 --> 00:35:57,359
know<font color="#E5E5E5"> look at the block that's down there</font>

742
00:35:52,980 --> 00:36:02,400
but yes this<font color="#E5E5E5"> is the</font><font color="#CCCCCC"> windows</font><font color="#E5E5E5"> 32 API being</font>

743
00:35:57,359 --> 00:36:04,619
called<font color="#E5E5E5"> using Excel M macros immediately</font>

744
00:36:02,400 --> 00:36:07,410
after I put this out<font color="#CCCCCC"> on Twitter</font><font color="#E5E5E5"> there</font>

745
00:36:04,619 --> 00:36:10,980
was a guy<font color="#E5E5E5"> called Philip Superman from</font>

746
00:36:07,410 --> 00:36:15,899
<font color="#E5E5E5">cyber reason who pointed out that xlm</font>

747
00:36:10,980 --> 00:36:18,300
macros are also exposed Viacom and<font color="#E5E5E5"> FOIA</font>

748
00:36:15,900 --> 00:36:20,880
<font color="#CCCCCC">decom so this is also an interesting</font>

749
00:36:18,300 --> 00:36:22,650
<font color="#E5E5E5">lateral movement option where</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> can</font>

750
00:36:20,880 --> 00:36:26,490
just pass<font color="#CCCCCC"> the excel and marker as a</font>

751
00:36:22,650 --> 00:36:28,079
string to a decom exposed method which

752
00:36:26,490 --> 00:36:29,939
<font color="#E5E5E5">means that you can lateral move</font><font color="#CCCCCC"> you can</font>

753
00:36:28,079 --> 00:36:31,800
do<font color="#E5E5E5"> a lateral move and fire</font><font color="#CCCCCC"> xlm markers</font>

754
00:36:29,940 --> 00:36:34,980
which means that you<font color="#E5E5E5"> should be able to</font>

755
00:36:31,800 --> 00:36:36,150
do<font color="#CCCCCC"> shellcode</font><font color="#E5E5E5"> injection fry addy calm and</font>

756
00:36:34,980 --> 00:36:37,950
excellent<font color="#CCCCCC"> markers haven't fully</font>

757
00:36:36,150 --> 00:36:40,349
recognized that but I'm pretty<font color="#CCCCCC"> sure</font><font color="#E5E5E5"> that</font>

758
00:36:37,950 --> 00:36:44,040
we will get there<font color="#E5E5E5"> so this is fun have a</font>

759
00:36:40,349 --> 00:36:47,579
good<font color="#CCCCCC"> look into</font><font color="#E5E5E5"> it so there's some</font>

760
00:36:44,040 --> 00:36:50,250
<font color="#E5E5E5">kung-fu happening there and now let's</font>

761
00:36:47,579 --> 00:36:53,060
get you an interesting<font color="#E5E5E5"> part how our</font>

762
00:36:50,250 --> 00:36:56,010
<font color="#CCCCCC">excellent mark loves being stored in</font>

763
00:36:53,060 --> 00:36:58,349
<font color="#E5E5E5">various file formats let's have a look</font>

764
00:36:56,010 --> 00:37:01,050
at the compound file format and on the

765
00:36:58,349 --> 00:37:03,540
left you<font color="#CCCCCC"> see a screenshot</font><font color="#E5E5E5"> of how a</font>

766
00:37:01,050 --> 00:37:06,060
regular VBA macro is stored<font color="#E5E5E5"> we've</font>

767
00:37:03,540 --> 00:37:09,060
already seen this in demo<font color="#CCCCCC"> one there's a</font>

768
00:37:06,060 --> 00:37:12,049
storage called VBA<font color="#E5E5E5"> which has all these</font>

769
00:37:09,060 --> 00:37:16,410
streams where the<font color="#E5E5E5"> actual code is and</font>

770
00:37:12,050 --> 00:37:18,660
this is<font color="#E5E5E5"> a standard file structure which</font>

771
00:37:16,410 --> 00:37:20,910
is being used by every<font color="#E5E5E5"> IV scanner that's</font>

772
00:37:18,660 --> 00:37:22,680
<font color="#E5E5E5">out there</font><font color="#CCCCCC"> just to extract</font><font color="#E5E5E5"> the VBA</font>

773
00:37:20,910 --> 00:37:25,109
modules and to see if there's anything

774
00:37:22,680 --> 00:37:27,830
malicious in there<font color="#CCCCCC"> well excellent</font>

775
00:37:25,110 --> 00:37:30,930
<font color="#CCCCCC">proce</font><font color="#E5E5E5"> the stuff is</font><font color="#CCCCCC"> completely different</font>

776
00:37:27,830 --> 00:37:33,390
<font color="#CCCCCC">Excel and</font><font color="#E5E5E5"> Marcus are just a special type</font>

777
00:37:30,930 --> 00:37:35,060
of<font color="#E5E5E5"> sheet that's in a file and you see</font>

778
00:37:33,390 --> 00:37:37,890
that in<font color="#E5E5E5"> the screenshot on the right</font>

779
00:37:35,060 --> 00:37:40,259
there is<font color="#CCCCCC"> no separate</font><font color="#E5E5E5"> storage for macros</font>

780
00:37:37,890 --> 00:37:43,080
for<font color="#E5E5E5"> Excel and</font><font color="#CCCCCC"> markers it's all in the</font>

781
00:37:40,260 --> 00:37:47,520
regular word book<font color="#E5E5E5"> follow a stream right</font>

782
00:37:43,080 --> 00:37:50,490
there<font color="#CCCCCC"> and this might be one of</font><font color="#E5E5E5"> the</font>

783
00:37:47,520 --> 00:37:52,770
<font color="#E5E5E5">reasons why apparently the whole</font>

784
00:37:50,490 --> 00:37:54,750
antivirus industry<font color="#E5E5E5"> seems to have</font>

785
00:37:52,770 --> 00:37:56,310
completely<font color="#E5E5E5"> forgotten about this</font>

786
00:37:54,750 --> 00:38:00,030
prehistoric technology because I

787
00:37:56,310 --> 00:38:08,880
uploaded the shell code injection<font color="#CCCCCC"> sheets</font>

788
00:38:00,030 --> 00:38:11,880
<font color="#E5E5E5">to</font><font color="#CCCCCC"> fires'</font><font color="#E5E5E5"> total and yeah try this with</font>

789
00:38:08,880 --> 00:38:14,160
an office<font color="#CCCCCC"> cated shellcode injector in</font>

790
00:38:11,880 --> 00:38:15,900
<font color="#CCCCCC">VBA and</font><font color="#E5E5E5"> you will definitely not get</font>

791
00:38:14,160 --> 00:38:18,509
scores<font color="#E5E5E5"> like this so this</font><font color="#CCCCCC"> is really</font><font color="#E5E5E5"> a</font>

792
00:38:15,900 --> 00:38:20,610
<font color="#CCCCCC">call-outs to</font><font color="#E5E5E5"> the AV industry</font><font color="#CCCCCC"> do</font>

793
00:38:18,510 --> 00:38:22,290
something with this stuff because<font color="#CCCCCC"> it can</font>

794
00:38:20,610 --> 00:38:24,990
be<font color="#CCCCCC"> weaponized that's what we have shown</font>

795
00:38:22,290 --> 00:38:28,650
and right now detection rates are way

796
00:38:24,990 --> 00:38:33,569
too low let's go one step<font color="#CCCCCC"> further</font>

797
00:38:28,650 --> 00:38:35,820
that's<font color="#E5E5E5"> a V but what about</font><font color="#CCCCCC"> mg Microsoft</font>

798
00:38:33,570 --> 00:38:39,480
recently announced<font color="#CCCCCC"> that the anti-malware</font>

799
00:38:35,820 --> 00:38:42,210
scan interface now also<font color="#E5E5E5"> integrates with</font>

800
00:38:39,480 --> 00:38:45,090
<font color="#CCCCCC">the VBA agents on the most recent office</font>

801
00:38:42,210 --> 00:38:48,990
365 client applications which means that

802
00:38:45,090 --> 00:38:51,840
you can<font color="#E5E5E5"> use a MZ provider to look into</font>

803
00:38:48,990 --> 00:38:53,939
what VBA code is actually<font color="#CCCCCC"> being executed</font>

804
00:38:51,840 --> 00:38:57,000
<font color="#E5E5E5">without all the obfuscation that might</font>

805
00:38:53,940 --> 00:39:00,450
be in there actually how it works is<font color="#E5E5E5"> the</font>

806
00:38:57,000 --> 00:39:01,920
MZ interface<font color="#E5E5E5"> catches all all core</font>

807
00:39:00,450 --> 00:39:04,680
methods that are being<font color="#CCCCCC"> called</font><font color="#E5E5E5"> and it</font>

808
00:39:01,920 --> 00:39:06,450
catches all<font color="#E5E5E5"> windows 32 API calls</font><font color="#CCCCCC"> that</font>

809
00:39:04,680 --> 00:39:09,990
are being<font color="#E5E5E5"> called and it logs them</font><font color="#CCCCCC"> high</font>

810
00:39:06,450 --> 00:39:14,359
MZ<font color="#CCCCCC"> to the MZ provider but that's pba</font>

811
00:39:09,990 --> 00:39:19,189
and the MZ provider<font color="#E5E5E5"> hasn't opened up to</font>

812
00:39:14,360 --> 00:39:21,630
XML so yes in this case<font color="#E5E5E5"> we can</font><font color="#CCCCCC"> use</font>

813
00:39:19,190 --> 00:39:23,370
<font color="#E5E5E5">twenty-six-year-old technology to</font>

814
00:39:21,630 --> 00:39:26,010
actually circumvent<font color="#E5E5E5"> I'm not saying</font>

815
00:39:23,370 --> 00:39:27,270
bypass and saying circumvents the MZ

816
00:39:26,010 --> 00:39:31,590
provider that<font color="#E5E5E5"> has been recently</font>

817
00:39:27,270 --> 00:39:34,070
introduced so actually this whole

818
00:39:31,590 --> 00:39:36,870
<font color="#CCCCCC">excellent excel</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> pedo marker stuff</font>

819
00:39:34,070 --> 00:39:39,269
with the current defensive layout that

820
00:39:36,870 --> 00:39:41,069
<font color="#E5E5E5">we see there is really</font><font color="#CCCCCC"> interest</font>

821
00:39:39,269 --> 00:39:43,198
staying for red teamers<font color="#E5E5E5"> but</font>

822
00:39:41,069 --> 00:39:45,419
<font color="#E5E5E5">unfortunately also for the bad guys that</font>

823
00:39:43,199 --> 00:39:47,809
<font color="#E5E5E5">are out</font><font color="#CCCCCC"> there</font><font color="#E5E5E5"> so we as an industry</font><font color="#CCCCCC"> we</font>

824
00:39:45,419 --> 00:39:51,929
<font color="#E5E5E5">really need to do something</font><font color="#CCCCCC"> about it</font>

825
00:39:47,809 --> 00:39:54,869
<font color="#E5E5E5">this concludes my third trick</font><font color="#CCCCCC"> there's</font>

826
00:39:51,929 --> 00:39:56,849
<font color="#E5E5E5">plenty of work to</font><font color="#CCCCCC"> do in this area I've</font>

827
00:39:54,869 --> 00:39:58,919
only scratched upon the<font color="#E5E5E5"> surface and</font>

828
00:39:56,849 --> 00:40:00,989
there's probably so many interesting

829
00:39:58,919 --> 00:40:04,078
stuff in these<font color="#CCCCCC"> directions that we can</font>

830
00:40:00,989 --> 00:40:05,459
get her so we as a community<font color="#E5E5E5"> as an</font>

831
00:40:04,079 --> 00:40:08,159
offensive community as well let's see

832
00:40:05,459 --> 00:40:10,499
what we can<font color="#CCCCCC"> get out of</font><font color="#E5E5E5"> this then back to</font>

833
00:40:08,159 --> 00:40:12,029
Peter for<font color="#CCCCCC"> the final thoughts</font><font color="#E5E5E5"> this was</font>

834
00:40:10,499 --> 00:40:14,578
kind of<font color="#CCCCCC"> Stan's pandora boxx</font>

835
00:40:12,029 --> 00:40:17,579
with the<font color="#E5E5E5"> ZX excellence but that's much</font>

836
00:40:14,579 --> 00:40:21,149
<font color="#E5E5E5">more to come as</font><font color="#CCCCCC"> soon as Microsoft allows</font>

837
00:40:17,579 --> 00:40:24,089
<font color="#CCCCCC">us so this fix we've demoed</font><font color="#E5E5E5"> we believe</font>

838
00:40:21,149 --> 00:40:25,618
they're fully in line with specs<font color="#E5E5E5"> so this</font>

839
00:40:24,089 --> 00:40:29,069
is kind of the desired functionality

840
00:40:25,619 --> 00:40:31,619
apparently<font color="#CCCCCC"> we</font><font color="#E5E5E5"> got some other</font><font color="#CCCCCC"> tricks as</font>

841
00:40:29,069 --> 00:40:34,769
<font color="#CCCCCC">well</font><font color="#E5E5E5"> so we</font><font color="#CCCCCC"> got a fishy monkey that</font>

842
00:40:31,619 --> 00:40:36,299
steals<font color="#E5E5E5"> your files and we have a don't</font>

843
00:40:34,769 --> 00:40:39,839
take debate<font color="#CCCCCC"> credential stealing Word</font>

844
00:40:36,299 --> 00:40:42,179
documents<font color="#CCCCCC"> and both these are 100%</font><font color="#E5E5E5"> macro</font>

845
00:40:39,839 --> 00:40:45,389
free and not these trickeries we just

846
00:40:42,179 --> 00:40:46,949
<font color="#CCCCCC">use but really macro free</font><font color="#E5E5E5"> but we can't</font>

847
00:40:45,389 --> 00:40:48,239
really talk<font color="#CCCCCC"> about that because</font><font color="#E5E5E5"> we're</font><font color="#CCCCCC"> in</font>

848
00:40:46,949 --> 00:40:50,819
a Microsoft responsible disclosure

849
00:40:48,239 --> 00:40:53,309
process<font color="#CCCCCC"> update</font><font color="#E5E5E5"> will be released and then</font>

850
00:40:50,819 --> 00:40:56,389
<font color="#E5E5E5">we will release what was behind</font><font color="#CCCCCC"> data</font>

851
00:40:53,309 --> 00:40:58,919
<font color="#CCCCCC">what we were actually doing there so</font>

852
00:40:56,389 --> 00:41:00,869
there's a lot<font color="#CCCCCC"> of more interesting</font><font color="#E5E5E5"> stuff</font>

853
00:40:58,919 --> 00:41:04,319
coming<font color="#CCCCCC"> up the upcoming</font><font color="#E5E5E5"> weeks and months</font>

854
00:41:00,869 --> 00:41:06,499
from<font color="#E5E5E5"> our end that concludes our</font>

855
00:41:04,319 --> 00:41:06,499
presentation

856
00:41:07,140 --> 00:41:19,700
[Applause]

857
00:41:16,340 --> 00:41:21,680
thank you thank you<font color="#CCCCCC"> I remember that</font>

858
00:41:19,700 --> 00:41:32,060
there was<font color="#E5E5E5"> a question from</font><font color="#CCCCCC"> the guy with</font>

859
00:41:21,680 --> 00:41:34,609
<font color="#CCCCCC">the</font><font color="#E5E5E5"> white shirt in the back so the</font>

860
00:41:32,060 --> 00:41:37,430
question is with the<font color="#CCCCCC"> peek</font><font color="#E5E5E5"> out stuff that</font>

861
00:41:34,610 --> 00:41:40,820
<font color="#CCCCCC">we have seen in the first Rick</font><font color="#E5E5E5"> what kind</font>

862
00:41:37,430 --> 00:41:43,370
of<font color="#E5E5E5"> version was I talking</font><font color="#CCCCCC"> about and yes</font>

863
00:41:40,820 --> 00:41:48,320
it seems to<font color="#E5E5E5"> be about the major version</font>

864
00:41:43,370 --> 00:41:52,580
like 2016 or 2013<font color="#E5E5E5"> or 2010</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> depending</font>

865
00:41:48,320 --> 00:42:07,640
<font color="#E5E5E5">on the architecture x64 or x86</font><font color="#CCCCCC"> Thanks</font>

866
00:41:52,580 --> 00:42:09,830
<font color="#E5E5E5">thank you that's a good question</font><font color="#CCCCCC"> what</font>

867
00:42:07,640 --> 00:42:13,040
happens if<font color="#E5E5E5"> you turn</font><font color="#CCCCCC"> off macros in your</font>

868
00:42:09,830 --> 00:42:16,040
environment<font color="#CCCCCC"> if I recall correctly I've</font>

869
00:42:13,040 --> 00:42:18,470
done all kinds of testing<font color="#E5E5E5"> this does</font>

870
00:42:16,040 --> 00:42:21,920
adhere<font color="#E5E5E5"> to the macro rules so if you</font>

871
00:42:18,470 --> 00:42:25,220
<font color="#E5E5E5">completely turn off macros then Excel</font>

872
00:42:21,920 --> 00:42:26,810
<font color="#CCCCCC">and marked rows won't run but there's</font>

873
00:42:25,220 --> 00:42:29,180
something that we didn't mention which

874
00:42:26,810 --> 00:42:31,270
you should<font color="#E5E5E5"> keep in mind</font><font color="#CCCCCC"> please</font><font color="#E5E5E5"> be aware</font>

875
00:42:29,180 --> 00:42:34,540
and<font color="#CCCCCC"> that relates to trick</font><font color="#E5E5E5"> to of Peter</font>

876
00:42:31,270 --> 00:42:37,850
<font color="#CCCCCC">that things like trusted locations</font>

877
00:42:34,540 --> 00:42:39,710
always are prioritized<font color="#E5E5E5"> above your macro</font>

878
00:42:37,850 --> 00:42:42,200
settings so you can<font color="#CCCCCC"> have the marker</font>

879
00:42:39,710 --> 00:42:43,730
settings<font color="#E5E5E5"> completely disabled but if you</font>

880
00:42:42,200 --> 00:42:45,879
have a trusted locations then still

881
00:42:43,730 --> 00:42:49,100
<font color="#E5E5E5">Marcos will run from that location</font>

882
00:42:45,880 --> 00:42:51,340
<font color="#E5E5E5">despite your macro settings that's</font>

883
00:42:49,100 --> 00:42:54,220
<font color="#E5E5E5">something that you</font><font color="#CCCCCC"> should keep in mind</font>

884
00:42:51,340 --> 00:43:00,870
<font color="#E5E5E5">all</font><font color="#CCCCCC"> right thank you</font><font color="#E5E5E5"> all</font>

885
00:42:54,220 --> 00:43:00,870
[Applause]

