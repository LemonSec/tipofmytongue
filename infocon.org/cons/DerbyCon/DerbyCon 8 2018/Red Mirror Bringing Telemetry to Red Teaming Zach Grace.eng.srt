1
00:00:14,870 --> 00:00:23,340
good morning how's everybody feeling

2
00:00:18,960 --> 00:00:27,240
<font color="#E5E5E5">this guy's feel</font><font color="#CCCCCC"> good</font><font color="#E5E5E5"> all right yeah</font>

3
00:00:23,340 --> 00:00:28,800
<font color="#CCCCCC">welcome to a Derby on Sunday morning</font><font color="#E5E5E5"> but</font>

4
00:00:27,240 --> 00:00:32,519
make it<font color="#E5E5E5"> after the this we party last</font>

5
00:00:28,800 --> 00:00:34,649
<font color="#CCCCCC">night with the offspring so talk is red</font>

6
00:00:32,520 --> 00:00:38,399
<font color="#CCCCCC">Mir</font><font color="#E5E5E5"> Blaine bringing telemetry to red t</font>

7
00:00:34,649 --> 00:00:41,910
me a little bit about myself

8
00:00:38,399 --> 00:00:43,110
<font color="#CCCCCC">Zack Grace</font><font color="#E5E5E5"> lead the red team</font><font color="#CCCCCC"> pentesting</font>

9
00:00:41,910 --> 00:00:47,218
and vulnerability management at fortune

10
00:00:43,110 --> 00:00:49,980
100<font color="#CCCCCC"> I am on the</font><font color="#E5E5E5"> Wisconsin CDC red team</font>

11
00:00:47,219 --> 00:00:51,989
and that'll<font color="#E5E5E5"> be important a minute</font>

12
00:00:49,980 --> 00:00:53,610
I am an elk<font color="#CCCCCC"> noob I do not claim to</font><font color="#E5E5E5"> be an</font>

13
00:00:51,989 --> 00:00:55,078
<font color="#CCCCCC">expert in a bunch of</font><font color="#E5E5E5"> this stuff</font><font color="#CCCCCC"> I just</font>

14
00:00:53,610 --> 00:00:57,000
<font color="#CCCCCC">found a</font><font color="#E5E5E5"> bunch</font><font color="#CCCCCC"> of this really useful</font><font color="#E5E5E5"> and</font>

15
00:00:55,079 --> 00:01:02,280
<font color="#E5E5E5">I</font><font color="#CCCCCC"> think you probably will too if you do</font>

16
00:00:57,000 --> 00:01:03,530
the Twitter thing<font color="#E5E5E5"> that's my handle</font><font color="#CCCCCC"> so</font>

17
00:01:02,280 --> 00:01:07,080
<font color="#CCCCCC">today's a little bit of an</font><font color="#E5E5E5"> origin story</font>

18
00:01:03,530 --> 00:01:08,640
<font color="#E5E5E5">it's like I mentioned CCDC</font>

19
00:01:07,080 --> 00:01:09,869
<font color="#E5E5E5">so if you're not</font><font color="#CCCCCC"> familiar with</font><font color="#E5E5E5"> it it's a</font>

20
00:01:08,640 --> 00:01:13,560
collegiate cyber<font color="#E5E5E5"> defense challenge</font>

21
00:01:09,869 --> 00:01:15,860
basically teams<font color="#E5E5E5"> of college students get</font>

22
00:01:13,560 --> 00:01:18,030
together<font color="#E5E5E5"> and they're giving different</font>

23
00:01:15,860 --> 00:01:20,039
environments to defend or they have to

24
00:01:18,030 --> 00:01:21,900
build environments themselves against

25
00:01:20,040 --> 00:01:24,420
basically<font color="#E5E5E5"> professional</font><font color="#CCCCCC"> Red Team right so</font>

26
00:01:21,900 --> 00:01:26,630
<font color="#E5E5E5">sort of like the pros vs. the</font><font color="#CCCCCC"> joes and</font>

27
00:01:24,420 --> 00:01:29,100
of course<font color="#CCCCCC"> red team always wins</font>

28
00:01:26,630 --> 00:01:31,140
in our<font color="#E5E5E5"> set up the one of the challenges</font>

29
00:01:29,100 --> 00:01:32,429
that we always<font color="#E5E5E5"> have is it's it's a</font>

30
00:01:31,140 --> 00:01:33,900
virtualized<font color="#E5E5E5"> environments the teams are</font>

31
00:01:32,430 --> 00:01:36,810
always<font color="#E5E5E5"> able just to click the reset</font>

32
00:01:33,900 --> 00:01:38,670
button<font color="#CCCCCC"> and just now they've reverted</font>

33
00:01:36,810 --> 00:01:40,320
back to<font color="#E5E5E5"> the original state right which</font>

34
00:01:38,670 --> 00:01:42,720
<font color="#CCCCCC">means also</font><font color="#E5E5E5"> they have kicked us out and</font>

35
00:01:40,320 --> 00:01:44,639
we have<font color="#E5E5E5"> to go back in and recom promise'</font>

36
00:01:42,720 --> 00:01:46,110
systems and if we're not<font color="#E5E5E5"> paying</font>

37
00:01:44,640 --> 00:01:47,640
attention<font color="#E5E5E5"> they can do that and then</font>

38
00:01:46,110 --> 00:01:49,649
change the passwords and then harden<font color="#E5E5E5"> the</font>

39
00:01:47,640 --> 00:01:50,909
systems and then<font color="#E5E5E5"> we kind of lose our</font>

40
00:01:49,649 --> 00:01:52,829
access right and then we have to work a

41
00:01:50,909 --> 00:01:55,439
little<font color="#E5E5E5"> bit hard</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> get</font><font color="#CCCCCC"> it back</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> I</font>

42
00:01:52,829 --> 00:01:57,570
decided it for last year's<font color="#CCCCCC"> competition</font>

43
00:01:55,439 --> 00:02:00,570
that I wanted<font color="#E5E5E5"> to build like some sort of</font>

44
00:01:57,570 --> 00:02:02,309
like board similar to what the blue<font color="#E5E5E5"> team</font>

45
00:02:00,570 --> 00:02:05,639
has as far as their service<font color="#CCCCCC"> uptime so</font>

46
00:02:02,310 --> 00:02:07,140
one<font color="#CCCCCC"> of the</font><font color="#E5E5E5"> goals at the the blue team</font>

47
00:02:05,640 --> 00:02:08,610
has is to keep their services up and

48
00:02:07,140 --> 00:02:09,880
running that's a component<font color="#E5E5E5"> of their</font>

49
00:02:08,610 --> 00:02:12,340
scores

50
00:02:09,880 --> 00:02:15,070
so that they're supposed to be<font color="#E5E5E5"> like a</font>

51
00:02:12,340 --> 00:02:16,540
pseudo business right and<font color="#E5E5E5"> as the the</font>

52
00:02:15,070 --> 00:02:18,400
services go down<font color="#E5E5E5"> they loot they don't</font>

53
00:02:16,540 --> 00:02:20,920
accrue points<font color="#CCCCCC"> but the services up that</font>

54
00:02:18,400 --> 00:02:22,630
they do get<font color="#CCCCCC"> into</font><font color="#E5E5E5"> those points</font><font color="#CCCCCC"> and so for</font>

55
00:02:20,920 --> 00:02:24,670
us I wanted<font color="#E5E5E5"> to make a very something</font>

56
00:02:22,630 --> 00:02:26,170
similar<font color="#CCCCCC"> so that we know</font><font color="#E5E5E5"> that hey we</font>

57
00:02:24,670 --> 00:02:28,570
actually<font color="#CCCCCC"> have these</font><font color="#E5E5E5"> systems compromised</font>

58
00:02:26,170 --> 00:02:30,670
or<font color="#E5E5E5"> no we don't have these compromised or</font>

59
00:02:28,570 --> 00:02:32,470
hey they reverted<font color="#E5E5E5"> or we just lost access</font>

60
00:02:30,670 --> 00:02:34,239
<font color="#E5E5E5">we should</font><font color="#CCCCCC"> probably go and hit that box</font>

61
00:02:32,470 --> 00:02:36,240
<font color="#E5E5E5">again</font><font color="#CCCCCC"> and get</font><font color="#E5E5E5"> that access back so I</font>

62
00:02:34,240 --> 00:02:41,500
built this thing's called poem board

63
00:02:36,240 --> 00:02:42,880
<font color="#CCCCCC">it's sort of a very kludgy thing it's</font>

64
00:02:41,500 --> 00:02:45,850
<font color="#CCCCCC">it's sort of</font><font color="#E5E5E5"> one support at this point</font>

65
00:02:42,880 --> 00:02:48,630
and I'll show<font color="#E5E5E5"> you why in</font><font color="#CCCCCC"> a minute</font><font color="#E5E5E5"> but</font>

66
00:02:45,850 --> 00:02:50,820
basically<font color="#E5E5E5"> it was every time we would</font>

67
00:02:48,630 --> 00:02:53,320
<font color="#E5E5E5">compromise something with like Empire</font><font color="#CCCCCC"> I</font>

68
00:02:50,820 --> 00:02:55,959
was I<font color="#E5E5E5"> was grabbing you know those</font>

69
00:02:53,320 --> 00:02:57,640
connections<font color="#E5E5E5"> pushing that</font><font color="#CCCCCC"> to slack</font>

70
00:02:55,960 --> 00:02:59,200
<font color="#E5E5E5">channel</font><font color="#CCCCCC"> grab the message</font><font color="#E5E5E5"> out of a slack</font>

71
00:02:57,640 --> 00:03:00,880
<font color="#E5E5E5">channel and populating the board so that</font>

72
00:02:59,200 --> 00:03:02,829
<font color="#E5E5E5">we knew that hey we were constantly</font>

73
00:03:00,880 --> 00:03:06,060
<font color="#E5E5E5">getting those</font><font color="#CCCCCC"> check-ins or we had new</font>

74
00:03:02,830 --> 00:03:09,520
new systems pop online<font color="#CCCCCC"> to monitor this</font>

75
00:03:06,060 --> 00:03:10,750
<font color="#E5E5E5">and I didn't throw up on Twitter and</font>

76
00:03:09,520 --> 00:03:12,600
like immediately got a response<font color="#E5E5E5"> from</font>

77
00:03:10,750 --> 00:03:16,150
virus and he's like do I<font color="#E5E5E5"> need your code</font>

78
00:03:12,600 --> 00:03:19,269
like now<font color="#E5E5E5"> because so you don't know virus</font>

79
00:03:16,150 --> 00:03:22,000
he's he's out west<font color="#E5E5E5"> and he's working on</font>

80
00:03:19,270 --> 00:03:24,970
the Western<font color="#CCCCCC"> Regional</font><font color="#E5E5E5"> see CDC and also</font>

81
00:03:22,000 --> 00:03:26,470
helps<font color="#E5E5E5"> those nationals</font><font color="#CCCCCC"> to and he's like</font>

82
00:03:24,970 --> 00:03:28,990
that<font color="#E5E5E5"> that's gonna fit really well into</font>

83
00:03:26,470 --> 00:03:31,240
<font color="#CCCCCC">all my stuff so I send the code</font><font color="#E5E5E5"> over to</font>

84
00:03:28,990 --> 00:03:32,650
<font color="#E5E5E5">him and I started asking</font><font color="#CCCCCC"> questions</font><font color="#E5E5E5"> about</font>

85
00:03:31,240 --> 00:03:35,230
his stuff and he's like oh yeah<font color="#CCCCCC"> and I</font>

86
00:03:32,650 --> 00:03:37,480
use I use an elk stack for all<font color="#CCCCCC"> theirs</font>

87
00:03:35,230 --> 00:03:40,119
and<font color="#E5E5E5"> we</font><font color="#CCCCCC"> use these things called beets and</font>

88
00:03:37,480 --> 00:03:41,890
like I knew nothing about this right<font color="#CCCCCC"> and</font>

89
00:03:40,120 --> 00:03:42,970
like well what's that<font color="#E5E5E5"> and</font><font color="#CCCCCC"> started you</font>

90
00:03:41,890 --> 00:03:44,859
<font color="#E5E5E5">know asking lots of questions and</font>

91
00:03:42,970 --> 00:03:46,540
realize like<font color="#CCCCCC"> how</font><font color="#E5E5E5"> awesome of like an</font>

92
00:03:44,860 --> 00:03:50,110
ecosystem<font color="#E5E5E5"> like all the the beets</font>

93
00:03:46,540 --> 00:03:52,030
libraries really<font color="#CCCCCC"> are and so that</font><font color="#E5E5E5"> got me</font>

94
00:03:50,110 --> 00:03:53,530
<font color="#CCCCCC">thinking about you know</font><font color="#E5E5E5"> telemetry and</font>

95
00:03:52,030 --> 00:03:55,770
<font color="#E5E5E5">like how could I do the the</font><font color="#CCCCCC"> pole more</font>

96
00:03:53,530 --> 00:03:57,670
thing better and then ultimately<font color="#E5E5E5"> made it</font>

97
00:03:55,770 --> 00:03:59,740
into something<font color="#E5E5E5"> a little</font><font color="#CCCCCC"> bit bigger</font><font color="#E5E5E5"> but</font>

98
00:03:57,670 --> 00:04:01,780
the beets<font color="#E5E5E5"> that he was mentioning our</font>

99
00:03:59,740 --> 00:04:04,540
they're called beets now<font color="#E5E5E5"> used</font><font color="#CCCCCC"> be</font><font color="#E5E5E5"> called</font>

100
00:04:01,780 --> 00:04:07,960
Libby is basically a<font color="#E5E5E5"> a gold library that</font>

101
00:04:04,540 --> 00:04:09,730
you can<font color="#CCCCCC"> use to build basically little</font>

102
00:04:07,960 --> 00:04:11,260
monitoring tools<font color="#E5E5E5"> right they're meant</font><font color="#CCCCCC"> to</font>

103
00:04:09,730 --> 00:04:12,670
take some sort<font color="#CCCCCC"> of data</font><font color="#E5E5E5"> some sort of</font>

104
00:04:11,260 --> 00:04:16,918
<font color="#E5E5E5">metric and then ship it off to like an</font>

105
00:04:12,670 --> 00:04:20,440
<font color="#CCCCCC">Alex stack and they're</font><font color="#E5E5E5"> really small and</font>

106
00:04:16,918 --> 00:04:22,590
there's no dependencies<font color="#E5E5E5"> things go</font><font color="#CCCCCC"> and</font>

107
00:04:20,440 --> 00:04:24,240
it's<font color="#E5E5E5"> pretty because there's we're</font>

108
00:04:22,590 --> 00:04:26,729
just focus on<font color="#E5E5E5"> like some of the primary</font>

109
00:04:24,240 --> 00:04:28,710
ones that are<font color="#E5E5E5"> out there but there's also</font>

110
00:04:26,730 --> 00:04:29,910
about 70 community beats so if you can

111
00:04:28,710 --> 00:04:32,430
imagine<font color="#E5E5E5"> like</font><font color="#CCCCCC"> a log source there's</font>

112
00:04:29,910 --> 00:04:38,639
probably a beat out there for<font color="#E5E5E5"> it or it's</font>

113
00:04:32,430 --> 00:04:42,449
<font color="#E5E5E5">fairly trivial to write your own</font><font color="#CCCCCC"> so so</font>

114
00:04:38,639 --> 00:04:44,370
why<font color="#E5E5E5"> telemetry</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> really you know my</font>

115
00:04:42,449 --> 00:04:47,190
<font color="#E5E5E5">opinion is like the red team should be</font>

116
00:04:44,370 --> 00:04:49,220
<font color="#E5E5E5">making the blue team better</font><font color="#CCCCCC"> right if</font>

117
00:04:47,190 --> 00:04:52,740
we're not actually improving things like

118
00:04:49,220 --> 00:04:53,880
we're<font color="#E5E5E5"> not really doing</font><font color="#CCCCCC"> our job so</font><font color="#E5E5E5"> we</font>

119
00:04:52,740 --> 00:04:55,380
were as we're blowing out<font color="#E5E5E5"> the red team</font>

120
00:04:53,880 --> 00:04:57,330
at my organization<font color="#CCCCCC"> and I thought</font><font color="#E5E5E5"> about</font>

121
00:04:55,380 --> 00:04:58,909
okay well what would<font color="#E5E5E5"> I</font><font color="#CCCCCC"> need in the</font><font color="#E5E5E5"> end</font>

122
00:04:57,330 --> 00:05:02,669
when we're all done with say like a

123
00:04:58,910 --> 00:05:04,260
multi month long engagement<font color="#CCCCCC"> to</font><font color="#E5E5E5"> actually</font>

124
00:05:02,669 --> 00:05:06,570
<font color="#E5E5E5">have the data</font><font color="#CCCCCC"> that we need to do a</font>

125
00:05:04,260 --> 00:05:08,909
fective like knowledge transfer and<font color="#CCCCCC"> help</font>

126
00:05:06,570 --> 00:05:10,680
them get better<font color="#E5E5E5"> show them exactly where</font>

127
00:05:08,910 --> 00:05:13,380
<font color="#E5E5E5">and</font><font color="#CCCCCC"> when like things happen so we could</font>

128
00:05:10,680 --> 00:05:15,990
you<font color="#E5E5E5"> know improve detections for the</font>

129
00:05:13,380 --> 00:05:17,280
organization and and then I sort of made

130
00:05:15,990 --> 00:05:19,729
the correlation back to like<font color="#E5E5E5"> that poem</font>

131
00:05:17,280 --> 00:05:21,840
<font color="#CCCCCC">Bartels hey like maybe we can do all the</font>

132
00:05:19,729 --> 00:05:23,460
get all<font color="#E5E5E5"> the data</font><font color="#CCCCCC"> from</font><font color="#E5E5E5"> all those the</font>

133
00:05:21,840 --> 00:05:28,469
streams<font color="#CCCCCC"> and actually put that</font><font color="#E5E5E5"> together</font>

134
00:05:23,460 --> 00:05:30,419
in<font color="#E5E5E5"> some</font><font color="#CCCCCC"> sort of fashion so this talk is</font>

135
00:05:28,470 --> 00:05:33,410
<font color="#E5E5E5">not really about like you don't just</font>

136
00:05:30,419 --> 00:05:36,450
<font color="#E5E5E5">hear plug and play this is more a</font>

137
00:05:33,410 --> 00:05:38,700
choose-your-own-adventure<font color="#E5E5E5"> type of talk</font>

138
00:05:36,450 --> 00:05:40,650
<font color="#E5E5E5">because I've never met</font><font color="#CCCCCC"> two</font><font color="#E5E5E5"> red teams</font>

139
00:05:38,700 --> 00:05:42,719
that have the<font color="#E5E5E5"> same infrastructure so I'm</font>

140
00:05:40,650 --> 00:05:43,799
<font color="#E5E5E5">gonna talk at a higher level of like</font>

141
00:05:42,720 --> 00:05:45,960
here's some<font color="#CCCCCC"> different things</font><font color="#E5E5E5"> that I</font>

142
00:05:43,800 --> 00:05:47,520
<font color="#E5E5E5">found that we're really useful and</font><font color="#CCCCCC"> some</font>

143
00:05:45,960 --> 00:05:50,190
might be<font color="#E5E5E5"> useful</font><font color="#CCCCCC"> to you but weren't</font>

144
00:05:47,520 --> 00:05:53,190
<font color="#CCCCCC">useful to me and</font><font color="#E5E5E5"> that's okay</font>

145
00:05:50,190 --> 00:05:55,800
and I'm gonna release<font color="#E5E5E5"> some code here</font><font color="#CCCCCC"> and</font>

146
00:05:53,190 --> 00:06:00,240
after<font color="#E5E5E5"> the talk and you can</font><font color="#CCCCCC"> use</font><font color="#E5E5E5"> it if you</font>

147
00:05:55,800 --> 00:06:01,830
like<font color="#E5E5E5"> it if not that's cool too</font><font color="#CCCCCC"> so I</font><font color="#E5E5E5"> just</font>

148
00:06:00,240 --> 00:06:03,990
<font color="#E5E5E5">wanted to give a shout out to</font><font color="#CCCCCC"> some like</font>

149
00:06:01,830 --> 00:06:05,099
some prior art so there's if you like

150
00:06:03,990 --> 00:06:07,139
<font color="#CCCCCC">spunk versus elk</font>

151
00:06:05,099 --> 00:06:09,599
there's a cool project<font color="#CCCCCC"> that visit you</font>

152
00:06:07,139 --> 00:06:11,639
put out called cobalt<font color="#CCCCCC"> Splunk</font><font color="#E5E5E5"> it</font>

153
00:06:09,599 --> 00:06:14,400
<font color="#E5E5E5">basically sucks up the beacon logs and</font>

154
00:06:11,639 --> 00:06:19,349
web<font color="#E5E5E5"> logs and then puts that into like a</font>

155
00:06:14,400 --> 00:06:21,419
<font color="#CCCCCC">Splunk app and of as of about</font><font color="#E5E5E5"> four hours</font>

156
00:06:19,349 --> 00:06:25,289
<font color="#E5E5E5">ago</font><font color="#CCCCCC"> looks like there's</font><font color="#E5E5E5"> another Red Team</font>

157
00:06:21,419 --> 00:06:26,849
elk<font color="#E5E5E5"> project out there</font><font color="#CCCCCC"> I literally woke</font>

158
00:06:25,289 --> 00:06:30,120
up this morning I'm like<font color="#E5E5E5"> hey I</font><font color="#CCCCCC"> have you</font>

159
00:06:26,849 --> 00:06:31,770
know<font color="#E5E5E5"> somebody tweeted at me</font><font color="#CCCCCC"> and it was</font>

160
00:06:30,120 --> 00:06:34,169
<font color="#CCCCCC">these guys who just presented it at</font><font color="#E5E5E5"> brew</font>

161
00:06:31,770 --> 00:06:35,820
con and now<font color="#CCCCCC"> they're talks up to</font><font color="#E5E5E5"> you so</font>

162
00:06:34,169 --> 00:06:36,299
they have a<font color="#E5E5E5"> little bit</font><font color="#CCCCCC"> different</font>

163
00:06:35,820 --> 00:06:38,580
approach

164
00:06:36,300 --> 00:06:40,379
<font color="#CCCCCC">I think it's really</font><font color="#E5E5E5"> cool and I like some</font>

165
00:06:38,580 --> 00:06:41,699
<font color="#E5E5E5">of the stuff</font><font color="#CCCCCC"> that they do better</font><font color="#E5E5E5"> than a</font>

166
00:06:40,379 --> 00:06:43,650
few aspects of mine<font color="#E5E5E5"> but there's some</font>

167
00:06:41,699 --> 00:06:49,319
stuff<font color="#CCCCCC"> that mine does</font><font color="#E5E5E5"> it theirs doesn't</font>

168
00:06:43,650 --> 00:06:51,870
do and<font color="#E5E5E5"> I'll I'll kind of mention that</font><font color="#CCCCCC"> so</font>

169
00:06:49,319 --> 00:06:54,479
<font color="#E5E5E5">for red</font><font color="#CCCCCC"> teams we</font><font color="#E5E5E5"> think of like typical</font>

170
00:06:51,870 --> 00:06:55,470
session logging right<font color="#CCCCCC"> I kind of talked</font>

171
00:06:54,479 --> 00:06:57,359
about<font color="#CCCCCC"> a few different</font><font color="#E5E5E5"> aspects of that</font>

172
00:06:55,470 --> 00:06:59,909
<font color="#E5E5E5">here right</font><font color="#CCCCCC"> so if you're in a console</font>

173
00:06:57,360 --> 00:07:02,960
like<font color="#E5E5E5"> a shell right</font><font color="#CCCCCC"> like basher is Eshu</font>

174
00:06:59,909 --> 00:07:05,340
probably use<font color="#E5E5E5"> script to log all that out</font>

175
00:07:02,960 --> 00:07:07,979
<font color="#CCCCCC">that works fine but</font><font color="#E5E5E5"> it's hard to grep</font>

176
00:07:05,340 --> 00:07:09,900
through its it gets big and<font color="#E5E5E5"> messy</font>

177
00:07:07,979 --> 00:07:12,539
you've got<font color="#E5E5E5"> for an ACEF console you can</font>

178
00:07:09,900 --> 00:07:15,210
<font color="#CCCCCC">spool all</font><font color="#E5E5E5"> that out as well</font><font color="#CCCCCC"> for Empire</font>

179
00:07:12,539 --> 00:07:16,650
<font color="#E5E5E5">the stuff gets written to agents</font><font color="#CCCCCC"> jet</font><font color="#E5E5E5"> log</font>

180
00:07:15,210 --> 00:07:19,590
<font color="#CCCCCC">and for cobalt strike he</font><font color="#E5E5E5"> gets written to</font>

181
00:07:16,650 --> 00:07:21,030
<font color="#E5E5E5">the beacon logs</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> so this is a lot of</font>

182
00:07:19,590 --> 00:07:23,299
different<font color="#CCCCCC"> information that</font><font color="#E5E5E5"> gets sorted</font>

183
00:07:21,030 --> 00:07:25,530
in like<font color="#E5E5E5"> different places and it's hard</font>

184
00:07:23,300 --> 00:07:26,759
you know<font color="#CCCCCC"> you go to</font><font color="#E5E5E5"> write reports like I</font>

185
00:07:25,530 --> 00:07:28,378
can remember<font color="#E5E5E5"> what I did</font><font color="#CCCCCC"> last week let</font>

186
00:07:26,759 --> 00:07:31,590
<font color="#CCCCCC">alone like two months</font><font color="#E5E5E5"> ago when</font><font color="#CCCCCC"> you have</font>

187
00:07:28,379 --> 00:07:35,250
<font color="#E5E5E5">long term out operations so it makes</font><font color="#CCCCCC"> is</font>

188
00:07:31,590 --> 00:07:37,500
kind<font color="#CCCCCC"> of hard for</font><font color="#E5E5E5"> the network side of</font>

189
00:07:35,250 --> 00:07:38,969
vlogging<font color="#CCCCCC"> this is typically</font><font color="#E5E5E5"> what I've</font>

190
00:07:37,500 --> 00:07:41,099
always<font color="#E5E5E5"> seen right where it's going to</font>

191
00:07:38,969 --> 00:07:43,789
you like pcap all the things like<font color="#CCCCCC"> pcaps</font>

192
00:07:41,099 --> 00:07:43,789
<font color="#CCCCCC">or didn't</font><font color="#E5E5E5"> happen</font>

193
00:07:44,789 --> 00:07:48,960
so what<font color="#CCCCCC"> could go</font><font color="#E5E5E5"> wrong with like these</font>

194
00:07:46,650 --> 00:07:51,840
current approaches<font color="#E5E5E5"> that you know you</font>

195
00:07:48,960 --> 00:07:54,359
could<font color="#E5E5E5"> basically forget to start them</font><font color="#CCCCCC"> or</font>

196
00:07:51,840 --> 00:07:56,159
you<font color="#E5E5E5"> know something could happen in not</font>

197
00:07:54,360 --> 00:07:59,969
realize it right so maybe you<font color="#CCCCCC"> fill the</font>

198
00:07:56,159 --> 00:08:02,069
discourse awfully crashes or you<font color="#E5E5E5"> delete</font>

199
00:07:59,969 --> 00:08:04,169
that<font color="#E5E5E5"> VM that you were working on and now</font>

200
00:08:02,069 --> 00:08:05,310
all<font color="#CCCCCC"> those logs</font><font color="#E5E5E5"> are gone like there's no</font>

201
00:08:04,169 --> 00:08:08,789
were things that<font color="#E5E5E5"> could kind of go wrong</font>

202
00:08:05,310 --> 00:08:11,279
so looking at something<font color="#E5E5E5"> more like a</font>

203
00:08:08,789 --> 00:08:14,159
centralized logging solution<font color="#CCCCCC"> I think</font>

204
00:08:11,279 --> 00:08:16,740
<font color="#CCCCCC">kind</font><font color="#E5E5E5"> of makes sense for us</font><font color="#CCCCCC"> going forward</font>

205
00:08:14,159 --> 00:08:18,330
so like I<font color="#E5E5E5"> said there's nothing</font>

206
00:08:16,740 --> 00:08:21,270
centralized about that it's all<font color="#E5E5E5"> on</font>

207
00:08:18,330 --> 00:08:22,590
<font color="#E5E5E5">different</font><font color="#CCCCCC"> servers if you're you know</font><font color="#E5E5E5"> red</font>

208
00:08:21,270 --> 00:08:23,940
<font color="#E5E5E5">team using multiple teams for versus</font>

209
00:08:22,590 --> 00:08:25,289
like opal strike or multiple<font color="#CCCCCC"> Empire</font>

210
00:08:23,940 --> 00:08:26,789
instances right spread<font color="#E5E5E5"> across your</font>

211
00:08:25,289 --> 00:08:27,930
infrastructure<font color="#E5E5E5"> now you have to go to</font>

212
00:08:26,789 --> 00:08:29,490
each<font color="#CCCCCC"> one of</font><font color="#E5E5E5"> those to</font><font color="#CCCCCC"> find all the</font>

213
00:08:27,930 --> 00:08:32,339
details<font color="#E5E5E5"> on that and that's a bit of a</font>

214
00:08:29,490 --> 00:08:33,599
pain it makes it<font color="#E5E5E5"> kind of difficult to</font>

215
00:08:32,339 --> 00:08:36,000
<font color="#E5E5E5">construct</font><font color="#CCCCCC"> those timelines of</font><font color="#E5E5E5"> what</font>

216
00:08:33,599 --> 00:08:37,229
happened when if I'm<font color="#E5E5E5"> working with the</font>

217
00:08:36,000 --> 00:08:39,360
blue team I<font color="#CCCCCC"> want appeal tell them that</font>

218
00:08:37,229 --> 00:08:42,060
like<font color="#E5E5E5"> at 9:00 a.m. on Sunday all right we</font>

219
00:08:39,360 --> 00:08:43,529
did this thing<font color="#CCCCCC"> to this system</font><font color="#E5E5E5"> and here's</font>

220
00:08:42,059 --> 00:08:45,599
what we saw

221
00:08:43,529 --> 00:08:48,689
that way<font color="#CCCCCC"> can actually help them go back</font>

222
00:08:45,600 --> 00:08:50,459
<font color="#E5E5E5">and correlate</font><font color="#CCCCCC"> within their logs or flow</font>

223
00:08:48,689 --> 00:08:53,699
<font color="#E5E5E5">data or whatever makes sense for that</font>

224
00:08:50,459 --> 00:08:56,339
that sort of<font color="#CCCCCC"> detection makes</font><font color="#E5E5E5"> it sane</font>

225
00:08:53,699 --> 00:08:57,899
right like trying to grep across tons

226
00:08:56,339 --> 00:08:59,970
and tons<font color="#E5E5E5"> of logs across multiple hosts</font>

227
00:08:57,899 --> 00:09:03,089
<font color="#E5E5E5">gets to be a bit of</font><font color="#CCCCCC"> the pain and not</font>

228
00:08:59,970 --> 00:09:05,129
<font color="#E5E5E5">very efficient</font><font color="#CCCCCC"> and then what we found is</font>

229
00:09:03,089 --> 00:09:07,350
that once we started<font color="#E5E5E5"> collecting some</font><font color="#CCCCCC"> of</font>

230
00:09:05,129 --> 00:09:09,569
this data<font color="#E5E5E5"> it was interesting to us and</font>

231
00:09:07,350 --> 00:09:11,910
that we could find different<font color="#E5E5E5"> things that</font>

232
00:09:09,569 --> 00:09:14,550
we we make we make<font color="#E5E5E5"> assumptions</font><font color="#CCCCCC"> a lot in</font>

233
00:09:11,910 --> 00:09:18,749
<font color="#CCCCCC">pentacene and security in general right</font>

234
00:09:14,550 --> 00:09:20,579
and we found once we actually<font color="#E5E5E5"> got some</font>

235
00:09:18,749 --> 00:09:22,230
data we can make better insights into

236
00:09:20,579 --> 00:09:23,849
you know recommendations that were

237
00:09:22,230 --> 00:09:29,249
making<font color="#E5E5E5"> and</font><font color="#CCCCCC"> I'll show</font><font color="#E5E5E5"> a couple examples</font>

238
00:09:23,850 --> 00:09:31,319
of<font color="#E5E5E5"> that</font><font color="#CCCCCC"> so kind of looking at you</font><font color="#E5E5E5"> know</font>

239
00:09:29,249 --> 00:09:32,639
<font color="#E5E5E5">what data could we possibly collect you</font>

240
00:09:31,319 --> 00:09:34,110
know<font color="#E5E5E5"> this is obviously like a super</font>

241
00:09:32,639 --> 00:09:35,579
simplified<font color="#E5E5E5"> diagram and you'll see the</font>

242
00:09:34,110 --> 00:09:38,189
insane monster<font color="#E5E5E5"> that is our</font>

243
00:09:35,579 --> 00:09:40,050
infrastructure<font color="#E5E5E5"> in a couple slides you</font>

244
00:09:38,189 --> 00:09:42,748
know<font color="#E5E5E5"> but you basically have you know the</font>

245
00:09:40,050 --> 00:09:44,279
implant<font color="#CCCCCC"> you've got the raw CT traffic</font>

246
00:09:42,749 --> 00:09:47,069
that goes back and<font color="#CCCCCC"> forth between you and</font>

247
00:09:44,279 --> 00:09:48,959
like your<font color="#E5E5E5"> c2 servers</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> then you've got</font>

248
00:09:47,069 --> 00:09:49,920
<font color="#CCCCCC">that communication of like</font><font color="#E5E5E5"> standalone</font>

249
00:09:48,959 --> 00:09:52,199
<font color="#E5E5E5">tools and maybe that's going</font><font color="#CCCCCC"> through</font>

250
00:09:49,920 --> 00:09:54,059
<font color="#E5E5E5">your c2 or maybe that's directly against</font>

251
00:09:52,199 --> 00:09:55,769
hosts<font color="#E5E5E5"> right so you can do some of these</font>

252
00:09:54,059 --> 00:10:01,139
same<font color="#E5E5E5"> principles for internal engagements</font>

253
00:09:55,769 --> 00:10:04,439
as well<font color="#E5E5E5"> so like</font><font color="#CCCCCC"> you mentioned this</font><font color="#E5E5E5"> is</font>

254
00:10:01,139 --> 00:10:05,610
all based<font color="#CCCCCC"> on like an Elex stack so this</font>

255
00:10:04,439 --> 00:10:08,670
is the general flow if you're not

256
00:10:05,610 --> 00:10:10,040
familiar<font color="#E5E5E5"> with it the beats are the</font>

257
00:10:08,670 --> 00:10:14,759
things that<font color="#CCCCCC"> were in use to</font><font color="#E5E5E5"> collect data</font>

258
00:10:10,040 --> 00:10:18,269
we've got log stash will process<font color="#E5E5E5"> and</font>

259
00:10:14,759 --> 00:10:21,240
aggregate data it's a pretty<font color="#E5E5E5"> it's sort</font>

260
00:10:18,269 --> 00:10:23,040
of like awk<font color="#CCCCCC"> on</font><font color="#E5E5E5"> steroids</font><font color="#CCCCCC"> it can it can</font>

261
00:10:21,240 --> 00:10:26,250
modify and manipulate data<font color="#E5E5E5"> as it</font><font color="#CCCCCC"> comes</font>

262
00:10:23,040 --> 00:10:28,860
in they can also<font color="#E5E5E5"> enrich it</font><font color="#CCCCCC"> elasticsearch</font>

263
00:10:26,250 --> 00:10:30,509
is essentially the<font color="#E5E5E5"> data store and</font><font color="#CCCCCC"> Korean</font>

264
00:10:28,860 --> 00:10:33,449
engine<font color="#E5E5E5"> for everything and then combine</font>

265
00:10:30,509 --> 00:10:36,559
is like the UI on<font color="#CCCCCC"> top of it</font><font color="#E5E5E5"> and so we'll</font>

266
00:10:33,449 --> 00:10:36,559
see a<font color="#CCCCCC"> couple of those components soon</font>

267
00:10:37,160 --> 00:10:41,399
and so for for collecting<font color="#E5E5E5"> that data like</font>

268
00:10:39,990 --> 00:10:46,589
this is what I found to<font color="#CCCCCC"> be the most</font>

269
00:10:41,399 --> 00:10:49,970
useful<font color="#E5E5E5"> for telemetry so</font><font color="#CCCCCC"> packet B with</font>

270
00:10:46,589 --> 00:10:49,970
<font color="#E5E5E5">Albie</font><font color="#CCCCCC"> combi and</font><font color="#E5E5E5"> metric</font><font color="#CCCCCC"> Pete</font>

271
00:10:50,970 --> 00:10:57,450
so<font color="#CCCCCC"> packet beats pretty</font><font color="#E5E5E5"> sweet it decodes</font>

272
00:10:52,950 --> 00:11:00,780
<font color="#E5E5E5">and in stores common protocols so you</font>

273
00:10:57,450 --> 00:11:03,570
know HTTP<font color="#E5E5E5"> DNS MySQL there's there's a</font>

274
00:11:00,780 --> 00:11:05,819
bunch of fairly<font color="#CCCCCC"> common protocols it can</font>

275
00:11:03,570 --> 00:11:09,270
also catch your flows<font color="#E5E5E5"> so like flow</font>

276
00:11:05,820 --> 00:11:10,590
diagrams<font color="#E5E5E5"> you know that could be useful</font>

277
00:11:09,270 --> 00:11:14,010
<font color="#CCCCCC">to</font><font color="#E5E5E5"> if you don't</font><font color="#CCCCCC"> want to capture like</font>

278
00:11:10,590 --> 00:11:15,510
full data<font color="#CCCCCC"> we found this</font><font color="#E5E5E5"> to be really</font>

279
00:11:14,010 --> 00:11:17,580
<font color="#CCCCCC">really useful for like actually</font>

280
00:11:15,510 --> 00:11:20,069
monitoring<font color="#E5E5E5"> like the</font><font color="#CCCCCC"> CTO infrastructure</font>

281
00:11:17,580 --> 00:11:22,320
<font color="#E5E5E5">so think about having like a redirect</font>

282
00:11:20,070 --> 00:11:23,910
errs out on like<font color="#CCCCCC"> your you know the</font><font color="#E5E5E5"> hedge</font>

283
00:11:22,320 --> 00:11:25,830
like<font color="#CCCCCC"> you spend up an ec2 instance or</font>

284
00:11:23,910 --> 00:11:27,270
something digital<font color="#E5E5E5"> ocean the thing</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> out</font>

285
00:11:25,830 --> 00:11:28,920
on<font color="#E5E5E5"> the edge</font><font color="#CCCCCC"> actually receiving</font><font color="#E5E5E5"> that</font>

286
00:11:27,270 --> 00:11:30,449
initial traffic<font color="#E5E5E5"> this is great for</font><font color="#CCCCCC"> that</font>

287
00:11:28,920 --> 00:11:31,979
because<font color="#E5E5E5"> it literally</font><font color="#CCCCCC"> alerts captured</font>

288
00:11:30,450 --> 00:11:34,320
that sort of<font color="#E5E5E5"> data and then send it back</font>

289
00:11:31,980 --> 00:11:38,160
<font color="#CCCCCC">to you</font><font color="#E5E5E5"> even</font><font color="#CCCCCC"> if you have other structure</font>

290
00:11:34,320 --> 00:11:40,470
back<font color="#CCCCCC"> behind it the only limitation that</font>

291
00:11:38,160 --> 00:11:43,469
<font color="#E5E5E5">we found so far</font><font color="#CCCCCC"> with</font><font color="#E5E5E5"> this is that only</font>

292
00:11:40,470 --> 00:11:44,760
<font color="#E5E5E5">supported protocols</font><font color="#CCCCCC"> you can log right so</font>

293
00:11:43,470 --> 00:11:46,320
if they<font color="#E5E5E5"> don't have a protocol or if it's</font>

294
00:11:44,760 --> 00:11:48,120
<font color="#E5E5E5">on a funky port or something like that</font>

295
00:11:46,320 --> 00:11:49,620
<font color="#E5E5E5">you're not going to capture it</font><font color="#CCCCCC"> so what</font>

296
00:11:48,120 --> 00:11:50,940
<font color="#CCCCCC">situ is</font><font color="#E5E5E5"> pretty</font><font color="#CCCCCC"> well-defined</font><font color="#E5E5E5"> right like I</font>

297
00:11:49,620 --> 00:11:52,800
know I'm gonna always gonna<font color="#E5E5E5"> have HTTP on</font>

298
00:11:50,940 --> 00:11:56,100
port 80 I won't send TNS for a DNS

299
00:11:52,800 --> 00:11:59,550
beacons<font color="#E5E5E5"> and so that makes it pretty</font>

300
00:11:56,100 --> 00:12:02,340
<font color="#CCCCCC">prettier for</font><font color="#E5E5E5"> that use case so here's an</font>

301
00:11:59,550 --> 00:12:05,699
example<font color="#E5E5E5"> packet</font><font color="#CCCCCC"> B config this is the one</font>

302
00:12:02,340 --> 00:12:07,020
that we use<font color="#E5E5E5"> it's pretty simple which is</font>

303
00:12:05,700 --> 00:12:08,670
why this is<font color="#E5E5E5"> nice like</font><font color="#CCCCCC"> I'm we're not</font>

304
00:12:07,020 --> 00:12:11,189
having to reinvent the wheel to gather

305
00:12:08,670 --> 00:12:12,930
all this rich data<font color="#E5E5E5"> you know you</font>

306
00:12:11,190 --> 00:12:15,900
basically<font color="#E5E5E5"> tell it what interface to</font>

307
00:12:12,930 --> 00:12:18,660
listen on<font color="#E5E5E5"> and in this case we're</font><font color="#CCCCCC"> not</font>

308
00:12:15,900 --> 00:12:19,800
looking for flows<font color="#E5E5E5"> you can enable it what</font>

309
00:12:18,660 --> 00:12:21,329
are you send it true and restart<font color="#E5E5E5"> the</font>

310
00:12:19,800 --> 00:12:24,000
service and now it's you know capturing

311
00:12:21,330 --> 00:12:25,910
flow data<font color="#CCCCCC"> and you</font><font color="#E5E5E5"> can</font><font color="#CCCCCC"> define</font><font color="#E5E5E5"> which</font>

312
00:12:24,000 --> 00:12:29,430
protocols and so so for<font color="#E5E5E5"> us when</font><font color="#CCCCCC"> were</font>

313
00:12:25,910 --> 00:12:30,810
<font color="#CCCCCC">capturing COBOL strike hybrid data that</font>

314
00:12:29,430 --> 00:12:37,020
<font color="#E5E5E5">right this this</font><font color="#CCCCCC"> will</font><font color="#E5E5E5"> capture all</font><font color="#CCCCCC"> of that</font>

315
00:12:30,810 --> 00:12:40,770
so it gets all<font color="#CCCCCC"> the the</font><font color="#E5E5E5"> DNS traffic</font><font color="#CCCCCC"> words</font>

316
00:12:37,020 --> 00:12:43,410
actually full<font color="#E5E5E5"> DNS queries as well as the</font>

317
00:12:40,770 --> 00:12:46,590
responses<font color="#CCCCCC"> that go back for them as well</font>

318
00:12:43,410 --> 00:12:47,280
<font color="#E5E5E5">as we're capturing like the full</font><font color="#CCCCCC"> keep</font>

319
00:12:46,590 --> 00:12:50,670
showing up there

320
00:12:47,280 --> 00:12:52,380
<font color="#E5E5E5">oh wait a little guy</font>

321
00:12:50,670 --> 00:12:55,020
<font color="#CCCCCC">we're actually capturing the</font><font color="#E5E5E5"> flow</font>

322
00:12:52,380 --> 00:12:57,060
requests and responses<font color="#E5E5E5"> for the HTTP</font>

323
00:12:55,020 --> 00:12:58,670
traffic as well<font color="#E5E5E5"> so then we can see you</font>

324
00:12:57,060 --> 00:13:03,150
know what we're sending<font color="#E5E5E5"> back and forth</font>

325
00:12:58,670 --> 00:13:04,560
<font color="#CCCCCC">on those different requests one thing to</font>

326
00:13:03,150 --> 00:13:06,420
note if you do

327
00:13:04,560 --> 00:13:09,000
try to<font color="#E5E5E5"> implement this for like kobol</font>

328
00:13:06,420 --> 00:13:10,680
strike with a malleable<font color="#CCCCCC"> situ</font><font color="#E5E5E5"> you're able</font>

329
00:13:09,000 --> 00:13:12,840
to define you<font color="#E5E5E5"> know all sorts of</font>

330
00:13:10,680 --> 00:13:16,589
<font color="#E5E5E5">different mime types for it you have to</font>

331
00:13:12,840 --> 00:13:17,670
have the mime type match here if it's

332
00:13:16,590 --> 00:13:19,740
not<font color="#CCCCCC"> in this list it's not</font><font color="#E5E5E5"> going to</font>

333
00:13:17,670 --> 00:13:21,420
capture<font color="#E5E5E5"> it right so</font><font color="#CCCCCC"> I think</font><font color="#E5E5E5"> one of the</font>

334
00:13:19,740 --> 00:13:25,650
profiles<font color="#CCCCCC"> we have been using like</font><font color="#E5E5E5"> using</font>

335
00:13:21,420 --> 00:13:26,910
audio<font color="#E5E5E5"> / mp4 as like its profile and it</font>

336
00:13:25,650 --> 00:13:28,920
wasn't capturing and I couldn't<font color="#E5E5E5"> figure</font>

337
00:13:26,910 --> 00:13:30,930
out for<font color="#CCCCCC"> a</font><font color="#E5E5E5"> while and realize that oh well</font>

338
00:13:28,920 --> 00:13:33,240
<font color="#CCCCCC">it's</font><font color="#E5E5E5"> because that that mime type wasn't</font>

339
00:13:30,930 --> 00:13:34,800
in this<font color="#CCCCCC"> whitelist here</font><font color="#E5E5E5"> so just keep that</font>

340
00:13:33,240 --> 00:13:40,140
<font color="#E5E5E5">in mind</font><font color="#CCCCCC"> if you're</font><font color="#E5E5E5"> gonna use</font><font color="#CCCCCC"> that for a</font>

341
00:13:34,800 --> 00:13:42,390
couple<font color="#CCCCCC"> and strike so comedy is similar</font>

342
00:13:40,140 --> 00:13:45,300
to<font color="#E5E5E5"> packet beat except for it can monitor</font>

343
00:13:42,390 --> 00:13:48,090
<font color="#E5E5E5">all TCP connections so instead of being</font>

344
00:13:45,300 --> 00:13:50,939
<font color="#E5E5E5">like a whitelist of protocols</font><font color="#CCCCCC"> it's any</font>

345
00:13:48,090 --> 00:13:52,650
<font color="#CCCCCC">any TCP connection that happens I think</font>

346
00:13:50,940 --> 00:13:55,620
<font color="#E5E5E5">the other interesting</font><font color="#CCCCCC"> part about it is</font>

347
00:13:52,650 --> 00:13:59,250
it<font color="#CCCCCC"> actually can capture the command line</font>

348
00:13:55,620 --> 00:14:02,220
so so on<font color="#E5E5E5"> left</font><font color="#CCCCCC"> here's an example of what</font>

349
00:13:59,250 --> 00:14:04,770
<font color="#E5E5E5">can</font><font color="#CCCCCC"> be can actually capture I think I</font>

350
00:14:02,220 --> 00:14:09,000
was<font color="#CCCCCC"> just doing you</font><font color="#E5E5E5"> know like a a map</font>

351
00:14:04,770 --> 00:14:11,790
scan<font color="#E5E5E5"> TCP in maps can write because the</font>

352
00:14:09,000 --> 00:14:13,350
the key here is<font color="#CCCCCC"> that</font><font color="#E5E5E5"> only full TCP</font>

353
00:14:11,790 --> 00:14:14,430
connections are logged right<font color="#E5E5E5"> so if</font>

354
00:14:13,350 --> 00:14:15,890
you're trying<font color="#CCCCCC"> to do like a</font><font color="#E5E5E5"> sense can</font>

355
00:14:14,430 --> 00:14:17,910
<font color="#E5E5E5">within map you're not going to catch</font><font color="#CCCCCC"> it</font>

356
00:14:15,890 --> 00:14:20,370
but if you're<font color="#CCCCCC"> doing</font><font color="#E5E5E5"> just sort of like</font>

357
00:14:17,910 --> 00:14:22,319
normal<font color="#CCCCCC"> operations say with like</font>

358
00:14:20,370 --> 00:14:24,840
<font color="#CCCCCC">Metasploit or something like that like</font>

359
00:14:22,320 --> 00:14:28,320
<font color="#E5E5E5">that might this might be great it might</font>

360
00:14:24,840 --> 00:14:30,090
be fine<font color="#CCCCCC"> and as far as</font><font color="#E5E5E5"> I could tell there</font>

361
00:14:28,320 --> 00:14:31,440
<font color="#CCCCCC">was no UDP for this right so if you're</font>

362
00:14:30,090 --> 00:14:34,740
<font color="#CCCCCC">doing anything over</font><font color="#E5E5E5"> UDP so I can't get</font>

363
00:14:31,440 --> 00:14:38,480
captured<font color="#CCCCCC"> so independent use case this</font>

364
00:14:34,740 --> 00:14:38,480
could<font color="#E5E5E5"> be like a good</font><font color="#CCCCCC"> option</font>

365
00:14:38,640 --> 00:14:42,810
another one is metric<font color="#CCCCCC"> beat so this is</font>

366
00:14:41,550 --> 00:14:44,520
newer<font color="#E5E5E5"> it looks like they're trying</font><font color="#CCCCCC"> to</font>

367
00:14:42,810 --> 00:14:48,180
replace<font color="#E5E5E5"> convey with this one so this one</font>

368
00:14:44,520 --> 00:14:50,610
<font color="#E5E5E5">is an official beat from elastic whereas</font>

369
00:14:48,180 --> 00:14:53,819
<font color="#E5E5E5">con beat is one of community beats so</font>

370
00:14:50,610 --> 00:14:57,090
this one is very<font color="#E5E5E5"> similar that only logs</font>

371
00:14:53,820 --> 00:15:01,020
<font color="#CCCCCC">full TCP connections what you get other</font>

372
00:14:57,090 --> 00:15:03,030
interesting things like<font color="#CCCCCC"> letting there's</font>

373
00:15:01,020 --> 00:15:04,710
like<font color="#CCCCCC"> Network IO</font><font color="#E5E5E5"> information you get</font><font color="#CCCCCC"> from</font>

374
00:15:03,030 --> 00:15:06,630
<font color="#E5E5E5">it so like number of packets and and</font>

375
00:15:04,710 --> 00:15:09,630
things like<font color="#CCCCCC"> that</font><font color="#E5E5E5"> so there might be good</font>

376
00:15:06,630 --> 00:15:10,980
sort of<font color="#E5E5E5"> like general data you know how</font>

377
00:15:09,630 --> 00:15:12,840
much<font color="#CCCCCC"> data are</font><font color="#E5E5E5"> you sending to these guys</font>

378
00:15:10,980 --> 00:15:15,120
you<font color="#CCCCCC"> know</font><font color="#E5E5E5"> if</font><font color="#CCCCCC"> we're</font><font color="#E5E5E5"> scanning the heck out</font>

379
00:15:12,840 --> 00:15:16,800
of them right<font color="#E5E5E5"> like oh it's you know 500k</font>

380
00:15:15,120 --> 00:15:21,300
worth of traffic<font color="#E5E5E5"> like at a constant</font>

381
00:15:16,800 --> 00:15:23,040
like<font color="#CCCCCC"> might be</font><font color="#E5E5E5"> interesting</font><font color="#CCCCCC"> to know I</font>

382
00:15:21,300 --> 00:15:27,180
<font color="#E5E5E5">think this</font><font color="#CCCCCC"> is probably</font><font color="#E5E5E5"> one</font><font color="#CCCCCC"> of the more</font>

383
00:15:23,040 --> 00:15:29,250
useful ones for I guess you know pretty

384
00:15:27,180 --> 00:15:30,870
detailed purposes you know<font color="#E5E5E5"> obviously you</font>

385
00:15:29,250 --> 00:15:31,860
know<font color="#E5E5E5"> you've got</font><font color="#CCCCCC"> pcaps right everybody</font>

386
00:15:30,870 --> 00:15:35,010
used to<font color="#E5E5E5"> run</font><font color="#CCCCCC"> t s-- you've been dumping</font>

387
00:15:31,860 --> 00:15:38,370
and dumping that<font color="#E5E5E5"> out to a file</font><font color="#CCCCCC"> so this</font>

388
00:15:35,010 --> 00:15:39,899
is a<font color="#E5E5E5"> flow here</font><font color="#CCCCCC"> put up by elastic talking</font>

389
00:15:38,370 --> 00:15:42,510
about how you can actually get data from

390
00:15:39,899 --> 00:15:44,550
Wireshark or obviously<font color="#E5E5E5"> TCP dump</font>

391
00:15:42,510 --> 00:15:46,829
<font color="#E5E5E5">previously any sort of pcap format and</font>

392
00:15:44,550 --> 00:15:52,410
then get<font color="#E5E5E5"> that over into an l a-- the</font>

393
00:15:46,829 --> 00:15:53,670
stack<font color="#CCCCCC"> so sort of</font><font color="#E5E5E5"> do that</font><font color="#CCCCCC"> and kind of</font>

394
00:15:52,410 --> 00:15:57,959
walk<font color="#CCCCCC"> through that a little bit so you</font>

395
00:15:53,670 --> 00:16:00,649
basically<font color="#E5E5E5"> can run</font><font color="#CCCCCC"> and capture packets so</font>

396
00:15:57,959 --> 00:16:03,719
here's an<font color="#CCCCCC"> example of running t shark</font>

397
00:16:00,649 --> 00:16:06,360
<font color="#E5E5E5">directly to generate that so one</font><font color="#CCCCCC"> of the</font>

398
00:16:03,720 --> 00:16:07,440
cool features<font color="#E5E5E5"> of t shark is</font><font color="#CCCCCC"> that i'm not</font>

399
00:16:06,360 --> 00:16:09,029
<font color="#CCCCCC">sure when they publish</font><font color="#E5E5E5"> it but there's</font>

400
00:16:07,440 --> 00:16:12,510
this EK format so it's basically

401
00:16:09,029 --> 00:16:14,820
<font color="#E5E5E5">elasticsearch format which means that</font>

402
00:16:12,510 --> 00:16:18,120
what it's<font color="#E5E5E5"> going to output to standard</font>

403
00:16:14,820 --> 00:16:20,670
out is a single line<font color="#CCCCCC"> json format for</font>

404
00:16:18,120 --> 00:16:24,420
each packet<font color="#E5E5E5"> that can just be directly</font>

405
00:16:20,670 --> 00:16:27,569
ingested by elasticsearch or is<font color="#CCCCCC"> i think</font>

406
00:16:24,420 --> 00:16:31,620
<font color="#CCCCCC">their normal json is like one giant json</font>

407
00:16:27,570 --> 00:16:34,560
object so it helps<font color="#CCCCCC"> with the format</font>

408
00:16:31,620 --> 00:16:35,670
options<font color="#CCCCCC"> you know so in this example</font><font color="#E5E5E5"> here</font>

409
00:16:34,560 --> 00:16:38,069
I'm showing you could you could put this

410
00:16:35,670 --> 00:16:39,449
with in something like supervisor<font color="#CCCCCC"> D so</font>

411
00:16:38,070 --> 00:16:40,740
they would automatically<font color="#CCCCCC"> start up</font><font color="#E5E5E5"> you</font>

412
00:16:39,450 --> 00:16:44,100
know<font color="#E5E5E5"> since you booted the system up and</font>

413
00:16:40,740 --> 00:16:45,750
<font color="#CCCCCC">will start logging those packets and</font>

414
00:16:44,100 --> 00:16:49,230
then you know you don't<font color="#E5E5E5"> have to worry</font>

415
00:16:45,750 --> 00:16:50,579
<font color="#CCCCCC">about that not</font><font color="#E5E5E5"> running</font><font color="#CCCCCC"> my only caution</font>

416
00:16:49,230 --> 00:16:53,910
about<font color="#E5E5E5"> this is I found this extremely</font>

417
00:16:50,579 --> 00:16:55,469
<font color="#CCCCCC">memory intensive I think it for what a</font>

418
00:16:53,910 --> 00:16:57,839
reason it seems to keep all that<font color="#CCCCCC"> data in</font>

419
00:16:55,470 --> 00:17:00,779
<font color="#E5E5E5">RAM like as</font><font color="#CCCCCC"> it's writing</font><font color="#E5E5E5"> out the</font><font color="#CCCCCC"> JSON</font>

420
00:16:57,839 --> 00:17:02,430
files<font color="#CCCCCC"> and when I first</font><font color="#E5E5E5"> ran this I'm like</font>

421
00:17:00,779 --> 00:17:04,709
why is<font color="#E5E5E5"> like why did this thing get</font>

422
00:17:02,430 --> 00:17:06,688
killed<font color="#E5E5E5"> like I got</font><font color="#CCCCCC"> em killed on</font><font color="#E5E5E5"> T shark</font>

423
00:17:04,709 --> 00:17:08,339
<font color="#CCCCCC">and so I started looking</font><font color="#E5E5E5"> at</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> and I'm</font>

424
00:17:06,689 --> 00:17:10,079
like oh this just<font color="#E5E5E5"> ate</font><font color="#CCCCCC"> up like an entire</font>

425
00:17:08,339 --> 00:17:13,109
gig of ram<font color="#E5E5E5"> trying to</font><font color="#CCCCCC"> capture like a</font>

426
00:17:10,079 --> 00:17:18,300
single<font color="#E5E5E5"> in map scan of a host for like</font>

427
00:17:13,109 --> 00:17:20,750
<font color="#E5E5E5">65,000 ports</font><font color="#CCCCCC"> so it it is like</font><font color="#E5E5E5"> that you</font>

428
00:17:18,300 --> 00:17:23,309
<font color="#E5E5E5">can do that but it seems like it's very</font>

429
00:17:20,750 --> 00:17:25,109
inefficient<font color="#CCCCCC"> so I think</font><font color="#E5E5E5"> probably what a</font>

430
00:17:23,309 --> 00:17:28,889
better<font color="#E5E5E5"> workflow is is to actually use</font>

431
00:17:25,109 --> 00:17:30,600
TCP dump<font color="#E5E5E5"> to</font><font color="#CCCCCC"> T shark</font><font color="#E5E5E5"> which didn't</font>

432
00:17:28,890 --> 00:17:31,740
<font color="#E5E5E5">universally JSON so</font>

433
00:17:30,600 --> 00:17:34,530
<font color="#CCCCCC">here's a couple</font><font color="#E5E5E5"> options for</font><font color="#CCCCCC"> doing</font><font color="#E5E5E5"> that</font>

434
00:17:31,740 --> 00:17:35,730
right you can use you know<font color="#CCCCCC"> TCP dump in</font>

435
00:17:34,530 --> 00:17:39,780
record kind of like you

436
00:17:35,730 --> 00:17:43,890
classically have and do some rotation

437
00:17:39,780 --> 00:17:45,210
here there's a couple keys<font color="#E5E5E5"> is that you</font>

438
00:17:43,890 --> 00:17:46,799
should<font color="#E5E5E5"> make sure</font><font color="#CCCCCC"> that you're not</font><font color="#E5E5E5"> also</font>

439
00:17:45,210 --> 00:17:50,910
recording your elasticsearch traffic

440
00:17:46,799 --> 00:17:52,530
back to your<font color="#E5E5E5"> hosts</font><font color="#CCCCCC"> I couldn't figure out</font>

441
00:17:50,910 --> 00:17:55,020
<font color="#E5E5E5">why I was generating like tons and tons</font>

442
00:17:52,530 --> 00:17:57,780
of<font color="#CCCCCC"> traffic for a while I'm</font><font color="#E5E5E5"> like why is</font>

443
00:17:55,020 --> 00:18:00,690
<font color="#E5E5E5">this like gigs of</font><font color="#CCCCCC"> pcaps when</font><font color="#E5E5E5"> I'm trying</font>

444
00:17:57,780 --> 00:18:02,309
<font color="#CCCCCC">to</font><font color="#E5E5E5"> scan like</font><font color="#CCCCCC"> a particular</font><font color="#E5E5E5"> you know host</font>

445
00:18:00,690 --> 00:18:03,900
<font color="#E5E5E5">and I realized oh yeah well I'm also</font>

446
00:18:02,309 --> 00:18:06,480
<font color="#CCCCCC">capturing like the traffic</font><font color="#E5E5E5"> sending back</font>

447
00:18:03,900 --> 00:18:07,860
<font color="#E5E5E5">to ELQ which then generates another</font><font color="#CCCCCC"> well</font>

448
00:18:06,480 --> 00:18:11,700
gets like<font color="#CCCCCC"> this recursive loop and just</font>

449
00:18:07,860 --> 00:18:14,580
like<font color="#E5E5E5"> flew everything so don't screw that</font>

450
00:18:11,700 --> 00:18:15,960
up<font color="#E5E5E5"> like I did</font><font color="#CCCCCC"> so so you</font><font color="#E5E5E5"> can basically</font>

451
00:18:14,580 --> 00:18:18,629
<font color="#E5E5E5">dump that straight to a file like you</font>

452
00:18:15,960 --> 00:18:20,720
typically have<font color="#CCCCCC"> in the past or you can</font>

453
00:18:18,630 --> 00:18:24,440
use<font color="#E5E5E5"> T shark to do something similar and</font>

454
00:18:20,720 --> 00:18:27,929
<font color="#CCCCCC">do some rotation on it</font><font color="#E5E5E5"> and then</font>

455
00:18:24,440 --> 00:18:30,030
basically use like a for loop and the T

456
00:18:27,929 --> 00:18:31,350
<font color="#CCCCCC">chart command similar to what we saw</font><font color="#E5E5E5"> in</font>

457
00:18:30,030 --> 00:18:33,600
the previous slide where you<font color="#E5E5E5"> were</font>

458
00:18:31,350 --> 00:18:35,490
basically reading that pcap file instead

459
00:18:33,600 --> 00:18:37,469
of<font color="#CCCCCC"> Rhian from you know the wire as is</font>

460
00:18:35,490 --> 00:18:39,720
happening<font color="#CCCCCC"> read it from that file we're</font>

461
00:18:37,470 --> 00:18:43,350
running it through the parser so it

462
00:18:39,720 --> 00:18:45,900
kicks<font color="#E5E5E5"> up that</font><font color="#CCCCCC"> last search and then dumps</font>

463
00:18:43,350 --> 00:18:48,059
it to<font color="#E5E5E5"> a JSON file or I haven't played</font>

464
00:18:45,900 --> 00:18:49,950
and gotten this<font color="#E5E5E5"> to work but TCP dump</font>

465
00:18:48,059 --> 00:18:51,780
does have<font color="#E5E5E5"> a - the option for</font><font color="#CCCCCC"> a post</font>

466
00:18:49,950 --> 00:18:54,929
rotate command so say you want<font color="#CCCCCC"> to rotate</font>

467
00:18:51,780 --> 00:18:57,360
every 10 Meg's or whatever you want<font color="#E5E5E5"> it</font>

468
00:18:54,929 --> 00:18:58,710
<font color="#E5E5E5">to be you can specify command to run</font>

469
00:18:57,360 --> 00:19:00,360
after<font color="#E5E5E5"> that so you can maybe use like</font>

470
00:18:58,710 --> 00:19:02,640
that<font color="#CCCCCC"> T chart</font><font color="#E5E5E5"> to JSON command so that</font>

471
00:19:00,360 --> 00:19:04,590
once<font color="#E5E5E5"> you rotate it'll automatically</font>

472
00:19:02,640 --> 00:19:07,049
convert<font color="#CCCCCC"> it to</font><font color="#E5E5E5"> JSON and</font><font color="#CCCCCC"> then if you set</font>

473
00:19:04,590 --> 00:19:09,330
<font color="#E5E5E5">up a file beat listener</font>

474
00:19:07,049 --> 00:19:11,039
you'd be<font color="#E5E5E5"> all able</font><font color="#CCCCCC"> to automatically</font>

475
00:19:09,330 --> 00:19:18,750
convert<font color="#E5E5E5"> that</font><font color="#CCCCCC"> and then import that</font><font color="#E5E5E5"> into</font>

476
00:19:11,039 --> 00:19:22,440
like an<font color="#CCCCCC"> elasticsearch stack so here's an</font>

477
00:19:18,750 --> 00:19:24,360
example file<font color="#E5E5E5"> beat setup so file beat is</font>

478
00:19:22,440 --> 00:19:28,590
another one<font color="#E5E5E5"> of the</font><font color="#CCCCCC"> the beats</font><font color="#E5E5E5"> that's</font>

479
00:19:24,360 --> 00:19:32,039
available for<font color="#CCCCCC"> elasticsearch</font><font color="#E5E5E5"> it focuses</font>

480
00:19:28,590 --> 00:19:35,100
obviously on files<font color="#E5E5E5"> creatively names and</font>

481
00:19:32,039 --> 00:19:36,539
and it's pretty slick in and we're gonna

482
00:19:35,100 --> 00:19:38,590
use probably<font color="#CCCCCC"> fala</font><font color="#E5E5E5"> be for like the rest</font>

483
00:19:36,539 --> 00:19:40,270
of the demonstration here

484
00:19:38,590 --> 00:19:42,520
it's like in<font color="#CCCCCC"> that you can basically</font><font color="#E5E5E5"> just</font>

485
00:19:40,270 --> 00:19:45,010
<font color="#E5E5E5">point it at like here's a log location</font>

486
00:19:42,520 --> 00:19:47,290
and it<font color="#E5E5E5"> will automatically ingest those</font>

487
00:19:45,010 --> 00:19:49,210
<font color="#E5E5E5">logs as they come through</font><font color="#CCCCCC"> it's it's</font>

488
00:19:47,290 --> 00:19:50,500
slick in that like impact could<font color="#E5E5E5"> be the</font>

489
00:19:49,210 --> 00:19:54,520
same way and really<font color="#E5E5E5"> anything that</font><font color="#CCCCCC"> uses</font>

490
00:19:50,500 --> 00:19:56,590
<font color="#E5E5E5">labeed</font><font color="#CCCCCC"> as it will know that</font><font color="#E5E5E5"> if it starts</font>

491
00:19:54,520 --> 00:19:57,790
<font color="#CCCCCC">to lose communication to the ELQ server</font>

492
00:19:56,590 --> 00:20:00,010
you're not going to drop those logs

493
00:19:57,790 --> 00:20:01,570
right<font color="#E5E5E5"> so if you have syslog sometimes it</font>

494
00:20:00,010 --> 00:20:02,980
just<font color="#E5E5E5"> goes to like</font><font color="#CCCCCC"> Deb know where as in</font>

495
00:20:01,570 --> 00:20:04,450
this case they're guaranteed to<font color="#E5E5E5"> get</font>

496
00:20:02,980 --> 00:20:06,070
there as long<font color="#CCCCCC"> as</font><font color="#E5E5E5"> you know eventually it</font>

497
00:20:04,450 --> 00:20:09,190
<font color="#CCCCCC">comes back up you don't</font><font color="#E5E5E5"> lose</font><font color="#CCCCCC"> discs or</font>

498
00:20:06,070 --> 00:20:10,720
services on crash<font color="#CCCCCC"> it's like we've</font>

499
00:20:09,190 --> 00:20:12,550
screwed I've screwed up infrastructure

500
00:20:10,720 --> 00:20:14,230
<font color="#E5E5E5">like our</font><font color="#CCCCCC"> elasticsearch server where it</font>

501
00:20:12,550 --> 00:20:15,820
you know went down<font color="#E5E5E5"> all right we ran out</font>

502
00:20:14,230 --> 00:20:17,790
of<font color="#E5E5E5"> RAM on our box</font><font color="#CCCCCC"> because like this</font>

503
00:20:15,820 --> 00:20:20,350
stuff is all like super<font color="#E5E5E5"> memory intensive</font>

504
00:20:17,790 --> 00:20:22,570
<font color="#E5E5E5">and so you know we went down and well</font>

505
00:20:20,350 --> 00:20:24,129
the packet beat and the file beat

506
00:20:22,570 --> 00:20:26,080
listeners we're continuing to spool that

507
00:20:24,130 --> 00:20:27,430
up and then as soon<font color="#E5E5E5"> as that came back up</font>

508
00:20:26,080 --> 00:20:29,080
if<font color="#CCCCCC"> flushed it all out and</font><font color="#E5E5E5"> was able to</font>

509
00:20:27,430 --> 00:20:31,980
you know recover<font color="#E5E5E5"> all that data which is</font>

510
00:20:29,080 --> 00:20:34,120
great<font color="#CCCCCC"> so</font><font color="#E5E5E5"> file beat is able to read in</font>

511
00:20:31,980 --> 00:20:35,920
individual log files and<font color="#E5E5E5"> it will monitor</font>

512
00:20:34,120 --> 00:20:37,479
<font color="#E5E5E5">them for changes and</font><font color="#CCCCCC"> so once these</font>

513
00:20:35,920 --> 00:20:39,400
changes<font color="#CCCCCC"> it will reparse them and then</font>

514
00:20:37,480 --> 00:20:41,020
ship them off<font color="#E5E5E5"> so in this case we're</font>

515
00:20:39,400 --> 00:20:43,270
<font color="#CCCCCC">looking at an example here where</font><font color="#E5E5E5"> I've</font>

516
00:20:41,020 --> 00:20:45,280
got<font color="#CCCCCC"> the VAR log</font><font color="#E5E5E5"> P caps so imagine I'm</font>

517
00:20:43,270 --> 00:20:48,700
you know writing that data out with you

518
00:20:45,280 --> 00:20:51,850
know via<font color="#CCCCCC"> T</font><font color="#E5E5E5"> shark to a JSON file and now</font>

519
00:20:48,700 --> 00:20:53,260
you've got a<font color="#CCCCCC"> couple</font><font color="#E5E5E5"> of key</font><font color="#CCCCCC"> things I've</font>

520
00:20:51,850 --> 00:20:54,909
got highlighted<font color="#CCCCCC"> here right is</font><font color="#E5E5E5"> make sure</font>

521
00:20:53,260 --> 00:20:57,910
<font color="#CCCCCC">this points to like where the you know</font>

522
00:20:54,910 --> 00:21:00,280
<font color="#E5E5E5">what files aren't obviously</font><font color="#CCCCCC"> this JSON</font>

523
00:20:57,910 --> 00:21:03,070
<font color="#CCCCCC">Keys under</font><font color="#E5E5E5"> root basically means this is</font>

524
00:21:00,280 --> 00:21:07,090
a structured log file format which<font color="#CCCCCC"> means</font>

525
00:21:03,070 --> 00:21:11,649
that it's one line per entry<font color="#E5E5E5"> and each</font>

526
00:21:07,090 --> 00:21:17,620
line is a JSON file in itself<font color="#E5E5E5"> or JSON</font>

527
00:21:11,650 --> 00:21:18,100
object structure<font color="#CCCCCC"> excuse me and obviously</font>

528
00:21:17,620 --> 00:21:20,439
down here

529
00:21:18,100 --> 00:21:27,219
change your<font color="#E5E5E5"> elasticsearch output to</font>

530
00:21:20,440 --> 00:21:29,410
where it needs to<font color="#E5E5E5"> go</font><font color="#CCCCCC"> to so so this will</font>

531
00:21:27,220 --> 00:21:31,540
ingest and then take any any files<font color="#E5E5E5"> of</font>

532
00:21:29,410 --> 00:21:38,170
the season shove these<font color="#E5E5E5"> pick up data over</font>

533
00:21:31,540 --> 00:21:39,850
to<font color="#E5E5E5"> an elastic search stack so big</font>

534
00:21:38,170 --> 00:21:43,630
<font color="#E5E5E5">advantage of this is like you can do all</font>

535
00:21:39,850 --> 00:21:45,399
traffic<font color="#CCCCCC"> right you can use filters to</font>

536
00:21:43,630 --> 00:21:46,540
ignore traffic I would<font color="#CCCCCC"> say</font><font color="#E5E5E5"> like you know</font>

537
00:21:45,400 --> 00:21:48,490
<font color="#E5E5E5">to the like filter out your own</font>

538
00:21:46,540 --> 00:21:49,480
<font color="#CCCCCC">elasticsearch traffic is pretty handy so</font>

539
00:21:48,490 --> 00:21:51,740
you don't get a whole<font color="#E5E5E5"> bunch</font><font color="#CCCCCC"> of garbage</font>

540
00:21:49,480 --> 00:21:55,279
<font color="#E5E5E5">in there</font>

541
00:21:51,740 --> 00:21:57,110
and the<font color="#E5E5E5"> only limitation is compared to</font>

542
00:21:55,279 --> 00:21:59,120
like<font color="#CCCCCC"> Han beat is it you can't tie that</font>

543
00:21:57,110 --> 00:22:01,309
<font color="#E5E5E5">traffic</font><font color="#CCCCCC"> back to</font><font color="#E5E5E5"> you an actual command</font>

544
00:21:59,120 --> 00:22:04,459
that<font color="#E5E5E5"> you ran now if you can start</font>

545
00:22:01,309 --> 00:22:05,899
overlaying<font color="#E5E5E5"> other you know say logs like</font>

546
00:22:04,460 --> 00:22:07,460
<font color="#E5E5E5">you know you're doing like a session log</font>

547
00:22:05,899 --> 00:22:09,020
<font color="#E5E5E5">on like your batch console or something</font>

548
00:22:07,460 --> 00:22:10,610
like<font color="#E5E5E5"> that and you're overlaying that</font>

549
00:22:09,020 --> 00:22:14,418
<font color="#E5E5E5">with you know this type</font><font color="#CCCCCC"> of traffic</font><font color="#E5E5E5"> can</font>

550
00:22:10,610 --> 00:22:15,830
get<font color="#CCCCCC"> something similar alright so now</font>

551
00:22:14,419 --> 00:22:17,029
we're<font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> talk</font><font color="#CCCCCC"> about</font><font color="#E5E5E5"> couple strike</font>

552
00:22:15,830 --> 00:22:18,500
right<font color="#E5E5E5"> so that was sort of primer</font><font color="#CCCCCC"> around</font>

553
00:22:17,029 --> 00:22:20,630
like what are these sorts of<font color="#CCCCCC"> things and</font>

554
00:22:18,500 --> 00:22:22,820
how<font color="#E5E5E5"> could we kind of use these now we're</font>

555
00:22:20,630 --> 00:22:29,270
going<font color="#E5E5E5"> to talk</font><font color="#CCCCCC"> about how we actually use</font>

556
00:22:22,820 --> 00:22:31,010
<font color="#CCCCCC">this with a cobalt strike so this is a</font>

557
00:22:29,270 --> 00:22:33,590
representation of what<font color="#CCCCCC"> we use for our</font>

558
00:22:31,010 --> 00:22:36,799
infrastructure<font color="#CCCCCC"> so I blogged about this</font>

559
00:22:33,590 --> 00:22:40,370
before linking down at the bottom<font color="#E5E5E5"> so we</font>

560
00:22:36,799 --> 00:22:42,020
actually<font color="#E5E5E5"> use on Prem</font><font color="#CCCCCC"> team servers so</font>

561
00:22:40,370 --> 00:22:44,949
that<font color="#CCCCCC"> you know we can ensure</font><font color="#E5E5E5"> data</font>

562
00:22:42,020 --> 00:22:48,139
protection and<font color="#E5E5E5"> things like</font><font color="#CCCCCC"> that we use</font>

563
00:22:44,950 --> 00:22:49,789
<font color="#E5E5E5">redirect errs out</font><font color="#CCCCCC"> in AWS so we can you</font>

564
00:22:48,140 --> 00:22:52,070
know you<font color="#E5E5E5"> know spin up however many</font>

565
00:22:49,789 --> 00:22:56,870
instances<font color="#E5E5E5"> that we want we're actually</font>

566
00:22:52,070 --> 00:22:57,980
running multiple<font color="#E5E5E5"> versions of</font><font color="#CCCCCC"> COBOL</font>

567
00:22:56,870 --> 00:22:59,178
<font color="#E5E5E5">strike so we have what we call our</font>

568
00:22:57,980 --> 00:23:00,649
<font color="#E5E5E5">working which</font><font color="#CCCCCC"> is like sort</font><font color="#E5E5E5"> of our</font>

569
00:22:59,179 --> 00:23:03,649
<font color="#CCCCCC">day-to-day stuff like I'm gonna</font><font color="#E5E5E5"> run</font>

570
00:23:00,649 --> 00:23:05,449
commands<font color="#CCCCCC"> and do</font><font color="#E5E5E5"> do you know attacker</font>

571
00:23:03,649 --> 00:23:06,949
type things and<font color="#CCCCCC"> we've got our</font><font color="#E5E5E5"> long haul</font>

572
00:23:05,450 --> 00:23:09,440
which are supposed to be<font color="#E5E5E5"> like super low</font>

573
00:23:06,950 --> 00:23:11,539
and<font color="#CCCCCC"> slow</font><font color="#E5E5E5"> as well as we also have a dev</font>

574
00:23:09,440 --> 00:23:13,549
as well but<font color="#E5E5E5"> I need to put three of these</font>

575
00:23:11,539 --> 00:23:14,840
up here<font color="#CCCCCC"> so obviously like we've got a</font>

576
00:23:13,549 --> 00:23:16,039
<font color="#E5E5E5">good</font><font color="#CCCCCC"> amount of</font><font color="#E5E5E5"> infrastructure right and</font>

577
00:23:14,840 --> 00:23:17,360
like how do<font color="#E5E5E5"> we like start to get</font><font color="#CCCCCC"> all the</font>

578
00:23:16,039 --> 00:23:19,779
<font color="#E5E5E5">stuff and correlate this and understand</font>

579
00:23:17,360 --> 00:23:23,750
you<font color="#CCCCCC"> know what the</font><font color="#E5E5E5"> hell is going on here</font>

580
00:23:19,779 --> 00:23:25,039
<font color="#CCCCCC">and and so in this</font><font color="#E5E5E5"> case in the diagram</font>

581
00:23:23,750 --> 00:23:27,320
we kind of see here where we've got

582
00:23:25,039 --> 00:23:29,179
<font color="#E5E5E5">pakka beat so</font><font color="#CCCCCC"> peg</font><font color="#E5E5E5"> could be sits on these</font>

583
00:23:27,320 --> 00:23:32,600
redirect errs they're the ones that<font color="#CCCCCC"> are</font>

584
00:23:29,179 --> 00:23:34,309
<font color="#CCCCCC">gonna accept that</font><font color="#E5E5E5"> see to traffic for us</font>

585
00:23:32,600 --> 00:23:38,059
that could<font color="#CCCCCC"> be is</font><font color="#E5E5E5"> going to</font><font color="#CCCCCC"> capture</font><font color="#E5E5E5"> that</font>

586
00:23:34,309 --> 00:23:39,529
data<font color="#E5E5E5"> forward it back to our elk stack so</font>

587
00:23:38,059 --> 00:23:41,418
we're gonna get all the<font color="#CCCCCC"> the visibility</font>

588
00:23:39,529 --> 00:23:43,610
here of whatever<font color="#E5E5E5"> is coming</font><font color="#CCCCCC"> into</font><font color="#E5E5E5"> the box</font>

589
00:23:41,419 --> 00:23:48,620
<font color="#E5E5E5">we know</font><font color="#CCCCCC"> about it</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> on the</font><font color="#E5E5E5"> back side</font>

590
00:23:43,610 --> 00:23:50,990
<font color="#CCCCCC">here we've got</font><font color="#E5E5E5"> file</font><font color="#CCCCCC"> B with a custom JSON</font>

591
00:23:48,620 --> 00:23:53,629
logger<font color="#E5E5E5"> that</font><font color="#CCCCCC"> I wrote that will do a demo</font>

592
00:23:50,990 --> 00:23:55,640
of here in a minute<font color="#CCCCCC"> but it's basically</font>

593
00:23:53,630 --> 00:23:56,899
logging everything<font color="#E5E5E5"> that happens within</font>

594
00:23:55,640 --> 00:23:58,520
like<font color="#E5E5E5"> the cobalt strike infrastructure</font>

595
00:23:56,899 --> 00:24:00,979
that<font color="#E5E5E5"> that you're doing</font><font color="#CCCCCC"> right so if you</font>

596
00:23:58,520 --> 00:24:02,580
run<font color="#E5E5E5"> commands</font><font color="#CCCCCC"> I know that you know the</font>

597
00:24:00,980 --> 00:24:05,190
operator ran that command right or

598
00:24:02,580 --> 00:24:06,960
if you know when beacons<font color="#E5E5E5"> show up they</font>

599
00:24:05,190 --> 00:24:11,820
also gets logged as well so we'll see

600
00:24:06,960 --> 00:24:15,690
<font color="#E5E5E5">some</font><font color="#CCCCCC"> examples of</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> so a couple strike</font>

601
00:24:11,820 --> 00:24:18,299
they bricked vlogs down by by day and by

602
00:24:15,690 --> 00:24:22,350
<font color="#CCCCCC">hosts in my type</font><font color="#E5E5E5"> so here's a little</font>

603
00:24:18,299 --> 00:24:23,970
<font color="#E5E5E5">screenshot of that</font><font color="#CCCCCC"> it it can be</font><font color="#E5E5E5"> done to</font>

604
00:24:22,350 --> 00:24:27,149
to read<font color="#E5E5E5"> these logs directly they're not</font>

605
00:24:23,970 --> 00:24:29,490
very clean they're multi-line logs<font color="#CCCCCC"> with</font>

606
00:24:27,149 --> 00:24:31,799
a funky<font color="#CCCCCC"> timestamp on them</font>

607
00:24:29,490 --> 00:24:34,320
and so you're<font color="#E5E5E5"> able to you can't parse</font>

608
00:24:31,799 --> 00:24:37,080
them with<font color="#CCCCCC"> logstash if you wanted to do</font>

609
00:24:34,320 --> 00:24:38,519
<font color="#E5E5E5">that but what I found was that it was</font>

610
00:24:37,080 --> 00:24:41,990
missing<font color="#E5E5E5"> some of the data</font><font color="#CCCCCC"> that it</font><font color="#E5E5E5"> was</font>

611
00:24:38,519 --> 00:24:44,340
kind of interested in<font color="#E5E5E5"> so there was</font>

612
00:24:41,990 --> 00:24:47,549
what's called artifact data<font color="#CCCCCC"> right so if</font>

613
00:24:44,340 --> 00:24:48,779
you go and<font color="#E5E5E5"> you try to</font><font color="#CCCCCC"> generate</font><font color="#E5E5E5"> there's a</font>

614
00:24:47,549 --> 00:24:50,210
coupled report<font color="#E5E5E5"> types one</font><font color="#CCCCCC"> of them says</font>

615
00:24:48,779 --> 00:24:52,409
you know show indicators<font color="#CCCCCC"> are compromised</font>

616
00:24:50,210 --> 00:24:53,610
<font color="#CCCCCC">and then you're</font><font color="#E5E5E5"> like here's a whole</font>

617
00:24:52,409 --> 00:24:56,309
bunch<font color="#CCCCCC"> of cool data that comes</font><font color="#E5E5E5"> out of it</font>

618
00:24:53,610 --> 00:24:57,840
like<font color="#E5E5E5"> you know here's file hashes</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> it</font>

619
00:24:56,309 --> 00:25:00,269
<font color="#CCCCCC">just says</font><font color="#E5E5E5"> like oh you dropped these file</font>

620
00:24:57,840 --> 00:25:03,029
these<font color="#E5E5E5"> five file hashes</font><font color="#CCCCCC"> on your</font>

621
00:25:00,269 --> 00:25:05,000
engagement<font color="#CCCCCC"> but no no correlation - like</font>

622
00:25:03,029 --> 00:25:07,590
what host or what times or winter where

623
00:25:05,000 --> 00:25:09,120
the data is<font color="#E5E5E5"> in there it just</font><font color="#CCCCCC"> doesn't get</font>

624
00:25:07,590 --> 00:25:12,029
pulled<font color="#E5E5E5"> out by default in that default</font>

625
00:25:09,120 --> 00:25:14,610
report and<font color="#E5E5E5"> also gives doesn't get</font>

626
00:25:12,029 --> 00:25:16,080
<font color="#E5E5E5">written out to logs and so I said when</font>

627
00:25:14,610 --> 00:25:17,969
we<font color="#CCCCCC"> started looking</font><font color="#E5E5E5"> at this one of the</font>

628
00:25:16,080 --> 00:25:19,889
<font color="#E5E5E5">things I was seeing was</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> well where</font>

629
00:25:17,970 --> 00:25:21,240
is this data<font color="#CCCCCC"> right like I'm seeing that</font>

630
00:25:19,889 --> 00:25:23,490
when you<font color="#E5E5E5"> generate those reports it shows</font>

631
00:25:21,240 --> 00:25:25,260
<font color="#E5E5E5">that here's your like</font><font color="#CCCCCC"> miter attack TTP's</font>

632
00:25:23,490 --> 00:25:27,840
which is one<font color="#E5E5E5"> of the ways</font><font color="#CCCCCC"> that we're</font>

633
00:25:25,260 --> 00:25:29,039
using to communicate<font color="#E5E5E5"> to the blue team so</font>

634
00:25:27,840 --> 00:25:31,740
I'm like well<font color="#CCCCCC"> I want</font><font color="#E5E5E5"> that data and I</font>

635
00:25:29,039 --> 00:25:35,519
want<font color="#CCCCCC"> that data in Elk and figured out</font>

636
00:25:31,740 --> 00:25:38,610
that it's not<font color="#CCCCCC"> actually in the log so I</font>

637
00:25:35,519 --> 00:25:41,370
go hunting<font color="#E5E5E5"> for it and write code which</font>

638
00:25:38,610 --> 00:25:42,840
doesn't always<font color="#E5E5E5"> turn out well but we'll</font>

639
00:25:41,370 --> 00:25:46,229
get to it<font color="#E5E5E5"> in a minute</font>

640
00:25:42,840 --> 00:25:49,260
so basically decided to write a coal

641
00:25:46,230 --> 00:25:50,519
strike<font color="#E5E5E5"> structured logging blogger so</font>

642
00:25:49,260 --> 00:25:51,600
<font color="#E5E5E5">basically and like I said</font><font color="#CCCCCC"> before you</font>

643
00:25:50,519 --> 00:25:56,669
<font color="#E5E5E5">know structured logging is where you've</font>

644
00:25:51,600 --> 00:25:59,699
<font color="#E5E5E5">got a JSON log</font><font color="#CCCCCC"> one-line</font><font color="#E5E5E5"> is an entire</font><font color="#CCCCCC"> log</font>

645
00:25:56,669 --> 00:26:01,679
entry<font color="#CCCCCC"> and</font><font color="#E5E5E5"> it has all the correct key</font>

646
00:25:59,700 --> 00:26:04,889
value pairs that<font color="#CCCCCC"> you</font><font color="#E5E5E5"> need for your log</font>

647
00:26:01,679 --> 00:26:08,130
entry<font color="#CCCCCC"> it works really</font><font color="#E5E5E5"> well with file</font>

648
00:26:04,889 --> 00:26:11,158
beam<font color="#E5E5E5"> that you can just ingest that you</font>

649
00:26:08,130 --> 00:26:12,720
can also do<font color="#E5E5E5"> like data enrichment things</font>

650
00:26:11,159 --> 00:26:15,210
like that with log stash as<font color="#CCCCCC"> stuffs comes</font>

651
00:26:12,720 --> 00:26:17,120
through<font color="#CCCCCC"> so it works</font><font color="#E5E5E5"> really well for like</font>

652
00:26:15,210 --> 00:26:21,150
the<font color="#CCCCCC"> entire flow</font>

653
00:26:17,120 --> 00:26:23,629
<font color="#E5E5E5">all right so now we're in try this what</font>

654
00:26:21,150 --> 00:26:23,630
<font color="#E5E5E5">could possibly go wrong</font>

655
00:26:24,210 --> 00:26:36,630
<font color="#E5E5E5">all right so the right window a we're</font>

656
00:26:34,830 --> 00:26:42,449
<font color="#CCCCCC">just connected</font><font color="#E5E5E5"> like I said would go</font>

657
00:26:36,630 --> 00:26:44,550
wrong<font color="#E5E5E5"> all right so this coal</font><font color="#CCCCCC"> will</font><font color="#E5E5E5"> strike</font>

658
00:26:42,450 --> 00:26:45,690
if you haven't seen it<font color="#CCCCCC"> there's a couple</font>

659
00:26:44,550 --> 00:26:53,190
<font color="#CCCCCC">things that I'm going</font><font color="#E5E5E5"> to show you here</font>

660
00:26:45,690 --> 00:26:54,450
so there are a<font color="#E5E5E5"> few a few things so so</font>

661
00:26:53,190 --> 00:26:56,940
under the<font color="#CCCCCC"> hood</font><font color="#E5E5E5"> there's a thing called</font>

662
00:26:54,450 --> 00:26:59,520
aggressor script so<font color="#E5E5E5"> coal strike has</font>

663
00:26:56,940 --> 00:27:01,620
basically<font color="#E5E5E5"> an event-driven library that</font>

664
00:26:59,520 --> 00:27:05,639
<font color="#E5E5E5">kind of feeds and updates all</font><font color="#CCCCCC"> the data</font>

665
00:27:01,620 --> 00:27:07,080
in the<font color="#E5E5E5"> UI so like oh my guys dead here</font>

666
00:27:05,640 --> 00:27:09,990
<font color="#CCCCCC">is</font><font color="#E5E5E5"> awesome</font>

667
00:27:07,080 --> 00:27:16,169
and so let's see if we<font color="#E5E5E5"> can start him</font>

668
00:27:09,990 --> 00:27:18,770
back up they always<font color="#E5E5E5"> have to recreate</font>

669
00:27:16,170 --> 00:27:18,770
<font color="#E5E5E5">this here okay</font>

670
00:27:41,420 --> 00:27:46,090
I didn't need updated<font color="#E5E5E5"> itself that's fun</font>

671
00:27:51,400 --> 00:27:56,750
so well that's trying to<font color="#CCCCCC"> to come</font><font color="#E5E5E5"> back up</font>

672
00:27:54,110 --> 00:27:58,370
um so aggressor is is the park amenities

673
00:27:56,750 --> 00:28:01,450
you can use to<font color="#E5E5E5"> interact programmatically</font>

674
00:27:58,370 --> 00:28:06,100
with<font color="#E5E5E5"> COBOL strike</font><font color="#CCCCCC"> its event-driven</font><font color="#E5E5E5"> and</font>

675
00:28:01,450 --> 00:28:08,420
I'll show<font color="#E5E5E5"> you this while that's loading</font>

676
00:28:06,100 --> 00:28:10,549
<font color="#E5E5E5">so you can write scripts in it it's kind</font>

677
00:28:08,420 --> 00:28:17,780
of like a it's a weird language<font color="#E5E5E5"> to be</font>

678
00:28:10,549 --> 00:28:20,150
honest<font color="#E5E5E5"> and what I loaded is something</font>

679
00:28:17,780 --> 00:28:23,990
called<font color="#CCCCCC"> a vent spy so it's out there in</font>

680
00:28:20,150 --> 00:28:26,480
the oh yeah that's gonna be super<font color="#E5E5E5"> hard</font>

681
00:28:23,990 --> 00:28:32,540
to see sorry<font color="#CCCCCC"> checking</font><font color="#E5E5E5"> the stuff on the</font>

682
00:28:26,480 --> 00:28:33,980
fly here so it it's in the documentation

683
00:28:32,540 --> 00:28:35,870
<font color="#CCCCCC">it's like literally</font><font color="#E5E5E5"> one of the first</font>

684
00:28:33,980 --> 00:28:37,070
things so anyway it's<font color="#E5E5E5"> like JavaScript</font>

685
00:28:35,870 --> 00:28:38,540
where there's all these<font color="#E5E5E5"> events right so</font>

686
00:28:37,070 --> 00:28:40,570
it's like on something right<font color="#E5E5E5"> so in</font>

687
00:28:38,540 --> 00:28:42,889
javascript you've got like on click and

688
00:28:40,570 --> 00:28:44,750
events<font color="#E5E5E5"> like that</font><font color="#CCCCCC"> where in coal strike</font>

689
00:28:42,890 --> 00:28:47,690
you basically have<font color="#CCCCCC"> like you</font><font color="#E5E5E5"> know on you</font>

690
00:28:44,750 --> 00:28:49,790
can check<font color="#E5E5E5"> in or different</font><font color="#CCCCCC"> events like</font>

691
00:28:47,690 --> 00:28:53,210
<font color="#CCCCCC">that and so what I'm going to show</font><font color="#E5E5E5"> here</font>

692
00:28:49,790 --> 00:28:55,850
is<font color="#E5E5E5"> this little events events by script</font>

693
00:28:53,210 --> 00:28:57,740
<font color="#E5E5E5">that I just</font><font color="#CCCCCC"> loaded and we loaded through</font>

694
00:28:55,850 --> 00:28:59,480
the<font color="#E5E5E5"> the script manager and now I go to</font>

695
00:28:57,740 --> 00:29:01,370
script console and we see that<font color="#E5E5E5"> a bunch</font>

696
00:28:59,480 --> 00:29:05,059
<font color="#E5E5E5">of stuff is just constantly getting like</font>

697
00:29:01,370 --> 00:29:08,209
puked out here<font color="#CCCCCC"> alright</font><font color="#E5E5E5"> so some of these</font>

698
00:29:05,059 --> 00:29:10,730
<font color="#E5E5E5">obviously aren't very interesting</font><font color="#CCCCCC"> like</font>

699
00:29:08,210 --> 00:29:12,169
there's a heartbeats<font color="#E5E5E5"> events and</font><font color="#CCCCCC"> things</font>

700
00:29:10,730 --> 00:29:13,549
like that<font color="#CCCCCC"> so that</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> can write timers</font>

701
00:29:12,169 --> 00:29:14,570
for<font color="#CCCCCC"> things if you want</font><font color="#E5E5E5"> something to</font>

702
00:29:13,549 --> 00:29:20,270
happen<font color="#CCCCCC"> like every second and every</font>

703
00:29:14,570 --> 00:29:22,780
<font color="#E5E5E5">couple seconds those are there let's see</font>

704
00:29:20,270 --> 00:29:26,049
if our<font color="#E5E5E5"> VM</font><font color="#CCCCCC"> is ready for</font><font color="#E5E5E5"> us</font>

705
00:29:22,780 --> 00:29:26,049
<font color="#E5E5E5">I've known</font>

706
00:29:30,320 --> 00:29:37,550
let's go back and copy<font color="#CCCCCC"> sites</font>

707
00:29:40,580 --> 00:30:01,590
there we go<font color="#E5E5E5"> all right cross fingers that</font>

708
00:29:45,270 --> 00:30:03,090
looks good<font color="#CCCCCC"> yeah shelf all right so</font>

709
00:30:01,590 --> 00:30:05,750
that's a<font color="#E5E5E5"> good thing</font><font color="#CCCCCC"> like actually kind</font>

710
00:30:03,090 --> 00:30:09,060
<font color="#E5E5E5">of look at so now we've got hold on</font>

711
00:30:05,750 --> 00:30:10,320
some<font color="#CCCCCC"> little</font><font color="#E5E5E5"> this bad boy</font><font color="#CCCCCC"> so obviously</font>

712
00:30:09,060 --> 00:30:12,120
there's a<font color="#E5E5E5"> lot of data</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> gets just</font>

713
00:30:10,320 --> 00:30:15,899
dumped out here and it's hard<font color="#CCCCCC"> to</font><font color="#E5E5E5"> kind of</font>

714
00:30:12,120 --> 00:30:23,760
like read and parse through<font color="#CCCCCC"> we'll see</font>

715
00:30:15,900 --> 00:30:28,470
<font color="#E5E5E5">that like somewhere in here they were</font>

716
00:30:23,760 --> 00:30:30,750
<font color="#E5E5E5">getting a new beacon</font><font color="#CCCCCC"> but basically every</font>

717
00:30:28,470 --> 00:30:34,050
every event that<font color="#E5E5E5"> happens gets logged to</font>

718
00:30:30,750 --> 00:30:38,030
the<font color="#CCCCCC"> subsystem and so the to lighten up</font>

719
00:30:34,050 --> 00:30:44,790
<font color="#CCCCCC">variety in here let's go to this show</font>

720
00:30:38,030 --> 00:30:47,700
<font color="#E5E5E5">well you can actually read this is a</font>

721
00:30:44,790 --> 00:30:50,190
<font color="#E5E5E5">JSON logger</font><font color="#CCCCCC"> oh it's better on</font><font color="#E5E5E5"> your</font>

722
00:30:47,700 --> 00:30:54,720
screen<font color="#CCCCCC"> than mine and</font><font color="#E5E5E5"> so this is just</font>

723
00:30:50,190 --> 00:30:58,590
<font color="#E5E5E5">like this monster CNA file</font><font color="#CCCCCC"> part</font><font color="#E5E5E5"> of it is</font>

724
00:30:54,720 --> 00:31:01,140
because I purposely<font color="#E5E5E5"> put in all the</font><font color="#CCCCCC"> mitre</font>

725
00:30:58,590 --> 00:31:02,699
<font color="#CCCCCC">tech</font><font color="#E5E5E5"> TTP stuff in here there's a note</font>

726
00:31:01,140 --> 00:31:05,010
<font color="#E5E5E5">basically says this would probably be a</font>

727
00:31:02,700 --> 00:31:08,070
log stash<font color="#CCCCCC"> plug-in but I haven't</font><font color="#E5E5E5"> had</font><font color="#CCCCCC"> time</font>

728
00:31:05,010 --> 00:31:10,230
<font color="#CCCCCC">to do that yet but</font><font color="#E5E5E5"> basically the the</font>

729
00:31:08,070 --> 00:31:11,280
reason for<font color="#E5E5E5"> doing this is</font><font color="#CCCCCC"> that cobalt rec</font>

730
00:31:10,230 --> 00:31:12,870
is really cool about<font color="#CCCCCC"> anytime you are</font><font color="#E5E5E5"> in</font>

731
00:31:11,280 --> 00:31:14,629
<font color="#CCCCCC">action say you spawn a new shell right</font>

732
00:31:12,870 --> 00:31:18,000
there's some TTP's that<font color="#E5E5E5"> happen from that</font>

733
00:31:14,630 --> 00:31:20,670
<font color="#CCCCCC">that will generate</font><font color="#E5E5E5"> the correct</font><font color="#CCCCCC"> mitre</font>

734
00:31:18,000 --> 00:31:22,770
attack tactic for<font color="#E5E5E5"> it but it</font><font color="#CCCCCC"> doesn't</font>

735
00:31:20,670 --> 00:31:24,630
actually like<font color="#E5E5E5"> tighten the phase so it's</font>

736
00:31:22,770 --> 00:31:26,220
missing some data<font color="#CCCCCC"> that I wanted</font><font color="#E5E5E5"> for like</font>

737
00:31:24,630 --> 00:31:28,200
some visualization<font color="#E5E5E5"> stuff that I want to</font>

738
00:31:26,220 --> 00:31:29,970
show you so I ended<font color="#CCCCCC"> up adding</font><font color="#E5E5E5"> this stuff</font>

739
00:31:28,200 --> 00:31:31,290
in manually<font color="#E5E5E5"> eventually you</font><font color="#CCCCCC"> should</font>

740
00:31:29,970 --> 00:31:33,270
probably<font color="#CCCCCC"> plug-in or I should really hit</font>

741
00:31:31,290 --> 00:31:34,560
up<font color="#E5E5E5"> Rafi and tell him that I would like</font>

742
00:31:33,270 --> 00:31:37,530
<font color="#CCCCCC">to state and</font><font color="#E5E5E5"> there need probably haven't</font>

743
00:31:34,560 --> 00:31:39,389
<font color="#CCCCCC">done in like the</font><font color="#E5E5E5"> next release but</font>

744
00:31:37,530 --> 00:31:40,740
<font color="#E5E5E5">basically it's configurable</font><font color="#CCCCCC"> here on top</font>

745
00:31:39,390 --> 00:31:42,190
so<font color="#CCCCCC"> you can figure</font><font color="#E5E5E5"> out what you want to</font>

746
00:31:40,740 --> 00:31:44,710
log in or not<font color="#E5E5E5"> log</font>

747
00:31:42,190 --> 00:31:46,120
some of these are are<font color="#E5E5E5"> really noisy and I</font>

748
00:31:44,710 --> 00:31:47,740
just don't<font color="#E5E5E5"> care about them so</font><font color="#CCCCCC"> I just</font>

749
00:31:46,120 --> 00:31:49,929
<font color="#E5E5E5">disabled them but I did write the code</font>

750
00:31:47,740 --> 00:31:52,660
that<font color="#CCCCCC"> like if somebody wanted to ingest</font>

751
00:31:49,930 --> 00:31:55,870
<font color="#E5E5E5">the stuff you could so let's go down</font>

752
00:31:52,660 --> 00:31:57,370
here<font color="#CCCCCC"> that's all the</font><font color="#E5E5E5"> mightor stuff and so</font>

753
00:31:55,870 --> 00:31:59,469
basically it's a whole bunch it's a

754
00:31:57,370 --> 00:32:01,389
<font color="#E5E5E5">giant if statement because there's no</font>

755
00:31:59,470 --> 00:32:02,950
case<font color="#CCCCCC"> or anything like that in here that</font>

756
00:32:01,390 --> 00:32:04,920
<font color="#E5E5E5">says if it's this event type remember</font>

757
00:32:02,950 --> 00:32:07,600
like<font color="#CCCCCC"> dissolve in drip and</font><font color="#E5E5E5"> so like on</font>

758
00:32:04,920 --> 00:32:09,280
beacon input which is you as an operator

759
00:32:07,600 --> 00:32:11,679
type something into the console like

760
00:32:09,280 --> 00:32:13,330
<font color="#E5E5E5">it's this</font><font color="#CCCCCC"> event</font><font color="#E5E5E5"> who's gonna fire since</font>

761
00:32:11,680 --> 00:32:15,820
<font color="#E5E5E5">I'm listening on every event</font><font color="#CCCCCC"> I'm going</font>

762
00:32:13,330 --> 00:32:20,350
to<font color="#CCCCCC"> kept</font><font color="#E5E5E5"> capture this event parse this</font>

763
00:32:15,820 --> 00:32:22,689
and then shove<font color="#E5E5E5"> this</font><font color="#CCCCCC"> into the log</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> so</font>

764
00:32:20,350 --> 00:32:24,490
I wrote<font color="#CCCCCC"> my wrote a custom</font><font color="#E5E5E5"> JSON</font><font color="#CCCCCC"> encode</font>

765
00:32:22,690 --> 00:32:25,600
<font color="#E5E5E5">function which probably will break at</font>

766
00:32:24,490 --> 00:32:27,340
some point when somebody has some crazy

767
00:32:25,600 --> 00:32:29,379
<font color="#E5E5E5">you know character encoding or something</font>

768
00:32:27,340 --> 00:32:32,740
like<font color="#E5E5E5"> that</font><font color="#CCCCCC"> for most</font><font color="#E5E5E5"> part this seems to</font>

769
00:32:29,380 --> 00:32:40,180
<font color="#E5E5E5">work pretty well all right so that's</font>

770
00:32:32,740 --> 00:32:43,690
file here<font color="#E5E5E5"> so</font><font color="#CCCCCC"> that's it started this up</font>

771
00:32:40,180 --> 00:32:45,700
so I like using<font color="#E5E5E5"> like</font><font color="#CCCCCC"> the console line</font><font color="#E5E5E5"> a</font>

772
00:32:43,690 --> 00:32:46,960
<font color="#CCCCCC">Chrysler script to run</font><font color="#E5E5E5"> this versus being</font>

773
00:32:45,700 --> 00:32:49,090
<font color="#E5E5E5">in your own that way you know it's gonna</font>

774
00:32:46,960 --> 00:32:56,770
<font color="#CCCCCC">constantly run</font><font color="#E5E5E5"> while you're connected</font><font color="#CCCCCC"> to</font>

775
00:32:49,090 --> 00:32:57,580
or not connected<font color="#CCCCCC"> to the team server all</font>

776
00:32:56,770 --> 00:33:05,110
<font color="#CCCCCC">right cool</font>

777
00:32:57,580 --> 00:33:07,600
so if we go back<font color="#CCCCCC"> that's</font><font color="#E5E5E5"> good</font>

778
00:33:05,110 --> 00:33:10,209
so we should see that<font color="#E5E5E5"> hey our log bot</font>

779
00:33:07,600 --> 00:33:12,010
has joined us<font color="#CCCCCC"> right so now we know that</font>

780
00:33:10,210 --> 00:33:15,580
<font color="#E5E5E5">it were constantly connected to it and</font>

781
00:33:12,010 --> 00:33:17,520
monitoring<font color="#E5E5E5"> those events and we're</font>

782
00:33:15,580 --> 00:33:19,860
probably gonna<font color="#E5E5E5"> see too much right</font><font color="#CCCCCC"> now</font>

783
00:33:17,520 --> 00:33:25,960
<font color="#E5E5E5">because we're</font><font color="#CCCCCC"> not</font><font color="#E5E5E5"> doing anything with it</font>

784
00:33:19,860 --> 00:33:28,479
but if we do see<font color="#E5E5E5"> like so Who am I now we</font>

785
00:33:25,960 --> 00:33:32,050
get<font color="#CCCCCC"> some output all right so let's go</font>

786
00:33:28,480 --> 00:33:35,280
back<font color="#E5E5E5"> and</font><font color="#CCCCCC"> see what</font><font color="#E5E5E5"> what happened here</font>

787
00:33:32,050 --> 00:33:35,280
<font color="#CCCCCC">so I'm gonna kill this guy</font>

788
00:33:40,980 --> 00:33:47,710
so we see<font color="#E5E5E5"> that we have</font><font color="#CCCCCC"> a JSON file and</font>

789
00:33:45,760 --> 00:33:51,670
now here's here's what<font color="#E5E5E5"> we just ran right</font>

790
00:33:47,710 --> 00:33:54,190
<font color="#CCCCCC">so we can see</font><font color="#E5E5E5"> here</font><font color="#CCCCCC"> that we've got what I</font>

791
00:33:51,670 --> 00:33:56,080
<font color="#E5E5E5">tested beacon in to run Who am I the</font>

792
00:33:54,190 --> 00:33:58,540
host called home here's a result all

793
00:33:56,080 --> 00:34:00,280
that which<font color="#E5E5E5"> is great it's all in JSON now</font>

794
00:33:58,540 --> 00:34:02,820
so it's<font color="#E5E5E5"> structured and we can actually</font>

795
00:34:00,280 --> 00:34:02,820
<font color="#E5E5E5">import that data</font>

796
00:34:08,190 --> 00:34:13,050
<font color="#CCCCCC">alright well fire that</font><font color="#E5E5E5"> gave that</font><font color="#CCCCCC"> good oh</font>

797
00:34:13,500 --> 00:34:18,429
one<font color="#E5E5E5"> other thing I was gonna show you</font><font color="#CCCCCC"> all</font>

798
00:34:15,449 --> 00:34:21,100
<font color="#CCCCCC">right so um</font><font color="#E5E5E5"> since</font><font color="#CCCCCC"> we got it ran out to a</font>

799
00:34:18,429 --> 00:34:24,220
file now here's we're gonna use file<font color="#E5E5E5"> B</font>

800
00:34:21,100 --> 00:34:26,830
to ingest<font color="#E5E5E5"> those into</font><font color="#CCCCCC"> logstash the the</font>

801
00:34:24,219 --> 00:34:27,939
key here is<font color="#CCCCCC"> a</font><font color="#E5E5E5"> couple</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> things if you're</font>

802
00:34:26,830 --> 00:34:30,520
<font color="#CCCCCC">doing</font><font color="#E5E5E5"> something out of the box with file</font>

803
00:34:27,940 --> 00:34:31,840
beat it works pretty well so<font color="#CCCCCC"> you say</font>

804
00:34:30,520 --> 00:34:33,668
like I want<font color="#CCCCCC"> it forward Apache logs or</font>

805
00:34:31,840 --> 00:34:35,320
nginx logs or something like that<font color="#E5E5E5"> you</font>

806
00:34:33,668 --> 00:34:36,370
<font color="#E5E5E5">don't</font><font color="#CCCCCC"> have to do anything</font><font color="#E5E5E5"> it's really</font>

807
00:34:35,320 --> 00:34:38,020
<font color="#CCCCCC">sweet</font>

808
00:34:36,370 --> 00:34:42,310
however if you<font color="#E5E5E5"> wanna start doing custom</font>

809
00:34:38,020 --> 00:34:43,929
stuff<font color="#CCCCCC"> it gets a little</font><font color="#E5E5E5"> ugly not too bad</font>

810
00:34:42,310 --> 00:34:46,259
there's some decent<font color="#CCCCCC"> tutorials out there</font>

811
00:34:43,929 --> 00:34:48,250
but what I found is the biggest pain and

812
00:34:46,260 --> 00:34:50,320
partly<font color="#E5E5E5"> because I didn't know what data</font>

813
00:34:48,250 --> 00:34:53,440
<font color="#E5E5E5">was gonna get you know shipped out</font><font color="#CCCCCC"> of</font>

814
00:34:50,320 --> 00:34:56,169
<font color="#CCCCCC">COBOL Trek</font><font color="#E5E5E5"> or all the field</font><font color="#CCCCCC"> names when I</font>

815
00:34:53,440 --> 00:34:58,300
started this was developing this field Z

816
00:34:56,168 --> 00:35:01,120
<font color="#CCCCCC">animal</font><font color="#E5E5E5"> and so this is basically a file</font>

817
00:34:58,300 --> 00:35:04,540
that describes all the<font color="#E5E5E5"> data that I want</font>

818
00:35:01,120 --> 00:35:06,640
<font color="#CCCCCC">to shove</font><font color="#E5E5E5"> into the elk stack and what</font>

819
00:35:04,540 --> 00:35:09,450
data type<font color="#E5E5E5"> it is the reason why the data</font>

820
00:35:06,640 --> 00:35:11,410
type<font color="#E5E5E5"> is important is in</font><font color="#CCCCCC"> elastic search</font>

821
00:35:09,450 --> 00:35:13,859
especially for<font color="#E5E5E5"> Strings there's two</font>

822
00:35:11,410 --> 00:35:16,690
primary data types like<font color="#E5E5E5"> one is just text</font>

823
00:35:13,860 --> 00:35:17,740
<font color="#CCCCCC">and then the other is</font><font color="#E5E5E5"> like</font><font color="#CCCCCC"> keyword and</font>

824
00:35:16,690 --> 00:35:19,650
so when you<font color="#E5E5E5"> start</font><font color="#CCCCCC"> doing visualizations</font>

825
00:35:17,740 --> 00:35:24,279
and things like<font color="#E5E5E5"> that you can only do</font>

826
00:35:19,650 --> 00:35:25,840
aggregation on keywords<font color="#CCCCCC"> and that that</font>

827
00:35:24,280 --> 00:35:27,880
gets important when you<font color="#CCCCCC"> actually want</font><font color="#E5E5E5"> to</font>

828
00:35:25,840 --> 00:35:30,130
like do cool<font color="#CCCCCC"> things and pre things with</font>

829
00:35:27,880 --> 00:35:31,510
the data<font color="#E5E5E5"> and I found that out</font><font color="#CCCCCC"> the hard</font>

830
00:35:30,130 --> 00:35:32,470
ways I don't<font color="#CCCCCC"> know how many like</font><font color="#E5E5E5"> probably</font>

831
00:35:31,510 --> 00:35:35,440
<font color="#E5E5E5">the first couple weeks</font><font color="#CCCCCC"> I was building</font>

832
00:35:32,470 --> 00:35:37,000
this just had to completely change this

833
00:35:35,440 --> 00:35:39,640
constantly cousin<font color="#E5E5E5"> to crappy</font><font color="#CCCCCC"> no that was</font>

834
00:35:37,000 --> 00:35:41,410
a<font color="#E5E5E5"> thing I wanted to do and one of the</font>

835
00:35:39,640 --> 00:35:43,120
bad things unlike<font color="#E5E5E5"> like a sequel database</font>

836
00:35:41,410 --> 00:35:46,660
where you<font color="#E5E5E5"> can run an alter command to</font>

837
00:35:43,120 --> 00:35:49,750
change<font color="#E5E5E5"> a table or a column type you</font>

838
00:35:46,660 --> 00:35:51,220
<font color="#E5E5E5">actually have to create a new index and</font>

839
00:35:49,750 --> 00:35:52,810
migrate the data

840
00:35:51,220 --> 00:35:55,419
<font color="#E5E5E5">/ so you can't really update it and you</font>

841
00:35:52,810 --> 00:35:58,270
have to<font color="#E5E5E5"> re and exit</font><font color="#CCCCCC"> so it's a bit</font><font color="#E5E5E5"> of a</font>

842
00:35:55,420 --> 00:36:01,270
pain<font color="#E5E5E5"> but once it's up and running it</font>

843
00:35:58,270 --> 00:36:02,440
<font color="#E5E5E5">it's pretty</font><font color="#CCCCCC"> awesome so you know these</font>

844
00:36:01,270 --> 00:36:04,060
files are<font color="#CCCCCC"> pretty simple it</font><font color="#E5E5E5"> basically</font>

845
00:36:02,440 --> 00:36:05,859
just describes all<font color="#CCCCCC"> the fields that</font><font color="#E5E5E5"> we</font>

846
00:36:04,060 --> 00:36:09,820
could possibly log or<font color="#E5E5E5"> instead I'm</font>

847
00:36:05,859 --> 00:36:12,910
<font color="#E5E5E5">logging out of here so far the main</font>

848
00:36:09,820 --> 00:36:15,060
configuration<font color="#CCCCCC"> file is file BT mo so it's</font>

849
00:36:12,910 --> 00:36:17,230
pretty simple<font color="#E5E5E5"> and straightforward</font>

850
00:36:15,060 --> 00:36:18,900
<font color="#CCCCCC">there's these</font><font color="#E5E5E5"> things called prospectors</font>

851
00:36:17,230 --> 00:36:21,910
<font color="#E5E5E5">I think they now change it to inputs</font>

852
00:36:18,900 --> 00:36:23,530
<font color="#E5E5E5">similar to Splunk</font><font color="#CCCCCC"> and we're defining</font>

853
00:36:21,910 --> 00:36:28,270
like where we're going to find our files

854
00:36:23,530 --> 00:36:29,980
at and we've got basically like we saw

855
00:36:28,270 --> 00:36:32,380
<font color="#CCCCCC">before</font><font color="#E5E5E5"> we're saying that hey there's</font>

856
00:36:29,980 --> 00:36:35,410
there's<font color="#E5E5E5"> Jason this is Jason</font><font color="#CCCCCC"> right so we</font>

857
00:36:32,380 --> 00:36:37,060
<font color="#E5E5E5">want important</font><font color="#CCCCCC"> s JSON and</font><font color="#E5E5E5"> then down here</font>

858
00:36:35,410 --> 00:36:40,118
<font color="#E5E5E5">we</font><font color="#CCCCCC"> just have a couple different things</font>

859
00:36:37,060 --> 00:36:41,200
<font color="#CCCCCC">we point</font><font color="#E5E5E5"> to our fields yamo</font><font color="#CCCCCC"> so it knows</font>

860
00:36:40,119 --> 00:36:45,099
<font color="#CCCCCC">that these are the custom fields that we</font>

861
00:36:41,200 --> 00:36:46,330
got here's the the template and<font color="#E5E5E5"> this is</font>

862
00:36:45,099 --> 00:36:48,099
<font color="#E5E5E5">probably</font><font color="#CCCCCC"> like the most painful part</font>

863
00:36:46,330 --> 00:36:49,690
about all<font color="#E5E5E5"> this</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> I've I've run into</font>

864
00:36:48,099 --> 00:36:51,040
<font color="#E5E5E5">is</font><font color="#CCCCCC"> like even if you define the fields</font>

865
00:36:49,690 --> 00:36:54,300
you still have to give it a<font color="#E5E5E5"> custom</font>

866
00:36:51,040 --> 00:36:56,230
template<font color="#E5E5E5"> to say here's the mapping</font><font color="#CCCCCC"> of</font>

867
00:36:54,300 --> 00:37:00,369
what I want<font color="#E5E5E5"> and I'll show you what the</font>

868
00:36:56,230 --> 00:37:02,440
template looks like<font color="#E5E5E5"> oh that's horrible</font>

869
00:37:00,369 --> 00:37:05,530
to read<font color="#E5E5E5"> I'm sorry</font>

870
00:37:02,440 --> 00:37:09,099
and so basically these it<font color="#E5E5E5"> looks a lot</font>

871
00:37:05,530 --> 00:37:11,710
<font color="#E5E5E5">like the</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> fowl beat around</font><font color="#CCCCCC"> the field</font>

872
00:37:09,099 --> 00:37:13,210
<font color="#CCCCCC">CMO or it basically just</font><font color="#E5E5E5"> defines these</font>

873
00:37:11,710 --> 00:37:14,349
but<font color="#E5E5E5"> it's it's</font><font color="#CCCCCC"> an I guess a slightly</font>

874
00:37:13,210 --> 00:37:16,180
different<font color="#E5E5E5"> format that's needed for</font>

875
00:37:14,349 --> 00:37:18,640
<font color="#CCCCCC">elasticsearch them that you know</font><font color="#E5E5E5"> like I</font>

876
00:37:16,180 --> 00:37:20,618
<font color="#CCCCCC">said</font><font color="#E5E5E5"> a bit of an</font><font color="#CCCCCC"> elf</font><font color="#E5E5E5"> noob so I'm not</font>

877
00:37:18,640 --> 00:37:22,868
<font color="#CCCCCC">sure that the the clear</font><font color="#E5E5E5"> differences</font>

878
00:37:20,619 --> 00:37:24,760
between what<font color="#E5E5E5"> by you've got</font><font color="#CCCCCC"> field zmo</font><font color="#E5E5E5"> and</font>

879
00:37:22,869 --> 00:37:25,750
also this<font color="#E5E5E5"> this template but if you don't</font>

880
00:37:24,760 --> 00:37:26,200
have the template<font color="#E5E5E5"> it's not gonna work</font>

881
00:37:25,750 --> 00:37:28,780
<font color="#CCCCCC">very well</font>

882
00:37:26,200 --> 00:37:34,859
when<font color="#E5E5E5"> you go to</font><font color="#CCCCCC"> actually put this new</font>

883
00:37:28,780 --> 00:37:36,790
beat<font color="#E5E5E5"> into elasticsearch so we've got</font>

884
00:37:34,859 --> 00:37:38,348
<font color="#CCCCCC">bare feet basically everything is</font>

885
00:37:36,790 --> 00:37:40,300
<font color="#E5E5E5">already there all the data is there</font><font color="#CCCCCC"> and</font>

886
00:37:38,349 --> 00:37:42,550
so now I'm<font color="#E5E5E5"> gonna run this interactively</font>

887
00:37:40,300 --> 00:37:45,310
this will run as a<font color="#E5E5E5"> service</font><font color="#CCCCCC"> but just so</font>

888
00:37:42,550 --> 00:37:48,310
we can<font color="#E5E5E5"> kind of see the data as it's</font>

889
00:37:45,310 --> 00:37:49,600
getting ingested here do this<font color="#E5E5E5"> and let's</font>

890
00:37:48,310 --> 00:37:54,370
do

891
00:37:49,600 --> 00:37:56,020
and there seems I'll be animal<font color="#E5E5E5"> so this</font>

892
00:37:54,370 --> 00:38:00,130
is probably<font color="#CCCCCC"> this girl super quick and</font>

893
00:37:56,020 --> 00:38:02,200
it's done<font color="#CCCCCC"> alright</font><font color="#E5E5E5"> so what we're seeing</font>

894
00:38:00,130 --> 00:38:05,050
here<font color="#CCCCCC"> is that file beet went to the to</font>

895
00:38:02,200 --> 00:38:06,520
those files<font color="#E5E5E5"> parsed them and this is what</font>

896
00:38:05,050 --> 00:38:08,770
it's<font color="#E5E5E5"> sending over right</font><font color="#CCCCCC"> so you can see</font>

897
00:38:06,520 --> 00:38:10,180
this is obviously very similar to what

898
00:38:08,770 --> 00:38:14,580
we<font color="#CCCCCC"> just had in terms of like JSON</font>

899
00:38:10,180 --> 00:38:22,830
logging so now the fun thing<font color="#CCCCCC"> is if we're</font>

900
00:38:14,580 --> 00:38:22,830
lucky let's reload here discover

901
00:38:24,900 --> 00:38:33,910
<font color="#CCCCCC">do-do-do-do-do-do alright and I have</font>

902
00:38:29,170 --> 00:38:36,850
this named as team server index and

903
00:38:33,910 --> 00:38:39,100
there you go here's<font color="#E5E5E5"> your data so here's</font>

904
00:38:36,850 --> 00:38:39,850
the commands them and running<font color="#E5E5E5"> so I think</font>

905
00:38:39,100 --> 00:38:42,759
one of the fun things<font color="#E5E5E5"> about</font>

906
00:38:39,850 --> 00:38:45,130
<font color="#CCCCCC">elasticsearch</font><font color="#E5E5E5"> is I can set this to say</font>

907
00:38:42,760 --> 00:38:47,920
you know constantly query and show me

908
00:38:45,130 --> 00:38:53,590
updates here<font color="#CCCCCC"> so if we go back to like</font>

909
00:38:47,920 --> 00:38:56,140
our<font color="#CCCCCC"> team's over here and it's held to</font>

910
00:38:53,590 --> 00:38:58,960
give<font color="#E5E5E5"> me you got P config here in</font><font color="#CCCCCC"> a</font>

911
00:38:56,140 --> 00:39:03,759
second<font color="#E5E5E5"> we should</font><font color="#CCCCCC"> see that the</font><font color="#E5E5E5"> data then</font>

912
00:38:58,960 --> 00:39:09,370
gets imported maybe<font color="#E5E5E5"> we still run finally</font>

913
00:39:03,760 --> 00:39:11,920
<font color="#E5E5E5">oh yeah yeah</font><font color="#CCCCCC"> ok so they're real sound</font>

914
00:39:09,370 --> 00:39:14,020
shows up<font color="#E5E5E5"> so imagine this now like to</font>

915
00:39:11,920 --> 00:39:15,070
turn it<font color="#CCCCCC"> to put this</font><font color="#E5E5E5"> into like each part</font>

916
00:39:14,020 --> 00:39:16,240
of<font color="#E5E5E5"> your infrastructure start to scale</font>

917
00:39:15,070 --> 00:39:18,460
<font color="#E5E5E5">this</font><font color="#CCCCCC"> and this</font><font color="#E5E5E5"> data starts to kind of</font>

918
00:39:16,240 --> 00:39:30,759
come together right<font color="#CCCCCC"> in a pretty sweet</font>

919
00:39:18,460 --> 00:39:32,470
way go<font color="#CCCCCC"> back</font><font color="#E5E5E5"> to slides</font><font color="#CCCCCC"> so alright</font><font color="#E5E5E5"> so</font>

920
00:39:30,760 --> 00:39:34,390
we'll go back to like what<font color="#E5E5E5"> is all the</font>

921
00:39:32,470 --> 00:39:37,689
really<font color="#CCCCCC"> cool stuff look like in a</font><font color="#E5E5E5"> minute</font>

922
00:39:34,390 --> 00:39:42,040
<font color="#CCCCCC">I just wanted</font><font color="#E5E5E5"> to touch on Empire here</font>

923
00:39:37,690 --> 00:39:45,280
quick<font color="#E5E5E5"> and a lot of folks use Empire you</font>

924
00:39:42,040 --> 00:39:46,779
can use pakka Pete for like your edge

925
00:39:45,280 --> 00:39:49,540
infrastructure<font color="#E5E5E5"> the same way that I'm</font>

926
00:39:46,780 --> 00:39:52,360
using it<font color="#CCCCCC"> for</font><font color="#E5E5E5"> COBOL strike</font><font color="#CCCCCC"> did you have</font>

927
00:39:49,540 --> 00:39:53,920
unstructured logs and you know here your

928
00:39:52,360 --> 00:39:57,070
empire folder downloads<font color="#E5E5E5"> whatever the</font>

929
00:39:53,920 --> 00:39:59,770
agent<font color="#E5E5E5"> name is and then agent</font><font color="#CCCCCC"> up log it</font>

930
00:39:57,070 --> 00:40:02,260
is possible to parse those<font color="#E5E5E5"> this is what</font>

931
00:39:59,770 --> 00:40:03,279
that law<font color="#E5E5E5"> kind of looks</font><font color="#CCCCCC"> like so you you</font>

932
00:40:02,260 --> 00:40:06,939
<font color="#CCCCCC">have a flunky</font>

933
00:40:03,279 --> 00:40:08,529
date format<font color="#CCCCCC"> you've got in whatever</font><font color="#E5E5E5"> at</font>

934
00:40:06,939 --> 00:40:10,899
<font color="#E5E5E5">the output was from that so you can run</font>

935
00:40:08,529 --> 00:40:11,859
modules<font color="#E5E5E5"> so you see that a certain you</font>

936
00:40:10,900 --> 00:40:14,589
<font color="#E5E5E5">want the</font><font color="#CCCCCC"> agent to run this particular</font>

937
00:40:11,859 --> 00:40:18,429
module<font color="#E5E5E5"> it just kind of gets dumped out</font>

938
00:40:14,589 --> 00:40:19,689
<font color="#CCCCCC">in this giant long format you can parse</font>

939
00:40:18,429 --> 00:40:24,009
it with<font color="#CCCCCC"> logstash</font>

940
00:40:19,689 --> 00:40:25,479
<font color="#E5E5E5">works pretty well</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> the easiest way</font>

941
00:40:24,009 --> 00:40:27,159
that I<font color="#CCCCCC"> found is you can you can find a</font>

942
00:40:25,479 --> 00:40:28,269
<font color="#CCCCCC">croc pattern so in</font><font color="#E5E5E5"> log stash you can</font>

943
00:40:27,159 --> 00:40:30,159
find these<font color="#E5E5E5"> things called Crocs are</font>

944
00:40:28,269 --> 00:40:32,618
basically like regular expressions<font color="#E5E5E5"> named</font>

945
00:40:30,159 --> 00:40:34,599
regular expressions<font color="#CCCCCC"> and so in this</font><font color="#E5E5E5"> case</font>

946
00:40:32,619 --> 00:40:36,999
I made a<font color="#E5E5E5"> regular</font><font color="#CCCCCC"> expression</font><font color="#E5E5E5"> or a croc</font>

947
00:40:34,599 --> 00:40:41,169
that<font color="#E5E5E5"> matches the format of the date</font><font color="#CCCCCC"> that</font>

948
00:40:36,999 --> 00:40:44,140
Empire has and then<font color="#E5E5E5"> match and then add</font>

949
00:40:41,169 --> 00:40:46,328
to this line<font color="#CCCCCC"> here to use this to parse</font>

950
00:40:44,140 --> 00:40:47,558
it right so you've<font color="#E5E5E5"> got if the pattern at</font>

951
00:40:46,329 --> 00:40:50,409
the<font color="#E5E5E5"> beginning starts with like the</font>

952
00:40:47,559 --> 00:40:52,479
<font color="#CCCCCC">Empire timestamp then grab everything</font>

953
00:40:50,409 --> 00:40:55,630
<font color="#E5E5E5">else that comes after that and then and</font>

954
00:40:52,479 --> 00:40:58,538
chunk<font color="#CCCCCC"> that up so that kind of</font><font color="#E5E5E5"> looks like</font>

955
00:40:55,630 --> 00:41:01,809
this<font color="#E5E5E5"> right so we're we're</font><font color="#CCCCCC"> matching</font><font color="#E5E5E5"> this</font>

956
00:40:58,539 --> 00:41:03,699
date<font color="#E5E5E5"> out we get this data gets matched</font>

957
00:41:01,809 --> 00:41:06,579
<font color="#E5E5E5">and so then that</font><font color="#CCCCCC"> would</font><font color="#E5E5E5"> get parsed and</font>

958
00:41:03,699 --> 00:41:08,019
<font color="#E5E5E5">put into it so this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> the sort</font><font color="#CCCCCC"> of</font>

959
00:41:06,579 --> 00:41:09,549
reason<font color="#E5E5E5"> I also wanted to go down</font><font color="#CCCCCC"> the</font>

960
00:41:08,019 --> 00:41:11,348
route of<font color="#E5E5E5"> writing like</font><font color="#CCCCCC"> a JSON logger</font>

961
00:41:09,549 --> 00:41:13,150
because there's this is cool but it's

962
00:41:11,349 --> 00:41:16,059
<font color="#E5E5E5">it's a little</font><font color="#CCCCCC"> tough to</font><font color="#E5E5E5"> pull estate</font><font color="#CCCCCC"> in</font>

963
00:41:13,150 --> 00:41:17,679
out it's<font color="#E5E5E5"> not quite as useful</font><font color="#CCCCCC"> I looked a</font>

964
00:41:16,059 --> 00:41:20,859
little<font color="#CCCCCC"> bit</font><font color="#E5E5E5"> into you like doing the work</font>

965
00:41:17,679 --> 00:41:22,209
to do<font color="#E5E5E5"> this and it looks like it's it's</font>

966
00:41:20,859 --> 00:41:24,999
definitely<font color="#CCCCCC"> possible there's already some</font>

967
00:41:22,209 --> 00:41:27,069
logging<font color="#E5E5E5"> infrastructure within Empire but</font>

968
00:41:24,999 --> 00:41:30,069
you'd<font color="#CCCCCC"> have to</font><font color="#E5E5E5"> go in and enable sort of</font>

969
00:41:27,069 --> 00:41:33,219
the JSON format and and have a little

970
00:41:30,069 --> 00:41:35,409
<font color="#E5E5E5">more detail around what each of those is</font>

971
00:41:33,219 --> 00:41:37,089
because it's just sort of like<font color="#E5E5E5"> and</font><font color="#CCCCCC"> dumps</font>

972
00:41:35,409 --> 00:41:39,459
<font color="#CCCCCC">up</font><font color="#E5E5E5"> through the log right you might want</font>

973
00:41:37,089 --> 00:41:40,839
<font color="#CCCCCC">to go like hey we ran a module or you</font>

974
00:41:39,459 --> 00:41:42,519
know here's an output for him<font color="#E5E5E5"> something</font>

975
00:41:40,839 --> 00:41:45,839
<font color="#E5E5E5">sort</font><font color="#CCCCCC"> of given more context whereas</font><font color="#E5E5E5"> right</font>

976
00:41:42,519 --> 00:41:45,839
<font color="#CCCCCC">now there's not</font><font color="#E5E5E5"> a lot</font><font color="#CCCCCC"> of context to it</font>

977
00:41:46,169 --> 00:41:52,689
<font color="#CCCCCC">for Empire there's a particular project</font>

978
00:41:49,209 --> 00:41:55,839
that<font color="#E5E5E5"> I saw come up a few weeks back</font><font color="#CCCCCC"> it's</font>

979
00:41:52,689 --> 00:41:58,209
called a<font color="#CCCCCC"> tach</font><font color="#E5E5E5"> Empire and certain by</font>

980
00:41:55,839 --> 00:42:00,249
<font color="#E5E5E5">Daniel Stepanek and it's pretty sweet</font>

981
00:41:58,209 --> 00:42:03,158
<font color="#CCCCCC">that it basically just</font><font color="#E5E5E5"> maps out Empire</font>

982
00:42:00,249 --> 00:42:04,149
module execution to tactic IDs<font color="#E5E5E5"> so if I</font>

983
00:42:03,159 --> 00:42:08,309
were going<font color="#CCCCCC"> to</font><font color="#E5E5E5"> do this for an empire</font>

984
00:42:04,150 --> 00:42:10,689
infrastructure I would basically build a

985
00:42:08,309 --> 00:42:12,729
basically<font color="#CCCCCC"> a</font><font color="#E5E5E5"> log stash</font><font color="#CCCCCC"> plugin to take</font>

986
00:42:10,689 --> 00:42:14,919
this as use all that<font color="#E5E5E5"> come across</font><font color="#CCCCCC"> the</font>

987
00:42:12,729 --> 00:42:16,930
<font color="#CCCCCC">logs</font><font color="#E5E5E5"> and you would identify those</font>

988
00:42:14,919 --> 00:42:19,600
modules<font color="#E5E5E5"> use like</font>

989
00:42:16,930 --> 00:42:21,250
<font color="#E5E5E5">code here</font><font color="#CCCCCC"> to grab that and then</font>

990
00:42:19,600 --> 00:42:22,690
<font color="#CCCCCC">basically say oh well</font><font color="#E5E5E5"> because you ran</font>

991
00:42:21,250 --> 00:42:26,590
the screenshot module<font color="#E5E5E5"> it's tactic</font>

992
00:42:22,690 --> 00:42:28,300
<font color="#E5E5E5">whatever</font><font color="#CCCCCC"> and so that would</font><font color="#E5E5E5"> be</font><font color="#CCCCCC"> a quick</font>

993
00:42:26,590 --> 00:42:33,370
way<font color="#CCCCCC"> to kind of get that additional</font><font color="#E5E5E5"> rich</font>

994
00:42:28,300 --> 00:42:37,720
data into those logs must<font color="#E5E5E5"> get such a</font>

995
00:42:33,370 --> 00:42:38,859
mess plate for a minute so I kind of

996
00:42:37,720 --> 00:42:40,779
mission a<font color="#CCCCCC"> little bit</font><font color="#E5E5E5"> before right so</font>

997
00:42:38,860 --> 00:42:43,360
most<font color="#E5E5E5"> things</font><font color="#CCCCCC"> you can do</font><font color="#E5E5E5"> in</font><font color="#CCCCCC"> Metasploit</font><font color="#E5E5E5"> are</font>

998
00:42:40,780 --> 00:42:47,820
tcp base so those packet<font color="#CCCCCC"> B's and con</font>

999
00:42:43,360 --> 00:42:51,190
<font color="#CCCCCC">beets or</font><font color="#E5E5E5"> pretty well</font><font color="#CCCCCC"> it's dumping out to</font>

1000
00:42:47,820 --> 00:42:52,720
the spool log typically so you can

1001
00:42:51,190 --> 00:42:56,350
capture that<font color="#E5E5E5"> and parse it similar to how</font>

1002
00:42:52,720 --> 00:42:58,600
I<font color="#E5E5E5"> mentioned with Empire and</font><font color="#CCCCCC"> for custom</font>

1003
00:42:56,350 --> 00:43:01,450
structured logging like it's definitely

1004
00:42:58,600 --> 00:43:02,500
<font color="#CCCCCC">possible Metasploit also has a bunch of</font>

1005
00:43:01,450 --> 00:43:04,660
<font color="#E5E5E5">events under the hood</font>

1006
00:43:02,500 --> 00:43:06,610
so there's<font color="#CCCCCC"> definitely like on</font><font color="#E5E5E5"> session</font>

1007
00:43:04,660 --> 00:43:08,620
and and things like<font color="#E5E5E5"> that where</font><font color="#CCCCCC"> you could</font>

1008
00:43:06,610 --> 00:43:10,270
<font color="#E5E5E5">write</font><font color="#CCCCCC"> your</font><font color="#E5E5E5"> own overloaded methods then</font>

1009
00:43:08,620 --> 00:43:11,640
to<font color="#E5E5E5"> just take that log data and then</font>

1010
00:43:10,270 --> 00:43:13,870
write<font color="#CCCCCC"> that to a structured file as well</font>

1011
00:43:11,640 --> 00:43:18,940
and then you<font color="#CCCCCC"> have very similar data it's</font>

1012
00:43:13,870 --> 00:43:20,049
a like what I've got in<font color="#E5E5E5"> coal strike I</font>

1013
00:43:18,940 --> 00:43:23,050
guess I'd be remiss if<font color="#CCCCCC"> I didn't mention</font>

1014
00:43:20,050 --> 00:43:24,760
<font color="#E5E5E5">like web hacking</font><font color="#CCCCCC"> there's already a</font>

1015
00:43:23,050 --> 00:43:27,940
pretty cool project<font color="#CCCCCC"> and</font><font color="#E5E5E5"> I've use this a</font>

1016
00:43:24,760 --> 00:43:29,610
bit<font color="#E5E5E5"> in the past that will take burp</font>

1017
00:43:27,940 --> 00:43:32,920
suite<font color="#E5E5E5"> output is a burp suite</font><font color="#CCCCCC"> plug-in</font>

1018
00:43:29,610 --> 00:43:34,810
<font color="#E5E5E5">written by Thomas passkey hope I'm</font>

1019
00:43:32,920 --> 00:43:36,280
<font color="#E5E5E5">pronouncing that right</font><font color="#CCCCCC"> that will take</font>

1020
00:43:34,810 --> 00:43:39,310
all that data<font color="#CCCCCC"> and</font><font color="#E5E5E5"> then shove that into</font>

1021
00:43:36,280 --> 00:43:40,810
<font color="#CCCCCC">elasticsearch</font><font color="#E5E5E5"> as well so I found it</font>

1022
00:43:39,310 --> 00:43:43,120
fairly<font color="#CCCCCC"> interesting when I was</font><font color="#E5E5E5"> just</font><font color="#CCCCCC"> using</font>

1023
00:43:40,810 --> 00:43:44,560
it for<font color="#CCCCCC"> a like</font><font color="#E5E5E5"> app testing like if you're</font>

1024
00:43:43,120 --> 00:43:47,319
running<font color="#E5E5E5"> and like fuzzers or sometimes</font>

1025
00:43:44,560 --> 00:43:49,390
you're<font color="#E5E5E5"> using like the active scanner you</font>

1026
00:43:47,320 --> 00:43:51,400
never really<font color="#E5E5E5"> see like what</font><font color="#CCCCCC"> happens or</font>

1027
00:43:49,390 --> 00:43:52,660
what you know<font color="#E5E5E5"> other than like oh this</font>

1028
00:43:51,400 --> 00:43:55,030
has a<font color="#E5E5E5"> finite</font><font color="#CCCCCC"> or no this doesn't have a</font>

1029
00:43:52,660 --> 00:43:57,460
finding<font color="#E5E5E5"> I was finding instances where I</font>

1030
00:43:55,030 --> 00:43:59,560
would get<font color="#E5E5E5"> like 500 error messages where</font>

1031
00:43:57,460 --> 00:44:01,060
it was enough to<font color="#E5E5E5"> like sort of show</font><font color="#CCCCCC"> that</font>

1032
00:43:59,560 --> 00:44:02,350
there was<font color="#E5E5E5"> an issue there but never</font>

1033
00:44:01,060 --> 00:44:04,420
really<font color="#CCCCCC"> surfaced to be like the active</font>

1034
00:44:02,350 --> 00:44:07,810
scanners I was able to<font color="#E5E5E5"> go and see</font><font color="#CCCCCC"> that</font>

1035
00:44:04,420 --> 00:44:09,700
hey like these these requests made 500

1036
00:44:07,810 --> 00:44:11,920
<font color="#E5E5E5">HTTP error messages</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> then sort of</font>

1037
00:44:09,700 --> 00:44:14,830
<font color="#E5E5E5">like</font><font color="#CCCCCC"> teased out and find</font><font color="#E5E5E5"> loner abilities</font>

1038
00:44:11,920 --> 00:44:15,910
based<font color="#E5E5E5"> on that so you know sort</font><font color="#CCCCCC"> of</font>

1039
00:44:14,830 --> 00:44:17,470
outside read to me that that's<font color="#E5E5E5"> a good</font>

1040
00:44:15,910 --> 00:44:20,350
use case<font color="#E5E5E5"> or if you're trying to proxy</font>

1041
00:44:17,470 --> 00:44:21,640
commands or your web<font color="#E5E5E5"> traffic this</font><font color="#CCCCCC"> is a</font>

1042
00:44:20,350 --> 00:44:23,200
good another good way of did<font color="#E5E5E5"> that</font><font color="#CCCCCC"> data</font>

1043
00:44:21,640 --> 00:44:24,750
in there<font color="#CCCCCC"> besides like the packet beet</font>

1044
00:44:23,200 --> 00:44:30,750
libraries and things<font color="#E5E5E5"> like that</font>

1045
00:44:24,750 --> 00:44:32,820
especially for<font color="#CCCCCC"> SSL</font><font color="#E5E5E5"> all right so what</font>

1046
00:44:30,750 --> 00:44:35,180
were the outcomes<font color="#E5E5E5"> of doing all this</font>

1047
00:44:32,820 --> 00:44:37,410
stuff<font color="#CCCCCC"> I think first and foremost like</font>

1048
00:44:35,180 --> 00:44:40,649
we've used this to debug<font color="#E5E5E5"> our</font>

1049
00:44:37,410 --> 00:44:42,180
infrastructure like we will break things

1050
00:44:40,650 --> 00:44:43,890
<font color="#E5E5E5">occasionally like it's fairly complex</font>

1051
00:44:42,180 --> 00:44:46,529
<font color="#E5E5E5">and on how we have things stood up and</font>

1052
00:44:43,890 --> 00:44:48,420
well we'll see that<font color="#E5E5E5"> hey well the beacons</font>

1053
00:44:46,530 --> 00:44:50,730
are making it to the<font color="#CCCCCC"> reader here's to</font>

1054
00:44:48,420 --> 00:44:52,980
<font color="#E5E5E5">the edge but we screw something else up</font>

1055
00:44:50,730 --> 00:44:57,480
<font color="#E5E5E5">after that right so it's helped us in</font>

1056
00:44:52,980 --> 00:44:59,460
debugging<font color="#E5E5E5"> and troubleshooting and</font>

1057
00:44:57,480 --> 00:45:01,080
operational security<font color="#CCCCCC"> I think this is</font>

1058
00:44:59,460 --> 00:45:02,630
probably<font color="#E5E5E5"> one of the more</font><font color="#CCCCCC"> entertaining</font>

1059
00:45:01,080 --> 00:45:04,830
things literally<font color="#E5E5E5"> the first day we</font>

1060
00:45:02,630 --> 00:45:06,869
installed<font color="#E5E5E5"> this we kept having</font><font color="#CCCCCC"> this issue</font>

1061
00:45:04,830 --> 00:45:09,000
of we call them like zombie or phantom

1062
00:45:06,869 --> 00:45:12,090
beacons<font color="#E5E5E5"> where we would just get like you</font>

1063
00:45:09,000 --> 00:45:13,170
know<font color="#CCCCCC"> you</font><font color="#E5E5E5"> little black icon shows up it's</font>

1064
00:45:12,090 --> 00:45:15,330
<font color="#E5E5E5">like hey somebody's trying to check in</font>

1065
00:45:13,170 --> 00:45:16,830
so if you<font color="#E5E5E5"> have a DNS beacon you</font><font color="#CCCCCC"> have to</font>

1066
00:45:15,330 --> 00:45:21,359
tell it<font color="#CCCCCC"> to check in and</font><font color="#E5E5E5"> then you'll get</font>

1067
00:45:16,830 --> 00:45:22,710
you<font color="#CCCCCC"> know</font><font color="#E5E5E5"> that rich look like this where</font>

1068
00:45:21,359 --> 00:45:24,210
you've got the IP and all and stuff like

1069
00:45:22,710 --> 00:45:26,160
that<font color="#CCCCCC"> otherwise it's just like a black</font>

1070
00:45:24,210 --> 00:45:28,710
computer icon<font color="#E5E5E5"> right here anyone see</font>

1071
00:45:26,160 --> 00:45:31,290
anything<font color="#CCCCCC"> until it actually</font><font color="#E5E5E5"> checks in so</font>

1072
00:45:28,710 --> 00:45:35,630
we kept<font color="#E5E5E5"> thinking</font><font color="#CCCCCC"> like well</font><font color="#E5E5E5"> what's trying</font>

1073
00:45:31,290 --> 00:45:37,980
<font color="#E5E5E5">to check in it's it's really strange</font><font color="#CCCCCC"> and</font>

1074
00:45:35,630 --> 00:45:39,240
<font color="#E5E5E5">we started doing some analysis on it</font>

1075
00:45:37,980 --> 00:45:42,050
right because<font color="#E5E5E5"> we</font><font color="#CCCCCC"> actually have the data</font>

1076
00:45:39,240 --> 00:45:44,549
<font color="#CCCCCC">now and being</font><font color="#E5E5E5"> an internal</font><font color="#CCCCCC"> Red Team we</font>

1077
00:45:42,050 --> 00:45:46,770
tend<font color="#CCCCCC"> to</font><font color="#E5E5E5"> write some stuff and blow it up</font>

1078
00:45:44,550 --> 00:45:48,570
internally to test<font color="#CCCCCC"> things out like hey</font>

1079
00:45:46,770 --> 00:45:50,430
we<font color="#E5E5E5"> want to see how well our macro</font>

1080
00:45:48,570 --> 00:45:52,200
<font color="#E5E5E5">detection is working or you know</font>

1081
00:45:50,430 --> 00:45:54,089
<font color="#E5E5E5">something like that</font><font color="#CCCCCC"> right so</font><font color="#E5E5E5"> we'll write</font>

1082
00:45:52,200 --> 00:45:55,859
<font color="#E5E5E5">our own you know pelos to get dropped</font>

1083
00:45:54,089 --> 00:45:58,380
and<font color="#E5E5E5"> exploited in an environment on like</font>

1084
00:45:55,859 --> 00:46:00,839
our<font color="#E5E5E5"> test</font><font color="#CCCCCC"> or dev infrastructure and</font>

1085
00:45:58,380 --> 00:46:04,530
clearly like you know the top<font color="#E5E5E5"> three</font><font color="#CCCCCC"> rows</font>

1086
00:46:00,839 --> 00:46:06,859
here<font color="#CCCCCC"> are legit</font><font color="#E5E5E5"> like these are our egress</font>

1087
00:46:04,530 --> 00:46:10,859
<font color="#E5E5E5">IPs and then all the other stuff</font><font color="#CCCCCC"> are</font>

1088
00:46:06,859 --> 00:46:12,509
security vendors so we've got in the

1089
00:46:10,859 --> 00:46:13,619
screenshot<font color="#CCCCCC"> BitDefender the defenders</font>

1090
00:46:12,510 --> 00:46:15,270
<font color="#E5E5E5">like super noisy there were the ones</font>

1091
00:46:13,619 --> 00:46:17,580
<font color="#CCCCCC">that were constantly like crannies</font>

1092
00:46:15,270 --> 00:46:20,520
<font color="#E5E5E5">phantom beacons and</font><font color="#CCCCCC"> really sort of</font>

1093
00:46:17,580 --> 00:46:23,119
<font color="#E5E5E5">annoying us</font><font color="#CCCCCC"> and then we've also</font><font color="#E5E5E5"> got Open</font>

1094
00:46:20,520 --> 00:46:24,990
DNS hits us quite a<font color="#E5E5E5"> bit in Palo Alto oh</font>

1095
00:46:23,119 --> 00:46:26,599
and<font color="#E5E5E5"> it's sort of annoying just</font><font color="#CCCCCC"> to get</font>

1096
00:46:24,990 --> 00:46:28,680
that stuff popping up all<font color="#E5E5E5"> the time</font>

1097
00:46:26,599 --> 00:46:30,450
<font color="#CCCCCC">because you're</font><font color="#E5E5E5"> like super excited like</font>

1098
00:46:28,680 --> 00:46:31,890
<font color="#E5E5E5">chill</font><font color="#CCCCCC"> and then it's like no I didn't</font>

1099
00:46:30,450 --> 00:46:35,720
<font color="#E5E5E5">really get shell like these these guys</font>

1100
00:46:31,890 --> 00:46:38,629
<font color="#E5E5E5">are</font><font color="#CCCCCC"> just monitoring my credit and so now</font>

1101
00:46:35,720 --> 00:46:40,308
since<font color="#E5E5E5"> since we know and we're actually</font>

1102
00:46:38,630 --> 00:46:43,640
and<font color="#CCCCCC"> the</font><font color="#E5E5E5"> stuff we</font><font color="#CCCCCC"> can do something</font><font color="#E5E5E5"> about</font>

1103
00:46:40,309 --> 00:46:45,740
<font color="#E5E5E5">it so</font><font color="#CCCCCC"> we started implementing some stuff</font>

1104
00:46:43,640 --> 00:46:46,490
and so<font color="#E5E5E5"> shout</font><font color="#CCCCCC"> out</font><font color="#E5E5E5"> to a Jason laying in</font>

1105
00:46:45,740 --> 00:46:50,000
the back

1106
00:46:46,490 --> 00:46:52,368
curious<font color="#E5E5E5"> jack</font><font color="#CCCCCC"> hey</font><font color="#E5E5E5"> Jason he gave a cool</font>

1107
00:46:50,000 --> 00:46:54,470
talk last<font color="#E5E5E5"> year at Derby con</font><font color="#CCCCCC"> about some</font>

1108
00:46:52,369 --> 00:46:56,990
of<font color="#CCCCCC"> those routine</font><font color="#E5E5E5"> tips and tricks that he</font>

1109
00:46:54,470 --> 00:46:59,029
had and if you<font color="#E5E5E5"> check out this one</font><font color="#CCCCCC"> here</font>

1110
00:46:56,990 --> 00:47:01,939
it's basically<font color="#E5E5E5"> a dot htaccess file that</font>

1111
00:46:59,029 --> 00:47:03,200
he wrote that will<font color="#E5E5E5"> I that he's</font>

1112
00:47:01,940 --> 00:47:06,170
<font color="#E5E5E5">identified like a ton of different</font>

1113
00:47:03,200 --> 00:47:07,788
security vendor subnets right so like

1114
00:47:06,170 --> 00:47:09,529
here's her entire site or blocks<font color="#E5E5E5"> right</font><font color="#CCCCCC"> I</font>

1115
00:47:07,789 --> 00:47:11,779
need any redirects<font color="#E5E5E5"> them to different</font>

1116
00:47:09,529 --> 00:47:15,170
places<font color="#CCCCCC"> right</font><font color="#E5E5E5"> so redirect</font><font color="#CCCCCC"> security</font><font color="#E5E5E5"> vendor</font>

1117
00:47:11,779 --> 00:47:17,240
a security<font color="#E5E5E5"> vendor</font><font color="#CCCCCC"> B and you know</font><font color="#E5E5E5"> be on</font>

1118
00:47:15,170 --> 00:47:18,470
your<font color="#E5E5E5"> merry little way and so we did</font>

1119
00:47:17,240 --> 00:47:19,819
something<font color="#CCCCCC"> very</font><font color="#E5E5E5"> similar we use internet</font>

1120
00:47:18,470 --> 00:47:23,299
so I convert that<font color="#E5E5E5"> all over to engine X</font>

1121
00:47:19,819 --> 00:47:25,430
format and put that into place and then

1122
00:47:23,299 --> 00:47:27,140
so here's<font color="#E5E5E5"> here's us actively</font>

1123
00:47:25,430 --> 00:47:29,240
silvertongue some of those security

1124
00:47:27,140 --> 00:47:31,160
vendors so it's kind of nice<font color="#CCCCCC"> to be able</font>

1125
00:47:29,240 --> 00:47:32,750
<font color="#E5E5E5">to see that and we go</font><font color="#CCCCCC"> alright we know</font>

1126
00:47:31,160 --> 00:47:34,430
now that<font color="#E5E5E5"> like at</font><font color="#CCCCCC"> least this part of the</font>

1127
00:47:32,750 --> 00:47:36,140
the attack is you know somebody's at

1128
00:47:34,430 --> 00:47:38,390
least aware of it you know we maybe need

1129
00:47:36,140 --> 00:47:40,700
<font color="#CCCCCC">to change our tactics we need to burn</font>

1130
00:47:38,390 --> 00:47:44,660
that infrastructure down or change<font color="#E5E5E5"> what</font>

1131
00:47:40,700 --> 00:47:46,808
we're doing<font color="#CCCCCC"> it's also</font><font color="#E5E5E5"> been pretty</font>

1132
00:47:44,660 --> 00:47:51,348
interesting<font color="#E5E5E5"> just to see</font><font color="#CCCCCC"> like visually</font>

1133
00:47:46,809 --> 00:47:54,519
<font color="#CCCCCC">can</font><font color="#E5E5E5"> you find the data X fill in this it</font>

1134
00:47:51,349 --> 00:47:56,839
becomes<font color="#E5E5E5"> very clear very quickly like how</font>

1135
00:47:54,519 --> 00:47:58,578
predictable<font color="#CCCCCC"> like some</font><font color="#E5E5E5"> of our tooling</font>

1136
00:47:56,839 --> 00:48:01,430
really kind<font color="#E5E5E5"> of looks like you know can</font>

1137
00:47:58,579 --> 00:48:04,460
it's very clear beaconing right you see

1138
00:48:01,430 --> 00:48:07,038
the very periodic<font color="#E5E5E5"> calls coming in and</font>

1139
00:48:04,460 --> 00:48:09,680
then we also see like the DNS<font color="#E5E5E5"> X well</font>

1140
00:48:07,039 --> 00:48:17,779
we're all<font color="#CCCCCC"> signed like us I</font><font color="#E5E5E5"> so flood of a</font>

1141
00:48:09,680 --> 00:48:19,279
DNS<font color="#CCCCCC"> request</font><font color="#E5E5E5"> the other thing it was sort</font>

1142
00:48:17,779 --> 00:48:21,619
of<font color="#E5E5E5"> interesting is I don't</font><font color="#CCCCCC"> think I</font>

1143
00:48:19,279 --> 00:48:23,630
realize how much noise<font color="#E5E5E5"> we actually make</font>

1144
00:48:21,619 --> 00:48:25,400
right so in this<font color="#CCCCCC"> case and this is some</font>

1145
00:48:23,630 --> 00:48:27,140
<font color="#E5E5E5">of our test infrastructure as well not</font>

1146
00:48:25,400 --> 00:48:29,450
just<font color="#CCCCCC"> production stuff</font><font color="#E5E5E5"> but you know we've</font>

1147
00:48:27,140 --> 00:48:32,328
got<font color="#E5E5E5"> three hundred sixty thousand</font>

1148
00:48:29,450 --> 00:48:34,490
different<font color="#E5E5E5"> DNS hits that were coming back</font>

1149
00:48:32,329 --> 00:48:35,900
<font color="#CCCCCC">to our infrastructure like that's a</font><font color="#E5E5E5"> lot</font>

1150
00:48:34,490 --> 00:48:37,848
of<font color="#CCCCCC"> traffic</font>

1151
00:48:35,900 --> 00:48:39,440
<font color="#E5E5E5">if you imagine from like you know</font><font color="#CCCCCC"> Red</font>

1152
00:48:37,849 --> 00:48:41,299
<font color="#E5E5E5">Sea perspective you know maybe we should</font>

1153
00:48:39,440 --> 00:48:42,680
be<font color="#E5E5E5"> you know tuning down how often we're</font>

1154
00:48:41,299 --> 00:48:46,038
calling back you know<font color="#CCCCCC"> like</font><font color="#E5E5E5"> 30</font><font color="#CCCCCC"> seconds</font>

1155
00:48:42,680 --> 00:48:47,480
seems like maybe an<font color="#CCCCCC"> okay like time but</font>

1156
00:48:46,039 --> 00:48:49,819
you realize oh<font color="#CCCCCC"> that really</font><font color="#E5E5E5"> adds up</font>

1157
00:48:47,480 --> 00:48:52,060
across all<font color="#E5E5E5"> the</font><font color="#CCCCCC"> Ho's all the beacons</font><font color="#E5E5E5"> like</font>

1158
00:48:49,819 --> 00:48:54,320
that gets really<font color="#E5E5E5"> noisy really fast</font>

1159
00:48:52,060 --> 00:48:56,270
so just<font color="#CCCCCC"> something to kind</font><font color="#E5E5E5"> of be</font><font color="#CCCCCC"> aware</font>

1160
00:48:54,320 --> 00:48:58,090
<font color="#CCCCCC">off to and I</font><font color="#E5E5E5"> think from like a defensive</font>

1161
00:48:56,270 --> 00:49:00,800
perspective it's interesting because

1162
00:48:58,090 --> 00:49:03,950
you're<font color="#E5E5E5"> probably using some sort of you</font>

1163
00:49:00,800 --> 00:49:05,360
know<font color="#CCCCCC"> CC</font><font color="#E5E5E5"> buy a domain right where you</font>

1164
00:49:03,950 --> 00:49:07,009
<font color="#E5E5E5">have no</font><font color="#CCCCCC"> traffic to that domain</font><font color="#E5E5E5"> all</font>

1165
00:49:05,360 --> 00:49:08,120
sudden you go<font color="#CCCCCC"> from no traffic</font><font color="#E5E5E5"> to like a</font>

1166
00:49:07,010 --> 00:49:09,650
whole bunch<font color="#CCCCCC"> of traffic right</font><font color="#E5E5E5"> there</font>

1167
00:49:08,120 --> 00:49:11,359
should<font color="#E5E5E5"> be some sort</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> like shelving</font>

1168
00:49:09,650 --> 00:49:14,330
<font color="#CCCCCC">that happens if you're doing some some</font>

1169
00:49:11,360 --> 00:49:15,590
like<font color="#E5E5E5"> log</font><font color="#CCCCCC"> tale analysis on that I think</font>

1170
00:49:14,330 --> 00:49:16,759
it's<font color="#E5E5E5"> just sort of interesting to</font><font color="#CCCCCC"> sort of</font>

1171
00:49:15,590 --> 00:49:20,180
<font color="#CCCCCC">visualize and think about like what</font><font color="#E5E5E5"> are</font>

1172
00:49:16,760 --> 00:49:21,350
the implications of that<font color="#CCCCCC"> and a lot of</font>

1173
00:49:20,180 --> 00:49:25,069
<font color="#E5E5E5">this is way noisier than I thought it</font>

1174
00:49:21,350 --> 00:49:29,180
<font color="#E5E5E5">was going</font><font color="#CCCCCC"> to be</font><font color="#E5E5E5"> and and here's sort of</font>

1175
00:49:25,070 --> 00:49:31,390
<font color="#E5E5E5">the reason</font><font color="#CCCCCC"> for adding</font><font color="#E5E5E5"> all that mitre</font><font color="#CCCCCC"> TTP</font>

1176
00:49:29,180 --> 00:49:34,310
stuff<font color="#CCCCCC"> into you like</font><font color="#E5E5E5"> the CNA script</font>

1177
00:49:31,390 --> 00:49:35,509
<font color="#E5E5E5">excuse me was that we can start to do</font>

1178
00:49:34,310 --> 00:49:40,250
some pretty<font color="#E5E5E5"> sweet stuff like this so</font>

1179
00:49:35,510 --> 00:49:43,250
this<font color="#CCCCCC"> is a visualization that we</font><font color="#E5E5E5"> built</font>

1180
00:49:40,250 --> 00:49:44,480
out in<font color="#E5E5E5"> elasticsearch</font><font color="#CCCCCC"> that as we're</font><font color="#E5E5E5"> doing</font>

1181
00:49:43,250 --> 00:49:48,850
engagement literally is basically

1182
00:49:44,480 --> 00:49:51,650
creating<font color="#E5E5E5"> its own</font><font color="#CCCCCC"> mitre attack</font><font color="#E5E5E5"> TTP map so</font>

1183
00:49:48,850 --> 00:49:53,270
<font color="#CCCCCC">you</font><font color="#E5E5E5"> can see here that you know some of</font>

1184
00:49:51,650 --> 00:49:55,160
the<font color="#E5E5E5"> things that I probably wasn't</font>

1185
00:49:53,270 --> 00:49:57,980
thinking about<font color="#E5E5E5"> you know as far</font><font color="#CCCCCC"> as</font><font color="#E5E5E5"> like</font>

1186
00:49:55,160 --> 00:50:00,770
what<font color="#CCCCCC"> are our most common tactics that</font>

1187
00:49:57,980 --> 00:50:02,510
<font color="#E5E5E5">we're using show up here like</font><font color="#CCCCCC"> processed</font>

1188
00:50:00,770 --> 00:50:04,220
Halloween like who knew that<font color="#E5E5E5"> was like</font>

1189
00:50:02,510 --> 00:50:06,320
one<font color="#E5E5E5"> of the most common ones</font><font color="#CCCCCC"> that we do</font>

1190
00:50:04,220 --> 00:50:07,959
it's like<font color="#E5E5E5"> well okay</font><font color="#CCCCCC"> well because of the</font>

1191
00:50:06,320 --> 00:50:10,580
way<font color="#E5E5E5"> that a couple strike you know</font>

1192
00:50:07,960 --> 00:50:12,140
injects its new beacons and and things

1193
00:50:10,580 --> 00:50:14,259
like<font color="#CCCCCC"> that</font><font color="#E5E5E5"> that that's one of</font><font color="#CCCCCC"> the top</font>

1194
00:50:12,140 --> 00:50:16,520
ones that we do so helps us in doing

1195
00:50:14,260 --> 00:50:22,580
<font color="#E5E5E5">recommendations and prioritization of</font>

1196
00:50:16,520 --> 00:50:24,050
<font color="#E5E5E5">that that's the type of work yeah and</font><font color="#CCCCCC"> so</font>

1197
00:50:22,580 --> 00:50:25,700
basically you can<font color="#E5E5E5"> start</font><font color="#CCCCCC"> now visualizing</font>

1198
00:50:24,050 --> 00:50:27,740
and understanding like what<font color="#E5E5E5"> sort of</font>

1199
00:50:25,700 --> 00:50:30,710
things<font color="#E5E5E5"> are going on within the</font>

1200
00:50:27,740 --> 00:50:32,899
<font color="#E5E5E5">infrastructure as it's going you've got</font>

1201
00:50:30,710 --> 00:50:34,220
some pretty<font color="#CCCCCC"> sweet stuff like like</font><font color="#E5E5E5"> this</font>

1202
00:50:32,900 --> 00:50:36,710
<font color="#E5E5E5">one is one</font><font color="#CCCCCC"> of my</font><font color="#E5E5E5"> favorite ones you can</font>

1203
00:50:34,220 --> 00:50:37,879
<font color="#E5E5E5">see very clearly like patterns</font><font color="#CCCCCC"> great so</font>

1204
00:50:36,710 --> 00:50:39,260
you can<font color="#E5E5E5"> start to figure out like</font><font color="#CCCCCC"> oh</font><font color="#E5E5E5"> this</font>

1205
00:50:37,880 --> 00:50:41,000
is this employee<font color="#E5E5E5"> they're normally in</font>

1206
00:50:39,260 --> 00:50:42,950
from like<font color="#CCCCCC"> nine to five</font><font color="#E5E5E5"> or what are</font><font color="#CCCCCC"> their</font>

1207
00:50:41,000 --> 00:50:46,130
<font color="#E5E5E5">times might be and then you can sort of</font>

1208
00:50:42,950 --> 00:50:47,779
<font color="#E5E5E5">plan your operations</font><font color="#CCCCCC"> around that you can</font>

1209
00:50:46,130 --> 00:50:49,790
<font color="#E5E5E5">tell you know like from this case where</font>

1210
00:50:47,780 --> 00:50:51,590
<font color="#CCCCCC">we've got some</font><font color="#E5E5E5"> some</font><font color="#CCCCCC"> a little bit</font><font color="#E5E5E5"> lower</font>

1211
00:50:49,790 --> 00:50:54,080
<font color="#E5E5E5">and slower beacons</font><font color="#CCCCCC"> and then we've also</font>

1212
00:50:51,590 --> 00:50:55,190
<font color="#CCCCCC">got our really fast working beacons too</font>

1213
00:50:54,080 --> 00:51:00,940
so we can kind of<font color="#E5E5E5"> keep an eye on that</font>

1214
00:50:55,190 --> 00:51:04,970
stuff<font color="#CCCCCC"> you know</font><font color="#E5E5E5"> and everybody loves</font>

1215
00:51:00,940 --> 00:51:05,660
reporting and and now that<font color="#E5E5E5"> everything is</font>

1216
00:51:04,970 --> 00:51:07,189
in

1217
00:51:05,660 --> 00:51:09,890
some sort of like structured format

1218
00:51:07,190 --> 00:51:11,870
<font color="#CCCCCC">structured logging</font><font color="#E5E5E5"> you can do some</font>

1219
00:51:09,890 --> 00:51:13,730
pretty<font color="#CCCCCC"> easy</font><font color="#E5E5E5"> reporting with some of the</font>

1220
00:51:11,870 --> 00:51:16,400
stuff<font color="#CCCCCC"> so like this little Python script</font>

1221
00:51:13,730 --> 00:51:20,000
here<font color="#E5E5E5"> will query elasticsearch pull out</font>

1222
00:51:16,400 --> 00:51:21,860
every time<font color="#E5E5E5"> a new</font><font color="#CCCCCC"> beacon</font><font color="#E5E5E5"> was created with</font>

1223
00:51:20,000 --> 00:51:23,500
the<font color="#E5E5E5"> like the beacon ID the host name</font><font color="#CCCCCC"> and</font>

1224
00:51:21,860 --> 00:51:26,510
the user that<font color="#E5E5E5"> was logged in at that time</font>

1225
00:51:23,500 --> 00:51:28,340
<font color="#CCCCCC">so</font><font color="#E5E5E5"> that way now you got a nice little</font>

1226
00:51:26,510 --> 00:51:29,630
less<font color="#CCCCCC"> script to you know you can dump it</font>

1227
00:51:28,340 --> 00:51:31,940
<font color="#E5E5E5">out to CSV</font><font color="#CCCCCC"> and put that</font><font color="#E5E5E5"> in some</font><font color="#CCCCCC"> some</font>

1228
00:51:29,630 --> 00:51:34,190
time lining tool and get<font color="#E5E5E5"> all that data</font>

1229
00:51:31,940 --> 00:51:38,710
out<font color="#CCCCCC"> so really sort of simplify your your</font>

1230
00:51:34,190 --> 00:51:41,210
approaches things so the gap<font color="#CCCCCC"> so far is</font>

1231
00:51:38,710 --> 00:51:43,840
attacking<font color="#E5E5E5"> from</font><font color="#CCCCCC"> Windows systems and</font><font color="#E5E5E5"> found</font>

1232
00:51:41,210 --> 00:51:45,950
a really<font color="#E5E5E5"> awesome way of doing that</font>

1233
00:51:43,840 --> 00:51:48,380
cross index correlation is kind of

1234
00:51:45,950 --> 00:51:51,080
crappy<font color="#CCCCCC"> there's no like</font><font color="#E5E5E5"> sub select</font>

1235
00:51:48,380 --> 00:51:52,070
statements<font color="#E5E5E5"> and there's a lot of ramen of</font>

1236
00:51:51,080 --> 00:51:57,259
<font color="#CCCCCC">alder</font><font color="#E5E5E5"> than this because everything is</font>

1237
00:51:52,070 --> 00:52:03,110
<font color="#E5E5E5">Java based one request I have for tool</font>

1238
00:51:57,260 --> 00:52:09,650
makers is to add<font color="#CCCCCC"> widget' timestamps ISO</font>

1239
00:52:03,110 --> 00:52:11,450
8601<font color="#E5E5E5"> and same logging so I want to add</font>

1240
00:52:09,650 --> 00:52:14,060
more window<font color="#E5E5E5"> stuff maybe feed some stuff</font>

1241
00:52:11,450 --> 00:52:15,200
in<font color="#E5E5E5"> the machine learning</font><font color="#CCCCCC"> do some more</font>

1242
00:52:14,060 --> 00:52:17,930
analysis<font color="#E5E5E5"> on the data that</font><font color="#CCCCCC"> we're getting</font>

1243
00:52:15,200 --> 00:52:19,669
<font color="#E5E5E5">back</font><font color="#CCCCCC"> and I'm out of</font><font color="#E5E5E5"> time</font>

1244
00:52:17,930 --> 00:52:23,830
so here's here's references and

1245
00:52:19,670 --> 00:52:23,830
resources all be posting the slides here

