1
00:00:00,660 --> 00:00:06,899
[Applause]

2
00:00:03,589 --> 00:00:09,780
<font color="#CCCCCC">all right cool we</font><font color="#E5E5E5"> get to start a little</font>

3
00:00:06,899 --> 00:00:12,629
earlier<font color="#E5E5E5"> thank you all</font><font color="#CCCCCC"> for coming this is</font>

4
00:00:09,780 --> 00:00:16,439
<font color="#CCCCCC">the unintended risks of trusting Active</font>

5
00:00:12,630 --> 00:00:18,300
Directory<font color="#E5E5E5"> so my name</font><font color="#CCCCCC"> is wolf trainer</font><font color="#E5E5E5"> my</font>

6
00:00:16,440 --> 00:00:19,859
handle is<font color="#CCCCCC"> harm</font><font color="#E5E5E5"> going yeah I've got a</font>

7
00:00:18,300 --> 00:00:21,840
<font color="#E5E5E5">little</font><font color="#CCCCCC"> Yoda picture and I</font><font color="#E5E5E5"> think that was</font>

8
00:00:19,859 --> 00:00:24,660
someone<font color="#E5E5E5"> on our team is a pretty good</font>

9
00:00:21,840 --> 00:00:26,490
<font color="#CCCCCC">Photoshop so I'm a red teamer and I like</font>

10
00:00:24,660 --> 00:00:28,199
to<font color="#E5E5E5"> call myself an offensive engineer I</font>

11
00:00:26,490 --> 00:00:30,359
work at<font color="#CCCCCC"> spectra so I build a lot of</font>

12
00:00:28,199 --> 00:00:32,489
tools<font color="#E5E5E5"> and</font><font color="#CCCCCC"> the definite by division</font>

13
00:00:30,359 --> 00:00:34,860
<font color="#E5E5E5">alumni</font><font color="#CCCCCC"> I vlog a lot and I'm a co-founder</font>

14
00:00:32,488 --> 00:00:36,510
<font color="#CCCCCC">and</font><font color="#E5E5E5"> co-developer or goes back to the new</font>

15
00:00:34,860 --> 00:00:39,510
<font color="#CCCCCC">c-sharp</font><font color="#E5E5E5"> stuff that was a demo a little</font>

16
00:00:36,510 --> 00:00:43,890
bit today<font color="#CCCCCC"> Empire bloodhound</font><font color="#E5E5E5"> and the</font><font color="#CCCCCC"> Vale</font>

17
00:00:39,510 --> 00:00:45,809
framework so my name<font color="#E5E5E5"> is Anna Christensen</font>

18
00:00:43,890 --> 00:00:49,829
<font color="#CCCCCC">TIFF get on Twitter I do bunch of</font>

19
00:00:45,809 --> 00:00:51,390
<font color="#E5E5E5">stubborn</font><font color="#CCCCCC"> spec drops</font><font color="#E5E5E5"> I I'm also just</font>

20
00:00:49,829 --> 00:00:53,940
going<font color="#CCCCCC"> after</font><font color="#E5E5E5"> shiny things all the time so</font>

21
00:00:51,390 --> 00:00:56,100
<font color="#CCCCCC">be that</font><font color="#E5E5E5"> offensive or defensive I kind of</font>

22
00:00:53,940 --> 00:00:58,890
flip<font color="#E5E5E5"> both sides</font><font color="#CCCCCC"> I kind of in the</font>

23
00:00:56,100 --> 00:01:00,180
background on a lot<font color="#E5E5E5"> of things so I don't</font>

24
00:00:58,890 --> 00:01:01,949
see a lot<font color="#CCCCCC"> of my projects but I</font>

25
00:01:00,180 --> 00:01:04,599
<font color="#CCCCCC">contributed a lot</font><font color="#E5E5E5"> of kind</font><font color="#CCCCCC"> of behind the</font>

26
00:01:01,949 --> 00:01:06,039
<font color="#E5E5E5">scenes</font><font color="#CCCCCC"> type teams</font>

27
00:01:04,599 --> 00:01:08,750
[Music]

28
00:01:06,040 --> 00:01:13,049
[Applause]

29
00:01:08,750 --> 00:01:14,970
I'm Matt Nelson<font color="#E5E5E5"> Twitter's</font><font color="#CCCCCC"> three I'm a</font>

30
00:01:13,049 --> 00:01:17,850
senior operator researcher expect ropes

31
00:01:14,970 --> 00:01:20,070
<font color="#CCCCCC">so I do a</font><font color="#E5E5E5"> lot of research that these</font>

32
00:01:17,850 --> 00:01:21,780
guys guys<font color="#E5E5E5"> are building tools for solving</font>

33
00:01:20,070 --> 00:01:22,470
problems<font color="#CCCCCC"> I've got my</font><font color="#E5E5E5"> operations and</font>

34
00:01:21,780 --> 00:01:24,600
stuff like<font color="#E5E5E5"> that</font>

35
00:01:22,470 --> 00:01:27,509
I also<font color="#CCCCCC"> brought a lot</font>

36
00:01:24,600 --> 00:01:29,908
<font color="#CCCCCC">a</font><font color="#E5E5E5"> few people</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> claim they sort</font><font color="#CCCCCC"> of</font>

37
00:01:27,509 --> 00:01:34,740
like<font color="#CCCCCC"> calm a</font><font color="#E5E5E5"> little bit and then all the</font>

38
00:01:29,909 --> 00:01:36,630
employees<font color="#CCCCCC"> alright so we're gonna</font><font color="#E5E5E5"> start</font>

39
00:01:34,740 --> 00:01:39,119
this talk with the question what is

40
00:01:36,630 --> 00:01:41,670
admin access<font color="#E5E5E5"> we're gonna make the</font>

41
00:01:39,119 --> 00:01:43,409
argument<font color="#CCCCCC"> that many</font><font color="#E5E5E5"> of us have been kind</font>

42
00:01:41,670 --> 00:01:45,180
<font color="#E5E5E5">of approaching this problem in</font><font color="#CCCCCC"> an</font>

43
00:01:43,409 --> 00:01:46,710
operational testing kind<font color="#CCCCCC"> of in the wrong</font>

44
00:01:45,180 --> 00:01:49,350
way we've<font color="#E5E5E5"> been approaching the concept</font>

45
00:01:46,710 --> 00:01:50,970
<font color="#E5E5E5">kind of the waterway the admin access is</font>

46
00:01:49,350 --> 00:01:52,740
a lot more<font color="#CCCCCC"> complicated than just</font>

47
00:01:50,970 --> 00:01:55,320
membership<font color="#CCCCCC"> that local administrators</font>

48
00:01:52,740 --> 00:01:57,568
well this covers many<font color="#E5E5E5"> of the cases there</font>

49
00:01:55,320 --> 00:01:59,610
are<font color="#E5E5E5"> some edge cases where things can get</font>

50
00:01:57,569 --> 00:02:01,590
really interesting where you can perform

51
00:01:59,610 --> 00:02:03,780
<font color="#CCCCCC">certain actions on</font><font color="#E5E5E5"> post without being a</font>

52
00:02:01,590 --> 00:02:05,850
<font color="#E5E5E5">member of</font><font color="#CCCCCC"> team local administrators so</font>

53
00:02:03,780 --> 00:02:08,009
there's kind of one<font color="#CCCCCC"> of our big points in</font>

54
00:02:05,850 --> 00:02:13,560
the<font color="#CCCCCC"> talk is</font><font color="#E5E5E5"> that having</font><font color="#CCCCCC"> access is more</font>

55
00:02:08,008 --> 00:02:14,760
<font color="#CCCCCC">than membership in just so the true</font>

56
00:02:13,560 --> 00:02:16,860
nature of having<font color="#E5E5E5"> access our</font>

57
00:02:14,760 --> 00:02:18,298
controversial statement is membership in

58
00:02:16,860 --> 00:02:20,130
the<font color="#E5E5E5"> systems local administrators group</font>

59
00:02:18,299 --> 00:02:23,790
like I mentioned<font color="#CCCCCC"> isn't what actually</font>

60
00:02:20,130 --> 00:02:26,549
matters<font color="#E5E5E5"> what actually matters is what</font>

61
00:02:23,790 --> 00:02:28,200
local domain groups<font color="#E5E5E5"> or</font><font color="#CCCCCC"> principals from</font>

62
00:02:26,549 --> 00:02:29,610
we're talking about a domain scenario

63
00:02:28,200 --> 00:02:31,530
with<font color="#E5E5E5"> the Human Bondage system</font>

64
00:02:29,610 --> 00:02:34,079
they care<font color="#CCCCCC"> about what local domain groups</font>

65
00:02:31,530 --> 00:02:37,200
or users have<font color="#CCCCCC"> access to specific</font><font color="#E5E5E5"> remote</font>

66
00:02:34,079 --> 00:02:38,220
<font color="#CCCCCC">resources on a host</font><font color="#E5E5E5"> those</font><font color="#CCCCCC"> are PC servers</font>

67
00:02:37,200 --> 00:02:41,880
remote registry

68
00:02:38,220 --> 00:02:43,290
<font color="#E5E5E5">W my sequel you know many many many</font>

69
00:02:41,880 --> 00:02:45,690
there's a million<font color="#E5E5E5"> of these different</font>

70
00:02:43,290 --> 00:02:47,190
host-based security descriptors<font color="#CCCCCC"> and</font>

71
00:02:45,690 --> 00:02:49,590
we'll get into<font color="#E5E5E5"> exactly with security</font>

72
00:02:47,190 --> 00:02:52,049
descriptors are and what they matter or

73
00:02:49,590 --> 00:02:55,049
<font color="#E5E5E5">white in there so it was an example you</font>

74
00:02:52,049 --> 00:02:56,850
have your<font color="#CCCCCC"> hosts many people just</font><font color="#E5E5E5"> think</font>

75
00:02:55,049 --> 00:02:58,890
okay I need<font color="#E5E5E5"> to pop this host</font><font color="#CCCCCC"> I'm gonna</font>

76
00:02:56,850 --> 00:03:00,510
do<font color="#E5E5E5"> like a one attack graph I'm gonna do</font>

77
00:02:58,890 --> 00:03:02,040
whatever else and I can figure out who's

78
00:03:00,510 --> 00:03:04,230
the<font color="#CCCCCC"> member of</font><font color="#E5E5E5"> local admins</font><font color="#CCCCCC"> in this box</font>

79
00:03:02,040 --> 00:03:06,630
and<font color="#E5E5E5"> then I'm gonna do my</font><font color="#CCCCCC"> final movement</font>

80
00:03:04,230 --> 00:03:08,100
off the<font color="#E5E5E5"> machine but this is what the</font>

81
00:03:06,630 --> 00:03:09,500
<font color="#E5E5E5">system actually is it's not just one</font>

82
00:03:08,100 --> 00:03:11,239
host<font color="#CCCCCC"> or like worldwide</font>

83
00:03:09,500 --> 00:03:13,520
<font color="#CCCCCC">is the monolithic you get remote access</font>

84
00:03:11,240 --> 00:03:15,530
to the<font color="#CCCCCC"> system host is a</font><font color="#E5E5E5"> collection of</font>

85
00:03:13,520 --> 00:03:17,150
services<font color="#E5E5E5"> many of these are registered</font><font color="#CCCCCC"> in</font>

86
00:03:15,530 --> 00:03:18,950
Active Directory through<font color="#E5E5E5"> for us or other</font>

87
00:03:17,150 --> 00:03:20,660
authentication protocols<font color="#CCCCCC"> I mean if</font>

88
00:03:18,950 --> 00:03:22,040
<font color="#CCCCCC">you're WMI your winner in service</font>

89
00:03:20,660 --> 00:03:24,560
Control Manager all this kind of stuff<font color="#CCCCCC"> I</font>

90
00:03:22,040 --> 00:03:26,390
talked<font color="#CCCCCC"> about</font><font color="#E5E5E5"> so what controls access</font><font color="#CCCCCC"> is</font>

91
00:03:24,560 --> 00:03:29,090
<font color="#E5E5E5">these particular remote services that</font>

92
00:03:26,390 --> 00:03:30,920
all act independently<font color="#E5E5E5"> so again there's</font>

93
00:03:29,090 --> 00:03:32,690
<font color="#E5E5E5">not a single security descriptor or</font>

94
00:03:30,920 --> 00:03:35,450
there's not<font color="#CCCCCC"> a</font><font color="#E5E5E5"> single set of rules that</font>

95
00:03:32,690 --> 00:03:39,230
says user a B and C has access<font color="#CCCCCC"> to all</font>

96
00:03:35,450 --> 00:03:41,089
these things each service contains their

97
00:03:39,230 --> 00:03:43,100
own set of rules<font color="#CCCCCC"> in</font><font color="#E5E5E5"> the host in the form</font>

98
00:03:41,090 --> 00:03:44,900
<font color="#E5E5E5">of security descriptors</font><font color="#CCCCCC"> it is binary</font>

99
00:03:43,100 --> 00:03:48,680
<font color="#CCCCCC">blob says who can</font><font color="#E5E5E5"> do what to this</font>

100
00:03:44,900 --> 00:03:50,660
particular service so for<font color="#E5E5E5"> example for a</font>

101
00:03:48,680 --> 00:03:52,459
<font color="#E5E5E5">service Control Manager you</font><font color="#CCCCCC"> can have you</font>

102
00:03:50,660 --> 00:03:53,959
<font color="#CCCCCC">know local administrators have generic</font>

103
00:03:52,459 --> 00:03:55,520
<font color="#E5E5E5">all get into all these kind of</font>

104
00:03:53,959 --> 00:03:57,350
components<font color="#E5E5E5"> in a second but you can also</font>

105
00:03:55,520 --> 00:03:59,030
have<font color="#E5E5E5"> domain users that are explicitly</font>

106
00:03:57,350 --> 00:04:00,859
<font color="#E5E5E5">added whether intentionally or</font>

107
00:03:59,030 --> 00:04:02,870
unintentionally<font color="#CCCCCC"> to the security</font>

108
00:04:00,860 --> 00:04:04,550
descriptors<font color="#E5E5E5"> for particular services that</font>

109
00:04:02,870 --> 00:04:07,280
might allow you to perform<font color="#CCCCCC"> certain type</font>

110
00:04:04,550 --> 00:04:13,070
of traditionally administrative actions

111
00:04:07,280 --> 00:04:15,260
on the<font color="#CCCCCC"> host so we'll just stay</font><font color="#E5E5E5"> that</font>

112
00:04:13,070 --> 00:04:16,700
services have security descriptors<font color="#CCCCCC"> and</font>

113
00:04:15,260 --> 00:04:19,130
those security descriptors control

114
00:04:16,700 --> 00:04:21,019
access<font color="#CCCCCC"> to those services so what our</font>

115
00:04:19,130 --> 00:04:23,840
security descriptors in which we care

116
00:04:21,019 --> 00:04:26,510
about<font color="#E5E5E5"> them security descriptors are the</font>

117
00:04:23,840 --> 00:04:29,750
mechanism that<font color="#E5E5E5"> Windows uses to control</font>

118
00:04:26,510 --> 00:04:32,719
access to<font color="#CCCCCC"> a</font><font color="#E5E5E5"> servants so any sort of</font>

119
00:04:29,750 --> 00:04:36,140
<font color="#CCCCCC">secure below object precinct securable</font>

120
00:04:32,720 --> 00:04:37,669
objects are so what are they<font color="#CCCCCC"> any object</font>

121
00:04:36,140 --> 00:04:40,310
<font color="#E5E5E5">I can have a security descriptor and if</font>

122
00:04:37,669 --> 00:04:42,349
<font color="#CCCCCC">I've done definition</font><font color="#E5E5E5"> and but essentially</font>

123
00:04:40,310 --> 00:04:44,150
<font color="#E5E5E5">what that means is you have the security</font>

124
00:04:42,350 --> 00:04:45,800
descriptor<font color="#CCCCCC"> that</font><font color="#E5E5E5"> it's just a structure</font>

125
00:04:44,150 --> 00:04:48,049
inside<font color="#CCCCCC"> of Windows it has a bunch</font><font color="#E5E5E5"> of</font>

126
00:04:45,800 --> 00:04:50,479
different<font color="#CCCCCC"> components as an attacker</font>

127
00:04:48,050 --> 00:04:53,390
<font color="#CCCCCC">we're</font><font color="#E5E5E5"> very interested in those</font><font color="#CCCCCC"> to read</font>

128
00:04:50,479 --> 00:04:57,440
<font color="#CCCCCC">highlighted fields there so on an owner</font>

129
00:04:53,390 --> 00:04:58,820
<font color="#E5E5E5">and add</font><font color="#CCCCCC"> Apple</font><font color="#E5E5E5"> so what we're gonna dive</font>

130
00:04:57,440 --> 00:05:01,070
into a<font color="#CCCCCC"> little bit</font><font color="#E5E5E5"> about what these are</font>

131
00:04:58,820 --> 00:05:02,750
<font color="#CCCCCC">worth mentioning is the</font><font color="#E5E5E5"> sepal because</font>

132
00:05:01,070 --> 00:05:06,080
that is a component that<font color="#E5E5E5"> the vendors can</font>

133
00:05:02,750 --> 00:05:08,030
use to monitor access<font color="#E5E5E5"> to these objects</font>

134
00:05:06,080 --> 00:05:10,370
so<font color="#CCCCCC"> we're</font><font color="#E5E5E5"> going to focus in a</font><font color="#CCCCCC"> little bit</font>

135
00:05:08,030 --> 00:05:14,770
<font color="#E5E5E5">on the owner and the devil and how we as</font>

136
00:05:10,370 --> 00:05:14,770
attackers<font color="#CCCCCC"> can use them</font><font color="#E5E5E5"> to our advantage</font>

137
00:05:15,580 --> 00:05:21,159
so the first instance is that<font color="#E5E5E5"> owner</font>

138
00:05:18,310 --> 00:05:23,830
<font color="#E5E5E5">field</font><font color="#CCCCCC"> owners have country complete</font>

139
00:05:21,160 --> 00:05:26,500
<font color="#E5E5E5">control over an object</font><font color="#CCCCCC"> by people so if</font>

140
00:05:23,830 --> 00:05:29,680
I'm<font color="#CCCCCC"> the owner of an object</font><font color="#E5E5E5"> then that</font>

141
00:05:26,500 --> 00:05:32,620
means I can add rights to it so I could

142
00:05:29,680 --> 00:05:34,990
say<font color="#CCCCCC"> will now has rights to control</font><font color="#E5E5E5"> this</font>

143
00:05:32,620 --> 00:05:38,770
<font color="#CCCCCC">object</font><font color="#E5E5E5"> I can</font><font color="#CCCCCC"> write to that</font><font color="#E5E5E5"> object</font><font color="#CCCCCC"> I just</font>

144
00:05:34,990 --> 00:05:41,410
have complete control likewise that

145
00:05:38,770 --> 00:05:43,750
second field was<font color="#E5E5E5"> the dapple so the</font>

146
00:05:41,410 --> 00:05:45,730
dapple is<font color="#CCCCCC"> a list of access control</font>

147
00:05:43,750 --> 00:05:48,520
<font color="#E5E5E5">entries so it's just a list</font><font color="#CCCCCC"> of</font>

148
00:05:45,730 --> 00:05:50,890
permissions<font color="#E5E5E5"> granting or denying users</font>

149
00:05:48,520 --> 00:05:54,430
access<font color="#CCCCCC"> to the object so if you take</font><font color="#E5E5E5"> like</font>

150
00:05:50,890 --> 00:05:55,900
a<font color="#E5E5E5"> file object</font><font color="#CCCCCC"> for example there's in the</font>

151
00:05:54,430 --> 00:05:59,220
dapple there's different<font color="#E5E5E5"> rules that</font>

152
00:05:55,900 --> 00:06:03,039
<font color="#E5E5E5">allow and deny users access</font><font color="#CCCCCC"> to that file</font>

153
00:05:59,220 --> 00:06:05,230
<font color="#CCCCCC">these files are</font><font color="#E5E5E5"> not the only secure</font>

154
00:06:03,040 --> 00:06:07,950
object<font color="#CCCCCC"> like we mentioned</font><font color="#E5E5E5"> there's a bunch</font>

155
00:06:05,230 --> 00:06:10,660
of different kinds out<font color="#E5E5E5"> there file shares</font>

156
00:06:07,950 --> 00:06:13,030
files<font color="#CCCCCC"> Active Directory objects all of</font>

157
00:06:10,660 --> 00:06:15,730
these have owners<font color="#CCCCCC"> all of these have</font>

158
00:06:13,030 --> 00:06:18,190
decals on them that control access<font color="#CCCCCC"> to</font>

159
00:06:15,730 --> 00:06:20,620
those objects<font color="#E5E5E5"> so how does this</font>

160
00:06:18,190 --> 00:06:22,690
familiarly<font color="#E5E5E5"> how does this normally look</font>

161
00:06:20,620 --> 00:06:24,970
if you've ever looked<font color="#E5E5E5"> right clicked on a</font>

162
00:06:22,690 --> 00:06:26,650
file for example<font color="#CCCCCC"> and looked at the</font>

163
00:06:24,970 --> 00:06:29,620
permissions<font color="#E5E5E5"> this is what it's looking</font>

164
00:06:26,650 --> 00:06:31,510
<font color="#CCCCCC">like</font><font color="#E5E5E5"> underneath you can see the dackel</font>

165
00:06:29,620 --> 00:06:33,820
is outlined there and there's on<font color="#E5E5E5"> the</font>

166
00:06:31,510 --> 00:06:37,599
left you see a type of<font color="#E5E5E5"> access so these</font>

167
00:06:33,820 --> 00:06:39,460
are allow access<font color="#E5E5E5"> and then inside there's</font>

168
00:06:37,600 --> 00:06:41,620
a list of<font color="#E5E5E5"> permissions that</font><font color="#CCCCCC"> are granted</font>

169
00:06:39,460 --> 00:06:45,190
<font color="#CCCCCC">so you can see</font><font color="#E5E5E5"> we're an allowing</font>

170
00:06:41,620 --> 00:06:46,810
marketer read access in<font color="#E5E5E5"> this case and</font>

171
00:06:45,190 --> 00:06:49,600
you<font color="#E5E5E5"> can see that IT admin and the</font>

172
00:06:46,810 --> 00:06:51,850
administrators have full control<font color="#CCCCCC"> over</font>

173
00:06:49,600 --> 00:06:53,200
this<font color="#CCCCCC"> this folder up at the top</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> that's</font>

174
00:06:51,850 --> 00:06:57,430
<font color="#CCCCCC">it in this</font><font color="#E5E5E5"> case we're talking about a</font>

175
00:06:53,200 --> 00:06:59,110
file object<font color="#E5E5E5"> the Downloads folder with in</font>

176
00:06:57,430 --> 00:07:00,970
<font color="#E5E5E5">addition so that's the</font><font color="#CCCCCC"> dapple and then</font>

177
00:06:59,110 --> 00:07:03,070
<font color="#CCCCCC">i'm right underneath you can see</font><font color="#E5E5E5"> the</font>

178
00:07:00,970 --> 00:07:05,500
owner is that<font color="#CCCCCC"> IT administrator as well</font>

179
00:07:03,070 --> 00:07:11,020
<font color="#E5E5E5">so that owner can do anything to</font><font color="#CCCCCC"> that</font>

180
00:07:05,500 --> 00:07:13,120
object<font color="#CCCCCC"> so we</font><font color="#E5E5E5"> have these objects they</font>

181
00:07:11,020 --> 00:07:15,820
have<font color="#CCCCCC"> their owners and their decals on</font>

182
00:07:13,120 --> 00:07:17,980
them and then when<font color="#CCCCCC"> it when another</font><font color="#E5E5E5"> user</font>

183
00:07:15,820 --> 00:07:19,570
<font color="#CCCCCC">tries to interact</font><font color="#E5E5E5"> with that</font><font color="#CCCCCC"> service so</font>

184
00:07:17,980 --> 00:07:22,660
<font color="#CCCCCC">let's say it's a file that file share</font>

185
00:07:19,570 --> 00:07:25,040
the individual service<font color="#E5E5E5"> performs an</font>

186
00:07:22,660 --> 00:07:26,360
authorization check it's<font color="#E5E5E5"> not some</font>

187
00:07:25,040 --> 00:07:28,790
<font color="#E5E5E5">Alliance component inside of Windows</font>

188
00:07:26,360 --> 00:07:30,650
<font color="#E5E5E5">that's doing the authorization checker</font>

189
00:07:28,790 --> 00:07:32,960
<font color="#E5E5E5">deciding who gets access</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> the file</font>

190
00:07:30,650 --> 00:07:35,780
<font color="#E5E5E5">chair</font><font color="#CCCCCC"> it's the file share service itself</font>

191
00:07:32,960 --> 00:07:38,840
that performs the<font color="#E5E5E5"> authorization</font><font color="#CCCCCC"> gem</font><font color="#E5E5E5"> the</font>

192
00:07:35,780 --> 00:07:40,940
same goes for W my<font color="#CCCCCC"> cert</font><font color="#E5E5E5"> control manager</font>

193
00:07:38,840 --> 00:07:43,310
etc<font color="#CCCCCC"> those all have security descriptors</font>

194
00:07:40,940 --> 00:07:46,640
<font color="#CCCCCC">that say who can access</font><font color="#E5E5E5"> each one of</font>

195
00:07:43,310 --> 00:07:48,350
those<font color="#CCCCCC"> services</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> what the service does</font>

196
00:07:46,640 --> 00:07:50,870
is it compares it looks at the user

197
00:07:48,350 --> 00:07:52,670
<font color="#CCCCCC">who's connecting</font><font color="#E5E5E5"> to the service and then</font>

198
00:07:50,870 --> 00:07:55,040
it looks at its security descriptor<font color="#E5E5E5"> and</font>

199
00:07:52,670 --> 00:07:57,170
says is the connecting<font color="#E5E5E5"> user</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> member in</font>

200
00:07:55,040 --> 00:08:00,080
<font color="#E5E5E5">the in the dackel in the security</font>

201
00:07:57,170 --> 00:08:02,630
descriptor<font color="#CCCCCC"> if so we're going to grant</font>

202
00:08:00,080 --> 00:08:04,250
them access if it's not in the list of

203
00:08:02,630 --> 00:08:08,180
accepted users they're going to be

204
00:08:04,250 --> 00:08:10,100
denied access<font color="#CCCCCC"> there</font><font color="#E5E5E5"> fairly simple</font><font color="#CCCCCC"> you</font>

205
00:08:08,180 --> 00:08:12,560
see this a lot so a lot<font color="#E5E5E5"> of</font><font color="#CCCCCC"> Windows</font>

206
00:08:10,100 --> 00:08:15,770
<font color="#CCCCCC">Services has the</font><font color="#E5E5E5"> local administrators</font>

207
00:08:12,560 --> 00:08:17,600
<font color="#CCCCCC">group added or granted access</font><font color="#E5E5E5"> to things</font>

208
00:08:15,770 --> 00:08:22,010
<font color="#E5E5E5">so for example the service Control</font>

209
00:08:17,600 --> 00:08:24,860
Manager<font color="#E5E5E5"> or WMI or the like sips the file</font>

210
00:08:22,010 --> 00:08:27,230
share<font color="#E5E5E5"> local administrators by default</font>

211
00:08:24,860 --> 00:08:29,060
<font color="#CCCCCC">are added to the dapples</font><font color="#E5E5E5"> of each one of</font>

212
00:08:27,230 --> 00:08:33,050
<font color="#E5E5E5">these services</font><font color="#CCCCCC"> that's why they can</font>

213
00:08:29,060 --> 00:08:34,610
access<font color="#E5E5E5"> them</font><font color="#CCCCCC"> however</font><font color="#E5E5E5"> you know those local</font>

214
00:08:33,049 --> 00:08:36,469
administrators<font color="#E5E5E5"> because all could also be</font>

215
00:08:34,610 --> 00:08:37,970
removed from<font color="#E5E5E5"> those same security</font>

216
00:08:36,470 --> 00:08:44,210
descriptors and<font color="#CCCCCC"> then they wouldn't be</font>

217
00:08:37,970 --> 00:08:45,520
able to<font color="#E5E5E5"> access those</font><font color="#CCCCCC"> services anymore so</font>

218
00:08:44,210 --> 00:08:49,040
why do<font color="#E5E5E5"> we really care about all of that</font>

219
00:08:45,520 --> 00:08:50,870
being a question to have so as far as

220
00:08:49,040 --> 00:08:52,610
Active Directory environments and

221
00:08:50,870 --> 00:08:55,370
<font color="#CCCCCC">specifically all those</font><font color="#E5E5E5"> inside them it's</font>

222
00:08:52,610 --> 00:08:57,500
<font color="#E5E5E5">really</font><font color="#CCCCCC"> hard to determine if a Miss Sarah</font>

223
00:08:55,370 --> 00:08:59,810
if a devil changes<font color="#CCCCCC"> on you know supposed</font>

224
00:08:57,500 --> 00:09:01,160
<font color="#E5E5E5">to</font><font color="#CCCCCC"> be there</font><font color="#E5E5E5"> if it was made by some sort</font>

225
00:08:59,810 --> 00:09:02,750
of<font color="#E5E5E5"> product on accent hit or</font><font color="#CCCCCC"> miss</font>

226
00:09:01,160 --> 00:09:05,810
<font color="#E5E5E5">configuration or if it was maliciously</font>

227
00:09:02,750 --> 00:09:07,250
put there<font color="#E5E5E5"> so doing that at scale it's</font>

228
00:09:05,810 --> 00:09:10,280
not an<font color="#E5E5E5"> easy thing to do it did anybody</font>

229
00:09:07,250 --> 00:09:15,650
here monitor all the<font color="#CCCCCC"> Devils on Baron</font>

230
00:09:10,280 --> 00:09:17,660
points exactly<font color="#E5E5E5"> so like I mentioned I've</font>

231
00:09:15,650 --> 00:09:19,520
got an<font color="#E5E5E5"> existing Miss configuration so</font>

232
00:09:17,660 --> 00:09:21,569
these are typically useful<font color="#CCCCCC"> and you might</font>

233
00:09:19,520 --> 00:09:23,520
<font color="#CCCCCC">occur with</font><font color="#E5E5E5"> just</font><font color="#CCCCCC"> galatians</font><font color="#E5E5E5"> scenario</font>

234
00:09:21,570 --> 00:09:25,800
<font color="#E5E5E5">you know the ability</font><font color="#CCCCCC"> for a little</font>

235
00:09:23,520 --> 00:09:28,079
<font color="#CCCCCC">current user to modify something</font><font color="#E5E5E5"> due</font><font color="#CCCCCC"> to</font>

236
00:09:25,800 --> 00:09:30,719
a<font color="#CCCCCC"> documents configuration for malicious</font>

237
00:09:28,080 --> 00:09:33,630
configuration so an attacker<font color="#CCCCCC"> in placing</font>

238
00:09:30,720 --> 00:09:36,120
a you know<font color="#E5E5E5"> backdoor</font><font color="#CCCCCC"> daca</font><font color="#E5E5E5"> on an object</font>

239
00:09:33,630 --> 00:09:38,580
<font color="#E5E5E5">order to kind of remain inside the</font>

240
00:09:36,120 --> 00:09:40,710
<font color="#CCCCCC">environment so the cool thing about</font>

241
00:09:38,580 --> 00:09:44,160
these is since it's<font color="#E5E5E5"> not easy to audit or</font>

242
00:09:40,710 --> 00:09:45,960
monitor outside of samples<font color="#E5E5E5"> you know the</font>

243
00:09:44,160 --> 00:09:47,640
<font color="#CCCCCC">printing footprint</font><font color="#E5E5E5"> that exists there's</font>

244
00:09:45,960 --> 00:09:49,350
pretty<font color="#E5E5E5"> recent law so it's a pretty safe</font>

245
00:09:47,640 --> 00:09:50,910
way<font color="#CCCCCC"> for an attacker to really</font><font color="#E5E5E5"> persist in</font>

246
00:09:49,350 --> 00:09:53,130
an apartment<font color="#E5E5E5"> not really have to</font><font color="#CCCCCC"> worry</font>

247
00:09:50,910 --> 00:09:56,550
<font color="#E5E5E5">about that</font><font color="#CCCCCC"> doctor access being</font>

248
00:09:53,130 --> 00:10:00,300
discovered<font color="#E5E5E5"> additionally how many teams</font>

249
00:09:56,550 --> 00:10:06,140
<font color="#E5E5E5">have read our configuration so you know</font>

250
00:10:00,300 --> 00:10:10,050
<font color="#E5E5E5">using them or looking</font><font color="#CCCCCC"> for them operation</font>

251
00:10:06,140 --> 00:10:11,850
<font color="#E5E5E5">so like like</font><font color="#CCCCCC"> Willa we mentioned</font><font color="#E5E5E5"> hose</font>

252
00:10:10,050 --> 00:10:13,650
base<font color="#E5E5E5"> security descriptor ease it's more</font>

253
00:10:11,850 --> 00:10:16,530
than<font color="#CCCCCC"> just a service control manager so</font>

254
00:10:13,650 --> 00:10:18,449
like we said<font color="#E5E5E5"> all of</font><font color="#CCCCCC"> the different</font>

255
00:10:16,530 --> 00:10:21,930
services<font color="#CCCCCC"> and</font><font color="#E5E5E5"> resources and windows are</font>

256
00:10:18,450 --> 00:10:24,870
controlled<font color="#E5E5E5"> yeah</font><font color="#CCCCCC"> you know it treats the</font>

257
00:10:21,930 --> 00:10:26,430
natural<font color="#E5E5E5"> did</font><font color="#CCCCCC"> anyone happens here talked</font>

258
00:10:24,870 --> 00:10:28,710
last year<font color="#E5E5E5"> at Derby on the host base</font>

259
00:10:26,430 --> 00:10:31,170
stuff<font color="#E5E5E5"> a few</font><font color="#CCCCCC"> minutes yeah so we covered</font>

260
00:10:28,710 --> 00:10:32,850
<font color="#E5E5E5">additional like five different backdoor</font>

261
00:10:31,170 --> 00:10:35,010
scenario specifically for host based

262
00:10:32,850 --> 00:10:36,630
<font color="#E5E5E5">activists additionally we've done some</font>

263
00:10:35,010 --> 00:10:38,670
<font color="#E5E5E5">research on the</font><font color="#CCCCCC"> active directory side</font>

264
00:10:36,630 --> 00:10:39,840
that we'll talk<font color="#E5E5E5"> about a bit but so we're</font>

265
00:10:38,670 --> 00:10:41,910
<font color="#E5E5E5">only going to touch on a couple use</font>

266
00:10:39,840 --> 00:10:43,860
<font color="#E5E5E5">cases specifically on the other side but</font>

267
00:10:41,910 --> 00:10:47,459
there's many many many many many many

268
00:10:43,860 --> 00:10:51,690
many more yeah this is<font color="#E5E5E5"> just it's just a</font>

269
00:10:47,460 --> 00:10:53,670
circus<font color="#CCCCCC"> Microsoft's documented a lot of</font>

270
00:10:51,690 --> 00:10:55,560
<font color="#E5E5E5">these secure locks out there and the</font>

271
00:10:53,670 --> 00:10:57,660
documentation<font color="#E5E5E5"> there are roughly 20</font><font color="#CCCCCC"> to 30</font>

272
00:10:55,560 --> 00:11:00,359
of<font color="#E5E5E5"> them through enumeration</font><font color="#CCCCCC"> and we've</font>

273
00:10:57,660 --> 00:11:02,939
identified<font color="#E5E5E5"> over 70 that</font><font color="#CCCCCC"> exist so there's</font>

274
00:11:00,360 --> 00:11:04,410
a lot of<font color="#E5E5E5"> attack surface as</font><font color="#CCCCCC"> far</font><font color="#E5E5E5"> as you</font>

275
00:11:02,940 --> 00:11:07,320
know<font color="#E5E5E5"> different operational components</font>

276
00:11:04,410 --> 00:11:09,180
you<font color="#CCCCCC"> can utilize</font><font color="#E5E5E5"> for RPC server</font>

277
00:11:07,320 --> 00:11:10,830
specifically which is slightly mention a

278
00:11:09,180 --> 00:11:12,300
<font color="#E5E5E5">secured</font><font color="#CCCCCC"> well object if you're</font><font color="#E5E5E5"> going</font><font color="#CCCCCC"> to</font>

279
00:11:10,830 --> 00:11:14,339
utilize<font color="#E5E5E5"> those</font>

280
00:11:12,300 --> 00:11:16,079
you know unless you really<font color="#CCCCCC"> want some</font>

281
00:11:14,339 --> 00:11:18,420
<font color="#CCCCCC">Anaheim reverse engineering Microsoft's</font>

282
00:11:16,080 --> 00:11:19,380
documented<font color="#E5E5E5"> documented most of those RPG</font>

283
00:11:18,420 --> 00:11:21,479
servers for<font color="#CCCCCC"> you</font>

284
00:11:19,380 --> 00:11:22,980
which is really really<font color="#E5E5E5"> nice so we also</font>

285
00:11:21,480 --> 00:11:24,839
<font color="#E5E5E5">has a script called find a registry</font>

286
00:11:22,980 --> 00:11:26,339
security descriptors sitting somewhere

287
00:11:24,839 --> 00:11:27,779
on the<font color="#CCCCCC"> internet don't</font><font color="#E5E5E5"> think it's on a</font>

288
00:11:26,339 --> 00:11:30,000
github<font color="#CCCCCC"> I thought</font><font color="#E5E5E5"> it looks like my cache</font>

289
00:11:27,779 --> 00:11:31,380
website earlier today<font color="#CCCCCC"> so we'll have that</font>

290
00:11:30,000 --> 00:11:32,970
<font color="#E5E5E5">reposted as well ways you can kind of</font>

291
00:11:31,380 --> 00:11:35,130
show you what<font color="#E5E5E5"> it might look like</font><font color="#CCCCCC"> when</font>

292
00:11:32,970 --> 00:11:36,540
you go do it agreed<font color="#CCCCCC"> this has anybody</font>

293
00:11:35,130 --> 00:11:37,670
heard<font color="#E5E5E5"> of</font><font color="#CCCCCC"> it the object manager from</font>

294
00:11:36,540 --> 00:11:40,380
James<font color="#CCCCCC"> Warsaw</font>

295
00:11:37,670 --> 00:11:41,819
so it's a really<font color="#E5E5E5"> great</font><font color="#CCCCCC"> tool to also kind</font>

296
00:11:40,380 --> 00:11:43,709
<font color="#E5E5E5">of doing analyze some of that I don't</font>

297
00:11:41,820 --> 00:11:46,380
<font color="#E5E5E5">like</font><font color="#CCCCCC"> it - of Windows specifically so</font>

298
00:11:43,709 --> 00:11:48,420
<font color="#CCCCCC">this tree descriptor</font><font color="#E5E5E5"> stuff so when</font>

299
00:11:46,380 --> 00:11:50,640
you're using<font color="#E5E5E5"> what we script this is what</font>

300
00:11:48,420 --> 00:11:52,020
the<font color="#E5E5E5"> output</font><font color="#CCCCCC"> looks like</font><font color="#E5E5E5"> so all this does</font>

301
00:11:50,640 --> 00:11:54,180
<font color="#CCCCCC">is it goes</font><font color="#E5E5E5"> through the registry and it</font>

302
00:11:52,020 --> 00:11:56,339
tries to identify any kind<font color="#E5E5E5"> of binary</font>

303
00:11:54,180 --> 00:11:58,620
<font color="#E5E5E5">blobs and that tries</font><font color="#CCCCCC"> to convert that</font>

304
00:11:56,339 --> 00:12:00,209
into<font color="#CCCCCC"> a valid security descriptor and</font>

305
00:11:58,620 --> 00:12:01,890
<font color="#CCCCCC">then output that for you so</font><font color="#E5E5E5"> this will</font>

306
00:12:00,209 --> 00:12:03,180
<font color="#E5E5E5">just kind of show you so many different</font>

307
00:12:01,890 --> 00:12:04,890
<font color="#CCCCCC">objects that are registered</font><font color="#E5E5E5"> in the</font>

308
00:12:03,180 --> 00:12:06,989
registry that<font color="#E5E5E5"> have a security descriptor</font>

309
00:12:04,890 --> 00:12:08,970
applied for them I mean<font color="#E5E5E5"> you can manually</font>

310
00:12:06,990 --> 00:12:13,610
go<font color="#CCCCCC"> through the hundreds of thousands of</font>

311
00:12:08,970 --> 00:12:13,610
results<font color="#CCCCCC"> and derive</font><font color="#E5E5E5"> we run utilize there</font>

312
00:12:13,730 --> 00:12:17,610
so we're talking<font color="#E5E5E5"> about security</font>

313
00:12:15,600 --> 00:12:20,040
descriptors<font color="#E5E5E5"> they're kind of two</font>

314
00:12:17,610 --> 00:12:21,600
<font color="#CCCCCC">different</font><font color="#E5E5E5"> kinds first day so there's</font>

315
00:12:20,040 --> 00:12:25,469
persistent there's kind of<font color="#CCCCCC"> runtime or</font>

316
00:12:21,600 --> 00:12:27,000
dynamic objects any job<font color="#CCCCCC"> data source</font><font color="#E5E5E5"> can</font>

317
00:12:25,470 --> 00:12:29,450
<font color="#E5E5E5">get third security descriptor from a</font>

318
00:12:27,000 --> 00:12:31,740
different place<font color="#CCCCCC"> -</font><font color="#E5E5E5"> just because the RBC's</font>

319
00:12:29,450 --> 00:12:34,620
RPC service has<font color="#E5E5E5"> it security descriptor</font>

320
00:12:31,740 --> 00:12:36,329
applied to it that how its applied might

321
00:12:34,620 --> 00:12:38,459
not be the same for<font color="#CCCCCC"> some</font><font color="#E5E5E5"> other object so</font>

322
00:12:36,329 --> 00:12:39,599
<font color="#E5E5E5">you get persistent objects so a security</font>

323
00:12:38,459 --> 00:12:40,589
descriptor that's applied to<font color="#E5E5E5"> something</font>

324
00:12:39,600 --> 00:12:41,910
<font color="#E5E5E5">like</font><font color="#CCCCCC"> a file</font>

325
00:12:40,589 --> 00:12:43,770
you know you're right click properties

326
00:12:41,910 --> 00:12:45,300
you the<font color="#CCCCCC"> Security tab</font><font color="#E5E5E5"> that says are you</font>

327
00:12:43,770 --> 00:12:47,910
descriptor file

328
00:12:45,300 --> 00:12:49,589
you know the registry etc<font color="#CCCCCC"> a runtime</font>

329
00:12:47,910 --> 00:12:50,939
would kind of applied towards more

330
00:12:49,589 --> 00:12:52,680
dynamic objects and things<font color="#E5E5E5"> like</font>

331
00:12:50,940 --> 00:12:54,240
processes and tokens and<font color="#E5E5E5"> security</font>

332
00:12:52,680 --> 00:12:56,160
descriptors like<font color="#E5E5E5"> they mentioned find</font>

333
00:12:54,240 --> 00:12:58,520
access<font color="#CCCCCC"> to our resource user can have</font>

334
00:12:56,160 --> 00:13:02,819
which more or less defines boundaries

335
00:12:58,520 --> 00:13:04,829
<font color="#E5E5E5">you</font><font color="#CCCCCC"> know for a user</font><font color="#E5E5E5"> as far as what they</font>

336
00:13:02,820 --> 00:13:06,079
can do<font color="#CCCCCC"> so when your numerating these we</font>

337
00:13:04,829 --> 00:13:09,529
typically have<font color="#E5E5E5"> that approach of</font><font color="#CCCCCC"> any</font>

338
00:13:06,079 --> 00:13:11,750
locally normally motivation<font color="#CCCCCC"> I'm free</font>

339
00:13:09,529 --> 00:13:13,610
the reason<font color="#E5E5E5"> for this is</font><font color="#CCCCCC"> because in order</font>

340
00:13:11,750 --> 00:13:16,910
<font color="#E5E5E5">to</font><font color="#CCCCCC"> integrate some components</font>

341
00:13:13,610 --> 00:13:18,769
yeah that's<font color="#CCCCCC"> Victoria bubbles and just</font>

342
00:13:16,910 --> 00:13:21,350
kind of get as much information as<font color="#CCCCCC"> you</font>

343
00:13:18,769 --> 00:13:23,029
can<font color="#E5E5E5"> doing it locally remotely and</font>

344
00:13:21,350 --> 00:13:26,839
<font color="#CCCCCC">privileged</font><font color="#E5E5E5"> not privileged that will be</font>

345
00:13:23,029 --> 00:13:28,910
as<font color="#CCCCCC"> much results so an example of</font><font color="#E5E5E5"> this</font>

346
00:13:26,839 --> 00:13:30,649
<font color="#E5E5E5">remote</font><font color="#CCCCCC"> registering like we will</font>

347
00:13:28,910 --> 00:13:32,899
<font color="#E5E5E5">mentioned we talked about shared there</font>

348
00:13:30,649 --> 00:13:34,910
beyond<font color="#E5E5E5"> makes Lamar do this so just</font><font color="#CCCCCC"> think</font>

349
00:13:32,899 --> 00:13:37,730
of<font color="#E5E5E5"> a scenario will be dumping the game</font>

350
00:13:34,910 --> 00:13:39,319
machines account hash so both of these

351
00:13:37,730 --> 00:13:42,319
are<font color="#CCCCCC"> familiar with that thanks to uh</font>

352
00:13:39,319 --> 00:13:43,519
Benjamin's great work<font color="#CCCCCC"> many others</font><font color="#E5E5E5"> you</font>

353
00:13:42,319 --> 00:13:45,050
can use<font color="#CCCCCC"> that machine account</font><font color="#E5E5E5"> ash do</font>

354
00:13:43,519 --> 00:13:47,750
things like sort tickets<font color="#E5E5E5"> other various</font>

355
00:13:45,050 --> 00:13:49,430
attacks<font color="#E5E5E5"> so this kind of attacker this</font>

356
00:13:47,750 --> 00:13:51,139
kind of<font color="#CCCCCC"> backer</font><font color="#E5E5E5"> person access is gonna</font>

357
00:13:49,430 --> 00:13:53,209
<font color="#CCCCCC">have set up to allow an attacker to</font>

358
00:13:51,139 --> 00:13:54,740
remotely retrieve<font color="#CCCCCC"> I remote computers</font>

359
00:13:53,209 --> 00:13:56,829
machine account hashed without having

360
00:13:54,740 --> 00:14:00,189
any administrative access to that house

361
00:13:56,829 --> 00:14:03,529
<font color="#E5E5E5">administrative</font><font color="#CCCCCC"> due</font><font color="#E5E5E5"> to a very granular</font>

362
00:14:00,189 --> 00:14:04,969
<font color="#CCCCCC">that will</font><font color="#E5E5E5"> change that we've made so the</font>

363
00:14:03,529 --> 00:14:07,639
process for<font color="#CCCCCC"> factoring</font><font color="#E5E5E5"> this would look</font>

364
00:14:04,970 --> 00:14:09,410
<font color="#E5E5E5">something like</font><font color="#CCCCCC"> that similar we're first</font>

365
00:14:07,639 --> 00:14:12,019
done in order<font color="#E5E5E5"> to apply the backdoor</font><font color="#CCCCCC"> you</font>

366
00:14:09,410 --> 00:14:15,050
want a<font color="#CCCCCC"> allow a specific user or group</font><font color="#E5E5E5"> it</font>

367
00:14:12,019 --> 00:14:16,250
<font color="#CCCCCC">doesn't have to be you know one thing</font><font color="#E5E5E5"> or</font>

368
00:14:15,050 --> 00:14:18,620
another<font color="#CCCCCC"> can be</font><font color="#E5E5E5"> you know whatever</font>

369
00:14:16,250 --> 00:14:20,420
whenever<font color="#CCCCCC"> easier</font><font color="#E5E5E5"> account or group oxygen</font>

370
00:14:18,620 --> 00:14:23,120
when I add to it<font color="#E5E5E5"> allowing the user to</font>

371
00:14:20,420 --> 00:14:25,009
remotely access remote registry<font color="#E5E5E5"> so</font>

372
00:14:23,120 --> 00:14:27,560
that's the fine via the<font color="#E5E5E5"> Whitbread should</font>

373
00:14:25,009 --> 00:14:29,870
be in the registry you see<font color="#CCCCCC"> eww my lets</font>

374
00:14:27,560 --> 00:14:34,399
you go<font color="#E5E5E5"> or</font><font color="#CCCCCC"> not that specific user that</font>

375
00:14:29,870 --> 00:14:35,899
<font color="#E5E5E5">you</font><font color="#CCCCCC"> want to be able</font><font color="#E5E5E5"> to access that then</font>

376
00:14:34,399 --> 00:14:38,360
you<font color="#E5E5E5"> just add a few different pieces to</font>

377
00:14:35,899 --> 00:14:40,519
some different<font color="#E5E5E5"> registry hives and keys</font>

378
00:14:38,360 --> 00:14:42,019
that<font color="#E5E5E5"> will allow you</font><font color="#CCCCCC"> to pull</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> whole</font>

379
00:14:40,519 --> 00:14:44,480
<font color="#CCCCCC">back the key material like you need to</font>

380
00:14:42,019 --> 00:14:46,630
<font color="#E5E5E5">calculate and retrieve the</font><font color="#CCCCCC"> Machine</font><font color="#E5E5E5"> house</font>

381
00:14:44,480 --> 00:14:48,889
<font color="#CCCCCC">for</font><font color="#E5E5E5"> that I got in that case we're adding</font>

382
00:14:46,630 --> 00:14:51,500
behind the<font color="#E5E5E5"> security descriptor of the</font>

383
00:14:48,889 --> 00:14:54,259
registry the remote registry service to

384
00:14:51,500 --> 00:14:56,839
allow<font color="#E5E5E5"> us to allow unprivileged user to</font>

385
00:14:54,259 --> 00:15:00,920
get<font color="#E5E5E5"> access</font><font color="#CCCCCC"> to the sensitivity registry</font>

386
00:14:56,839 --> 00:15:02,689
keys so I'm gonna see you need

387
00:15:00,920 --> 00:15:04,370
administrative access or privilege in

388
00:15:02,689 --> 00:15:05,839
the environment to do this given<font color="#CCCCCC"> you</font>

389
00:15:04,370 --> 00:15:08,029
know<font color="#E5E5E5"> it's persistent technique that can</font>

390
00:15:05,839 --> 00:15:09,769
allow<font color="#CCCCCC"> an attacker</font><font color="#E5E5E5"> to say I want for the</font>

391
00:15:08,029 --> 00:15:12,199
exchange<font color="#CCCCCC"> server</font><font color="#E5E5E5"> the domain controller I</font>

392
00:15:09,769 --> 00:15:13,459
want it grant<font color="#CCCCCC"> you</font><font color="#E5E5E5"> know Nancy</font><font color="#CCCCCC"> from HR the</font>

393
00:15:12,199 --> 00:15:14,990
ability to<font color="#E5E5E5"> reach reading this account</font>

394
00:15:13,459 --> 00:15:17,359
hash<font color="#CCCCCC"> for I want</font><font color="#E5E5E5"> every you know</font>

395
00:15:14,990 --> 00:15:18,560
authenticated users or

396
00:15:17,360 --> 00:15:20,510
so if they<font color="#E5E5E5"> get back to the environment</font>

397
00:15:18,560 --> 00:15:22,479
<font color="#CCCCCC">they can immediately you know elevate</font>

398
00:15:20,510 --> 00:15:25,160
back up<font color="#CCCCCC"> there</font>

399
00:15:22,480 --> 00:15:26,779
so once we've added that<font color="#E5E5E5"> back door the</font>

400
00:15:25,160 --> 00:15:29,360
process for<font color="#CCCCCC"> retrieving is it's pretty</font>

401
00:15:26,779 --> 00:15:31,459
<font color="#CCCCCC">straightforward</font><font color="#E5E5E5"> so as that</font><font color="#CCCCCC"> backdoor user</font>

402
00:15:29,360 --> 00:15:35,899
group we're going to connect<font color="#CCCCCC"> to the</font>

403
00:15:31,459 --> 00:15:37,670
remote host<font color="#E5E5E5"> over we're able to do that</font>

404
00:15:35,899 --> 00:15:40,820
<font color="#E5E5E5">because we've added that backdoor</font>

405
00:15:37,670 --> 00:15:42,170
privilege for<font color="#E5E5E5"> that specific user open up</font>

406
00:15:40,820 --> 00:15:43,970
specific<font color="#CCCCCC"> registry keys</font><font color="#E5E5E5"> that are linked</font>

407
00:15:42,170 --> 00:15:46,160
<font color="#CCCCCC">to LSA</font><font color="#E5E5E5"> and extract those classes</font>

408
00:15:43,970 --> 00:15:51,740
<font color="#CCCCCC">combined these classes the values to</font>

409
00:15:46,160 --> 00:15:53,719
calculate<font color="#E5E5E5"> the boot key then we can</font>

410
00:15:51,740 --> 00:15:56,149
finally use the<font color="#CCCCCC"> LSA key to decrypt the</font>

411
00:15:53,720 --> 00:15:57,709
<font color="#E5E5E5">Machine</font><font color="#CCCCCC"> accomplished</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> house so</font>

412
00:15:56,149 --> 00:15:58,790
again we're all able<font color="#E5E5E5"> to do this because</font>

413
00:15:57,709 --> 00:16:00,979
<font color="#E5E5E5">even though the user is not an</font>

414
00:15:58,790 --> 00:16:03,230
administrator<font color="#E5E5E5"> on their emoto's we've</font>

415
00:16:00,980 --> 00:16:04,880
<font color="#E5E5E5">granted these specific user or group the</font>

416
00:16:03,230 --> 00:16:06,680
appropriate permissions<font color="#CCCCCC"> for the</font><font color="#E5E5E5"> doubtful</font>

417
00:16:04,880 --> 00:16:08,480
that<font color="#E5E5E5"> allow</font><font color="#CCCCCC"> us to access</font><font color="#E5E5E5"> this information</font>

418
00:16:06,680 --> 00:16:09,589
<font color="#CCCCCC">does anybody think</font><font color="#E5E5E5"> that they would be</font>

419
00:16:08,480 --> 00:16:12,220
<font color="#CCCCCC">able to</font><font color="#E5E5E5"> see that kind of</font><font color="#CCCCCC"> stay on their</font>

420
00:16:09,589 --> 00:16:12,220
<font color="#CCCCCC">network right now</font>

421
00:16:13,089 --> 00:16:25,190
once that<font color="#E5E5E5"> happens everybody gets a</font>

422
00:16:15,380 --> 00:16:26,720
silver ticket<font color="#E5E5E5"> all right so that</font><font color="#CCCCCC"> was</font><font color="#E5E5E5"> the</font>

423
00:16:25,190 --> 00:16:28,519
host<font color="#E5E5E5"> site and now we're going to talk</font>

424
00:16:26,720 --> 00:16:29,959
<font color="#CCCCCC">about the</font><font color="#E5E5E5"> Active</font><font color="#CCCCCC"> Directory security</font>

425
00:16:28,519 --> 00:16:31,790
descriptor<font color="#E5E5E5"> side then we're going to</font>

426
00:16:29,959 --> 00:16:34,239
combine them together and show how the

427
00:16:31,790 --> 00:16:36,620
system<font color="#CCCCCC"> works kind of holistically so</font>

428
00:16:34,240 --> 00:16:38,300
<font color="#CCCCCC">again all</font><font color="#E5E5E5"> these security descriptors</font><font color="#CCCCCC"> are</font>

429
00:16:36,620 --> 00:16:39,829
just the access control model<font color="#E5E5E5"> Active</font>

430
00:16:38,300 --> 00:16:44,120
Directory needs an<font color="#CCCCCC"> access control</font><font color="#E5E5E5"> model</font>

431
00:16:39,829 --> 00:16:46,339
<font color="#E5E5E5">just like everything else so one really</font>

432
00:16:44,120 --> 00:16:49,040
big<font color="#CCCCCC"> advantage with that</font><font color="#E5E5E5"> directly is that</font>

433
00:16:46,339 --> 00:16:50,949
by default<font color="#E5E5E5"> the dapples for almost every</font>

434
00:16:49,040 --> 00:16:52,339
single<font color="#CCCCCC"> object in Active</font><font color="#E5E5E5"> Directory users</font>

435
00:16:50,949 --> 00:16:55,189
<font color="#E5E5E5">groups</font>

436
00:16:52,339 --> 00:16:57,620
subnets<font color="#E5E5E5"> like Oh use almost everything</font>

437
00:16:55,190 --> 00:17:00,440
<font color="#CCCCCC">can be enumerated by any domain</font>

438
00:16:57,620 --> 00:17:02,240
authenticated user through<font color="#E5E5E5"> all</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> so</font>

439
00:17:00,440 --> 00:17:04,730
you do not have<font color="#CCCCCC"> to be privileged in</font><font color="#E5E5E5"> the</font>

440
00:17:02,240 --> 00:17:06,620
domain<font color="#CCCCCC"> to pull all of the</font><font color="#E5E5E5"> security</font>

441
00:17:04,730 --> 00:17:09,199
descriptor information<font color="#E5E5E5"> for almost every</font>

442
00:17:06,619 --> 00:17:10,159
<font color="#E5E5E5">objects in Active Directory</font><font color="#CCCCCC"> this is</font>

443
00:17:09,199 --> 00:17:12,230
actually something that's<font color="#E5E5E5"> been</font>

444
00:17:10,160 --> 00:17:14,419
integrated<font color="#E5E5E5"> into the bloodhound project</font>

445
00:17:12,230 --> 00:17:16,279
<font color="#E5E5E5">to where you</font><font color="#CCCCCC"> tend to</font><font color="#E5E5E5"> start</font><font color="#CCCCCC"> to map these</font>

446
00:17:14,419 --> 00:17:18,959
permissions of scale

447
00:17:16,279 --> 00:17:21,059
some other<font color="#CCCCCC"> advantages of a</font><font color="#E5E5E5"> backdoor</font>

448
00:17:18,959 --> 00:17:22,919
approach<font color="#E5E5E5"> or</font><font color="#CCCCCC"> muscum</font><font color="#E5E5E5"> miss configuration</font>

449
00:17:21,059 --> 00:17:25,259
approach<font color="#CCCCCC"> or Active Directory with</font><font color="#E5E5E5"> a CLS</font>

450
00:17:22,919 --> 00:17:27,600
<font color="#E5E5E5">as these changes</font><font color="#CCCCCC"> also</font><font color="#E5E5E5"> have a minimal</font>

451
00:17:25,259 --> 00:17:30,239
forensic footprint so<font color="#E5E5E5"> even if people do</font>

452
00:17:27,599 --> 00:17:31,980
<font color="#E5E5E5">find a bad thing</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> know it's bad</font><font color="#CCCCCC"> it's</font>

453
00:17:30,239 --> 00:17:33,779
very<font color="#E5E5E5"> difficult to unless they have</font>

454
00:17:31,980 --> 00:17:35,669
specific event log tuning<font color="#E5E5E5"> them on the</font>

455
00:17:33,779 --> 00:17:37,739
domain controller<font color="#E5E5E5"> where that change was</font>

456
00:17:35,669 --> 00:17:39,570
made<font color="#E5E5E5"> when that change of</font><font color="#CCCCCC"> main it's</font><font color="#E5E5E5"> very</font>

457
00:17:37,739 --> 00:17:42,570
difficult to<font color="#CCCCCC"> figure out who even made</font><font color="#E5E5E5"> to</font>

458
00:17:39,570 --> 00:17:45,330
<font color="#CCCCCC">change or exactly</font><font color="#E5E5E5"> when</font><font color="#CCCCCC"> that change</font><font color="#E5E5E5"> was</font>

459
00:17:42,570 --> 00:17:47,908
made changes in Active Directory for

460
00:17:45,330 --> 00:17:49,559
persistence<font color="#E5E5E5"> also will survive operating</font>

461
00:17:47,909 --> 00:17:52,559
system in domain functional level

462
00:17:49,559 --> 00:17:53,970
<font color="#E5E5E5">upgrades this kind of leads into a term</font>

463
00:17:52,559 --> 00:17:56,249
that<font color="#E5E5E5"> we're kind of calling this</font>

464
00:17:53,970 --> 00:17:58,169
configuration<font color="#CCCCCC"> debt so where if you have</font>

465
00:17:56,249 --> 00:17:59,669
a domain<font color="#E5E5E5"> that's been</font><font color="#CCCCCC"> around for 15 years</font>

466
00:17:58,169 --> 00:18:01,950
and you installed some crappy third

467
00:17:59,669 --> 00:18:03,570
party thing<font color="#CCCCCC"> 13 years ago that added</font>

468
00:18:01,950 --> 00:18:04,859
itself all these permissions and<font color="#E5E5E5"> all</font>

469
00:18:03,570 --> 00:18:07,109
that use all this kind of stuff<font color="#E5E5E5"> in the</font>

470
00:18:04,859 --> 00:18:09,600
access control model<font color="#E5E5E5"> even if you remove</font>

471
00:18:07,109 --> 00:18:11,129
<font color="#CCCCCC">that even if you remove that solution as</font>

472
00:18:09,600 --> 00:18:13,769
your<font color="#CCCCCC"> domain is upgraded many of these</font>

473
00:18:11,129 --> 00:18:15,330
permissions likely still persist so you

474
00:18:13,769 --> 00:18:17,220
just<font color="#E5E5E5"> call this</font><font color="#CCCCCC"> ruffed and things start</font>

475
00:18:15,330 --> 00:18:19,830
<font color="#CCCCCC">to build on each other and we found</font><font color="#E5E5E5"> old</font>

476
00:18:17,220 --> 00:18:22,049
permissions from<font color="#E5E5E5"> you know like 2003 or</font>

477
00:18:19,830 --> 00:18:24,629
something like that<font color="#CCCCCC"> that still</font><font color="#E5E5E5"> exists in</font>

478
00:18:22,049 --> 00:18:26,158
a modern domain also<font color="#CCCCCC"> anti</font><font color="#E5E5E5"> audit measures</font>

479
00:18:24,629 --> 00:18:28,168
can be taken we're not going<font color="#E5E5E5"> to touch on</font>

480
00:18:26,159 --> 00:18:30,869
this really during this presentation<font color="#E5E5E5"> by</font>

481
00:18:28,169 --> 00:18:33,210
a little over<font color="#CCCCCC"> a year ago and get Robin</font>

482
00:18:30,869 --> 00:18:35,189
to<font color="#CCCCCC"> myself</font><font color="#E5E5E5"> David talk hold an ace up the</font>

483
00:18:33,210 --> 00:18:37,769
sleeve and<font color="#E5E5E5"> blackhat of building an</font>

484
00:18:35,190 --> 00:18:39,389
Active Directory<font color="#E5E5E5"> persistent backdoor so</font>

485
00:18:37,769 --> 00:18:41,340
there's ways<font color="#CCCCCC"> that you can actually</font>

486
00:18:39,389 --> 00:18:42,840
prevent like domain admins from<font color="#CCCCCC"> the</font>

487
00:18:41,340 --> 00:18:44,609
numerating the secure<font color="#E5E5E5"> descriptor</font>

488
00:18:42,840 --> 00:18:47,189
<font color="#CCCCCC">information for specific objects are</font>

489
00:18:44,609 --> 00:18:50,009
<font color="#CCCCCC">hiding principles so even if people</font><font color="#E5E5E5"> find</font>

490
00:18:47,190 --> 00:18:53,399
<font color="#E5E5E5">me the bad intrigue</font><font color="#CCCCCC"> no it's bad no it's</font>

491
00:18:50,009 --> 00:18:55,440
not a accidental miss configuration you

492
00:18:53,399 --> 00:18:57,090
can actually<font color="#E5E5E5"> like take anti audit</font>

493
00:18:55,440 --> 00:18:57,960
measures to mess with blue<font color="#CCCCCC"> teamers</font>

494
00:18:57,090 --> 00:18:59,759
<font color="#E5E5E5">anymore</font>

495
00:18:57,960 --> 00:19:02,129
that was us<font color="#E5E5E5"> trying to go to evil as</font>

496
00:18:59,759 --> 00:19:03,809
possible so this<font color="#E5E5E5"> is the graphical</font>

497
00:19:02,129 --> 00:19:05,158
<font color="#E5E5E5">representation</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> all a security</font>

498
00:19:03,809 --> 00:19:07,230
<font color="#CCCCCC">scriptures software</font><font color="#E5E5E5"> active directory</font><font color="#CCCCCC"> and</font>

499
00:19:05,159 --> 00:19:09,600
a dunk<font color="#CCCCCC"> so we have permission</font><font color="#E5E5E5"> entry for</font>

500
00:19:07,230 --> 00:19:10,889
victim user says the victim objects we

501
00:19:09,600 --> 00:19:13,139
have<font color="#E5E5E5"> the principles and there's the</font>

502
00:19:10,889 --> 00:19:14,459
personality rights<font color="#CCCCCC"> we see there's a</font>

503
00:19:13,139 --> 00:19:15,748
whole<font color="#E5E5E5"> bunch of different rights</font><font color="#CCCCCC"> some the</font>

504
00:19:14,460 --> 00:19:18,029
ones who care<font color="#E5E5E5"> about or like modify</font>

505
00:19:15,749 --> 00:19:19,499
permissions great<font color="#E5E5E5"> yourself anything you</font>

506
00:19:18,029 --> 00:19:21,119
want to modify<font color="#E5E5E5"> the owner because they</font>

507
00:19:19,499 --> 00:19:24,029
have full control<font color="#E5E5E5"> force reset the</font>

508
00:19:21,119 --> 00:19:25,149
password<font color="#CCCCCC"> lost</font><font color="#E5E5E5"> notes</font><font color="#CCCCCC"> time so what Bracy</font>

509
00:19:24,029 --> 00:19:27,490
care about

510
00:19:25,150 --> 00:19:29,680
in the white paper<font color="#E5E5E5"> that's on our site</font>

511
00:19:27,490 --> 00:19:31,480
along<font color="#CCCCCC"> with that was in correlation with</font>

512
00:19:29,680 --> 00:19:33,190
the base of<font color="#CCCCCC"> the sleeve talk</font><font color="#E5E5E5"> we have like</font>

513
00:19:31,480 --> 00:19:34,630
a 60 page<font color="#CCCCCC"> active directory</font><font color="#E5E5E5"> the only</font>

514
00:19:33,190 --> 00:19:36,400
security<font color="#E5E5E5"> script or white paper</font><font color="#CCCCCC"> that</font>

515
00:19:34,630 --> 00:19:37,960
covers<font color="#E5E5E5"> all these more depth but in</font>

516
00:19:36,400 --> 00:19:40,840
<font color="#E5E5E5">general we care</font><font color="#CCCCCC"> about the generic</font><font color="#E5E5E5"> call</font>

517
00:19:37,960 --> 00:19:42,490
rate<font color="#E5E5E5"> experience</font><font color="#CCCCCC"> generates the object</font><font color="#E5E5E5"> the</font>

518
00:19:40,840 --> 00:19:44,409
generic<font color="#E5E5E5"> write object which allows for</font>

519
00:19:42,490 --> 00:19:47,860
modifications of almost all properties

520
00:19:44,410 --> 00:19:49,450
of a specified object right tackle which

521
00:19:47,860 --> 00:19:50,800
you don't have the ability<font color="#CCCCCC"> to like force</font>

522
00:19:49,450 --> 00:19:52,120
to reset someone's password<font color="#E5E5E5"> but you'd</font>

523
00:19:50,800 --> 00:19:54,580
ability to create yourself<font color="#CCCCCC"> the ability</font>

524
00:19:52,120 --> 00:19:56,979
<font color="#E5E5E5">before you</font><font color="#CCCCCC"> send</font><font color="#E5E5E5"> someone answered or</font>

525
00:19:54,580 --> 00:19:58,809
right motor so if all<font color="#CCCCCC"> you have is</font><font color="#E5E5E5"> right</font>

526
00:19:56,980 --> 00:20:00,280
<font color="#E5E5E5">number you can just modify the owner of</font>

527
00:19:58,809 --> 00:20:04,450
<font color="#E5E5E5">that object to yourself</font><font color="#CCCCCC"> then you have</font>

528
00:20:00,280 --> 00:20:06,340
full<font color="#E5E5E5"> control object specific rights you</font>

529
00:20:04,450 --> 00:20:07,840
care<font color="#E5E5E5"> about this is not complete somewhat</font>

530
00:20:06,340 --> 00:20:10,449
abbreviated there's a couple<font color="#E5E5E5"> new ones we</font>

531
00:20:07,840 --> 00:20:11,889
<font color="#E5E5E5">have my</font><font color="#CCCCCC"> own</font><font color="#E5E5E5"> stuff but</font><font color="#CCCCCC"> for users we</font>

532
00:20:10,450 --> 00:20:13,540
genuinely care<font color="#CCCCCC"> about the force reset</font>

533
00:20:11,890 --> 00:20:14,740
<font color="#CCCCCC">password' great so can</font><font color="#E5E5E5"> we reset the</font>

534
00:20:13,540 --> 00:20:16,899
password<font color="#E5E5E5"> without moving the previous</font>

535
00:20:14,740 --> 00:20:18,400
value or can we modify<font color="#E5E5E5"> the service</font>

536
00:20:16,900 --> 00:20:20,440
<font color="#CCCCCC">principle name so we can do targeted</font>

537
00:20:18,400 --> 00:20:23,260
Kerberos<font color="#CCCCCC"> T same SPN Kerberos beam</font>

538
00:20:20,440 --> 00:20:24,580
<font color="#CCCCCC">resubmit for groups can we modify the</font>

539
00:20:23,260 --> 00:20:26,620
member property<font color="#CCCCCC"> and modify group</font>

540
00:20:24,580 --> 00:20:28,659
membership for computers we actually

541
00:20:26,620 --> 00:20:30,550
don't<font color="#E5E5E5"> have a generic PCL based or</font>

542
00:20:28,660 --> 00:20:32,590
<font color="#CCCCCC">database takeover primitive yet</font><font color="#E5E5E5"> outside</font>

543
00:20:30,550 --> 00:20:35,980
<font color="#E5E5E5">of maps</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> you have the</font><font color="#CCCCCC"> ability to</font><font color="#E5E5E5"> like</font>

544
00:20:32,590 --> 00:20:37,870
grant somebody<font color="#E5E5E5"> the ability to read the</font>

545
00:20:35,980 --> 00:20:39,160
<font color="#CCCCCC">Lapps password as a backdoor but outside</font>

546
00:20:37,870 --> 00:20:42,639
of that we don't<font color="#E5E5E5"> have engineering</font><font color="#CCCCCC"> take</font>

547
00:20:39,160 --> 00:20:44,890
<font color="#E5E5E5">over 40</font><font color="#CCCCCC"> PIOs we care can someone modify</font>

548
00:20:42,640 --> 00:20:46,960
the GPC<font color="#E5E5E5"> file set path so</font><font color="#CCCCCC"> today the</font>

549
00:20:44,890 --> 00:20:49,570
<font color="#E5E5E5">ability</font><font color="#CCCCCC"> to edit the gpo files on sis</font>

550
00:20:46,960 --> 00:20:51,970
<font color="#E5E5E5">ball and for domain is the domain object</font>

551
00:20:49,570 --> 00:20:53,889
itself which is a securable object<font color="#E5E5E5"> if</font>

552
00:20:51,970 --> 00:20:55,780
you have you write<font color="#CCCCCC"> DAC or generic</font><font color="#E5E5E5"> all</font>

553
00:20:53,890 --> 00:20:59,980
ability over<font color="#E5E5E5"> the root domain object you</font>

554
00:20:55,780 --> 00:21:00,730
can grant<font color="#CCCCCC"> yourself</font><font color="#E5E5E5"> at TCC and grits so I</font>

555
00:20:59,980 --> 00:21:03,820
was a<font color="#E5E5E5"> grateful</font>

556
00:21:00,730 --> 00:21:05,740
<font color="#CCCCCC">Abbie's an exchange exchange</font><font color="#E5E5E5"> server it</font>

557
00:21:03,820 --> 00:21:08,678
is<font color="#E5E5E5"> one</font><font color="#CCCCCC"> of the worst perpetrators of</font>

558
00:21:05,740 --> 00:21:10,720
really messed up ACL base<font color="#CCCCCC"> configurations</font>

559
00:21:08,679 --> 00:21:12,610
or at least it was newer<font color="#E5E5E5"> versions of</font>

560
00:21:10,720 --> 00:21:14,080
exchange have cleaned this up on

561
00:21:12,610 --> 00:21:16,000
previous<font color="#CCCCCC"> versions of exchanges would</font>

562
00:21:14,080 --> 00:21:18,460
just create<font color="#E5E5E5"> itself</font><font color="#CCCCCC"> ten million writes</font>

563
00:21:16,000 --> 00:21:20,200
all<font color="#E5E5E5"> over the domain and again because</font>

564
00:21:18,460 --> 00:21:22,840
you<font color="#E5E5E5"> know even if the domain</font><font color="#CCCCCC"> is upgraded</font>

565
00:21:20,200 --> 00:21:24,820
or exchange is upgraded things don't go

566
00:21:22,840 --> 00:21:26,020
back<font color="#CCCCCC"> in and rip out the old ACL rights</font>

567
00:21:24,820 --> 00:21:27,820
because people don't want<font color="#CCCCCC"> to break stuff</font>

568
00:21:26,020 --> 00:21:28,929
<font color="#E5E5E5">so if you had</font><font color="#CCCCCC"> everage installed</font><font color="#E5E5E5"> the</font>

569
00:21:27,820 --> 00:21:29,439
<font color="#E5E5E5">whole version</font><font color="#CCCCCC"> of exchange</font><font color="#E5E5E5"> in your</font>

570
00:21:28,929 --> 00:21:31,420
environment

571
00:21:29,440 --> 00:21:34,840
those bad misconfigurations<font color="#CCCCCC"> are</font><font color="#E5E5E5"> probably</font>

572
00:21:31,420 --> 00:21:36,670
still there son of ton of stuff so this

573
00:21:34,840 --> 00:21:39,790
<font color="#E5E5E5">makes it a perfect spot for</font><font color="#CCCCCC"> us to</font><font color="#E5E5E5"> land</font>

574
00:21:36,670 --> 00:21:44,710
within<font color="#E5E5E5"> the noise so specifically pretty</font>

575
00:21:39,790 --> 00:21:47,230
change<font color="#CCCCCC"> server 2007 sp1</font><font color="#E5E5E5"> exchange granted</font>

576
00:21:44,710 --> 00:21:49,870
the right<font color="#CCCCCC"> deck</font><font color="#E5E5E5"> and privilege against the</font>

577
00:21:47,230 --> 00:21:51,970
domain<font color="#E5E5E5"> and object itself for the</font>

578
00:21:49,870 --> 00:21:54,070
exchange<font color="#E5E5E5"> trusted subsystem group so this</font>

579
00:21:51,970 --> 00:21:56,590
<font color="#E5E5E5">is a group that</font><font color="#CCCCCC"> all exchange servers</font><font color="#E5E5E5"> are</font>

580
00:21:54,070 --> 00:21:58,840
<font color="#CCCCCC">member of</font><font color="#E5E5E5"> and that group has the ability</font>

581
00:21:56,590 --> 00:22:02,350
to<font color="#E5E5E5"> modify the ECL information</font><font color="#CCCCCC"> of a group</font>

582
00:21:58,840 --> 00:22:04,060
<font color="#CCCCCC">the main</font><font color="#E5E5E5"> object so just as a pin</font><font color="#CCCCCC"> test my</font>

583
00:22:02,350 --> 00:22:05,949
<font color="#E5E5E5">guess is you have a compromise and</font>

584
00:22:04,060 --> 00:22:07,960
<font color="#E5E5E5">exchange server you elevate the system</font>

585
00:22:05,950 --> 00:22:10,480
the system is<font color="#E5E5E5"> going to use the</font><font color="#CCCCCC"> machine</font>

586
00:22:07,960 --> 00:22:11,800
account<font color="#CCCCCC"> hash provisions of the</font><font color="#E5E5E5"> machine</font>

587
00:22:10,480 --> 00:22:13,600
account permissions when<font color="#E5E5E5"> it's</font>

588
00:22:11,800 --> 00:22:15,010
communicate on the network<font color="#E5E5E5"> you should</font><font color="#CCCCCC"> be</font>

589
00:22:13,600 --> 00:22:16,990
<font color="#CCCCCC">able</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> grant</font><font color="#E5E5E5"> anyone</font><font color="#CCCCCC"> you want the</font>

590
00:22:15,010 --> 00:22:19,210
ability to<font color="#CCCCCC"> TCC income debate</font><font color="#E5E5E5"> so yours</font>

591
00:22:16,990 --> 00:22:22,710
will<font color="#E5E5E5"> not wait just an</font><font color="#CCCCCC"> example</font><font color="#E5E5E5"> and we</font>

592
00:22:19,210 --> 00:22:22,710
<font color="#CCCCCC">have a case study</font><font color="#E5E5E5"> that will go into</font><font color="#CCCCCC"> that</font>

593
00:22:24,030 --> 00:22:28,450
so we've talked a little bit about on

594
00:22:26,560 --> 00:22:30,280
the host side<font color="#E5E5E5"> you know</font><font color="#CCCCCC"> that we have</font>

595
00:22:28,450 --> 00:22:32,320
these<font color="#CCCCCC"> different services</font><font color="#E5E5E5"> we can</font><font color="#CCCCCC"> interact</font>

596
00:22:30,280 --> 00:22:33,940
with<font color="#CCCCCC"> that we've also talked about</font><font color="#E5E5E5"> how we</font>

597
00:22:32,320 --> 00:22:35,530
have<font color="#E5E5E5"> active directory you have Active</font>

598
00:22:33,940 --> 00:22:40,330
Directory objects that we<font color="#E5E5E5"> can also</font>

599
00:22:35,530 --> 00:22:41,980
interact<font color="#E5E5E5"> with why this is interesting is</font>

600
00:22:40,330 --> 00:22:44,050
because when you start combining those

601
00:22:41,980 --> 00:22:47,440
two separate kind of disparate systems

602
00:22:44,050 --> 00:22:49,030
<font color="#E5E5E5">together you start introducing a bunch</font>

603
00:22:47,440 --> 00:22:51,550
of different risks inside of the

604
00:22:49,030 --> 00:22:54,720
environment so<font color="#E5E5E5"> let's say you have an</font>

605
00:22:51,550 --> 00:22:56,860
individual host<font color="#E5E5E5"> not joined to the domain</font>

606
00:22:54,720 --> 00:23:00,010
you know that's a pretty<font color="#E5E5E5"> secure host</font>

607
00:22:56,860 --> 00:23:02,889
<font color="#E5E5E5">because it's in control of what can</font>

608
00:23:00,010 --> 00:23:04,990
access that machine<font color="#E5E5E5"> so it can define you</font>

609
00:23:02,890 --> 00:23:07,270
know<font color="#E5E5E5"> who controls access to the service</font>

610
00:23:04,990 --> 00:23:10,120
<font color="#E5E5E5">Control Manager remotely it can say to</font>

611
00:23:07,270 --> 00:23:14,110
who<font color="#CCCCCC"> access is like W my kind of thing</font>

612
00:23:10,120 --> 00:23:17,679
<font color="#CCCCCC">that</font><font color="#E5E5E5"> host itself is solely in control of</font>

613
00:23:14,110 --> 00:23:19,959
itself after a machine is joined to

614
00:23:17,680 --> 00:23:23,440
<font color="#E5E5E5">Active Directory however this control</font>

615
00:23:19,960 --> 00:23:25,660
model changes so the machine itself is

616
00:23:23,440 --> 00:23:27,850
no<font color="#CCCCCC"> longer in charge</font><font color="#E5E5E5"> of authentication so</font>

617
00:23:25,660 --> 00:23:29,890
an individual host by default is<font color="#E5E5E5"> going</font>

618
00:23:27,850 --> 00:23:32,290
to be using<font color="#E5E5E5"> like this ham database for</font>

619
00:23:29,890 --> 00:23:35,560
authentication<font color="#E5E5E5"> and using like ntlm</font>

620
00:23:32,290 --> 00:23:37,540
underneath her authentication<font color="#CCCCCC"> after you</font>

621
00:23:35,560 --> 00:23:38,940
join Active Directory that changes her

622
00:23:37,540 --> 00:23:40,950
rose and the

623
00:23:38,940 --> 00:23:43,020
<font color="#CCCCCC">Toller get thrown into the situation and</font>

624
00:23:40,950 --> 00:23:46,860
that machine<font color="#CCCCCC"> isn't the sole</font>

625
00:23:43,020 --> 00:23:48,450
authentication provider<font color="#E5E5E5"> that limits you</font>

626
00:23:46,860 --> 00:23:50,760
know<font color="#CCCCCC"> a variety</font><font color="#E5E5E5"> of different attacks like</font>

627
00:23:48,450 --> 00:23:52,710
silver tickets and golden tickets<font color="#E5E5E5"> which</font>

628
00:23:50,760 --> 00:23:57,120
gate which can allow an attacker access

629
00:23:52,710 --> 00:24:00,110
to the system likewise<font color="#E5E5E5"> key material is</font>

630
00:23:57,120 --> 00:24:03,780
no longer stored solely on<font color="#CCCCCC"> that</font>

631
00:24:00,110 --> 00:24:06,330
individual<font color="#E5E5E5"> host so for example if it's</font>

632
00:24:03,780 --> 00:24:08,120
<font color="#CCCCCC">the</font><font color="#E5E5E5"> host is just isolated by itself all</font>

633
00:24:06,330 --> 00:24:10,860
the<font color="#CCCCCC"> passwords are in the Sam</font><font color="#E5E5E5"> database</font>

634
00:24:08,120 --> 00:24:13,020
<font color="#E5E5E5">and if an attacker attacks another</font>

635
00:24:10,860 --> 00:24:14,909
machine<font color="#E5E5E5"> on the network they're not going</font>

636
00:24:13,020 --> 00:24:16,740
to<font color="#E5E5E5"> be able to meaningly access this</font>

637
00:24:14,910 --> 00:24:18,800
individual<font color="#CCCCCC"> host</font><font color="#E5E5E5"> because all the</font>

638
00:24:16,740 --> 00:24:20,790
passwords<font color="#E5E5E5"> are stored on that</font><font color="#CCCCCC"> toast</font><font color="#E5E5E5"> only</font>

639
00:24:18,800 --> 00:24:22,649
after you join Active Directory that

640
00:24:20,790 --> 00:24:25,590
changes<font color="#CCCCCC"> the domain controller has</font>

641
00:24:22,650 --> 00:24:27,840
passwords in it<font color="#E5E5E5"> certificate authority</font><font color="#CCCCCC"> CA</font>

642
00:24:25,590 --> 00:24:29,610
<font color="#E5E5E5">servers have some info</font><font color="#CCCCCC"> you know your</font>

643
00:24:27,840 --> 00:24:33,260
<font color="#E5E5E5">Federation services may have some stuff</font>

644
00:24:29,610 --> 00:24:35,280
all these things may end up allowing

645
00:24:33,260 --> 00:24:37,260
compromising those machines may grant

646
00:24:35,280 --> 00:24:41,210
<font color="#E5E5E5">you access to this individual</font><font color="#CCCCCC"> host</font><font color="#E5E5E5"> now</font>

647
00:24:37,260 --> 00:24:41,210
that since<font color="#CCCCCC"> it's joined to the domain</font>

648
00:24:41,300 --> 00:24:45,570
<font color="#CCCCCC">likewise</font><font color="#E5E5E5"> that individual host is no</font>

649
00:24:43,920 --> 00:24:49,140
longer<font color="#E5E5E5"> control of its own security</font>

650
00:24:45,570 --> 00:24:51,840
groups anymore so<font color="#E5E5E5"> by default</font><font color="#CCCCCC"> when you</font>

651
00:24:49,140 --> 00:24:53,610
join a machine<font color="#E5E5E5"> to Active Directory the</font>

652
00:24:51,840 --> 00:24:56,040
domain administrators<font color="#E5E5E5"> group is added to</font>

653
00:24:53,610 --> 00:24:57,959
the local administrators group<font color="#CCCCCC"> so now</font>

654
00:24:56,040 --> 00:25:01,260
<font color="#E5E5E5">you have these other groups in the</font>

655
00:24:57,960 --> 00:25:03,510
domain that<font color="#CCCCCC"> can</font><font color="#E5E5E5"> now access this machine</font>

656
00:25:01,260 --> 00:25:05,850
<font color="#E5E5E5">those groups may have other groups and</font>

657
00:25:03,510 --> 00:25:08,760
<font color="#E5E5E5">other users in it and so now</font><font color="#CCCCCC"> all</font><font color="#E5E5E5"> those</font>

658
00:25:05,850 --> 00:25:13,919
<font color="#CCCCCC">people are implicitly trusted</font><font color="#E5E5E5"> to access</font>

659
00:25:08,760 --> 00:25:16,200
this machine likewise<font color="#E5E5E5"> management of that</font>

660
00:25:13,920 --> 00:25:18,510
<font color="#E5E5E5">machine is no longer to that individual</font>

661
00:25:16,200 --> 00:25:20,490
<font color="#CCCCCC">host</font><font color="#E5E5E5"> anymore before if it was just one</font>

662
00:25:18,510 --> 00:25:22,290
host by itself you<font color="#E5E5E5"> log in you know</font><font color="#CCCCCC"> just</font>

663
00:25:20,490 --> 00:25:24,540
the GUI<font color="#E5E5E5"> use whatever you want</font>

664
00:25:22,290 --> 00:25:26,520
configure the<font color="#CCCCCC"> host once</font><font color="#E5E5E5"> it's join to</font>

665
00:25:24,540 --> 00:25:28,980
Active Directory however you bring in

666
00:25:26,520 --> 00:25:31,740
other<font color="#CCCCCC"> management solutions such as</font><font color="#E5E5E5"> group</font>

667
00:25:28,980 --> 00:25:33,300
<font color="#E5E5E5">policy so now there's other things in</font>

668
00:25:31,740 --> 00:25:35,220
the network and<font color="#CCCCCC"> in the domain that are</font>

669
00:25:33,300 --> 00:25:37,470
<font color="#E5E5E5">going to be influencing how this host</font>

670
00:25:35,220 --> 00:25:39,580
<font color="#E5E5E5">functions and is configured and it may</font>

671
00:25:37,470 --> 00:25:46,630
result in<font color="#CCCCCC"> on</font>

672
00:25:39,580 --> 00:25:48,189
<font color="#CCCCCC">and access</font><font color="#E5E5E5"> to this host so how does this</font>

673
00:25:46,630 --> 00:25:50,620
<font color="#E5E5E5">look</font><font color="#CCCCCC"> again</font><font color="#E5E5E5"> just a different way to</font>

674
00:25:48,190 --> 00:25:52,660
looking at that<font color="#E5E5E5"> so when you're in a</font>

675
00:25:50,620 --> 00:25:54,580
<font color="#CCCCCC">workgroup so just that isolated computer</font>

676
00:25:52,660 --> 00:25:56,200
by<font color="#CCCCCC"> itself</font><font color="#E5E5E5"> you have local users and</font>

677
00:25:54,580 --> 00:26:00,010
groups<font color="#E5E5E5"> only those are the only security</font>

678
00:25:56,200 --> 00:26:01,900
principles<font color="#CCCCCC"> you have</font><font color="#E5E5E5"> how do you control</font>

679
00:26:00,010 --> 00:26:03,820
access to<font color="#E5E5E5"> that</font><font color="#CCCCCC"> machine and that's based</font>

680
00:26:01,900 --> 00:26:05,800
off of<font color="#E5E5E5"> host-based security descriptors</font>

681
00:26:03,820 --> 00:26:07,810
so we can<font color="#E5E5E5"> change like the W my service</font>

682
00:26:05,800 --> 00:26:10,300
the<font color="#E5E5E5"> service Control Manager individually</font>

683
00:26:07,810 --> 00:26:13,090
and grant<font color="#CCCCCC"> other local users and groups</font>

684
00:26:10,300 --> 00:26:17,379
to<font color="#E5E5E5"> those services authentication is</font>

685
00:26:13,090 --> 00:26:20,020
through the Sam database like ntlm or LM

686
00:26:17,380 --> 00:26:22,870
and then how is it<font color="#E5E5E5"> Howard</font><font color="#CCCCCC"> how is</font><font color="#E5E5E5"> that</font>

687
00:26:20,020 --> 00:26:25,450
<font color="#CCCCCC">Reis resource administer or configured</font>

688
00:26:22,870 --> 00:26:27,429
<font color="#E5E5E5">actually that's like a manual process or</font>

689
00:26:25,450 --> 00:26:28,990
you know you may have<font color="#CCCCCC"> like</font><font color="#E5E5E5"> Simmons like</font>

690
00:26:27,430 --> 00:26:31,060
<font color="#CCCCCC">PowerShell scripts on the machine that</font>

691
00:26:28,990 --> 00:26:34,420
<font color="#E5E5E5">can that configure the object or the</font>

692
00:26:31,060 --> 00:26:36,879
coast however once you join<font color="#CCCCCC"> that machine</font>

693
00:26:34,420 --> 00:26:41,230
to<font color="#CCCCCC"> Active Directory</font><font color="#E5E5E5"> this entire model is</font>

694
00:26:36,880 --> 00:26:43,530
expanded<font color="#E5E5E5"> which could result in some</font>

695
00:26:41,230 --> 00:26:45,970
unintended consequences<font color="#CCCCCC"> so now you have</font>

696
00:26:43,530 --> 00:26:48,310
in terms<font color="#E5E5E5"> of security principles you now</font>

697
00:26:45,970 --> 00:26:51,220
have domain users and groups being<font color="#CCCCCC"> added</font>

698
00:26:48,310 --> 00:26:53,679
who have control<font color="#CCCCCC"> to this machine</font><font color="#E5E5E5"> now in</font>

699
00:26:51,220 --> 00:26:54,070
terms of access<font color="#E5E5E5"> granting access to this</font>

700
00:26:53,680 --> 00:26:56,950
machine

701
00:26:54,070 --> 00:26:58,929
those same<font color="#CCCCCC"> domain groups may be</font>

702
00:26:56,950 --> 00:27:01,540
controlled by other people in<font color="#E5E5E5"> the</font>

703
00:26:58,930 --> 00:27:03,640
environment<font color="#CCCCCC"> so</font><font color="#E5E5E5"> you may add a group to</font>

704
00:27:01,540 --> 00:27:06,040
<font color="#E5E5E5">the local</font><font color="#CCCCCC"> administrators group and then</font>

705
00:27:03,640 --> 00:27:07,390
<font color="#E5E5E5">you know a random IT administrator and a</font>

706
00:27:06,040 --> 00:27:10,540
different part<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the network may start</font>

707
00:27:07,390 --> 00:27:12,730
adding users to<font color="#E5E5E5"> that group that you</font>

708
00:27:10,540 --> 00:27:14,260
<font color="#E5E5E5">never intended those users that</font><font color="#CCCCCC"> were</font>

709
00:27:12,730 --> 00:27:17,770
added<font color="#CCCCCC"> were never intended to gain access</font>

710
00:27:14,260 --> 00:27:19,300
to your individual<font color="#E5E5E5"> hosts in addition you</font>

711
00:27:17,770 --> 00:27:21,190
have different authentication mechanisms

712
00:27:19,300 --> 00:27:23,100
that<font color="#E5E5E5"> can now be used to</font><font color="#CCCCCC"> access the hosts</font>

713
00:27:21,190 --> 00:27:27,070
<font color="#CCCCCC">beyond just like</font><font color="#E5E5E5"> the Sam database</font>

714
00:27:23,100 --> 00:27:29,439
<font color="#E5E5E5">Kerberos</font><font color="#CCCCCC"> ends</font><font color="#E5E5E5"> um those include different</font>

715
00:27:27,070 --> 00:27:31,560
keys that<font color="#CCCCCC"> you can access to gain</font><font color="#E5E5E5"> access</font>

716
00:27:29,440 --> 00:27:33,760
to this individual<font color="#CCCCCC"> hosts and</font>

717
00:27:31,560 --> 00:27:35,919
configuration is now changed because

718
00:27:33,760 --> 00:27:40,980
<font color="#CCCCCC">yeah you have things like GPOs that can</font>

719
00:27:35,920 --> 00:27:40,980
be abused<font color="#CCCCCC"> to configure</font><font color="#E5E5E5"> those</font>

720
00:27:41,960 --> 00:27:46,100
<font color="#E5E5E5">all right same thing graphically Henry</font>

721
00:27:44,899 --> 00:27:48,168
the<font color="#E5E5E5"> appointment</font><font color="#CCCCCC"> so we have</font><font color="#E5E5E5"> our single</font>

722
00:27:46,100 --> 00:27:49,580
<font color="#E5E5E5">host again there's a million different</font>

723
00:27:48,169 --> 00:27:52,190
services on it we're going<font color="#E5E5E5"> to</font><font color="#CCCCCC"> focus just</font>

724
00:27:49,580 --> 00:27:54,320
<font color="#E5E5E5">on D columns</font><font color="#CCCCCC"> austerity to come we have a</font>

725
00:27:52,190 --> 00:27:55,820
<font color="#E5E5E5">local user without Ben there's a local</font>

726
00:27:54,320 --> 00:27:57,908
administrators group<font color="#E5E5E5"> and</font><font color="#CCCCCC"> distribute</font>

727
00:27:55,820 --> 00:28:00,110
computer<font color="#E5E5E5"> security</font><font color="#CCCCCC"> it's just by default</font>

728
00:27:57,909 --> 00:28:03,259
<font color="#E5E5E5">so I would say this</font><font color="#CCCCCC"> advant is a member</font>

729
00:28:00,110 --> 00:28:04,758
of<font color="#E5E5E5"> local admins and give an MTA to</font><font color="#CCCCCC"> calm</font>

730
00:28:03,259 --> 00:28:06,799
you this group those have the ability<font color="#CCCCCC"> to</font>

731
00:28:04,759 --> 00:28:09,980
invoke<font color="#E5E5E5"> the stream to calm objects on the</font>

732
00:28:06,799 --> 00:28:13,070
system<font color="#CCCCCC"> ok relatively secure you know</font>

733
00:28:09,980 --> 00:28:15,320
<font color="#E5E5E5">randomize</font><font color="#CCCCCC"> an investor in</font><font color="#E5E5E5"> Paraguay so</font>

734
00:28:13,070 --> 00:28:17,090
then we have<font color="#E5E5E5"> her to me you have</font>

735
00:28:15,320 --> 00:28:18,918
<font color="#E5E5E5">different users groups machines people</font>

736
00:28:17,090 --> 00:28:21,980
<font color="#E5E5E5">logged in and this is essentially you</font>

737
00:28:18,919 --> 00:28:24,379
know that<font color="#E5E5E5"> bloodhound style</font><font color="#CCCCCC"> attacker</font><font color="#E5E5E5"> so</font>

738
00:28:21,980 --> 00:28:26,259
you can have domain users nested in

739
00:28:24,379 --> 00:28:29,918
additional<font color="#CCCCCC"> group so you domain admins</font>

740
00:28:26,259 --> 00:28:32,210
and say<font color="#E5E5E5"> this machine is joined to</font><font color="#CCCCCC"> AD</font>

741
00:28:29,919 --> 00:28:33,860
<font color="#E5E5E5">might default domain admins are going to</font>

742
00:28:32,210 --> 00:28:35,629
have into the local admins group<font color="#E5E5E5"> so now</font>

743
00:28:33,860 --> 00:28:37,729
<font color="#CCCCCC">we have lead the</font><font color="#E5E5E5"> man</font><font color="#CCCCCC"> happens everyone</font>

744
00:28:35,629 --> 00:28:40,820
<font color="#E5E5E5">else that can invoke distributed</font><font color="#CCCCCC"> calm</font>

745
00:28:37,730 --> 00:28:42,590
objects you can also have individual

746
00:28:40,820 --> 00:28:44,389
domain users<font color="#CCCCCC"> other principles that can</font>

747
00:28:42,590 --> 00:28:47,090
<font color="#E5E5E5">be manually added and whether through</font>

748
00:28:44,389 --> 00:28:49,189
some<font color="#CCCCCC"> third-party software or maliciously</font>

749
00:28:47,090 --> 00:28:50,869
<font color="#E5E5E5">or whatever</font><font color="#CCCCCC"> do things like to disturb</font>

750
00:28:49,190 --> 00:28:52,909
<font color="#E5E5E5">calm users group so now this person</font><font color="#CCCCCC"> has</font>

751
00:28:50,869 --> 00:28:54,619
<font color="#CCCCCC">the ability to invoke</font><font color="#E5E5E5"> distribute objects</font>

752
00:28:52,909 --> 00:28:56,539
and get<font color="#E5E5E5"> code execution in their own</font>

753
00:28:54,619 --> 00:29:00,230
system<font color="#E5E5E5"> even though they are not in local</font>

754
00:28:56,539 --> 00:29:03,710
admins you also have all the inbound

755
00:29:00,230 --> 00:29:06,110
<font color="#E5E5E5">control attack</font><font color="#CCCCCC"> pass to like all these</font>

756
00:29:03,710 --> 00:29:07,549
users<font color="#E5E5E5"> and</font><font color="#CCCCCC"> groups as</font><font color="#E5E5E5"> well so this</font><font color="#CCCCCC"> is all</font>

757
00:29:06,110 --> 00:29:10,369
<font color="#E5E5E5">the additional risk that you're</font>

758
00:29:07,549 --> 00:29:12,320
introducing<font color="#E5E5E5"> with to this individual</font><font color="#CCCCCC"> host</font>

759
00:29:10,369 --> 00:29:17,059
of the single active<font color="#E5E5E5"> high in Active</font>

760
00:29:12,320 --> 00:29:18,529
<font color="#CCCCCC">Directory</font><font color="#E5E5E5"> you can also have users that</font>

761
00:29:17,059 --> 00:29:21,649
log in on<font color="#E5E5E5"> this house so domain</font>

762
00:29:18,529 --> 00:29:23,090
<font color="#CCCCCC">principals that</font><font color="#E5E5E5"> log in on this post they</font>

763
00:29:21,649 --> 00:29:24,619
could be members<font color="#E5E5E5"> of addition all</font><font color="#CCCCCC"> the</font>

764
00:29:23,090 --> 00:29:27,350
groups and<font color="#E5E5E5"> everything so the idea here</font>

765
00:29:24,619 --> 00:29:28,399
<font color="#CCCCCC">is on the first part you have</font><font color="#E5E5E5"> additional</font>

766
00:29:27,350 --> 00:29:30,320
risk<font color="#E5E5E5"> inbound</font>

767
00:29:28,399 --> 00:29:32,059
<font color="#E5E5E5">into the post and depending on the</font>

768
00:29:30,320 --> 00:29:35,879
security<font color="#CCCCCC"> of your host so you</font><font color="#E5E5E5"> don't lock</font>

769
00:29:32,059 --> 00:29:37,690
it down<font color="#CCCCCC"> and</font><font color="#E5E5E5"> have some ours to eat sorry</font>

770
00:29:35,880 --> 00:29:40,070
[Music]

771
00:29:37,690 --> 00:29:42,019
and you have an<font color="#E5E5E5"> additional one outbound</font>

772
00:29:40,070 --> 00:29:43,700
<font color="#E5E5E5">different kind of control objects or</font>

773
00:29:42,019 --> 00:29:45,710
relationships going<font color="#E5E5E5"> from the host</font>

774
00:29:43,700 --> 00:29:47,960
<font color="#E5E5E5">so someone compromised the system it has</font>

775
00:29:45,710 --> 00:29:49,940
a<font color="#CCCCCC"> little blue or</font><font color="#E5E5E5"> whatever on it</font>

776
00:29:47,960 --> 00:29:53,110
keep talking<font color="#CCCCCC"> whether</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> chunk</font><font color="#E5E5E5"> really</font>

777
00:29:49,940 --> 00:29:55,490
<font color="#CCCCCC">warms or enough ice</font><font color="#E5E5E5"> very happy</font>

778
00:29:53,110 --> 00:29:57,139
so that<font color="#E5E5E5"> machine's compromised the</font><font color="#CCCCCC"> token</font>

779
00:29:55,490 --> 00:29:59,119
stolen and<font color="#E5E5E5"> that person is a member</font><font color="#CCCCCC"> of</font>

780
00:29:57,139 --> 00:30:01,129
these server admins there's now outbound

781
00:29:59,119 --> 00:30:11,240
<font color="#E5E5E5">access to other nodes in the network</font>

782
00:30:01,129 --> 00:30:13,399
<font color="#E5E5E5">that</font><font color="#CCCCCC"> your</font><font color="#E5E5E5"> machine</font><font color="#CCCCCC"> affected looks like me</font>

783
00:30:11,240 --> 00:30:15,799
<font color="#E5E5E5">in the last two</font><font color="#CCCCCC"> years</font><font color="#E5E5E5"> so security</font>

784
00:30:13,399 --> 00:30:17,268
implications host-based<font color="#E5E5E5"> periods</font>

785
00:30:15,799 --> 00:30:19,369
characters are<font color="#E5E5E5"> kind</font><font color="#CCCCCC"> of the missing link</font>

786
00:30:17,269 --> 00:30:21,769
when thinking about<font color="#E5E5E5"> domain attack graphs</font>

787
00:30:19,369 --> 00:30:23,570
so we've been thinking<font color="#CCCCCC"> about used to</font>

788
00:30:21,769 --> 00:30:25,399
<font color="#CCCCCC">make attack graphs for a while only</font><font color="#E5E5E5"> the</font>

789
00:30:23,570 --> 00:30:27,379
<font color="#CCCCCC">aunty stop</font><font color="#E5E5E5"> bloodhound you know John</font>

790
00:30:25,399 --> 00:30:29,059
Lambert stuff and all that<font color="#CCCCCC"> so host-based</font>

791
00:30:27,379 --> 00:30:31,039
security<font color="#CCCCCC"> scriptures kind of help</font>

792
00:30:29,059 --> 00:30:34,039
logically fill this gap in the entire

793
00:30:31,039 --> 00:30:36,619
system<font color="#CCCCCC"> something</font><font color="#E5E5E5"> I do want to emphasize</font>

794
00:30:34,039 --> 00:30:39,379
there's there's a ton of securable

795
00:30:36,619 --> 00:30:40,699
<font color="#E5E5E5">objects and nobody's looked at like</font>

796
00:30:39,379 --> 00:30:42,559
there's the<font color="#CCCCCC"> obvious things that we've</font>

797
00:30:40,700 --> 00:30:44,419
mentioned<font color="#E5E5E5"> already like</font><font color="#CCCCCC"> W mines the</font>

798
00:30:42,559 --> 00:30:46,940
service<font color="#CCCCCC"> Control Manager all those things</font>

799
00:30:44,419 --> 00:30:49,070
but<font color="#E5E5E5"> there's hundreds of RPC servers that</font>

800
00:30:46,940 --> 00:30:51,559
are<font color="#E5E5E5"> accessible remotely that I'm sure</font>

801
00:30:49,070 --> 00:30:54,289
none of<font color="#E5E5E5"> you</font><font color="#CCCCCC"> have ever heard of</font><font color="#E5E5E5"> and I've</font>

802
00:30:51,559 --> 00:30:55,999
<font color="#E5E5E5">never looked at so that's why we're</font>

803
00:30:54,289 --> 00:30:57,769
<font color="#E5E5E5">trying</font><font color="#CCCCCC"> to emphasize</font><font color="#E5E5E5"> there's all this</font>

804
00:30:55,999 --> 00:30:59,899
<font color="#E5E5E5">additional tax</font><font color="#CCCCCC"> service</font><font color="#E5E5E5"> and nobody's</font>

805
00:30:57,769 --> 00:31:03,619
<font color="#CCCCCC">allowed better</font><font color="#E5E5E5"> that is extremely</font>

806
00:30:59,899 --> 00:31:05,389
<font color="#E5E5E5">important and will show why a little</font><font color="#CCCCCC"> bit</font>

807
00:31:03,619 --> 00:31:08,299
likewise we know that there's existing

808
00:31:05,389 --> 00:31:10,279
<font color="#E5E5E5">misconfigurations</font><font color="#CCCCCC"> we blatantly shown</font>

809
00:31:08,299 --> 00:31:11,899
that with active<font color="#CCCCCC"> burglar protector Percy</font>

810
00:31:10,279 --> 00:31:14,419
- yeah

811
00:31:11,899 --> 00:31:17,719
through<font color="#E5E5E5"> Blood Mountain and</font><font color="#CCCCCC"> we'll give an</font>

812
00:31:14,419 --> 00:31:19,639
<font color="#E5E5E5">example of this later</font><font color="#CCCCCC"> on likewise</font><font color="#E5E5E5"> a</font>

813
00:31:17,720 --> 00:31:21,230
really important<font color="#CCCCCC"> thing too is when</font><font color="#E5E5E5"> you</font>

814
00:31:19,639 --> 00:31:23,029
<font color="#E5E5E5">combine these two worlds together</font>

815
00:31:21,230 --> 00:31:26,149
you have<font color="#CCCCCC"> misconfigurations on a host</font>

816
00:31:23,029 --> 00:31:29,299
those<font color="#E5E5E5"> misconfigurations can you know</font>

817
00:31:26,149 --> 00:31:30,889
lead to escalation<font color="#E5E5E5"> or lateral movement</font>

818
00:31:29,299 --> 00:31:34,399
inside of<font color="#E5E5E5"> active directory in the</font>

819
00:31:30,889 --> 00:31:36,320
environment as a whole<font color="#E5E5E5"> so essentially</font>

820
00:31:34,399 --> 00:31:38,959
like host<font color="#E5E5E5"> host based security</font>

821
00:31:36,320 --> 00:31:41,779
descriptors<font color="#CCCCCC"> can fill in or can provide</font>

822
00:31:38,960 --> 00:31:44,360
opportunities<font color="#CCCCCC"> for escalation inside of</font>

823
00:31:41,779 --> 00:31:47,029
<font color="#E5E5E5">Active Directory when there's not solely</font>

824
00:31:44,360 --> 00:31:48,979
a single escalation path in Active

825
00:31:47,029 --> 00:31:51,409
Directory just itself<font color="#CCCCCC"> the inverse</font><font color="#E5E5E5"> is</font>

826
00:31:48,980 --> 00:31:53,419
<font color="#CCCCCC">true as</font><font color="#E5E5E5"> well so if you're trying to</font>

827
00:31:51,409 --> 00:31:55,129
attack an individual host<font color="#CCCCCC"> you may not be</font>

828
00:31:53,419 --> 00:31:57,049
<font color="#CCCCCC">able</font><font color="#E5E5E5"> to gain</font><font color="#CCCCCC"> access to it but if you go</font>

829
00:31:55,129 --> 00:31:57,990
through<font color="#E5E5E5"> Active Directory you can then</font>

830
00:31:57,049 --> 00:32:00,970
<font color="#E5E5E5">gain access to the</font>

831
00:31:57,990 --> 00:32:02,770
if it brings an additional pack pass and

832
00:32:00,970 --> 00:32:08,980
attack vectors to get access<font color="#CCCCCC"> to</font><font color="#E5E5E5"> whatever</font>

833
00:32:02,770 --> 00:32:10,480
<font color="#E5E5E5">you're targeting so when you join us in</font>

834
00:32:08,980 --> 00:32:11,680
Active<font color="#CCCCCC"> Directory like we kind of</font>

835
00:32:10,480 --> 00:32:13,600
hammered in<font color="#E5E5E5"> you're introducing</font>

836
00:32:11,680 --> 00:32:15,760
<font color="#E5E5E5">additional nodes into the access craft</font>

837
00:32:13,600 --> 00:32:17,830
that may affect the security<font color="#CCCCCC"> of other</font>

838
00:32:15,760 --> 00:32:19,900
systems<font color="#E5E5E5"> again you know perfect world</font>

839
00:32:17,830 --> 00:32:21,879
<font color="#CCCCCC">perfect stock install and everything</font>

840
00:32:19,900 --> 00:32:23,740
<font color="#E5E5E5">there's no problem when the real world</font>

841
00:32:21,880 --> 00:32:25,510
<font color="#E5E5E5">that are going to be an enormous number</font>

842
00:32:23,740 --> 00:32:27,040
<font color="#E5E5E5">of this configurations or this</font>

843
00:32:25,510 --> 00:32:28,270
configuration<font color="#CCCCCC"> data and all these types</font>

844
00:32:27,040 --> 00:32:31,720
of<font color="#CCCCCC"> things are potentially malicious</font>

845
00:32:28,270 --> 00:32:33,639
backdoors<font color="#E5E5E5"> and again you're</font><font color="#CCCCCC"> also</font>

846
00:32:31,720 --> 00:32:35,620
implicitly trusting the security of<font color="#E5E5E5"> a</font>

847
00:32:33,640 --> 00:32:37,870
large number<font color="#E5E5E5"> of other systems in the</font>

848
00:32:35,620 --> 00:32:40,510
graph as well<font color="#E5E5E5"> so you're almost certainly</font>

849
00:32:37,870 --> 00:32:42,610
as we mentioned exposing your system

850
00:32:40,510 --> 00:32:44,980
services to more access than you realize

851
00:32:42,610 --> 00:32:46,479
so we realize<font color="#CCCCCC"> this kind of may seem</font>

852
00:32:44,980 --> 00:32:48,340
<font color="#E5E5E5">self-evident but this is just the way we</font>

853
00:32:46,480 --> 00:32:50,890
broke the problem down I was thinking of

854
00:32:48,340 --> 00:32:52,810
<font color="#CCCCCC">host host</font><font color="#E5E5E5"> basic area descriptors</font>

855
00:32:50,890 --> 00:32:54,480
<font color="#E5E5E5">combined Active Directory and everything</font>

856
00:32:52,810 --> 00:32:57,280
<font color="#E5E5E5">to where the actual attack craft is</font>

857
00:32:54,480 --> 00:32:59,740
enormous<font color="#E5E5E5"> where we only model the 80</font>

858
00:32:57,280 --> 00:33:01,840
<font color="#CCCCCC">active</font><font color="#E5E5E5"> directory you like</font><font color="#CCCCCC"> a CL</font><font color="#E5E5E5"> basic</font>

859
00:32:59,740 --> 00:33:03,820
<font color="#CCCCCC">inaudible</font><font color="#E5E5E5"> bloodhound</font><font color="#CCCCCC"> in the real</font><font color="#E5E5E5"> world</font>

860
00:33:01,840 --> 00:33:05,530
are the<font color="#CCCCCC"> like with</font><font color="#E5E5E5"> that attack craft</font>

861
00:33:03,820 --> 00:33:07,030
<font color="#E5E5E5">actually is will include the security</font>

862
00:33:05,530 --> 00:33:08,530
descriptor information<font color="#CCCCCC"> for every</font><font color="#E5E5E5"> single</font>

863
00:33:07,030 --> 00:33:09,879
service<font color="#CCCCCC"> and every</font><font color="#E5E5E5"> single host including</font>

864
00:33:08,530 --> 00:33:13,180
all<font color="#E5E5E5"> those like hundreds or thousands of</font>

865
00:33:09,880 --> 00:33:15,220
<font color="#E5E5E5">our PC servers something that on that</font>

866
00:33:13,180 --> 00:33:16,540
same<font color="#E5E5E5"> note is so say you have your</font>

867
00:33:15,220 --> 00:33:17,860
individual<font color="#CCCCCC"> hosts say it's</font><font color="#E5E5E5"> like a</font>

868
00:33:16,540 --> 00:33:20,860
database<font color="#CCCCCC"> that</font><font color="#E5E5E5"> has tons of information</font>

869
00:33:17,860 --> 00:33:22,780
<font color="#E5E5E5">you want to restrict access to it and</font>

870
00:33:20,860 --> 00:33:24,729
limit that as much as<font color="#E5E5E5"> possible</font><font color="#CCCCCC"> so maybe</font>

871
00:33:22,780 --> 00:33:27,310
you<font color="#E5E5E5"> just allow one</font><font color="#CCCCCC"> domain group access</font>

872
00:33:24,730 --> 00:33:29,920
<font color="#E5E5E5">to that but that domain group itself is</font>

873
00:33:27,310 --> 00:33:32,230
<font color="#E5E5E5">controlled by IP administrators that may</font>

874
00:33:29,920 --> 00:33:35,020
not have the<font color="#CCCCCC"> same</font><font color="#E5E5E5"> security mindset that</font>

875
00:33:32,230 --> 00:33:36,880
you do so they made<font color="#E5E5E5"> it invert endure</font>

876
00:33:35,020 --> 00:33:38,410
standing the security implications<font color="#CCCCCC"> start</font>

877
00:33:36,880 --> 00:33:42,130
<font color="#E5E5E5">adding users and other groups to that</font>

878
00:33:38,410 --> 00:33:44,500
that<font color="#CCCCCC"> group and</font><font color="#E5E5E5"> so again it's</font><font color="#CCCCCC"> unded</font>

879
00:33:42,130 --> 00:33:46,480
unintended consequences you never had

880
00:33:44,500 --> 00:33:48,940
that<font color="#E5E5E5"> intent of granting anybody else</font>

881
00:33:46,480 --> 00:33:50,560
<font color="#E5E5E5">access but because other people didn't</font>

882
00:33:48,940 --> 00:33:54,390
<font color="#E5E5E5">have the same security mindset as you</font>

883
00:33:50,560 --> 00:33:56,770
buy these new paths have been introduced

884
00:33:54,390 --> 00:33:58,030
<font color="#CCCCCC">cool so first</font><font color="#E5E5E5"> case study</font><font color="#CCCCCC"> that we're</font>

885
00:33:56,770 --> 00:33:59,770
<font color="#CCCCCC">gonna</font><font color="#E5E5E5"> talk about kind</font><font color="#CCCCCC"> of weaponization</font>

886
00:33:58,030 --> 00:34:01,510
<font color="#CCCCCC">we're going to pick on exchange again</font>

887
00:33:59,770 --> 00:34:03,879
it's like what I mentioned

888
00:34:01,510 --> 00:34:05,320
the exchange<font color="#CCCCCC"> Crescent subsystem which</font>

889
00:34:03,880 --> 00:34:06,490
contains to see how the<font color="#CCCCCC"> administrators</font>

890
00:34:05,320 --> 00:34:08,710
<font color="#CCCCCC">are</font><font color="#E5E5E5"> all</font><font color="#CCCCCC"> they exchange servers in that</font>

891
00:34:06,490 --> 00:34:10,179
<font color="#E5E5E5">group typically will have</font><font color="#CCCCCC"> a large amount</font>

892
00:34:08,710 --> 00:34:12,340
<font color="#CCCCCC">of writer of the domain or they don't</font>

893
00:34:10,179 --> 00:34:15,220
<font color="#CCCCCC">make objects</font><font color="#E5E5E5"> so they can kind of abuse</font>

894
00:34:12,340 --> 00:34:18,550
your remote registry<font color="#CCCCCC"> backdoor to go from</font>

895
00:34:15,219 --> 00:34:22,209
<font color="#E5E5E5">you know</font><font color="#CCCCCC"> access the</font><font color="#E5E5E5"> environment by</font>

896
00:34:18,550 --> 00:34:25,870
allowing any<font color="#E5E5E5"> defined</font><font color="#CCCCCC"> rupert user to</font>

897
00:34:22,210 --> 00:34:33,610
basically<font color="#CCCCCC"> become</font><font color="#E5E5E5"> into the VA that you</font>

898
00:34:25,870 --> 00:34:35,049
have demo of this so<font color="#CCCCCC"> either go right</font>

899
00:34:33,610 --> 00:34:37,630
<font color="#CCCCCC">back towards that function via wrote to</font>

900
00:34:35,050 --> 00:34:40,000
<font color="#E5E5E5">backdoor</font><font color="#CCCCCC"> i remote registry specifically</font>

901
00:34:37,630 --> 00:34:41,409
for removing or extracting<font color="#CCCCCC"> the machine</font>

902
00:34:40,000 --> 00:34:42,730
<font color="#CCCCCC">you have half step let's give me a</font>

903
00:34:41,409 --> 00:34:44,740
<font color="#E5E5E5">computer name this kids were doing</font>

904
00:34:42,730 --> 00:34:46,150
exchange we're adding a domain user

905
00:34:44,739 --> 00:34:48,250
called<font color="#CCCCCC"> jason so jason has been</font>

906
00:34:46,150 --> 00:34:50,950
<font color="#E5E5E5">privileged to the environment he's just</font>

907
00:34:48,250 --> 00:34:53,290
you<font color="#E5E5E5"> know some random</font><font color="#CCCCCC"> don't know after we</font>

908
00:34:50,949 --> 00:34:55,389
have added<font color="#CCCCCC"> or modified the</font><font color="#E5E5E5"> very</font>

909
00:34:53,290 --> 00:34:57,070
descriptor on those object that's being

910
00:34:55,389 --> 00:35:00,370
tired<font color="#CCCCCC"> yeah</font>

911
00:34:57,070 --> 00:35:02,110
we can also search<font color="#E5E5E5"> over to Jason here in</font>

912
00:35:00,370 --> 00:35:03,670
a second what's cool<font color="#E5E5E5"> about this</font><font color="#CCCCCC"> as a</font>

913
00:35:02,110 --> 00:35:05,350
scenario like<font color="#E5E5E5"> I mentioned</font><font color="#CCCCCC"> earlier it be</font>

914
00:35:03,670 --> 00:35:11,290
if attacker gets kicked out we can be

915
00:35:05,350 --> 00:35:13,150
fish they had<font color="#CCCCCC"> we</font><font color="#E5E5E5"> have a function called</font>

916
00:35:11,290 --> 00:35:14,860
<font color="#E5E5E5">get machine or get remote mission</font>

917
00:35:13,150 --> 00:35:16,990
accomplished in<font color="#E5E5E5"> the computer</font><font color="#CCCCCC"> named as</font>

918
00:35:14,860 --> 00:35:18,820
<font color="#E5E5E5">that user and then it'll just pop out</font>

919
00:35:16,990 --> 00:35:20,890
<font color="#E5E5E5">machine account hops grab</font><font color="#CCCCCC"> outpost so</font>

920
00:35:18,820 --> 00:35:23,440
since we're doing<font color="#E5E5E5"> this against exchange</font>

921
00:35:20,890 --> 00:35:24,549
we can utilize<font color="#E5E5E5"> kind of</font><font color="#CCCCCC"> miss</font>

922
00:35:23,440 --> 00:35:28,240
configuration<font color="#CCCCCC"> that'll all</font><font color="#E5E5E5"> the</font>

923
00:35:24,550 --> 00:35:29,890
<font color="#E5E5E5">organizations kind of an here it to do</font>

924
00:35:28,240 --> 00:35:31,180
some really<font color="#E5E5E5"> nasty stuff</font><font color="#CCCCCC"> so here we're</font>

925
00:35:29,890 --> 00:35:33,190
<font color="#CCCCCC">just taking the hash and we're using</font>

926
00:35:31,180 --> 00:35:34,779
<font color="#CCCCCC">overpass to hash to kind of put</font>

927
00:35:33,190 --> 00:35:37,780
ourselves in<font color="#CCCCCC"> that context</font><font color="#E5E5E5"> and so you've</font>

928
00:35:34,780 --> 00:35:40,270
got<font color="#CCCCCC"> to</font><font color="#E5E5E5"> be a machine accounts hash so we</font>

929
00:35:37,780 --> 00:35:41,770
give<font color="#E5E5E5"> you guys to do this</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> users gonna</font>

930
00:35:40,270 --> 00:35:43,480
<font color="#CCCCCC">be an exchange</font><font color="#E5E5E5"> server dollars so the</font>

931
00:35:41,770 --> 00:35:45,610
computer account<font color="#E5E5E5"> and how should</font><font color="#CCCCCC"> that</font>

932
00:35:43,480 --> 00:35:47,890
so now that we're running is<font color="#CCCCCC"> that we can</font>

933
00:35:45,610 --> 00:35:49,780
<font color="#E5E5E5">come</font><font color="#CCCCCC"> up with</font><font color="#E5E5E5"> me be cuts again</font><font color="#CCCCCC"> then we</font>

934
00:35:47,890 --> 00:35:51,700
can kind<font color="#CCCCCC"> of demonstrate that you know we</font>

935
00:35:49,780 --> 00:35:55,180
can do more<font color="#CCCCCC"> of us whatever we want in</font>

936
00:35:51,700 --> 00:35:57,640
this case since you<font color="#CCCCCC"> know the exchange</font>

937
00:35:55,180 --> 00:35:59,740
trusted subsystem<font color="#CCCCCC"> has a lot of control</font>

938
00:35:57,640 --> 00:36:02,230
over those<font color="#E5E5E5"> different objects we</font><font color="#CCCCCC"> can</font><font color="#E5E5E5"> do</font>

939
00:35:59,740 --> 00:36:04,750
something<font color="#CCCCCC"> like</font><font color="#E5E5E5"> PC sync we do one of the</font>

940
00:36:02,230 --> 00:36:07,450
<font color="#E5E5E5">ran ourselves PCC</font><font color="#CCCCCC"> pride never right for</font>

941
00:36:04,750 --> 00:36:09,250
<font color="#E5E5E5">that exchange</font><font color="#CCCCCC"> so here we just</font><font color="#E5E5E5"> pulled the</font>

942
00:36:07,450 --> 00:36:11,529
<font color="#E5E5E5">karaoke hash</font>

943
00:36:09,250 --> 00:36:16,560
domain using<font color="#CCCCCC"> the</font><font color="#E5E5E5"> factories installed as</font>

944
00:36:11,530 --> 00:36:20,050
a just having<font color="#E5E5E5"> access that</font><font color="#CCCCCC"> I change sir</font>

945
00:36:16,560 --> 00:36:21,759
cool<font color="#CCCCCC"> alright</font><font color="#E5E5E5"> so like kind of cool</font>

946
00:36:20,050 --> 00:36:23,380
there's one like you make one little

947
00:36:21,760 --> 00:36:25,300
<font color="#CCCCCC">back</font><font color="#E5E5E5"> door to one system there's no</font>

948
00:36:23,380 --> 00:36:26,500
<font color="#E5E5E5">malware running you come back in and</font>

949
00:36:25,300 --> 00:36:28,660
<font color="#E5E5E5">then off the entire domain it will</font>

950
00:36:26,500 --> 00:36:30,850
<font color="#CCCCCC">forever basically unless someone's</font><font color="#E5E5E5"> found</font>

951
00:36:28,660 --> 00:36:32,350
that backdoor in the registry<font color="#CCCCCC"> that one</font>

952
00:36:30,850 --> 00:36:36,370
exchange<font color="#E5E5E5"> box on the wiped everything out</font>

953
00:36:32,350 --> 00:36:38,799
<font color="#CCCCCC">so say second case study that one was</font>

954
00:36:36,370 --> 00:36:40,270
persistence<font color="#E5E5E5"> so again you</font><font color="#CCCCCC"> elevated on</font>

955
00:36:38,800 --> 00:36:42,340
that<font color="#E5E5E5"> exchange server to implement the</font>

956
00:36:40,270 --> 00:36:44,380
backdoor but persistence<font color="#E5E5E5"> now we're going</font>

957
00:36:42,340 --> 00:36:47,020
<font color="#E5E5E5">to cover existing</font><font color="#CCCCCC"> misconfigurations</font><font color="#E5E5E5"> in</font>

958
00:36:44,380 --> 00:36:49,120
these<font color="#CCCCCC"> gonna cover a really cool</font><font color="#E5E5E5"> thing</font>

959
00:36:47,020 --> 00:36:51,370
that<font color="#E5E5E5"> he found so we</font><font color="#CCCCCC"> have a couple of</font>

960
00:36:49,120 --> 00:36:54,700
ingredients<font color="#E5E5E5"> first ingredient is</font>

961
00:36:51,370 --> 00:36:56,529
<font color="#E5E5E5">unconstrained delegation so everybody</font>

962
00:36:54,700 --> 00:36:57,669
perfectly understands<font color="#E5E5E5"> Kerberos and you</font>

963
00:36:56,530 --> 00:37:02,350
know I'm<font color="#E5E5E5"> just going</font><font color="#CCCCCC"> to explain this</font><font color="#E5E5E5"> in</font>

964
00:36:57,670 --> 00:37:03,670
20 seconds yeah totally<font color="#E5E5E5"> so there's going</font>

965
00:37:02,350 --> 00:37:06,250
<font color="#E5E5E5">to be a link at the</font><font color="#CCCCCC"> end</font><font color="#E5E5E5"> if you want</font><font color="#CCCCCC"> more</font>

966
00:37:03,670 --> 00:37:08,080
information<font color="#CCCCCC"> on this but TLDR the server</font>

967
00:37:06,250 --> 00:37:11,350
is configured for<font color="#E5E5E5"> unconstrained</font>

968
00:37:08,080 --> 00:37:13,569
delegation service ticket<font color="#CCCCCC"> requests to</font>

969
00:37:11,350 --> 00:37:15,430
that<font color="#E5E5E5"> server will include the requesters</font>

970
00:37:13,570 --> 00:37:17,920
<font color="#CCCCCC">ticket granting ticket</font><font color="#E5E5E5"> stuff in the</font>

971
00:37:15,430 --> 00:37:19,930
service ticket<font color="#CCCCCC"> so user authenticates to</font>

972
00:37:17,920 --> 00:37:21,700
a service and<font color="#CCCCCC"> one constraint server</font><font color="#E5E5E5"> that</font>

973
00:37:19,930 --> 00:37:23,770
users TGT is<font color="#CCCCCC"> something the service</font>

974
00:37:21,700 --> 00:37:25,930
ticket<font color="#E5E5E5"> sent to the server and that's</font>

975
00:37:23,770 --> 00:37:31,810
cash<font color="#E5E5E5"> these for a small period</font><font color="#CCCCCC"> in time</font><font color="#E5E5E5"> is</font>

976
00:37:25,930 --> 00:37:33,640
<font color="#E5E5E5">not more in alsace concern so</font><font color="#CCCCCC"> TLDR if</font>

977
00:37:31,810 --> 00:37:35,410
you can get a<font color="#CCCCCC"> principal to</font><font color="#E5E5E5"> authenticate</font>

978
00:37:33,640 --> 00:37:38,080
<font color="#E5E5E5">to an unconstrained server that you</font>

979
00:37:35,410 --> 00:37:40,359
control you can extract their ticket

980
00:37:38,080 --> 00:37:42,790
grant it gets out of<font color="#E5E5E5"> memory whether</font>

981
00:37:40,360 --> 00:37:43,390
through<font color="#CCCCCC"> hell fast manipulation with</font>

982
00:37:42,790 --> 00:37:45,670
<font color="#E5E5E5">mitty-kats</font>

983
00:37:43,390 --> 00:37:49,089
or through using<font color="#E5E5E5"> some of the approved</font>

984
00:37:45,670 --> 00:37:51,070
<font color="#E5E5E5">real like LSA</font><font color="#CCCCCC"> ad</font><font color="#E5E5E5"> is more information on</font>

985
00:37:49,090 --> 00:37:53,200
the unconstrained delegation as always

986
00:37:51,070 --> 00:37:56,080
<font color="#E5E5E5">the link is always</font><font color="#CCCCCC"> ad Security org</font>

987
00:37:53,200 --> 00:37:57,549
<font color="#CCCCCC">there's on Metcalf yeah</font><font color="#E5E5E5"> talk so much</font>

988
00:37:56,080 --> 00:37:59,160
more<font color="#E5E5E5"> about some little bunch more the</font>

989
00:37:57,550 --> 00:38:01,570
operational<font color="#E5E5E5"> details</font>

990
00:37:59,160 --> 00:38:04,149
second ingredient<font color="#CCCCCC"> we want to be able</font><font color="#E5E5E5"> to</font>

991
00:38:01,570 --> 00:38:06,130
attract those TG<font color="#E5E5E5"> T's so we started</font>

992
00:38:04,150 --> 00:38:07,990
building<font color="#E5E5E5"> this tool set</font><font color="#CCCCCC"> a bit ago to</font>

993
00:38:06,130 --> 00:38:09,760
actually<font color="#E5E5E5"> support this attack primitive</font>

994
00:38:07,990 --> 00:38:11,799
<font color="#E5E5E5">that they came</font><font color="#CCCCCC"> up with but</font><font color="#E5E5E5"> our previous</font>

995
00:38:09,760 --> 00:38:13,960
as<font color="#E5E5E5"> a news</font><font color="#CCCCCC"> t sharp</font><font color="#E5E5E5"> Kurvers abuse toolkit</font>

996
00:38:11,800 --> 00:38:17,380
<font color="#E5E5E5">that's essentially a recoded version of</font>

997
00:38:13,960 --> 00:38:18,160
some of kikyo's<font color="#CCCCCC"> implementation</font><font color="#E5E5E5"> kikyo is</font>

998
00:38:17,380 --> 00:38:19,660
the other project

999
00:38:18,160 --> 00:38:21,790
from<font color="#CCCCCC"> digital beside the other</font><font color="#E5E5E5"> main</font>

1000
00:38:19,660 --> 00:38:23,770
project<font color="#CCCCCC"> besides me becomes it also</font>

1001
00:38:21,790 --> 00:38:27,070
includes the ability<font color="#E5E5E5"> for ticket</font>

1002
00:38:23,770 --> 00:38:28,720
extraction<font color="#E5E5E5"> so there's a monitoring</font>

1003
00:38:27,070 --> 00:38:30,760
action which<font color="#E5E5E5"> you run it on</font><font color="#CCCCCC"> a post</font>

1004
00:38:28,720 --> 00:38:33,430
<font color="#E5E5E5">elevated on a host on an unconstrained</font>

1005
00:38:30,760 --> 00:38:35,590
server<font color="#CCCCCC"> control</font><font color="#E5E5E5"> don't monitor</font><font color="#CCCCCC"> four</font><font color="#E5E5E5"> four</font>

1006
00:38:33,430 --> 00:38:38,020
<font color="#E5E5E5">six</font><font color="#CCCCCC"> two</font><font color="#E5E5E5"> four logon events in the event</font>

1007
00:38:35,590 --> 00:38:40,810
log<font color="#CCCCCC"> and minerals track extract any</font>

1008
00:38:38,020 --> 00:38:42,580
<font color="#E5E5E5">usable ticket granting ticket</font><font color="#CCCCCC"> Kirby so</font>

1009
00:38:40,810 --> 00:38:45,549
like<font color="#E5E5E5"> hold her credit objects out</font><font color="#CCCCCC"> of</font>

1010
00:38:42,580 --> 00:38:48,100
memory<font color="#E5E5E5"> from</font><font color="#CCCCCC"> Elvis using the approved LSA</font>

1011
00:38:45,550 --> 00:38:50,770
yes so we're not actually<font color="#E5E5E5"> opening up a</font>

1012
00:38:48,100 --> 00:38:52,690
read handle to<font color="#CCCCCC"> alehouse</font><font color="#E5E5E5"> so this isn't</font>

1013
00:38:50,770 --> 00:38:54,190
<font color="#E5E5E5">like running</font><font color="#CCCCCC"> the console Polson</font><font color="#E5E5E5"> ticket</font>

1014
00:38:52,690 --> 00:38:57,220
<font color="#E5E5E5">circle so long run passwords this is</font>

1015
00:38:54,190 --> 00:38:59,470
just using<font color="#CCCCCC"> Windows api's intended way</font>

1016
00:38:57,220 --> 00:39:05,560
because they built the api's to extract

1017
00:38:59,470 --> 00:39:06,879
these ticket laws<font color="#CCCCCC"> so I I think I</font>

1018
00:39:05,560 --> 00:39:08,860
mentioned<font color="#E5E5E5"> that there's hundreds and</font>

1019
00:39:06,880 --> 00:39:10,030
hundreds of RPC servers on machines and

1020
00:39:08,860 --> 00:39:14,140
<font color="#CCCCCC">I'm pretty sure nobody's looked at</font>

1021
00:39:10,030 --> 00:39:16,540
before this<font color="#E5E5E5"> is one</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> those so last year</font>

1022
00:39:14,140 --> 00:39:19,299
and we<font color="#E5E5E5"> were diving into most basic URI</font>

1023
00:39:16,540 --> 00:39:21,910
descriptors<font color="#CCCCCC"> one of</font><font color="#E5E5E5"> these RPC server is</font>

1024
00:39:19,300 --> 00:39:26,020
identified with printers<font color="#E5E5E5"> printers are</font>

1025
00:39:21,910 --> 00:39:30,160
always fun<font color="#E5E5E5"> so I started</font><font color="#CCCCCC"> diving</font><font color="#E5E5E5"> into</font><font color="#CCCCCC"> what</font>

1026
00:39:26,020 --> 00:39:32,680
goes into the print server RPC calls<font color="#E5E5E5"> so</font>

1027
00:39:30,160 --> 00:39:34,839
there's one interface that you can

1028
00:39:32,680 --> 00:39:37,890
<font color="#CCCCCC">interact with</font><font color="#E5E5E5"> called the print system</font>

1029
00:39:34,840 --> 00:39:45,310
<font color="#E5E5E5">remote protocol and this</font><font color="#CCCCCC"> RP an RPM</font><font color="#E5E5E5"> are</font>

1030
00:39:37,890 --> 00:39:47,230
anybody<font color="#E5E5E5"> ever</font><font color="#CCCCCC"> this protocol has</font><font color="#E5E5E5"> an</font>

1031
00:39:45,310 --> 00:39:49,240
interesting<font color="#CCCCCC"> function in it</font><font color="#E5E5E5"> so as I was</font>

1032
00:39:47,230 --> 00:39:51,310
doing<font color="#E5E5E5"> one day I was reading through the</font>

1033
00:39:49,240 --> 00:39:54,640
technical specifications on<font color="#CCCCCC"> Microsoft's</font>

1034
00:39:51,310 --> 00:39:55,840
<font color="#CCCCCC">web site it's really reads and as I</font><font color="#E5E5E5"> was</font>

1035
00:39:54,640 --> 00:39:58,270
reading through<font color="#CCCCCC"> I came</font><font color="#E5E5E5"> across one of</font>

1036
00:39:55,840 --> 00:40:00,460
<font color="#E5E5E5">these methods RPC you remove fine first</font>

1037
00:39:58,270 --> 00:40:04,500
printer change notification obviously

1038
00:40:00,460 --> 00:40:09,370
looks<font color="#E5E5E5"> malicious essentially the purpose</font>

1039
00:40:04,500 --> 00:40:12,130
of it is to I can say as a user I want<font color="#E5E5E5"> I</font>

1040
00:40:09,370 --> 00:40:15,100
can say hey print server notify me

1041
00:40:12,130 --> 00:40:17,500
whenever you have a new print job<font color="#CCCCCC"> you</font>

1042
00:40:15,100 --> 00:40:18,850
know I'm<font color="#E5E5E5"> just curious so let me know</font>

1043
00:40:17,500 --> 00:40:22,000
whenever<font color="#CCCCCC"> there's new print job or</font>

1044
00:40:18,850 --> 00:40:24,040
<font color="#E5E5E5">whatever for whatever reason what's the</font>

1045
00:40:22,000 --> 00:40:26,290
implication of this for me as an

1046
00:40:24,040 --> 00:40:29,110
attacker<font color="#E5E5E5"> well how this works</font><font color="#CCCCCC"> underneath</font>

1047
00:40:26,290 --> 00:40:33,520
is that any domain user can make<font color="#E5E5E5"> that</font>

1048
00:40:29,110 --> 00:40:36,010
request of the print server and<font color="#E5E5E5"> spooler</font>

1049
00:40:33,520 --> 00:40:39,310
is enabled<font color="#E5E5E5"> on every single machine</font><font color="#CCCCCC"> in</font>

1050
00:40:36,010 --> 00:40:42,100
modern domains<font color="#E5E5E5"> and so any user</font><font color="#CCCCCC"> can</font>

1051
00:40:39,310 --> 00:40:46,180
<font color="#E5E5E5">actually request this from any print</font>

1052
00:40:42,100 --> 00:40:48,339
server in a domain and so what happens

1053
00:40:46,180 --> 00:40:50,049
<font color="#E5E5E5">is when I make that request</font><font color="#CCCCCC"> the print</font>

1054
00:40:48,340 --> 00:40:52,450
server itself so the spooler service

1055
00:40:50,050 --> 00:40:54,490
which is running<font color="#E5E5E5"> a system is actually</font>

1056
00:40:52,450 --> 00:40:57,160
<font color="#E5E5E5">going to immediately talk back to me</font>

1057
00:40:54,490 --> 00:40:59,020
just<font color="#CCCCCC"> to test connectivity and it's</font><font color="#E5E5E5"> gonna</font>

1058
00:40:57,160 --> 00:41:02,500
authenticate to<font color="#CCCCCC"> whatever machine I tell</font>

1059
00:40:59,020 --> 00:41:05,170
it to<font color="#E5E5E5"> so I can say for</font><font color="#CCCCCC"> example I could</font>

1060
00:41:02,500 --> 00:41:07,810
<font color="#E5E5E5">tell you know the exchange server over</font>

1061
00:41:05,170 --> 00:41:10,000
there hey I want to monitor your<font color="#CCCCCC"> put</font>

1062
00:41:07,810 --> 00:41:12,120
<font color="#CCCCCC">jobs</font><font color="#E5E5E5"> and when I say that it's gonna</font>

1063
00:41:10,000 --> 00:41:15,940
connect back<font color="#CCCCCC"> to my machine</font><font color="#E5E5E5"> as the</font>

1064
00:41:12,120 --> 00:41:17,920
<font color="#CCCCCC">exchange server dollar account and try</font>

1065
00:41:15,940 --> 00:41:20,770
<font color="#E5E5E5">not temp date to me so why is that</font>

1066
00:41:17,920 --> 00:41:24,400
interesting<font color="#CCCCCC"> well this isn't won't fix</font>

1067
00:41:20,770 --> 00:41:27,400
I pulled Microsoft<font color="#E5E5E5"> by design</font><font color="#CCCCCC"> I don't</font>

1068
00:41:24,400 --> 00:41:28,600
<font color="#CCCCCC">think that's a good idea but mine we</font>

1069
00:41:27,400 --> 00:41:32,440
using<font color="#E5E5E5"> this did not they were not</font>

1070
00:41:28,600 --> 00:41:34,660
<font color="#CCCCCC">listening to so so again what</font><font color="#E5E5E5"> is this</font>

1071
00:41:32,440 --> 00:41:36,160
look<font color="#E5E5E5"> like so let's</font><font color="#CCCCCC"> say I'm on eyes the</font>

1072
00:41:34,660 --> 00:41:38,710
attacker<font color="#E5E5E5"> might not top</font><font color="#CCCCCC"> machine over</font>

1073
00:41:36,160 --> 00:41:40,720
<font color="#CCCCCC">there I'm</font><font color="#E5E5E5"> gonna talk</font><font color="#CCCCCC"> to you</font><font color="#E5E5E5"> this server</font>

1074
00:41:38,710 --> 00:41:42,280
over there and using<font color="#E5E5E5"> this print protocol</font>

1075
00:41:40,720 --> 00:41:45,370
<font color="#CCCCCC">I'm</font><font color="#E5E5E5"> gonna say please authenticate to</font>

1076
00:41:42,280 --> 00:41:48,370
<font color="#E5E5E5">other</font><font color="#CCCCCC"> hosts</font><font color="#E5E5E5"> down there when I make that</font>

1077
00:41:45,370 --> 00:41:50,950
request the server is a server dollar

1078
00:41:48,370 --> 00:41:52,900
that's the<font color="#E5E5E5"> server's domain account it's</font>

1079
00:41:50,950 --> 00:41:55,870
going to authenticate<font color="#E5E5E5"> the</font><font color="#CCCCCC"> SMB to other</font>

1080
00:41:52,900 --> 00:41:58,720
<font color="#E5E5E5">posts I'm gonna choose so I can coerce</font>

1081
00:41:55,870 --> 00:42:00,790
<font color="#E5E5E5">that machine to use Kerberos or ntlm</font>

1082
00:41:58,720 --> 00:42:03,399
authentication<font color="#E5E5E5"> when that when I make</font>

1083
00:42:00,790 --> 00:42:05,650
<font color="#E5E5E5">that request so why is that interesting</font>

1084
00:42:03,400 --> 00:42:07,510
bunch<font color="#E5E5E5"> of different abuse scenarios but</font>

1085
00:42:05,650 --> 00:42:09,130
we're just<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to talk about one that</font>

1086
00:42:07,510 --> 00:42:12,460
<font color="#E5E5E5">first one they're talking</font><font color="#CCCCCC"> about</font>

1087
00:42:09,130 --> 00:42:14,200
<font color="#E5E5E5">unconstraint delegation so if we</font>

1088
00:42:12,460 --> 00:42:16,720
<font color="#CCCCCC">compromise</font><font color="#E5E5E5"> an unconstrained delegation</font>

1089
00:42:14,200 --> 00:42:18,939
server I<font color="#E5E5E5"> can use this to coerce the</font>

1090
00:42:16,720 --> 00:42:20,709
domain controller to<font color="#CCCCCC"> authenticate back</font>

1091
00:42:18,940 --> 00:42:22,630
to me<font color="#E5E5E5"> when the remain controller</font>

1092
00:42:20,710 --> 00:42:26,800
authenticates<font color="#E5E5E5"> to</font><font color="#CCCCCC"> me</font><font color="#E5E5E5"> it's going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> send</font>

1093
00:42:22,630 --> 00:42:28,089
<font color="#E5E5E5">its TGT and I can use that</font><font color="#CCCCCC"> new</font><font color="#E5E5E5"> TGT to</font><font color="#CCCCCC"> DC</font>

1094
00:42:26,800 --> 00:42:33,349
<font color="#E5E5E5">sync because</font>

1095
00:42:28,089 --> 00:42:35,058
yeah so this<font color="#CCCCCC"> is the recipe I compromised</font>

1096
00:42:33,349 --> 00:42:39,079
a server that<font color="#CCCCCC"> has</font><font color="#E5E5E5"> a constrained</font>

1097
00:42:35,059 --> 00:42:42,979
delegation<font color="#CCCCCC"> I start monitoring 40 GTS</font>

1098
00:42:39,079 --> 00:42:44,719
using<font color="#CCCCCC"> Rubeus</font><font color="#E5E5E5"> and so it's gonna check</font>

1099
00:42:42,979 --> 00:42:47,089
every<font color="#CCCCCC"> 5 seconds for new people</font><font color="#E5E5E5"> logging</font>

1100
00:42:44,719 --> 00:42:49,489
<font color="#CCCCCC">onto</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> machine</font><font color="#E5E5E5"> and then I'm going to</font>

1101
00:42:47,089 --> 00:42:51,288
<font color="#E5E5E5">use this printer bug to coerce the</font>

1102
00:42:49,489 --> 00:42:53,499
domain controller<font color="#E5E5E5"> to authenticate to my</font>

1103
00:42:51,289 --> 00:43:02,539
image to<font color="#CCCCCC"> the server</font><font color="#E5E5E5"> that I compromised</font>

1104
00:42:53,499 --> 00:43:05,660
using<font color="#CCCCCC"> school sample which is a tool</font><font color="#E5E5E5"> and</font>

1105
00:43:02,539 --> 00:43:08,210
then once you've got<font color="#CCCCCC"> that the domain</font>

1106
00:43:05,660 --> 00:43:11,029
controllers ticket you load that<font color="#CCCCCC"> up</font>

1107
00:43:08,210 --> 00:43:16,849
DC same problem so what<font color="#E5E5E5"> does this look</font>

1108
00:43:11,029 --> 00:43:18,499
like so here we have cobalt strike we're

1109
00:43:16,849 --> 00:43:23,180
going to identify unconstrained

1110
00:43:18,499 --> 00:43:24,558
delegation servers using power view so

1111
00:43:23,180 --> 00:43:27,049
we<font color="#CCCCCC"> can</font><font color="#E5E5E5"> see that the SharePoint Server</font>

1112
00:43:24,559 --> 00:43:29,749
has<font color="#CCCCCC"> unconstrained delegation enabled</font>

1113
00:43:27,049 --> 00:43:32,150
<font color="#E5E5E5">that's</font><font color="#CCCCCC"> really</font><font color="#E5E5E5"> typical in some</font>

1114
00:43:29,749 --> 00:43:33,709
environments so now we're going to give

1115
00:43:32,150 --> 00:43:35,420
<font color="#E5E5E5">it over to</font><font color="#CCCCCC"> that sharepoint server i</font>

1116
00:43:33,710 --> 00:43:37,670
don't know how maybe we found some more

1117
00:43:35,420 --> 00:43:41,690
<font color="#E5E5E5">privileged user 90 admins cred whatever</font>

1118
00:43:37,670 --> 00:43:43,309
we're<font color="#E5E5E5"> going to pivot to that machine now</font>

1119
00:43:41,690 --> 00:43:45,079
we're on a<font color="#E5E5E5"> message a delegation server</font>

1120
00:43:43,309 --> 00:43:49,460
<font color="#E5E5E5">we're going to start monitoring for new</font>

1121
00:43:45,079 --> 00:43:51,170
<font color="#CCCCCC">ticketing</font><font color="#E5E5E5"> tickets using</font><font color="#CCCCCC"> Rubeus so now</font>

1122
00:43:49,460 --> 00:43:53,299
we're<font color="#E5E5E5"> gonna be monitoring specifically</font>

1123
00:43:51,170 --> 00:43:55,640
for the<font color="#E5E5E5"> domain controller logging into</font>

1124
00:43:53,299 --> 00:43:58,130
this machine<font color="#CCCCCC"> and when it</font><font color="#E5E5E5"> locks in we're</font>

1125
00:43:55,640 --> 00:44:00,319
gonna dump<font color="#E5E5E5"> its</font><font color="#CCCCCC"> tuner so we're gonna</font>

1126
00:43:58,130 --> 00:44:03,309
execute that it's now monitoring<font color="#E5E5E5"> for new</font>

1127
00:44:00,319 --> 00:44:06,558
logins<font color="#CCCCCC"> we're gonna use spool sample to</font>

1128
00:44:03,309 --> 00:44:07,969
request that ticket so this is going to

1129
00:44:06,559 --> 00:44:10,130
<font color="#E5E5E5">course the domain controller to</font>

1130
00:44:07,969 --> 00:44:13,910
authenticate to<font color="#CCCCCC"> the SharePoint</font><font color="#E5E5E5"> Server</font>

1131
00:44:10,130 --> 00:44:16,039
that<font color="#E5E5E5"> I've compromised</font><font color="#CCCCCC"> I execute it we</font>

1132
00:44:13,910 --> 00:44:17,930
wait a little<font color="#E5E5E5"> while for this to happen</font>

1133
00:44:16,039 --> 00:44:21,019
<font color="#E5E5E5">and you can see the domain controller</font>

1134
00:44:17,930 --> 00:44:22,848
authenticated and since<font color="#CCCCCC"> it's TGT now we</font>

1135
00:44:21,019 --> 00:44:25,758
can extract<font color="#CCCCCC"> the</font><font color="#E5E5E5"> base64 encoded version</font>

1136
00:44:22,849 --> 00:44:28,249
of that we're<font color="#CCCCCC"> going</font><font color="#E5E5E5"> to write that to a</font>

1137
00:44:25,759 --> 00:44:31,369
file<font color="#E5E5E5"> using some</font><font color="#CCCCCC"> powershell</font><font color="#E5E5E5"> that ticket</font>

1138
00:44:28,249 --> 00:44:34,009
<font color="#E5E5E5">Kirby</font><font color="#CCCCCC"> this is on my attackers</font><font color="#E5E5E5"> house you</font>

1139
00:44:31,369 --> 00:44:36,499
know<font color="#E5E5E5"> right up there go ahead</font><font color="#CCCCCC"> and execute</font>

1140
00:44:34,009 --> 00:44:37,969
it<font color="#CCCCCC"> now we're going to use now we're</font>

1141
00:44:36,499 --> 00:44:38,419
<font color="#E5E5E5">going to look it up load</font><font color="#CCCCCC"> it up and we're</font>

1142
00:44:37,969 --> 00:44:40,130
going<font color="#E5E5E5"> to make</font>

1143
00:44:38,420 --> 00:44:46,339
sacrificial<font color="#E5E5E5"> logon</font><font color="#CCCCCC"> sessions so</font><font color="#E5E5E5"> we don't</font>

1144
00:44:40,130 --> 00:44:48,020
screw anything<font color="#E5E5E5"> up</font><font color="#CCCCCC"> password doesn't</font>

1145
00:44:46,339 --> 00:44:50,380
<font color="#E5E5E5">matter here</font><font color="#CCCCCC"> I'm just</font><font color="#E5E5E5"> doing this so I</font>

1146
00:44:48,020 --> 00:44:54,259
don't clobber the current logon session

1147
00:44:50,380 --> 00:44:58,910
then I'm gonna load<font color="#E5E5E5"> up the Kerberos</font>

1148
00:44:54,260 --> 00:45:04,460
ticket using<font color="#CCCCCC"> Meakin so progress ticket</font>

1149
00:44:58,910 --> 00:45:06,828
use path to the ticket I just loaded<font color="#E5E5E5"> now</font>

1150
00:45:04,460 --> 00:45:10,640
that's<font color="#CCCCCC"> gonna be loaded</font><font color="#E5E5E5"> up and because</font>

1151
00:45:06,829 --> 00:45:21,950
I'm a domain controller now<font color="#E5E5E5"> I can use</font><font color="#CCCCCC"> DC</font>

1152
00:45:10,640 --> 00:45:26,598
sync to request any<font color="#CCCCCC"> users password sure</font>

1153
00:45:21,950 --> 00:45:29,029
<font color="#E5E5E5">worked</font><font color="#CCCCCC"> so that's the point here is there</font>

1154
00:45:26,599 --> 00:45:30,859
<font color="#CCCCCC">is a bunch of different</font><font color="#E5E5E5"> host-based</font>

1155
00:45:29,030 --> 00:45:35,000
security descriptors that can be used

1156
00:45:30,859 --> 00:45:36,348
<font color="#E5E5E5">you know maliciously or</font><font color="#CCCCCC"> you know they're</font>

1157
00:45:35,000 --> 00:45:38,420
<font color="#CCCCCC">just enabled by default</font><font color="#E5E5E5"> and the</font>

1158
00:45:36,349 --> 00:45:40,220
authenticated<font color="#E5E5E5"> user can do this a lot of</font>

1159
00:45:38,420 --> 00:45:43,940
<font color="#E5E5E5">people like</font><font color="#CCCCCC"> for example</font><font color="#E5E5E5"> the session</font>

1160
00:45:40,220 --> 00:45:46,129
enumeration the like so for a long time

1161
00:45:43,940 --> 00:45:48,170
Sam<font color="#CCCCCC"> our and session enumeration was</font>

1162
00:45:46,130 --> 00:45:50,720
enabled<font color="#E5E5E5"> by default on Windows which i</font>

1163
00:45:48,170 --> 00:45:51,619
think is a<font color="#E5E5E5"> great name which wasn't a</font>

1164
00:45:50,720 --> 00:45:55,220
good idea

1165
00:45:51,619 --> 00:45:57,140
Microsoft has since made some changes<font color="#CCCCCC"> to</font>

1166
00:45:55,220 --> 00:45:58,339
restrict<font color="#CCCCCC"> that so for example</font><font color="#E5E5E5"> modern</font>

1167
00:45:57,140 --> 00:46:01,640
versions of<font color="#CCCCCC"> Windows you can't enumerate</font>

1168
00:45:58,339 --> 00:46:03,740
the local<font color="#E5E5E5"> administrator like we said</font>

1169
00:46:01,640 --> 00:46:06,950
though there's hundreds of RPC servers

1170
00:46:03,740 --> 00:46:10,040
and many of those have<font color="#E5E5E5"> yet been fully</font>

1171
00:46:06,950 --> 00:46:11,808
analyzed and many of them allow any user

1172
00:46:10,040 --> 00:46:14,240
<font color="#E5E5E5">to connect to them interact interact</font>

1173
00:46:11,809 --> 00:46:15,470
with them and that's exactly<font color="#E5E5E5"> what we did</font>

1174
00:46:14,240 --> 00:46:21,410
<font color="#CCCCCC">with like the print</font><font color="#E5E5E5"> server one that</font>

1175
00:46:15,470 --> 00:46:23,660
there's many others so<font color="#E5E5E5"> summary access is</font>

1176
00:46:21,410 --> 00:46:25,549
<font color="#CCCCCC">more than it's more complicated we'll</font>

1177
00:46:23,660 --> 00:46:27,759
say in just<font color="#CCCCCC"> the membership that local</font>

1178
00:46:25,549 --> 00:46:29,780
administrator

1179
00:46:27,760 --> 00:46:31,609
host-based security descriptor is

1180
00:46:29,780 --> 00:46:34,220
whether<font color="#CCCCCC"> accidentally misconfigured</font>

1181
00:46:31,609 --> 00:46:36,319
<font color="#E5E5E5">configure by defaults incorrectly or</font>

1182
00:46:34,220 --> 00:46:38,240
maliciously back board<font color="#CCCCCC"> to know</font>

1183
00:46:36,319 --> 00:46:40,290
far-reaching implications for the

1184
00:46:38,240 --> 00:46:42,660
security of<font color="#E5E5E5"> other systems in the domain</font>

1185
00:46:40,290 --> 00:46:45,330
and<font color="#CCCCCC"> vice-versa you might have</font><font color="#E5E5E5"> your</font>

1186
00:46:42,660 --> 00:46:47,100
<font color="#E5E5E5">database compromised because one host</font>

1187
00:46:45,330 --> 00:46:50,359
has a misconfigured host-based security

1188
00:46:47,100 --> 00:46:52,529
<font color="#E5E5E5">descriptors</font><font color="#CCCCCC"> an</font><font color="#E5E5E5"> extremely complex system</font>

1189
00:46:50,359 --> 00:46:54,660
<font color="#CCCCCC">defenses should focus on restricting</font>

1190
00:46:52,530 --> 00:46:56,340
access to all<font color="#CCCCCC"> Sevierville</font><font color="#E5E5E5"> objects host</font>

1191
00:46:54,660 --> 00:46:58,410
<font color="#CCCCCC">Active Directory exchange sequel and</font>

1192
00:46:56,340 --> 00:47:00,359
everything<font color="#E5E5E5"> this is kind of somewhat</font>

1193
00:46:58,410 --> 00:47:01,618
uncharted territory we know we need

1194
00:47:00,359 --> 00:47:03,210
people<font color="#E5E5E5"> need to start building the</font>

1195
00:47:01,619 --> 00:47:04,859
tooling for this spread awareness and

1196
00:47:03,210 --> 00:47:06,780
things<font color="#E5E5E5"> like</font><font color="#CCCCCC"> that it's a very complicated</font>

1197
00:47:04,859 --> 00:47:12,150
problem a<font color="#CCCCCC"> very complex system but we</font>

1198
00:47:06,780 --> 00:47:13,350
<font color="#E5E5E5">think we can start tackling so that's</font>

1199
00:47:12,150 --> 00:47:14,490
pretty much<font color="#E5E5E5"> it unless we have</font><font color="#CCCCCC"> any</font>

1200
00:47:13,350 --> 00:47:17,670
<font color="#CCCCCC">questions</font><font color="#E5E5E5"> we</font><font color="#CCCCCC"> knew we started a little</font>

1201
00:47:14,490 --> 00:47:20,220
bit<font color="#E5E5E5"> early kind of I do want to give a</font>

1202
00:47:17,670 --> 00:47:22,320
<font color="#E5E5E5">little</font><font color="#CCCCCC"> shout out</font><font color="#E5E5E5"> to alleged Amir</font><font color="#CCCCCC"> I've</font>

1203
00:47:20,220 --> 00:47:24,509
interacted<font color="#CCCCCC"> with him previously</font><font color="#E5E5E5"> he also</font>

1204
00:47:22,320 --> 00:47:26,460
<font color="#E5E5E5">subsequently found that printer birth</font>

1205
00:47:24,510 --> 00:47:29,030
<font color="#CCCCCC">date so I just want</font><font color="#E5E5E5"> to give a shout out</font>

1206
00:47:26,460 --> 00:47:29,030
<font color="#E5E5E5">to</font><font color="#CCCCCC"> him as well</font>

1207
00:47:33,540 --> 00:47:43,450
[Applause]

