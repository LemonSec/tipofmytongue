1
00:00:00,260 --> 00:00:09,240
hello<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is a Foxtrot</font><font color="#E5E5E5"> journey of a</font>

2
00:00:05,819 --> 00:00:14,910
payload delivery<font color="#CCCCCC"> I am Demetrius</font><font color="#E5E5E5"> Nash</font><font color="#CCCCCC"> car</font>

3
00:00:09,240 --> 00:00:18,539
<font color="#E5E5E5">work 4x4 shred</font><font color="#CCCCCC"> officially</font><font color="#E5E5E5"> managing</font>

4
00:00:14,910 --> 00:00:21,380
consultant<font color="#CCCCCC"> IBM</font><font color="#E5E5E5"> corporation x4 shred but</font>

5
00:00:18,539 --> 00:00:25,439
really<font color="#CCCCCC"> just</font><font color="#E5E5E5"> work and code application</font>

6
00:00:21,380 --> 00:00:30,179
<font color="#E5E5E5">networks human sometimes code and so</font>

7
00:00:25,439 --> 00:00:33,450
today I wanted to share an experience or

8
00:00:30,179 --> 00:00:36,480
a few things that we see out there<font color="#E5E5E5"> when</font>

9
00:00:33,450 --> 00:00:39,200
we<font color="#E5E5E5"> do</font><font color="#CCCCCC"> Red Team assessments</font><font color="#E5E5E5"> and some of</font>

10
00:00:36,480 --> 00:00:42,239
the<font color="#E5E5E5"> things that</font><font color="#CCCCCC"> we come across</font><font color="#E5E5E5"> and how</font>

11
00:00:39,200 --> 00:00:45,030
maybe we solved<font color="#E5E5E5"> the pain point that we</font>

12
00:00:42,239 --> 00:00:50,430
had with<font color="#CCCCCC"> gradient</font><font color="#E5E5E5"> some custom tooling</font>

13
00:00:45,030 --> 00:00:52,160
<font color="#E5E5E5">right so if you're doing red team</font>

14
00:00:50,430 --> 00:00:55,980
<font color="#E5E5E5">exercises or any kind of offensive</font>

15
00:00:52,160 --> 00:00:59,309
adversary simulation<font color="#E5E5E5"> or even phishing</font>

16
00:00:55,980 --> 00:01:01,199
attempts right<font color="#E5E5E5"> sometimes you come to</font>

17
00:00:59,309 --> 00:01:03,570
realization<font color="#E5E5E5"> that when you send</font><font color="#CCCCCC"> a payload</font>

18
00:01:01,199 --> 00:01:06,780
<font color="#CCCCCC">that</font><font color="#E5E5E5"> payload doesn't make it to</font><font color="#CCCCCC"> the end</font>

19
00:01:03,570 --> 00:01:09,750
user<font color="#CCCCCC"> let alone getting detonated it just</font>

20
00:01:06,780 --> 00:01:12,210
doesn't make<font color="#E5E5E5"> it because you're</font><font color="#CCCCCC"> sending</font>

21
00:01:09,750 --> 00:01:14,369
from<font color="#E5E5E5"> the outside and sometimes you just</font>

22
00:01:12,210 --> 00:01:19,139
<font color="#E5E5E5">can't prototype all the things that</font>

23
00:01:14,369 --> 00:01:21,990
going<font color="#E5E5E5"> on on the wire</font><font color="#CCCCCC"> that stopped</font><font color="#E5E5E5"> your</font>

24
00:01:19,140 --> 00:01:24,390
<font color="#E5E5E5">payload could it be the link checker</font><font color="#CCCCCC"> if</font>

25
00:01:21,990 --> 00:01:27,199
you send the link<font color="#E5E5E5"> in the</font><font color="#CCCCCC"> email was the</font>

26
00:01:24,390 --> 00:01:29,790
user able to<font color="#E5E5E5"> navigate to your payload</font>

27
00:01:27,200 --> 00:01:33,479
was it because you hosted<font color="#E5E5E5"> your payload</font>

28
00:01:29,790 --> 00:01:36,810
on the side that<font color="#CCCCCC"> doesn't really have a</font>

29
00:01:33,479 --> 00:01:38,549
good domain<font color="#E5E5E5"> ranking at the time maybe</font>

30
00:01:36,810 --> 00:01:40,110
your<font color="#CCCCCC"> forum app or extension</font><font color="#E5E5E5"> of your</font>

31
00:01:38,549 --> 00:01:43,079
payload<font color="#CCCCCC"> that you're trying</font><font color="#E5E5E5"> to ship to</font>

32
00:01:40,110 --> 00:01:44,520
the<font color="#E5E5E5"> user is just not being supportive or</font>

33
00:01:43,079 --> 00:01:48,360
they don't<font color="#CCCCCC"> have</font><font color="#E5E5E5"> the tools to unwrap it</font>

34
00:01:44,520 --> 00:01:50,970
and then this realization that 30

35
00:01:48,360 --> 00:01:55,350
minutes after you sent your payload<font color="#CCCCCC"> you</font>

36
00:01:50,970 --> 00:01:58,439
have a frenzy<font color="#E5E5E5"> of</font><font color="#CCCCCC"> sandboxes visiting your</font>

37
00:01:55,350 --> 00:02:00,929
c2 server<font color="#E5E5E5"> trying to</font><font color="#CCCCCC"> communicate</font><font color="#E5E5E5"> with</font>

38
00:01:58,439 --> 00:02:04,139
your CI server by obviously<font color="#CCCCCC"> getting</font><font color="#E5E5E5"> the</font>

39
00:02:00,930 --> 00:02:06,000
payload so at<font color="#E5E5E5"> that time you</font><font color="#CCCCCC"> move into</font>

40
00:02:04,140 --> 00:02:09,300
<font color="#CCCCCC">operation</font><font color="#E5E5E5"> security mode where you</font>

41
00:02:06,000 --> 00:02:12,209
<font color="#CCCCCC">basically say well can</font><font color="#E5E5E5"> I minimize the</font>

42
00:02:09,300 --> 00:02:13,910
attribution can I avoid<font color="#E5E5E5"> the attribution</font>

43
00:02:12,209 --> 00:02:16,100
<font color="#E5E5E5">what do I do next</font>

44
00:02:13,910 --> 00:02:20,420
do I create the different<font color="#CCCCCC"> pre-tax</font><font color="#E5E5E5"> that I</font>

45
00:02:16,100 --> 00:02:23,470
sent to<font color="#E5E5E5"> users my vector is burnt my</font>

46
00:02:20,420 --> 00:02:30,170
payload<font color="#E5E5E5"> is</font><font color="#CCCCCC"> burnt what do</font><font color="#E5E5E5"> i do do</font><font color="#CCCCCC"> i</font>

47
00:02:23,470 --> 00:02:31,820
recode it so in my experience<font color="#CCCCCC"> there</font><font color="#E5E5E5"> are</font>

48
00:02:30,170 --> 00:02:34,429
two types of<font color="#CCCCCC"> customers right or</font>

49
00:02:31,820 --> 00:02:39,049
companies<font color="#E5E5E5"> some are very very good with</font>

50
00:02:34,430 --> 00:02:41,480
<font color="#E5E5E5">host based</font><font color="#CCCCCC"> deduction</font><font color="#E5E5E5"> they use EDR on</font>

51
00:02:39,050 --> 00:02:43,610
<font color="#CCCCCC">host</font><font color="#E5E5E5"> they unwrap your payload and that's</font>

52
00:02:41,480 --> 00:02:46,489
how you get burned<font color="#E5E5E5"> but there are other</font>

53
00:02:43,610 --> 00:02:49,280
customers<font color="#CCCCCC"> that have very</font><font color="#E5E5E5"> tight in-flight</font>

54
00:02:46,490 --> 00:02:53,390
defense<font color="#E5E5E5"> meaning</font><font color="#CCCCCC"> that the network</font><font color="#E5E5E5"> is what</font>

55
00:02:49,280 --> 00:02:55,460
burns you<font color="#E5E5E5"> and essentially the problem of</font>

56
00:02:53,390 --> 00:02:58,940
a red team here is<font color="#E5E5E5"> that you really can't</font>

57
00:02:55,460 --> 00:03:01,520
prototype a lot of the network defenses

58
00:02:58,940 --> 00:03:03,260
<font color="#CCCCCC">because you can't</font><font color="#E5E5E5"> prototype you know</font>

59
00:03:01,520 --> 00:03:05,390
solutions that are happening on the wire

60
00:03:03,260 --> 00:03:08,269
at that<font color="#E5E5E5"> customer well you can't buy a</font>

61
00:03:05,390 --> 00:03:10,940
EDR<font color="#E5E5E5"> for the host you</font><font color="#CCCCCC"> can buy in an ER</font>

62
00:03:08,270 --> 00:03:14,060
for<font color="#CCCCCC"> AV it's kind of</font><font color="#E5E5E5"> challenging</font><font color="#CCCCCC"> to get</font>

63
00:03:10,940 --> 00:03:16,130
the same thing<font color="#E5E5E5"> going for the network so</font>

64
00:03:14,060 --> 00:03:17,720
in this talk<font color="#CCCCCC"> let's go through some of</font>

65
00:03:16,130 --> 00:03:22,370
<font color="#CCCCCC">the</font><font color="#E5E5E5"> things that we've seen</font><font color="#CCCCCC"> and how we</font>

66
00:03:17,720 --> 00:03:24,830
minimize<font color="#E5E5E5"> them so strike one and me if</font>

67
00:03:22,370 --> 00:03:27,350
we're talking<font color="#E5E5E5"> about in-flight detection</font>

68
00:03:24,830 --> 00:03:29,870
is<font color="#E5E5E5"> traffic correlation</font><font color="#CCCCCC"> some things some</font>

69
00:03:27,350 --> 00:03:33,079
known<font color="#E5E5E5"> packets or signature</font><font color="#CCCCCC"> way back</font><font color="#E5E5E5"> and</font>

70
00:03:29,870 --> 00:03:36,310
<font color="#E5E5E5">gets pulled out if you rely on your tail</font>

71
00:03:33,080 --> 00:03:40,160
less by doing<font color="#E5E5E5"> HTTP or whatever custom</font>

72
00:03:36,310 --> 00:03:41,990
SSL encryption you're doing<font color="#E5E5E5"> you will get</font>

73
00:03:40,160 --> 00:03:44,410
on<font color="#CCCCCC"> wrapped</font><font color="#E5E5E5"> and when it gets unwrapped</font>

74
00:03:41,990 --> 00:03:47,660
your payload is naked

75
00:03:44,410 --> 00:03:49,640
you have<font color="#E5E5E5"> behavioral patterns you have a</font>

76
00:03:47,660 --> 00:03:53,299
load type and frequency of communication

77
00:03:49,640 --> 00:03:55,279
<font color="#E5E5E5">to your</font><font color="#CCCCCC"> c2 once you deploy</font><font color="#E5E5E5"> that if</font>

78
00:03:53,300 --> 00:04:00,350
<font color="#E5E5E5">people are actually watching on the</font>

79
00:03:55,280 --> 00:04:02,720
network gets<font color="#E5E5E5"> your burn and so what it</font>

80
00:04:00,350 --> 00:04:04,579
<font color="#CCCCCC">comes down to is that</font><font color="#E5E5E5"> if we as</font><font color="#CCCCCC"> Red Team</font>

81
00:04:02,720 --> 00:04:07,970
operators allow<font color="#E5E5E5"> defenders to build a</font>

82
00:04:04,580 --> 00:04:09,709
story to the point where they may not

83
00:04:07,970 --> 00:04:12,500
even<font color="#E5E5E5"> know</font><font color="#CCCCCC"> what</font><font color="#E5E5E5"> that is but if they know</font>

84
00:04:09,709 --> 00:04:15,560
<font color="#CCCCCC">that it's known bad or unknown bad or</font>

85
00:04:12,500 --> 00:04:17,930
they get some form of alerting<font color="#E5E5E5"> us</font><font color="#CCCCCC"> to</font>

86
00:04:15,560 --> 00:04:22,660
what they need to look at we've already

87
00:04:17,930 --> 00:04:24,919
lost<font color="#E5E5E5"> so strike two is with the sandbox</font>

88
00:04:22,660 --> 00:04:26,510
<font color="#E5E5E5">struct strike two is really about</font>

89
00:04:24,919 --> 00:04:28,370
payload sampling

90
00:04:26,510 --> 00:04:31,659
the<font color="#CCCCCC"> frenzy that</font><font color="#E5E5E5"> you've seen on your end</font>

91
00:04:28,370 --> 00:04:35,830
when<font color="#E5E5E5"> fifteen or thirty peel different</font>

92
00:04:31,660 --> 00:04:38,210
sandbox hybrid analysis<font color="#E5E5E5"> virustotal</font>

93
00:04:35,830 --> 00:04:40,280
<font color="#CCCCCC">McAfee</font><font color="#E5E5E5"> Falcon doesn't matter right</font>

94
00:04:38,210 --> 00:04:41,030
visits you<font color="#E5E5E5"> and tries to analyze your</font>

95
00:04:40,280 --> 00:04:44,150
patterns

96
00:04:41,030 --> 00:04:46,640
that's a payload sampling if one doesn't

97
00:04:44,150 --> 00:04:49,909
<font color="#E5E5E5">get you Dada will be able to get you and</font>

98
00:04:46,640 --> 00:04:52,610
share it with<font color="#CCCCCC"> the community so</font>

99
00:04:49,910 --> 00:04:54,440
correlation<font color="#E5E5E5"> rules is if if your payload</font>

100
00:04:52,610 --> 00:04:57,140
actually makes it past the initial

101
00:04:54,440 --> 00:04:58,730
<font color="#CCCCCC">network interception the secondary</font>

102
00:04:57,140 --> 00:05:01,460
interaction is where the correlation

103
00:04:58,730 --> 00:05:03,610
<font color="#E5E5E5">rules on the internal network</font><font color="#CCCCCC"> how fast</font>

104
00:05:01,460 --> 00:05:06,260
does the payload spread where does it go

105
00:05:03,610 --> 00:05:08,510
which users or how travels on<font color="#CCCCCC"> the</font>

106
00:05:06,260 --> 00:05:10,250
network<font color="#E5E5E5"> and</font><font color="#CCCCCC"> then again it's your</font>

107
00:05:08,510 --> 00:05:12,650
submission<font color="#E5E5E5"> to the cloud to analysis</font>

108
00:05:10,250 --> 00:05:13,990
engine<font color="#CCCCCC"> and you cannot choose your</font>

109
00:05:12,650 --> 00:05:16,760
payload anymore

110
00:05:13,990 --> 00:05:18,440
strike three is everything that<font color="#E5E5E5"> basic</font>

111
00:05:16,760 --> 00:05:21,380
<font color="#E5E5E5">list surrounds your ability to deliver</font>

112
00:05:18,440 --> 00:05:23,870
deliver across<font color="#E5E5E5"> the wire</font><font color="#CCCCCC"> it's your link</font>

113
00:05:21,380 --> 00:05:27,170
inspectors<font color="#E5E5E5"> it's your domain the main</font>

114
00:05:23,870 --> 00:05:29,180
ranking the attribution capabilities

115
00:05:27,170 --> 00:05:34,730
that<font color="#E5E5E5"> exist</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> the company and so on and</font>

116
00:05:29,180 --> 00:05:36,860
so forth let's minimize<font color="#E5E5E5"> that so we</font>

117
00:05:34,730 --> 00:05:39,020
started thinking<font color="#E5E5E5"> what</font><font color="#CCCCCC"> would be the</font><font color="#E5E5E5"> the</font>

118
00:05:36,860 --> 00:05:41,420
improvement<font color="#E5E5E5"> against certain things that</font>

119
00:05:39,020 --> 00:05:44,599
happen on<font color="#E5E5E5"> the wire we know how to solve</font>

120
00:05:41,420 --> 00:05:47,030
issues to the better<font color="#CCCCCC"> or worse</font><font color="#E5E5E5"> on</font><font color="#CCCCCC"> the EDR</font>

121
00:05:44,600 --> 00:05:50,030
<font color="#E5E5E5">and a host but we have no idea</font><font color="#CCCCCC"> of what</font>

122
00:05:47,030 --> 00:05:52,929
<font color="#E5E5E5">to do with</font><font color="#CCCCCC"> the network</font><font color="#E5E5E5"> so primary goals</font>

123
00:05:50,030 --> 00:05:56,570
for<font color="#CCCCCC"> us to</font><font color="#E5E5E5"> deliver a payload would be</font>

124
00:05:52,930 --> 00:05:58,750
obviously it's a hostile traffic<font color="#CCCCCC"> it's</font>

125
00:05:56,570 --> 00:06:02,000
inspection so we<font color="#E5E5E5"> should not rely on TLS</font>

126
00:05:58,750 --> 00:06:04,970
we should be able<font color="#E5E5E5"> to have the email or</font>

127
00:06:02,000 --> 00:06:07,240
<font color="#E5E5E5">the link if it's clear reach out to the</font>

128
00:06:04,970 --> 00:06:10,970
<font color="#E5E5E5">to</font><font color="#CCCCCC"> an external</font><font color="#E5E5E5"> payload or external</font>

129
00:06:07,240 --> 00:06:12,770
entity that basically downloads the if

130
00:06:10,970 --> 00:06:14,720
you have a stager download the payload

131
00:06:12,770 --> 00:06:17,900
if you have a<font color="#E5E5E5"> payload downloads and some</font>

132
00:06:14,720 --> 00:06:19,910
other capabilities we should go<font color="#CCCCCC"> around</font>

133
00:06:17,900 --> 00:06:24,229
the<font color="#CCCCCC"> same</font><font color="#E5E5E5"> boxes that try to repeatably</font>

134
00:06:19,910 --> 00:06:26,360
sample our<font color="#E5E5E5"> payload and techniques and</font>

135
00:06:24,230 --> 00:06:28,910
<font color="#E5E5E5">obviously you know it's nice to have</font>

136
00:06:26,360 --> 00:06:31,190
attribution minimization<font color="#E5E5E5"> it's nice to be</font>

137
00:06:28,910 --> 00:06:34,340
able<font color="#E5E5E5"> to work through the link inspectors</font>

138
00:06:31,190 --> 00:06:36,050
<font color="#CCCCCC">and it's nice when somebody</font><font color="#E5E5E5"> on the other</font>

139
00:06:34,340 --> 00:06:38,419
<font color="#E5E5E5">side can actually use your payload</font>

140
00:06:36,050 --> 00:06:39,750
<font color="#E5E5E5">because you can</font><font color="#CCCCCC"> create a payload that is</font>

141
00:06:38,420 --> 00:06:42,960
completely

142
00:06:39,750 --> 00:06:46,260
fasten<font color="#E5E5E5"> the defenses but it's not usable</font>

143
00:06:42,960 --> 00:06:49,080
<font color="#E5E5E5">because the other side the</font><font color="#CCCCCC"> the customer</font>

144
00:06:46,260 --> 00:06:52,349
declined the mark<font color="#E5E5E5"> doesn't</font><font color="#CCCCCC"> have</font><font color="#E5E5E5"> the tools</font>

145
00:06:49,080 --> 00:06:56,700
<font color="#CCCCCC">to use</font><font color="#E5E5E5"> it it's like in an application</font>

146
00:06:52,350 --> 00:06:59,760
<font color="#CCCCCC">support so we started looking for things</font>

147
00:06:56,700 --> 00:07:01,800
that<font color="#E5E5E5"> may potentially you know aid us in</font>

148
00:06:59,760 --> 00:07:05,130
<font color="#E5E5E5">our quest</font><font color="#CCCCCC"> and one of the things that we</font>

149
00:07:01,800 --> 00:07:08,250
came<font color="#E5E5E5"> across</font><font color="#CCCCCC"> was</font><font color="#E5E5E5"> Firefox sent service</font><font color="#CCCCCC"> I</font>

150
00:07:05,130 --> 00:07:10,350
think of it as<font color="#E5E5E5"> Dropbox or box or any</font>

151
00:07:08,250 --> 00:07:13,230
other sharing mechanism and<font color="#E5E5E5"> basically</font>

152
00:07:10,350 --> 00:07:15,150
says<font color="#CCCCCC"> ok</font><font color="#E5E5E5"> drop us your file will get you</font>

153
00:07:13,230 --> 00:07:17,940
the links<font color="#E5E5E5"> and that link to a user that</font>

154
00:07:15,150 --> 00:07:20,400
<font color="#CCCCCC">needs to get it</font><font color="#E5E5E5"> you get the payload in</font>

155
00:07:17,940 --> 00:07:22,410
this case<font color="#CCCCCC"> we're working with</font><font color="#E5E5E5"> a browser</font>

156
00:07:20,400 --> 00:07:25,169
<font color="#E5E5E5">we go into the browser we're basically</font>

157
00:07:22,410 --> 00:07:28,440
dropping<font color="#CCCCCC"> in</font><font color="#E5E5E5"> JPEG file it gets somehow</font>

158
00:07:25,169 --> 00:07:31,020
encrypted<font color="#E5E5E5"> it gets stored in manner on</font>

159
00:07:28,440 --> 00:07:34,230
the<font color="#CCCCCC"> Firefox servers or</font><font color="#E5E5E5"> Mozilla servers</font>

160
00:07:31,020 --> 00:07:36,419
and then the user goes out<font color="#CCCCCC"> gets the link</font>

161
00:07:34,230 --> 00:07:39,330
on the other side<font color="#CCCCCC"> I'm grabs it and</font>

162
00:07:36,419 --> 00:07:41,370
<font color="#E5E5E5">downloads</font><font color="#CCCCCC"> that JPEG</font><font color="#E5E5E5"> it seems easy very</font>

163
00:07:39,330 --> 00:07:44,039
easy<font color="#E5E5E5"> service it gives you the link</font>

164
00:07:41,370 --> 00:07:46,110
if the link exists you download<font color="#CCCCCC"> it to</font>

165
00:07:44,040 --> 00:07:50,250
the<font color="#E5E5E5"> billing expires and doesn't exist</font>

166
00:07:46,110 --> 00:07:52,530
then the user can<font color="#CCCCCC"> download so we started</font>

167
00:07:50,250 --> 00:07:55,830
<font color="#E5E5E5">looking at this Firefox</font><font color="#CCCCCC"> sound private</font>

168
00:07:52,530 --> 00:07:58,500
service and we<font color="#E5E5E5"> thought</font><font color="#CCCCCC"> ok well what</font><font color="#E5E5E5"> are</font>

169
00:07:55,830 --> 00:08:00,719
the advantages of solving all<font color="#CCCCCC"> of our</font>

170
00:07:58,500 --> 00:08:02,790
issues<font color="#CCCCCC"> or some parts</font><font color="#E5E5E5"> of our issues</font>

171
00:08:00,720 --> 00:08:05,940
really well it's built<font color="#E5E5E5"> with web crypto</font>

172
00:08:02,790 --> 00:08:07,770
API which is a standard way of using

173
00:08:05,940 --> 00:08:12,030
encryption<font color="#CCCCCC"> in</font><font color="#E5E5E5"> JavaScript and browsers</font>

174
00:08:07,770 --> 00:08:15,659
and so that's how the<font color="#E5E5E5"> the Mozilla is</font>

175
00:08:12,030 --> 00:08:17,609
able to store encrypted payload or in

176
00:08:15,660 --> 00:08:18,090
this<font color="#CCCCCC"> guy's in this case any kind of file</font>

177
00:08:17,610 --> 00:08:20,610
right

178
00:08:18,090 --> 00:08:24,119
it's a browser encryption symmetric

179
00:08:20,610 --> 00:08:26,160
encryption keys get stored in the URL

180
00:08:24,120 --> 00:08:27,450
<font color="#E5E5E5">and then that URL actually unwraps it in</font>

181
00:08:26,160 --> 00:08:30,930
the<font color="#CCCCCC"> browser's it's a browser to browser</font>

182
00:08:27,450 --> 00:08:33,990
communication<font color="#E5E5E5"> keep that in</font><font color="#CCCCCC"> mind the</font>

183
00:08:30,930 --> 00:08:36,330
actual server is<font color="#E5E5E5"> open-source</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> can be</font>

184
00:08:33,990 --> 00:08:39,180
hosted<font color="#CCCCCC"> through Mozilla or or it can be</font>

185
00:08:36,330 --> 00:08:41,370
hosted<font color="#CCCCCC"> on your own domain</font><font color="#E5E5E5"> and so that</font>

186
00:08:39,179 --> 00:08:42,929
here's the traffic<font color="#E5E5E5"> that we actually see</font>

187
00:08:41,370 --> 00:08:45,540
the<font color="#E5E5E5"> request</font><font color="#CCCCCC"> actually goes out</font><font color="#E5E5E5"> to the</font>

188
00:08:42,929 --> 00:08:48,000
<font color="#E5E5E5">upload you know</font><font color="#CCCCCC"> you drop a file and what</font>

189
00:08:45,540 --> 00:08:50,400
you get is some form of descriptor the

190
00:08:48,000 --> 00:08:52,000
descriptor for<font color="#E5E5E5"> the resource and you get</font>

191
00:08:50,400 --> 00:08:56,300
the decryption<font color="#E5E5E5"> key</font>

192
00:08:52,000 --> 00:08:58,399
in some form appended to the URL<font color="#E5E5E5"> okay</font>

193
00:08:56,300 --> 00:09:00,439
that's what<font color="#E5E5E5"> you sent to the other user</font>

194
00:08:58,399 --> 00:09:02,149
in phishing exercises or if you want to

195
00:09:00,440 --> 00:09:04,670
work on<font color="#E5E5E5"> the inside</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> get your payloads</font>

196
00:09:02,149 --> 00:09:07,279
from the outside or your tools into the

197
00:09:04,670 --> 00:09:10,790
enterprise<font color="#E5E5E5"> that's what you will do so</font>

198
00:09:07,279 --> 00:09:13,850
<font color="#CCCCCC">goal number one was to</font><font color="#E5E5E5"> avoid traffic</font>

199
00:09:10,790 --> 00:09:16,760
<font color="#E5E5E5">inspection during</font><font color="#CCCCCC"> the TLS</font><font color="#E5E5E5"> right and so</font>

200
00:09:13,850 --> 00:09:19,310
what happens here<font color="#CCCCCC"> is that</font><font color="#E5E5E5"> an acci or a</font>

201
00:09:16,760 --> 00:09:23,060
file or Japan gets symmetrically

202
00:09:19,310 --> 00:09:25,880
encrypted<font color="#CCCCCC"> and that's what you know the</font>

203
00:09:23,060 --> 00:09:29,540
user of the user actually retrieves on

204
00:09:25,880 --> 00:09:31,640
the other end<font color="#E5E5E5"> curiously to know that the</font>

205
00:09:29,540 --> 00:09:36,500
proxy<font color="#CCCCCC"> that</font><font color="#E5E5E5"> basically does</font><font color="#CCCCCC"> the inspection</font>

206
00:09:31,640 --> 00:09:39,829
happens<font color="#E5E5E5"> so the the payload travels</font>

207
00:09:36,500 --> 00:09:41,630
across the<font color="#E5E5E5"> hostile customer</font><font color="#CCCCCC"> network</font>

208
00:09:39,829 --> 00:09:44,149
<font color="#E5E5E5">right and it ends in the browser on</font><font color="#CCCCCC"> the</font>

209
00:09:41,630 --> 00:09:46,790
<font color="#E5E5E5">other side at that point any kind of</font>

210
00:09:44,149 --> 00:09:48,829
<font color="#CCCCCC">unraveling</font><font color="#E5E5E5"> TLS or proxy happened</font>

211
00:09:46,790 --> 00:09:50,540
they<font color="#CCCCCC"> unwrap the TLS they do not see</font>

212
00:09:48,829 --> 00:09:56,300
anything except for<font color="#E5E5E5"> the encrypted block</font>

213
00:09:50,540 --> 00:09:58,310
<font color="#E5E5E5">blob blob of data and so the the link</font>

214
00:09:56,300 --> 00:10:00,170
gets posted<font color="#CCCCCC"> into Mozilla you download</font>

215
00:09:58,310 --> 00:10:01,910
the<font color="#E5E5E5"> JavaScript you unwrap the payload</font>

216
00:10:00,170 --> 00:10:05,209
<font color="#E5E5E5">and you download the file it's very</font>

217
00:10:01,910 --> 00:10:07,010
handy right<font color="#E5E5E5"> so the proxy or traffic</font>

218
00:10:05,209 --> 00:10:09,020
inspection is not<font color="#E5E5E5"> in in the picture</font>

219
00:10:07,010 --> 00:10:10,870
<font color="#CCCCCC">anymore we don't</font><font color="#E5E5E5"> have to generate the</font>

220
00:10:09,020 --> 00:10:13,730
<font color="#CCCCCC">shared</font><font color="#E5E5E5"> is either because those are</font>

221
00:10:10,870 --> 00:10:19,660
prepended and generated for<font color="#CCCCCC"> us</font><font color="#E5E5E5"> by</font>

222
00:10:13,730 --> 00:10:22,970
<font color="#CCCCCC">mozilla itself the second goal is to</font>

223
00:10:19,660 --> 00:10:24,890
<font color="#CCCCCC">actually reach for the payload from from</font>

224
00:10:22,970 --> 00:10:27,649
the customer<font color="#CCCCCC"> network a lot of things</font>

225
00:10:24,890 --> 00:10:30,620
play towards it but<font color="#CCCCCC"> firefox comm is</font>

226
00:10:27,649 --> 00:10:33,950
mostly trusted and so when the user<font color="#E5E5E5"> gets</font>

227
00:10:30,620 --> 00:10:36,589
a fish<font color="#E5E5E5"> and tries</font><font color="#CCCCCC"> to go out you</font><font color="#E5E5E5"> know all</font>

228
00:10:33,950 --> 00:10:39,230
your content ranking will probably allow

229
00:10:36,589 --> 00:10:41,930
<font color="#CCCCCC">you to allow the user to to be able to</font>

230
00:10:39,230 --> 00:10:43,790
<font color="#CCCCCC">get to</font><font color="#E5E5E5"> firefox</font><font color="#CCCCCC"> comm so we started</font>

231
00:10:41,930 --> 00:10:46,489
thinking<font color="#E5E5E5"> well how do we weaponize this</font>

232
00:10:43,790 --> 00:10:48,769
thing<font color="#E5E5E5"> so let's split it into three</font><font color="#CCCCCC"> areas</font>

233
00:10:46,490 --> 00:10:51,140
<font color="#CCCCCC">the red which is</font><font color="#E5E5E5"> us trying to push the</font>

234
00:10:48,769 --> 00:10:54,140
<font color="#E5E5E5">pail over to the customer degree in the</font>

235
00:10:51,140 --> 00:10:56,600
<font color="#E5E5E5">mozilla the trusted entity the middleman</font>

236
00:10:54,140 --> 00:10:58,750
so<font color="#E5E5E5"> to speak and the blue network which</font>

237
00:10:56,600 --> 00:11:03,200
is the<font color="#E5E5E5"> customer network</font>

238
00:10:58,750 --> 00:11:04,790
in this case we can we've proven the two

239
00:11:03,200 --> 00:11:10,000
goals right let's let's move to number

240
00:11:04,790 --> 00:11:13,430
<font color="#E5E5E5">three so we can deliver the payload but</font>

241
00:11:10,000 --> 00:11:16,730
in the in the event<font color="#CCCCCC"> that somehow</font><font color="#E5E5E5"> it gets</font>

242
00:11:13,430 --> 00:11:18,739
<font color="#E5E5E5">flagged in the middle maybe there is a</font>

243
00:11:16,730 --> 00:11:21,050
way to fingerprint<font color="#CCCCCC"> once you unwrap the</font>

244
00:11:18,740 --> 00:11:23,050
<font color="#E5E5E5">TLS how do we minimize the capability</font>

245
00:11:21,050 --> 00:11:25,699
for<font color="#E5E5E5"> sandboxes to actually go</font><font color="#CCCCCC"> out to</font><font color="#E5E5E5"> our</font>

246
00:11:23,050 --> 00:11:28,130
hosting server and and grab the payload

247
00:11:25,700 --> 00:11:29,630
well it turns<font color="#E5E5E5"> out that mozilla sensor</font>

248
00:11:28,130 --> 00:11:31,490
ver provides us with<font color="#E5E5E5"> the really</font>

249
00:11:29,630 --> 00:11:33,680
convenient features which are<font color="#CCCCCC"> really</font>

250
00:11:31,490 --> 00:11:35,900
<font color="#E5E5E5">great</font><font color="#CCCCCC"> they're really good</font><font color="#E5E5E5"> for users</font>

251
00:11:33,680 --> 00:11:40,069
<font color="#CCCCCC">they're useful</font><font color="#E5E5E5"> features</font><font color="#CCCCCC"> for example you</font>

252
00:11:35,900 --> 00:11:42,170
can expire<font color="#E5E5E5"> the link you can state the</font>

253
00:11:40,070 --> 00:11:45,050
number<font color="#E5E5E5"> of times</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> can get downloaded</font>

254
00:11:42,170 --> 00:11:47,780
and<font color="#CCCCCC"> mozilla gives you a very generous</font>

255
00:11:45,050 --> 00:11:50,719
size limit on<font color="#CCCCCC"> your file for</font><font color="#E5E5E5"> example</font><font color="#CCCCCC"> if</font>

256
00:11:47,780 --> 00:11:53,270
you want<font color="#E5E5E5"> to store a toolkit one gig</font>

257
00:11:50,720 --> 00:11:55,550
should be enough<font color="#CCCCCC"> for</font><font color="#E5E5E5"> you and of course</font>

258
00:11:53,270 --> 00:11:57,680
you can expire them you know in 24 hours

259
00:11:55,550 --> 00:11:59,900
<font color="#E5E5E5">and be done with it</font><font color="#CCCCCC"> so for example if</font>

260
00:11:57,680 --> 00:12:01,790
you do not want to attack that customer

261
00:11:59,900 --> 00:12:04,130
if you do not want to you know the<font color="#E5E5E5"> users</font>

262
00:12:01,790 --> 00:12:07,280
download that payment you can just leave

263
00:12:04,130 --> 00:12:09,140
it<font color="#CCCCCC"> that's gonna</font><font color="#E5E5E5"> be gone</font><font color="#CCCCCC"> in 24</font><font color="#E5E5E5"> hours you</font>

264
00:12:07,280 --> 00:12:11,270
can also forcefully delete your<font color="#E5E5E5"> payload</font>

265
00:12:09,140 --> 00:12:15,770
if you want to you can<font color="#CCCCCC"> put password on</font>

266
00:12:11,270 --> 00:12:18,560
it<font color="#CCCCCC"> if you choose to okay</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> onto</font><font color="#E5E5E5"> number</font>

267
00:12:15,770 --> 00:12:21,380
<font color="#CCCCCC">and number for many minimization of</font>

268
00:12:18,560 --> 00:12:25,430
<font color="#E5E5E5">attribution in the beginning when</font><font color="#CCCCCC"> we</font>

269
00:12:21,380 --> 00:12:27,470
start talking about Firefox and what we

270
00:12:25,430 --> 00:12:29,150
said is that<font color="#E5E5E5"> it's like draw a box or a</font>

271
00:12:27,470 --> 00:12:31,250
light it's like box or maybe<font color="#CCCCCC"> Google</font>

272
00:12:29,150 --> 00:12:33,800
sharing but it's really not it's

273
00:12:31,250 --> 00:12:36,230
<font color="#CCCCCC">anonymous you do</font><font color="#E5E5E5"> not have to have a</font>

274
00:12:33,800 --> 00:12:38,270
credential<font color="#CCCCCC"> or</font><font color="#E5E5E5"> SATA credentials or user</font>

275
00:12:36,230 --> 00:12:41,150
ID<font color="#E5E5E5"> and a password</font><font color="#CCCCCC"> to be able</font><font color="#E5E5E5"> to sign</font><font color="#CCCCCC"> up</font>

276
00:12:38,270 --> 00:12:44,660
<font color="#CCCCCC">for this</font><font color="#E5E5E5"> ID you come in you drop the</font>

277
00:12:41,150 --> 00:12:46,400
<font color="#E5E5E5">file mean you just get</font><font color="#CCCCCC"> a link and every</font>

278
00:12:44,660 --> 00:12:48,500
time you<font color="#E5E5E5"> drop the same file you get it</font>

279
00:12:46,400 --> 00:12:51,589
<font color="#E5E5E5">differently and every time you drop</font><font color="#CCCCCC"> the</font>

280
00:12:48,500 --> 00:12:54,530
<font color="#CCCCCC">file to</font><font color="#E5E5E5"> get a different shared key so</font>

281
00:12:51,589 --> 00:12:58,130
essentially if defense<font color="#E5E5E5"> gets our payload</font>

282
00:12:54,530 --> 00:13:01,310
<font color="#E5E5E5">and signatures off of the either a</font>

283
00:12:58,130 --> 00:13:04,450
decryption<font color="#E5E5E5"> key hash or maybe a resource</font>

284
00:13:01,310 --> 00:13:08,000
ID that's not gonna<font color="#E5E5E5"> help them</font>

285
00:13:04,450 --> 00:13:10,790
so number<font color="#E5E5E5"> five capability to minimize</font>

286
00:13:08,000 --> 00:13:13,460
<font color="#CCCCCC">response from link inspectors well</font>

287
00:13:10,790 --> 00:13:16,760
that's really<font color="#E5E5E5"> just a good side byproduct</font>

288
00:13:13,460 --> 00:13:19,300
of<font color="#E5E5E5"> using Firefox comm Firefox comm looks</font>

289
00:13:16,760 --> 00:13:24,100
much<font color="#E5E5E5"> better</font><font color="#CCCCCC"> than any other</font><font color="#E5E5E5"> side that you</font>

290
00:13:19,300 --> 00:13:26,810
<font color="#CCCCCC">probably created in the past two days</font><font color="#E5E5E5"> so</font>

291
00:13:24,100 --> 00:13:29,570
<font color="#CCCCCC">what</font><font color="#E5E5E5"> do we get with this we get full the</font>

292
00:13:26,810 --> 00:13:31,849
custom application encryption we get

293
00:13:29,570 --> 00:13:34,210
full support<font color="#E5E5E5"> on</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> JavaScript</font><font color="#CCCCCC"> because</font>

294
00:13:31,850 --> 00:13:37,370
it's a JavaScript browser web crypto API

295
00:13:34,210 --> 00:13:39,410
<font color="#E5E5E5">it's used by pretty</font><font color="#CCCCCC"> much all the</font>

296
00:13:37,370 --> 00:13:41,480
<font color="#CCCCCC">browser's except for edge at this point</font>

297
00:13:39,410 --> 00:13:46,850
the problem<font color="#CCCCCC"> we will get there because</font>

298
00:13:41,480 --> 00:13:48,680
<font color="#E5E5E5">just market pressure so we decided</font><font color="#CCCCCC"> to</font>

299
00:13:46,850 --> 00:13:50,630
weaponize<font color="#E5E5E5"> this happy</font><font color="#CCCCCC"> file-sharing</font>

300
00:13:48,680 --> 00:13:52,310
services we talked<font color="#E5E5E5"> before we created</font>

301
00:13:50,630 --> 00:13:55,100
<font color="#E5E5E5">three tiers and we started looking into</font>

302
00:13:52,310 --> 00:13:59,930
<font color="#E5E5E5">how do we actually productize that on</font>

303
00:13:55,100 --> 00:14:02,930
the greater scale so<font color="#E5E5E5"> that's good</font><font color="#CCCCCC"> at all</font>

304
00:13:59,930 --> 00:14:05,329
<font color="#E5E5E5">you know we can we can now do you know</font>

305
00:14:02,930 --> 00:14:09,439
just<font color="#E5E5E5"> manual stands and we can pretty</font>

306
00:14:05,330 --> 00:14:13,420
much<font color="#E5E5E5"> curse companies to to download</font><font color="#CCCCCC"> or</font>

307
00:14:09,440 --> 00:14:16,220
marks on the<font color="#E5E5E5"> other side to download</font>

308
00:14:13,420 --> 00:14:21,829
<font color="#CCCCCC">reprecussions we filled our initial six</font>

309
00:14:16,220 --> 00:14:24,440
goals but here's the thing<font color="#CCCCCC"> we really</font>

310
00:14:21,830 --> 00:14:27,020
<font color="#E5E5E5">want to be able to do it fast we want to</font>

311
00:14:24,440 --> 00:14:29,660
be able to<font color="#CCCCCC"> prototype</font><font color="#E5E5E5"> and for more</font><font color="#CCCCCC"> than</font>

312
00:14:27,020 --> 00:14:32,300
just<font color="#E5E5E5"> one environment and while it's nice</font>

313
00:14:29,660 --> 00:14:34,660
to do it<font color="#E5E5E5"> just</font><font color="#CCCCCC"> for that</font><font color="#E5E5E5"> customer we'll</font>

314
00:14:32,300 --> 00:14:38,750
also want to do it<font color="#E5E5E5"> for others because we</font>

315
00:14:34,660 --> 00:14:40,069
think that<font color="#E5E5E5"> well at this point where you</font>

316
00:14:38,750 --> 00:14:42,350
know the right team is actually<font color="#CCCCCC"> losing</font>

317
00:14:40,070 --> 00:14:44,300
the game<font color="#E5E5E5"> and defense is real really</font>

318
00:14:42,350 --> 00:14:47,540
ramping up and<font color="#E5E5E5"> we have seen real really</font>

319
00:14:44,300 --> 00:14:49,790
good results from defense so we actually

320
00:14:47,540 --> 00:14:55,160
<font color="#E5E5E5">need</font><font color="#CCCCCC"> to step up our game</font><font color="#E5E5E5"> and automate</font>

321
00:14:49,790 --> 00:14:58,430
<font color="#E5E5E5">things so what would</font><font color="#CCCCCC"> be</font><font color="#E5E5E5"> the three</font><font color="#CCCCCC"> sort</font>

322
00:14:55,160 --> 00:15:01,329
<font color="#CCCCCC">of auxiliary scenarios or goals for us</font>

323
00:14:58,430 --> 00:15:03,800
<font color="#E5E5E5">to</font><font color="#CCCCCC"> to do</font><font color="#E5E5E5"> something with this service</font>

324
00:15:01,330 --> 00:15:08,110
<font color="#E5E5E5">well we can build the delivery framework</font>

325
00:15:03,800 --> 00:15:10,670
<font color="#E5E5E5">on it we can have a lot more challenges</font>

326
00:15:08,110 --> 00:15:12,650
<font color="#E5E5E5">you know dealing with tests and</font><font color="#CCCCCC"> crona's</font>

327
00:15:10,670 --> 00:15:15,410
<font color="#CCCCCC">ation so we have to address that</font><font color="#E5E5E5"> and</font>

328
00:15:12,650 --> 00:15:17,870
then<font color="#E5E5E5"> finally maybe maybe we can build</font>

329
00:15:15,410 --> 00:15:20,660
<font color="#CCCCCC">the command and</font><font color="#E5E5E5"> control goes</font>

330
00:15:17,870 --> 00:15:23,120
so we started decoupling<font color="#E5E5E5"> what it what</font>

331
00:15:20,660 --> 00:15:25,699
<font color="#E5E5E5">that's actual service what that service</font>

332
00:15:23,120 --> 00:15:27,800
does what are the web in<font color="#CCCCCC"> the eyes that</font>

333
00:15:25,700 --> 00:15:30,170
<font color="#CCCCCC">are</font><font color="#E5E5E5"> so standard</font><font color="#CCCCCC"> and what</font><font color="#E5E5E5"> can we do with</font>

334
00:15:27,800 --> 00:15:33,439
them<font color="#E5E5E5"> you can do it with curl of course</font>

335
00:15:30,170 --> 00:15:37,069
<font color="#E5E5E5">but it's kind of you</font><font color="#CCCCCC"> know it's</font><font color="#E5E5E5"> not</font>

336
00:15:33,440 --> 00:15:38,360
minimized it's very you know<font color="#E5E5E5"> just</font><font color="#CCCCCC"> just</font>

337
00:15:37,070 --> 00:15:40,880
manual but you have a<font color="#CCCCCC"> generate</font>

338
00:15:38,360 --> 00:15:46,180
JavaScript<font color="#E5E5E5"> engine right so</font><font color="#CCCCCC"> talking off</font>

339
00:15:40,880 --> 00:15:49,130
of that web<font color="#CCCCCC"> preview API is nothing more</font>

340
00:15:46,180 --> 00:15:52,880
<font color="#E5E5E5">in JavaScript than javascript crypto</font>

341
00:15:49,130 --> 00:15:56,300
<font color="#CCCCCC">maybe Web API</font><font color="#E5E5E5"> plus crypto standards and</font>

342
00:15:52,880 --> 00:15:58,700
HTTP libraries so would it be<font color="#E5E5E5"> fair</font><font color="#CCCCCC"> to</font>

343
00:15:56,300 --> 00:16:00,560
say<font color="#CCCCCC"> that</font><font color="#E5E5E5"> if you</font><font color="#CCCCCC"> pour it to different</font>

344
00:15:58,700 --> 00:16:03,290
<font color="#CCCCCC">language we can actually take the web</font>

345
00:16:00,560 --> 00:16:05,599
crypto API use the same encryption<font color="#CCCCCC"> AS</font>

346
00:16:03,290 --> 00:16:08,270
<font color="#E5E5E5">you know do the SHA whatever the case</font>

347
00:16:05,600 --> 00:16:11,720
may be<font color="#E5E5E5"> apply the same HTTP libraries</font><font color="#CCCCCC"> on</font>

348
00:16:08,270 --> 00:16:13,370
a different side and use<font color="#CCCCCC"> the same crypto</font>

349
00:16:11,720 --> 00:16:17,750
standards so we<font color="#E5E5E5"> can pour and say from</font>

350
00:16:13,370 --> 00:16:20,420
JavaScript or Python<font color="#E5E5E5"> of course but then</font>

351
00:16:17,750 --> 00:16:22,250
the<font color="#CCCCCC"> problem becomes that JavaScript</font><font color="#E5E5E5"> were</font>

352
00:16:20,420 --> 00:16:24,260
rather<font color="#CCCCCC"> mozilla firefox'</font>

353
00:16:22,250 --> 00:16:28,640
<font color="#CCCCCC">sell</font><font color="#E5E5E5"> servers the mozilla servers</font>

354
00:16:24,260 --> 00:16:30,830
themselves<font color="#E5E5E5"> they don't have a way</font><font color="#CCCCCC"> to</font>

355
00:16:28,640 --> 00:16:32,540
notify<font color="#E5E5E5"> the other side the agent that we</font>

356
00:16:30,830 --> 00:16:34,790
want<font color="#E5E5E5"> to build what to do with it they</font>

357
00:16:32,540 --> 00:16:36,680
just toggle data<font color="#E5E5E5"> so I can store</font><font color="#CCCCCC"> the data</font>

358
00:16:34,790 --> 00:16:38,290
but I can tell the data to tell somebody

359
00:16:36,680 --> 00:16:41,930
<font color="#CCCCCC">else and neither</font><font color="#E5E5E5"> side what to do with it</font>

360
00:16:38,290 --> 00:16:44,360
<font color="#E5E5E5">so we needed</font><font color="#CCCCCC"> a side channel</font><font color="#E5E5E5"> side channel</font>

361
00:16:41,930 --> 00:16:45,890
on HTTP then<font color="#E5E5E5"> you run exactly the same</font>

362
00:16:44,360 --> 00:16:48,140
issue because you<font color="#CCCCCC"> have to have rank</font>

363
00:16:45,890 --> 00:16:49,670
domain<font color="#E5E5E5"> you have to be able</font><font color="#CCCCCC"> to age it you</font>

364
00:16:48,140 --> 00:16:53,650
have to be able<font color="#E5E5E5"> to trust it and</font><font color="#CCCCCC"> so on</font>

365
00:16:49,670 --> 00:16:57,979
support<font color="#E5E5E5"> you can use ICMP but in our case</font>

366
00:16:53,650 --> 00:16:59,360
<font color="#E5E5E5">ICMP is fairly limited</font><font color="#CCCCCC"> because it's kind</font>

367
00:16:57,980 --> 00:17:02,240
of loud<font color="#CCCCCC"> it doesn't have a lot of</font>

368
00:16:59,360 --> 00:17:05,360
capabilities to<font color="#E5E5E5"> do what we need to</font><font color="#CCCCCC"> do we</font>

369
00:17:02,240 --> 00:17:07,819
<font color="#CCCCCC">can use</font><font color="#E5E5E5"> DNS DNS is also being looked at</font>

370
00:17:05,359 --> 00:17:10,790
from<font color="#CCCCCC"> defense</font><font color="#E5E5E5"> but the way we do it is</font>

371
00:17:07,819 --> 00:17:13,550
we're gonna<font color="#CCCCCC"> try</font><font color="#E5E5E5"> to split the the channel</font>

372
00:17:10,790 --> 00:17:16,280
from<font color="#CCCCCC"> the command and the data in</font>

373
00:17:13,550 --> 00:17:18,889
minimize the actual<font color="#E5E5E5"> traffic so</font>

374
00:17:16,280 --> 00:17:21,649
essentially you know that's our<font color="#E5E5E5"> goal</font>

375
00:17:18,890 --> 00:17:26,330
number<font color="#CCCCCC"> two if we employ</font><font color="#E5E5E5"> DNS what do we</font>

376
00:17:21,650 --> 00:17:29,630
do we use a custom<font color="#E5E5E5"> game as broker and we</font>

377
00:17:26,329 --> 00:17:31,280
create a protocol application protocol

378
00:17:29,630 --> 00:17:34,310
what to do

379
00:17:31,280 --> 00:17:37,970
without file<font color="#E5E5E5"> or rather a link on a</font>

380
00:17:34,310 --> 00:17:40,850
<font color="#CCCCCC">payload</font><font color="#E5E5E5"> so essentially what we want</font><font color="#CCCCCC"> to</font>

381
00:17:37,970 --> 00:17:43,610
do is we want to<font color="#E5E5E5"> use the</font><font color="#CCCCCC"> MX TST</font><font color="#E5E5E5"> txt</font>

382
00:17:40,850 --> 00:17:45,139
record and<font color="#E5E5E5"> not DNS txt record is going</font>

383
00:17:43,610 --> 00:17:48,199
<font color="#E5E5E5">to be encrypted by the shared key</font>

384
00:17:45,140 --> 00:17:50,480
provided<font color="#E5E5E5"> to us by Firefox</font><font color="#CCCCCC"> and that's</font>

385
00:17:48,200 --> 00:17:52,700
<font color="#E5E5E5">going to be fully valid</font><font color="#CCCCCC"> dickham record</font>

386
00:17:50,480 --> 00:17:55,940
which upon<font color="#CCCCCC"> unwrapped because we know the</font>

387
00:17:52,700 --> 00:17:58,790
key<font color="#CCCCCC"> we'll</font><font color="#E5E5E5"> be able to provide a URL for</font>

388
00:17:55,940 --> 00:18:01,790
the<font color="#E5E5E5"> payload and</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> specific metadata what</font>

389
00:17:58,790 --> 00:18:04,220
to do with this<font color="#E5E5E5"> payload on the wire</font>

390
00:18:01,790 --> 00:18:07,399
looks<font color="#E5E5E5"> completely normal it looks as if</font>

391
00:18:04,220 --> 00:18:10,130
any<font color="#E5E5E5"> text record it doesn't travel very</font>

392
00:18:07,400 --> 00:18:12,110
frequently it's only<font color="#E5E5E5"> there to give you</font>

393
00:18:10,130 --> 00:18:15,130
<font color="#E5E5E5">the metadata what to do with the file</font>

394
00:18:12,110 --> 00:18:21,860
or<font color="#E5E5E5"> the</font><font color="#CCCCCC"> URL that</font><font color="#E5E5E5"> you're trying to</font>

395
00:18:15,130 --> 00:18:26,120
<font color="#E5E5E5">together master slave concept</font><font color="#CCCCCC"> sure</font><font color="#E5E5E5"> more</font>

396
00:18:21,860 --> 00:18:30,169
than<font color="#CCCCCC"> one agent sure</font><font color="#E5E5E5"> so why not just do</font>

397
00:18:26,120 --> 00:18:31,879
this<font color="#E5E5E5"> why not</font><font color="#CCCCCC"> just have a expansion of</font>

398
00:18:30,170 --> 00:18:35,120
what we want to do the rest<font color="#CCCCCC"> stays the</font>

399
00:18:31,880 --> 00:18:38,420
red the blue stays<font color="#CCCCCC"> the blue the green is</font>

400
00:18:35,120 --> 00:18:42,110
our trusted Firefox<font color="#E5E5E5"> server and the</font>

401
00:18:38,420 --> 00:18:43,670
yellow is our DNS server<font color="#CCCCCC"> and</font><font color="#E5E5E5"> essentially</font>

402
00:18:42,110 --> 00:18:47,090
we have two commands and<font color="#E5E5E5"> control</font>

403
00:18:43,670 --> 00:18:49,640
channels we<font color="#CCCCCC"> have we have gone</font><font color="#E5E5E5"> from being</font>

404
00:18:47,090 --> 00:18:52,159
able completely visible<font color="#CCCCCC"> to the network</font>

405
00:18:49,640 --> 00:18:56,240
inspection to<font color="#CCCCCC"> be able</font><font color="#E5E5E5"> to split the</font>

406
00:18:52,160 --> 00:18:57,950
command<font color="#E5E5E5"> channel to the DMS and</font><font color="#CCCCCC"> the data</font>

407
00:18:56,240 --> 00:19:01,420
channel<font color="#CCCCCC"> to the</font><font color="#E5E5E5"> Firefox sound so they</font>

408
00:18:57,950 --> 00:19:05,720
cannot correlate us we also<font color="#CCCCCC"> built</font>

409
00:19:01,420 --> 00:19:07,700
intervals to build in<font color="#E5E5E5"> to get into that</font>

410
00:19:05,720 --> 00:19:10,370
specific environment<font color="#CCCCCC"> you know make sure</font>

411
00:19:07,700 --> 00:19:12,590
<font color="#CCCCCC">that you know our efforts are not very</font>

412
00:19:10,370 --> 00:19:15,169
loud<font color="#E5E5E5"> because if you think about it there</font>

413
00:19:12,590 --> 00:19:17,600
are<font color="#E5E5E5"> things</font><font color="#CCCCCC"> to that</font><font color="#E5E5E5"> explain that split</font>

414
00:19:15,170 --> 00:19:19,700
the<font color="#E5E5E5"> data on txt records and shove maybe</font>

415
00:19:17,600 --> 00:19:21,800
a million txt records through the

416
00:19:19,700 --> 00:19:25,040
network<font color="#E5E5E5"> you know getting your data</font>

417
00:19:21,800 --> 00:19:27,169
<font color="#CCCCCC">across but in our case that one DNS txt</font>

418
00:19:25,040 --> 00:19:29,180
record<font color="#E5E5E5"> is just</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> command it's just a</font>

419
00:19:27,170 --> 00:19:32,600
metadata<font color="#CCCCCC"> the data</font><font color="#E5E5E5"> actually comes from</font>

420
00:19:29,180 --> 00:19:34,430
<font color="#E5E5E5">the</font><font color="#CCCCCC"> Firefox so Firefox operation is</font>

421
00:19:32,600 --> 00:19:39,500
pretty<font color="#E5E5E5"> simple</font><font color="#CCCCCC"> right you have a master</font>

422
00:19:34,430 --> 00:19:44,690
that posts the the commands through the

423
00:19:39,500 --> 00:19:46,670
<font color="#E5E5E5">Firefox link through</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> DNS to the</font>

424
00:19:44,690 --> 00:19:47,870
<font color="#E5E5E5">to the slave</font><font color="#CCCCCC"> or the other way</font><font color="#E5E5E5"> around</font><font color="#CCCCCC"> and</font>

425
00:19:46,670 --> 00:19:49,310
depending which way<font color="#CCCCCC"> you want</font><font color="#E5E5E5"> to</font>

426
00:19:47,870 --> 00:19:52,310
communicate<font color="#E5E5E5"> if you want to exfiltrate</font>

427
00:19:49,310 --> 00:19:54,200
data<font color="#E5E5E5"> the roles get reversed</font><font color="#CCCCCC"> you may want</font>

428
00:19:52,310 --> 00:19:57,740
to send the payload through exactly<font color="#CCCCCC"> the</font>

429
00:19:54,200 --> 00:20:02,290
<font color="#E5E5E5">same mechanism out</font><font color="#CCCCCC"> to your</font><font color="#E5E5E5"> situ or</font><font color="#CCCCCC"> out</font>

430
00:19:57,740 --> 00:20:04,610
to any<font color="#E5E5E5"> other communication</font><font color="#CCCCCC"> endpoint and</font>

431
00:20:02,290 --> 00:20:10,460
everything is brokered<font color="#E5E5E5"> through the</font><font color="#CCCCCC"> DNS</font>

432
00:20:04,610 --> 00:20:15,830
right so Foxtrot c2 is born<font color="#CCCCCC"> foxtrot CTU</font>

433
00:20:10,460 --> 00:20:19,960
is really just a mechanism<font color="#E5E5E5"> to use split</font>

434
00:20:15,830 --> 00:20:24,500
HTTP data delivery from DNS commanding

435
00:20:19,960 --> 00:20:28,040
and on the wire<font color="#E5E5E5"> once you want</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> drop it</font>

436
00:20:24,500 --> 00:20:30,800
in<font color="#E5E5E5"> is gonna look completely</font><font color="#CCCCCC"> normal from</font>

437
00:20:28,040 --> 00:20:35,000
<font color="#CCCCCC">both HTTP</font><font color="#E5E5E5"> standpoint when it gets a file</font>

438
00:20:30,800 --> 00:20:37,669
from<font color="#CCCCCC"> Firefox and it's going</font><font color="#E5E5E5"> to look</font><font color="#CCCCCC"> very</font>

439
00:20:35,000 --> 00:20:40,480
normal<font color="#E5E5E5"> from the DNS perspective</font><font color="#CCCCCC"> unless</font>

440
00:20:37,670 --> 00:20:44,270
<font color="#CCCCCC">you're actually watching and no exact</font>

441
00:20:40,480 --> 00:20:47,180
you know split<font color="#E5E5E5"> of that channel right the</font>

442
00:20:44,270 --> 00:20:52,760
data goes on<font color="#E5E5E5"> HTTP</font><font color="#CCCCCC"> and DNS only gets one</font>

443
00:20:47,180 --> 00:20:56,930
packet so what what<font color="#CCCCCC"> are the defenses</font><font color="#E5E5E5"> for</font>

444
00:20:52,760 --> 00:20:59,720
this well first<font color="#E5E5E5"> of all the vendors</font><font color="#CCCCCC"> that</font>

445
00:20:56,930 --> 00:21:02,540
deploy Firefox<font color="#CCCCCC"> send</font><font color="#E5E5E5"> them on local local</font>

446
00:20:59,720 --> 00:21:05,620
network<font color="#E5E5E5"> you know private servers should</font>

447
00:21:02,540 --> 00:21:08,090
put captures<font color="#E5E5E5"> if they can on Firefox on</font>

448
00:21:05,620 --> 00:21:10,270
unexposed Firefox and server because

449
00:21:08,090 --> 00:21:12,050
then we're not able to do<font color="#E5E5E5"> real-time</font>

450
00:21:10,270 --> 00:21:15,860
communication we<font color="#CCCCCC"> need to be able to</font>

451
00:21:12,050 --> 00:21:18,320
solve<font color="#E5E5E5"> CAPTCHA right then they probably</font>

452
00:21:15,860 --> 00:21:20,389
need<font color="#E5E5E5"> to throttle the number of uploads</font>

453
00:21:18,320 --> 00:21:22,580
to the<font color="#CCCCCC"> endpoint so for example if</font><font color="#E5E5E5"> I type</font>

454
00:21:20,390 --> 00:21:24,980
<font color="#E5E5E5">shell-like commands</font><font color="#CCCCCC"> I have 5 seconds</font>

455
00:21:22,580 --> 00:21:29,360
delay between commands on the<font color="#CCCCCC"> prior</font>

456
00:21:24,980 --> 00:21:33,680
<font color="#E5E5E5">Firefox and uploads then no sensible</font>

457
00:21:29,360 --> 00:21:35,270
business<font color="#E5E5E5"> case would really cover every</font>

458
00:21:33,680 --> 00:21:36,980
five seconds upload the files<font color="#E5E5E5"> and what</font>

459
00:21:35,270 --> 00:21:39,379
if you do then you have<font color="#CCCCCC"> to have</font><font color="#E5E5E5"> certain</font>

460
00:21:36,980 --> 00:21:42,260
specific provisioning and<font color="#E5E5E5"> you actually</font>

461
00:21:39,380 --> 00:21:45,290
<font color="#E5E5E5">take you need to take exception with</font>

462
00:21:42,260 --> 00:21:48,800
that and then<font color="#E5E5E5"> defense the blue team</font>

463
00:21:45,290 --> 00:21:52,790
actually<font color="#E5E5E5"> now needs to explain expect the</font>

464
00:21:48,800 --> 00:21:55,190
split protocol delivery<font color="#E5E5E5"> because it is</font>

465
00:21:52,790 --> 00:21:57,170
just too good of a vector<font color="#CCCCCC"> for us to</font>

466
00:21:55,190 --> 00:21:58,430
utilize<font color="#E5E5E5"> because we can</font><font color="#CCCCCC"> actually go to</font>

467
00:21:57,170 --> 00:22:01,510
<font color="#E5E5E5">different</font>

468
00:21:58,430 --> 00:22:03,770
we can we can<font color="#CCCCCC"> bounce off of different</font>

469
00:22:01,510 --> 00:22:08,750
<font color="#E5E5E5">mechanisms in order</font><font color="#CCCCCC"> to split the</font>

470
00:22:03,770 --> 00:22:11,600
behavioral analytics<font color="#E5E5E5"> here so while this</font>

471
00:22:08,750 --> 00:22:15,110
<font color="#E5E5E5">is</font><font color="#CCCCCC"> all good and bad I love it</font><font color="#E5E5E5"> and all</font>

472
00:22:11,600 --> 00:22:17,540
but<font color="#CCCCCC"> III think that</font><font color="#E5E5E5"> what this was down to</font>

473
00:22:15,110 --> 00:22:20,659
the<font color="#CCCCCC"> red team which in</font><font color="#E5E5E5"> this case I care</font>

474
00:22:17,540 --> 00:22:22,490
about is that<font color="#E5E5E5"> payload delivery itself is</font>

475
00:22:20,660 --> 00:22:23,900
not easy<font color="#E5E5E5"> or hard</font><font color="#CCCCCC"> there's</font><font color="#E5E5E5"> just the</font>

476
00:22:22,490 --> 00:22:26,690
challenge with variables that you<font color="#CCCCCC"> need</font>

477
00:22:23,900 --> 00:22:29,570
to solve<font color="#E5E5E5"> hopefully you get</font><font color="#CCCCCC"> get some</font>

478
00:22:26,690 --> 00:22:33,200
ideas from<font color="#E5E5E5"> this I think</font><font color="#CCCCCC"> that right now</font>

479
00:22:29,570 --> 00:22:35,510
<font color="#E5E5E5">red teams are kind of struggling with</font>

480
00:22:33,200 --> 00:22:37,700
existing tooling and we need to<font color="#E5E5E5"> create</font>

481
00:22:35,510 --> 00:22:39,920
<font color="#E5E5E5">more tools to</font><font color="#CCCCCC"> test that because the</font>

482
00:22:37,700 --> 00:22:43,100
adversaries will definitely definitely

483
00:22:39,920 --> 00:22:44,960
move<font color="#CCCCCC"> into</font><font color="#E5E5E5"> split channels and then you</font>

484
00:22:43,100 --> 00:22:47,780
need<font color="#E5E5E5"> to instrument yourself if you are</font>

485
00:22:44,960 --> 00:22:50,090
on a defender side<font color="#E5E5E5"> you need to know what</font>

486
00:22:47,780 --> 00:22:51,740
fails you need to know<font color="#E5E5E5"> your your network</font>

487
00:22:50,090 --> 00:22:53,870
you<font color="#E5E5E5"> need to acquiesce your network and</font>

488
00:22:51,740 --> 00:22:55,940
you actually<font color="#E5E5E5"> need to</font><font color="#CCCCCC"> know</font><font color="#E5E5E5"> the behavioral</font>

489
00:22:53,870 --> 00:22:58,909
<font color="#CCCCCC">patterns that</font><font color="#E5E5E5"> exist because if you see</font>

490
00:22:55,940 --> 00:23:01,490
the NS txt for example when you

491
00:22:58,910 --> 00:23:03,710
shouldn't<font color="#E5E5E5"> see DNS txt at all</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> example</font>

492
00:23:01,490 --> 00:23:08,120
you know<font color="#CCCCCC"> self registration</font><font color="#E5E5E5"> of dynamic</font>

493
00:23:03,710 --> 00:23:14,270
<font color="#E5E5E5">DNS that's a telltale sign for you to to</font>

494
00:23:08,120 --> 00:23:16,629
take advantage so this is you<font color="#E5E5E5"> know this</font>

495
00:23:14,270 --> 00:23:18,740
code is posted out there it will move

496
00:23:16,630 --> 00:23:21,050
unfortunately right now<font color="#E5E5E5"> it</font><font color="#CCCCCC"> needs to be</font>

497
00:23:18,740 --> 00:23:22,970
where it is but definitely follow this

498
00:23:21,050 --> 00:23:26,899
<font color="#CCCCCC">Twitter and will definitely give you</font><font color="#E5E5E5"> the</font>

499
00:23:22,970 --> 00:23:28,820
the final resting<font color="#CCCCCC"> place of it</font><font color="#E5E5E5"> this is a</font>

500
00:23:26,900 --> 00:23:32,240
<font color="#CCCCCC">short presentation we don't have a demo</font>

501
00:23:28,820 --> 00:23:35,929
for<font color="#E5E5E5"> it</font><font color="#CCCCCC"> but it's going</font><font color="#E5E5E5"> we're gonna have a</font>

502
00:23:32,240 --> 00:23:38,390
wiki we're gonna have videos on<font color="#CCCCCC"> its use</font>

503
00:23:35,930 --> 00:23:40,600
and<font color="#E5E5E5"> you guys can take</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> for a</font><font color="#CCCCCC"> spin</font>

504
00:23:38,390 --> 00:23:44,750
use it in<font color="#CCCCCC"> your environment</font><font color="#E5E5E5"> so you feel</font>

505
00:23:40,600 --> 00:23:47,110
<font color="#CCCCCC">this is good for you</font><font color="#E5E5E5"> you have questions</font>

506
00:23:44,750 --> 00:23:47,110
let me know

507
00:23:49,990 --> 00:23:53,770
I'll be around thank you

