1
00:00:00,000 --> 00:00:05,569
for a<font color="#E5E5E5"> Sunday</font><font color="#CCCCCC"> tuck we're right at about</font>

2
00:00:02,129 --> 00:00:11,370
<font color="#E5E5E5">11:30 here so I guess we'll get</font><font color="#CCCCCC"> started</font>

3
00:00:05,569 --> 00:00:13,320
good morning<font color="#CCCCCC"> I'm Carl fasten if that</font>

4
00:00:11,370 --> 00:00:15,059
wasn't<font color="#E5E5E5"> obvious from the slides up here</font>

5
00:00:13,320 --> 00:00:17,369
<font color="#CCCCCC">and today we're gonna be</font><font color="#E5E5E5"> talking</font><font color="#CCCCCC"> about</font>

6
00:00:15,059 --> 00:00:20,759
attacking<font color="#E5E5E5"> environments with PowerShell</font>

7
00:00:17,369 --> 00:00:25,289
<font color="#CCCCCC">so a little</font><font color="#E5E5E5"> bit of background on me I'm</font>

8
00:00:20,760 --> 00:00:26,460
Abe Simpson in<font color="#E5E5E5"> this picture but yeah I'm</font>

9
00:00:25,289 --> 00:00:27,900
a pen tester I<font color="#CCCCCC"> worked for a</font><font color="#E5E5E5"> company</font>

10
00:00:26,460 --> 00:00:30,210
called net<font color="#CCCCCC"> spy we're headquartered out</font>

11
00:00:27,900 --> 00:00:32,159
of Minneapolis<font color="#CCCCCC"> I'm based out</font><font color="#E5E5E5"> of Oregon</font>

12
00:00:30,210 --> 00:00:35,790
if that wasn't obvious based off of<font color="#E5E5E5"> the</font>

13
00:00:32,159 --> 00:00:38,069
flannel today but do<font color="#CCCCCC"> pentesting up in</font>

14
00:00:35,790 --> 00:00:40,980
with net spy for a little<font color="#E5E5E5"> over seven</font>

15
00:00:38,070 --> 00:00:42,870
years<font color="#E5E5E5"> as of this last</font><font color="#CCCCCC"> week</font><font color="#E5E5E5"> here but do</font>

16
00:00:40,980 --> 00:00:44,640
password cracking social engineering you

17
00:00:42,870 --> 00:00:46,379
<font color="#E5E5E5">can find me on the</font><font color="#CCCCCC"> Nets by blog blog</font>

18
00:00:44,640 --> 00:00:47,280
<font color="#CCCCCC">Dutton</font><font color="#E5E5E5"> that's why calm and</font><font color="#CCCCCC"> well than</font><font color="#E5E5E5"> the</font>

19
00:00:46,379 --> 00:00:48,960
information<font color="#CCCCCC"> that we're talking</font><font color="#E5E5E5"> about</font>

20
00:00:47,280 --> 00:00:50,640
<font color="#CCCCCC">today we've actually got blog</font><font color="#E5E5E5"> post up</font>

21
00:00:48,960 --> 00:00:52,620
already<font color="#E5E5E5"> that covers</font><font color="#CCCCCC"> some of</font><font color="#E5E5E5"> this stuff</font>

22
00:00:50,640 --> 00:00:54,840
<font color="#E5E5E5">so if you've read those posts it'll be a</font>

23
00:00:52,620 --> 00:00:55,980
<font color="#E5E5E5">little bit the same info but a couple of</font>

24
00:00:54,840 --> 00:00:58,890
new<font color="#CCCCCC"> things that</font><font color="#E5E5E5"> haven't made it out to</font>

25
00:00:55,980 --> 00:01:01,199
<font color="#E5E5E5">the blog yet cloud enthusiasts is a</font>

26
00:00:58,890 --> 00:01:04,339
strong word<font color="#CCCCCC"> I spend a lot of time in the</font>

27
00:01:01,199 --> 00:01:07,140
cloud<font color="#E5E5E5"> but</font><font color="#CCCCCC"> there's some interesting stuff</font>

28
00:01:04,339 --> 00:01:09,570
<font color="#E5E5E5">you can also find me on twitter</font><font color="#CCCCCC"> @ @ k</font>

29
00:01:07,140 --> 00:01:12,619
<font color="#CCCCCC">Fossen or i'll be tweeting about</font><font color="#E5E5E5"> this</font>

30
00:01:09,570 --> 00:01:14,729
kind of stuff<font color="#CCCCCC"> so here's a quick overview</font>

31
00:01:12,619 --> 00:01:15,780
we're<font color="#E5E5E5"> gonna talk about</font><font color="#CCCCCC"> this stuff so I'm</font>

32
00:01:14,729 --> 00:01:19,408
not going<font color="#E5E5E5"> to spend too much time on it</font>

33
00:01:15,780 --> 00:01:22,650
<font color="#E5E5E5">so quick start here dumping</font><font color="#CCCCCC"> a sure data</font>

34
00:01:19,409 --> 00:01:25,439
<font color="#E5E5E5">so a little background on me I've been</font>

35
00:01:22,650 --> 00:01:27,720
<font color="#E5E5E5">doing a lot</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> work in applications</font>

36
00:01:25,439 --> 00:01:30,029
deployment subscriptions we've got fair

37
00:01:27,720 --> 00:01:31,259
number<font color="#E5E5E5"> of clients</font><font color="#CCCCCC"> that do work with</font><font color="#E5E5E5"> Nets</font>

38
00:01:30,030 --> 00:01:33,000
<font color="#CCCCCC">file that have moved a lot of their</font>

39
00:01:31,259 --> 00:01:34,530
applications<font color="#E5E5E5"> and infrastructure up to</font>

40
00:01:33,000 --> 00:01:37,140
the issuer<font color="#CCCCCC"> cloud so we're getting asked</font>

41
00:01:34,530 --> 00:01:39,299
more to do assessments on Azure<font color="#E5E5E5"> this</font>

42
00:01:37,140 --> 00:01:41,310
includes application assessments<font color="#E5E5E5"> Azure</font>

43
00:01:39,299 --> 00:01:44,790
Active Directory<font color="#CCCCCC"> Microsoft online</font>

44
00:01:41,310 --> 00:01:47,430
<font color="#CCCCCC">assessments all</font><font color="#E5E5E5"> sorts of good</font><font color="#CCCCCC"> sure stuff</font>

45
00:01:44,790 --> 00:01:48,630
so we needed<font color="#E5E5E5"> something to automate</font><font color="#CCCCCC"> some</font>

46
00:01:47,430 --> 00:01:51,630
of these processes and<font color="#E5E5E5"> some of these</font>

47
00:01:48,630 --> 00:01:54,030
<font color="#E5E5E5">attacks so why do we want to get data</font>

48
00:01:51,630 --> 00:01:55,320
<font color="#CCCCCC">from Azure well as part of this process</font>

49
00:01:54,030 --> 00:01:57,390
you<font color="#CCCCCC"> know if you're looking at</font><font color="#E5E5E5"> a</font>

50
00:01:55,320 --> 00:02:00,148
subscription<font color="#E5E5E5"> that's got a couple hundred</font>

51
00:01:57,390 --> 00:02:01,590
users<font color="#CCCCCC"> a bunch of applications number of</font>

52
00:02:00,149 --> 00:02:04,259
network<font color="#E5E5E5"> security groups all sorts of</font>

53
00:02:01,590 --> 00:02:05,790
stuff<font color="#E5E5E5"> you want to do that by hand going</font>

54
00:02:04,259 --> 00:02:07,590
through the<font color="#E5E5E5"> is your portal and going</font>

55
00:02:05,790 --> 00:02:09,840
like line by line by line gets a little

56
00:02:07,590 --> 00:02:12,720
tedious<font color="#CCCCCC"> so we want</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> automate all of</font>

57
00:02:09,840 --> 00:02:13,990
<font color="#E5E5E5">this and kind of an additional benefit</font>

58
00:02:12,720 --> 00:02:15,790
<font color="#CCCCCC">of this</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> if</font>

59
00:02:13,990 --> 00:02:18,370
external<font color="#CCCCCC"> pen testers in the room here if</font>

60
00:02:15,790 --> 00:02:20,709
you're guessing fall 2018 passwords

61
00:02:18,370 --> 00:02:22,360
right<font color="#E5E5E5"> now chances</font><font color="#CCCCCC"> are those fall 2018</font>

62
00:02:20,710 --> 00:02:24,460
passwords<font color="#E5E5E5"> for the domain will get you</font>

63
00:02:22,360 --> 00:02:26,440
<font color="#CCCCCC">access to the issuer</font><font color="#E5E5E5"> portal what we're</font>

64
00:02:24,460 --> 00:02:28,300
frequently finding is<font color="#CCCCCC"> that just all</font>

65
00:02:26,440 --> 00:02:31,000
users have read access<font color="#CCCCCC"> to the</font><font color="#E5E5E5"> issuer</font>

66
00:02:28,300 --> 00:02:32,890
portal<font color="#CCCCCC"> it's just kind of a default</font><font color="#E5E5E5"> setup</font>

67
00:02:31,000 --> 00:02:35,470
<font color="#E5E5E5">while</font><font color="#CCCCCC"> the times</font><font color="#E5E5E5"> people are not</font><font color="#CCCCCC"> locking</font>

68
00:02:32,890 --> 00:02:37,119
<font color="#E5E5E5">that down so if you get standard domain</font>

69
00:02:35,470 --> 00:02:39,640
<font color="#CCCCCC">credentials you can just go to portal</font>

70
00:02:37,120 --> 00:02:41,340
<font color="#CCCCCC">dot as your</font><font color="#E5E5E5"> com log right in and</font>

71
00:02:39,640 --> 00:02:43,600
enumerate a whole bunch of information

72
00:02:41,340 --> 00:02:46,510
<font color="#E5E5E5">so it's handy</font><font color="#CCCCCC"> for the infrastructure</font>

73
00:02:43,600 --> 00:02:48,160
audits external<font color="#E5E5E5"> pentesting and you know</font>

74
00:02:46,510 --> 00:02:50,170
regular domain users not typically

75
00:02:48,160 --> 00:02:52,270
locked down<font color="#CCCCCC"> so it's pretty easy to</font><font color="#E5E5E5"> do</font>

76
00:02:50,170 --> 00:02:54,549
this<font color="#E5E5E5"> and since it's the cloud it's all</font>

77
00:02:52,270 --> 00:02:55,960
available<font color="#E5E5E5"> over the internet</font><font color="#CCCCCC"> so it's</font>

78
00:02:54,550 --> 00:03:00,190
easily<font color="#E5E5E5"> and readily available for</font>

79
00:02:55,960 --> 00:03:01,930
external<font color="#CCCCCC"> pentose so there's a few</font>

80
00:03:00,190 --> 00:03:04,090
<font color="#E5E5E5">different ways</font><font color="#CCCCCC"> that we can</font><font color="#E5E5E5"> dump data</font>

81
00:03:01,930 --> 00:03:05,800
from<font color="#CCCCCC"> azure</font><font color="#E5E5E5"> I talked about</font><font color="#CCCCCC"> the most</font><font color="#E5E5E5"> basic</font>

82
00:03:04,090 --> 00:03:07,990
<font color="#CCCCCC">one</font><font color="#E5E5E5"> up front here just going into</font><font color="#CCCCCC"> the</font>

83
00:03:05,800 --> 00:03:10,450
<font color="#CCCCCC">azure</font><font color="#E5E5E5"> portal and copying and pasting</font>

84
00:03:07,990 --> 00:03:11,980
things out<font color="#E5E5E5"> the graphical interface is</font>

85
00:03:10,450 --> 00:03:13,929
nice if you<font color="#E5E5E5"> want to poke around</font><font color="#CCCCCC"> and look</font>

86
00:03:11,980 --> 00:03:14,619
at<font color="#E5E5E5"> things individually</font><font color="#CCCCCC"> just log directly</font>

87
00:03:13,930 --> 00:03:17,590
<font color="#E5E5E5">into the website</font>

88
00:03:14,620 --> 00:03:19,900
<font color="#E5E5E5">it's</font><font color="#CCCCCC"> screenshot on</font><font color="#E5E5E5"> the side here</font><font color="#CCCCCC"> of some</font>

89
00:03:17,590 --> 00:03:21,580
<font color="#E5E5E5">of the services</font><font color="#CCCCCC"> you can access there</font><font color="#E5E5E5"> but</font>

90
00:03:19,900 --> 00:03:24,760
it's not<font color="#E5E5E5"> great for scaling it's hard to</font>

91
00:03:21,580 --> 00:03:27,640
<font color="#E5E5E5">copy and paste IP addresses for 400 VMs</font>

92
00:03:24,760 --> 00:03:30,100
directly out of the website<font color="#E5E5E5"> there's also</font>

93
00:03:27,640 --> 00:03:31,769
<font color="#CCCCCC">REST API</font><font color="#E5E5E5"> you get some nice</font><font color="#CCCCCC"> structured</font>

94
00:03:30,100 --> 00:03:34,180
JSON data that comes out<font color="#CCCCCC"> of those but</font>

95
00:03:31,770 --> 00:03:36,130
setting up<font color="#E5E5E5"> the</font><font color="#CCCCCC"> authentication for it and</font>

96
00:03:34,180 --> 00:03:38,290
some<font color="#E5E5E5"> of the JSON data formatting is not</font>

97
00:03:36,130 --> 00:03:39,880
ideal<font color="#CCCCCC"> for things like powershell</font>

98
00:03:38,290 --> 00:03:41,769
commandlets which we'll talk<font color="#E5E5E5"> about next</font>

99
00:03:39,880 --> 00:03:44,590
you have nice pipelined<font color="#E5E5E5"> objects that you</font>

100
00:03:41,770 --> 00:03:47,500
can feed into<font color="#E5E5E5"> other commandlets so in</font>

101
00:03:44,590 --> 00:03:49,570
the case of your let's say<font color="#CCCCCC"> that we've</font>

102
00:03:47,500 --> 00:03:50,890
got<font color="#E5E5E5"> network security groups and under</font>

103
00:03:49,570 --> 00:03:52,780
those security groups we have different

104
00:03:50,890 --> 00:03:54,459
machines with different<font color="#CCCCCC"> rules</font><font color="#E5E5E5"> we want to</font>

105
00:03:52,780 --> 00:03:56,770
pipe that<font color="#E5E5E5"> list of security groups and</font>

106
00:03:54,460 --> 00:03:59,440
machines into different functions for

107
00:03:56,770 --> 00:04:00,790
issuer to<font color="#E5E5E5"> get additional information</font><font color="#CCCCCC"> so</font>

108
00:03:59,440 --> 00:04:02,920
with that<font color="#E5E5E5"> pipeline of all data it's</font>

109
00:04:00,790 --> 00:04:04,650
easier to automate all<font color="#CCCCCC"> of this stuff</font><font color="#E5E5E5"> a</font>

110
00:04:02,920 --> 00:04:06,970
<font color="#E5E5E5">little bit harder with the</font><font color="#CCCCCC"> rest api x'</font>

111
00:04:04,650 --> 00:04:08,650
with the powershell commandlets which

112
00:04:06,970 --> 00:04:10,150
<font color="#E5E5E5">we'll talk about</font><font color="#CCCCCC"> the dependencies next</font>

113
00:04:08,650 --> 00:04:12,850
you've got<font color="#E5E5E5"> integrated authentication</font>

114
00:04:10,150 --> 00:04:15,330
<font color="#E5E5E5">through the Active Directory libraries</font>

115
00:04:12,850 --> 00:04:17,320
that<font color="#CCCCCC"> are just inherently with these</font>

116
00:04:15,330 --> 00:04:19,299
commandlets so it's easy<font color="#E5E5E5"> to do</font>

117
00:04:17,320 --> 00:04:20,890
authentication get that<font color="#E5E5E5"> set up the</font>

118
00:04:19,298 --> 00:04:23,890
<font color="#E5E5E5">outputs easier to handle it's easy to</font>

119
00:04:20,890 --> 00:04:25,280
output to CSV<font color="#CCCCCC"> or txt files</font><font color="#E5E5E5"> and it can</font>

120
00:04:23,890 --> 00:04:26,750
handle data at scale

121
00:04:25,280 --> 00:04:29,530
<font color="#E5E5E5">I said you can pipeline these objects</font>

122
00:04:26,750 --> 00:04:32,060
<font color="#E5E5E5">and get everything outputted very easily</font>

123
00:04:29,530 --> 00:04:33,200
<font color="#CCCCCC">cons really</font><font color="#E5E5E5"> just kind</font><font color="#CCCCCC"> of limited</font>

124
00:04:32,060 --> 00:04:34,580
<font color="#CCCCCC">threading options depending</font><font color="#E5E5E5"> on how</font>

125
00:04:33,200 --> 00:04:37,010
you're setting up some of these pipeline

126
00:04:34,580 --> 00:04:38,750
objects<font color="#E5E5E5"> threading can be kind of</font>

127
00:04:37,010 --> 00:04:41,450
<font color="#E5E5E5">difficult</font><font color="#CCCCCC"> and if you're dealing with</font><font color="#E5E5E5"> say</font>

128
00:04:38,750 --> 00:04:43,430
<font color="#CCCCCC">a 10000 user domain that</font><font color="#E5E5E5"> can take a</font>

129
00:04:41,450 --> 00:04:45,139
little<font color="#CCCCCC"> bit</font><font color="#E5E5E5"> of time to go</font><font color="#CCCCCC"> through</font><font color="#E5E5E5"> all of</font>

130
00:04:43,430 --> 00:04:47,570
the Active Directory<font color="#E5E5E5"> groups and map</font>

131
00:04:45,139 --> 00:04:49,520
those users back to<font color="#E5E5E5"> groups so it does</font>

132
00:04:47,570 --> 00:04:51,409
<font color="#E5E5E5">take a while</font><font color="#CCCCCC"> I do</font><font color="#E5E5E5"> have flags in some of</font>

133
00:04:49,520 --> 00:04:53,120
<font color="#E5E5E5">these scripts that basically say don't</font>

134
00:04:51,410 --> 00:04:54,740
dump the users<font color="#E5E5E5"> and groups if that's not</font>

135
00:04:53,120 --> 00:04:56,660
important<font color="#CCCCCC"> if you just want to</font><font color="#E5E5E5"> focus on</font>

136
00:04:54,740 --> 00:04:59,950
<font color="#E5E5E5">more of the services</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> are there you</font>

137
00:04:56,660 --> 00:05:02,690
<font color="#CCCCCC">can go ahead and do that as well</font>

138
00:04:59,950 --> 00:05:04,849
so for the powershell commandant

139
00:05:02,690 --> 00:05:06,919
commandant<font color="#E5E5E5"> modules there's three</font>

140
00:05:04,850 --> 00:05:09,140
<font color="#CCCCCC">different ones that</font><font color="#E5E5E5"> the micro burst</font>

141
00:05:06,919 --> 00:05:10,789
tools rely on so<font color="#E5E5E5"> Microverse is the name</font>

142
00:05:09,140 --> 00:05:14,180
of<font color="#CCCCCC"> the tools repo where all of</font><font color="#E5E5E5"> these</font>

143
00:05:10,790 --> 00:05:17,180
<font color="#CCCCCC">PowerShell tools live and we'll show a</font>

144
00:05:14,180 --> 00:05:19,040
link to<font color="#CCCCCC"> that in a</font><font color="#E5E5E5"> minute here but we</font>

145
00:05:17,180 --> 00:05:22,160
make use of the<font color="#E5E5E5"> azure service management</font>

146
00:05:19,040 --> 00:05:24,710
or typically<font color="#E5E5E5"> ASM it's actually just a</font>

147
00:05:22,160 --> 00:05:26,900
juror in the modules<font color="#CCCCCC"> for</font><font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> a</font>

148
00:05:24,710 --> 00:05:28,638
<font color="#CCCCCC">jiu ORM which is kind of</font><font color="#E5E5E5"> the slightly</font>

149
00:05:26,900 --> 00:05:31,640
newer option it's<font color="#E5E5E5"> your resource</font>

150
00:05:28,639 --> 00:05:33,919
management<font color="#E5E5E5"> and the MS online which</font>

151
00:05:31,640 --> 00:05:35,419
really if you're in a<font color="#CCCCCC"> situation</font><font color="#E5E5E5"> where</font>

152
00:05:33,919 --> 00:05:38,030
you've got domain creds from external

153
00:05:35,419 --> 00:05:40,430
<font color="#CCCCCC">pentest</font><font color="#E5E5E5"> perspective and they've locked</font>

154
00:05:38,030 --> 00:05:42,380
down<font color="#E5E5E5"> the actual</font><font color="#CCCCCC"> user</font><font color="#E5E5E5"> management you can</font>

155
00:05:40,430 --> 00:05:45,770
<font color="#E5E5E5">typically still</font><font color="#CCCCCC"> login to the microsoft</font>

156
00:05:42,380 --> 00:05:47,419
<font color="#CCCCCC">office 365</font><font color="#E5E5E5"> portal and use the powershell</font>

157
00:05:45,770 --> 00:05:49,070
commandlets that way and still list out

158
00:05:47,419 --> 00:05:50,930
<font color="#CCCCCC">all of the users and groups</font><font color="#E5E5E5"> and service</font>

159
00:05:49,070 --> 00:05:52,880
principles<font color="#E5E5E5"> and still get a bunch of</font>

160
00:05:50,930 --> 00:05:55,610
<font color="#E5E5E5">additional information</font><font color="#CCCCCC"> that's handy for</font>

161
00:05:52,880 --> 00:05:58,430
external<font color="#CCCCCC"> pentose so that's kind of a</font>

162
00:05:55,610 --> 00:05:59,780
fallback<font color="#E5E5E5"> I'd say 75 80 percent of the</font>

163
00:05:58,430 --> 00:06:03,080
<font color="#E5E5E5">time we're actually able to</font><font color="#CCCCCC"> use the</font>

164
00:05:59,780 --> 00:06:05,750
<font color="#CCCCCC">issuer modules when we get creds so it's</font>

165
00:06:03,080 --> 00:06:08,990
a<font color="#E5E5E5"> little bit easier</font><font color="#CCCCCC"> and you get a lot</font>

166
00:06:05,750 --> 00:06:10,910
more<font color="#E5E5E5"> data so there is some existing</font>

167
00:06:08,990 --> 00:06:13,490
<font color="#E5E5E5">research and tooling that's already</font><font color="#CCCCCC"> out</font>

168
00:06:10,910 --> 00:06:17,210
there<font color="#E5E5E5"> actually when like the day</font><font color="#CCCCCC"> after I</font>

169
00:06:13,490 --> 00:06:20,180
submitted for<font color="#CCCCCC"> the</font><font color="#E5E5E5"> seeit CFP</font><font color="#CCCCCC"> azúcar came</font>

170
00:06:17,210 --> 00:06:21,710
out from<font color="#E5E5E5"> NCC group</font><font color="#CCCCCC"> I didn't quite fit my</font>

171
00:06:20,180 --> 00:06:24,020
use cases<font color="#E5E5E5"> tried it out on</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> couple of</font>

172
00:06:21,710 --> 00:06:26,060
<font color="#E5E5E5">different subscriptions didn't quite</font>

173
00:06:24,020 --> 00:06:27,680
<font color="#E5E5E5">work well in those environments</font><font color="#CCCCCC"> it feels</font>

174
00:06:26,060 --> 00:06:30,229
a little bit more audit focus and

175
00:06:27,680 --> 00:06:31,970
<font color="#E5E5E5">pentesting focus and as a pen tester my</font>

176
00:06:30,229 --> 00:06:34,010
focus is a<font color="#E5E5E5"> little bit more pen testing</font>

177
00:06:31,970 --> 00:06:36,180
you can<font color="#E5E5E5"> use my tools as kind of audit</font>

178
00:06:34,010 --> 00:06:38,400
type tools but

179
00:06:36,180 --> 00:06:40,860
as you car felt a little<font color="#E5E5E5"> bit more out of</font>

180
00:06:38,400 --> 00:06:42,630
<font color="#CCCCCC">focus</font><font color="#E5E5E5"> cut great reporting so</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> might</font>

181
00:06:40,860 --> 00:06:45,330
<font color="#E5E5E5">want to give that</font><font color="#CCCCCC"> a try there's also as</font>

182
00:06:42,630 --> 00:06:46,949
<font color="#E5E5E5">you</font><font color="#CCCCCC"> write</font><font color="#E5E5E5"> Explorer that one seems like</font>

183
00:06:45,330 --> 00:06:48,419
it<font color="#CCCCCC"> hasn't been very</font><font color="#E5E5E5"> actively maintained</font>

184
00:06:46,949 --> 00:06:51,330
<font color="#E5E5E5">I think that came out</font><font color="#CCCCCC"> about two years</font>

185
00:06:48,419 --> 00:06:53,190
ago initially<font color="#CCCCCC"> I just tried running it</font><font color="#E5E5E5"> a</font>

186
00:06:51,330 --> 00:06:55,349
couple<font color="#E5E5E5"> of</font><font color="#CCCCCC"> weeks ago on my example domain</font>

187
00:06:53,190 --> 00:06:57,210
that will<font color="#E5E5E5"> show some information for and</font>

188
00:06:55,350 --> 00:06:58,800
I<font color="#E5E5E5"> was coming</font><font color="#CCCCCC"> back with some broken as</font>

189
00:06:57,210 --> 00:07:00,870
you were RM command<font color="#CCCCCC"> lit</font><font color="#E5E5E5"> so I think it's</font>

190
00:06:58,800 --> 00:07:02,669
<font color="#CCCCCC">four previous versions of the URL I</font>

191
00:07:00,870 --> 00:07:05,220
should spend a<font color="#E5E5E5"> little bit more time on</font>

192
00:07:02,669 --> 00:07:07,650
<font color="#E5E5E5">those and you'll see if there's any good</font>

193
00:07:05,220 --> 00:07:08,910
<font color="#CCCCCC">data out</font><font color="#E5E5E5"> of that but if my tools aren't</font>

194
00:07:07,650 --> 00:07:11,729
working<font color="#CCCCCC"> for you go ahead and check</font><font color="#E5E5E5"> these</font>

195
00:07:08,910 --> 00:07:13,289
out as well<font color="#CCCCCC"> so we do have some required</font>

196
00:07:11,729 --> 00:07:15,359
reading here if anybody's going to<font color="#E5E5E5"> go</font>

197
00:07:13,289 --> 00:07:17,219
out<font color="#E5E5E5"> and do a jus been testing</font><font color="#CCCCCC"> after this</font>

198
00:07:15,360 --> 00:07:19,949
I would<font color="#E5E5E5"> definitely say go</font><font color="#CCCCCC"> out</font><font color="#E5E5E5"> and find</font>

199
00:07:17,220 --> 00:07:21,870
this book<font color="#E5E5E5"> find an O search com</font>

200
00:07:19,949 --> 00:07:23,699
I don't actually know the<font color="#E5E5E5"> author haven't</font>

201
00:07:21,870 --> 00:07:26,340
talked to them<font color="#CCCCCC"> this came out right</font>

202
00:07:23,699 --> 00:07:27,509
<font color="#E5E5E5">before Def Con</font><font color="#CCCCCC"> and it was actually</font><font color="#E5E5E5"> kind</font>

203
00:07:26,340 --> 00:07:29,070
of nice because<font color="#E5E5E5"> I was</font><font color="#CCCCCC"> prepping for</font><font color="#E5E5E5"> this</font>

204
00:07:27,509 --> 00:07:30,960
talk and a<font color="#CCCCCC"> lot of</font><font color="#E5E5E5"> the stuff</font><font color="#CCCCCC"> that's</font><font color="#E5E5E5"> in</font>

205
00:07:29,070 --> 00:07:33,270
here lines up with<font color="#CCCCCC"> exactly what we're</font>

206
00:07:30,960 --> 00:07:35,159
talking<font color="#CCCCCC"> about today including using</font>

207
00:07:33,270 --> 00:07:36,990
example scripts<font color="#E5E5E5"> from the book</font><font color="#CCCCCC"> I</font>

208
00:07:35,160 --> 00:07:38,870
referenced a couple<font color="#CCCCCC"> of those in the</font>

209
00:07:36,990 --> 00:07:41,729
process of writing some of<font color="#CCCCCC"> these scripts</font>

210
00:07:38,870 --> 00:07:44,430
they're<font color="#E5E5E5"> basically just wrapping</font><font color="#CCCCCC"> me as</font>

211
00:07:41,729 --> 00:07:46,380
you are<font color="#CCCCCC"> a manoj or commandlets so doing</font>

212
00:07:44,430 --> 00:07:48,650
a lot of<font color="#E5E5E5"> the same stuff but definitely</font>

213
00:07:46,380 --> 00:07:52,860
required reading go<font color="#CCCCCC"> and</font><font color="#E5E5E5"> pick up</font><font color="#CCCCCC"> a copy</font>

214
00:07:48,650 --> 00:07:55,080
<font color="#E5E5E5">it's good read so this brings us</font><font color="#CCCCCC"> to</font>

215
00:07:52,860 --> 00:07:56,039
<font color="#CCCCCC">microburst</font><font color="#E5E5E5"> this is the name of the tool</font>

216
00:07:55,080 --> 00:07:57,510
that<font color="#CCCCCC"> we're going to be talking about</font>

217
00:07:56,039 --> 00:08:00,210
<font color="#E5E5E5">today it's a collection of</font><font color="#CCCCCC"> PowerShell</font>

218
00:07:57,510 --> 00:08:01,770
scripts and basically is the diagram

219
00:08:00,210 --> 00:08:03,780
outlines we've got powershell

220
00:08:01,770 --> 00:08:06,690
commandlets that dump out credentials

221
00:08:03,780 --> 00:08:09,000
config files<font color="#CCCCCC"> usable</font><font color="#E5E5E5"> data works out for</font>

222
00:08:06,690 --> 00:08:10,800
public file access lateral movement you

223
00:08:09,000 --> 00:08:12,090
can use all of<font color="#CCCCCC"> this data</font><font color="#E5E5E5"> to go</font>

224
00:08:10,800 --> 00:08:13,949
<font color="#E5E5E5">throughout and is your environment and</font>

225
00:08:12,090 --> 00:08:18,030
potentially pivot into an internal

226
00:08:13,949 --> 00:08:19,740
<font color="#CCCCCC">domain</font><font color="#E5E5E5"> from the cloud so this quick list</font>

227
00:08:18,030 --> 00:08:21,599
of<font color="#E5E5E5"> the</font><font color="#CCCCCC"> current functions and module</font>

228
00:08:19,740 --> 00:08:23,460
dependencies we're just<font color="#E5E5E5"> gonna get into</font>

229
00:08:21,599 --> 00:08:25,979
these so we're not<font color="#CCCCCC"> gonna spend too much</font>

230
00:08:23,460 --> 00:08:27,989
time on<font color="#CCCCCC"> that but how to run it pretty</font>

231
00:08:25,979 --> 00:08:32,159
<font color="#E5E5E5">simple just</font><font color="#CCCCCC"> use the</font><font color="#E5E5E5"> powershell import</font>

232
00:08:27,990 --> 00:08:33,510
module<font color="#E5E5E5"> just use the PSM one file</font><font color="#CCCCCC"> if</font><font color="#E5E5E5"> you</font>

233
00:08:32,159 --> 00:08:35,189
want to see<font color="#CCCCCC"> exactly what's being loaded</font>

234
00:08:33,510 --> 00:08:37,979
up or what modules<font color="#E5E5E5"> are</font><font color="#CCCCCC"> being used use</font>

235
00:08:35,190 --> 00:08:39,570
<font color="#CCCCCC">tak verbose here's some</font><font color="#E5E5E5"> simple command</font>

236
00:08:37,979 --> 00:08:42,120
examples these slides will be up<font color="#CCCCCC"> online</font>

237
00:08:39,570 --> 00:08:44,760
<font color="#E5E5E5">on SlideShare i'll post these on twitter</font>

238
00:08:42,120 --> 00:08:46,920
<font color="#CCCCCC">i can see the link at the very</font><font color="#E5E5E5"> end here</font>

239
00:08:44,760 --> 00:08:48,870
it's just<font color="#E5E5E5"> chaos</font><font color="#CCCCCC"> and on SlideShare but</font>

240
00:08:46,920 --> 00:08:50,540
<font color="#CCCCCC">i'll get those up hopefully and today</font>

241
00:08:48,870 --> 00:08:52,800
today<font color="#E5E5E5"> we'll see</font>

242
00:08:50,540 --> 00:08:54,750
but<font color="#E5E5E5"> we'll talk about all</font><font color="#CCCCCC"> of these</font>

243
00:08:52,800 --> 00:08:56,490
<font color="#E5E5E5">different tools in some of</font><font color="#CCCCCC"> our examples</font>

244
00:08:54,750 --> 00:08:59,130
here but<font color="#E5E5E5"> first we're</font><font color="#CCCCCC"> gonna give people</font>

245
00:08:56,490 --> 00:09:01,950
primer on some of<font color="#E5E5E5"> the other services</font><font color="#CCCCCC"> so</font>

246
00:08:59,130 --> 00:09:03,630
kind<font color="#E5E5E5"> of dope right in upfront about pen</font>

247
00:09:01,950 --> 00:09:05,250
testing<font color="#CCCCCC"> issue</font><font color="#E5E5E5"> or didn't really talk a</font>

248
00:09:03,630 --> 00:09:07,380
whole lot about<font color="#E5E5E5"> the actual issue</font><font color="#CCCCCC"> or</font>

249
00:09:05,250 --> 00:09:09,150
services<font color="#CCCCCC"> so let's take a step back and</font>

250
00:09:07,380 --> 00:09:13,350
<font color="#E5E5E5">talk about what</font><font color="#CCCCCC"> you can actually do with</font>

251
00:09:09,150 --> 00:09:14,520
<font color="#CCCCCC">sure so with the microbrews tools</font><font color="#E5E5E5"> that</font>

252
00:09:13,350 --> 00:09:15,680
we have we've<font color="#CCCCCC"> got</font><font color="#E5E5E5"> a number</font><font color="#CCCCCC"> of</font>

253
00:09:14,520 --> 00:09:18,329
authenticated and unauthenticated

254
00:09:15,680 --> 00:09:20,489
attacks<font color="#E5E5E5"> we</font><font color="#CCCCCC"> dumped out information for a</font>

255
00:09:18,330 --> 00:09:23,040
number<font color="#CCCCCC"> of</font><font color="#E5E5E5"> different</font><font color="#CCCCCC"> services since</font><font color="#E5E5E5"> this</font>

256
00:09:20,490 --> 00:09:24,900
is a stable talk and<font color="#CCCCCC"> I'm already eight</font>

257
00:09:23,040 --> 00:09:26,939
minutes in we're<font color="#E5E5E5"> not gonna have time</font><font color="#CCCCCC"> to</font>

258
00:09:24,900 --> 00:09:29,130
go<font color="#CCCCCC"> through everything but we'll</font><font color="#E5E5E5"> touch on</font>

259
00:09:26,940 --> 00:09:30,870
<font color="#E5E5E5">a couple</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> different services that</font><font color="#CCCCCC"> we</font>

260
00:09:29,130 --> 00:09:35,850
really focus on with the<font color="#CCCCCC"> microburst</font>

261
00:09:30,870 --> 00:09:37,920
<font color="#E5E5E5">tools so</font><font color="#CCCCCC"> is your Active Directory or as</font>

262
00:09:35,850 --> 00:09:39,660
your ad for<font color="#CCCCCC"> short is the</font><font color="#E5E5E5"> first thing</font>

263
00:09:37,920 --> 00:09:41,040
that<font color="#E5E5E5"> we're going to talk</font><font color="#CCCCCC"> about</font><font color="#E5E5E5"> I've</font>

264
00:09:39,660 --> 00:09:42,959
honestly found this to be<font color="#CCCCCC"> one of the</font>

265
00:09:41,040 --> 00:09:44,219
most<font color="#CCCCCC"> useful things to</font><font color="#E5E5E5"> dump information</font>

266
00:09:42,960 --> 00:09:47,010
about from an external<font color="#CCCCCC"> pentest</font>

267
00:09:44,220 --> 00:09:49,110
<font color="#E5E5E5">perspective we guess those fall</font><font color="#CCCCCC"> 20 18</font>

268
00:09:47,010 --> 00:09:51,000
creds log into the<font color="#E5E5E5"> azure portal and then</font>

269
00:09:49,110 --> 00:09:52,830
<font color="#E5E5E5">we're able to list out every single user</font>

270
00:09:51,000 --> 00:09:54,300
in the domain<font color="#CCCCCC"> okay cool</font>

271
00:09:52,830 --> 00:09:55,860
that gives us opportunities<font color="#CCCCCC"> to</font><font color="#E5E5E5"> do more</font>

272
00:09:54,300 --> 00:09:58,050
<font color="#E5E5E5">password guessing attacks because</font>

273
00:09:55,860 --> 00:09:59,610
typically we're starting with some OS in

274
00:09:58,050 --> 00:10:01,380
something<font color="#CCCCCC"> that you might be</font><font color="#E5E5E5"> pulling from</font>

275
00:09:59,610 --> 00:10:03,540
LinkedIn<font color="#CCCCCC"> you know</font><font color="#E5E5E5"> email addresses</font>

276
00:10:01,380 --> 00:10:05,189
anything like that<font color="#E5E5E5"> and this way we've</font>

277
00:10:03,540 --> 00:10:06,780
got<font color="#E5E5E5"> a full list of all</font><font color="#CCCCCC"> of the domain</font>

278
00:10:05,190 --> 00:10:09,330
<font color="#E5E5E5">users so</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> really opens up that</font>

279
00:10:06,780 --> 00:10:11,310
<font color="#E5E5E5">surface attack area on top of that we</font>

280
00:10:09,330 --> 00:10:13,620
can<font color="#CCCCCC"> get phone numbers for say</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> phone</font>

281
00:10:11,310 --> 00:10:16,109
based social engineering getting a list

282
00:10:13,620 --> 00:10:17,490
<font color="#E5E5E5">of the enrolled devices if laptops are</font>

283
00:10:16,110 --> 00:10:20,160
being enrolled with<font color="#E5E5E5"> Azure Active</font>

284
00:10:17,490 --> 00:10:21,690
Directory for device management<font color="#CCCCCC"> make</font>

285
00:10:20,160 --> 00:10:23,430
<font color="#CCCCCC">sure just go get a list of</font><font color="#E5E5E5"> all</font><font color="#CCCCCC"> of the</font>

286
00:10:21,690 --> 00:10:25,800
host names that are deployed to<font color="#E5E5E5"> specific</font>

287
00:10:23,430 --> 00:10:28,439
<font color="#CCCCCC">people so you can go ahead</font><font color="#E5E5E5"> and line up</font><font color="#CCCCCC"> o</font>

288
00:10:25,800 --> 00:10:30,839
<font color="#CCCCCC">host name 1 2 3 is tied to this</font><font color="#E5E5E5"> domain</font>

289
00:10:28,440 --> 00:10:32,310
administrator let's go target that box

290
00:10:30,840 --> 00:10:35,460
later once<font color="#E5E5E5"> we get into the internal</font>

291
00:10:32,310 --> 00:10:37,500
<font color="#E5E5E5">network third-party apps integration is</font>

292
00:10:35,460 --> 00:10:39,450
also really<font color="#E5E5E5"> handy</font><font color="#CCCCCC"> so once you've got</font>

293
00:10:37,500 --> 00:10:41,820
those creds<font color="#E5E5E5"> cool you can get</font><font color="#CCCCCC"> into</font>

294
00:10:39,450 --> 00:10:42,900
<font color="#E5E5E5">Outlook Web Access the Microsoft portals</font>

295
00:10:41,820 --> 00:10:44,670
that's nice

296
00:10:42,900 --> 00:10:46,590
but what<font color="#E5E5E5"> about other third-party apps</font>

297
00:10:44,670 --> 00:10:49,079
that are<font color="#E5E5E5"> single sign-on</font><font color="#CCCCCC"> either with is</font>

298
00:10:46,590 --> 00:10:50,550
your Active Directory or<font color="#E5E5E5"> ad FS we can</font>

299
00:10:49,080 --> 00:10:53,880
<font color="#E5E5E5">just list those</font><font color="#CCCCCC"> out from the azure</font>

300
00:10:50,550 --> 00:10:56,160
portal so if you're<font color="#E5E5E5"> integrating AWS or</font>

301
00:10:53,880 --> 00:10:58,350
<font color="#CCCCCC">WebEx or your HR or</font><font color="#E5E5E5"> Salesforce or</font>

302
00:10:56,160 --> 00:11:00,180
something like<font color="#E5E5E5"> that with a DFS we can</font>

303
00:10:58,350 --> 00:11:02,420
list that out and as an attacker we can

304
00:11:00,180 --> 00:11:05,209
start pivoting into those<font color="#E5E5E5"> systems</font>

305
00:11:02,420 --> 00:11:06,589
which can be<font color="#E5E5E5"> really</font><font color="#CCCCCC"> handy last</font><font color="#E5E5E5"> item that</font>

306
00:11:05,210 --> 00:11:09,620
<font color="#CCCCCC">I listed</font><font color="#E5E5E5"> on here for your Active</font>

307
00:11:06,590 --> 00:11:11,240
<font color="#E5E5E5">Directory is guest users so what</font><font color="#CCCCCC"> we'll</font>

308
00:11:09,620 --> 00:11:13,040
typically see in<font color="#E5E5E5"> most as your Active</font>

309
00:11:11,240 --> 00:11:15,290
Directory environments<font color="#CCCCCC"> is what's</font><font color="#E5E5E5"> called</font>

310
00:11:13,040 --> 00:11:17,689
a DC sync with a<font color="#E5E5E5"> primary domain so</font>

311
00:11:15,290 --> 00:11:19,250
you'll<font color="#E5E5E5"> have the company domain that DC</font>

312
00:11:17,690 --> 00:11:21,080
syncs up<font color="#CCCCCC"> to is your Active Directory</font>

313
00:11:19,250 --> 00:11:23,060
which syncs the<font color="#E5E5E5"> credentials</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> user</font>

314
00:11:21,080 --> 00:11:26,300
<font color="#E5E5E5">names and domain information</font><font color="#CCCCCC"> up to Azure</font>

315
00:11:23,060 --> 00:11:28,699
ad<font color="#CCCCCC"> and you</font><font color="#E5E5E5"> can have guest users added to</font>

316
00:11:26,300 --> 00:11:30,079
that as your Active Directory so let's

317
00:11:28,700 --> 00:11:31,670
say that<font color="#CCCCCC"> I get</font><font color="#E5E5E5"> access to</font><font color="#CCCCCC"> an</font><font color="#E5E5E5"> owner</font>

318
00:11:30,080 --> 00:11:34,040
account<font color="#CCCCCC"> on one of these subscriptions</font>

319
00:11:31,670 --> 00:11:36,740
<font color="#CCCCCC">icon I can</font><font color="#E5E5E5"> go ahead and</font><font color="#CCCCCC"> add my net spy</font>

320
00:11:34,040 --> 00:11:38,360
account as a guest account<font color="#CCCCCC"> in Azure</font>

321
00:11:36,740 --> 00:11:39,830
Active Directory and<font color="#E5E5E5"> get a little</font><font color="#CCCCCC"> bit</font>

322
00:11:38,360 --> 00:11:41,810
more persistence

323
00:11:39,830 --> 00:11:44,510
not<font color="#E5E5E5"> necessarily the most OPSEC safe</font>

324
00:11:41,810 --> 00:11:46,550
thing<font color="#E5E5E5"> being pretty obvious at that point</font>

325
00:11:44,510 --> 00:11:48,830
adding a user<font color="#E5E5E5"> however you know if people</font>

326
00:11:46,550 --> 00:11:50,180
<font color="#CCCCCC">are</font><font color="#E5E5E5"> not auditing those guest users or</font>

327
00:11:48,830 --> 00:11:51,320
they're on those subscriptions<font color="#E5E5E5"> you might</font>

328
00:11:50,180 --> 00:11:54,530
be able<font color="#E5E5E5"> to hide out there for a</font><font color="#CCCCCC"> little</font>

329
00:11:51,320 --> 00:11:56,090
<font color="#E5E5E5">bit longer</font><font color="#CCCCCC"> so I think we talked through</font>

330
00:11:54,530 --> 00:11:57,740
<font color="#E5E5E5">most of the practical examples here I</font>

331
00:11:56,090 --> 00:11:59,420
think the one<font color="#CCCCCC"> thing I didn't touch</font><font color="#E5E5E5"> on</font>

332
00:11:57,740 --> 00:12:01,340
was fishing so enumerated all of those

333
00:11:59,420 --> 00:12:03,110
users<font color="#CCCCCC"> and</font><font color="#E5E5E5"> getting the additional email</font>

334
00:12:01,340 --> 00:12:05,690
addresses you've got a<font color="#E5E5E5"> nice base for</font>

335
00:12:03,110 --> 00:12:10,940
<font color="#E5E5E5">fishing but pretty</font><font color="#CCCCCC"> much</font><font color="#E5E5E5"> talk</font><font color="#CCCCCC"> about</font>

336
00:12:05,690 --> 00:12:13,250
anything<font color="#E5E5E5"> else so next thing we're gonna</font>

337
00:12:10,940 --> 00:12:15,230
talk<font color="#E5E5E5"> about</font><font color="#CCCCCC"> our sure storage accounts now</font>

338
00:12:13,250 --> 00:12:18,050
<font color="#CCCCCC">as</font><font color="#E5E5E5"> yours got kind</font><font color="#CCCCCC"> of a different</font>

339
00:12:15,230 --> 00:12:20,330
structure for handling<font color="#E5E5E5"> data within the</font>

340
00:12:18,050 --> 00:12:22,520
cloud primary thing that<font color="#E5E5E5"> we're really</font>

341
00:12:20,330 --> 00:12:24,920
<font color="#E5E5E5">going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> talk</font><font color="#CCCCCC"> about</font><font color="#E5E5E5"> today is</font><font color="#CCCCCC"> sure</font><font color="#E5E5E5"> lobs</font>

342
00:12:22,520 --> 00:12:26,900
and<font color="#E5E5E5"> easiest way to describe this</font><font color="#CCCCCC"> as</font>

343
00:12:24,920 --> 00:12:30,050
comparing it to AWS<font color="#E5E5E5"> if you're familiar</font>

344
00:12:26,900 --> 00:12:32,090
with s3 containers<font color="#E5E5E5"> it's very similar to</font>

345
00:12:30,050 --> 00:12:34,699
<font color="#CCCCCC">that Microsoft probably would</font><font color="#E5E5E5"> like that</font>

346
00:12:32,090 --> 00:12:36,020
comparison<font color="#CCCCCC"> but it's the easiest way to</font>

347
00:12:34,700 --> 00:12:39,080
describe<font color="#CCCCCC"> it</font><font color="#E5E5E5"> for people that are not</font>

348
00:12:36,020 --> 00:12:41,150
<font color="#CCCCCC">familiar with a</font><font color="#E5E5E5"> juror so blob storage is</font>

349
00:12:39,080 --> 00:12:42,710
<font color="#CCCCCC">just kind of unstructured</font><font color="#E5E5E5"> dump file into</font>

350
00:12:41,150 --> 00:12:45,079
a<font color="#CCCCCC"> folder</font><font color="#E5E5E5"> you have it there you</font><font color="#CCCCCC"> can</font>

351
00:12:42,710 --> 00:12:46,910
<font color="#CCCCCC">access it you can set</font><font color="#E5E5E5"> up permissions for</font>

352
00:12:45,080 --> 00:12:49,460
it access policies which we'll talk

353
00:12:46,910 --> 00:12:51,290
<font color="#E5E5E5">about next</font><font color="#CCCCCC"> but you know from a</font><font color="#E5E5E5"> practical</font>

354
00:12:49,460 --> 00:12:52,970
example standpoint we've done as your

355
00:12:51,290 --> 00:12:54,920
assessments<font color="#E5E5E5"> take them look at storage</font>

356
00:12:52,970 --> 00:12:57,410
containers where we'll find config files

357
00:12:54,920 --> 00:12:59,449
<font color="#E5E5E5">VHD files which we'll talk</font><font color="#CCCCCC"> about in the</font>

358
00:12:57,410 --> 00:13:02,600
practical<font color="#E5E5E5"> example but basically virtual</font>

359
00:12:59,450 --> 00:13:05,390
hard disks publicly available files<font color="#E5E5E5"> that</font>

360
00:13:02,600 --> 00:13:07,430
shouldn't be public PII

361
00:13:05,390 --> 00:13:08,689
all sorts<font color="#E5E5E5"> of good stuff that</font><font color="#CCCCCC"> you just</font>

362
00:13:07,430 --> 00:13:11,060
<font color="#E5E5E5">shouldn't be able to find normally</font>

363
00:13:08,690 --> 00:13:13,490
publicly<font color="#E5E5E5"> and you can also use this</font><font color="#CCCCCC"> for</font>

364
00:13:11,060 --> 00:13:15,689
hosting payloads<font color="#E5E5E5"> since what we're</font><font color="#CCCCCC"> going</font>

365
00:13:13,490 --> 00:13:18,030
<font color="#CCCCCC">to see</font><font color="#E5E5E5"> here for the</font><font color="#CCCCCC"> naming structure you</font>

366
00:13:15,690 --> 00:13:20,670
is the this<font color="#E5E5E5"> laser</font><font color="#CCCCCC"> pointer is not</font><font color="#E5E5E5"> gonna</font>

367
00:13:18,030 --> 00:13:23,880
work<font color="#CCCCCC"> from this</font><font color="#E5E5E5"> angle</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> I we</font><font color="#CCCCCC"> seen nets</font>

368
00:13:20,670 --> 00:13:26,939
<font color="#E5E5E5">by Azure blob core windows net that's</font>

369
00:13:23,880 --> 00:13:28,200
the storage<font color="#CCCCCC"> account name</font><font color="#E5E5E5"> so net spy as</font>

370
00:13:26,940 --> 00:13:30,750
<font color="#E5E5E5">your is what we named the storage</font>

371
00:13:28,200 --> 00:13:32,640
account<font color="#CCCCCC"> blob core</font><font color="#E5E5E5"> windows net is the URL</font>

372
00:13:30,750 --> 00:13:34,140
<font color="#E5E5E5">to</font><font color="#CCCCCC"> access the</font><font color="#E5E5E5"> rest of it then you have</font>

373
00:13:32,640 --> 00:13:36,210
folder structures<font color="#CCCCCC"> behind that that cover</font>

374
00:13:34,140 --> 00:13:37,350
the containers well talk a little bit

375
00:13:36,210 --> 00:13:40,440
<font color="#E5E5E5">more about</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> when we talk</font><font color="#CCCCCC"> about the</font>

376
00:13:37,350 --> 00:13:43,290
enumeration<font color="#E5E5E5"> but I</font>

377
00:13:40,440 --> 00:13:45,720
that's a trusted domain<font color="#CCCCCC"> coming from</font>

378
00:13:43,290 --> 00:13:47,390
<font color="#CCCCCC">Windows net if you're trying</font><font color="#E5E5E5"> to go</font><font color="#CCCCCC"> to</font>

379
00:13:45,720 --> 00:13:49,350
<font color="#CCCCCC">the Internet to</font><font color="#E5E5E5"> pull down a payload</font>

380
00:13:47,390 --> 00:13:51,360
<font color="#CCCCCC">you're</font><font color="#E5E5E5"> probably not going to get blocked</font>

381
00:13:49,350 --> 00:13:53,010
for windows.net<font color="#CCCCCC"> if you're going out to</font>

382
00:13:51,360 --> 00:13:55,770
<font color="#E5E5E5">fishing domain.com to pull down the</font>

383
00:13:53,010 --> 00:13:57,150
payload<font color="#E5E5E5"> okay chances</font><font color="#CCCCCC"> that you're gonna</font>

384
00:13:55,770 --> 00:13:59,310
get blocked there are much more<font color="#CCCCCC"> likely</font>

385
00:13:57,150 --> 00:14:01,260
so using a<font color="#E5E5E5"> trusted domain from</font><font color="#CCCCCC"> Windows</font>

386
00:13:59,310 --> 00:14:03,560
<font color="#E5E5E5">might be handy</font><font color="#CCCCCC"> for hosting some</font><font color="#E5E5E5"> of your</font>

387
00:14:01,260 --> 00:14:03,560
payloads

388
00:14:03,950 --> 00:14:09,450
so for the anonymous<font color="#E5E5E5"> blob enumeration</font>

389
00:14:06,990 --> 00:14:12,090
<font color="#CCCCCC">you can set what's called an access</font>

390
00:14:09,450 --> 00:14:13,590
policy for the blob containers so you've

391
00:14:12,090 --> 00:14:15,030
got the<font color="#E5E5E5"> storage account</font><font color="#CCCCCC"> underneath that</font>

392
00:14:13,590 --> 00:14:17,250
you've got the containers underneath

393
00:14:15,030 --> 00:14:19,380
that you've got the blob<font color="#E5E5E5"> so for the</font>

394
00:14:17,250 --> 00:14:21,510
container<font color="#E5E5E5"> you can set the public access</font>

395
00:14:19,380 --> 00:14:23,910
level since permissions are hard

396
00:14:21,510 --> 00:14:25,740
sometimes and<font color="#E5E5E5"> it's just easier to give</font>

397
00:14:23,910 --> 00:14:27,510
everybody access we've seen that

398
00:14:25,740 --> 00:14:29,730
container permissions are frequently

399
00:14:27,510 --> 00:14:32,400
used which allow for<font color="#E5E5E5"> anonymous read</font>

400
00:14:29,730 --> 00:14:34,080
access for containers and blobs<font color="#CCCCCC"> which</font>

401
00:14:32,400 --> 00:14:35,939
means if<font color="#E5E5E5"> you're an anonymous user who</font>

402
00:14:34,080 --> 00:14:38,130
knows the storage account<font color="#E5E5E5"> and the name</font>

403
00:14:35,940 --> 00:14:40,770
<font color="#E5E5E5">of the container you can list out all of</font>

404
00:14:38,130 --> 00:14:43,020
the files<font color="#CCCCCC"> so a lot of</font><font color="#E5E5E5"> this can be done</font>

405
00:14:40,770 --> 00:14:45,300
<font color="#CCCCCC">with Google Dorking on the blob core</font>

406
00:14:43,020 --> 00:14:47,850
<font color="#E5E5E5">windows net I've actually got</font>

407
00:14:45,300 --> 00:14:49,949
functionality built into<font color="#E5E5E5"> the script</font>

408
00:14:47,850 --> 00:14:51,480
<font color="#E5E5E5">that's tied</font><font color="#CCCCCC"> to this to do Bing searches</font>

409
00:14:49,950 --> 00:14:54,870
<font color="#E5E5E5">because things easy to do with</font>

410
00:14:51,480 --> 00:14:57,780
PowerShell<font color="#E5E5E5"> but wrap Bing searches in</font>

411
00:14:54,870 --> 00:14:59,430
here to expand the<font color="#CCCCCC"> scope a little bit so</font>

412
00:14:57,780 --> 00:15:01,110
what this script will actually do is

413
00:14:59,430 --> 00:15:02,790
take a keyword<font color="#E5E5E5"> in the case that will</font>

414
00:15:01,110 --> 00:15:05,640
show in the examples here we'll just<font color="#CCCCCC"> use</font>

415
00:15:02,790 --> 00:15:07,189
<font color="#E5E5E5">micro burst and do a quick search</font><font color="#CCCCCC"> for</font>

416
00:15:05,640 --> 00:15:09,569
that so do some<font color="#E5E5E5"> DNS brute-forcing</font>

417
00:15:07,190 --> 00:15:11,430
<font color="#E5E5E5">potentially add a Bing search to that to</font>

418
00:15:09,570 --> 00:15:13,080
<font color="#CCCCCC">identify</font><font color="#E5E5E5"> additional storage accounts and</font>

419
00:15:11,430 --> 00:15:16,079
then<font color="#E5E5E5"> iterate through potential</font>

420
00:15:13,080 --> 00:15:17,670
containers at that point once we've

421
00:15:16,080 --> 00:15:19,650
identified a public<font color="#E5E5E5"> folder we use the</font>

422
00:15:17,670 --> 00:15:21,420
<font color="#CCCCCC">issue arrest api's</font><font color="#E5E5E5"> to actually list out</font>

423
00:15:19,650 --> 00:15:24,480
the<font color="#E5E5E5"> files cuz it's about the easiest way</font>

424
00:15:21,420 --> 00:15:26,790
to do that<font color="#E5E5E5"> but like I</font><font color="#CCCCCC"> said we frequently</font>

425
00:15:24,480 --> 00:15:28,650
find<font color="#E5E5E5"> public containers with just all</font>

426
00:15:26,790 --> 00:15:29,969
sorts of<font color="#CCCCCC"> information interesting</font>

427
00:15:28,650 --> 00:15:32,890
<font color="#E5E5E5">information</font>

428
00:15:29,970 --> 00:15:36,120
so another<font color="#CCCCCC"> sewer service that we're</font>

429
00:15:32,890 --> 00:15:39,819
gonna chat about here is a juror sequel

430
00:15:36,120 --> 00:15:41,470
and<font color="#E5E5E5"> a</font><font color="#CCCCCC"> Juris</font><font color="#E5E5E5"> equals a kind of interesting</font>

431
00:15:39,820 --> 00:15:43,570
what<font color="#E5E5E5"> we're typically seeing it used for</font>

432
00:15:41,470 --> 00:15:46,540
is just application services that need a

433
00:15:43,570 --> 00:15:48,940
database<font color="#CCCCCC"> out in the cloud</font><font color="#E5E5E5"> so it's</font>

434
00:15:46,540 --> 00:15:51,069
Microsoft sequel<font color="#E5E5E5"> out in the cloud but</font>

435
00:15:48,940 --> 00:15:54,190
<font color="#E5E5E5">what we've actually found is</font><font color="#CCCCCC"> that people</font>

436
00:15:51,070 --> 00:15:55,660
<font color="#E5E5E5">will just open</font><font color="#CCCCCC"> up access</font><font color="#E5E5E5"> and keep those</font>

437
00:15:54,190 --> 00:15:58,270
sequel servers wide opening<font color="#E5E5E5"> Internet</font>

438
00:15:55,660 --> 00:15:59,529
well sequel servers can frequently<font color="#E5E5E5"> be</font>

439
00:15:58,270 --> 00:16:01,540
configured with<font color="#E5E5E5"> we could default</font>

440
00:15:59,529 --> 00:16:03,610
passwords when my<font color="#CCCCCC"> coworkers Scott</font>

441
00:16:01,540 --> 00:16:04,990
Sutherland who wrote<font color="#E5E5E5"> powerup sequel has</font>

442
00:16:03,610 --> 00:16:07,540
done a little<font color="#E5E5E5"> bit of research into this</font>

443
00:16:04,990 --> 00:16:09,610
space<font color="#E5E5E5"> and yeah just like regular</font>

444
00:16:07,540 --> 00:16:11,560
Microsoft sequel as<font color="#CCCCCC"> your a sequel can</font>

445
00:16:09,610 --> 00:16:13,450
<font color="#CCCCCC">default at some of the same pitfalls</font>

446
00:16:11,560 --> 00:16:16,869
that<font color="#E5E5E5"> you find with standard Microsoft</font>

447
00:16:13,450 --> 00:16:19,360
<font color="#CCCCCC">sequel servers so in terms of accessing</font>

448
00:16:16,870 --> 00:16:22,029
<font color="#CCCCCC">that data</font><font color="#E5E5E5"> if you're an attacker who's</font>

449
00:16:19,360 --> 00:16:24,460
got domain creds<font color="#CCCCCC"> and gets</font><font color="#E5E5E5"> into the azure</font>

450
00:16:22,029 --> 00:16:26,200
portal you can<font color="#CCCCCC"> actually just directly</font>

451
00:16:24,460 --> 00:16:28,480
query databases<font color="#E5E5E5"> if you have rights to</font>

452
00:16:26,200 --> 00:16:30,580
them<font color="#E5E5E5"> from the portal</font><font color="#CCCCCC"> they've got a query</font>

453
00:16:28,480 --> 00:16:33,279
Explorer built into the<font color="#CCCCCC"> Guru sequel</font>

454
00:16:30,580 --> 00:16:34,930
section pretty easy to access<font color="#E5E5E5"> you can</font>

455
00:16:33,279 --> 00:16:37,240
also access<font color="#E5E5E5"> it from sequel management</font>

456
00:16:34,930 --> 00:16:39,430
studio if the firewall rules allow it

457
00:16:37,240 --> 00:16:41,440
by default Microsoft<font color="#CCCCCC"> does lock that</font><font color="#E5E5E5"> down</font>

458
00:16:39,430 --> 00:16:43,510
and makes you put exceptions in for your

459
00:16:41,440 --> 00:16:45,490
<font color="#E5E5E5">own IP addresses</font><font color="#CCCCCC"> but we've seen it where</font>

460
00:16:43,510 --> 00:16:47,490
people<font color="#E5E5E5"> are kind</font><font color="#CCCCCC"> of lazy and</font><font color="#E5E5E5"> want</font><font color="#CCCCCC"> to open</font>

461
00:16:45,490 --> 00:16:49,360
it<font color="#E5E5E5"> up for multiple different</font><font color="#CCCCCC"> IPs and</font>

462
00:16:47,490 --> 00:16:52,959
just open it up everywhere

463
00:16:49,360 --> 00:16:54,820
so some practical examples<font color="#E5E5E5"> we've</font><font color="#CCCCCC"> seen</font>

464
00:16:52,959 --> 00:16:56,520
development development environments

465
00:16:54,820 --> 00:16:59,410
where those sequel servers are available

466
00:16:56,520 --> 00:17:02,050
open firewall rules and get in<font color="#CCCCCC"> with a</font>

467
00:16:59,410 --> 00:17:03,730
weak<font color="#CCCCCC"> sa password something like that so</font>

468
00:17:02,050 --> 00:17:06,550
it's gonna be handy<font color="#E5E5E5"> I did have a bullet</font>

469
00:17:03,730 --> 00:17:09,520
<font color="#E5E5E5">on here for a Jewish sequel used as</font><font color="#CCCCCC"> a C</font>

470
00:17:06,550 --> 00:17:11,079
<font color="#E5E5E5">- Scott Sullivan did write a blog post</font>

471
00:17:09,520 --> 00:17:13,599
<font color="#CCCCCC">about</font><font color="#E5E5E5"> this to tell them and that's my</font>

472
00:17:11,079 --> 00:17:15,550
blog but since<font color="#E5E5E5"> as your sequels going</font>

473
00:17:13,599 --> 00:17:18,359
through those trusted<font color="#CCCCCC"> Microsoft domains</font>

474
00:17:15,550 --> 00:17:20,919
<font color="#CCCCCC">you can just go ahead and make</font><font color="#E5E5E5"> your C to</font>

475
00:17:18,359 --> 00:17:22,780
communications<font color="#E5E5E5"> out through</font><font color="#CCCCCC"> that and use</font>

476
00:17:20,920 --> 00:17:27,010
<font color="#CCCCCC">that</font><font color="#E5E5E5"> as your sequel database as that</font>

477
00:17:22,780 --> 00:17:28,569
pivot point<font color="#CCCCCC"> so I can be</font><font color="#E5E5E5"> pretty handy so</font>

478
00:17:27,010 --> 00:17:31,300
the last thing<font color="#E5E5E5"> I'm going</font><font color="#CCCCCC"> to cover on the</font>

479
00:17:28,569 --> 00:17:34,210
services<font color="#CCCCCC"> side of things</font><font color="#E5E5E5"> prior to jumping</font>

480
00:17:31,300 --> 00:17:35,770
into the demo here<font color="#CCCCCC"> is password so</font>

481
00:17:34,210 --> 00:17:37,600
passwords<font color="#E5E5E5"> can be stored in a number of</font>

482
00:17:35,770 --> 00:17:39,129
<font color="#E5E5E5">different</font><font color="#CCCCCC"> places in these</font><font color="#E5E5E5"> your you've</font>

483
00:17:37,600 --> 00:17:41,290
<font color="#E5E5E5">got key vaults app service</font>

484
00:17:39,130 --> 00:17:42,429
configurations<font color="#E5E5E5"> and automation accounts</font>

485
00:17:41,290 --> 00:17:43,010
kind of the primary ones<font color="#E5E5E5"> that we're</font>

486
00:17:42,429 --> 00:17:45,440
going<font color="#E5E5E5"> to</font><font color="#CCCCCC"> focus</font>

487
00:17:43,010 --> 00:17:46,700
<font color="#CCCCCC">keye volts you can store all sorts of</font>

488
00:17:45,440 --> 00:17:47,960
<font color="#E5E5E5">great</font><font color="#CCCCCC"> information in here what</font><font color="#E5E5E5"> we've</font>

489
00:17:46,700 --> 00:17:49,550
found<font color="#CCCCCC"> with key vaults is those are</font>

490
00:17:47,960 --> 00:17:51,680
usually<font color="#E5E5E5"> typically locked down a little</font>

491
00:17:49,550 --> 00:17:53,510
<font color="#E5E5E5">bit more but if you've got owner rights</font>

492
00:17:51,680 --> 00:17:54,740
on that<font color="#E5E5E5"> subscription you can go ahead</font>

493
00:17:53,510 --> 00:17:57,470
<font color="#CCCCCC">and give yourself access to the key</font>

494
00:17:54,740 --> 00:17:59,600
<font color="#E5E5E5">bolts as well so we find keys certs</font>

495
00:17:57,470 --> 00:18:01,490
passwords all sorts of really good stuff

496
00:17:59,600 --> 00:18:04,820
but you expect<font color="#E5E5E5"> to find in a key vault</font>

497
00:18:01,490 --> 00:18:07,700
<font color="#CCCCCC">their app services are basically</font><font color="#E5E5E5"> rapid</font>

498
00:18:04,820 --> 00:18:09,290
<font color="#CCCCCC">application deployment options within a</font>

499
00:18:07,700 --> 00:18:11,390
juror so let's say you want to fire up<font color="#CCCCCC"> a</font>

500
00:18:09,290 --> 00:18:13,760
web application<font color="#CCCCCC"> you just point</font><font color="#E5E5E5"> it at a</font>

501
00:18:11,390 --> 00:18:15,710
github<font color="#E5E5E5"> or a source code zip anything</font>

502
00:18:13,760 --> 00:18:18,260
like<font color="#CCCCCC"> that and you can rapidly fire up</font>

503
00:18:15,710 --> 00:18:20,570
these app services<font color="#E5E5E5"> to have web services</font>

504
00:18:18,260 --> 00:18:23,360
available<font color="#CCCCCC"> it's great</font><font color="#E5E5E5"> for scaling pretty</font>

505
00:18:20,570 --> 00:18:24,590
handy<font color="#CCCCCC"> we found that it can</font><font color="#E5E5E5"> actually kind</font>

506
00:18:23,360 --> 00:18:26,689
<font color="#E5E5E5">of work for</font><font color="#CCCCCC"> phishing domains as well</font>

507
00:18:24,590 --> 00:18:30,320
<font color="#E5E5E5">since by default they issue you</font><font color="#CCCCCC"> a</font>

508
00:18:26,690 --> 00:18:31,550
Microsoft domain right<font color="#CCCCCC"> off the bat but</font>

509
00:18:30,320 --> 00:18:34,580
that's covered<font color="#CCCCCC"> in another blog post</font>

510
00:18:31,550 --> 00:18:35,899
<font color="#E5E5E5">that's up on the net spy blog but when</font>

511
00:18:34,580 --> 00:18:40,310
we're<font color="#CCCCCC"> doing that you can</font><font color="#E5E5E5"> actually get</font>

512
00:18:35,900 --> 00:18:41,510
credentials<font color="#E5E5E5"> for FTP and can't remember</font>

513
00:18:40,310 --> 00:18:43,370
<font color="#E5E5E5">the other</font><font color="#CCCCCC"> service that's available</font><font color="#E5E5E5"> we'll</font>

514
00:18:41,510 --> 00:18:45,650
see it my demo<font color="#E5E5E5"> but you can get</font>

515
00:18:43,370 --> 00:18:47,600
credentials<font color="#CCCCCC"> for actually just deploying</font>

516
00:18:45,650 --> 00:18:49,610
that<font color="#E5E5E5"> so let's say</font><font color="#CCCCCC"> that you want</font><font color="#E5E5E5"> to throw</font>

517
00:18:47,600 --> 00:18:51,919
a web shell up on one of these<font color="#E5E5E5"> app</font>

518
00:18:49,610 --> 00:18:53,300
services configurations you could

519
00:18:51,920 --> 00:18:55,370
<font color="#E5E5E5">potentially do that by capturing those</font>

520
00:18:53,300 --> 00:18:57,530
credentials for the deployment

521
00:18:55,370 --> 00:18:58,969
credentials<font color="#E5E5E5"> in addition to that let's</font>

522
00:18:57,530 --> 00:19:00,800
say that<font color="#E5E5E5"> they've got a</font><font color="#CCCCCC"> juror sequel set</font>

523
00:18:58,970 --> 00:19:02,750
up for those application services that

524
00:19:00,800 --> 00:19:04,760
they're<font color="#CCCCCC"> running there might be database</font>

525
00:19:02,750 --> 00:19:07,250
connection strings included in those app

526
00:19:04,760 --> 00:19:09,590
service configurations so again<font color="#E5E5E5"> pretty</font>

527
00:19:07,250 --> 00:19:11,690
handy<font color="#CCCCCC"> to get access to that automation</font>

528
00:19:09,590 --> 00:19:13,459
accounts we'll cover here automation

529
00:19:11,690 --> 00:19:15,530
accounts can<font color="#E5E5E5"> be used to automate things</font>

530
00:19:13,460 --> 00:19:17,510
<font color="#E5E5E5">in a juror and typically things are set</font>

531
00:19:15,530 --> 00:19:20,030
up<font color="#E5E5E5"> with a username and</font><font color="#CCCCCC"> password to</font><font color="#E5E5E5"> run</font>

532
00:19:17,510 --> 00:19:21,170
those automation automation jobs the

533
00:19:20,030 --> 00:19:23,600
script<font color="#E5E5E5"> that we're seeing right here is</font>

534
00:19:21,170 --> 00:19:26,540
<font color="#E5E5E5">actually the script that we'll use in</font>

535
00:19:23,600 --> 00:19:28,580
the PowerShell script<font color="#E5E5E5"> to basically get</font>

536
00:19:26,540 --> 00:19:30,139
those<font color="#CCCCCC"> credentials</font><font color="#E5E5E5"> out of a juror so</font>

537
00:19:28,580 --> 00:19:31,429
really<font color="#E5E5E5"> all it does is it creates objects</font>

538
00:19:30,140 --> 00:19:33,710
for the<font color="#E5E5E5"> username and</font><font color="#CCCCCC"> password writes</font>

539
00:19:31,430 --> 00:19:36,230
them to the output<font color="#E5E5E5"> we upload that script</font>

540
00:19:33,710 --> 00:19:38,630
<font color="#CCCCCC">up to in Azure runbook we run the</font><font color="#E5E5E5"> run</font>

541
00:19:36,230 --> 00:19:40,790
<font color="#E5E5E5">book typically do this with a pre</font>

542
00:19:38,630 --> 00:19:43,310
generated like<font color="#E5E5E5"> 12 character</font><font color="#CCCCCC"> upper/lower</font>

543
00:19:40,790 --> 00:19:44,840
looks<font color="#E5E5E5"> fairly random it does show up in</font>

544
00:19:43,310 --> 00:19:46,429
the logs but we delete the run book

545
00:19:44,840 --> 00:19:48,439
after the fact so<font color="#CCCCCC"> it just kind of looks</font>

546
00:19:46,430 --> 00:19:49,910
like a randomly named<font color="#E5E5E5"> you'll see it in</font>

547
00:19:48,440 --> 00:19:52,220
the example<font color="#E5E5E5"> but it looks like</font><font color="#CCCCCC"> a randomly</font>

548
00:19:49,910 --> 00:19:54,500
named job that shows up in there and

549
00:19:52,220 --> 00:19:56,960
<font color="#E5E5E5">then</font><font color="#CCCCCC"> we've got credentials</font><font color="#E5E5E5"> from the</font>

550
00:19:54,500 --> 00:20:01,559
<font color="#E5E5E5">automation accounts</font>

551
00:19:56,960 --> 00:20:06,029
so quick demo<font color="#CCCCCC"> here since I</font><font color="#E5E5E5"> think we got</font>

552
00:20:01,559 --> 00:20:08,039
<font color="#E5E5E5">about five right well five okay so this</font>

553
00:20:06,029 --> 00:20:10,049
<font color="#E5E5E5">is a sample escalation</font><font color="#CCCCCC"> that kind</font><font color="#E5E5E5"> of</font>

554
00:20:08,039 --> 00:20:12,870
comes out of a<font color="#E5E5E5"> couple of different</font>

555
00:20:10,049 --> 00:20:15,750
things<font color="#CCCCCC"> that I've seen in the actual</font><font color="#E5E5E5"> live</font>

556
00:20:12,870 --> 00:20:17,129
environments I've worked with<font color="#E5E5E5"> first</font>

557
00:20:15,750 --> 00:20:18,779
thing that we're gonna do is enumerate a

558
00:20:17,130 --> 00:20:19,919
public blob storage container there's

559
00:20:18,779 --> 00:20:21,390
<font color="#CCCCCC">number</font><font color="#E5E5E5"> of different ways that we</font><font color="#CCCCCC"> can run</font>

560
00:20:19,919 --> 00:20:23,220
<font color="#E5E5E5">into these public storage containers</font>

561
00:20:21,390 --> 00:20:25,799
either authenticated or unauthenticated

562
00:20:23,220 --> 00:20:27,899
<font color="#CCCCCC">in this case we will</font><font color="#E5E5E5"> be unauthenticated</font>

563
00:20:25,799 --> 00:20:30,750
<font color="#CCCCCC">we'll find a micro burst container and</font>

564
00:20:27,899 --> 00:20:31,860
<font color="#E5E5E5">get a VHD file</font><font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> gonna read through</font>

565
00:20:30,750 --> 00:20:33,690
<font color="#E5E5E5">all of this because</font><font color="#CCCCCC"> I'm just gonna show</font>

566
00:20:31,860 --> 00:20:36,418
<font color="#CCCCCC">you the</font><font color="#E5E5E5"> example but wanted</font><font color="#CCCCCC"> to prime</font><font color="#E5E5E5"> you</font>

567
00:20:33,690 --> 00:20:39,210
for that right here<font color="#CCCCCC"> so the first thing</font>

568
00:20:36,419 --> 00:20:43,289
we're gonna do<font color="#CCCCCC"> is import the module for</font>

569
00:20:39,210 --> 00:20:49,470
micro burst and run<font color="#E5E5E5"> as soon as I can hit</font>

570
00:20:43,289 --> 00:20:51,269
<font color="#CCCCCC">play</font><font color="#E5E5E5"> here there we go so we'll import</font>

571
00:20:49,470 --> 00:20:53,429
<font color="#E5E5E5">the module and use the invoke enumerate</font>

572
00:20:51,269 --> 00:20:55,200
issuer blobs with the base<font color="#E5E5E5"> of micro</font>

573
00:20:53,429 --> 00:20:57,179
burst so you can see we<font color="#E5E5E5"> found a storage</font>

574
00:20:55,200 --> 00:20:58,950
account for micro burst blob<font color="#CCCCCC"> court out</font>

575
00:20:57,179 --> 00:21:00,750
<font color="#E5E5E5">windows.net for those that are</font>

576
00:20:58,950 --> 00:21:03,149
interested<font color="#E5E5E5"> in diving</font><font color="#CCCCCC"> into</font><font color="#E5E5E5"> this and is</font>

577
00:21:00,750 --> 00:21:05,610
hacking my subscription I've<font color="#E5E5E5"> burned this</font>

578
00:21:03,149 --> 00:21:07,799
one to the ground already so that's<font color="#E5E5E5"> why</font>

579
00:21:05,610 --> 00:21:08,969
we're<font color="#E5E5E5"> using videos because it didn't</font>

580
00:21:07,799 --> 00:21:11,158
<font color="#E5E5E5">make sense</font><font color="#CCCCCC"> to put something</font><font color="#E5E5E5"> out on the</font>

581
00:21:08,970 --> 00:21:14,669
<font color="#CCCCCC">cloud</font><font color="#E5E5E5"> for public people to started</font>

582
00:21:11,159 --> 00:21:16,710
<font color="#E5E5E5">hacking so anyways what we found here</font><font color="#CCCCCC"> is</font>

583
00:21:14,669 --> 00:21:19,350
a public<font color="#E5E5E5"> file available under the test</font>

584
00:21:16,710 --> 00:21:20,309
container so<font color="#E5E5E5"> we did</font><font color="#CCCCCC"> DNS brute-forcing to</font>

585
00:21:19,350 --> 00:21:23,399
find micro burst

586
00:21:20,309 --> 00:21:25,710
<font color="#E5E5E5">blob core windows</font><font color="#CCCCCC"> at net and then</font>

587
00:21:23,399 --> 00:21:27,750
enumerated a test<font color="#E5E5E5"> folder or container</font>

588
00:21:25,710 --> 00:21:31,799
<font color="#CCCCCC">within</font><font color="#E5E5E5"> there and listed out</font><font color="#CCCCCC"> files so</font>

589
00:21:27,750 --> 00:21:34,049
we've got a URL<font color="#E5E5E5"> for test dot V HD which</font>

590
00:21:31,799 --> 00:21:35,460
<font color="#CCCCCC">we'll go incognito here and show that</font>

591
00:21:34,049 --> 00:21:38,070
you know we're not<font color="#E5E5E5"> currently logged in</font>

592
00:21:35,460 --> 00:21:40,350
<font color="#E5E5E5">anywhere it's super exciting here we're</font>

593
00:21:38,070 --> 00:21:43,918
gonna<font color="#E5E5E5"> download a file so we'll paste</font>

594
00:21:40,350 --> 00:21:46,049
that and instead<font color="#E5E5E5"> of making you wait for</font>

595
00:21:43,919 --> 00:21:48,600
<font color="#E5E5E5">30 gigs of data to come down here we'll</font>

596
00:21:46,049 --> 00:21:50,100
just<font color="#E5E5E5"> fast forward in time and we've got</font>

597
00:21:48,600 --> 00:21:52,260
the test<font color="#E5E5E5"> VHD</font><font color="#CCCCCC"> file so</font><font color="#E5E5E5"> we're gonna</font>

598
00:21:50,100 --> 00:21:54,629
<font color="#CCCCCC">right-click and mount that pretty easy</font>

599
00:21:52,260 --> 00:21:58,320
in<font color="#CCCCCC"> Windows and we've got</font><font color="#E5E5E5"> access to</font>

600
00:21:54,630 --> 00:22:00,659
somebody's hard drive so in this case

601
00:21:58,320 --> 00:22:02,610
what most likely happened<font color="#E5E5E5"> was a</font>

602
00:22:00,659 --> 00:22:06,360
developer wanted to use some<font color="#E5E5E5"> kind of</font>

603
00:22:02,610 --> 00:22:08,639
gold<font color="#E5E5E5"> image or make a backup of the hard</font>

604
00:22:06,360 --> 00:22:09,570
drive here<font color="#E5E5E5"> and that ended up in a</font>

605
00:22:08,639 --> 00:22:11,610
storage account we've

606
00:22:09,570 --> 00:22:13,590
<font color="#CCCCCC">this happened before and what we're</font>

607
00:22:11,610 --> 00:22:15,959
doing<font color="#CCCCCC"> now is pulling these</font><font color="#E5E5E5"> salmon system</font>

608
00:22:13,590 --> 00:22:18,689
files to pull the ntlm hashes for the

609
00:22:15,960 --> 00:22:19,770
local administrator account so if

610
00:22:18,690 --> 00:22:21,990
anybody's use came to do this before

611
00:22:19,770 --> 00:22:22,889
<font color="#CCCCCC">it's just a nice easy GUI</font><font color="#E5E5E5"> to show you</font>

612
00:22:21,990 --> 00:22:25,110
<font color="#E5E5E5">guys what we're doing</font>

613
00:22:22,890 --> 00:22:27,570
but pulling<font color="#E5E5E5"> the system file grabbing the</font>

614
00:22:25,110 --> 00:22:29,520
system key<font color="#E5E5E5"> copy and pasting it and in a</font>

615
00:22:27,570 --> 00:22:32,120
<font color="#E5E5E5">couple of seconds here</font><font color="#CCCCCC"> we should have</font>

616
00:22:29,520 --> 00:22:35,010
the local admin credentials right there

617
00:22:32,120 --> 00:22:38,070
cool<font color="#CCCCCC"> so what can</font><font color="#E5E5E5"> we do at this point</font>

618
00:22:35,010 --> 00:22:40,290
we've<font color="#CCCCCC"> got local</font><font color="#E5E5E5"> admin username and</font><font color="#CCCCCC"> NT</font>

619
00:22:38,070 --> 00:22:42,149
hash we can you know potentially crack

620
00:22:40,290 --> 00:22:45,149
the ntlm hash<font color="#CCCCCC"> do a number of</font><font color="#E5E5E5"> different</font>

621
00:22:42,150 --> 00:22:46,590
<font color="#E5E5E5">things in that</font><font color="#CCCCCC"> regard here but in this</font>

622
00:22:45,150 --> 00:22:49,170
case we'll just<font color="#E5E5E5"> pretend</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> we use hash</font>

623
00:22:46,590 --> 00:22:51,570
<font color="#E5E5E5">cat and cracked it a Z admin pass</font><font color="#CCCCCC"> all</font>

624
00:22:49,170 --> 00:22:53,790
<font color="#CCCCCC">right</font><font color="#E5E5E5"> cool we've got the local admin</font>

625
00:22:51,570 --> 00:22:55,560
pass for this<font color="#CCCCCC"> VHD file where do we go</font>

626
00:22:53,790 --> 00:22:57,510
<font color="#E5E5E5">from there well for an authenticated</font>

627
00:22:55,560 --> 00:22:59,399
user<font color="#CCCCCC"> we could</font><font color="#E5E5E5"> potentially log into the</font>

628
00:22:57,510 --> 00:23:01,140
portal backtrack a little bit figure out

629
00:22:59,400 --> 00:23:03,390
where the server is

630
00:23:01,140 --> 00:23:05,790
<font color="#CCCCCC">if RDP is enabled</font><font color="#E5E5E5"> we could</font><font color="#CCCCCC"> potentially</font>

631
00:23:03,390 --> 00:23:07,830
go in that way<font color="#E5E5E5"> the VHD files are</font>

632
00:23:05,790 --> 00:23:09,330
literally<font color="#E5E5E5"> just virtual hard drive so we</font>

633
00:23:07,830 --> 00:23:11,669
can go ahead<font color="#CCCCCC"> and load that up</font><font color="#E5E5E5"> in hyper-v</font>

634
00:23:09,330 --> 00:23:15,389
we've<font color="#E5E5E5"> got local admin creds we can just</font>

635
00:23:11,670 --> 00:23:17,460
log<font color="#CCCCCC"> directly in potentially modify Sam</font>

636
00:23:15,390 --> 00:23:19,500
system<font color="#CCCCCC"> or</font><font color="#E5E5E5"> Sam file on there and give</font>

637
00:23:17,460 --> 00:23:22,100
yourself access but since we've cracked

638
00:23:19,500 --> 00:23:24,900
creds it's pretty simple<font color="#CCCCCC"> to</font><font color="#E5E5E5"> just do this</font>

639
00:23:22,100 --> 00:23:27,120
so in this case<font color="#E5E5E5"> I kind</font><font color="#CCCCCC"> of a more</font>

640
00:23:24,900 --> 00:23:29,550
<font color="#E5E5E5">practical example if this</font><font color="#CCCCCC"> VHD file has</font>

641
00:23:27,120 --> 00:23:31,770
applications that are specific to<font color="#E5E5E5"> the</font>

642
00:23:29,550 --> 00:23:33,810
environment<font color="#E5E5E5"> that you're attacking you</font>

643
00:23:31,770 --> 00:23:35,730
could potentially<font color="#CCCCCC"> use those</font><font color="#E5E5E5"> applications</font>

644
00:23:33,810 --> 00:23:39,510
natively<font color="#E5E5E5"> within that virtual hard disk</font>

645
00:23:35,730 --> 00:23:42,720
<font color="#E5E5E5">so it's nice alternatives we could just</font>

646
00:23:39,510 --> 00:23:44,610
<font color="#E5E5E5">RDP in after we've identified the RDP</font>

647
00:23:42,720 --> 00:23:47,340
interface<font color="#E5E5E5"> for on me me cats in this case</font>

648
00:23:44,610 --> 00:23:49,379
for proof of the demo<font color="#CCCCCC"> we got</font><font color="#E5E5E5"> access to</font>

649
00:23:47,340 --> 00:23:51,899
the<font color="#CCCCCC"> Kay test account</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> is a domain</font>

650
00:23:49,380 --> 00:23:55,970
<font color="#E5E5E5">joint account and hey cool we got</font>

651
00:23:51,900 --> 00:23:58,200
credentials<font color="#CCCCCC"> in</font><font color="#E5E5E5"> this case just ntlm creds</font>

652
00:23:55,970 --> 00:23:59,460
alternatively since we've got<font color="#E5E5E5"> access</font><font color="#CCCCCC"> to</font>

653
00:23:58,200 --> 00:24:01,740
that hard<font color="#E5E5E5"> drive we can go ahead and use</font>

654
00:23:59,460 --> 00:24:03,630
<font color="#E5E5E5">secrets</font><font color="#CCCCCC"> now to pull off be cached</font>

655
00:24:01,740 --> 00:24:04,980
credentials<font color="#E5E5E5"> this is a slightly more</font>

656
00:24:03,630 --> 00:24:05,880
<font color="#CCCCCC">realistic option because if you're</font>

657
00:24:04,980 --> 00:24:07,980
coming<font color="#E5E5E5"> from an unauthenticated</font>

658
00:24:05,880 --> 00:24:10,470
perspective chances are you're not<font color="#CCCCCC"> going</font>

659
00:24:07,980 --> 00:24:13,820
<font color="#CCCCCC">to have that</font><font color="#E5E5E5"> external IP address for RDP</font>

660
00:24:10,470 --> 00:24:16,290
to get access<font color="#CCCCCC"> or RTP</font><font color="#E5E5E5"> is limited but</font>

661
00:24:13,820 --> 00:24:19,260
since we're getting<font color="#E5E5E5"> domain credentials</font>

662
00:24:16,290 --> 00:24:21,240
at this point we<font color="#E5E5E5"> went ahead and cracked</font>

663
00:24:19,260 --> 00:24:22,799
this randomly<font color="#E5E5E5"> generated Microsoft</font>

664
00:24:21,240 --> 00:24:25,719
password

665
00:24:22,799 --> 00:24:28,199
<font color="#E5E5E5">the is your Active Directory passwords</font>

666
00:24:25,719 --> 00:24:31,359
are typically<font color="#E5E5E5"> I believe</font><font color="#CCCCCC"> for</font>

667
00:24:28,199 --> 00:24:33,039
<font color="#CCCCCC">alphanumerics</font><font color="#E5E5E5"> or sorry for letters</font>

668
00:24:31,359 --> 00:24:34,389
followed by<font color="#E5E5E5"> four numbers I added some</font>

669
00:24:33,039 --> 00:24:36,579
<font color="#CCCCCC">exclamation marks for a little bit more</font>

670
00:24:34,389 --> 00:24:37,928
entropy<font color="#E5E5E5"> here but in this case let's</font>

671
00:24:36,579 --> 00:24:40,629
pretend that we've got domain

672
00:24:37,929 --> 00:24:43,269
credentials<font color="#E5E5E5"> and we'll go ahead and</font><font color="#CCCCCC"> log</font>

673
00:24:40,629 --> 00:24:46,928
<font color="#CCCCCC">in directly through the is</font><font color="#E5E5E5"> your command</font>

674
00:24:43,269 --> 00:24:48,519
<font color="#CCCCCC">let's and run some scripts so we'll just</font>

675
00:24:46,929 --> 00:24:50,679
go<font color="#E5E5E5"> ahead and connect the</font><font color="#CCCCCC"> azure RM</font>

676
00:24:48,519 --> 00:24:52,119
account here we'll be<font color="#E5E5E5"> prompted for our</font>

677
00:24:50,679 --> 00:24:53,999
credentials just using the native

678
00:24:52,119 --> 00:24:57,158
libraries for<font color="#CCCCCC"> as</font><font color="#E5E5E5"> your Active Directory</font>

679
00:24:53,999 --> 00:24:59,109
<font color="#CCCCCC">login we're going</font><font color="#E5E5E5"> to use this</font><font color="#CCCCCC"> kay test</font>

680
00:24:57,159 --> 00:25:01,239
account in this case this account has

681
00:24:59,109 --> 00:25:03,009
owner<font color="#E5E5E5"> rights</font><font color="#CCCCCC"> we're kind</font><font color="#E5E5E5"> of cheating here</font>

682
00:25:01,239 --> 00:25:05,199
for the demo but for sake of<font color="#E5E5E5"> time and</font>

683
00:25:03,009 --> 00:25:08,769
<font color="#E5E5E5">I'm pretty much running up on time here</font>

684
00:25:05,199 --> 00:25:10,749
<font color="#E5E5E5">I we're just gonna go through</font><font color="#CCCCCC"> jumpin the</font>

685
00:25:08,769 --> 00:25:12,009
<font color="#E5E5E5">issuer domain info it's gonna prompt you</font>

686
00:25:10,749 --> 00:25:13,809
<font color="#CCCCCC">for which subscription you want to use</font>

687
00:25:12,009 --> 00:25:17,169
you just<font color="#E5E5E5"> select that and it's</font><font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> dump</font>

688
00:25:13,809 --> 00:25:18,219
out this information<font color="#E5E5E5"> so this will start</font>

689
00:25:17,169 --> 00:25:19,499
spinning through a whole bunch<font color="#CCCCCC"> of</font>

690
00:25:18,219 --> 00:25:22,149
<font color="#CCCCCC">information that's gonna</font><font color="#E5E5E5"> start dumping</font>

691
00:25:19,499 --> 00:25:26,829
for sake of<font color="#CCCCCC"> time since I think</font><font color="#E5E5E5"> we're</font>

692
00:25:22,149 --> 00:25:28,418
coming up about<font color="#E5E5E5"> a minute here okay so</font><font color="#CCCCCC"> we</font>

693
00:25:26,829 --> 00:25:30,879
won't sit through all<font color="#E5E5E5"> of this but these</font>

694
00:25:28,419 --> 00:25:32,619
slides will be<font color="#CCCCCC"> up</font><font color="#E5E5E5"> online</font><font color="#CCCCCC"> the other thing</font>

695
00:25:30,879 --> 00:25:34,569
that we're<font color="#E5E5E5"> gonna do next</font><font color="#CCCCCC"> was dump out</font>

696
00:25:32,619 --> 00:25:36,129
all of the<font color="#E5E5E5"> passwords for that</font>

697
00:25:34,569 --> 00:25:38,769
subscription<font color="#CCCCCC"> we'll just get that video</font>

698
00:25:36,129 --> 00:25:40,689
started here<font color="#E5E5E5"> and basically</font><font color="#CCCCCC"> we're already</font>

699
00:25:38,769 --> 00:25:42,699
<font color="#E5E5E5">logged in as</font><font color="#CCCCCC"> @k test account who had</font>

700
00:25:40,690 --> 00:25:45,819
owner rights and had<font color="#CCCCCC"> access to</font><font color="#E5E5E5"> all of</font>

701
00:25:42,699 --> 00:25:47,949
<font color="#E5E5E5">these different password stores here</font>

702
00:25:45,819 --> 00:25:50,339
we're just<font color="#CCCCCC"> gonna output that to out grid</font>

703
00:25:47,949 --> 00:25:52,989
<font color="#E5E5E5">view use Microsoft burst demo here</font>

704
00:25:50,339 --> 00:25:55,178
you'll see the example run<font color="#E5E5E5"> book job that</font>

705
00:25:52,989 --> 00:25:59,789
pops<font color="#E5E5E5"> up here as well</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> couple</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> seconds</font>

706
00:25:55,179 --> 00:26:02,079
<font color="#E5E5E5">after we get through app services and</font>

707
00:25:59,789 --> 00:26:03,609
that's kind of<font color="#E5E5E5"> the end</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the demo so</font>

708
00:26:02,079 --> 00:26:05,440
what we're waiting<font color="#CCCCCC"> for this</font><font color="#E5E5E5"> to wrap up</font>

709
00:26:03,609 --> 00:26:07,978
we have like probably<font color="#E5E5E5"> 30 seconds left</font>

710
00:26:05,440 --> 00:26:13,749
any questions

711
00:26:07,979 --> 00:26:17,759
yep so the question<font color="#E5E5E5"> was does the script</font>

712
00:26:13,749 --> 00:26:22,479
to<font color="#E5E5E5"> the DNS brute-forcing yes yes it does</font>

713
00:26:17,759 --> 00:26:24,279
you can so<font color="#CCCCCC"> that takes a base word list</font>

714
00:26:22,479 --> 00:26:27,249
that you<font color="#CCCCCC"> can pipe</font><font color="#E5E5E5"> into that or you can</font>

715
00:26:24,279 --> 00:26:29,019
do a folder permutations as well<font color="#CCCCCC"> so</font>

716
00:26:27,249 --> 00:26:31,209
there's a permutations file that does

717
00:26:29,019 --> 00:26:34,420
<font color="#E5E5E5">like - dev</font><font color="#CCCCCC"> - test as</font><font color="#E5E5E5"> if you were that</font>

718
00:26:31,209 --> 00:26:36,640
<font color="#E5E5E5">kind of stuff any other questions</font>

719
00:26:34,420 --> 00:26:37,860
nope I'm getting the stop<font color="#E5E5E5"> so we'll wrap</font>

720
00:26:36,640 --> 00:26:42,430
<font color="#CCCCCC">up here</font>

721
00:26:37,860 --> 00:26:42,429
[Applause]

722
00:26:43,290 --> 00:26:48,159
there's some fixes conclusions if

723
00:26:45,670 --> 00:26:49,510
anybody wants the info<font color="#CCCCCC"> it's on this last</font>

724
00:26:48,160 --> 00:26:50,920
<font color="#CCCCCC">slide here but thanks everyone for</font>

725
00:26:49,510 --> 00:26:53,310
coming to a Sunday talk<font color="#E5E5E5"> really</font>

726
00:26:50,920 --> 00:26:53,310
appreciate

