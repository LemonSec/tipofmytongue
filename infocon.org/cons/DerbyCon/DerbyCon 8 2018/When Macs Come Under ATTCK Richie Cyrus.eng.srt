1
00:00:14,660 --> 00:00:25,710
we'll give it<font color="#E5E5E5"> about another minute</font>

2
00:00:16,619 --> 00:00:27,779
I guess that minute<font color="#E5E5E5"> is now I'll get</font>

3
00:00:25,710 --> 00:00:29,250
<font color="#E5E5E5">started I want to say thanks for</font>

4
00:00:27,779 --> 00:00:31,529
everyone to coming<font color="#E5E5E5"> out to my talk when</font>

5
00:00:29,250 --> 00:00:33,180
<font color="#E5E5E5">Max come under attack</font><font color="#CCCCCC"> it's a pleasure to</font>

6
00:00:31,529 --> 00:00:35,160
<font color="#CCCCCC">be here derbycon</font><font color="#E5E5E5"> this is my first debut</font>

7
00:00:33,180 --> 00:00:38,850
<font color="#CCCCCC">con it's been an awesome con so far the</font>

8
00:00:35,160 --> 00:00:40,140
<font color="#CCCCCC">community is amazing I'm glad I'm</font><font color="#E5E5E5"> able</font>

9
00:00:38,850 --> 00:00:42,770
to<font color="#E5E5E5"> talk about something</font><font color="#CCCCCC"> that I enjoy</font>

10
00:00:40,140 --> 00:00:46,770
<font color="#E5E5E5">which is</font><font color="#CCCCCC"> Mac OS detection and response</font>

11
00:00:42,770 --> 00:00:49,079
<font color="#E5E5E5">so let's jump right into</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> my name is</font>

12
00:00:46,770 --> 00:00:52,289
<font color="#CCCCCC">Ritchie Cyrus</font><font color="#E5E5E5"> I'm currently adversary</font>

13
00:00:49,079 --> 00:00:54,660
<font color="#CCCCCC">detection</font><font color="#E5E5E5"> analysts</font><font color="#CCCCCC"> expect the ROPS</font><font color="#E5E5E5"> Apple</font>

14
00:00:52,289 --> 00:00:56,250
fanboy and<font color="#CCCCCC"> sadly I'm a New York Knicks</font>

15
00:00:54,660 --> 00:01:00,269
fan we've been horrible<font color="#CCCCCC"> for quite some</font>

16
00:00:56,250 --> 00:01:02,550
time<font color="#E5E5E5"> so prior to</font><font color="#CCCCCC"> specter</font><font color="#E5E5E5"> ops I cut a lot</font>

17
00:01:00,270 --> 00:01:04,949
of<font color="#CCCCCC"> my teeth and private and public</font>

18
00:01:02,550 --> 00:01:06,570
sector most recently at Apple I was on

19
00:01:04,949 --> 00:01:09,630
<font color="#CCCCCC">their Incident Response and monitoring</font>

20
00:01:06,570 --> 00:01:12,419
team so a lot of<font color="#E5E5E5"> what this talk consists</font>

21
00:01:09,630 --> 00:01:14,520
of came from<font color="#E5E5E5"> my time at Apple</font><font color="#CCCCCC"> and what I</font>

22
00:01:12,420 --> 00:01:15,900
wasn't<font color="#CCCCCC"> able</font><font color="#E5E5E5"> to share but now that I've</font>

23
00:01:14,520 --> 00:01:17,399
left Apple<font color="#E5E5E5"> I'm able</font><font color="#CCCCCC"> to share some of</font>

24
00:01:15,900 --> 00:01:18,900
<font color="#E5E5E5">this information</font><font color="#CCCCCC"> that might help to you</font>

25
00:01:17,400 --> 00:01:22,460
<font color="#E5E5E5">and your enterprise when you go about</font>

26
00:01:18,900 --> 00:01:25,320
<font color="#E5E5E5">hunting for Mac OS malicious activity</font>

27
00:01:22,460 --> 00:01:27,750
and so a little<font color="#E5E5E5"> bit</font><font color="#CCCCCC"> about the outline of</font>

28
00:01:25,320 --> 00:01:30,119
this talk<font color="#CCCCCC"> so I'll go</font><font color="#E5E5E5"> into like the need</font>

29
00:01:27,750 --> 00:01:32,579
for Mac OS start hunting and then what

30
00:01:30,119 --> 00:01:35,520
the Mac OS<font color="#E5E5E5"> attack landscape looks like</font>

31
00:01:32,579 --> 00:01:37,350
today<font color="#E5E5E5"> also</font><font color="#CCCCCC"> the hunt methodology so a lot</font>

32
00:01:35,520 --> 00:01:39,000
of<font color="#E5E5E5"> people bring up hunting but they</font>

33
00:01:37,350 --> 00:01:41,369
don't know what it<font color="#E5E5E5"> is or they may have</font>

34
00:01:39,000 --> 00:01:43,500
some skewed view of how<font color="#E5E5E5"> to go about</font>

35
00:01:41,369 --> 00:01:45,119
<font color="#CCCCCC">doing</font><font color="#E5E5E5"> it so I'll introduce the hunt</font>

36
00:01:43,500 --> 00:01:47,790
methodology that<font color="#E5E5E5"> we</font><font color="#CCCCCC"> subscribe to at</font>

37
00:01:45,119 --> 00:01:49,409
<font color="#E5E5E5">Specter ops and then some of the tools</font>

38
00:01:47,790 --> 00:01:51,810
<font color="#E5E5E5">and data that you'll need</font><font color="#CCCCCC"> to hunt and</font>

39
00:01:49,409 --> 00:01:54,329
then<font color="#E5E5E5"> we'll go into adversary techniques</font>

40
00:01:51,810 --> 00:01:56,670
and detections of these techniques<font color="#CCCCCC"> that</font>

41
00:01:54,329 --> 00:01:58,919
I'll introduce<font color="#E5E5E5"> and then a cool little</font>

42
00:01:56,670 --> 00:02:01,770
demo where I'll introduce like what an

43
00:01:58,920 --> 00:02:03,719
attack looks<font color="#E5E5E5"> like on the offensive side</font>

44
00:02:01,770 --> 00:02:05,369
<font color="#E5E5E5">and</font><font color="#CCCCCC"> then switching over to</font><font color="#E5E5E5"> the defensive</font>

45
00:02:03,719 --> 00:02:07,350
side and looking<font color="#E5E5E5"> at that activity and</font>

46
00:02:05,369 --> 00:02:12,380
picking<font color="#CCCCCC"> one technique and hunting for</font>

47
00:02:07,350 --> 00:02:15,920
<font color="#E5E5E5">that activity so</font><font color="#CCCCCC"> there was</font><font color="#E5E5E5"> a comer</font>

48
00:02:12,380 --> 00:02:19,400
a series of commercials<font color="#CCCCCC"> back in 2007 in</font>

49
00:02:15,920 --> 00:02:22,820
<font color="#CCCCCC">which you have the Mac versus PC</font><font color="#E5E5E5"> the guy</font>

50
00:02:19,400 --> 00:02:25,190
in the suit<font color="#E5E5E5"> is</font><font color="#CCCCCC"> the PC user and the guy</font>

51
00:02:22,820 --> 00:02:27,079
with the<font color="#E5E5E5"> cool hoodie is the Mac user and</font>

52
00:02:25,190 --> 00:02:28,730
right now in this commercial he's like

53
00:02:27,080 --> 00:02:30,470
take care<font color="#E5E5E5"> and he's taking</font><font color="#CCCCCC"> care of</font><font color="#E5E5E5"> the</font>

54
00:02:28,730 --> 00:02:32,840
sick guy because he's come down<font color="#E5E5E5"> with the</font>

55
00:02:30,470 --> 00:02:34,220
<font color="#CCCCCC">virus and the PC</font><font color="#E5E5E5"> guys like yeah there's</font>

56
00:02:32,840 --> 00:02:35,630
a<font color="#E5E5E5"> bunch of these viruses going around</font>

57
00:02:34,220 --> 00:02:38,240
there's over a hundred<font color="#E5E5E5"> thousand of these</font>

58
00:02:35,630 --> 00:02:40,090
viruses<font color="#E5E5E5"> and the Mac guy was like oh poor</font>

59
00:02:38,240 --> 00:02:42,890
thing sorry for you max don't<font color="#E5E5E5"> get those</font>

60
00:02:40,090 --> 00:02:46,100
well that is false

61
00:02:42,890 --> 00:02:49,220
even back in<font color="#E5E5E5"> 2000 even back as far as</font>

62
00:02:46,100 --> 00:02:52,010
<font color="#E5E5E5">2006 you had the leap worm which was</font>

63
00:02:49,220 --> 00:02:54,710
pretty significant<font color="#CCCCCC"> and</font><font color="#E5E5E5"> all Mac OS</font>

64
00:02:52,010 --> 00:02:57,859
systems and so even back<font color="#CCCCCC"> then</font><font color="#E5E5E5"> it wasn't</font>

65
00:02:54,710 --> 00:02:59,630
<font color="#E5E5E5">maybe as prevalent as Windows viruses</font>

66
00:02:57,860 --> 00:03:03,410
and malware that<font color="#E5E5E5"> was going</font><font color="#CCCCCC"> around but</font>

67
00:02:59,630 --> 00:03:05,960
max did in fact have viruses and so a

68
00:03:03,410 --> 00:03:07,730
lot<font color="#CCCCCC"> of the marketing that</font><font color="#E5E5E5"> Apple had back</font>

69
00:03:05,960 --> 00:03:09,530
then and even<font color="#CCCCCC"> today is like okay the</font>

70
00:03:07,730 --> 00:03:12,619
nomenclature that<font color="#E5E5E5"> max don't get viruses</font>

71
00:03:09,530 --> 00:03:14,180
well that's simply<font color="#E5E5E5"> untrue</font><font color="#CCCCCC"> and so in</font>

72
00:03:12,620 --> 00:03:15,620
<font color="#E5E5E5">order</font><font color="#CCCCCC"> for us</font><font color="#E5E5E5"> to hunt for malicious</font>

73
00:03:14,180 --> 00:03:18,920
activity you have<font color="#CCCCCC"> to come to terms that</font>

74
00:03:15,620 --> 00:03:20,390
<font color="#E5E5E5">hey there are malicious activity going</font>

75
00:03:18,920 --> 00:03:22,910
on on Macs like<font color="#CCCCCC"> Macs are getting hit</font>

76
00:03:20,390 --> 00:03:25,790
with malware<font color="#E5E5E5"> right and so that</font><font color="#CCCCCC"> takes us</font>

77
00:03:22,910 --> 00:03:27,950
to<font color="#E5E5E5"> today well what I mentioned</font><font color="#CCCCCC"> Mac's are</font>

78
00:03:25,790 --> 00:03:31,549
getting attacked<font color="#CCCCCC"> and so a lot of what</font>

79
00:03:27,950 --> 00:03:35,810
kind<font color="#E5E5E5"> of you know push this upward thread</font>

80
00:03:31,550 --> 00:03:38,210
<font color="#CCCCCC">thread was that</font><font color="#E5E5E5"> as you get</font><font color="#CCCCCC"> more</font><font color="#E5E5E5"> Mac's</font><font color="#CCCCCC"> in</font>

81
00:03:35,810 --> 00:03:40,130
the homes of users as<font color="#CCCCCC"> you get more</font><font color="#E5E5E5"> Mac's</font>

82
00:03:38,210 --> 00:03:42,020
and the enterprise environment<font color="#E5E5E5"> you think</font>

83
00:03:40,130 --> 00:03:44,560
of your enterprise environment your

84
00:03:42,020 --> 00:03:46,820
security<font color="#E5E5E5"> team wants a Mac your</font>

85
00:03:44,560 --> 00:03:49,520
developers want a Mac to do their work

86
00:03:46,820 --> 00:03:50,930
<font color="#CCCCCC">your higher-ups</font><font color="#E5E5E5"> want a Mac because they</font>

87
00:03:49,520 --> 00:03:52,850
think they're cool and they want the Mac

88
00:03:50,930 --> 00:03:55,190
right<font color="#E5E5E5"> and so these are the</font><font color="#CCCCCC"> folks with</font>

89
00:03:52,850 --> 00:03:57,170
<font color="#E5E5E5">the most to lose</font><font color="#CCCCCC"> and so attackers know</font>

90
00:03:55,190 --> 00:03:59,109
this and as that market share goes up

91
00:03:57,170 --> 00:04:02,390
<font color="#E5E5E5">they're gonna come more interested in</font>

92
00:03:59,110 --> 00:04:06,440
writing malware for<font color="#CCCCCC"> Mac or less and</font><font color="#E5E5E5"> so</font>

93
00:04:02,390 --> 00:04:08,119
to piggyback<font color="#CCCCCC"> on that</font><font color="#E5E5E5"> there are also apt</font>

94
00:04:06,440 --> 00:04:12,079
groups<font color="#E5E5E5"> that are now interested</font><font color="#CCCCCC"> in mac OS</font>

95
00:04:08,120 --> 00:04:14,390
<font color="#E5E5E5">you have X agent that was used by</font><font color="#CCCCCC"> apt 28</font>

96
00:04:12,080 --> 00:04:17,420
also known as the fancy<font color="#CCCCCC"> Bayer folks and</font>

97
00:04:14,390 --> 00:04:21,168
then you have<font color="#E5E5E5"> ocean Lotus which was tied</font>

98
00:04:17,420 --> 00:04:23,150
to<font color="#CCCCCC"> apt</font><font color="#E5E5E5"> 32 and so it's no longer that</font>

99
00:04:21,168 --> 00:04:24,919
game where there's Mac malware being

100
00:04:23,150 --> 00:04:30,140
written out there to just do stuff

101
00:04:24,920 --> 00:04:32,000
like adware<font color="#E5E5E5"> or to get some monetary</font><font color="#CCCCCC"> game</font>

102
00:04:30,140 --> 00:04:34,610
there<font color="#E5E5E5"> are actual nation-states</font>

103
00:04:32,000 --> 00:04:36,680
<font color="#E5E5E5">interested in Mac OS systems and doing</font>

104
00:04:34,610 --> 00:04:39,320
them harm so you also have

105
00:04:36,680 --> 00:04:41,360
vulnerabilities<font color="#CCCCCC"> that occur on Mac OS</font>

106
00:04:39,320 --> 00:04:43,340
systems<font color="#CCCCCC"> that leave them susceptible to</font>

107
00:04:41,360 --> 00:04:44,840
<font color="#E5E5E5">major attack</font><font color="#CCCCCC"> I don't know if</font><font color="#E5E5E5"> many people</font>

108
00:04:43,340 --> 00:04:46,760
<font color="#CCCCCC">are familiar</font><font color="#E5E5E5"> with the I am</font><font color="#CCCCCC"> root</font>

109
00:04:44,840 --> 00:04:48,950
vulnerability which where you put in

110
00:04:46,760 --> 00:04:50,900
root as the<font color="#CCCCCC"> username</font><font color="#E5E5E5"> and you hit</font>

111
00:04:48,950 --> 00:04:53,840
password a few times this was back<font color="#CCCCCC"> in</font>

112
00:04:50,900 --> 00:04:56,179
last year 2017<font color="#E5E5E5"> and if you press that</font>

113
00:04:53,840 --> 00:04:58,190
<font color="#E5E5E5">enough times you would get on</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> system</font>

114
00:04:56,180 --> 00:05:02,420
<font color="#E5E5E5">right you have elevator privileges to do</font>

115
00:04:58,190 --> 00:05:03,890
some nasty<font color="#CCCCCC"> things so kudos to</font><font color="#E5E5E5"> Apple for</font>

116
00:05:02,420 --> 00:05:07,280
cleaning<font color="#E5E5E5"> it up pretty quickly but in</font>

117
00:05:03,890 --> 00:05:10,909
that window of<font color="#CCCCCC"> time the landscape</font><font color="#E5E5E5"> was</font>

118
00:05:07,280 --> 00:05:13,549
wide<font color="#CCCCCC"> open for for attack and so I'll</font>

119
00:05:10,910 --> 00:05:16,100
<font color="#E5E5E5">talk about what the Mac attack landscape</font>

120
00:05:13,550 --> 00:05:18,590
looks like today<font color="#CCCCCC"> so a lot of the Mac</font>

121
00:05:16,100 --> 00:05:20,750
attacks that<font color="#E5E5E5"> you see well one you see</font>

122
00:05:18,590 --> 00:05:23,299
macros there right<font color="#E5E5E5"> because if there's</font>

123
00:05:20,750 --> 00:05:25,820
macros that<font color="#E5E5E5"> are there to exists they</font>

124
00:05:23,300 --> 00:05:28,430
will be weaponized to distribute

125
00:05:25,820 --> 00:05:29,930
malicious activity also PDF documents

126
00:05:28,430 --> 00:05:32,180
right<font color="#E5E5E5"> so that's one way getting that an</font>

127
00:05:29,930 --> 00:05:33,440
email but then a more interesting<font color="#E5E5E5"> way</font>

128
00:05:32,180 --> 00:05:35,030
that<font color="#E5E5E5"> you don't see too much on the</font>

129
00:05:33,440 --> 00:05:37,219
window side but you're starting<font color="#CCCCCC"> to see</font>

130
00:05:35,030 --> 00:05:40,609
it on<font color="#E5E5E5"> the Mac side is like supply chain</font>

131
00:05:37,220 --> 00:05:43,640
compromises so<font color="#E5E5E5"> the</font><font color="#CCCCCC"> tool handbrake that's</font>

132
00:05:40,610 --> 00:05:45,890
useful<font color="#E5E5E5"> video encoding the mirror to</font>

133
00:05:43,640 --> 00:05:48,080
download that<font color="#E5E5E5"> tool was compromised and</font>

134
00:05:45,890 --> 00:05:50,080
<font color="#E5E5E5">so what the attackers did was they</font>

135
00:05:48,080 --> 00:05:52,280
embedded<font color="#E5E5E5"> some malicious code into</font>

136
00:05:50,080 --> 00:05:54,800
handbrake<font color="#E5E5E5"> and then they added</font><font color="#CCCCCC"> that to</font>

137
00:05:52,280 --> 00:05:56,630
<font color="#CCCCCC">the</font><font color="#E5E5E5"> download mirror and so when you go</font>

138
00:05:54,800 --> 00:05:59,060
<font color="#CCCCCC">to download</font><font color="#E5E5E5"> handbrake you think you're</font>

139
00:05:56,630 --> 00:06:01,760
<font color="#CCCCCC">getting a true copy but</font><font color="#E5E5E5"> it's</font><font color="#CCCCCC"> back doored</font>

140
00:05:59,060 --> 00:06:04,250
with some additional malicious code that

141
00:06:01,760 --> 00:06:06,080
<font color="#E5E5E5">will persist on your system the same</font>

142
00:06:04,250 --> 00:06:08,240
thing happened with transmission<font color="#E5E5E5"> they</font>

143
00:06:06,080 --> 00:06:11,030
actually distributed<font color="#CCCCCC"> makam</font>

144
00:06:08,240 --> 00:06:12,980
<font color="#CCCCCC">mac</font><font color="#E5E5E5"> OS ransomware so that was the first</font>

145
00:06:11,030 --> 00:06:14,690
time<font color="#E5E5E5"> we saw a macro</font><font color="#CCCCCC"> west ransomware in</font>

146
00:06:12,980 --> 00:06:17,180
the wild is that<font color="#CCCCCC"> supply chain</font>

147
00:06:14,690 --> 00:06:18,530
<font color="#E5E5E5">compromised and then</font><font color="#CCCCCC"> i mean if any of</font>

148
00:06:17,180 --> 00:06:20,000
you had a Mac where you have families

149
00:06:18,530 --> 00:06:22,210
that<font color="#CCCCCC"> have a Mac you've come across</font><font color="#E5E5E5"> our</font>

150
00:06:20,000 --> 00:06:25,400
ad where it says<font color="#CCCCCC"> download Adobe Flash</font>

151
00:06:22,210 --> 00:06:27,729
<font color="#CCCCCC">that's almost never</font><font color="#E5E5E5"> Adobe Flash and so</font>

152
00:06:25,400 --> 00:06:31,070
that's how users get compromised as well

153
00:06:27,730 --> 00:06:33,110
and so threat hunting right

154
00:06:31,070 --> 00:06:35,450
what is threat hunting how do we do it

155
00:06:33,110 --> 00:06:38,270
<font color="#CCCCCC">well inspector ops we like to subscribe</font>

156
00:06:35,450 --> 00:06:38,810
<font color="#E5E5E5">to the methodology</font><font color="#CCCCCC"> that threat hunting</font>

157
00:06:38,270 --> 00:06:40,580
is

158
00:06:38,810 --> 00:06:42,860
<font color="#E5E5E5">police searching for malicious activity</font>

159
00:06:40,580 --> 00:06:45,729
that has evaded the<font color="#E5E5E5"> defenses that you</font>

160
00:06:42,860 --> 00:06:47,810
have in place<font color="#CCCCCC"> right so your et are tools</font>

161
00:06:45,730 --> 00:06:50,450
<font color="#CCCCCC">things</font><font color="#E5E5E5"> that you have monitoring your</font>

162
00:06:47,810 --> 00:06:52,400
network<font color="#E5E5E5"> your firewall whatever you have</font>

163
00:06:50,450 --> 00:06:55,010
in<font color="#CCCCCC"> place defensively</font><font color="#E5E5E5"> you're assuming</font>

164
00:06:52,400 --> 00:06:57,620
that the attacker has knowledge<font color="#E5E5E5"> of it or</font>

165
00:06:55,010 --> 00:06:59,480
has been<font color="#E5E5E5"> able</font><font color="#CCCCCC"> to bypass that</font><font color="#E5E5E5"> and so</font>

166
00:06:57,620 --> 00:07:01,940
you're<font color="#CCCCCC"> looking for malicious activity</font>

167
00:06:59,480 --> 00:07:04,100
<font color="#E5E5E5">and you're looking for a malicious</font>

168
00:07:01,940 --> 00:07:08,900
activity in spite<font color="#CCCCCC"> of those defenses</font>

169
00:07:04,100 --> 00:07:12,950
being in place right and so why we hunt

170
00:07:08,900 --> 00:07:15,679
is here<font color="#E5E5E5"> so Michael Hayden which was the</font>

171
00:07:12,950 --> 00:07:17,270
former director of NSA and CIA<font color="#CCCCCC"> he says</font>

172
00:07:15,680 --> 00:07:19,010
fundamentally if someone wants to<font color="#E5E5E5"> get in</font>

173
00:07:17,270 --> 00:07:21,680
they're going to get<font color="#E5E5E5"> in you're in the</font>

174
00:07:19,010 --> 00:07:23,570
fight<font color="#E5E5E5"> acknowledge that own up to</font><font color="#CCCCCC"> it and</font>

175
00:07:21,680 --> 00:07:25,160
<font color="#E5E5E5">you're most certainly penetrated right</font>

176
00:07:23,570 --> 00:07:28,099
<font color="#CCCCCC">and so that's a lot of the</font><font color="#E5E5E5"> assumed</font>

177
00:07:25,160 --> 00:07:30,440
breach<font color="#E5E5E5"> mentality and so if you take the</font>

178
00:07:28,100 --> 00:07:33,080
<font color="#E5E5E5">assumed breach mentality as</font><font color="#CCCCCC"> Matt</font><font color="#E5E5E5"> graver</font>

179
00:07:30,440 --> 00:07:35,360
<font color="#E5E5E5">eloquently stated here then you kind of</font>

180
00:07:33,080 --> 00:07:37,039
<font color="#E5E5E5">introduce the attackers dilemma into the</font>

181
00:07:35,360 --> 00:07:39,110
equation right so the attacker dilemma

182
00:07:37,040 --> 00:07:41,300
<font color="#E5E5E5">for so long me as a blue</font><font color="#CCCCCC"> Timur I've</font>

183
00:07:39,110 --> 00:07:43,130
hated this for so long<font color="#E5E5E5"> where an attacker</font>

184
00:07:41,300 --> 00:07:44,960
<font color="#CCCCCC">saying</font><font color="#E5E5E5"> oh you know the defense has to</font>

185
00:07:43,130 --> 00:07:46,580
get it<font color="#E5E5E5"> right so many times there's so</font>

186
00:07:44,960 --> 00:07:48,890
many holes<font color="#E5E5E5"> that they have to fill if I</font>

187
00:07:46,580 --> 00:07:51,169
get into<font color="#CCCCCC"> this you know one system</font><font color="#E5E5E5"> then</font>

188
00:07:48,890 --> 00:07:53,210
it's<font color="#E5E5E5"> game over right well if you're</font>

189
00:07:51,169 --> 00:07:55,280
assumed that<font color="#E5E5E5"> your breach then you start</font>

190
00:07:53,210 --> 00:07:57,380
to flip that<font color="#CCCCCC"> on their head right the</font>

191
00:07:55,280 --> 00:07:59,750
attacker has to<font color="#E5E5E5"> do so many things right</font>

192
00:07:57,380 --> 00:08:01,520
not to get caught once because once they

193
00:07:59,750 --> 00:08:03,620
<font color="#E5E5E5">get caught once it can also it kicks off</font>

194
00:08:01,520 --> 00:08:05,390
the<font color="#CCCCCC"> IR process and you have evidence</font><font color="#E5E5E5"> of</font>

195
00:08:03,620 --> 00:08:08,330
someone<font color="#E5E5E5"> being in their environment so</font>

196
00:08:05,390 --> 00:08:12,110
<font color="#E5E5E5">your security</font><font color="#CCCCCC"> awareness is heightened</font>

197
00:08:08,330 --> 00:08:14,750
<font color="#E5E5E5">right and so we go into now how can we</font>

198
00:08:12,110 --> 00:08:17,330
<font color="#E5E5E5">detect attackers behaviors and activity</font>

199
00:08:14,750 --> 00:08:20,410
post<font color="#E5E5E5"> compromised</font><font color="#CCCCCC"> right</font><font color="#E5E5E5"> that's the big</font>

200
00:08:17,330 --> 00:08:22,490
<font color="#E5E5E5">piece that if you could do this well it</font>

201
00:08:20,410 --> 00:08:23,750
it'll take<font color="#CCCCCC"> care</font><font color="#E5E5E5"> of a lot</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the things</font>

202
00:08:22,490 --> 00:08:26,570
in<font color="#CCCCCC"> your environment</font><font color="#E5E5E5"> as far as post</font>

203
00:08:23,750 --> 00:08:29,510
compromised<font color="#E5E5E5"> and so it'll be nice if</font><font color="#CCCCCC"> we</font>

204
00:08:26,570 --> 00:08:31,370
had<font color="#E5E5E5"> a framework that can display to us</font>

205
00:08:29,510 --> 00:08:33,700
all the behaviors and<font color="#CCCCCC"> activities</font><font color="#E5E5E5"> that</font>

206
00:08:31,370 --> 00:08:36,260
attack us could do post<font color="#E5E5E5"> compromised well</font>

207
00:08:33,700 --> 00:08:38,029
that's where<font color="#E5E5E5"> mitre attack comes in right</font>

208
00:08:36,260 --> 00:08:40,729
and so mitre attack is a framework<font color="#E5E5E5"> for</font>

209
00:08:38,029 --> 00:08:42,708
<font color="#E5E5E5">describing the behaviors of cyber</font>

210
00:08:40,729 --> 00:08:44,810
adversaries across the intrusion<font color="#E5E5E5"> life</font>

211
00:08:42,708 --> 00:08:47,239
<font color="#E5E5E5">cycle but the majority of the framework</font>

212
00:08:44,810 --> 00:08:50,119
is focused on post compromised activity

213
00:08:47,240 --> 00:08:52,040
which is right before threat hunting

214
00:08:50,120 --> 00:08:52,730
<font color="#E5E5E5">right and so it's pretty convenient to</font>

215
00:08:52,040 --> 00:08:55,010
answer our

216
00:08:52,730 --> 00:08:56,540
and documented<font color="#E5E5E5"> in the frameworks are the</font>

217
00:08:55,010 --> 00:08:58,340
<font color="#E5E5E5">tactics that are being used by the</font>

218
00:08:56,540 --> 00:09:00,829
<font color="#CCCCCC">attackers so that's like high-level and</font>

219
00:08:58,340 --> 00:09:02,870
<font color="#E5E5E5">then the techniques that</font><font color="#CCCCCC"> are being used</font>

220
00:09:00,830 --> 00:09:04,610
<font color="#CCCCCC">so the specific thing that they</font><font color="#E5E5E5"> use to</font>

221
00:09:02,870 --> 00:09:06,770
accomplish<font color="#CCCCCC"> the tactic</font><font color="#E5E5E5"> and then the</font>

222
00:09:04,610 --> 00:09:09,110
procedures goes into well<font color="#E5E5E5"> you</font><font color="#CCCCCC"> know the</font>

223
00:09:06,770 --> 00:09:11,930
<font color="#E5E5E5">specific actions</font><font color="#CCCCCC"> that they took to carry</font>

224
00:09:09,110 --> 00:09:14,870
out theirs but<font color="#E5E5E5"> their technique and so</font>

225
00:09:11,930 --> 00:09:16,880
<font color="#CCCCCC">mitre attack includes Mac Windows and</font>

226
00:09:14,870 --> 00:09:20,870
<font color="#CCCCCC">Linux but will be primarily talking</font>

227
00:09:16,880 --> 00:09:23,360
about Mac and so we can<font color="#E5E5E5"> use this</font>

228
00:09:20,870 --> 00:09:26,450
framework<font color="#E5E5E5"> for hunting it's ideal what</font>

229
00:09:23,360 --> 00:09:28,790
we'll do is in the hunt methodology<font color="#E5E5E5"> will</font>

230
00:09:26,450 --> 00:09:30,860
identify the tactic<font color="#E5E5E5"> and the technique</font>

231
00:09:28,790 --> 00:09:33,140
that<font color="#CCCCCC"> we</font><font color="#E5E5E5"> want a hunt</font><font color="#CCCCCC"> for and that's you</font>

232
00:09:30,860 --> 00:09:35,570
know<font color="#E5E5E5"> guided by your upper management</font>

233
00:09:33,140 --> 00:09:37,189
<font color="#E5E5E5">that's guided by your threat Intel team</font>

234
00:09:35,570 --> 00:09:39,230
saying<font color="#E5E5E5"> okay well maybe you're in a</font>

235
00:09:37,190 --> 00:09:41,180
financial<font color="#E5E5E5"> sector</font><font color="#CCCCCC"> these are the types of</font>

236
00:09:39,230 --> 00:09:43,370
<font color="#E5E5E5">attacks</font><font color="#CCCCCC"> that you</font><font color="#E5E5E5"> might come across and</font>

237
00:09:41,180 --> 00:09:45,050
so with that<font color="#E5E5E5"> you say okay well what are</font>

238
00:09:43,370 --> 00:09:46,700
the what are<font color="#E5E5E5"> the techniques that we</font>

239
00:09:45,050 --> 00:09:47,959
might come across<font color="#E5E5E5"> and let's hunt for</font>

240
00:09:46,700 --> 00:09:50,660
<font color="#E5E5E5">those techniques so that we're ahead of</font>

241
00:09:47,960 --> 00:09:53,480
<font color="#E5E5E5">the</font><font color="#CCCCCC"> curve right and so once you identify</font>

242
00:09:50,660 --> 00:09:55,189
<font color="#CCCCCC">the tactic</font><font color="#E5E5E5"> and the technique then you go</font>

243
00:09:53,480 --> 00:09:57,170
<font color="#E5E5E5">about</font><font color="#CCCCCC"> identifying the procedure right</font>

244
00:09:55,190 --> 00:09:58,670
how specifically are they carrying<font color="#E5E5E5"> out</font>

245
00:09:57,170 --> 00:10:00,709
that technique right there's multiple

246
00:09:58,670 --> 00:10:04,790
ways to<font color="#E5E5E5"> like add a user</font><font color="#CCCCCC"> to the system</font>

247
00:10:00,710 --> 00:10:06,890
using<font color="#CCCCCC"> like net right and so after that</font>

248
00:10:04,790 --> 00:10:09,790
<font color="#CCCCCC">you want to</font><font color="#E5E5E5"> identify the collection</font>

249
00:10:06,890 --> 00:10:12,350
<font color="#CCCCCC">requirements which I'll</font><font color="#E5E5E5"> get</font><font color="#CCCCCC"> into which</font>

250
00:10:09,790 --> 00:10:13,819
evolves<font color="#CCCCCC"> around like data</font><font color="#E5E5E5"> and collection</font>

251
00:10:12,350 --> 00:10:16,010
of data<font color="#E5E5E5"> and then you want to identify</font>

252
00:10:13,820 --> 00:10:18,110
the scope right so do<font color="#E5E5E5"> you want to focus</font>

253
00:10:16,010 --> 00:10:20,060
<font color="#E5E5E5">on just</font><font color="#CCCCCC"> like the enterprise systems</font><font color="#E5E5E5"> in</font>

254
00:10:18,110 --> 00:10:23,090
totality or do you want to focus on

255
00:10:20,060 --> 00:10:26,089
maybe the<font color="#E5E5E5"> systems that executive staffs</font>

256
00:10:23,090 --> 00:10:27,890
have maybe the<font color="#CCCCCC"> security team systems or</font>

257
00:10:26,090 --> 00:10:30,140
maybe the developer systems right in the

258
00:10:27,890 --> 00:10:32,030
case<font color="#E5E5E5"> of Mac and how long do you want</font>

259
00:10:30,140 --> 00:10:34,430
<font color="#CCCCCC">that scope to run for do you want to</font>

260
00:10:32,030 --> 00:10:36,410
hunt for a week<font color="#CCCCCC"> you want to</font><font color="#E5E5E5"> hunt for a</font>

261
00:10:34,430 --> 00:10:38,959
couple months<font color="#CCCCCC"> what does that look like</font>

262
00:10:36,410 --> 00:10:40,699
right and so what we subscribe<font color="#E5E5E5"> to is</font>

263
00:10:38,960 --> 00:10:43,910
that folks should<font color="#E5E5E5"> hunt for specific</font>

264
00:10:40,700 --> 00:10:46,460
technique<font color="#E5E5E5"> and tactic for about a week's</font>

265
00:10:43,910 --> 00:10:49,490
<font color="#E5E5E5">time right and then from that document</font>

266
00:10:46,460 --> 00:10:51,020
<font color="#E5E5E5">what you have so far</font><font color="#CCCCCC"> and let the results</font>

267
00:10:49,490 --> 00:10:52,970
<font color="#E5E5E5">from that documentation and lead into</font>

268
00:10:51,020 --> 00:10:55,819
the<font color="#E5E5E5"> next hunt and keep moving</font><font color="#CCCCCC"> along you</font>

269
00:10:52,970 --> 00:10:58,010
<font color="#CCCCCC">don't want you know to be stuck</font><font color="#E5E5E5"> in like</font>

270
00:10:55,820 --> 00:11:00,350
<font color="#CCCCCC">a paralysis cycle where you're worried</font>

271
00:10:58,010 --> 00:11:02,150
about finishing<font color="#CCCCCC"> a specific hunt to</font><font color="#E5E5E5"> the</font>

272
00:11:00,350 --> 00:11:05,520
point where it never gets completed<font color="#E5E5E5"> and</font>

273
00:11:02,150 --> 00:11:07,470
<font color="#E5E5E5">that's all you worry about and so</font>

274
00:11:05,520 --> 00:11:09,210
if you adapt this hunt methodology you

275
00:11:07,470 --> 00:11:10,770
start to create a minefield<font color="#CCCCCC"> right and so</font>

276
00:11:09,210 --> 00:11:13,380
this is what I talked about<font color="#E5E5E5"> before where</font>

277
00:11:10,770 --> 00:11:16,380
you<font color="#E5E5E5"> kind of guide the attacker to where</font>

278
00:11:13,380 --> 00:11:19,760
they need to<font color="#E5E5E5"> be right</font><font color="#CCCCCC"> on your system to</font>

279
00:11:16,380 --> 00:11:23,460
do a<font color="#E5E5E5"> compromise and so if let's say you</font>

280
00:11:19,760 --> 00:11:25,500
knock out<font color="#CCCCCC"> everything in execution right</font>

281
00:11:23,460 --> 00:11:27,780
<font color="#E5E5E5">or most things</font><font color="#CCCCCC"> the executions then</font>

282
00:11:25,500 --> 00:11:29,370
there's<font color="#E5E5E5"> only a limited set of execution</font>

283
00:11:27,780 --> 00:11:31,110
techniques that they could carry out<font color="#E5E5E5"> in</font>

284
00:11:29,370 --> 00:11:33,090
order<font color="#E5E5E5"> to carry out their entire attack</font>

285
00:11:31,110 --> 00:11:35,040
and so<font color="#E5E5E5"> if they trip any over if they</font>

286
00:11:33,090 --> 00:11:37,650
trip<font color="#CCCCCC"> over any of these detection Zoar</font>

287
00:11:35,040 --> 00:11:40,349
<font color="#E5E5E5">analytics it kicks off the</font><font color="#CCCCCC"> IR process</font>

288
00:11:37,650 --> 00:11:42,600
<font color="#E5E5E5">and you're able to respond to</font><font color="#CCCCCC"> it a</font>

289
00:11:40,350 --> 00:11:44,730
little<font color="#E5E5E5"> bit</font><font color="#CCCCCC"> faster</font><font color="#E5E5E5"> and so when you're</font>

290
00:11:42,600 --> 00:11:46,860
hunting and the more times<font color="#E5E5E5"> you</font><font color="#CCCCCC"> go</font>

291
00:11:44,730 --> 00:11:49,560
through this<font color="#E5E5E5"> iterative process then</font>

292
00:11:46,860 --> 00:11:52,350
you're<font color="#CCCCCC"> able to take</font><font color="#E5E5E5"> a technique take a</font>

293
00:11:49,560 --> 00:11:54,270
tactic and dive into<font color="#E5E5E5"> the details and</font>

294
00:11:52,350 --> 00:11:56,250
then the next time that an attacker or

295
00:11:54,270 --> 00:11:58,860
your red team comes across that<font color="#E5E5E5"> you'll</font>

296
00:11:56,250 --> 00:12:01,500
be<font color="#E5E5E5"> better</font><font color="#CCCCCC"> equipped right</font><font color="#E5E5E5"> and so in order</font>

297
00:11:58,860 --> 00:12:03,180
<font color="#CCCCCC">to create</font><font color="#E5E5E5"> this minefield</font><font color="#CCCCCC"> you need to</font>

298
00:12:01,500 --> 00:12:05,700
have the data<font color="#E5E5E5"> to represent</font><font color="#CCCCCC"> that right</font>

299
00:12:03,180 --> 00:12:08,550
and so the cool<font color="#E5E5E5"> thing about minor attack</font>

300
00:12:05,700 --> 00:12:10,680
it has the<font color="#E5E5E5"> data sources section</font><font color="#CCCCCC"> in which</font>

301
00:12:08,550 --> 00:12:13,589
it tells you what data source you need

302
00:12:10,680 --> 00:12:17,520
<font color="#E5E5E5">to</font><font color="#CCCCCC"> actually</font><font color="#E5E5E5"> make the detection come to</font>

303
00:12:13,590 --> 00:12:19,950
life<font color="#E5E5E5"> right and so I used the API</font><font color="#CCCCCC"> that</font>

304
00:12:17,520 --> 00:12:21,990
<font color="#CCCCCC">mightor has to extract these details</font>

305
00:12:19,950 --> 00:12:24,540
from the data sources<font color="#E5E5E5"> specifically for</font>

306
00:12:21,990 --> 00:12:26,940
<font color="#CCCCCC">mac OS and so for process monitoring</font>

307
00:12:24,540 --> 00:12:29,160
file monitoring process<font color="#E5E5E5"> command line and</font>

308
00:12:26,940 --> 00:12:31,530
process use of<font color="#E5E5E5"> network</font><font color="#CCCCCC"> those were the</font>

309
00:12:29,160 --> 00:12:33,959
highest right so from those four items

310
00:12:31,530 --> 00:12:35,880
<font color="#CCCCCC">if I were to build detections off of</font>

311
00:12:33,960 --> 00:12:38,220
those if I collected that type of<font color="#E5E5E5"> data</font>

312
00:12:35,880 --> 00:12:39,990
<font color="#CCCCCC">it'll give</font><font color="#E5E5E5"> me the best chance to start</font>

313
00:12:38,220 --> 00:12:43,020
<font color="#E5E5E5">to create that minefield</font><font color="#CCCCCC"> and knock out</font>

314
00:12:39,990 --> 00:12:45,330
as many<font color="#E5E5E5"> techniques as possible and so</font>

315
00:12:43,020 --> 00:12:47,550
I'll go<font color="#CCCCCC"> into some of the tools that you</font>

316
00:12:45,330 --> 00:12:49,860
can use to do<font color="#E5E5E5"> this and all these tools</font>

317
00:12:47,550 --> 00:12:52,050
are<font color="#E5E5E5"> open source and so you could go</font><font color="#CCCCCC"> home</font>

318
00:12:49,860 --> 00:12:54,450
today try<font color="#CCCCCC"> this in</font><font color="#E5E5E5"> your lab environment</font>

319
00:12:52,050 --> 00:12:59,390
<font color="#CCCCCC">deploy this in your network and get</font><font color="#E5E5E5"> some</font>

320
00:12:54,450 --> 00:13:02,160
use out<font color="#CCCCCC"> of</font><font color="#E5E5E5"> it</font><font color="#CCCCCC"> it's free to use</font><font color="#E5E5E5"> use it</font>

321
00:12:59,390 --> 00:13:03,870
the<font color="#CCCCCC"> first tool I introduced is Google</font>

322
00:13:02,160 --> 00:13:05,910
Santa<font color="#E5E5E5"> so this was a tool that</font><font color="#CCCCCC"> was</font>

323
00:13:03,870 --> 00:13:07,620
<font color="#CCCCCC">developed</font><font color="#E5E5E5"> by Google's Macintosh</font>

324
00:13:05,910 --> 00:13:10,439
operations team for the purpose of

325
00:13:07,620 --> 00:13:12,420
binary whitelisting<font color="#E5E5E5"> or blacklisting but</font>

326
00:13:10,440 --> 00:13:14,250
the thing that's cool about this is it

327
00:13:12,420 --> 00:13:15,959
also gives you process<font color="#E5E5E5"> monitoring right</font>

328
00:13:14,250 --> 00:13:18,050
so that<font color="#E5E5E5"> gives us one of the data sources</font>

329
00:13:15,960 --> 00:13:19,769
that<font color="#CCCCCC"> are described</font><font color="#E5E5E5"> just now</font><font color="#CCCCCC"> a</font>

330
00:13:18,050 --> 00:13:22,229
<font color="#CCCCCC">lesser-known</font><font color="#E5E5E5"> tool</font>

331
00:13:19,769 --> 00:13:25,319
is<font color="#CCCCCC"> ex Newman it was written by Daniel</font>

332
00:13:22,230 --> 00:13:27,480
Roethlisberger<font color="#E5E5E5"> and so it's designed to</font>

333
00:13:25,319 --> 00:13:30,420
<font color="#E5E5E5">mimic sis</font><font color="#CCCCCC"> Mon who's familiar with</font>

334
00:13:27,480 --> 00:13:31,980
cysmart for<font color="#CCCCCC"> Windows and so the idea</font>

335
00:13:30,420 --> 00:13:34,618
behind this<font color="#CCCCCC"> is that is</font><font color="#E5E5E5"> going to be</font>

336
00:13:31,980 --> 00:13:37,230
<font color="#CCCCCC">cysmart for mac right so it has various</font>

337
00:13:34,619 --> 00:13:40,589
event<font color="#E5E5E5"> IDs</font><font color="#CCCCCC"> one</font><font color="#E5E5E5"> event ID is basically</font>

338
00:13:37,230 --> 00:13:43,439
monitoring<font color="#E5E5E5"> for the agent this x newman</font>

339
00:13:40,589 --> 00:13:45,179
is persisting via a launch agent so it's

340
00:13:43,439 --> 00:13:46,889
monitoring<font color="#E5E5E5"> for the agent if anything</font>

341
00:13:45,179 --> 00:13:49,110
happens to<font color="#CCCCCC"> the agent it'll log it will</font>

342
00:13:46,889 --> 00:13:51,089
give you that<font color="#E5E5E5"> event ID also if there's</font>

343
00:13:49,110 --> 00:13:54,629
anything<font color="#E5E5E5"> going on as far</font><font color="#CCCCCC"> as like process</font>

344
00:13:51,089 --> 00:13:56,369
command like process injection you

345
00:13:54,629 --> 00:13:58,860
typically have to<font color="#E5E5E5"> call task for</font><font color="#CCCCCC"> pid'</font>

346
00:13:56,369 --> 00:14:01,470
right and so that's like<font color="#E5E5E5"> another event</font>

347
00:13:58,860 --> 00:14:03,239
type that's there it also does process

348
00:14:01,470 --> 00:14:07,319
monitoring which is another event<font color="#E5E5E5"> type</font>

349
00:14:03,239 --> 00:14:10,709
and it logs persistent<font color="#E5E5E5"> items which like</font>

350
00:14:07,319 --> 00:14:11,910
launch the launch agents launch<font color="#CCCCCC"> Damons</font>

351
00:14:10,709 --> 00:14:14,128
which<font color="#CCCCCC"> i'll get</font><font color="#E5E5E5"> into and that's a</font>

352
00:14:11,910 --> 00:14:16,589
separate event<font color="#E5E5E5"> type so any</font><font color="#CCCCCC"> any</font><font color="#E5E5E5"> time that</font>

353
00:14:14,129 --> 00:14:18,360
you<font color="#E5E5E5"> have a process execute on a</font><font color="#CCCCCC"> Mac the</font>

354
00:14:16,589 --> 00:14:19,829
cool thing about<font color="#E5E5E5"> X</font><font color="#CCCCCC"> Neuman that separates</font>

355
00:14:18,360 --> 00:14:22,199
it<font color="#CCCCCC"> from the rest of</font><font color="#E5E5E5"> the group</font><font color="#CCCCCC"> that does</font>

356
00:14:19,829 --> 00:14:23,998
process monitoring<font color="#E5E5E5"> is that it'll</font><font color="#CCCCCC"> show</font>

357
00:14:22,199 --> 00:14:25,709
you the<font color="#E5E5E5"> process</font><font color="#CCCCCC"> it'll show you</font><font color="#E5E5E5"> the hash</font>

358
00:14:23,999 --> 00:14:27,899
<font color="#E5E5E5">of</font><font color="#CCCCCC"> that process but it has a cool</font>

359
00:14:25,709 --> 00:14:29,839
feature<font color="#E5E5E5"> called ancestors which will show</font>

360
00:14:27,899 --> 00:14:32,639
you not<font color="#CCCCCC"> only the</font><font color="#E5E5E5"> parent process for that</font>

361
00:14:29,839 --> 00:14:35,040
<font color="#CCCCCC">process</font><font color="#E5E5E5"> that just executed</font><font color="#CCCCCC"> but all the</font>

362
00:14:32,639 --> 00:14:36,839
way down through the<font color="#E5E5E5"> tree to the the</font>

363
00:14:35,040 --> 00:14:40,049
<font color="#E5E5E5">process that kicked that whole thing off</font>

364
00:14:36,839 --> 00:14:41,999
so for<font color="#CCCCCC"> max</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> processes launch</font><font color="#E5E5E5"> D</font>

365
00:14:40,049 --> 00:14:44,639
that's similar to<font color="#E5E5E5"> like in it for Linux</font>

366
00:14:41,999 --> 00:14:46,410
<font color="#E5E5E5">and</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> it'll show</font><font color="#CCCCCC"> you that ancestry</font><font color="#E5E5E5"> from</font>

367
00:14:44,639 --> 00:14:47,939
the process<font color="#CCCCCC"> that just executed all the</font>

368
00:14:46,410 --> 00:14:52,110
way down to launch<font color="#E5E5E5"> D which is pretty</font>

369
00:14:47,939 --> 00:14:54,449
cool and last but not least<font color="#E5E5E5"> OS query so</font>

370
00:14:52,110 --> 00:14:56,639
if you do Mac defense a lot<font color="#E5E5E5"> of people</font>

371
00:14:54,449 --> 00:14:58,618
who are<font color="#CCCCCC"> familiar with OS query and so</font>

372
00:14:56,639 --> 00:15:01,290
what<font color="#E5E5E5"> o is query is best at doing is</font>

373
00:14:58,619 --> 00:15:05,429
tracking persistent items right because

374
00:15:01,290 --> 00:15:06,899
one<font color="#E5E5E5"> os query has some scheduled queries</font>

375
00:15:05,429 --> 00:15:09,269
that you run across your enterprise and

376
00:15:06,899 --> 00:15:11,549
<font color="#CCCCCC">a SQL format right so all</font><font color="#E5E5E5"> the data that</font>

377
00:15:09,269 --> 00:15:13,019
OS query collects<font color="#E5E5E5"> is sort of thrown into</font>

378
00:15:11,549 --> 00:15:15,149
a database and<font color="#CCCCCC"> then you could interact</font>

379
00:15:13,019 --> 00:15:18,569
<font color="#E5E5E5">with</font><font color="#CCCCCC"> that database</font><font color="#E5E5E5"> with various</font><font color="#CCCCCC"> tables</font>

380
00:15:15,149 --> 00:15:20,220
that you<font color="#CCCCCC"> have</font><font color="#E5E5E5"> access</font><font color="#CCCCCC"> to and so the cool</font>

381
00:15:18,569 --> 00:15:22,709
<font color="#CCCCCC">thing about</font><font color="#E5E5E5"> OS query it does file</font>

382
00:15:20,220 --> 00:15:25,259
integrity monitoring pretty well as far

383
00:15:22,709 --> 00:15:27,660
<font color="#CCCCCC">as yarra scanning and process monitoring</font>

384
00:15:25,259 --> 00:15:29,730
the<font color="#CCCCCC"> process monitoring for</font><font color="#E5E5E5"> OS query</font>

385
00:15:27,660 --> 00:15:31,049
piggybacks off of audit<font color="#E5E5E5"> d which is</font><font color="#CCCCCC"> a</font>

386
00:15:29,730 --> 00:15:33,600
little bit kludgy if you ever work with

387
00:15:31,049 --> 00:15:35,850
<font color="#E5E5E5">that in an enterprise</font><font color="#CCCCCC"> environment but</font>

388
00:15:33,600 --> 00:15:37,379
for<font color="#E5E5E5"> the process monitoring piece you</font>

389
00:15:35,850 --> 00:15:40,589
<font color="#E5E5E5">would probably want</font><font color="#CCCCCC"> to go with</font><font color="#E5E5E5"> Santa or</font>

390
00:15:37,379 --> 00:15:43,019
<font color="#E5E5E5">X</font><font color="#CCCCCC"> Neumann so I'll get into</font><font color="#E5E5E5"> techniques</font>

391
00:15:40,589 --> 00:15:44,639
that are<font color="#E5E5E5"> used by attackers now well the</font>

392
00:15:43,019 --> 00:15:47,129
three most<font color="#CCCCCC"> popular techniques that are</font>

393
00:15:44,639 --> 00:15:50,189
tactics that<font color="#E5E5E5"> are</font><font color="#CCCCCC"> used</font><font color="#E5E5E5"> by attackers</font>

394
00:15:47,129 --> 00:15:53,249
<font color="#E5E5E5">so the first is persistence right and so</font>

395
00:15:50,189 --> 00:15:55,349
the idea behind persistence is like the

396
00:15:53,249 --> 00:15:57,660
attacker has compromised the system

397
00:15:55,350 --> 00:15:59,369
right baby<font color="#CCCCCC"> their fish their way in or</font>

398
00:15:57,660 --> 00:16:01,169
found some other mechanism but they

399
00:15:59,369 --> 00:16:04,019
don't want<font color="#E5E5E5"> to lose</font><font color="#CCCCCC"> that access to their</font>

400
00:16:01,169 --> 00:16:05,759
system right<font color="#E5E5E5"> it's a pain</font><font color="#CCCCCC"> speaking to the</font>

401
00:16:04,019 --> 00:16:07,889
red teamers on my team and<font color="#E5E5E5"> red teamers</font>

402
00:16:05,759 --> 00:16:11,519
throughout the community<font color="#E5E5E5"> red teamers</font>

403
00:16:07,889 --> 00:16:12,240
hates<font color="#E5E5E5"> fishing it is a chore so they want</font>

404
00:16:11,519 --> 00:16:14,519
to<font color="#CCCCCC"> make sure that they maintain</font>

405
00:16:12,240 --> 00:16:17,730
persistence<font color="#E5E5E5"> just so they</font><font color="#CCCCCC"> don't have to</font>

406
00:16:14,519 --> 00:16:19,529
fish anybody else<font color="#CCCCCC"> again right</font><font color="#E5E5E5"> and so the</font>

407
00:16:17,730 --> 00:16:21,149
most<font color="#CCCCCC"> common way to do</font><font color="#E5E5E5"> that on a Mac</font><font color="#CCCCCC"> OS</font>

408
00:16:19,529 --> 00:16:23,189
<font color="#E5E5E5">system is through launch agents and</font>

409
00:16:21,149 --> 00:16:25,100
launch<font color="#E5E5E5"> game ins so the idea behind</font>

410
00:16:23,189 --> 00:16:27,809
launch agents and launch<font color="#CCCCCC"> Damons</font><font color="#E5E5E5"> is</font>

411
00:16:25,100 --> 00:16:30,539
launch<font color="#CCCCCC"> D</font><font color="#E5E5E5"> kicks off the process so that's</font>

412
00:16:27,809 --> 00:16:33,029
<font color="#E5E5E5">the first process after the bootloader</font>

413
00:16:30,539 --> 00:16:35,549
kicks off and it's the first user<font color="#E5E5E5"> land</font>

414
00:16:33,029 --> 00:16:37,829
process that exists<font color="#CCCCCC"> right and the</font>

415
00:16:35,549 --> 00:16:40,169
existence of launch D is to kick off and

416
00:16:37,829 --> 00:16:41,998
load everything<font color="#CCCCCC"> that's in the system</font>

417
00:16:40,169 --> 00:16:43,649
library<font color="#E5E5E5"> launch Damian's folder and then</font>

418
00:16:41,999 --> 00:16:45,569
everything in the library launch

419
00:16:43,649 --> 00:16:47,759
<font color="#CCCCCC">statements folder and what that is those</font>

420
00:16:45,569 --> 00:16:50,490
<font color="#E5E5E5">like system level</font><font color="#CCCCCC"> functions that will</font>

421
00:16:47,759 --> 00:16:54,029
happen<font color="#CCCCCC"> build like more like services and</font>

422
00:16:50,490 --> 00:16:56,399
so when a user<font color="#E5E5E5"> logs into the</font><font color="#CCCCCC"> system then</font>

423
00:16:54,029 --> 00:16:58,860
<font color="#E5E5E5">the specific launch agents and system</font>

424
00:16:56,399 --> 00:17:02,220
library and the<font color="#CCCCCC"> user's individual</font>

425
00:16:58,860 --> 00:17:04,789
library folder will execute<font color="#CCCCCC"> write or be</font>

426
00:17:02,220 --> 00:17:07,199
kicked off or load into the system<font color="#E5E5E5"> and</font>

427
00:17:04,789 --> 00:17:08,849
so if you've never seen a launch agent

428
00:17:07,199 --> 00:17:10,770
or<font color="#CCCCCC"> a launch</font><font color="#E5E5E5"> name in before here it is</font>

429
00:17:08,849 --> 00:17:13,049
right<font color="#CCCCCC"> here and the key</font><font color="#E5E5E5"> behind it the</font>

430
00:17:10,770 --> 00:17:15,929
major key<font color="#E5E5E5"> behind the launch agent or the</font>

431
00:17:13,049 --> 00:17:19,799
<font color="#CCCCCC">launch daemon</font><font color="#E5E5E5"> is the run at load right</font>

432
00:17:15,929 --> 00:17:22,380
so if<font color="#CCCCCC"> run at load is set to</font><font color="#E5E5E5"> zero then</font>

433
00:17:19,799 --> 00:17:23,869
it'll be on the<font color="#E5E5E5"> box but when it's loaded</font>

434
00:17:22,380 --> 00:17:27,089
<font color="#E5E5E5">by the system</font>

435
00:17:23,869 --> 00:17:30,330
it just won't execute<font color="#E5E5E5"> the command that's</font>

436
00:17:27,089 --> 00:17:32,190
in the program<font color="#E5E5E5"> arguments right so with</font>

437
00:17:30,330 --> 00:17:35,850
every launch agent and<font color="#CCCCCC"> let every launch</font>

438
00:17:32,190 --> 00:17:38,429
<font color="#E5E5E5">daemon there is</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> X is a</font><font color="#CCCCCC"> associated</font>

439
00:17:35,850 --> 00:17:39,539
binary<font color="#E5E5E5"> with that launch agent on launch</font>

440
00:17:38,429 --> 00:17:41,340
statement and<font color="#E5E5E5"> that's what actually</font>

441
00:17:39,539 --> 00:17:44,158
<font color="#E5E5E5">executes at load right</font>

442
00:17:41,340 --> 00:17:45,330
and so<font color="#E5E5E5"> attackers have been</font><font color="#CCCCCC"> making</font><font color="#E5E5E5"> a use</font>

443
00:17:44,159 --> 00:17:47,610
<font color="#E5E5E5">of this for quite</font><font color="#CCCCCC"> some</font>

444
00:17:45,330 --> 00:17:50,429
the first image<font color="#CCCCCC"> that top</font><font color="#E5E5E5"> is from the</font>

445
00:17:47,610 --> 00:17:53,250
<font color="#E5E5E5">cold root rat that exists out there</font><font color="#CCCCCC"> and</font>

446
00:17:50,430 --> 00:17:55,680
so with the coal root rat<font color="#CCCCCC"> they use the</font>

447
00:17:53,250 --> 00:17:58,320
launch agent of<font color="#CCCCCC"> comm dot Apple</font><font color="#E5E5E5"> audio</font>

448
00:17:55,680 --> 00:18:01,380
<font color="#E5E5E5">driver right and so the intent behind</font>

449
00:17:58,320 --> 00:18:02,909
that was<font color="#E5E5E5"> to actually blend in with a lot</font>

450
00:18:01,380 --> 00:18:04,950
of the launch agents and launch<font color="#E5E5E5"> demons</font>

451
00:18:02,910 --> 00:18:06,900
that<font color="#CCCCCC"> exist on the</font><font color="#E5E5E5"> Mac OS system a lot of</font>

452
00:18:04,950 --> 00:18:09,690
them start<font color="#CCCCCC"> with comm that Apple if they</font>

453
00:18:06,900 --> 00:18:11,340
are created<font color="#CCCCCC"> by Apple</font><font color="#E5E5E5"> so if you're an</font>

454
00:18:09,690 --> 00:18:13,290
attacker<font color="#E5E5E5"> you want to kind of hide in</font>

455
00:18:11,340 --> 00:18:14,820
plain sight<font color="#CCCCCC"> so you there's nothing</font>

456
00:18:13,290 --> 00:18:16,139
<font color="#E5E5E5">preventing an attacker from</font><font color="#CCCCCC"> kareena</font>

457
00:18:14,820 --> 00:18:20,060
launch daemon that starts<font color="#E5E5E5"> with combat</font>

458
00:18:16,140 --> 00:18:21,990
<font color="#CCCCCC">Apple the second iteration here is from</font>

459
00:18:20,060 --> 00:18:25,560
some<font color="#E5E5E5"> malware that was distributed</font>

460
00:18:21,990 --> 00:18:27,750
<font color="#CCCCCC">through a site called</font><font color="#E5E5E5"> Mac update and so</font>

461
00:18:25,560 --> 00:18:29,100
the Mac update site is by itself pretty

462
00:18:27,750 --> 00:18:31,830
sketchy<font color="#E5E5E5"> but there's some illegitimate</font>

463
00:18:29,100 --> 00:18:34,409
stuff there and so what they did was it

464
00:18:31,830 --> 00:18:35,939
was<font color="#CCCCCC"> a supply chain compromise again in</font>

465
00:18:34,410 --> 00:18:37,260
which<font color="#E5E5E5"> they were able to embed some</font>

466
00:18:35,940 --> 00:18:39,570
<font color="#E5E5E5">malicious code into some of the</font>

467
00:18:37,260 --> 00:18:42,060
applications hosted<font color="#E5E5E5"> there and with that</font>

468
00:18:39,570 --> 00:18:45,510
you<font color="#E5E5E5"> see that launch control was used to</font>

469
00:18:42,060 --> 00:18:48,000
launch to load the<font color="#E5E5E5"> Mac OS update dot P</font>

470
00:18:45,510 --> 00:18:49,680
list<font color="#E5E5E5"> and so that P list looks similar to</font>

471
00:18:48,000 --> 00:18:51,420
what's here but this is the<font color="#CCCCCC"> P list</font><font color="#E5E5E5"> for</font>

472
00:18:49,680 --> 00:18:53,910
Little Snitch<font color="#CCCCCC"> which is a tool used for</font>

473
00:18:51,420 --> 00:18:57,960
Mac<font color="#E5E5E5"> for monitoring connections in and</font>

474
00:18:53,910 --> 00:18:59,790
out and<font color="#E5E5E5"> so with that once launch control</font>

475
00:18:57,960 --> 00:19:01,950
is<font color="#CCCCCC"> called and it's loaded into there</font>

476
00:18:59,790 --> 00:19:05,399
then<font color="#E5E5E5"> from now on when the system starts</font>

477
00:19:01,950 --> 00:19:09,000
<font color="#E5E5E5">up then it will call that executable and</font>

478
00:19:05,400 --> 00:19:10,680
that executable<font color="#E5E5E5"> will run and so when we</font>

479
00:19:09,000 --> 00:19:12,420
start to<font color="#E5E5E5"> look at launch agents and</font>

480
00:19:10,680 --> 00:19:14,040
launch<font color="#CCCCCC"> demons in an environment there's</font>

481
00:19:12,420 --> 00:19:16,020
a few things that<font color="#CCCCCC"> stick out</font><font color="#E5E5E5"> that you can</font>

482
00:19:14,040 --> 00:19:18,540
automatically<font color="#E5E5E5"> count as malicious right</font>

483
00:19:16,020 --> 00:19:21,060
and so this<font color="#CCCCCC"> is a great example here from</font>

484
00:19:18,540 --> 00:19:23,430
<font color="#E5E5E5">the co root rat and so you see the use</font>

485
00:19:21,060 --> 00:19:25,470
of the<font color="#CCCCCC"> comm</font><font color="#E5E5E5"> that Apple you know prefix</font>

486
00:19:23,430 --> 00:19:28,140
<font color="#E5E5E5">right but you also see that</font><font color="#CCCCCC"> the binary</font>

487
00:19:25,470 --> 00:19:30,630
associated with it is unsigned<font color="#CCCCCC"> right so</font>

488
00:19:28,140 --> 00:19:33,660
<font color="#E5E5E5">that's a red flag</font><font color="#CCCCCC"> right this this code</font>

489
00:19:30,630 --> 00:19:36,000
wasn't signed by<font color="#E5E5E5"> any official entity and</font>

490
00:19:33,660 --> 00:19:38,280
so you can see the<font color="#E5E5E5"> startup binary there</font>

491
00:19:36,000 --> 00:19:40,830
but if you look take a deep<font color="#CCCCCC"> look</font><font color="#E5E5E5"> at the</font>

492
00:19:38,280 --> 00:19:42,899
<font color="#E5E5E5">the startup binaries location</font><font color="#CCCCCC"> you see</font>

493
00:19:40,830 --> 00:19:44,610
that it's in temp which is suspicious

494
00:19:42,900 --> 00:19:46,230
right<font color="#E5E5E5"> most</font><font color="#CCCCCC"> of the time when an attacker</font>

495
00:19:44,610 --> 00:19:47,719
gets<font color="#CCCCCC"> onto</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> Box</font><font color="#E5E5E5"> they might be</font>

496
00:19:46,230 --> 00:19:50,820
restricted to<font color="#E5E5E5"> where they</font><font color="#CCCCCC"> could put</font>

497
00:19:47,720 --> 00:19:52,620
<font color="#E5E5E5">specific files and binaries most of the</font>

498
00:19:50,820 --> 00:19:56,970
time you'll find<font color="#CCCCCC"> these binaries ended up</font>

499
00:19:52,620 --> 00:19:59,020
in temp and so from this now knowing

500
00:19:56,970 --> 00:20:00,910
<font color="#CCCCCC">that we understand the tactic</font>

501
00:19:59,020 --> 00:20:02,980
which is persistence<font color="#E5E5E5"> and the technique</font>

502
00:20:00,910 --> 00:20:04,930
which is launched ages and<font color="#E5E5E5"> large</font><font color="#CCCCCC"> stamens</font>

503
00:20:02,980 --> 00:20:07,720
then we could come up<font color="#CCCCCC"> with a hypothesis</font>

504
00:20:04,930 --> 00:20:10,120
and so that hypothesis is an attacker

505
00:20:07,720 --> 00:20:13,540
has compromised at least one system and

506
00:20:10,120 --> 00:20:16,689
is persistent<font color="#E5E5E5"> do via a launch agent or a</font>

507
00:20:13,540 --> 00:20:19,389
launch daemon<font color="#CCCCCC"> and</font><font color="#E5E5E5"> so I mentioned before</font>

508
00:20:16,690 --> 00:20:20,980
<font color="#E5E5E5">that</font><font color="#CCCCCC"> os query is the best tool for</font><font color="#E5E5E5"> doing</font>

509
00:20:19,390 --> 00:20:22,600
this<font color="#E5E5E5"> because it's the best at</font><font color="#CCCCCC"> doing</font>

510
00:20:20,980 --> 00:20:25,450
enterprise sweeps which is good for

511
00:20:22,600 --> 00:20:27,250
persistent items and so this is an

512
00:20:25,450 --> 00:20:29,320
example of a query<font color="#E5E5E5"> that</font><font color="#CCCCCC"> you might want</font>

513
00:20:27,250 --> 00:20:31,570
to run at an interval and<font color="#E5E5E5"> so</font><font color="#CCCCCC"> I'll walk</font>

514
00:20:29,320 --> 00:20:33,790
<font color="#CCCCCC">through</font><font color="#E5E5E5"> this query pretty quickly and so</font>

515
00:20:31,570 --> 00:20:35,980
there's a signature table s right and

516
00:20:33,790 --> 00:20:37,690
<font color="#CCCCCC">you</font><font color="#E5E5E5"> would join that data on launch D</font>

517
00:20:35,980 --> 00:20:40,180
which includes launch<font color="#E5E5E5"> agents and</font>

518
00:20:37,690 --> 00:20:42,790
<font color="#E5E5E5">launched Damon's and so you want to grab</font>

519
00:20:40,180 --> 00:20:46,030
the program<font color="#E5E5E5"> arguments from the signature</font>

520
00:20:42,790 --> 00:20:48,760
table where the<font color="#CCCCCC"> launch</font><font color="#E5E5E5"> where it's tied</font>

521
00:20:46,030 --> 00:20:51,580
to<font color="#E5E5E5"> launch D and the name is starts with</font>

522
00:20:48,760 --> 00:20:53,350
<font color="#CCCCCC">calm a polite so that's signifies a</font>

523
00:20:51,580 --> 00:20:55,389
<font color="#E5E5E5">launch agent or a launch</font><font color="#CCCCCC"> daemon</font><font color="#E5E5E5"> that</font>

524
00:20:53,350 --> 00:20:57,639
starts with calm down a pole so<font color="#CCCCCC"> that</font>

525
00:20:55,390 --> 00:20:59,830
takes<font color="#CCCCCC"> some things out of</font><font color="#E5E5E5"> the picture but</font>

526
00:20:57,640 --> 00:21:01,810
<font color="#E5E5E5">then also you want</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> look for unsigned</font>

527
00:20:59,830 --> 00:21:06,250
binary and the example that<font color="#E5E5E5"> I</font><font color="#CCCCCC"> showed</font>

528
00:21:01,810 --> 00:21:09,010
right here right and so with that the

529
00:21:06,250 --> 00:21:10,360
sign flag will<font color="#CCCCCC"> be</font><font color="#E5E5E5"> 0</font><font color="#CCCCCC"> right and</font><font color="#E5E5E5"> so with</font>

530
00:21:09,010 --> 00:21:12,850
<font color="#E5E5E5">that you'll be able to detect something</font>

531
00:21:10,360 --> 00:21:15,370
<font color="#E5E5E5">like</font><font color="#CCCCCC"> a cold rat and then as I mentioned</font>

532
00:21:12,850 --> 00:21:16,990
<font color="#E5E5E5">before it's important for it</font><font color="#CCCCCC"> to run at</font>

533
00:21:15,370 --> 00:21:20,530
load or else it<font color="#E5E5E5"> doesn't really achieve</font>

534
00:21:16,990 --> 00:21:23,020
persistence and so that's all well<font color="#CCCCCC"> and</font>

535
00:21:20,530 --> 00:21:25,990
good<font color="#CCCCCC"> but when it comes to defense you</font>

536
00:21:23,020 --> 00:21:28,840
want to consider<font color="#E5E5E5"> how robust is your</font>

537
00:21:25,990 --> 00:21:30,940
detection for a particular thing<font color="#CCCCCC"> and so</font>

538
00:21:28,840 --> 00:21:33,189
<font color="#CCCCCC">we might</font><font color="#E5E5E5"> want to tweak that a</font><font color="#CCCCCC"> little bit</font>

539
00:21:30,940 --> 00:21:35,110
to say an attacker has compromised at

540
00:21:33,190 --> 00:21:38,290
least one system and maybe<font color="#E5E5E5"> they're</font>

541
00:21:35,110 --> 00:21:41,110
persisting via a signed launch<font color="#E5E5E5"> agent or</font>

542
00:21:38,290 --> 00:21:43,420
launch daemon in which the binary is not

543
00:21:41,110 --> 00:21:45,370
signed<font color="#E5E5E5"> by Apple and so there's</font><font color="#CCCCCC"> nothing</font>

544
00:21:43,420 --> 00:21:46,990
stopping someone from<font color="#E5E5E5"> getting</font>

545
00:21:45,370 --> 00:21:49,000
compromised maybe like<font color="#E5E5E5"> an apple</font>

546
00:21:46,990 --> 00:21:51,850
developer<font color="#CCCCCC"> and then</font><font color="#E5E5E5"> the attacker using</font>

547
00:21:49,000 --> 00:21:53,650
the<font color="#CCCCCC"> Apple developer certificate</font><font color="#E5E5E5"> to sign</font>

548
00:21:51,850 --> 00:21:55,030
their malicious code right and so you

549
00:21:53,650 --> 00:21:57,300
want<font color="#CCCCCC"> to account</font><font color="#E5E5E5"> for this sort of</font><font color="#CCCCCC"> thing</font>

550
00:21:55,030 --> 00:21:59,620
also the<font color="#E5E5E5"> venting process of actually</font>

551
00:21:57,300 --> 00:22:02,230
<font color="#E5E5E5">someone sign up to be Apple developer</font>

552
00:21:59,620 --> 00:22:03,969
and getting a certificate<font color="#E5E5E5"> they could use</font>

553
00:22:02,230 --> 00:22:06,820
that<font color="#CCCCCC"> certificate to write malicious code</font>

554
00:22:03,970 --> 00:22:08,980
that vetting process of you<font color="#CCCCCC"> know is this</font>

555
00:22:06,820 --> 00:22:11,139
person<font color="#CCCCCC"> a sketchy person that might</font><font color="#E5E5E5"> want</font>

556
00:22:08,980 --> 00:22:11,850
<font color="#E5E5E5">to write code malicious code is not</font>

557
00:22:11,140 --> 00:22:14,610
really

558
00:22:11,850 --> 00:22:16,770
documented or vetted by<font color="#E5E5E5"> Apple and so</font>

559
00:22:14,610 --> 00:22:19,110
what do you have<font color="#E5E5E5"> a lot of the times</font><font color="#CCCCCC"> to</font>

560
00:22:16,770 --> 00:22:21,059
bypass certain mechanism I'll talk about

561
00:22:19,110 --> 00:22:23,428
<font color="#E5E5E5">it later called gatekeeper you'll have</font>

562
00:22:21,059 --> 00:22:25,289
<font color="#E5E5E5">signed malicious code</font><font color="#CCCCCC"> out</font><font color="#E5E5E5"> there in a</font>

563
00:22:23,429 --> 00:22:27,179
while and it'll<font color="#CCCCCC"> be able</font><font color="#E5E5E5"> to execute</font>

564
00:22:25,289 --> 00:22:30,299
<font color="#CCCCCC">because gatekeepers sees that it's</font>

565
00:22:27,179 --> 00:22:33,360
signed<font color="#E5E5E5"> right and so to take account</font><font color="#CCCCCC"> for</font>

566
00:22:30,299 --> 00:22:35,370
this<font color="#E5E5E5"> you would do the following</font><font color="#CCCCCC"> you</font>

567
00:22:33,360 --> 00:22:37,770
<font color="#CCCCCC">would account for com that Apple but</font>

568
00:22:35,370 --> 00:22:40,918
then the authority of not software

569
00:22:37,770 --> 00:22:42,900
signing because<font color="#E5E5E5"> software signing it is</font>

570
00:22:40,919 --> 00:22:46,260
associated with<font color="#E5E5E5"> Apple</font><font color="#CCCCCC"> signed binaries</font>

571
00:22:42,900 --> 00:22:47,760
and if anyone<font color="#E5E5E5"> wants to Josh</font><font color="#CCCCCC"> Pitt's</font><font color="#E5E5E5"> talk</font>

572
00:22:46,260 --> 00:22:50,700
he mentioned a<font color="#CCCCCC"> way to</font><font color="#E5E5E5"> kind of fool</font>

573
00:22:47,760 --> 00:22:52,379
<font color="#E5E5E5">apples</font><font color="#CCCCCC"> co-signature</font><font color="#E5E5E5"> process based on</font>

574
00:22:50,700 --> 00:22:54,740
like certain tools out there<font color="#CCCCCC"> open-source</font>

575
00:22:52,380 --> 00:22:58,580
tools<font color="#E5E5E5"> and so a requirement for that</font>

576
00:22:54,740 --> 00:23:03,799
<font color="#E5E5E5">specific technique</font><font color="#CCCCCC"> it's the use</font><font color="#E5E5E5"> of the</font>

577
00:22:58,580 --> 00:23:06,120
36 I mean 86<font color="#CCCCCC"> i386</font><font color="#E5E5E5"> architecture for</font>

578
00:23:03,799 --> 00:23:07,950
binaries right so you have to use<font color="#CCCCCC"> that</font>

579
00:23:06,120 --> 00:23:09,870
architecture in order<font color="#CCCCCC"> for</font><font color="#E5E5E5"> this type of</font>

580
00:23:07,950 --> 00:23:12,240
<font color="#CCCCCC">attack to</font><font color="#E5E5E5"> work and so if you included</font>

581
00:23:09,870 --> 00:23:14,399
<font color="#E5E5E5">that you'll take into consideration Josh</font>

582
00:23:12,240 --> 00:23:16,919
<font color="#E5E5E5">Pitt's technique that he introduced</font>

583
00:23:14,400 --> 00:23:20,429
today<font color="#E5E5E5"> so that's from the</font><font color="#CCCCCC"> persistence</font>

584
00:23:16,919 --> 00:23:23,940
side as far<font color="#E5E5E5"> as privilege escalation goes</font>

585
00:23:20,429 --> 00:23:26,309
well you can't do<font color="#E5E5E5"> many things on a Mac</font>

586
00:23:23,940 --> 00:23:28,980
unless you have some elevated<font color="#E5E5E5"> privileges</font>

587
00:23:26,309 --> 00:23:31,830
right there's<font color="#E5E5E5"> something you just can't</font>

588
00:23:28,980 --> 00:23:35,490
<font color="#CCCCCC">write so most times</font><font color="#E5E5E5"> on a Mac system the</font>

589
00:23:31,830 --> 00:23:37,168
person who is the main user of the

590
00:23:35,490 --> 00:23:39,480
<font color="#CCCCCC">system doesn't</font><font color="#E5E5E5"> create a second</font><font color="#CCCCCC"> account</font>

591
00:23:37,169 --> 00:23:40,950
and so because they don'ts create the

592
00:23:39,480 --> 00:23:42,960
second<font color="#E5E5E5"> account they're automatically</font>

593
00:23:40,950 --> 00:23:44,190
admin so most<font color="#CCCCCC"> times if you compromised</font>

594
00:23:42,960 --> 00:23:46,559
the<font color="#CCCCCC"> system you're able to get</font><font color="#E5E5E5"> the</font>

595
00:23:44,190 --> 00:23:48,299
keychain<font color="#CCCCCC"> and dump the password</font><font color="#E5E5E5"> well then</font>

596
00:23:46,559 --> 00:23:50,158
you're able to<font color="#CCCCCC"> elevate your privileges</font>

597
00:23:48,299 --> 00:23:53,639
right but<font color="#CCCCCC"> that's</font><font color="#E5E5E5"> not always the case and</font>

598
00:23:50,159 --> 00:23:55,740
so one way one common<font color="#CCCCCC"> way to</font><font color="#E5E5E5"> elevate</font>

599
00:23:53,640 --> 00:23:58,740
privileges on a Mac is to give the<font color="#E5E5E5"> user</font>

600
00:23:55,740 --> 00:24:01,679
a prompt<font color="#E5E5E5"> whether it be through a</font>

601
00:23:58,740 --> 00:24:03,480
<font color="#E5E5E5">systemic like API call or through</font>

602
00:24:01,679 --> 00:24:05,580
something<font color="#CCCCCC"> like</font><font color="#E5E5E5"> Apple scripts right and</font>

603
00:24:03,480 --> 00:24:07,679
so this<font color="#E5E5E5"> is a prompt that I created using</font>

604
00:24:05,580 --> 00:24:09,600
Apple script and if you<font color="#E5E5E5"> enter your</font>

605
00:24:07,679 --> 00:24:12,450
username<font color="#CCCCCC"> and password</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> you're the</font>

606
00:24:09,600 --> 00:24:16,770
admin on<font color="#E5E5E5"> the system</font><font color="#CCCCCC"> then it</font><font color="#E5E5E5"> will execute</font>

607
00:24:12,450 --> 00:24:18,809
as elevated process or it will be

608
00:24:16,770 --> 00:24:21,059
spawned<font color="#E5E5E5"> and with elevated privileges and</font>

609
00:24:18,809 --> 00:24:23,040
so<font color="#E5E5E5"> behind this is just like a simple LS</font>

610
00:24:21,059 --> 00:24:25,408
but<font color="#E5E5E5"> it could be anything</font><font color="#CCCCCC"> behind that</font>

611
00:24:23,040 --> 00:24:25,740
right<font color="#E5E5E5"> and so on the Mac systems all the</font>

612
00:24:25,409 --> 00:24:27,510
<font color="#E5E5E5">time</font>

613
00:24:25,740 --> 00:24:28,860
you get a bunch<font color="#E5E5E5"> of</font><font color="#CCCCCC"> popups</font><font color="#E5E5E5"> and you're not</font>

614
00:24:27,510 --> 00:24:31,080
really<font color="#E5E5E5"> sure if they're legitimate or not</font>

615
00:24:28,860 --> 00:24:33,719
<font color="#E5E5E5">legitimate right</font><font color="#CCCCCC"> Apple does a bad job of</font>

616
00:24:31,080 --> 00:24:36,629
actually showing that<font color="#CCCCCC"> to the user</font>

617
00:24:33,720 --> 00:24:38,640
<font color="#E5E5E5">because it happens so many times but all</font>

618
00:24:36,630 --> 00:24:40,110
it<font color="#CCCCCC"> takes is one</font><font color="#E5E5E5"> entry into this with</font>

619
00:24:38,640 --> 00:24:43,500
<font color="#E5E5E5">username and password and it's and it's</font>

620
00:24:40,110 --> 00:24:45,419
game over<font color="#CCCCCC"> and so one hypothesis that we</font>

621
00:24:43,500 --> 00:24:47,880
can create is well what if an attacker

622
00:24:45,420 --> 00:24:49,920
has compromised at least one system and

623
00:24:47,880 --> 00:24:51,179
has elevated<font color="#E5E5E5"> their privileges through</font>

624
00:24:49,920 --> 00:24:53,280
the use of the sudo command

625
00:24:51,179 --> 00:24:55,890
right<font color="#E5E5E5"> so sudo command is similar to that</font>

626
00:24:53,280 --> 00:24:59,428
<font color="#CCCCCC">of Linux you get it you can</font><font color="#E5E5E5"> use it to</font>

627
00:24:55,890 --> 00:25:00,300
elevate<font color="#E5E5E5"> privileges and and so one</font><font color="#CCCCCC"> thing</font>

628
00:24:59,429 --> 00:25:03,960
<font color="#CCCCCC">that you</font><font color="#E5E5E5"> want to look for in your</font>

629
00:25:00,300 --> 00:25:05,970
<font color="#CCCCCC">environment is baselining how often</font><font color="#E5E5E5"> sudo</font>

630
00:25:03,960 --> 00:25:07,320
is being used<font color="#E5E5E5"> right and so you if you</font>

631
00:25:05,970 --> 00:25:09,660
<font color="#E5E5E5">don't expect you</font><font color="#CCCCCC"> to use</font><font color="#E5E5E5"> this to suit you</font>

632
00:25:07,320 --> 00:25:12,600
much<font color="#E5E5E5"> well then this is something</font><font color="#CCCCCC"> that</font>

633
00:25:09,660 --> 00:25:15,030
will give you a lot of<font color="#E5E5E5"> good fidelity so</font>

634
00:25:12,600 --> 00:25:17,010
be high fidelity but<font color="#E5E5E5"> it'll be like not</font>

635
00:25:15,030 --> 00:25:20,520
that many alerts that<font color="#E5E5E5"> come</font><font color="#CCCCCC"> to you right</font>

636
00:25:17,010 --> 00:25:23,100
<font color="#E5E5E5">and so also when folks are invoking the</font>

637
00:25:20,520 --> 00:25:26,010
prompt for elevated privileges<font color="#E5E5E5"> through</font>

638
00:25:23,100 --> 00:25:28,909
like<font color="#E5E5E5"> a API call it calls this security</font>

639
00:25:26,010 --> 00:25:30,960
<font color="#E5E5E5">off trampoline binary and so you</font><font color="#CCCCCC"> wanna</font>

640
00:25:28,910 --> 00:25:32,940
<font color="#E5E5E5">baseline the use of that in your</font>

641
00:25:30,960 --> 00:25:35,070
environment<font color="#CCCCCC"> as well</font><font color="#E5E5E5"> those two things</font>

642
00:25:32,940 --> 00:25:36,990
shouldn't happen very<font color="#E5E5E5"> often at</font><font color="#CCCCCC"> all in</font>

643
00:25:35,070 --> 00:25:38,700
your environment<font color="#CCCCCC"> and if it does</font><font color="#E5E5E5"> then</font>

644
00:25:36,990 --> 00:25:40,559
it's probably<font color="#E5E5E5"> tied back</font><font color="#CCCCCC"> to some</font>

645
00:25:38,700 --> 00:25:42,990
legitimate tool whether it be<font color="#E5E5E5"> I've seen</font>

646
00:25:40,559 --> 00:25:45,750
Microsoft suite<font color="#E5E5E5"> of tools like</font><font color="#CCCCCC"> Microsoft</font>

647
00:25:42,990 --> 00:25:47,130
Office<font color="#E5E5E5"> I've seen tools like like Little</font>

648
00:25:45,750 --> 00:25:48,900
Snitch but these are<font color="#CCCCCC"> legitimate tools</font>

649
00:25:47,130 --> 00:25:51,420
which if you check the code<font color="#E5E5E5"> signature on</font>

650
00:25:48,900 --> 00:25:54,840
them<font color="#CCCCCC"> they're tied back to</font><font color="#E5E5E5"> like some</font>

651
00:25:51,420 --> 00:25:57,000
legitimate entity<font color="#CCCCCC"> right</font><font color="#E5E5E5"> and so the next</font>

652
00:25:54,840 --> 00:26:00,178
<font color="#E5E5E5">tactic that I'll get into is defense</font>

653
00:25:57,000 --> 00:26:01,559
evasion and so in<font color="#E5E5E5"> order to talk</font><font color="#CCCCCC"> about</font>

654
00:26:00,179 --> 00:26:03,900
defense evasion you have to talk<font color="#E5E5E5"> about</font>

655
00:26:01,559 --> 00:26:07,110
well<font color="#E5E5E5"> what are the different defense</font>

656
00:26:03,900 --> 00:26:09,030
mechanisms on Mac OS<font color="#E5E5E5"> systems well the</font>

657
00:26:07,110 --> 00:26:11,939
first is file quarantine<font color="#E5E5E5"> right so the</font>

658
00:26:09,030 --> 00:26:13,860
idea<font color="#CCCCCC"> behind</font><font color="#E5E5E5"> file quarantine is to slow</font>

659
00:26:11,940 --> 00:26:15,690
the user down from executing things that

660
00:26:13,860 --> 00:26:17,250
were downloaded<font color="#E5E5E5"> from the internet</font><font color="#CCCCCC"> and so</font>

661
00:26:15,690 --> 00:26:19,020
let's say you download something<font color="#CCCCCC"> from</font>

662
00:26:17,250 --> 00:26:21,840
the<font color="#E5E5E5"> Internet's here I install I</font>

663
00:26:19,020 --> 00:26:24,600
downloaded<font color="#CCCCCC"> opera the browser and it's</font>

664
00:26:21,840 --> 00:26:26,669
installer<font color="#E5E5E5"> and it acts as me do I want</font><font color="#CCCCCC"> to</font>

665
00:26:24,600 --> 00:26:29,669
<font color="#CCCCCC">open this</font><font color="#E5E5E5"> it came from the</font><font color="#CCCCCC"> Internet</font><font color="#E5E5E5"> and</font>

666
00:26:26,670 --> 00:26:32,160
it shows me<font color="#CCCCCC"> the</font><font color="#E5E5E5"> URL but one thing about</font>

667
00:26:29,670 --> 00:26:34,380
<font color="#CCCCCC">this</font><font color="#E5E5E5"> is that it doesn't prevent the user</font>

668
00:26:32,160 --> 00:26:36,270
from opening<font color="#E5E5E5"> this it just</font><font color="#CCCCCC"> shows the user</font>

669
00:26:34,380 --> 00:26:37,500
<font color="#E5E5E5">that hey like you might want to slow</font>

670
00:26:36,270 --> 00:26:39,080
<font color="#CCCCCC">down and</font><font color="#E5E5E5"> think about what</font><font color="#CCCCCC"> you're doing</font>

671
00:26:37,500 --> 00:26:41,990
<font color="#E5E5E5">here so</font>

672
00:26:39,080 --> 00:26:43,309
gatekeeper<font color="#CCCCCC"> is complementary where once</font>

673
00:26:41,990 --> 00:26:45,769
you say<font color="#E5E5E5"> okay I want</font><font color="#CCCCCC"> to open</font><font color="#E5E5E5"> this</font>

674
00:26:43,309 --> 00:26:48,529
<font color="#E5E5E5">gatekeeper checks to see if it's signed</font>

675
00:26:45,769 --> 00:26:49,970
by a<font color="#E5E5E5"> legitimate entity right so that's</font>

676
00:26:48,529 --> 00:26:52,700
like<font color="#CCCCCC"> an</font><font color="#E5E5E5"> Apple developer that's like</font>

677
00:26:49,970 --> 00:26:55,460
Apple<font color="#E5E5E5"> itself</font><font color="#CCCCCC"> and if it's not let's say</font>

678
00:26:52,700 --> 00:26:59,000
that that<font color="#CCCCCC"> binary is unsigned</font><font color="#E5E5E5"> or the</font>

679
00:26:55,460 --> 00:26:59,870
<font color="#CCCCCC">binary is signed by already identified</font>

680
00:26:59,000 --> 00:27:02,600
malicious entity

681
00:26:59,870 --> 00:27:04,370
<font color="#E5E5E5">well</font><font color="#CCCCCC"> axe you are you sure you want to</font>

682
00:27:02,600 --> 00:27:06,529
<font color="#CCCCCC">open this this came</font><font color="#E5E5E5"> from an</font><font color="#CCCCCC"> unidentified</font>

683
00:27:04,370 --> 00:27:09,469
developer or malicious develop developer

684
00:27:06,529 --> 00:27:11,269
right and so it<font color="#E5E5E5"> doesn't again</font><font color="#CCCCCC"> stop you</font>

685
00:27:09,470 --> 00:27:13,250
from<font color="#CCCCCC"> opening it it just tries to</font><font color="#E5E5E5"> slow</font>

686
00:27:11,269 --> 00:27:16,700
you down from<font color="#E5E5E5"> doing something</font><font color="#CCCCCC"> pretty</font>

687
00:27:13,250 --> 00:27:18,350
<font color="#E5E5E5">dumb right and so to combat that you</font>

688
00:27:16,700 --> 00:27:20,389
have X protect which a lot<font color="#E5E5E5"> of people</font>

689
00:27:18,350 --> 00:27:23,299
don't know about<font color="#E5E5E5"> which</font><font color="#CCCCCC"> is basically the</font>

690
00:27:20,389 --> 00:27:26,240
<font color="#CCCCCC">built-in AV system for Mac OS systems</font>

691
00:27:23,299 --> 00:27:28,610
right and so the idea behind X protect

692
00:27:26,240 --> 00:27:30,559
it used to be<font color="#E5E5E5"> like just like</font><font color="#CCCCCC"> sha-256</font>

693
00:27:28,610 --> 00:27:32,899
hashes that<font color="#E5E5E5"> were stored on</font><font color="#CCCCCC"> a system but</font>

694
00:27:30,559 --> 00:27:37,279
they've since<font color="#E5E5E5"> use since moved to</font><font color="#CCCCCC"> Yarra</font>

695
00:27:32,899 --> 00:27:40,370
<font color="#E5E5E5">base signatures and so the</font><font color="#CCCCCC"> Yarra</font>

696
00:27:37,279 --> 00:27:43,309
signatures are open to anyone to<font color="#E5E5E5"> go see</font>

697
00:27:40,370 --> 00:27:45,799
so if you go<font color="#E5E5E5"> to the system library core</font>

698
00:27:43,309 --> 00:27:48,049
services X protect bundle<font color="#E5E5E5"> and the</font>

699
00:27:45,799 --> 00:27:50,658
<font color="#E5E5E5">resources you can see all of the</font><font color="#CCCCCC"> yarra</font>

700
00:27:48,049 --> 00:27:52,879
rules that Apple is actually using to

701
00:27:50,659 --> 00:27:54,919
detect the malware<font color="#CCCCCC"> right and so with</font>

702
00:27:52,880 --> 00:27:57,049
that malware authors can also see the

703
00:27:54,919 --> 00:28:01,210
same<font color="#E5E5E5"> thing so they can modify their</font>

704
00:27:57,049 --> 00:28:03,049
malware to kind<font color="#E5E5E5"> of evade X protect and</font>

705
00:28:01,210 --> 00:28:05,210
then you have system integrity

706
00:28:03,049 --> 00:28:08,269
<font color="#CCCCCC">protection and so the idea behind that</font>

707
00:28:05,210 --> 00:28:11,059
<font color="#CCCCCC">is like</font><font color="#E5E5E5"> Apple</font><font color="#CCCCCC"> wants</font><font color="#E5E5E5"> Mac OS systems to be</font>

708
00:28:08,269 --> 00:28:13,850
rootless<font color="#E5E5E5"> so let's say that even if you</font>

709
00:28:11,059 --> 00:28:15,918
were root on a Mac system<font color="#E5E5E5"> there's only</font>

710
00:28:13,850 --> 00:28:18,168
so much you<font color="#CCCCCC"> can do as far as to</font>

711
00:28:15,919 --> 00:28:20,510
<font color="#E5E5E5">compromise</font><font color="#CCCCCC"> a system</font><font color="#E5E5E5"> to like smithereens</font>

712
00:28:18,169 --> 00:28:22,549
right you can't totally<font color="#E5E5E5"> compromise the</font>

713
00:28:20,510 --> 00:28:24,470
Mac there are some folders and files

714
00:28:22,549 --> 00:28:27,620
that<font color="#E5E5E5"> are protected even if you're the</font>

715
00:28:24,470 --> 00:28:29,360
<font color="#CCCCCC">root user</font><font color="#E5E5E5"> and that's</font><font color="#CCCCCC"> my design right so</font>

716
00:28:27,620 --> 00:28:30,918
there's a way<font color="#CCCCCC"> to disable</font><font color="#E5E5E5"> system</font>

717
00:28:29,360 --> 00:28:33,649
integrity<font color="#CCCCCC"> protection but</font><font color="#E5E5E5"> you have to</font>

718
00:28:30,919 --> 00:28:35,210
have physical<font color="#CCCCCC"> access to</font><font color="#E5E5E5"> the system or</font>

719
00:28:33,649 --> 00:28:37,399
there's been vulnerabilities that<font color="#E5E5E5"> have</font>

720
00:28:35,210 --> 00:28:39,100
<font color="#E5E5E5">popped up over the last two years where</font>

721
00:28:37,399 --> 00:28:41,239
people<font color="#CCCCCC"> have been able to circumvent</font>

722
00:28:39,100 --> 00:28:43,490
<font color="#E5E5E5">system integrity</font><font color="#CCCCCC"> protection and it has</font>

723
00:28:41,240 --> 00:28:47,090
to do with<font color="#CCCCCC"> like malicious like dynamic</font>

724
00:28:43,490 --> 00:28:48,830
<font color="#E5E5E5">libraries and things of that</font><font color="#CCCCCC"> sort so so</font>

725
00:28:47,090 --> 00:28:52,550
one way<font color="#CCCCCC"> to bypass</font><font color="#E5E5E5"> gatekeeper that's</font>

726
00:28:48,830 --> 00:28:55,100
pretty significant is that<font color="#E5E5E5"> in</font>

727
00:28:52,550 --> 00:28:57,560
order for file quarantine or gatekeeper

728
00:28:55,100 --> 00:28:59,600
to notify you that<font color="#E5E5E5"> something originated</font>

729
00:28:57,560 --> 00:29:01,340
from the<font color="#CCCCCC"> internet</font><font color="#E5E5E5"> what it does it does</font>

730
00:28:59,600 --> 00:29:03,020
<font color="#E5E5E5">similar something similar to Windows</font>

731
00:29:01,340 --> 00:29:04,970
where it does like a mark of the web and

732
00:29:03,020 --> 00:29:07,660
that's<font color="#E5E5E5"> called an extended attribute so</font>

733
00:29:04,970 --> 00:29:10,040
it'll tie the extended attribute to the

734
00:29:07,660 --> 00:29:12,020
file<font color="#E5E5E5"> that was</font><font color="#CCCCCC"> downloaded</font><font color="#E5E5E5"> and say hey</font>

735
00:29:10,040 --> 00:29:13,370
this thing was downloaded<font color="#CCCCCC"> from the</font>

736
00:29:12,020 --> 00:29:15,170
internet<font color="#CCCCCC"> well there are some</font>

737
00:29:13,370 --> 00:29:17,899
<font color="#CCCCCC">applications on Mac OS which are not</font>

738
00:29:15,170 --> 00:29:20,300
quarantine<font color="#E5E5E5"> aware right and so one of</font>

739
00:29:17,900 --> 00:29:23,720
<font color="#CCCCCC">those</font><font color="#E5E5E5"> applications is terminal so if you</font>

740
00:29:20,300 --> 00:29:25,940
could<font color="#E5E5E5"> simply get a user to run a command</font>

741
00:29:23,720 --> 00:29:28,280
<font color="#CCCCCC">that</font><font color="#E5E5E5"> goes to download something</font><font color="#CCCCCC"> well</font>

742
00:29:25,940 --> 00:29:30,020
then it's not quarantine aware file

743
00:29:28,280 --> 00:29:30,470
keeper I mean<font color="#CCCCCC"> gate keeper doesn't know</font>

744
00:29:30,020 --> 00:29:31,790
about<font color="#E5E5E5"> it</font>

745
00:29:30,470 --> 00:29:33,770
file quarantine doesn't know about<font color="#CCCCCC"> it</font>

746
00:29:31,790 --> 00:29:34,250
<font color="#E5E5E5">and it allow</font><font color="#CCCCCC"> it to run it'll bypass the</font>

747
00:29:33,770 --> 00:29:37,070
<font color="#CCCCCC">coat check</font>

748
00:29:34,250 --> 00:29:39,080
<font color="#CCCCCC">it'll</font><font color="#E5E5E5"> bypass you know hey did you</font>

749
00:29:37,070 --> 00:29:42,320
originate from the<font color="#E5E5E5"> internet and so this</font>

750
00:29:39,080 --> 00:29:44,990
instance was from some crypto malware

751
00:29:42,320 --> 00:29:49,010
that was<font color="#E5E5E5"> targeting a certain community</font>

752
00:29:44,990 --> 00:29:51,680
and it<font color="#E5E5E5"> was presented</font><font color="#CCCCCC"> by</font><font color="#E5E5E5"> sans ISC right</font>

753
00:29:49,010 --> 00:29:54,170
the storm center<font color="#E5E5E5"> and so in this</font><font color="#CCCCCC"> instance</font>

754
00:29:51,680 --> 00:29:57,430
they went to go curl<font color="#E5E5E5"> a binary from the</font>

755
00:29:54,170 --> 00:29:59,570
<font color="#CCCCCC">Internet and</font><font color="#E5E5E5"> with that it changed the</font>

756
00:29:57,430 --> 00:30:02,060
permissions on that and then allowed<font color="#CCCCCC"> the</font>

757
00:29:59,570 --> 00:30:03,830
<font color="#CCCCCC">descriptor</font><font color="#E5E5E5"> execute and so another way</font><font color="#CCCCCC"> to</font>

758
00:30:02,060 --> 00:30:06,409
bypass<font color="#E5E5E5"> gatekeeper is to simply just</font>

759
00:30:03,830 --> 00:30:08,570
delete the quarantine<font color="#E5E5E5"> flag that's</font>

760
00:30:06,410 --> 00:30:10,430
<font color="#CCCCCC">associated with it so the extended</font>

761
00:30:08,570 --> 00:30:12,889
attribute which has come<font color="#E5E5E5"> at Apple that</font>

762
00:30:10,430 --> 00:30:16,280
quarantine you could just delete<font color="#CCCCCC"> it and</font>

763
00:30:12,890 --> 00:30:17,810
<font color="#CCCCCC">it'll</font><font color="#E5E5E5"> allow</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> to run right and so one</font>

764
00:30:16,280 --> 00:30:20,720
hypothesis<font color="#E5E5E5"> that we want to create is</font>

765
00:30:17,810 --> 00:30:22,280
well an attacker has attempted to they

766
00:30:20,720 --> 00:30:23,840
have<font color="#CCCCCC"> they have compromised at least one</font>

767
00:30:22,280 --> 00:30:26,300
system<font color="#E5E5E5"> and is attempting</font><font color="#CCCCCC"> to evade</font>

768
00:30:23,840 --> 00:30:29,689
<font color="#E5E5E5">defenses specifically system integrity</font>

769
00:30:26,300 --> 00:30:33,260
protection<font color="#CCCCCC"> and/or gatekeeper and so with</font>

770
00:30:29,690 --> 00:30:35,810
<font color="#E5E5E5">this for OS query which</font><font color="#CCCCCC"> is great at</font>

771
00:30:33,260 --> 00:30:37,700
point in time you<font color="#CCCCCC"> can check to see if</font>

772
00:30:35,810 --> 00:30:40,879
for<font color="#E5E5E5"> any of your users the system</font>

773
00:30:37,700 --> 00:30:43,610
integrity<font color="#E5E5E5"> check is like disabled right</font>

774
00:30:40,880 --> 00:30:45,950
so if this if enabled is equal to<font color="#CCCCCC"> zero</font>

775
00:30:43,610 --> 00:30:47,149
which means<font color="#CCCCCC"> it's disabled</font><font color="#E5E5E5"> you might want</font>

776
00:30:45,950 --> 00:30:48,080
to<font color="#E5E5E5"> know about</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> right because that's</font>

777
00:30:47,150 --> 00:30:50,090
unusual

778
00:30:48,080 --> 00:30:52,100
and then for real-time<font color="#E5E5E5"> process</font>

779
00:30:50,090 --> 00:30:54,350
monitoring<font color="#CCCCCC"> you might want to</font><font color="#E5E5E5"> look at</font>

780
00:30:52,100 --> 00:30:56,480
<font color="#CCCCCC">baselining the use of like curl</font><font color="#E5E5E5"> get</font>

781
00:30:54,350 --> 00:30:58,639
<font color="#E5E5E5">double you get four attempts to download</font>

782
00:30:56,480 --> 00:31:00,590
files specifically<font color="#E5E5E5"> for like IP addresses</font>

783
00:30:58,640 --> 00:31:04,820
<font color="#CCCCCC">you might want to monitoring</font><font color="#E5E5E5"> for the use</font>

784
00:31:00,590 --> 00:31:05,720
<font color="#CCCCCC">of the system</font><font color="#E5E5E5"> control command to disable</font>

785
00:31:04,820 --> 00:31:07,580
gatekeeper

786
00:31:05,720 --> 00:31:09,740
and then you might<font color="#CCCCCC"> also want to monitor</font>

787
00:31:07,580 --> 00:31:10,908
for<font color="#E5E5E5"> the use of</font><font color="#CCCCCC"> X adder to remove the</font>

788
00:31:09,740 --> 00:31:14,029
extended<font color="#E5E5E5"> actually boot that I just</font>

789
00:31:10,909 --> 00:31:16,509
showed and so I'll get<font color="#CCCCCC"> into the</font><font color="#E5E5E5"> demo</font>

790
00:31:14,029 --> 00:31:19,970
portion of the presentation<font color="#CCCCCC"> in which</font>

791
00:31:16,509 --> 00:31:22,070
<font color="#CCCCCC">it'll</font><font color="#E5E5E5"> outline like a attack that happens</font>

792
00:31:19,970 --> 00:31:25,220
on<font color="#CCCCCC"> the Mac side and then it'll show you</font>

793
00:31:22,070 --> 00:31:28,279
how<font color="#E5E5E5"> to go about hunting for that using</font>

794
00:31:25,220 --> 00:31:30,500
some<font color="#E5E5E5"> other tools I introduced so this is</font>

795
00:31:28,279 --> 00:31:32,570
<font color="#CCCCCC">common user gets</font><font color="#E5E5E5"> the email like</font><font color="#CCCCCC"> this</font>

796
00:31:30,500 --> 00:31:36,200
saying<font color="#CCCCCC"> that hey you must</font><font color="#E5E5E5"> download this</font>

797
00:31:32,570 --> 00:31:38,210
file<font color="#CCCCCC"> Mojave is coming up to upgrade</font>

798
00:31:36,200 --> 00:31:39,860
these are network settings that<font color="#E5E5E5"> need</font><font color="#CCCCCC"> to</font>

799
00:31:38,210 --> 00:31:41,090
be<font color="#CCCCCC"> updated on the system in</font><font color="#E5E5E5"> order for</font>

800
00:31:39,860 --> 00:31:43,668
you<font color="#CCCCCC"> to connect to the</font><font color="#E5E5E5"> corporate</font><font color="#CCCCCC"> network</font>

801
00:31:41,090 --> 00:31:45,139
<font color="#E5E5E5">so we want you to</font><font color="#CCCCCC"> download</font><font color="#E5E5E5"> this Apple</font>

802
00:31:43,669 --> 00:31:48,799
script and then we want you to execute

803
00:31:45,139 --> 00:31:50,469
<font color="#E5E5E5">this command right and so a hypothesis</font>

804
00:31:48,799 --> 00:31:53,570
<font color="#E5E5E5">that could be generated from</font><font color="#CCCCCC"> that from</font>

805
00:31:50,470 --> 00:31:55,700
<font color="#CCCCCC">Hunter</font><font color="#E5E5E5"> point of view is that an attacker</font>

806
00:31:53,570 --> 00:31:57,620
has compromised at least one system and

807
00:31:55,700 --> 00:31:59,870
is executing<font color="#E5E5E5"> the licious code via Apple</font>

808
00:31:57,620 --> 00:32:01,340
script<font color="#E5E5E5"> and so how might this look from a</font>

809
00:31:59,870 --> 00:32:03,559
hunting perspective right<font color="#E5E5E5"> what data</font>

810
00:32:01,340 --> 00:32:07,668
might we need and what platforms will<font color="#CCCCCC"> be</font>

811
00:32:03,559 --> 00:32:10,039
<font color="#E5E5E5">used and so</font><font color="#CCCCCC"> with this you have</font><font color="#E5E5E5"> OS query</font>

812
00:32:07,669 --> 00:32:11,539
and<font color="#CCCCCC"> x newman running on us on a box</font>

813
00:32:10,039 --> 00:32:13,039
right and it's collecting those<font color="#E5E5E5"> logs</font>

814
00:32:11,539 --> 00:32:15,230
collecting that information that you

815
00:32:13,039 --> 00:32:17,570
need and then that's<font color="#E5E5E5"> being fed</font><font color="#CCCCCC"> into</font>

816
00:32:15,230 --> 00:32:19,309
<font color="#CCCCCC">help-help is a tool written by</font><font color="#E5E5E5"> roberto</font>

817
00:32:17,570 --> 00:32:22,370
<font color="#E5E5E5">rodriguez a colleague of mine</font><font color="#CCCCCC"> i expect</font>

818
00:32:19,309 --> 00:32:24,830
the<font color="#E5E5E5"> ROPS which is used for kind of</font>

819
00:32:22,370 --> 00:32:27,408
modeling<font color="#CCCCCC"> all of your data into one</font>

820
00:32:24,830 --> 00:32:30,110
<font color="#E5E5E5">location so it's sim based but then also</font>

821
00:32:27,409 --> 00:32:31,399
doing some additional<font color="#E5E5E5"> data science on</font>

822
00:32:30,110 --> 00:32:33,590
top of that to get the<font color="#E5E5E5"> most out of your</font>

823
00:32:31,399 --> 00:32:35,090
<font color="#E5E5E5">data right</font><font color="#CCCCCC"> and so then from the</font>

824
00:32:33,590 --> 00:32:38,570
attackers perspective<font color="#E5E5E5"> they</font><font color="#CCCCCC"> can use a</font>

825
00:32:35,090 --> 00:32:41,299
tool like<font color="#CCCCCC"> Empire which is it's a remote</font>

826
00:32:38,570 --> 00:32:43,370
access<font color="#E5E5E5"> Trojan</font><font color="#CCCCCC"> that could be used for</font>

827
00:32:41,299 --> 00:32:45,590
Windows Mac and<font color="#CCCCCC"> Linux right so I'll be</font>

828
00:32:43,370 --> 00:32:56,870
using<font color="#E5E5E5"> that to carry out my attack in the</font>

829
00:32:45,590 --> 00:32:58,039
demo<font color="#CCCCCC"> right let's get to the demo</font><font color="#E5E5E5"> all</font>

830
00:32:56,870 --> 00:33:00,678
right<font color="#E5E5E5"> it might be</font><font color="#CCCCCC"> a little hard to</font><font color="#E5E5E5"> see</font>

831
00:32:58,039 --> 00:33:03,980
this but<font color="#CCCCCC"> we'll walk</font><font color="#E5E5E5"> there right so this</font>

832
00:33:00,679 --> 00:33:05,960
<font color="#E5E5E5">is the attacker activity so the person</font>

833
00:33:03,980 --> 00:33:08,600
has entered in that command<font color="#E5E5E5"> just now</font>

834
00:33:05,960 --> 00:33:10,519
<font color="#E5E5E5">they've downloaded the file and so from</font>

835
00:33:08,600 --> 00:33:13,639
an attacker point of view<font color="#E5E5E5"> and</font><font color="#CCCCCC"> Empire</font>

836
00:33:10,519 --> 00:33:15,200
<font color="#E5E5E5">that agent has come up and so what</font>

837
00:33:13,639 --> 00:33:17,029
they're<font color="#E5E5E5"> going to do now with that agent</font>

838
00:33:15,200 --> 00:33:18,970
<font color="#CCCCCC">there on the system with</font><font color="#E5E5E5"> that agent</font>

839
00:33:17,029 --> 00:33:23,260
<font color="#E5E5E5">they're</font><font color="#CCCCCC"> able to</font>

840
00:33:18,970 --> 00:33:26,289
<font color="#E5E5E5">take that agent and run a collection</font>

841
00:33:23,260 --> 00:33:28,000
module which will prompt application any

842
00:33:26,289 --> 00:33:30,370
application on<font color="#E5E5E5"> the system and tell that</font>

843
00:33:28,000 --> 00:33:33,059
<font color="#E5E5E5">the user tell the user that the password</font>

844
00:33:30,370 --> 00:33:35,799
is required<font color="#E5E5E5"> in order for the execution</font>

845
00:33:33,059 --> 00:33:39,129
application to run<font color="#E5E5E5"> right and so in this</font>

846
00:33:35,799 --> 00:33:40,539
<font color="#E5E5E5">case I used</font><font color="#CCCCCC"> the app store</font><font color="#E5E5E5"> application</font>

847
00:33:39,130 --> 00:33:43,480
and so we'll<font color="#E5E5E5"> get to see that here in a</font>

848
00:33:40,539 --> 00:33:44,590
moment<font color="#E5E5E5"> so I'm setting up the agent and</font>

849
00:33:43,480 --> 00:33:46,750
making sure that that's all<font color="#E5E5E5"> good to go</font>

850
00:33:44,590 --> 00:33:55,270
<font color="#CCCCCC">and then</font><font color="#E5E5E5"> once it executes it'll switch</font>

851
00:33:46,750 --> 00:33:57,669
over to the end users<font color="#E5E5E5"> and side</font><font color="#CCCCCC"> all</font><font color="#E5E5E5"> right</font>

852
00:33:55,270 --> 00:33:59,500
<font color="#E5E5E5">so from the end users perspective now</font>

853
00:33:57,669 --> 00:34:01,419
<font color="#E5E5E5">you see that the Apple</font><font color="#CCCCCC"> store came the</font>

854
00:33:59,500 --> 00:34:03,280
<font color="#CCCCCC">App Store came up and</font><font color="#E5E5E5"> then acts as you</font>

855
00:34:01,419 --> 00:34:04,510
for your<font color="#CCCCCC"> password to continue and so</font>

856
00:34:03,280 --> 00:34:06,280
this<font color="#E5E5E5"> looks like any normal prompt</font><font color="#CCCCCC"> that</font>

857
00:34:04,510 --> 00:34:07,900
<font color="#CCCCCC">you</font><font color="#E5E5E5"> would see on</font><font color="#CCCCCC"> your Mac OS system</font><font color="#E5E5E5"> at</font>

858
00:34:06,280 --> 00:34:10,119
<font color="#E5E5E5">any point in time</font><font color="#CCCCCC"> right your users will</font>

859
00:34:07,900 --> 00:34:12,940
be fooled by this and<font color="#E5E5E5"> so they</font><font color="#CCCCCC"> entered in</font>

860
00:34:10,119 --> 00:34:14,560
their<font color="#E5E5E5"> password and on the Empire side we</font>

861
00:34:12,940 --> 00:34:16,869
see<font color="#CCCCCC"> that it</font><font color="#E5E5E5"> gives us it gave</font><font color="#CCCCCC"> us some</font>

862
00:34:14,560 --> 00:34:19,359
<font color="#CCCCCC">results and so with</font><font color="#E5E5E5"> that agent now we</font>

863
00:34:16,869 --> 00:34:21,669
could go<font color="#CCCCCC"> into the directory</font><font color="#E5E5E5"> that agent</font>

864
00:34:19,359 --> 00:34:24,129
<font color="#E5E5E5">is designated to and we could see the</font>

865
00:34:21,668 --> 00:34:26,529
<font color="#CCCCCC">the logs for that particular agent and</font>

866
00:34:24,129 --> 00:34:28,830
embedded in those logs would be the

867
00:34:26,530 --> 00:34:31,629
<font color="#CCCCCC">password that</font><font color="#E5E5E5"> was returned by the user</font>

868
00:34:28,830 --> 00:34:33,699
and<font color="#E5E5E5"> so we'll get to see that here in a</font>

869
00:34:31,629 --> 00:34:36,190
second and<font color="#E5E5E5"> then we could actually use</font>

870
00:34:33,699 --> 00:34:37,960
that<font color="#E5E5E5"> password to elevate</font><font color="#CCCCCC"> our privileges</font>

871
00:34:36,190 --> 00:34:40,060
on the<font color="#E5E5E5"> system because</font><font color="#CCCCCC"> of course this</font>

872
00:34:37,960 --> 00:34:41,980
person hasn't<font color="#CCCCCC"> seperated the admin</font>

873
00:34:40,060 --> 00:34:46,149
account from like a normal user account

874
00:34:41,980 --> 00:34:49,119
on<font color="#E5E5E5"> their box right and so it's using the</font>

875
00:34:46,149 --> 00:34:52,810
model is<font color="#CCCCCC"> using the module here</font><font color="#E5E5E5"> to spawn</font>

876
00:34:49,119 --> 00:34:57,540
<font color="#CCCCCC">another</font><font color="#E5E5E5"> agent using the credentials that</font>

877
00:34:52,810 --> 00:35:00,160
<font color="#CCCCCC">were specified in that agent</font><font color="#E5E5E5"> output and</font>

878
00:34:57,540 --> 00:35:02,349
so here<font color="#CCCCCC"> you see us apply the password of</font>

879
00:35:00,160 --> 00:35:04,569
Apple<font color="#E5E5E5"> 1-2-3 which is what the user</font>

880
00:35:02,349 --> 00:35:06,790
entered and then once that's executed on

881
00:35:04,570 --> 00:35:11,109
the<font color="#E5E5E5"> box it'll give us that privilege</font>

882
00:35:06,790 --> 00:35:12,460
escalation you see<font color="#E5E5E5"> that's returned to</font><font color="#CCCCCC"> us</font>

883
00:35:11,109 --> 00:35:15,490
a new agent has been<font color="#CCCCCC"> kicked off</font>

884
00:35:12,460 --> 00:35:18,940
specified by the the green there and so

885
00:35:15,490 --> 00:35:20,979
with that<font color="#E5E5E5"> agent now we can do suspicious</font>

886
00:35:18,940 --> 00:35:24,760
well more malicious<font color="#E5E5E5"> things on a system</font>

887
00:35:20,980 --> 00:35:26,859
such<font color="#CCCCCC"> as</font><font color="#E5E5E5"> create a launch game in so an</font>

888
00:35:24,760 --> 00:35:29,320
important<font color="#E5E5E5"> thing to note here is that</font>

889
00:35:26,859 --> 00:35:32,170
<font color="#E5E5E5">from the detections that I've introduced</font>

890
00:35:29,320 --> 00:35:32,920
so far<font color="#CCCCCC"> for OS query that's</font><font color="#E5E5E5"> been added to</font>

891
00:35:32,170 --> 00:35:35,380
<font color="#E5E5E5">the OS</font>

892
00:35:32,920 --> 00:35:37,180
query configuration and so you'll get<font color="#CCCCCC"> to</font>

893
00:35:35,380 --> 00:35:40,300
<font color="#E5E5E5">see on analyst side when we hunt for</font>

894
00:35:37,180 --> 00:35:46,720
<font color="#E5E5E5">this is a possibility that that analytic</font>

895
00:35:40,300 --> 00:35:48,400
my trigger and so here you<font color="#CCCCCC"> see our name</font>

896
00:35:46,720 --> 00:35:50,770
the launch agent

897
00:35:48,400 --> 00:35:53,470
<font color="#E5E5E5">well the launch daemon</font><font color="#CCCCCC"> comm that</font><font color="#E5E5E5"> Apple</font>

898
00:35:50,770 --> 00:35:55,990
dot<font color="#CCCCCC"> Network update and so that's the</font>

899
00:35:53,470 --> 00:35:58,569
blend in with all this system activity

900
00:35:55,990 --> 00:36:01,509
<font color="#E5E5E5">that that</font><font color="#CCCCCC"> happens on a Mac</font><font color="#E5E5E5"> so if you're</font>

901
00:35:58,570 --> 00:36:03,250
not<font color="#E5E5E5"> familiar</font><font color="#CCCCCC"> with that</font><font color="#E5E5E5"> as a hunter then</font>

902
00:36:01,510 --> 00:36:05,580
you might come<font color="#CCCCCC"> across that and</font><font color="#E5E5E5"> think it</font>

903
00:36:03,250 --> 00:36:08,080
might be<font color="#E5E5E5"> you know legitimate right so</font>

904
00:36:05,580 --> 00:36:11,680
this<font color="#CCCCCC"> is the analytic the</font><font color="#E5E5E5"> analyst hunt</font>

905
00:36:08,080 --> 00:36:14,170
<font color="#E5E5E5">side now and so as</font><font color="#CCCCCC"> far as the analyst</font>

906
00:36:11,680 --> 00:36:16,390
hunt<font color="#E5E5E5"> we're hunting for</font><font color="#CCCCCC"> apple</font><font color="#E5E5E5"> scripts</font>

907
00:36:14,170 --> 00:36:18,820
being used in<font color="#E5E5E5"> our environment so we saw</font>

908
00:36:16,390 --> 00:36:21,100
<font color="#E5E5E5">a script we start our search with OS a</font>

909
00:36:18,820 --> 00:36:22,870
script<font color="#E5E5E5"> see how often it's used if it's</font>

910
00:36:21,100 --> 00:36:25,930
used at all in<font color="#CCCCCC"> the environment</font><font color="#E5E5E5"> and so we</font>

911
00:36:22,870 --> 00:36:28,330
see<font color="#E5E5E5"> that it's been</font><font color="#CCCCCC"> used</font><font color="#E5E5E5"> 62 times right</font>

912
00:36:25,930 --> 00:36:31,450
<font color="#CCCCCC">and so as it's been used 62 times we</font>

913
00:36:28,330 --> 00:36:34,060
want<font color="#E5E5E5"> to see well when was the script</font>

914
00:36:31,450 --> 00:36:35,529
<font color="#E5E5E5">binary actually executed how many times</font>

915
00:36:34,060 --> 00:36:39,400
does<font color="#E5E5E5"> that occur and you</font><font color="#CCCCCC"> see it's</font><font color="#E5E5E5"> only</font>

916
00:36:35,530 --> 00:36:41,730
been<font color="#E5E5E5"> a handful</font><font color="#CCCCCC"> of times right</font><font color="#E5E5E5"> and so the</font>

917
00:36:39,400 --> 00:36:44,350
first<font color="#CCCCCC"> iteration of that is when that</font>

918
00:36:41,730 --> 00:36:46,150
command that<font color="#CCCCCC"> was run by the user</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> kick</font>

919
00:36:44,350 --> 00:36:47,620
<font color="#E5E5E5">off the malicious activity occurred</font>

920
00:36:46,150 --> 00:36:50,200
right and so we don't<font color="#E5E5E5"> know that as a</font>

921
00:36:47,620 --> 00:36:54,009
hunter but we'll get to the next

922
00:36:50,200 --> 00:36:56,350
<font color="#CCCCCC">iteration here where</font><font color="#E5E5E5"> oh so script was</font>

923
00:36:54,010 --> 00:36:58,600
<font color="#CCCCCC">used to actually prompt the App Store</font><font color="#E5E5E5"> to</font>

924
00:36:56,350 --> 00:37:01,960
run and then<font color="#E5E5E5"> the results of</font><font color="#CCCCCC"> that was</font>

925
00:36:58,600 --> 00:37:03,549
going<font color="#E5E5E5"> to be entered</font><font color="#CCCCCC"> into a file right</font>

926
00:37:01,960 --> 00:37:05,320
and so<font color="#CCCCCC"> that looked suspicious because</font>

927
00:37:03,550 --> 00:37:07,780
<font color="#E5E5E5">you see he was like</font><font color="#CCCCCC"> is asking for</font>

928
00:37:05,320 --> 00:37:10,690
password<font color="#E5E5E5"> so</font><font color="#CCCCCC"> we also see that</font><font color="#E5E5E5"> the child</font>

929
00:37:07,780 --> 00:37:13,390
<font color="#CCCCCC">of that using ancestors was Python so</font>

930
00:37:10,690 --> 00:37:15,550
<font color="#CCCCCC">Python spawned oh</font><font color="#E5E5E5"> so scripts Apple</font>

931
00:37:13,390 --> 00:37:17,440
script<font color="#E5E5E5"> and so that is suspicious right</font>

932
00:37:15,550 --> 00:37:20,910
so we<font color="#E5E5E5"> want to look for</font><font color="#CCCCCC"> well how often</font>

933
00:37:17,440 --> 00:37:23,590
<font color="#E5E5E5">this Python run in their environment and</font>

934
00:37:20,910 --> 00:37:25,379
so with<font color="#E5E5E5"> that we get some results</font><font color="#CCCCCC"> back</font>

935
00:37:23,590 --> 00:37:28,930
<font color="#E5E5E5">and we're like</font><font color="#CCCCCC"> okay there's</font><font color="#E5E5E5"> quite a few</font>

936
00:37:25,380 --> 00:37:32,410
<font color="#E5E5E5">Python instances here and with that we</font>

937
00:37:28,930 --> 00:37:34,000
see some base64 encoding<font color="#E5E5E5"> with Python it</font>

938
00:37:32,410 --> 00:37:35,319
was like ah<font color="#E5E5E5"> well</font><font color="#CCCCCC"> I mean unless</font><font color="#E5E5E5"> our</font>

939
00:37:34,000 --> 00:37:37,240
developers<font color="#E5E5E5"> are doing that that looks</font>

940
00:37:35,320 --> 00:37:40,180
<font color="#E5E5E5">like a bad day</font><font color="#CCCCCC"> right</font><font color="#E5E5E5"> and so we could</font>

941
00:37:37,240 --> 00:37:44,200
take that<font color="#E5E5E5"> and we can decode that base64</font>

942
00:37:40,180 --> 00:37:46,240
using a tool like<font color="#E5E5E5"> cyber chef and we'll</font>

943
00:37:44,200 --> 00:37:49,029
see here what the<font color="#E5E5E5"> out</font>

944
00:37:46,240 --> 00:37:50,830
of the cyber chef results will be<font color="#E5E5E5"> and so</font>

945
00:37:49,030 --> 00:37:54,850
you see that<font color="#E5E5E5"> there's an IP in there and</font>

946
00:37:50,830 --> 00:37:56,380
you see<font color="#E5E5E5"> get that PHP well that looks</font>

947
00:37:54,850 --> 00:37:58,360
<font color="#E5E5E5">pretty suspicious right that's enough</font>

948
00:37:56,380 --> 00:38:00,760
probably<font color="#E5E5E5"> to kick off in some response</font>

949
00:37:58,360 --> 00:38:02,710
process<font color="#E5E5E5"> especially if</font><font color="#CCCCCC"> that IP address</font><font color="#E5E5E5"> is</font>

950
00:38:00,760 --> 00:38:04,900
not internal right<font color="#CCCCCC"> its internal for the</font>

951
00:38:02,710 --> 00:38:07,390
use<font color="#E5E5E5"> of this demo here but if that was to</font>

952
00:38:04,900 --> 00:38:10,570
be<font color="#CCCCCC"> a external IP or external domain you</font>

953
00:38:07,390 --> 00:38:11,980
might have some interest<font color="#CCCCCC"> in that and so</font>

954
00:38:10,570 --> 00:38:13,420
we can see<font color="#E5E5E5"> here that because of our</font>

955
00:38:11,980 --> 00:38:16,990
analytic that<font color="#E5E5E5"> we</font><font color="#CCCCCC"> had from our hunt</font>

956
00:38:13,420 --> 00:38:19,180
before<font color="#E5E5E5"> we were</font><font color="#CCCCCC"> able to detect the launch</font>

957
00:38:16,990 --> 00:38:21,430
daemon right so we detected the<font color="#E5E5E5"> launch</font>

958
00:38:19,180 --> 00:38:24,460
daemon of<font color="#E5E5E5"> calm that</font><font color="#CCCCCC"> Apple about Network</font>

959
00:38:21,430 --> 00:38:28,359
update and so that's a win for<font color="#CCCCCC"> us right</font>

960
00:38:24,460 --> 00:38:29,920
so<font color="#CCCCCC"> right now we've definitely</font><font color="#E5E5E5"> kicked off</font>

961
00:38:28,360 --> 00:38:31,480
the<font color="#E5E5E5"> IR process that we know that</font>

962
00:38:29,920 --> 00:38:36,190
<font color="#E5E5E5">adversary is living within our</font>

963
00:38:31,480 --> 00:38:39,160
environment<font color="#E5E5E5"> and so another thing that</font><font color="#CCCCCC"> we</font>

964
00:38:36,190 --> 00:38:41,020
might be curious about well so here you

965
00:38:39,160 --> 00:38:42,819
see<font color="#CCCCCC"> that it's run at low run at low to</font>

966
00:38:41,020 --> 00:38:45,100
<font color="#CCCCCC">step two one</font><font color="#E5E5E5"> so it's going to persist on</font>

967
00:38:42,820 --> 00:38:46,690
<font color="#CCCCCC">his system and it's</font><font color="#E5E5E5"> gonna roll it's</font>

968
00:38:45,100 --> 00:38:52,330
gonna load when<font color="#E5E5E5"> ever the system reboots</font>

969
00:38:46,690 --> 00:38:55,510
or starts right and so one<font color="#CCCCCC"> thing that</font><font color="#E5E5E5"> we</font>

970
00:38:52,330 --> 00:38:58,569
might<font color="#E5E5E5"> be really interested in is well</font>

971
00:38:55,510 --> 00:39:00,160
how did they actually elevate their

972
00:38:58,570 --> 00:39:02,740
privileges<font color="#E5E5E5"> enabled to in order</font><font color="#CCCCCC"> to</font>

973
00:39:00,160 --> 00:39:04,810
<font color="#E5E5E5">install the</font><font color="#CCCCCC"> launch daemon right and so</font>

974
00:39:02,740 --> 00:39:08,109
with<font color="#E5E5E5"> that we could go in and we can see</font>

975
00:39:04,810 --> 00:39:09,369
how<font color="#CCCCCC"> many</font><font color="#E5E5E5"> times have sudo been listed as</font>

976
00:39:08,109 --> 00:39:12,910
like an argument<font color="#CCCCCC"> right</font><font color="#E5E5E5"> and in the</font>

977
00:39:09,369 --> 00:39:17,109
process execution<font color="#CCCCCC"> and</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> with</font><font color="#E5E5E5"> that</font>

978
00:39:12,910 --> 00:39:18,940
you'll see that here and so and help in

979
00:39:17,109 --> 00:39:21,220
<font color="#CCCCCC">Splunk this is easy like</font><font color="#E5E5E5"> you could do</font>

980
00:39:18,940 --> 00:39:23,590
like stats count by and like

981
00:39:21,220 --> 00:39:24,759
elasticsearch is a bit tougher so<font color="#CCCCCC"> i'm</font>

982
00:39:23,590 --> 00:39:27,010
going<font color="#CCCCCC"> through the</font><font color="#E5E5E5"> process of how to</font>

983
00:39:24,760 --> 00:39:29,619
actually do that<font color="#CCCCCC"> and so you see that</font>

984
00:39:27,010 --> 00:39:32,170
<font color="#CCCCCC">sudo was at least mentioned sixty five</font>

985
00:39:29,619 --> 00:39:34,900
times and<font color="#E5E5E5"> so we can filter</font><font color="#CCCCCC"> for that</font><font color="#E5E5E5"> and</font>

986
00:39:32,170 --> 00:39:37,450
then we<font color="#CCCCCC"> want to see well within su do</font>

987
00:39:34,900 --> 00:39:40,900
what arguments were passed at a command

988
00:39:37,450 --> 00:39:42,790
<font color="#E5E5E5">line when she</font><font color="#CCCCCC"> who was called</font><font color="#E5E5E5"> right and</font>

989
00:39:40,900 --> 00:39:44,830
so that<font color="#CCCCCC"> would be significant to</font><font color="#E5E5E5"> us we</font>

990
00:39:42,790 --> 00:39:47,380
want to got we want<font color="#CCCCCC"> to see like at what</font>

991
00:39:44,830 --> 00:39:50,859
<font color="#E5E5E5">point did was sudo used for malicious</font>

992
00:39:47,380 --> 00:39:53,890
activity and so we see<font color="#E5E5E5"> that bin shell</font>

993
00:39:50,859 --> 00:39:55,960
was used two times as opposed to like

994
00:39:53,890 --> 00:39:57,549
bash<font color="#E5E5E5"> right so that's significant</font><font color="#CCCCCC"> enough</font>

995
00:39:55,960 --> 00:40:00,670
<font color="#E5E5E5">we might be a little</font><font color="#CCCCCC"> bit interested in</font>

996
00:39:57,550 --> 00:40:02,380
<font color="#E5E5E5">that and so in instances where</font>

997
00:40:00,670 --> 00:40:04,180
the shell<font color="#E5E5E5"> was used well what</font>

998
00:40:02,380 --> 00:40:06,970
command-line arguments were present<font color="#E5E5E5"> and</font>

999
00:40:04,180 --> 00:40:08,890
so you see<font color="#E5E5E5"> pseudo and Python in the same</font>

1000
00:40:06,970 --> 00:40:12,189
line<font color="#E5E5E5"> right and so that's pretty</font>

1001
00:40:08,890 --> 00:40:14,350
suspicious<font color="#E5E5E5"> and so we want to look for</font>

1002
00:40:12,190 --> 00:40:18,100
instances where pseudo<font color="#CCCCCC"> and Python were</font>

1003
00:40:14,350 --> 00:40:20,440
used at the same time and so you get we

1004
00:40:18,100 --> 00:40:23,200
get four hits back but as you scroll

1005
00:40:20,440 --> 00:40:25,570
<font color="#E5E5E5">down you see evidence of</font><font color="#CCCCCC"> Apple</font><font color="#E5E5E5"> one two</font>

1006
00:40:23,200 --> 00:40:27,520
<font color="#E5E5E5">three and so at this point you're like</font>

1007
00:40:25,570 --> 00:40:29,590
<font color="#E5E5E5">okay we know how they elevated their</font>

1008
00:40:27,520 --> 00:40:32,109
privileges<font color="#E5E5E5"> we know that they</font><font color="#CCCCCC"> install the</font>

1009
00:40:29,590 --> 00:40:33,790
launch daemon<font color="#E5E5E5"> and we could probably tie</font>

1010
00:40:32,109 --> 00:40:38,230
it back to<font color="#E5E5E5"> the file</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> was downloaded</font>

1011
00:40:33,790 --> 00:40:40,359
to the system and so that's just<font color="#E5E5E5"> an</font>

1012
00:40:38,230 --> 00:40:48,220
example<font color="#E5E5E5"> of how</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> would do hunting for</font>

1013
00:40:40,359 --> 00:40:50,710
<font color="#E5E5E5">Mac OS</font><font color="#CCCCCC"> alright and so</font><font color="#E5E5E5"> some of the</font>

1014
00:40:48,220 --> 00:40:53,740
credits here<font color="#CCCCCC"> that are used for my talk</font>

1015
00:40:50,710 --> 00:40:55,270
is obviously Jonathan<font color="#E5E5E5"> Levin's security</font>

1016
00:40:53,740 --> 00:40:57,609
and<font color="#E5E5E5"> insecurity book if you don't have</font>

1017
00:40:55,270 --> 00:40:59,680
that book<font color="#CCCCCC"> volume three it goes into a</font>

1018
00:40:57,609 --> 00:41:01,509
lot of<font color="#E5E5E5"> the details</font><font color="#CCCCCC"> about Mac OS</font>

1019
00:40:59,680 --> 00:41:04,359
internals especially from the security

1020
00:41:01,510 --> 00:41:05,500
aspect it covers iOS as well<font color="#CCCCCC"> you might</font>

1021
00:41:04,359 --> 00:41:07,930
want to<font color="#E5E5E5"> pick up that</font><font color="#CCCCCC"> book and</font><font color="#E5E5E5"> then of</font>

1022
00:41:05,500 --> 00:41:09,790
course<font color="#CCCCCC"> objective-c I'll presented</font><font color="#E5E5E5"> I'll</font>

1023
00:41:07,930 --> 00:41:13,810
be<font color="#CCCCCC"> presenting this talk in a different</font>

1024
00:41:09,790 --> 00:41:16,090
<font color="#CCCCCC">iteration</font><font color="#E5E5E5"> at the objective by the C talk</font>

1025
00:41:13,810 --> 00:41:17,350
is in Hawaii<font color="#CCCCCC"> in November that's hosted</font>

1026
00:41:16,090 --> 00:41:19,060
by Patrick<font color="#E5E5E5"> Worrell if you're familiar</font>

1027
00:41:17,350 --> 00:41:22,299
with him he does a lot<font color="#E5E5E5"> of Mac OS</font>

1028
00:41:19,060 --> 00:41:24,609
research<font color="#E5E5E5"> I've also used stuff from the</font>

1029
00:41:22,300 --> 00:41:26,710
NS<font color="#CCCCCC"> gnome center as well</font><font color="#E5E5E5"> as Apple</font><font color="#CCCCCC"> and</font>

1030
00:41:24,609 --> 00:41:29,230
hacker news had an interesting<font color="#CCCCCC"> article</font>

1031
00:41:26,710 --> 00:41:32,440
about some of the macro malware that<font color="#E5E5E5"> was</font>

1032
00:41:29,230 --> 00:41:34,900
<font color="#CCCCCC">used</font><font color="#E5E5E5"> for this presentation and if you</font>

1033
00:41:32,440 --> 00:41:39,119
want to find me on<font color="#CCCCCC"> Twitter I'm</font><font color="#E5E5E5"> @rr</font><font color="#CCCCCC"> Cyrus</font>

1034
00:41:34,900 --> 00:41:39,119
<font color="#E5E5E5">and that's the end</font><font color="#CCCCCC"> of my talk Thanks</font>

1035
00:41:43,630 --> 00:42:00,470
I'll open<font color="#E5E5E5"> it up</font><font color="#CCCCCC"> to any questions are you</font>

1036
00:41:54,680 --> 00:42:03,770
<font color="#E5E5E5">can just</font><font color="#CCCCCC"> yell it out</font><font color="#E5E5E5"> so one thing that I</font>

1037
00:42:00,470 --> 00:42:05,899
didn't talk<font color="#CCCCCC"> about as</font><font color="#E5E5E5"> far as get so he</font>

1038
00:42:03,770 --> 00:42:08,120
<font color="#CCCCCC">asked what</font><font color="#E5E5E5"> would you recommend as far</font><font color="#CCCCCC"> as</font>

1039
00:42:05,900 --> 00:42:10,520
getting<font color="#E5E5E5"> logs off of an</font><font color="#CCCCCC"> endpoint</font><font color="#E5E5E5"> for Mac</font>

1040
00:42:08,120 --> 00:42:13,759
OS one thing that I didn't<font color="#E5E5E5"> mention that</font>

1041
00:42:10,520 --> 00:42:15,200
was used in<font color="#E5E5E5"> a demo is file</font><font color="#CCCCCC"> beep</font><font color="#E5E5E5"> so file</font>

1042
00:42:13,760 --> 00:42:17,840
beat was used to<font color="#CCCCCC"> actually ship those</font>

1043
00:42:15,200 --> 00:42:24,549
logs<font color="#E5E5E5"> from like</font><font color="#CCCCCC"> var log</font><font color="#E5E5E5"> OS query and var</font>

1044
00:42:17,840 --> 00:42:29,300
log X<font color="#CCCCCC"> Nouman to ingest into help</font><font color="#E5E5E5"> so yep</font>

1045
00:42:24,550 --> 00:42:33,440
<font color="#E5E5E5">another question back here the slides</font>

1046
00:42:29,300 --> 00:42:34,700
will be posted on my<font color="#CCCCCC"> blog and I'll put</font>

1047
00:42:33,440 --> 00:42:42,950
it out<font color="#E5E5E5"> on Twitter as well</font>

1048
00:42:34,700 --> 00:43:04,430
security Never Sleeps<font color="#E5E5E5"> dotnet yep any</font>

1049
00:42:42,950 --> 00:43:07,790
other questions yes

1050
00:43:04,430 --> 00:43:11,509
the<font color="#CCCCCC"> ex Newmont</font><font color="#E5E5E5"> tool right</font>

1051
00:43:07,790 --> 00:43:14,300
<font color="#E5E5E5">oh I'm repeating the question so</font><font color="#CCCCCC"> Devon</font>

1052
00:43:11,510 --> 00:43:16,700
asked about the the<font color="#E5E5E5"> network piece of it</font>

1053
00:43:14,300 --> 00:43:18,890
<font color="#E5E5E5">so if someone was to evade defenses and</font>

1054
00:43:16,700 --> 00:43:20,299
<font color="#E5E5E5">they were used</font><font color="#CCCCCC"> to use network right</font><font color="#E5E5E5"> how</font>

1055
00:43:18,890 --> 00:43:22,190
<font color="#CCCCCC">would you go about detecting that well</font>

1056
00:43:20,300 --> 00:43:24,050
<font color="#E5E5E5">there's no</font><font color="#CCCCCC"> open-source tools that do</font>

1057
00:43:22,190 --> 00:43:27,290
that<font color="#CCCCCC"> pretty</font><font color="#E5E5E5"> well today right</font><font color="#CCCCCC"> you have to</font>

1058
00:43:24,050 --> 00:43:29,660
use oddity for<font color="#CCCCCC"> Mac which is pretty like</font>

1059
00:43:27,290 --> 00:43:31,610
hard to use but it does give you<font color="#CCCCCC"> Network</font>

1060
00:43:29,660 --> 00:43:35,330
information about processes that make

1061
00:43:31,610 --> 00:43:37,450
network connections<font color="#CCCCCC"> ex Newman the guy</font>

1062
00:43:35,330 --> 00:43:40,790
Daniel Roethlisberger is planning to<font color="#E5E5E5"> add</font>

1063
00:43:37,450 --> 00:43:43,370
like<font color="#E5E5E5"> network use of I mean process use</font>

1064
00:43:40,790 --> 00:43:45,620
of network<font color="#CCCCCC"> activity</font><font color="#E5E5E5"> and future</font>

1065
00:43:43,370 --> 00:43:47,089
iterations of<font color="#E5E5E5"> that that tool so that's</font>

1066
00:43:45,620 --> 00:43:50,740
<font color="#E5E5E5">one way you detective but outside of</font>

1067
00:43:47,090 --> 00:43:50,740
that<font color="#CCCCCC"> you would use something like</font><font color="#E5E5E5"> oddity</font>

1068
00:44:04,660 --> 00:44:09,680
yeah I've seen<font color="#CCCCCC"> Java</font><font color="#E5E5E5"> rat being used</font>

1069
00:44:07,250 --> 00:44:12,560
pretty heavily in<font color="#CCCCCC"> in a while so the</font>

1070
00:44:09,680 --> 00:44:14,839
question was<font color="#E5E5E5"> have</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> seen like adwin like</font>

1071
00:44:12,560 --> 00:44:17,740
<font color="#CCCCCC">Java</font><font color="#E5E5E5"> rats being used in the wall that's</font>

1072
00:44:14,840 --> 00:44:20,690
pretty prevalent<font color="#E5E5E5"> on Mac OS systems and</font>

1073
00:44:17,740 --> 00:44:23,600
most people don't have<font color="#E5E5E5"> Java</font><font color="#CCCCCC"> installed on</font>

1074
00:44:20,690 --> 00:44:25,070
their Mac anyway<font color="#E5E5E5"> so if you do then you</font>

1075
00:44:23,600 --> 00:44:26,660
would target<font color="#E5E5E5"> those</font><font color="#CCCCCC"> users and you would</font>

1076
00:44:25,070 --> 00:44:29,240
<font color="#E5E5E5">start</font><font color="#CCCCCC"> to baseline some of that Java</font>

1077
00:44:26,660 --> 00:44:31,069
activity especially network<font color="#E5E5E5"> connections</font>

1078
00:44:29,240 --> 00:44:33,140
going<font color="#CCCCCC"> out you so you would tie in the</font>

1079
00:44:31,070 --> 00:44:36,650
<font color="#E5E5E5">endpoint data with your network data to</font>

1080
00:44:33,140 --> 00:44:38,799
make that correlation<font color="#E5E5E5"> I'll take two more</font>

1081
00:44:36,650 --> 00:44:38,800
questions

1082
00:44:55,369 --> 00:45:02,280
so for<font color="#CCCCCC"> Mac</font><font color="#E5E5E5"> that doesn't exist yet but</font>

1083
00:44:59,480 --> 00:45:04,260
<font color="#E5E5E5">there's been there's</font><font color="#CCCCCC"> been a lot of</font>

1084
00:45:02,280 --> 00:45:07,280
discussion about<font color="#CCCCCC"> that same thing where</font>

1085
00:45:04,260 --> 00:45:10,859
tools are start<font color="#E5E5E5"> to display you know the</font>

1086
00:45:07,280 --> 00:45:12,810
technique ID<font color="#E5E5E5"> that that that they</font>

1087
00:45:10,859 --> 00:45:16,140
correspond to right<font color="#E5E5E5"> like a specific</font>

1088
00:45:12,810 --> 00:45:17,400
technique<font color="#E5E5E5"> right so</font><font color="#CCCCCC"> something</font><font color="#E5E5E5"> someone</font>

1089
00:45:16,140 --> 00:45:19,410
will<font color="#E5E5E5"> like oh it's</font><font color="#CCCCCC"> crazy to say hey we</font>

1090
00:45:17,400 --> 00:45:20,760
covered these technique IDs right that

1091
00:45:19,410 --> 00:45:32,970
might be<font color="#CCCCCC"> something that</font><font color="#E5E5E5"> comes along like</font>

1092
00:45:20,760 --> 00:45:36,780
down in<font color="#CCCCCC"> the pipeline so so the</font><font color="#E5E5E5"> question</font>

1093
00:45:32,970 --> 00:45:38,490
was what tools do you<font color="#E5E5E5"> suggest for kind</font>

1094
00:45:36,780 --> 00:45:41,369
of managing your<font color="#E5E5E5"> always</font><font color="#CCCCCC"> for instance</font>

1095
00:45:38,490 --> 00:45:44,250
things of that sort<font color="#E5E5E5"> and so with that I</font>

1096
00:45:41,369 --> 00:45:46,800
<font color="#E5E5E5">would consider collide which is a parent</font>

1097
00:45:44,250 --> 00:45:51,150
<font color="#E5E5E5">company</font><font color="#CCCCCC"> of like OS query and so would</font>

1098
00:45:46,800 --> 00:45:53,670
collide<font color="#E5E5E5"> you're able to basically run a</font>

1099
00:45:51,150 --> 00:45:55,230
take a query<font color="#CCCCCC"> and select</font><font color="#E5E5E5"> what host you</font>

1100
00:45:53,670 --> 00:45:57,780
want to run that query against and you

1101
00:45:55,230 --> 00:45:59,700
<font color="#CCCCCC">could do a lot</font><font color="#E5E5E5"> of the configuration at</font>

1102
00:45:57,780 --> 00:46:01,619
that like<font color="#CCCCCC"> central management</font><font color="#E5E5E5"> terminal</font>

1103
00:45:59,700 --> 00:46:04,950
for collide so that's one tool that<font color="#CCCCCC"> I</font>

1104
00:46:01,619 --> 00:46:05,070
would<font color="#CCCCCC"> recommend strongly alright thank</font>

1105
00:46:04,950 --> 00:46:06,140
you

1106
00:46:05,070 --> 00:46:11,719
[Music]

1107
00:46:06,140 --> 00:46:11,719
[Applause]

