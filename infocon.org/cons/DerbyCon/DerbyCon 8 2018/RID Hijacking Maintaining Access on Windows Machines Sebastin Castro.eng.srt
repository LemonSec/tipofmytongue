1
00:00:00,030 --> 00:00:07,740
ready<font color="#E5E5E5"> okay so hello</font><font color="#CCCCCC"> I am supposin Castro</font>

2
00:00:05,940 --> 00:00:09,240
and today<font color="#CCCCCC"> I am going to share with</font><font color="#E5E5E5"> you</font>

3
00:00:07,740 --> 00:00:11,490
our<font color="#CCCCCC"> research I have made a</font><font color="#E5E5E5"> Windows</font>

4
00:00:09,240 --> 00:00:13,650
persistence<font color="#CCCCCC"> I have never read already</font>

5
00:00:11,490 --> 00:00:16,440
<font color="#E5E5E5">hijacking maintaining access on Windows</font>

6
00:00:13,650 --> 00:00:18,359
machines<font color="#CCCCCC"> it's my first</font><font color="#E5E5E5"> time there</font><font color="#CCCCCC"> become</font>

7
00:00:16,440 --> 00:00:24,630
here<font color="#E5E5E5"> so I am quite excited</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> be here</font>

8
00:00:18,359 --> 00:00:27,869
<font color="#E5E5E5">thank you I hope</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> all enjoy this so</font>

9
00:00:24,630 --> 00:00:30,150
it's<font color="#E5E5E5"> about me</font><font color="#CCCCCC"> I am an info SEC nerd</font>

10
00:00:27,869 --> 00:00:31,800
I<font color="#E5E5E5"> like this ploy development I am a</font>

11
00:00:30,150 --> 00:00:34,620
<font color="#E5E5E5">Windows security enthusiast</font><font color="#CCCCCC"> not an</font>

12
00:00:31,800 --> 00:00:37,020
expert in fact my<font color="#E5E5E5"> first goal was 25</font>

13
00:00:34,620 --> 00:00:40,680
years<font color="#E5E5E5"> ago and I</font><font color="#CCCCCC"> am a Microsoft paint</font>

14
00:00:37,020 --> 00:00:42,510
artist<font color="#CCCCCC"> as you can see here</font><font color="#E5E5E5"> I am the</font>

15
00:00:40,680 --> 00:00:44,280
<font color="#E5E5E5">current technical research lead at CSL</font>

16
00:00:42,510 --> 00:00:46,010
apps<font color="#E5E5E5"> that it's a company</font><font color="#CCCCCC"> that work</font>

17
00:00:44,280 --> 00:00:48,899
<font color="#E5E5E5">mainly providing ethical hacking</font>

18
00:00:46,010 --> 00:00:51,269
services to organization working<font color="#CCCCCC"> on the</font>

19
00:00:48,899 --> 00:00:53,730
financial<font color="#E5E5E5"> sector I have been working on</font>

20
00:00:51,270 --> 00:00:56,629
the field as a red<font color="#E5E5E5"> teamer</font><font color="#CCCCCC"> mainly been a</font>

21
00:00:53,730 --> 00:00:59,059
<font color="#CCCCCC">span and</font><font color="#E5E5E5"> pastor and researcher for above</font>

22
00:00:56,629 --> 00:01:02,070
<font color="#CCCCCC">6 years</font>

23
00:00:59,059 --> 00:01:04,530
<font color="#E5E5E5">ok this will be their quick agenda</font><font color="#CCCCCC"> of</font>

24
00:01:02,070 --> 00:01:07,650
the talk I'll first expose the attack

25
00:01:04,530 --> 00:01:08,939
<font color="#E5E5E5">and how it looks like I will</font><font color="#CCCCCC"> be</font><font color="#E5E5E5"> expose</font>

26
00:01:07,650 --> 00:01:12,210
<font color="#E5E5E5">the</font><font color="#CCCCCC"> windows</font><font color="#E5E5E5"> security architecture</font>

27
00:01:08,939 --> 00:01:14,070
related to the<font color="#E5E5E5"> login process</font><font color="#CCCCCC"> and here in</font>

28
00:01:12,210 --> 00:01:15,899
the hijacking<font color="#CCCCCC"> they</font><font color="#E5E5E5"> are</font><font color="#CCCCCC"> ID I</font><font color="#E5E5E5"> will point</font>

29
00:01:14,070 --> 00:01:17,548
out where exactly<font color="#CCCCCC"> are the</font><font color="#E5E5E5"> security</font>

30
00:01:15,900 --> 00:01:19,950
<font color="#E5E5E5">issues that make this attack possible</font>

31
00:01:17,549 --> 00:01:21,509
and<font color="#E5E5E5"> after that a live demonstration of</font>

32
00:01:19,950 --> 00:01:23,430
<font color="#E5E5E5">attacking against a Windows 10 machine I</font>

33
00:01:21,509 --> 00:01:27,360
have related<font color="#E5E5E5"> this morning I hope you</font>

34
00:01:23,430 --> 00:01:28,680
will<font color="#E5E5E5"> work and some</font><font color="#CCCCCC"> funny</font><font color="#E5E5E5"> conclusions so</font>

35
00:01:27,360 --> 00:01:31,409
let's meet up they already hit you can

36
00:01:28,680 --> 00:01:33,000
<font color="#E5E5E5">attack so what is this this is a new</font>

37
00:01:31,409 --> 00:01:35,520
post exploitation vector which<font color="#CCCCCC"> is</font>

38
00:01:33,000 --> 00:01:38,220
reliable<font color="#CCCCCC"> on all windows always</font><font color="#E5E5E5"> version</font>

39
00:01:35,520 --> 00:01:41,520
since<font color="#E5E5E5"> NT I have tested it from XP to</font>

40
00:01:38,220 --> 00:01:45,270
<font color="#CCCCCC">Windows</font><font color="#E5E5E5"> 10 and Windows Server 2003 to</font>

41
00:01:41,520 --> 00:01:47,699
2012<font color="#CCCCCC"> it creates in stealthy access on</font>

42
00:01:45,270 --> 00:01:49,920
the target<font color="#E5E5E5"> all by using only OS</font>

43
00:01:47,700 --> 00:01:53,460
resources meaning<font color="#E5E5E5"> that no noise</font><font color="#CCCCCC"> reactor</font>

44
00:01:49,920 --> 00:01:55,259
files are needed to take<font color="#E5E5E5"> advantage take</font>

45
00:01:53,460 --> 00:01:57,509
<font color="#E5E5E5">advantage of</font><font color="#CCCCCC"> the security some integrity</font>

46
00:01:55,259 --> 00:01:59,820
issues that I have found<font color="#E5E5E5"> that are</font>

47
00:01:57,509 --> 00:02:01,619
exploitable with this attack<font color="#E5E5E5"> it is</font>

48
00:01:59,820 --> 00:02:03,898
converted reliable on<font color="#CCCCCC"> domain joint</font>

49
00:02:01,619 --> 00:02:05,969
machines but not<font color="#E5E5E5"> owning controllers yet</font>

50
00:02:03,899 --> 00:02:09,199
I am working<font color="#E5E5E5"> on</font><font color="#CCCCCC"> a similar attack that</font>

51
00:02:05,969 --> 00:02:12,359
can<font color="#E5E5E5"> be reliable on domain controllers</font>

52
00:02:09,199 --> 00:02:13,640
<font color="#CCCCCC">ensured this attack</font><font color="#E5E5E5"> modifies their idea</font>

53
00:02:12,360 --> 00:02:16,520
of an existing account

54
00:02:13,640 --> 00:02:18,619
sets it<font color="#E5E5E5"> up to another one</font><font color="#CCCCCC"> Jose they are</font>

55
00:02:16,520 --> 00:02:20,990
ID<font color="#CCCCCC"> meaning</font><font color="#E5E5E5"> that all the other account</font>

56
00:02:18,620 --> 00:02:23,660
properties as<font color="#E5E5E5"> you see it with the user</font>

57
00:02:20,990 --> 00:02:25,880
such as buzzer<font color="#CCCCCC"> Hajj account estate you</font>

58
00:02:23,660 --> 00:02:28,730
<font color="#E5E5E5">sub cetera keep consistent before and</font>

59
00:02:25,880 --> 00:02:30,500
after the attack by hijacking<font color="#CCCCCC"> the</font>

60
00:02:28,730 --> 00:02:32,660
<font color="#E5E5E5">already at the exact moment the</font>

61
00:02:30,500 --> 00:02:36,650
privileges will be spoofed<font color="#CCCCCC"> and one cool</font>

62
00:02:32,660 --> 00:02:38,870
<font color="#CCCCCC">thing is that no matter</font><font color="#E5E5E5"> what they hijack</font>

63
00:02:36,650 --> 00:02:41,390
the county<font color="#CCCCCC"> statistics is active for now</font>

64
00:02:38,870 --> 00:02:44,630
the hijacker account will retrieve its

65
00:02:41,390 --> 00:02:46,399
privileges<font color="#CCCCCC"> Essam so remember that</font><font color="#E5E5E5"> only</font>

66
00:02:44,630 --> 00:02:48,380
<font color="#E5E5E5">the relative identifier is modified so</font>

67
00:02:46,400 --> 00:02:50,480
<font color="#E5E5E5">an attacker could log on with an ax</font>

68
00:02:48,380 --> 00:02:52,670
specific set of revenge<font color="#CCCCCC"> else he already</font>

69
00:02:50,480 --> 00:02:54,980
owns<font color="#E5E5E5"> and get</font><font color="#CCCCCC"> access as another user</font>

70
00:02:52,670 --> 00:02:57,350
<font color="#E5E5E5">depending</font><font color="#CCCCCC"> on configuration it would be</font>

71
00:02:54,980 --> 00:03:02,149
<font color="#E5E5E5">possible</font><font color="#CCCCCC"> for him to access</font><font color="#E5E5E5"> remotely via</font>

72
00:02:57,350 --> 00:03:03,769
<font color="#E5E5E5">RDP</font><font color="#CCCCCC"> bsx second so on</font><font color="#E5E5E5"> and besides the</font>

73
00:03:02,150 --> 00:03:05,840
privileges is still in the system<font color="#E5E5E5"> will</font>

74
00:03:03,770 --> 00:03:07,970
register any operation which has<font color="#E5E5E5"> taken</font>

75
00:03:05,840 --> 00:03:10,880
<font color="#E5E5E5">place</font><font color="#CCCCCC"> during the hijacker session as</font>

76
00:03:07,970 --> 00:03:12,350
done by<font color="#CCCCCC"> this poofed account</font><font color="#E5E5E5"> and of</font>

77
00:03:10,880 --> 00:03:15,950
course this<font color="#E5E5E5"> technique is reboot</font>

78
00:03:12,350 --> 00:03:19,519
persistent so this is how it looks<font color="#E5E5E5"> like</font>

79
00:03:15,950 --> 00:03:21,798
in this image we<font color="#CCCCCC"> are running a CMD as</font>

80
00:03:19,519 --> 00:03:24,820
the guest<font color="#E5E5E5"> built-in account we can see</font>

81
00:03:21,799 --> 00:03:27,320
but see in the<font color="#E5E5E5"> output of the Who am I</font>

82
00:03:24,820 --> 00:03:30,500
<font color="#E5E5E5">command we are still members of the</font>

83
00:03:27,320 --> 00:03:32,329
guest local group but we have widen

84
00:03:30,500 --> 00:03:35,630
permissions over the<font color="#CCCCCC"> system32 folder</font>

85
00:03:32,330 --> 00:03:37,370
which<font color="#CCCCCC"> is pretty cool why</font><font color="#E5E5E5"> I</font><font color="#CCCCCC"> think so</font>

86
00:03:35,630 --> 00:03:39,200
understand the<font color="#E5E5E5"> magic behind this</font><font color="#CCCCCC"> I will</font>

87
00:03:37,370 --> 00:03:42,170
briefly<font color="#CCCCCC"> explain</font><font color="#E5E5E5"> how</font><font color="#CCCCCC"> the windows</font><font color="#E5E5E5"> logon</font>

88
00:03:39,200 --> 00:03:45,619
process works<font color="#E5E5E5"> the thing</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> that I am</font><font color="#CCCCCC"> NOT</font>

89
00:03:42,170 --> 00:03:46,280
<font color="#E5E5E5">that really good at prayer but well I'm</font>

90
00:03:45,620 --> 00:03:47,989
terrible

91
00:03:46,280 --> 00:03:49,970
well I think<font color="#E5E5E5"> that</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> windows</font>

92
00:03:47,989 --> 00:03:51,980
architecture is pretty similar<font color="#E5E5E5"> to the</font>

93
00:03:49,970 --> 00:03:54,170
security concepts of some buildings I

94
00:03:51,980 --> 00:03:56,230
have been on so you<font color="#E5E5E5"> introduce yourself</font>

95
00:03:54,170 --> 00:03:59,119
in front<font color="#E5E5E5"> of the guy who is in charge</font>

96
00:03:56,230 --> 00:04:01,220
<font color="#E5E5E5">then he verifies you if you are</font>

97
00:03:59,120 --> 00:04:03,110
registered in<font color="#E5E5E5"> their database</font><font color="#CCCCCC"> and we you</font>

98
00:04:01,220 --> 00:04:05,239
are then he provides you an<font color="#E5E5E5"> access card</font>

99
00:04:03,110 --> 00:04:08,090
<font color="#E5E5E5">which permits you to get into the sounds</font>

100
00:04:05,239 --> 00:04:10,010
<font color="#E5E5E5">you are allowed to so let's assume that</font>

101
00:04:08,090 --> 00:04:11,360
<font color="#CCCCCC">they this green guy will be</font><font color="#E5E5E5"> the</font>

102
00:04:10,010 --> 00:04:14,870
<font color="#CCCCCC">representation of the</font><font color="#E5E5E5"> ministry or</font>

103
00:04:11,360 --> 00:04:16,160
<font color="#E5E5E5">building account this red girl will will</font>

104
00:04:14,870 --> 00:04:18,140
<font color="#CCCCCC">be our</font><font color="#E5E5E5"> main character</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> will</font>

105
00:04:16,160 --> 00:04:20,540
represent an unprivileged account for

106
00:04:18,140 --> 00:04:23,320
example<font color="#CCCCCC"> the guest</font><font color="#E5E5E5"> account and the butler</font>

107
00:04:20,540 --> 00:04:25,539
will represent the<font color="#E5E5E5"> windows security and</font>

108
00:04:23,320 --> 00:04:27,260
this<font color="#CCCCCC"> awfully build in the Windows OS</font>

109
00:04:25,539 --> 00:04:29,030
imagined are in image

110
00:04:27,260 --> 00:04:30,980
that inside of<font color="#CCCCCC"> this building there is</font><font color="#E5E5E5"> an</font>

111
00:04:29,030 --> 00:04:32,900
RFID<font color="#E5E5E5"> a</font><font color="#CCCCCC"> light control system which is</font>

112
00:04:30,980 --> 00:04:35,870
based on<font color="#CCCCCC"> the</font><font color="#E5E5E5"> access card the blue guide</font>

113
00:04:32,900 --> 00:04:37,400
<font color="#E5E5E5">provide us to keep it simple I</font><font color="#CCCCCC"> have to</font>

114
00:04:35,870 --> 00:04:39,740
run three floors I know there are a lot

115
00:04:37,400 --> 00:04:42,289
<font color="#CCCCCC">of</font><font color="#E5E5E5"> more privileges but</font><font color="#CCCCCC"> that it's really</font>

116
00:04:39,740 --> 00:04:44,240
hard to draw em all<font color="#E5E5E5"> and depending on</font>

117
00:04:42,290 --> 00:04:47,750
configuration of the access card<font color="#E5E5E5"> user</font>

118
00:04:44,240 --> 00:04:50,810
users shall enter inside<font color="#E5E5E5"> instead some</font>

119
00:04:47,750 --> 00:04:52,070
specific floors so this is the<font color="#CCCCCC"> windows</font>

120
00:04:50,810 --> 00:04:53,540
<font color="#CCCCCC">security architecture in a more</font>

121
00:04:52,070 --> 00:04:55,400
technical way<font color="#E5E5E5"> related</font><font color="#CCCCCC"> to the logon</font>

122
00:04:53,540 --> 00:04:57,730
process but as you can<font color="#E5E5E5"> see</font><font color="#CCCCCC"> we are</font>

123
00:04:55,400 --> 00:04:59,870
ignoring<font color="#E5E5E5"> the models related to the ad</font>

124
00:04:57,730 --> 00:05:02,840
authentication<font color="#E5E5E5"> that's because the our ID</font>

125
00:04:59,870 --> 00:05:05,300
hijacking is focused<font color="#CCCCCC"> takes</font><font color="#E5E5E5"> advantage of</font>

126
00:05:02,840 --> 00:05:07,310
the<font color="#E5E5E5"> way that</font><font color="#CCCCCC"> windows handles the local</font>

127
00:05:05,300 --> 00:05:09,590
users local login process<font color="#CCCCCC"> so we are</font>

128
00:05:07,310 --> 00:05:14,090
going<font color="#E5E5E5"> to</font><font color="#CCCCCC"> be focused on the</font><font color="#E5E5E5"> LSA as as the</font>

129
00:05:09,590 --> 00:05:16,039
MSB<font color="#E5E5E5"> 100</font><font color="#CCCCCC"> DLL</font><font color="#E5E5E5"> and the some server deal in</font>

130
00:05:14,090 --> 00:05:17,840
a nutshell the logon task is like this

131
00:05:16,040 --> 00:05:19,610
<font color="#E5E5E5">I'm</font><font color="#CCCCCC"> sure many of you have seen this</font>

132
00:05:17,840 --> 00:05:21,919
before<font color="#E5E5E5"> so when a new is</font><font color="#CCCCCC"> worth in</font><font color="#E5E5E5"> the</font>

133
00:05:19,610 --> 00:05:24,680
case through<font color="#CCCCCC"> window</font><font color="#E5E5E5"> go on LS a SSB</font>

134
00:05:21,920 --> 00:05:26,740
<font color="#CCCCCC">verify it's Residential's</font><font color="#E5E5E5"> and creates an</font>

135
00:05:24,680 --> 00:05:33,650
access token to identify<font color="#E5E5E5"> see security</font>

136
00:05:26,740 --> 00:05:35,420
<font color="#E5E5E5">context against the to defend a security</font>

137
00:05:33,650 --> 00:05:37,909
context and after that<font color="#E5E5E5"> after creating</font>

138
00:05:35,420 --> 00:05:39,890
the access token<font color="#CCCCCC"> it will verify these</font>

139
00:05:37,910 --> 00:05:42,170
access token against the objects the

140
00:05:39,890 --> 00:05:46,669
user is trying to access by using<font color="#E5E5E5"> their</font>

141
00:05:42,170 --> 00:05:49,190
<font color="#E5E5E5">own access control lists</font><font color="#CCCCCC"> ok here is the</font>

142
00:05:46,670 --> 00:05:51,170
<font color="#E5E5E5">structure</font><font color="#CCCCCC"> of the SE</font><font color="#E5E5E5"> identifier that is</font>

143
00:05:49,190 --> 00:05:53,000
<font color="#E5E5E5">that is the way that Windows</font><font color="#CCCCCC"> has to</font>

144
00:05:51,170 --> 00:05:55,100
define<font color="#E5E5E5"> other way that</font><font color="#CCCCCC"> Windows had to</font>

145
00:05:53,000 --> 00:05:57,620
identify security<font color="#CCCCCC"> principles so such</font><font color="#E5E5E5"> the</font>

146
00:05:55,100 --> 00:05:59,420
<font color="#E5E5E5">users groups or computers the first</font><font color="#CCCCCC"> part</font>

147
00:05:57,620 --> 00:06:01,550
in yellow<font color="#CCCCCC"> we</font><font color="#E5E5E5"> can see here that is it's</font>

148
00:05:59,420 --> 00:06:04,070
the one which differentiates<font color="#E5E5E5"> off the</font>

149
00:06:01,550 --> 00:06:08,300
machine<font color="#CCCCCC"> our own domain among others but</font>

150
00:06:04,070 --> 00:06:10,159
<font color="#E5E5E5">the last one</font><font color="#CCCCCC"> the relative identifier can</font>

151
00:06:08,300 --> 00:06:11,630
be the same across all machines for

152
00:06:10,160 --> 00:06:14,180
example<font color="#CCCCCC"> in every</font><font color="#E5E5E5"> Windows machine as you</font>

153
00:06:11,630 --> 00:06:16,400
may know the 500 relative<font color="#E5E5E5"> identifier is</font>

154
00:06:14,180 --> 00:06:19,400
associated with<font color="#E5E5E5"> the administrator</font>

155
00:06:16,400 --> 00:06:22,120
built-in account so keep in<font color="#CCCCCC"> mind</font><font color="#E5E5E5"> that</font>

156
00:06:19,400 --> 00:06:25,900
every user account<font color="#E5E5E5"> local user account</font>

157
00:06:22,120 --> 00:06:28,310
<font color="#CCCCCC">built in or not had</font><font color="#E5E5E5"> has its own already</font>

158
00:06:25,900 --> 00:06:30,049
<font color="#E5E5E5">so let's suppose</font><font color="#CCCCCC"> that the administrator</font>

159
00:06:28,310 --> 00:06:33,170
wants<font color="#E5E5E5"> to log on so he provides its</font>

160
00:06:30,050 --> 00:06:34,970
username and password to<font color="#E5E5E5"> win log on to</font>

161
00:06:33,170 --> 00:06:36,770
do<font color="#E5E5E5"> that</font><font color="#CCCCCC"> Windows need</font><font color="#E5E5E5"> to initialize some</font>

162
00:06:34,970 --> 00:06:40,100
<font color="#E5E5E5">test and connection between processes</font>

163
00:06:36,770 --> 00:06:40,940
right after window go on<font color="#E5E5E5"> Co slogan UI to</font>

164
00:06:40,100 --> 00:06:42,950
grab the crane

165
00:06:40,940 --> 00:06:44,719
by using credential providers and with

166
00:06:42,950 --> 00:06:47,990
this information<font color="#E5E5E5"> we</font><font color="#CCCCCC"> level we create and</font>

167
00:06:44,720 --> 00:06:50,450
unique<font color="#E5E5E5"> Logan s ID to identify this</font><font color="#CCCCCC"> logon</font>

168
00:06:47,990 --> 00:06:52,040
attempt and now<font color="#E5E5E5"> window</font><font color="#CCCCCC"> retrieve the</font>

169
00:06:50,450 --> 00:06:54,550
handle for an authentication package

170
00:06:52,040 --> 00:06:58,100
which has which are used<font color="#E5E5E5"> to identify</font>

171
00:06:54,550 --> 00:06:59,690
sorry the authentication policies of a

172
00:06:58,100 --> 00:07:02,210
logon attempt remember that we are

173
00:06:59,690 --> 00:07:05,090
focusing on the MSB one DLL of<font color="#E5E5E5"> unleased</font>

174
00:07:02,210 --> 00:07:06,560
<font color="#E5E5E5">an elephant</font><font color="#CCCCCC"> ocation package so we Logan</font>

175
00:07:05,090 --> 00:07:07,849
<font color="#E5E5E5">sends</font><font color="#CCCCCC"> the authenticate to</font><font color="#E5E5E5"> the whole</font>

176
00:07:06,560 --> 00:07:10,520
intent<font color="#E5E5E5"> occasion package the username</font>

177
00:07:07,850 --> 00:07:14,510
password combination we created logon

178
00:07:10,520 --> 00:07:16,580
<font color="#CCCCCC">sed and then this critical step the MSB</font>

179
00:07:14,510 --> 00:07:18,800
one<font color="#CCCCCC"> sends the user</font><font color="#E5E5E5"> password combination</font>

180
00:07:16,580 --> 00:07:21,200
to the Sam server which retrieves the

181
00:07:18,800 --> 00:07:23,420
related security<font color="#CCCCCC"> information including</font>

182
00:07:21,200 --> 00:07:26,330
the security the user community identity

183
00:07:23,420 --> 00:07:28,880
<font color="#E5E5E5">and now</font><font color="#CCCCCC"> - submitter</font><font color="#E5E5E5"> up</font><font color="#CCCCCC"> there as we want</font>

184
00:07:26,330 --> 00:07:30,919
to checks the information retrieved<font color="#E5E5E5"> if</font>

185
00:07:28,880 --> 00:07:32,570
it is occasionally<font color="#E5E5E5"> generates another</font>

186
00:07:30,920 --> 00:07:34,640
<font color="#E5E5E5">identifier</font><font color="#CCCCCC"> called Lu it</font><font color="#E5E5E5"> for the current</font>

187
00:07:32,570 --> 00:07:37,190
<font color="#CCCCCC">session and sends back to other</font>

188
00:07:34,640 --> 00:07:39,680
information<font color="#CCCCCC"> to the LSAs s including this</font>

189
00:07:37,190 --> 00:07:41,510
<font color="#CCCCCC">new identifier</font><font color="#E5E5E5"> all these data will</font><font color="#CCCCCC"> be</font>

190
00:07:39,680 --> 00:07:44,210
used by<font color="#CCCCCC"> the</font><font color="#E5E5E5"> security reference monitor</font>

191
00:07:41,510 --> 00:07:46,849
<font color="#E5E5E5">to define the security context of the</font>

192
00:07:44,210 --> 00:07:49,130
user<font color="#E5E5E5"> so we'll see that</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> shirt now that</font>

193
00:07:46,850 --> 00:07:51,290
everything<font color="#E5E5E5"> is</font><font color="#CCCCCC"> ok the city</font><font color="#E5E5E5"> subsystem</font>

194
00:07:49,130 --> 00:07:54,530
proceeds to create the access token<font color="#CCCCCC"> for</font>

195
00:07:51,290 --> 00:07:56,150
the recently authenticated user so the

196
00:07:54,530 --> 00:07:58,340
access token<font color="#CCCCCC"> is used</font><font color="#E5E5E5"> to define the</font>

197
00:07:56,150 --> 00:08:00,140
security context of a process<font color="#CCCCCC"> this</font>

198
00:07:58,340 --> 00:08:02,500
<font color="#E5E5E5">subject is created by the security</font>

199
00:08:00,140 --> 00:08:05,090
reference monitor for every<font color="#E5E5E5"> user session</font>

200
00:08:02,500 --> 00:08:07,430
it's important<font color="#E5E5E5"> to know that</font><font color="#CCCCCC"> every child</font>

201
00:08:05,090 --> 00:08:09,380
process in heretical attacking copy of

202
00:08:07,430 --> 00:08:11,510
their creators<font color="#CCCCCC"> 1 meaning that</font><font color="#E5E5E5"> every</font>

203
00:08:09,380 --> 00:08:15,409
process<font color="#CCCCCC"> within a user session will be</font>

204
00:08:11,510 --> 00:08:17,090
executed with<font color="#CCCCCC"> the same access token so</font>

205
00:08:15,410 --> 00:08:19,419
continuing with<font color="#E5E5E5"> the authorization task</font>

206
00:08:17,090 --> 00:08:23,060
<font color="#CCCCCC">LS a SS receives the</font><font color="#E5E5E5"> logon information</font>

207
00:08:19,419 --> 00:08:25,280
from MSB<font color="#CCCCCC"> 1o and checks up its sound</font>

208
00:08:23,060 --> 00:08:27,919
database to<font color="#CCCCCC"> determine the users allowed</font>

209
00:08:25,280 --> 00:08:31,159
access this check is done<font color="#E5E5E5"> by using the</font>

210
00:08:27,919 --> 00:08:33,890
<font color="#E5E5E5">security identifier of</font><font color="#CCCCCC"> the user right</font>

211
00:08:31,160 --> 00:08:36,050
after<font color="#CCCCCC"> LS a SS adds to the initial access</font>

212
00:08:33,890 --> 00:08:38,059
track and<font color="#E5E5E5"> the related groups as Hades</font>

213
00:08:36,049 --> 00:08:40,968
and privileges which<font color="#CCCCCC"> are associated with</font>

214
00:08:38,059 --> 00:08:42,829
this<font color="#E5E5E5"> user</font><font color="#CCCCCC"> and finally the primary</font><font color="#E5E5E5"> access</font>

215
00:08:40,969 --> 00:08:44,630
token<font color="#E5E5E5"> is created later will no one will</font>

216
00:08:42,830 --> 00:08:46,460
call usually<font color="#CCCCCC"> needs and stuff to</font>

217
00:08:44,630 --> 00:08:47,270
initialize everything<font color="#CCCCCC"> women are</font>

218
00:08:46,460 --> 00:08:49,730
concerned<font color="#E5E5E5"> about it</font>

219
00:08:47,270 --> 00:08:51,350
then<font color="#E5E5E5"> Alice a SS provides the access</font>

220
00:08:49,730 --> 00:08:52,820
token<font color="#CCCCCC"> to the user session</font><font color="#E5E5E5"> allowing him</font>

221
00:08:51,350 --> 00:08:54,500
to<font color="#CCCCCC"> acess now he can get into</font><font color="#E5E5E5"> the VIP</font>

222
00:08:52,820 --> 00:08:59,540
zone<font color="#CCCCCC"> ok</font>

223
00:08:54,500 --> 00:09:02,420
yeah cool<font color="#E5E5E5"> so now</font><font color="#CCCCCC"> that we went through</font>

224
00:08:59,540 --> 00:09:04,250
<font color="#E5E5E5">the windows standard</font><font color="#CCCCCC"> Logan process let's</font>

225
00:09:02,420 --> 00:09:06,140
take a look at the thing<font color="#CCCCCC"> we're</font>

226
00:09:04,250 --> 00:09:09,170
<font color="#CCCCCC">interested in we're in the</font><font color="#E5E5E5"> process or</font>

227
00:09:06,140 --> 00:09:11,840
something<font color="#CCCCCC"> is</font><font color="#E5E5E5"> playable</font><font color="#CCCCCC"> so how is the user</font>

228
00:09:09,170 --> 00:09:14,630
identified<font color="#E5E5E5"> by the system after being</font>

229
00:09:11,840 --> 00:09:17,510
successfully authenticated<font color="#E5E5E5"> it is</font>

230
00:09:14,630 --> 00:09:19,580
identified but it's associated security

231
00:09:17,510 --> 00:09:23,090
identifier which is unique within<font color="#E5E5E5"> the</font>

232
00:09:19,580 --> 00:09:25,150
host how does this system associate<font color="#E5E5E5"> and</font>

233
00:09:23,090 --> 00:09:27,740
<font color="#CCCCCC">username with his security identifier</font>

234
00:09:25,150 --> 00:09:30,680
<font color="#E5E5E5">with black magic</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> course this is one</font>

235
00:09:27,740 --> 00:09:33,320
<font color="#CCCCCC">of the things</font><font color="#E5E5E5"> I have analyzed it</font><font color="#CCCCCC"> and</font>

236
00:09:30,680 --> 00:09:35,000
<font color="#CCCCCC">burst at the</font><font color="#E5E5E5"> back to find the security</font>

237
00:09:33,320 --> 00:09:37,820
<font color="#E5E5E5">issue so let me show how</font><font color="#CCCCCC"> there's</font><font color="#E5E5E5"> the</font>

238
00:09:35,000 --> 00:09:39,980
hell this work<font color="#E5E5E5"> so do you remember this</font>

239
00:09:37,820 --> 00:09:42,350
part<font color="#E5E5E5"> of the process</font><font color="#CCCCCC"> here is the exact</font>

240
00:09:39,980 --> 00:09:44,360
moment<font color="#E5E5E5"> when a</font><font color="#CCCCCC"> new surname is translated</font>

241
00:09:42,350 --> 00:09:46,550
to his<font color="#CCCCCC"> associated si D for the very</font>

242
00:09:44,360 --> 00:09:49,820
first<font color="#E5E5E5"> time and then some important data</font>

243
00:09:46,550 --> 00:09:52,099
is obtained from the Sun so how is the

244
00:09:49,820 --> 00:09:53,570
user name associated<font color="#E5E5E5"> with the</font><font color="#CCCCCC"> SAT and</font>

245
00:09:52,100 --> 00:09:56,870
what<font color="#CCCCCC"> security information</font>

246
00:09:53,570 --> 00:09:59,420
<font color="#CCCCCC">it's retrieved some server</font><font color="#E5E5E5"> now</font><font color="#CCCCCC"> housed</font>

247
00:09:56,870 --> 00:10:01,850
now how<font color="#CCCCCC"> to translate from</font><font color="#E5E5E5"> username to</font>

248
00:09:59,420 --> 00:10:04,760
<font color="#CCCCCC">u.s. ID he goes into</font><font color="#E5E5E5"> the Sam database on</font>

249
00:10:01,850 --> 00:10:07,370
this specific registry hive and then

250
00:10:04,760 --> 00:10:09,650
selects the<font color="#E5E5E5"> username each of these keys</font>

251
00:10:07,370 --> 00:10:13,160
contains a reg binary<font color="#E5E5E5"> as you can notice</font>

252
00:10:09,650 --> 00:10:15,050
here and this registry by analysts have

253
00:10:13,160 --> 00:10:17,150
an<font color="#E5E5E5"> attribute called type this a3 which</font>

254
00:10:15,050 --> 00:10:19,640
contained an accessible version<font color="#CCCCCC"> of the</font>

255
00:10:17,150 --> 00:10:22,550
relative identifier associated with<font color="#E5E5E5"> this</font>

256
00:10:19,640 --> 00:10:27,350
user in this<font color="#CCCCCC"> case</font><font color="#E5E5E5"> is 3</font><font color="#CCCCCC"> e</font><font color="#E5E5E5"> 9 which is</font>

257
00:10:22,550 --> 00:10:29,839
<font color="#E5E5E5">equal</font><font color="#CCCCCC"> to 1000 1 now that the some server</font>

258
00:10:27,350 --> 00:10:32,630
<font color="#CCCCCC">node related our ID</font><font color="#E5E5E5"> he looks at this</font>

259
00:10:29,840 --> 00:10:35,000
registry place and she's the<font color="#CCCCCC"> one whose</font>

260
00:10:32,630 --> 00:10:37,670
name<font color="#CCCCCC"> is the same our ID with some</font>

261
00:10:35,000 --> 00:10:39,440
significant zeros and then it grabs all

262
00:10:37,670 --> 00:10:43,310
the information is<font color="#CCCCCC"> tort</font><font color="#E5E5E5"> ended into</font><font color="#CCCCCC"> the</font>

263
00:10:39,440 --> 00:10:45,770
<font color="#E5E5E5">reference key and some server sent sends</font>

264
00:10:43,310 --> 00:10:48,739
back all<font color="#E5E5E5"> T stayed at to the MSB one</font>

265
00:10:45,770 --> 00:10:49,910
process<font color="#E5E5E5"> and this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> the security</font><font color="#CCCCCC"> data</font>

266
00:10:48,740 --> 00:10:51,500
that is returned back to<font color="#E5E5E5"> the</font>

267
00:10:49,910 --> 00:10:52,880
authentication package<font color="#E5E5E5"> after</font>

268
00:10:51,500 --> 00:10:55,550
<font color="#CCCCCC">understanding</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> process</font><font color="#E5E5E5"> some</font>

269
00:10:52,880 --> 00:10:58,760
questions may rise so why does some

270
00:10:55,550 --> 00:11:01,609
store only<font color="#E5E5E5"> they already because every</font>

271
00:10:58,760 --> 00:11:03,560
user will<font color="#CCCCCC"> have the same s ID initial</font>

272
00:11:01,610 --> 00:11:05,570
part but the our ID will always be

273
00:11:03,560 --> 00:11:08,140
different<font color="#E5E5E5"> for each</font><font color="#CCCCCC"> of them the only</font>

274
00:11:05,570 --> 00:11:11,070
<font color="#E5E5E5">thing</font><font color="#CCCCCC"> that buys</font><font color="#E5E5E5"> from user to user is the</font>

275
00:11:08,140 --> 00:11:13,720
in the same system sorry<font color="#E5E5E5"> is</font><font color="#CCCCCC"> the already</font>

276
00:11:11,070 --> 00:11:16,810
what information is retrieved<font color="#E5E5E5"> from the</font>

277
00:11:13,720 --> 00:11:18,940
<font color="#CCCCCC">some data obtained from the stamp of the</font>

278
00:11:16,810 --> 00:11:21,399
registry contains the password hash<font color="#CCCCCC"> the</font>

279
00:11:18,940 --> 00:11:24,339
<font color="#CCCCCC">county</font><font color="#E5E5E5"> status some additional account</font>

280
00:11:21,399 --> 00:11:26,620
<font color="#E5E5E5">restrictions and the pivotal one a copy</font>

281
00:11:24,339 --> 00:11:28,660
of the users<font color="#E5E5E5"> already this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> the core of</font>

282
00:11:26,620 --> 00:11:31,120
the<font color="#E5E5E5"> our ID hijacking attack will see</font>

283
00:11:28,660 --> 00:11:32,410
that<font color="#CCCCCC"> insured</font><font color="#E5E5E5"> so let's simplify the</font>

284
00:11:31,120 --> 00:11:34,779
attack let's do the authentication

285
00:11:32,410 --> 00:11:36,550
<font color="#CCCCCC">process with the red girl</font><font color="#E5E5E5"> but now we</font>

286
00:11:34,779 --> 00:11:38,439
will omit some parts<font color="#E5E5E5"> of the</font>

287
00:11:36,550 --> 00:11:40,810
authentication<font color="#CCCCCC"> process and explained in</font>

288
00:11:38,440 --> 00:11:43,899
more<font color="#CCCCCC"> detail and thus we</font><font color="#E5E5E5"> table one so</font>

289
00:11:40,810 --> 00:11:47,529
guess<font color="#E5E5E5"> it's just an example remember</font><font color="#CCCCCC"> this</font>

290
00:11:43,899 --> 00:11:49,209
works also on standard user accounts so

291
00:11:47,529 --> 00:11:51,189
<font color="#E5E5E5">omit in the beginning</font><font color="#CCCCCC"> will</font><font color="#E5E5E5"> logon has</font>

292
00:11:49,209 --> 00:11:52,689
done his job<font color="#E5E5E5"> and sent</font><font color="#CCCCCC"> a lot of</font>

293
00:11:51,190 --> 00:11:55,240
<font color="#CCCCCC">information to the authentication</font>

294
00:11:52,690 --> 00:11:57,070
package<font color="#CCCCCC"> MSB one and now MSB one sends</font>

295
00:11:55,240 --> 00:11:59,860
the user<font color="#CCCCCC"> has combination to the Sam</font>

296
00:11:57,070 --> 00:12:01,720
server<font color="#E5E5E5"> now the some server</font><font color="#CCCCCC"> query the Sam</font>

297
00:11:59,860 --> 00:12:04,390
database<font color="#E5E5E5"> looking for the associated</font>

298
00:12:01,720 --> 00:12:07,269
guest<font color="#E5E5E5"> key it determines that the guest</font>

299
00:12:04,390 --> 00:12:09,430
<font color="#E5E5E5">account has they</font><font color="#CCCCCC"> are ID 501 or</font><font color="#E5E5E5"> 105 for</font>

300
00:12:07,269 --> 00:12:11,800
next<font color="#CCCCCC"> our decimal</font><font color="#E5E5E5"> base so some server</font>

301
00:12:09,430 --> 00:12:13,420
queries again the Sam but now consulting

302
00:12:11,800 --> 00:12:16,719
the zero zero zero zero zero one and

303
00:12:13,420 --> 00:12:18,670
<font color="#E5E5E5">five key now the process retrieves the</font>

304
00:12:16,720 --> 00:12:20,740
security data related<font color="#CCCCCC"> to the user</font>

305
00:12:18,670 --> 00:12:24,219
including<font color="#CCCCCC"> this</font><font color="#E5E5E5"> our ID copy I told you is</font>

306
00:12:20,740 --> 00:12:25,990
important after that some<font color="#CCCCCC"> servers sent</font>

307
00:12:24,220 --> 00:12:28,149
this<font color="#CCCCCC"> information back</font><font color="#E5E5E5"> to the MSB one</font>

308
00:12:25,990 --> 00:12:30,070
authentication package and this guy does

309
00:12:28,149 --> 00:12:33,220
<font color="#E5E5E5">his job so this could lead</font><font color="#CCCCCC"> to two</font>

310
00:12:30,070 --> 00:12:34,480
possible<font color="#CCCCCC"> the</font><font color="#E5E5E5"> scenarios the first one is</font>

311
00:12:33,220 --> 00:12:36,339
that the hacker girl will not

312
00:12:34,480 --> 00:12:38,560
authenticate because I<font color="#E5E5E5"> never</font><font color="#CCCCCC"> win</font><font color="#E5E5E5"> to the</font>

313
00:12:36,339 --> 00:12:41,610
<font color="#E5E5E5">Machine by default</font><font color="#CCCCCC"> the guest account</font><font color="#E5E5E5"> is</font>

314
00:12:38,560 --> 00:12:44,140
disabled<font color="#CCCCCC"> leading to an access denied</font>

315
00:12:41,610 --> 00:12:46,390
then is the second<font color="#E5E5E5"> one so supported</font><font color="#CCCCCC"> that</font>

316
00:12:44,140 --> 00:12:49,029
supposed that for some<font color="#CCCCCC"> reason</font><font color="#E5E5E5"> the guest</font>

317
00:12:46,390 --> 00:12:51,850
account<font color="#E5E5E5"> is enabled</font><font color="#CCCCCC"> she receives her</font>

318
00:12:49,029 --> 00:12:53,890
<font color="#E5E5E5">access token and then what she doesn't</font>

319
00:12:51,850 --> 00:12:55,920
get<font color="#E5E5E5"> tick left but has access point to</font>

320
00:12:53,890 --> 00:12:58,529
the<font color="#E5E5E5"> guest floor so how could we improve</font>

321
00:12:55,920 --> 00:13:01,800
<font color="#E5E5E5">this situation</font>

322
00:12:58,529 --> 00:13:04,329
it's a mystery for<font color="#CCCCCC"> us right now to</font>

323
00:13:01,800 --> 00:13:07,599
understand why there's a copy of the<font color="#E5E5E5"> our</font>

324
00:13:04,329 --> 00:13:11,680
ID inside a key with the same name<font color="#E5E5E5"> but</font>

325
00:13:07,600 --> 00:13:14,649
what would<font color="#E5E5E5"> happen if we modify</font><font color="#CCCCCC"> it well</font><font color="#E5E5E5"> I</font>

326
00:13:11,680 --> 00:13:18,609
have found that this<font color="#E5E5E5"> our ID copy is the</font>

327
00:13:14,649 --> 00:13:20,770
value used by the<font color="#CCCCCC"> LS a SS and security</font>

328
00:13:18,610 --> 00:13:21,800
reference monitor to create the primary

329
00:13:20,770 --> 00:13:23,780
access<font color="#CCCCCC"> to</font>

330
00:13:21,800 --> 00:13:26,599
so the privileges added to the access

331
00:13:23,780 --> 00:13:29,300
token<font color="#E5E5E5"> are obtained based on this already</font>

332
00:13:26,600 --> 00:13:31,460
<font color="#CCCCCC">so let's</font><font color="#E5E5E5"> set this already copy with</font>

333
00:13:29,300 --> 00:13:33,520
another already already<font color="#E5E5E5"> in this case the</font>

334
00:13:31,460 --> 00:13:36,350
<font color="#E5E5E5">500 which belongs to the</font><font color="#CCCCCC"> built-in</font>

335
00:13:33,520 --> 00:13:38,720
administrator so now repeat all the

336
00:13:36,350 --> 00:13:40,880
process<font color="#E5E5E5"> MSB sends the user hash to some</font>

337
00:13:38,720 --> 00:13:43,160
server some server queries the<font color="#E5E5E5"> same</font>

338
00:13:40,880 --> 00:13:45,800
<font color="#CCCCCC">database with the</font><font color="#E5E5E5"> guest user name then</font>

339
00:13:43,160 --> 00:13:48,860
it retrieves<font color="#E5E5E5"> the</font><font color="#CCCCCC"> associated</font><font color="#E5E5E5"> a'ready key</font>

340
00:13:45,800 --> 00:13:50,569
which is when<font color="#CCCCCC"> a5</font><font color="#E5E5E5"> now it worries again</font>

341
00:13:48,860 --> 00:13:54,800
the<font color="#E5E5E5"> same database with the obtained</font>

342
00:13:50,570 --> 00:13:57,350
array D and now it receives the security

343
00:13:54,800 --> 00:14:00,229
data from<font color="#E5E5E5"> some including the modify it</font>

344
00:13:57,350 --> 00:14:02,450
already copy this data is sent back<font color="#E5E5E5"> to</font>

345
00:14:00,230 --> 00:14:04,340
the MSB authentication<font color="#CCCCCC"> parish</font>

346
00:14:02,450 --> 00:14:06,320
now that the MSB<font color="#E5E5E5"> one authentication</font>

347
00:14:04,340 --> 00:14:10,310
<font color="#CCCCCC">buckets</font><font color="#E5E5E5"> check for security</font><font color="#CCCCCC"> restrictions</font>

348
00:14:06,320 --> 00:14:13,480
of the user obtained from the sand I'm

349
00:14:10,310 --> 00:14:15,680
security data<font color="#E5E5E5"> so it compares the</font>

350
00:14:13,480 --> 00:14:18,680
<font color="#CCCCCC">restrictions with the data obtained from</font>

351
00:14:15,680 --> 00:14:20,810
<font color="#E5E5E5">the</font><font color="#CCCCCC"> Sam the thing</font><font color="#E5E5E5"> is that MSB one takes</font>

352
00:14:18,680 --> 00:14:22,010
the status of the guest account<font color="#CCCCCC"> but</font><font color="#E5E5E5"> that</font>

353
00:14:20,810 --> 00:14:24,349
seems that<font color="#E5E5E5"> they</font><font color="#CCCCCC"> are from</font><font color="#E5E5E5"> the</font>

354
00:14:22,010 --> 00:14:25,970
administrator<font color="#CCCCCC"> and</font><font color="#E5E5E5"> allow in the access</font>

355
00:14:24,350 --> 00:14:28,580
<font color="#E5E5E5">even</font><font color="#CCCCCC"> AB administrator account is</font>

356
00:14:25,970 --> 00:14:30,680
disabled<font color="#E5E5E5"> as I have told you only the</font>

357
00:14:28,580 --> 00:14:32,360
only<font color="#E5E5E5"> thing that we are modifying</font><font color="#CCCCCC"> is</font>

358
00:14:30,680 --> 00:14:35,930
their ID<font color="#E5E5E5"> not the other security</font>

359
00:14:32,360 --> 00:14:38,570
<font color="#E5E5E5">properties this applies also to the hash</font>

360
00:14:35,930 --> 00:14:40,939
so<font color="#E5E5E5"> M is become first the cached version</font>

361
00:14:38,570 --> 00:14:43,310
<font color="#CCCCCC">of the enter</font><font color="#E5E5E5"> password hash the hash</font>

362
00:14:40,940 --> 00:14:45,860
retrieved from<font color="#CCCCCC"> the Sam and</font><font color="#E5E5E5"> profit but</font>

363
00:14:43,310 --> 00:14:47,420
<font color="#E5E5E5">what will be the same now</font><font color="#CCCCCC"> that</font>

364
00:14:45,860 --> 00:14:49,190
everything<font color="#E5E5E5"> is</font><font color="#CCCCCC"> ok the authentication</font>

365
00:14:47,420 --> 00:14:53,120
package retrieves the logon information

366
00:14:49,190 --> 00:14:55,100
to the<font color="#E5E5E5"> LSA</font><font color="#CCCCCC"> SS and then LSA</font><font color="#E5E5E5"> SS</font>

367
00:14:53,120 --> 00:14:57,950
communicates with the security reference

368
00:14:55,100 --> 00:15:02,150
monitor<font color="#E5E5E5"> to create the access token based</font>

369
00:14:57,950 --> 00:15:03,770
<font color="#E5E5E5">on this modified</font><font color="#CCCCCC"> our ID copy so all the</font>

370
00:15:02,150 --> 00:15:06,560
security<font color="#CCCCCC"> properties of the account</font>

371
00:15:03,770 --> 00:15:08,900
<font color="#E5E5E5">remain the same except the our ID which</font>

372
00:15:06,560 --> 00:15:11,150
is<font color="#CCCCCC"> the</font><font color="#E5E5E5"> critical one modifying their ID</font>

373
00:15:08,900 --> 00:15:13,520
<font color="#E5E5E5">at the exact place it's equal to</font>

374
00:15:11,150 --> 00:15:16,910
<font color="#E5E5E5">acquiring the privileges of its profit</font>

375
00:15:13,520 --> 00:15:18,680
account and doing everything one in this

376
00:15:16,910 --> 00:15:20,660
case<font color="#E5E5E5"> the guest account receives her</font>

377
00:15:18,680 --> 00:15:23,120
access token and<font color="#E5E5E5"> she can do anything</font>

378
00:15:20,660 --> 00:15:28,850
<font color="#CCCCCC">inside the system</font><font color="#E5E5E5"> all because the</font>

379
00:15:23,120 --> 00:15:30,920
administrator so these are the security

380
00:15:28,850 --> 00:15:33,230
<font color="#E5E5E5">issues the</font><font color="#CCCCCC"> first one is that</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> Sam</font>

381
00:15:30,920 --> 00:15:35,300
server does<font color="#CCCCCC"> not check if</font><font color="#E5E5E5"> the our ID</font>

382
00:15:33,230 --> 00:15:37,930
associated<font color="#E5E5E5"> with the user is</font>

383
00:15:35,300 --> 00:15:41,599
assistant<font color="#E5E5E5"> to this particular our ad copy</font>

384
00:15:37,930 --> 00:15:43,910
<font color="#E5E5E5">the second one is that the</font><font color="#CCCCCC"> LS a SS does</font>

385
00:15:41,600 --> 00:15:46,250
not corroborate<font color="#E5E5E5"> the relative</font><font color="#CCCCCC"> identifier</font>

386
00:15:43,910 --> 00:15:49,279
with the<font color="#E5E5E5"> username right before creating</font>

387
00:15:46,250 --> 00:15:51,890
<font color="#E5E5E5">the primary access token the third one</font>

388
00:15:49,279 --> 00:15:53,390
is<font color="#CCCCCC"> that the</font><font color="#E5E5E5"> LS a SS never looks for</font>

389
00:15:51,890 --> 00:15:57,199
already<font color="#CCCCCC"> inconsistency</font>

390
00:15:53,390 --> 00:16:02,649
during the user session so the funny

391
00:15:57,200 --> 00:16:02,649
part<font color="#E5E5E5"> the demonstration</font><font color="#CCCCCC"> so let me see</font>

392
00:16:02,769 --> 00:16:09,140
this<font color="#E5E5E5"> will be our victim</font><font color="#CCCCCC"> machine as</font><font color="#E5E5E5"> you</font>

393
00:16:07,399 --> 00:16:16,130
can see I have updated<font color="#CCCCCC"> early this</font>

394
00:16:09,140 --> 00:16:24,260
<font color="#E5E5E5">morning</font><font color="#CCCCCC"> okay</font>

395
00:16:16,130 --> 00:16:26,600
and here the latest<font color="#E5E5E5"> batches here are the</font>

396
00:16:24,260 --> 00:16:29,720
<font color="#CCCCCC">uses local users of the victim that</font>

397
00:16:26,600 --> 00:16:30,950
means<font color="#E5E5E5"> Twitter one the guest one and a</font>

398
00:16:29,720 --> 00:16:37,519
standard user account called

399
00:16:30,950 --> 00:16:44,450
<font color="#E5E5E5">unprivileged we can see that the</font>

400
00:16:37,519 --> 00:16:45,950
<font color="#E5E5E5">administrator account is not active we</font>

401
00:16:44,450 --> 00:16:56,480
can<font color="#CCCCCC"> see that the administrator account</font>

402
00:16:45,950 --> 00:16:57,770
is active for demo purposes<font color="#E5E5E5"> okay and</font>

403
00:16:56,480 --> 00:17:00,440
this<font color="#E5E5E5"> is the standard account for</font>

404
00:16:57,770 --> 00:17:01,010
applying<font color="#E5E5E5"> to use also this active and</font>

405
00:17:00,440 --> 00:17:08,150
<font color="#CCCCCC">okay</font>

406
00:17:01,010 --> 00:17:10,459
so let's look down and<font color="#E5E5E5"> let's try to</font>

407
00:17:08,150 --> 00:17:17,689
interactively authenticate with<font color="#E5E5E5"> the</font>

408
00:17:10,459 --> 00:17:20,360
guest account<font color="#CCCCCC"> I have set the password</font>

409
00:17:17,689 --> 00:17:22,850
before<font color="#E5E5E5"> we can see here that it is a</font>

410
00:17:20,359 --> 00:17:25,750
possible for us to interactively<font color="#E5E5E5"> log on</font>

411
00:17:22,849 --> 00:17:25,750
as the guest account

412
00:17:26,460 --> 00:17:29,599
[Music]

413
00:17:30,760 --> 00:17:35,559
I have developed a<font color="#CCCCCC"> Metasploit model</font>

414
00:17:32,710 --> 00:17:38,440
which is available<font color="#E5E5E5"> on the latest</font>

415
00:17:35,559 --> 00:17:40,210
<font color="#CCCCCC">official version</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> Metasploit and you</font>

416
00:17:38,440 --> 00:17:42,520
can see it on you can<font color="#E5E5E5"> find it on</font><font color="#CCCCCC"> Windows</font>

417
00:17:40,210 --> 00:17:43,780
<font color="#CCCCCC">managed</font><font color="#E5E5E5"> already hijack both windows</font>

418
00:17:42,520 --> 00:17:45,970
<font color="#E5E5E5">managed already hijacked this</font><font color="#CCCCCC"> is the</font>

419
00:17:43,780 --> 00:17:49,030
model<font color="#E5E5E5"> teaser some of the properties will</font>

420
00:17:45,970 --> 00:17:53,710
see that in shirt<font color="#E5E5E5"> this the is the IP</font>

421
00:17:49,030 --> 00:17:58,809
<font color="#CCCCCC">address of</font><font color="#E5E5E5"> the attacker machine and we</font>

422
00:17:53,710 --> 00:18:00,820
will try to do a PS xxxx against the big

423
00:17:58,809 --> 00:18:03,639
team<font color="#E5E5E5"> and by using the guest potentials</font>

424
00:18:00,820 --> 00:18:10,330
<font color="#E5E5E5">so if we try</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> it is not successful</font><font color="#CCCCCC"> by</font>

425
00:18:03,640 --> 00:18:17,790
now we can try<font color="#E5E5E5"> it also with the</font><font color="#CCCCCC"> improve</font>

426
00:18:10,330 --> 00:18:17,790
<font color="#CCCCCC">already at account</font><font color="#E5E5E5"> ok just won't work</font>

427
00:18:17,970 --> 00:18:25,120
and<font color="#E5E5E5"> let's see the model so this requires</font>

428
00:18:22,770 --> 00:18:27,639
<font color="#CCCCCC">meterpreter session to modify the</font>

429
00:18:25,120 --> 00:18:31,959
specific<font color="#E5E5E5"> registry binary that contains</font>

430
00:18:27,640 --> 00:18:33,400
they already copy<font color="#E5E5E5"> so the gate system</font>

431
00:18:31,960 --> 00:18:36,160
will try to<font color="#CCCCCC"> acquire the required</font>

432
00:18:33,400 --> 00:18:38,380
privileges to modify this<font color="#E5E5E5"> particular</font>

433
00:18:36,160 --> 00:18:40,120
binary the guest account<font color="#E5E5E5"> volume will</font>

434
00:18:38,380 --> 00:18:43,390
define if we are going<font color="#E5E5E5"> to use as the</font>

435
00:18:40,120 --> 00:18:44,949
<font color="#E5E5E5">hijacker account if we</font><font color="#CCCCCC"> are</font><font color="#E5E5E5"> planning</font><font color="#CCCCCC"> to</font>

436
00:18:43,390 --> 00:18:47,260
<font color="#CCCCCC">use the</font><font color="#E5E5E5"> guest account as a hijacker one</font>

437
00:18:44,950 --> 00:18:49,059
sorry<font color="#CCCCCC"> if we want to change the</font><font color="#E5E5E5"> password</font>

438
00:18:47,260 --> 00:18:52,210
<font color="#E5E5E5">of a hijacker account we will set it in</font>

439
00:18:49,059 --> 00:18:54,428
the field password and in the filter ID

440
00:18:52,210 --> 00:18:56,559
will set the relative identifier world

441
00:18:54,429 --> 00:18:59,530
<font color="#E5E5E5">point you are planning to move to set to</font>

442
00:18:56,559 --> 00:19:04,750
and this<font color="#E5E5E5"> session</font><font color="#CCCCCC"> all</font><font color="#E5E5E5"> might meet up</font><font color="#CCCCCC"> at</font>

443
00:18:59,530 --> 00:19:06,879
<font color="#E5E5E5">our session so if we're an exploit we</font>

444
00:19:04,750 --> 00:19:10,510
can see here<font color="#E5E5E5"> that we have modify it from</font>

445
00:19:06,880 --> 00:19:13,750
<font color="#E5E5E5">the guest account</font><font color="#CCCCCC"> default or ID which is</font>

446
00:19:10,510 --> 00:19:17,740
501<font color="#CCCCCC"> to the 500</font><font color="#E5E5E5"> so if we</font><font color="#CCCCCC"> try to</font>

447
00:19:13,750 --> 00:19:27,580
<font color="#CCCCCC">authenticate again with the guest</font>

448
00:19:17,740 --> 00:19:30,220
account interactively let's see<font color="#CCCCCC"> ok</font><font color="#E5E5E5"> by</font>

449
00:19:27,580 --> 00:19:32,860
now<font color="#E5E5E5"> it's possible but let's see what's</font>

450
00:19:30,220 --> 00:19:41,500
happened if we try<font color="#E5E5E5"> to do that with the</font>

451
00:19:32,860 --> 00:19:44,320
<font color="#E5E5E5">PS</font><font color="#CCCCCC"> execration</font><font color="#E5E5E5"> cool good show and by</font>

452
00:19:41,500 --> 00:19:46,899
<font color="#E5E5E5">default</font><font color="#CCCCCC"> in packet version the</font><font color="#E5E5E5"> basics</font>

453
00:19:44,320 --> 00:19:49,299
version of<font color="#E5E5E5"> in packet will try to acquire</font>

454
00:19:46,899 --> 00:19:56,158
the most important privilege<font color="#CCCCCC"> which with</font>

455
00:19:49,299 --> 00:19:58,899
our system account so that's wait here

456
00:19:56,159 --> 00:20:02,649
<font color="#E5E5E5">but I think is</font><font color="#CCCCCC"> that we are</font><font color="#E5E5E5"> impersonating</font>

457
00:19:58,899 --> 00:20:14,168
the administrator<font color="#E5E5E5"> built-in account we</font>

458
00:20:02,649 --> 00:20:16,120
can<font color="#CCCCCC"> see here</font><font color="#E5E5E5"> that it is disabled</font><font color="#CCCCCC"> its</font>

459
00:20:14,169 --> 00:20:18,840
account is enabled<font color="#CCCCCC"> we are authenticating</font>

460
00:20:16,120 --> 00:20:21,729
with the<font color="#E5E5E5"> guests potentials but we are</font>

461
00:20:18,840 --> 00:20:25,570
generating<font color="#E5E5E5"> or access token</font><font color="#CCCCCC"> based it on</font>

462
00:20:21,730 --> 00:20:31,860
the<font color="#E5E5E5"> administrator already so let's check</font>

463
00:20:25,570 --> 00:20:36,639
this can you see this<font color="#CCCCCC"> okay cool</font>

464
00:20:31,860 --> 00:20:39,039
<font color="#E5E5E5">now we are the guest account but or</font><font color="#CCCCCC"> a CD</font>

465
00:20:36,639 --> 00:20:44,049
or access token<font color="#E5E5E5"> is generated with the</font>

466
00:20:39,039 --> 00:20:48,070
500 access token<font color="#CCCCCC"> okay so if</font><font color="#E5E5E5"> we run</font>

467
00:20:44,049 --> 00:21:10,029
something like<font color="#CCCCCC"> who am i and we try to</font>

468
00:20:48,070 --> 00:21:11,799
write inside of a protected folder<font color="#E5E5E5"> okay</font>

469
00:21:10,029 --> 00:21:13,779
will be<font color="#CCCCCC"> possible</font><font color="#E5E5E5"> for us to write on</font>

470
00:21:11,799 --> 00:21:20,918
protected folders<font color="#E5E5E5"> by with my using</font><font color="#CCCCCC"> the</font>

471
00:21:13,779 --> 00:21:22,840
guest potentials and no<font color="#CCCCCC"> trigger and by</font>

472
00:21:20,919 --> 00:21:26,019
inaudible and<font color="#E5E5E5"> triggering any alerts on</font>

473
00:21:22,840 --> 00:21:30,360
<font color="#CCCCCC">the victim you can see here that</font><font color="#E5E5E5"> it</font><font color="#CCCCCC"> is</font>

474
00:21:26,019 --> 00:21:32,500
also the user is disabled by default

475
00:21:30,360 --> 00:21:35,758
<font color="#CCCCCC">okay but we are</font><font color="#E5E5E5"> impersonating</font>

476
00:21:32,500 --> 00:21:39,639
administrator so in every never we lock

477
00:21:35,759 --> 00:21:41,230
<font color="#CCCCCC">taking every</font><font color="#E5E5E5"> lock that register any</font>

478
00:21:39,639 --> 00:21:43,299
operation that<font color="#CCCCCC"> has taken place during</font>

479
00:21:41,230 --> 00:21:45,370
<font color="#E5E5E5">this decision will</font><font color="#CCCCCC"> be registered as done</font>

480
00:21:43,299 --> 00:21:47,230
by<font color="#CCCCCC"> the administrator</font><font color="#E5E5E5"> but we are blogging</font>

481
00:21:45,370 --> 00:21:49,870
<font color="#E5E5E5">with the quest credentials this is also</font>

482
00:21:47,230 --> 00:21:51,909
<font color="#CCCCCC">I forget to do</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> they I mean</font><font color="#E5E5E5"> I'm</font>

483
00:21:49,870 --> 00:21:53,918
<font color="#E5E5E5">running out of time but it is</font><font color="#CCCCCC"> possible</font>

484
00:21:51,909 --> 00:21:56,950
<font color="#CCCCCC">to do this also with</font><font color="#E5E5E5"> the standard user</font>

485
00:21:53,919 --> 00:21:58,330
accounts<font color="#E5E5E5"> and some final conclusions so</font>

486
00:21:56,950 --> 00:22:00,100
by now as

487
00:21:58,330 --> 00:22:02,139
you have seen this is<font color="#CCCCCC"> the latest wind</font><font color="#E5E5E5"> 10</font>

488
00:22:00,100 --> 00:22:04,269
version<font color="#E5E5E5"> there is no existing</font><font color="#CCCCCC"> packs</font><font color="#E5E5E5"> patch</font>

489
00:22:02,140 --> 00:22:06,820
to protect window from this<font color="#E5E5E5"> attack the</font>

490
00:22:04,269 --> 00:22:10,179
<font color="#E5E5E5">only way to the Phantom machine against</font>

491
00:22:06,820 --> 00:22:11,918
this is by detection<font color="#CCCCCC"> I have tested</font><font color="#E5E5E5"> this</font>

492
00:22:10,179 --> 00:22:14,470
with many antivirus<font color="#CCCCCC"> but it is not</font>

493
00:22:11,919 --> 00:22:16,980
detected<font color="#CCCCCC"> I mean then the only thing that</font>

494
00:22:14,470 --> 00:22:19,990
can be detected<font color="#CCCCCC"> is the meterpreter</font>

495
00:22:16,980 --> 00:22:23,440
executable but this can be<font color="#CCCCCC"> done also</font><font color="#E5E5E5"> by</font>

496
00:22:19,990 --> 00:22:25,390
using only<font color="#E5E5E5"> OS resources</font><font color="#CCCCCC"> the thing is</font>

497
00:22:23,440 --> 00:22:27,549
<font color="#E5E5E5">that this</font><font color="#CCCCCC"> is more complicated to</font><font color="#E5E5E5"> detect</font>

498
00:22:25,390 --> 00:22:30,370
on big<font color="#CCCCCC"> Windows domain</font><font color="#E5E5E5"> since a simple</font>

499
00:22:27,549 --> 00:22:33,639
workstation can<font color="#E5E5E5"> be used as an open door</font>

500
00:22:30,370 --> 00:22:36,070
to<font color="#E5E5E5"> people inside the network</font><font color="#CCCCCC"> I am</font><font color="#E5E5E5"> NOT</font>

501
00:22:33,639 --> 00:22:39,250
<font color="#CCCCCC">currently aware about any malware that</font>

502
00:22:36,070 --> 00:22:41,590
uses this kind of persistence<font color="#CCCCCC"> I mean as</font>

503
00:22:39,250 --> 00:22:44,200
<font color="#CCCCCC">you see this</font><font color="#E5E5E5"> is a quite</font><font color="#CCCCCC"> simple technique</font>

504
00:22:41,590 --> 00:22:46,870
and<font color="#E5E5E5"> it's pretty easy to apply I hope you</font>

505
00:22:44,200 --> 00:22:49,750
will<font color="#E5E5E5"> enjoy this technique as more and</font>

506
00:22:46,870 --> 00:22:51,110
<font color="#CCCCCC">more</font><font color="#E5E5E5"> such I do and thank you for coming</font>

507
00:22:49,750 --> 00:22:57,650
that's it

508
00:22:51,110 --> 00:22:59,709
[Applause]

509
00:22:57,650 --> 00:22:59,710
you

