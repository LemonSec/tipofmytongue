1
00:00:00,000 --> 00:00:09,510
<font color="#CCCCCC">go</font><font color="#E5E5E5"> ahead and get started here</font><font color="#CCCCCC"> first of</font>

2
00:00:06,629 --> 00:00:14,399
all<font color="#E5E5E5"> Mic Check</font><font color="#CCCCCC"> do we have any mics in the</font>

3
00:00:09,510 --> 00:00:18,600
<font color="#E5E5E5">house any</font><font color="#CCCCCC"> Justins all right so</font><font color="#E5E5E5"> I</font><font color="#CCCCCC"> talked</font>

4
00:00:14,400 --> 00:00:20,369
is living off the land<font color="#CCCCCC"> named in honor of</font>

5
00:00:18,600 --> 00:00:23,240
this year's<font color="#E5E5E5"> derbycon</font>

6
00:00:20,369 --> 00:00:25,560
evolution theme<font color="#CCCCCC"> it's going to be about</font>

7
00:00:23,240 --> 00:00:27,330
sustainable attacking essentially how

8
00:00:25,560 --> 00:00:28,788
<font color="#E5E5E5">you can take an exploit your</font>

9
00:00:27,330 --> 00:00:32,668
infrastructure once you have a foothold

10
00:00:28,789 --> 00:00:36,090
<font color="#CCCCCC">without</font><font color="#E5E5E5"> killing the Golden Goose so</font>

11
00:00:32,668 --> 00:00:38,610
first of all who I<font color="#E5E5E5"> am my name's Adam</font>

12
00:00:36,090 --> 00:00:40,110
<font color="#E5E5E5">Reiser</font><font color="#CCCCCC"> I'm a</font><font color="#E5E5E5"> security research engineer</font>

13
00:00:38,610 --> 00:00:42,510
with<font color="#CCCCCC"> the Cisco's</font><font color="#E5E5E5"> advanced security</font>

14
00:00:40,110 --> 00:00:44,969
<font color="#E5E5E5">initiatives group</font><font color="#CCCCCC"> I do primarily</font><font color="#E5E5E5"> red</font>

15
00:00:42,510 --> 00:00:47,640
team and application<font color="#E5E5E5"> security work all</font>

16
00:00:44,969 --> 00:00:50,190
opinions presented here are my own and

17
00:00:47,640 --> 00:00:53,579
what is this<font color="#E5E5E5"> this is a composite of</font>

18
00:00:50,190 --> 00:00:56,968
<font color="#CCCCCC">several red team engagements</font><font color="#E5E5E5"> from 2018</font>

19
00:00:53,579 --> 00:00:58,890
<font color="#CCCCCC">so this is this current</font><font color="#E5E5E5"> work it's been</font>

20
00:00:56,969 --> 00:01:00,629
authorized for<font color="#E5E5E5"> disclosure the target is</font>

21
00:00:58,890 --> 00:01:03,480
going<font color="#CCCCCC"> to</font><font color="#E5E5E5"> be the fictitious</font><font color="#CCCCCC"> said comm</font>

22
00:01:00,629 --> 00:01:05,970
enterprises<font color="#CCCCCC"> Network and throughout this</font>

23
00:01:03,480 --> 00:01:08,460
this talk I will<font color="#E5E5E5"> be discussing several</font>

24
00:01:05,970 --> 00:01:10,200
<font color="#E5E5E5">tools that</font><font color="#CCCCCC"> I've written which needless</font>

25
00:01:08,460 --> 00:01:11,820
to say are<font color="#E5E5E5"> for authorized testing and</font>

26
00:01:10,200 --> 00:01:15,180
educational purposes only do not

27
00:01:11,820 --> 00:01:17,520
<font color="#E5E5E5">puncture</font><font color="#CCCCCC"> or incinerate so this is our</font>

28
00:01:15,180 --> 00:01:22,110
<font color="#E5E5E5">target the said</font><font color="#CCCCCC"> comm marketplace it's a</font>

29
00:01:17,520 --> 00:01:24,090
network of several systems<font color="#E5E5E5"> that yeah it</font>

30
00:01:22,110 --> 00:01:26,400
sells fresh produce gardening supplies

31
00:01:24,090 --> 00:01:28,650
farm equipment<font color="#E5E5E5"> basic online storefront</font>

32
00:01:26,400 --> 00:01:30,450
<font color="#CCCCCC">we've been hired to perform</font><font color="#E5E5E5"> a red team</font>

33
00:01:28,650 --> 00:01:33,900
pen test<font color="#E5E5E5"> whatever you want to call it</font>

34
00:01:30,450 --> 00:01:36,900
against this corporation our objectives

35
00:01:33,900 --> 00:01:38,729
<font color="#E5E5E5">in this endeavor are to exploit the</font>

36
00:01:36,900 --> 00:01:41,360
<font color="#E5E5E5">sedge comm network in order</font><font color="#CCCCCC"> to</font>

37
00:01:38,729 --> 00:01:44,429
demonstrate the<font color="#E5E5E5"> impact to the</font><font color="#CCCCCC"> business</font>

38
00:01:41,360 --> 00:01:46,649
<font color="#E5E5E5">in the course of that we want to avoid</font>

39
00:01:44,430 --> 00:01:48,060
detection<font color="#E5E5E5"> by the blue team because if</font>

40
00:01:46,649 --> 00:01:51,119
we're detected<font color="#E5E5E5"> there's no business</font>

41
00:01:48,060 --> 00:01:53,220
<font color="#E5E5E5">impact and we also want to minimize any</font>

42
00:01:51,119 --> 00:01:56,460
additional risks posed<font color="#E5E5E5"> by our activities</font>

43
00:01:53,220 --> 00:02:01,399
<font color="#E5E5E5">either risks to us or</font><font color="#CCCCCC"> to our employers</font>

44
00:01:56,460 --> 00:02:01,399
the sedge comm enterprises<font color="#CCCCCC"> association</font>

45
00:02:01,840 --> 00:02:05,829
<font color="#CCCCCC">therefore the two following</font><font color="#E5E5E5"> principles</font>

46
00:02:03,729 --> 00:02:07,929
will inform our endeavors we're going to

47
00:02:05,829 --> 00:02:09,429
avoid exploiting<font color="#CCCCCC"> for the sake of it</font><font color="#E5E5E5"> and</font>

48
00:02:07,929 --> 00:02:11,610
the less<font color="#CCCCCC"> privilege we need to</font>

49
00:02:09,429 --> 00:02:14,260
demonstrate<font color="#E5E5E5"> a business impact the better</font>

50
00:02:11,610 --> 00:02:20,019
number of boxes popped<font color="#E5E5E5"> is not a good</font>

51
00:02:14,260 --> 00:02:22,410
metric and we're going<font color="#E5E5E5"> to avoid any mass</font>

52
00:02:20,019 --> 00:02:24,430
indiscriminate scans or<font color="#CCCCCC"> exploit sprays</font>

53
00:02:22,410 --> 00:02:26,170
<font color="#E5E5E5">so here's an extremely simplified</font>

54
00:02:24,430 --> 00:02:27,910
overview of the network we're going to

55
00:02:26,170 --> 00:02:29,349
be exploiting obviously no<font color="#E5E5E5"> actual</font>

56
00:02:27,910 --> 00:02:31,599
infrastructure<font color="#E5E5E5"> is shown here just a</font>

57
00:02:29,349 --> 00:02:33,429
series<font color="#CCCCCC"> of servers</font><font color="#E5E5E5"> domain controller</font>

58
00:02:31,599 --> 00:02:35,859
<font color="#E5E5E5">obviously at the top this</font><font color="#CCCCCC"> is roughly</font>

59
00:02:33,430 --> 00:02:39,160
organized<font color="#CCCCCC"> for more secure on top to less</font>

60
00:02:35,860 --> 00:02:41,829
secure<font color="#E5E5E5"> on the bottom so yeah domain</font>

61
00:02:39,160 --> 00:02:43,569
<font color="#E5E5E5">that's our last resort if we can't</font>

62
00:02:41,829 --> 00:02:48,790
demonstrate impact<font color="#CCCCCC"> using anything else</font>

63
00:02:43,569 --> 00:02:50,859
<font color="#E5E5E5">we're</font><font color="#CCCCCC"> gonna go for</font><font color="#E5E5E5"> for da as per as per</font>

64
00:02:48,790 --> 00:02:53,560
standard<font color="#E5E5E5"> practice but</font><font color="#CCCCCC"> ideally we're</font>

65
00:02:50,860 --> 00:02:55,690
going to be able<font color="#E5E5E5"> to to demonstrate an</font>

66
00:02:53,560 --> 00:02:57,790
impact without without having<font color="#E5E5E5"> that since</font>

67
00:02:55,690 --> 00:02:59,799
this is a post exploitation talk we're

68
00:02:57,790 --> 00:03:01,900
starting with and<font color="#E5E5E5"> assumed</font><font color="#CCCCCC"> a breach of</font>

69
00:02:59,799 --> 00:03:04,170
<font color="#E5E5E5">this build server</font><font color="#CCCCCC"> which I'll explain how</font>

70
00:03:01,900 --> 00:03:08,230
we get<font color="#CCCCCC"> to in a second the middle</font><font color="#E5E5E5"> row</font>

71
00:03:04,170 --> 00:03:10,510
Jenkins master<font color="#E5E5E5"> and EDR or</font><font color="#CCCCCC"> sim console</font>

72
00:03:08,230 --> 00:03:13,510
the point is<font color="#E5E5E5"> that the blue team our</font>

73
00:03:10,510 --> 00:03:15,040
adversary has<font color="#E5E5E5"> endpoint</font><font color="#CCCCCC"> insight</font><font color="#E5E5E5"> and is</font>

74
00:03:13,510 --> 00:03:18,069
going<font color="#E5E5E5"> to be monitoring our activities</font>

75
00:03:15,040 --> 00:03:20,590
<font color="#E5E5E5">and therefore we need to we need</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> be</font>

76
00:03:18,069 --> 00:03:22,208
extremely<font color="#E5E5E5"> selective in how we go about</font>

77
00:03:20,590 --> 00:03:24,250
<font color="#E5E5E5">this we're going to start with an</font>

78
00:03:22,209 --> 00:03:26,349
account<font color="#CCCCCC"> a domain account</font><font color="#E5E5E5"> with no</font>

79
00:03:24,250 --> 00:03:27,849
<font color="#CCCCCC">particular privileges that</font><font color="#E5E5E5"> we can assume</font>

80
00:03:26,349 --> 00:03:29,078
that we've fished<font color="#E5E5E5"> and we need to be</font>

81
00:03:27,849 --> 00:03:33,970
<font color="#E5E5E5">careful</font><font color="#CCCCCC"> to avoid</font><font color="#E5E5E5"> burning those</font>

82
00:03:29,079 --> 00:03:35,950
credentials so before we<font color="#CCCCCC"> even touch our</font>

83
00:03:33,970 --> 00:03:38,889
target<font color="#E5E5E5"> network before</font><font color="#CCCCCC"> we</font><font color="#E5E5E5"> log</font><font color="#CCCCCC"> into the</font>

84
00:03:35,950 --> 00:03:40,780
<font color="#E5E5E5">VPN using our ordinary Alice account</font>

85
00:03:38,889 --> 00:03:42,569
that we've<font color="#CCCCCC"> we fished we're going to</font>

86
00:03:40,780 --> 00:03:44,530
<font color="#E5E5E5">begin</font><font color="#CCCCCC"> with external discovery</font>

87
00:03:42,569 --> 00:03:45,910
basically<font color="#E5E5E5"> I'm</font><font color="#CCCCCC"> not going to spend</font><font color="#E5E5E5"> a lot</font>

88
00:03:44,530 --> 00:03:47,560
of time on this compendium of very

89
00:03:45,910 --> 00:03:49,540
well-known techniques using public data

90
00:03:47,560 --> 00:03:52,359
for passive reconnaissance<font color="#E5E5E5"> avoids</font>

91
00:03:49,540 --> 00:03:54,160
touching the target infrastructure yeah

92
00:03:52,359 --> 00:03:55,180
search engines who is<font color="#CCCCCC"> Joe dan you all</font>

93
00:03:54,160 --> 00:03:57,160
you all<font color="#E5E5E5"> know this stuff</font>

94
00:03:55,180 --> 00:03:59,079
the main one I want to talk about<font color="#E5E5E5"> that's</font>

95
00:03:57,160 --> 00:04:01,418
kind<font color="#CCCCCC"> of hot right</font><font color="#E5E5E5"> now is certificate</font>

96
00:03:59,079 --> 00:04:03,519
transparency<font color="#CCCCCC"> there's a couple</font><font color="#E5E5E5"> of main</font>

97
00:04:01,419 --> 00:04:06,489
ones<font color="#E5E5E5"> the Google transparency report and</font>

98
00:04:03,519 --> 00:04:09,310
<font color="#CCCCCC">syrtis</font><font color="#E5E5E5"> H and get a tremendous amount of</font>

99
00:04:06,489 --> 00:04:11,620
information<font color="#E5E5E5"> about infrastructure</font><font color="#CCCCCC"> many</font>

100
00:04:09,310 --> 00:04:13,629
<font color="#E5E5E5">times non publicly accessible servers</font>

101
00:04:11,620 --> 00:04:15,500
<font color="#CCCCCC">behind the</font><font color="#E5E5E5"> corporate firewall</font><font color="#CCCCCC"> in this</font>

102
00:04:13,629 --> 00:04:18,599
case

103
00:04:15,500 --> 00:04:20,700
these are the<font color="#E5E5E5"> said</font><font color="#CCCCCC"> comm servers</font><font color="#E5E5E5"> that</font>

104
00:04:18,600 --> 00:04:23,280
we're<font color="#CCCCCC"> going to be exploring these are</font>

105
00:04:20,700 --> 00:04:25,110
all only<font color="#E5E5E5"> one of them has publicly</font>

106
00:04:23,280 --> 00:04:27,690
accessible services<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is an actual</font>

107
00:04:25,110 --> 00:04:29,430
network that's up and yeah<font color="#CCCCCC"> do you want</font>

108
00:04:27,690 --> 00:04:34,290
<font color="#E5E5E5">to try to try</font><font color="#CCCCCC"> to knock it down</font>

109
00:04:29,430 --> 00:04:37,170
feel free<font color="#E5E5E5"> yes you can see they all have</font>

110
00:04:34,290 --> 00:04:39,570
<font color="#E5E5E5">valid certificates</font><font color="#CCCCCC"> that I've grabbed</font>

111
00:04:37,170 --> 00:04:41,040
from let's encrypt<font color="#E5E5E5"> even though they're</font>

112
00:04:39,570 --> 00:04:43,980
not<font color="#E5E5E5"> publicly accessible so this is a</font>

113
00:04:41,040 --> 00:04:46,350
<font color="#E5E5E5">tremendous resource for for just a first</font>

114
00:04:43,980 --> 00:04:48,690
<font color="#E5E5E5">step</font><font color="#CCCCCC"> where you don't even have to touch</font>

115
00:04:46,350 --> 00:04:50,400
the target infrastructure but<font color="#E5E5E5"> it can</font>

116
00:04:48,690 --> 00:04:52,140
<font color="#CCCCCC">only take us so far so at some</font><font color="#E5E5E5"> point</font>

117
00:04:50,400 --> 00:04:54,719
<font color="#CCCCCC">we're going</font><font color="#E5E5E5"> to need to transition to</font>

118
00:04:52,140 --> 00:04:56,370
<font color="#E5E5E5">internal discovery and again we're not</font>

119
00:04:54,720 --> 00:04:58,410
<font color="#E5E5E5">just</font><font color="#CCCCCC"> running</font><font color="#E5E5E5"> nmap we're not going to do</font>

120
00:04:56,370 --> 00:05:00,360
any mass scans<font color="#CCCCCC"> where we're</font><font color="#E5E5E5"> going to be</font>

121
00:04:58,410 --> 00:05:02,610
careful<font color="#CCCCCC"> because we only have access</font><font color="#E5E5E5"> to</font>

122
00:05:00,360 --> 00:05:05,070
<font color="#CCCCCC">the</font><font color="#E5E5E5"> VPN and through these creds</font><font color="#CCCCCC"> that we</font>

123
00:05:02,610 --> 00:05:06,720
either have been provided<font color="#CCCCCC"> to us or we</font>

124
00:05:05,070 --> 00:05:07,260
<font color="#CCCCCC">can assume that we've fished</font><font color="#E5E5E5"> again it</font>

125
00:05:06,720 --> 00:05:10,650
doesn't<font color="#E5E5E5"> matter</font>

126
00:05:07,260 --> 00:05:12,960
and<font color="#CCCCCC"> the first step which is really</font>

127
00:05:10,650 --> 00:05:16,010
pretty obvious but again<font color="#E5E5E5"> I I see people</font>

128
00:05:12,960 --> 00:05:19,080
skip this sometimes but<font color="#E5E5E5"> LDAP utilities</font>

129
00:05:16,010 --> 00:05:21,630
tremendously useful for beginning<font color="#E5E5E5"> to</font>

130
00:05:19,080 --> 00:05:23,280
enumerate in<font color="#E5E5E5"> this case we're we're</font>

131
00:05:21,630 --> 00:05:26,190
binding against the user that we have

132
00:05:23,280 --> 00:05:30,780
<font color="#E5E5E5">some pretty common search base people</font>

133
00:05:26,190 --> 00:05:32,880
said<font color="#CCCCCC"> Mae's comm right</font><font color="#E5E5E5"> away we can</font><font color="#CCCCCC"> see in</font>

134
00:05:30,780 --> 00:05:34,770
this abbreviated list of<font color="#E5E5E5"> permissions and</font>

135
00:05:32,880 --> 00:05:38,310
groups<font color="#CCCCCC"> that this account that</font><font color="#E5E5E5"> we have</font>

136
00:05:34,770 --> 00:05:40,500
<font color="#E5E5E5">Alice is a developer does not have a</font>

137
00:05:38,310 --> 00:05:43,410
<font color="#CCCCCC">login shell which</font><font color="#E5E5E5"> is a good thing to</font>

138
00:05:40,500 --> 00:05:45,590
know<font color="#E5E5E5"> now because if we tried to</font><font color="#CCCCCC"> log into</font>

139
00:05:43,410 --> 00:05:47,940
one<font color="#E5E5E5"> of the servers</font><font color="#CCCCCC"> that we identified</font>

140
00:05:45,590 --> 00:05:49,469
not<font color="#CCCCCC"> only would we</font><font color="#E5E5E5"> get denied it would</font>

141
00:05:47,940 --> 00:05:51,600
also be a chance<font color="#E5E5E5"> for the blue team to</font>

142
00:05:49,470 --> 00:05:53,850
<font color="#E5E5E5">detect us an account that doesn't have</font>

143
00:05:51,600 --> 00:05:57,660
any business logging in is kind of a red

144
00:05:53,850 --> 00:05:58,919
<font color="#CCCCCC">flag but</font><font color="#E5E5E5"> the most important thing here</font>

145
00:05:57,660 --> 00:06:00,570
<font color="#CCCCCC">is we can see the groups that</font><font color="#E5E5E5"> this</font>

146
00:05:58,919 --> 00:06:03,900
account<font color="#E5E5E5"> is a member of in</font><font color="#CCCCCC"> particular the</font>

147
00:06:00,570 --> 00:06:07,020
Jenkins group and as your call we saw a

148
00:06:03,900 --> 00:06:08,130
Jenkins server<font color="#E5E5E5"> on the cert</font><font color="#CCCCCC"> SH scan so</font>

149
00:06:07,020 --> 00:06:11,460
that gives<font color="#E5E5E5"> us an excellent place to</font>

150
00:06:08,130 --> 00:06:13,290
<font color="#E5E5E5">start a Jenkins</font><font color="#CCCCCC"> I'm going to spend</font><font color="#E5E5E5"> a</font>

151
00:06:11,460 --> 00:06:15,330
little<font color="#CCCCCC"> bit</font><font color="#E5E5E5"> of time here</font><font color="#CCCCCC"> because it's a</font>

152
00:06:13,290 --> 00:06:18,540
tremendously popular<font color="#E5E5E5"> automation server</font>

153
00:06:15,330 --> 00:06:22,650
it's probably part<font color="#E5E5E5"> of the workflow of</font>

154
00:06:18,540 --> 00:06:24,419
<font color="#E5E5E5">many of the places you</font><font color="#CCCCCC"> guys work at it's</font>

155
00:06:22,650 --> 00:06:26,039
extremely easy to<font color="#E5E5E5"> miss configure and</font>

156
00:06:24,419 --> 00:06:27,479
development pipelines are notorious for

157
00:06:26,039 --> 00:06:29,460
yielding<font color="#CCCCCC"> that low hanging</font>

158
00:06:27,480 --> 00:06:31,320
there's many write-ups on exploiting

159
00:06:29,460 --> 00:06:34,469
<font color="#CCCCCC">Jenkins I'm not going</font><font color="#E5E5E5"> to spend a huge</font>

160
00:06:31,320 --> 00:06:36,240
amount<font color="#E5E5E5"> of time on all the many and</font>

161
00:06:34,470 --> 00:06:40,620
various interesting ways it can be

162
00:06:36,240 --> 00:06:42,300
misconfigured except that the the<font color="#E5E5E5"> worst</font>

163
00:06:40,620 --> 00:06:47,370
<font color="#E5E5E5">case scenario of course</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> completely</font>

164
00:06:42,300 --> 00:06:49,920
open server<font color="#CCCCCC"> where you can just run run</font>

165
00:06:47,370 --> 00:06:52,110
scripts<font color="#CCCCCC"> directly on the master just run</font>

166
00:06:49,920 --> 00:06:57,020
groovy code or whatever<font color="#CCCCCC"> just directly on</font>

167
00:06:52,110 --> 00:07:00,720
it<font color="#E5E5E5"> that's the worst case scenario and</font>

168
00:06:57,020 --> 00:07:03,719
it's not it's not<font color="#E5E5E5"> going to be the case</font>

169
00:07:00,720 --> 00:07:07,740
<font color="#CCCCCC">here</font><font color="#E5E5E5"> however so we're going to log in</font>

170
00:07:03,720 --> 00:07:11,460
using our using our Alice<font color="#E5E5E5"> user and see</font>

171
00:07:07,740 --> 00:07:13,710
what see what<font color="#E5E5E5"> we can find the first</font>

172
00:07:11,460 --> 00:07:16,849
thing to notice is what isn't<font color="#E5E5E5"> here in</font>

173
00:07:13,710 --> 00:07:19,169
particular<font color="#CCCCCC"> there's no</font><font color="#E5E5E5"> manage Jenkins</font>

174
00:07:16,850 --> 00:07:20,880
<font color="#CCCCCC">item in the left hand column</font><font color="#E5E5E5"> that</font>

175
00:07:19,170 --> 00:07:22,770
indicates we don't have Jenkins admin

176
00:07:20,880 --> 00:07:25,640
<font color="#E5E5E5">we're just an ordinary user on it you</font>

177
00:07:22,770 --> 00:07:29,190
see<font color="#CCCCCC"> several several</font><font color="#E5E5E5"> folders with jobs</font>

178
00:07:25,640 --> 00:07:31,440
<font color="#CCCCCC">it's a</font><font color="#E5E5E5"> platform check job this this</font>

179
00:07:29,190 --> 00:07:33,570
tells us we can probably<font color="#E5E5E5"> if we can build</font>

180
00:07:31,440 --> 00:07:35,940
this<font color="#CCCCCC"> then we can probably modify it and</font>

181
00:07:33,570 --> 00:07:38,430
therefore we<font color="#E5E5E5"> probably have shell access</font>

182
00:07:35,940 --> 00:07:41,430
<font color="#E5E5E5">on at least one server possibly even the</font>

183
00:07:38,430 --> 00:07:44,190
master take a look at it we<font color="#E5E5E5"> can</font><font color="#CCCCCC"> see that</font>

184
00:07:41,430 --> 00:07:47,280
<font color="#CCCCCC">yeah it</font><font color="#E5E5E5"> there's a build step that is</font>

185
00:07:44,190 --> 00:07:49,560
executing executing shell commands and

186
00:07:47,280 --> 00:07:52,950
we may even<font color="#E5E5E5"> have a limited amount of</font>

187
00:07:49,560 --> 00:07:55,350
<font color="#E5E5E5">pseudo access and so our next our next</font>

188
00:07:52,950 --> 00:07:57,690
<font color="#E5E5E5">goal is to</font><font color="#CCCCCC"> determine</font><font color="#E5E5E5"> where exactly we</font>

189
00:07:55,350 --> 00:08:00,510
have shell<font color="#E5E5E5"> where can we run this where</font>

190
00:07:57,690 --> 00:08:02,730
can we run this job if we just run<font color="#CCCCCC"> it</font>

191
00:08:00,510 --> 00:08:04,620
<font color="#E5E5E5">without without modifying it</font><font color="#CCCCCC"> and take a</font>

192
00:08:02,730 --> 00:08:07,590
look<font color="#CCCCCC"> at the console</font><font color="#E5E5E5"> output we</font><font color="#CCCCCC"> can see</font>

193
00:08:04,620 --> 00:08:10,430
this platform check job it's running DM

194
00:08:07,590 --> 00:08:14,729
ID code<font color="#CCCCCC"> yields</font><font color="#E5E5E5"> some information about</font>

195
00:08:10,430 --> 00:08:16,790
<font color="#E5E5E5">hardware DMI is kind of a it's an older</font>

196
00:08:14,730 --> 00:08:18,870
it's an older specification for

197
00:08:16,790 --> 00:08:21,660
classifying<font color="#E5E5E5"> hardware info it's been</font>

198
00:08:18,870 --> 00:08:25,130
replaced<font color="#CCCCCC"> but it's</font><font color="#E5E5E5"> still in use</font><font color="#CCCCCC"> and the</font>

199
00:08:21,660 --> 00:08:27,540
DM ID code<font color="#E5E5E5"> utility is still in place in</font>

200
00:08:25,130 --> 00:08:30,659
<font color="#E5E5E5">most Linux distributions</font><font color="#CCCCCC"> and this will</font>

201
00:08:27,540 --> 00:08:32,610
be important as we'll see in<font color="#E5E5E5"> a minute so</font>

202
00:08:30,660 --> 00:08:34,620
where<font color="#E5E5E5"> can we run this job we can see</font>

203
00:08:32,610 --> 00:08:36,630
that<font color="#E5E5E5"> on this server there are three</font>

204
00:08:34,620 --> 00:08:37,349
agents<font color="#E5E5E5"> configured the master as it's</font>

205
00:08:36,630 --> 00:08:40,439
<font color="#E5E5E5">always there</font>

206
00:08:37,349 --> 00:08:43,560
build and the<font color="#E5E5E5"> website</font><font color="#CCCCCC"> W</font>

207
00:08:40,440 --> 00:08:45,540
<font color="#E5E5E5">aw it's the</font><font color="#CCCCCC"> web</font><font color="#E5E5E5"> server the storefront</font>

208
00:08:43,559 --> 00:08:49,170
which we saw in<font color="#E5E5E5"> the original</font><font color="#CCCCCC"> network</font>

209
00:08:45,540 --> 00:08:52,280
infrastructure<font color="#E5E5E5"> diagram more to the point</font>

210
00:08:49,170 --> 00:08:57,630
we can<font color="#E5E5E5"> see in the left column the build</font>

211
00:08:52,280 --> 00:09:01,890
executor status only<font color="#CCCCCC"> has agents</font><font color="#E5E5E5"> for</font>

212
00:08:57,630 --> 00:09:03,630
build and<font color="#E5E5E5"> WWE apparently cannot run code</font>

213
00:09:01,890 --> 00:09:06,439
on<font color="#CCCCCC"> the master itself which</font><font color="#E5E5E5"> makes sense</font>

214
00:09:03,630 --> 00:09:10,110
<font color="#E5E5E5">as we saw it was</font><font color="#CCCCCC"> in the middle secure</font>

215
00:09:06,440 --> 00:09:13,110
<font color="#E5E5E5">row again in that diagram maybe we can</font>

216
00:09:10,110 --> 00:09:15,540
change<font color="#CCCCCC"> that though</font><font color="#E5E5E5"> well</font><font color="#CCCCCC"> no as it turns</font>

217
00:09:13,110 --> 00:09:17,910
out Alice is missing the agent configure

218
00:09:15,540 --> 00:09:20,310
permission<font color="#E5E5E5"> so this Jenkins server is</font>

219
00:09:17,910 --> 00:09:24,120
<font color="#E5E5E5">relatively locked down and we're not</font>

220
00:09:20,310 --> 00:09:27,810
<font color="#CCCCCC">actually able to to</font><font color="#E5E5E5"> run code wherever we</font>

221
00:09:24,120 --> 00:09:30,540
want<font color="#E5E5E5"> okay</font><font color="#CCCCCC"> so it's designed to be</font><font color="#E5E5E5"> run on</font>

222
00:09:27,810 --> 00:09:33,859
<font color="#CCCCCC">the build server</font><font color="#E5E5E5"> but can we run it on</font>

223
00:09:30,540 --> 00:09:36,870
WWE makes sense<font color="#E5E5E5"> the way</font><font color="#CCCCCC"> you check that</font>

224
00:09:33,860 --> 00:09:39,900
<font color="#CCCCCC">we can just configure the job</font><font color="#E5E5E5"> restrict</font>

225
00:09:36,870 --> 00:09:42,300
where<font color="#E5E5E5"> it can be run to only</font><font color="#CCCCCC"> WW and we'll</font>

226
00:09:39,900 --> 00:09:45,270
try building<font color="#E5E5E5"> it and unfortunately</font><font color="#CCCCCC"> we see</font>

227
00:09:42,300 --> 00:09:47,189
console output job failed<font color="#E5E5E5"> and you can</font>

228
00:09:45,270 --> 00:09:49,860
guess what happened here pretty<font color="#E5E5E5"> easily</font>

229
00:09:47,190 --> 00:09:52,980
we get a sudo prompt so it's pretty

230
00:09:49,860 --> 00:09:55,220
<font color="#E5E5E5">clear</font><font color="#CCCCCC"> that the</font><font color="#E5E5E5"> Jenkins user on</font><font color="#CCCCCC"> WWE</font>

231
00:09:52,980 --> 00:09:59,010
<font color="#E5E5E5">wallet exists as it was able</font><font color="#CCCCCC"> to log in</font>

232
00:09:55,220 --> 00:10:00,870
it failed<font color="#CCCCCC"> to execute</font><font color="#E5E5E5"> sudo so either it</font>

233
00:09:59,010 --> 00:10:02,520
requires a<font color="#CCCCCC"> password or it's not</font>

234
00:10:00,870 --> 00:10:04,620
<font color="#E5E5E5">configured at all</font><font color="#CCCCCC"> and of course the</font>

235
00:10:02,520 --> 00:10:07,199
worst case here is we may have gotten

236
00:10:04,620 --> 00:10:09,210
<font color="#CCCCCC">caught</font><font color="#E5E5E5"> because we just tried</font><font color="#CCCCCC"> to run sudo</font>

237
00:10:07,200 --> 00:10:12,330
on a server<font color="#CCCCCC"> that wasn't configured to</font>

238
00:10:09,210 --> 00:10:12,810
<font color="#E5E5E5">expect this so maybe this wasn't a great</font>

239
00:10:12,330 --> 00:10:14,940
idea

240
00:10:12,810 --> 00:10:18,900
we need<font color="#E5E5E5"> another</font><font color="#CCCCCC"> method to</font><font color="#E5E5E5"> get root or</font>

241
00:10:14,940 --> 00:10:22,380
even to get root on WWE do have the

242
00:10:18,900 --> 00:10:24,569
shell on it so for that we're going<font color="#E5E5E5"> to</font>

243
00:10:22,380 --> 00:10:27,180
<font color="#E5E5E5">need privilege escalation on the build</font>

244
00:10:24,570 --> 00:10:29,460
server<font color="#CCCCCC"> and use that to pivot into a</font>

245
00:10:27,180 --> 00:10:32,939
domain account<font color="#E5E5E5"> that will let</font><font color="#CCCCCC"> us login to</font>

246
00:10:29,460 --> 00:10:35,730
the www server how do we do that this

247
00:10:32,940 --> 00:10:37,770
brings us<font color="#CCCCCC"> to a DMI exploit this</font><font color="#E5E5E5"> is my</font>

248
00:10:35,730 --> 00:10:40,400
favorite<font color="#E5E5E5"> part of red teaming it's custom</font>

249
00:10:37,770 --> 00:10:43,640
exploit development<font color="#E5E5E5"> now this isn't a</font>

250
00:10:40,400 --> 00:10:48,360
vulnerability<font color="#CCCCCC"> and DM ID code per sell</font>

251
00:10:43,640 --> 00:10:50,439
<font color="#E5E5E5">itself per se Speaking</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> hard</font><font color="#CCCCCC"> this is a</font>

252
00:10:48,360 --> 00:10:52,329
<font color="#CCCCCC">site-specific</font>

253
00:10:50,440 --> 00:10:54,519
there's a<font color="#E5E5E5"> site-specific configuration</font>

254
00:10:52,329 --> 00:10:57,969
weakness<font color="#E5E5E5"> that takes</font><font color="#CCCCCC"> advantage of</font><font color="#E5E5E5"> the</font>

255
00:10:54,519 --> 00:11:00,339
fact<font color="#CCCCCC"> that</font><font color="#E5E5E5"> the pseudo configuration on</font>

256
00:10:57,970 --> 00:11:02,680
these servers<font color="#E5E5E5"> allows you to run DM ID</font>

257
00:11:00,339 --> 00:11:04,750
code with any arguments you specify<font color="#E5E5E5"> what</font>

258
00:11:02,680 --> 00:11:08,079
I discovered<font color="#E5E5E5"> on this engagement is that</font>

259
00:11:04,750 --> 00:11:10,300
a crafted DMI table allows<font color="#CCCCCC"> you arbitrary</font>

260
00:11:08,079 --> 00:11:14,019
file right and therefore<font color="#E5E5E5"> pseudo DM ID</font>

261
00:11:10,300 --> 00:11:15,430
<font color="#E5E5E5">code gives you a brute escalation so</font>

262
00:11:14,019 --> 00:11:19,209
what does this<font color="#E5E5E5"> look</font><font color="#CCCCCC"> like</font><font color="#E5E5E5"> the conditions</font>

263
00:11:15,430 --> 00:11:21,430
<font color="#E5E5E5">to execute this attack are a pseudo</font><font color="#CCCCCC"> L</font><font color="#E5E5E5"> we</font>

264
00:11:19,209 --> 00:11:23,170
need to be able<font color="#E5E5E5"> to run DM ID code and we</font>

265
00:11:21,430 --> 00:11:27,128
need to be able<font color="#E5E5E5"> to specify arguments</font>

266
00:11:23,170 --> 00:11:30,550
that we<font color="#CCCCCC"> have are choosing no password</font>

267
00:11:27,129 --> 00:11:35,920
isn't<font color="#E5E5E5"> required</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> in this case</font><font color="#CCCCCC"> we kind</font>

268
00:11:30,550 --> 00:11:37,569
of need it for using it on Jenkins<font color="#E5E5E5"> so</font>

269
00:11:35,920 --> 00:11:39,849
what<font color="#E5E5E5"> does this actually</font><font color="#CCCCCC"> look like</font><font color="#E5E5E5"> the</font>

270
00:11:37,569 --> 00:11:42,370
exploit is very simple DM ID code is

271
00:11:39,850 --> 00:11:45,040
designed to read the system<font color="#E5E5E5"> hardware</font>

272
00:11:42,370 --> 00:11:48,579
information<font color="#CCCCCC"> and the way it</font><font color="#E5E5E5"> does that by</font>

273
00:11:45,040 --> 00:11:50,829
default<font color="#CCCCCC"> is it just accesses dev mem</font><font color="#E5E5E5"> and</font>

274
00:11:48,579 --> 00:11:54,880
looks for certain<font color="#E5E5E5"> patterns in particular</font>

275
00:11:50,829 --> 00:11:59,469
<font color="#E5E5E5">the underscore</font><font color="#CCCCCC"> sm underscore is one kind</font>

276
00:11:54,880 --> 00:12:04,050
<font color="#E5E5E5">of magic</font><font color="#CCCCCC"> ward that begins the the header</font>

277
00:11:59,470 --> 00:12:07,540
for the<font color="#CCCCCC"> bios and what we can do here is</font>

278
00:12:04,050 --> 00:12:10,660
this tool<font color="#E5E5E5"> that I wrote</font><font color="#CCCCCC"> called</font><font color="#E5E5E5"> DM I</font><font color="#CCCCCC"> write</font>

279
00:12:07,540 --> 00:12:13,899
will craft a<font color="#E5E5E5"> DM I file based on an input</font>

280
00:12:10,660 --> 00:12:19,839
file<font color="#E5E5E5"> and when that file is read by DM ID</font>

281
00:12:13,899 --> 00:12:23,649
code it will<font color="#CCCCCC"> output a DM</font><font color="#E5E5E5"> I file it</font><font color="#CCCCCC"> has a</font>

282
00:12:19,839 --> 00:12:26,980
dump bin option that allows<font color="#E5E5E5"> you</font><font color="#CCCCCC"> to dump</font>

283
00:12:23,649 --> 00:12:30,370
the output of<font color="#E5E5E5"> it and when that</font><font color="#CCCCCC"> Trojan</font>

284
00:12:26,980 --> 00:12:32,399
file is dumped<font color="#E5E5E5"> it will be identical to</font>

285
00:12:30,370 --> 00:12:34,990
the file that<font color="#CCCCCC"> we passed in the input</font>

286
00:12:32,399 --> 00:12:37,540
with one annoying exception it's

287
00:12:34,990 --> 00:12:39,639
prepended by a header which the most

288
00:12:37,540 --> 00:12:45,219
<font color="#CCCCCC">i've been able to do with it is make</font><font color="#E5E5E5"> 32</font>

289
00:12:39,639 --> 00:12:46,870
no bytes<font color="#E5E5E5"> at the beginning it's annoying</font>

290
00:12:45,220 --> 00:12:49,750
<font color="#E5E5E5">but fortunately it doesn't actually</font>

291
00:12:46,870 --> 00:12:52,569
interfere with all avenues<font color="#CCCCCC"> of privilege</font>

292
00:12:49,750 --> 00:12:56,910
escalation so that's what the exploit

293
00:12:52,569 --> 00:12:59,589
looks like<font color="#CCCCCC"> say</font><font color="#E5E5E5"> generates a DM</font><font color="#CCCCCC"> I file</font>

294
00:12:56,910 --> 00:13:02,230
containing a table<font color="#E5E5E5"> that we can then</font><font color="#CCCCCC"> use</font>

295
00:12:59,589 --> 00:13:03,940
we can load that<font color="#CCCCCC"> onto</font><font color="#E5E5E5"> our target system</font>

296
00:13:02,230 --> 00:13:08,200
<font color="#E5E5E5">using some some man</font>

297
00:13:03,940 --> 00:13:11,470
and we can<font color="#E5E5E5"> then</font><font color="#CCCCCC"> use DM</font><font color="#E5E5E5"> ID code to read</font>

298
00:13:08,200 --> 00:13:13,270
that<font color="#E5E5E5"> as a memory file and dump it to an</font>

299
00:13:11,470 --> 00:13:17,040
arbitrary file we specify<font color="#E5E5E5"> using our</font>

300
00:13:13,270 --> 00:13:19,960
<font color="#E5E5E5">pseudo access what that looks like is</font>

301
00:13:17,040 --> 00:13:23,530
notice now instead of<font color="#E5E5E5"> being</font><font color="#CCCCCC"> on the our</font>

302
00:13:19,960 --> 00:13:26,320
home server were on the build<font color="#E5E5E5"> server or</font>

303
00:13:23,530 --> 00:13:29,829
I'm sorry<font color="#E5E5E5"> the target server we runs DM</font>

304
00:13:26,320 --> 00:13:31,060
ID code<font color="#CCCCCC"> no sis FS that</font><font color="#E5E5E5"> that may or may</font>

305
00:13:29,830 --> 00:13:33,310
not be something you<font color="#E5E5E5"> need to use</font>

306
00:13:31,060 --> 00:13:37,329
depending<font color="#E5E5E5"> on the version of DM ID code</font>

307
00:13:33,310 --> 00:13:40,989
you have just tells us<font color="#E5E5E5"> we want to use</font>

308
00:13:37,330 --> 00:13:43,600
the<font color="#CCCCCC"> - D temp crafted DMI as our memory</font>

309
00:13:40,990 --> 00:13:46,900
device<font color="#E5E5E5"> rather</font><font color="#CCCCCC"> than reading</font><font color="#E5E5E5"> from dev mem</font>

310
00:13:43,600 --> 00:13:49,180
<font color="#E5E5E5">or from sis FS and our dump bin is at C</font>

311
00:13:46,900 --> 00:13:52,300
passwd<font color="#E5E5E5"> and of course what we've done in</font>

312
00:13:49,180 --> 00:13:55,810
<font color="#E5E5E5">our in our</font><font color="#CCCCCC"> trojan version of that that</font>

313
00:13:52,300 --> 00:14:00,849
<font color="#CCCCCC">we've created</font><font color="#E5E5E5"> what is in crafted DMI is</font>

314
00:13:55,810 --> 00:14:02,410
we've set the Jenkins<font color="#E5E5E5"> user to UID 0 so</font>

315
00:14:00,850 --> 00:14:05,130
<font color="#E5E5E5">it's route equivalent now of course</font>

316
00:14:02,410 --> 00:14:09,310
there's many<font color="#E5E5E5"> ways to leverage a</font>

317
00:14:05,130 --> 00:14:13,900
arbitrary<font color="#E5E5E5"> file right into root access</font>

318
00:14:09,310 --> 00:14:15,640
<font color="#E5E5E5">and some of them are more detectable</font>

319
00:14:13,900 --> 00:14:17,470
than others again that's kind of

320
00:14:15,640 --> 00:14:20,140
something<font color="#E5E5E5"> that's site-specific and</font>

321
00:14:17,470 --> 00:14:22,870
<font color="#E5E5E5">you'll need to examine what what kind of</font>

322
00:14:20,140 --> 00:14:24,490
countermeasures<font color="#CCCCCC"> you I'm going to be up</font>

323
00:14:22,870 --> 00:14:27,760
against and what's least likely to be

324
00:14:24,490 --> 00:14:29,230
<font color="#E5E5E5">detected</font><font color="#CCCCCC"> of course you can also add SSH</font>

325
00:14:27,760 --> 00:14:32,020
keys and all that kind of thing

326
00:14:29,230 --> 00:14:34,810
<font color="#E5E5E5">I just looked up dirty cow pox for ideas</font>

327
00:14:32,020 --> 00:14:38,740
since<font color="#E5E5E5"> that is kind of a notorious file</font>

328
00:14:34,810 --> 00:14:40,869
right<font color="#CCCCCC"> so this is what it looks like</font><font color="#E5E5E5"> when</font>

329
00:14:38,740 --> 00:14:43,920
you have<font color="#E5E5E5"> properly exploited the</font>

330
00:14:40,870 --> 00:14:48,160
vulnerability there's<font color="#CCCCCC"> two fw right calls</font>

331
00:14:43,920 --> 00:14:50,829
the first<font color="#E5E5E5"> one will write number of bytes</font>

332
00:14:48,160 --> 00:14:53,829
of the file<font color="#E5E5E5"> and the second one will look</font>

333
00:14:50,830 --> 00:14:55,210
like it failed that's just because<font color="#E5E5E5"> it's</font>

334
00:14:53,830 --> 00:14:57,610
trying<font color="#E5E5E5"> to write an empty header to it</font>

335
00:14:55,210 --> 00:14:59,560
and it'll just<font color="#CCCCCC"> write 32 dolls instead so</font>

336
00:14:57,610 --> 00:15:02,380
<font color="#E5E5E5">we do that we log back in because</font><font color="#CCCCCC"> again</font>

337
00:14:59,560 --> 00:15:07,479
kind of annoyingly<font color="#CCCCCC"> we need to re log in</font>

338
00:15:02,380 --> 00:15:10,390
to actually see the results<font color="#CCCCCC"> of the UID</font>

339
00:15:07,480 --> 00:15:13,390
change<font color="#E5E5E5"> we do ID as the Jenkins user and</font>

340
00:15:10,390 --> 00:15:15,250
we can see<font color="#CCCCCC"> where UID 0</font><font color="#E5E5E5"> where</font><font color="#CCCCCC"> we're</font>

341
00:15:13,390 --> 00:15:19,900
Jenkins but we have root yeah

342
00:15:15,250 --> 00:15:22,750
permissions kind<font color="#E5E5E5"> of a just a note</font><font color="#CCCCCC"> on the</font>

343
00:15:19,900 --> 00:15:26,579
what it looks like technically<font color="#E5E5E5"> when you</font>

344
00:15:22,750 --> 00:15:29,260
are running the DM ID code this is

345
00:15:26,580 --> 00:15:32,080
obviously a stack trace at the<font color="#E5E5E5"> right</font>

346
00:15:29,260 --> 00:15:35,680
dump<font color="#E5E5E5"> time and we're overriding at</font><font color="#CCCCCC"> C</font>

347
00:15:32,080 --> 00:15:39,310
passwd<font color="#E5E5E5"> you can see that's our dump file</font>

348
00:15:35,680 --> 00:15:40,959
<font color="#E5E5E5">and to get there we came from DMI table</font>

349
00:15:39,310 --> 00:15:44,319
dump we're dumping a<font color="#E5E5E5"> DMI table that</font>

350
00:15:40,960 --> 00:15:47,920
begins with<font color="#CCCCCC"> newline root that's not</font>

351
00:15:44,320 --> 00:15:49,960
suspicious<font color="#E5E5E5"> at all the new line actually</font>

352
00:15:47,920 --> 00:15:53,349
<font color="#E5E5E5">is</font><font color="#CCCCCC"> really important to</font><font color="#E5E5E5"> make sure that</font>

353
00:15:49,960 --> 00:15:55,420
it's at<font color="#CCCCCC"> C passwd is going to be</font>

354
00:15:53,350 --> 00:15:57,040
interpreted properly even though it's

355
00:15:55,420 --> 00:16:02,650
kind<font color="#CCCCCC"> of malformed at this point</font>

356
00:15:57,040 --> 00:16:05,110
beginning with<font color="#E5E5E5"> 32 null characters and</font>

357
00:16:02,650 --> 00:16:09,939
here's the<font color="#CCCCCC"> the second the second dump</font>

358
00:16:05,110 --> 00:16:14,170
that yeah is the<font color="#E5E5E5"> 32 32 nulls and</font><font color="#CCCCCC"> I've</font>

359
00:16:09,940 --> 00:16:17,020
not<font color="#CCCCCC"> found a</font><font color="#E5E5E5"> way</font><font color="#CCCCCC"> to avoid avoid</font><font color="#E5E5E5"> this so</font>

360
00:16:14,170 --> 00:16:23,770
it does limit the the<font color="#CCCCCC"> number of ways you</font>

361
00:16:17,020 --> 00:16:26,470
<font color="#CCCCCC">can</font><font color="#E5E5E5"> actually escalate set UID</font><font color="#CCCCCC"> is</font>

362
00:16:23,770 --> 00:16:30,189
primarily what's kind<font color="#E5E5E5"> of off-limits to</font>

363
00:16:26,470 --> 00:16:36,400
us<font color="#E5E5E5"> at this</font><font color="#CCCCCC"> point</font><font color="#E5E5E5"> if anyone has a way</font>

364
00:16:30,190 --> 00:16:37,930
that we can make a<font color="#E5E5E5"> binary that yeah it's</font>

365
00:16:36,400 --> 00:16:42,730
probably<font color="#E5E5E5"> probably not</font><font color="#CCCCCC"> feasible if it</font>

366
00:16:37,930 --> 00:16:43,689
begins with nulls<font color="#CCCCCC"> anyway</font><font color="#E5E5E5"> we're going to</font>

367
00:16:42,730 --> 00:16:46,540
<font color="#E5E5E5">enumerate whether this is actually</font>

368
00:16:43,690 --> 00:16:50,470
<font color="#CCCCCC">possible</font><font color="#E5E5E5"> on our target system we'll just</font>

369
00:16:46,540 --> 00:16:53,920
modify<font color="#E5E5E5"> the job</font><font color="#CCCCCC"> studio</font><font color="#E5E5E5"> l to see if we</font>

370
00:16:50,470 --> 00:16:57,370
<font color="#CCCCCC">actually</font><font color="#E5E5E5"> can specify any arguments we</font>

371
00:16:53,920 --> 00:17:01,560
want on here this<font color="#CCCCCC"> is a tactic that I</font>

372
00:16:57,370 --> 00:17:04,329
love post build steps on Jenkins servers

373
00:17:01,560 --> 00:17:06,929
<font color="#E5E5E5">is because it lets you let's let C run</font>

374
00:17:04,329 --> 00:17:10,209
shell commands<font color="#E5E5E5"> and there's not a history</font>

375
00:17:06,930 --> 00:17:12,100
maintained on it<font color="#CCCCCC"> obviously it can be</font>

376
00:17:10,209 --> 00:17:14,680
monitored in<font color="#E5E5E5"> other ways and of course</font>

377
00:17:12,099 --> 00:17:17,438
the<font color="#CCCCCC"> sudo is going to be logged</font><font color="#E5E5E5"> anyway</font>

378
00:17:14,680 --> 00:17:19,630
the console output<font color="#E5E5E5"> as it turns out it's</font>

379
00:17:17,439 --> 00:17:21,850
<font color="#CCCCCC">like this and</font><font color="#E5E5E5"> we see</font><font color="#CCCCCC"> that we can't</font>

380
00:17:19,630 --> 00:17:24,910
indeed run DM ID code with any arguments

381
00:17:21,849 --> 00:17:27,369
we want so<font color="#E5E5E5"> conditions are green all</font>

382
00:17:24,910 --> 00:17:29,860
<font color="#E5E5E5">systems go</font>

383
00:17:27,369 --> 00:17:34,090
or modified build steps look<font color="#CCCCCC"> like this</font>

384
00:17:29,860 --> 00:17:37,179
we<font color="#E5E5E5"> fetch</font><font color="#CCCCCC"> or troj into</font><font color="#E5E5E5"> DM I file from</font>

385
00:17:34,090 --> 00:17:39,699
some drop server<font color="#CCCCCC"> we run the command</font><font color="#E5E5E5"> and</font>

386
00:17:37,180 --> 00:17:44,290
we<font color="#CCCCCC"> remove the evidence</font><font color="#E5E5E5"> that we were</font>

387
00:17:39,700 --> 00:17:47,559
there<font color="#E5E5E5"> console output looks the same as</font>

388
00:17:44,290 --> 00:17:52,770
<font color="#E5E5E5">it did when we ran it in our</font><font color="#CCCCCC"> test at C</font>

389
00:17:47,559 --> 00:17:56,399
<font color="#CCCCCC">past WDFW right so now at this point</font>

390
00:17:52,770 --> 00:17:58,780
Jenkins user should<font color="#CCCCCC"> be routed equivalent</font>

391
00:17:56,400 --> 00:18:01,960
on the<font color="#E5E5E5"> build server which means that</font>

392
00:17:58,780 --> 00:18:04,510
we're route equivalent<font color="#E5E5E5"> so now we can</font>

393
00:18:01,960 --> 00:18:07,600
just<font color="#CCCCCC"> go nuts</font><font color="#E5E5E5"> and loot the server and</font>

394
00:18:04,510 --> 00:18:10,410
move on<font color="#E5E5E5"> to to the to the next step right</font>

395
00:18:07,600 --> 00:18:13,629
<font color="#E5E5E5">well not so fast</font>

396
00:18:10,410 --> 00:18:15,190
<font color="#E5E5E5">yeah there's no passwords and Etsy</font>

397
00:18:13,630 --> 00:18:18,390
<font color="#E5E5E5">shadow</font><font color="#CCCCCC"> all</font><font color="#E5E5E5"> the private keys are</font>

398
00:18:15,190 --> 00:18:21,400
encrypted<font color="#E5E5E5"> because</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> you know PCI DSS</font>

399
00:18:18,390 --> 00:18:23,890
<font color="#E5E5E5">and this general awareness of the risks</font>

400
00:18:21,400 --> 00:18:26,230
of keeping<font color="#E5E5E5"> secrets on disk it's becoming</font>

401
00:18:23,890 --> 00:18:27,910
less and less common<font color="#CCCCCC"> for</font><font color="#E5E5E5"> people to do</font>

402
00:18:26,230 --> 00:18:31,570
<font color="#CCCCCC">that so we're going</font><font color="#E5E5E5"> to need to up our</font>

403
00:18:27,910 --> 00:18:33,490
game<font color="#E5E5E5"> we're not always it just you can</font>

404
00:18:31,570 --> 00:18:36,070
just loot and get out we're<font color="#CCCCCC"> gonna</font>

405
00:18:33,490 --> 00:18:37,960
<font color="#E5E5E5">actually</font><font color="#CCCCCC"> need to run</font><font color="#E5E5E5"> some kind of code</font>

406
00:18:36,070 --> 00:18:41,530
on here<font color="#CCCCCC"> that</font><font color="#E5E5E5"> is going to</font><font color="#CCCCCC"> persist and</font>

407
00:18:37,960 --> 00:18:43,750
<font color="#E5E5E5">either Trojan a binary key log something</font>

408
00:18:41,530 --> 00:18:45,879
<font color="#CCCCCC">we're gonna we're going to need to leave</font>

409
00:18:43,750 --> 00:18:48,220
some<font color="#CCCCCC"> kind of persistence on here to</font><font color="#E5E5E5"> get</font>

410
00:18:45,880 --> 00:18:50,170
anywhere<font color="#CCCCCC"> and this just got worse because</font>

411
00:18:48,220 --> 00:18:53,340
<font color="#E5E5E5">when we check the process list we can</font>

412
00:18:50,170 --> 00:18:56,710
<font color="#CCCCCC">see evidence</font><font color="#E5E5E5"> clear evidence of</font><font color="#CCCCCC"> HIDs</font>

413
00:18:53,340 --> 00:18:58,928
<font color="#E5E5E5">we've got</font><font color="#CCCCCC"> two</font><font color="#E5E5E5"> endpoint agents that are</font>

414
00:18:56,710 --> 00:19:03,790
<font color="#E5E5E5">running on here we can see OSS SEC agent</font>

415
00:18:58,929 --> 00:19:05,860
D and<font color="#CCCCCC"> rapid7 shout-out</font><font color="#E5E5E5"> IR agent so this</font>

416
00:19:03,790 --> 00:19:10,840
server is clearly going<font color="#E5E5E5"> to tattle on us</font>

417
00:19:05,860 --> 00:19:14,309
<font color="#CCCCCC">to to the EDR sim console</font><font color="#E5E5E5"> if we muck</font>

418
00:19:10,840 --> 00:19:19,600
about<font color="#E5E5E5"> on it and if it goes dark</font><font color="#CCCCCC"> then</font>

419
00:19:14,309 --> 00:19:21,460
then we're<font color="#CCCCCC"> on a clock and again</font>

420
00:19:19,600 --> 00:19:23,379
one of the other things<font color="#CCCCCC"> that we</font><font color="#E5E5E5"> could</font>

421
00:19:21,460 --> 00:19:26,380
just<font color="#E5E5E5"> run up against here that could set</font>

422
00:19:23,380 --> 00:19:28,180
off alarm bells<font color="#E5E5E5"> is file integrity if we</font>

423
00:19:26,380 --> 00:19:30,910
start modifying<font color="#E5E5E5"> files and in fact since</font>

424
00:19:28,180 --> 00:19:32,590
<font color="#CCCCCC">we modified passwd this we could already</font>

425
00:19:30,910 --> 00:19:34,900
<font color="#E5E5E5">have been caught at this point so both</font>

426
00:19:32,590 --> 00:19:41,230
speed and<font color="#CCCCCC"> stealth are critical from this</font>

427
00:19:34,900 --> 00:19:43,620
point onward so this brings us<font color="#E5E5E5"> to a</font>

428
00:19:41,230 --> 00:19:45,610
<font color="#E5E5E5">topic I like</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> call offensive forensics</font>

429
00:19:43,620 --> 00:19:52,149
<font color="#CCCCCC">honestly</font><font color="#E5E5E5"> just</font><font color="#CCCCCC"> because it</font><font color="#E5E5E5"> sounds</font><font color="#CCCCCC"> cool and</font>

430
00:19:45,610 --> 00:19:54,370
<font color="#E5E5E5">badass but seriously though it it's</font>

431
00:19:52,150 --> 00:19:57,340
because of the remarkable<font color="#E5E5E5"> overlap</font>

432
00:19:54,370 --> 00:19:59,590
between red and blue team<font color="#E5E5E5"> technologies</font>

433
00:19:57,340 --> 00:20:01,659
when you think<font color="#CCCCCC"> about it these</font><font color="#E5E5E5"> Incident</font>

434
00:19:59,590 --> 00:20:05,199
<font color="#E5E5E5">Response toolkits like grr or whatever</font>

435
00:20:01,660 --> 00:20:08,320
<font color="#E5E5E5">Rapid Response they're essentially just</font>

436
00:20:05,200 --> 00:20:12,040
<font color="#CCCCCC">c2 infrastructure that's not optimized</font>

437
00:20:08,320 --> 00:20:15,340
<font color="#E5E5E5">for stealth so this brings us</font><font color="#CCCCCC"> to one of</font>

438
00:20:12,040 --> 00:20:18,100
my<font color="#E5E5E5"> favorite tools for just quickly going</font>

439
00:20:15,340 --> 00:20:19,780
<font color="#E5E5E5">onto a box and seeing seeing what active</font>

440
00:20:18,100 --> 00:20:20,830
processes are doing she's gonna be

441
00:20:19,780 --> 00:20:23,740
familiar<font color="#CCCCCC"> to many of</font><font color="#E5E5E5"> you</font>

442
00:20:20,830 --> 00:20:25,360
s trace<font color="#CCCCCC"> it's because it's it's</font>

443
00:20:23,740 --> 00:20:28,420
tremendously useful for targeting

444
00:20:25,360 --> 00:20:33,159
targeting memory and<font color="#E5E5E5"> just whatever a</font>

445
00:20:28,420 --> 00:20:34,840
<font color="#CCCCCC">particular process is</font><font color="#E5E5E5"> doing you can get</font>

446
00:20:33,160 --> 00:20:37,180
a remarkable amount of insight into it

447
00:20:34,840 --> 00:20:41,290
<font color="#CCCCCC">just you know beyond beyond encryption</font>

448
00:20:37,180 --> 00:20:43,180
now the weaknesses of this are gonna be

449
00:20:41,290 --> 00:20:45,970
that<font color="#CCCCCC"> yeah if someone's logging in with</font>

450
00:20:43,180 --> 00:20:48,400
SSH keys or one-time passwords<font color="#CCCCCC"> yeah it's</font>

451
00:20:45,970 --> 00:20:50,920
not<font color="#E5E5E5"> going to be quite as helpful because</font>

452
00:20:48,400 --> 00:20:52,990
<font color="#E5E5E5">I'm like a debugger it's entirely it's</font>

453
00:20:50,920 --> 00:20:55,480
entirely<font color="#CCCCCC"> passive</font><font color="#E5E5E5"> at least if we use the</font>

454
00:20:52,990 --> 00:20:57,190
<font color="#E5E5E5">off-the-shelf version I like to call</font><font color="#CCCCCC"> s</font>

455
00:20:55,480 --> 00:20:59,530
trace<font color="#CCCCCC"> the Swiss Army</font><font color="#E5E5E5"> microscope of</font>

456
00:20:57,190 --> 00:21:02,290
process inspection microscope is

457
00:20:59,530 --> 00:21:03,970
distinct from knife because<font color="#CCCCCC"> again it's</font>

458
00:21:02,290 --> 00:21:07,330
<font color="#E5E5E5">it's passive we're not going to be able</font>

459
00:21:03,970 --> 00:21:09,160
<font color="#E5E5E5">to to just start cutting up the process</font>

460
00:21:07,330 --> 00:21:12,370
and<font color="#CCCCCC"> actually man in the middle</font><font color="#E5E5E5"> and yet</font>

461
00:21:09,160 --> 00:21:17,830
it's P trace under the hood<font color="#CCCCCC"> again</font><font color="#E5E5E5"> not</font>

462
00:21:12,370 --> 00:21:19,959
not<font color="#E5E5E5"> any revelations there and advantages</font>

463
00:21:17,830 --> 00:21:23,649
of using s trace is just your first stop

464
00:21:19,960 --> 00:21:26,050
<font color="#CCCCCC">for examining running</font><font color="#E5E5E5"> processes and</font>

465
00:21:23,650 --> 00:21:28,780
grabbing secrets from them<font color="#CCCCCC"> it's mature</font>

466
00:21:26,050 --> 00:21:31,149
<font color="#E5E5E5">stable and well supported</font><font color="#CCCCCC"> and it's</font>

467
00:21:28,780 --> 00:21:34,210
frequently present by default

468
00:21:31,149 --> 00:21:34,978
cons of using<font color="#E5E5E5"> it it's it</font><font color="#CCCCCC"> looks</font>

469
00:21:34,210 --> 00:21:39,729
suspicious

470
00:21:34,979 --> 00:21:44,259
<font color="#CCCCCC">yearning</font><font color="#E5E5E5"> s trace and the SSH process ID</font>

471
00:21:39,729 --> 00:21:47,289
is in the<font color="#E5E5E5"> process</font><font color="#CCCCCC"> list on it that is</font>

472
00:21:44,259 --> 00:21:49,690
kind of an<font color="#E5E5E5"> alarm bell again off the</font>

473
00:21:47,289 --> 00:21:53,019
<font color="#E5E5E5">shelf</font><font color="#CCCCCC"> s trace is only useful useful for</font>

474
00:21:49,690 --> 00:21:55,690
a passive interception<font color="#CCCCCC"> and it the</font>

475
00:21:53,019 --> 00:21:57,789
<font color="#CCCCCC">flipside of</font><font color="#E5E5E5"> being mature stable and well</font>

476
00:21:55,690 --> 00:21:59,499
<font color="#CCCCCC">supported is that it's</font><font color="#E5E5E5"> well known the</font>

477
00:21:57,789 --> 00:22:02,259
risks<font color="#CCCCCC"> of it now</font><font color="#E5E5E5"> and it's frequently</font>

478
00:21:59,499 --> 00:22:03,609
denied by either the<font color="#CCCCCC"> yama</font><font color="#E5E5E5"> security</font>

479
00:22:02,259 --> 00:22:05,889
module or if you're unfortunate enough

480
00:22:03,609 --> 00:22:09,249
<font color="#CCCCCC">to be up against SELinux it's also</font>

481
00:22:05,889 --> 00:22:12,070
deniable by that let's<font color="#E5E5E5"> take a look at</font>

482
00:22:09,249 --> 00:22:15,190
just<font color="#E5E5E5"> a basic use case of s trace for</font>

483
00:22:12,070 --> 00:22:16,689
reading<font color="#CCCCCC"> ssh passwords</font><font color="#E5E5E5"> again the context</font>

484
00:22:15,190 --> 00:22:18,399
for this is<font color="#E5E5E5"> we're trying to pivot</font><font color="#CCCCCC"> from</font>

485
00:22:16,690 --> 00:22:20,259
the build<font color="#E5E5E5"> server that we have root on</font>

486
00:22:18,399 --> 00:22:23,799
we're trying<font color="#CCCCCC"> to gain a domain</font><font color="#E5E5E5"> account</font>

487
00:22:20,259 --> 00:22:26,019
that is logging<font color="#CCCCCC"> into here</font><font color="#E5E5E5"> that's also</font>

488
00:22:23,799 --> 00:22:28,029
<font color="#E5E5E5">logging into another server so that</font><font color="#CCCCCC"> we</font>

489
00:22:26,019 --> 00:22:29,200
can actually get off<font color="#E5E5E5"> this box and do</font>

490
00:22:28,029 --> 00:22:33,249
<font color="#E5E5E5">something useful that's going to</font>

491
00:22:29,200 --> 00:22:36,879
demonstrate business impact so we<font color="#CCCCCC"> run as</font>

492
00:22:33,249 --> 00:22:40,149
trace against the<font color="#CCCCCC"> SSH process the pit</font>

493
00:22:36,879 --> 00:22:42,549
<font color="#E5E5E5">that it specifies there we want to trace</font>

494
00:22:40,149 --> 00:22:45,218
<font color="#E5E5E5">all read sis calls and we want to follow</font>

495
00:22:42,549 --> 00:22:47,950
the<font color="#CCCCCC"> child</font><font color="#E5E5E5"> processes that the SSH daemon</font>

496
00:22:45,219 --> 00:22:49,960
<font color="#E5E5E5">spawns</font><font color="#CCCCCC"> it's very important because</font><font color="#E5E5E5"> many</font>

497
00:22:47,950 --> 00:22:52,779
processes<font color="#E5E5E5"> aren't going to just you know</font>

498
00:22:49,960 --> 00:22:54,039
handle<font color="#E5E5E5"> everything on their</font><font color="#CCCCCC"> own</font><font color="#E5E5E5"> when we</font>

499
00:22:52,779 --> 00:22:56,649
do this we need<font color="#CCCCCC"> to</font><font color="#E5E5E5"> be prepared for an</font>

500
00:22:54,039 --> 00:22:59,529
avalanche<font color="#E5E5E5"> of output we're going to see</font>

501
00:22:56,649 --> 00:23:01,209
many<font color="#E5E5E5"> many lines of useless garbage and</font>

502
00:22:59,529 --> 00:23:02,950
generate a fair<font color="#CCCCCC"> amount of network</font>

503
00:23:01,210 --> 00:23:08,830
<font color="#E5E5E5">traffic in the process so be on</font><font color="#CCCCCC"> guard</font>

504
00:23:02,950 --> 00:23:11,559
against<font color="#CCCCCC"> that as well yeah eventually we</font>

505
00:23:08,830 --> 00:23:13,299
<font color="#E5E5E5">come across a</font><font color="#CCCCCC"> username</font><font color="#E5E5E5"> here</font><font color="#CCCCCC"> the Osiris</font>

506
00:23:11,559 --> 00:23:15,519
account<font color="#E5E5E5"> which will turn out</font><font color="#CCCCCC"> to be</font><font color="#E5E5E5"> a</font>

507
00:23:13,299 --> 00:23:20,399
service account<font color="#CCCCCC"> that we actually</font><font color="#E5E5E5"> want</font>

508
00:23:15,519 --> 00:23:22,450
and if we look at<font color="#E5E5E5"> the second line here</font>

509
00:23:20,399 --> 00:23:25,959
we can see that<font color="#CCCCCC"> we've actually</font><font color="#E5E5E5"> grabbed</font>

510
00:23:22,450 --> 00:23:29,379
the password for<font color="#E5E5E5"> it the success let's go</font>

511
00:23:25,960 --> 00:23:31,149
back to LDAP and we're going<font color="#CCCCCC"> to use this</font>

512
00:23:29,379 --> 00:23:34,859
<font color="#E5E5E5">account that we've just got with the</font>

513
00:23:31,149 --> 00:23:38,199
creative password of<font color="#CCCCCC"> hunter to to</font>

514
00:23:34,859 --> 00:23:41,109
enumerate this<font color="#E5E5E5"> the permissions for this</font>

515
00:23:38,200 --> 00:23:43,359
account<font color="#CCCCCC"> and we can see the</font><font color="#E5E5E5"> description</font>

516
00:23:41,109 --> 00:23:43,990
is storefront<font color="#E5E5E5"> update or service account</font>

517
00:23:43,359 --> 00:23:46,169
so

518
00:23:43,990 --> 00:23:50,170
we can probably<font color="#CCCCCC"> log into the</font><font color="#E5E5E5"> storefront</font>

519
00:23:46,170 --> 00:23:52,540
server and we can also see<font color="#E5E5E5"> that we have</font>

520
00:23:50,170 --> 00:23:57,460
<font color="#CCCCCC">login she'll been bash</font><font color="#E5E5E5"> so we should</font>

521
00:23:52,540 --> 00:23:59,230
finally<font color="#E5E5E5"> have shell access I'm going to</font>

522
00:23:57,460 --> 00:24:03,670
take a step back<font color="#CCCCCC"> here</font><font color="#E5E5E5"> before we do</font><font color="#CCCCCC"> that</font>

523
00:23:59,230 --> 00:24:06,300
and<font color="#E5E5E5"> talk about PS evasion because what</font>

524
00:24:03,670 --> 00:24:10,300
actually<font color="#E5E5E5"> happened when we</font><font color="#CCCCCC"> did this is</font>

525
00:24:06,300 --> 00:24:12,610
the<font color="#CCCCCC"> endpoint insight</font><font color="#E5E5E5"> tools that we saw</font>

526
00:24:10,300 --> 00:24:15,430
were running<font color="#E5E5E5"> yeah they noticed a unique</font>

527
00:24:12,610 --> 00:24:18,120
<font color="#CCCCCC">process</font><font color="#E5E5E5"> and not</font><font color="#CCCCCC"> only that a suspicious</font>

528
00:24:15,430 --> 00:24:20,890
process<font color="#E5E5E5"> s trace and we got caught</font><font color="#CCCCCC"> so</font>

529
00:24:18,120 --> 00:24:22,540
before we even tried to<font color="#CCCCCC"> use this</font><font color="#E5E5E5"> blue</font>

530
00:24:20,890 --> 00:24:24,280
team was on to<font color="#CCCCCC"> us they cut off our axis</font>

531
00:24:22,540 --> 00:24:27,330
and we got booted off<font color="#E5E5E5"> so I'm going to</font>

532
00:24:24,280 --> 00:24:30,720
talk<font color="#CCCCCC"> about</font><font color="#E5E5E5"> an kind of elementary PS</font>

533
00:24:27,330 --> 00:24:34,870
evasion technique that<font color="#E5E5E5"> I've employed</font>

534
00:24:30,720 --> 00:24:36,220
successfully on<font color="#E5E5E5"> on red teams it's not</font>

535
00:24:34,870 --> 00:24:38,620
anything new or revolutionary

536
00:24:36,220 --> 00:24:40,510
but it's really kind<font color="#CCCCCC"> of a good thing to</font>

537
00:24:38,620 --> 00:24:42,159
have in your<font color="#E5E5E5"> tool bag</font><font color="#CCCCCC"> and I'm gonna talk</font>

538
00:24:40,510 --> 00:24:44,350
about<font color="#E5E5E5"> how it can</font><font color="#CCCCCC"> be</font><font color="#E5E5E5"> applied to s trace</font>

539
00:24:42,160 --> 00:24:47,200
in particular<font color="#E5E5E5"> it's hard coding arguments</font>

540
00:24:44,350 --> 00:24:49,689
into binaries again it's not not

541
00:24:47,200 --> 00:24:51,970
anything<font color="#E5E5E5"> not anything revolutionary</font><font color="#CCCCCC"> but</font>

542
00:24:49,690 --> 00:24:53,920
it's remarkably easy to do and it can<font color="#CCCCCC"> go</font>

543
00:24:51,970 --> 00:24:56,080
a<font color="#E5E5E5"> surprisingly long way of course you</font>

544
00:24:53,920 --> 00:24:57,430
will still get caught by SEO<font color="#CCCCCC"> linux or</font>

545
00:24:56,080 --> 00:25:00,189
<font color="#CCCCCC">yama or anything</font><font color="#E5E5E5"> that's</font><font color="#CCCCCC"> actually looking</font>

546
00:24:57,430 --> 00:25:01,570
<font color="#CCCCCC">at what's going</font><font color="#E5E5E5"> on under the hood this</font>

547
00:25:00,190 --> 00:25:05,320
<font color="#CCCCCC">is a tool that</font><font color="#E5E5E5"> I wrote</font><font color="#CCCCCC"> called stealth</font>

548
00:25:01,570 --> 00:25:09,340
trace and it's based on this is<font color="#E5E5E5"> just the</font>

549
00:25:05,320 --> 00:25:11,230
<font color="#CCCCCC">s trace see</font><font color="#E5E5E5"> the remarkable thing about s</font>

550
00:25:09,340 --> 00:25:13,990
trace and<font color="#E5E5E5"> this is again just straight</font>

551
00:25:11,230 --> 00:25:15,810
<font color="#E5E5E5">off the s trace github is it almost</font>

552
00:25:13,990 --> 00:25:18,550
seems built for this<font color="#CCCCCC"> kind of tool</font>

553
00:25:15,810 --> 00:25:21,190
because right inside the main function

554
00:25:18,550 --> 00:25:24,909
<font color="#CCCCCC">is</font><font color="#E5E5E5"> just a nested init function using</font>

555
00:25:21,190 --> 00:25:26,680
<font color="#E5E5E5">just</font><font color="#CCCCCC"> arg crv</font><font color="#E5E5E5"> so it's remarkably easy to</font>

556
00:25:24,910 --> 00:25:30,310
just allocate our own memory make fake

557
00:25:26,680 --> 00:25:32,590
arguments<font color="#E5E5E5"> and just run in a just</font><font color="#CCCCCC"> make a</font>

558
00:25:30,310 --> 00:25:34,629
statically compiled<font color="#CCCCCC"> s trace with</font>

559
00:25:32,590 --> 00:25:36,459
hard-coded arguments for the site<font color="#CCCCCC"> that</font>

560
00:25:34,630 --> 00:25:39,430
<font color="#E5E5E5">you're targeting the server that you're</font>

561
00:25:36,460 --> 00:25:44,200
running<font color="#E5E5E5"> this on with the</font><font color="#CCCCCC"> pid' built</font>

562
00:25:39,430 --> 00:25:47,200
right into the code<font color="#E5E5E5"> and it's remarkably</font>

563
00:25:44,200 --> 00:25:49,669
stable<font color="#E5E5E5"> of being able to compile it on it</font>

564
00:25:47,200 --> 00:25:52,129
<font color="#E5E5E5">won't do and have it run on</font><font color="#CCCCCC"> RedHat just</font>

565
00:25:49,669 --> 00:25:55,519
it's been stable statically compiled<font color="#E5E5E5"> s</font>

566
00:25:52,129 --> 00:25:56,958
traces very nice<font color="#E5E5E5"> mature software and</font>

567
00:25:55,519 --> 00:25:59,269
<font color="#E5E5E5">just the before and after of what it</font>

568
00:25:56,959 --> 00:26:03,799
looks like without modified<font color="#E5E5E5"> a you've got</font>

569
00:25:59,269 --> 00:26:05,209
<font color="#E5E5E5">the specified option for the process and</font>

570
00:26:03,799 --> 00:26:06,679
you're looking<font color="#E5E5E5"> at read calls</font>

571
00:26:05,209 --> 00:26:08,119
afterwards we've also renamed it to

572
00:26:06,679 --> 00:26:10,639
<font color="#CCCCCC">something a little</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> little more</font>

573
00:26:08,119 --> 00:26:12,488
innocent looking and that's what the PS

574
00:26:10,639 --> 00:26:15,728
outfit looks like we're<font color="#CCCCCC"> just running top</font>

575
00:26:12,489 --> 00:26:15,729
<font color="#CCCCCC">quiet here</font>

576
00:26:16,029 --> 00:26:20,239
but yeah<font color="#CCCCCC"> you are still going</font><font color="#E5E5E5"> to get you</font>

577
00:26:18,469 --> 00:26:23,479
you're still going to<font color="#CCCCCC"> get busted by any</font>

578
00:26:20,239 --> 00:26:26,239
real<font color="#E5E5E5"> detection capabilities and again</font>

579
00:26:23,479 --> 00:26:31,579
the worst<font color="#E5E5E5"> case is SEO Linux in this case</font>

580
00:26:26,239 --> 00:26:34,969
we have a got a demo of<font color="#E5E5E5"> what happens</font>

581
00:26:31,579 --> 00:26:36,918
when<font color="#E5E5E5"> SC Linux denied P trace has been</font>

582
00:26:34,969 --> 00:26:40,479
configured and we're gathering<font color="#E5E5E5"> those</font>

583
00:26:36,919 --> 00:26:45,169
logs<font color="#E5E5E5"> centrally the audit log and what</font>

584
00:26:40,479 --> 00:26:48,679
happens when you<font color="#CCCCCC"> actually try to run</font>

585
00:26:45,169 --> 00:26:50,809
this even as root you<font color="#E5E5E5"> get s trace yeah</font>

586
00:26:48,679 --> 00:26:53,029
<font color="#E5E5E5">attach</font><font color="#CCCCCC"> Petraeus P trace</font><font color="#E5E5E5"> attach that's</font>

587
00:26:50,809 --> 00:26:55,940
the<font color="#CCCCCC"> ssh process ID permission denied</font>

588
00:26:53,029 --> 00:26:58,879
<font color="#CCCCCC">okay so failed but no big deal right</font>

589
00:26:55,940 --> 00:27:07,070
<font color="#E5E5E5">except here's what's happening on the</font>

590
00:26:58,879 --> 00:27:11,498
<font color="#E5E5E5">the blue team admins oh blue team</font>

591
00:27:07,070 --> 00:27:11,499
wins<font color="#CCCCCC"> okay so that wasn't</font><font color="#E5E5E5"> a great</font><font color="#CCCCCC"> idea</font>

592
00:27:12,009 --> 00:27:18,200
and yeah they what they were doing

593
00:27:15,919 --> 00:27:21,799
<font color="#E5E5E5">basically</font><font color="#CCCCCC"> is they they</font><font color="#E5E5E5"> an OS query and</font>

594
00:27:18,200 --> 00:27:25,279
yeah all that so a head-on<font color="#CCCCCC"> attack</font>

595
00:27:21,799 --> 00:27:29,809
we got caught the point I want to

596
00:27:25,279 --> 00:27:31,399
emphasize<font color="#E5E5E5"> here is the</font><font color="#CCCCCC"> blue team</font><font color="#E5E5E5"> is</font>

597
00:27:29,809 --> 00:27:32,839
always<font color="#CCCCCC"> going to</font><font color="#E5E5E5"> win if they know what</font>

598
00:27:31,399 --> 00:27:35,049
they're doing<font color="#E5E5E5"> and they're as good as you</font>

599
00:27:32,839 --> 00:27:38,119
because they were<font color="#E5E5E5"> here first</font>

600
00:27:35,049 --> 00:27:40,849
that's why as attackers we constantly

601
00:27:38,119 --> 00:27:43,189
<font color="#E5E5E5">need to be up in our game I like</font><font color="#CCCCCC"> to</font>

602
00:27:40,849 --> 00:27:45,619
<font color="#E5E5E5">think of it as three levels of evasion</font>

603
00:27:43,190 --> 00:27:47,529
<font color="#CCCCCC">head-on attack with no evasion</font><font color="#E5E5E5"> yet</font>

604
00:27:45,619 --> 00:27:49,789
you're going to get caught

605
00:27:47,529 --> 00:27:51,859
use an<font color="#CCCCCC"> appropriate level</font><font color="#E5E5E5"> of evasion</font>

606
00:27:49,789 --> 00:27:55,459
<font color="#E5E5E5">based on your reconnaissance of the</font>

607
00:27:51,859 --> 00:27:57,168
target site that's<font color="#E5E5E5"> a success if you use</font>

608
00:27:55,459 --> 00:27:59,839
too<font color="#CCCCCC"> much of</font><font color="#E5E5E5"> Asian you get caught in your</font>

609
00:27:57,169 --> 00:28:01,519
own web of deception<font color="#E5E5E5"> and that</font><font color="#CCCCCC"> doesn't</font>

610
00:27:59,839 --> 00:28:03,470
work out so<font color="#CCCCCC"> well either so again it's</font>

611
00:28:01,519 --> 00:28:07,639
<font color="#CCCCCC">about being site-specific and a</font><font color="#E5E5E5"> pro</font>

612
00:28:03,470 --> 00:28:09,889
for the<font color="#E5E5E5"> target</font><font color="#CCCCCC"> environment so what's</font><font color="#E5E5E5"> our</font>

613
00:28:07,639 --> 00:28:12,678
endgame here<font color="#E5E5E5"> we started with</font><font color="#CCCCCC"> the</font>

614
00:28:09,889 --> 00:28:15,860
<font color="#E5E5E5">foothold on the build server using a</font>

615
00:28:12,679 --> 00:28:18,529
<font color="#E5E5E5">fished account we escalated to root and</font>

616
00:28:15,860 --> 00:28:20,899
then we captured a domain account<font color="#CCCCCC"> that</font>

617
00:28:18,529 --> 00:28:25,070
allowed<font color="#CCCCCC"> us to log</font><font color="#E5E5E5"> into the storefront so</font>

618
00:28:20,899 --> 00:28:28,939
our privilege escalation yeah we got

619
00:28:25,070 --> 00:28:30,970
root on the<font color="#E5E5E5"> build server and we migrated</font>

620
00:28:28,940 --> 00:28:38,450
to the storefront server

621
00:28:30,970 --> 00:28:42,679
what's our end game from here as you<font color="#CCCCCC"> may</font>

622
00:28:38,450 --> 00:28:48,309
have<font color="#E5E5E5"> guessed based on storefront one of</font>

623
00:28:42,679 --> 00:28:51,940
the highest impact<font color="#E5E5E5"> lowest risk ways to</font>

624
00:28:48,309 --> 00:28:56,350
exploit access of this kind is

625
00:28:51,940 --> 00:28:59,720
client-side skimming<font color="#E5E5E5"> the mage cart</font>

626
00:28:56,350 --> 00:29:02,389
threat actor is<font color="#CCCCCC"> the most</font><font color="#E5E5E5"> notorious one</font>

627
00:28:59,720 --> 00:29:05,210
and it's<font color="#E5E5E5"> not just for credit card info</font>

628
00:29:02,389 --> 00:29:07,820
<font color="#E5E5E5">it's useful as an attacker for just any</font>

629
00:29:05,210 --> 00:29:09,529
kind of<font color="#CCCCCC"> client-side access of</font>

630
00:29:07,820 --> 00:29:12,710
credentials<font color="#E5E5E5"> if you if you need to pivot</font>

631
00:29:09,529 --> 00:29:14,330
<font color="#E5E5E5">from one server to another</font><font color="#CCCCCC"> client-side</font>

632
00:29:12,710 --> 00:29:16,100
<font color="#E5E5E5">there's just there's</font><font color="#CCCCCC"> just not enough</font>

633
00:29:14,330 --> 00:29:18,860
ways to sing the<font color="#E5E5E5"> praises of client-side</font>

634
00:29:16,100 --> 00:29:25,760
attacks<font color="#E5E5E5"> because not only is the captured</font>

635
00:29:18,860 --> 00:29:27,530
data<font color="#CCCCCC"> known to be</font><font color="#E5E5E5"> current its exfiltrate</font>

636
00:29:25,760 --> 00:29:29,360
from outside<font color="#CCCCCC"> at the corporate network</font>

637
00:29:27,530 --> 00:29:34,520
<font color="#CCCCCC">you know unless they're using a full</font>

638
00:29:29,360 --> 00:29:38,290
tunnel VPN but who does<font color="#CCCCCC"> that</font><font color="#E5E5E5"> as three</font>

639
00:29:34,520 --> 00:29:42,370
<font color="#E5E5E5">notable companies have discovered lately</font>

640
00:29:38,290 --> 00:29:45,560
client-side JavaScript<font color="#CCCCCC"> exfiltration is</font>

641
00:29:42,370 --> 00:29:51,129
incredibly dangerous<font color="#E5E5E5"> hard to</font><font color="#CCCCCC"> detect and</font>

642
00:29:45,560 --> 00:29:55,940
just just<font color="#E5E5E5"> nasty</font><font color="#CCCCCC"> it's it's</font><font color="#E5E5E5"> almost unfair</font>

643
00:29:51,130 --> 00:29:57,440
so object lessons<font color="#CCCCCC"> for for this don't</font>

644
00:29:55,940 --> 00:29:58,790
<font color="#E5E5E5">exploit for the sake of exploiting</font>

645
00:29:57,440 --> 00:29:59,960
that's that's a good way<font color="#CCCCCC"> to get caught</font>

646
00:29:58,790 --> 00:30:03,409
<font color="#E5E5E5">and if you get caught</font>

647
00:29:59,960 --> 00:30:05,960
there goes your business impact<font color="#CCCCCC"> CEOs</font>

648
00:30:03,410 --> 00:30:10,040
laptop Trump's domain admin every single

649
00:30:05,960 --> 00:30:12,920
time use an appropriate<font color="#CCCCCC"> level</font><font color="#E5E5E5"> of evasion</font>

650
00:30:10,040 --> 00:30:14,480
<font color="#E5E5E5">for your target site your target system</font>

651
00:30:12,920 --> 00:30:17,690
<font color="#E5E5E5">it's going to be based on heuristics</font>

652
00:30:14,480 --> 00:30:20,570
<font color="#E5E5E5">like how how much sure you think the the</font>

653
00:30:17,690 --> 00:30:24,220
<font color="#CCCCCC">target is do they do they actually</font><font color="#E5E5E5"> have</font>

654
00:30:20,570 --> 00:30:26,570
a real<font color="#CCCCCC"> Edie</font><font color="#E5E5E5"> are they still stuck on</font><font color="#CCCCCC"> Sim</font>

655
00:30:24,220 --> 00:30:28,730
<font color="#CCCCCC">do they</font><font color="#E5E5E5"> are they just</font><font color="#CCCCCC"> ad</font><font color="#E5E5E5"> Hawking</font>

656
00:30:26,570 --> 00:30:30,710
everything again there's no<font color="#CCCCCC"> business</font>

657
00:30:28,730 --> 00:30:34,280
impact if<font color="#CCCCCC"> you get caught</font><font color="#E5E5E5"> and if you must</font>

658
00:30:30,710 --> 00:30:37,550
take trophies<font color="#E5E5E5"> make them</font><font color="#CCCCCC"> pox not boxes</font>

659
00:30:34,280 --> 00:30:43,430
<font color="#E5E5E5">cool hacks are better than the number</font><font color="#CCCCCC"> of</font>

660
00:30:37,550 --> 00:30:44,899
number of boxes every single time<font color="#E5E5E5"> and</font>

661
00:30:43,430 --> 00:30:47,450
that's pretty<font color="#CCCCCC"> much that's pretty much</font>

662
00:30:44,900 --> 00:30:48,110
yet<font color="#E5E5E5"> because</font><font color="#CCCCCC"> you folks are so shy and</font>

663
00:30:47,450 --> 00:30:52,670
<font color="#E5E5E5">retiring</font>

664
00:30:48,110 --> 00:30:54,889
<font color="#E5E5E5">I suggest</font><font color="#CCCCCC"> so you</font><font color="#E5E5E5"> suggest any any</font>

665
00:30:52,670 --> 00:30:57,230
<font color="#E5E5E5">questions that you're afraid to ask here</font>

666
00:30:54,890 --> 00:30:59,750
<font color="#E5E5E5">direct them to to either my email</font><font color="#CCCCCC"> on my</font>

667
00:30:57,230 --> 00:31:07,150
Twitter account<font color="#E5E5E5"> not that I ever actually</font>

668
00:30:59,750 --> 00:31:07,150
tweet but I could in theory I have one

669
00:31:16,210 --> 00:31:26,660
but in the<font color="#CCCCCC"> meantime</font><font color="#E5E5E5"> any any questions</font>

670
00:31:19,160 --> 00:31:28,770
from the<font color="#CCCCCC"> audience</font><font color="#E5E5E5"> for real all</font><font color="#CCCCCC"> right</font>

671
00:31:26,660 --> 00:31:33,589
thank you<font color="#CCCCCC"> very much</font>

672
00:31:28,770 --> 00:31:33,589
[Applause]

