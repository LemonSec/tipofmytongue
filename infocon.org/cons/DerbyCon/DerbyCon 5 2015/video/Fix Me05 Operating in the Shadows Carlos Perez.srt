1
00:00:00,060 --> 00:00:16,289
how are you guys ok let's get Joe saw it
today is going to be operating in the

2
00:00:16,289 --> 00:00:22,800
shadows and my name is Carlos Perez so
bad about myself my day job is as a

3
00:00:22,800 --> 00:00:28,300
director of reverse engineering
integration for a security vendor yes I

4
00:00:28,300 --> 00:00:32,119
know I'm a manager and you're going like
what the fuck is he doing out there

5
00:00:32,119 --> 00:00:37,760
talking but in my spare time I still do
some research I still write some tools

6
00:00:37,760 --> 00:00:41,800
and talk with very smart people and I
kind of get all that information into my

7
00:00:41,800 --> 00:00:46,800
head I am one of the co-host indiscreet
weekly podcast show you some of you

8
00:00:46,800 --> 00:00:54,340
probably may have heard it also I blog
from time to time and dark operator dot

9
00:00:54,340 --> 00:00:58,920
com in addition to that I'm a
contributor to many open source tools

10
00:00:58,920 --> 00:00:59,960
out there

11
00:00:59,960 --> 00:01:09,979
PowerShell Python Ruby I've written
several Metasploit modules movers grabs

12
00:01:09,979 --> 00:01:15,130
just jumping around you can see that
that about my ADHD as they move from one

13
00:01:15,130 --> 00:01:20,179
language to the other recently have been
focusing impoverished which is great so

14
00:01:20,179 --> 00:01:25,829
on the talk today why do we want to
operate in the shadows

15
00:01:25,829 --> 00:01:29,729
this was a talk that have been having to
real people since yesterday it's very

16
00:01:29,729 --> 00:01:35,030
simple and just to be clear I know that
many of you have asked me this question

17
00:01:35,030 --> 00:01:42,109
as I was talking with you in the hall
and the question was what the fuck right

18
00:01:42,109 --> 00:01:46,609
now when you talk with blue teams out
there to go like they're not catching me

19
00:01:46,609 --> 00:01:53,630
why do I need to operate in the shadows
why do I need to be on their radar well

20
00:01:53,630 --> 00:02:01,570
stuff has been changing a bit much but
when you look at stuff

21
00:02:01,570 --> 00:02:06,729
tools out there information training and
stuff we're blue teams have been getting

22
00:02:06,729 --> 00:02:14,250
better I've had the chance to actually
talk with some of these regimes one of

23
00:02:14,250 --> 00:02:19,670
them is a very big company in the west
coast of actually talked to two of their

24
00:02:19,670 --> 00:02:23,330
internal Blu teams actually had to play
sure

25
00:02:23,330 --> 00:02:28,540
helping out a bunch of friends and a pen
test that they were doing to military

26
00:02:28,540 --> 00:02:33,020
industrial company out on the east coast
and one of things that we noticed was

27
00:02:33,020 --> 00:02:34,440
that we're getting caught

28
00:02:34,440 --> 00:02:41,750
seconds and we went in we started kind
of trying to see what what we had on the

29
00:02:41,750 --> 00:02:45,980
system we were following those rules
we're gonna live off the land we're

30
00:02:45,980 --> 00:02:50,910
going to be kind of like survival as
ninjas here we're going to use Windows

31
00:02:50,910 --> 00:02:55,070
tools that they won't be able to take
this five seconds later we lost our show

32
00:02:55,070 --> 00:03:00,230
later we got into another system and all
of the sudden everything was hunky-dory

33
00:03:00,230 --> 00:03:04,970
until we created another shell and then
we had some persistent

34
00:03:04,970 --> 00:03:09,940
five minutes later we lost our show and
we can skip moving on moving the network

35
00:03:09,940 --> 00:03:13,870
and we just keep getting caught and it
was because these blue team actually

36
00:03:13,870 --> 00:03:19,660
knew their shit actually just for does
completely anything we did they were

37
00:03:19,660 --> 00:03:25,410
looking at and they were triggering on
it then when I had a chance to go to an

38
00:03:25,410 --> 00:03:31,209
event in the west coast and I was able
to meet some people very big blue team

39
00:03:31,209 --> 00:03:37,260
they were totally yeah we're able to do
that and actually kind of surprised they

40
00:03:37,260 --> 00:03:45,150
really got that mandela operating with
the assumed compromise and when I was

41
00:03:45,150 --> 00:03:50,060
talking with one of them he's a great
friend of place name is Dave and I was

42
00:03:50,060 --> 00:03:59,570
well we're hunting we've got into the
maturity level we were not no longer

43
00:03:59,570 --> 00:04:04,299
fighting fires where hunters so since
we're still in that we have been

44
00:04:04,299 --> 00:04:07,960
compromised were always hunting for deer
at team

45
00:04:07,960 --> 00:04:12,520
and then we have several meetings in a
couple of weeks with the red team where

46
00:04:12,520 --> 00:04:18,000
they come in and we say we catch you
here and you'll go no you didn't I was

47
00:04:18,000 --> 00:04:23,380
over here and then we take those rules
we apply apply the IOC said they give us

48
00:04:23,380 --> 00:04:30,690
and we work with them so yeah I actually
have some hope I'm not so bitter anymore

49
00:04:30,690 --> 00:04:35,520
when I'm talking about security with
several people because stuff is actually

50
00:04:35,520 --> 00:04:41,530
improving and Dennis I was talking with
John strand talking with other of my

51
00:04:41,530 --> 00:04:47,640
friends and suc indeed panel that we had
this morning in fact I was actually

52
00:04:47,640 --> 00:04:51,230
shocked because for the first 30 minutes
there were talking a lot of stuff that

53
00:04:51,230 --> 00:04:56,470
was going to talk about that in my don't
talk about it and they were talking

54
00:04:56,470 --> 00:05:04,230
about why because we Penn testers we've
helped blue team gesture controls if we

55
00:05:04,230 --> 00:05:08,690
repent tester and we call ourselves
professionals and it's our profession

56
00:05:08,690 --> 00:05:13,260
one of the things that we have to keep
in mind is that we're QA like Chris

57
00:05:13,260 --> 00:05:19,860
Dickerson said we're going on and stuff
we go in and we tried to break their

58
00:05:19,860 --> 00:05:23,920
shed and tell them hey it broke here
because you're not looking at what we

59
00:05:23,920 --> 00:05:29,140
needed to be looking at you need to join
this this way and Daniel chocolate

60
00:05:29,140 --> 00:05:33,530
truffle much that came out with a ball
strike three point zero and one of the

61
00:05:33,530 --> 00:05:37,720
nice things he actually added to cobalt
strike was that now you can get a report

62
00:05:37,720 --> 00:05:42,990
of proceeds of all of your actions so
that actually helps you when you go to

63
00:05:42,990 --> 00:05:49,530
the blue team like hey guys my IOC's
which ones you and which ones did you

64
00:05:49,530 --> 00:05:54,670
caught me help you improve on that and
many times people go like well I don't

65
00:05:54,670 --> 00:05:58,890
want it to you that I like my cushy job
I'm like dude you're working government

66
00:05:58,890 --> 00:06:05,840
your hacker your job is just to
challenge yourself so simple that we

67
00:06:05,840 --> 00:06:10,300
have we go through processes when we go
into apprentice one of them is

68
00:06:10,300 --> 00:06:14,280
identifying their what polls show we're
actually running because we need to know

69
00:06:14,280 --> 00:06:19,669
who we are and that network and many
times just been a regular user can have

70
00:06:19,669 --> 00:06:24,199
it back to us and we don't have to go
after domain admin if all of the sudden

71
00:06:24,199 --> 00:06:28,120
the guy who click on my phishing scheme

72
00:06:28,120 --> 00:06:35,599
CFO I'm accessing all of your
information that affects your business

73
00:06:35,599 --> 00:06:42,300
that is just enough for me to show risk
to your structure so typically just do

74
00:06:42,300 --> 00:06:46,460
that we check what is our privilege then
we just go and try to identify the

75
00:06:46,460 --> 00:06:52,159
controls for those of you who are in the
military I have a lot of friends whose

76
00:06:52,159 --> 00:06:57,530
job is to put holes into the animals and
the way that they work is if they were

77
00:06:57,530 --> 00:07:02,580
telling me typically when we infiltrator
we go in one of the first things we do

78
00:07:02,580 --> 00:07:07,379
is we just a quiet like why

79
00:07:07,379 --> 00:07:12,900
well we need to know if we hear somebody
shooting in the air and saying that we

80
00:07:12,900 --> 00:07:19,090
are certain that area or when we go into
urban areas we're operating we just gon

81
00:07:19,090 --> 00:07:26,520
said watch and listen we're looking for
the controls up the opponent who are

82
00:07:26,520 --> 00:07:31,870
looking for us what controls today have
what types of food or concerns you know

83
00:07:31,870 --> 00:07:36,779
why our cameras alarms all that kind of
stuff they're looking for controls same

84
00:07:36,779 --> 00:07:41,340
thing when we go into a network we go
into that box we need to know what shit

85
00:07:41,340 --> 00:07:47,169
is there so we won't trigger we also
need to identify those controls

86
00:07:47,169 --> 00:07:56,300
monitored there's no use for you to log
everything if nobody of us have had that

87
00:07:56,300 --> 00:08:00,719
frustration breeding you Verizon report
or in Cisco report within the Microsoft

88
00:08:00,719 --> 00:08:07,330
report and all of them are saying the
same 240 days or more for somebody to

89
00:08:07,330 --> 00:08:12,099
actually know that they have been
compromised and we're gonna like why do

90
00:08:12,099 --> 00:08:17,599
I bother working in this industry until
you find those nuggets of information

91
00:08:17,599 --> 00:08:23,040
out there that actually go like yeah we
get it working to change this

92
00:08:23,040 --> 00:08:26,490
and then all of the sudden couple of
months later you find another one and

93
00:08:26,490 --> 00:08:30,430
then you find another customer that you
took the time to work with them and work

94
00:08:30,430 --> 00:08:33,080
with your Blue team and they're actually
improving

95
00:08:33,080 --> 00:08:38,110
makes you feel good inside and that's
why you believe you have heard by other

96
00:08:38,110 --> 00:08:43,150
presentations and yours before I'm very
negative I'm very sometimes even better

97
00:08:43,150 --> 00:08:48,300
when I talk about blue teams and now my
perspective has been changing because of

98
00:08:48,300 --> 00:08:56,170
this thing is when they're monitoring
either moving those locks outside the

99
00:08:56,170 --> 00:09:00,260
box that will give me some information
so they mentioned typically we go with

100
00:09:00,260 --> 00:09:04,890
situational awareness we go in we want
to know where we are how are we going to

101
00:09:04,890 --> 00:09:13,710
be housed at Target set up operate in it
so we start first looking into that we

102
00:09:13,710 --> 00:09:18,680
got into the house will look what
controls and then once we feel secure

103
00:09:18,680 --> 00:09:25,120
with feel safe we didn't start moving
laterally in that network now our

104
00:09:25,120 --> 00:09:32,810
behavior will be dictated by those
controls so if the customer actually has

105
00:09:32,810 --> 00:09:37,630
a blind hole he's already in the shadows
I can just walk up to him and slapped

106
00:09:37,630 --> 00:09:40,470
him and he won't know who did it

107
00:09:40,470 --> 00:09:46,020
shadows but if my opponent actually has
his eyes open I cannot approach him

108
00:09:46,020 --> 00:09:46,630
directly

109
00:09:46,630 --> 00:09:50,840
debt-limit michael says it will live in
my actions

110
00:09:50,840 --> 00:09:59,170
host so ernest hemingway has a very nice
quote that says certainly there's no

111
00:09:59,170 --> 00:10:03,480
hunting like hunting of men and those
who have hunted armed men long enough

112
00:10:03,480 --> 00:10:08,790
and liked that never really care for
anything else after it is the same thing

113
00:10:08,790 --> 00:10:13,500
when you're a pen tester if you're going
to have a bunch of scripts that are

114
00:10:13,500 --> 00:10:17,770
always getting new shell you're just
going to get the time that you gonna get

115
00:10:17,770 --> 00:10:22,120
bored with it and all of the sudden you
find a blue team that actually no stores

116
00:10:22,120 --> 00:10:24,290
and you're getting caught

117
00:10:24,290 --> 00:10:28,660
of the sudden you go like oh cool this
is a challenge you get out you get those

118
00:10:28,660 --> 00:10:33,610
brain juices flowing in your head and
your cool finally get one and one

119
00:10:33,610 --> 00:10:35,139
somebody who can actually

120
00:10:35,139 --> 00:10:39,980
can attest to the limits and just how we
how we should start working we should

121
00:10:39,980 --> 00:10:48,089
start going out there and we teach blue
team routines gets better we get we now

122
00:10:48,089 --> 00:10:52,850
have to adapt we now need to get better
they get better and we just keep getting

123
00:10:52,850 --> 00:10:58,269
better and we just keep playing games
with one another we got it reached that

124
00:10:58,269 --> 00:11:05,410
point so we get more excited so heavily
as I mentioned we go with privilege

125
00:11:05,410 --> 00:11:09,499
privileged houses to determine what we
can actually number eight in that box

126
00:11:09,499 --> 00:11:15,959
and what tools I am I going to use to
numerate this stuff on it after Dad also

127
00:11:15,959 --> 00:11:26,939
also indicated go into a box and outbox
their domain admin and there are you

128
00:11:26,939 --> 00:11:31,179
sure to click on something that's
already telling me that they have very

129
00:11:31,179 --> 00:11:35,149
bad behavior inside of their network
that they really have very bad practices

130
00:11:35,149 --> 00:11:40,449
if all the Sun and get into that box and
that user is local admin on his block

131
00:11:40,449 --> 00:11:47,049
and this is the secretary I just pwnage
as local admin her box doesn't look that

132
00:11:47,049 --> 00:11:52,929
good said privilege will actually take
take that as a mention regular user

133
00:11:52,929 --> 00:11:58,319
accounts may be all that we need but we
need to actually look for that

134
00:11:58,319 --> 00:12:06,610
information ahead of time I remember my
dad told me when he was 4 Benning

135
00:12:06,610 --> 00:12:12,519
Georgia he told me that there was to
speak signed at Murphy's laws of compaq

136
00:12:12,519 --> 00:12:18,730
and it every time he went 2d mess hope
this respect India Vietnam era and one

137
00:12:18,730 --> 00:12:22,579
of them actually set professionals are
predictable but the world's tulip

138
00:12:22,579 --> 00:12:27,970
amateurs right now if you're a
professional you have certain rules or

139
00:12:27,970 --> 00:12:32,379
SOP standard operating procedures that
you're gonna follow always through gonna

140
00:12:32,379 --> 00:12:36,889
follow the PTSD penetration testing
execution standard you're going to use

141
00:12:36,889 --> 00:12:41,369
chels that encrypt your customer data
you're going to have certain behaviors

142
00:12:41,369 --> 00:12:45,610
are going to be unique but many times
has as John mention

143
00:12:45,610 --> 00:12:49,000
his favorite quote is that there are a
lot of dentists are out there does come

144
00:12:49,000 --> 00:12:53,760
from the pentacene puppy mills in my
case I called them to monkeys are people

145
00:12:53,760 --> 00:12:57,690
that they know I'm at the Nomad exploit
you take them away and they just go

146
00:12:57,690 --> 00:13:05,829
bonkers don't know what to do so we have
to strive to move away that unique group

147
00:13:05,829 --> 00:13:11,829
inside a larger and we should be those
professionals I borrowed this life from

148
00:13:11,829 --> 00:13:18,290
friendly homes but it seemed a slower
rate of security controls the amount he

149
00:13:18,290 --> 00:13:24,709
tells that you need certain things in
life like food water and some other

150
00:13:24,709 --> 00:13:29,910
stuff and here we're just applying that
to security controls so I I like that

151
00:13:29,910 --> 00:13:35,100
concept and it borrowed it from him so
we're looking at controls typically the

152
00:13:35,100 --> 00:13:39,140
first one that we're going to find an
environment he said he followed by

153
00:13:39,140 --> 00:13:44,230
probably whitelist and blacklist in type
of applications and controls so it

154
00:13:44,230 --> 00:13:48,220
doesn't need to be a Parker it could
actually be something as simple as

155
00:13:48,220 --> 00:13:53,910
proper hackles on files and then after
that we just keep moving up and we moved

156
00:13:53,910 --> 00:13:57,730
to probably something like device card
in Windows 10 that will probably seen

157
00:13:57,730 --> 00:14:02,670
the future deployed we just keep me and
now we have an opponent who not only

158
00:14:02,670 --> 00:14:09,240
just decide to deploy enterprise and
start locking down a bit their system

159
00:14:09,240 --> 00:14:10,699
but now they're auditing

160
00:14:10,699 --> 00:14:16,140
proactively enabling auditing on their
boxes look for something more and then

161
00:14:16,140 --> 00:14:17,829
they just keep moving up and we go

162
00:14:17,829 --> 00:14:21,740
moving up to forensic captured host base
hard facts all of the sudden they're

163
00:14:21,740 --> 00:14:27,269
capturing information and filtering out
that auditing information and looking

164
00:14:27,269 --> 00:14:31,779
for those indicators of compromise and
then we moved to the Holy Grail what is

165
00:14:31,779 --> 00:14:35,790
where we you have an actual team that
will be able to do memory forensics

166
00:14:35,790 --> 00:14:38,680
because we all know that if we live in
memory

167
00:14:38,680 --> 00:14:42,260
many times we just can't go completely
unnoticed there are very few

168
00:14:42,260 --> 00:14:48,949
organizations second actually do that I
can actually count them he wants that I

169
00:14:48,949 --> 00:14:52,570
know but my left hand and the guys in
pulled a calm call me charlie

170
00:14:52,570 --> 00:14:57,079
forefingers because I have four fingers
so that will give you an idea how small

171
00:14:57,079 --> 00:14:57,529
deck

172
00:14:57,529 --> 00:15:03,399
that number of people are one of them is
Microsoft will go and they're on and

173
00:15:03,399 --> 00:15:07,350
there's another one that I know actually
certain teams inside of those

174
00:15:07,350 --> 00:15:11,180
organizations when they see something
funny and that's something on either

175
00:15:11,180 --> 00:15:13,620
seen it doesn't make them laugh

176
00:15:13,620 --> 00:15:19,499
actually dumped the memory of that box
remotely bring it over to Alice's and

177
00:15:19,499 --> 00:15:22,649
we're seeing people actually moving to
the store starting with that mentality

178
00:15:22,649 --> 00:15:28,569
but there are few and far between and we
have to work with them to make that

179
00:15:28,569 --> 00:15:33,819
number even bigger so when we start
looking at the controls and will start

180
00:15:33,819 --> 00:15:38,939
looking like I'm not going to bore you
with these tables and go one by one by

181
00:15:38,939 --> 00:15:39,860
one by one

182
00:15:39,860 --> 00:15:45,639
I don't want to have you guys here for
two hours so typically antivirus we all

183
00:15:45,639 --> 00:15:52,639
know enterprises we know it's there in
fact let me skip this to just go we

184
00:15:52,639 --> 00:16:02,420
typically say is not doing anything then
again when I get the most she via email

185
00:16:02,420 --> 00:16:09,620
from people is how do i bypass AVG how
do i bypass sematech I would say for

186
00:16:09,620 --> 00:16:15,529
every 10 emails were questions that I
get from people ate are still related

187
00:16:15,529 --> 00:16:25,829
about us so if we're saying that is dead
why do we find it so annoying that is

188
00:16:25,829 --> 00:16:31,540
one of those cases where we have to
bring our game up because if you talk

189
00:16:31,540 --> 00:16:35,939
with a mid-level pen test for a
high-level Penta Sri screens one of

190
00:16:35,939 --> 00:16:41,290
those sis Lords of jet ice depending on
which bank you wanna be your gonna

191
00:16:41,290 --> 00:16:47,970
notice it go like now I can bypass any
API trans I know how to do it I know I

192
00:16:47,970 --> 00:16:52,679
have my own lab where I can test my
tools to my stuff and do it but still

193
00:16:52,679 --> 00:17:00,399
out there people that were finding out
there are still being caught by a TV

194
00:17:00,399 --> 00:17:05,490
show a be actually does serve a purpose
if we can actually be useful here

195
00:17:05,490 --> 00:17:15,410
isley to the tact and for us to bypass
there are many techniques many tools

196
00:17:15,410 --> 00:17:20,540
over there to bypass AV we have trip
Thurs we have Packers repackaging the

197
00:17:20,540 --> 00:17:25,480
inside of scripting languages we can use
PowerShell we can compile them and go we

198
00:17:25,480 --> 00:17:28,270
can just altered at fingerprint

199
00:17:28,270 --> 00:17:35,150
so many ways if not one of my favorite
tools to see bill framework you can just

200
00:17:35,150 --> 00:17:39,929
grab a post about anything packaging
pipe and you'll notice that bypasses if

201
00:17:39,929 --> 00:17:45,260
you want to see examples on how to
bypass almost all these just go to Black

202
00:17:45,260 --> 00:17:49,050
Hills security booth they're actually
have a series of videos with the goal

203
00:17:49,050 --> 00:17:54,090
one by one on the top and harbors
vendors out there and they're showing

204
00:17:54,090 --> 00:17:58,220
techniques right there right next door
in their booze and how to bypass which

205
00:17:58,220 --> 00:17:59,040
one

206
00:17:59,040 --> 00:18:02,460
yes I know their tolerance imitate by
putting a big sign how to bypass

207
00:18:02,460 --> 00:18:10,110
semantic in front of the booth but yeah
they do know their stuff so typically

208
00:18:10,110 --> 00:18:14,850
when we go in and we look in the case of
Windows most of the antivirus solutions

209
00:18:14,850 --> 00:18:19,330
out there actually going to a deal with
Microsoft when they get access to

210
00:18:19,330 --> 00:18:25,790
specific API so under NDA and what they
do is they reduced their antivirus

211
00:18:25,790 --> 00:18:32,190
product on their degrees center and
windows when you go with your open

212
00:18:32,190 --> 00:18:36,300
windows and you get that pop up your
antivirus has been disabled because

213
00:18:36,300 --> 00:18:40,629
let's face it almost all of a sudden
we're in the trenches 2 a.m. we're

214
00:18:40,630 --> 00:18:41,710
trying to do something

215
00:18:41,710 --> 00:18:46,910
exploit or something double strike we
decided to export our pay line that we

216
00:18:46,910 --> 00:18:51,410
copy to Windows machine in bloom Windows
Defender catches and we'll talk and you

217
00:18:51,410 --> 00:18:54,880
go in and you disable it so you can
finish your test go to sleep and all the

218
00:18:54,880 --> 00:18:58,380
sudden you see that when this pops up a
box that says hey

219
00:18:58,380 --> 00:19:06,460
solution is disabled so most of the ABC
actually reduce their very few firewalls

220
00:19:06,460 --> 00:19:11,980
and very few others actually reduce
about that and they can one of the best

221
00:19:11,980 --> 00:19:16,890
ways to actually enumerate this has been
a job limb I W my eyes

222
00:19:16,890 --> 00:19:22,460
tool for both for different than the
attacker if you want to just people in a

223
00:19:22,460 --> 00:19:26,770
way of all the things you can do with
double my just go to Mac Raiders talk

224
00:19:26,770 --> 00:19:33,360
here at their pecan and and you're going
to have a great time there and learn a

225
00:19:33,360 --> 00:19:39,450
lot so when we look at my own sim in
Windows Vista 2008 is going to be

226
00:19:39,450 --> 00:19:45,010
registered under Security Center to in
the case of XP and 2003 they should be

227
00:19:45,010 --> 00:19:50,950
hmm there should be flog then there's
going to be under center I know I know

228
00:19:50,950 --> 00:19:57,120
there's a business reasons but three
reasons that Windows 2003 but I still

229
00:19:57,120 --> 00:20:04,590
going to environments 2594 and 2000
that's when it starts getting better so

230
00:20:04,590 --> 00:20:08,230
when we go there are typically what
they'll do is to their server products

231
00:20:08,230 --> 00:20:11,950
that can be registered arizona had
surpluses that we can actually create

232
00:20:11,950 --> 00:20:15,790
one of them is just simply enterprise
and we get all the enterprise products

233
00:20:15,790 --> 00:20:20,440
producer in that box you can have three
different enterprise products like my

234
00:20:20,440 --> 00:20:26,060
dad when time did somehow he would be
more secure so he went to night night

235
00:20:26,060 --> 00:20:29,150
and he just like that every under
various product that was there in

236
00:20:29,150 --> 00:20:31,920
nineteen ninety download that's
announced on install them on these call

237
00:20:31,920 --> 00:20:36,860
me like a Carling that's my nickname
Hollywood happening here my machines

238
00:20:36,860 --> 00:20:43,910
running super slow I'm like anything
that we all do know that website you

239
00:20:43,910 --> 00:20:51,070
showed me so I can install stuff quickly
yes well I downloaded version download

240
00:20:51,070 --> 00:20:55,410
don't because in CNN they were talking
about that there's going to be a

241
00:20:55,410 --> 00:20:59,510
weakening of people because everybody's
getting attacking information is getting

242
00:20:59,510 --> 00:21:03,780
stolen bubbly blonde our people are
going to their suicides in like yeah

243
00:21:03,780 --> 00:21:09,820
that's the story that you're not there I
checked

244
00:21:09,820 --> 00:21:17,170
products inside of the box and was
getting nervous and don't don't don't

245
00:21:17,170 --> 00:21:24,440
worry it's hard to say when you go into
the double Mikey you can actually should

246
00:21:24,440 --> 00:21:28,400
typically the crew would look like this
here is a sample of a modular road and

247
00:21:28,400 --> 00:21:32,090
Metasploit it only took me less than
five minutes to write it's very simple

248
00:21:32,090 --> 00:21:39,970
actually lets me do w my crease on the
box which is awesome thanks OJ please to

249
00:21:39,970 --> 00:21:46,580
finish fixing that so in this case I
just have a case statement or a half if

250
00:21:46,580 --> 00:21:52,320
I wanted crew for AP's by where fire war
or just all of them and here's an

251
00:21:52,320 --> 00:22:03,810
example of that marginal running over
there okay over here so there you will

252
00:22:03,810 --> 00:22:08,620
see it kind of an example of it running
and it should enumerate two different

253
00:22:08,620 --> 00:22:16,250
enterprise products are and that box and
when I think I like about my classes

254
00:22:16,250 --> 00:22:22,090
that when you get that data there's
going to be a specific field and it is

255
00:22:22,090 --> 00:22:25,020
great that when you go into it

256
00:22:25,020 --> 00:22:32,040
the six bite going from left to right
when you look at it you're be able to

257
00:22:32,040 --> 00:22:35,870
tell if the product is enabled or
disabled so much of his side's enough to

258
00:22:35,870 --> 00:22:37,600
give us that information

259
00:22:37,600 --> 00:22:44,920
different products will actually tell
you if they're up to date not update in

260
00:22:44,920 --> 00:22:51,510
a bit more information those classes in
addition to dad to believe so now we

261
00:22:51,510 --> 00:22:54,730
know that they have and her brother we
know which type of Thunderbirds product

262
00:22:54,730 --> 00:22:58,720
so now we can start driving our stuff
that we're going to be using for

263
00:22:58,720 --> 00:23:02,450
persistence or details that we're going
to use and we're going to test them for

264
00:23:02,450 --> 00:23:07,370
them but before we do that one thing to
have fun too many engagements is that

265
00:23:07,370 --> 00:23:12,900
they tend to set exclusions and here's
another Marshall this case our roads

266
00:23:12,900 --> 00:23:17,590
specifically for this offender that goes
into one of my lap boxes and goes and

267
00:23:17,590 --> 00:23:22,130
just Windows Defender has exclusions

268
00:23:22,130 --> 00:23:27,080
I will actually show that one of them is
a chair in the network when I tend to

269
00:23:27,080 --> 00:23:30,990
put over most of my paddle tennis stuff
that I'm testing on and also another one

270
00:23:30,990 --> 00:23:37,230
in which his test underscore code I just
put stuff in it so this is quite helpful

271
00:23:37,230 --> 00:23:44,260
for me to kind of protect how the
control actually implement we're

272
00:23:44,260 --> 00:23:49,200
starting to look at the controls are
starting to look at how the controls

273
00:23:49,200 --> 00:23:54,390
being configured and we're trying to see
how can we abused a conflagration that

274
00:23:54,390 --> 00:24:07,800
finish so I said controls may times
level controls when we start looking at

275
00:24:07,800 --> 00:24:11,370
them they will be a good indicator of
the level of maturity of that

276
00:24:11,370 --> 00:24:17,130
organization we're trying to get that
data it is like going to a fight

277
00:24:17,130 --> 00:24:21,160
industry and a punk goes like this hey
what's the problem

278
00:24:21,160 --> 00:24:26,580
already have an idea that the guys gonna
kick his teeth clenched 10 if it's going

279
00:24:26,580 --> 00:24:30,990
like this to you all the signs you see
that the guys were so just like a boxer

280
00:24:30,990 --> 00:24:38,140
mike 000 shit just by looking at the
posture of those controls your gonna

281
00:24:38,140 --> 00:24:46,330
know in what position you are and just
to remember even the simplest control

282
00:24:46,330 --> 00:24:52,670
can give us a way that this is why we
typically try to have a repeatable

283
00:24:52,670 --> 00:24:59,220
testable so peace standard operating
procedures so we can minimize that risk

284
00:24:59,220 --> 00:25:04,270
so one of the first things I like to do

285
00:25:04,270 --> 00:25:09,960
animating the audit policy I like to
know what they're actually auditing on

286
00:25:09,960 --> 00:25:15,350
the box now there are several ways that
you can actually do this one of them is

287
00:25:15,350 --> 00:25:19,720
using audit paul got a taxi which is a
tool inside of the box

288
00:25:19,720 --> 00:25:25,570
sadly my experience with that way east
coast company it was as soon as we ran

289
00:25:25,570 --> 00:25:31,929
it we got caught why well they're very
smart they have a bunch of tools that

290
00:25:31,929 --> 00:25:37,400
people run on the boxes so they run but
they trying to fix boxes and days set up

291
00:25:37,400 --> 00:25:43,990
in their same windows for maintenance
and anytime any of those tools are ran

292
00:25:43,990 --> 00:25:50,110
outside of one of those windows they
just put out a red alert for disagree

293
00:25:50,110 --> 00:25:58,030
team to check so if I hit and it's a net
a sage ipconfig power show Windows

294
00:25:58,030 --> 00:26:00,630
scripting host you scrape or anything
like that

295
00:26:00,630 --> 00:26:05,610
outside of that window you're gonna like
somebody somewhere is doing something

296
00:26:05,610 --> 00:26:09,630
they shouldn't do and they quickly check
the system that somebody opened a ticket

297
00:26:09,630 --> 00:26:16,000
for that post yes or now no ok don't
memory check connections let's see

298
00:26:16,000 --> 00:26:20,770
what's going on there because they
decide they have a very solid change

299
00:26:20,770 --> 00:26:24,659
management policy where they know that
nothing should happen on those boxes

300
00:26:24,659 --> 00:26:30,220
unless it is this day of the week
ordering this specific hours we were we

301
00:26:30,220 --> 00:26:34,690
have set up this I find it very
interesting because how many here have

302
00:26:34,690 --> 00:26:46,090
to read the book to finish by six or
seven ok highly highly recommend it but

303
00:26:46,090 --> 00:26:53,039
to be worn as you're reading that novel
you will have flashbacks so depending on

304
00:26:53,039 --> 00:26:57,809
the company that you have to work for in
your experience in life and if you have

305
00:26:57,809 --> 00:27:06,679
I T PTSD it may bring it out on it is a
very good novel where the guy just comes

306
00:27:06,679 --> 00:27:10,630
in his going in his looking at stuff and
one of the first things he need to

307
00:27:10,630 --> 00:27:12,370
change its change management

308
00:27:12,370 --> 00:27:16,909
why because all of the sudden D-day that
they have to put out the payroll

309
00:27:16,909 --> 00:27:22,399
everything crashes and everybody's going
to fall quite like that and when things

310
00:27:22,399 --> 00:27:27,029
have changed so if we can see that type
of behavior if we can see that type of

311
00:27:27,029 --> 00:27:31,830
organization into target for example we
go in we don't emails and we see emails

312
00:27:31,830 --> 00:27:39,179
that says change management we should
copy daddy Monreal typically we just go

313
00:27:39,179 --> 00:27:46,830
password secret sex and we look through
those overlooking the emails so I think

314
00:27:46,830 --> 00:27:55,899
I tend to do for the API is that I used
the next sect AP from the API that it

315
00:27:55,899 --> 00:28:02,169
you library I just bought a small C++
program yes I know C++ songs I should

316
00:28:02,169 --> 00:28:09,399
have done it didn't see but I'm not
elite so I can just see them at greater

317
00:28:09,399 --> 00:28:18,609
risk off people's plus you can see that
in assembly c'mon challenge yourself I'm

318
00:28:18,609 --> 00:28:24,710
just so yeah here's a small sample we
can see unloading those libraries and

319
00:28:24,710 --> 00:28:28,619
I'm using certain calls one of things
differently I do a side dish category

320
00:28:28,619 --> 00:28:34,229
then I numerate of the sub categories
and then I go up there so I tried to

321
00:28:34,229 --> 00:28:35,979
identify what's going on there

322
00:28:35,979 --> 00:28:41,269
you like Carlos when you run because I
can get caught I need to know if process

323
00:28:41,269 --> 00:28:47,759
audit and that box so only by me being
able to run an exploit and getting a

324
00:28:47,759 --> 00:28:52,409
shell on top box for Fulham interpreter
or beacon or something like that that

325
00:28:52,409 --> 00:28:54,739
its members

326
00:28:54,739 --> 00:29:00,989
memory I may have already given myself
away I don't wanna make more noise on

327
00:29:00,989 --> 00:29:06,309
that box that may get caught because
probably was an HTA attack and macro

328
00:29:06,309 --> 00:29:10,619
attack they're probably drop something
on this and probably already had system

329
00:29:10,619 --> 00:29:15,859
on how was injecting into memory systems
says a somebody creator remote threat

330
00:29:15,859 --> 00:29:21,590
look at this so I may have given myself
away I don't want to make more noise

331
00:29:21,590 --> 00:29:27,480
target so one of the things I do in my
case here's an example of mature for her

332
00:29:27,480 --> 00:29:34,160
I use execute head in China lies
interactive in memory I give it a dummy

333
00:29:34,160 --> 00:29:37,270
file and disk I in this case is going to
be no pipe

334
00:29:37,270 --> 00:29:45,440
taxi come on who monitors for Godot
accident at work almost nobody so and

335
00:29:45,440 --> 00:29:51,300
then I just give it my XP which is get
on it paul it runs and it gives me all

336
00:29:51,300 --> 00:29:55,080
the information of what is actually
being audited if it is for sure says her

337
00:29:55,080 --> 00:30:02,650
failure I'm getting all of that info is
running in memory so if I see process

338
00:30:02,650 --> 00:30:08,080
auditing be monitored one of the first
things that I'm going to check this for

339
00:30:08,080 --> 00:30:14,910
specific registry key that specific
registry key is on there is a machine

340
00:30:14,910 --> 00:30:19,700
software Microsoft Windows current
version policies system audit and it's

341
00:30:19,700 --> 00:30:25,970
going to be called process creation
include command line if you have ever

342
00:30:25,970 --> 00:30:31,190
had the displeasure of working with the
event locks and windows for process

343
00:30:31,190 --> 00:30:39,040
auditing day only Khanna they'd like to
cheesy like to say hey something wrong

344
00:30:39,040 --> 00:30:42,500
here and that's all

345
00:30:42,500 --> 00:30:48,980
created you get a pit oh and by the way
we're gonna give it to you export like

346
00:30:48,980 --> 00:30:56,750
come on and they can deliver information
is limited so you only know when it ran

347
00:30:56,750 --> 00:31:01,640
on their own account and went and other
information in there that you may find

348
00:31:01,640 --> 00:31:06,490
useful you actually have to hammer it
out of that event locked it takes a bit

349
00:31:06,490 --> 00:31:17,270
of processing now they did improve a bit
recently this year there's DKB 343 75

350
00:31:17,270 --> 00:31:25,730
that installed in windows 7 or an 2008
art are too it is also already included

351
00:31:25,730 --> 00:31:32,430
with Windows 10 Windows a 81 Windows
2012 2004 to that actually lets me get

352
00:31:32,430 --> 00:31:37,650
dat command line how many here were in
the presentation that leone's did today

353
00:31:37,650 --> 00:31:46,240
about power show everybody awesome so
everybody saw when he was doing his

354
00:31:46,240 --> 00:31:51,710
example of out the encoder commanders
dashing Cody command and you saw all of

355
00:31:51,710 --> 00:31:56,010
everything that was running at a command
line I'm not even going to ask who was

356
00:31:56,010 --> 00:32:00,900
in protects presentation because he has
to be almost everybody and he also

357
00:32:00,900 --> 00:32:06,450
covered several techniques and when you
look at those you're going to find them

358
00:32:06,450 --> 00:32:10,510
in the process audit log you're going to
see there but you're only going to see

359
00:32:10,510 --> 00:32:18,000
Annex II I can rename unique as to what
everyone from a full there probably may

360
00:32:18,000 --> 00:32:24,730
confuse the user is looking at it may
not know about it but when you start

361
00:32:24,730 --> 00:32:30,680
looking at the full command line then
you start getting more details and then

362
00:32:30,680 --> 00:32:34,850
you start moving to higher versions of
Windows like Windows 2012 when you do

363
00:32:34,850 --> 00:32:40,930
disable enable full command line 40
parent process so all of the sudden

364
00:32:40,930 --> 00:32:45,540
happy Purim process full command line
and shell process full command line I'm

365
00:32:45,540 --> 00:32:51,990
able to kind of see what's actually
going on which is awesome

366
00:32:51,990 --> 00:32:58,570
to mention kinda like some of the
information filled the gap commercial

367
00:32:58,570 --> 00:33:05,630
products you can use tenable correlation
engine first there's also Microsoft

368
00:33:05,630 --> 00:33:12,560
system on which only exception that
keeps changing scheme out of the rules

369
00:33:12,560 --> 00:33:16,360
and the documentation is a couple of
weeks later which kind of breaks a bunch

370
00:33:16,360 --> 00:33:19,810
of my stuff but other than that is
awesome

371
00:33:19,810 --> 00:33:28,610
still balking christians mark alleged
unblock me then you have it nine carbon

372
00:33:28,610 --> 00:33:32,820
black I know that everybody kind of
troops on them I've actually seen

373
00:33:32,820 --> 00:33:40,610
children of CBT taxi and stuff like that
but it's good it is like system on super

374
00:33:40,610 --> 00:33:45,650
high school so if you don't have the
budget to go with system on tends to be

375
00:33:45,650 --> 00:33:51,110
awesome so here we have an example of a
system on entry when we look at it won't

376
00:33:51,110 --> 00:33:55,350
fit for seeing step we're going to
notice we're getting the full amount

377
00:33:55,350 --> 00:34:00,660
mind that is an example of our power of
interpreter payload that actually export

378
00:34:00,660 --> 00:34:08,320
it as empower those running there
actually was so big that it had to be

379
00:34:08,320 --> 00:34:12,370
compressed show you the first game and
that you're seeing is just that Baylor

380
00:34:12,370 --> 00:34:16,510
running in a compressed mode and then
that is invoking again PowerShell to

381
00:34:16,510 --> 00:34:17,720
dinner Brian

382
00:34:17,720 --> 00:34:25,650
on codek code to compress code so then
you see actually ran there in addition

383
00:34:25,650 --> 00:34:30,440
today you can see the intermediate level
injury able to give him information

384
00:34:30,440 --> 00:34:35,220
under what privileges it was running
than one thinks I'm saying is that

385
00:34:35,220 --> 00:34:39,690
they're hashing file so then they if
they decided that something dangerous

386
00:34:39,690 --> 00:34:44,870
they can take the hash that process to
start looking to their network this is

387
00:34:44,870 --> 00:34:49,990
scary if your red team just means my
tools can be tracked a lot easier just

388
00:34:49,990 --> 00:34:54,800
means they can track my movements inside
of the network not only that but it will

389
00:34:54,800 --> 00:35:00,130
also start monitoring your network
connections for those files so typically

390
00:35:00,130 --> 00:35:04,540
what people will do is set up a rule for
sis Montes says ignoring checked water

391
00:35:04,540 --> 00:35:10,960
or fire fire Firefox Chrome ignored
Windows Update Service any other network

392
00:35:10,960 --> 00:35:16,580
connection that you or any other person
I am client for jabber have chat and dad

393
00:35:16,580 --> 00:35:23,420
then any other connection out there that
gets it wrong that I want to see it and

394
00:35:23,420 --> 00:35:28,020
ship it to me it does that every 15
seconds so you have a 15 second window

395
00:35:28,020 --> 00:35:32,310
before it gets reported same for UDP
calls

396
00:35:32,310 --> 00:35:37,030
and then if you want to be even more
scared one thing to actually sit among

397
00:35:37,030 --> 00:35:44,010
can do is ours I am migrating from one
process to the other or I'm injecting a

398
00:35:44,010 --> 00:35:49,390
payload into another process when you're
doing that you're so they have a list of

399
00:35:49,390 --> 00:35:54,810
calls that they typically check that
malware use this and it will do at

400
00:35:54,810 --> 00:35:59,950
remote create remote threat and they'll
detect that and chili from what process

401
00:35:59,950 --> 00:36:05,470
do what process was done in this case it
caught me migrating from PowerShell to

402
00:36:05,470 --> 00:36:10,640
nope at tonic see so we have to be
careful now they have this ability to

403
00:36:10,640 --> 00:36:19,950
know as we've been moving inside of
memory anyway the only process and

404
00:36:19,950 --> 00:36:26,790
windows that does this by default it is
w my so the only thing you have to do is

405
00:36:26,790 --> 00:36:31,330
just go on their damn process and then
you can do all four injections you want

406
00:36:31,330 --> 00:36:36,860
and if they rules are kinda lacks
bypassed dose for detection it is deep

407
00:36:36,860 --> 00:36:43,270
only process I know in a windows box
that create remote threats by people on

408
00:36:43,270 --> 00:36:51,510
a regular box in the network so here
happen example of detecting system is

409
00:36:51,510 --> 00:36:58,900
running against windows 2010 host I'll
be able to see what is actually longing

410
00:36:58,900 --> 00:37:05,810
for his lawyer network connections if it
is logging if there's hashing it will

411
00:37:05,810 --> 00:37:07,710
tell me if their rules or not

412
00:37:07,710 --> 00:37:12,690
advancers up six months I can create
rules so what information can gain about

413
00:37:12,690 --> 00:37:18,210
this is also the maturity level because
probably they deployed system but if I

414
00:37:18,210 --> 00:37:25,450
don't see rules that means they're still
in diapers they're still playing with it

415
00:37:25,450 --> 00:37:31,280
they're not lowered to neutral to the
extreme so I won't get that scared if I

416
00:37:31,280 --> 00:37:37,210
see it if I don't see rules I don't see
some other stuff enable I just gauge

417
00:37:37,210 --> 00:37:43,790
their maturity and conjugate guessing
where they are in terms of operation

418
00:37:43,790 --> 00:38:29,660
that finished running so running change
my settings here for many times what

419
00:38:29,660 --> 00:38:33,480
we're trying to do is kinda minimize the
amount of noise that we have to deal

420
00:38:33,480 --> 00:38:40,610
with so yeah many times I i just tell
countries you're sorry you're not that

421
00:38:40,610 --> 00:38:46,410
good at managing logs don't enable on
all of your client machines login

422
00:38:46,410 --> 00:38:51,320
transporter is to just gonna get
pummeled with logs same for Firefox

423
00:38:51,320 --> 00:38:57,610
theme for Chrome now in your servers is
a different story on your servers if you

424
00:38:57,610 --> 00:39:03,380
catch somebody using water on server you
should go and slappin same for Firefox

425
00:39:03,380 --> 00:39:12,400
or Chrome some organizations have a jury
a resume generating event

426
00:39:12,400 --> 00:39:22,529
so we have to be careful in those ok now
we're moving over to whitelist and

427
00:39:22,529 --> 00:39:28,029
blacklist rarely implemented the main
white I still haven't seen one single

428
00:39:28,029 --> 00:39:34,710
organization that has deployed a blocker
du Bain why is difficult to manage its

429
00:39:34,710 --> 00:39:42,180
not the East you still up there I have
to admit mostly used for systems are

430
00:39:42,180 --> 00:39:47,000
actually let's say your section is
systems are are accessible to other

431
00:39:47,000 --> 00:39:52,549
people feel where's the case of target
probably should have used to what was

432
00:39:52,549 --> 00:39:59,740
said in the picture

433
00:39:59,740 --> 00:40:03,039
area where the infected the mission that
they moved to the POS should have to

434
00:40:03,039 --> 00:40:09,730
stay you can actually use it in audit
mode and you can get a bunch of

435
00:40:09,730 --> 00:40:15,329
information is is it could be used as a
poor man's login system it works awesome

436
00:40:15,329 --> 00:40:22,299
if you wanna learn a bunch of techniques
about bypassing whitelisting sub 3

437
00:40:22,299 --> 00:40:29,880
I think St Supt is one of those guys I i
she's aware of his new and commuter not

438
00:40:29,880 --> 00:40:36,559
but one thing I notice it is he takes it
as a personal challenge to bypass

439
00:40:36,559 --> 00:40:41,960
whitelisting products are blacklisted
products out there are highly recommend

440
00:40:41,960 --> 00:40:49,720
spot pose also his device cart is too
great improvement it's a lot easier to

441
00:40:49,720 --> 00:40:55,529
configure a lot easier to deploy a lot
easier to manage but is still starting

442
00:40:55,529 --> 00:41:00,270
out we'll have to wait and see how many
people actually played with just 10

443
00:41:00,270 --> 00:41:06,940
over 75 million off their of them out
there probably not many enterprises but

444
00:41:06,940 --> 00:41:12,279
it's out there and there are some
bypasses the agency has over the phone

445
00:41:12,279 --> 00:41:17,430
that Microsoft is already working in
Texas on those here's an example

446
00:41:17,430 --> 00:41:40,670
on a blocker when I just go and water
would have been here in June a blocker

447
00:41:40,670 --> 00:41:46,300
of these modules you can find them in my
gear on the dot com dot operator there's

448
00:41:46,300 --> 00:41:53,670
on the proposed new scripts I know just
told everybody is imposed martial sound

449
00:41:53,670 --> 00:41:59,920
so here you can see I said a session I
run it I'm running against my target box

450
00:41:59,920 --> 00:42:09,170
it goes into registry pools of the issue
of different roles are in XML format in

451
00:42:09,170 --> 00:42:17,450
the registry forces XML as I'm going in
our show allows power show from a

452
00:42:17,450 --> 00:42:22,089
specific location so that means if I'm
going to do anything with power show I

453
00:42:22,089 --> 00:42:30,599
do it from that location I said to allow
anyone under rule so that it's already

454
00:42:30,599 --> 00:42:35,780
given the information who can actually
run it or not I can actually check if it

455
00:42:35,780 --> 00:42:42,119
is enforced or if it is set up to audit
also the rules here you can see this as

456
00:42:42,119 --> 00:42:48,579
a script enable so the rule is actually
being forced on MSI packets are no rules

457
00:42:48,579 --> 00:42:53,280
is actually it's disabled so that means
I can probably use a massage it's one of

458
00:42:53,280 --> 00:42:58,290
my back doors and that box for
persistence I can set up fake emphasized

459
00:42:58,290 --> 00:43:00,500
and they make sure

460
00:43:00,500 --> 00:43:05,190
a technique they don't know if it's
public are a lot of people are actually

461
00:43:05,190 --> 00:43:10,780
using is that they'll put an Amazon box
that is back toward and dental go via

462
00:43:10,780 --> 00:43:16,110
WMI and run win32 underscore product
when you create a double in my closet

463
00:43:16,110 --> 00:43:20,430
with actually forces system to rebuild
the a massage and then they get back

464
00:43:20,430 --> 00:43:28,580
their control in the box if not I
apologize to my friend for his technique

465
00:43:28,580 --> 00:43:36,100
sorry dude also here you can see details
are enabled during the audit mode so

466
00:43:36,100 --> 00:43:42,630
he'll also are being loaded for being
ran their audit on that box and they can

467
00:43:42,630 --> 00:43:46,300
pull that information so right now I
just got a bunch of information how they

468
00:43:46,300 --> 00:43:52,550
have that box set up now I know how to
behave in that box so I just went from

469
00:43:52,550 --> 00:43:59,070
anti buyers I went over to how their
login stuff and now I look at the

470
00:43:59,070 --> 00:44:05,210
controls now I know how I can behave
inside of that environment now not yet

471
00:44:05,210 --> 00:44:10,250
because we just look at windows but we
haven't looked at other stuff those of

472
00:44:10,250 --> 00:44:14,370
you who were at least homes presentation
today you notice that PowerShell has

473
00:44:14,370 --> 00:44:18,880
alotta long can it now can actually take
a pawn shops detect a bunch of stuff

474
00:44:18,880 --> 00:44:25,550
especially if you're running Windows
2012 or Windows 8.1 or above but partial

475
00:44:25,550 --> 00:44:30,280
version for an update 1 reply to it you
have all of those nice it is that you

476
00:44:30,280 --> 00:44:35,830
saw almost all of them that you saw 45
now you have them also on those systems

477
00:44:35,830 --> 00:44:42,650
I can start tracking those of you took
my class we covered how to also like you

478
00:44:42,650 --> 00:44:47,130
can actually log and see previous
versions of power show and it's quite a

479
00:44:47,130 --> 00:44:53,630
bit so you can still be detected so we
still have to check for other stuff and

480
00:44:53,630 --> 00:44:59,050
Annamarie that information how that
extra stuff is being locked so here we

481
00:44:59,050 --> 00:45:00,239
have an example

482
00:45:00,239 --> 00:45:14,859
get my different sessions none of them
is my work laptop I promise I don't use

483
00:45:14,859 --> 00:45:20,799
post windows gather and this is my own
module and MPs and I'm running a box

484
00:45:20,799 --> 00:45:29,479
checked the info on this phone number
eighteen power show set my session like

485
00:45:29,479 --> 00:45:43,319
always run it under hot I see the
partial version 50 profile back toward a

486
00:45:43,319 --> 00:45:50,749
execution policy high up to bypass or
not cause if you see that they're

487
00:45:50,749 --> 00:45:54,039
setting actually imposing become a line
while they're looking at it they might

488
00:45:54,039 --> 00:46:01,509
attack me also I see you're logging shed
you can try to model so I am loading out

489
00:46:01,509 --> 00:46:06,839
small tip when you enable module logging
and you launch PowerShell da taxi India

490
00:46:06,839 --> 00:46:10,919
about locks it will add to full command
line of how you invoke the program that

491
00:46:10,919 --> 00:46:14,769
is running that run space so you will
get the full from a line for partial BA

492
00:46:14,769 --> 00:46:20,019
taxi also the full command line for ISE
or any other program that run that runs

493
00:46:20,019 --> 00:46:22,219
base that is kind of like a need

494
00:46:22,219 --> 00:46:28,259
addition when you enable my dogging you
can see screw plug logging for disabled

495
00:46:28,259 --> 00:46:29,059
or not

496
00:46:29,059 --> 00:46:34,209
transcripts and the transcript Barbie
movie if it is in the network or locally

497
00:46:34,209 --> 00:46:40,489
that is kind of fun to kind of check
then we start checking for centralized

498
00:46:40,489 --> 00:46:44,359
logging other Central Islip their locks
Rd checking well there are two different

499
00:46:44,359 --> 00:46:49,089
ways of doing this one of them is pull
was somebody from the outside going to

500
00:46:49,089 --> 00:46:53,499
my box and pulling those locks problem
there live it and what they do typically

501
00:46:53,499 --> 00:46:58,849
they used to love my job I am I gonna
give them your regular old talks cannot

502
00:46:58,849 --> 00:47:04,469
get to the ones then there's the other
method what is pushing agents or they

503
00:47:04,469 --> 00:47:09,359
use PowerShell forwarding when you use
PowerShell forwarding actually need to

504
00:47:09,359 --> 00:47:13,640
configure died in the box and we can
actually enumerate that so

505
00:47:13,640 --> 00:47:21,829
a lot better for us here we have an
example on event forwarding I'm drawn in

506
00:47:21,829 --> 00:47:23,130
the box

507
00:47:23,130 --> 00:47:29,109
session I'll check it will check for
Windows Phone forwarding if it is a

508
00:47:29,109 --> 00:47:35,890
computer to push to a server and to what
server settings for that I run it is

509
00:47:35,890 --> 00:47:39,980
pulling all of the information from the
registry I still hate your connecting to

510
00:47:39,980 --> 00:47:45,180
a server this is your server on this
border just this man you're only

511
00:47:45,180 --> 00:47:50,609
connecting to one single server this is
another indicator of maturity if they're

512
00:47:50,609 --> 00:47:53,710
sending your locks to two or three of
those servers I know that they really

513
00:47:53,710 --> 00:47:59,910
know their stuff they're sending it to
one there's kind of starting off also I

514
00:47:59,910 --> 00:48:06,490
see you refresh rate how often are
saying that info so what other things

515
00:48:06,490 --> 00:48:11,359
that we have to do so we have to control
noise just one of the things that many

516
00:48:11,359 --> 00:48:15,720
of these people are looking for patterns
and many times since they get a lot of

517
00:48:15,720 --> 00:48:20,970
false positives they'll set boundaries
on their patterns that if this is

518
00:48:20,970 --> 00:48:26,430
trigger five-time four times three times
then trigger an alert so we have to play

519
00:48:26,430 --> 00:48:31,839
dat mind games with them so we have to
control over execution many times I used

520
00:48:31,839 --> 00:48:37,640
to teach a class which was automating
Metasploit and one of things that they

521
00:48:37,640 --> 00:48:42,740
have 20 channels and their run command
against all twenty chills and five of

522
00:48:42,740 --> 00:48:46,299
them were on a single host and all of
the sudden you fell into that pattern

523
00:48:46,299 --> 00:48:52,670
you were not checking for uniqueness in
this case have any of you use my pentas

524
00:48:52,670 --> 00:49:01,829
plugin for Metasploit Framework ok
sounds that I wrote 28 a pen tester with

525
00:49:01,829 --> 00:49:04,740
a bunch of additional tools for
automating stuff so one of things I

526
00:49:04,740 --> 00:49:09,369
added to most of the precipitation
commands is for uniqueness it will check

527
00:49:09,369 --> 00:49:14,240
the idea of that machine and it will
then check the credentials and will make

528
00:49:14,240 --> 00:49:18,750
sure that you don't hit that box twice
on their doctor attention when you're

529
00:49:18,750 --> 00:49:25,150
reading your post exploitation actions
today said good way to control noise

530
00:49:25,150 --> 00:49:29,260
when it comes to determining your
footprint one of the things I tell

531
00:49:29,260 --> 00:49:36,680
people is building set up walking
properly install system on you see a

532
00:49:36,680 --> 00:49:42,799
cheat sheets from archaeology on how to
set logging and auditing said all that

533
00:49:42,799 --> 00:49:43,490
stuff

534
00:49:43,490 --> 00:49:47,819
see what footprint your living there and
then just tried to me my set and also

535
00:49:47,819 --> 00:49:51,789
start prepping the templates for when
you're writing reports so you can tell

536
00:49:51,789 --> 00:49:52,930
your customers

537
00:49:52,930 --> 00:49:58,710
this is my footprint also capture
network traffic and then run that does

538
00:49:58,710 --> 00:50:03,420
speak apps against other tools and get
into the habit of doing that P cap also

539
00:50:03,420 --> 00:50:09,940
to your customer for them to test and no

540
00:50:09,940 --> 00:50:14,849
also if you have the chance installed
tools to look for these patterns that

541
00:50:14,849 --> 00:50:19,000
through the analysis we have a terrible
locker Legion engine that does great

542
00:50:19,000 --> 00:50:23,650
work there we have Splunk where you can
write some additional hand tools hand

543
00:50:23,650 --> 00:50:28,890
tools to detect this type of anomaly and
one of the recent additions house there

544
00:50:28,890 --> 00:50:33,210
which is one of my favorite so far is
Microsoft pamphlets and allowed except

545
00:50:33,210 --> 00:50:37,700
will actually kinda weird time bills
what is normal behavior in your network

546
00:50:37,700 --> 00:50:45,930
and if you do something that doesn't fit
it will trigger and so remember we're

547
00:50:45,930 --> 00:50:52,829
dealing with blue team explained eins
questions

548
00:50:52,829 --> 00:51:11,299
yes I'll have to check if I can share
his code is somebody that i'm gonna make

549
00:51:11,299 --> 00:51:15,069
this public sometime I don't know where
I want to clean it up and it should show

550
00:51:15,069 --> 00:51:22,589
it to me I like oh that's cool and other
questions if not I wish you guys a good

551
00:51:22,589 --> 00:51:23,440
day and thanks

