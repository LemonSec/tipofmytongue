1
00:00:00,000 --> 00:00:32,610
thank you very much

2
00:00:32,610 --> 00:00:44,260
I am Ben 10 it's not access it's a zero
you know that's not been accessed from

3
00:00:44,260 --> 00:00:53,070
Chicago but I'm actually relocating to
Dallas on Monday yes I know I know I

4
00:00:53,070 --> 00:00:56,710
work at a company called by a point
which is an spf in Auburn Hills Michigan

5
00:00:56,710 --> 00:01:01,410
go my sack out when a good

6
00:01:01,410 --> 00:01:05,759
250 drive against developer secretary
for creators of the guys I know

7
00:01:05,759 --> 00:01:06,770
something about that

8
00:01:06,770 --> 00:01:16,110
about that project but I did bring my
son with me but unfortunately you know

9
00:01:16,110 --> 00:01:19,729
in discussing things my son looks at me
and he says Rubin Paul is going to be

10
00:01:19,729 --> 00:01:26,240
there so I'm going to ribbons so on the
count of three were all going to yell

11
00:01:26,240 --> 00:01:33,600
thanks Ruben ready 123

12
00:01:33,600 --> 00:01:50,820
she's my little guy is here I brought
him just to show you that there are

13
00:01:50,820 --> 00:01:56,450
people that are shorter than me so they
do exist and everyone that's walked

14
00:01:56,450 --> 00:01:59,080
around they're still giving me crap
about my height though then they look at

15
00:01:59,080 --> 00:02:04,930
him like to do so did you bring your son
with you I'm three-quarters my dad high

16
00:02:04,930 --> 00:02:06,030
time to be taller than him

17
00:02:06,030 --> 00:02:12,360
alright so I did you a contest I can you
ever years old number into this kind of

18
00:02:12,360 --> 00:02:15,930
quick we're a little bit behind schedule
I wanna be fair the next speaker but I

19
00:02:15,930 --> 00:02:19,120
didn't contest this year as a as I'm
done every year becoming an annual event

20
00:02:19,120 --> 00:02:23,530
we're giving away free tickets to be
kind and the whole idea that you know

21
00:02:23,530 --> 00:02:28,440
typically it's something with Photoshop
with me and so this year I try to do

22
00:02:28,440 --> 00:02:29,410
something a little different

23
00:02:29,410 --> 00:02:34,489
those who may not know I help out with
besides Joint Task Force capture the

24
00:02:34,489 --> 00:02:38,209
flag events that we were doing in
Chicago Michigan City County Indiana

25
00:02:38,209 --> 00:02:42,780
couple of years ago and I'm big into
steganography love it so this year I

26
00:02:42,780 --> 00:02:48,950
kinda tired that into the contest so you
had to go and then if you got the right

27
00:02:48,950 --> 00:02:53,660
could you were able to enter the contest
so this is the winning entry loves to

28
00:02:53,660 --> 00:02:57,410
run trains run still won't survive shirt

29
00:02:57,410 --> 00:03:01,550
so I thought that was an extra line that
was done by Chris can you guys

30
00:03:01,550 --> 00:03:03,540
difference being random +

31
00:03:03,540 --> 00:03:14,050
where you busy in here I get a free
ticket should I talk he's next door

32
00:03:14,050 --> 00:03:24,740
here's a text when I was little
disturbed by this wine has been will

33
00:03:24,740 --> 00:03:26,740
unfortunately not live through this

34
00:03:26,740 --> 00:03:40,270
apocalypse GATT treaty can on a kid's
body thank you very kindly man running

35
00:03:40,270 --> 00:03:42,790
man three popular

36
00:03:42,790 --> 00:03:45,290
the four spot check maybe

37
00:03:45,290 --> 00:03:56,980
I'm going for a run what's the worst
that can happen I did make it worse by

38
00:03:56,980 --> 00:04:04,420
not running a five-game losing to a guy
who was clearly not prepared for it at

39
00:04:04,420 --> 00:04:08,470
the end of this race this is the first
time I've ever been photoshopped on a

40
00:04:08,470 --> 00:04:18,220
woman's body and I say I look great so
this is chasing me runs mystery solved

41
00:04:18,220 --> 00:04:28,660
so this guy is messed up in the head so
he does this ETF thing and the whole

42
00:04:28,660 --> 00:04:33,000
premise was actually create a running
knee and so the one of the first ones he

43
00:04:33,000 --> 00:04:44,949
sent me this and I'm like a running once
they sent me this now I know seriously

44
00:04:44,949 --> 00:04:50,650
I'm running late so that and then the
final one was the enemy get me running

45
00:04:50,650 --> 00:04:57,400
chasing child no less so that was fun so
I do want to talk to you guys a little

46
00:04:57,400 --> 00:05:01,710
bit about what we talked about today's
show we can talk about how to use

47
00:05:01,710 --> 00:05:05,610
PowerShell heard good things and evil
things as well but here's my disclaimer

48
00:05:05,610 --> 00:05:15,620
its lorem ipsum no seriously you guys
I'm not saying you guys go back to your

49
00:05:15,620 --> 00:05:18,500
enterprise environments pop
administrator and you take a toll on us

50
00:05:18,500 --> 00:05:22,110
on some of the stuff a lot of the stuff
I didn't write

51
00:05:22,110 --> 00:05:26,330
some of it can destroy things if you
want a cool tool to measure and let

52
00:05:26,330 --> 00:05:29,170
somebody use manifestations

53
00:05:29,170 --> 00:05:32,970
critical process and what this will do
is it'll take PowerShell in a critical

54
00:05:32,970 --> 00:05:36,930
process you leave the PowerShell running
back to their destinations type Exeter

55
00:05:36,930 --> 00:05:43,440
hit the X in it blue screens in AZ just
don't do it on your domain controller

56
00:05:43,440 --> 00:05:49,650
all rights this stock is not enter a
powershell ok I did it last year

57
00:05:49,650 --> 00:05:54,130
talk last year that Interpol show oK so
that's not this time we're not doing

58
00:05:54,130 --> 00:05:57,730
intro we're gonna be very fast very
quick there's no way I can do all of

59
00:05:57,730 --> 00:06:03,050
that no one would you want to see that
talk it's up and it's a slight shirring

60
00:06:03,050 --> 00:06:09,800
available see ok so you can get that
they're okay so quick overview we are

61
00:06:09,800 --> 00:06:13,800
gonna dive into dotnet we're going to
get some of the offensive tools in the

62
00:06:13,800 --> 00:06:19,200
defense of tools will look at some
resources and hugs ok but before we go

63
00:06:19,200 --> 00:06:38,260
any further I have limited edition

64
00:06:38,260 --> 00:06:42,350
these were scoreless

65
00:06:42,350 --> 00:06:45,790
stress he gave us some limited edition
powers

66
00:06:45,790 --> 00:06:52,120
PowerShell challenge coins ok there's
not very many of these things to carlos

67
00:06:52,120 --> 00:06:58,070
has donated is my talk if you ask me a
non in named questioned something

68
00:06:58,070 --> 00:07:01,240
related to what we're talking about and
it's possible you'll get a challenge

69
00:07:01,240 --> 00:07:07,660
claim okay and then I have three tokens
to tonight's party for free drinks ok so

70
00:07:07,660 --> 00:07:13,400
you guys can choose one of the other one
rogue on their way out there alright so

71
00:07:13,400 --> 00:07:20,420
let's look at it he said that at home
how she'll actually sit on dotnet ok so

72
00:07:20,420 --> 00:07:24,800
one of the things that most people don't
realize is you know it was developed by

73
00:07:24,800 --> 00:07:31,060
Microsoft a sexy guy right here is one
of the sexiest like this is my

74
00:07:31,060 --> 00:07:37,640
background image you know nothing better
than being you then bill but it is a

75
00:07:37,640 --> 00:07:41,050
Microsoft product it's not it's not a
Linux things that Python whatever the

76
00:07:41,050 --> 00:07:43,760
case may be and it's it took a long time
to actually pick up speed and momentum

77
00:07:43,760 --> 00:07:47,920
and now there's what six PowerShell
talks use this year so it's super

78
00:07:47,920 --> 00:07:51,650
awesome great see a lot of the stuff
that's going on at that but you know

79
00:07:51,650 --> 00:07:55,670
before you actually begin to creating a
2004 defense you actually need to

80
00:07:55,670 --> 00:07:59,010
understand what you're doing you know
there's a lot of wrong way to actually

81
00:07:59,010 --> 00:08:00,340
developing right at all

82
00:08:00,340 --> 00:08:03,860
you can make a tool that's great but it
you know if you don't understand what's

83
00:08:03,860 --> 00:08:05,980
going on in the background then you're
not going to be an effective attack

84
00:08:05,980 --> 00:08:11,150
you're certainly not going to be
effective defender so this is something

85
00:08:11,150 --> 00:08:14,810
that must be very surprised about
PowerShell is not PowerShell that you

86
00:08:14,810 --> 00:08:24,750
see how show that you see is not our
show it's just host application the

87
00:08:24,750 --> 00:08:29,340
whole idea here is that you can actually
do PowerShell with out our show that you

88
00:08:29,340 --> 00:08:33,690
see where PowerShell lives is system
data management that automation that

89
00:08:33,690 --> 00:08:39,300
yellow that is where the magic happens
that's where there's butterflies ponies

90
00:08:39,300 --> 00:08:41,270
and Dave Kennedy

91
00:08:41,270 --> 00:08:46,970
seriously that's where it happens so let
me show you a little bit what's what's

92
00:08:46,970 --> 00:08:53,250
happening with this so this is what you
would see in PowerShell you see then you

93
00:08:53,250 --> 00:08:59,300
have to host application so that's how
you see this is what's happening on the

94
00:08:59,300 --> 00:09:03,340
background you have individual overruns
base yet pipeline you can have local

95
00:09:03,340 --> 00:09:08,970
pipelines then you have your command let
scripts functions out with all of this

96
00:09:08,970 --> 00:09:14,520
can be managed manipulated and messed
around with without power so that you

97
00:09:14,520 --> 00:09:26,310
see me show you a little bit but that so
so unless putes ni se PowerShell

98
00:09:26,310 --> 00:09:33,550
ok so what I've done is have actually
created a separate instance of

99
00:09:33,550 --> 00:09:38,800
PowerShell said you look here the type
of my variable is actually our show so I

100
00:09:38,800 --> 00:09:52,450
can actually go now a man date right now
it worked

101
00:09:52,450 --> 00:09:56,940
it's the same as this but the difference
is that it's in a separate runs its own

102
00:09:56,940 --> 00:10:01,500
inspector pipeline so you know that's
well and fine but let me show you

103
00:10:01,500 --> 00:10:05,490
something else going close to our show
and make sure PowerShell isn't running

104
00:10:05,490 --> 00:10:18,330
ignore the process has any power-sharing
yes I now know ok so let's go ahead over

105
00:10:18,330 --> 00:10:27,430
here so this is my awesomer shell so
this is awesomer than our show so what

106
00:10:27,430 --> 00:10:34,930
I've done is put into the system to
ensure I have set up our Celtic Tree as

107
00:10:34,930 --> 00:10:39,240
I just showed you guys just a moment ago
on the strip command whatever you type

108
00:10:39,240 --> 00:10:42,960
into this command and now I'm not doing
input senators a chanel is ever going to

109
00:10:42,960 --> 00:10:45,030
buy stuff

110
00:10:45,030 --> 00:10:48,620
then go ahead invoking the bully I don't
back out alright let's go and take a

111
00:10:48,620 --> 00:10:51,130
look and see what that does

112
00:10:51,130 --> 00:10:58,640
alright alright do it and get my process
and I type over here this is set to

113
00:10:58,640 --> 00:11:02,870
always on top so you guys can see
PowerSeller pops up if you guys see

114
00:11:02,870 --> 00:11:21,450
PowerShell pop up so I say get out
string now that's Powershot come in so

115
00:11:21,450 --> 00:11:26,550
the whole idea here is that you can
actually build your own runs base your

116
00:11:26,550 --> 00:11:32,860
own pipeline put all those commands in
its memory so if you think from a

117
00:11:32,860 --> 00:11:36,650
defender side if you think you're just
going to whitelist patter blacklist

118
00:11:36,650 --> 00:11:39,590
PowerShell that you see in your gonna
win you're wrong

119
00:11:39,590 --> 00:11:44,380
ok that's not how you solve this problem

120
00:11:44,380 --> 00:11:50,740
blacking power should not exceed doesn't
solve it i just i I could use awesome

121
00:11:50,740 --> 00:12:00,360
Michelle ok cuz it's awesomer so you
have to rethink your defensive

122
00:12:00,360 --> 00:12:06,260
strategies when you're looking at this
because anyone can do this and I i didnt

123
00:12:06,260 --> 00:12:10,400
like it helps if you guys wanna see it
just copy and paste industrial with you

124
00:12:10,400 --> 00:12:19,690
guys do that so there's a little example
their back alright so I put these I put

125
00:12:19,690 --> 00:12:22,580
these into my deck the screenshot of
what I was doing just so that way when

126
00:12:22,580 --> 00:12:26,030
you download this slide later you can
remember we did so did your head explode

127
00:12:26,030 --> 00:12:29,710
as mine certainly did so the first time
that I thought about this when I was

128
00:12:29,710 --> 00:12:33,780
writing this autumn like wow I can do
everything in PowerShell without you see

129
00:12:33,780 --> 00:12:43,010
will you create and then I was like this
so there is another thing I just went

130
00:12:43,010 --> 00:12:48,340
through that so there's a special so now
I want to figure out how we can so I met

131
00:12:48,340 --> 00:12:52,050
you know these great people call me a
creeper

132
00:12:52,050 --> 00:12:56,770
develops Matt Kramer is right there I
would say the guy in the plaid but

133
00:12:56,770 --> 00:13:02,760
there's like six of them right in a row
so you know he sees the good looking one

134
00:13:02,760 --> 00:13:08,440
next to Carlo's but Matt Chris created
power supply crate too honey glazed and

135
00:13:08,440 --> 00:13:15,250
use PowerShell ok so but there's also
this thing called Empire you know what

136
00:13:15,250 --> 00:13:24,620
I'm tired of it you know its security
security security even you been doing

137
00:13:24,620 --> 00:13:26,290
this the entire time

138
00:13:26,290 --> 00:13:40,420
security has got let's go you guys give
it up for you will enjoy

139
00:13:40,420 --> 00:13:45,590
actually a short burst onto per

140
00:13:45,590 --> 00:14:02,550
alright so I was going to demo some of
the cool tools that they had will

141
00:14:02,550 --> 00:14:09,160
release PowerShell empire one of the
coolest things i've seen come out of her

142
00:14:09,160 --> 00:14:18,540
shell on time and he did not send it to
me because my excuse fail okay so what I

143
00:14:18,540 --> 00:14:21,740
wanted as I wanted to actually turn the
mike over him I want him to show you

144
00:14:21,740 --> 00:14:29,459
what he's doing so he could get up to
will per second

145
00:14:29,459 --> 00:14:55,619
so powerful empire fully functional
malware pose fully functional PowerShell

146
00:14:55,619 --> 00:15:00,350
physics so me and a few other people
start to notice that there's a lot of

147
00:15:00,350 --> 00:15:05,240
these awesome offensive tools like mod
and Paris boy that have a lot of

148
00:15:05,240 --> 00:15:11,410
functionality of iraq would normally 140
loggers screenshots meat-axe you know

149
00:15:11,410 --> 00:15:15,119
took manipulation everything but there
wasn't the only weaponized kind of

150
00:15:15,119 --> 00:15:21,110
framework that let you run these and get
the output effectively and efficiently

151
00:15:21,110 --> 00:15:26,790
those secure manner 39 quotes because if
anyone watches the logs there was a

152
00:15:26,790 --> 00:15:30,230
really bad bug in the controller they
got sick so you're actually running

153
00:15:30,230 --> 00:15:35,860
empire in the field you should
definitely so yeah it's writing secure

154
00:15:35,860 --> 00:15:48,149
code apparently very hard I thought ok
so real quick like it has the persistent

155
00:15:48,149 --> 00:15:52,829
or has the concept of personal listeners
equali back and so whenever the control

156
00:15:52,829 --> 00:15:56,110
server comes down it comes back up all
your personal listeners will be starting

157
00:15:56,110 --> 00:16:00,779
back up you have these concepts of
launchers we have bees macrocycle

158
00:16:00,779 --> 00:16:05,740
one-liners and things like this kind of
a shortcut is little wonder whether the

159
00:16:05,740 --> 00:16:09,829
listener name is this big Cody command
that they are here and this on the 2012

160
00:16:09,829 --> 00:16:13,410
box what this will do is is it starts
kind of a little souped-up download

161
00:16:13,410 --> 00:16:16,869
cradle that doesn't change in the back
end and actually starts running this

162
00:16:16,869 --> 00:16:21,499
agent or completely in memory again none
of this is touching dis just kinda by

163
00:16:21,499 --> 00:16:25,570
nature so you have a fully functional
kind of running

164
00:16:25,570 --> 00:16:31,150
no default we were using powershell once
but we actually have been adapted

165
00:16:31,150 --> 00:16:35,080
version what been talked about alexis
you process injection it uses a

166
00:16:35,080 --> 00:16:39,120
reflective deal on the backend from
managed or unmanaged code is based on a

167
00:16:39,120 --> 00:16:44,550
jury will get the runs basis so we re
triggered it's all just kinda four-time

168
00:16:44,550 --> 00:16:50,750
clear ok so we have this kind of Asian
session IDs it comes back and you have

169
00:16:50,750 --> 00:16:54,520
all the functionality you'd normally
expect in Iraq interprocess listing your

170
00:16:54,520 --> 00:17:02,040
upload download all those kind of things
so I kind of see that you see so we're

171
00:17:02,040 --> 00:17:07,790
quick way too much functionality go over
in five minutes there's a large number

172
00:17:07,790 --> 00:17:13,350
of these boots exploitation modules the
kind of wrap up a lot of other things so

173
00:17:13,350 --> 00:17:18,910
if we want to do something like use
module credentials many cats login

174
00:17:18,910 --> 00:17:22,600
passwords

175
00:17:22,600 --> 00:17:26,400
you know come before metadata container
kind of similar to Metasploit post

176
00:17:26,400 --> 00:17:30,140
module execute this will actually pass
the PowerShell in the back into the

177
00:17:30,140 --> 00:17:33,490
control server to be picked up by the
agency secretive sleazy comes back again

178
00:17:33,490 --> 00:17:38,620
in a run it executes everything fully
memory post the results back so to get

179
00:17:38,620 --> 00:17:52,710
those kind of setup all started
background job there you go

180
00:17:52,710 --> 00:17:55,690
going at all hours there may be a cat
scan output coming back and it actually

181
00:17:55,690 --> 00:18:00,960
has a internal credential store so
everything we parse down those are my

182
00:18:00,960 --> 00:18:08,270
pastors yeah should be gone but I think
it's a cool project that really built on

183
00:18:08,270 --> 00:18:12,500
top of a lot of the stuff that people
will not be doing if anyone's interested

184
00:18:12,500 --> 00:18:25,480
to be more than happy to be in the
hallway after well

185
00:18:25,480 --> 00:18:34,610
so they smell very much will do a lot of
cool stuff with that stuff we've covered

186
00:18:34,610 --> 00:18:40,110
some house stuff earlier than previously
and other toxins that so Matt and his

187
00:18:40,110 --> 00:18:43,190
product isn't great but I really like to
highlight will is doing because it's

188
00:18:43,190 --> 00:18:48,190
something a little bit beyond what you
guys to see so before you go and grab

189
00:18:48,190 --> 00:18:53,910
these tools I want to be want you to be
aware something so all of these are

190
00:18:53,910 --> 00:18:58,549
being signature so a lot of the tools
that Matt his team are creating lots

191
00:18:58,549 --> 00:19:04,790
will hit you are creating there are now
signatures for the ps1 files so now

192
00:19:04,790 --> 00:19:08,200
there's a PC application bypass
techniques and whatever the case may be

193
00:19:08,200 --> 00:19:11,580
but if you think that you're going to be
as an attacker you gonna go and grab

194
00:19:11,580 --> 00:19:16,620
power supply in the cats and write it to
disk on the the the box or attacking if

195
00:19:16,620 --> 00:19:19,580
they have a V chances are it's actually
gonna get black and I know Windows

196
00:19:19,580 --> 00:19:23,340
Defender does it matter does it I
haven't seen it I don't have any other

197
00:19:23,340 --> 00:19:27,490
sweets but I know that those two both
have been plugging it in fact they just

198
00:19:27,490 --> 00:19:34,770
wrote a new signature on Monday for
another one of Matt's tools so this is

199
00:19:34,770 --> 00:19:39,669
where the next process really comes into
play which is invoke expression and so

200
00:19:39,669 --> 00:19:44,410
that the whole idea here is that with
invoke expression by the way Lee homes

201
00:19:44,410 --> 00:19:46,650
in here so we thank you so much

202
00:19:46,650 --> 00:19:53,470
expression on the down low string so
thank you thank you so much

203
00:19:53,470 --> 00:19:58,059
confession new implant dentistry and
then just click to rate to the ps1 file

204
00:19:58,059 --> 00:20:01,780
and that'll actually bypass it because
as it stands right now the eighty is not

205
00:20:01,780 --> 00:20:06,950
doing scans in memory so don't write it
to disk ok if you wanna mess around with

206
00:20:06,950 --> 00:20:10,760
it put it on disc whatever the case may
be but if you really at your attacker

207
00:20:10,760 --> 00:20:12,010
and you want this on the box

208
00:20:12,010 --> 00:20:16,320
leave it out and leave it out of disk
put it all in memory

209
00:20:16,320 --> 00:20:23,559
alright sweet I'm in that I was leaving
behind a nice light so so there is other

210
00:20:23,559 --> 00:20:27,600
things I want to point out to a little
bit on the attacking site so when does

211
00:20:27,600 --> 00:20:50,630
stan is coming out it's actually so that
one thing I want to mention is this

212
00:20:50,630 --> 00:21:20,290
picture ahead this year

213
00:21:20,290 --> 00:21:53,490
and download I was a little nervous
about that right so Microsoft has

214
00:21:53,490 --> 00:21:57,690
actually come a long way given you know
we get Microsoft crap all the time but

215
00:21:57,690 --> 00:22:03,460
they've actually come a long way and
they have worked really hard with the

216
00:22:03,460 --> 00:22:08,420
security meeting at against and I have
to give them credit for that so you know

217
00:22:08,420 --> 00:22:13,260
a lot of people didn't know you can't
see you as will demonstrate earliest

218
00:22:13,260 --> 00:22:19,530
memories in plain text with Windows 10
went a step further they tried to block

219
00:22:19,530 --> 00:22:24,020
that may work directly with you know
this Jewish community trying to get this

220
00:22:24,020 --> 00:22:28,750
resolved trying to help things get
better and safer and leavin reached out

221
00:22:28,750 --> 00:22:32,190
to man and his team and and try and talk
about different ways that they can make

222
00:22:32,190 --> 00:22:36,940
things better so I gotta give props to
actively trying to make things better so

223
00:22:36,940 --> 00:22:41,910
if you look at 10 stand you if you run
it natively without a change that were

224
00:22:41,910 --> 00:22:47,780
the case I V CAST actually doesn't work
tops so any given huge props to

225
00:22:47,780 --> 00:22:52,060
understand i mean i just i mean I gotta
give him credit for that but there is

226
00:22:52,060 --> 00:22:55,870
actually a bypass business and it's the
same one that worked in Windows 8 which

227
00:22:55,870 --> 00:23:01,330
is it you just change the registry key
16 but they're at least trying

228
00:23:01,330 --> 00:23:07,080
they're doing the best you know so
granted that that that that case out of

229
00:23:07,080 --> 00:23:12,300
the box without changing anything this
one stops so it's cool there working

230
00:23:12,300 --> 00:23:15,650
hard on that so so we've got to give
them credit for some of the stuff that

231
00:23:15,650 --> 00:23:18,970
they do and some of the stuff that
they're working on the defensive side

232
00:23:18,970 --> 00:23:23,140
awesome as an attacker that sucks
because it just makes it that much more

233
00:23:23,140 --> 00:23:26,470
harder when you just have to put it in a
registry key is that

234
00:23:26,470 --> 00:23:32,970
so so they are working hard and trying
to get that so let's talk a little about

235
00:23:32,970 --> 00:23:40,799
some of the defensive we talked and I'm
running questions answers to hear

236
00:23:40,799 --> 00:23:47,100
someone like alright so there are some
defensive tool so hot sex is something

237
00:23:47,100 --> 00:23:49,110
you gotta feeling with something I've
talked about it for a while

238
00:23:49,110 --> 00:23:55,200
Konza from deep hole a great utility a
great set of tools trying to help people

239
00:23:55,200 --> 00:23:58,520
out and get better handle on a lot of
the stuff that they're doing on their

240
00:23:58,520 --> 00:24:03,730
systems and empower forensics by Terry
Atkinson I wanted to actually show

241
00:24:03,730 --> 00:24:07,309
something that's cool but in the speaker
in just minutes ago it kept on failing

242
00:24:07,309 --> 00:24:11,870
so that's because Lee was helping him
out new homes for Microsoft was helping

243
00:24:11,870 --> 00:24:24,419
him out brokers gonna kill me so so
thanks again Lee so so we're gonna look

244
00:24:24,419 --> 00:24:29,559
at project that Madden Matt Johnson
myself working so a lot of you guys know

245
00:24:29,559 --> 00:24:33,830
I'm actually a blue team so I actually
do pen testing that I'll blame I like

246
00:24:33,830 --> 00:24:37,470
being on that side of the team and I
like doing other things with them but

247
00:24:37,470 --> 00:24:42,450
her heart I love keeping people safe I
like I like I like making sure that

248
00:24:42,450 --> 00:24:46,590
things are and you know what I'll be
honest with you I hadn't doing testing

249
00:24:46,590 --> 00:24:52,549
for that on but I found ten testing be
so much easier it is so much easier you

250
00:24:52,549 --> 00:24:56,820
know I got into an alarm control system
and the password 1234 I mean it wasn't

251
00:24:56,820 --> 00:24:59,570
hard I didn't have to do anything you
know I called the guy like are you

252
00:24:59,570 --> 00:25:07,470
standing next to your server injuries
IKEA has a lot but I like as an ally

253
00:25:07,470 --> 00:25:16,860
right so it like so far I have I'm sure
the challenges exist but so far and the

254
00:25:16,860 --> 00:25:17,570
challenge

255
00:25:17,570 --> 00:25:23,580
well as defense it was so hard at work
and you know if I fail in red team it's

256
00:25:23,580 --> 00:25:27,600
just that you know you're there you're
really secure I suck as a pen tester but

257
00:25:27,600 --> 00:25:31,059
no one no big deal if I fail as a blue
team I could lose my job or the company

258
00:25:31,059 --> 00:25:35,000
could be a distance so it's a lot harder
so matchup tonight we're very passionate

259
00:25:35,000 --> 00:25:38,730
about that we like seeing a ways that we
can actually use PowerShell and do other

260
00:25:38,730 --> 00:25:42,809
things to do all that and some of you
guys know we talked about how passionate

261
00:25:42,809 --> 00:25:46,580
was created and so we believe that
passionate belief project can score and

262
00:25:46,580 --> 00:25:51,320
we believe that can be better with
community involvement so this is a

263
00:25:51,320 --> 00:25:57,039
screenshot from Jarret Stoll and it
actually works really touched it just

264
00:25:57,039 --> 00:26:08,110
right so I want to show you a couple
things as hell yeah I run everything is

265
00:26:08,110 --> 00:26:35,240
an engineer ok so I'm gonna do this and
ok watch this

266
00:26:35,240 --> 00:26:51,850
now I just blow your mind ok

267
00:26:51,850 --> 00:27:19,000
computer bro

268
00:27:19,000 --> 00:27:41,440
yeah I got it right it's just get I
don't know if I don't get i dont have

269
00:27:41,440 --> 00:27:44,300
basically what we can do as you can see
all of the things that are going on with

270
00:27:44,300 --> 00:27:51,160
that in a minute run directories you can
see all the stuff that I have started up

271
00:27:51,160 --> 00:27:57,100
in the run menu the registry right so
one of the things that I talk to a lot

272
00:27:57,100 --> 00:28:01,990
of people about is being able to monitor
the status right so you know especially

273
00:28:01,990 --> 00:28:05,170
on your critical assets and just
checking for any type of person stuff

274
00:28:05,170 --> 00:28:08,270
you know there's multiple there's many
different places that you can hide

275
00:28:08,270 --> 00:28:12,290
something so that will actually start
back up but one of the lowest hanging

276
00:28:12,290 --> 00:28:15,490
fruit places that you can possibly do
this is in the registry right it's

277
00:28:15,490 --> 00:28:18,750
simple it's easy to put it there and
everything else it boots up because

278
00:28:18,750 --> 00:28:22,480
they're so one of the things I want to
do is monitor this I wanted to do this

279
00:28:22,480 --> 00:28:25,290
for two reasons why I wanted to make
sure that if there was ever an attack on

280
00:28:25,290 --> 00:28:29,910
my system he did tried persistence here
I do with identifying Claggett do I want

281
00:28:29,910 --> 00:28:32,620
to also check to make sure that if any
software put something here that I

282
00:28:32,620 --> 00:28:36,640
wasn't aware of like you know Citrix or
whatever the case I would know about

283
00:28:36,640 --> 00:28:40,429
that neither am I so if I

284
00:28:40,429 --> 00:29:05,869
if I do this and name is so now I do you
get you can see my not a virus in their

285
00:29:05,869 --> 00:29:11,619
right so let's just go and look the
registry which I have opened so there's

286
00:29:11,619 --> 00:29:16,919
no not a virus at five there's not a
vice ok super simple whatever the case

287
00:29:16,919 --> 00:29:21,759
but I'm gonna delete this right now and
I show you just told I have said this is

288
00:29:21,759 --> 00:29:28,039
Mark and like I showed you earlier this
was me looking into this is completely

289
00:29:28,039 --> 00:29:29,720
open source and I'm I get up

290
00:29:29,720 --> 00:29:33,539
hundred-page Dec 2012 figure out how to
do this you can you have like I think

291
00:29:33,539 --> 00:29:39,820
it's like 2009 the Pope 32 just OK but I
wrote this to actually make PowerShell

292
00:29:39,820 --> 00:29:43,499
easier for people to use of you have a
team they don't really want to know how

293
00:29:43,499 --> 00:29:46,700
should they know how to double click
something then they can actually do it

294
00:29:46,700 --> 00:29:52,450
if they don't I double click something
that should not be under team alright so

295
00:29:52,450 --> 00:29:55,460
I have this thing called monitor startup
programs so when you double-click can

296
00:29:55,460 --> 00:29:59,740
actually say okay so maybe it's like wow
what you want me to monitor so I've got

297
00:29:59,740 --> 00:30:05,090
file ok and run and what it does is it
goes out to the registry looks for any

298
00:30:05,090 --> 00:30:10,590
changes and then if there's a change
will actually show and other one of the

299
00:30:10,590 --> 00:30:15,669
cool things I did about this tool is I
set it up to you can actually get to

300
00:30:15,669 --> 00:30:25,389
keep going over here and you can kind of
see it coming into work so if I go ahead

301
00:30:25,389 --> 00:30:35,169
and go back to my power show where I do
this again

302
00:30:35,169 --> 00:30:40,200
ok so I now have my not a virus when I'm
gonna come over here and I've got the

303
00:30:40,200 --> 00:30:44,159
setup is a scheduled task so I can run
you know however our frequently I want

304
00:30:44,159 --> 00:30:55,260
to let it go ahead go now

305
00:30:55,260 --> 00:31:07,560
and it's it's it's super simple super
easy and you want to do this on your

306
00:31:07,560 --> 00:31:10,790
critical assets do you know a lot of the
persistence of you can do this without

307
00:31:10,790 --> 00:31:13,810
monitoring you can do this with
configuration changes a lot of people

308
00:31:13,810 --> 00:31:17,530
using these bold images now right so I
have you heard about the ukraine this

309
00:31:17,530 --> 00:31:20,460
golden agent signing up the Vienna and
trying to get everything at work all

310
00:31:20,460 --> 00:31:24,870
that but how do you know that the gold
image of a change or when you're

311
00:31:24,870 --> 00:31:29,590
monitoring system you know you got a web
application and all the sudden someone

312
00:31:29,590 --> 00:31:32,920
upload the file will and she monitoring
those files to make sure that they're

313
00:31:32,920 --> 00:31:34,370
actually supposed to be there

314
00:31:34,370 --> 00:31:39,350
well there's a lot of you know there's
also PowerShell which is super easy to

315
00:31:39,350 --> 00:31:43,430
use super super straight to get up and
running so you know that's part of the

316
00:31:43,430 --> 00:31:47,530
reason we created this my last word we
didn't have a never-ending budget you

317
00:31:47,530 --> 00:31:51,840
know so I wrote something that makes my
life easier integrate with system which

318
00:31:51,840 --> 00:31:56,430
were already using should be and that
way whenever the registry change

319
00:31:56,430 --> 00:32:05,840
whenever the files were done I was able
to see what was going on at that so I'll

320
00:32:05,840 --> 00:32:15,120
talk to you a little bit up tests so a
bit ago Lee home sorry lee and love you

321
00:32:15,120 --> 00:32:20,720
bunny Lee Road escaped the thing called
PowerShell of simply team and we love

322
00:32:20,720 --> 00:32:27,270
them too sometimes so they worked really
hard on trying to set up these events

323
00:32:27,270 --> 00:32:31,170
and event logging and everything like
that and it was really cool technique

324
00:32:31,170 --> 00:32:35,000
and what was cool about least he
actually reached out to the security

325
00:32:35,000 --> 00:32:40,850
team before he wrote this and I was at
Microsoft tonight and Matt Johnson over

326
00:32:40,850 --> 00:32:44,380
there and we're running around and all
the sudden you know I'm talking with

327
00:32:44,380 --> 00:32:46,669
some of their subject matter experts and

328
00:32:46,669 --> 00:32:51,269
showing them how to actually break stuff
and whatever the case may be I even got

329
00:32:51,269 --> 00:32:55,100
to show Jeffrey Snover the creator of
PowerShell a bug in his coat it was so

330
00:32:55,100 --> 00:33:00,059
cool I would like to leave families like
a little child like I normally am and I

331
00:33:00,059 --> 00:33:04,529
was so called the show that by 10 but I
actually got a call like to talk with

332
00:33:04,529 --> 00:33:11,720
Leon Lai XE on the phone is really cool
I like matt gets well so we're we're

333
00:33:11,720 --> 00:33:14,609
sitting there doing this and he reached
out and he's like a see what you can do

334
00:33:14,609 --> 00:33:18,679
it and so I went back to the hotel room
that night I had a partial I passed by

335
00:33:18,679 --> 00:33:29,519
the next day and so little about that so
any event logs year ago

336
00:33:29,519 --> 00:33:33,730
alright so under these laws you have
this PowerShell operational ok so the

337
00:33:33,730 --> 00:33:38,749
whole idea here is you can see any type
of things that might be going on with a

338
00:33:38,749 --> 00:33:44,049
41 or so I had this filter just before
10 so make sure you guys write that down

339
00:33:44,049 --> 00:33:49,230
it's an interesting event lot so this is
going to be basically what is trying to

340
00:33:49,230 --> 00:33:53,730
do is capture anything that looks out of
the ordinary right so one of the things

341
00:33:53,730 --> 00:34:01,619
that matter he's doing with power supply
is he looks into the reflection file so

342
00:34:01,619 --> 00:34:08,869
that so this is this is one of those
things where if you want to look into

343
00:34:08,869 --> 00:34:12,190
you know Internet services Marshall

344
00:34:12,190 --> 00:34:15,260
you're basically pulling out the secure
string into plain text

345
00:34:15,260 --> 00:34:20,619
that's that's what this code is doing so
that would actually take this code and

346
00:34:20,619 --> 00:34:30,980
run it

347
00:34:30,980 --> 00:34:40,560
what you're gonna see it in you are
going to see it show you the actual code

348
00:34:40,560 --> 00:34:42,220
of what's being used

349
00:34:42,220 --> 00:34:49,149
ok so that was cool and awesome but I
found out that if you don't use that

350
00:34:49,149 --> 00:34:53,010
actually interrupts services and then
just put the two together with an owl it

351
00:34:53,010 --> 00:34:59,080
doesn't blanket so you can basically
type interrupt service s Marshall join

352
00:34:59,080 --> 00:35:04,380
them together and then cast that to the
type so then basically I go like that's

353
00:35:04,380 --> 00:35:27,000
now an event like

354
00:35:27,000 --> 00:35:34,380
lead did tell me that this was fixed in
the latest ok so so those are the types

355
00:35:34,380 --> 00:35:37,490
of things so they're trying really hard
but again there's always been something

356
00:35:37,490 --> 00:35:40,120
around that and but I gotta give him
huge credit for the amount of effort

357
00:35:40,120 --> 00:35:44,610
that they're trying to put into their ok
so what a couple of things I want to

358
00:35:44,610 --> 00:35:49,070
talk about is you know different
resources that are available

359
00:35:49,070 --> 00:35:53,970
some things that are going on we have
power supply we have helped our view we

360
00:35:53,970 --> 00:35:59,910
have plastic Mod Podge SEC conta invoke
I R but there is one less thing I just

361
00:35:59,910 --> 00:36:05,920
demonstrate so you know there's a lot of
times that you know people talk about

362
00:36:05,920 --> 00:36:27,630
you know dem appealed the case may be so
I'm going to go thanks arba model no I'm

363
00:36:27,630 --> 00:36:46,200
alright so this is this is one of those
things where it's you can basically set

364
00:36:46,200 --> 00:36:50,310
something for those who don't know
anything that's going to process it

365
00:36:50,310 --> 00:36:55,350
stops windows just shuts down it stops
it's cold it's hard it's unforgiving so

366
00:36:55,350 --> 00:37:01,010
this is a great way to to to mess around
with someone and to you you know

367
00:37:01,010 --> 00:37:06,590
basically he go whatever start but
there's also another one that I wrote

368
00:37:06,590 --> 00:37:12,620
here in its called it's called the
cracking and basically it's called

369
00:37:12,620 --> 00:37:16,110
unlock the cracking and so what this
does is intellectually enumerate all of

370
00:37:16,110 --> 00:37:20,530
you are networking devices and when you
run it intellectually disabled them it

371
00:37:20,530 --> 00:37:24,920
won't like it won't just remove the IP
telephony disable them so you can even

372
00:37:24,920 --> 00:37:28,310
remotely and then you have to physically
walk around and you can point the set

373
00:37:28,310 --> 00:37:31,350
every system on your networking and
happily did it for you

374
00:37:31,350 --> 00:37:38,370
so if you have ever wanted to rage quit

375
00:37:38,370 --> 00:37:43,430
so you just don't say anything about me

376
00:37:43,430 --> 00:37:52,550
alright so before I do anything actually
BSOD my inbox any questions so far I've

377
00:37:52,550 --> 00:38:01,910
got drink tickets yet so I don't have
the answer that question and that may be

378
00:38:01,910 --> 00:38:06,180
a good question probably at the end
there but I know for a fact that the

379
00:38:06,180 --> 00:38:11,440
automation all the libraries which is
like that P or I'll spy on that knee

380
00:38:11,440 --> 00:38:17,620
deep in the automation that DLL it shows
that there's a lot in there and it looks

381
00:38:17,620 --> 00:38:22,340
into a lot of functions jeffrey's over
told me that when power was first

382
00:38:22,340 --> 00:38:26,330
created they didn't actually create a
lot of the modules until they got by and

383
00:38:26,330 --> 00:38:31,550
from the executives they said every team
from forensics to anti friends XP

384
00:38:31,550 --> 00:38:36,200
Security to it you have to write five
models for our show and it just grew

385
00:38:36,200 --> 00:38:40,610
exponentially so I don't have the full
answer your question but I'm sure that

386
00:38:40,610 --> 00:38:50,850
that's a lot more in there yet there's
no there's nothing really that that's

387
00:38:50,850 --> 00:38:55,060
automation that DLL is using but I'll
tell you that going forward there's a

388
00:38:55,060 --> 00:38:58,820
lot of PowerShell that's doing a lot of
your manager now so special to get an

389
00:38:58,820 --> 00:39:03,380
answer for you can't manage Nana service
without power show so be careful that

390
00:39:03,380 --> 00:39:06,190
thats if you're looking for a
competition control that may not be the

391
00:39:06,190 --> 00:39:09,810
best one you may want to be work on the
detection of hours then trying to remove

392
00:39:09,810 --> 00:39:20,530
the blue shirt

393
00:39:20,530 --> 00:39:38,240
yes

394
00:39:38,240 --> 00:39:42,869
with the basically there D encoding the
messages from our shelter house I can

395
00:39:42,869 --> 00:39:45,980
work on the defensive side of you know
because the $41 a big that was my first

396
00:39:45,980 --> 00:39:50,130
complaint to leave is that the
signal-to-noise ratio is too high and

397
00:39:50,130 --> 00:39:53,190
shit the noise to signal reaches too
high it's too much force anyone to

398
00:39:53,190 --> 00:39:55,220
consume it's a good place to start

399
00:39:55,220 --> 00:40:00,440
I will tell you thatthe Microsoft
analytics team they are on the money if

400
00:40:00,440 --> 00:40:03,070
you've not looked at the dance right
analytics you need to look at that

401
00:40:03,070 --> 00:40:06,440
because they're specifically looking at
that base lining and they're looking at

402
00:40:06,440 --> 00:40:09,820
creating that use case so that when you
don't have to look at the developers

403
00:40:09,820 --> 00:40:14,410
machine whose pop in PowerShell like you
know aspirin you know but if all the

404
00:40:14,410 --> 00:40:19,780
sudden a 20 in a jar or you know bob in
accounting their pop in PowerShell then

405
00:40:19,780 --> 00:40:44,840
that's when the threat analyst Matt yes
yes you can have ever run into issues

406
00:40:44,840 --> 00:40:49,510
execution policy so yeah definitely

407
00:40:49,510 --> 00:40:53,570
yeah for sure the code execution policy
doesn't know is basically you can send

408
00:40:53,570 --> 00:40:59,030
it to unsigned or signed all which
should never do or find only but yeah

409
00:40:59,030 --> 00:41:03,240
there's definitely there but I have
found that even with its set there there

410
00:41:03,240 --> 00:41:07,130
are some commands it a go through
without any problem whatsoever so and

411
00:41:07,130 --> 00:41:12,510
you know that's that's that's the rub
right is that you know defense you guys

412
00:41:12,510 --> 00:41:15,700
gotta stop thinking about defense is
stopping the attacker from getting in i

413
00:41:15,700 --> 00:41:18,820
mean that's definitely part of it but
that's not the goal the goal is to

414
00:41:18,820 --> 00:41:24,030
detect when they're in ok that's the
that's the key gotta be able to look and

415
00:41:24,030 --> 00:41:29,650
see what's there

416
00:41:29,650 --> 00:41:32,730
so you can actually and that's a cool
thing about this is that you can

417
00:41:32,730 --> 00:41:42,869
actually do so you can actually look
into your own stuff and radio messages

418
00:41:42,869 --> 00:42:02,970
right so yeah absolutely for those that
for those teams that actually don't need

419
00:42:02,970 --> 00:42:05,970
to use a lot of PowerShell I would I
would definitely like it down and make

420
00:42:05,970 --> 00:42:08,400
sure that it can't run from other people
I mean that's definitely a low-hanging

421
00:42:08,400 --> 00:42:12,589
fruit thing that you can take care of
but it's not an end-all solution so if

422
00:42:12,589 --> 00:42:17,000
in fact once again your system that's
that's going to be but if you have it

423
00:42:17,000 --> 00:42:20,200
locked down but you do have power so
that you see as an attacker as you saw

424
00:42:20,200 --> 00:42:25,119
even with will tell he didn't look into
some rare process you don't see you know

425
00:42:25,119 --> 00:42:30,700
if you have a learning from will in a
county that pulls up our said that you

426
00:42:30,700 --> 00:42:34,299
do something different but your are you
gonna know about it if you're actually

427
00:42:34,299 --> 00:42:37,440
maintaining and watching your lodge
which we all do right

428
00:42:37,440 --> 00:42:50,990
yeah yeah yeah yeah so he is actually
the one doing all odds are any questions

429
00:42:50,990 --> 00:42:59,140
do as you're using the existing deal
I'll on the disc to you inject into

430
00:42:59,140 --> 00:43:00,190
memory

431
00:43:00,190 --> 00:43:21,090
yeah yes you can do that for sure yeah
yeah yeah he was using the fixed version

432
00:43:21,090 --> 00:43:25,080
yet

433
00:43:25,080 --> 00:43:34,390
yeah and that's why I gave huge props to
him he reached out to us so that way we

434
00:43:34,390 --> 00:43:38,010
can break it before he published it so I
mean give me a hand I mean seriously

435
00:43:38,010 --> 00:43:47,560
coming that's really cool right they're
not just going to say hey this is the

436
00:43:47,560 --> 00:43:51,860
this is the silver bullet know they're
like dude you might be able to rate this

437
00:43:51,860 --> 00:43:55,609
but if you do tell us and we did and
that was so corny Mike this is back in

438
00:43:55,609 --> 00:43:59,350
April or May and that's when it was able
to do it you know so that's really cool

439
00:43:59,350 --> 00:44:03,359
but yeah he was you if you do script
block block logging as he destroyed just

440
00:44:03,359 --> 00:44:07,990
got yesterday my bypass actually feels
so but most guys don't have this yet so

441
00:44:07,990 --> 00:44:11,359
this bypass still

442
00:44:11,359 --> 00:44:25,540
policies will from that because you're
looking into the PowerShell that

443
00:44:25,540 --> 00:44:36,300
PowerShell thing and that that's where
all that style is absolutely 2010 4:21

444
00:44:36,300 --> 00:44:41,650
yet what you guys are running unless
you're still under 2000 which I know

445
00:44:41,650 --> 00:44:43,640
some of you

446
00:44:43,640 --> 00:44:57,660
yes yes you see that many

