1
00:00:49,290 --> 00:02:01,480
I worked for dan dan the Man

2
00:02:01,480 --> 00:02:15,560
let's get started in this room is still
see their and they're they're good

3
00:02:15,560 --> 00:02:25,190
afternoon to become like that I'm sure
on that cap and this is Red vs Blue

4
00:02:25,190 --> 00:02:31,910
modern ex-director attacks and defense
the CEO Dan solutions yes I work for

5
00:02:31,910 --> 00:02:36,170
damn company that provides Microsoft
platform engineering IT security

6
00:02:36,170 --> 00:02:40,340
solutions one about a hundred Microsoft
Certified Master snack director in the

7
00:02:40,340 --> 00:02:45,150
world and I work with large enterprises
the show them how to best secure their

8
00:02:45,150 --> 00:02:49,660
environment specifically Active
Directory do a lot of eighty security

9
00:02:49,660 --> 00:02:56,810
research results of which I put in the
slides and opposed to 80 security on the

10
00:02:56,810 --> 00:02:59,260
agenda is straightforward

11
00:02:59,260 --> 00:03:03,880
attack techniques for the red team and
mitigation and detection methods for the

12
00:03:03,880 --> 00:03:11,310
booty so let's start with the red team
which may be about 20 years ago right

13
00:03:11,310 --> 00:03:20,730
let's update this for the modern red
chain better so this post

14
00:03:20,730 --> 00:03:26,450
exploitation talk we need to assume
breach in our modern networks which

15
00:03:26,450 --> 00:03:30,420
means the attacker has dropped some code
running on your computer a computer

16
00:03:30,420 --> 00:03:32,300
running on your network

17
00:03:32,300 --> 00:03:36,370
this is the reality today since the post
exploitation talk goes without saying

18
00:03:36,370 --> 00:03:41,310
that talks about the malware and how
they get on and what they do this is

19
00:03:41,310 --> 00:03:48,610
what happens once that happens when
you're not know about

20
00:03:48,610 --> 00:03:53,240
so power split has been around for a
couple years

21
00:03:53,240 --> 00:03:58,500
lot of really interesting tools in that
toolkit ability to dump credentials

22
00:03:58,500 --> 00:04:06,760
using invoke many cats which effectively
duplicate so the executable many cast a

23
00:04:06,760 --> 00:04:12,620
couple of the more popular ones here but
empire was released this past summer and

24
00:04:12,620 --> 00:04:17,709
wraps a lot of these tools and functions
available across other scripts and

25
00:04:17,709 --> 00:04:24,200
toolkits into pure Powershot agent that
injects into a process doesn't use

26
00:04:24,200 --> 00:04:29,669
PowerShell 98 see if you try to track
powerful taxis in PowerShell that you're

27
00:04:29,669 --> 00:04:35,090
not going to see it so packing with
PowerShell what does it look like does

28
00:04:35,090 --> 00:04:43,500
it look like that yet maybe Empire
disappointed it looks like this we're

29
00:04:43,500 --> 00:04:48,310
getting there so powerful empire wraps a
lot of the deployment methods attackers

30
00:04:48,310 --> 00:04:49,520
using today

31
00:04:49,520 --> 00:04:52,610
macro zhdat LLC etc

32
00:04:52,610 --> 00:05:02,030
including injecting the agent directly
into prophecies else s

33
00:05:02,030 --> 00:05:06,740
can leverage the power tools invoke es
injector to inject the agent into these

34
00:05:06,740 --> 00:05:11,680
processes in this let the attackers are
doing with the red team's doing such as

35
00:05:11,680 --> 00:05:15,190
the blue team you want to understand
what these tools are doing our best

36
00:05:15,190 --> 00:05:20,550
attack because empires and use it on a
different modules for recon to

37
00:05:20,550 --> 00:05:31,729
credential reviews and persistence and
privilege escalation that's so let's

38
00:05:31,729 --> 00:05:35,030
talk about recon

39
00:05:35,030 --> 00:05:48,550
feel like I'm not sorry doctor says the
attackers want to know about domain

40
00:05:48,550 --> 00:05:51,750
controllers that are in the domain in
the environment is a lot of different

41
00:05:51,750 --> 00:05:56,680
ways to do this but realistically in the
modern environment the easiest way to

42
00:05:56,680 --> 00:06:00,610
discover all the domain controllers in
the entire acts rectory forces last

43
00:06:00,610 --> 00:06:05,940
dotnet commanded you can run PowerShell
most of the domain controllers running

44
00:06:05,940 --> 00:06:11,320
in a modern network are global catalogs
as per best practices for Microsoft so

45
00:06:11,320 --> 00:06:15,450
once we do that when a reactor were
trying to find her public accounts this

46
00:06:15,450 --> 00:06:20,760
typically involves her cursing group
membership usually focus and targeting

47
00:06:20,760 --> 00:06:26,380
the main out but if you recursively
enumerate administrators that includes

48
00:06:26,380 --> 00:06:30,130
domain admins and give you a bunch of
other things or if you as a red team

49
00:06:30,130 --> 00:06:34,960
were target the RDC denied replication
groups includes those as well as any

50
00:06:34,960 --> 00:06:40,710
custom delegate groups and so when you
wanted to identify who the partner

51
00:06:40,710 --> 00:06:46,940
organizations are for this organization
you're operating with or for or against

52
00:06:46,940 --> 00:06:52,180
you want to discover who they work with
who they operate course one of the best

53
00:06:52,180 --> 00:06:58,850
ways to do this for years been hammering
trust but you can also enumerated asked

54
00:06:58,850 --> 00:07:03,340
the domain controller for all of the
contact objects in the Forex contact

55
00:07:03,340 --> 00:07:07,660
object is a special type of object that
is effectively an email address for an

56
00:07:07,660 --> 00:07:13,390
external organisation that's not part of
that record for its so I want to learn

57
00:07:13,390 --> 00:07:18,210
about who this company does business
with and who these user gmail on a

58
00:07:18,210 --> 00:07:22,270
regular basis if you read all the
contact objects and dump those email

59
00:07:22,270 --> 00:07:26,470
addresses and then look at those demands
I know exactly who they do you this is

60
00:07:26,470 --> 00:07:30,340
how it stacks up in identifying his
partner organisations compromising them

61
00:07:30,340 --> 00:07:34,480
to come in the back door and then the
best way to

62
00:07:34,480 --> 00:07:38,360
Discoverer Enterprise Services an
environment that's what I call spin skin

63
00:07:38,360 --> 00:07:45,080
this is enterprise service discovery
without network port scan is no need for

64
00:07:45,080 --> 00:07:49,250
us to target a subnet and scan through a
whole bunch of different brand for its

65
00:07:49,250 --> 00:07:54,080
we can ask the domain controller where
the secret service reports are they

66
00:07:54,080 --> 00:08:01,590
running and that the spin is a service
principal name is required for Kerberos

67
00:08:01,590 --> 00:08:07,160
authentication to work for that purpose
enable service without that service

68
00:08:07,160 --> 00:08:13,090
principal name Curtis doesn't work so if
we ask for that information the domain

69
00:08:13,090 --> 00:08:16,120
controllers gonna give it to us why
because when a user accesses that

70
00:08:16,120 --> 00:08:21,170
service they need to get a a service
ticket for that service nor to get that

71
00:08:21,170 --> 00:08:25,190
service ticket the domain controller
needs associated service account with

72
00:08:25,190 --> 00:08:29,940
that curb reasonable service which is
the service principal maybe we can

73
00:08:29,940 --> 00:08:35,010
discover the sequel servers we can find
all the systems configured for RDP the

74
00:08:35,010 --> 00:08:41,030
ones configured for when R M S remoting
estimating rise on when I am but then it

75
00:08:41,030 --> 00:08:44,260
gets really interesting because we can
discover an organization is using cell

76
00:08:44,260 --> 00:08:49,550
but still finished if italy deployed in
very large enterprises in order to

77
00:08:49,550 --> 00:08:53,810
manage privileged accounts and groups
trying to find them I highly recommend

78
00:08:53,810 --> 00:09:00,670
you do if your read jeanne was also
exchanged a CCM and stop so we can spend

79
00:09:00,670 --> 00:09:05,050
scan for services I wrote a script by
get however there's a lot of tools do

80
00:09:05,050 --> 00:09:10,820
this by asking for all of the spins of a
certain type class we can get from need

81
00:09:10,820 --> 00:09:14,960
to make more information about this
service including the demand the server

82
00:09:14,960 --> 00:09:22,040
name or number the service account
associated with so that means we can

83
00:09:22,040 --> 00:09:26,790
spend scan for service counts so we can
ask to make the trailer what are all the

84
00:09:26,790 --> 00:09:31,730
service counter all the user accounts in
the domain that have service principal

85
00:09:31,730 --> 00:09:36,570
name associated with this will give us
information about which service counter

86
00:09:36,570 --> 00:09:40,030
associated services that's

87
00:09:40,030 --> 00:09:44,940
but what we gonna do with that last year
in this stage imogene released rigorous

88
00:09:44,940 --> 00:09:50,050
pretty incredible because what it does
is it does offline cracking of service

89
00:09:50,050 --> 00:09:58,390
brute forcing the nice thing about this
for a red chamber is it does not require

90
00:09:58,390 --> 00:10:05,590
any admin rights and you don't need to
communicate with you target see since

91
00:10:05,590 --> 00:10:08,560
camp for service accounts that are
running for a sequel or what have you

92
00:10:08,560 --> 00:10:15,100
actually user accounts in the identified
and then you run PowerShell he say I

93
00:10:15,100 --> 00:10:20,270
would like service tickets were these
specific fence yet that you can check to

94
00:10:20,270 --> 00:10:25,750
see if that service it is now in memory
as a user you have access to your own

95
00:10:25,750 --> 00:10:30,330
memory space your own tickets so we can
see Cayless the bottom there that yes

96
00:10:30,330 --> 00:10:36,920
this user has access to that that
service ticket so they'll be used many

97
00:10:36,920 --> 00:10:44,460
cats to say this to a file as a user and
then say this off to our colleague box

98
00:10:44,460 --> 00:10:50,600
and as your AWS and then we run the
Kerberos python script against now we

99
00:10:50,600 --> 00:10:55,420
have a pretty sizable would last or some
other method to French news passwords

100
00:10:55,420 --> 00:11:01,640
effectively her US uses Curtis against
itself because that service ticket is

101
00:11:01,640 --> 00:11:07,930
encrypted with the password data for the
service account so see that's been so

102
00:11:07,930 --> 00:11:12,850
gross runs through and brute force is it
attempting to open a service ticket if

103
00:11:12,850 --> 00:11:19,250
it can open it then knows it found the
right password protecting this can be

104
00:11:19,250 --> 00:11:24,680
done using an IDS signature because in
order for it to work it has to use the

105
00:11:24,680 --> 00:11:32,840
encryption type r/c for HMAC because
that's so we can create 90 s signature

106
00:11:32,840 --> 00:11:38,180
to look for that but the best mitigation
for this is make sure you search account

107
00:11:38,180 --> 00:11:43,330
passwords are greater than 25 characters
because you do not want to have your

108
00:11:43,330 --> 00:11:50,620
service account be the one that leads to
an entire to me

109
00:11:50,620 --> 00:11:56,090
probably guess what the service counts
are for most of the organizations how

110
00:11:56,090 --> 00:12:02,380
because the service account password
length is directly proportional to

111
00:12:02,380 --> 00:12:07,770
whatever the minimum pass worries that
demand right it's 10 characters out

112
00:12:07,770 --> 00:12:14,130
probably is 10 characters that make
sense we can also leverage the new

113
00:12:14,130 --> 00:12:19,930
features in Windows so managers Council
2008 group managers Council 2012 Active

114
00:12:19,930 --> 00:12:24,430
Directory wanna just passed already we
don't have to worry about them make it a

115
00:12:24,430 --> 00:12:29,370
hundred and twenty characters ran
detection is difficult if you're looking

116
00:12:29,370 --> 00:12:42,810
at a fence but like I said you can then
we get into Group Policy mierda grown

117
00:12:42,810 --> 00:12:50,270
releases it was a great idea great
opportunity for administrators because

118
00:12:50,270 --> 00:12:53,720
they could do a lot of things were
policy they couldn't do before

119
00:12:53,720 --> 00:12:57,940
prior to this admins typically would
have to buy products maker policy really

120
00:12:57,940 --> 00:13:00,430
work for them to the Group Policy
Preferences there were a number of

121
00:13:00,430 --> 00:13:04,270
things that he brought to the table
which are useful primary among this

122
00:13:04,270 --> 00:13:08,630
change the local admin account password
or a large number of workstations now an

123
00:13:08,630 --> 00:13:12,600
admin just needs to create a new her
policy apply to a no you with hundreds

124
00:13:12,600 --> 00:13:15,990
of thousands of workstations it applies
and change that password

125
00:13:15,990 --> 00:13:23,470
well maybe the admin comes back around
and said don't say their job well that

126
00:13:23,470 --> 00:13:28,530
data for that group policy preference is
stored in XML file system authenticate

127
00:13:28,530 --> 00:13:34,590
users in Active Directory have access
system and the passwords Bay 6464 and

128
00:13:34,590 --> 00:13:37,650
AES 256 bit encrypted which should be
enough

129
00:13:37,650 --> 00:13:45,880
Microsoft published the ASP product key
on him this was realized in early 2012

130
00:13:45,880 --> 00:13:50,910
and then Chris Campbell gender
PowerShell tool to then identify and

131
00:13:50,910 --> 00:13:51,670
exploit it

132
00:13:51,670 --> 00:13:53,459
part of our sport

133
00:13:53,459 --> 00:13:58,869
so attacker has to do is a demain user
again that post exploit scenario soon

134
00:13:58,869 --> 00:14:04,019
breach attacker has code running on a
system as it to mean user they can scan

135
00:14:04,019 --> 00:14:08,509
sis fall look for these three years
there's a few other XML files look for C

136
00:14:08,509 --> 00:14:14,079
password at that data that random string
a day after Nazi password is encrypted

137
00:14:14,079 --> 00:14:21,129
password so all we have to use the
powers AST crypt function and we have

138
00:14:21,129 --> 00:14:29,420
some indication of this is install this
patch on every computer that might open

139
00:14:29,420 --> 00:14:35,639
up new policy because that prevents the
admins from actually putting passwords

140
00:14:35,639 --> 00:14:36,429
into

141
00:14:36,429 --> 00:14:41,529
injustice and then after you do that
patch you have to go through and check

142
00:14:41,529 --> 00:14:46,269
to make sure that there's no more group
policy preference files as those past

143
00:14:46,269 --> 00:14:56,410
Microsoft is a script to stand for that
escaped detection you could create an

144
00:14:56,410 --> 00:15:02,839
XML file set access to the no one can
access it so the ACL sonoma taxes and

145
00:15:02,839 --> 00:15:08,939
then set auditing and if you get errors
maybe someone scanning for please don't

146
00:15:08,939 --> 00:15:12,910
do this anymore this drives me crazy
just about every organization I look at

147
00:15:12,910 --> 00:15:17,850
I found a VBS script insist ball that
has a clear text password this script is

148
00:15:17,850 --> 00:15:22,879
still on Microsoft TechNet gallery
actually pull this last week so please

149
00:15:22,879 --> 00:15:28,089
please please stop putting passwords and
small driving me crazy that's making

150
00:15:28,089 --> 00:15:32,860
things easier for the attackers because
once they have that admin password for

151
00:15:32,860 --> 00:15:39,249
those hundreds of thousands of local
admin house workstations I'll have to do

152
00:15:39,249 --> 00:15:44,589
is use that account to jump from one
workstation to another because the term

153
00:15:44,589 --> 00:15:50,019
local is a bit of a misnomer local
account admin account password is same

154
00:15:50,019 --> 00:15:54,230
you can just use that credentials to
access them

155
00:15:54,230 --> 00:15:59,420
wire so what do we do the pics well we
can leverage Microsoft last two which

156
00:15:59,420 --> 00:16:06,220
was released earlier this year which
make sure that these local admin

157
00:16:06,220 --> 00:16:10,480
password change on a regular basis and
that there and each one each computer

158
00:16:10,480 --> 00:16:17,500
has a different password the other part
of this is to playing Kb 287 1997 which

159
00:16:17,500 --> 00:16:21,330
is effectively a backward of security
enhancements from when does a doubt one

160
00:16:21,330 --> 00:16:26,550
in 2012 are to this adds a local said so
that way you can track an account on a

161
00:16:26,550 --> 00:16:31,550
system as a local account you create a
group policy apply to your use and say

162
00:16:31,550 --> 00:16:37,220
local accounts cannot login over the
network that will stop that lateral

163
00:16:37,220 --> 00:16:42,560
movement of that time he also want to
start investigating work seasonal work

164
00:16:42,560 --> 00:16:46,040
station restrictions that make any sense
that workstation over here can

165
00:16:46,040 --> 00:16:50,770
communicate with a work session even
better doesn't make sense that a random

166
00:16:50,770 --> 00:16:55,060
workstation I'm at work and communicate
with the finance system where the HRC

167
00:16:55,060 --> 00:17:01,140
backend database that stores all the PII
information for organization we've been

168
00:17:01,140 --> 00:17:07,680
bagging system well once the attacker
gets as local admin account where they

169
00:17:07,680 --> 00:17:11,460
gonna do they're going to run commands
on remote system I have a few that are

170
00:17:11,460 --> 00:17:15,420
listed here but effectively its W my
which Matt Kramer and colleagues and

171
00:17:15,420 --> 00:17:18,370
talk about tomorrow or its when R M

172
00:17:18,370 --> 00:17:26,480
ourself morning which rides on when and
where they are you run when you get a

173
00:17:26,480 --> 00:17:36,310
system that shit about me guess so many
cats provides the capability dumb

174
00:17:36,310 --> 00:17:41,400
potentials tickets inject those
credentials Kerberos tickets

175
00:17:41,400 --> 00:17:46,460
golden tickets or tickets trust tickets
all sorts of tickets this is what

176
00:17:46,460 --> 00:17:51,620
happens when it runs on a system in
order to run many cats the attacker

177
00:17:51,620 --> 00:17:56,030
needs to have admin rights are being
local system why because many cats

178
00:17:56,030 --> 00:18:01,850
interacts with nelson also is a
protected process to protect the process

179
00:18:01,850 --> 00:18:03,900
least protected 2012

180
00:18:03,900 --> 00:18:13,940
protected memory space where the
credentials are stored in the system so

181
00:18:13,940 --> 00:18:16,670
that the user and admin log on to that
system

182
00:18:16,670 --> 00:18:23,030
their credentials are stored else s
which means that many cats and what's

183
00:18:23,030 --> 00:18:29,810
really interesting is that if you have a
service account that is used by service

184
00:18:29,810 --> 00:18:34,120
on that system and that service starts
up that service has to place that

185
00:18:34,120 --> 00:18:39,060
service account credentials summer
clothes and also so if you have services

186
00:18:39,060 --> 00:18:44,170
that are running on workstations under
the context of domain admins whoever can

187
00:18:44,170 --> 00:18:48,890
own that workstation can own your domain
and you can probably noticed there's a

188
00:18:48,890 --> 00:18:54,670
clear text password for each of these
read that's because up until Windows 8

189
00:18:54,670 --> 00:18:59,630
2011 and 2012 are to Windows developers
decided that instead of prompting users

190
00:18:59,630 --> 00:19:08,060
for things just go ahead story different
things just in case and in filing in

191
00:19:08,060 --> 00:19:14,210
2012 are too there's a way to stop that
by default the password in a easily

192
00:19:14,210 --> 00:19:22,090
reversible I know some properties now
the backward patch then mentioned

193
00:19:22,090 --> 00:19:27,300
earlier Kb 287 1997 you can slip a
registry key to prevent the older

194
00:19:27,300 --> 00:19:34,649
versions of Windows 7 2002 from storing
that from actually generating so what

195
00:19:34,650 --> 00:19:35,480
happens next

196
00:19:35,480 --> 00:19:41,620
chocolates admin rights on workstations
and they go after the demand that

197
00:19:41,620 --> 00:19:45,090
necessary to get access to data but it
makes things easier doesn't it

198
00:19:45,090 --> 00:19:50,530
sure there's two primary method city
this get access to the NTS I get a tax

199
00:19:50,530 --> 00:19:55,620
rectory database file or have
credentials that you've pulled off the

200
00:19:55,620 --> 00:20:00,360
system maybe you've gotten a domain
admin credentials out of a service using

201
00:20:00,360 --> 00:20:05,410
many cats or out of syslog or somewhere
else but the two primary methods and

202
00:20:05,410 --> 00:20:09,180
then at that point the attacker can
either dumped that accurately database

203
00:20:09,180 --> 00:20:11,190
file get the credentials out of it

204
00:20:11,190 --> 00:20:13,210
were run something like DC's

205
00:20:13,210 --> 00:20:20,179
you said that you can find the
AccurateRip database on the net word I

206
00:20:20,179 --> 00:20:25,880
don't believe you there they're easy
backup PC storage on your sand on your

207
00:20:25,880 --> 00:20:32,210
now as virtual domain controllers very
popular bean counters like to make

208
00:20:32,210 --> 00:20:38,039
everything virtual because cheaper right
easier to manage but if your virtual

209
00:20:38,039 --> 00:20:41,990
administrators are not considered domain
admins you may be in for a tough days

210
00:20:41,990 --> 00:20:49,370
because of VMware admin has the ability
to clone that fertility see copy down

211
00:20:49,370 --> 00:20:54,000
the storage files from virtually see
which includes the debt in the registry

212
00:20:54,000 --> 00:20:59,330
Hughes take it offline crack them open
and then dumped the current and that

213
00:20:59,330 --> 00:21:03,250
virtual PC clone can just be deleted it
was never started up there's no that

214
00:21:03,250 --> 00:21:04,159
launched the needy

215
00:21:04,159 --> 00:21:07,159
noting that flows to symbolize your
monitoring your virtual environment

216
00:21:07,159 --> 00:21:14,299
another option for attackers around its
well that's built into yes you still use

217
00:21:14,299 --> 00:21:19,480
by eighty admins in order to create and
install for Mediaset when I found this

218
00:21:19,480 --> 00:21:25,059
is very useful for a date yet because if
you want to play number of chores you

219
00:21:25,059 --> 00:21:30,600
can use to create the IFM set which
effectively takes a virtual snapshot of

220
00:21:30,600 --> 00:21:36,960
the debt on that to me as well as a
registered copy over to a member

221
00:21:36,960 --> 00:21:42,159
services to promoting and then when they
run to see promo points that I little

222
00:21:42,159 --> 00:21:46,059
see that Active Directory database with
a new domain controller so doesn't have

223
00:21:46,059 --> 00:21:51,640
to copy all that data across the network
from another dimension quicker but the

224
00:21:51,640 --> 00:21:57,970
problem is that that is the did so that
could be done and a lot of times this

225
00:21:57,970 --> 00:22:02,279
member server where this file is placed
the words to make sure is not protected

226
00:22:02,279 --> 00:22:07,580
the same levels or maybe a surprising to
me that you know what I put this on a

227
00:22:07,580 --> 00:22:13,130
share that make it easier when we're
gonna promoted easy later because once

228
00:22:13,130 --> 00:22:19,070
they have that file they own Active
Directory Holly

229
00:22:19,070 --> 00:22:22,250
impact it plus it did file on the reg
key

230
00:22:22,250 --> 00:22:29,830
to me now we have hashes here we have
purchased tickets now where we can just

231
00:22:29,830 --> 00:22:35,080
use the hashes how we heard about past
the hash but over the past two hash is

232
00:22:35,080 --> 00:22:38,980
even better because we can clear out all
of those Kerberos encryption keys on

233
00:22:38,980 --> 00:22:44,880
that system for that user and inject
that until and password hash and then we

234
00:22:44,880 --> 00:22:49,180
request the Kerberos ticket this what
happens that entail and password hashes

235
00:22:49,180 --> 00:22:58,920
used to effectively converting that into
her brothers and now the attack looks

236
00:22:58,920 --> 00:23:03,090
like pretty much anything else so the
medication ultimately protect your admin

237
00:23:03,090 --> 00:23:07,840
credentials set all your admin account
so sensitive and cannot be delegated I

238
00:23:07,840 --> 00:23:12,230
talked about this a black hat showing
how unconstrained delegation used where

239
00:23:12,230 --> 00:23:16,710
a single server in your environment
could be used to compromise your entire

240
00:23:16,710 --> 00:23:21,170
make sure the admins on a log on a
specific systems like an admin

241
00:23:21,170 --> 00:23:25,740
workstation an admin types her
credentials on a system and it shared by

242
00:23:25,740 --> 00:23:31,540
users were it's as user type activities
died like browsing web browsing e-mail

243
00:23:31,540 --> 00:23:39,840
cetera those credentials so we buy it
from a vendor and what's the first thing

244
00:23:39,840 --> 00:23:46,200
we're told that this service fountains
even right now what do we do we go okay

245
00:23:46,200 --> 00:23:53,320
that's I want this functionality time to
push back on the vendors time pushed

246
00:23:53,320 --> 00:23:57,490
back on the vendors because oftentimes
the developers to work for the vendor's

247
00:23:57,490 --> 00:24:04,820
product they test with what the man
admits so if someone tells you that this

248
00:24:04,820 --> 00:24:09,910
account its main admin find out when you
see the furnace install find out why

249
00:24:09,910 --> 00:24:16,160
what are the rights of a really require
so last year in November Microsoft had a

250
00:24:16,160 --> 00:24:25,720
major vulnerability with the way that
Kerberos was handle it properly validate

251
00:24:25,720 --> 00:24:30,670
the pac checks on the Kerberos tickets
now the Packers supremely Josh beautiful

252
00:24:30,670 --> 00:24:34,450
which contains the group membership of
the user for that ticket

253
00:24:34,450 --> 00:24:40,040
so this method to main user could
rewrite their ticket and effectively say

254
00:24:40,040 --> 00:24:46,510
within the ticket I'm now a domain admin
pass it to the demands so you could own

255
00:24:46,510 --> 00:24:48,590
eighty in five minutes

256
00:24:48,590 --> 00:24:54,030
Gavin Millar with tenable had this great
analogy lot of people here traveled on a

257
00:24:54,030 --> 00:24:58,850
plane you have a boarding pass to take a
sharp I'll go up to get on the plane and

258
00:24:58,850 --> 00:25:08,210
its flight attendants would you like to
drink caffeine before we take off so

259
00:25:08,210 --> 00:25:15,800
about two weeks after this patch was
released I can't drop this is a Python

260
00:25:15,800 --> 00:25:20,840
script written by Sylvia mind which
exploited this vulnerability once you

261
00:25:20,840 --> 00:25:22,390
had a domain user account

262
00:25:22,390 --> 00:25:42,820
explained that say yes but i wanna so
then packets at TGT with no pac what

263
00:25:42,820 --> 00:25:50,050
does Nexus it creates if it says the
main admin etcetera signs that with that

264
00:25:50,050 --> 00:25:54,900
domain user account password and send
both of them back to the person that

265
00:25:54,900 --> 00:26:02,300
along with original TGT and says the
domain controller I would like to TGS

266
00:26:02,300 --> 00:26:08,730
with impact I wanna service controller
gets really have no idea what's going on

267
00:26:08,730 --> 00:26:19,280
here that i'm gonna create a brand new
one but you can put that into that TTT

268
00:26:19,280 --> 00:26:21,710
and send it back to you here you go

269
00:26:21,710 --> 00:26:24,850
so now the attacker has a golden ticket

270
00:26:24,850 --> 00:26:29,150
effective that is good for that
wonderful deceive any other dc-in

271
00:26:29,150 --> 00:26:34,210
environment to stop at which means that
the ticket can be passed to catch or

272
00:26:34,210 --> 00:26:39,730
something else to own the domain through
that vulnerable Dec earlier this year

273
00:26:39,730 --> 00:26:45,640
Benjamin Delpy release a tool as part of
a toolkit that took this step further

274
00:26:45,640 --> 00:26:47,059
with

275
00:26:47,059 --> 00:26:50,749
you have to know which one as well and
there's been some tools out there the

276
00:26:50,749 --> 00:27:00,690
right amount of time than that made
since late last year but already seen

277
00:27:00,690 --> 00:27:08,110
once it finds it it explodes it and gets
that Ms 14068 golden ticket and then it

278
00:27:08,110 --> 00:27:20,399
takes it one step further and goes I
would like delegations delegation to the

279
00:27:20,399 --> 00:27:26,419
past so the mitigation straightforward
make sure you pack controllers make sure

280
00:27:26,419 --> 00:27:31,159
that the server image server build has
dispatched before you run Dec problem

281
00:27:31,159 --> 00:27:36,389
make sure all your QA checks on Dec
promo include this PowerShell command at

282
00:27:36,389 --> 00:27:40,440
the bottom and you can create 90 s
signature looking for a Kerberos a US

283
00:27:40,440 --> 00:27:50,990
request that set TGT and TGS request
both containing include packs false so

284
00:27:50,990 --> 00:27:56,639
let's talk about what happens when an
attacker gets to me that there's an

285
00:27:56,639 --> 00:27:59,799
infinite number of things an attacker
could do but ultimately there's a finite

286
00:27:59,799 --> 00:28:05,789
number of pathways this is what I call
sneaky eighty attacker as da access 45

287
00:28:05,789 --> 00:28:12,080
minutes let's talk about the ones unless
I talked about a couple of good ones on

288
00:28:12,080 --> 00:28:14,389
the right at DEFCON

289
00:28:14,389 --> 00:28:20,909
golden tickets what's a golden ticket is
a foreign CDT authentication to prove

290
00:28:20,909 --> 00:28:22,119
who you are

291
00:28:22,119 --> 00:28:29,999
well if I have the courage et password
hash was used the sign that as well as

292
00:28:29,999 --> 00:28:33,610
that TTT

293
00:28:33,610 --> 00:28:40,470
and when I can create my own I can be
anyone I wanted on the net somebody who

294
00:28:40,470 --> 00:28:45,990
doesn't exist but I still have to pass
out to the main controller to get

295
00:28:45,990 --> 00:28:49,350
service tickets to to do things in the
environment

296
00:28:49,350 --> 00:29:00,880
there is a limitation of sorts but in a
multi-domain directory and fire horace

297
00:29:00,880 --> 00:29:09,289
as if you have a golden ticket for a
child to me that golden tickets other to

298
00:29:09,289 --> 00:29:14,880
me because it says I'm a member of
enterprise outlines but enterprise admin

299
00:29:14,880 --> 00:29:22,549
has not held in that child health by the
parent that route first main course so I

300
00:29:22,549 --> 00:29:26,809
was doing some research on said history
the May June timeframe and I reached out

301
00:29:26,809 --> 00:29:37,039
to Benjamin Katz I said he had said
history two tickets for sure

302
00:29:37,039 --> 00:29:42,059
golden tickets are now more golden
because when you that's it history

303
00:29:42,059 --> 00:29:47,620
component to that golden ticket if a
child gets compromised that golden

304
00:29:47,620 --> 00:29:51,840
ticket will now troopers those trust
relationships with the other demands and

305
00:29:51,840 --> 00:29:55,549
there's other demands will trust in
information in that city history he'll

306
00:29:55,549 --> 00:30:02,299
saying that this is an enterprise
enterprise admin is a actively domain

307
00:30:02,299 --> 00:30:12,309
admin every domain so it's important to
note that the forest the forest the

308
00:30:12,309 --> 00:30:17,289
security boundary not the demand for the
fact that you can jump from demanded a

309
00:30:17,289 --> 00:30:25,000
man with an actor should not be news but
if you're ready more you loveless blue

310
00:30:25,000 --> 00:30:28,169
team will talk about that later

311
00:30:28,169 --> 00:30:33,059
so her ticket this is like the younger
brother of the gold nobody cares about

312
00:30:33,059 --> 00:30:36,950
some things I really like silver tickets
why because there's no communication

313
00:30:36,950 --> 00:30:45,110
with the demand is super ticket is a
particular service where specific

314
00:30:45,110 --> 00:30:50,750
service running on a server remember
that service ticket is encrypted with

315
00:30:50,750 --> 00:30:55,470
the password data for the service
account for that service so we don't

316
00:30:55,470 --> 00:30:58,790
need to ask them to make sure that we re
created

317
00:30:58,790 --> 00:31:03,510
we can create silver and gold tickets
were ever want to have that passed and

318
00:31:03,510 --> 00:31:07,250
then we just need to inject it on any
computer on the network not even demand

319
00:31:07,250 --> 00:31:17,180
joined other if we have the password or
account is a lot of different services

320
00:31:17,180 --> 00:31:24,540
that run under the context of the
computer account windows and the

321
00:31:24,540 --> 00:31:32,580
computer account password is changed by
the computer now on some sort of policy

322
00:31:32,580 --> 00:31:41,940
but it's more of a guideline not a rule
Active Directory is not have the same

323
00:31:41,940 --> 00:31:49,240
password for years now and an attacker
can actually block this process from

324
00:31:49,240 --> 00:31:56,680
working I said this Reggie were setting
group policy fiscal policy in DI

325
00:31:56,680 --> 00:32:01,440
environments this is often configured
your water so that when that master

326
00:32:01,440 --> 00:32:06,250
image is fun up with a copy so they
don't need to try to track with that

327
00:32:06,250 --> 00:32:13,670
your password if we've been able to
compromise the domain and we have that

328
00:32:13,670 --> 00:32:18,150
control our computer account password
what can we do with the computer account

329
00:32:18,150 --> 00:32:22,970
password hash her to make the Silverton
well we can create a silver ticket using

330
00:32:22,970 --> 00:32:32,520
the password and we can target any
service we in target all that on that to

331
00:32:32,520 --> 00:32:32,740
me

332
00:32:32,740 --> 00:32:42,290
anyone know why we might want to target
DCC if we create a silver ticket for a

333
00:32:42,290 --> 00:32:47,120
domain controller using the bank tellers
password hash and target the LDAP

334
00:32:47,120 --> 00:32:55,130
service we can run many cat species and
we can call the current account password

335
00:32:55,130 --> 00:32:58,330
let's talk

336
00:32:58,330 --> 00:33:02,480
that's another type persist the admin St
Homer object which may be known to

337
00:33:02,480 --> 00:33:10,659
anyone else it's a template object
exists in the system container with an

338
00:33:10,659 --> 00:33:12,640
Active Directory

339
00:33:12,640 --> 00:33:18,850
does nothing else hold security
information security app and there's a

340
00:33:18,850 --> 00:33:24,769
process on the PC emulator that runs
about every 60 minutes and it enumerates

341
00:33:24,769 --> 00:33:32,130
some of the most privileged accounts and
groups in the demand and if that group

342
00:33:32,130 --> 00:33:36,669
membership roster that security and
information does not match what's on at

343
00:33:36,669 --> 00:33:41,580
the admin St holder object it re- stamps
it and it also stances object so that

344
00:33:41,580 --> 00:33:49,669
they don't have security inherit and
then it sets out and count to one so you

345
00:33:49,669 --> 00:33:55,500
can actually enumerate accounts
environment without group membership in

346
00:33:55,500 --> 00:34:02,580
checking because you can look for
accounts of how bad encounter one now

347
00:34:02,580 --> 00:34:09,510
when there's never comes back in 20 so
Mike its assets but without looking at

348
00:34:09,510 --> 00:34:13,909
any groups if you can enumerate all
accounts the demeanor asked for all of

349
00:34:13,909 --> 00:34:20,179
the Council Council you can find some
cows live because our members of these

350
00:34:20,179 --> 00:34:24,580
groups are these accounts so what's
really interesting about this whole

351
00:34:24,580 --> 00:34:28,899
process is if we have two main admin
rights review minutes we can change the

352
00:34:28,899 --> 00:34:40,700
default and St prop process run which
means that we can also those permissions

353
00:34:40,700 --> 00:34:49,919
game rights so we go ahead and delegate
full control to a user object to a user

354
00:34:49,919 --> 00:34:56,609
to and then about 60 minutes later that
get stamped on every one of those

355
00:34:56,609 --> 00:35:01,240
protected objects which means this
account house full control on the domain

356
00:35:01,240 --> 00:35:07,750
admins and this user has no group
members but this user can add another

357
00:35:07,750 --> 00:35:08,330
user

358
00:35:08,330 --> 00:35:17,460
works so many cats added Dec saying this
is big Vegas week soon after that

359
00:35:17,460 --> 00:35:24,680
they'll be rolled into many cats you
used to pull password data from an

360
00:35:24,680 --> 00:35:26,370
account users

361
00:35:26,370 --> 00:35:32,400
yrs domain controllers it uses the
domain controller replication API's and

362
00:35:32,400 --> 00:35:41,290
requires membership into Manhattan's
administrators were controller so I was

363
00:35:41,290 --> 00:35:50,570
wondering how could I Randy single-user
fired demand averaged 45 minutes how

364
00:35:50,570 --> 00:35:54,400
could I persistent

365
00:35:54,400 --> 00:36:00,700
at the root of the demesne you set the
permissions to wear a regular user

366
00:36:00,700 --> 00:36:04,700
accounts in replicating director changed
replicating director she's already came

367
00:36:04,700 --> 00:36:09,000
directly changes those of the
right-center need the only rights

368
00:36:09,000 --> 00:36:17,140
attorney to randy said so the next
question is are there any accounts

369
00:36:17,140 --> 00:36:23,590
already have made a number of Microsoft
article that talks about setting

370
00:36:23,590 --> 00:36:28,120
replicating director changes permission
for them type Services Directory

371
00:36:28,120 --> 00:36:33,780
replication service some instances sure
none of them say set all three but we

372
00:36:33,780 --> 00:36:38,150
know that admins always use the minimum
number of emissions right so it's

373
00:36:38,150 --> 00:36:42,220
possible there's a service count out
there that has Dec cigarettes so if we

374
00:36:42,220 --> 00:36:50,480
Kerberos that service hurt TTT
straighter which includes the password

375
00:36:50,480 --> 00:36:54,440
history for that account which means
that if we track this these crashes than

376
00:36:54,440 --> 00:36:59,810
we know what pastor strategy they use
for that account YouTube account

377
00:36:59,810 --> 00:37:05,910
password data for detecting this is
difficult to laws but there is a way to

378
00:37:05,910 --> 00:37:12,380
do it with an idea if you do keywords
for DRS UHCI and es geht and see changes

379
00:37:12,380 --> 00:37:17,700
request and you correlate this with the
source IP not being a domain controller

380
00:37:17,700 --> 00:37:21,170
IP anytime you see that you know that
that is bad

381
00:37:21,170 --> 00:37:29,180
bad so deftly I talked about the DSM
accounts the directory services restore

382
00:37:29,180 --> 00:37:33,859
account or so remote account that is
figured all domain controllers and the

383
00:37:33,859 --> 00:37:40,150
demand and are set the password is set
for it when the domain controllers first

384
00:37:40,150 --> 00:37:44,720
remote and I talked about how to
leverage this to retain full admin

385
00:37:44,720 --> 00:37:50,940
access to the demand for it involves
knowing the password or changing a

386
00:37:50,940 --> 00:37:57,809
setting this Reggie at the bottom to
which i think is this account is set for

387
00:37:57,809 --> 00:38:03,880
AM I went and forgot about it is no easy
automated way to change the process

388
00:38:03,880 --> 00:38:18,980
everything and so what do you think the
admin password 24 yes around a lot and

389
00:38:18,980 --> 00:38:26,119
sale of keyboard patterns appear so the
DSM account is a domain controller local

390
00:38:26,119 --> 00:38:30,859
admin account and we can dump this using
many cats because many cats can dump the

391
00:38:30,859 --> 00:38:36,740
Sam potentials increasingly not here we
dump it and we see this writ 500 on this

392
00:38:36,740 --> 00:38:42,319
dementia which the administrator and we
have a password hash actually do with

393
00:38:42,319 --> 00:38:46,970
the password will Benjamin LPI working
through this last week we discovered

394
00:38:46,970 --> 00:38:51,460
something really really interesting we
got very excited he got very excited

395
00:38:51,460 --> 00:38:57,500
French cuz he's a friend even more
exciting we couldn't pass the hash for

396
00:38:57,500 --> 00:39:08,030
the DSM account sale we got a fence that
said we fail 4625 fail 4776 fail

397
00:39:08,030 --> 00:39:25,470
so we thought about it and see what
happens if we change that registry key

398
00:39:25,470 --> 00:39:28,010
yessir a madman log on

399
00:39:28,010 --> 00:39:35,550
registry he doesn't exist he said it's
2-2 in order to long on the DSM account

400
00:39:35,550 --> 00:39:42,200
without having to shut down the research
we were able to pass the hash using the

401
00:39:42,200 --> 00:39:46,940
DSM account we got access to the file
system on that sir

402
00:39:46,940 --> 00:39:56,560
this demand that DSM account that's not
what we were able to use gcc so using

403
00:39:56,560 --> 00:40:00,610
that local admin account which the
password is generally not changed this

404
00:40:00,610 --> 00:40:07,630
reg key is often set 22 we were able to
run Dec saying and pull the curtain

405
00:40:07,630 --> 00:40:17,240
decal pass with no one ever uses account
I ran decent side of the red team right

406
00:40:17,240 --> 00:40:19,940
now is ready have a party right lots of
cool stuff

407
00:40:19,940 --> 00:40:26,270
have forgotten about you lose him so
there's a number of different things you

408
00:40:26,270 --> 00:40:27,380
can do

409
00:40:27,380 --> 00:40:32,470
potentially there's anomalies in advance
for Kerberos tickets he silver tickets

410
00:40:32,470 --> 00:40:36,440
make sure you change your computer
account passwords after a breach object

411
00:40:36,440 --> 00:40:39,650
permissions you want to check them on
the admin St holder the route demand

412
00:40:39,650 --> 00:40:45,630
IDSA for DCC change your DSi and
password regularly monitoring that

413
00:40:45,630 --> 00:40:49,540
Reggie and the DSM offense but
ultimately protecting your age admits

414
00:40:49,540 --> 00:40:55,450
solut my love for you to know I know it
feels like it's 300 purchase 300,000

415
00:40:55,450 --> 00:41:01,900
being a blue team being a defensive
person in the world while pull through

416
00:41:01,900 --> 00:41:11,900
this recently and said how many you can
fill this out I'm here to help so if you

417
00:41:11,900 --> 00:41:14,850
have the Active Directory commandments
and Saudi can run this command at the

418
00:41:14,850 --> 00:41:18,870
top which will give you information to
help fill out a lot of that computer

419
00:41:18,870 --> 00:41:24,190
data including operating system data
looking at the types of operating

420
00:41:24,190 --> 00:41:29,490
systems have each year from MSDN
operating system in the version number

421
00:41:29,490 --> 00:41:33,460
which set family and you can do the same
thing for users get the information

422
00:41:33,460 --> 00:41:37,890
about the users that are out there when
their password last said whenever

423
00:41:37,890 --> 00:41:45,210
required said history information which
is often used her persistence counts but

424
00:41:45,210 --> 00:41:51,370
defense starts with logs as InfoSec TSYS
you need to make sure you're logging

425
00:41:51,370 --> 00:41:57,980
logging the data you're not going to get
what you need to track so let's talk

426
00:41:57,980 --> 00:42:02,250
about PowerShell attack detection it
starts with Los longing Powershot

427
00:42:02,250 --> 00:42:11,680
configure PowerShell module that way you
can get the log data detail why didn't

428
00:42:11,680 --> 00:42:16,040
you want to check it out because there's
a lot of really good information their

429
00:42:16,040 --> 00:42:20,730
talks about powerful security especially
now when you login you looking for

430
00:42:20,730 --> 00:42:25,180
instance interesting activity there may
be some legitimate PowerShell scripts in

431
00:42:25,180 --> 00:42:27,350
her downloading stuff via dotnet

432
00:42:27,350 --> 00:42:36,380
were running invoke Expression Encoder
commander bits activity etc but

433
00:42:36,380 --> 00:42:39,470
ultimately comes down to a few a
PowerShell remoting on your network and

434
00:42:39,470 --> 00:42:41,010
your environment

435
00:42:41,010 --> 00:42:44,560
make sure it's being used as its not
disabled it that's a great actor for an

436
00:42:44,560 --> 00:42:53,400
ad attacking you can limit yourself to
specific subnets edmondson s by

437
00:42:53,400 --> 00:42:59,800
configuring the winner analyst and you
can audit and meter your power surge

438
00:42:59,800 --> 00:43:07,240
texting invoked using signatures right
and a virus companies are doing this

439
00:43:07,240 --> 00:43:12,500
work so I dug in little further to look
at with these commands it doing the

440
00:43:12,500 --> 00:43:15,920
PowerShell attack tools what they're
actually doing in order for them to work

441
00:43:15,920 --> 00:43:21,590
properly they teaser dotnet
functionalities API API calls and so you

442
00:43:21,590 --> 00:43:25,770
can use some keywords in your event lots
of powerful about lunch now you're

443
00:43:25,770 --> 00:43:30,100
pulling back is no guarantee that
they'll be there but they can lead you

444
00:43:30,100 --> 00:43:34,840
down the breadcrumb trail to find out
what's going on and you can see in the

445
00:43:34,840 --> 00:43:40,130
event here if i'm looking for token
privileges I can get some obvious that I

446
00:43:40,130 --> 00:43:49,290
look for something like summer
collection there's a ton of events so I

447
00:43:49,290 --> 00:43:54,510
cracked open the the shower spray get
home area and I looked at some of the

448
00:43:54,510 --> 00:43:58,320
commands there to see what similarities
there are a number of similarities and

449
00:43:58,320 --> 00:44:06,430
such so can a person nation took ages
reflection reflection its password which

450
00:44:06,430 --> 00:44:16,510
stands for chances for an entire
shoulders and five this a lot easier on

451
00:44:16,510 --> 00:44:21,970
you look for these keywords but
obviously very true again it's about

452
00:44:21,970 --> 00:44:25,190
finding these breadcrumb setting
yourself up as a blue team member to

453
00:44:25,190 --> 00:44:29,300
have better potential for success this
number

454
00:44:29,300 --> 00:44:33,150
rate security enhancements which I heard
his outside

455
00:44:33,150 --> 00:44:39,480
search was crip walk logging so one of
the most common methods by an attacker

456
00:44:39,480 --> 00:44:45,700
is to run an encoded command which has
basic see where and when

457
00:44:45,700 --> 00:44:54,150
module log that data with previous
versions you get the five Indian skipper

458
00:44:54,150 --> 00:45:01,369
Clarke gives you that actually the
opposite running that script gets a semi

459
00:45:01,369 --> 00:45:06,069
transcripts which gives you an over the
shoulder look at what you doing this

460
00:45:06,069 --> 00:45:11,549
configured by in situ a right on sharing
your network and that way you can parse

461
00:45:11,549 --> 00:45:18,980
it later using it since see what was
wrong when it was executed it but what

462
00:45:18,980 --> 00:45:26,289
the host application and then we talk
about constrained PowerShell constrain

463
00:45:26,289 --> 00:45:34,190
powerful language mood boils down to
just the poor man's functionality like

464
00:45:34,190 --> 00:45:40,510
API calls and i dont working stream how
she'll version five blocks down to this

465
00:45:40,510 --> 00:45:46,260
move by deed poll once you get a proper
an elaborate on the network and that

466
00:45:46,260 --> 00:45:51,730
could stop tax story gets better with
Windows 10 we're talking about the

467
00:45:51,730 --> 00:46:00,910
anti-maoist and interface which means
that the MSI which exposed that Coach

468
00:46:00,910 --> 00:46:05,339
the enzyme our solution and PowerShell
will not run that code regardless of

469
00:46:05,339 --> 00:46:08,869
whether or not it was approached from
the internet were run from the script or

470
00:46:08,869 --> 00:46:16,020
type to manually so I get back Assad's
ok so let's cover some of the medication

471
00:46:16,020 --> 00:46:21,750
that I've mentioned in some that habit
21 Kb 287 1997 want to do this on every

472
00:46:21,750 --> 00:46:26,700
computer on your network said that group
policy leverage those local sits you can

473
00:46:26,700 --> 00:46:30,950
look at RTP restricted admin mode the
client bird component is is covered in

474
00:46:30,950 --> 00:46:36,619
this KB article the server one is
covered in these different Apr but

475
00:46:36,619 --> 00:46:44,760
ultimately removed which didn't happen
prior to download lines and it will

476
00:46:44,760 --> 00:46:50,220
remove password from actually being
stored memory by setting this registry

477
00:46:50,220 --> 00:46:56,119
registry key 20 and you want to monitor
the stretchy because attackers action

478
00:46:56,119 --> 00:47:00,000
setting to win and some cases so that
way this clear text passwords available

479
00:47:00,000 --> 00:47:07,329
new rivers now covered some of the east
side over the you make sure you know

480
00:47:07,329 --> 00:47:12,069
your admins are you sure there's no user
accounts they're good at midnight long

481
00:47:12,069 --> 00:47:17,990
complex passwords service accounts
catching the main control randomizing

482
00:47:17,990 --> 00:47:22,970
those pewter local admin account
password additional protections for your

483
00:47:22,970 --> 00:47:27,619
service accounts making sure the you
know what

484
00:47:27,619 --> 00:47:36,720
systems rabin's along onto should be
separate and works herself now we get

485
00:47:36,720 --> 00:47:37,650
into what I call me

486
00:47:37,650 --> 00:47:43,109
level 3 or the it's complicated it's
time to stop using the man out in so

487
00:47:43,109 --> 00:47:51,420
that group should be the main islands
nineteen nineties thinking dnt days

488
00:47:51,420 --> 00:47:58,220
movie hackers came out in nineteen it's
time to stop using the main outlines how

489
00:47:58,220 --> 00:48:02,730
do we do this we clear it out we get our
exchange admins out there we got a sec

490
00:48:02,730 --> 00:48:09,589
I'm out here to get a sequel service
count out we create custom delegation

491
00:48:09,589 --> 00:48:14,599
groups and give them the rights they
need not the right say a score we are

492
00:48:14,599 --> 00:48:17,819
looking at temporal group membership
which is gonna be a feature in 2016

493
00:48:17,819 --> 00:48:23,549
where we look at the fact that everyone
is here if your blue team your domain

494
00:48:23,549 --> 00:48:27,589
admin if you're an admin or admin
accounts back at your company still

495
00:48:27,589 --> 00:48:32,779
without rights it's time to reconsider
that and start looking at a better way

496
00:48:32,779 --> 00:48:38,170
to do it for me are not operating you're
not using your performing tasks where we

497
00:48:38,170 --> 00:48:40,140
need these these rights we should not
have

498
00:48:40,140 --> 00:48:45,070
a workflow which when I come in I go I
need these rights and then go through a

499
00:48:45,070 --> 00:48:49,560
process needs auto approve maybe its
workload later the important thing is I

500
00:48:49,560 --> 00:48:54,700
get a notification I requested it and
someone else as well because I get a

501
00:48:54,700 --> 00:49:00,780
notification email right now that says
demand admins I know that that's not an

502
00:49:00,780 --> 00:49:04,320
implement network segmentation target
after they were breached higher pen test

503
00:49:04,320 --> 00:49:06,800
team come in to check out their
environment

504
00:49:06,800 --> 00:49:10,970
the pen test team discovered they were
able to compromise a meat scale at the

505
00:49:10,970 --> 00:49:15,500
deli counter one Target store and use
that connect to the cash register and

506
00:49:15,500 --> 00:49:21,710
other targets it's time for us to stop
making her network so it's time for us

507
00:49:21,710 --> 00:49:28,690
to start protecting her networks to have
a number of additional medications the

508
00:49:28,690 --> 00:49:34,310
most important a rich mix you computer
accounts you are in breach of our

509
00:49:34,310 --> 00:49:41,150
scenario I love talk to its top change
the kurds YouTube account password at

510
00:49:41,150 --> 00:49:43,460
least every year

511
00:49:43,460 --> 00:49:50,550
gotta be changed twice every year and
especially where daily my house in

512
00:49:50,550 --> 00:49:55,930
outpatient from especially when an
action and deploy internal IDE as if

513
00:49:55,930 --> 00:50:02,350
you're not watching the traffic insider
networked have no idea what's going on I

514
00:50:02,350 --> 00:50:10,600
can tell you what's so in summary the
attackers will get code running on a

515
00:50:10,600 --> 00:50:15,610
target system in your network extent of
their access entirely based on your

516
00:50:15,610 --> 00:50:19,940
defense posture and if your Active
Directory admins are not protected at a

517
00:50:19,940 --> 00:50:26,160
very high level they will compromise
your entire to me and partisan involves

518
00:50:26,160 --> 00:50:30,310
making sure that our eighty-eight mins
only ever log on to the main controllers

519
00:50:30,310 --> 00:50:34,970
a special admin servers special ad
networks same thing for server add only

520
00:50:34,970 --> 00:50:40,790
servers only workstation Adams only on
workstation because once an attack get

521
00:50:40,790 --> 00:50:43,490
server credits around and press freedom
and out

522
00:50:43,490 --> 00:50:57,810
game over by the way I want for
Christmas so that's my time thank you

523
00:50:57,810 --> 00:51:09,780
very much for years I think we have
another minute

524
00:51:09,780 --> 00:51:14,240
these are highly recommended

525
00:51:14,240 --> 00:51:19,470
questions if not I can go outside and
talk with people have some additional

526
00:51:19,470 --> 00:51:29,340
questions thank you yeah available on
this link right here eighty security out

527
00:51:29,340 --> 00:51:31,100
or I'll try to get him up this weekend

