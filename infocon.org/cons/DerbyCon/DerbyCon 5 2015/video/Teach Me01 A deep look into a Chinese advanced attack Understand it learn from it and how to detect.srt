1
00:00:00,000 --> 00:00:04,180
work partly because of my experience
with this guy right here and talk about

2
00:00:04,180 --> 00:00:06,279
today so Who Am I

3
00:00:06,279 --> 00:00:15,349
well my name is Michael Malaga hollick
and a good team defender archaeologists

4
00:00:15,349 --> 00:00:20,830
in La Jolla course I love properly
configured logs logs are awesome as its

5
00:00:20,830 --> 00:00:25,400
long conference last week teaching
people how to do is there somebody

6
00:00:25,400 --> 00:00:31,500
else's phone come here and tell us who
what where when and hopefully how

7
00:00:31,500 --> 00:00:37,450
malware or the behavior of malaria
occurred what happened what they do on

8
00:00:37,450 --> 00:00:40,190
the creator of the windows logging cheat
sheets a great reference if you wanna

9
00:00:40,190 --> 00:00:42,980
know how to configure Windows logs are
they actually tell you something please

10
00:00:42,980 --> 00:00:46,590
go out and check that out that's on
everything you talked about yours on our

11
00:00:46,590 --> 00:00:51,460
archaeology at the bottom line I also be
releasing Windows PowerShell logging

12
00:00:51,460 --> 00:00:55,920
chichi and just released the window
Splunk logging chichi for you folks can

13
00:00:55,920 --> 00:01:00,539
interpolate after logging solution to go
on and also the creator of them our

14
00:01:00,539 --> 00:01:04,549
manager framework so our management
thinking ability management reports I

15
00:01:04,549 --> 00:01:08,119
take the artifacts out of that and I
played my security solutions or that's

16
00:01:08,119 --> 00:01:13,270
where I look for things I'm also the
co-creator of MDD the log malicious

17
00:01:13,270 --> 00:01:19,729
discovery tool with mister better a
reason and send up their ago so we'll be

18
00:01:19,729 --> 00:01:26,299
covering that here in a second brian is
with the other Brian cast so the goal is

19
00:01:26,299 --> 00:01:33,509
interaction I don't get rewarded if you
ask questions

20
00:01:33,509 --> 00:01:36,280
short questions of course I don't hold
us down too much but there is some

21
00:01:36,280 --> 00:01:41,630
wiggle room here so by all means please
myself for 30 ding-dong a good question

22
00:01:41,630 --> 00:01:50,009
and again this is to teach those ninjas
out there all of you how we found this

23
00:01:50,009 --> 00:01:53,090
and of course we're also gonna talk
about a new tool for you to use

24
00:01:53,090 --> 00:01:58,170
we are announcing the release of today's
free for your use that can help out so I

25
00:01:58,170 --> 00:02:01,510
listen to me about 2012 may 2012

26
00:02:01,510 --> 00:02:06,030
company I work for the time got hacked
and about two months later Kaspersky

27
00:02:06,030 --> 00:02:09,150
came out with this many people here are
familiar with this windy I report

28
00:02:09,150 --> 00:02:14,160
anybody so you can get the details of
what they found

29
00:02:14,160 --> 00:02:18,990
we did see the hour we found in 2012
2:12 different companies heard from two

30
00:02:18,990 --> 00:02:24,750
of them one said it was not our yeah
it's on sending a report to him and then

31
00:02:24,750 --> 00:02:28,410
also in 2014 the stuff I'm gonna walk
you through and show you today we

32
00:02:28,410 --> 00:02:32,190
actually gave a copy of the infected
p.m. actually with the artifacts I'm

33
00:02:32,190 --> 00:02:35,880
gonna be speaking about a large IR firm
and they came back and said the box was

34
00:02:35,880 --> 00:02:46,300
so you know pound failed there and
graduated is the moral of story so into

35
00:02:46,300 --> 00:02:52,460
you I 2014 Sep 2012 report got it got it
again in 2014 much more sophisticated

36
00:02:52,460 --> 00:02:58,220
and before they updated their approach
much more complex much more tricky this

37
00:02:58,220 --> 00:03:02,930
is not your typical pwnage but for sure
to catch him in the act and show you why

38
00:03:02,930 --> 00:03:06,800
and how and pretty much if it wasn't for
the single item it would have been very

39
00:03:06,800 --> 00:03:12,100
very typical and I'm sharing with all of
you see you can learn the slide deck has

40
00:03:12,100 --> 00:03:16,730
been posted to SlideShare already so
take that out of the way it is available

41
00:03:16,730 --> 00:03:23,140
and recording this so you get on his
good side as well so history of guys

42
00:03:23,140 --> 00:03:27,230
been around for about five years this
group named by Kaspersky and the Bureau

43
00:03:27,230 --> 00:03:31,440
as indications of Bureau of this now
been doing this a while there is an

44
00:03:31,440 --> 00:03:35,850
estimated one billion dollar underground
industry for the gaming that's basically

45
00:03:35,850 --> 00:03:40,900
stealing fake gold selling online for
real money not to mention various other

46
00:03:40,900 --> 00:03:44,390
things like steel town so what we're
quite a bit over those folks are in this

47
00:03:44,390 --> 00:03:49,730
industry and so they're highly motivated
that's really the motivation and Chinese

48
00:03:49,730 --> 00:03:54,819
why and I generally don't nutrition in
the Fed said it's the Chinese

49
00:03:54,819 --> 00:04:00,579
I believe them and everything we saw
very much and I guess not quite state

50
00:04:00,579 --> 00:04:06,769
sponsored point some of the trickiest he
saw that I would I would consider this

51
00:04:06,769 --> 00:04:11,920
your typical attack he was very much
targeted to our company and an industry

52
00:04:11,920 --> 00:04:17,630
so so plus a reported seven percent of
all our unique to one company 80% tenor

53
00:04:17,630 --> 00:04:21,220
less TV industry focuses on twenty
percent of all power returned sixty

54
00:04:21,220 --> 00:04:25,570
million uniques last year and they focus
on a very small amount of that because

55
00:04:25,570 --> 00:04:29,710
that's what we see mostly in fishing and
websites and whatnot the obviously

56
00:04:29,710 --> 00:04:37,190
WordPress Joomla type type of downloads
rabbis but things changed their new

57
00:04:37,190 --> 00:04:42,050
where we saw compiled it from just 30
minutes ago so these were very active

58
00:04:42,050 --> 00:04:45,960
participating actors nobody made an
interesting point you know maybe this is

59
00:04:45,960 --> 00:04:50,340
state sponsored in that we really can't
tell what the bad actors are they're

60
00:04:50,340 --> 00:04:54,389
doing and maybe this is how they test
for the stuff they're executing used in

61
00:04:54,389 --> 00:04:59,009
the real world for state sponsored taxes
that was interesting not sure I would I

62
00:04:59,009 --> 00:05:03,720
would say that but you know it's
possible early as the summer of 2012

63
00:05:03,720 --> 00:05:06,080
again

64
00:05:06,080 --> 00:05:11,970
typical Mauer a lot of action that drops
deals in the WBEM directory what happens

65
00:05:11,970 --> 00:05:16,229
there is one W my started it loads the
deal will automatically are too much

66
00:05:16,229 --> 00:05:19,460
time to do anything else to use the
Explorer when someone logged into the

67
00:05:19,460 --> 00:05:25,020
box or not exe called the local info DLL
automatically loaded them our window

68
00:05:25,020 --> 00:05:28,039
user login so they had multiple
mechanisms to get into the box

69
00:05:28,039 --> 00:05:32,259
start files and system 32 unprogrammed a
pretty typical looking like video

70
00:05:32,259 --> 00:05:35,870
drivers and stuff like that either
nothing did send us the Lenovo video

71
00:05:35,870 --> 00:05:36,710
driver that we

72
00:05:36,710 --> 00:05:40,520
was a couple years ago with attacks and
we weren't all the houses that was

73
00:05:40,520 --> 00:05:46,030
coming and they also use amicably here
seen or read anything about the sysprep

74
00:05:46,030 --> 00:05:51,120
trip based compromise I know he knows
about it so if you're not monitoring for

75
00:05:51,120 --> 00:05:56,140
execution of six prep I recommend you do
as a matter of fact and one of them

76
00:05:56,140 --> 00:06:01,170
hours talk about later actually seeing
this in commodity and it's actually been

77
00:06:01,170 --> 00:06:05,570
extended its use this is only seen it
used exactly like you see here

78
00:06:05,570 --> 00:06:12,030
sysprep crispy lol so you just have to
create a bogus militias lol run sysprep

79
00:06:12,030 --> 00:06:16,630
basement base and booming lows but I've
seen some more sophisticated command

80
00:06:16,630 --> 00:06:20,420
lines on that song before that the
Microsoft that to me is interesting that

81
00:06:20,420 --> 00:06:25,820
they need to fix that utility my guest
and they also had a booth at back door

82
00:06:25,820 --> 00:06:27,720
so this thing was cool

83
00:06:27,720 --> 00:06:32,100
real pain the butt because when you we
have rate assemblies and big big storage

84
00:06:32,100 --> 00:06:36,230
arrays and you want to take the driver
to drive down the workstation

85
00:06:36,230 --> 00:06:41,160
polymerization outgoing test lab scandal
not that easy with servers specially

86
00:06:41,160 --> 00:06:44,670
when they're in other countries really
are and so they had a little piece a

87
00:06:44,670 --> 00:06:48,340
little make a kind of backdoor where
when the system booted up it read from

88
00:06:48,340 --> 00:06:52,730
disk loaded and delete itself and then
wrote down to this after it was done and

89
00:06:52,730 --> 00:06:54,560
the cool thing was we had a power outage

90
00:06:54,560 --> 00:06:58,830
percent of our office locations and
Exchange servers that had it is we're

91
00:06:58,830 --> 00:07:06,330
trying to figure out exactly what the
mechanism and a way to power here in

92
00:07:06,330 --> 00:07:11,090
town that had not here I live in Austin
and proof of our disappeared so it's a

93
00:07:11,090 --> 00:07:15,630
ninja tip if you're dealing with all
memory power just pulled power so

94
00:07:15,630 --> 00:07:20,330
services down the databases was not to
kill it cause I can't finish doing the

95
00:07:20,330 --> 00:07:24,560
right down back at this was a very
effective cleaning technique lots of new

96
00:07:24,560 --> 00:07:28,450
services so this is very typical just
like you see in the retail POS attacks

97
00:07:28,450 --> 00:07:33,720
Home Depot target saw the installation
of two services that alone should have

98
00:07:33,720 --> 00:07:38,810
alerted them to the detection of that
kind of attack and Annie also put

99
00:07:38,810 --> 00:07:42,250
multiple sections on a machine in some
cases some machines had a completely

100
00:07:42,250 --> 00:07:47,310
different infection very small quantity
idea was it the bolt there would be

101
00:07:47,310 --> 00:07:51,390
these other variants of things elsewhere
then get back in with so you can really

102
00:07:51,390 --> 00:08:01,200
focus on one thing it was three or four
things so went into 2014 new stuff so

103
00:08:01,200 --> 00:08:06,210
what triggered it changed avoided the
methods they used before this was really

104
00:08:06,210 --> 00:08:06,920
cool

105
00:08:06,920 --> 00:08:11,900
really avoided what they'd probably cuz
they booted everybody out so fast they

106
00:08:11,900 --> 00:08:13,130
said well we can't do that again

107
00:08:13,130 --> 00:08:17,650
fortunately we were doing really really
good logging and more ninjas after all

108
00:08:17,650 --> 00:08:22,260
so we were able to detect it so it's
summer evening components here they

109
00:08:22,260 --> 00:08:26,320
utilized luck acts in regards to the
o'day the patient zero in the old days

110
00:08:26,320 --> 00:08:31,620
are using and they also had a litter of
projects around remodeler to exploit kit

111
00:08:31,620 --> 00:08:35,979
right things for it and so we saw this
kind of funny entertaining stuff that

112
00:08:35,979 --> 00:08:41,030
they would use they also had the low
injection on sequencer now that's unique

113
00:08:41,030 --> 00:08:45,340
because it's five directories deep so in
secret service start all these processes

114
00:08:45,340 --> 00:08:49,620
it loaded eventually cease caveat DLL
and then inspected the single server

115
00:08:49,620 --> 00:08:53,420
which allowed them to go in and run the
dot necromancy reason to come and chill

116
00:08:53,420 --> 00:08:57,220
and do all kinds of pwnage on the
database automatically so that in

117
00:08:57,220 --> 00:09:02,110
getting to know they had a binary
vectors so talk about that a little bit

118
00:09:02,110 --> 00:09:05,380
and a driving factor which place drivers
will talk about that as well

119
00:09:05,380 --> 00:09:08,510
the closing here as they hit not only
the scripts but the payloads in the

120
00:09:08,510 --> 00:09:14,870
Registry's a walk through some of that
and registries like you know a so

121
00:09:14,870 --> 00:09:17,570
registry when

122
00:09:17,570 --> 00:09:27,870
anywhere so 2013 much of a user is not
an admin so this is the coolest thing in

123
00:09:27,870 --> 00:09:31,990
this case the guy was not an admin we
verified that for sure and he ran a

124
00:09:31,990 --> 00:09:36,020
bunch of office at the time that we saw
over so we think they took advantage of

125
00:09:36,020 --> 00:09:41,030
10 day we did verify that some of the
office stuff had not been patched so

126
00:09:41,030 --> 00:09:47,480
fairly recent day and once that account
got compromised obviously that boxing

127
00:09:47,480 --> 00:09:51,260
compromised with the other day got admin
access they jumped immediately two

128
00:09:51,260 --> 00:09:55,970
domain controllers and use the backup
credentials backup software credentials

129
00:09:55,970 --> 00:10:01,420
do that and once they had to back at
prudential the environment pretty

130
00:10:01,420 --> 00:10:02,750
typical that they would do this

131
00:10:02,750 --> 00:10:11,170
always go two mail servers and PCs
everywhere so watch these things heavily

132
00:10:11,170 --> 00:10:16,050
specially change her skills as a great
explorer and from there they spread all

133
00:10:16,050 --> 00:10:19,750
over the place of these servers Samee no
hemos 2012 so they have a very specific

134
00:10:19,750 --> 00:10:26,270
thing they want to get a box go to a
domain controller their profiles

135
00:10:26,270 --> 00:10:31,170
dropping on gone in 60 seconds they used
when the initial droppers came in and

136
00:10:31,170 --> 00:10:35,410
they spread around the use the public
accessible directories why didn't have

137
00:10:35,410 --> 00:10:39,620
to worry about which user context they
were in these directories are available

138
00:10:39,620 --> 00:10:42,910
to everybody all the time and they also
littered different pieces and parts

139
00:10:42,910 --> 00:10:48,070
within those directors and Angelina's in
vector files like this in a second or so

140
00:10:48,070 --> 00:10:54,000
but they did leave a couple on this
again the the service a single server

141
00:10:54,000 --> 00:10:58,870
file called seascape he was there only
one single server boxes and only on some

142
00:10:58,870 --> 00:11:04,680
of them she waved at me lol the normal
sound driver found support file for

143
00:11:04,680 --> 00:11:09,260
Windows workstations but does not exist
by default Windows servers and that

144
00:11:09,260 --> 00:11:11,840
popped up a sudden these boxes that were
in fact

145
00:11:11,840 --> 00:11:17,270
they also picked on a management
software so unsure that exclude my

146
00:11:17,270 --> 00:11:23,270
management software and stuff you might
wanna rethink this case they just added

147
00:11:23,270 --> 00:11:27,400
some new files added drivers again
drivers don't log very well windows they

148
00:11:27,400 --> 00:11:30,950
know we do really the blogging so they
were trying to avoid that but we also

149
00:11:30,950 --> 00:11:34,550
had big thick so we watching these
routes using fake pics and saw these

150
00:11:34,550 --> 00:11:39,970
drunk driver files be added to directors
a secure and there were no sis file so

151
00:11:39,970 --> 00:11:45,410
again they don't show loading and in
normal prosecution so the initial

152
00:11:45,410 --> 00:11:50,710
sectors were users public lots of miners
being exploited rear seat audio CD will

153
00:11:50,710 --> 00:11:55,040
see that little bit insect she didn't
know exactly what that did until we

154
00:11:55,040 --> 00:12:01,480
finally got to go to the end and six
assists drivers got their 6400 fairly

155
00:12:01,480 --> 00:12:05,800
looking for 64 bit systems and then
again seventy percent of our journey to

156
00:12:05,800 --> 00:12:10,020
one company this file that he exceeds
and a member companies so clearly they

157
00:12:10,020 --> 00:12:17,640
were over the Civic we writing stuff and
director and binaries in their windows

158
00:12:17,640 --> 00:12:22,580
web to put my files and in the windows
temp directory to put the VBScript so

159
00:12:22,580 --> 00:12:25,880
you can see the other littering
different pieces of parts on the system

160
00:12:25,880 --> 00:12:31,490
hoping we wouldn't catch them as easily
modifying the permissions of course 61

161
00:12:31,490 --> 00:12:33,250
64 was also used

162
00:12:33,250 --> 00:12:40,540
UAB levels drop their sis while 64
tutsis in the script 07 lol porno

163
00:12:40,540 --> 00:12:48,110
tutsis drivers with the same file just
so here's an example of the C dot T

164
00:12:48,110 --> 00:12:54,180
exceed for once we actually down so we
actually saw them utilize a password

165
00:12:54,180 --> 00:12:58,420
here you can see the mine at the
password samsung pc games on the box and

166
00:12:58,420 --> 00:13:02,450
so we were able to actually then be able
to replicate what they did and talking

167
00:13:02,450 --> 00:13:05,740
out so they had in a box and transferred
power to another box and they used the

168
00:13:05,740 --> 00:13:11,100
password samsung to propagate that kinda
cool so again you superb blog record

169
00:13:11,100 --> 00:13:13,780
being used here and for once

170
00:13:13,780 --> 00:13:19,750
compromise them resistance well this is
the thing started getting this kind of

171
00:13:19,750 --> 00:13:25,760
scratching their heads so their profile
or they called a file called double X 64

172
00:13:25,760 --> 00:13:30,800
@ systems nowhere on the disc so
fortunately we look at that code 740

173
00:13:30,800 --> 00:13:35,740
found you are watching the stuff we do
pretty heavily services really don't

174
00:13:35,740 --> 00:13:39,890
change on servers you should those that
they picked on the worst CBL supports

175
00:13:39,890 --> 00:13:44,850
Windows Error Reporting support and they
basically pointed to the spot that

176
00:13:44,850 --> 00:13:45,870
didn't exist

177
00:13:45,870 --> 00:13:50,820
this is one of those right back to this
when it shuts down

178
00:13:50,820 --> 00:13:54,580
well we took a workstation and shut it
down and read the disc and it wasn't

179
00:13:54,580 --> 00:14:00,410
there were like that's not the case so
you can see on the slide here they

180
00:14:00,410 --> 00:14:03,850
modify the way it looks on the right it
looks good on the left is what they put

181
00:14:03,850 --> 00:14:07,930
in its place so fortunately in the case
of some of these we had actually capture

182
00:14:07,930 --> 00:14:15,360
before encrypted the payload the emcee
or the text of the binaries literally

183
00:14:15,360 --> 00:14:20,330
pulled out a registry rewriting the DLL
or or driver people compared to the

184
00:14:20,330 --> 00:14:26,710
other systems and hashes but you can see
there being cryptic error so who was not

185
00:14:26,710 --> 00:14:27,490
on disk

186
00:14:27,490 --> 00:14:29,240
well the persistence

187
00:14:29,240 --> 00:14:33,920
wear seat belts grave marker software a
cpl support service failed to start so

188
00:14:33,920 --> 00:14:37,750
yeah one of service failed to start
because it's not there

189
00:14:37,750 --> 00:14:42,470
Thank You microsoftr looping over and
over and over and over again so this

190
00:14:42,470 --> 00:14:46,899
thing that this thing just kept starting
in stark stark files in there so we did

191
00:14:46,899 --> 00:14:54,580
see that some points and watch them try
to figure it out so ended up happening

192
00:14:54,580 --> 00:14:59,870
was in the course of looking at the logs
this is your first hinted his command

193
00:14:59,870 --> 00:15:04,270
line logging is real power these you can
see where we got some of the data from

194
00:15:04,270 --> 00:15:09,270
so you can see them executing this case
pushing up a 64 that DLL you see here

195
00:15:09,270 --> 00:15:14,620
big long list of scripts this is what
actually was in the registry and then

196
00:15:14,620 --> 00:15:18,980
right here is what pointed us to the
location the stuff occurs this is the

197
00:15:18,980 --> 00:15:26,910
first big tit and appointed us to the
software classes so I logging was

198
00:15:26,910 --> 00:15:31,029
crucial in this attack in regards to
detecting it I would say we would have

199
00:15:31,029 --> 00:15:35,420
had a helluva time detecting this attack
without remembering logging because they

200
00:15:35,420 --> 00:15:39,010
went over and our radar with all the
stuff we are learning the command line

201
00:15:39,010 --> 00:15:43,040
stuff all the details we needed pointed
us to the register key and wanted us to

202
00:15:43,040 --> 00:15:48,240
service appointed US two locations and I
we decide to put the puzzle together now

203
00:15:48,240 --> 00:15:54,260
as a last year until February 2012
February of this year is only available

204
00:15:54,260 --> 00:16:01,620
when does a 2012 or to February this
rotating that Microsoft had they pulled

205
00:16:01,620 --> 00:16:06,920
echoed from 801 along with a couple
other service paxon and pieces in the

206
00:16:06,920 --> 00:16:10,899
enabled command-line logging in 2007 and
2008 server so I can do it all across

207
00:16:10,899 --> 00:16:19,670
the world so very cool and you do need
applied to reach 8343 75 to do that and

208
00:16:19,670 --> 00:16:23,360
so we had seen them execute all these
commands right so bottom line cease

209
00:16:23,360 --> 00:16:27,279
script command these tackles net
take-home pushed you trip

210
00:16:27,279 --> 00:16:31,680
this is not normal administrator
behavior all at once and not on 20 30 50

211
00:16:31,680 --> 00:16:36,259
machines and so you can see here things
are called again pointing to the

212
00:16:36,259 --> 00:16:40,420
registry at the pushing stuff for years
the starting of the service or stopping

213
00:16:40,420 --> 00:16:42,310
the service and again

214
00:16:42,310 --> 00:16:47,930
launching see script to do some stuff
pushed the next that you see software

215
00:16:47,930 --> 00:16:52,139
Alliance and so we went looking in and
take on so they're taking ownership is a

216
00:16:52,139 --> 00:16:58,050
really fine these things and again
pointed us to the registry and here's

217
00:16:58,050 --> 00:17:02,629
where the payload was again look at the
bottom and this is the in this case it's

218
00:17:02,629 --> 00:17:07,740
hex so this is the encrypted stuff they
called a text this is encrypted payload

219
00:17:07,740 --> 00:17:11,870
so we had no way of knowing well what is
this so fortunately there were three

220
00:17:11,870 --> 00:17:17,179
cases this Palin got dropped initially
as a Nazi in the registry so literally

221
00:17:17,179 --> 00:17:22,179
started with him see the code and then
they don't get over to hex 45 a and then

222
00:17:22,179 --> 00:17:26,140
encrypted it's so different states of
the box being infected left these keys

223
00:17:26,140 --> 00:17:30,659
in various states and we replicated in
the lab we meet at least architects

224
00:17:30,659 --> 00:17:34,210
which gives an idea what to look forward
to looking to receive 45 a that can

225
00:17:34,210 --> 00:17:37,690
happen too often and we just kept
playing kept playing and when we saw

226
00:17:37,690 --> 00:17:46,200
going cryptic parts so get a texan some
cases you can see here

227
00:17:46,200 --> 00:17:52,110
binary rate they're going to find areas
and when completed was encrypted other

228
00:17:52,110 --> 00:17:57,789
net sometimes it still wouldn't have
enough to figure out how did it so this

229
00:17:57,789 --> 00:18:00,330
was new for 2013 we never seen him do
this before

230
00:18:00,330 --> 00:18:04,260
talk about how to detect this condition
here in a second they added three values

231
00:18:04,260 --> 00:18:08,510
to the keys again the classes or
client's key they also used another key

232
00:18:08,510 --> 00:18:13,940
called binary with an acrobat the only
dis is one of their only did three

233
00:18:13,940 --> 00:18:18,520
places kinda back door but same drivers
same information that just kind of put

234
00:18:18,520 --> 00:18:24,110
it somewhere totally different look for
israelis and it put these three keys

235
00:18:24,110 --> 00:18:27,779
input file file and read

236
00:18:27,779 --> 00:18:33,950
so but then again not much used to us
because you can't read it right so we've

237
00:18:33,950 --> 00:18:36,869
really had to kind of reverse this
figure out what they didn't get the

238
00:18:36,869 --> 00:18:41,409
actor wasn't clear what we ended up
doing sitting here see here in the lab

239
00:18:41,409 --> 00:18:45,340
an hour we try to check the box in the
labs and you can see here tonight X 45

240
00:18:45,340 --> 00:18:52,989
so definitely something to focus on and
after they got it all working when they

241
00:18:52,989 --> 00:18:57,469
want let's go back to inspector da da
see what it do we started playing with

242
00:18:57,469 --> 00:19:01,509
these executables capture show you how
to capture those on second thought they

243
00:19:01,509 --> 00:19:06,789
had one for the Delos and then one for
the drivers they alter how they did this

244
00:19:06,789 --> 00:19:11,599
is the altered our management software
so whether they used caves we never got

245
00:19:11,599 --> 00:19:15,249
around I had left the company never got
around to it whether these tapes to to

246
00:19:15,249 --> 00:19:19,859
do that or they put some jump roads in
there the funny part was our soccer

247
00:19:19,859 --> 00:19:24,950
still work perfectly well that's really
was crazy so our best client stuff works

248
00:19:24,950 --> 00:19:28,239
fine McAfee was still working fine we
don't have any errors or bloating or

249
00:19:28,239 --> 00:19:33,929
watching changes but has to change in
search of a break and you can compare

250
00:19:33,929 --> 00:19:38,669
the strengths of both trials and clearly
see that will alter so few other

251
00:19:38,669 --> 00:19:43,129
binaries and failed it was custom code
probably why it failed the typical

252
00:19:43,129 --> 00:19:48,669
standards and then we tried on several
files were able to infect those as well

253
00:19:48,669 --> 00:19:52,139
as some factors kind of a pain in the
butt so we can affect pretty much any

254
00:19:52,139 --> 00:19:55,130
executable you haven't

255
00:19:55,130 --> 00:20:01,250
sold again back to the persistence right
so now we have this this in fact topics

256
00:20:01,250 --> 00:20:01,670
E

257
00:20:01,670 --> 00:20:05,010
and we were able to see where everything
went we had to basically put the puzzle

258
00:20:05,010 --> 00:20:09,390
pieces together and so again back to
that file that didn't exist in Program

259
00:20:09,390 --> 00:20:14,690
Files common files so now we know how it
God ok we know the inspector alter

260
00:20:14,690 --> 00:20:19,370
McAfee your best for all terrorists or
whatever and somehow in the process of

261
00:20:19,370 --> 00:20:24,850
that starting right now but as soon as
soon as it loaded it disappeared so we

262
00:20:24,850 --> 00:20:29,360
got to see a load just had to run long
enough to get to get the box and click

263
00:20:29,360 --> 00:20:33,980
but again we're better now so I'll let
us there

264
00:20:33,980 --> 00:20:38,350
well first we did our discovery baseline
so this is my concept of taking a good

265
00:20:38,350 --> 00:20:42,120
ashes and comparing them to a suspect
machines we have a couple of big files a

266
00:20:42,120 --> 00:20:45,810
typical or Windows environments so it's
pretty easy pretty quick to be able to

267
00:20:45,810 --> 00:20:50,810
run these through some of the box and
some servers and compare those to the

268
00:20:50,810 --> 00:20:55,760
suspects and use our master master
repository or Big Bash database of good

269
00:20:55,760 --> 00:21:02,090
stuff and it showed us some single files
and directories mainly McAfee kiryas big

270
00:21:02,090 --> 00:21:07,870
six right one altar cash only like 20
serves we didn't update any agents are

271
00:21:07,870 --> 00:21:11,180
pretty sure that's something we should
look at and that's kind of how we got to

272
00:21:11,180 --> 00:21:18,620
looking at those files those we had big
dicks has to spy on this location and

273
00:21:18,620 --> 00:21:23,520
sort it we able to find that these these
alter XQ binaries had only been on the

274
00:21:23,520 --> 00:21:28,250
boxes of these other behaviors we could
see so now we knew that binary out

275
00:21:28,250 --> 00:21:50,420
something actually writing 264 driver so
now we actually could see the right to

276
00:21:50,420 --> 00:21:56,180
do so now we knew the missing knew how
the hell they got on this so we recreate

277
00:21:56,180 --> 00:21:59,500
in the lab we knew we had everything and
actively looked just like we saw in the

278
00:21:59,500 --> 00:22:04,350
environment and we had high confidence
remediation right you do not clean your

279
00:22:04,350 --> 00:22:07,360
boxes until you know you have every
component is if you miss something

280
00:22:07,360 --> 00:22:10,490
they're going to alter their behavior
and immediately know you was something

281
00:22:10,490 --> 00:22:16,120
else and by the way is to take us 210
days meantime to infections happens

282
00:22:16,120 --> 00:22:20,590
happened in Thanksgiving last year we
had a clean up my Christmas so we're

283
00:22:20,590 --> 00:22:25,450
ahead of the normal days for sure so
finally our management allowed us to set

284
00:22:25,450 --> 00:22:29,550
up alerts and artifacts from our
analysis of you read for example perfect

285
00:22:29,550 --> 00:22:34,380
example of Home Depot dread target
eyesight partnership or and look for

286
00:22:34,380 --> 00:22:38,330
those artifacts their system they would
not have been breached because it would

287
00:22:38,330 --> 00:22:43,540
seem the new services were component of
the black POS software in theory could

288
00:22:43,540 --> 00:22:47,480
have alerted on course our own
experience in dealing with these guys

289
00:22:47,480 --> 00:22:52,470
for 13 years and our discovery with the
hash comparisons allowed us to find it

290
00:22:52,470 --> 00:22:55,770
the nuances of not doing the entire box
of cherry picking some of the infected

291
00:22:55,770 --> 00:23:00,710
wounds and trying to find some variances
really really well and I'm our analysis

292
00:23:00,710 --> 00:23:05,520
of course give us the details we needed
so how can you guys detect this is a

293
00:23:05,520 --> 00:23:10,620
learning session so use the ninja ninja
to be harvested them our kind of silly

294
00:23:10,620 --> 00:23:15,980
really but again some some of us as long
as in fact that stuff it literally did

295
00:23:15,980 --> 00:23:19,380
not complete and so all you have to do
is look at basically Process Monitor

296
00:23:19,380 --> 00:23:24,590
automated script to dump that those
processes and find those Hong Kong

297
00:23:24,590 --> 00:23:28,480
systems by the command line showed us
the name and executables are using so we

298
00:23:28,480 --> 00:23:32,690
had to do see if any of those are
running in the environment and logging

299
00:23:32,690 --> 00:23:38,230
as well just to those executable by the
way the executables day used to have a

300
00:23:38,230 --> 00:23:39,530
lot with power

301
00:23:39,530 --> 00:23:44,280
do scans for parentless finery meaning
the pilots windward and leeward has

302
00:23:44,280 --> 00:23:48,450
executable and it's bad BB strip right
after this and you close window where

303
00:23:48,450 --> 00:23:54,350
this thing does not have apparently be
better yet BC host commonly used in

304
00:23:54,350 --> 00:23:59,550
power has to be loaded by services
Process Monitor Process Explorer and UC

305
00:23:59,550 --> 00:24:03,100
services that exceed below that in the
chain of the tree is gonna be serviced

306
00:24:03,100 --> 00:24:07,410
so if it's outside that yeah it's bad
it's not talking about look to see what

307
00:24:07,410 --> 00:24:13,680
the parent process for these binaries
almost 95% or more the cases these

308
00:24:13,680 --> 00:24:17,880
things must have a normal logical parent
except the stuff that we all right

309
00:24:17,880 --> 00:24:25,080
because we generally because of the
command-line logging we wrote the script

310
00:24:25,080 --> 00:24:29,870
really complicated script here is we did
a robocopy to basically create a

311
00:24:29,870 --> 00:24:36,960
directory called it captured I changed
is that senator and we robocopy to and

312
00:24:36,960 --> 00:24:41,260
when the box get affected everything
they did in these directories and we got

313
00:24:41,260 --> 00:24:44,340
copies of the binaries so we started
putting that running on all the servers

314
00:24:44,340 --> 00:24:49,210
across the environment try to catch all
the locations of existing servers as

315
00:24:49,210 --> 00:24:55,530
they were going at it while we were
going out complicated and this is great

316
00:24:55,530 --> 00:24:59,710
for doing in your laboratory inspecting
an elaborate second the user have to

317
00:24:59,710 --> 00:25:03,060
space in 10 harvest the funkiness that
happens with malware doing all that

318
00:25:03,060 --> 00:25:06,500
highly recommend you run loop through
local data local epidemiology alone

319
00:25:06,500 --> 00:25:10,610
after only two catch all kinds it to
design artifacts that normally get

320
00:25:10,610 --> 00:25:16,600
dropped executed deleted so here's your
top priority this is your take away to

321
00:25:16,600 --> 00:25:20,830
go back to work so how do I start doing
this so so I can catch the stuff Mike

322
00:25:20,830 --> 00:25:25,760
sketching well there's the KB 347 get
the URL in there again

323
00:25:25,760 --> 00:25:31,260
SlideShare so don't worry about how
these ten items advanced auto policies

324
00:25:31,260 --> 00:25:33,760
yes use the Windows logging chichi

325
00:25:33,760 --> 00:25:39,520
longer people here sponsors yes go get
the windows spotlighting chichi

326
00:25:39,520 --> 00:25:41,670
incorporate the two and you're going to
win

327
00:25:41,670 --> 00:25:46,800
yes 4688 are the new process creations
are noisy but you can filter out at

328
00:25:46,800 --> 00:25:51,050
least collect them locally so you can
use some sort of script new tool

329
00:25:51,050 --> 00:25:54,920
intended to actually pull this
information out if you're not many

330
00:25:54,920 --> 00:26:02,620
people here have anything that's not
even half the room like a third of the

331
00:26:02,620 --> 00:26:09,000
room maybe so you really don't like the
latter part of the process creation

332
00:26:09,000 --> 00:26:13,200
login you want to see the brute forcing
stuff so yes you look for successes

333
00:26:13,200 --> 00:26:18,460
failures the new yorker EDS shares so
when they're hopping over you want to

334
00:26:18,460 --> 00:26:22,920
monitor your shares so you can see them
connecting to you definitely want to

335
00:26:22,920 --> 00:26:29,240
start turning on some of our registry
auditing and phylogeny and registry

336
00:26:29,240 --> 00:26:33,970
editing an obvious keys so once he saw
them do this in turn on restricting

337
00:26:33,970 --> 00:26:38,590
across all the classes keys and and and
clients keys to see if they created some

338
00:26:38,590 --> 00:26:44,320
new keys and then of course you can use
this enterprise you don't want to the

339
00:26:44,320 --> 00:26:49,040
winds are well put it in the any any
mode just don't set it in the brutal you

340
00:26:49,040 --> 00:26:53,490
and disabled it out of there put it in
another way you said it to the any any

341
00:26:53,490 --> 00:26:54,800
or off mode

342
00:26:54,800 --> 00:26:58,250
another overused turns it on and even if
you're investigating a machine dragged

343
00:26:58,250 --> 00:27:04,220
their turned on highly recommend this
gives you the process name and then they

344
00:27:04,220 --> 00:27:10,470
went to so my workout exe went 21 2012
really powerful and of course services

345
00:27:10,470 --> 00:27:14,610
not only new installs services like it s
tough but also the change existing

346
00:27:14,610 --> 00:27:18,430
service and an hour show logging
definitely can't say enough about this

347
00:27:18,430 --> 00:27:21,640
but you're gonna have to credit default
profile and set your execution policy to

348
00:27:21,640 --> 00:27:25,960
restricted so that if they do execute
PowerShell commands on you which I see a

349
00:27:25,960 --> 00:27:32,650
lot and you can be able to do an
execution policy bypass which again is

350
00:27:32,650 --> 00:27:36,120
an indication that's what they're trying
to do and that makes a great spot

351
00:27:36,120 --> 00:27:41,330
and is it isn't she so here's a typical
example member those commands I showed

352
00:27:41,330 --> 00:27:44,800
the very beginning of all the things
they executed so you build one of these

353
00:27:44,800 --> 00:27:49,720
this is the Splunk alert right here and
you put all the different things that

354
00:27:49,720 --> 00:27:53,550
many cats and that's that I just keep
adding to this thing as I read our

355
00:27:53,550 --> 00:27:54,650
report

356
00:27:54,650 --> 00:27:59,420
misrepresent here and all the things the
executor de beers and watch for this to

357
00:27:59,420 --> 00:28:04,590
generate a greater than to buy an animal
gonna use on a box and do paying or

358
00:28:04,590 --> 00:28:08,210
something and I sometimes get to
commands the hackers will generate at

359
00:28:08,210 --> 00:28:14,370
least 10 sometimes they looked at times
so this thing will go off like I could

360
00:28:14,370 --> 00:28:23,010
trigger something bad this is like the
best color ever or whatever size doesn't

361
00:28:23,010 --> 00:28:25,980
matter this is the tricky part that
allowed us to really know where in the

362
00:28:25,980 --> 00:28:31,210
registry fortunately the registry
database has mostly keys under 20 K so

363
00:28:31,210 --> 00:28:34,990
your ninja tip here is in this case
written your software tools already

364
00:28:34,990 --> 00:28:39,380
scanner this is where we started and I'm
able to look for keys of a certain size

365
00:28:39,380 --> 00:28:44,560
so I knew how big the deal over driver
was already harvested some like the

366
00:28:44,560 --> 00:28:50,060
registries for scanning service for keys
are bigger than yours like so even a

367
00:28:50,060 --> 00:28:53,370
broken up their mauer is bigger than 20
K

368
00:28:53,370 --> 00:28:58,180
you have to bring your mouth and risk it
getting corrupted but this is a great

369
00:28:58,180 --> 00:29:04,150
way to check for this kind of attack but
looking for sizet registry David

370
00:29:04,150 --> 00:29:07,360
longnecker in Austin we had done some
tweeting and texting I know he writes

371
00:29:07,360 --> 00:29:12,160
register python script texaco outlook
for the size of a registry keys and

372
00:29:12,160 --> 00:29:15,320
watching our archaeology logged SMD dot
com

373
00:29:15,320 --> 00:29:20,890
or maybe more on that future enhance
logging this is a great tip for incident

374
00:29:20,890 --> 00:29:25,860
responders are working in a lab i turn
on system on any time a funky box but I

375
00:29:25,860 --> 00:29:30,290
have to give a huge shoutout to Jason
record added to route 82 people here

376
00:29:30,290 --> 00:29:35,390
early Windows logging service so this is
highly recommend if you're looking for

377
00:29:35,390 --> 00:29:39,240
an alternative blocking agent whether it
sends it to syslog so you don't have to

378
00:29:39,240 --> 00:29:44,360
happen to log management years but
Suffolk Alexis definitely take a look at

379
00:29:44,360 --> 00:29:48,420
that but since moms assistant girls to
all the cool thing about this mine has

380
00:29:48,420 --> 00:29:52,730
it'll tell you from experience used to
win where example

381
00:29:52,730 --> 00:29:58,120
exceed drops an executable and in the
process of the eventid 7 believe it is

382
00:29:58,120 --> 00:30:02,480
you'll see that executable being called
and then the fact that it's not signed

383
00:30:02,480 --> 00:30:07,340
and so give you that kind of look it
also shows human driver's load that's

384
00:30:07,340 --> 00:30:11,770
nothing gives you can actually catch the
bus drivers

385
00:30:11,770 --> 00:30:16,210
discovery room for once I labeled a
system suspect take model batch files

386
00:30:16,210 --> 00:30:21,090
show 164 and run that against the box
and get a fairly short list of files to

387
00:30:21,090 --> 00:30:26,840
to look at what files will show up so we
know how many people here don't have a

388
00:30:26,840 --> 00:30:27,970
sim so what

389
00:30:27,970 --> 00:30:40,420
well set out to solve the problem and
would like to share that to you today so

390
00:30:40,420 --> 00:30:44,930
we're introducing a new tool called log
on D Street for everybody here it is

391
00:30:44,930 --> 00:30:45,470
posted

392
00:30:45,470 --> 00:30:49,180
officially today so you guys go download
this initially I was trying to solve a

393
00:30:49,180 --> 00:30:49,820
problem

394
00:30:49,820 --> 00:30:54,480
a pic more quickly analyzing power in a
lab so I was taking a lot of these data

395
00:30:54,480 --> 00:30:59,360
collected to win and stuff and I do a
lot more but you know where fishing and

396
00:30:59,360 --> 00:31:06,220
whatnot and I need to know the facts the
Yankees and the location filename these

397
00:31:06,220 --> 00:31:10,030
effects are important to me as a
defender that I can put into my slowing

398
00:31:10,030 --> 00:31:13,930
my other security tools so we can search
the entire environment for who has this

399
00:31:13,930 --> 00:31:14,870
condition

400
00:31:14,870 --> 00:31:20,010
than for example email I can search
extent by subject I can take that

401
00:31:20,010 --> 00:31:24,340
medicare covers that easy sometimes I
can exploded in the lab

402
00:31:24,340 --> 00:31:30,120
log indie artists tax going to put stuff
in there and BAM I know not only receive

403
00:31:30,120 --> 00:31:37,020
the email and send them an email message
through PowerShell scripts I T guys but

404
00:31:37,020 --> 00:31:40,540
I also have the IP's and I know exactly
who opened the stupid thing and you

405
00:31:40,540 --> 00:31:44,510
actually get their boxes remediate it
and I have the data to give to help the

406
00:31:44,510 --> 00:31:50,390
skies so it's great for investigating a
suspect system for the lawsuit the box

407
00:31:50,390 --> 00:31:55,870
and see what comes up in San responders
I can totally see this have been

408
00:31:55,870 --> 00:31:59,470
referred to a couple our gigs where do
the 20 questions of the people I don't

409
00:31:59,470 --> 00:32:02,880
know I don't know I don't know how that
turned on so I now have something I can

410
00:32:02,880 --> 00:32:08,660
email these guys and say to me they were
run this and it is referenced in regards

411
00:32:08,660 --> 00:32:11,640
to what it looks as compared to the
Center for an IT security we have a nice

412
00:32:11,640 --> 00:32:16,050
art report that you can actually print
out a copy of your report and now you

413
00:32:16,050 --> 00:32:19,559
have guidance and what to tell the
client we should turn on a Y and it also

414
00:32:19,559 --> 00:32:24,160
compares to the windows login she cheat
a little bit farther in CIS so I highly

415
00:32:24,160 --> 00:32:28,850
recommend you take a look at and also
assist you in the tweaking the file and

416
00:32:28,850 --> 00:32:32,980
registry that's really cool so you start
turning the stuff on your plate with you

417
00:32:32,980 --> 00:32:34,900
see some noisy keys or what not

418
00:32:34,900 --> 00:32:38,700
for example if you were to go away
Services Director you'll find TCP is

419
00:32:38,700 --> 00:32:42,400
lighting up her walks like crazy to turn
it off there and you can use walk indeed

420
00:32:42,400 --> 00:32:49,540
and we call the log missus discovery
tool log dash indeed.com URL and when

421
00:32:49,540 --> 00:32:54,100
you run the tool it will sail and tell
you configure everything here so that's

422
00:32:54,100 --> 00:32:59,230
the cool thing we are helping to push
you or guide you may be pushing it to

423
00:32:59,230 --> 00:33:00,809
actually enable to stop

424
00:33:00,809 --> 00:33:06,480
guys even if you're doing it and doing
it locally information make sure you

425
00:33:06,480 --> 00:33:09,289
want to be in effect security about a
week to you probably need to make a

426
00:33:09,289 --> 00:33:17,360
security log but when the money runs it
will drop a report CST really consumed

427
00:33:17,360 --> 00:33:22,639
used Excel filtering option we condemn
this after the talks and the couch couch

428
00:33:22,639 --> 00:33:27,350
hawk on and show you how this works with
the laptop some hours also you how that

429
00:33:27,350 --> 00:33:33,080
works and it's real straight 4-8 help
logging daemon to see we'll tell you all

430
00:33:33,080 --> 00:33:40,129
the configurations and any review it in
the the output so again really cool we

431
00:33:40,129 --> 00:33:43,730
also be three white lists as you're
doing this in a box so take a look at

432
00:33:43,730 --> 00:33:48,730
our lab for example and this is really
working in handy when I really wish I

433
00:33:48,730 --> 00:33:52,850
had this when I was doing the winning GI
work because once I started excuse stuff

434
00:33:52,850 --> 00:33:57,549
will change and be able to run this tool
that's big advantage here is we have

435
00:33:57,549 --> 00:34:01,429
three wireless ok I know I have that
India driver I don't wanna know that

436
00:34:01,429 --> 00:34:07,019
because I'm looking online I can get
very granular a whitelist very very cool

437
00:34:07,019 --> 00:34:14,399
site address destination IP destination
port no source IP why they're all over

438
00:34:14,399 --> 00:34:19,690
the place to buy that most part and we
also like to do file and registry

439
00:34:19,690 --> 00:34:23,399
editing locations and throw those out no
I don't need to see that directory all

440
00:34:23,399 --> 00:34:27,599
upset about later the cool thing about
that white list is it will become what

441
00:34:27,599 --> 00:34:30,270
you'll tweak your own policies on the
box

442
00:34:30,270 --> 00:34:34,060
registry port that's really good way to
help filter that stuff out and then

443
00:34:34,060 --> 00:34:39,470
generates the report so here's an
example of boxes already infected and I

444
00:34:39,470 --> 00:34:43,230
kind of want to see what it did a reboot
the lawyers argued the box in Ranelagh

445
00:34:43,230 --> 00:34:48,089
indeed the ones you see the bottom taxa
bloom up and you can see that when the

446
00:34:48,089 --> 00:34:50,130
script ovett heard it

447
00:34:50,130 --> 00:34:57,790
read the original executable VZW I X ke
Dadi exceed and dropped a new one VZW

448
00:34:57,790 --> 00:35:04,000
per yard and then went ahead and deleted
original

449
00:35:04,000 --> 00:35:09,590
piped out the term and interest and also
you can see the data capture McMahon

450
00:35:09,590 --> 00:35:14,800
Line by the way and then you also saw
that executed vs admin delete shadows

451
00:35:14,800 --> 00:35:18,840
which means yeah you're not getting in
shower copy back of some of this thing

452
00:35:18,840 --> 00:35:20,700
so I knew this point

453
00:35:20,700 --> 00:35:30,090
image 15 minutes but missus word doc so
this is the example i gave so again I

454
00:35:30,090 --> 00:35:34,360
executed the word doc I wanna see what
it does I can see that these batch files

455
00:35:34,360 --> 00:35:38,370
on BBS files they try to get clever here
because in the batch file these

456
00:35:38,370 --> 00:35:43,560
variables for B&B then fumbled it on the
command line which is why you see all

457
00:35:43,560 --> 00:35:50,510
those funny quotes like why because of
my search for WPS McMahon so that's

458
00:35:50,510 --> 00:35:56,010
that's the only obfuscation they were
doing this you can see here the paint

459
00:35:56,010 --> 00:36:00,600
china network connection or you
valuating me laugh and then go ahead and

460
00:36:00,600 --> 00:36:04,000
execute the payloads here's where the
directories were inexcusable that were

461
00:36:04,000 --> 00:36:09,590
done a load again so I still have
network connectivity yes and again be

462
00:36:09,590 --> 00:36:10,510
continued

463
00:36:10,510 --> 00:36:16,090
Windows logs so this is a great example
now here's all the executable that

464
00:36:16,090 --> 00:36:21,330
launched when word immediately went out
to this suspect I P and see strippers

465
00:36:21,330 --> 00:36:26,130
executing going out to the suspect AP
thinking China and the IP social with

466
00:36:26,130 --> 00:36:31,520
those executables that ran and what a
piece they went as well so now I have

467
00:36:31,520 --> 00:36:36,450
the data very quickly in regards to what
I had to do so I found out very quickly

468
00:36:36,450 --> 00:36:40,350
what process is executed where'd
excluded from AP used to enter into a

469
00:36:40,350 --> 00:36:42,540
log management to see who else

470
00:36:42,540 --> 00:36:47,330
where the details I need for remediation
and the details improve Mac defense and

471
00:36:47,330 --> 00:36:56,700
I did this in any idea I wish 15 minutes
that's how fast this can work for you

472
00:36:56,700 --> 00:37:02,260
granted the tools I can do it better
than anybody right now Bryant but that's

473
00:37:02,260 --> 00:37:07,290
significant improvement in evaluating
some typical commodity Mauer I would

474
00:37:07,290 --> 00:37:11,330
really love to have this is seen this
activity returned registry auditing and

475
00:37:11,330 --> 00:37:17,130
followed over the lab and I didn't enjoy
so I would get a lot of details so in

476
00:37:17,130 --> 00:37:22,310
summary our is noisy we can detect it
even this advanced attack completely

477
00:37:22,310 --> 00:37:28,530
changing their aspect what they did in
2012 to a new method for 2014 sure lots

478
00:37:28,530 --> 00:37:32,470
sold all types of information under
estimating laws i play with a lot of

479
00:37:32,470 --> 00:37:36,050
power tools i play with tons of them I'm
here to tell you

480
00:37:36,050 --> 00:37:40,410
logging is the number-one tool for me
absolutely by far hands down nothing

481
00:37:40,410 --> 00:37:45,580
seemed close to six number two and then
we can talk about security has become

482
00:37:45,580 --> 00:37:52,010
crucial for HP for eight years I've seen
a lot of stuff people you gotta start

483
00:37:52,010 --> 00:37:55,330
doing this we are going to get better
and industry for the stop doing this

484
00:37:55,330 --> 00:37:59,180
even if you click the locally and again
get the windows looking she cheated

485
00:37:59,180 --> 00:38:02,750
talks about turns on and everything you
need to do is login to start playing

486
00:38:02,750 --> 00:38:10,690
with it right and i cant come downstairs
will gladly demolition and again here's

487
00:38:10,690 --> 00:38:15,210
the resources to archaeologists my web
sites where we have a bunch of the

488
00:38:15,210 --> 00:38:19,350
windows logging she cheats and various
stuff do keep it very long list of them

489
00:38:19,350 --> 00:38:23,740
our analysis reports so you can actually
start doing power management on your own

490
00:38:23,740 --> 00:38:27,290
and go to these look at the reports and
start getting artifacts for your

491
00:38:27,290 --> 00:38:35,300
environment and again you can find a
better moment in hurricane you find a

492
00:38:35,300 --> 00:39:24,250
location so let's take some questions
and four outs and got some time but no

493
00:39:24,250 --> 00:39:29,360
question is the answer is No

494
00:39:29,360 --> 00:39:33,950
only a handful of keys in the registry
that are all are to me they're almost

495
00:39:33,950 --> 00:39:38,800
all under 20 K there's a few other doing
the icons and things towards a kind of

496
00:39:38,800 --> 00:39:45,280
data but as far as binaries absolutely
nothing like that normal yes definitely

497
00:39:45,280 --> 00:40:05,350
look for everything see all 4 430 of
course when the box as you could see

498
00:40:05,350 --> 00:40:11,150
that over 50 Samsung passwords used so
they used heavily use it w my attacks in

499
00:40:11,150 --> 00:40:15,600
regards to executing stop remotely is no
longer W my but we saw all the behavior

500
00:40:15,600 --> 00:40:19,130
around that so we were able to see what
they did is they got on and off the box

501
00:40:19,130 --> 00:40:25,040
we do know w by five within the
environment but then pretty much all 43

502
00:40:25,040 --> 00:40:29,680
after that question and use the
Microsoft by the way so they didn't

503
00:40:29,680 --> 00:40:30,470
bother you

504
00:40:30,470 --> 00:40:51,710
openbox anybody else questions here oh
so people are dumb and then click on the

505
00:40:51,710 --> 00:40:56,290
user was of no help it was really calm
following user so what exactly happened

506
00:40:56,290 --> 00:41:00,420
on that box we don't know immediately we
know that everything started their real

507
00:41:00,420 --> 00:41:04,590
obvious in regards to the connections
going to the box but what exactly he did

508
00:41:04,590 --> 00:41:08,200
he would not tell us anything of any
value so we really don't know other than

509
00:41:08,200 --> 00:41:34,830
it started there and it was a desktop or
laptop oh that is a great question so

510
00:41:34,830 --> 00:41:37,109
you notice I didn't mention that at all

511
00:41:37,109 --> 00:41:41,220
mention anything about what sites they
used in fact environment with the

512
00:41:41,220 --> 00:41:46,089
Chinese actors liquidity generally we
use USPS websites and they use nothing

513
00:41:46,089 --> 00:41:50,119
blacklist well actually jumped from
server hosting company chief Persia

514
00:41:50,119 --> 00:41:55,180
company ab&c jump from there so in 2012
when they were using an Asian PAC server

515
00:41:55,180 --> 00:41:59,450
we just gotta face the fact that morphed
and start using OpenDNS and we cut that

516
00:41:59,450 --> 00:42:03,830
off and then they morph to use Google
DNS cut that off and then they moved to

517
00:42:03,830 --> 00:42:08,510
code.google.com where they used a string
on the codepage to actually talk to it

518
00:42:08,510 --> 00:42:11,900
and change the direction we're going and
so they told him away from that this

519
00:42:11,900 --> 00:42:14,970
time they're like well clearly they know
we're coming from foreign countries so

520
00:42:14,970 --> 00:42:18,900
we'll just use your servers and they
came from USA servers that are used in

521
00:42:18,900 --> 00:42:22,930
the gaming environment so we could just
say one block all these they were used

522
00:42:22,930 --> 00:42:24,260
for VPN services

523
00:42:24,260 --> 00:42:28,150
all they're doing is buying this host
servers and rotating between IP is very

524
00:42:28,150 --> 00:42:32,520
quickly so block blacklisting that is
almost forget about it they questioned

525
00:42:32,520 --> 00:42:57,530
like we do

526
00:42:57,530 --> 00:43:02,620
and 2012 case we saw very dumb sloppy
behavior was a very good behavior one of

527
00:43:02,620 --> 00:43:05,880
which is clear the law so they stopped
doing that because it's such an easy to

528
00:43:05,880 --> 00:43:11,400
overlook but surprisingly no doubt
whether they will in the future because

529
00:43:11,400 --> 00:43:17,390
now we're talking about 30 days of early
and so will they start doing that

530
00:43:17,390 --> 00:43:22,600
possibly I know he's working on stuff
thanks

531
00:43:22,600 --> 00:43:27,370
some of that in his talk today where he
can avoid that you can with our show as

532
00:43:27,370 --> 00:43:30,930
well as dotnet commands completely
bypassed running to the law so they'll

533
00:43:30,930 --> 00:43:34,650
start moving to that aspect but they
will execute things on disk and that

534
00:43:34,650 --> 00:44:02,290
that you really can't hide so we'll see
I mean there obviously is so easy you

535
00:44:02,290 --> 00:44:05,160
can do windows forwarding I would
recommend if you don't have anything due

536
00:44:05,160 --> 00:44:09,040
into scoring at least now you have one
box that has everything and you can use

537
00:44:09,040 --> 00:44:12,150
scripts for all that matters right you
can use cloud solutions like longer

538
00:44:12,150 --> 00:44:16,110
whatnot but for the most part in getting
a big enough so they collect

539
00:44:16,110 --> 00:44:21,360
and then you can run scripts automated
scripts or in theory you login d dropped

540
00:44:21,360 --> 00:44:25,140
to a scheduled job man let's do this

541
00:44:25,140 --> 00:44:29,690
scheduled jobs report and basically a
write up with the date and time of

542
00:44:29,690 --> 00:44:33,340
machine send it off somewhere and you
can run this thing every day in theory

543
00:44:33,340 --> 00:44:39,290
right doesn't take depends how much data
you do like everyday very clearly what

544
00:44:39,290 --> 00:44:42,800
would be the enterprise solution or some
sort of our site or something you really

545
00:44:42,800 --> 00:44:46,640
do this as far as getting it on

546
00:44:46,640 --> 00:45:09,720
yes yes oh well China with the chances
of us really do you think so the

547
00:45:09,720 --> 00:45:12,610
question here was doesn't really
frustrate you that we do all this work

548
00:45:12,610 --> 00:45:14,950
that release what happens next

549
00:45:14,950 --> 00:45:20,150
so again this year this particular 2014
stuff we gave the box to inquire firm

550
00:45:20,150 --> 00:45:23,850
hoping to get that kind of report that
came back and said nothing was on it was

551
00:45:23,850 --> 00:45:30,470
all that stuff so we give all the
explicit details to the bureau and work

552
00:45:30,470 --> 00:45:34,400
with them I do know that this data that
we provided them being we're so far

553
00:45:34,400 --> 00:45:38,280
ahead but last time this time they went
out of their way to declassify very

554
00:45:38,280 --> 00:45:41,470
quickly I think within three months they
were giving it to other gaming companies

555
00:45:41,470 --> 00:45:44,980
reporting them what we had seen and
we're looking to find it so from that

556
00:45:44,980 --> 00:45:48,430
perspective that's really up to them I'm
not going to get a ball that if I need

557
00:45:48,430 --> 00:45:52,620
to do a full receiving power and stuff
and I really need to do it all of them

558
00:45:52,620 --> 00:45:56,520
are most guys or all through the fence
to mandiant or a Dell SecureWorks or

559
00:45:56,520 --> 00:45:57,870
anybody else who

560
00:45:57,870 --> 00:46:01,180
wants to reverse that stuff to get
really good at it but as a defender I

561
00:46:01,180 --> 00:46:04,370
don't care I didn't know what he's doing
in my environment theoretically

562
00:46:04,370 --> 00:46:07,360
basically and then I need to get rid of
it that's really my goals and after

563
00:46:07,360 --> 00:46:11,810
defender and the reversing stuff is
definitely after the fact that my report

564
00:46:11,810 --> 00:46:21,810
done everything good right now is the
time to question four minutes

565
00:46:21,810 --> 00:46:35,920
yeah we know from the Brio bureau
telling us specifically that in the

566
00:46:35,920 --> 00:46:39,150
gaming industry lot of the security
people would compromise because they

567
00:46:39,150 --> 00:46:42,370
would go after you for jobs and things
like that and the emails we got for a

568
00:46:42,370 --> 00:46:44,940
CEO got one for example it was beautiful

569
00:46:44,940 --> 00:46:49,310
uncompromised server to a page that they
just added to the server I mean

570
00:46:49,310 --> 00:46:52,790
everything looked totally normal and but
she could just talk to the guy which is

571
00:46:52,790 --> 00:46:57,330
widely reported to us so very closer to
click on it and we did in the lab and

572
00:46:57,330 --> 00:47:04,010
we're so from that aspect the fishing
industry eg a just-announced to lay off

573
00:47:04,010 --> 00:47:08,720
because Star Wars is big block and I'll
send their resumes go out so he targets

574
00:47:08,720 --> 00:47:12,300
and that there's very in tune with
what's going on in the in the

575
00:47:12,300 --> 00:47:15,760
environment they know who we are from
LinkedIn they buy the service they can

576
00:47:15,760 --> 00:47:19,030
see when you join a company added a
bunch of people from the company so in

577
00:47:19,030 --> 00:47:23,150
my case I never had people who were
currently cause I don't want that thing

578
00:47:23,150 --> 00:47:27,070
to show up in LinkedIn's I can say he
probably works for company be I just say

579
00:47:27,070 --> 00:47:32,060
I'm not telling you how I don't tell
everybody has joined the company I'm

580
00:47:32,060 --> 00:47:35,290
still a way that try to get rid of some
of that noise again about a lot of

581
00:47:35,290 --> 00:47:46,520
countries are never going to write songs
and out ahead in the hallways are still

582
00:47:46,520 --> 00:47:50,130
getting dogs are not taking this back to
Austin

583
00:47:50,130 --> 00:47:57,539
here no trick question

584
00:47:57,539 --> 00:48:01,960
shooting guns so widely enough in 2014

585
00:48:01,960 --> 00:48:05,240
none of it was signed and what they did
when using vector a broke all the

586
00:48:05,240 --> 00:48:09,390
signatures so they just ignored the
whole sick thing all the time in 2012

587
00:48:09,390 --> 00:48:17,000
and 13 know they did you find files
pretty extensively so we found 10 cents

588
00:48:17,000 --> 00:48:22,289
a webcam driver and they use these as
mexico's launchers so that nine works

589
00:48:22,289 --> 00:48:25,289
that you can package something up and
trust that installer everything below

590
00:48:25,289 --> 00:48:29,250
that installs automatically trust it and
so they tried to use that logic against

591
00:48:29,250 --> 00:48:33,230
us we did have a bit 9 stuff word demo
mode when it first occurred which is

592
00:48:33,230 --> 00:48:37,869
probably why they did that to use the
form that exe which was signed a used an

593
00:48:37,869 --> 00:48:43,769
Intel driver which was signed a lot of
these headaches fire pro-vote so some of

594
00:48:43,769 --> 00:48:51,200
the very valid like $0.10 use that and
so they just figure out analyzed

595
00:48:51,200 --> 00:48:57,460
analyzed drivers Dell or HP they look
the same these are probably the after

596
00:48:57,460 --> 00:49:02,470
hours work of driver writers and so they
look very similar in that same sloppy

597
00:49:02,470 --> 00:49:06,450
habits same time to use of API calls and
stuff the garbage I hate seeing drivers

598
00:49:06,450 --> 00:49:11,730
going to install the printer driver to
exclude my master list but for the most

599
00:49:11,730 --> 00:49:16,240
part no signing in this story really
interesting last time and when they did

600
00:49:16,240 --> 00:49:19,660
that once a month once every other month
thing they very much you signed files

601
00:49:19,660 --> 00:49:32,839
either expired or current from somebody
that compromise to question

602
00:49:32,839 --> 00:49:37,989
yes

603
00:49:37,989 --> 00:49:45,650
comments comments no but stupidly PDB
files I mean some of these were so it's

604
00:49:45,650 --> 00:49:50,499
clear that these actors in GI are using
some exploit you can tell us not to buy

605
00:49:50,499 --> 00:49:53,829
them it's all Russian language
references in there and what not but the

606
00:49:53,829 --> 00:49:58,299
long descriptive location of what the
stupid PDB file project file is not

607
00:49:58,299 --> 00:50:02,160
surprising that that would be left in
their great if you look at Windows

608
00:50:02,160 --> 00:50:06,299
executable it's like explored IPTV it's
not something long path and drive letter

609
00:50:06,299 --> 00:50:10,229
but yes that actually quite a bit when
we did the strings of them out or so

610
00:50:10,229 --> 00:50:16,519
good question

611
00:50:16,519 --> 00:50:17,239
pecan and

