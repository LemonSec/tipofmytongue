1
00:00:00,000 --> 00:00:06,029
can everybody hear me I called you need
this for the recording or a loophole

2
00:00:06,029 --> 00:00:10,300
that alright

3
00:00:10,300 --> 00:00:17,930
hello my name is Rob I go by the handle
Cano's which is a duckbill platypus in

4
00:00:17,930 --> 00:00:24,680
Russian and actually what's interesting
is last month when I was stuck on a

5
00:00:24,680 --> 00:00:31,980
black hat I ran into the other person in
the hacker community is and he spelled

6
00:00:31,980 --> 00:00:42,680
his he spelled the word canis wrong so
you actually has utk a NOS or na and he

7
00:00:42,680 --> 00:00:47,410
actually has a friend we had a friend
with him who he had asked how to spell

8
00:00:47,410 --> 00:00:55,590
it and his friend is Ukrainian and so he
got the wrong spelling so my my handle

9
00:00:55,590 --> 00:01:01,469
is spelled correctly but so much talk
today is about our file collection and

10
00:01:01,469 --> 00:01:10,280
analysis for power and one of the the
the the basic reasons for this talk is

11
00:01:10,280 --> 00:01:17,909
for somebody who is not an analyst is
not a you know malware reverse engineer

12
00:01:17,909 --> 00:01:22,479
someone that does not have a malware lab
which I'm probably a lot of a lot of

13
00:01:22,479 --> 00:01:27,880
people in this room do so what this talk
is aimed at the people this talk is

14
00:01:27,880 --> 00:01:32,049
aimed towards our people who don't have
the resources they might be working for

15
00:01:32,049 --> 00:01:39,520
a small company they may not have a lot
of the knowledge of how to you know work

16
00:01:39,520 --> 00:01:44,340
for some of the other tools that are
open source or if you have like you may

17
00:01:44,340 --> 00:01:49,200
not have the money for some of the the
expensive clothes source tools and

18
00:01:49,200 --> 00:01:55,049
services for doing analysis of malicious
URLs so the point of this is to use just

19
00:01:55,049 --> 00:02:00,030
the tools that you have available with a
little bit of Python and a little bit of

20
00:02:00,030 --> 00:02:06,520
scripting added to that to automate it
so that's the that's the goal of my talk

21
00:02:06,520 --> 00:02:12,120
is to basically give a tool that's very
very easy to use to people who don't

22
00:02:12,120 --> 00:02:18,129
necessarily have the resources to to do
full you know malware analysis that I do

23
00:02:18,129 --> 00:02:21,330
and other people do so

24
00:02:21,330 --> 00:02:24,640
whom I i'm the senior threat
intelligence researcher for threat

25
00:02:24,640 --> 00:02:30,780
connect were based out of Arlington and
I started their little known fact

26
00:02:30,780 --> 00:02:40,050
actually accepted the job at last year's
Derby so I've been there for exactly one

27
00:02:40,050 --> 00:02:47,730
year now so this is my my door handle
Mauer who can host and I work toward the

28
00:02:47,730 --> 00:02:53,330
Intel research team at Direct Connect
and at the end of my talk we actually

29
00:02:53,330 --> 00:02:57,090
just published a research paper which
I'll give you the link to everybody

30
00:02:57,090 --> 00:03:03,440
should read it very very very
interesting so what is a hard files so

31
00:03:03,440 --> 00:03:11,390
far file is an HTTP archive and what it
the the purpose of our file is not what

32
00:03:11,390 --> 00:03:15,319
I'm going to be using it for obviously
the purpose of our files if you are a

33
00:03:15,319 --> 00:03:20,810
web developer and you are doing web
testing of your site or site you develop

34
00:03:20,810 --> 00:03:26,209
the point of this is to get page load
times and component you know different

35
00:03:26,209 --> 00:03:30,950
components that are part of your website
and get the load times and other

36
00:03:30,950 --> 00:03:35,989
information about how the how the pages
loading so when I first encountered this

37
00:03:35,989 --> 00:03:40,060
error out great I can just visit a
malicious website and then this will

38
00:03:40,060 --> 00:03:45,220
show me all of the different you know
the response headers from the server it

39
00:03:45,220 --> 00:03:49,299
all you know I'll get the IP address cuz
it'll show the the IP resolution from

40
00:03:49,299 --> 00:03:54,239
the host name required all the different
URLs if one of them has like a payload

41
00:03:54,239 --> 00:04:00,239
winery you know it'll be there and
that's also one thing in the abstract

42
00:04:00,239 --> 00:04:04,120
right talk is a few months old so
actually improve the couple of items on

43
00:04:04,120 --> 00:04:09,470
there so I had mentioned in there that I
use her Leiser have tossed that out on

44
00:04:09,470 --> 00:04:14,010
the curb and I actually wrote my own
code to do the same thing and then also

45
00:04:14,010 --> 00:04:16,420
the the payload binaries I actually

46
00:04:16,420 --> 00:04:19,400
pull down in a different way than than
going through the heart file and

47
00:04:19,400 --> 00:04:25,750
actually pulling out basic thing but
we'll get into that in a minute but

48
00:04:25,750 --> 00:04:31,540
first let's look so the the definition
of Haaretz you be archived format or

49
00:04:31,540 --> 00:04:36,880
hard JSON formatted archival format for
logging of a web browsers interaction

50
00:04:36,880 --> 00:04:43,510
with the website the common extension
for these dot hard and so the the great

51
00:04:43,510 --> 00:04:48,660
thing about it is it's JSON format so
anything as JSON is very easy to use

52
00:04:48,660 --> 00:04:53,940
you can even take the raw are filed and
just send it in to elasticsearch you you

53
00:04:53,940 --> 00:05:01,810
know what is it that way and let's take
a look at the components and so this is

54
00:05:01,810 --> 00:05:05,850
the intended purpose and then the
additional purposes that i'm gonna talk

55
00:05:05,850 --> 00:05:10,990
about the main one is to record
malicious URL behavior that's this one

56
00:05:10,990 --> 00:05:17,100
and then I'm also very briefly going to
talk about another way where you can

57
00:05:17,100 --> 00:05:23,190
record manual behavior and then replay
that in an automated way and that's

58
00:05:23,190 --> 00:05:27,240
actually where I was introduced to her
files because I was using them to

59
00:05:27,240 --> 00:05:32,300
basically take you know UI interaction
and then just replay it over and over

60
00:05:32,300 --> 00:05:39,790
and over when I realized hey this is
good for URL analysis as well so there's

61
00:05:39,790 --> 00:05:45,050
a lot there's actually more tools that
support our files than this but these

62
00:05:45,050 --> 00:05:53,310
are the major ones so chrome has it and
then also Firefox with Firefox version

63
00:05:53,310 --> 00:06:00,250
42 and its version 42 the ability to
save and use our files is now backed

64
00:06:00,250 --> 00:06:06,760
into Firefox itself I think you know you
know I'm guessing that the Firebug

65
00:06:06,760 --> 00:06:12,350
project you might have heard of Firebug
I believe the Firebug project has kind

66
00:06:12,350 --> 00:06:17,270
of been pulled into Firefox or at least
the capabilities that fire bug has have

67
00:06:17,270 --> 00:06:23,950
become part of Firefox proper so but
forty-two is actually the development

68
00:06:23,950 --> 00:06:28,820
version so I'm not actually going to use
that one in any of this for now I might

69
00:06:28,820 --> 00:06:34,680
go back and do little bit adjustment for
the talk once 42 is is stable released

70
00:06:34,680 --> 00:06:41,020
version but for now I'm gonna be using
Firebug and another plugin for Firebug

71
00:06:41,020 --> 00:06:46,470
safire bugs and add on and have a plugin
for the addon called net export and

72
00:06:46,470 --> 00:06:51,730
we'll get into that in a minute but
Internet Explorer 9 on also can save our

73
00:06:51,730 --> 00:06:57,160
files its in the developers tools areas
so you might be familiar with that the

74
00:06:57,160 --> 00:07:01,110
same thing in chrome it's in the
developers told area for most of these

75
00:07:01,110 --> 00:07:07,080
I'm gonna show you how to how to use
them and then hitler also if you if you

76
00:07:07,080 --> 00:07:09,510
are familiar with fiddler you can do

77
00:07:09,510 --> 00:07:16,060
proxies from Internet Explorer and other
browsers and capture the traffic

78
00:07:16,060 --> 00:07:22,870
analyzed it so you can actually save
save our files from fiddler and then

79
00:07:22,870 --> 00:07:28,160
phantom jail I'm not going to go into
using phantom Jas because I've used

80
00:07:28,160 --> 00:07:35,300
Python scripting and selenium for my
system but phantom jess has the ability

81
00:07:35,300 --> 00:07:40,460
to save saved the traffic but can't
ingest goes and visits to the website

82
00:07:40,460 --> 00:07:47,100
save it as a heart so and then the last
1 I'm gonna talk about this this is a

83
00:07:47,100 --> 00:07:51,190
paid product it's about 30 bucks so
usually I don't like to talk about stuff

84
00:07:51,190 --> 00:07:56,210
like that and you know hacker conference
talk but the thing is too awesome for me

85
00:07:56,210 --> 00:08:02,670
not to mention it and it was a really
really useful tool for the the for the

86
00:08:02,670 --> 00:08:07,310
second the recording manual behavior in
the replaying it automatically so and I

87
00:08:07,310 --> 00:08:11,370
want to talk to in-depth about that
that's not the purpose of this talk but

88
00:08:11,370 --> 00:08:15,900
let's take a look sorry if this part of
the talks going to be a little boring

89
00:08:15,900 --> 00:08:19,980
but i wanna get you up on what the
specification for our files is and what

90
00:08:19,980 --> 00:08:25,210
the components are what the the
different key value pairs are so the

91
00:08:25,210 --> 00:08:30,810
main specification has the mistake he
called log and then under that there are

92
00:08:30,810 --> 00:08:33,719
keys version creator browser pages

93
00:08:33,719 --> 00:08:42,399
entities entries and comment so the
Creator and the creator key has a has a

94
00:08:42,399 --> 00:08:46,610
dictionary that has you know whatever
the software that created it is the

95
00:08:46,610 --> 00:08:52,740
version of that so in this case Firebug
version 1.6 I think Firebug is up to

96
00:08:52,740 --> 00:09:00,240
version 2.02% things like that so these
Dr the documentation that I pulled this

97
00:09:00,240 --> 00:09:07,019
from is actually very old so the browser
it also shows you the record the browser

98
00:09:07,019 --> 00:09:15,449
browser version and then pages so
there's actually two there's kind of two

99
00:09:15,449 --> 00:09:21,660
different sections major sections in our
file one is pages and then one is

100
00:09:21,660 --> 00:09:29,120
entries and so that the difference
between the two is if you the the pages

101
00:09:29,120 --> 00:09:34,540
section is is essentially the page the
Euro you visited or is being visited

102
00:09:34,540 --> 00:09:39,449
automatically and then entries that
other URLs that are contained inside of

103
00:09:39,449 --> 00:09:46,180
that page so if it visits you know if it
visits a flash you know militia /

104
00:09:46,180 --> 00:09:50,290
payload that's embedded in the page
that's going to be listed under entries

105
00:09:50,290 --> 00:09:55,759
not under pages so there's usually only
one page or if you use it if you use it

106
00:09:55,759 --> 00:10:02,379
to analyze traffic diversion system like
a TDS it will have a page each one of

107
00:10:02,379 --> 00:10:06,360
the hop so if you get forwarded from
this one to the next one and then on to

108
00:10:06,360 --> 00:10:07,319
the next one

109
00:10:07,319 --> 00:10:14,910
there's gonna be a page for each one of
those hops in the TDS so and treats this

110
00:10:14,910 --> 00:10:22,079
is where some of the really good data is
it has paid ref and so is a reference to

111
00:10:22,079 --> 00:10:25,730
the entry from or I should use a
different word than entries or entries

112
00:10:25,730 --> 00:10:34,079
but the the the the item in pages so you
can actually go through and see sort of

113
00:10:34,079 --> 00:10:37,569
parenthood and parent-child
relationships between pages and then the

114
00:10:37,569 --> 00:10:43,150
entries that that were generated or were
then downloaded

115
00:10:43,150 --> 00:10:47,750
it were visited afterwards time and
started at actually don't really care

116
00:10:47,750 --> 00:10:50,960
about this stuff that's for the people
who are actually using this for its

117
00:10:50,960 --> 00:10:56,070
intended purpose so the type you know
the time it took down load the page I

118
00:10:56,070 --> 00:11:01,510
really couldn't care less and then it
has the request headers response and

119
00:11:01,510 --> 00:11:06,750
cash flow cash timings don't really care
about that either server IP addresses

120
00:11:06,750 --> 00:11:13,060
good this is whatever the DNS resolution
of the hosts in the Euro result too so I

121
00:11:13,060 --> 00:11:16,540
capture this in the script that I that I
use later

122
00:11:16,540 --> 00:11:24,180
connection comment not important for me
so the request has to get the method it

123
00:11:24,180 --> 00:11:31,130
has the euro was visited has the version
of HTTP etcetera etcetera cookies not so

124
00:11:31,130 --> 00:11:32,260
important for me

125
00:11:32,260 --> 00:11:36,760
headers these are very important query
string this is one of the really cool

126
00:11:36,760 --> 00:11:41,580
things about heart takes the whole query
string from the Euro breaks it into key

127
00:11:41,580 --> 00:11:46,790
value pairs and then puts it into
dictionary in the JSON files so it's all

128
00:11:46,790 --> 00:11:52,310
nicely broken apart and that's really
important for doing certain types of our

129
00:11:52,310 --> 00:11:59,010
analysis like if you're looking at an
exploit kit many exploit kit URLs will

130
00:11:59,010 --> 00:12:05,670
have you know t value pairs in the euro
and the query string and the values

131
00:12:05,670 --> 00:12:11,170
actually match up with the the person or
the group they're sending out the spam

132
00:12:11,170 --> 00:12:15,530
so it's not always you know if there's
an hour campaign it's not always one

133
00:12:15,530 --> 00:12:21,980
person and it's not always one group you
know you'll have let's say you've got 11

134
00:12:21,980 --> 00:12:27,530
adversary and he has bought time on a
botnet from someone else to send out

135
00:12:27,530 --> 00:12:35,000
spam and then he is sending out spam and
then using someone else's exploit kit

136
00:12:35,000 --> 00:12:40,980
you know someone else's renting their
exploit kit to him they need to know who

137
00:12:40,980 --> 00:12:45,560
that visit belong to so when you get a
piece of spam that has like a malicious

138
00:12:45,560 --> 00:12:48,870
link and it and you click that malicious
link

139
00:12:48,870 --> 00:12:53,120
when you click that malicious link some
you know some amount of money is being

140
00:12:53,120 --> 00:12:57,830
paid being transferred from someone to
someone else because they're paying for

141
00:12:57,830 --> 00:13:03,130
your visit to their exploit kit and for
your you know potential infection of

142
00:13:03,130 --> 00:13:08,680
your computer so it's sort of like a
little token which represents who that

143
00:13:08,680 --> 00:13:14,010
you know who the guy down here sending
spam is that guided sending spam can

144
00:13:14,010 --> 00:13:15,900
either get paid more

145
00:13:15,900 --> 00:13:19,320
be paid by someone else and so it's sort
of like a little tracking numbers so

146
00:13:19,320 --> 00:13:26,250
those that's really important that gets
pulled in the query string and then

147
00:13:26,250 --> 00:13:29,279
you've got the response header this has
a lot of really good information in it

148
00:13:29,279 --> 00:13:33,630
you can tell the server you know the
response had or will have the often will

149
00:13:33,630 --> 00:13:42,150
have the the server type of server name
so Apache but if you're doing drive-by

150
00:13:42,150 --> 00:13:46,580
malware analysis you know and genetics
is pretty much engine X some some some

151
00:13:46,580 --> 00:13:52,279
people even thinking engine X by itself
is sort of an indicator on its own so

152
00:13:52,279 --> 00:13:57,790
especially if you have the if you hit
port 80 on a web server and it's running

153
00:13:57,790 --> 00:14:04,180
Apache and WordPress and then you go to
port 8080 and it's running engine acts

154
00:14:04,180 --> 00:14:10,080
on the same server something fishy is
going on there and then redirect you

155
00:14:10,080 --> 00:14:14,010
were also shows you where if you get
like if this is a three hundred redirect

156
00:14:14,010 --> 00:14:20,400
you get the redirect euro listed there
are side by side comment doesn't matter

157
00:14:20,400 --> 00:14:26,339
and then cookies cookies not so
interesting for me you know that that's

158
00:14:26,339 --> 00:14:31,990
usually gonna be something that a
legitimate websites using so it still in

159
00:14:31,990 --> 00:14:36,020
there and then it nicely breaks out each
one of the headers into the key-value

160
00:14:36,020 --> 00:14:41,160
pairs in the header and then you can you
can you know through that and search for

161
00:14:41,160 --> 00:14:46,760
different information query string as we
talked about the printer in value is

162
00:14:46,760 --> 00:14:53,010
nicely broken out there and then content
so it shows the mimetype for whatever is

163
00:14:53,010 --> 00:14:57,600
in there you know whether it's a flash
file or whether it's you know download

164
00:14:57,600 --> 00:15:03,920
you know octet stream something like
this so that's all found here in content

165
00:15:03,920 --> 00:15:10,290
and then so how do you how do you
generate our file there's it's actually

166
00:15:10,290 --> 00:15:18,220
super super super easy so when you're
doing it manually in chrome so you may

167
00:15:18,220 --> 00:15:23,000
be familiar with this if you go to the
little pancake menu in the corner chrome

168
00:15:23,000 --> 00:15:28,940
and then navigate to more tools and then
developer tools and once developer tools

169
00:15:28,940 --> 00:15:35,470
opens and this is this is a par file
that I created this is not there's

170
00:15:35,470 --> 00:15:39,899
nothing hard fouls developer tools
visualization of get hub but this is

171
00:15:39,899 --> 00:15:45,089
this can be saved as a her file so what
you do is just right click on that area

172
00:15:45,089 --> 00:15:53,790
down in the bottom and then it shows you
save his par file content so then

173
00:15:53,790 --> 00:16:01,980
Firefox takes a little bit more effort
however the good thing about Firefox is

174
00:16:01,980 --> 00:16:07,410
when I'm using Selenium to to automate
the visiting of the websites selenium

175
00:16:07,410 --> 00:16:15,199
works very well with Firebug and net
Explorer and Firefox there is a chrome

176
00:16:15,199 --> 00:16:20,939
driver that's part of this project but I
wasn't able to find a way to get

177
00:16:20,939 --> 00:16:26,889
selenium to talk to the crime driver and
tell the driver to save a heart file so

178
00:16:26,889 --> 00:16:32,620
I don't use Chrome for this for this
talk at all so what you have to do for

179
00:16:32,620 --> 00:16:37,480
this is you go to install fire fire fire
bug could have told menu and then

180
00:16:37,480 --> 00:16:43,050
install add-ons and then you have to
install net export you have to do one of

181
00:16:43,050 --> 00:16:47,779
those things that you know you're that's
never recommended you go to some random

182
00:16:47,779 --> 00:16:53,130
website you download the ad on file
itself and then you have to right click

183
00:16:53,130 --> 00:16:58,980
in add-ons and say a dog at an add-on
from a file so never safe but in this

184
00:16:58,980 --> 00:17:05,569
case you should be doing this inside of
of Yemeni so and actually I don't think

185
00:17:05,569 --> 00:17:08,310
that export is not not that bad thing

186
00:17:08,310 --> 00:17:15,620
know it's pretty small yeah it's pretty
small and actually you know at the end

187
00:17:15,620 --> 00:17:21,160
of my talking to be publishing this to
get a job and I actually have the two at

188
00:17:21,160 --> 00:17:26,240
the two most recent versions of the
add-ons in my repository so it's all

189
00:17:26,240 --> 00:17:29,240
right there for you to use

190
00:17:29,240 --> 00:17:39,470
yeah I back toward them exactly ok so
then what you have to do and here is

191
00:17:39,470 --> 00:17:43,400
this is also just for the manual if you
want to do this manually and save it for

192
00:17:43,400 --> 00:17:48,350
our file the automation takes care of
all these settings or you have to click

193
00:17:48,350 --> 00:17:56,170
Enable under the net panel and this all
of these things like I he in Chrome and

194
00:17:56,170 --> 00:18:02,740
Firefox Firebug it all has that sort of
same like waterfall diagram format with

195
00:18:02,740 --> 00:18:10,350
each one of the entries listed so and
you know this is the same thing but this

196
00:18:10,350 --> 00:18:16,870
is in Firebug so it looks nearly the
same and the way you save it is almost

197
00:18:16,870 --> 00:18:22,550
the same as well so just right click on
export no sorry click on export and then

198
00:18:22,550 --> 00:18:27,950
save as and then you've got a heart file
somewhere where you put it so let's get

199
00:18:27,950 --> 00:18:32,180
into the fun stuff is the part that
that's the exciting part of the talks so

200
00:18:32,180 --> 00:18:39,250
far collection automation using Selenium
and Python to automate visiting a set of

201
00:18:39,250 --> 00:18:46,180
URL potentially potentially malicious
URLs so I've written two components here

202
00:18:46,180 --> 00:18:52,980
each one is an independent tool so the
first one is hard collector . pie and

203
00:18:52,980 --> 00:18:58,780
this actually leverages hard two sticks
in when it gets to the point of after

204
00:18:58,780 --> 00:19:04,070
the hard fouls been collected it then
parses the heart file but each one of

205
00:19:04,070 --> 00:19:07,140
these can be used independently so if
you have a heart file you can just use

206
00:19:07,140 --> 00:19:12,559
hard to stick to have that parse out the
HAR file and pull out

207
00:19:12,559 --> 00:19:19,190
IP and other network indicators and have
them saved and sticks format and Mike

208
00:19:19,190 --> 00:19:27,809
MATC format and also I will say that I'm
not an expert in sticks and MHC it's

209
00:19:27,809 --> 00:19:35,320
actually a very labyrinth in standard
and it right and and and and so I want

210
00:19:35,320 --> 00:19:39,710
to apologize I may have picked a
combination of objects in there that is

211
00:19:39,710 --> 00:19:43,779
different than what someone else has
picked and put together but the data is

212
00:19:43,779 --> 00:19:49,529
in there and if anyone has if anyone has
any more expertise than I do about six

213
00:19:49,529 --> 00:19:54,639
or a taxi or any of that stuff please
suggest a better way to put together the

214
00:19:54,639 --> 00:20:03,980
objects but it's it works so so the
heart collector let's take a look at

215
00:20:03,980 --> 00:20:09,619
that the hard to see the two components
hardest takes an art collector let me

216
00:20:09,619 --> 00:20:24,010
just

217
00:20:24,010 --> 00:20:54,440
alright so this is this is the program
for the selenium so important to me I'm

218
00:20:54,440 --> 00:20:58,890
using webdriver and then a massive
number of preference settings down here

219
00:20:58,890 --> 00:21:04,020
and the the pressure settings down here
basically make it so that the harsh I'll

220
00:21:04,020 --> 00:21:08,630
gets automatically download
automatically saved also if there's a

221
00:21:08,630 --> 00:21:13,460
download this is also super this set of
the senate's preferences super dangerous

222
00:21:13,460 --> 00:21:18,260
because it turns off any of the the
dialogues for downloading so it just

223
00:21:18,260 --> 00:21:24,470
goes head and says yes we use Download
everything so they don't use these

224
00:21:24,470 --> 00:21:31,890
settings anywhere else you know in your
regular browser was your insane so it

225
00:21:31,890 --> 00:21:37,630
basically polls in both of the XPI files
and then put an add them to Firefox each

226
00:21:37,630 --> 00:21:42,300
time and so I've actually put a car
collector car collector directory in

227
00:21:42,300 --> 00:21:47,030
your your route near your home directory
that contains this to file so knows

228
00:21:47,030 --> 00:21:48,030
where to find them

229
00:21:48,030 --> 00:21:55,910
does a whole bunch of set up all the
settings does a visit to the Euro one of

230
00:21:55,910 --> 00:22:01,560
the things that I that I need to work on
in here is the timing of when it saves

231
00:22:01,560 --> 00:22:07,240
the heart file is not controllable by me
in silentium so I have to sit there and

232
00:22:07,240 --> 00:22:12,360
and give it a wait time I have it
waiting for a hundred and twenty seconds

233
00:22:12,360 --> 00:22:17,860
after each one just to make sure that
the page has fully loaded and then when

234
00:22:17,860 --> 00:22:23,440
when the page reaches when the page is
fully loaded thats the moment when our

235
00:22:23,440 --> 00:22:28,410
files begin to be saved and sometimes if
it's loaded a lot of different

236
00:22:28,410 --> 00:22:29,920
components in the page

237
00:22:29,920 --> 00:22:32,999
creating our file takes a little bit of
time on its own

238
00:22:32,999 --> 00:22:38,259
and so I have to leave like a nice
leeway in there and if there's any web

239
00:22:38,259 --> 00:22:43,779
developers that use this on a regular
basis for your own stuff not collecting

240
00:22:43,779 --> 00:22:48,129
malware and you know like an opera
switch that can change this so that I

241
00:22:48,129 --> 00:22:53,279
can force the HAR file to be done
without using a timer please let me know

242
00:22:53,279 --> 00:22:59,939
but I found it for almost all the
websites that I've looked at a hundred

243
00:22:59,939 --> 00:23:03,539
twenty seconds is pretty good and then
the the sleep time at the beginning is

244
00:23:03,539 --> 00:23:13,819
to make sure that both of those addons
have been loaded properly and it just

245
00:23:13,819 --> 00:23:18,229
goes through and it pulls down all the
all the files saved in one location and

246
00:23:18,229 --> 00:23:22,999
then I have it download any of the files
you know any minor is that are on the

247
00:23:22,999 --> 00:23:30,579
site and it puts there's no download
directory and then I call translate har

248
00:23:30,579 --> 00:23:35,999
and so translate are actually runs the
other the other program hard two sticks

249
00:23:35,999 --> 00:23:45,609
so we'll look at that one next so hard
two sticks if anyone is familiar with

250
00:23:45,609 --> 00:23:52,369
the Python sticks I box and Mike stuff
you know this is the imports for all the

251
00:23:52,369 --> 00:23:58,149
objects and I'm using in here and then I
go through and I create both MATC

252
00:23:58,149 --> 00:24:05,739
package and also a sticks package and
the reason for that is the MEAC is NBC

253
00:24:05,739 --> 00:24:13,079
right now is just the is just the
malware subject as the mural is the

254
00:24:13,079 --> 00:24:19,409
malware subject in this case and then as
as you know in a later stage if you do

255
00:24:19,409 --> 00:24:24,989
further analysis and have findings
according to you the MAAC format you can

256
00:24:24,989 --> 00:24:32,499
then add to this to this as you go along
using other tools not this one but it

257
00:24:32,499 --> 00:24:39,239
starts off with the subject and then
save that as a as a MEAC package and

258
00:24:39,239 --> 00:24:46,029
then the sticks package is this part so
goes through nicole's out

259
00:24:46,029 --> 00:24:53,210
the ural indicator and then saves that
as a Euro observable in the sticks

260
00:24:53,210 --> 00:25:02,029
package and then goes through and pulls
out the host and put the hosts into

261
00:25:02,029 --> 00:25:09,320
another observable and then last of all
puts the IP address into the third eye

262
00:25:09,320 --> 00:25:16,599
IP observable and then once readdress
observable and then adds all of those

263
00:25:16,599 --> 00:25:22,859
into a stick package and it puts each of
them is like an IP watch list

264
00:25:22,859 --> 00:25:26,739
domain watch list and you were all watch
list so that you can consume them in

265
00:25:26,739 --> 00:25:31,469
whatever devices and systems that can
consume sticks and it will understand

266
00:25:31,469 --> 00:25:38,889
that it needs to you know flag knees or
you know if you got intelligence system

267
00:25:38,889 --> 00:25:44,210
like example you consume it that way and
get your set of indicators there will be

268
00:25:44,210 --> 00:25:51,580
only club and then this part this was
that the parts are section it's actually

269
00:25:51,580 --> 00:25:55,289
I I found it's much easier for me to
just pull the whole the data out of the

270
00:25:55,289 --> 00:26:01,769
key-value pairs in JSON then it is so
use ha réaliser and you know go through

271
00:26:01,769 --> 00:26:05,830
someone else's software you know just it
just to do something simple like this

272
00:26:05,830 --> 00:26:10,789
that's why you know I basically replaced
all this labyrinth in code using our

273
00:26:10,789 --> 00:26:17,989
allies it with you know I seventy nine
395 so and then it goes through and

274
00:26:17,989 --> 00:26:22,549
actually pulls out the name of the
website from the heart path because the

275
00:26:22,549 --> 00:26:27,929
way selenium selenium I'm sorry for the
way Firebug saves things that saves it

276
00:26:27,929 --> 00:26:33,489
with the the URL or at least I'm sorry
the the host name in the filename for

277
00:26:33,489 --> 00:26:40,349
the heart and so I pulled that out of
there and use that as the site name and

278
00:26:40,349 --> 00:26:46,089
then jam it all into the sticks the
general and the stakes package and I'm

279
00:26:46,089 --> 00:26:50,389
done and then save save them into the
same save them in the same folder I

280
00:26:50,389 --> 00:26:55,979
found so far is where I found are filed
to begin with so it's pretty simple and

281
00:26:55,979 --> 00:26:58,169
it works and let me

282
00:26:58,169 --> 00:27:18,190
flip back to the parties intentions and
lets and also I didn't want to tempt the

283
00:27:18,190 --> 00:27:24,850
demo gods so I made a recording we will
I brought my MiFi so we can visit a few

284
00:27:24,850 --> 00:27:27,600
sites and see it live

285
00:27:27,600 --> 00:27:33,840
potentially but just to make sure I
wanted to have the recording which as

286
00:27:33,840 --> 00:27:50,080
you know

287
00:27:50,080 --> 00:28:09,980
everybody see that cool so I'll kind of
describe what is going on here as it

288
00:28:09,980 --> 00:28:22,370
happens so first thing I do is run so
what this takes is a list of URLs in a

289
00:28:22,370 --> 00:28:33,559
text file I think they didn't cut I
didn't cut off the beginning of it but

290
00:28:33,559 --> 00:28:45,080
alright so it takes it takes a bit
should be doing a dash each their age

291
00:28:45,080 --> 00:28:53,980
thank goodness ok so it takes a list you
know so one euro per line in a text file

292
00:28:53,980 --> 00:29:00,190
and you know pulls out each one of the
bodies one of the roles in visits with

293
00:29:00,190 --> 00:29:06,710
the heart collector script so I've also
time-lapse this a little bit because

294
00:29:06,710 --> 00:29:08,409
that one hundred and twenty seconds

295
00:29:08,409 --> 00:29:14,279
visit time for the sleep time in between
each one I have removed that so don't

296
00:29:14,279 --> 00:29:19,590
worry we're not gonna sit here and wait
for a few minutes for each one so as you

297
00:29:19,590 --> 00:29:25,110
can see it's just it pops up Firebug
opens fire bug the little green little

298
00:29:25,110 --> 00:29:33,289
green light there means the export is
automated and then visits the malicious

299
00:29:33,289 --> 00:29:38,279
website all trades da true obviously
this is you know probably a malicious

300
00:29:38,279 --> 00:29:46,880
website this one actually has a 11
malicious iframe in the in the site and

301
00:29:46,880 --> 00:29:51,409
so it pulled our file created all the
MAAC indicators and all that moves on to

302
00:29:51,409 --> 00:29:56,240
the next one and also this is not
necessarily always going to be for

303
00:29:56,240 --> 00:30:01,340
malware specifically so there it
downloaded the exe file

304
00:30:01,340 --> 00:30:13,760
case sumitomo's up then dirty 1.0 TXC I
would never run that but it's not always

305
00:30:13,760 --> 00:30:18,870
you know i i say that this talk was
about malware but if you're doing like

306
00:30:18,870 --> 00:30:23,080
fishing links and looking at fishing
sites works just as well for that so

307
00:30:23,080 --> 00:30:30,970
this next one I believe is a phishing
site and let's see I didn't pull out

308
00:30:30,970 --> 00:30:36,040
that couple of said that 10 seconds at
the beginning of each visit so yes

309
00:30:36,040 --> 00:30:41,270
that's obviously a fishing say you know
one account all Google choose your email

310
00:30:41,270 --> 00:30:46,160
providers give us your login and
password and then you'll continue to

311
00:30:46,160 --> 00:30:48,190
Google Drive and so will we

312
00:30:48,190 --> 00:30:57,760
so you can use it to pull out you know
that you're going to get the indicator

313
00:30:57,760 --> 00:30:58,290
here

314
00:30:58,290 --> 00:31:03,570
San Juan matsu dotnet and then whatever
IP address its running and then the

315
00:31:03,570 --> 00:31:12,770
fishing you're all so you'll have like
the sticks reach one of those yes so in

316
00:31:12,770 --> 00:31:16,280
this case that would be a little bit
more advanced I need to go and automate

317
00:31:16,280 --> 00:31:20,040
visiting each one of the forms which is
a really good idea but I didn't do that

318
00:31:20,040 --> 00:31:25,720
in this sort of person but yet that
would be pretty easy to do just look for

319
00:31:25,720 --> 00:31:33,230
the form but crap in it it go and then
catch the next to the next one and this

320
00:31:33,230 --> 00:31:33,540
one

321
00:31:33,540 --> 00:31:38,150
yo films da true

322
00:31:38,150 --> 00:31:42,360
and it's got like this there's some
parts and there that are there throwing

323
00:31:42,360 --> 00:31:54,860
a status of 444 fun stuff there and then
this next one I think this is going to

324
00:31:54,860 --> 00:32:03,170
be a file download if I remember
correctly yes so ok one-dot exe I don't

325
00:32:03,170 --> 00:32:07,430
I haven't actually run any of these
through anything yet they're still

326
00:32:07,430 --> 00:32:11,480
sitting here on my laptop will take a
look at them we'll take a look at

327
00:32:11,480 --> 00:32:17,520
basically like transition over to
terminal here you know basically then

328
00:32:17,520 --> 00:32:21,280
the next moment after this video stops I
kind of just left the p.m. open so we

329
00:32:21,280 --> 00:32:27,180
can take a look at the files that it
produced and I think there's one more

330
00:32:27,180 --> 00:32:38,550
after K one or maybe two more speed this
up a little bit so yes you can see bet

331
00:32:38,550 --> 00:32:49,210
beds died exe whatever that is just got
downloaded and then P a.net the OPA da

332
00:32:49,210 --> 00:32:56,940
txt was last one and that's it so that's
the that's the end of the recorded demo

333
00:32:56,940 --> 00:33:10,580
and I will jump over to self

334
00:33:10,580 --> 00:33:22,100
cool so the way I haven't arranged I
just take the hostname and depend upon

335
00:33:22,100 --> 00:33:26,360
that to the timestamp but when they
visit happened or when they visit began

336
00:33:26,360 --> 00:33:31,590
and turn that into a directory and then
in that directory structure I keep all

337
00:33:31,590 --> 00:33:37,470
of the different files including the
downloaded file so let's look at the

338
00:33:37,470 --> 00:33:57,799
first one all trades ok so as you can
see there is a download folder here and

339
00:33:57,799 --> 00:34:02,950
then here's the heart file that was
collected by net export and then over

340
00:34:02,950 --> 00:34:08,050
here the MATC and the dots text file
these are the ones that I created using

341
00:34:08,050 --> 00:34:13,700
the hardest X program after the visit
and after the heart file saved so let's

342
00:34:13,700 --> 00:34:28,220
take a look at the car so you know it
has all the different sections that we

343
00:34:28,220 --> 00:34:37,300
went through earlier so it's got the IP
address resolution it has the three the

344
00:34:37,300 --> 00:34:44,339
vmi don't think I can scroll properly
using my my Apple trackpad so let me

345
00:34:44,339 --> 00:34:53,530
just put that through less ok cool so
has the title of the page and the other

346
00:34:53,530 --> 00:35:02,270
information about that and has the each
one of the components that was loaded in

347
00:35:02,270 --> 00:35:08,390
the page and so each one of these has a
separate sticks indicator created for it

348
00:35:08,390 --> 00:35:14,080
and so far through all of this data and
then

349
00:35:14,080 --> 00:35:29,590
out of that and then it creates the MACC
files so let's take a look at that and I

350
00:35:29,590 --> 00:35:35,550
i dont actually know why I'm in a look
at MHC stuff is like just like it's it's

351
00:35:35,550 --> 00:35:45,900
horrible it's actually XML which is so
last year I actually feel bad taking

352
00:35:45,900 --> 00:35:52,350
nice JSON feel bad taking Lake
beautifully crafted JSON and then

353
00:35:52,350 --> 00:35:57,840
translating it over to this garbage but
I do so is this is you know industry

354
00:35:57,840 --> 00:36:05,520
standard stuff so this is the the mic
package with the Euro object type the

355
00:36:05,520 --> 00:36:13,280
URL and then here we have a malware
object instance object etcetera etcetera

356
00:36:13,280 --> 00:36:21,440
that and then last going to look at
these tix file which is just as ugly

357
00:36:21,440 --> 00:36:31,300
just as ugly but a lot longer so it has
all the sticks inside box stuff the top

358
00:36:31,300 --> 00:36:39,850
and then goes through each of these
observable indicator types URI post and

359
00:36:39,850 --> 00:36:45,860
IP address so that's output you can then
take these files and jam into you know

360
00:36:45,860 --> 00:36:51,430
whatever sort of thing you have the that
speaks sticks in taxi you have these set

361
00:36:51,430 --> 00:36:56,110
up his attack like you could even set up
a taxi server to sit there and kind of

362
00:36:56,110 --> 00:37:01,470
cough up these files as they're created
you know whatever you'd like to do you

363
00:37:01,470 --> 00:37:06,400
have something else like subscribe to it
but that's getting a little bit too

364
00:37:06,400 --> 00:37:13,580
complex for the the focus of this talk
and then

365
00:37:13,580 --> 00:37:19,750
looks like I'm almost at it and I'm
actually I'm just gonna go over went a

366
00:37:19,750 --> 00:37:23,080
little bit oversaw just keep going

367
00:37:23,080 --> 00:37:29,690
last talked so some of you dislike get
up and leave a guest but alright so I

368
00:37:29,690 --> 00:37:35,960
wanted to point out the one thing and
hear that was the other uses

369
00:37:35,960 --> 00:37:55,360
so this is just the no I don't want to
customize to ok so potential like

370
00:37:55,360 --> 00:38:01,920
offensive capabilities potential so
using our files what you can do and this

371
00:38:01,920 --> 00:38:07,130
is where I this is like where my
introduction to our files began there

372
00:38:07,130 --> 00:38:10,730
was a 24

373
00:38:10,730 --> 00:38:19,970
there was a website that had a tool that
I needed to enter data into and I wanted

374
00:38:19,970 --> 00:38:25,430
to automate that and it had all kinds of
Ajax easy stuff and just lots and lots

375
00:38:25,430 --> 00:38:30,810
of components that all had to be added
together for it to work and not have the

376
00:38:30,810 --> 00:38:36,290
not have that website know that I'm
automating them they don't know most

377
00:38:36,290 --> 00:38:42,430
places don't like that so what I did was
I used chrome and I did you know did my

378
00:38:42,430 --> 00:38:50,020
my my stuff like I usually would in that
you I and then when I was done I saved

379
00:38:50,020 --> 00:38:55,950
an entire session as a har file and then
I used just this is the easy button for

380
00:38:55,950 --> 00:38:57,970
me there might be other tools that can
be

381
00:38:57,970 --> 00:39:02,860
can do the same thing but I is Paul so
you can import the heart of the harsh

382
00:39:02,860 --> 00:39:09,400
Highland Mall is a rest client so it's
like it's a rest it's a rest client for

383
00:39:09,400 --> 00:39:15,810
Mac and so I imported the HAR file and
basically the HAR file gets imported

384
00:39:15,810 --> 00:39:18,240
into the same sort of

385
00:39:18,240 --> 00:39:27,130
component input as different rest you
are also a kind of treats the visit you

386
00:39:27,130 --> 00:39:36,260
just did the visit the you just told it
how to do as a REST URL and so are REST

387
00:39:36,260 --> 00:39:42,660
API euro and so from there it has a
really awesome another feature where you

388
00:39:42,660 --> 00:39:49,610
can export price on request code based
on the API visit that it's looking at

389
00:39:49,610 --> 00:39:54,860
and so I basically took the heart file
and then went through this this pathway

390
00:39:54,860 --> 00:40:00,600
now I have a set price on request code
and then I can take the the the one

391
00:40:00,600 --> 00:40:04,950
piece of what I did that I want to
manipulate and just redo that over and

392
00:40:04,950 --> 00:40:09,710
over and over and automate that so I'm
sure there's many but much potential in

393
00:40:09,710 --> 00:40:14,590
that for you know replaying and replace
attacks that kind of thing so have fun

394
00:40:14,590 --> 00:40:22,390
with that this is the link to pause and
questions if you have any questions let

395
00:40:22,390 --> 00:40:27,450
me know but one thing really quick so
that's my twitter handle again and then

396
00:40:27,450 --> 00:40:33,640
this is the blog for us and my team and
then also this is the link to the paper

397
00:40:33,640 --> 00:40:38,400
that we just released the day before you
actually on Wednesday so check out check

398
00:40:38,400 --> 00:40:49,060
out that paper very interesting stuff
and now that's a good question so so

399
00:40:49,060 --> 00:40:54,850
what you i i would imagine what you're
asking is if a user goes in visit our

400
00:40:54,850 --> 00:41:05,100
website can I then extract a har like in
the background or it is but the thing is

401
00:41:05,100 --> 00:41:10,630
that it would read it requires the
developers tools for Firebug to be open

402
00:41:10,630 --> 00:41:15,210
so if you're thinking of doing something
sneaky to someone else

403
00:41:15,210 --> 00:41:19,589
very obvious that

404
00:41:19,589 --> 00:41:28,819
that's right yeah exactly cuz it's it's
it's very obvious and if you i think if

405
00:41:28,819 --> 00:41:31,749
you were to use something like man in
the middle

406
00:41:31,749 --> 00:41:36,039
proxy of some type you might be able to
if it had if that proxy that you're

407
00:41:36,039 --> 00:41:40,710
using supports harder than you could
probably create our files based on the

408
00:41:40,710 --> 00:41:44,319
traffic that goes through your property
but that's just a guess

409
00:41:44,319 --> 00:41:58,529
question no this was Firefox all this is
Firefox Chrome unfortunately the

410
00:41:58,529 --> 00:42:04,210
selenium chrome driver for a chrome I
wasn't able to find a way to automate

411
00:42:04,210 --> 00:42:10,019
the saving of our files using Chrome so
chrome the extent of Chrome's usage here

412
00:42:10,019 --> 00:42:15,299
was just for manual har file creation
like visit something like you know that

413
00:42:15,299 --> 00:42:23,489
the second use case that I had alright
thank you very much thank you thank you

