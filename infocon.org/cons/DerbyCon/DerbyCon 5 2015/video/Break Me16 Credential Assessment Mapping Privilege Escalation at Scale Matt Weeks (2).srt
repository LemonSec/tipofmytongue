1
00:00:00,000 --> 00:00:09,900
aligning Galliano paint decorating just
down the road from from my house so yeah

2
00:00:09,900 --> 00:00:19,020
that's right you also have the element
alright let's go to good or actual

3
00:00:19,020 --> 00:00:25,740
presentation here which is on credential
assessment and so I'm not weeks I'm

4
00:00:25,740 --> 00:00:34,450
script junkie and not skip 21 Microsoft
Store the 20 most horrifying registered

5
00:00:34,450 --> 00:00:38,730
and then they later gave it up in a
still can get it back so I'm skip 21 on

6
00:00:38,730 --> 00:00:50,440
Twitter in your hand outs so just a
little bit about motivation behind this

7
00:00:50,440 --> 00:00:55,250
talk when I started out I said the first
things that I didn security i dun

8
00:00:55,250 --> 00:01:00,500
Mauryan in the software development side
of things and then called you start to

9
00:01:00,500 --> 00:01:05,210
get interested in security learn all I
could started to look for

10
00:01:05,210 --> 00:01:11,979
vulnerabilities and exploits 440
availabilities sold a few of those that

11
00:01:11,979 --> 00:01:15,390
was kind of an accident continue in that
direction although I have done a few

12
00:01:15,390 --> 00:01:22,850
since then I did a and in addition to
see as majored in math major research

13
00:01:22,850 --> 00:01:31,189
for my project I broke Chinese code then
when I went in to actually get a job

14
00:01:31,189 --> 00:01:34,610
after graduating my first a lot of work
in the forensics and reverse-engineering

15
00:01:34,610 --> 00:01:42,250
world soda lot of fun part by Marys
looking through logs and stuff I'll

16
00:01:42,250 --> 00:01:48,090
tables and all that kind of thing I then
moved into a similar area into

17
00:01:48,090 --> 00:01:52,520
enterprise operations so looking at
finding our customer network find out

18
00:01:52,520 --> 00:01:56,409
how people were moving through the
network a network getting into

19
00:01:56,409 --> 00:02:02,079
adversary see two channels and doing
lots of interesting things of that and

20
00:02:02,079 --> 00:02:07,740
then red teaming which I've done little
bit as part of that also a lot with for

21
00:02:07,740 --> 00:02:14,360
example CCDC and some other places as
well on the side of done some defensive

22
00:02:14,360 --> 00:02:19,959
development which is my current job now
which is writing software for doing

23
00:02:19,959 --> 00:02:26,730
things and identifying weaknesses in
that works for the image helps to do

24
00:02:26,730 --> 00:02:31,959
that which is not to say go look at me
I've been out here there are certainly

25
00:02:31,959 --> 00:02:35,060
people if you look at things like you
know exploit development people have

26
00:02:35,060 --> 00:02:39,500
spent a whole lot more time than I have
in that world are better at that than I

27
00:02:39,500 --> 00:02:45,540
am but having a glimpse of a lot of
normally very separate fields I'm you

28
00:02:45,540 --> 00:02:50,970
start to see a lot of disconnects
between that and so I'm gonna talk about

29
00:02:50,970 --> 00:02:55,510
one of those here but a lot of times we
see this happens due to kind of a

30
00:02:55,510 --> 00:03:00,980
pigeon-holed focus in one area or one
thing that you see

31
00:03:00,980 --> 00:03:05,230
to some extent you like a lot of a team
or say how you define some guys done

32
00:03:05,230 --> 00:03:09,750
anything you really need to do offensive
to see the picture and some extent

33
00:03:09,750 --> 00:03:13,169
that's true but you also need to see the
defensive side otherwise you end up with

34
00:03:13,169 --> 00:03:17,660
some some very not the best suggestions
for fixing the problems that you find

35
00:03:17,660 --> 00:03:24,560
and sometimes you find attention on
certain things due to financial bias

36
00:03:24,560 --> 00:03:30,530
just have to look at your typical vendor
area and banner advertisements not so

37
00:03:30,530 --> 00:03:34,880
much in Derby Conn below the vendors you
know like to advertise you just let this

38
00:03:34,880 --> 00:03:38,859
box I'm not working I will fix
everything obviously they have a

39
00:03:38,859 --> 00:03:45,250
financial incentive to do that other
times a lot of attention in the research

40
00:03:45,250 --> 00:03:51,220
world and to some extent conference
world on the new and exciting new bright

41
00:03:51,220 --> 00:03:52,620
shiny objects vs

42
00:03:52,620 --> 00:03:58,030
you know the old the normal you know
things that you need to do to take care

43
00:03:58,030 --> 00:04:04,430
of your network here so one of the big
things which has been attracting a lot

44
00:04:04,430 --> 00:04:09,040
of attention recently as some of the
major breaches and so major breaches are

45
00:04:09,040 --> 00:04:13,060
the high impact reaches that result from
complete network compromise so

46
00:04:13,060 --> 00:04:18,600
everybody's seen you know DDoS attacks
or defacement those matter but they

47
00:04:18,600 --> 00:04:22,970
aren't the big major beaches which are
which are really having significant

48
00:04:22,970 --> 00:04:29,539
economic effect and significant effect
on a lot of different people and so you

49
00:04:29,539 --> 00:04:35,030
can look at the effect from just data
stolen so everybody sort of the target

50
00:04:35,030 --> 00:04:40,960
breach the Home Depot breaches very
similar card data the JPMorgan Chase

51
00:04:40,960 --> 00:04:46,889
breach which was again more hansel down
I we've also seen recently are certainly

52
00:04:46,889 --> 00:04:51,000
more so than in previous years I say
about five years I was saying

53
00:04:51,000 --> 00:04:56,669
destructive major breaches so the Sony
breach is probably the most well-known

54
00:04:56,669 --> 00:05:01,580
of those but it's certainly not the only
one of the Sands Casino are actually Las

55
00:05:01,580 --> 00:05:04,120
Vegas Sands entertainment I just the
same thing itself but the entire

56
00:05:04,120 --> 00:05:09,840
business was hit and that's what Saudi
Aramco few years ago and I was major oil

57
00:05:09,840 --> 00:05:16,220
producer in saudi arabia and so when we
look at some of these you know Saudi

58
00:05:16,220 --> 00:05:22,240
Aramco has 30,000 systems which got
wiped and Norma's impact on on their

59
00:05:22,240 --> 00:05:29,830
systems these are normally accompanied
by you know screens showing you know

60
00:05:29,830 --> 00:05:36,190
taunting messages toward the users and
blasting music or thunder struck or

61
00:05:36,190 --> 00:05:38,300
something like that

62
00:05:38,300 --> 00:05:42,960
that ends up being very painful to
accompany as all the Sun tens of

63
00:05:42,960 --> 00:05:47,440
thousands of their employees can't get
their works were done and they're often

64
00:05:47,440 --> 00:05:51,530
as a lot of data which is lost which is
not easy to get back so what's what is

65
00:05:51,530 --> 00:05:55,770
happening what is causing these so the
security industry it's our job to fix

66
00:05:55,770 --> 00:06:00,280
that probably the best analysis which
has been made public is done at the

67
00:06:00,280 --> 00:06:03,969
target reach and I pulled this diagram

68
00:06:03,969 --> 00:06:10,409
the link there which you can see it
started by infecting a vendor with a

69
00:06:10,409 --> 00:06:15,929
social engineering email most likely
after having access to that

70
00:06:15,929 --> 00:06:21,119
HVAC vendor in pennsylvania those
vendors crunches were stolen by the bad

71
00:06:21,119 --> 00:06:24,929
guys to access a web server of targets
which that vendor had access to after

72
00:06:24,929 --> 00:06:28,069
that point they're able to use his
credentials and access to exploit that

73
00:06:28,069 --> 00:06:34,259
web server get a shot on a web server
they identify the modified their malware

74
00:06:34,259 --> 00:06:39,349
to avoid antivirus detection as it was
mentioned in the last talked to her for

75
00:06:39,349 --> 00:06:44,799
them and then they use the power to
still credentials in something called

76
00:06:44,799 --> 00:06:52,389
many cats 2 don't passwords and and
other essentials on that web server I

77
00:06:52,389 --> 00:06:57,179
want to have those they don't spread
their their their actual game was called

78
00:06:57,179 --> 00:07:03,649
back pls onto each of the point of sale
POS stands for systems and those are the

79
00:07:03,649 --> 00:07:06,629
systems that were you know you're
striking a credit card into collecting

80
00:07:06,629 --> 00:07:11,759
your card data and send it back to them
at which point they then sold on the

81
00:07:11,759 --> 00:07:17,059
black market and a lot of money so you
know critical flaw in this is a rugged

82
00:07:17,059 --> 00:07:21,149
mountain to think was eleven different
steps which are summarized a little bit

83
00:07:21,149 --> 00:07:27,069
there was a lot of press coverage on
this lot of it from bankruptcy 2012 was

84
00:07:27,069 --> 00:07:33,469
leading a lot of the reporting on this
so first thing he did was point out that

85
00:07:33,469 --> 00:07:37,989
I'm home depot set by the same power as
target so we're kind of focusing on this

86
00:07:37,989 --> 00:07:41,369
this black PR smaller was something
which had been modified so there was

87
00:07:41,369 --> 00:07:44,479
something which had been seen before
maybe they have better Miller detection

88
00:07:44,479 --> 00:07:46,689
they would have been able to find this

89
00:07:46,689 --> 00:07:50,999
Bloomberg has it right there in the in
the headline says mr. alarms and

90
00:07:50,999 --> 00:07:54,839
fourteen million stolen credit card
numbers how target blew it how they have

91
00:07:54,839 --> 00:07:59,860
little real simple than most alarms they
have fire I systems on the network which

92
00:07:59,860 --> 00:08:03,739
set off a couple Ernst as these
executables are being downloaded in

93
00:08:03,739 --> 00:08:10,509
plain text to their systems and target
didn't respond to that and that sounds

94
00:08:10,509 --> 00:08:15,509
very easy to well of course that must
have been to a reporter outside the

95
00:08:15,509 --> 00:08:21,179
industry if you've SAT within a security
operation center have seen the millions

96
00:08:21,179 --> 00:08:24,999
and millions of false-positive this is
not surprising at all and certainly

97
00:08:24,999 --> 00:08:33,969
isn't a red flag to this is the biggest
issue other articles talked about how

98
00:08:33,969 --> 00:08:38,610
Obama's budget for security software
hardware and services that means little

99
00:08:38,610 --> 00:08:42,490
if you don't have empowered geeks to
help recognize a breach early on so is a

100
00:08:42,490 --> 00:08:46,959
person now that they should have been
putting the money into and so the boxes

101
00:08:46,959 --> 00:08:49,569
on the network and that's certainly
something which is at the root of a lot

102
00:08:49,569 --> 00:08:56,370
of issues us' Senate even held a hearing
and had a committee to prepare a report

103
00:08:56,370 --> 00:09:01,910
on what happened here which is rare for
breaches but they came up with four

104
00:09:01,910 --> 00:09:08,769
major findings first one was giving
access to the HVAC vendor didn't follow

105
00:09:08,769 --> 00:09:14,040
great security policies as it was a HVAC
vendor compromises initial stuff here

106
00:09:14,040 --> 00:09:18,149
the second dimension was the warnings as
was the fourth one day mentioned in the

107
00:09:18,149 --> 00:09:23,740
third one they said that they'll move
from one network to another area and

108
00:09:23,740 --> 00:09:26,990
target publishing isolated that so maybe
maybe we should about its network

109
00:09:26,990 --> 00:09:34,699
segmentation here to put a barrier in
between these different servers other

110
00:09:34,699 --> 00:09:39,019
research are other articles again talked
about breaking and be the HVAC company

111
00:09:39,019 --> 00:09:43,889
that initial stuff there another soda
sunrise we had the missing alerts

112
00:09:43,889 --> 00:09:49,029
crimes we talked about missing skilled
incident responders this initial access

113
00:09:49,029 --> 00:09:54,140
with the HVAC vendors they just adopted
and then the corruption

114
00:09:54,140 --> 00:09:57,750
didn't go into detail here but this is
basically what the chip is if you've got

115
00:09:57,750 --> 00:10:02,820
a new credit card you got the chip I'm
you put that chip into Target and those

116
00:10:02,820 --> 00:10:07,110
devices never have your credit card
number does basically cryptographic can

117
00:10:07,110 --> 00:10:13,150
check with the bank servers and
shouldn't have her released your credit

118
00:10:13,150 --> 00:10:16,690
card number I'm so she do that that's
certainly one way to to fix this issue

119
00:10:16,690 --> 00:10:20,430
but that's not applicable generally
because a lot of companies are going to

120
00:10:20,430 --> 00:10:23,250
have some some information which they're
gonna need to protect and you can't just

121
00:10:23,250 --> 00:10:26,180
say I am I gonna keep sensitive
information on my network and obviously

122
00:10:26,180 --> 00:10:30,140
minimizing if you can soak up the Sun
investigations against missile Earth's

123
00:10:30,140 --> 00:10:35,770
axis and I'm a presentation a similar
story happened with the Sands Casino

124
00:10:35,770 --> 00:10:42,250
this one I just love the article about
this is just amazing I'm going to read

125
00:10:42,250 --> 00:10:47,190
peace when this attack happened the
computers were flat lining email was

126
00:10:47,190 --> 00:10:50,940
down most of the phones don't work and
several the technology systems that help

127
00:10:50,940 --> 00:10:53,500
to run the fourteen billion dollar
operation had sputtered to a halt

128
00:10:53,500 --> 00:10:57,040
computer engineers at Las Vegas Sands
corporation traced to figure out what

129
00:10:57,040 --> 00:11:02,030
was happening within our head diagnoses
same was under a withering cyberattack

130
00:11:02,030 --> 00:11:06,730
PCs and servers are shutting down a
cascading I T catastrophe with many of

131
00:11:06,730 --> 00:11:10,150
their hard drives wiped clean the
company's technical staff had never seen

132
00:11:10,150 --> 00:11:14,950
anything like it in an effort to save as
many machines as they could I T staffers

133
00:11:14,950 --> 00:11:19,100
scrambled across the casino fall floors
of the sands Vegas properties the

134
00:11:19,100 --> 00:11:23,050
Venetian and the Palazzo ripping network
cards out of every functioning computer

135
00:11:23,050 --> 00:11:28,020
they could find including PCs by pit
bosses to track gamblers and kiosks

136
00:11:28,020 --> 00:11:33,140
where slot players cash in their tickets
so in the middle of Vegas the running

137
00:11:33,140 --> 00:11:38,030
down the hallways yanking the cords out
of the walls to stop the cyber attack

138
00:11:38,030 --> 00:11:41,220
and it wasn't even DEFCON

139
00:11:41,220 --> 00:11:48,240
I'm very disappointed but yeah it was it
was an attack which hit so many their

140
00:11:48,240 --> 00:11:53,290
service across the world some of their
casinos and shutting down a lot of their

141
00:11:53,290 --> 00:11:55,089
operations are costing them

142
00:11:55,089 --> 00:12:01,509
awful lot of money they've been going to
describing how this happens so the

143
00:12:01,509 --> 00:12:06,279
attackers had attempted to gain access
and a few a failed came back they found

144
00:12:06,279 --> 00:12:10,600
a web development server which was
something that the Sands corporation

145
00:12:10,600 --> 00:12:14,610
developer said stood up but they haven't
locked it down it was just a test server

146
00:12:14,610 --> 00:12:18,699
was on their production servers
vulnerability in that compromise that

147
00:12:18,699 --> 00:12:22,649
system to use many cats to steal
passwords they were then able to move

148
00:12:22,649 --> 00:12:29,449
from that service other servers on that
same network that bethlehem I T system

149
00:12:29,449 --> 00:12:34,689
one of those other ones using probably
local administrator credentials and I'm

150
00:12:34,689 --> 00:12:39,509
on one of those will find a domain or
enterprise admin equivalent credential

151
00:12:39,509 --> 00:12:44,249
and that guy's password or total ticket
and then move from there to take over

152
00:12:44,249 --> 00:12:49,800
the entire Active Directory forest that
Las Vegas Sands was using at that point

153
00:12:49,800 --> 00:12:57,129
they control the entire network so again
initially exploit your web server still

154
00:12:57,129 --> 00:13:02,319
passwords repeated that till they found
demand out man and then they deploy

155
00:13:02,319 --> 00:13:05,749
their tax plus the entire network in
this case as far as I know there were no

156
00:13:05,749 --> 00:13:11,459
alerts that were missed their their
initial tack flag similar to but then

157
00:13:11,459 --> 00:13:17,990
their second long did not and then we
have starting saudi riyal Sony and Saudi

158
00:13:17,990 --> 00:13:22,620
Aramco which is a very similar story we
don't know all the details for these

159
00:13:22,620 --> 00:13:28,439
attacks however we do know how that
massive the power was cut across their

160
00:13:28,439 --> 00:13:34,540
network and I was again being a stolen
credentials causing a lot of chaos so we

161
00:13:34,540 --> 00:13:38,679
go again with these breaches what we
have is something that looks like this

162
00:13:38,679 --> 00:13:46,389
in in every case and so we ask yourself
all let's let's plot how the industry is

163
00:13:46,389 --> 00:13:52,160
responding to these breaches and so
you've got number one identified that

164
00:13:52,160 --> 00:13:56,050
initial access make it so they can't get
into our network at all so there's

165
00:13:56,050 --> 00:13:59,600
there's a lot of effort here you have
your vulnerability scanners

166
00:13:59,600 --> 00:14:06,160
we have various penthouse often focus on
this you have you know various types of

167
00:14:06,160 --> 00:14:11,800
firewalls about firewalls and I would
say possibly most of the computer

168
00:14:11,800 --> 00:14:16,009
security industry is is many china stop
that first boxer to from being

169
00:14:16,009 --> 00:14:19,699
compromised and they have an enormous
effort over here on the right side of

170
00:14:19,699 --> 00:14:24,380
the graph to go after that now we're and
so things like you know identified that

171
00:14:24,380 --> 00:14:30,009
black leather that any virus signatures
or threat intelligence was just a fancy

172
00:14:30,009 --> 00:14:35,420
name for anybody signatures you have to
pay for normally can include other

173
00:14:35,420 --> 00:14:39,730
things like IP addresses and techniques
as well but a lot of emphasis on how are

174
00:14:39,730 --> 00:14:44,699
they doing that now how are they doing
these techniques and both of these are

175
00:14:44,699 --> 00:14:51,540
really critical parts of your
information security program but if you

176
00:14:51,540 --> 00:14:55,850
know something kinda happened in the
middle there seems to be pretty

177
00:14:55,850 --> 00:15:01,790
important so what happened right over
here we have been here was the bad guys

178
00:15:01,790 --> 00:15:06,740
steal administrator token because those
credentials were left on a web server

179
00:15:06,740 --> 00:15:12,319
and in all these major breaches what we
find repeatedly is that credential theft

180
00:15:12,319 --> 00:15:17,970
grants you at least 5,000 times the
access that your Explorer social

181
00:15:17,970 --> 00:15:24,259
engineering attacks did some time just
10,000 30,000 times as much access but

182
00:15:24,259 --> 00:15:27,610
it's really credential theft that turns
that one system into

183
00:15:27,610 --> 00:15:34,220
thousands and thousands more and you
know what you find is in my opinion

184
00:15:34,220 --> 00:15:38,200
power to tax and and and software
vulnerabilities aren't the biggest

185
00:15:38,200 --> 00:15:42,360
problem in enterprises leaving on a
credit line around all over the demand

186
00:15:42,360 --> 00:15:48,380
tends to be that problem whose
recognizing this problem well you can

187
00:15:48,380 --> 00:15:53,649
just google target breaks you look for
that it's recommended rentals that

188
00:15:53,649 --> 00:15:57,890
initial access you get almost half a
million results are you look for malware

189
00:15:57,890 --> 00:16:01,519
and you go again almost half a million
results

190
00:16:01,519 --> 00:16:05,339
you know the first page in both of these
instances it's all I mentioned right

191
00:16:05,339 --> 00:16:07,769
there in the title right there in the
headline

192
00:16:07,769 --> 00:16:14,720
you get very few results about the 10th
as many and none of them are in the

193
00:16:14,720 --> 00:16:21,180
headline they're all in like you know
paragraph 11 5 there's there's basically

194
00:16:21,180 --> 00:16:27,800
very little focus on this comparatively
and that's not just and this particular

195
00:16:27,800 --> 00:16:32,310
research that's in the industry as a
whole and I think the biggest one of the

196
00:16:32,310 --> 00:16:38,420
biggest illustrations of this is look at
from for more than 10 years now goes to

197
00:16:38,420 --> 00:16:45,510
15 years Windows has stored complete
passwords in slightly obvious skated it

198
00:16:45,510 --> 00:16:49,649
was implied by documented features
documented at least as far back as 2003

199
00:16:49,649 --> 00:16:56,089
far as I can tell us a lot of people
this was not excluded offensively

200
00:16:56,089 --> 00:17:02,029
certainly not publicly until early 2012
over ten years later when Benjamin Delpy

201
00:17:02,029 --> 00:17:06,620
who's not a dedicated security
researcher was making a hobby project

202
00:17:06,620 --> 00:17:11,750
called many cats which he was using to
learn to program see environment as

203
00:17:11,750 --> 00:17:17,780
authentication and actually look at just
a breaches a few of them we mention but

204
00:17:17,780 --> 00:17:21,010
a lot of other ones just the documented
impact

205
00:17:21,010 --> 00:17:27,300
mimic outs in breaches surpasses that of
virtually any exploit you could say

206
00:17:27,300 --> 00:17:31,169
maybe there's a couple which which
passed it but document impact america s

207
00:17:31,170 --> 00:17:34,230
probably surpasses just about any
explains that we've seen in the past

208
00:17:34,230 --> 00:17:39,960
five years so again credential attacks
tend to lead in real-world impact but

209
00:17:39,960 --> 00:17:43,480
they're still receive very little
research attention compared to more

210
00:17:43,480 --> 00:17:50,920
abilities so why is that and i dont have
a great answer for that I think there's

211
00:17:50,920 --> 00:17:58,170
kind of an attitude of first of a few
visible alternatives and it's a boring

212
00:17:58,170 --> 00:18:05,270
alternatives that say oh well I guess
our our place the blame on the user's

213
00:18:05,270 --> 00:18:09,770
ministers they say well I guess you
shouldn't have a week a surrogacy Center

214
00:18:09,770 --> 00:18:17,480
user password login to that system maybe
you should just reboot er we just kind

215
00:18:17,480 --> 00:18:22,900
of go back to authenticated access we're
going to do about it and there's not a

216
00:18:22,900 --> 00:18:27,910
whole lot of I think imaginative
solutions and some decisions that are

217
00:18:27,910 --> 00:18:36,340
out there tend to be large software
project deployments which can can

218
00:18:36,340 --> 00:18:44,580
certainly help but tend to be a large I
T issue so how do we defend against this

219
00:18:44,580 --> 00:18:51,570
so described his kind of how we approach
this perspective as a security

220
00:18:51,570 --> 00:18:58,050
assessment in one of our security
assessment services I guess first thing

221
00:18:58,050 --> 00:19:03,390
we want to do is identify the
dissemination of credentials so where

222
00:19:03,390 --> 00:19:07,160
are your credentials where they store
where can we find them where they in

223
00:19:07,160 --> 00:19:13,980
memory where they on desk and then once
once you've found that and who they all

224
00:19:13,980 --> 00:19:20,260
correspond to identify which ones are
reviews so who are sharing credentials

225
00:19:20,260 --> 00:19:25,470
and then once you've identified that you
need to identify both direct and

226
00:19:25,470 --> 00:19:30,980
indirect impact of the credentials so
what can those credentials get to and

227
00:19:30,980 --> 00:19:35,840
figure out how to change those together
to get maximum impact looking at just

228
00:19:35,840 --> 00:19:38,500
the impact of the one we are also
looking at the impact of everything that

229
00:19:38,500 --> 00:19:42,940
you can get to from there an
undetermined mechanisms to break those

230
00:19:42,940 --> 00:19:49,220
chains and say where can we can we cut
this off so it doesn't and causing a

231
00:19:49,220 --> 00:19:55,890
cascading failure and then goto cleanup
identify if there's any changes you can

232
00:19:55,890 --> 00:19:59,260
make to help prevent some of the stuff
from happening in the future and of

233
00:19:59,260 --> 00:20:03,320
course continuing to audit so that I
don't just try to clean stuff up and

234
00:20:03,320 --> 00:20:04,660
then leave and then much at all

235
00:20:04,660 --> 00:20:13,640
go back so here's kind of our hand
waving diagram of God scanners which

236
00:20:13,640 --> 00:20:17,650
will go ahead and click on this
information and other collectors that

237
00:20:17,650 --> 00:20:21,830
dedicates pulled back into big data base
and then we do queries on that and kind

238
00:20:21,830 --> 00:20:28,000
of everyone else's for that I so first
of all the scale of the systems do need

239
00:20:28,000 --> 00:20:31,510
to use credentials to do this we don't
benefit either of these are using to

240
00:20:31,510 --> 00:20:37,370
spread this it is a small collector you
can debate till the end of time about

241
00:20:37,370 --> 00:20:41,090
whether you want an agent or whether you
just want to rely on existing log on to

242
00:20:41,090 --> 00:20:47,130
your own code within these are on our
own code method so that we're not

243
00:20:47,130 --> 00:20:52,730
leaving more stuff on the network and we
can account of its more of the

244
00:20:52,730 --> 00:20:58,350
assessment methodology look at the
credentials present this is something

245
00:20:58,350 --> 00:21:05,980
which was certainly more involved than I
realized it would be when you look out

246
00:21:05,980 --> 00:21:10,330
when you start getting into the guts of
how this works we find Microsoft tends

247
00:21:10,330 --> 00:21:11,370
to lie

248
00:21:11,370 --> 00:21:17,890
and its documentation and so Microsoft
has all these explanations of things so

249
00:21:17,890 --> 00:21:23,980
for example tokens which is not a big
swath of stealing your domain

250
00:21:23,980 --> 00:21:28,370
credentials from a single system they
come in two flavors if you read the new

251
00:21:28,370 --> 00:21:31,750
Microsoft documentation there in person
nation tokens and their delegation

252
00:21:31,750 --> 00:21:38,850
tokens and impersonation tokens you
don't really care because impersonation

253
00:21:38,850 --> 00:21:45,760
tokens just means processes running as
if it was a privilege to count on this

254
00:21:45,760 --> 00:21:49,059
system but it doesn't really have that
privilege privileged accounts

255
00:21:49,059 --> 00:21:54,000
credentials to then use against a
different system delegation tokens are

256
00:21:54,000 --> 00:21:57,790
the other kinds delegation tokens are
the all-powerful kind of location tokens

257
00:21:57,790 --> 00:22:04,330
me not only am i operating privileged
admin on this system but I also have

258
00:22:04,330 --> 00:22:07,870
privileged documents credentials and I
can throw them out and a system that I

259
00:22:07,870 --> 00:22:13,260
want and take over those systems I can
then steal and reuses credentials again

260
00:22:13,260 --> 00:22:23,740
documentation and access which has been
done based on previous incognito which

261
00:22:23,740 --> 00:22:26,830
will show you what you have on the
system

262
00:22:26,830 --> 00:22:34,340
unfortunately though quite a few of
those delegation tokens delegation

263
00:22:34,340 --> 00:22:39,400
tokens when you ask windows as a
delegation total say really

264
00:22:39,400 --> 00:22:44,170
or it'll say no it's an impersonation
token but there's really a house or apt

265
00:22:44,170 --> 00:22:50,830
and memory or something like that and so
we can we had done had to do more stuff

266
00:22:50,830 --> 00:22:56,440
or kind of like cats to basically I'd
check in see is this has really in

267
00:22:56,440 --> 00:23:00,140
memory or is this cover us to UT really
in memory

268
00:23:00,140 --> 00:23:07,920
and so so you have to have to do that
and then you also want to look in detail

269
00:23:07,920 --> 00:23:11,580
out what are all these accounts on the
system where all the relevant privilege

270
00:23:11,580 --> 00:23:17,830
assignments so which groups have been
granted which privileges on the system

271
00:23:17,830 --> 00:23:22,140
what configuration details as a system
have caused an independent of effect on

272
00:23:22,140 --> 00:23:27,230
the ability to pass credentials and
identify all these security group

273
00:23:27,230 --> 00:23:30,770
memberships of all accounts on that
system and all the groups on that system

274
00:23:30,770 --> 00:23:36,270
once you've done that you can basically
attempt to recreate that we as a nation

275
00:23:36,270 --> 00:23:41,720
on the other side and I don't know how
that it's happened when we move on to

276
00:23:41,720 --> 00:23:50,570
extracting hashes and so normally you as
as we mentioned he just mentioned in

277
00:23:50,570 --> 00:23:55,950
previous slide extracting two main house
has often been a difficult process which

278
00:23:55,950 --> 00:24:00,280
involves extracting system high and the
anti-assad did file which is huge and

279
00:24:00,280 --> 00:24:04,220
they have to extract has a strong now
which is its own long process which

280
00:24:04,220 --> 00:24:07,500
involves installing pollution
dependencies is really complicated and

281
00:24:07,500 --> 00:24:10,280
there's much python script out there
which don't work for their work on some

282
00:24:10,280 --> 00:24:14,590
like 2k three version but not the to
k-12 version but there's a website

283
00:24:14,590 --> 00:24:19,630
extractor and tedious D-ninety which is
uploaded amino acids and just accepting

284
00:24:19,630 --> 00:24:33,320
and as far as I know it's the works so I
know what we want to do was not that

285
00:24:33,320 --> 00:24:37,370
certainly as they're talking about
before this was something that had on

286
00:24:37,370 --> 00:24:44,580
this what has also now added on some
handling for and that is you don't want

287
00:24:44,580 --> 00:24:49,550
to you ideally don't have to extract
this massive file out and then go run

288
00:24:49,550 --> 00:24:56,460
very intensive operations so our method
actually just as the riders sectors and

289
00:24:56,460 --> 00:25:02,260
then President St Andrews and author of
this kind of like doing about except not

290
00:25:02,260 --> 00:25:03,240
to show

291
00:25:03,240 --> 00:25:09,050
considering structure from there and
then we just cleared the salmon from

292
00:25:09,050 --> 00:25:14,620
registry and so once we have that the
other thing that we do then is we don't

293
00:25:14,620 --> 00:25:18,929
want to contribute to this problem of
grabbing a whole bunch of credentials as

294
00:25:18,929 --> 00:25:23,690
a little bit different goals then does
so rather than store the original hashes

295
00:25:23,690 --> 00:25:27,590
in there but will actually do is we will
pass them again

296
00:25:27,590 --> 00:25:32,830
shot 256 so that if you capture our
hashes you won't be able to replay them

297
00:25:32,830 --> 00:25:38,620
and pass the house somewhere else you'd
have to track them so we will use double

298
00:25:38,620 --> 00:25:44,630
passes which still allows us to check
for reused hashes because the second

299
00:25:44,630 --> 00:25:48,340
half will still be the same if
somebody's reuse their password but

300
00:25:48,340 --> 00:25:54,530
reduces the danger of grabbing a whole
bunch of criminals yourself

301
00:25:54,530 --> 00:25:57,870
all right let's say we've done this on a
couple of systems we've got workstation

302
00:25:57,870 --> 00:26:03,059
workstation bob they both have a guest
account password that's not going to be

303
00:26:03,059 --> 00:26:07,970
useful for anything else has else's
account has got one has bob has bob's

304
00:26:07,970 --> 00:26:11,700
accounts got a different house no
problem there a way they both got a

305
00:26:11,700 --> 00:26:17,300
local administrator account and it's got
the same hash and saw this point you

306
00:26:17,300 --> 00:26:22,350
might be thinking somebody from could
compromise on these workstations pass a

307
00:26:22,350 --> 00:26:27,390
house over to the other line so in
reality again I they would be just

308
00:26:27,390 --> 00:26:35,870
imagine like a funny facebook video if
the Derby was working but it wasn't and

309
00:26:35,870 --> 00:26:42,679
that fails so you might ask yourself
okay well why did this fail

310
00:26:42,679 --> 00:26:45,670
administrators in the Administrators
group most of the time this one actually

311
00:26:45,670 --> 00:26:52,360
does succeed but it might fail and so we
found is that so what we're doing is

312
00:26:52,360 --> 00:26:56,800
we're taking account tracing its rights
through its any groups that it's a

313
00:26:56,800 --> 00:27:01,309
membership of and where those rights are
sign and so you can see

314
00:27:01,309 --> 00:27:05,120
the local Administrators group has been
granted

315
00:27:05,120 --> 00:27:08,749
well it's on the screen but the Local
History Group by the fall is granted US

316
00:27:08,749 --> 00:27:12,620
network logon write a bunch of other
rights like has he taken a shipwright

317
00:27:12,620 --> 00:27:17,830
and others which equate town in control
and so many of the measures group

318
00:27:17,830 --> 00:27:22,080
generally do work for this exact or
however you want to take over that

319
00:27:22,080 --> 00:27:27,230
remote system except if there's this
setting introduced to mister which is

320
00:27:27,230 --> 00:27:37,259
the UAC which box all the administrators
from remotely other local administrators

321
00:27:37,259 --> 00:27:42,659
from remotely on taking under that
system with network logo except if its

322
00:27:42,659 --> 00:27:45,610
debts 500 local administrator account is
to build an administrator account

323
00:27:45,610 --> 00:27:50,409
usually named administrator must
strengthen its like to order something

324
00:27:50,409 --> 00:27:55,129
like that but it's still under 500 so we
just called the building administrator

325
00:27:55,129 --> 00:28:01,369
account but that will still work even
investing later except when it doesn't

326
00:28:01,369 --> 00:28:05,070
work and it doesn't work well in that
setting you I see something is a

327
00:28:05,070 --> 00:28:07,929
different setting is set to admin
approval mode for the built-in

328
00:28:07,929 --> 00:28:14,700
administrator account this is important
because you can you can run into

329
00:28:14,700 --> 00:28:19,529
environments where hopefully they have
this one sets of this one is set in the

330
00:28:19,529 --> 00:28:25,149
local admin accounts can be used to
copious exact over to another local

331
00:28:25,149 --> 00:28:29,869
admin box even if they have the same
password and we need to be able to

332
00:28:29,869 --> 00:28:34,429
identify that correctly and one of the
one of the issues that have to start

333
00:28:34,429 --> 00:28:36,179
talking about stuff like this

334
00:28:36,179 --> 00:28:40,970
authentication you find a lot of people
say I will the building industry council

335
00:28:40,970 --> 00:28:45,340
worker passed the House and then just
stop there and we find

336
00:28:45,340 --> 00:28:50,090
actually there's so many settings
normally normally you can't just say

337
00:28:50,090 --> 00:28:54,200
this work so this doesn't work you
actually have to check all the non

338
00:28:54,200 --> 00:28:58,110
default settings and all the non-default
registry keys to see how was it really

339
00:28:58,110 --> 00:29:01,220
configured because something which
normally isn't an issue might be an

340
00:29:01,220 --> 00:29:05,490
issue or something which normally is
this you might not all right so we try

341
00:29:05,490 --> 00:29:07,230
again

342
00:29:07,230 --> 00:29:15,890
that back to the default and try to go
execute that fails again right now what

343
00:29:15,890 --> 00:29:21,420
might be the issue week blocked by
firewall to authenticate as anybody know

344
00:29:21,420 --> 00:29:30,030
what could still block it's still
granted but that is something I could

345
00:29:30,030 --> 00:29:40,270
could granite well logging times is
something that could be an issue in this

346
00:29:40,270 --> 00:29:45,390
case but I didn't like I was configured
to force guests the first guest is the

347
00:29:45,390 --> 00:29:52,250
default on non Domain Join systems and
it corresponds to a setting here which

348
00:29:52,250 --> 00:29:59,440
says no network sharing access and
security model for local accounts and if

349
00:29:59,440 --> 00:30:02,560
thats at two guests only which is the
default on my competitions are not to

350
00:30:02,560 --> 00:30:05,960
mention systems which corresponds to
simple file sharing then you will be

351
00:30:05,960 --> 00:30:10,400
blocked even if you have an account even
if it is the five hundred or USC has

352
00:30:10,400 --> 00:30:15,040
turned off you will still be blocked
from his exact and according to

353
00:30:15,040 --> 00:30:21,710
Microsoft documentation force gassed
prevents local administrators or should

354
00:30:21,710 --> 00:30:26,540
have a phrase that his first guest
forces all local council authenticate as

355
00:30:26,540 --> 00:30:30,570
the guest accounts when enabled and it
is not enabled by default under

356
00:30:30,570 --> 00:30:42,010
management systems so what happens when
you turn it on a dimension system that

357
00:30:42,010 --> 00:30:46,770
thoughts but that is not the case as a
documentation so his first guests only

358
00:30:46,770 --> 00:30:51,280
applies to the local accounts however
the documentation is wrong

359
00:30:51,280 --> 00:30:56,000
first guest has no effect whatsoever and
even though it says the box and it

360
00:30:56,000 --> 00:31:00,330
doesn't actually block it so that was a
surprise to me again in the past few

361
00:31:00,330 --> 00:31:07,590
months actually testing some of the
stuff so basically off on occasions

362
00:31:07,590 --> 00:31:11,470
complicated again we have the special
rights assignment we didn't go into you

363
00:31:11,470 --> 00:31:14,990
could add some unease account to the
icd-9 are calling on access right even

364
00:31:14,990 --> 00:31:19,790
if they had access right or you can vote
as a network LAN access right and still

365
00:31:19,790 --> 00:31:26,390
block it in and versions of Windows
equivalent to seven or later with

366
00:31:26,390 --> 00:31:32,280
sufficient Service Pack are you can you
can do special sit restrictions so you

367
00:31:32,280 --> 00:31:37,420
can apply those rights are denied their
rights to only local councils a special

368
00:31:37,420 --> 00:31:41,140
set for that or local council member of
the Administrators group across this

369
00:31:41,140 --> 00:31:43,980
firewall policies which you can run into

370
00:31:43,980 --> 00:31:48,810
alright so I've done all that I've
turned USC up all the way I have blocked

371
00:31:48,810 --> 00:31:52,680
the local council must not working on
right via special some restrictions on

372
00:31:52,680 --> 00:32:00,400
good right accepts do not cause all that
works for service management like this

373
00:32:00,400 --> 00:32:04,730
exact it all works for remote file share
access which you can use to achieve code

374
00:32:04,730 --> 00:32:09,440
execution via something called the WBT
best method and you can use remote

375
00:32:09,440 --> 00:32:15,390
registry access and task management
Windows Management all which ride off of

376
00:32:15,390 --> 00:32:20,240
amateur separate mechanisms of taking
over a standard Windows system and I'll

377
00:32:20,240 --> 00:32:24,670
get right off the network log on and
it's important to consider all of these

378
00:32:24,670 --> 00:32:29,450
because when I frequently see isn't
companies all say what we're blocking

379
00:32:29,450 --> 00:32:33,320
windows remote management so you know
we're gonna stop all that

380
00:32:33,320 --> 00:32:37,230
you know hackers from taking advantage
of that and really hackers have at least

381
00:32:37,230 --> 00:32:40,720
five other choices which they can use to
achieve the same as all which is popping

382
00:32:40,720 --> 00:32:47,850
your box and so a lot of times these
restrictions are particularly valid for

383
00:32:47,850 --> 00:32:53,740
the block lots of them except for one
and so so you have all that and all

384
00:32:53,740 --> 00:32:58,870
works for network log onto there's a
completely different set of rules for

385
00:32:58,870 --> 00:33:05,740
remote desktop so UAC settings which
blocked your accounts don't affect it

386
00:33:05,740 --> 00:33:09,870
however that's ok though because you
need an actual password to do remote

387
00:33:09,870 --> 00:33:15,059
desktop except you don't need an actual
password to do remote desktop log on and

388
00:33:15,059 --> 00:33:19,970
when is a point one and later because
there's this great security feature

389
00:33:19,970 --> 00:33:23,549
called restricted admin mode remote
desktop and restricted mode is great

390
00:33:23,549 --> 00:33:27,940
because basically you can pass the house
to remote desktop without knowing what

391
00:33:27,940 --> 00:33:34,970
the password is and and still get remote
desktop once you've done that your count

392
00:33:34,970 --> 00:33:39,480
on that remote side won't have your
password and memory like it otherwise

393
00:33:39,480 --> 00:33:43,909
would have so it's a way to help avoid
spreading your credentials if you're

394
00:33:43,909 --> 00:33:47,519
doing you know domain management you
should use restricted a minute because

395
00:33:47,519 --> 00:33:51,200
then you don't give your credentials
after that remote system but it does

396
00:33:51,200 --> 00:33:56,090
have the side effect of undermining all
the USC restrictions which prevented

397
00:33:56,090 --> 00:34:01,740
lateral movement to the local using the
local workstation accounts and you have

398
00:34:01,740 --> 00:34:07,159
to use restricted with us low counts and
so of course it's got its own set of

399
00:34:07,159 --> 00:34:12,419
serum 0 interactive logon right Sandusky
deny remote interactive logon rights to

400
00:34:12,419 --> 00:34:19,550
enable or disable that alright I have
nothing open I've got two main box it's

401
00:34:19,550 --> 00:34:22,659
got remote desktop disabled yes

402
00:34:22,659 --> 00:34:35,429
so if you so yes kind of if you start
off with remote desktop connection and

403
00:34:35,429 --> 00:34:39,500
you don't specifically asked for
restricted admin it will give you a

404
00:34:39,500 --> 00:34:44,889
non-restricted out so you have to know
that on as a separate switch on Dec

405
00:34:44,889 --> 00:34:50,720
command prompt and I'll talk a little
bit about medications at the end i cant

406
00:34:50,720 --> 00:34:57,380
force that in a bit so nothing's open so
we've got to know just how to disable we

407
00:34:57,380 --> 00:35:01,680
turn the firewall to block all of those
network logon ne law any inbound

408
00:35:01,680 --> 00:35:06,569
connection whatsoever so the question is
can you this box is just sitting there

409
00:35:06,569 --> 00:35:11,180
in the middle of the room nobody's
touching you can target a user without

410
00:35:11,180 --> 00:35:22,950
using an exploit can you pop this box if
they have any ideas are laws blocking

411
00:35:22,950 --> 00:35:27,990
that so you you've you've put everyone
in the tonight we're going on you put

412
00:35:27,990 --> 00:35:34,700
your firewall off they can't connect to
you can control your system

413
00:35:34,700 --> 00:35:46,220
yep that's right of course you can pop
it comes to demand you my group policy

414
00:35:46,220 --> 00:35:52,680
to it to set a particular registry key
like a happenin else and then it goes

415
00:35:52,680 --> 00:36:00,230
and folded lol from your server code
execution in about 20 minutes to an hour

416
00:36:00,230 --> 00:36:05,480
again with anybody ever touching it so
you you've got other methods like that

417
00:36:05,480 --> 00:36:08,750
so why do we care about all the
nitty-gritty details of Windows

418
00:36:08,750 --> 00:36:13,720
authentication well if you can do to
show false positives are you get treated

419
00:36:13,720 --> 00:36:18,980
like the network intrusion detection
systems or like the vulnerability

420
00:36:18,980 --> 00:36:23,410
scanners this is a pet peeve of mine you
look at a take home until the skin of a

421
00:36:23,410 --> 00:36:28,859
PHP installation for example they'll say
ok this is PHP 5.2 let me look up how

422
00:36:28,859 --> 00:36:33,530
you've got five thousand sea bees on PHP
5.2 and here they all are and it looks

423
00:36:33,530 --> 00:36:48,900
awful if you actually look at with us
these are 99% of 90 percent of them are

424
00:36:48,900 --> 00:36:54,720
irrelevant to you they only apply if you
are let's say running a shared hosting

425
00:36:54,720 --> 00:37:01,130
provider and you run untrusted PHP code
from somebody else they could use that

426
00:37:01,130 --> 00:37:06,109
PHP code to get code execution which is
a stupid security model anyway if your

427
00:37:06,109 --> 00:37:09,530
gonna let me run PHP coated just treated
as equivalent to code execution because

428
00:37:09,530 --> 00:37:14,840
it's basically an exclusion and yet
because somebody somewhere tries to make

429
00:37:14,840 --> 00:37:20,740
that a security barrier of 10,000 TV's
most of them are just meeting us so we

430
00:37:20,740 --> 00:37:24,710
want to avoid doing that for want to
tell you you've got social depth here I

431
00:37:24,710 --> 00:37:25,900
want that to be accurate

432
00:37:25,900 --> 00:37:33,090
alright so we put it all together I put
up three systems test two main

433
00:37:33,090 --> 00:37:41,619
controller the other ones are demanding
workstation pull our our data back and

434
00:37:41,619 --> 00:37:48,150
so the question is what happens if you
know bill learning from a char gets his

435
00:37:48,150 --> 00:37:53,300
password mister compromised her runs an
executable or something like that so

436
00:37:53,300 --> 00:37:55,380
it's what happens

437
00:37:55,380 --> 00:38:01,690
so here's bill done and what we found
was bologna has a reuse passwords so we

438
00:38:01,690 --> 00:38:06,819
can all hang from from his circle to the
credential circle their corresponding to

439
00:38:06,819 --> 00:38:15,650
that reuse credential there's a lot of
other people share his password will

440
00:38:15,650 --> 00:38:19,500
just say this is very similar to
basically every real network we've

441
00:38:19,500 --> 00:38:24,460
scanned it shouldn't be too much of a
surprise so we see is often times a lot

442
00:38:24,460 --> 00:38:28,960
of used Ford engines not just with an
atom and security you find another few

443
00:38:28,960 --> 00:38:34,789
other accounts no privilege to meet
users are anything but you also find the

444
00:38:34,789 --> 00:38:40,569
local admin accounts of at least two
systems and so these are the two

445
00:38:40,569 --> 00:38:45,730
workstations and so once you have those
accounts those accounts have rights over

446
00:38:45,730 --> 00:38:54,240
their respective Workstation 390 all the
links there and then you look at those

447
00:38:54,240 --> 00:38:59,319
workstations those then have access to
whole lot more account so they've got

448
00:38:59,319 --> 00:39:04,259
access to all the hashes of their local
counts but as we can see at least one of

449
00:39:04,259 --> 00:39:12,700
them also house a token jurassic which
is the demand user sterling . Archer

450
00:39:12,700 --> 00:39:19,660
Archer has privileges to do pretty much
anything he's a domain administrator

451
00:39:19,660 --> 00:39:24,470
city that has rights over the domain
controller which is class which then at

452
00:39:24,470 --> 00:39:29,789
that point of course has all the rest of
the ashes from the domain users on it

453
00:39:29,789 --> 00:39:34,710
now leading to complete the main
compromise and so are you are you found

454
00:39:34,710 --> 00:39:39,220
here is that when you when you put
together not just what does this guy

455
00:39:39,220 --> 00:39:44,500
have rights to which is like most I T
analysts are looking out there saying

456
00:39:44,500 --> 00:39:49,410
what's what's his group to see other
property rights yeah looks good but also

457
00:39:49,410 --> 00:39:50,990
where can he go from there

458
00:39:50,990 --> 00:39:55,539
not just directly but indirectly by
calling all those links and we found is

459
00:39:55,539 --> 00:40:01,210
that about half the accounts and all of
the systems in the demand are equivalent

460
00:40:01,210 --> 00:40:02,420
to fill them in control

461
00:40:02,420 --> 00:40:09,190
and that's generally regarded as a bad
thing and that was just the shortest

462
00:40:09,190 --> 00:40:14,069
path that we draft from that account to
fill them in control there's also lots

463
00:40:14,069 --> 00:40:18,369
of other password you can also take to
get you the same result

464
00:40:18,369 --> 00:40:27,700
leaving Harry must to to clean up so the
question as the way you want to find is

465
00:40:27,700 --> 00:40:33,390
where where can you make the biggest
difference because again you don't start

466
00:40:33,390 --> 00:40:36,740
off with you you do want to fix all of
these but you want to be able to say

467
00:40:36,740 --> 00:40:41,619
what's the biggest deal so we're done
here as we said what what happens we

468
00:40:41,619 --> 00:40:48,299
disable the sterling Archer account and
then in that case of this guy who is our

469
00:40:48,299 --> 00:40:52,450
trouble and who went logged in to work
stations and involved in too if he had

470
00:40:52,450 --> 00:41:07,910
not done that this is what the new graph
looks like and so you have to control

471
00:41:07,910 --> 00:41:12,640
these are always going to be read minds
is always good to have full control

472
00:41:12,640 --> 00:41:18,510
that's expected but now this year is now
yellow and yellow is better than right

473
00:41:18,510 --> 00:41:24,960
and so yellow is all of your work
stations in local counts there I still

474
00:41:24,960 --> 00:41:29,460
their own issues we are now they've got
to use the service is bad thing but at

475
00:41:29,460 --> 00:41:33,579
least they're not equivalent to fill
them in control now so it kind of

476
00:41:33,579 --> 00:41:37,430
identify what the problem is at least a
little bit better and we can move

477
00:41:37,430 --> 00:41:43,020
forward from that point on you know
figure out whose is causing issues so

478
00:41:43,020 --> 00:41:43,960
again

479
00:41:43,960 --> 00:41:48,859
fished it still bad but it's not
immediately earnestly catastrophic you

480
00:41:48,859 --> 00:41:56,819
more chance to catch things alright so
now we know what the issue is how to

481
00:41:56,819 --> 00:42:02,220
clean up for it how do we prevent these
types of issues from happening and so

482
00:42:02,220 --> 00:42:05,650
one of the things that you can do is
start applying some of those

483
00:42:05,650 --> 00:42:09,559
those deny network access long gun
rights apply to all the groups can

484
00:42:09,559 --> 00:42:14,920
certainly all the local groups are they
shouldn't be using remote network access

485
00:42:14,920 --> 00:42:24,250
we also want to enforce on your domain
users are restricted admin if if we can

486
00:42:24,250 --> 00:42:31,799
do that so in in any instance in which
you're doing this you're probably going

487
00:42:31,799 --> 00:42:37,640
to have some system in which they're
going to want to double hot from and you

488
00:42:37,640 --> 00:42:43,589
can teach them how to manually do that
or you can add that as an exception and

489
00:42:43,589 --> 00:42:47,779
and this this is what I really don't
like about Windows there's basically two

490
00:42:47,779 --> 00:42:50,960
main modes you can do this you can do it
as default give your credentials away

491
00:42:50,960 --> 00:42:55,440
that's a bad thing that's how things are
normally done now or you can have as

492
00:42:55,440 --> 00:42:59,400
forced nobody can give their credentials
away unless there's a specific exception

493
00:42:59,400 --> 00:43:05,039
I really wish in a future version of
Windows Microsoft people here I really

494
00:43:05,039 --> 00:43:08,329
wish they would make it so that you
could set a default don't give your

495
00:43:08,329 --> 00:43:12,730
credentials away but you can add a
special flag if you really need to and

496
00:43:12,730 --> 00:43:18,640
then you won't have as much of an admin
report but as it is I definitely

497
00:43:18,640 --> 00:43:22,990
recommend this if you can do it you
going to group policy on you you flip

498
00:43:22,990 --> 00:43:30,730
the switches to disable delegating same
credentials to remote servers and other

499
00:43:30,730 --> 00:43:35,529
delegations settings and you can avoid
giving your kids away and this could

500
00:43:35,529 --> 00:43:36,819
stop by the fall

501
00:43:36,819 --> 00:43:45,400
always happen in restricted and I what
else can you do if somebody does have to

502
00:43:45,400 --> 00:43:48,420
go put in their credentials into a box
the best thing you want to do is you

503
00:43:48,420 --> 00:43:53,180
want to make sure that those credentials
in get invalidated as quickly as

504
00:43:53,180 --> 00:43:53,960
possible

505
00:43:53,960 --> 00:44:00,300
and so the best way to do that and also
help solve like 15 other issues with

506
00:44:00,300 --> 00:44:05,180
passwords being stolen and reused and
because I'm going to you

507
00:44:05,180 --> 00:44:10,290
network you're going to see just as many
reused as they do everywhere else you

508
00:44:10,290 --> 00:44:14,680
see just as my awful passer as they do
everywhere else and most of our can be

509
00:44:14,680 --> 00:44:19,859
tracked just like everywhere else so I
recommend using smart cards with an

510
00:44:19,859 --> 00:44:23,130
offline CIA and that's something that we
do detect by the way

511
00:44:23,130 --> 00:44:29,089
popping a lot of people do an online CA
so if you are able to company has one CA

512
00:44:29,089 --> 00:44:33,650
which is maybe a support group but
doesn't matter that CA is in the trusted

513
00:44:33,650 --> 00:44:40,280
chain as your auntie off store on your
DC's then you can issue your self

514
00:44:40,280 --> 00:44:46,650
certificates valid for smart card logon
and then use that to to gain control the

515
00:44:46,650 --> 00:44:53,609
demand so you definitely want to at
least highly restricted those who fall

516
00:44:53,609 --> 00:45:00,990
offline CIA but maybe you can rotate and
revoke regular schedule do you search

517
00:45:00,990 --> 00:45:16,109
that on the network permanently there
and back again so that is that certainly

518
00:45:16,109 --> 00:45:22,040
helps a lot if you use a hardware
security module HSM they can so that

519
00:45:22,040 --> 00:45:28,920
will prevent you from stealing the
actual CA route or the actual CAS

520
00:45:28,920 --> 00:45:32,369
private key but you can still get
control that CA and issue yourself

521
00:45:32,369 --> 00:45:38,470
assert which is valid for as long as the
CIA is valid so you know there's there's

522
00:45:38,470 --> 00:45:47,140
still doubt potential there so it's here
I also highly recommend unlikely and

523
00:45:47,140 --> 00:45:53,740
daily randomizing voters smart card user
hashes and every I would recommend every

524
00:45:53,740 --> 00:45:58,170
week randomizer TGT hashes we've never
hung philosophical discussions on how

525
00:45:58,170 --> 00:46:01,540
frequently you should do that if you do
it every week you have very little

526
00:46:01,540 --> 00:46:09,920
chance of you have no chance of an
existing Kerberos ticket and if you use

527
00:46:09,920 --> 00:46:16,240
the Microsoft script to do so you've got
very very very small chance issuing

528
00:46:16,240 --> 00:46:22,080
tickets which are involved and
uncertainties but that is the account

529
00:46:22,080 --> 00:46:26,359
password which is used for Kerberos
authentication if you still that crashed

530
00:46:26,359 --> 00:46:30,330
and you can trust tickets forever and
all that has changed and it's only

531
00:46:30,330 --> 00:46:36,750
changed if you do it so you need to do
that what else so authentication

532
00:46:36,750 --> 00:46:40,130
policies in silence and this is
something which is really cool

533
00:46:40,130 --> 00:46:47,150
something which has been added to 2012
are too and later versions of Windows

534
00:46:47,150 --> 00:46:52,030
domain prior to 2012 hard to basically
you could restrict log on workstations

535
00:46:52,030 --> 00:46:55,080
you can restrict the target long gone

536
00:46:55,080 --> 00:46:59,560
of a particular count but you cannot
restrict the source of that account that

537
00:46:59,560 --> 00:47:03,900
occasion policies in silence can do that
for you can make it so even if I have

538
00:47:03,900 --> 00:47:08,970
stolen your credentials if I'm not
coming from a system which is necessary

539
00:47:08,970 --> 00:47:17,589
for me to come from then I still get
denied that's really cool thing that

540
00:47:17,589 --> 00:47:22,710
they've added however that one is
comforted to configure but sometimes

541
00:47:22,710 --> 00:47:27,060
we're going to do if your gonna have
some of the service has to run as admin

542
00:47:27,060 --> 00:47:32,369
has to have a password says which is a
really terrible thing and it has to have

543
00:47:32,369 --> 00:47:36,720
network logon rights and if that's the
case I would advise finding different

544
00:47:36,720 --> 00:47:40,460
vendor but sometimes there's there's
those situations in which you've got

545
00:47:40,460 --> 00:47:44,339
this terribly insecure thing and at
least for now you can't change that you

546
00:47:44,339 --> 00:47:47,070
can use something like that occasion
policy since I was to help mitigate that

547
00:47:47,070 --> 00:47:51,480
risk so that doesn't become as much of
an issue

548
00:47:51,480 --> 00:47:57,520
what else I would recommend walking
until at least in bound for all Windows

549
00:47:57,520 --> 00:48:06,080
Domain systems makes makes passing the
house the whole lot harder you can you

550
00:48:06,080 --> 00:48:10,619
can no longer directly passed the house
you can still overpass the picket if

551
00:48:10,619 --> 00:48:14,550
pass along on his allowed so again if
you if you do this

552
00:48:14,550 --> 00:48:19,010
anyone for smart card logon then you've
got no saved threads on the network or

553
00:48:19,010 --> 00:48:23,940
in memory at any time for that that
account so this is this is really nice

554
00:48:23,940 --> 00:48:30,560
the biggest thing I found that this
doesn't work on as if you disable and

555
00:48:30,560 --> 00:48:35,859
authentication entirely outbound and
then you have like somewhere printer or

556
00:48:35,859 --> 00:48:42,859
somewhere proxy which only works with
and those don't work but you can disable

557
00:48:42,859 --> 00:48:47,980
inbound on your Windows systems and
that's a lot easier you can have

558
00:48:47,980 --> 00:48:52,630
exceptions if you will and that will
that will prevent a lot of these

559
00:48:52,630 --> 00:48:58,010
countries tax alright so that was kind
of on our defensive side offensively

560
00:48:58,010 --> 00:49:02,090
what can we do this and what I
understand I'm the only thing standing

561
00:49:02,090 --> 00:49:09,180
between you and freedom is running late
already so offensively what you want to

562
00:49:09,180 --> 00:49:16,260
do is about to capture using dumping
couches if you map out the network like

563
00:49:16,260 --> 00:49:21,650
we do defensively you can identify lot
of locations to persist

564
00:49:21,650 --> 00:49:26,690
whips which are great trading places and
will have access to those credentials on

565
00:49:26,690 --> 00:49:30,770
so that's a really useful way to do this
a lot of times it seems like to make

566
00:49:30,770 --> 00:49:35,550
controllers and other servers they get
the tighter security policies to get the

567
00:49:35,550 --> 00:49:40,090
tighter inspection I mean you can kind
of avoid leaving your persistence there

568
00:49:40,090 --> 00:49:45,790
another thing that we did was let's say
you want to figure out how passionately

569
00:49:45,790 --> 00:49:51,690
use happens one option is to get a
username and password and try that

570
00:49:51,690 --> 00:49:55,260
against everything on this is kind of a
bad idea because you could lock out

571
00:49:55,260 --> 00:49:55,920
accounts

572
00:49:55,920 --> 00:50:03,230
you might love to have one of those so
how else do you identify final count has

573
00:50:03,230 --> 00:50:08,170
the same pass your house where Sam how's
your password

574
00:50:08,170 --> 00:50:15,559
nothing that you can do is to set up
until capture server distributes ePals

575
00:50:15,559 --> 00:50:21,650
around washington Mt long challenge
response come back and then apply then

576
00:50:21,650 --> 00:50:26,049
try brute force those offline so to my
knowledge power before prior to us

577
00:50:26,049 --> 00:50:32,040
releasing the script nobody have found a
way of doing this with the hashes alone

578
00:50:32,040 --> 00:50:36,950
there are various systems out there like
go see a house cat which will allow you

579
00:50:36,950 --> 00:50:41,119
to brute force the challenge response
just with the challenge response and

580
00:50:41,119 --> 00:50:47,940
they're going for passwords but what we
what we did was we wrote a script that

581
00:50:47,940 --> 00:50:51,460
allow you to do it with a hash so if
you've captured the house industry you

582
00:50:51,460 --> 00:50:55,660
somewhere else and you can't crack it no
matter how good the password is a you

583
00:50:55,660 --> 00:51:06,230
can still identify if it's been reused
on another account do that test here all

584
00:51:06,230 --> 00:51:37,460
right so we have a system here are
victims one system and we've got think

585
00:51:37,460 --> 00:51:42,890
they're here know they are somewhere
else will find it later on the desktop

586
00:51:42,890 --> 00:51:49,299
so here's our here's our house and we
don't it from somewhere else refuses any

587
00:51:49,299 --> 00:51:58,170
of these hashes without being able to
track them I'm so going to use server

588
00:51:58,170 --> 00:52:12,620
capture and we are at 2261 and so we
read a link or something over give them

589
00:52:12,620 --> 00:52:21,490
a link to click on and they go to one
and when we got home town responses

590
00:52:21,490 --> 00:52:26,990
using our spoofs challenges so we can
see its user bobbed up Parker coming

591
00:52:26,990 --> 00:52:33,170
from and he's got these various
challenges as what we do is we do will

592
00:52:33,170 --> 00:52:44,150
be captured house check and this every
day we give it the account name which is

593
00:52:44,150 --> 00:52:53,440
Bob Barker we give it the client
challenge which we cut from here the one

594
00:52:53,440 --> 00:53:02,860
that says client challenge to me but
that there we do

595
00:53:02,860 --> 00:53:08,310
domain which is whatever they told us
the new man murders which in this case

596
00:53:08,310 --> 00:53:21,250
is this done and then we do the ante has
response which is in the section called

597
00:53:21,250 --> 00:53:31,440
and tea house and redo the server to
challenge which in this case of default

598
00:53:31,440 --> 00:53:38,310
because we're on our own we ran our own
capture server which spoofs there is no

599
00:53:38,310 --> 00:53:52,940
need for that in there and we will test
this file which is ashes and we run outs

600
00:53:52,940 --> 00:54:00,829
we found matching hash hash we've
identified that this new account that we

601
00:54:00,829 --> 00:54:04,859
did have the house for has a reuse house
of account we did have a house fire in

602
00:54:04,859 --> 00:54:07,270
this new account might be more
privileged and we can then use its

603
00:54:07,270 --> 00:54:10,569
credentials cache and take over from
there

604
00:54:10,569 --> 00:54:20,290
that's our demo is most certainly
genuine alright that's in the 1999

605
00:54:20,290 --> 00:54:29,329
repository on github I think it's
actually 909 be somebody else had taken

606
00:54:29,329 --> 00:54:41,890
the repository which we've done all
right so pay attention across the

607
00:54:41,890 --> 00:54:49,599
country search directory and credit
check your privilege identify new

608
00:54:49,599 --> 00:54:56,869
channels and use them to your sister too
offensive or defensive work whenever you

609
00:54:56,869 --> 00:54:57,500
can

610
00:54:57,500 --> 00:55:06,650
are there any questions

611
00:55:06,650 --> 00:55:18,359
derived credentials so so like what
specifically so they're likes you know

612
00:55:18,359 --> 00:55:23,089
they're they're things like Kerberos
tickets which you get past the original

613
00:55:23,089 --> 00:55:27,359
post where's my car to do whatever else
you get that ticket and that's good for

614
00:55:27,359 --> 00:55:34,290
a certain period of time and those can
be stolen but aren't necessarily valid

615
00:55:34,290 --> 00:55:36,420
for as long as the other ones

