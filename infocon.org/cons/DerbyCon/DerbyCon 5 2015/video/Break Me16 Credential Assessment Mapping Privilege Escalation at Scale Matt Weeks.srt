1
00:00:00,000 --> 00:00:07,040
aligning Galliano paint decorating just
down the road from from my house at

2
00:00:07,040 --> 00:00:15,460
seven oh yeah that's right you also have
the Alamo

3
00:00:15,460 --> 00:00:22,550
all right let's go to good or actual
presentation here which is on credential

4
00:00:22,550 --> 00:00:32,650
assessment and so I'm not weeks I'm
script junkie and not script he won the

5
00:00:32,650 --> 00:00:37,660
2005 registered and then they later gave
it up and I still can get it back so I'm

6
00:00:37,660 --> 00:00:49,590
skip 21 on Twitter in your hand outs so
just a little bit about motivation

7
00:00:49,590 --> 00:00:54,850
behind this talk when I started I said
the first things that I didn't security

8
00:00:54,850 --> 00:00:59,899
I done more in in the software
development side of things and then

9
00:00:59,899 --> 00:01:04,870
called you start to get interested in
security learn all I could started to

10
00:01:04,870 --> 00:01:09,960
look for vulnerabilities and exploits
440 availabilities sold a few of those

11
00:01:09,960 --> 00:01:15,370
that was kind of an accident continue in
that direction although I have done for

12
00:01:15,370 --> 00:01:22,899
you since then I did a in addition to
see as majored in math major research

13
00:01:22,899 --> 00:01:31,250
for my project I broke Chinese code then
when I went in to actually get a job

14
00:01:31,250 --> 00:01:35,040
after graduating my first a lot of work
in the forensics and reverse engineering

15
00:01:35,040 --> 00:01:42,200
world soda lot of fun part binaries
looking through logs and Masterfile

16
00:01:42,200 --> 00:01:48,710
tables and all that kind of thing I then
moved into similar area into enterprise

17
00:01:48,710 --> 00:01:53,670
operations so looking at finding our
customer network I know how people were

18
00:01:53,670 --> 00:01:57,840
moving through the network adding that
work getting into

19
00:01:57,840 --> 00:02:02,079
adversaries see two channels and doing
lots of interesting things of that and

20
00:02:02,079 --> 00:02:07,740
then red teaming which I've done little
bit as part of that also a lot with for

21
00:02:07,740 --> 00:02:14,799
example CCDC and some other places as
well done some defensive development

22
00:02:14,799 --> 00:02:21,140
which is my current job now which is
writing software for doing things and

23
00:02:21,140 --> 00:02:28,150
identifying weaknesses in that works for
the image helps to do that which is not

24
00:02:28,150 --> 00:02:32,660
to say go look at me I've been out here
there are certainly people if you look

25
00:02:32,660 --> 00:02:36,420
at things like exploit development
people have spent a whole lot more time

26
00:02:36,420 --> 00:02:42,180
than I have in that world and are better
at that than I am but having a glimpse

27
00:02:42,180 --> 00:02:46,349
of a lot of normally very separate
fields I'm you start to see a lot of

28
00:02:46,349 --> 00:02:52,690
disconnects between that and so I'm
gonna talk about one of those here but a

29
00:02:52,690 --> 00:02:57,870
lot of times we see this happens due to
kind of a pigeon-holed focus on one area

30
00:02:57,870 --> 00:03:05,060
or one thing that you see a lot of a
team or say how you define some guys

31
00:03:05,060 --> 00:03:09,180
done anything you really need to do
offensive to see the picture and some

32
00:03:09,180 --> 00:03:12,139
extent that's true but you also need to
see the defensive side of the writers

33
00:03:12,139 --> 00:03:16,639
are you end up with some some very not
the best suggestions for fixing the

34
00:03:16,639 --> 00:03:23,849
problems that you find and sometimes you
find attention on certain things due to

35
00:03:23,849 --> 00:03:28,340
financial bias you just have to look at
your typical vendor area and

36
00:03:28,340 --> 00:03:33,269
advertisements not so much in Derby Conn
below the vendors you know like to

37
00:03:33,269 --> 00:03:38,370
advertise you just let this box I'm not
working I will fix everything obviously

38
00:03:38,370 --> 00:03:43,470
they have a financial incentive to do
that other times you find a lot of it

39
00:03:43,470 --> 00:03:48,880
attention in the research world and to
some extent conference world on the new

40
00:03:48,880 --> 00:03:55,510
and exciting new bright shiny objects
versus you know the old the normal you

41
00:03:55,510 --> 00:04:02,920
know things that you need to do to take
care of your network here so one of the

42
00:04:02,920 --> 00:04:05,880
big things which has been attracting a
lot of attention recently as some of the

43
00:04:05,880 --> 00:04:11,010
major breaches and so major breaches are
the high impact reaches that result from

44
00:04:11,010 --> 00:04:15,290
complete network compromise so
everybody's seen you know DDoS attacks

45
00:04:15,290 --> 00:04:20,340
or defacement those are annoying matter
but they aren't the big major beaches

46
00:04:20,340 --> 00:04:23,870
which are which are really having
significant economic effect and

47
00:04:23,870 --> 00:04:32,070
significant effect on a lot of different
people and so you can look at the effect

48
00:04:32,070 --> 00:04:36,810
from just down a stolen so I'm ready for
the target breach at the Home Depot

49
00:04:36,810 --> 00:04:42,240
breaches very similar card data the
JPMorgan Chase breach which was again

50
00:04:42,240 --> 00:04:47,960
more financial down I we've also seen
recently are certainly more so than in

51
00:04:47,960 --> 00:04:53,730
previous years I say about five years I
was saying destructive major breaches so

52
00:04:53,730 --> 00:04:58,230
the Sony breach is probably the most
well-known of those but it's certainly

53
00:04:58,230 --> 00:05:02,620
not the only one of the Sands Casino are
actually Las Vegas Sands entertainment I

54
00:05:02,620 --> 00:05:06,370
just the same thing itself at the entire
business was hit and that's what Saudi

55
00:05:06,370 --> 00:05:13,370
Aramco few years ago and I was major oil
producer and Saudi Arabia and so when we

56
00:05:13,370 --> 00:05:18,229
look at some of these you know Saudi
Aramco has 30,000 systems which got

57
00:05:18,229 --> 00:05:21,490
wiped and Norma's impact

58
00:05:21,490 --> 00:05:29,280
on on their systems these are normally
accompanied by you know screens showing

59
00:05:29,280 --> 00:05:35,660
you know taunting messages toward the
users and blasting music but was under

60
00:05:35,660 --> 00:05:40,819
struck or something like that so that
ends up being very painful to accompany

61
00:05:40,819 --> 00:05:45,289
as all the Sun tens of thousands of
their employees can't get their works

62
00:05:45,289 --> 00:05:49,630
were done and they're often as a lot of
data which is lost which is not easy to

63
00:05:49,630 --> 00:05:53,979
get back so what what is happening what
is causing these so the security

64
00:05:53,979 --> 00:05:59,080
industry it's our job to fix that
probably the best analysis which has

65
00:05:59,080 --> 00:06:04,180
been made public is done at the target
reach and I pulled this diagram from the

66
00:06:04,180 --> 00:06:10,880
link there which you can see it started
by infecting a vendor with a social

67
00:06:10,880 --> 00:06:15,930
engineering email most likely after
having access to that

68
00:06:15,930 --> 00:06:21,110
HVAC vendor in pennsylvania those
vendors crunches or stolen by the bad

69
00:06:21,110 --> 00:06:24,930
guys to access a web server of targets
which that vendor had access to after

70
00:06:24,930 --> 00:06:28,060
that point they're able to use those
credentials and access to exploit that

71
00:06:28,060 --> 00:06:33,449
web server get a shot on a web server
they identify what was on that the

72
00:06:33,449 --> 00:06:38,409
modified their mara where to avoid
antivirus detection as it was mentioning

73
00:06:38,409 --> 00:06:44,400
the last talked to her for them and then
they use the power to steal credentials

74
00:06:44,400 --> 00:06:50,280
in something called many cats 2 don't
passwords and and other essentials on

75
00:06:50,280 --> 00:06:55,520
that web server I want to have those
they don't spread their their their

76
00:06:55,520 --> 00:07:02,370
actual game was called back pls onto
each of the point of sale POS stands for

77
00:07:02,370 --> 00:07:06,240
systems and those are the systems that
were you know your your credit card into

78
00:07:06,240 --> 00:07:10,360
collecting your data and sending that
all back to them at which point they

79
00:07:10,360 --> 00:07:13,400
then sold on the black market and

80
00:07:13,400 --> 00:07:18,460
well you know critical flaw in this is a
rugged mountain to he was eleven

81
00:07:18,460 --> 00:07:22,780
different steps which are summarized a
little bit there was a lot of press

82
00:07:22,780 --> 00:07:28,759
coverage on this lot of it from
bankruptcy 2012 was leading a lot of the

83
00:07:28,759 --> 00:07:34,880
reporting on this so first thing he did
was point out that I'm home depot set by

84
00:07:34,880 --> 00:07:39,400
the same power as target so we're kind
of focusing on this this black girl was

85
00:07:39,400 --> 00:07:42,250
something which had been modified so
there was something which had been seen

86
00:07:42,250 --> 00:07:45,130
before maybe they have better Miller
detection they would have been able to

87
00:07:45,130 --> 00:07:50,900
find this Bloomberg has it right there
in the in the headline says mr. alarms

88
00:07:50,900 --> 00:07:54,979
and fourteen million stolen credit card
numbers how target GLuint how they blew

89
00:07:54,979 --> 00:07:59,729
it will real simple than most alarms
they have fire I systems on the network

90
00:07:59,729 --> 00:08:03,740
which set off a couple Ernst as these
executables are being downloaded in

91
00:08:03,740 --> 00:08:10,510
plain text to their systems and target
didn't respond to that and that sounds

92
00:08:10,510 --> 00:08:15,660
very easy does of course that must have
been to a reporter outside the industry

93
00:08:15,660 --> 00:08:21,190
if you've SAT within a security
operation center have seen the millions

94
00:08:21,190 --> 00:08:24,860
and millions of false-positive learns
this is not surprising at all and

95
00:08:24,860 --> 00:08:33,490
certainly isn't a red flag to this is
the biggest issue other articles talked

96
00:08:33,490 --> 00:08:38,110
about how Obama's budget for security
software hardware and services that

97
00:08:38,110 --> 00:08:41,669
means little if you don't have empowered
gigs to help recognize a breach early on

98
00:08:41,669 --> 00:08:46,350
so is a person now that they should have
been putting the money into and so the

99
00:08:46,350 --> 00:08:49,570
boxes on a network and that's certainly
something which is at the root of a lot

100
00:08:49,570 --> 00:08:56,370
of issues us' Senate even held a hearing
and had a committee to prepare a report

101
00:08:56,370 --> 00:09:01,900
on what happened here which is rare for
breaches but they came up with four

102
00:09:01,900 --> 00:09:08,529
major findings first one was giving
access to the HVAC vendor who didn't

103
00:09:08,529 --> 00:09:13,400
follow grape security policies it was a
HVAC vendor compromises initial stuff

104
00:09:13,400 --> 00:09:14,079
here

105
00:09:14,080 --> 00:09:17,980
the second dimension was the warnings as
was the fourth one that they mentioned

106
00:09:17,980 --> 00:09:18,920
in the third one

107
00:09:18,920 --> 00:09:23,750
they said that they'll move from one ERA
target network to another area and

108
00:09:23,750 --> 00:09:26,990
target publishing isolated that so maybe
maybe we should about it some network

109
00:09:26,990 --> 00:09:34,700
segmentation here to put a barrier in
between these different servers other

110
00:09:34,700 --> 00:09:39,029
research are other articles again talked
about breaking in view the HVAC company

111
00:09:39,029 --> 00:09:43,959
that initial stuff there another so to
summarize we had the missing alerts from

112
00:09:43,959 --> 00:09:48,510
the crimes we talked about missing
skilled incident responders this initial

113
00:09:48,510 --> 00:09:55,360
access with the HVAC vendors just
adopted end-to-end encryption didn't go

114
00:09:55,360 --> 00:09:57,949
into detail here but this is basically
what the chip is if you've got a new

115
00:09:57,949 --> 00:10:02,810
credit card you've gotten the chip I'm
you put that chip into Target and those

116
00:10:02,810 --> 00:10:06,649
devices never have your credit card
number does basically cryptographic

117
00:10:06,649 --> 00:10:13,370
handshake with the bank servers and
shouldn't have her released your card

118
00:10:13,370 --> 00:10:16,690
number I'm so she do that that's
certainly one way to to fix this issue

119
00:10:16,690 --> 00:10:20,430
but that's not applicable generally
because a lot of companies are going to

120
00:10:20,430 --> 00:10:23,089
have some some information which they're
going to need to protect and you can't

121
00:10:23,089 --> 00:10:26,660
just say I am I gonna keep sensitive
information network obviously minimizing

122
00:10:26,660 --> 00:10:33,940
if you can ask questions on any of you
miss alert Access and on the isolation a

123
00:10:33,940 --> 00:10:40,029
similar story happened with the Sands
Casino this one I just love the the

124
00:10:40,029 --> 00:10:45,040
article about this is just amazing I'm
gonna read peace from when the attack

125
00:10:45,040 --> 00:10:48,779
happened the computers were flat lining
email was down most of the phones don't

126
00:10:48,779 --> 00:10:51,790
work and several the technology systems
that help to run the fourteen billion

127
00:10:51,790 --> 00:10:55,709
dollar operation had sputtered to a halt
computer engineers at Las Vegas Sands

128
00:10:55,709 --> 00:11:00,070
corporation race to figure out what was
happening within our head diagnoses same

129
00:11:00,070 --> 00:11:04,170
was under a withering cyberattack PCs
and servers were shutting down a

130
00:11:04,170 --> 00:11:08,510
cascading I T catastrophe with many of
their hard drives wiped clean the

131
00:11:08,510 --> 00:11:12,380
company's technical staff had never seen
anything like it in an effort to save as

132
00:11:12,380 --> 00:11:17,449
many machines as they could I T staffers
scrambled across the casino four floors

133
00:11:17,449 --> 00:11:21,329
of the same Vegas properties the
Venetian and the Palazzo ripping network

134
00:11:21,329 --> 00:11:25,319
cards out of every functioning computer
they could find including PCs used by

135
00:11:25,319 --> 00:11:30,769
pit bosses to track gamblers and kiosks
where slot players cash in their tickets

136
00:11:30,769 --> 00:11:35,290
so in the middle of Vegas the running
down the hallways yanking the cords out

137
00:11:35,290 --> 00:11:41,220
of the walls to stop the cyber attack
and it wasn't even DEFCON

138
00:11:41,220 --> 00:11:48,239
I'm very disappointed but yeah it was it
was an attack which hit so many of their

139
00:11:48,239 --> 00:11:52,759
service across the world some of their
casinos and shutting down there are a

140
00:11:52,759 --> 00:11:58,649
lot of their operations are costing them
an awful lot of money they've been going

141
00:11:58,649 --> 00:12:02,739
to describing how this happens so the
attackers had attempted to gain access

142
00:12:02,739 --> 00:12:08,869
and a few a failed came back they found
a web development server which was

143
00:12:08,869 --> 00:12:12,540
something that the sounds are
Corporation vol percent stood up but

144
00:12:12,540 --> 00:12:15,559
they haven't locked it down it was just
a test server was on their production

145
00:12:15,559 --> 00:12:20,420
servers vulnerability in that compromise
that system to use many cats to steal

146
00:12:20,420 --> 00:12:25,309
passwords they were then able to move
from that service other servers on that

147
00:12:25,309 --> 00:12:32,319
same network that bethlehem I T system
one of those other ones using probably

148
00:12:32,319 --> 00:12:38,119
local administrator credentials and I'm
on one of those will find a domain or

149
00:12:38,119 --> 00:12:42,129
enterprise admin equivalent credential
and that guy's password or token to take

150
00:12:42,129 --> 00:12:47,480
it and then move from there to take over
the entire Active Directory forest that

151
00:12:47,480 --> 00:12:55,160
Las Vegas Sands was using at that point
they control the entire network so again

152
00:12:55,160 --> 00:13:00,299
initially exploit your web server still
passwords repeated that till they found

153
00:13:00,299 --> 00:13:04,299
demand out man and then they deploy
their tech crossing tire not work in

154
00:13:04,299 --> 00:13:08,999
this case as far as I know there were no
alerts that were missed their their

155
00:13:08,999 --> 00:13:15,740
initial tack flag similar to but then
their second long did not and then we

156
00:13:15,740 --> 00:13:19,740
have starting Sunday around Sony and
Saudi Aramco which is a very similar

157
00:13:19,740 --> 00:13:24,569
story we don't know all the details for
these attacks however we do know how

158
00:13:24,569 --> 00:13:30,879
that massive power was cut across their
network and I was again a stolen admin

159
00:13:30,879 --> 00:13:36,970
credentials causing a lot of chaos so we
don't have these bitches what we have is

160
00:13:36,970 --> 00:13:43,800
something that looks like this in in
every case and so we ask yourself all

161
00:13:43,800 --> 00:13:49,019
let's let's plot how the industry is
responding to these breaches and so

162
00:13:49,019 --> 00:13:54,750
you've got a number one identified that
initial access make it so they can't get

163
00:13:54,750 --> 00:13:57,189
into our network at all so there's
there's a lot of effort here you have

164
00:13:57,189 --> 00:14:04,649
your vulnerability scanners have various
penthouse often focus on this you have

165
00:14:04,649 --> 00:14:11,279
you know various types of fireballs
fireball and I would say possibly most

166
00:14:11,279 --> 00:14:15,810
of the computer security industries as
many China stop that first boxer to from

167
00:14:15,810 --> 00:14:19,379
being compromised and they have an
enormous effort over here on the right

168
00:14:19,379 --> 00:14:23,850
side of the graph to go after that now
we're and so things like you know

169
00:14:23,850 --> 00:14:28,120
identifying that back to us know whether
that's any virus signatures or threat

170
00:14:28,120 --> 00:14:31,290
intelligence which is just a fancy name
for a number of signatures you have to

171
00:14:31,290 --> 00:14:37,259
pay for normally can include other
things like IP addresses and techniques

172
00:14:37,259 --> 00:14:40,680
as well but a lot of emphasis on how are
they doing that matter how are they

173
00:14:40,680 --> 00:14:46,160
doing these techniques and both of these
are really critical parts of your

174
00:14:46,160 --> 00:14:53,839
information security program but if you
notice something kinda happened in the

175
00:14:53,839 --> 00:14:58,910
middle there seems to be pretty
important so what happened right over

176
00:14:58,910 --> 00:15:04,129
here we have been here was the bad guys
steal a domain administrator token

177
00:15:04,129 --> 00:15:09,180
because those credentials were left on a
web server and and all these major

178
00:15:09,180 --> 00:15:13,689
breaches what we find repeatedly is that
credential theft grants you at least

179
00:15:13,689 --> 00:15:19,120
5,000 times the access that your exploit
your social engineering attacks did

180
00:15:19,120 --> 00:15:25,829
sometimes just 10,000 30,000 times as
much access credentials that turns that

181
00:15:25,829 --> 00:15:31,379
one system in 2000 and thousands more
and

182
00:15:31,379 --> 00:15:36,739
you know what you find is in my opinion
on our detection and and software

183
00:15:36,739 --> 00:15:40,949
vulnerabilities are the biggest problem
in enterprises leaving around a credit

184
00:15:40,949 --> 00:15:46,429
line around all over the demand tends to
be that problem whose recognizing this

185
00:15:46,429 --> 00:15:52,189
problem well you can just google target
breaks you look for that it's

186
00:15:52,189 --> 00:15:55,329
recommended credentials that initial
access you get almost half a million

187
00:15:55,329 --> 00:16:01,389
results are you look for malware and you
go again almost half a million results

188
00:16:01,389 --> 00:16:05,339
in the first page in both of these
instances it's all I mentioned right

189
00:16:05,339 --> 00:16:07,769
there in the title right there headline

190
00:16:07,769 --> 00:16:14,720
you get very few results about a tenth
as many and none of them are in the

191
00:16:14,720 --> 00:16:21,179
headline they're all in like you know
paragraph 11 5 there's there's basically

192
00:16:21,179 --> 00:16:27,799
very little focus on this comparatively
and that's not just and this particular

193
00:16:27,799 --> 00:16:32,309
reach that's in the industry as a whole
and I think the biggest one of the

194
00:16:32,309 --> 00:16:38,419
biggest illustrations of this is look at
from for more than 10 years now goes to

195
00:16:38,419 --> 00:16:45,509
15 years Windows has stored complete
passwords in slightly obvious skated it

196
00:16:45,509 --> 00:16:49,669
was implied by documented features
documented at least as far back as 2003

197
00:16:49,669 --> 00:16:55,639
far as I can tell us a lot of people
this was not exploded offensively

198
00:16:55,639 --> 00:17:02,029
certainly not publicly until early 2012
over ten years later when Benjamin Delpy

199
00:17:02,029 --> 00:17:06,620
who's not a dedicated security
researcher was making a hobby project

200
00:17:06,620 --> 00:17:11,750
called many cats which he was using to
learn to program see environment as

201
00:17:11,750 --> 00:17:18,299
authentication and if you look at just a
few of them we've mentioned but a lot of

202
00:17:18,299 --> 00:17:21,020
other ones just the documented impact

203
00:17:21,020 --> 00:17:27,300
many cats in breaches surpasses that of
virtually any exploit you could say

204
00:17:27,300 --> 00:17:30,860
maybe there's a couple which which
passed it but document impacted many

205
00:17:30,860 --> 00:17:34,230
cats probably surpasses just about any
explains that we've seen in the past

206
00:17:34,230 --> 00:17:39,960
five years so again credential attacks
tend to lead in real-world impact but

207
00:17:39,960 --> 00:17:43,480
they're still receive very little
research attention compared to more

208
00:17:43,480 --> 00:17:50,930
abilities so why is that I don't have a
great answer for that I think there's

209
00:17:50,930 --> 00:17:58,170
kind of an attitude of first of a few
visible alternatives and it's a boring

210
00:17:58,170 --> 00:18:05,270
alternatives that say oh well I guess
our our place the blame on the user's

211
00:18:05,270 --> 00:18:09,570
ministers they say well I guess you
shouldn't have a week after I guess you

212
00:18:09,570 --> 00:18:13,720
can reuse your pastor agency said log
into that system or maybe you should

213
00:18:13,720 --> 00:18:20,450
just reboot er we just kind of go back
to authenticated access whatcha gonna do

214
00:18:20,450 --> 00:18:27,190
about it and there's not a whole lot of
I think imaginative solutions and some

215
00:18:27,190 --> 00:18:35,620
decisions that are out there tend to be
large software project deployments which

216
00:18:35,620 --> 00:18:44,140
can can certainly help but tend to be a
large I T issue so how do we defend

217
00:18:44,140 --> 00:18:50,540
against this so described his kind of
how we approach this perspective as a

218
00:18:50,540 --> 00:18:55,059
security assessment in one of our
security assessment

219
00:18:55,059 --> 00:19:02,240
services I guess first thing we want to
do is identify the dissemination of

220
00:19:02,240 --> 00:19:06,029
credentials so where are your
credentials where they store where can

221
00:19:06,029 --> 00:19:12,289
we find them were they in memory where
they on desk and then once once you've

222
00:19:12,289 --> 00:19:18,559
found that and who they correspond to
identify which ones are reviews so who

223
00:19:18,559 --> 00:19:24,370
are sharing credentials and then once
you've identified that you need to

224
00:19:24,370 --> 00:19:28,600
identify both direct and indirect impact
of the credentials so what can those

225
00:19:28,600 --> 00:19:34,279
credentials get to and figure out how to
change those together to get maximum

226
00:19:34,279 --> 00:19:38,029
impact looking adjusting back to the one
we are also looking at the impact of

227
00:19:38,029 --> 00:19:42,590
everything that you can get to from
there an undetermined mechanisms to

228
00:19:42,590 --> 00:19:47,999
break those chains and say where can we
can we cut this off so it doesn't and

229
00:19:47,999 --> 00:19:55,279
causing a cascading failure and then
goto cleanup identify if there's any

230
00:19:55,279 --> 00:19:58,369
changes you can make to help prevent
some of the stuff from happening in the

231
00:19:58,369 --> 00:20:02,919
future and of course continuing to audit
so that I don't just try to clean stuff

232
00:20:02,919 --> 00:20:04,789
up and then leaving that much at all

233
00:20:04,789 --> 00:20:13,840
go back so here's kind of our way the
diagram we've got scanners which will

234
00:20:13,840 --> 00:20:18,429
call this information and other
collectors that dedicates pulled back

235
00:20:18,429 --> 00:20:22,330
into big data base and then we do
queries on that and kind of heaven on

236
00:20:22,330 --> 00:20:29,940
the scale of the systems do need to use
credentials to do this we don't do

237
00:20:29,940 --> 00:20:36,220
anything these days are using to spread
this it is a small collector you can

238
00:20:36,220 --> 00:20:38,860
debate till the end of time about
whether you want an agent or do you just

239
00:20:38,860 --> 00:20:46,869
want to rely on existing laws whether
onto your own code code method so that

240
00:20:46,869 --> 00:20:52,049
we're not leaving more stuff on the
network and we can we can it kind of

241
00:20:52,049 --> 00:20:54,710
fits more the assessment methodology

242
00:20:54,710 --> 00:21:00,220
look at the credentials president this
is something which was certainly more

243
00:21:00,220 --> 00:21:07,090
involved than I realized it would be
when you look out when you start getting

244
00:21:07,090 --> 00:21:11,970
into the guts of how this works we find
that Microsoft tends to lie a lot and

245
00:21:11,970 --> 00:21:18,080
its documentation so Microsoft has all
the explanations of things so for

246
00:21:18,080 --> 00:21:23,980
example tokens which is normally a big
swath of stealing your domain

247
00:21:23,980 --> 00:21:28,360
credentials from a single system they
come in two flavors if you read the new

248
00:21:28,360 --> 00:21:31,200
Microsoft documentation there
impersonation tokens and their

249
00:21:31,200 --> 00:21:38,130
delegations tokens and impersonation
tokens you don't really care because

250
00:21:38,130 --> 00:21:44,630
impersonation talking this just means
processes running as if it was a

251
00:21:44,630 --> 00:21:47,899
privilege to count on this system but it
doesn't really have that privilege

252
00:21:47,899 --> 00:21:51,659
privileged accounts credentials to then
use against a different system

253
00:21:51,659 --> 00:21:56,279
delegation tokens are the other kinds
delegation tokens are the all-powerful

254
00:21:56,279 --> 00:22:03,070
kind of location tokens me not only am i
operating privileged admin on this

255
00:22:03,070 --> 00:22:06,690
system but I also have privileged
documents credentials and I can throw

256
00:22:06,690 --> 00:22:10,350
them out and a system that I want and
take over those systems I can then steal

257
00:22:10,350 --> 00:22:13,260
and reuses credentials again

258
00:22:13,260 --> 00:22:21,559
documentation and access which was
better than based on previous incognito

259
00:22:21,559 --> 00:22:26,830
show you what you have on the system

260
00:22:26,830 --> 00:22:36,289
unfortunately though quite a few of
those delegation token tokens as a

261
00:22:36,289 --> 00:22:43,220
delegation total say yes or a no it's an
impersonation token but there's really a

262
00:22:43,220 --> 00:22:46,820
house or apt in memory or something like
that

263
00:22:46,820 --> 00:22:55,789
and so we had done had to do more stuff
to basically I'd check and see is this

264
00:22:55,789 --> 00:23:03,529
has really in memory or is this cover us
to UT really in memory and so so you

265
00:23:03,529 --> 00:23:08,480
have to have to do that and then you
also want to look in detail out what are

266
00:23:08,480 --> 00:23:13,279
the user count on the system where all
the relevant privilege assignments so

267
00:23:13,279 --> 00:23:18,909
which groups have been granted which
privileges on the system configuration

268
00:23:18,909 --> 00:23:24,409
details a system have caused an end up
having a lot of effect on the ability to

269
00:23:24,409 --> 00:23:28,309
pass credentials and identify all these
security group memberships of all

270
00:23:28,309 --> 00:23:32,120
accounts on that system and all the
groups on that system once you've done

271
00:23:32,120 --> 00:23:36,730
that you can basically attempt to
recreate that we as a nation on the

272
00:23:36,730 --> 00:23:41,720
other side and I don't know how that
it's happened when we move on to

273
00:23:41,720 --> 00:23:50,580
extracting hashes and so normally you as
as we mentioned you just mentioned in

274
00:23:50,580 --> 00:23:55,950
previous slide extracting two main house
has often been a difficult process which

275
00:23:55,950 --> 00:24:00,340
involves extracting system high and the
NTSB identify which is huge and they

276
00:24:00,340 --> 00:24:04,590
have to extract has a strong that which
is its own long process which involves

277
00:24:04,590 --> 00:24:07,750
installing whole bunch of dependencies
is really complicated and there's much

278
00:24:07,750 --> 00:24:11,120
python script out there which don't work
for their work on some like 2k three

279
00:24:11,120 --> 00:24:16,149
version but not the to k-12 version but
there's a website extractor and tedious

280
00:24:16,149 --> 00:24:35,730
did I T which houses and as far as I
know it's the works as they're talking

281
00:24:35,730 --> 00:24:44,360
about before us what has also now added
on some handling for and that is you

282
00:24:44,360 --> 00:24:49,070
don't want to you ideally don't have to
extract this massive file out and then

283
00:24:49,070 --> 00:24:54,830
go run very intensive operations so our
method actually just as the riders

284
00:24:54,830 --> 00:25:01,260
sectors and then team and we talked
about this kind of like doing about him

285
00:25:01,260 --> 00:25:07,389
set up except not doing my show in
saddam extracted from there and then we

286
00:25:07,389 --> 00:25:12,590
just clear the samples from registry and
so once we have that the other thing

287
00:25:12,590 --> 00:25:17,340
that we do then is we don't want to
contribute to this problem of grabbing a

288
00:25:17,340 --> 00:25:21,500
whole bunch of credentials as a little
bit different goals then does

289
00:25:21,500 --> 00:25:27,590
surrounding houses in there but will
actually do is we will pass them again

290
00:25:27,590 --> 00:25:32,840
shot 256 so that if you capture our
hashes you won't be able to replay them

291
00:25:32,840 --> 00:25:38,620
and pass the house somewhere else you'd
have to track them so we will use double

292
00:25:38,620 --> 00:25:44,820
passes which still allows us to check
for reused hashes cause the second half

293
00:25:44,820 --> 00:25:49,500
will still be the same if somebody's
reuse their password but reduces the

294
00:25:49,500 --> 00:25:56,460
danger of grabbing a whole bunch of
criminals yourself so we've done this a

295
00:25:56,460 --> 00:26:01,330
couple of systems we've got work station
also got workstation Bob have a guest

296
00:26:01,330 --> 00:26:05,629
account password that's not going to be
useful for anything else has else's

297
00:26:05,629 --> 00:26:09,610
account has got one has bob has bob's
accounts got a different cash no problem

298
00:26:09,610 --> 00:26:13,429
there a way they both got a local
administrator account and it's got the

299
00:26:13,429 --> 00:26:20,559
same hash and saw this point you might
be thinking somebody from could

300
00:26:20,559 --> 00:26:25,820
compromise on these workstations pass a
house over to the other one soon reality

301
00:26:25,820 --> 00:26:30,389
again I there would be just imagine like
a funny facebook video if the Derby Conn

302
00:26:30,389 --> 00:26:39,679
that work was working but it was and
that fails so you might ask yourself

303
00:26:39,679 --> 00:26:42,679
okay well why did this fail

304
00:26:42,679 --> 00:26:45,679
administrators in the Administrators
group most of the time this one actually

305
00:26:45,679 --> 00:26:47,080
does succeed

306
00:26:47,080 --> 00:26:53,510
but failed and so we found is that so
what we're doing is we're taking account

307
00:26:53,510 --> 00:26:57,980
tracing its rights through its any
groups that it's a membership of and

308
00:26:57,980 --> 00:27:03,230
where those rights are assigned and so
you can see the local Administrators

309
00:27:03,230 --> 00:27:07,940
group has been granted it's on the
screen but the Local History Group by

310
00:27:07,940 --> 00:27:11,850
the father is granted US network logon
write a bunch of other rights like has

311
00:27:11,850 --> 00:27:16,809
he taken a shit right and others which
equate admin control and so many

312
00:27:16,809 --> 00:27:21,720
investors group generally do work for
this exact or however you want to take

313
00:27:21,720 --> 00:27:26,529
over that remote system except if
there's this setting introduced to

314
00:27:26,529 --> 00:27:31,600
mister which is the UAC run all
administrators an admin approval mode

315
00:27:31,600 --> 00:27:36,399
setting which is on by default which box
all the administrators from remotely all

316
00:27:36,399 --> 00:27:40,029
the local administrators from remotely
taking under that system with network

317
00:27:40,029 --> 00:27:45,090
long gone except if its debts 500 local
administrator account is the building

318
00:27:45,090 --> 00:27:49,049
administrator counseling usually named
administrator must strengthen its like

319
00:27:49,049 --> 00:27:54,559
to order something like that but still
under 500 so we just called the building

320
00:27:54,559 --> 00:28:00,570
administrator account but that will
still work even investing later except

321
00:28:00,570 --> 00:28:04,340
when it doesn't work and it doesn't work
well in that setting USC something is

322
00:28:04,340 --> 00:28:07,929
different setting is set to admin
approval mode for the built-in

323
00:28:07,929 --> 00:28:14,570
administrator account and this is
important because you can you can run

324
00:28:14,570 --> 00:28:19,860
into environments where hopefully they
have this one sets us up in the local

325
00:28:19,860 --> 00:28:24,210
admin accounts can be used to copious
exact over to

326
00:28:24,210 --> 00:28:29,490
another local admin box even if they
have the same password and we need to be

327
00:28:29,490 --> 00:28:34,220
able to identify that correctly and one
of the one of the issues that have to

328
00:28:34,220 --> 00:28:36,180
start talking about stuff like this

329
00:28:36,180 --> 00:28:40,320
authentication you find a lot of people
say I will the building industry

330
00:28:40,320 --> 00:28:46,310
accounts for past the hash and then just
stop there and we find actually there's

331
00:28:46,310 --> 00:28:51,510
so many settings normally normally you
can't just say this work so this doesn't

332
00:28:51,510 --> 00:28:55,200
work you actually have to check all the
non default settings and all the

333
00:28:55,200 --> 00:28:59,280
non-default registry keys to see how was
it really configured because something

334
00:28:59,280 --> 00:29:02,580
which normally isn't an issue might be
an issue or something which normally is

335
00:29:02,580 --> 00:29:07,230
an issue might not all right so we try
again

336
00:29:07,230 --> 00:29:15,880
that back to the default and try to go
execute that fails again right now what

337
00:29:15,880 --> 00:29:20,870
might be the issue week blocked by
firewall trying to authenticate as

338
00:29:20,870 --> 00:29:29,740
anybody know what can still block it's
still granted but that is something I

339
00:29:29,740 --> 00:29:42,860
could well sometimes something that
could be an issue in this case I was

340
00:29:42,860 --> 00:29:47,260
configured to force guests the first
guest is the default on non demain

341
00:29:47,260 --> 00:29:54,430
joining systems and corresponds to a
setting here which says no network

342
00:29:54,430 --> 00:29:59,960
sharing access and security model for
local accounts and if that's set to

343
00:29:59,960 --> 00:30:03,460
guest only which is the default on my
competitions are not enjoying systems

344
00:30:03,460 --> 00:30:06,860
which corresponds to simple file sharing
then you will be blocked even if you

345
00:30:06,860 --> 00:30:11,300
have an account even if it is the five
hundred or USC has turned off you will

346
00:30:11,300 --> 00:30:15,900
still be blocked from his exactly
according to Microsoft documentation

347
00:30:15,900 --> 00:30:17,880
force gassed

348
00:30:17,880 --> 00:30:25,040
prevents local administrators are
praising his first guest forces all

349
00:30:25,040 --> 00:30:29,490
local counts to authenticate as the
guest accounts when enabled and it is

350
00:30:29,490 --> 00:30:33,690
not enabled by default under management
systems so what happens when you turn it

351
00:30:33,690 --> 00:30:45,020
on a dimension system that is what I
thought but that is not the case as a

352
00:30:45,020 --> 00:30:50,100
documentation so his first guests only
applies to the local accounts however

353
00:30:50,100 --> 00:30:55,330
the documentation is wrong just has no
effect whatsoever and even though it

354
00:30:55,330 --> 00:30:58,190
says the box and it doesn't actually
block it so that was a surprise to me

355
00:30:58,190 --> 00:31:06,280
again in the past few months actually
testing some of this stuff so basically

356
00:31:06,280 --> 00:31:10,500
off on occasions complicated again we
have these special rights assignment we

357
00:31:10,500 --> 00:31:14,110
didn't go into you could have somebody's
account to the icd-9 are calling on

358
00:31:14,110 --> 00:31:17,680
access right even if they had a network
logon access right or you can vote as a

359
00:31:17,680 --> 00:31:24,870
network LAN access right and still block
it in and versions of Windows equivalent

360
00:31:24,870 --> 00:31:30,180
to seven or later with sufficient
Service Pack are you can you can do

361
00:31:30,180 --> 00:31:35,260
special sit restrictions so you can
apply those rights are denied network

362
00:31:35,260 --> 00:31:39,010
logon rights to only local councils a
special set for that or local council

363
00:31:39,010 --> 00:31:42,250
member of the Administrators group like
this for awhile policies which you can

364
00:31:42,250 --> 00:31:43,930
run into

365
00:31:43,930 --> 00:31:48,810
alright so I've done all that I have
turned USC up all the way I have blocked

366
00:31:48,810 --> 00:31:52,190
the local council must not work going on
right now feel special said restrictions

367
00:31:52,190 --> 00:31:55,049
on good right accepts

368
00:31:55,049 --> 00:32:01,330
has all that works for service
management like this exact it all works

369
00:32:01,330 --> 00:32:05,539
remote file share access which you can
use to achieve code execution via

370
00:32:05,539 --> 00:32:10,769
something called the WBT MOF method and
you can use remote registry access and

371
00:32:10,769 --> 00:32:15,389
tasked to learn W my remove Windows
Remote Management all which ride off of

372
00:32:15,389 --> 00:32:20,239
amateur separate mechanisms of taking
over a standard Windows system and I'll

373
00:32:20,239 --> 00:32:24,669
get right off road network log on and
it's important to consider all of these

374
00:32:24,669 --> 00:32:29,450
because when I frequently see isn't
companies though say we're blocking

375
00:32:29,450 --> 00:32:33,999
windows remote management so you know
we're gonna stop all that you know

376
00:32:33,999 --> 00:32:37,580
hackers from taking advantage of that
and real the hackers have at least five

377
00:32:37,580 --> 00:32:40,379
other choices which they can use to
achieve the same results which is

378
00:32:40,379 --> 00:32:46,149
popping your box and so a lot of times
these restrictions are particularly

379
00:32:46,149 --> 00:32:53,690
valid for the block lots of them except
for one and so so you have all that and

380
00:32:53,690 --> 00:32:58,869
all works for network logon but there's
a completely different set of rules for

381
00:32:58,869 --> 00:33:05,739
remote desktop so UAC settings which
blocked your accounts don't affect it

382
00:33:05,739 --> 00:33:09,869
however that's ok though because you
need an actual password to do remote

383
00:33:09,869 --> 00:33:14,440
desktop long gone except you don't need
an actual password to do remote desktop

384
00:33:14,440 --> 00:33:19,509
log on and when it was 8.1 and later
because there's this great security

385
00:33:19,509 --> 00:33:23,269
feature called restricted admin mode
just acting restricted on a boat is

386
00:33:23,269 --> 00:33:27,820
great because basically you can pass the
house to remote desktop without knowing

387
00:33:27,820 --> 00:33:33,139
what the password is and and still get
remote desktop once you've done that

388
00:33:33,139 --> 00:33:39,269
your count on that remote side won't
have your password and memory like it

389
00:33:39,269 --> 00:33:43,769
otherwise would have so it's a way to
help avoid spreading your credentials if

390
00:33:43,769 --> 00:33:47,460
you're doing you know domain management
you should use restricted a minute

391
00:33:47,460 --> 00:33:50,140
because then you don't give your
credentials after that remote system

392
00:33:50,140 --> 00:33:55,450
but it does have the side effect of
undermining all the USC restrictions

393
00:33:55,450 --> 00:33:59,060
which prevented lateral movement to the
local using the local workstation

394
00:33:59,060 --> 00:34:06,510
accounts you have to use restricted with
a low counts and so of course it's got

395
00:34:06,510 --> 00:34:11,250
its own set of St remote interactive
logon right Sandusky deny remote

396
00:34:11,250 --> 00:34:17,899
interactive logon rights to enable or
disable that alright I have nothing open

397
00:34:17,899 --> 00:34:31,429
I've got two main box it's got remote
desktop disabled yes so if you so yes

398
00:34:31,429 --> 00:34:35,700
kind of if you start off with a remote
desktop connection and you don't

399
00:34:35,700 --> 00:34:40,630
specifically asked for restricted admin
it will give you a non-restricted admin

400
00:34:40,630 --> 00:34:45,360
so you have to throw that on as a
separate switch on the TSC command

401
00:34:45,360 --> 00:34:51,110
prompt and I'll talk a little bit about
medications at the end I can force that

402
00:34:51,110 --> 00:34:57,650
in a bit so nothing's open so we've got
a modest have disabled we turn the

403
00:34:57,650 --> 00:35:02,170
firewall to block all of those network
logon ne law any inbound connection

404
00:35:02,170 --> 00:35:07,030
whatsoever so the question is can you
this box is just sitting there in the

405
00:35:07,030 --> 00:35:11,720
middle of the room nobody's touching you
can target a user without using an

406
00:35:11,720 --> 00:35:22,760
exploit can you pop this box if you have
any ideas I know because your firewall

407
00:35:22,760 --> 00:35:27,530
is blocking that so you you've you've
put everyone in the tonight we're going

408
00:35:27,530 --> 00:35:37,200
on you put your firewall off they can't
connect to you can control your system

409
00:35:37,200 --> 00:35:45,890
yep that's right of course you can pop
it comprises demand you like group

410
00:35:45,890 --> 00:35:52,369
policy to it to set a particular
registry key like a happenin else and

411
00:35:52,369 --> 00:35:53,460
then it goes and

412
00:35:53,460 --> 00:36:01,460
lol from your server code execution in
about 20 mins to her again without ever

413
00:36:01,460 --> 00:36:06,280
touching it so again you you've got
other methods like that so why do we

414
00:36:06,280 --> 00:36:10,920
care about all the nitty-gritty details
of Windows authentication well if you

415
00:36:10,920 --> 00:36:16,089
can do to show false positives are you
get treated like the network intrusion

416
00:36:16,089 --> 00:36:20,839
detection systems or like the
vulnerability scanners this is a pet

417
00:36:20,839 --> 00:36:24,550
peeve of mine you look at a take home
until the skin of a PHP installation for

418
00:36:24,550 --> 00:36:25,400
example

419
00:36:25,400 --> 00:36:31,230
ok this is PHP 5.2 I'll let me look up
oh you've got five thousand season PHP

420
00:36:31,230 --> 00:36:35,839
5.2 and here they all are and it looks
awful if you actually look at what the

421
00:36:35,839 --> 00:36:47,060
CDs are 99% of something if you're just
on the default install 98 percent of

422
00:36:47,060 --> 00:36:50,900
them actually hundred percent of them
are irrelevant to you they only apply if

423
00:36:50,900 --> 00:36:57,000
you are let's say running a shared
hosting provider and you run untrusted

424
00:36:57,000 --> 00:37:02,819
PHP code from somebody else and then
they could use that PHP code to get code

425
00:37:02,819 --> 00:37:06,579
execution which is the stupid security
model anyway if your gonna let somebody

426
00:37:06,579 --> 00:37:09,530
run PHP coated just treated as
equivalent to code execution because

427
00:37:09,530 --> 00:37:14,530
it's basically could undercut exclusion
and yet because somebody somewhere tries

428
00:37:14,530 --> 00:37:20,660
to make that a security barrier of
10,000 sea bees most of them are just so

429
00:37:20,660 --> 00:37:21,780
we want to avoid doing that

430
00:37:21,780 --> 00:37:25,380
want to tell you you've got issues
credential test here I want that to be

431
00:37:25,380 --> 00:37:25,930
accurate

432
00:37:25,930 --> 00:37:34,460
alright so we could all together I put
up three systems test two main one of

433
00:37:34,460 --> 00:37:37,840
the main controller the other ones are
demanding workstation

434
00:37:37,840 --> 00:37:44,650
pull our our data back and so the
question is what happens if you know

435
00:37:44,650 --> 00:37:51,370
bill learning from a char gets his
password fished a compromised or runs an

436
00:37:51,370 --> 00:37:55,760
excuse or something like that so let's
see what happens

437
00:37:55,760 --> 00:38:01,690
so here's bill done in what we found was
bologna has a reuse passwords and so we

438
00:38:01,690 --> 00:38:06,820
can all hang from from his circle to the
credential circle their corresponding to

439
00:38:06,820 --> 00:38:15,640
that reuse credential turns out a lot of
other people share his password will

440
00:38:15,640 --> 00:38:19,440
just say this is very similar to
basically every real network we have

441
00:38:19,440 --> 00:38:24,460
scammed but shouldn't be too much of a
surprise so we see is often times a lot

442
00:38:24,460 --> 00:38:28,960
of use potentials not just with in a
demain so here you find another few

443
00:38:28,960 --> 00:38:34,780
other accounts no privilege to meet
users are anything but you also find the

444
00:38:34,780 --> 00:38:40,580
local admin accounts of at least two
systems and so these are the two

445
00:38:40,580 --> 00:38:45,730
workstations and so once you have those
accounts those accounts have rights over

446
00:38:45,730 --> 00:38:49,810
their respective workstation

447
00:38:49,810 --> 00:38:57,250
other links there and then you look at
those workstations those then have

448
00:38:57,250 --> 00:39:00,110
access to whole lot more account so
they've of course got access to all the

449
00:39:00,110 --> 00:39:05,790
houses of their local counts but as we
can see at least one of them also house

450
00:39:05,790 --> 00:39:14,630
a token of jurrasic which is the demand
user strolling down Archer sterling

451
00:39:14,630 --> 00:39:19,660
Archer as religious to do pretty much
anything he's a domain administrator

452
00:39:19,660 --> 00:39:24,470
city that has rights over the domain
controller which is class which then at

453
00:39:24,470 --> 00:39:29,790
that point of course has all the rest of
the ashes from the domain users on it

454
00:39:29,790 --> 00:39:34,710
now leading to complete the main
compromise and so what you are you found

455
00:39:34,710 --> 00:39:39,220
here is that when you when you put
together not just what does this guy

456
00:39:39,220 --> 00:39:40,310
have rights too

457
00:39:40,310 --> 00:39:45,420
which is like most I T analysts are
looking out there saying what's what's

458
00:39:45,420 --> 00:39:49,910
his group to see other property rights
yup looks good but also where can he go

459
00:39:49,910 --> 00:39:50,990
from there

460
00:39:50,990 --> 00:39:55,370
not just directly but indirectly by
following all those links and we found

461
00:39:55,370 --> 00:40:00,710
is that about half the accounts and all
of the systems in the demand are

462
00:40:00,710 --> 00:40:05,870
equivalent to fill them in control and
that's generally regarded as a bad thing

463
00:40:05,870 --> 00:40:12,070
and that was just the shortest path that
we draft from that account to fill them

464
00:40:12,070 --> 00:40:16,650
in control there's also lots of other
password you can also take to get you

465
00:40:16,650 --> 00:40:18,050
the same result

466
00:40:18,050 --> 00:40:27,550
leaving Harry must to to clean up so the
question has the way you want to find

467
00:40:27,550 --> 00:40:32,620
his where where can you make the biggest
difference because again you don't

468
00:40:32,620 --> 00:40:36,320
necessarily start off with you you do
want to fix all of these but you want to

469
00:40:36,320 --> 00:40:40,980
be able to say what's the biggest deal
so we've done here as we said one of

470
00:40:40,980 --> 00:40:47,050
what happens if we disable the sterling
Archer account and then in that case of

471
00:40:47,050 --> 00:40:51,450
this guy who is our trouble and who went
long into work stations and logged into

472
00:40:51,450 --> 00:41:07,480
if he had not done that this is what the
new graph looks like and so you have to

473
00:41:07,480 --> 00:41:12,480
control these are always going to be
read minds is always good to have full

474
00:41:12,480 --> 00:41:14,750
control that's expected but now

475
00:41:14,750 --> 00:41:21,640
this here is now yellow and yellow is
better than read write and so yellow all

476
00:41:21,640 --> 00:41:25,930
of your work stations in local counts
there I still their own issues we are in

477
00:41:25,930 --> 00:41:30,020
the know they've got to use the service
is bad thing but at least they're not

478
00:41:30,020 --> 00:41:34,450
equivalent to fill them in control now
so it kinda identify what the problem is

479
00:41:34,450 --> 00:41:40,290
at least a little bit better and we can
move forward from that point on you know

480
00:41:40,290 --> 00:41:45,910
figure out whose is causing issues so
again if no got phished it's still bad

481
00:41:45,910 --> 00:41:49,780
but it's not immediately known as the
catastrophic you more chance to catch

482
00:41:49,780 --> 00:41:57,860
things alright so you know we know what
the issue is how to clean up for it how

483
00:41:57,860 --> 00:42:02,860
do we prevent these types of issues from
happening and so one of the things that

484
00:42:02,860 --> 00:42:08,070
you can do is start applying some of
those deny network access log on rights

485
00:42:08,070 --> 00:42:12,140
apply to all the groups that you can
certainly all the local groups are they

486
00:42:12,140 --> 00:42:20,100
shouldn't be using remote network access
we also want to enforce on your domain

487
00:42:20,100 --> 00:42:29,320
users are restricted admin if if we can
do that and so in in any instance in

488
00:42:29,320 --> 00:42:33,620
which you're doing this you're probably
going to have some system in which

489
00:42:33,620 --> 00:42:38,620
they're going to want to double hot from
and you can teach them how to manually

490
00:42:38,620 --> 00:42:44,650
do that or you can add that as an
exception and and this this is what I

491
00:42:44,650 --> 00:42:48,810
really don't like about Windows there's
basically two main modes you can do this

492
00:42:48,810 --> 00:42:51,950
you can do it as default give your
credentials away that's a bad thing

493
00:42:51,950 --> 00:42:57,060
that's how things are normally done now
or you can have it as forced nobody can

494
00:42:57,060 --> 00:43:01,130
give their credentials away unless
there's a specific exception I really

495
00:43:01,130 --> 00:43:05,040
wish in a future version of Windows are
there any Microsoft people here I really

496
00:43:05,040 --> 00:43:08,330
wish they would make it so that you
could set a default don't give your

497
00:43:08,330 --> 00:43:12,730
credentials away but you can add a
special flag if you really need to and

498
00:43:12,730 --> 00:43:14,490
then you won't have as much of an ad

499
00:43:14,490 --> 00:43:20,550
monroeville but as it is I definitely
recommend this if you can do it you

500
00:43:20,550 --> 00:43:25,650
going to group policy on you you flip
the switches to disable delegating said

501
00:43:25,650 --> 00:43:33,350
credentials to remote servers and other
delegations settings and you can avoid

502
00:43:33,350 --> 00:43:37,610
giving orkut away investor remote
desktop about to fall always happen in

503
00:43:37,610 --> 00:43:45,760
restricted admin mode I what else can
you do if somebody does have to go put

504
00:43:45,760 --> 00:43:48,730
in their credentials into a box the best
thing you want to do is you want to make

505
00:43:48,730 --> 00:43:54,660
sure that those credentials in get
invalidated as quickly as possible and

506
00:43:54,660 --> 00:44:00,300
so the best way to do that and it also
helps others like 15 other issues with

507
00:44:00,300 --> 00:44:05,180
oscar has been stolen and reused and
because I'm going to you

508
00:44:05,180 --> 00:44:10,280
network you're going to see just as many
reused as they do everywhere else you

509
00:44:10,280 --> 00:44:14,680
see just as many awful passer as they do
everywhere else and most of our gonna be

510
00:44:14,680 --> 00:44:19,859
packed just like everywhere else so I
recommend using smart cards with an

511
00:44:19,859 --> 00:44:23,140
offline CA that's one thing that we do
to take by the way

512
00:44:23,140 --> 00:44:29,090
popping a lot of people do an online CA
so if you are able to compromise one CA

513
00:44:29,090 --> 00:44:33,650
which is maybe a support group but
doesn't matter that CA is in the trusted

514
00:44:33,650 --> 00:44:40,280
chain as your auntie off store under
DC's then you can issue your self

515
00:44:40,280 --> 00:44:46,650
certificates valid for smart card logon
and then use that to to gain control the

516
00:44:46,650 --> 00:44:53,080
demand so you definitely want to at
least highly restrictive laws maybe we

517
00:44:53,080 --> 00:44:59,420
can do full offline CIA but maybe you
can rotate and revoke regular schedule

518
00:44:59,420 --> 00:45:05,080
the search that on the network
permanently there's a question back

519
00:45:05,080 --> 00:45:18,150
I'm sorry he said again so that is that
certainly helps a lot if you use a

520
00:45:18,150 --> 00:45:25,430
hardware security module HSM they can so
that will prevent you from stealing the

521
00:45:25,430 --> 00:45:30,720
actual CA route or the actual CAS
private key but you can still get

522
00:45:30,720 --> 00:45:33,950
control that CA and issue yourself
assert which is valid for as long as the

523
00:45:33,950 --> 00:45:44,170
CIA is valid so you know there's there's
still doubt potential there so it's here

524
00:45:44,170 --> 00:45:48,430
I also highly recommend automatically
and daily randomizing both your

525
00:45:48,430 --> 00:45:54,610
smartphone user hashes and then every I
would recommend every week randomizer

526
00:45:54,610 --> 00:45:58,170
TGT hashes we can have long
philosophical discussions on how

527
00:45:58,170 --> 00:46:01,540
frequently you should do that if you do
it every week you have very little

528
00:46:01,540 --> 00:46:09,480
chance of you have no chance of
involving existing Kerberos ticket and

529
00:46:09,480 --> 00:46:13,040
if you use the Microsoft script to do so
you've got very very very small chance

530
00:46:13,040 --> 00:46:21,680
of issuing tickets which are invalidated
uncertainty season but that is the

531
00:46:21,680 --> 00:46:24,910
account password which is used for
Kerberos authentication if you still

532
00:46:24,910 --> 00:46:30,130
that crashed and you can caress tickets
forever and all that has changed and

533
00:46:30,130 --> 00:46:36,120
it's only changed if you do it so you
need to do that what else so

534
00:46:36,120 --> 00:46:40,130
authentication policies in silence and
this is something which is really cool

535
00:46:40,130 --> 00:46:45,360
something which has been added to 2012
are too and later after

536
00:46:45,360 --> 00:46:49,359
versions of Windows domain prior to 2012
are too

537
00:46:49,359 --> 00:46:53,720
basically you could restrict log on
workstations you can restrict the target

538
00:46:53,720 --> 00:46:54,779
long gone

539
00:46:54,779 --> 00:46:59,559
of a particular count but you cannot
restrict the source of that account that

540
00:46:59,559 --> 00:47:03,809
occasion policies in silos can do that
for you they can make it so even if I

541
00:47:03,809 --> 00:47:08,960
have stolen your credentials if I'm not
coming from a system which is necessary

542
00:47:08,960 --> 00:47:15,140
for me to come from then I still get
denied I mean that's that's really cool

543
00:47:15,140 --> 00:47:22,170
thing they've added however I want you
that one is competent to configure but

544
00:47:22,170 --> 00:47:26,450
sometimes we gonna do you gonna have
something to say why the service has to

545
00:47:26,450 --> 00:47:31,999
run as admin has to have a password says
which is a really terrible thing and it

546
00:47:31,999 --> 00:47:36,119
has to have network logon rights and if
that's the case I wouldn't advise

547
00:47:36,119 --> 00:47:39,690
finding different vendor but sometimes
there's there's those situations in

548
00:47:39,690 --> 00:47:43,890
which this terribly insecure thing and
at least for now you can't change that

549
00:47:43,890 --> 00:47:47,069
you can use something like a sanitation
policies in silos to help mitigate that

550
00:47:47,069 --> 00:47:54,130
risk so that doesn't become as much of
an issue what else highly recommend

551
00:47:54,130 --> 00:48:01,670
walking until at least in bound for all
Windows Domain systems makes makes

552
00:48:01,670 --> 00:48:07,799
passing the house a whole lot harder you
can you can no longer directly passed

553
00:48:07,799 --> 00:48:13,279
the house you can still recover lost
ticket if house or log on as a loud so

554
00:48:13,279 --> 00:48:14,549
again if you if you do this

555
00:48:14,549 --> 00:48:19,150
anyone for smart card logon then you've
got no saved crowds on the network or in

556
00:48:19,150 --> 00:48:26,700
memory at any time for that that account
to do so this is this is really nice the

557
00:48:26,700 --> 00:48:31,009
biggest thing I found this doesn't work
on as if you disable and authentication

558
00:48:31,009 --> 00:48:32,920
entirely or disable it

559
00:48:32,920 --> 00:48:38,529
outbound and then you have like some
weird printer are some weird proxy which

560
00:48:38,529 --> 00:48:44,019
only works with and those don't work but
you can disable inbound on your Windows

561
00:48:44,019 --> 00:48:50,359
systems and that's a lot easier you can
have exceptions if you want and that

562
00:48:50,359 --> 00:48:51,160
will

563
00:48:51,160 --> 00:48:55,850
that will prevent a lot of these
contributions tax alright so that was

564
00:48:55,850 --> 00:48:59,730
kind of on our defensive side
offensively what can we do this and what

565
00:48:59,730 --> 00:49:04,810
I understand I'm the only thing standing
between you n freedom I'll try to hurry

566
00:49:04,810 --> 00:49:08,980
up cuz I don't know I always running
late already so offensively what you

567
00:49:08,980 --> 00:49:15,180
want to do is win about talking
capturing using dumping hashes if you

568
00:49:15,180 --> 00:49:19,740
map out the network like we do
defensively you can identify lot of

569
00:49:19,740 --> 00:49:24,120
locations to persist out which which are
great trading places and will have

570
00:49:24,120 --> 00:49:29,440
access to those credentials so that's a
really useful way to do this lot of

571
00:49:29,440 --> 00:49:32,890
times it seems like to me and
controllers and other servers they get

572
00:49:32,890 --> 00:49:37,410
the tighter you know a pucker security
policies to get the tighter inspection I

573
00:49:37,410 --> 00:49:41,600
mean you can kind of avoid leaving your
persistence there another thing that we

574
00:49:41,600 --> 00:49:48,080
did was let's say you want to figure out
how passionately used happens one option

575
00:49:48,080 --> 00:49:52,210
is to get a username and a half or
password and try them against everything

576
00:49:52,210 --> 00:49:57,340
this is kind of a bad idea because you
could lock out accounts you might blow

577
00:49:57,340 --> 00:50:03,230
up in Siem if they have one of those so
how else do you identify final count has

578
00:50:03,230 --> 00:50:11,050
the same passer house where the same
password password nothing that you can

579
00:50:11,050 --> 00:50:17,070
do is to set up until capture server
distributing see pals around until

580
00:50:17,070 --> 00:50:22,510
unchallenged response come back and then
apply then try to brute force those

581
00:50:22,510 --> 00:50:28,030
offline so to my knowledge by before
prior to us releasing the script nobody

582
00:50:28,030 --> 00:50:34,930
had found a way of doing this with the
hashes alone there are various systems

583
00:50:34,930 --> 00:50:38,250
out there like go see a house cat which
will allow you to brute force the

584
00:50:38,250 --> 00:50:41,890
challenge response just with the
challenge response and they're going for

585
00:50:41,890 --> 00:50:44,650
passwords but

586
00:50:44,650 --> 00:50:48,799
what we what we did was we wrote a
script that allow you to do it with a

587
00:50:48,799 --> 00:50:53,309
hash so if you've captured the hassles
reuse somewhere else and you can't crack

588
00:50:53,309 --> 00:50:57,130
it no matter how good the password is a
you can still identify if it's been

589
00:50:57,130 --> 00:51:02,660
reused another account and I will do
that

590
00:51:02,660 --> 00:51:16,410
Superfest here all right so we have
we've got a system here

591
00:51:16,410 --> 00:51:30,220
console to somebody removed himself
still high and once we start that saw

592
00:51:30,220 --> 00:51:34,849
this is gonna be are are victims we've
done has tumbled one system and we've

593
00:51:34,849 --> 00:51:42,529
got think they're here know they are
somewhere else will find it later on the

594
00:51:42,529 --> 00:51:47,900
desktop so here's our here's our house
and we've done it from somewhere else

595
00:51:47,900 --> 00:51:53,359
reduces any of these houses without
being able to track them and they're

596
00:51:53,359 --> 00:52:10,460
going to use capture and we are at
fifty-six home one and so we spread a

597
00:52:10,460 --> 00:52:19,210
link or something over give them a link
to click on and they get a 2001 and what

598
00:52:19,210 --> 00:52:24,380
we got a whole bunch of town responses
using our spoofs challenges so we can

599
00:52:24,380 --> 00:52:28,779
see its user bobbed up Parker coming
from a scientist and he's got these

600
00:52:28,779 --> 00:52:38,320
various challenges so what we do is we
do capture house checks and this one

601
00:52:38,320 --> 00:52:49,450
we give it the account name which is bob
dunne Parker we get the client challenge

602
00:52:49,450 --> 00:53:01,770
which we cut from here the one that says
clients allen's put that there

603
00:53:01,770 --> 00:53:10,320
we do domain which is whatever they told
us the demand was in this cases Vista

604
00:53:10,320 --> 00:53:22,200
and then we do the ante has response
which is in the section called and he

605
00:53:22,200 --> 00:53:32,260
has and we do the server challenge which
in this case is default because we're on

606
00:53:32,260 --> 00:53:41,830
our own we ran our own capture
surveillance 2007 that in there and we

607
00:53:41,830 --> 00:53:55,260
will test this file which is just passes
and we run that and we found matching

608
00:53:55,260 --> 00:54:01,710
hash hash we've identified that this new
account that we did have the house for

609
00:54:01,710 --> 00:54:05,550
has a reuse house of account we did have
a house for this new account might be

610
00:54:05,550 --> 00:54:09,580
more privileged and we can then use its
credentials cache and take over from

611
00:54:09,580 --> 00:54:10,930
there

612
00:54:10,930 --> 00:54:16,890
that's our demo and when those most
certainly genuine

613
00:54:16,890 --> 00:54:29,330
1999 repository I get home I think it's
actually 909 be somebody else had taken

614
00:54:29,330 --> 00:54:42,540
the repository which we all right so pay
attention to trends do country search

615
00:54:42,540 --> 00:54:51,420
directory includes check your privilege
identify new and reuse financials and

616
00:54:51,420 --> 00:54:57,620
use them to your sister too offensive or
defensive work whenever you can

617
00:54:57,620 --> 00:55:06,660
are there any questions concerning

618
00:55:06,660 --> 00:55:18,520
derived credentials so what specifically
so they're likes you know they're

619
00:55:18,520 --> 00:55:23,400
they're things like Kerberos tickets
which you get past the original poster

620
00:55:23,400 --> 00:55:28,260
or whatever else you get that cover us
ticket and that's good for a certain

621
00:55:28,260 --> 00:55:34,860
period of time and those can be stolen
but aren't necessarily valid for as long

622
00:55:34,860 --> 00:55:36,410
as the other ones

