1
00:00:02,530 --> 00:00:07,650
so savior thank you good morning

2
00:00:06,759 --> 00:00:10,090
everybody

3
00:00:07,650 --> 00:00:12,010
first before starting the talk I would

4
00:00:10,090 --> 00:00:14,740
like to thank the organizer of F sake

5
00:00:12,010 --> 00:00:16,360
because they invited me and it's so my

6
00:00:14,740 --> 00:00:18,940
it's the first time that I'm adding this

7
00:00:16,360 --> 00:00:21,550
conference and also my first visit in

8
00:00:18,940 --> 00:00:23,710
Croatia we look to be a nice country so

9
00:00:21,550 --> 00:00:29,400
until now it's very nice it's a nice

10
00:00:23,710 --> 00:00:31,869
trip so let's start it was really a

11
00:00:29,400 --> 00:00:34,420
small introduction about myself but I'm

12
00:00:31,869 --> 00:00:36,550
well known under my nickname which is

13
00:00:34,420 --> 00:00:39,489
it's me almost on Twitter I'm very

14
00:00:36,550 --> 00:00:42,069
active on Twitter and as the presenter

15
00:00:39,489 --> 00:00:44,078
said I'm a freelancer a blogger I see

16
00:00:42,070 --> 00:00:46,750
handler so if you don't know the I see

17
00:00:44,079 --> 00:00:48,809
so the sun's internet storm center is an

18
00:00:46,750 --> 00:00:52,090
organization based in the US which

19
00:00:48,809 --> 00:00:55,510
monitors the internet 24th day and the

20
00:00:52,090 --> 00:00:58,510
organization is based on volunteers and

21
00:00:55,510 --> 00:01:00,760
the goal is to keep an eye on what's

22
00:00:58,510 --> 00:01:03,670
happening on the internet and to also

23
00:01:00,760 --> 00:01:06,460
raise some security awareness to give

24
00:01:03,670 --> 00:01:09,880
advice to people and to report some new

25
00:01:06,460 --> 00:01:12,939
vulnerabilities and so on different

26
00:01:09,880 --> 00:01:14,740
website my company my blog sand of

27
00:01:12,939 --> 00:01:17,259
course brick on which is a conference

28
00:01:14,740 --> 00:01:19,570
organized in Belgium next month but

29
00:01:17,260 --> 00:01:22,450
basically besides this description this

30
00:01:19,570 --> 00:01:24,369
is what my family my friends think that

31
00:01:22,450 --> 00:01:27,490
I'm doing every day I'm hunting I'm a

32
00:01:24,369 --> 00:01:29,799
nice guy and so on but anyway I'm this

33
00:01:27,490 --> 00:01:32,740
guy as most of you I'm doing stupid

34
00:01:29,799 --> 00:01:37,900
stuff sometimes and I'm doing boring

35
00:01:32,740 --> 00:01:43,509
stuff and a typical IT related job so

36
00:01:37,900 --> 00:01:45,610
why HTTP I've took it and in fact my

37
00:01:43,509 --> 00:01:47,619
kids they are not going on the internet

38
00:01:45,610 --> 00:01:48,820
they're going on Facebook they're going

39
00:01:47,619 --> 00:01:50,860
on what's up they don't know what's

40
00:01:48,820 --> 00:01:54,039
internet because today for many people

41
00:01:50,860 --> 00:01:56,979
the new generation Facebook is the

42
00:01:54,040 --> 00:01:59,950
internet that's so that's that's like

43
00:01:56,979 --> 00:02:02,229
this my wife the first page on my wall

44
00:01:59,950 --> 00:02:04,600
on my wife's computer is Google and she

45
00:02:02,229 --> 00:02:07,600
always starts to surf using Google she

46
00:02:04,600 --> 00:02:09,699
never typed the URL in the surf bar of

47
00:02:07,600 --> 00:02:11,060
the browser she tied well directly into

48
00:02:09,699 --> 00:02:14,989
Google search bar

49
00:02:11,060 --> 00:02:18,380
that's crazy so regarding HTTP we can

50
00:02:14,990 --> 00:02:22,340
also say that it's almost the same so

51
00:02:18,380 --> 00:02:23,660
HTTP in fact it's the new TCP this code

52
00:02:22,340 --> 00:02:26,780
I think is coming from Palo Alto

53
00:02:23,660 --> 00:02:30,500
Networks but I like this because today

54
00:02:26,780 --> 00:02:33,380
HTTP is used for almost anything on the

55
00:02:30,500 --> 00:02:35,930
Internet you can of course browse the

56
00:02:33,380 --> 00:02:40,160
Internet surf on website but you can

57
00:02:35,930 --> 00:02:43,100
manage stuff you can chat you can also

58
00:02:40,160 --> 00:02:45,920
read write emails Gmail come so how many

59
00:02:43,100 --> 00:02:49,310
people are still using email clients and

60
00:02:45,920 --> 00:02:51,820
configuring pop3 IMAP IMAP ask server

61
00:02:49,310 --> 00:02:55,130
maybe some technical guys but most

62
00:02:51,820 --> 00:02:58,519
regular people that use web mails so

63
00:02:55,130 --> 00:03:01,370
HTTP is used everywhere and if it's used

64
00:02:58,520 --> 00:03:03,709
everywhere we can also use HTTP for bad

65
00:03:01,370 --> 00:03:07,190
stuff so if we have a compromised

66
00:03:03,709 --> 00:03:09,530
machine HTTP is used first during the

67
00:03:07,190 --> 00:03:11,989
compromised ation face so we can

68
00:03:09,530 --> 00:03:14,150
download payloads over HTTP on the

69
00:03:11,989 --> 00:03:17,360
machine once the machine has been

70
00:03:14,150 --> 00:03:20,090
compromised we can control the machine

71
00:03:17,360 --> 00:03:23,110
un exchanged messages with the control

72
00:03:20,090 --> 00:03:27,140
center the c2 or CNC in two directions

73
00:03:23,110 --> 00:03:29,870
we can also exfiltrate data to another

74
00:03:27,140 --> 00:03:31,640
host and using a remote access tool we

75
00:03:29,870 --> 00:03:34,580
can completely manage the server

76
00:03:31,640 --> 00:03:38,179
remotely everything of all those tasks

77
00:03:34,580 --> 00:03:42,049
are based on HD HTTP protocol but you

78
00:03:38,180 --> 00:03:44,750
will say yeah today we have HTTP will it

79
00:03:42,049 --> 00:03:48,049
solve the problem no it doesn't solve

80
00:03:44,750 --> 00:03:49,280
the problem when I wrote the slider the

81
00:03:48,049 --> 00:03:52,130
first rhizoma slides

82
00:03:49,280 --> 00:03:53,900
HTTP you say is slowly increasing I

83
00:03:52,130 --> 00:03:56,750
remove this world because I see that

84
00:03:53,900 --> 00:04:00,920
today most malware has a lot of bad

85
00:03:56,750 --> 00:04:03,620
stuff happens over HTTPS but HTTPS

86
00:04:00,920 --> 00:04:05,570
remains complex to deploy for the

87
00:04:03,620 --> 00:04:07,790
attacker to attackers they try to keep

88
00:04:05,570 --> 00:04:11,060
simple and stupid stuff and they try to

89
00:04:07,790 --> 00:04:13,700
deploy as soon as possible new samples

90
00:04:11,060 --> 00:04:16,040
on servers and if they compromised a

91
00:04:13,700 --> 00:04:17,029
machine web site they don't care if the

92
00:04:16,040 --> 00:04:19,850
machine is

93
00:04:17,029 --> 00:04:21,679
is the the page on sort of HTTP HTTP

94
00:04:19,850 --> 00:04:25,370
they just need the files to be available

95
00:04:21,680 --> 00:04:27,860
from everywhere so really those people

96
00:04:25,370 --> 00:04:30,020
they don't care about you CPS if they

97
00:04:27,860 --> 00:04:32,300
need to drop a file and to hide the file

98
00:04:30,020 --> 00:04:35,090
they will just use another alternative

99
00:04:32,300 --> 00:04:37,160
system like X or atom in X all the files

100
00:04:35,090 --> 00:04:39,409
so the file is seen as a simple binary

101
00:04:37,160 --> 00:04:42,190
file over the Internet I will not be

102
00:04:39,410 --> 00:04:45,139
detected by anti redness IDs and so on

103
00:04:42,190 --> 00:04:48,889
but we have a new player today let's

104
00:04:45,139 --> 00:04:51,200
encrypt so let's encrypt I probably most

105
00:04:48,889 --> 00:04:54,650
of you know the system so you can get

106
00:04:51,200 --> 00:04:56,750
free certificates in a few minutes it's

107
00:04:54,650 --> 00:05:01,460
very straightforward to configure quite

108
00:04:56,750 --> 00:05:05,590
very easy but it will not change the the

109
00:05:01,460 --> 00:05:08,950
way attackers will use HTTPS because

110
00:05:05,590 --> 00:05:11,770
browser they are trying to fight against

111
00:05:08,950 --> 00:05:14,840
HTTP websites so starting from October

112
00:05:11,770 --> 00:05:18,080
Chrome will start to flash website which

113
00:05:14,840 --> 00:05:19,789
are not HTTPS as dangerous if you F if

114
00:05:18,080 --> 00:05:23,960
you try to submit information using a

115
00:05:19,790 --> 00:05:26,710
post so they try to do to make the user

116
00:05:23,960 --> 00:05:29,210
a rel that is dangerous but definitely

117
00:05:26,710 --> 00:05:31,940
can you spot the difference using these

118
00:05:29,210 --> 00:05:33,950
two websites on the left you have the

119
00:05:31,940 --> 00:05:36,770
official paypal web page in the login

120
00:05:33,950 --> 00:05:39,830
page and on the right side you have a

121
00:05:36,770 --> 00:05:42,500
fake one and if the window is tool in

122
00:05:39,830 --> 00:05:45,560
fact this domain you have paypal.com -

123
00:05:42,500 --> 00:05:48,919
with something so for mr. nobody it's

124
00:05:45,560 --> 00:05:51,979
exactly the same for yours the in the

125
00:05:48,919 --> 00:05:54,770
media in the press we always see we

126
00:05:51,979 --> 00:05:56,810
always listen that if you see the small

127
00:05:54,770 --> 00:05:59,359
yellow lock I know if you remember for

128
00:05:56,810 --> 00:06:01,610
the oldest people in the room if you see

129
00:05:59,360 --> 00:06:04,070
the yellow small lock in the browser you

130
00:06:01,610 --> 00:06:08,960
are safe yeah that's true that's not the

131
00:06:04,070 --> 00:06:12,650
case definitively so the idea of the

132
00:06:08,960 --> 00:06:15,440
talk was how to get a better

133
00:06:12,650 --> 00:06:18,669
understanding about HTTP how is it it

134
00:06:15,440 --> 00:06:21,169
should be used by the bad guys because

135
00:06:18,669 --> 00:06:23,750
that's some kind of my motto

136
00:06:21,169 --> 00:06:24,299
it's my email taxing at Reitsma on my

137
00:06:23,750 --> 00:06:27,180
blog

138
00:06:24,300 --> 00:06:30,240
if the enemy leaves a door you must rush

139
00:06:27,180 --> 00:06:32,550
in so I'm I like the principle of active

140
00:06:30,240 --> 00:06:35,610
playing active defense so it means that

141
00:06:32,550 --> 00:06:38,910
if somebody comes to me to do some nasty

142
00:06:35,610 --> 00:06:42,420
stuff I will react and see if I can

143
00:06:38,910 --> 00:06:44,840
abuse a system and if I can extract

144
00:06:42,420 --> 00:06:48,000
useful information to do more research

145
00:06:44,840 --> 00:06:50,159
between parentheses normally this this

146
00:06:48,000 --> 00:06:51,840
kind of stuff is private that you cannot

147
00:06:50,160 --> 00:06:54,180
do this in some countries because even

148
00:06:51,840 --> 00:06:56,789
scanning your system is prohibited but

149
00:06:54,180 --> 00:07:00,870
the idea is there active the Iranian

150
00:06:56,790 --> 00:07:03,270
active response how to get such kind of

151
00:07:00,870 --> 00:07:06,540
information so to find interesting stuff

152
00:07:03,270 --> 00:07:09,780
to research I have plenty of sources the

153
00:07:06,540 --> 00:07:12,300
first one is based in I really like PES

154
00:07:09,780 --> 00:07:14,609
bean I have an account for yours I have

155
00:07:12,300 --> 00:07:17,310
a machine scrapping piece being 24 hours

156
00:07:14,610 --> 00:07:19,440
a day seven days a week I'm scrapping

157
00:07:17,310 --> 00:07:21,960
all the Pastis and surfer interesting

158
00:07:19,440 --> 00:07:24,480
stuff based on regular expression and

159
00:07:21,960 --> 00:07:25,260
you can find plenty of interesting

160
00:07:24,480 --> 00:07:27,540
information

161
00:07:25,260 --> 00:07:32,010
plenty blending the second one is spam

162
00:07:27,540 --> 00:07:35,490
trap I'm the happy holder of multiple

163
00:07:32,010 --> 00:07:37,980
domain names for years more than 10-15

164
00:07:35,490 --> 00:07:40,230
years and those domains are present in

165
00:07:37,980 --> 00:07:42,750
all the spammer mailing lists over the

166
00:07:40,230 --> 00:07:45,000
world so it means that I received a lot

167
00:07:42,750 --> 00:07:48,600
of spam every day and trust me I like

168
00:07:45,000 --> 00:07:51,450
receiving spam because again I get a lot

169
00:07:48,600 --> 00:07:53,550
of data forget I get a lot of samples

170
00:07:51,450 --> 00:07:55,800
and of course there is some automation

171
00:07:53,550 --> 00:07:58,800
behind the spam so I'm extracting files

172
00:07:55,800 --> 00:08:02,940
automatically generating statistics and

173
00:07:58,800 --> 00:08:05,040
so on on e but I'm also deploying so

174
00:08:02,940 --> 00:08:08,400
many pots over the world in the Europe

175
00:08:05,040 --> 00:08:12,620
in the u.s. mainly mainly in Belgium in

176
00:08:08,400 --> 00:08:16,380
Mahara and you can also find a lot of

177
00:08:12,620 --> 00:08:19,860
attackers and spot them being a son's

178
00:08:16,380 --> 00:08:21,990
eyes I see enter we have a worldwide

179
00:08:19,860 --> 00:08:23,520
network of honeypot

180
00:08:21,990 --> 00:08:25,770
so everybody in this room is free to

181
00:08:23,520 --> 00:08:28,680
contribute prior honeypot and to follow

182
00:08:25,770 --> 00:08:32,010
to us the data and also we get some

183
00:08:28,680 --> 00:08:34,440
samples provided by by horrible so some

184
00:08:32,010 --> 00:08:36,429
people they submit files oh by the way I

185
00:08:34,440 --> 00:08:38,349
found this one could we investigate

186
00:08:36,429 --> 00:08:40,569
do some research and it's also a nice

187
00:08:38,349 --> 00:08:44,290
source of information and finally just

188
00:08:40,570 --> 00:08:46,390
panting so and then if you you find a

189
00:08:44,290 --> 00:08:48,219
nice well you find something which looks

190
00:08:46,390 --> 00:08:51,160
suspicious don't estate to spend some

191
00:08:48,220 --> 00:08:52,450
time and to to to really deal you don't

192
00:08:51,160 --> 00:08:54,219
know what you're looking for you don't

193
00:08:52,450 --> 00:08:55,959
know what you will find but you spend

194
00:08:54,220 --> 00:09:00,370
some time on the internet and trying to

195
00:08:55,959 --> 00:09:04,390
find information so once I have this

196
00:09:00,370 --> 00:09:06,339
information just the principle that I'm

197
00:09:04,390 --> 00:09:10,390
using so action-reaction so that's a

198
00:09:06,339 --> 00:09:12,970
nice formula on top of the slides from

199
00:09:10,390 --> 00:09:15,459
all my honey pots of course I get IP

200
00:09:12,970 --> 00:09:17,709
addresses and all those IP addresses are

201
00:09:15,459 --> 00:09:20,229
put in the database and every day I'm

202
00:09:17,709 --> 00:09:22,959
scanning the databases so the map that

203
00:09:20,230 --> 00:09:25,630
you see is a map of all the IP addresses

204
00:09:22,959 --> 00:09:29,079
which scanned my honey pots and I scan

205
00:09:25,630 --> 00:09:32,170
them and based on this I find

206
00:09:29,080 --> 00:09:34,330
compromised servers I find ft open FTP

207
00:09:32,170 --> 00:09:36,849
servers with plenty of nasty file I

208
00:09:34,330 --> 00:09:39,010
found web interface and protected web

209
00:09:36,850 --> 00:09:42,850
interface and some hasan so that's

210
00:09:39,010 --> 00:09:45,580
really the gold mine and amongst all

211
00:09:42,850 --> 00:09:49,000
those information i try to put more

212
00:09:45,580 --> 00:09:51,339
focus for a few months on websites so

213
00:09:49,000 --> 00:09:53,529
this is the definition of a web shell it

214
00:09:51,339 --> 00:09:57,640
i just did a copy-paste from the US so

215
00:09:53,529 --> 00:10:02,170
basically a web shell is a scene usually

216
00:09:57,640 --> 00:10:04,209
a single file written in perl PHP dotnet

217
00:10:02,170 --> 00:10:06,910
but in this presentation i will focus on

218
00:10:04,209 --> 00:10:09,130
PHP this is a one single file which

219
00:10:06,910 --> 00:10:12,610
contains a complete application that

220
00:10:09,130 --> 00:10:16,779
helps you to manage a server remotely

221
00:10:12,610 --> 00:10:19,150
using a web browser basically you can

222
00:10:16,779 --> 00:10:21,910
compare a simple web shell to a file

223
00:10:19,150 --> 00:10:24,339
manager if you remember the Norton

224
00:10:21,910 --> 00:10:26,199
commander on NCO leaves we have the two

225
00:10:24,339 --> 00:10:28,900
columns and you can manage files you can

226
00:10:26,200 --> 00:10:30,790
copy them write them delete them create

227
00:10:28,900 --> 00:10:35,649
ones and so that basically the feature

228
00:10:30,790 --> 00:10:38,110
for for up shell but the simple website

229
00:10:35,649 --> 00:10:40,990
that you can write is this one this is

230
00:10:38,110 --> 00:10:43,810
web shell what does it mean if you pass

231
00:10:40,990 --> 00:10:47,350
to the you ll the parameter C equals

232
00:10:43,810 --> 00:10:48,390
something in PHP it will be executed on

233
00:10:47,350 --> 00:10:50,040
the server

234
00:10:48,390 --> 00:10:52,710
that's the simple web shell that we can

235
00:10:50,040 --> 00:10:55,860
create but they have also plenty of

236
00:10:52,710 --> 00:10:57,870
other features so the most important one

237
00:10:55,860 --> 00:11:00,750
file manipulation basically is a file

238
00:10:57,870 --> 00:11:04,380
manager but but yeah I've had it a lot

239
00:11:00,750 --> 00:11:06,720
of interesting modules system command

240
00:11:04,380 --> 00:11:08,610
execution you're on the server why not

241
00:11:06,720 --> 00:11:11,730
have a shell and just execute system

242
00:11:08,610 --> 00:11:13,980
commands database administration if you

243
00:11:11,730 --> 00:11:16,290
know PHP my admin which is also some

244
00:11:13,980 --> 00:11:18,570
kind of web shell because you can manage

245
00:11:16,290 --> 00:11:20,670
stuff using the web browser you can

246
00:11:18,570 --> 00:11:23,400
manage my scale database using web shell

247
00:11:20,670 --> 00:11:26,339
of course you can use them for nasty

248
00:11:23,400 --> 00:11:28,470
stuff you can scan you can compromise a

249
00:11:26,340 --> 00:11:30,630
server so you can do try to escalate to

250
00:11:28,470 --> 00:11:33,150
do privilege escalation to get root

251
00:11:30,630 --> 00:11:35,160
access and so on and you can also some

252
00:11:33,150 --> 00:11:37,530
funny stuff too much minion just and

253
00:11:35,160 --> 00:11:40,290
your generate spam campaign and so on so

254
00:11:37,530 --> 00:11:42,689
basically it's like a swiss knife you

255
00:11:40,290 --> 00:11:46,500
have plenty of modules that you can use

256
00:11:42,690 --> 00:11:48,990
and it's very very powerful just for the

257
00:11:46,500 --> 00:11:51,840
fun some I don't know if a lot of you

258
00:11:48,990 --> 00:11:54,390
already saw web shells in the wild or on

259
00:11:51,840 --> 00:11:56,400
your servers if you find some on your

260
00:11:54,390 --> 00:11:59,210
servers you are in a bad situation

261
00:11:56,400 --> 00:12:01,650
some of them are very simple like this

262
00:11:59,210 --> 00:12:03,810
some of them looks very professional

263
00:12:01,650 --> 00:12:07,020
because the interface is nice a lot of

264
00:12:03,810 --> 00:12:10,800
patterns and very easy to understand

265
00:12:07,020 --> 00:12:13,079
some of them are quite simple some of

266
00:12:10,800 --> 00:12:15,420
them are very difficult to read so you

267
00:12:13,080 --> 00:12:17,100
see the buttons that you have here are

268
00:12:15,420 --> 00:12:19,500
all the different modules that you can

269
00:12:17,100 --> 00:12:23,070
have activate it there are plenty of

270
00:12:19,500 --> 00:12:25,110
different features some of them because

271
00:12:23,070 --> 00:12:27,570
they are used by screen I call them

272
00:12:25,110 --> 00:12:30,120
script kiddies and it's completely

273
00:12:27,570 --> 00:12:34,020
unreadable I don't know how people can

274
00:12:30,120 --> 00:12:36,900
work with a website like this and what's

275
00:12:34,020 --> 00:12:39,510
interesting so I collected a lot a lot

276
00:12:36,900 --> 00:12:43,199
of samples all of those options are not

277
00:12:39,510 --> 00:12:45,120
very different this will put it just a

278
00:12:43,200 --> 00:12:47,940
div of two different websites that I

279
00:12:45,120 --> 00:12:50,400
found and this is read thief of the two

280
00:12:47,940 --> 00:12:54,090
websites in fact the guy they just reuse

281
00:12:50,400 --> 00:12:55,620
the web shell they change the name they

282
00:12:54,090 --> 00:12:58,200
change the default password which is

283
00:12:55,620 --> 00:12:59,710
usually md5 they change the background

284
00:12:58,200 --> 00:13:02,170
color they put a nice pitch

285
00:12:59,710 --> 00:13:05,410
and so on today they just revamp the web

286
00:13:02,170 --> 00:13:06,939
shell that's so you can have nice

287
00:13:05,410 --> 00:13:10,240
picture like you saw in previous slide

288
00:13:06,940 --> 00:13:11,980
but the feature is acted the same and of

289
00:13:10,240 --> 00:13:14,680
course why do we need to reopen the

290
00:13:11,980 --> 00:13:16,570
wheel this screenshot is coming from

291
00:13:14,680 --> 00:13:19,899
Viper I'm a big fan of the Viper

292
00:13:16,570 --> 00:13:23,580
framework to analyze malware and Viper

293
00:13:19,899 --> 00:13:27,820
as your module to use SS deep to compute

294
00:13:23,580 --> 00:13:30,250
to build a signature of of a file and

295
00:13:27,820 --> 00:13:33,040
find in the database if they are fine

296
00:13:30,250 --> 00:13:36,010
which are almost the same and you see

297
00:13:33,040 --> 00:13:39,459
that for one web shell I have twelve

298
00:13:36,010 --> 00:13:43,240
matches starting from 71 percent to

299
00:13:39,459 --> 00:13:46,140
seventy one fifty four and so on so you

300
00:13:43,240 --> 00:13:49,360
see that most web shells are a lot of

301
00:13:46,140 --> 00:13:53,080
code in common and they just Riven the

302
00:13:49,360 --> 00:13:55,690
wheel all the time so what are the

303
00:13:53,080 --> 00:13:58,420
protections of option if you try to go

304
00:13:55,690 --> 00:14:00,490
deeper now so our server is compromised

305
00:13:58,420 --> 00:14:03,579
the guy installed web challon's on the

306
00:14:00,490 --> 00:14:06,250
server but the risk to have is web shell

307
00:14:03,580 --> 00:14:09,880
found by another attacker is very high

308
00:14:06,250 --> 00:14:12,910
or by a regular people a guy of yeah a

309
00:14:09,880 --> 00:14:15,640
web crawler like Googlebot and so what

310
00:14:12,910 --> 00:14:17,469
are the different protections and then

311
00:14:15,640 --> 00:14:19,360
we will start with a lot of stuff that I

312
00:14:17,470 --> 00:14:22,150
found the first one is quite easy the

313
00:14:19,360 --> 00:14:24,400
user agent in this piece of code we see

314
00:14:22,150 --> 00:14:27,069
that the word shell checks the user

315
00:14:24,400 --> 00:14:29,500
agent passed by the browser and if the

316
00:14:27,070 --> 00:14:32,410
user agent contains but if one of the

317
00:14:29,500 --> 00:14:35,110
words Googlebot slow MSN boats and

318
00:14:32,410 --> 00:14:38,140
Yahoo's remember index with crawler and

319
00:14:35,110 --> 00:14:40,510
so on it will just return a fourth one

320
00:14:38,140 --> 00:14:42,819
dress so using this technique they

321
00:14:40,510 --> 00:14:45,880
prevent web crawlers to index their

322
00:14:42,820 --> 00:14:48,310
websites so if you are looking for you

323
00:14:45,880 --> 00:14:50,230
are trying to use google dorks to find

324
00:14:48,310 --> 00:14:53,969
web shell you will not be lucky because

325
00:14:50,230 --> 00:14:57,370
usually the nothing text by the crawlers

326
00:14:53,970 --> 00:15:00,459
another example is some hidden look in

327
00:14:57,370 --> 00:15:03,940
or even more bypass authentication in

328
00:15:00,459 --> 00:15:07,270
this example first that's what's nice

329
00:15:03,940 --> 00:15:09,089
instead of displaying of having built in

330
00:15:07,270 --> 00:15:11,249
a whore they

331
00:15:09,089 --> 00:15:13,379
display a default page coming from

332
00:15:11,249 --> 00:15:16,079
github so the for all three engine

333
00:15:13,379 --> 00:15:19,559
exhausting task page of ingenious so in

334
00:15:16,079 --> 00:15:23,539
this code what we see if the attacker

335
00:15:19,559 --> 00:15:26,909
would like to access the web shell use

336
00:15:23,539 --> 00:15:30,389
quotation mark in equals the the number

337
00:15:26,909 --> 00:15:33,119
if this parameter is past the web shell

338
00:15:30,389 --> 00:15:35,129
will not display the login page which is

339
00:15:33,119 --> 00:15:36,899
classic login passwords on and will

340
00:15:35,129 --> 00:15:41,519
automatically it will automatically

341
00:15:36,899 --> 00:15:44,339
access to the to the web interface so as

342
00:15:41,519 --> 00:15:46,679
I said all those web shell as most of

343
00:15:44,339 --> 00:15:49,349
them has been found on pastebin but

344
00:15:46,679 --> 00:15:50,699
don't think that the sent on piece been

345
00:15:49,349 --> 00:15:53,579
in clear text of course they are

346
00:15:50,699 --> 00:15:58,429
obsolete obfuscated usually you will

347
00:15:53,579 --> 00:16:01,348
have only a dump of data and they use

348
00:15:58,429 --> 00:16:03,809
base64 sometimes rot13

349
00:16:01,349 --> 00:16:06,779
and gzip deflate to hide the code that's

350
00:16:03,809 --> 00:16:08,399
the standard stuff in 99 percent of the

351
00:16:06,779 --> 00:16:11,879
time it's one of those three

352
00:16:08,399 --> 00:16:13,649
combinations which is used but they can

353
00:16:11,879 --> 00:16:15,959
you know they can also obfuscate using

354
00:16:13,649 --> 00:16:18,659
all the techniques they just instead of

355
00:16:15,959 --> 00:16:20,279
writing the simple string they just

356
00:16:18,659 --> 00:16:23,429
convert the string in exactly similar

357
00:16:20,279 --> 00:16:25,339
code don't try to read this but your

358
00:16:23,429 --> 00:16:28,348
computer will do this missile program

359
00:16:25,339 --> 00:16:30,689
you can also mix and then I would like

360
00:16:28,349 --> 00:16:33,029
to thank the PHP developers because

361
00:16:30,689 --> 00:16:36,269
pitch is a wonderful development

362
00:16:33,029 --> 00:16:38,909
language you can create variables with

363
00:16:36,269 --> 00:16:41,249
random strings and this variable will be

364
00:16:38,909 --> 00:16:44,339
the name of a fraction and then you will

365
00:16:41,249 --> 00:16:48,239
cut concatenate different strings to

366
00:16:44,339 --> 00:16:50,939
finally generate another one and the

367
00:16:48,239 --> 00:16:53,579
obfuscation of this one is the same code

368
00:16:50,939 --> 00:16:55,199
as previous gzip inflate basic c40 code

369
00:16:53,579 --> 00:16:57,269
says your three in blah blah blah blah

370
00:16:55,199 --> 00:17:00,419
at this parameter so it's a nice way to

371
00:16:57,269 --> 00:17:04,349
escape so once again thank you for PHP

372
00:17:00,419 --> 00:17:08,549
to be supremacist in in writing shitty

373
00:17:04,349 --> 00:17:12,388
code definitively they can also inject

374
00:17:08,549 --> 00:17:14,970
some random get params so if you put at

375
00:17:12,388 --> 00:17:17,428
the end of your web shell you put

376
00:17:14,970 --> 00:17:19,919
question are full equal bar you will

377
00:17:17,429 --> 00:17:20,839
access to app shell if you don't you

378
00:17:19,919 --> 00:17:23,750
will get a

379
00:17:20,839 --> 00:17:26,658
for that's simple and stupid but it

380
00:17:23,750 --> 00:17:28,459
works sometimes when they compromise a

381
00:17:26,659 --> 00:17:30,919
server and they have already an access

382
00:17:28,459 --> 00:17:33,320
to to put more files they just create an

383
00:17:30,919 --> 00:17:35,960
HT Access file so it's Jax's file dotage

384
00:17:33,320 --> 00:17:38,960
access is a file used by the Apache web

385
00:17:35,960 --> 00:17:41,870
server to change on the fly the

386
00:17:38,960 --> 00:17:43,990
configuration of the web server in this

387
00:17:41,870 --> 00:17:46,699
case it's not coming from a web shell

388
00:17:43,990 --> 00:17:48,890
it's coming from a phishing page but I

389
00:17:46,700 --> 00:17:52,130
like the example it was in fact it was a

390
00:17:48,890 --> 00:17:55,279
phishing page targeting French people so

391
00:17:52,130 --> 00:17:58,399
it means that if the what what means it

392
00:17:55,279 --> 00:18:01,460
the dot H Jax's file if you are coming

393
00:17:58,399 --> 00:18:03,949
from an ESP called wanna do dot FA s FL

394
00:18:01,460 --> 00:18:06,260
net toxic pneumonia which are all the

395
00:18:03,950 --> 00:18:08,000
big players on the French market you

396
00:18:06,260 --> 00:18:11,299
will get access to the phishing page

397
00:18:08,000 --> 00:18:15,049
otherwise we'd get a four or three zero

398
00:18:11,299 --> 00:18:16,639
so that's a way to prevent researcher to

399
00:18:15,049 --> 00:18:18,379
prevent people to access the phishing

400
00:18:16,640 --> 00:18:20,960
page because the fish get the fishing

401
00:18:18,380 --> 00:18:25,309
kit was for example targeting for

402
00:18:20,960 --> 00:18:27,320
silicon EF and so on and so they can

403
00:18:25,309 --> 00:18:31,908
also check your fully qualified domain

404
00:18:27,320 --> 00:18:34,460
name so they do reverse lookup and if in

405
00:18:31,909 --> 00:18:39,350
your host name you have Google SoftLayer

406
00:18:34,460 --> 00:18:41,779
Amazon Amazon Cloud dream all net pilot

407
00:18:39,350 --> 00:18:43,969
and so on you will be kicked out why

408
00:18:41,779 --> 00:18:46,399
because usually researcher I'm using

409
00:18:43,970 --> 00:18:49,760
Amazon Elastic cloud to run some virtual

410
00:18:46,399 --> 00:18:52,879
systems and they are chain that if an

411
00:18:49,760 --> 00:18:55,669
Amazon system is coming to your phishing

412
00:18:52,880 --> 00:18:58,370
page your web shell it's not a user it's

413
00:18:55,669 --> 00:19:02,539
just a system and automatic tool or

414
00:18:58,370 --> 00:19:04,520
researcher doing some some stuff if we

415
00:19:02,539 --> 00:19:06,320
can at least fully qualified domain name

416
00:19:04,520 --> 00:19:11,570
you can also blacklist

417
00:19:06,320 --> 00:19:13,610
IP addresses so if your IP address is in

418
00:19:11,570 --> 00:19:16,700
a list that I redacted I don't put the

419
00:19:13,610 --> 00:19:19,189
list of IP addresses in the slide you

420
00:19:16,700 --> 00:19:21,679
will just get banned and those list of

421
00:19:19,190 --> 00:19:24,320
IP addresses usually they contain first

422
00:19:21,679 --> 00:19:26,450
the country that cannot be targeted so

423
00:19:24,320 --> 00:19:31,189
for example if the malicious code

424
00:19:26,450 --> 00:19:33,680
targets people from Russia they will

425
00:19:31,190 --> 00:19:36,560
they will ban the Ukrainian I care

426
00:19:33,680 --> 00:19:38,510
is just an example or they will black

427
00:19:36,560 --> 00:19:41,510
their blacklist that you can find on the

428
00:19:38,510 --> 00:19:44,330
dark web on forums containing all the

429
00:19:41,510 --> 00:19:47,210
list of all the antivirus vendors so

430
00:19:44,330 --> 00:19:49,580
people working for an anti-virus a POC

431
00:19:47,210 --> 00:19:51,800
if they try to access the website the

432
00:19:49,580 --> 00:19:55,399
malicious page they will get an access

433
00:19:51,800 --> 00:19:57,290
denied the HTTP referer is also

434
00:19:55,400 --> 00:19:59,570
interesting so if you are not coming

435
00:19:57,290 --> 00:20:03,139
from this page of you can also

436
00:19:59,570 --> 00:20:04,970
manipulate HSB refer then you will be

437
00:20:03,140 --> 00:20:07,490
actually will be granted or access

438
00:20:04,970 --> 00:20:09,920
denied to the web page the goal is first

439
00:20:07,490 --> 00:20:12,110
to be sure that you follow a correct

440
00:20:09,920 --> 00:20:14,420
path so in case of an exploit kit you

441
00:20:12,110 --> 00:20:17,149
will get the payload only if you are

442
00:20:14,420 --> 00:20:20,510
coming from this page or you can also

443
00:20:17,150 --> 00:20:22,250
put some specific code some hidden elite

444
00:20:20,510 --> 00:20:25,550
some kind of flag in the referrer to

445
00:20:22,250 --> 00:20:28,010
grant access to the page it's the same

446
00:20:25,550 --> 00:20:30,649
thing with custom HTTP headers if we

447
00:20:28,010 --> 00:20:32,870
create in the HTTP request X malicious

448
00:20:30,650 --> 00:20:35,810
header we can put in this case I put my

449
00:20:32,870 --> 00:20:38,989
kill string then we can generate

450
00:20:35,810 --> 00:20:43,639
different behavior and again grieve

451
00:20:38,990 --> 00:20:46,370
access denied access the page fragments

452
00:20:43,640 --> 00:20:49,160
I saw a lot of web shell when they just

453
00:20:46,370 --> 00:20:51,679
put fake acraman so if you don't open

454
00:20:49,160 --> 00:20:53,870
something the access will be denied so

455
00:20:51,680 --> 00:20:57,440
simply so you need and even the the

456
00:20:53,870 --> 00:20:59,719
question mark t48 one one any girls tree

457
00:20:57,440 --> 00:21:03,620
is just something random you just need

458
00:20:59,720 --> 00:21:07,240
to provide a fake agreement if you don't

459
00:21:03,620 --> 00:21:07,239
provide one you are just kicked out

460
00:21:09,310 --> 00:21:14,330
geolocalization it's another one

461
00:21:11,900 --> 00:21:18,410
so Jurek a logician they use a lot of

462
00:21:14,330 --> 00:21:19,909
tools like fridge yp.com i will show you

463
00:21:18,410 --> 00:21:23,150
a nice example in a few minutes

464
00:21:19,910 --> 00:21:25,760
about another one so the goal is just to

465
00:21:23,150 --> 00:21:28,250
restrict access to grant access based on

466
00:21:25,760 --> 00:21:30,650
the country so if you target people in

467
00:21:28,250 --> 00:21:32,210
Croatia you will only grant access to

468
00:21:30,650 --> 00:21:36,920
people coming from Croatia

469
00:21:32,210 --> 00:21:40,700
so simply also why keep all the data on

470
00:21:36,920 --> 00:21:43,010
your on your web server because you can

471
00:21:40,700 --> 00:21:44,150
maybe blacklist some stuff you can pass

472
00:21:43,010 --> 00:21:46,520
your proxies and

473
00:21:44,150 --> 00:21:49,820
so this is an example of code that I

474
00:21:46,520 --> 00:21:52,100
found in in many web shells web shells

475
00:21:49,820 --> 00:21:54,110
include features to install older tools

476
00:21:52,100 --> 00:21:57,050
so you can deploy more tools when you

477
00:21:54,110 --> 00:22:00,760
get access to a web shell and all those

478
00:21:57,050 --> 00:22:04,040
tools usually taught on paste bin I will

479
00:22:00,760 --> 00:22:06,500
this I did not obviate the derailleur

480
00:22:04,040 --> 00:22:08,810
because okay I consumed space beans

481
00:22:06,500 --> 00:22:10,910
public so all those wires are too big so

482
00:22:08,810 --> 00:22:13,820
you can find them or it just contain

483
00:22:10,910 --> 00:22:17,810
shitty code with more backdoors more web

484
00:22:13,820 --> 00:22:20,389
citizen and so on this one is a nice

485
00:22:17,810 --> 00:22:23,210
example in the beginning of the tour I

486
00:22:20,390 --> 00:22:25,010
say that the bad guys they don't care

487
00:22:23,210 --> 00:22:26,360
about the GPS because it's boring to

488
00:22:25,010 --> 00:22:28,490
depress it appears you need to generate

489
00:22:26,360 --> 00:22:30,830
a certificate to wreck off your server

490
00:22:28,490 --> 00:22:34,370
and so on but if you compromise a server

491
00:22:30,830 --> 00:22:37,280
which is not HTTP enable you can still

492
00:22:34,370 --> 00:22:40,250
need some privacy between codes and

493
00:22:37,280 --> 00:22:41,930
encrypt your traffic so there is a very

494
00:22:40,250 --> 00:22:43,640
nice project resist which is not

495
00:22:41,930 --> 00:22:45,410
malicious it was a project of a

496
00:22:43,640 --> 00:22:47,690
researcher it's on get up

497
00:22:45,410 --> 00:22:51,140
it's called nit riddle and using a

498
00:22:47,690 --> 00:22:53,300
simple backdoor you can just encrypt and

499
00:22:51,140 --> 00:22:55,280
decrypt your traffic between the web

500
00:22:53,300 --> 00:22:57,500
shell and your browser on the fly so

501
00:22:55,280 --> 00:23:00,379
every request HTTP request that you will

502
00:22:57,500 --> 00:23:01,460
send will be encrypted it's very nice

503
00:23:00,380 --> 00:23:04,670
have a look

504
00:23:01,460 --> 00:23:06,410
it will be on the slide so it's it's a

505
00:23:04,670 --> 00:23:09,980
good way to learn all the encryption is

506
00:23:06,410 --> 00:23:12,860
working without HTTPS so if you wanna

507
00:23:09,980 --> 00:23:14,860
play for recommendation if you would

508
00:23:12,860 --> 00:23:17,689
like to investigate some time in some

509
00:23:14,860 --> 00:23:21,139
trying to find web shells investigating

510
00:23:17,690 --> 00:23:23,480
code first use a DSL line so an animal

511
00:23:21,140 --> 00:23:26,390
anonymous internet connection never use

512
00:23:23,480 --> 00:23:29,720
IP connectivity from your corporate

513
00:23:26,390 --> 00:23:32,450
network your corporate proxy and it's

514
00:23:29,720 --> 00:23:34,820
better to use a multi exit node VPN

515
00:23:32,450 --> 00:23:36,860
provider so you can test the web shell

516
00:23:34,820 --> 00:23:38,840
from different countries you start a VPN

517
00:23:36,860 --> 00:23:41,419
session with the endpoint in the US

518
00:23:38,840 --> 00:23:44,209
roxette's web shell you stop it you

519
00:23:41,420 --> 00:23:45,920
access the same page from Croatia you

520
00:23:44,210 --> 00:23:48,980
will get maybe different results could

521
00:23:45,920 --> 00:23:51,260
be interesting it's the same user agent

522
00:23:48,980 --> 00:23:54,170
try to access the web shell using a

523
00:23:51,260 --> 00:23:56,320
normal browser try to access the web

524
00:23:54,170 --> 00:23:58,330
shell using a mobile browser

525
00:23:56,320 --> 00:24:01,419
user agent you will see many differences

526
00:23:58,330 --> 00:24:03,129
and generate interesting referrals what

527
00:24:01,420 --> 00:24:06,340
happens if you come from Google what

528
00:24:03,130 --> 00:24:08,920
happen if you come from another website

529
00:24:06,340 --> 00:24:12,490
from a newspaper something like that you

530
00:24:08,920 --> 00:24:14,920
can maybe find interesting stuff so all

531
00:24:12,490 --> 00:24:17,380
the example that I gave here are nice

532
00:24:14,920 --> 00:24:20,370
because they explain all people the body

533
00:24:17,380 --> 00:24:23,320
I try to protect themselves but in fact

534
00:24:20,370 --> 00:24:28,419
people the bad guys are human so they

535
00:24:23,320 --> 00:24:31,659
also make mistakes like everybody so my

536
00:24:28,420 --> 00:24:33,130
lab just which man who I worked I when I

537
00:24:31,660 --> 00:24:35,800
don't know the web shell it just

538
00:24:33,130 --> 00:24:38,650
executed in sandbox on the separate

539
00:24:35,800 --> 00:24:41,139
dedicated infrastructure using a wild

540
00:24:38,650 --> 00:24:43,840
internet connectivity in front of the

541
00:24:41,140 --> 00:24:46,990
between the internet and my lamp server

542
00:24:43,840 --> 00:24:48,850
I have need yes very very important full

543
00:24:46,990 --> 00:24:51,340
packet capture so I can capture all the

544
00:24:48,850 --> 00:24:55,449
communications between the web shell and

545
00:24:51,340 --> 00:24:57,879
Cincy or the the user and it's

546
00:24:55,450 --> 00:24:59,410
interesting to have a caddy system

547
00:24:57,880 --> 00:25:01,690
because I'm a big fan of Bourke Street

548
00:24:59,410 --> 00:25:04,720
and using birds you can modify on the

549
00:25:01,690 --> 00:25:06,760
flight HTTP request add some arguments

550
00:25:04,720 --> 00:25:09,070
remove them change them to some

551
00:25:06,760 --> 00:25:12,070
motivation and so on so the methodology

552
00:25:09,070 --> 00:25:15,189
is you collect you deploy in the lab you

553
00:25:12,070 --> 00:25:19,300
do a quick scan you do some code review

554
00:25:15,190 --> 00:25:20,800
I'm not a reviewer so I had to do this

555
00:25:19,300 --> 00:25:22,330
so don't ask me to read to do

556
00:25:20,800 --> 00:25:22,720
comfortable review it's not my cup of

557
00:25:22,330 --> 00:25:26,530
tea

558
00:25:22,720 --> 00:25:30,670
do manual test and of course full packet

559
00:25:26,530 --> 00:25:31,060
captures so one word about automatic

560
00:25:30,670 --> 00:25:32,920
scanning

561
00:25:31,060 --> 00:25:35,740
it's tempting when you see web shell to

562
00:25:32,920 --> 00:25:38,820
start using burp suite name your best

563
00:25:35,740 --> 00:25:42,160
web scanner it's tempting to scan it

564
00:25:38,820 --> 00:25:44,889
usually it's completely useful because

565
00:25:42,160 --> 00:25:48,310
the web shell by default by the arrow

566
00:25:44,890 --> 00:25:50,590
allows file inclusion it used page pecan

567
00:25:48,310 --> 00:25:53,050
injection it allows directory traversal

568
00:25:50,590 --> 00:25:54,850
code execution zone so we will get a lot

569
00:25:53,050 --> 00:25:56,350
of for positive coming from your web

570
00:25:54,850 --> 00:25:59,320
scanner so don't try this it's

571
00:25:56,350 --> 00:26:02,260
completely losing your time but some

572
00:25:59,320 --> 00:26:05,860
tips so work in the sandbox do not use a

573
00:26:02,260 --> 00:26:07,270
corporate computer if you don't want to

574
00:26:05,860 --> 00:26:09,750
connect to the internet you can use

575
00:26:07,270 --> 00:26:11,910
anything which is a to which small

576
00:26:09,750 --> 00:26:14,040
it's Internet services you can submit a

577
00:26:11,910 --> 00:26:17,520
web browser FTP server mail server and

578
00:26:14,040 --> 00:26:19,530
so on and abuse the snapshot of your

579
00:26:17,520 --> 00:26:22,290
iPad reserve so you snapshot you test

580
00:26:19,530 --> 00:26:25,440
revert snapshot snapshot all the time so

581
00:26:22,290 --> 00:26:27,810
what did I found this is just for the

582
00:26:25,440 --> 00:26:30,420
fun but developers of website they also

583
00:26:27,810 --> 00:26:32,190
use deprecated function so you get some

584
00:26:30,420 --> 00:26:35,730
nice warning from time to time this guy

585
00:26:32,190 --> 00:26:38,910
is using the old MySQL API PHP okay

586
00:26:35,730 --> 00:26:43,110
nothing special but it's just just funny

587
00:26:38,910 --> 00:26:47,340
to find director indexing when they

588
00:26:43,110 --> 00:26:49,620
compromised a server usually they forget

589
00:26:47,340 --> 00:26:52,260
or they don't protect properly the web

590
00:26:49,620 --> 00:26:55,530
server so it means that the dot reflex

591
00:26:52,260 --> 00:26:57,900
is when I'm visiting a website if I'm

592
00:26:55,530 --> 00:27:00,570
finally what URL blah blah blah slash

593
00:26:57,900 --> 00:27:02,940
territory slash file I always have the

594
00:27:00,570 --> 00:27:05,700
reflex to go back to go up open

595
00:27:02,940 --> 00:27:08,810
directory to see if some files are

596
00:27:05,700 --> 00:27:12,960
available and sometime you are lucky so

597
00:27:08,810 --> 00:27:15,929
in this case I found it was the the

598
00:27:12,960 --> 00:27:18,270
panel of a C&C server and what's nice

599
00:27:15,930 --> 00:27:20,700
that the guy like to deploy the stuff

600
00:27:18,270 --> 00:27:22,500
they just copy a zip file and you read

601
00:27:20,700 --> 00:27:24,060
the zip file remain on the server so you

602
00:27:22,500 --> 00:27:26,160
can just download the zip file and you

603
00:27:24,060 --> 00:27:28,800
have a copy of all the web shell all the

604
00:27:26,160 --> 00:27:33,270
CNC files locally you can deploy it on

605
00:27:28,800 --> 00:27:35,669
your VM and start the analysis this one

606
00:27:33,270 --> 00:27:37,440
has nothing to do with a web shell but I

607
00:27:35,670 --> 00:27:39,960
found this on the internet I found very

608
00:27:37,440 --> 00:27:42,870
into exam very lucky it's very very bad

609
00:27:39,960 --> 00:27:45,060
behavior the user creation on on on the

610
00:27:42,870 --> 00:27:46,560
panel web panel I'd you know I don't

611
00:27:45,060 --> 00:27:49,379
know if you can read the message but the

612
00:27:46,560 --> 00:27:51,540
message says the password is being used

613
00:27:49,380 --> 00:27:55,560
by this user please choose another

614
00:27:51,540 --> 00:27:57,210
password documents but I had to put this

615
00:27:55,560 --> 00:27:59,330
slide in my presentation because it is

616
00:27:57,210 --> 00:28:02,539
very very bad coding Yin

617
00:27:59,330 --> 00:28:05,539
of course you can find a lot of classic

618
00:28:02,539 --> 00:28:10,700
vulnerabilities cross-site scripting yes

619
00:28:05,539 --> 00:28:12,529
what else all those all these so the

620
00:28:10,700 --> 00:28:15,590
cookies if they use cookie they are not

621
00:28:12,529 --> 00:28:17,330
protected at all CSRF is available so

622
00:28:15,590 --> 00:28:19,100
that's classic stuff for what this thing

623
00:28:17,330 --> 00:28:21,470
I like this one

624
00:28:19,100 --> 00:28:23,449
usually they don't protect against O's

625
00:28:21,470 --> 00:28:26,419
either attacks or what's a hosted or

626
00:28:23,450 --> 00:28:28,970
attack when you manipulate a get HTTP

627
00:28:26,419 --> 00:28:31,999
requests and you replace the lost by for

628
00:28:28,970 --> 00:28:34,519
example I'm I feel calm in fact if you

629
00:28:31,999 --> 00:28:36,859
get a redirect the redirect will be so

630
00:28:34,519 --> 00:28:39,859
the attacker will be sent to your server

631
00:28:36,859 --> 00:28:41,539
so it means that if you manipulate and

632
00:28:39,859 --> 00:28:43,399
you replicate the content of the web

633
00:28:41,539 --> 00:28:45,499
shell on your home server the guy will

634
00:28:43,399 --> 00:28:47,178
be redirected and then you can track in

635
00:28:45,499 --> 00:28:50,659
and follow exactly what he is doing and

636
00:28:47,179 --> 00:28:52,700
so that's nice of course we have with we

637
00:28:50,659 --> 00:28:54,830
caught on occasion I saw this if

638
00:28:52,700 --> 00:28:58,429
password calls password then it works

639
00:28:54,830 --> 00:29:02,119
and just for the fun I also collected

640
00:28:58,429 --> 00:29:03,769
the most password seen in all the web

641
00:29:02,119 --> 00:29:07,129
shall sample that I downloaded this is

642
00:29:03,769 --> 00:29:10,039
an example admins classic uncocks alpha

643
00:29:07,129 --> 00:29:12,320
5 space why not

644
00:29:10,039 --> 00:29:16,940
endo exploit this is a very active group

645
00:29:12,320 --> 00:29:18,109
on the the web shell seen for W seconds

646
00:29:16,940 --> 00:29:20,539
on and so on

647
00:29:18,109 --> 00:29:22,549
but basically they provide very big

648
00:29:20,539 --> 00:29:24,980
authentication they don't protect again

649
00:29:22,549 --> 00:29:27,529
brute-force attacks so if you don't know

650
00:29:24,980 --> 00:29:29,749
the password don't you can just start a

651
00:29:27,529 --> 00:29:31,759
brute force attack using your best tool

652
00:29:29,749 --> 00:29:34,419
and enough usually in a few minutes

653
00:29:31,759 --> 00:29:37,669
depending on the speed of your line and

654
00:29:34,419 --> 00:29:40,309
the the web shell the web server you

655
00:29:37,669 --> 00:29:42,320
will get the password in no time but

656
00:29:40,309 --> 00:29:44,450
sometimes you don't you you even don't

657
00:29:42,320 --> 00:29:46,330
have to look for the password because

658
00:29:44,450 --> 00:29:50,720
you can just bypass the authentication

659
00:29:46,330 --> 00:29:52,970
so this is a Chinese web interface when

660
00:29:50,720 --> 00:29:55,159
normally so when you log in and you can

661
00:29:52,970 --> 00:29:57,529
download some files in fact if you

662
00:29:55,159 --> 00:29:59,239
access directly the file you don't have

663
00:29:57,529 --> 00:30:00,559
to put your GIMP ass what you get you

664
00:29:59,239 --> 00:30:04,519
get access to a file immediately so you

665
00:30:00,559 --> 00:30:06,889
bypass it another example of auto auto

666
00:30:04,519 --> 00:30:08,570
technician bypass this one is

667
00:30:06,890 --> 00:30:12,680
as nothing to do with web shell but it's

668
00:30:08,570 --> 00:30:15,110
related to max mine so max my comm is a

669
00:30:12,680 --> 00:30:18,050
service providing geoip locally

670
00:30:15,110 --> 00:30:21,139
co-located social organization so using

671
00:30:18,050 --> 00:30:22,879
an API you send a request to the service

672
00:30:21,140 --> 00:30:25,670
and based on your IP address that we

673
00:30:22,880 --> 00:30:28,220
just reply with an txt file containing

674
00:30:25,670 --> 00:30:31,190
your country or city and some other

675
00:30:28,220 --> 00:30:34,100
information and by default if you do a

676
00:30:31,190 --> 00:30:36,080
simple W get you received a 401

677
00:30:34,100 --> 00:30:38,480
unauthorized with a nice message user

678
00:30:36,080 --> 00:30:41,120
password technicians failed but if you

679
00:30:38,480 --> 00:30:44,300
do the same HTTP query so the seventh

680
00:30:41,120 --> 00:30:46,250
one and you put as we've refer max mind

681
00:30:44,300 --> 00:30:48,710
outcome and so on then we get access to

682
00:30:46,250 --> 00:30:52,010
the file so just based on the refere

683
00:30:48,710 --> 00:30:54,730
they don't do authentication and you are

684
00:30:52,010 --> 00:30:59,600
free to use the api

685
00:30:54,730 --> 00:31:01,340
ali every time this has been fixed in

686
00:30:59,600 --> 00:31:06,980
the so don't try this because it doesn't

687
00:31:01,340 --> 00:31:09,050
work anymore you can also have nice auto

688
00:31:06,980 --> 00:31:11,780
technician parameters just put in the

689
00:31:09,050 --> 00:31:13,430
get request classic stuff so you have

690
00:31:11,780 --> 00:31:15,800
access to the web shell and then you

691
00:31:13,430 --> 00:31:16,640
have user equals and user path across

692
00:31:15,800 --> 00:31:19,129
blah blah blah

693
00:31:16,640 --> 00:31:21,650
stupid because it will be in the field

694
00:31:19,130 --> 00:31:24,770
in the in the wild this kind of gray

695
00:31:21,650 --> 00:31:27,350
will be locked in proxy is locked in in

696
00:31:24,770 --> 00:31:29,710
the the web server log files and so on

697
00:31:27,350 --> 00:31:31,820
so it's completely stupid

698
00:31:29,710 --> 00:31:34,250
this one is nice

699
00:31:31,820 --> 00:31:36,110
usually when you have a phishing page or

700
00:31:34,250 --> 00:31:38,390
you have a web shell the people they

701
00:31:36,110 --> 00:31:40,100
they like also to keep data because they

702
00:31:38,390 --> 00:31:42,680
they need to collect some information

703
00:31:40,100 --> 00:31:45,199
about the visitors and you really create

704
00:31:42,680 --> 00:31:47,630
a file on the file system but if they

705
00:31:45,200 --> 00:31:50,870
forgot to protect the web the web server

706
00:31:47,630 --> 00:31:53,000
you can go to the file index and the

707
00:31:50,870 --> 00:31:55,399
visit old txt file on this example which

708
00:31:53,000 --> 00:31:58,010
is a real one contain the format was

709
00:31:55,400 --> 00:31:59,600
email file name i progress and contains

710
00:31:58,010 --> 00:32:03,830
twelve thousand lines of potential

711
00:31:59,600 --> 00:32:05,510
victims it was found in the wine so from

712
00:32:03,830 --> 00:32:10,669
time time you are lucky and you can find

713
00:32:05,510 --> 00:32:13,220
choice information tracking the bad guys

714
00:32:10,670 --> 00:32:16,980
to to to finish presentation a CAF 2

715
00:32:13,220 --> 00:32:19,980
minutes 12 to interesting

716
00:32:16,980 --> 00:32:23,070
trick the first one a few months ago I

717
00:32:19,980 --> 00:32:25,650
detect it on my soul I have a blog and

718
00:32:23,070 --> 00:32:27,480
I'm writing rap ups on my blog I have a

719
00:32:25,650 --> 00:32:29,340
lot of articles and so on so a lot of

720
00:32:27,480 --> 00:32:30,690
traffic but I'm always keeping an eye on

721
00:32:29,340 --> 00:32:33,419
the on what's happening on my on my

722
00:32:30,690 --> 00:32:35,700
server and one day I saw that a lot of

723
00:32:33,420 --> 00:32:38,340
web server when requesting a specific

724
00:32:35,700 --> 00:32:41,010
image which is this one so in fact this

725
00:32:38,340 --> 00:32:42,809
image I made it because I was in

726
00:32:41,010 --> 00:32:47,160
blackhat in Amsterdam so that's the

727
00:32:42,809 --> 00:32:49,860
Netherlands flag with the black hat but

728
00:32:47,160 --> 00:32:53,940
in fact this if you reduce this it looks

729
00:32:49,860 --> 00:32:56,370
like the Indonesian flag also and I

730
00:32:53,940 --> 00:32:59,549
detected that so a lot of website were

731
00:32:56,370 --> 00:33:02,639
requesting this file and after some

732
00:32:59,549 --> 00:33:05,340
investigation I saw that bad guys so

733
00:33:02,640 --> 00:33:08,100
they just were busy to deface a lot of

734
00:33:05,340 --> 00:33:11,610
website and they put in five eco one a

735
00:33:08,100 --> 00:33:14,520
link to my picture of course I started

736
00:33:11,610 --> 00:33:17,520
to track them and I found plenty of

737
00:33:14,520 --> 00:33:21,120
compromised website and in the code you

738
00:33:17,520 --> 00:33:24,750
just saw this they put a link to the the

739
00:33:21,120 --> 00:33:27,000
favicon directly to my blog so based on

740
00:33:24,750 --> 00:33:30,210
this was not because I got a lot of hit

741
00:33:27,000 --> 00:33:33,030
I was able to detect the compromised

742
00:33:30,210 --> 00:33:34,980
website I was able to see when the

743
00:33:33,030 --> 00:33:37,530
website was compromised for the first

744
00:33:34,980 --> 00:33:40,080
time if the website was popular or not

745
00:33:37,530 --> 00:33:42,750
based on the traffic if the website was

746
00:33:40,080 --> 00:33:45,899
quickly recovered or if the website was

747
00:33:42,750 --> 00:33:47,880
left defaced for weeks I was also able

748
00:33:45,900 --> 00:33:49,740
to see the activity of this group is

749
00:33:47,880 --> 00:33:52,410
this group very active and defacing more

750
00:33:49,740 --> 00:33:55,049
and more website so it was a funny

751
00:33:52,410 --> 00:33:57,480
example if you need more information or

752
00:33:55,049 --> 00:34:02,370
you can sort on the IC website I wrote a

753
00:33:57,480 --> 00:34:04,470
blog post about this another one some

754
00:34:02,370 --> 00:34:06,178
bad guys they try to attack all the bad

755
00:34:04,470 --> 00:34:09,300
guys of course because don't forget that

756
00:34:06,179 --> 00:34:12,210
internet is the wine so nice example

757
00:34:09,300 --> 00:34:13,980
that we found a seashell is a very nice

758
00:34:12,210 --> 00:34:16,500
website when you look at the interface

759
00:34:13,980 --> 00:34:19,050
it's very professional it's nice it's

760
00:34:16,500 --> 00:34:21,918
clean and it has also a lot of features

761
00:34:19,050 --> 00:34:24,960
and when you see this you have many

762
00:34:21,918 --> 00:34:27,149
system and mist retro we can be tempted

763
00:34:24,960 --> 00:34:29,789
by installing and using this kind of in

764
00:34:27,149 --> 00:34:32,668
interface some people hate come online

765
00:34:29,789 --> 00:34:34,529
tools so they prefer to use a browser or

766
00:34:32,668 --> 00:34:37,049
maybe they don't have the time to learn

767
00:34:34,529 --> 00:34:40,230
command line now to Holt or I don't know

768
00:34:37,049 --> 00:34:42,059
whatever but the tempted to install this

769
00:34:40,230 --> 00:34:43,740
kind of dude really it's nice if you can

770
00:34:42,059 --> 00:34:47,849
manage your five new server do your

771
00:34:43,739 --> 00:34:51,989
backups copy and so on why not but in

772
00:34:47,849 --> 00:34:53,940
this file usually so this file is quite

773
00:34:51,989 --> 00:34:57,000
professional so it means that for every

774
00:34:53,940 --> 00:35:00,289
file type they have included in the code

775
00:34:57,000 --> 00:35:03,359
a small images in PNG format

776
00:35:00,289 --> 00:35:05,490
base64-encoded which represent all the

777
00:35:03,359 --> 00:35:08,609
icons for the a wall document a PDF

778
00:35:05,490 --> 00:35:10,169
document and so on and so on and one of

779
00:35:08,609 --> 00:35:12,569
the fire of call you have an unknown

780
00:35:10,170 --> 00:35:15,359
icon which is basically four encoded and

781
00:35:12,569 --> 00:35:18,990
when you decode this one if you use the

782
00:35:15,359 --> 00:35:21,990
tool tweet PNG on it's a Windows tool in

783
00:35:18,990 --> 00:35:24,509
fact in PNG files you have a lot of

784
00:35:21,990 --> 00:35:28,109
metadata and one of the chunk is called

785
00:35:24,510 --> 00:35:30,240
text and it's just a free space where

786
00:35:28,109 --> 00:35:32,788
people can put information about the PNG

787
00:35:30,240 --> 00:35:36,689
in the metadata and of course in this

788
00:35:32,789 --> 00:35:39,510
text chunk you had a bunch of data which

789
00:35:36,690 --> 00:35:42,270
is almost unreadable and in the web

790
00:35:39,510 --> 00:35:44,940
shell you had a nice function set 8 T

791
00:35:42,270 --> 00:35:47,849
which in fact run the backdoors decode

792
00:35:44,940 --> 00:35:52,200
the contents of the the texture in the

793
00:35:47,849 --> 00:35:53,700
BG file and this X penetration every

794
00:35:52,200 --> 00:35:58,049
time you connect to the web shell an

795
00:35:53,700 --> 00:36:01,379
HTTP POST is sent to this hostname and a

796
00:35:58,049 --> 00:36:03,299
mail is sent to this email address I put

797
00:36:01,380 --> 00:36:04,680
the name of the guy and the real hell

798
00:36:03,299 --> 00:36:06,900
because I don't know it's still active

799
00:36:04,680 --> 00:36:09,808
at the moment this is the information

800
00:36:06,900 --> 00:36:11,940
that is sent via email so you get almost

801
00:36:09,809 --> 00:36:14,670
everything the UFL of your web shell the

802
00:36:11,940 --> 00:36:17,160
version user password all the different

803
00:36:14,670 --> 00:36:19,799
variable your PHP environment version

804
00:36:17,160 --> 00:36:22,770
and so on and so and so on so I had the

805
00:36:19,799 --> 00:36:24,809
idea of course if the guy receive a mail

806
00:36:22,770 --> 00:36:27,420
like this of course the guy will be

807
00:36:24,809 --> 00:36:27,869
tempted to check and to come on the web

808
00:36:27,420 --> 00:36:31,170
shell

809
00:36:27,869 --> 00:36:34,230
so I created a honeypot I sent a mail to

810
00:36:31,170 --> 00:36:36,779
the guy say ok this is all FC shell

811
00:36:34,230 --> 00:36:38,520
decision information I waited a few week

812
00:36:36,779 --> 00:36:41,700
but unfortunately the guy

813
00:36:38,520 --> 00:36:46,259
ever came to me so I tried but it was

814
00:36:41,700 --> 00:36:48,990
not successful I found a few days ago in

815
00:36:46,260 --> 00:36:50,220
fact another guy made the studio bought

816
00:36:48,990 --> 00:36:53,250
web shells I was not too worried about

817
00:36:50,220 --> 00:36:55,200
this you have the real hell below in

818
00:36:53,250 --> 00:36:57,660
fact he will so analyzed a lot of web

819
00:36:55,200 --> 00:37:00,509
shells and detected that most of them

820
00:36:57,660 --> 00:37:03,210
are compromised so most of them contain

821
00:37:00,510 --> 00:37:05,700
backdoors so the three type of malicious

822
00:37:03,210 --> 00:37:08,010
activity with Auto diction bypass more

823
00:37:05,700 --> 00:37:10,770
than 7% of the tested web shell effort

824
00:37:08,010 --> 00:37:14,100
on authentication bypass home fawning

825
00:37:10,770 --> 00:37:18,600
which mean that you you they just call

826
00:37:14,100 --> 00:37:20,940
back to a CNC server 13% of them or spam

827
00:37:18,600 --> 00:37:23,700
other server-side malicious activity so

828
00:37:20,940 --> 00:37:27,360
they do nasty stuff behind the scene and

829
00:37:23,700 --> 00:37:31,410
they try to do more than expected so my

830
00:37:27,360 --> 00:37:33,660
conclusion is really don't install a web

831
00:37:31,410 --> 00:37:35,879
shell on your productions of never never

832
00:37:33,660 --> 00:37:37,410
never because you will never you are

833
00:37:35,880 --> 00:37:39,030
never sure that they don't contain the

834
00:37:37,410 --> 00:37:41,759
back door that I don't do nasty stuff

835
00:37:39,030 --> 00:37:43,700
behind you and some so that's the end of

836
00:37:41,760 --> 00:37:48,540
our presentation

837
00:37:43,700 --> 00:37:50,700
yes if you still have question I present

838
00:37:48,540 --> 00:37:52,620
today until tomorrow morning

839
00:37:50,700 --> 00:37:55,589
well the moment I will leave very early

840
00:37:52,620 --> 00:37:56,670
but feel free to come back to me you

841
00:37:55,590 --> 00:37:58,290
have my email address and Twitter

842
00:37:56,670 --> 00:38:00,920
account and you if you have questions

843
00:37:58,290 --> 00:38:01,970
I'm open to questions thank you

844
00:38:00,920 --> 00:38:05,070
[Applause]

845
00:38:01,970 --> 00:38:05,069
[Music]

846
00:38:22,110 --> 00:38:25,239
[Music]

847
00:38:31,650 --> 00:38:34,760
[Music]

848
00:38:44,970 --> 00:38:50,439
yes I know

849
00:38:47,700 --> 00:38:52,839
usually what shells are deployed by

850
00:38:50,440 --> 00:38:54,970
script kiddies so there is no semen

851
00:38:52,840 --> 00:38:56,230
issues there because it just is the

852
00:38:54,970 --> 00:38:57,910
installation of opposite so the

853
00:38:56,230 --> 00:39:00,100
compromise ation of the server insertion

854
00:38:57,910 --> 00:39:01,870
is flew too much because you just have

855
00:39:00,100 --> 00:39:04,390
bot scanning the internet all the time

856
00:39:01,870 --> 00:39:07,210
they found a vulnerability usually it's

857
00:39:04,390 --> 00:39:09,310
on the a very nice CMS you know what

858
00:39:07,210 --> 00:39:11,680
press for example they find a venerable

859
00:39:09,310 --> 00:39:13,660
plugin writable directory they inject

860
00:39:11,680 --> 00:39:16,720
the web shell install and so the service

861
00:39:13,660 --> 00:39:19,540
is available the next step they will use

862
00:39:16,720 --> 00:39:22,390
the web shell to do more nasty stuff

863
00:39:19,540 --> 00:39:26,680
like sending spam install other BOTS and

864
00:39:22,390 --> 00:39:28,779
so on so I never saw this so it's always

865
00:39:26,680 --> 00:39:32,890
in the wire but I never saw a very

866
00:39:28,780 --> 00:39:36,010
dedicated attacks on using this kind of

867
00:39:32,890 --> 00:39:37,660
technology no it's really it's a common

868
00:39:36,010 --> 00:39:40,630
way to compromise the server it's a very

869
00:39:37,660 --> 00:39:43,509
common tools because on paste bin at the

870
00:39:40,630 --> 00:39:46,780
moment I think I'm finding between three

871
00:39:43,510 --> 00:39:49,090
and five new options every day so it's

872
00:39:46,780 --> 00:39:50,740
but mark as I said most of them always

873
00:39:49,090 --> 00:39:53,230
the same so they reuse the code it's

874
00:39:50,740 --> 00:39:54,939
it's it's always a classic stuff but

875
00:39:53,230 --> 00:40:04,300
it's it's a common way to compromise the

876
00:39:54,940 --> 00:40:04,640
server another question thank you very

877
00:40:04,300 --> 00:40:05,430
much

878
00:40:04,640 --> 00:40:10,270
you

879
00:40:05,430 --> 00:40:10,270
[Applause]

