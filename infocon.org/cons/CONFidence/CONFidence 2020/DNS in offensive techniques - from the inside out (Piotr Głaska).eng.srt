1
00:00:10,080 --> 00:00:12,320
okay guys so

2
00:00:12,320 --> 00:00:16,480
uh let's go right ahead because i have

3
00:00:16,480 --> 00:00:19,520
lots of slice and not too much time we

4
00:00:19,520 --> 00:00:22,000
will go through different

5
00:00:22,000 --> 00:00:25,279
miter attack techniques

6
00:00:25,439 --> 00:00:29,119
which might use dns and we'll look at it

7
00:00:29,119 --> 00:00:30,800
how different you know what attackers

8
00:00:30,800 --> 00:00:32,800
how different actors are are using those

9
00:00:32,800 --> 00:00:34,399
techniques and

10
00:00:34,399 --> 00:00:38,320
uh some specific you know offensive uh

11
00:00:38,320 --> 00:00:41,360
techniques uh involving dns so if

12
00:00:41,360 --> 00:00:42,879
anybody is thinking about you know

13
00:00:42,879 --> 00:00:44,480
security and as they usually think like

14
00:00:44,480 --> 00:00:46,559
yeah okay i could block malicious domain

15
00:00:46,559 --> 00:00:47,280
names so

16
00:00:47,280 --> 00:00:49,840
if user will click that then of course i

17
00:00:49,840 --> 00:00:51,360
can block it so that's the most

18
00:00:51,360 --> 00:00:54,480
simple way how you can how the attackers

19
00:00:54,480 --> 00:00:55,600
are using uh

20
00:00:55,600 --> 00:00:57,840
domain name system right providing a

21
00:00:57,840 --> 00:01:00,480
fully fully qualified domain name

22
00:01:00,480 --> 00:01:03,520
uh which will uh

23
00:01:03,520 --> 00:01:06,159
which will you know attract the user um

24
00:01:06,159 --> 00:01:07,119
and

25
00:01:07,119 --> 00:01:09,360
it can be malware behind or it can be a

26
00:01:09,360 --> 00:01:12,159
phishing page or whatever so let's just

27
00:01:12,159 --> 00:01:14,320
have a very quick warm up

28
00:01:14,320 --> 00:01:17,360
uh with uh some recent

29
00:01:17,360 --> 00:01:21,439
uh campaigns so this one is from uh

30
00:01:21,439 --> 00:01:24,159
about a week ago that's a hydra android

31
00:01:24,159 --> 00:01:25,280
malware

32
00:01:25,280 --> 00:01:28,560
and it's something we can see

33
00:01:28,560 --> 00:01:31,680
a lot of times it's uh using of fresh

34
00:01:31,680 --> 00:01:32,560
domains by the

35
00:01:32,560 --> 00:01:35,040
by the thread actors so here is perfect

36
00:01:35,040 --> 00:01:36,079
example

37
00:01:36,079 --> 00:01:39,200
uh actually i've seen the first

38
00:01:39,200 --> 00:01:41,920
screenshots right so it's from um

39
00:01:41,920 --> 00:01:44,960
customers uh reporting system where we

40
00:01:44,960 --> 00:01:45,759
can see that

41
00:01:45,759 --> 00:01:48,799
some of the employees clicked link which

42
00:01:48,799 --> 00:01:50,960
is not malicious which was not malicious

43
00:01:50,960 --> 00:01:52,799
as seen as malicious of those this time

44
00:01:52,799 --> 00:01:54,159
it was you know saturday

45
00:01:54,159 --> 00:01:57,840
4 p.m uh it was just a fresh domain name

46
00:01:57,840 --> 00:02:00,640
uh which was registered you know around

47
00:02:00,640 --> 00:02:01,040
four

48
00:02:01,040 --> 00:02:04,399
hours sorry six hours uh behind

49
00:02:04,399 --> 00:02:06,320
before the user actually clicked the

50
00:02:06,320 --> 00:02:08,399
link and

51
00:02:08,399 --> 00:02:11,440
what we can see on the right bottom is a

52
00:02:11,440 --> 00:02:13,760
screenshot from virustotal where you can

53
00:02:13,760 --> 00:02:15,360
see detections by different

54
00:02:15,360 --> 00:02:17,760
antivirus engines and you can see that

55
00:02:17,760 --> 00:02:20,640
it was not detected as malicious

56
00:02:20,640 --> 00:02:23,120
until actually you know next day or

57
00:02:23,120 --> 00:02:24,879
actually two days even right

58
00:02:24,879 --> 00:02:27,280
and it was slowly growing it's still not

59
00:02:27,280 --> 00:02:28,800
too big because it's a

60
00:02:28,800 --> 00:02:31,519
campaign targeting just poland so not

61
00:02:31,519 --> 00:02:33,840
every you know antivirus system is

62
00:02:33,840 --> 00:02:36,000
is actually detecting that as malicious

63
00:02:36,000 --> 00:02:38,560
but it's very typical example

64
00:02:38,560 --> 00:02:40,400
that attackers are registering the

65
00:02:40,400 --> 00:02:42,239
domain name and using it

66
00:02:42,239 --> 00:02:44,080
the same day or next day for the

67
00:02:44,080 --> 00:02:46,319
campaign they have limited time to do so

68
00:02:46,319 --> 00:02:47,440
because usually

69
00:02:47,440 --> 00:02:49,760
in simple attacks they will just use

70
00:02:49,760 --> 00:02:51,920
some fake data to register the domain

71
00:02:51,920 --> 00:02:54,000
name maybe stolen credit card

72
00:02:54,000 --> 00:02:57,120
so they don't have too much time when

73
00:02:57,120 --> 00:02:58,000
they can

74
00:02:58,000 --> 00:03:00,400
use this domain name and try to use it

75
00:03:00,400 --> 00:03:02,480
you know right away or in next one two

76
00:03:02,480 --> 00:03:03,519
days

77
00:03:03,519 --> 00:03:06,720
a very similar case but this is uh sms

78
00:03:06,720 --> 00:03:08,720
phishing susmishing

79
00:03:08,720 --> 00:03:12,159
in czech republic very fresh just

80
00:03:12,159 --> 00:03:15,920
from last weekend last monday also

81
00:03:15,920 --> 00:03:18,159
the domain name was registered on

82
00:03:18,159 --> 00:03:19,760
september 5th

83
00:03:19,760 --> 00:03:22,480
uh actually on passive dns system we saw

84
00:03:22,480 --> 00:03:25,280
first query just 10 minutes later

85
00:03:25,280 --> 00:03:28,720
um but uh it was not until 7th

86
00:03:28,720 --> 00:03:31,040
of september when actually people start

87
00:03:31,040 --> 00:03:32,000
to notice that

88
00:03:32,000 --> 00:03:34,400
this domain name is small issues as you

89
00:03:34,400 --> 00:03:35,440
can see

90
00:03:35,440 --> 00:03:38,640
on the left side on the bottom

91
00:03:38,640 --> 00:03:41,120
and so exactly the same technique

92
00:03:41,120 --> 00:03:41,680
basically

93
00:03:41,680 --> 00:03:44,799
using a new fresh domain name and as i

94
00:03:44,799 --> 00:03:46,480
said we can see that

95
00:03:46,480 --> 00:03:50,799
very often on some simple campaigns

96
00:03:50,799 --> 00:03:52,560
this one is actually quite interesting

97
00:03:52,560 --> 00:03:54,720
because the screenshots

98
00:03:54,720 --> 00:03:56,879
from this phishing web pages especially

99
00:03:56,879 --> 00:03:58,239
the one on the

100
00:03:58,239 --> 00:04:01,680
right button basically the attack was

101
00:04:01,680 --> 00:04:04,879
targeted towards czech republic uh users

102
00:04:04,879 --> 00:04:06,879
but actually the language on this

103
00:04:06,879 --> 00:04:07,920
webpage is not

104
00:04:07,920 --> 00:04:11,120
czech it's slovenian so uh

105
00:04:11,120 --> 00:04:13,680
someone who was doing this this campaign

106
00:04:13,680 --> 00:04:16,160
uh is definitely not from czech republic

107
00:04:16,160 --> 00:04:19,440
probably not even from our uh region of

108
00:04:19,440 --> 00:04:21,680
europe because you know in central

109
00:04:21,680 --> 00:04:22,720
eastern europe people

110
00:04:22,720 --> 00:04:24,479
uh know the difference between czech

111
00:04:24,479 --> 00:04:26,960
republic slovakia and slovenia

112
00:04:26,960 --> 00:04:28,960
right they totally different countries

113
00:04:28,960 --> 00:04:31,600
with different languages

114
00:04:31,600 --> 00:04:33,600
and you would never use you know

115
00:04:33,600 --> 00:04:34,880
different language to target

116
00:04:34,880 --> 00:04:38,080
uh you know people in czech republic so

117
00:04:38,080 --> 00:04:41,520
it's not very well prepared such simple

118
00:04:41,520 --> 00:04:43,759
attacks also you know simple defense

119
00:04:43,759 --> 00:04:44,880
techniques and

120
00:04:44,880 --> 00:04:47,360
uh you know very simple technique is

121
00:04:47,360 --> 00:04:49,440
just quarantine a fresh domain name

122
00:04:49,440 --> 00:04:51,600
i always say domain names are like a you

123
00:04:51,600 --> 00:04:53,440
know good wine it shouldn't be

124
00:04:53,440 --> 00:04:57,360
fresh right uh very often we can see

125
00:04:57,360 --> 00:04:57,680
look

126
00:04:57,680 --> 00:05:00,320
like domain names or domain names which

127
00:05:00,320 --> 00:05:02,240
try to

128
00:05:02,240 --> 00:05:04,160
look like try to mimic you know some

129
00:05:04,160 --> 00:05:05,440
legitimate domain names

130
00:05:05,440 --> 00:05:08,880
and uh a lot of security vendors are

131
00:05:08,880 --> 00:05:10,720
doing look-alike detections

132
00:05:10,720 --> 00:05:12,720
but they are mostly focusing on some

133
00:05:12,720 --> 00:05:13,840
global brands

134
00:05:13,840 --> 00:05:16,240
when it comes to local brands it's not

135
00:05:16,240 --> 00:05:17,280
that common

136
00:05:17,280 --> 00:05:20,560
and that's why such domain names can be

137
00:05:20,560 --> 00:05:22,320
undetected for long time so this is

138
00:05:22,320 --> 00:05:23,680
example for example

139
00:05:23,680 --> 00:05:26,080
this is an example sorry for look-alike

140
00:05:26,080 --> 00:05:26,880
domain name for

141
00:05:26,880 --> 00:05:30,320
inpost which is polish delivery company

142
00:05:30,320 --> 00:05:32,880
and this domain name was registered uh

143
00:05:32,880 --> 00:05:35,199
around end of february this year

144
00:05:35,199 --> 00:05:38,320
but it was not blocked anywhere until

145
00:05:38,320 --> 00:05:38,880
end of

146
00:05:38,880 --> 00:05:41,840
june so it's like four months normally

147
00:05:41,840 --> 00:05:43,199
people say like you know

148
00:05:43,199 --> 00:05:45,680
phishing pages will be blocked or

149
00:05:45,680 --> 00:05:47,600
disappeared within hours

150
00:05:47,600 --> 00:05:50,720
but here when we have a local threat

151
00:05:50,720 --> 00:05:52,800
actually you can see that's not true and

152
00:05:52,800 --> 00:05:54,800
it can last much much

153
00:05:54,800 --> 00:05:58,400
longer again

154
00:05:58,400 --> 00:06:00,400
attackers are probably from different

155
00:06:00,400 --> 00:06:01,520
country because

156
00:06:01,520 --> 00:06:04,319
on the fake page on the left we see lack

157
00:06:04,319 --> 00:06:06,000
of polish national characters

158
00:06:06,000 --> 00:06:08,720
which we can see on the legitimate web

159
00:06:08,720 --> 00:06:12,000
page on the right side

160
00:06:12,400 --> 00:06:14,400
very interesting case combining

161
00:06:14,400 --> 00:06:16,240
look-alike domain names with web

162
00:06:16,240 --> 00:06:17,680
advertisements so this

163
00:06:17,680 --> 00:06:21,360
is something seen a few months ago

164
00:06:21,360 --> 00:06:25,039
again in poland so attackers register a

165
00:06:25,039 --> 00:06:26,080
domain name which

166
00:06:26,080 --> 00:06:27,759
looks a little bit like a getting bank

167
00:06:27,759 --> 00:06:29,840
domain name but in addition they

168
00:06:29,840 --> 00:06:32,240
actually bought a advertisement on

169
00:06:32,240 --> 00:06:32,960
google

170
00:06:32,960 --> 00:06:36,319
so if a user is actually entering

171
00:06:36,319 --> 00:06:38,319
getting bank in the google

172
00:06:38,319 --> 00:06:42,400
uh they had as a first link there was an

173
00:06:42,400 --> 00:06:43,039
ad

174
00:06:43,039 --> 00:06:45,360
bought by the attacker and unfortunately

175
00:06:45,360 --> 00:06:47,440
some people especially older people

176
00:06:47,440 --> 00:06:49,440
don't use you know the the url address

177
00:06:49,440 --> 00:06:51,680
bar but they just enter their bank name

178
00:06:51,680 --> 00:06:53,520
into the google search and

179
00:06:53,520 --> 00:06:55,680
that's how they go to the bank so some

180
00:06:55,680 --> 00:06:56,800
people might

181
00:06:56,800 --> 00:06:59,680
be alert by that

182
00:07:00,319 --> 00:07:03,680
another example of lookalike and

183
00:07:03,680 --> 00:07:05,759
adam lange two days ago was talking

184
00:07:05,759 --> 00:07:08,080
about how fishing kids are trying to

185
00:07:08,080 --> 00:07:08,960
distract

186
00:07:08,960 --> 00:07:11,360
you know fred researchers this is one of

187
00:07:11,360 --> 00:07:12,560
the examples

188
00:07:12,560 --> 00:07:15,599
when you enter such look-alike domain

189
00:07:15,599 --> 00:07:16,560
name without

190
00:07:16,560 --> 00:07:20,479
exact uh url actually are redirected to

191
00:07:20,479 --> 00:07:21,680
the legitimate

192
00:07:21,680 --> 00:07:24,800
bnt paribas web page and this causes

193
00:07:24,800 --> 00:07:25,199
some

194
00:07:25,199 --> 00:07:27,840
security systems so url filtering system

195
00:07:27,840 --> 00:07:28,639
to qualify

196
00:07:28,639 --> 00:07:31,919
to classify this domain name

197
00:07:31,919 --> 00:07:34,639
as there is a classification for the

198
00:07:34,639 --> 00:07:36,880
legitimate domain name so in this case

199
00:07:36,880 --> 00:07:39,199
this phishing domain name was

200
00:07:39,199 --> 00:07:41,520
categorized as financial services

201
00:07:41,520 --> 00:07:44,479
for example in palo alto in forest in

202
00:07:44,479 --> 00:07:45,919
actually in a few

203
00:07:45,919 --> 00:07:49,840
url filtering uh solutions

204
00:07:49,840 --> 00:07:51,680
okay let's uh have something more

205
00:07:51,680 --> 00:07:53,680
interesting this was just a warm-up so

206
00:07:53,680 --> 00:07:55,120
dga

207
00:07:55,120 --> 00:07:57,280
yesterday there was a nice session about

208
00:07:57,280 --> 00:07:59,360
dj algorithms

209
00:07:59,360 --> 00:08:02,080
but it was like most typical dgas which

210
00:08:02,080 --> 00:08:03,759
generate domain names

211
00:08:03,759 --> 00:08:07,199
uh out of random characters or in some

212
00:08:07,199 --> 00:08:08,479
more advanced cases

213
00:08:08,479 --> 00:08:11,039
uh out of uh whole words in case of

214
00:08:11,039 --> 00:08:12,560
dictionary dga

215
00:08:12,560 --> 00:08:15,440
but this year i've seen a completely

216
00:08:15,440 --> 00:08:16,000
different

217
00:08:16,000 --> 00:08:19,120
approach to dga

218
00:08:19,120 --> 00:08:21,120
so there was a docking malware which was

219
00:08:21,120 --> 00:08:23,280
infecting docker servers in the public

220
00:08:23,280 --> 00:08:25,120
cloud so it was scanning for docker

221
00:08:25,120 --> 00:08:26,960
servers in public cloud

222
00:08:26,960 --> 00:08:30,479
and trying to exploit some default uh

223
00:08:30,479 --> 00:08:32,479
configuration features

224
00:08:32,479 --> 00:08:35,839
and how doki was resolving its command

225
00:08:35,839 --> 00:08:36,799
and control

226
00:08:36,799 --> 00:08:40,320
server was by using um

227
00:08:40,320 --> 00:08:43,519
dot coin cryptocurrency blockchain so

228
00:08:43,519 --> 00:08:46,880
how did that work basically to

229
00:08:46,880 --> 00:08:49,839
get domain name of the c2 server the

230
00:08:49,839 --> 00:08:50,480
malware

231
00:08:50,480 --> 00:08:53,839
was sending a query to blockchain.info

232
00:08:53,839 --> 00:08:55,600
api

233
00:08:55,600 --> 00:08:58,800
asking about how much money was spent

234
00:08:58,800 --> 00:09:00,080
from a hardcoded

235
00:09:00,080 --> 00:09:02,000
wallet address and this wallet was

236
00:09:02,000 --> 00:09:03,680
controlled by the attacker

237
00:09:03,680 --> 00:09:06,560
so attacker was generating a domain name

238
00:09:06,560 --> 00:09:07,279
just by

239
00:09:07,279 --> 00:09:09,680
you know spending some money from this

240
00:09:09,680 --> 00:09:10,480
wallet

241
00:09:10,480 --> 00:09:12,880
and then the malware was accessing

242
00:09:12,880 --> 00:09:14,560
information about how much money was

243
00:09:14,560 --> 00:09:15,120
spent

244
00:09:15,120 --> 00:09:17,360
through the api call and based on that

245
00:09:17,360 --> 00:09:20,160
it was generating a domain name

246
00:09:20,160 --> 00:09:22,880
none of the existing dga detection coins

247
00:09:22,880 --> 00:09:23,680
will work here

248
00:09:23,680 --> 00:09:25,680
because most of the g8 detection

249
00:09:25,680 --> 00:09:27,920
algorithms will look for

250
00:09:27,920 --> 00:09:30,399
a lot of dns queries which result in

251
00:09:30,399 --> 00:09:32,160
non-existent domain name answer

252
00:09:32,160 --> 00:09:35,120
because that's how dj algorithm works it

253
00:09:35,120 --> 00:09:36,000
generates

254
00:09:36,000 --> 00:09:38,640
a lot of domains using random characters

255
00:09:38,640 --> 00:09:40,640
until it will

256
00:09:40,640 --> 00:09:42,080
match the domain name which was

257
00:09:42,080 --> 00:09:44,160
registered by the attacker

258
00:09:44,160 --> 00:09:46,399
the rest like thousands per day will be

259
00:09:46,399 --> 00:09:47,279
actually

260
00:09:47,279 --> 00:09:50,560
having a response that this domain name

261
00:09:50,560 --> 00:09:51,680
does not exist

262
00:09:51,680 --> 00:09:53,920
in this case there are no random domain

263
00:09:53,920 --> 00:09:55,839
names actually attacker is just

264
00:09:55,839 --> 00:09:57,600
generating domain name based on the

265
00:09:57,600 --> 00:09:59,440
money spent from the wallet so quite

266
00:09:59,440 --> 00:10:02,240
interesting example

267
00:10:02,240 --> 00:10:05,920
uh okay and next case uh

268
00:10:05,920 --> 00:10:08,320
technique for command and control tactic

269
00:10:08,320 --> 00:10:09,760
ingress tool transfer

270
00:10:09,760 --> 00:10:12,160
uh previous name was remote copy file

271
00:10:12,160 --> 00:10:13,279
transfer

272
00:10:13,279 --> 00:10:14,959
it has changed recently when the sub

273
00:10:14,959 --> 00:10:16,560
techniques were introduced to mitre

274
00:10:16,560 --> 00:10:18,959
attack

275
00:10:19,040 --> 00:10:21,040
and here is an example which was

276
00:10:21,040 --> 00:10:23,040
described by

277
00:10:23,040 --> 00:10:26,880
asset in june you have the presentation

278
00:10:26,880 --> 00:10:28,560
you have the links there so it's good to

279
00:10:28,560 --> 00:10:29,360
go there and

280
00:10:29,360 --> 00:10:31,839
actually read in details how it works

281
00:10:31,839 --> 00:10:32,480
that they

282
00:10:32,480 --> 00:10:36,160
provided like a 60 pages very detailed

283
00:10:36,160 --> 00:10:37,519
report so

284
00:10:37,519 --> 00:10:41,279
kudos to to asset team uh

285
00:10:41,279 --> 00:10:44,800
so they they um reported attack

286
00:10:44,800 --> 00:10:48,000
by invisible group and it was targeting

287
00:10:48,000 --> 00:10:49,920
high-profile organizations in military

288
00:10:49,920 --> 00:10:52,399
sector in eastern europe

289
00:10:52,399 --> 00:10:55,519
they were using dns to download

290
00:10:55,519 --> 00:10:58,480
new malicious components of this malware

291
00:10:58,480 --> 00:10:59,600
so

292
00:10:59,600 --> 00:11:01,440
when they infected the computer to try

293
00:11:01,440 --> 00:11:03,040
to download you know new

294
00:11:03,040 --> 00:11:06,480
uh new stuff uh on this on this infected

295
00:11:06,480 --> 00:11:07,360
machine

296
00:11:07,360 --> 00:11:09,920
they were using null records by default

297
00:11:09,920 --> 00:11:10,480
uh

298
00:11:10,480 --> 00:11:13,120
which for me was well it might be a

299
00:11:13,120 --> 00:11:15,600
little bit surprising because

300
00:11:15,600 --> 00:11:18,320
new records are very good for the data

301
00:11:18,320 --> 00:11:20,079
transfer because you can put any kind of

302
00:11:20,079 --> 00:11:21,360
data inside

303
00:11:21,360 --> 00:11:23,680
and it could you could put like 250

304
00:11:23,680 --> 00:11:24,880
bucks

305
00:11:24,880 --> 00:11:27,279
the problem is they are very rarely seen

306
00:11:27,279 --> 00:11:28,079
on the network

307
00:11:28,079 --> 00:11:30,320
so it's quite easy to detect that as a

308
00:11:30,320 --> 00:11:31,120
anomaly

309
00:11:31,120 --> 00:11:33,519
because of course if you if you monitor

310
00:11:33,519 --> 00:11:35,360
what kind of queries you normally have

311
00:11:35,360 --> 00:11:36,240
in your network

312
00:11:36,240 --> 00:11:38,640
but then if you do that then you will

313
00:11:38,640 --> 00:11:39,839
quickly notice that

314
00:11:39,839 --> 00:11:41,839
you have quite a large amount of noodle

315
00:11:41,839 --> 00:11:44,079
queries which is not typical

316
00:11:44,079 --> 00:11:46,560
maybe they were thinking like using text

317
00:11:46,560 --> 00:11:47,600
records uh

318
00:11:47,600 --> 00:11:51,360
txt records would be detected by some

319
00:11:51,360 --> 00:11:53,519
security solutions

320
00:11:53,519 --> 00:11:55,600
maybe some firewalls or some dns

321
00:11:55,600 --> 00:11:56,800
firewalls are

322
00:11:56,800 --> 00:11:59,120
looking into ticks takes their records

323
00:11:59,120 --> 00:12:01,360
uh data and then it could detect

324
00:12:01,360 --> 00:12:02,959
something automatically so maybe that

325
00:12:02,959 --> 00:12:03,600
was

326
00:12:03,600 --> 00:12:06,160
that was the reason they are using dns

327
00:12:06,160 --> 00:12:06,880
uh

328
00:12:06,880 --> 00:12:09,920
because in this case they can actually

329
00:12:09,920 --> 00:12:10,639
get

330
00:12:10,639 --> 00:12:13,519
the data from the internet even if the

331
00:12:13,519 --> 00:12:15,839
infected machine is in isolated segment

332
00:12:15,839 --> 00:12:18,320
without internet access because dns

333
00:12:18,320 --> 00:12:20,639
resolver is actually working as a kind

334
00:12:20,639 --> 00:12:22,959
of a proxy it gets a dns request from

335
00:12:22,959 --> 00:12:23,760
the client

336
00:12:23,760 --> 00:12:25,680
and it creates a new request with its

337
00:12:25,680 --> 00:12:27,440
source address

338
00:12:27,440 --> 00:12:29,680
to the internet so even if the infected

339
00:12:29,680 --> 00:12:31,920
client does not have internet access

340
00:12:31,920 --> 00:12:33,760
actually it can download data from the

341
00:12:33,760 --> 00:12:38,800
internet using dns resolver as a proxy

342
00:12:38,800 --> 00:12:42,560
uh next tactics and techniques so

343
00:12:42,560 --> 00:12:44,480
again command and control acceleration i

344
00:12:44,480 --> 00:12:46,240
think those tactics are

345
00:12:46,240 --> 00:12:48,560
the most uh interested from dns

346
00:12:48,560 --> 00:12:49,600
interesting from

347
00:12:49,600 --> 00:12:52,720
dns perspective

348
00:12:52,720 --> 00:12:55,200
so how actually you can exfiltrate data

349
00:12:55,200 --> 00:12:59,279
out of the network using dns queries

350
00:12:59,279 --> 00:13:01,120
basically you need to register a domain

351
00:13:01,120 --> 00:13:03,360
name and set up name server which will

352
00:13:03,360 --> 00:13:06,160
handle these domain name requests

353
00:13:06,160 --> 00:13:09,200
then from the infected endpoint

354
00:13:09,200 --> 00:13:11,519
so in the last phase of the infection

355
00:13:11,519 --> 00:13:13,920
when you want to exfiltrate data

356
00:13:13,920 --> 00:13:16,959
to your external server basically

357
00:13:16,959 --> 00:13:19,200
you can and in advanced attack it's

358
00:13:19,200 --> 00:13:20,240
usually done you

359
00:13:20,240 --> 00:13:23,279
attacker will encrypt the data then

360
00:13:23,279 --> 00:13:25,360
the data needs to be encoded because it

361
00:13:25,360 --> 00:13:26,399
will be sent

362
00:13:26,399 --> 00:13:29,600
in form of fqd and fully qualified

363
00:13:29,600 --> 00:13:31,360
domain name in the dns query

364
00:13:31,360 --> 00:13:34,480
so it needs to comply rfc

365
00:13:34,480 --> 00:13:36,959
rfc is saying you can only use letters

366
00:13:36,959 --> 00:13:37,760
digits

367
00:13:37,760 --> 00:13:41,199
dash and underscore so you need to use

368
00:13:41,199 --> 00:13:43,040
some algorithms such as hacks such as

369
00:13:43,040 --> 00:13:44,399
base 32

370
00:13:44,399 --> 00:13:48,000
or modified base64 so base64 url

371
00:13:48,000 --> 00:13:51,120
because standard base64 contains

372
00:13:51,120 --> 00:13:53,440
plus sign and slash which are not

373
00:13:53,440 --> 00:13:55,440
allowed in the dns names

374
00:13:55,440 --> 00:13:59,839
so you usually even use basicsd for url

375
00:13:59,839 --> 00:14:02,800
dns system basically is case insensitive

376
00:14:02,800 --> 00:14:03,519
so

377
00:14:03,519 --> 00:14:06,160
when attacker is using base64 he's a

378
00:14:06,160 --> 00:14:08,160
little bit at risk that he will lose

379
00:14:08,160 --> 00:14:10,240
some data because

380
00:14:10,240 --> 00:14:13,440
when you send some query let's let's

381
00:14:13,440 --> 00:14:16,000
actually do that

382
00:14:16,000 --> 00:14:19,519
uh when we will ask about let's say

383
00:14:19,519 --> 00:14:22,800
like this one uh sorry without short

384
00:14:22,800 --> 00:14:23,760
because we don't see

385
00:14:23,760 --> 00:14:26,959
it and you can see

386
00:14:26,959 --> 00:14:28,839
actually this name server which i'm

387
00:14:28,839 --> 00:14:31,199
using

388
00:14:31,199 --> 00:14:33,279
you know still has the same case right

389
00:14:33,279 --> 00:14:35,279
but if you will ask for example

390
00:14:35,279 --> 00:14:38,000
cloudfur

391
00:14:42,880 --> 00:14:45,760
then you can see that they do not hold

392
00:14:45,760 --> 00:14:47,120
the same case so

393
00:14:47,120 --> 00:14:49,279
you have no guarantee when you use

394
00:14:49,279 --> 00:14:51,040
base64

395
00:14:51,040 --> 00:14:53,680
that it will work so it's a little bit

396
00:14:53,680 --> 00:14:54,720
risky

397
00:14:54,720 --> 00:14:58,880
uh then after you have this encoded data

398
00:14:58,880 --> 00:15:00,800
uh you need to cut it into the chunks

399
00:15:00,800 --> 00:15:02,480
because in the sub domain you can have

400
00:15:02,480 --> 00:15:04,320
maximum 63 characters

401
00:15:04,320 --> 00:15:07,920
so you need to cut it into some

402
00:15:07,920 --> 00:15:09,839
chunks of data maybe one chunk maybe

403
00:15:09,839 --> 00:15:11,360
more depends and then you send those

404
00:15:11,360 --> 00:15:13,680
individual queries to local dns server

405
00:15:13,680 --> 00:15:15,279
used by the

406
00:15:15,279 --> 00:15:18,959
endpoint which was infected uh

407
00:15:18,959 --> 00:15:21,519
so let's look at some examples so we

408
00:15:21,519 --> 00:15:23,519
will see also different kind of encoding

409
00:15:23,519 --> 00:15:26,720
of data used by different

410
00:15:26,720 --> 00:15:29,360
threat actors depending on their skills

411
00:15:29,360 --> 00:15:30,000
actually

412
00:15:30,000 --> 00:15:32,320
so here we have a point of cell modeler

413
00:15:32,320 --> 00:15:33,440
alina

414
00:15:33,440 --> 00:15:35,920
that was described on visa web pages

415
00:15:35,920 --> 00:15:37,040
actually

416
00:15:37,040 --> 00:15:39,440
and here you can see they are probably

417
00:15:39,440 --> 00:15:40,959
using base64

418
00:15:40,959 --> 00:15:43,920
uh we can have a look at that in a

419
00:15:43,920 --> 00:15:44,959
second

420
00:15:44,959 --> 00:15:48,320
uh because you have small and unless

421
00:15:48,320 --> 00:15:51,759
and capital letters here

422
00:15:51,759 --> 00:15:55,519
so let's have this in cyber chef

423
00:15:55,519 --> 00:15:58,399
let's see what's there

424
00:16:00,079 --> 00:16:03,360
okay so i copied the part of

425
00:16:03,360 --> 00:16:06,480
fqdn without the top level domain name

426
00:16:06,480 --> 00:16:09,519
to the cyber chef

427
00:16:10,160 --> 00:16:13,360
and i know what's in there because i

428
00:16:13,360 --> 00:16:16,480
i read the research so basically it's uh

429
00:16:16,480 --> 00:16:20,639
base64 encoded as i said modified one

430
00:16:20,639 --> 00:16:22,079
url save

431
00:16:22,079 --> 00:16:26,240
and then actually it is just using sort

432
00:16:26,240 --> 00:16:28,320
if we don't know the key we can actually

433
00:16:28,320 --> 00:16:30,959
use brute force in cyber chef

434
00:16:30,959 --> 00:16:33,759
and we can have a look what is uh what

435
00:16:33,759 --> 00:16:37,839
is making some sense

436
00:16:41,040 --> 00:16:44,959
and actually here it is so you can see

437
00:16:44,959 --> 00:16:48,399
that here is a ide of

438
00:16:48,399 --> 00:16:50,560
infected machine here is the name don't

439
00:16:50,560 --> 00:16:51,839
have one pc

440
00:16:51,839 --> 00:16:54,639
uh i don't remember what was the one

441
00:16:54,639 --> 00:16:55,759
probably a stage

442
00:16:55,759 --> 00:16:58,639
post dot exam so the executable which is

443
00:16:58,639 --> 00:17:00,160
actually holding data about

444
00:17:00,160 --> 00:17:02,720
credit cards and here you have credit

445
00:17:02,720 --> 00:17:04,720
card data information so the number and

446
00:17:04,720 --> 00:17:06,559
the validity date plus some additional

447
00:17:06,559 --> 00:17:07,359
data

448
00:17:07,359 --> 00:17:10,959
so this is stored just in dns query

449
00:17:10,959 --> 00:17:14,079
the bad thing about it is that

450
00:17:14,079 --> 00:17:16,000
if the attacker is using command and

451
00:17:16,000 --> 00:17:18,720
control or filtration channel over https

452
00:17:18,720 --> 00:17:20,079
the data is transferred from the

453
00:17:20,079 --> 00:17:21,359
infected endpoint

454
00:17:21,359 --> 00:17:23,679
towards the c2 server and it's encrypted

455
00:17:23,679 --> 00:17:24,720
in between

456
00:17:24,720 --> 00:17:27,919
here if you are using dns actually

457
00:17:27,919 --> 00:17:29,200
on the internet you have a lot of

458
00:17:29,200 --> 00:17:31,600
passive dns systems so whatever will be

459
00:17:31,600 --> 00:17:33,760
sent to dns resolvers

460
00:17:33,760 --> 00:17:36,720
probably will be stored at some passive

461
00:17:36,720 --> 00:17:39,200
dns system and will stay there you know

462
00:17:39,200 --> 00:17:40,559
ethernet is like

463
00:17:40,559 --> 00:17:42,400
las vegas right what happens on the

464
00:17:42,400 --> 00:17:44,640
internet stays on the internet

465
00:17:44,640 --> 00:17:47,679
so we can have a look here

466
00:17:47,679 --> 00:17:49,440
actually my session expired but it

467
00:17:49,440 --> 00:17:52,240
doesn't matter here i'm using uh

468
00:17:52,240 --> 00:17:55,919
another research tool from from infoblox

469
00:17:55,919 --> 00:17:58,559
which contains passive dns data and here

470
00:17:58,559 --> 00:17:59,840
we see uh

471
00:17:59,840 --> 00:18:03,360
analytics the dns domain name and we see

472
00:18:03,360 --> 00:18:05,520
that in passive dns we are actually

473
00:18:05,520 --> 00:18:06,080
seeing

474
00:18:06,080 --> 00:18:09,440
all those queries and the recent one

475
00:18:09,440 --> 00:18:12,640
was from today actually

476
00:18:12,640 --> 00:18:15,760
so this malware is infecting

477
00:18:15,760 --> 00:18:19,120
you know credit cards uh processing data

478
00:18:19,120 --> 00:18:20,000
computers

479
00:18:20,000 --> 00:18:22,400
as we speak and it's exfiltrating data

480
00:18:22,400 --> 00:18:23,120
all the time

481
00:18:23,120 --> 00:18:25,520
and actually almost anybody on the

482
00:18:25,520 --> 00:18:27,440
internet who has access to some passive

483
00:18:27,440 --> 00:18:28,640
dns system

484
00:18:28,640 --> 00:18:30,880
will have access to this credit card

485
00:18:30,880 --> 00:18:32,320
data information

486
00:18:32,320 --> 00:18:34,160
so if you are a victim you are actually

487
00:18:34,160 --> 00:18:35,760
lucky if the

488
00:18:35,760 --> 00:18:37,679
fred actor was doing some kind of

489
00:18:37,679 --> 00:18:41,280
encryption if not everybody can see that

490
00:18:41,280 --> 00:18:44,400
in this case uh this came from uh

491
00:18:44,400 --> 00:18:47,039
visa reports so i hope you know this

492
00:18:47,039 --> 00:18:48,640
information these credit cards were

493
00:18:48,640 --> 00:18:49,200
already

494
00:18:49,200 --> 00:18:52,320
invalidated okay

495
00:18:52,320 --> 00:18:55,280
good go go back to invisimo for a second

496
00:18:55,280 --> 00:18:56,400
so

497
00:18:56,400 --> 00:18:57,679
i was saying that they are doing

498
00:18:57,679 --> 00:18:59,520
infiltration so downloading data from

499
00:18:59,520 --> 00:19:00,559
the internet but

500
00:19:00,559 --> 00:19:03,039
actually also sending data to the c2

501
00:19:03,039 --> 00:19:04,000
server

502
00:19:04,000 --> 00:19:07,440
using uh dns and

503
00:19:07,440 --> 00:19:10,320
invisimo is an advanced group so they

504
00:19:10,320 --> 00:19:12,320
are targeting military institutions so

505
00:19:12,320 --> 00:19:14,559
probably there is some government behind

506
00:19:14,559 --> 00:19:17,440
and you can see the difference like most

507
00:19:17,440 --> 00:19:18,000
simple

508
00:19:18,000 --> 00:19:21,360
attackers are using hex encoding

509
00:19:21,360 --> 00:19:24,880
maybe base64 but in advanced attacks apt

510
00:19:24,880 --> 00:19:25,440
groups

511
00:19:25,440 --> 00:19:28,799
usually use something like base 32 and

512
00:19:28,799 --> 00:19:32,000
with non-standard dictionary so here we

513
00:19:32,000 --> 00:19:32,400
have

514
00:19:32,400 --> 00:19:34,960
one one of the examples for invisible

515
00:19:34,960 --> 00:19:36,960
this is the dictionary they used

516
00:19:36,960 --> 00:19:38,960
in addition i noticed that in all

517
00:19:38,960 --> 00:19:40,480
queries they sent

518
00:19:40,480 --> 00:19:44,240
i could found 16 a letters and

519
00:19:44,240 --> 00:19:47,280
i have no idea why they did it but one

520
00:19:47,280 --> 00:19:48,080
of the

521
00:19:48,080 --> 00:19:51,600
guesses could be that if you use 16

522
00:19:51,600 --> 00:19:53,840
characters which are the same the

523
00:19:53,840 --> 00:19:56,480
entropy of the whole string will be much

524
00:19:56,480 --> 00:19:57,200
lower

525
00:19:57,200 --> 00:19:59,600
so in case somebody uses detection based

526
00:19:59,600 --> 00:20:01,520
on the entropy only

527
00:20:01,520 --> 00:20:03,039
then they can actually avoid this

528
00:20:03,039 --> 00:20:04,960
detection because they are lowering the

529
00:20:04,960 --> 00:20:07,440
level of entropy

530
00:20:07,440 --> 00:20:09,039
just by using you know but just by

531
00:20:09,039 --> 00:20:10,880
repeating the same characters several

532
00:20:10,880 --> 00:20:12,960
times

533
00:20:12,960 --> 00:20:15,840
uh another example of advanced groups

534
00:20:15,840 --> 00:20:17,039
wellness malware

535
00:20:17,039 --> 00:20:20,480
uh probably related to apt-29 according

536
00:20:20,480 --> 00:20:21,120
to

537
00:20:21,120 --> 00:20:25,440
to some uk and u.s security institutions

538
00:20:25,440 --> 00:20:27,919
they were targeting companies which are

539
00:20:27,919 --> 00:20:29,120
doing research

540
00:20:29,120 --> 00:20:32,240
related to kovit 19 vasin and they are

541
00:20:32,240 --> 00:20:34,960
using dns they are using https

542
00:20:34,960 --> 00:20:38,000
uh for c2 for data exfiltration and

543
00:20:38,000 --> 00:20:40,480
here we also can see that they are using

544
00:20:40,480 --> 00:20:42,799
base 32 encoding with non-standard

545
00:20:42,799 --> 00:20:43,760
dictionary

546
00:20:43,760 --> 00:20:46,000
and here is the dictionary so it's comp

547
00:20:46,000 --> 00:20:48,799
it's even more you know non-standard

548
00:20:48,799 --> 00:20:50,720
than the one used by the by the

549
00:20:50,720 --> 00:20:53,679
invisible group

550
00:20:56,480 --> 00:21:00,000
uh this attack is not new so usually

551
00:21:00,000 --> 00:21:01,440
in the last slides i was showing

552
00:21:01,440 --> 00:21:03,520
something from 2020

553
00:21:03,520 --> 00:21:05,280
this one is a little bit longer but i

554
00:21:05,280 --> 00:21:07,039
think it's worth to mention because

555
00:21:07,039 --> 00:21:10,400
it's one of the most advanced use of uh

556
00:21:10,400 --> 00:21:15,120
dns transmission uh during c2 phase

557
00:21:15,120 --> 00:21:17,520
so dark hydra's group was uh targeting

558
00:21:17,520 --> 00:21:19,120
also government agencies

559
00:21:19,120 --> 00:21:22,559
in the middle east in this case and

560
00:21:22,559 --> 00:21:25,039
the transmission they were using was

561
00:21:25,039 --> 00:21:28,000
randomized as much as possible so

562
00:21:28,000 --> 00:21:30,320
what they randomized in dns query was

563
00:21:30,320 --> 00:21:31,520
the query size

564
00:21:31,520 --> 00:21:33,440
so the hosting part of the query was

565
00:21:33,440 --> 00:21:36,240
between 30 to 43 characters

566
00:21:36,240 --> 00:21:38,640
so there was not a pattern which could

567
00:21:38,640 --> 00:21:39,520
be you know

568
00:21:39,520 --> 00:21:43,039
detected easily that was randomized uh

569
00:21:43,039 --> 00:21:45,679
delay between the queries uh it was also

570
00:21:45,679 --> 00:21:47,840
randomized and it was not that small it

571
00:21:47,840 --> 00:21:50,400
was uh more or less three seconds

572
00:21:50,400 --> 00:21:53,440
plus minus uh 0.6 second so

573
00:21:53,440 --> 00:21:55,120
between every query there was slightly

574
00:21:55,120 --> 00:21:56,480
different delay

575
00:21:56,480 --> 00:21:59,760
uh they could randomize query types so

576
00:21:59,760 --> 00:22:02,080
they could ask about a record quad a

577
00:22:02,080 --> 00:22:03,520
cname and so on

578
00:22:03,520 --> 00:22:05,360
and they were also randomizing domain

579
00:22:05,360 --> 00:22:06,880
name out of uh

580
00:22:06,880 --> 00:22:09,440
a dozen which they provided in the

581
00:22:09,440 --> 00:22:10,799
malware so

582
00:22:10,799 --> 00:22:13,039
the the you know transmission they were

583
00:22:13,039 --> 00:22:13,840
using was

584
00:22:13,840 --> 00:22:18,159
quiet uh well not looking exactly as

585
00:22:18,159 --> 00:22:20,640
machine generated so it was not so easy

586
00:22:20,640 --> 00:22:22,400
and many security systems

587
00:22:22,400 --> 00:22:25,600
are failing to detect this transmission

588
00:22:25,600 --> 00:22:28,720
what they also did was actually they

589
00:22:28,720 --> 00:22:29,440
were doing

590
00:22:29,440 --> 00:22:32,880
a test what kind of query records

591
00:22:32,880 --> 00:22:36,400
are blocked by uh by a security system

592
00:22:36,400 --> 00:22:36,799
so

593
00:22:36,799 --> 00:22:38,720
they have in the table you have

594
00:22:38,720 --> 00:22:40,240
different comments which could be sent

595
00:22:40,240 --> 00:22:42,240
from the c2 server to the infected

596
00:22:42,240 --> 00:22:43,440
machine

597
00:22:43,440 --> 00:22:46,240
and one of them was test mode and then

598
00:22:46,240 --> 00:22:46,720
the

599
00:22:46,720 --> 00:22:48,960
end point in fact that endpoint would

600
00:22:48,960 --> 00:22:49,919
actually

601
00:22:49,919 --> 00:22:52,640
send some queries with different records

602
00:22:52,640 --> 00:22:55,600
so they will first send a query record

603
00:22:55,600 --> 00:22:59,120
a query uh for for one of these domain

604
00:22:59,120 --> 00:22:59,600
names

605
00:22:59,600 --> 00:23:02,159
if that would be not blocked then they

606
00:23:02,159 --> 00:23:03,600
would use just a query

607
00:23:03,600 --> 00:23:05,440
for the further transmission if that

608
00:23:05,440 --> 00:23:07,600
would be blocked they would try quad a

609
00:23:07,600 --> 00:23:09,200
if that would be blocked

610
00:23:09,200 --> 00:23:12,159
a cname mx soa so they would try

611
00:23:12,159 --> 00:23:14,000
different record types

612
00:23:14,000 --> 00:23:16,960
and the reason why they did what they

613
00:23:16,960 --> 00:23:17,679
did so

614
00:23:17,679 --> 00:23:20,720
is because they did reconnaissance phase

615
00:23:20,720 --> 00:23:21,600
very well

616
00:23:21,600 --> 00:23:23,840
and they knew what kind of security

617
00:23:23,840 --> 00:23:24,960
systems

618
00:23:24,960 --> 00:23:28,040
they could find in the in their target

619
00:23:28,040 --> 00:23:29,440
[Music]

620
00:23:29,440 --> 00:23:33,200
so in this case target was was using a

621
00:23:33,200 --> 00:23:35,760
cisco umbrella secured dns system and

622
00:23:35,760 --> 00:23:37,039
umbrella has this uh

623
00:23:37,039 --> 00:23:39,280
feature that they actually block only

624
00:23:39,280 --> 00:23:41,279
those green types of queries

625
00:23:41,279 --> 00:23:44,400
and they do not block those red mx sla

626
00:23:44,400 --> 00:23:45,679
ns and sig

627
00:23:45,679 --> 00:23:48,799
even if the category for the domain name

628
00:23:48,799 --> 00:23:50,240
is malicious and here you have a

629
00:23:50,240 --> 00:23:52,880
screenshot from january this year

630
00:23:52,880 --> 00:23:56,159
for this owa 365 the bit domain name

631
00:23:56,159 --> 00:23:57,440
that actually when you

632
00:23:57,440 --> 00:24:00,080
ask umbrella about a record it's blocked

633
00:24:00,080 --> 00:24:01,679
as a malicious category

634
00:24:01,679 --> 00:24:04,559
but if you send the same uh same domain

635
00:24:04,559 --> 00:24:06,400
name in the query but change record type

636
00:24:06,400 --> 00:24:09,120
to ns or soa it's actually a load even

637
00:24:09,120 --> 00:24:10,880
though that the category is blocked

638
00:24:10,880 --> 00:24:12,559
so here at the reconnaissance phase

639
00:24:12,559 --> 00:24:15,039
attackers really you know

640
00:24:15,039 --> 00:24:18,000
uh did what did good job on

641
00:24:18,000 --> 00:24:19,919
understanding what are the systems

642
00:24:19,919 --> 00:24:21,440
behind the the target

643
00:24:21,440 --> 00:24:25,360
and how you could bypass them

644
00:24:25,600 --> 00:24:28,080
next techniques in common and control

645
00:24:28,080 --> 00:24:29,520
phase

646
00:24:29,520 --> 00:24:32,080
so dynamic resolution and protocol to

647
00:24:32,080 --> 00:24:33,120
nulling so

648
00:24:33,120 --> 00:24:35,919
dynamic resolution you can use dns in

649
00:24:35,919 --> 00:24:37,279
different ways to to

650
00:24:37,279 --> 00:24:41,120
to resolve an ip address and here

651
00:24:41,120 --> 00:24:43,120
going back to the previous previous

652
00:24:43,120 --> 00:24:44,640
example how you can

653
00:24:44,640 --> 00:24:48,240
for example use soa record to get ip

654
00:24:48,240 --> 00:24:48,799
address

655
00:24:48,799 --> 00:24:51,679
uh of the c2 server so it's very easy

656
00:24:51,679 --> 00:24:52,320
because

657
00:24:52,320 --> 00:24:54,799
in soa record you have master name

658
00:24:54,799 --> 00:24:56,640
server in the first field email of the

659
00:24:56,640 --> 00:24:58,480
administrator in the second field

660
00:24:58,480 --> 00:25:01,440
and then you have a 32-bit integer which

661
00:25:01,440 --> 00:25:03,520
is serial number of the zone file

662
00:25:03,520 --> 00:25:06,720
and then some ttl stuff also 32-bit uh

663
00:25:06,720 --> 00:25:10,000
integers so you can use for example

664
00:25:10,000 --> 00:25:11,279
serial number field

665
00:25:11,279 --> 00:25:13,360
which is 32-bit integer to store ip

666
00:25:13,360 --> 00:25:14,960
address ipv4 address

667
00:25:14,960 --> 00:25:17,679
is also 32-bit integer so actually you

668
00:25:17,679 --> 00:25:19,120
can just even you know

669
00:25:19,120 --> 00:25:21,120
for the purpose of pinging these ip

670
00:25:21,120 --> 00:25:22,559
address you can just

671
00:25:22,559 --> 00:25:25,520
copy and paste it and it will be

672
00:25:25,520 --> 00:25:26,840
displayed as a for

673
00:25:26,840 --> 00:25:30,559
octet format so this is very simple

674
00:25:30,559 --> 00:25:33,120
and it can be used to bypass dns

675
00:25:33,120 --> 00:25:34,799
firewalls

676
00:25:34,799 --> 00:25:37,679
another way which works in for example

677
00:25:37,679 --> 00:25:38,080
in

678
00:25:38,080 --> 00:25:42,400
cloudflare uh secure dns both the

679
00:25:42,400 --> 00:25:44,320
commercial one and the one you can use

680
00:25:44,320 --> 00:25:46,080
at home they have you know one one one

681
00:25:46,080 --> 00:25:46,400
one

682
00:25:46,400 --> 00:25:50,159
for families uh which can block malware

683
00:25:50,159 --> 00:25:50,559
and

684
00:25:50,559 --> 00:25:53,600
uh uh some uh

685
00:25:53,600 --> 00:25:56,799
blocked categories is again using this

686
00:25:56,799 --> 00:25:57,039
uh

687
00:25:57,039 --> 00:26:00,559
different cases so uh well let's

688
00:26:00,559 --> 00:26:03,760
do live actually so for example

689
00:26:03,760 --> 00:26:07,039
if we would ask cloudflare

690
00:26:07,039 --> 00:26:10,720
for example for families for this uh

691
00:26:10,720 --> 00:26:14,240
lightboy top right

692
00:26:14,880 --> 00:26:19,279
but let's make it short

693
00:26:19,279 --> 00:26:21,120
so you can see it was actually blocked

694
00:26:21,120 --> 00:26:23,679
because this is smaller related domain

695
00:26:23,679 --> 00:26:25,679
but it's enough to just change you know

696
00:26:25,679 --> 00:26:28,320
one letter

697
00:26:28,400 --> 00:26:30,720
and then it's resolved to the to the

698
00:26:30,720 --> 00:26:32,159
malicious uh

699
00:26:32,159 --> 00:26:35,840
ip so it can also be used to to bypass

700
00:26:35,840 --> 00:26:39,440
some firewalls okay let's let's look at

701
00:26:39,440 --> 00:26:39,760
the

702
00:26:39,760 --> 00:26:42,799
tunneling so dns over https is

703
00:26:42,799 --> 00:26:47,279
one of the ways to tune out dns protocol

704
00:26:47,440 --> 00:26:50,480
and as colleagues from kaspersky

705
00:26:50,480 --> 00:26:51,360
mentions

706
00:26:51,360 --> 00:26:53,520
some malware start to use somatic or

707
00:26:53,520 --> 00:26:55,919
start to use dns over https

708
00:26:55,919 --> 00:26:59,840
from my experience what i've seen so far

709
00:26:59,840 --> 00:27:02,559
attackers usually use either google's

710
00:27:02,559 --> 00:27:03,120
dns

711
00:27:03,120 --> 00:27:06,480
dns over https or cloudflare because

712
00:27:06,480 --> 00:27:09,840
those two are used by google chrome and

713
00:27:09,840 --> 00:27:13,760
by by firefox and what attackers want to

714
00:27:13,760 --> 00:27:14,960
achieve by using

715
00:27:14,960 --> 00:27:18,080
doh is not the doh itself but basically

716
00:27:18,080 --> 00:27:20,080
they want to hide in the legitimate

717
00:27:20,080 --> 00:27:22,880
traffic and right now there should be

718
00:27:22,880 --> 00:27:25,200
some traffic generated by the browsers

719
00:27:25,200 --> 00:27:28,320
trying to resolve domain names over dns

720
00:27:28,320 --> 00:27:30,799
over https from google or from

721
00:27:30,799 --> 00:27:32,080
cloudflare so they will

722
00:27:32,080 --> 00:27:35,279
not use you know their own doa server

723
00:27:35,279 --> 00:27:36,799
because it doesn't make sense

724
00:27:36,799 --> 00:27:38,399
they want to hide in the legitimate

725
00:27:38,399 --> 00:27:40,240
traffic so they will try to use google

726
00:27:40,240 --> 00:27:40,880
and

727
00:27:40,880 --> 00:27:42,880
and cloud and this is one example six

728
00:27:42,880 --> 00:27:43,919
bot

729
00:27:43,919 --> 00:27:46,240
uh as you see they try to resolve c2

730
00:27:46,240 --> 00:27:47,760
server ip address

731
00:27:47,760 --> 00:27:51,360
using dnsgoogle.com doh service

732
00:27:51,360 --> 00:27:53,279
it's very easy to block actually because

733
00:27:53,279 --> 00:27:56,000
first dnsgoogle.com

734
00:27:56,000 --> 00:27:58,240
has to be resolved to an ip address and

735
00:27:58,240 --> 00:27:59,279
if we are talking about

736
00:27:59,279 --> 00:28:02,159
enterprises basically you should never

737
00:28:02,159 --> 00:28:02,960
allow your

738
00:28:02,960 --> 00:28:06,000
employees to use any kind of external

739
00:28:06,000 --> 00:28:08,559
you know open dns resolver it doesn't

740
00:28:08,559 --> 00:28:11,520
matter if it's using dns dns over https

741
00:28:11,520 --> 00:28:13,919
dns over kls it doesn't matter

742
00:28:13,919 --> 00:28:15,760
basically you should always blocks this

743
00:28:15,760 --> 00:28:18,080
axis so in case of dns you block

744
00:28:18,080 --> 00:28:21,440
ports port 53 in case of doh

745
00:28:21,440 --> 00:28:23,679
you need to block ip addresses of known

746
00:28:23,679 --> 00:28:24,880
resolvers such as

747
00:28:24,880 --> 00:28:26,960
eight eight eight eight you know one one

748
00:28:26,960 --> 00:28:30,960
one one and so on uh

749
00:28:30,960 --> 00:28:32,960
there was a very interesting case of

750
00:28:32,960 --> 00:28:35,520
using doh to resolve

751
00:28:35,520 --> 00:28:38,320
to resolve something let's look uh at

752
00:28:38,320 --> 00:28:40,399
this example and see what is it

753
00:28:40,399 --> 00:28:45,440
let me just copy it into my

754
00:28:45,440 --> 00:28:48,370
board one second

755
00:28:48,370 --> 00:28:51,279
[Music]

756
00:28:51,279 --> 00:28:53,679
okay

757
00:28:55,760 --> 00:28:58,080
so here the attacker was asking

758
00:28:58,080 --> 00:28:59,279
google.com

759
00:28:59,279 --> 00:29:02,559
doh at google to resolve dmarc

760
00:29:02,559 --> 00:29:05,600
record for jqueryartdjs.com so they

761
00:29:05,600 --> 00:29:07,919
asked about txt record and you can see

762
00:29:07,919 --> 00:29:10,159
that it looks like a little bit looks

763
00:29:10,159 --> 00:29:12,399
like a dkim

764
00:29:12,399 --> 00:29:14,559
record so the record which is used to

765
00:29:14,559 --> 00:29:15,600
store

766
00:29:15,600 --> 00:29:18,559
signatures for for email and the key

767
00:29:18,559 --> 00:29:19,520
should be rsa

768
00:29:19,520 --> 00:29:22,000
and here theoretically should be a

769
00:29:22,000 --> 00:29:24,000
base64 encoded key

770
00:29:24,000 --> 00:29:26,799
but actually it was not a key uh so

771
00:29:26,799 --> 00:29:27,679
let's

772
00:29:27,679 --> 00:29:31,279
move back again to the

773
00:29:31,360 --> 00:29:34,799
cyber shaft let's put

774
00:29:34,799 --> 00:29:37,520
let's treat these records not as as a

775
00:29:37,520 --> 00:29:38,080
whole

776
00:29:38,080 --> 00:29:42,158
but let's use slash as a

777
00:29:43,039 --> 00:29:45,600
something which is splitting those this

778
00:29:45,600 --> 00:29:47,279
text into separate

779
00:29:47,279 --> 00:29:49,520
separate records so let's copy for

780
00:29:49,520 --> 00:29:50,480
example

781
00:29:50,480 --> 00:29:53,679
uh one of these to cyber chef and let's

782
00:29:53,679 --> 00:29:54,399
do

783
00:29:54,399 --> 00:29:58,480
base64 decoding once

784
00:29:58,480 --> 00:30:01,600
and guess what this looks like another

785
00:30:01,600 --> 00:30:02,720
base64

786
00:30:02,720 --> 00:30:06,840
a string right so let's decode it once

787
00:30:06,840 --> 00:30:08,720
again

788
00:30:08,720 --> 00:30:12,399
and here you got the number

789
00:30:15,760 --> 00:30:19,840
let's try to use it as an ipv4 address

790
00:30:19,840 --> 00:30:22,880
right so we see how

791
00:30:22,880 --> 00:30:26,159
different techniques can be can be using

792
00:30:26,159 --> 00:30:28,399
dns to resolve domain name

793
00:30:28,399 --> 00:30:30,559
not necessarily you know asking from an

794
00:30:30,559 --> 00:30:31,520
a record

795
00:30:31,520 --> 00:30:33,440
but it could be an soa record holding

796
00:30:33,440 --> 00:30:35,360
some data it could be you know

797
00:30:35,360 --> 00:30:38,320
txt record having something pretending

798
00:30:38,320 --> 00:30:39,520
to be

799
00:30:39,520 --> 00:30:42,720
digging uh the kim wrestler uh record

800
00:30:42,720 --> 00:30:44,399
right so it's quite interesting

801
00:30:44,399 --> 00:30:46,880
uh to look how how those attackers are

802
00:30:46,880 --> 00:30:49,360
trying to find out new ways

803
00:30:49,360 --> 00:30:52,960
so as i said regarding doh i don't think

804
00:30:52,960 --> 00:30:54,000
it's like a

805
00:30:54,000 --> 00:30:56,720
big change in the security space people

806
00:30:56,720 --> 00:30:57,039
are

807
00:30:57,039 --> 00:31:00,480
afraid of that but actually in case of

808
00:31:00,480 --> 00:31:03,679
enterprises in case of company security

809
00:31:03,679 --> 00:31:05,919
you basically should do what you were

810
00:31:05,919 --> 00:31:08,960
always doing so you are blocking port 53

811
00:31:08,960 --> 00:31:10,000
to block

812
00:31:10,000 --> 00:31:12,799
public dns resolvers and now you need to

813
00:31:12,799 --> 00:31:14,720
just use different way to block all

814
00:31:14,720 --> 00:31:16,720
public doh resolvers

815
00:31:16,720 --> 00:31:18,240
and this has to be done in a different

816
00:31:18,240 --> 00:31:19,840
way of course it's not just about

817
00:31:19,840 --> 00:31:20,960
blocking with the port

818
00:31:20,960 --> 00:31:23,600
you need to block fqdns of those you

819
00:31:23,600 --> 00:31:24,360
know

820
00:31:24,360 --> 00:31:26,799
dns.google.com dns.google because they

821
00:31:26,799 --> 00:31:27,840
need to be resolved

822
00:31:27,840 --> 00:31:29,360
and also on your firewalls you should

823
00:31:29,360 --> 00:31:31,279
block ip addresses such as you know quad

824
00:31:31,279 --> 00:31:34,000
a quad one quad nine and so on and so on

825
00:31:34,000 --> 00:31:34,880
and you can get

826
00:31:34,880 --> 00:31:37,440
a list of public level library solvers

827
00:31:37,440 --> 00:31:38,000
uh

828
00:31:38,000 --> 00:31:39,760
here on the on the github of course if

829
00:31:39,760 --> 00:31:42,320
you can would be best to analyze

830
00:31:42,320 --> 00:31:44,240
inspect you know decrypt and inspect

831
00:31:44,240 --> 00:31:45,760
https traffic

832
00:31:45,760 --> 00:31:48,960
and look uh in those packets in search

833
00:31:48,960 --> 00:31:49,360
for

834
00:31:49,360 --> 00:31:53,519
actually doh requests

835
00:31:53,600 --> 00:31:57,279
okay that's uh that's that's all from my

836
00:31:57,279 --> 00:31:59,600
from my side i think i was a little bit

837
00:31:59,600 --> 00:32:00,799
uh

838
00:32:00,799 --> 00:32:02,399
hurrying to be honest because i was

839
00:32:02,399 --> 00:32:04,640
afraid that it wouldn't it can take too

840
00:32:04,640 --> 00:32:05,519
much time but

841
00:32:05,519 --> 00:32:07,200
we will have more time for questions

842
00:32:07,200 --> 00:32:08,559
then or maybe

843
00:32:08,559 --> 00:32:11,600
also you know some live shows

844
00:32:11,600 --> 00:32:22,639
in the q a session so back to your idol

