1
00:00:09,200 --> 00:00:10,800
okay so hi everyone

2
00:00:10,800 --> 00:00:12,719
today i'm going to talk to you about

3
00:00:12,719 --> 00:00:15,120
milobot and detecting the undetected

4
00:00:15,120 --> 00:00:17,039
using deep learning

5
00:00:17,039 --> 00:00:19,760
first i'll present myself my name is

6
00:00:19,760 --> 00:00:21,840
yael dais

7
00:00:21,840 --> 00:00:23,439
and you can see my picture here but you

8
00:00:23,439 --> 00:00:25,279
can also see my face

9
00:00:25,279 --> 00:00:28,240
and i'm a security data science team

10
00:00:28,240 --> 00:00:30,000
lead for akamai technologies

11
00:00:30,000 --> 00:00:32,558
and i'll explain a little bit about this

12
00:00:32,558 --> 00:00:34,160
in the next slide

13
00:00:34,160 --> 00:00:37,200
um and i wanted to

14
00:00:37,200 --> 00:00:39,680
get to know you guys but i can't see you

15
00:00:39,680 --> 00:00:41,360
guys so i thought i'd present myself a

16
00:00:41,360 --> 00:00:43,680
little bit in a personal way so

17
00:00:43,680 --> 00:00:46,320
during this pandemic i think my days

18
00:00:46,320 --> 00:00:48,320
usually consist of all the things that i

19
00:00:48,320 --> 00:00:49,920
listed here so it's

20
00:00:49,920 --> 00:00:52,960
botnets traffic data algorithms

21
00:00:52,960 --> 00:00:55,600
and i also like reading painting and i

22
00:00:55,600 --> 00:00:57,680
also enjoy a little bit of gaming

23
00:00:57,680 --> 00:01:01,359
so i hope uh this gives us a little bit

24
00:01:01,359 --> 00:01:03,039
of a personal introduction

25
00:01:03,039 --> 00:01:05,360
um and now let's talk about my daily

26
00:01:05,360 --> 00:01:08,640
work or why am i here speaking to you so

27
00:01:08,640 --> 00:01:11,520
i work for a company called akamai and

28
00:01:11,520 --> 00:01:13,200
maybe some of you may know but

29
00:01:13,200 --> 00:01:16,000
akamai is probably one of the largest

30
00:01:16,000 --> 00:01:17,840
cdm providers in the world which means

31
00:01:17,840 --> 00:01:18,479
that

32
00:01:18,479 --> 00:01:20,400
they have a lot of servers all over the

33
00:01:20,400 --> 00:01:22,080
internet all over the globe and

34
00:01:22,080 --> 00:01:23,600
a lot of the internet traffic in the

35
00:01:23,600 --> 00:01:25,200
world go through akamai

36
00:01:25,200 --> 00:01:28,000
and over the years they have

37
00:01:28,000 --> 00:01:30,720
transitioned into using all this data

38
00:01:30,720 --> 00:01:33,840
into really interesting security product

39
00:01:33,840 --> 00:01:35,200
and defense systems

40
00:01:35,200 --> 00:01:39,280
and specifically i have the privilege of

41
00:01:39,280 --> 00:01:40,400
researching over

42
00:01:40,400 --> 00:01:43,759
this sheer size of data like it's huge

43
00:01:43,759 --> 00:01:46,479
dns traffic that we see every day and my

44
00:01:46,479 --> 00:01:47,920
task is to

45
00:01:47,920 --> 00:01:51,040
look for attacks over this traffic and

46
00:01:51,040 --> 00:01:52,720
block it for everyone

47
00:01:52,720 --> 00:01:55,040
um so as you can see i have great

48
00:01:55,040 --> 00:01:57,520
responsibility and also great visibility

49
00:01:57,520 --> 00:02:00,640
to understand how things look for

50
00:02:00,640 --> 00:02:03,280
about a third of this world at every

51
00:02:03,280 --> 00:02:04,719
given time

52
00:02:04,719 --> 00:02:07,119
so we've established what i have is the

53
00:02:07,119 --> 00:02:08,160
dns empire

54
00:02:08,160 --> 00:02:10,318
and a lot of data but what do i do with

55
00:02:10,318 --> 00:02:11,920
it

56
00:02:11,920 --> 00:02:13,920
so what's going to be on the agenda

57
00:02:13,920 --> 00:02:15,760
today first of all we're going to talk

58
00:02:15,760 --> 00:02:16,959
about milobot right

59
00:02:16,959 --> 00:02:18,879
it's an it's an unknown name at least it

60
00:02:18,879 --> 00:02:20,720
was for me let's get best out of the

61
00:02:20,720 --> 00:02:21,680
clear

62
00:02:21,680 --> 00:02:24,080
and then we're going to talk about dgas

63
00:02:24,080 --> 00:02:24,800
and

64
00:02:24,800 --> 00:02:26,400
how did the defense system and the

65
00:02:26,400 --> 00:02:28,560
defense community tackle this problem so

66
00:02:28,560 --> 00:02:29,440
far

67
00:02:29,440 --> 00:02:31,519
we're going to also cover how did we at

68
00:02:31,519 --> 00:02:32,800
akamai tackle this

69
00:02:32,800 --> 00:02:34,800
issue and we're going to present you a

70
00:02:34,800 --> 00:02:37,519
real production system that we have

71
00:02:37,519 --> 00:02:39,920
running on real traffic at any given

72
00:02:39,920 --> 00:02:40,879
time

73
00:02:40,879 --> 00:02:42,160
i'm going to share with the results in

74
00:02:42,160 --> 00:02:43,840
the wild and then i'm going to get give

75
00:02:43,840 --> 00:02:46,000
a really deep dive into milobot from our

76
00:02:46,000 --> 00:02:48,239
perspective

77
00:02:48,239 --> 00:02:52,879
so what is milobot back in 2018

78
00:02:52,879 --> 00:02:55,440
there were a few blogs about this new

79
00:02:55,440 --> 00:02:56,720
botnet that is on the

80
00:02:56,720 --> 00:02:59,440
horizon and it's just now being

81
00:02:59,440 --> 00:03:00,319
discovered

82
00:03:00,319 --> 00:03:02,560
and there was a few blogs by a few

83
00:03:02,560 --> 00:03:04,159
vendors here you can see

84
00:03:04,159 --> 00:03:06,720
um trends micro and deep instinct and

85
00:03:06,720 --> 00:03:07,680
centurylink

86
00:03:07,680 --> 00:03:10,080
and morphe set and so on and you can see

87
00:03:10,080 --> 00:03:13,040
um there was some traction around it

88
00:03:13,040 --> 00:03:16,159
and specifically i

89
00:03:16,159 --> 00:03:18,800
took a snapshot of the blog given by

90
00:03:18,800 --> 00:03:20,080
etip instinct

91
00:03:20,080 --> 00:03:22,720
and they were talking about how advanced

92
00:03:22,720 --> 00:03:25,120
this new malware and botnet is that it

93
00:03:25,120 --> 00:03:25,440
has

94
00:03:25,440 --> 00:03:27,920
tons of evasions techniques you can see

95
00:03:27,920 --> 00:03:28,959
anti-vm

96
00:03:28,959 --> 00:03:31,200
and online sandbox and item debugging

97
00:03:31,200 --> 00:03:33,519
and code injection and process halloween

98
00:03:33,519 --> 00:03:37,920
so many fancy techniques and lastly

99
00:03:37,920 --> 00:03:40,959
it also uses a dka now

100
00:03:40,959 --> 00:03:43,360
specifically i'm focusing on this one

101
00:03:43,360 --> 00:03:44,080
because

102
00:03:44,080 --> 00:03:46,640
this is a invasion technique that could

103
00:03:46,640 --> 00:03:47,519
be visible

104
00:03:47,519 --> 00:03:51,120
in the network space which is obviously

105
00:03:51,120 --> 00:03:54,720
my expertise so i want to go over

106
00:03:54,720 --> 00:03:57,439
this specific evasion technique and walk

107
00:03:57,439 --> 00:03:58,159
you through

108
00:03:58,159 --> 00:04:00,799
our detection system to understand how

109
00:04:00,799 --> 00:04:01,840
we detected

110
00:04:01,840 --> 00:04:05,360
this really sophisticated button

111
00:04:05,360 --> 00:04:08,000
so let's go over the go over the basics

112
00:04:08,000 --> 00:04:08,640
say

113
00:04:08,640 --> 00:04:10,879
you were successful enough as an

114
00:04:10,879 --> 00:04:12,799
attacker and you managed to get your

115
00:04:12,799 --> 00:04:14,239
client your malware

116
00:04:14,239 --> 00:04:16,399
installed on a remote computer and here

117
00:04:16,399 --> 00:04:18,320
you can see it on the left

118
00:04:18,320 --> 00:04:22,000
and once this computer wakes up and the

119
00:04:22,000 --> 00:04:23,280
malware wakes up

120
00:04:23,280 --> 00:04:25,120
you want it to do something for you for

121
00:04:25,120 --> 00:04:27,040
your malicious intent

122
00:04:27,040 --> 00:04:29,919
and you form some kind of command

123
00:04:29,919 --> 00:04:31,199
control channel

124
00:04:31,199 --> 00:04:34,479
to have the ability to transfer data

125
00:04:34,479 --> 00:04:35,120
between

126
00:04:35,120 --> 00:04:37,280
the malware and the infected computer

127
00:04:37,280 --> 00:04:39,680
and specifically in this case

128
00:04:39,680 --> 00:04:41,520
between both master.com which is the

129
00:04:41,520 --> 00:04:43,440
domain that is used for the command

130
00:04:43,440 --> 00:04:45,680
control channel

131
00:04:45,680 --> 00:04:48,639
and defense systems natively and

132
00:04:48,639 --> 00:04:49,680
naturally

133
00:04:49,680 --> 00:04:51,919
look for these command control domains

134
00:04:51,919 --> 00:04:53,680
in traffic or

135
00:04:53,680 --> 00:04:56,960
look for them before traffic happens

136
00:04:56,960 --> 00:04:58,880
and they add this to this blocking

137
00:04:58,880 --> 00:05:01,120
system that would not allow the

138
00:05:01,120 --> 00:05:03,440
communication to pass through

139
00:05:03,440 --> 00:05:05,520
so from the network perspective the

140
00:05:05,520 --> 00:05:07,440
computer might be compromised but it's

141
00:05:07,440 --> 00:05:09,360
not going to be able to form

142
00:05:09,360 --> 00:05:11,680
this command and control communication

143
00:05:11,680 --> 00:05:12,960
channel and therefore the malicious

144
00:05:12,960 --> 00:05:13,759
activity

145
00:05:13,759 --> 00:05:17,440
is somewhat blocked

146
00:05:17,520 --> 00:05:20,720
so what is a dga and the dga is an

147
00:05:20,720 --> 00:05:22,240
acronym that stands for domain

148
00:05:22,240 --> 00:05:23,039
generation

149
00:05:23,039 --> 00:05:27,680
algorithms so specifically in this case

150
00:05:27,680 --> 00:05:29,520
an attacker sophisticated attacker

151
00:05:29,520 --> 00:05:31,120
understand that they want to evade the

152
00:05:31,120 --> 00:05:33,039
technique that i just showcased you they

153
00:05:33,039 --> 00:05:33,919
want to evade

154
00:05:33,919 --> 00:05:36,880
the fact they have a one point failure

155
00:05:36,880 --> 00:05:38,080
with a communication

156
00:05:38,080 --> 00:05:40,320
channel and they want to be resilient to

157
00:05:40,320 --> 00:05:42,160
this so they understand they want to

158
00:05:42,160 --> 00:05:42,800
create

159
00:05:42,800 --> 00:05:44,880
multiple domain names that could be

160
00:05:44,880 --> 00:05:46,400
potentially used for

161
00:05:46,400 --> 00:05:48,880
forming this communication channel and

162
00:05:48,880 --> 00:05:51,039
what those sophisticated attackers do

163
00:05:51,039 --> 00:05:53,039
is that they write code just like you

164
00:05:53,039 --> 00:05:55,520
and me and they add it to the malware

165
00:05:55,520 --> 00:05:58,479
and this code generates randomly

166
00:05:58,479 --> 00:06:00,000
generated strings

167
00:06:00,000 --> 00:06:01,680
that could be used for those domain

168
00:06:01,680 --> 00:06:03,039
names and

169
00:06:03,039 --> 00:06:06,080
those randomly generated domains are not

170
00:06:06,080 --> 00:06:08,000
completely random because they are based

171
00:06:08,000 --> 00:06:09,919
on a shared secret

172
00:06:09,919 --> 00:06:11,919
and this shared secret is known both to

173
00:06:11,919 --> 00:06:14,000
the malware and to the attacker on the

174
00:06:14,000 --> 00:06:14,720
surface

175
00:06:14,720 --> 00:06:17,440
on the server side so what happens on

176
00:06:17,440 --> 00:06:18,479
day one

177
00:06:18,479 --> 00:06:20,560
the malware wakes up the attacker wakes

178
00:06:20,560 --> 00:06:22,000
up on the server side

179
00:06:22,000 --> 00:06:24,400
they both run this dji code the same

180
00:06:24,400 --> 00:06:25,520
code with the same

181
00:06:25,520 --> 00:06:28,960
secret secret um shared between them

182
00:06:28,960 --> 00:06:31,520
between them and they're able to create

183
00:06:31,520 --> 00:06:32,160
the same

184
00:06:32,160 --> 00:06:35,680
chain of random looking domain names

185
00:06:35,680 --> 00:06:37,520
and because they are so random and they

186
00:06:37,520 --> 00:06:39,680
look so gibberish it's not very likely

187
00:06:39,680 --> 00:06:41,919
that they are registered to anyone

188
00:06:41,919 --> 00:06:44,240
so the attacker can basically choose one

189
00:06:44,240 --> 00:06:46,479
of this really long list of domains

190
00:06:46,479 --> 00:06:49,039
and register it that day to an ip that

191
00:06:49,039 --> 00:06:50,080
belongs to their

192
00:06:50,080 --> 00:06:52,400
infrastructure for attacking and for

193
00:06:52,400 --> 00:06:53,199
this day

194
00:06:53,199 --> 00:06:54,800
this is going to be the communication

195
00:06:54,800 --> 00:06:57,520
channel for command and control

196
00:06:57,520 --> 00:07:00,080
then on day number two the thinking

197
00:07:00,080 --> 00:07:01,199
thing happened

198
00:07:01,199 --> 00:07:03,440
the attacker and the malware run this

199
00:07:03,440 --> 00:07:04,639
dga code

200
00:07:04,639 --> 00:07:06,720
they create the domain names the

201
00:07:06,720 --> 00:07:09,199
attacker registers only one of them

202
00:07:09,199 --> 00:07:12,000
and this way they are forming the

203
00:07:12,000 --> 00:07:13,440
command and control communication for

204
00:07:13,440 --> 00:07:14,479
the second day

205
00:07:14,479 --> 00:07:17,360
but for your keen eyes you will see that

206
00:07:17,360 --> 00:07:19,280
on day number one it was a completely

207
00:07:19,280 --> 00:07:20,319
different domain

208
00:07:20,319 --> 00:07:23,520
used for this communication so for me

209
00:07:23,520 --> 00:07:24,800
for the defense side

210
00:07:24,800 --> 00:07:27,759
if i'm able to detect it or maybe

211
00:07:27,759 --> 00:07:28,560
predict it

212
00:07:28,560 --> 00:07:31,360
in advance maybe i will be able to stop

213
00:07:31,360 --> 00:07:31,840
it

214
00:07:31,840 --> 00:07:33,759
but during the day that is happening i

215
00:07:33,759 --> 00:07:36,080
need to detect it basically

216
00:07:36,080 --> 00:07:38,720
a few minutes later at most to be able

217
00:07:38,720 --> 00:07:40,000
to effectively

218
00:07:40,000 --> 00:07:42,080
stop this botnet from working because

219
00:07:42,080 --> 00:07:43,520
otherwise tomorrow

220
00:07:43,520 --> 00:07:45,440
this domain is not going to be relevant

221
00:07:45,440 --> 00:07:46,720
anymore

222
00:07:46,720 --> 00:07:50,240
so so far we understood what is dga and

223
00:07:50,240 --> 00:07:52,160
what is this evasion techniques that

224
00:07:52,160 --> 00:07:54,479
attackers use and i think i'm trying to

225
00:07:54,479 --> 00:07:55,199
give you

226
00:07:55,199 --> 00:07:57,440
a notion of what the solution for

227
00:07:57,440 --> 00:07:59,280
detecting this is going to be it has to

228
00:07:59,280 --> 00:08:00,560
be timeliness right

229
00:08:00,560 --> 00:08:03,919
because we want to be effective but it

230
00:08:03,919 --> 00:08:05,599
also needs to do something

231
00:08:05,599 --> 00:08:08,080
with this really random looking pattern

232
00:08:08,080 --> 00:08:09,280
and so on

233
00:08:09,280 --> 00:08:11,199
so this specific technique as i

234
00:08:11,199 --> 00:08:14,639
mentioned milobot was using

235
00:08:14,639 --> 00:08:16,879
so how did the defense community tackle

236
00:08:16,879 --> 00:08:19,759
the dga problem so far

237
00:08:19,759 --> 00:08:23,440
so i this is an example given from

238
00:08:23,440 --> 00:08:26,240
a blog and a github for from a

239
00:08:26,240 --> 00:08:27,039
researchers

240
00:08:27,039 --> 00:08:28,879
a researcher that i really appreciate

241
00:08:28,879 --> 00:08:30,639
and i would like to give a shout out to

242
00:08:30,639 --> 00:08:33,039
and it's called butterj you can see the

243
00:08:33,039 --> 00:08:34,000
link here at the

244
00:08:34,000 --> 00:08:37,120
at the top left so usually what

245
00:08:37,120 --> 00:08:39,039
researchers did so far

246
00:08:39,039 --> 00:08:42,479
is once they got a hold of a malware

247
00:08:42,479 --> 00:08:45,279
that has a dga code they just reversed

248
00:08:45,279 --> 00:08:45,839
it

249
00:08:45,839 --> 00:08:47,760
and once they reversed it they found the

250
00:08:47,760 --> 00:08:49,680
piece of code that is the dga that is

251
00:08:49,680 --> 00:08:51,600
generating these domain names

252
00:08:51,600 --> 00:08:53,920
and then implement it back in python for

253
00:08:53,920 --> 00:08:55,040
example

254
00:08:55,040 --> 00:08:57,600
just so the community can use this to

255
00:08:57,600 --> 00:08:59,040
predict the domains that are going to be

256
00:08:59,040 --> 00:09:00,399
used tomorrow

257
00:09:00,399 --> 00:09:03,440
next year next week whatever

258
00:09:03,440 --> 00:09:05,839
so this is an example of a real case of

259
00:09:05,839 --> 00:09:06,720
a quite

260
00:09:06,720 --> 00:09:09,600
quite an old malware called cinda and

261
00:09:09,600 --> 00:09:11,200
this is a real reverse engineering

262
00:09:11,200 --> 00:09:13,440
task that he did and we implemented in

263
00:09:13,440 --> 00:09:14,320
python

264
00:09:14,320 --> 00:09:17,279
now what can the defense community do

265
00:09:17,279 --> 00:09:19,200
based on this reverse engineering

266
00:09:19,200 --> 00:09:22,320
so as i said these domains are

267
00:09:22,320 --> 00:09:25,120
basing their creation of domains based

268
00:09:25,120 --> 00:09:26,880
on a shared secret

269
00:09:26,880 --> 00:09:29,040
and sometimes the secret is also called

270
00:09:29,040 --> 00:09:30,320
the seed

271
00:09:30,320 --> 00:09:32,240
is something that is not that trivial to

272
00:09:32,240 --> 00:09:33,519
achieve or to retrieve

273
00:09:33,519 --> 00:09:35,200
back from the code sometimes it's not

274
00:09:35,200 --> 00:09:36,800
even in the code

275
00:09:36,800 --> 00:09:40,240
so using this uh reversed

276
00:09:40,240 --> 00:09:43,040
code what defenses mechanic community

277
00:09:43,040 --> 00:09:44,399
did so far

278
00:09:44,399 --> 00:09:46,560
is try to leverage it for first of all

279
00:09:46,560 --> 00:09:47,760
breaking the seed

280
00:09:47,760 --> 00:09:50,160
for example if i see a lot of domains in

281
00:09:50,160 --> 00:09:50,959
traffic

282
00:09:50,959 --> 00:09:52,800
and i see that the pattern looks like

283
00:09:52,800 --> 00:09:54,160
something that could be used

284
00:09:54,160 --> 00:09:56,800
could be generated by this code maybe i

285
00:09:56,800 --> 00:09:58,880
can brute force this and then understand

286
00:09:58,880 --> 00:10:00,000
the seeds

287
00:10:00,000 --> 00:10:02,560
in retrospect for example and once i

288
00:10:02,560 --> 00:10:03,519
have the seed

289
00:10:03,519 --> 00:10:05,920
i have the ability in combination with

290
00:10:05,920 --> 00:10:06,880
this code

291
00:10:06,880 --> 00:10:08,399
to create all of the domains that it's

292
00:10:08,399 --> 00:10:09,920
going to create tomorrow

293
00:10:09,920 --> 00:10:12,640
and next year and another thing we can

294
00:10:12,640 --> 00:10:13,760
do

295
00:10:13,760 --> 00:10:16,320
is that sometimes there are domains

296
00:10:16,320 --> 00:10:18,720
there are djs that don't use a seed

297
00:10:18,720 --> 00:10:20,560
and in which case this is a problem that

298
00:10:20,560 --> 00:10:23,120
is already solved and it's really easy

299
00:10:23,120 --> 00:10:25,839
so this is most of the work that's been

300
00:10:25,839 --> 00:10:27,120
done before

301
00:10:27,120 --> 00:10:29,279
what i'm going to show you and it's

302
00:10:29,279 --> 00:10:30,320
really valuable

303
00:10:30,320 --> 00:10:33,440
right like it's spot-on we have

304
00:10:33,440 --> 00:10:35,120
malwares and samples we know how to

305
00:10:35,120 --> 00:10:36,959
reverse engineer we know how to get what

306
00:10:36,959 --> 00:10:38,079
we want

307
00:10:38,079 --> 00:10:40,320
but there's an inherent problem with

308
00:10:40,320 --> 00:10:42,320
this specific solution

309
00:10:42,320 --> 00:10:44,720
and i think you would all intuitively

310
00:10:44,720 --> 00:10:45,680
agree that

311
00:10:45,680 --> 00:10:48,399
how can it detect anything new like this

312
00:10:48,399 --> 00:10:49,279
is a system

313
00:10:49,279 --> 00:10:52,160
that we built to detect the same variant

314
00:10:52,160 --> 00:10:52,480
or

315
00:10:52,480 --> 00:10:54,399
the same malware family that we already

316
00:10:54,399 --> 00:10:56,160
know but what about if

317
00:10:56,160 --> 00:10:57,920
there's a new malware on the horizon and

318
00:10:57,920 --> 00:10:59,680
it's using a dga

319
00:10:59,680 --> 00:11:02,160
can't i leverage my knowledge of this

320
00:11:02,160 --> 00:11:04,079
very interesting phenomena to detect it

321
00:11:04,079 --> 00:11:05,279
without being

322
00:11:05,279 --> 00:11:07,120
it's based on the binary and reverse

323
00:11:07,120 --> 00:11:09,279
engineering and also

324
00:11:09,279 --> 00:11:11,600
if i already managed to retrieve the

325
00:11:11,600 --> 00:11:13,120
malware and i have a binary

326
00:11:13,120 --> 00:11:15,920
at hold what about if i couldn't break

327
00:11:15,920 --> 00:11:16,560
the seed

328
00:11:16,560 --> 00:11:18,320
so it means i have the code i have the

329
00:11:18,320 --> 00:11:20,079
reverse engineering and still i can't

330
00:11:20,079 --> 00:11:21,600
block it in traffic like

331
00:11:21,600 --> 00:11:23,279
i can't predict what it's going to use

332
00:11:23,279 --> 00:11:24,880
tomorrow in advance

333
00:11:24,880 --> 00:11:29,279
it's mind-boggling right so

334
00:11:29,279 --> 00:11:32,079
for advancing our defense system we're

335
00:11:32,079 --> 00:11:33,279
gonna go through

336
00:11:33,279 --> 00:11:35,519
a thinking process together right now

337
00:11:35,519 --> 00:11:36,560
and our goal is

338
00:11:36,560 --> 00:11:38,800
first of all as i just stressed we want

339
00:11:38,800 --> 00:11:41,040
to be able to detect dji domains

340
00:11:41,040 --> 00:11:44,000
that we couldn't break because if i have

341
00:11:44,000 --> 00:11:46,079
no malware it's pretty ridiculous if i

342
00:11:46,079 --> 00:11:48,720
couldn't block it in traffic tomorrow

343
00:11:48,720 --> 00:11:50,880
secondly we want to be able to detect

344
00:11:50,880 --> 00:11:52,320
new new malwares

345
00:11:52,320 --> 00:11:54,800
using dga even if i have no knowledge of

346
00:11:54,800 --> 00:11:55,519
the pattern

347
00:11:55,519 --> 00:11:57,920
no knowledge of how it's going to look

348
00:11:57,920 --> 00:11:59,440
in traffic

349
00:11:59,440 --> 00:12:02,399
and a bonus goal would be if i'm able to

350
00:12:02,399 --> 00:12:03,920
detect the ones that i

351
00:12:03,920 --> 00:12:06,320
did break and do know because then this

352
00:12:06,320 --> 00:12:08,240
would make my new system

353
00:12:08,240 --> 00:12:11,200
a holistic system for solving a

354
00:12:11,200 --> 00:12:13,279
dga-based malware

355
00:12:13,279 --> 00:12:15,760
so this is our goal and now let's go

356
00:12:15,760 --> 00:12:17,440
through this together

357
00:12:17,440 --> 00:12:20,959
um my first intuition and i hope that

358
00:12:20,959 --> 00:12:22,639
yours as well would be

359
00:12:22,639 --> 00:12:25,040
okay this looks pretty gibberish right

360
00:12:25,040 --> 00:12:26,720
like if i look at the domain names and

361
00:12:26,720 --> 00:12:27,680
traffic

362
00:12:27,680 --> 00:12:29,440
it looks like something that wasn't

363
00:12:29,440 --> 00:12:31,519
generated by a person

364
00:12:31,519 --> 00:12:34,399
nobody wrote and typed it in and it

365
00:12:34,399 --> 00:12:36,000
looks pretty weird right so

366
00:12:36,000 --> 00:12:38,560
can't i just make a heuristic or basic

367
00:12:38,560 --> 00:12:40,480
algorithm that would understand

368
00:12:40,480 --> 00:12:43,839
this exact intuition and this exact

369
00:12:43,839 --> 00:12:44,639
intuition is

370
00:12:44,639 --> 00:12:47,279
quite true and the way we formulate it

371
00:12:47,279 --> 00:12:50,320
in a statistical manner is we say that

372
00:12:50,320 --> 00:12:52,079
we believe the distribution of

373
00:12:52,079 --> 00:12:54,399
characters used for the domain name

374
00:12:54,399 --> 00:12:56,560
is not going to look natural at all for

375
00:12:56,560 --> 00:12:57,519
example

376
00:12:57,519 --> 00:13:00,000
you can see that this is a real example

377
00:13:00,000 --> 00:13:01,120
of two

378
00:13:01,120 --> 00:13:02,959
malwares and you can see that the

379
00:13:02,959 --> 00:13:04,240
distribution or

380
00:13:04,240 --> 00:13:06,160
the amount of characters used in the

381
00:13:06,160 --> 00:13:07,279
domain names

382
00:13:07,279 --> 00:13:09,600
look very interesting for tinba for

383
00:13:09,600 --> 00:13:10,320
example

384
00:13:10,320 --> 00:13:12,240
you can see a uniform distribution

385
00:13:12,240 --> 00:13:14,079
between characters a and z

386
00:13:14,079 --> 00:13:16,240
which means that every character you use

387
00:13:16,240 --> 00:13:18,000
the same amount of time

388
00:13:18,000 --> 00:13:20,160
over the language and obviously this is

389
00:13:20,160 --> 00:13:22,079
something that is very

390
00:13:22,079 --> 00:13:24,399
different from natural language or for

391
00:13:24,399 --> 00:13:25,360
domains that are

392
00:13:25,360 --> 00:13:28,560
um popular because for example we can

393
00:13:28,560 --> 00:13:29,440
all understand

394
00:13:29,440 --> 00:13:32,320
intuitively that vowels are used much

395
00:13:32,320 --> 00:13:34,320
more than every other ladder letter in

396
00:13:34,320 --> 00:13:36,320
the english language so obviously

397
00:13:36,320 --> 00:13:38,800
it's not going all to be uh for the same

398
00:13:38,800 --> 00:13:40,000
frequency

399
00:13:40,000 --> 00:13:41,839
and for example for the dire malware you

400
00:13:41,839 --> 00:13:43,680
can see that it uses

401
00:13:43,680 --> 00:13:46,160
uh the same characters for hexa which is

402
00:13:46,160 --> 00:13:47,839
obviously something that we're not using

403
00:13:47,839 --> 00:13:49,600
natural language so

404
00:13:49,600 --> 00:13:51,440
when you see this you're thinking okay

405
00:13:51,440 --> 00:13:52,880
so this is a really easy way to

406
00:13:52,880 --> 00:13:53,680
understand that

407
00:13:53,680 --> 00:13:55,199
all these domain names are coming from

408
00:13:55,199 --> 00:13:56,959
malwares

409
00:13:56,959 --> 00:13:59,360
but attackers are not dumb attackers

410
00:13:59,360 --> 00:14:01,199
adapt like they understand that we're

411
00:14:01,199 --> 00:14:02,959
looking for ways to block them and they

412
00:14:02,959 --> 00:14:05,040
understand we're looking for ways to

413
00:14:05,040 --> 00:14:08,079
detect them so they just adapted and

414
00:14:08,079 --> 00:14:11,600
what they did was they basically

415
00:14:11,600 --> 00:14:14,560
created the domain names in the code but

416
00:14:14,560 --> 00:14:15,040
they're

417
00:14:15,040 --> 00:14:17,040
sampling or using the characters for the

418
00:14:17,040 --> 00:14:18,399
same distribution

419
00:14:18,399 --> 00:14:21,519
that is in alexa top 1 million domains

420
00:14:21,519 --> 00:14:23,760
so obviously the heuristic that we just

421
00:14:23,760 --> 00:14:25,120
had and which we tried to create

422
00:14:25,120 --> 00:14:28,000
together wouldn't work

423
00:14:28,000 --> 00:14:30,240
but okay wait hold up like we're still

424
00:14:30,240 --> 00:14:31,040
smarter right

425
00:14:31,040 --> 00:14:33,199
we we are working just as hard as the

426
00:14:33,199 --> 00:14:35,199
attackers to try and defend our system

427
00:14:35,199 --> 00:14:36,000
like okay

428
00:14:36,000 --> 00:14:39,279
we got this so what we did next was okay

429
00:14:39,279 --> 00:14:40,079
i'm gonna to

430
00:14:40,079 --> 00:14:41,680
look at the distribution of the two

431
00:14:41,680 --> 00:14:44,959
characters um in the language mean to me

432
00:14:44,959 --> 00:14:47,839
that i'm taking every two characters

433
00:14:47,839 --> 00:14:50,160
concatenated and looking how frequent

434
00:14:50,160 --> 00:14:52,079
that is in the domain names

435
00:14:52,079 --> 00:14:53,839
and here again you can see that i was

436
00:14:53,839 --> 00:14:55,360
able to differentiate

437
00:14:55,360 --> 00:14:57,680
between domains that are using coming

438
00:14:57,680 --> 00:14:59,360
from a dga code and domains that are

439
00:14:59,360 --> 00:15:01,279
coming from alexa

440
00:15:01,279 --> 00:15:03,920
but again attackers adapt they

441
00:15:03,920 --> 00:15:04,800
understand

442
00:15:04,800 --> 00:15:06,959
that this cat and mouse game they always

443
00:15:06,959 --> 00:15:07,839
want to win

444
00:15:07,839 --> 00:15:10,320
and this is an example of an even uh

445
00:15:10,320 --> 00:15:11,199
newer

446
00:15:11,199 --> 00:15:14,079
version of a dga code and it's sampling

447
00:15:14,079 --> 00:15:15,839
also from the distribution of the two

448
00:15:15,839 --> 00:15:17,199
characters so you can see

449
00:15:17,199 --> 00:15:19,680
this cat and mouse game is quite

450
00:15:19,680 --> 00:15:22,000
difficult for solving this issue

451
00:15:22,000 --> 00:15:25,120
and this pretty much got the research

452
00:15:25,120 --> 00:15:26,160
community to understand

453
00:15:26,160 --> 00:15:28,000
that we need something better we need

454
00:15:28,000 --> 00:15:29,279
something smarter we need something

455
00:15:29,279 --> 00:15:30,079
stronger

456
00:15:30,079 --> 00:15:32,160
we need something that would understand

457
00:15:32,160 --> 00:15:33,199
the pattern

458
00:15:33,199 --> 00:15:37,199
and not only the difference in pattern

459
00:15:37,199 --> 00:15:40,160
so this intuition and the fact that we

460
00:15:40,160 --> 00:15:42,000
need something stronger

461
00:15:42,000 --> 00:15:43,519
brought the research community to

462
00:15:43,519 --> 00:15:46,000
understanding that we need deep learning

463
00:15:46,000 --> 00:15:49,199
and specifically deep learning or neural

464
00:15:49,199 --> 00:15:50,959
network model

465
00:15:50,959 --> 00:15:53,680
and the neural network that was used

466
00:15:53,680 --> 00:15:56,000
here is called an lstm

467
00:15:56,000 --> 00:15:58,639
and it's specialty or it's made for

468
00:15:58,639 --> 00:16:00,720
understanding sequences

469
00:16:00,720 --> 00:16:03,759
and we were hoping that

470
00:16:03,759 --> 00:16:06,079
if we input it with enough example

471
00:16:06,079 --> 00:16:07,519
sequences of both

472
00:16:07,519 --> 00:16:10,240
domains are used generated by dgas and

473
00:16:10,240 --> 00:16:12,240
domains that are used in traffic

474
00:16:12,240 --> 00:16:14,079
it would understand the inherent

475
00:16:14,079 --> 00:16:16,079
difference in pattern

476
00:16:16,079 --> 00:16:18,959
between those domains and the benign

477
00:16:18,959 --> 00:16:19,839
domains

478
00:16:19,839 --> 00:16:22,160
and what it essentially means that we're

479
00:16:22,160 --> 00:16:23,839
hoping that the neural network

480
00:16:23,839 --> 00:16:26,160
by seeing a lot of examples would

481
00:16:26,160 --> 00:16:27,839
essentially understand the regular

482
00:16:27,839 --> 00:16:30,160
expression that is describing

483
00:16:30,160 --> 00:16:32,959
these pieces of codes and this is a

484
00:16:32,959 --> 00:16:34,079
really profound

485
00:16:34,079 --> 00:16:36,720
understanding like we went from having a

486
00:16:36,720 --> 00:16:38,800
heuristic and some kind of boundary to

487
00:16:38,800 --> 00:16:40,240
decide between

488
00:16:40,240 --> 00:16:42,160
this question to something that we want

489
00:16:42,160 --> 00:16:45,040
to actually understand the pattern

490
00:16:45,040 --> 00:16:48,480
and this notion was first portrayed by

491
00:16:48,480 --> 00:16:50,800
an academic paper that they shared here

492
00:16:50,800 --> 00:16:53,680
by endgame a company called endgame

493
00:16:53,680 --> 00:16:55,279
and it was really interesting to see

494
00:16:55,279 --> 00:16:57,360
because their idea was

495
00:16:57,360 --> 00:17:00,480
uh quite interesting but one of the

496
00:17:00,480 --> 00:17:01,360
things that we

497
00:17:01,360 --> 00:17:03,920
faced at the time was okay but there's a

498
00:17:03,920 --> 00:17:06,400
bit of a distance between

499
00:17:06,400 --> 00:17:08,640
having this intuitive solution and maybe

500
00:17:08,640 --> 00:17:10,400
writing an academic paper about it

501
00:17:10,400 --> 00:17:14,079
and actually having it in production

502
00:17:14,079 --> 00:17:16,959
running on this massive amount of third

503
00:17:16,959 --> 00:17:17,280
or

504
00:17:17,280 --> 00:17:21,039
third of the with this world traffic so

505
00:17:21,039 --> 00:17:23,839
let's see how we use this intuition and

506
00:17:23,839 --> 00:17:25,679
all the progress that research

507
00:17:25,679 --> 00:17:28,720
uh have done outside of akamai

508
00:17:28,720 --> 00:17:32,320
and took it in so what we did

509
00:17:32,320 --> 00:17:34,400
is that we used this architecture as i

510
00:17:34,400 --> 00:17:36,000
just showed you of the lstm neural

511
00:17:36,000 --> 00:17:37,120
network

512
00:17:37,120 --> 00:17:39,440
and it needs to have a lot of data and a

513
00:17:39,440 --> 00:17:41,440
lot of examples to learn from

514
00:17:41,440 --> 00:17:43,440
so we built a data set and we built a

515
00:17:43,440 --> 00:17:44,640
data set of

516
00:17:44,640 --> 00:17:47,200
1.2 million domains that were created by

517
00:17:47,200 --> 00:17:49,200
dgas and the way that we did that for

518
00:17:49,200 --> 00:17:50,240
example

519
00:17:50,240 --> 00:17:52,400
is by actually taking samples of

520
00:17:52,400 --> 00:17:54,400
malwares that we know have dgas and

521
00:17:54,400 --> 00:17:57,120
using them to create a lot of names and

522
00:17:57,120 --> 00:17:59,039
i gave her another here another example

523
00:17:59,039 --> 00:17:59,520
because

524
00:17:59,520 --> 00:18:01,200
i would encourage you to do something

525
00:18:01,200 --> 00:18:02,640
very similar

526
00:18:02,640 --> 00:18:05,840
is there are open sourced databases that

527
00:18:05,840 --> 00:18:06,799
you can

528
00:18:06,799 --> 00:18:09,919
grab and use for this kind of research

529
00:18:09,919 --> 00:18:12,080
that has a lot of domain names and i and

530
00:18:12,080 --> 00:18:14,799
i give an example to a great one

531
00:18:14,799 --> 00:18:18,160
and on the other hand we want the

532
00:18:18,160 --> 00:18:20,000
network to understand also what is the

533
00:18:20,000 --> 00:18:21,039
pattern that it's trying to

534
00:18:21,039 --> 00:18:22,240
differentiate it from

535
00:18:22,240 --> 00:18:24,400
like we wanted to be able to understand

536
00:18:24,400 --> 00:18:25,760
that this is a dga

537
00:18:25,760 --> 00:18:28,160
but also that this is a benign domain so

538
00:18:28,160 --> 00:18:30,720
we also feed it with 1.2 million benign

539
00:18:30,720 --> 00:18:31,440
domains

540
00:18:31,440 --> 00:18:34,160
now back at akamai what we did was to

541
00:18:34,160 --> 00:18:35,039
just grab

542
00:18:35,039 --> 00:18:37,600
normal traffic and add it to the data

543
00:18:37,600 --> 00:18:38,720
set obviously

544
00:18:38,720 --> 00:18:40,880
not all of you have the access that i

545
00:18:40,880 --> 00:18:42,640
have but

546
00:18:42,640 --> 00:18:45,120
hopefully you all know what is alexa top

547
00:18:45,120 --> 00:18:46,799
1 million domain which is

548
00:18:46,799 --> 00:18:49,600
a list provided providing the top 1

549
00:18:49,600 --> 00:18:51,919
million domain scene used in traffic and

550
00:18:51,919 --> 00:18:55,200
this could be a pretty good data set to

551
00:18:55,200 --> 00:18:57,760
use for the benign examples here

552
00:18:57,760 --> 00:19:00,000
so this is the data set we built we run

553
00:19:00,000 --> 00:19:01,760
the neural network we train it on this

554
00:19:01,760 --> 00:19:02,480
data

555
00:19:02,480 --> 00:19:05,360
and we achieved great accuracy like the

556
00:19:05,360 --> 00:19:06,400
network learned

557
00:19:06,400 --> 00:19:08,160
the difference between dga and benign

558
00:19:08,160 --> 00:19:09,440
domains

559
00:19:09,440 --> 00:19:13,120
but one of the um misfortunate or one of

560
00:19:13,120 --> 00:19:15,120
the shortcomings of the result of

561
00:19:15,120 --> 00:19:17,440
this neural network was that it wasn't

562
00:19:17,440 --> 00:19:19,039
able to classify

563
00:19:19,039 --> 00:19:21,360
which malware family it came from and

564
00:19:21,360 --> 00:19:23,280
now i would like to

565
00:19:23,280 --> 00:19:25,919
stress out why it's important to us as a

566
00:19:25,919 --> 00:19:26,960
defense community

567
00:19:26,960 --> 00:19:28,640
it's not enough to only block it in

568
00:19:28,640 --> 00:19:31,200
traffic i want to be able to provide the

569
00:19:31,200 --> 00:19:32,880
person i blocked it from

570
00:19:32,880 --> 00:19:35,440
with actionable intelligence on what is

571
00:19:35,440 --> 00:19:37,360
the malware that you are infected with

572
00:19:37,360 --> 00:19:39,039
like what is the malware you need to

573
00:19:39,039 --> 00:19:40,080
mitigate

574
00:19:40,080 --> 00:19:42,960
and i was hoping that when i'm using

575
00:19:42,960 --> 00:19:43,440
such

576
00:19:43,440 --> 00:19:45,919
advanced system that understand the

577
00:19:45,919 --> 00:19:47,280
inherent pattern

578
00:19:47,280 --> 00:19:49,919
it would also understand the matter

579
00:19:49,919 --> 00:19:51,440
specifically it's coming from because it

580
00:19:51,440 --> 00:19:53,120
learned a pattern that belongs to this

581
00:19:53,120 --> 00:19:55,120
very specific code

582
00:19:55,120 --> 00:19:57,280
and once we saw this result we were

583
00:19:57,280 --> 00:19:58,799
quite disheartened because

584
00:19:58,799 --> 00:20:01,280
we really wanted to solve this issue and

585
00:20:01,280 --> 00:20:02,640
we are going to solve this issue

586
00:20:02,640 --> 00:20:04,240
together again

587
00:20:04,240 --> 00:20:07,039
but first we needed to understand why is

588
00:20:07,039 --> 00:20:08,960
it such a difficult task for the neural

589
00:20:08,960 --> 00:20:10,559
network

590
00:20:10,559 --> 00:20:12,320
now this is probably the most

591
00:20:12,320 --> 00:20:13,919
mathematical

592
00:20:13,919 --> 00:20:16,480
slide i have in this presentation so

593
00:20:16,480 --> 00:20:18,080
please bear with me

594
00:20:18,080 --> 00:20:21,919
um but i try to get an intuition

595
00:20:21,919 --> 00:20:24,240
of why is it so difficult for the neural

596
00:20:24,240 --> 00:20:25,520
network to understand

597
00:20:25,520 --> 00:20:27,840
which model it's coming from so what i

598
00:20:27,840 --> 00:20:29,919
did is that i visualized

599
00:20:29,919 --> 00:20:31,760
all of the data that i gave the neural

600
00:20:31,760 --> 00:20:34,320
network and i visualized it in a way

601
00:20:34,320 --> 00:20:35,679
that i wanted to see

602
00:20:35,679 --> 00:20:37,919
each and every domain in the data set

603
00:20:37,919 --> 00:20:39,039
where does it fall

604
00:20:39,039 --> 00:20:41,039
in the space that the neural network is

605
00:20:41,039 --> 00:20:42,720
making a decision on

606
00:20:42,720 --> 00:20:44,960
so intuitively if you guys were the

607
00:20:44,960 --> 00:20:46,320
neural network right now

608
00:20:46,320 --> 00:20:49,520
and i would tell you that the um green

609
00:20:49,520 --> 00:20:52,240
cluster here for example is the benign

610
00:20:52,240 --> 00:20:53,120
domains

611
00:20:53,120 --> 00:20:55,360
i think we can all understand i can draw

612
00:20:55,360 --> 00:20:57,039
some kind of circle

613
00:20:57,039 --> 00:20:59,280
that would say okay this is the benign

614
00:20:59,280 --> 00:21:01,760
area and everything else is malicious

615
00:21:01,760 --> 00:21:04,640
so this is why it was so accurate with

616
00:21:04,640 --> 00:21:05,679
understanding if it's

617
00:21:05,679 --> 00:21:08,480
denied it's benign or malicious but this

618
00:21:08,480 --> 00:21:09,600
visualization

619
00:21:09,600 --> 00:21:12,000
also explains why it was so difficult

620
00:21:12,000 --> 00:21:12,880
for the neural

621
00:21:12,880 --> 00:21:14,799
network to divide it between the

622
00:21:14,799 --> 00:21:16,400
different clusters

623
00:21:16,400 --> 00:21:18,880
you can see that some clusters are

624
00:21:18,880 --> 00:21:20,480
already separable and it's really easy

625
00:21:20,480 --> 00:21:21,280
to understand

626
00:21:21,280 --> 00:21:23,679
that this is i don't remember the colors

627
00:21:23,679 --> 00:21:24,799
but this is a

628
00:21:24,799 --> 00:21:26,960
a k dars and this is romney and so on

629
00:21:26,960 --> 00:21:28,400
maybe it's

630
00:21:28,400 --> 00:21:30,799
separable enough but you can see that

631
00:21:30,799 --> 00:21:32,400
some of those clusters are too

632
00:21:32,400 --> 00:21:33,600
intertwined

633
00:21:33,600 --> 00:21:35,120
you can see that for example at the

634
00:21:35,120 --> 00:21:37,360
cluster at the top you have

635
00:21:37,360 --> 00:21:40,720
purple dots and blue dots and red dots

636
00:21:40,720 --> 00:21:44,000
and brown dots and obviously if

637
00:21:44,000 --> 00:21:47,840
i in my human eye can't pass a line

638
00:21:47,840 --> 00:21:50,159
or a circle to differentiate between the

639
00:21:50,159 --> 00:21:51,039
clusters

640
00:21:51,039 --> 00:21:52,559
the neural network couldn't do that

641
00:21:52,559 --> 00:21:54,159
either either

642
00:21:54,159 --> 00:21:56,240
and the intuition behind that is that

643
00:21:56,240 --> 00:21:58,480
it's true they are not separable

644
00:21:58,480 --> 00:22:00,240
by regular expression they are not

645
00:22:00,240 --> 00:22:01,919
separable by pattern

646
00:22:01,919 --> 00:22:05,600
there they are all uh dga domains or dga

647
00:22:05,600 --> 00:22:06,720
code pieces

648
00:22:06,720 --> 00:22:08,960
that generate domain names that follow

649
00:22:08,960 --> 00:22:09,919
the following

650
00:22:09,919 --> 00:22:12,880
pattern random choose a character

651
00:22:12,880 --> 00:22:14,240
between a to z

652
00:22:14,240 --> 00:22:17,039
seven length uh of a domain name so

653
00:22:17,039 --> 00:22:17,600
obviously

654
00:22:17,600 --> 00:22:19,840
they all have the same regular

655
00:22:19,840 --> 00:22:21,120
expression so

656
00:22:21,120 --> 00:22:23,280
i understood that my intuition and using

657
00:22:23,280 --> 00:22:25,360
this neural network actually worked but

658
00:22:25,360 --> 00:22:27,200
this task is just not solvable by a

659
00:22:27,200 --> 00:22:28,720
neural network

660
00:22:28,720 --> 00:22:31,280
but while while viewing this and

661
00:22:31,280 --> 00:22:32,559
understanding that

662
00:22:32,559 --> 00:22:35,520
this is what's happening we saw okay

663
00:22:35,520 --> 00:22:36,960
maybe we need to go for something

664
00:22:36,960 --> 00:22:37,520
simpler

665
00:22:37,520 --> 00:22:39,280
like we have this understanding that

666
00:22:39,280 --> 00:22:41,039
these are all represented by regular

667
00:22:41,039 --> 00:22:42,720
expression by patterns

668
00:22:42,720 --> 00:22:46,400
maybe we can leverage that to using

669
00:22:46,400 --> 00:22:49,600
an aftermath maybe and understanding

670
00:22:49,600 --> 00:22:52,799
which malware it's coming from so after

671
00:22:52,799 --> 00:22:54,400
this whole thought process that we did

672
00:22:54,400 --> 00:22:55,280
together

673
00:22:55,280 --> 00:22:57,840
i'm gonna showcase you the actual system

674
00:22:57,840 --> 00:22:58,799
that we built

675
00:22:58,799 --> 00:23:01,200
that is actually running and protecting

676
00:23:01,200 --> 00:23:03,200
me and you and all of you all over the

677
00:23:03,200 --> 00:23:05,440
internet

678
00:23:05,440 --> 00:23:08,559
so what we did here is that

679
00:23:08,559 --> 00:23:11,679
we took our live system our live dns

680
00:23:11,679 --> 00:23:12,799
traffic

681
00:23:12,799 --> 00:23:15,919
and we divide each user into a very

682
00:23:15,919 --> 00:23:18,000
small specified time window

683
00:23:18,000 --> 00:23:20,960
of dns queries that we see so here for

684
00:23:20,960 --> 00:23:22,559
example you can see

685
00:23:22,559 --> 00:23:26,480
that the user is requiring facebook.com

686
00:23:26,480 --> 00:23:27,120
and maybe

687
00:23:27,120 --> 00:23:29,760
google.com with a typo here and you can

688
00:23:29,760 --> 00:23:31,440
see funny looking domain names that

689
00:23:31,440 --> 00:23:33,600
you and i by now understand that it

690
00:23:33,600 --> 00:23:35,039
looks like a dga right

691
00:23:35,039 --> 00:23:38,640
it looks very weird and what our system

692
00:23:38,640 --> 00:23:40,640
does is that it takes all these domains

693
00:23:40,640 --> 00:23:42,640
that are coming from this time window

694
00:23:42,640 --> 00:23:44,960
which could be both the malware querying

695
00:23:44,960 --> 00:23:47,039
and the user frame because it's using

696
00:23:47,039 --> 00:23:50,000
their computer and we use our neural

697
00:23:50,000 --> 00:23:51,200
network to decide

698
00:23:51,200 --> 00:23:53,200
if this domain name is looking like it's

699
00:23:53,200 --> 00:23:55,120
coming from a dga code

700
00:23:55,120 --> 00:23:56,720
and we asked the neural network a very

701
00:23:56,720 --> 00:23:59,600
simple question is this a dga or not

702
00:23:59,600 --> 00:24:02,320
and it gives us a result between zero

703
00:24:02,320 --> 00:24:04,159
and one where zero represents

704
00:24:04,159 --> 00:24:06,880
next it's not a dga and run represents

705
00:24:06,880 --> 00:24:08,400
yeah this is a dj you

706
00:24:08,400 --> 00:24:10,960
you need to block this so here you can

707
00:24:10,960 --> 00:24:12,320
see for example

708
00:24:12,320 --> 00:24:15,919
and this is real results actually

709
00:24:15,919 --> 00:24:18,720
that on facebook.com the network said

710
00:24:18,720 --> 00:24:19,200
zero

711
00:24:19,200 --> 00:24:21,200
it's not a vga and here you can see on

712
00:24:21,200 --> 00:24:23,120
two other domains it said yeah it looks

713
00:24:23,120 --> 00:24:24,080
like a dj

714
00:24:24,080 --> 00:24:26,480
and for the typo it said no it doesn't

715
00:24:26,480 --> 00:24:28,080
look like a dj

716
00:24:28,080 --> 00:24:29,360
expression it doesn't look like a

717
00:24:29,360 --> 00:24:32,320
pattern so you can see the results here

718
00:24:32,320 --> 00:24:33,360
and then what we do

719
00:24:33,360 --> 00:24:35,760
is that we take all of the domains that

720
00:24:35,760 --> 00:24:36,559
pass this

721
00:24:36,559 --> 00:24:38,400
threshold of understanding okay this is

722
00:24:38,400 --> 00:24:39,760
a dga

723
00:24:39,760 --> 00:24:42,000
and then we try to attribute it to a

724
00:24:42,000 --> 00:24:44,640
specific malware we take it as a group

725
00:24:44,640 --> 00:24:46,559
and we try to fit it to all the regular

726
00:24:46,559 --> 00:24:49,200
expressions that we already understand

727
00:24:49,200 --> 00:24:51,520
that are belonging to this specific dga

728
00:24:51,520 --> 00:24:52,240
code

729
00:24:52,240 --> 00:24:54,080
and this is quite novel like this is

730
00:24:54,080 --> 00:24:55,840
something that i'm not aware that anyone

731
00:24:55,840 --> 00:24:56,400
has

732
00:24:56,400 --> 00:24:59,440
been able to done to do before us but

733
00:24:59,440 --> 00:25:01,520
using the system and using the fact that

734
00:25:01,520 --> 00:25:03,679
we have it coming in from traffic

735
00:25:03,679 --> 00:25:05,840
we were able to attribute so many

736
00:25:05,840 --> 00:25:07,840
detections we are making

737
00:25:07,840 --> 00:25:11,200
and moreover it's so cool because we

738
00:25:11,200 --> 00:25:12,720
were also able to detect

739
00:25:12,720 --> 00:25:15,840
and even group together newly seen

740
00:25:15,840 --> 00:25:18,880
dga domains because what this system

741
00:25:18,880 --> 00:25:20,159
essentially is doing is not only

742
00:25:20,159 --> 00:25:21,760
detecting the fact that it's coming from

743
00:25:21,760 --> 00:25:22,720
a dga

744
00:25:22,720 --> 00:25:24,559
but it's also saying and this is the

745
00:25:24,559 --> 00:25:25,840
shared pattern that all of

746
00:25:25,840 --> 00:25:28,080
these domains share and is it something

747
00:25:28,080 --> 00:25:29,440
that i already know or is it something

748
00:25:29,440 --> 00:25:31,279
that i don't know yet

749
00:25:31,279 --> 00:25:33,200
i'm not sure but i'm gonna tell you in a

750
00:25:33,200 --> 00:25:35,039
second and you can see that in some

751
00:25:35,039 --> 00:25:37,039
cases we were able to attribute

752
00:25:37,039 --> 00:25:40,080
okay this group of domains is 100

753
00:25:40,080 --> 00:25:42,400
fitting for the lockheed pattern so

754
00:25:42,400 --> 00:25:44,400
we're gonna label it as loki

755
00:25:44,400 --> 00:25:46,720
and another case for dire and for the

756
00:25:46,720 --> 00:25:47,600
case that it's an

757
00:25:47,600 --> 00:25:49,440
a regular expression that was never seen

758
00:25:49,440 --> 00:25:51,919
before we're gonna give it a name

759
00:25:51,919 --> 00:25:54,880
unknown number one and this is really

760
00:25:54,880 --> 00:25:55,840
cool because

761
00:25:55,840 --> 00:25:58,159
this way we can track this newly

762
00:25:58,159 --> 00:25:59,279
detected

763
00:25:59,279 --> 00:26:02,480
malware over time and at one point in

764
00:26:02,480 --> 00:26:03,120
time when

765
00:26:03,120 --> 00:26:04,960
you or every other researcher is going

766
00:26:04,960 --> 00:26:07,520
to share your blog and share with us

767
00:26:07,520 --> 00:26:08,799
some new

768
00:26:08,799 --> 00:26:10,960
newly detected malwares we can attribute

769
00:26:10,960 --> 00:26:12,720
it and give the story of this malware

770
00:26:12,720 --> 00:26:13,760
over time because

771
00:26:13,760 --> 00:26:17,360
we already detected it now if there is a

772
00:26:17,360 --> 00:26:18,960
question now and i hope some of you

773
00:26:18,960 --> 00:26:19,440
might

774
00:26:19,440 --> 00:26:21,840
think it is okay but why can't you

775
00:26:21,840 --> 00:26:23,520
attribute it or give it a name or why

776
00:26:23,520 --> 00:26:25,440
don't you research it yourself

777
00:26:25,440 --> 00:26:28,240
you need to remember that as akamai and

778
00:26:28,240 --> 00:26:28,640
this

779
00:26:28,640 --> 00:26:30,960
standpoint that i'm standing in i don't

780
00:26:30,960 --> 00:26:33,279
have access to the end point

781
00:26:33,279 --> 00:26:35,919
in many cases all i see is the network

782
00:26:35,919 --> 00:26:36,799
and i

783
00:26:36,799 --> 00:26:39,679
maybe control and own the network but i

784
00:26:39,679 --> 00:26:41,760
can never go to the specific computer

785
00:26:41,760 --> 00:26:42,480
and then

786
00:26:42,480 --> 00:26:44,240
grab the process that is generating

787
00:26:44,240 --> 00:26:46,080
these queries and then research it

788
00:26:46,080 --> 00:26:48,880
and then give you guys this whole new

789
00:26:48,880 --> 00:26:50,400
listen this is the new

790
00:26:50,400 --> 00:26:53,360
testament or whatever but as you

791
00:26:53,360 --> 00:26:54,080
understand

792
00:26:54,080 --> 00:26:56,240
from a network point of view it's going

793
00:26:56,240 --> 00:26:58,559
to be called unknown until one of your

794
00:26:58,559 --> 00:27:00,880
reversers or endpoint security

795
00:27:00,880 --> 00:27:01,840
researchers

796
00:27:01,840 --> 00:27:03,440
is going to tell me what is the name of

797
00:27:03,440 --> 00:27:05,360
this malware

798
00:27:05,360 --> 00:27:08,640
so this is an actual system that we have

799
00:27:08,640 --> 00:27:11,200
um predicting on actual traffic and

800
00:27:11,200 --> 00:27:13,279
blocking it on real time

801
00:27:13,279 --> 00:27:16,240
and um i want to share with you actual

802
00:27:16,240 --> 00:27:17,679
results now this is running in our

803
00:27:17,679 --> 00:27:19,039
systems for

804
00:27:19,039 --> 00:27:22,640
i think maybe about a year

805
00:27:22,640 --> 00:27:26,000
so the result in the wild is that

806
00:27:26,000 --> 00:27:29,279
we detect and we block daily

807
00:27:29,279 --> 00:27:33,520
about 2.5 million domains which is huge

808
00:27:33,520 --> 00:27:36,399
and because of that we block about 70

809
00:27:36,399 --> 00:27:36,880
million

810
00:27:36,880 --> 00:27:40,399
dns requests a day by this system alone

811
00:27:40,399 --> 00:27:44,000
and this specific number is subtracting

812
00:27:44,000 --> 00:27:45,440
my robot which we're going to see in a

813
00:27:45,440 --> 00:27:47,039
second because you'll understand that my

814
00:27:47,039 --> 00:27:48,080
robot is

815
00:27:48,080 --> 00:27:51,520
going to skew these numbers way to

816
00:27:51,520 --> 00:27:54,799
the other end of the scale

817
00:27:55,200 --> 00:27:58,320
now the system has a very low false

818
00:27:58,320 --> 00:27:59,360
positive rate

819
00:27:59,360 --> 00:28:01,840
and the reason is is not because the

820
00:28:01,840 --> 00:28:03,440
patterns in the system is so good is

821
00:28:03,440 --> 00:28:05,200
because also as part of putting the

822
00:28:05,200 --> 00:28:06,799
system in production

823
00:28:06,799 --> 00:28:08,880
is adding a lot of understanding of how

824
00:28:08,880 --> 00:28:11,120
we need to enforce this and how we need

825
00:28:11,120 --> 00:28:12,480
to filter this so we have a lot of

826
00:28:12,480 --> 00:28:14,399
algorithms that i didn't go in

827
00:28:14,399 --> 00:28:16,480
that we do to make sure that we have no

828
00:28:16,480 --> 00:28:17,760
mistakes but

829
00:28:17,760 --> 00:28:20,720
to make sure and also to rest assure you

830
00:28:20,720 --> 00:28:21,840
i will not

831
00:28:21,840 --> 00:28:23,679
have any intention of blocking anything

832
00:28:23,679 --> 00:28:25,440
that wouldn't affect you badly so it's

833
00:28:25,440 --> 00:28:26,799
really important for me

834
00:28:26,799 --> 00:28:28,320
to have zero false positives because

835
00:28:28,320 --> 00:28:30,720
otherwise i would block something that

836
00:28:30,720 --> 00:28:32,320
you all use

837
00:28:32,320 --> 00:28:35,600
and lastly as i showcased we have a lot

838
00:28:35,600 --> 00:28:37,440
of unknown groups that we track over

839
00:28:37,440 --> 00:28:38,399
time

840
00:28:38,399 --> 00:28:41,039
and it may be a zero day it may be an

841
00:28:41,039 --> 00:28:42,320
hour that nobody

842
00:28:42,320 --> 00:28:44,799
reported on yet but for our point of

843
00:28:44,799 --> 00:28:46,159
view we are certain

844
00:28:46,159 --> 00:28:47,760
that this is a process that is using

845
00:28:47,760 --> 00:28:49,600
using dga code

846
00:28:49,600 --> 00:28:51,600
and its art has to attribute it to

847
00:28:51,600 --> 00:28:53,520
understand is it a malware

848
00:28:53,520 --> 00:28:56,880
is it maybe a vision maybe a vpn using

849
00:28:56,880 --> 00:28:58,640
this evasion technique and so on

850
00:28:58,640 --> 00:29:00,640
but we are definitely tracking all of

851
00:29:00,640 --> 00:29:02,000
these to understand

852
00:29:02,000 --> 00:29:05,520
their activity and now we're gonna

853
00:29:05,520 --> 00:29:08,720
uh dive into my level so um

854
00:29:08,720 --> 00:29:10,320
i hope that so far you understood our

855
00:29:10,320 --> 00:29:11,760
system and we're doing and

856
00:29:11,760 --> 00:29:12,880
one of those really interesting

857
00:29:12,880 --> 00:29:14,960
detection is called milo button as i

858
00:29:14,960 --> 00:29:15,360
showed

859
00:29:15,360 --> 00:29:17,559
there was some blogging about it back in

860
00:29:17,559 --> 00:29:19,600
2018

861
00:29:19,600 --> 00:29:22,799
and based on these blogs i wanted to

862
00:29:22,799 --> 00:29:26,159
go over how they reported it as using so

863
00:29:26,159 --> 00:29:28,799
i can explain what we saw in traffic so

864
00:29:28,799 --> 00:29:30,240
this is based on the report

865
00:29:30,240 --> 00:29:33,360
done by deep instinct and centurylink

866
00:29:33,360 --> 00:29:36,000
and the first stage of uh my robot

867
00:29:36,000 --> 00:29:36,720
action

868
00:29:36,720 --> 00:29:40,000
or a traffic communication pattern

869
00:29:40,000 --> 00:29:42,159
is that the client the malware is

870
00:29:42,159 --> 00:29:44,799
querying a regular dns query and i think

871
00:29:44,799 --> 00:29:46,640
that by now you should you should all

872
00:29:46,640 --> 00:29:48,480
have this like red flag and saying okay

873
00:29:48,480 --> 00:29:50,799
dns this is probably your expertise so

874
00:29:50,799 --> 00:29:52,640
you're in the right direction and the

875
00:29:52,640 --> 00:29:54,720
dns is replying with an ip that the

876
00:29:54,720 --> 00:29:56,640
client needs to query next

877
00:29:56,640 --> 00:29:58,880
then the client queries this ip and he's

878
00:29:58,880 --> 00:30:00,880
asking where do i go next

879
00:30:00,880 --> 00:30:03,919
now this ip is already the attacker's id

880
00:30:03,919 --> 00:30:05,679
and they're just serving them with the

881
00:30:05,679 --> 00:30:07,039
next server you need to go

882
00:30:07,039 --> 00:30:09,840
in order to download a second stage

883
00:30:09,840 --> 00:30:10,960
malware

884
00:30:10,960 --> 00:30:13,440
so then the client goes to this very

885
00:30:13,440 --> 00:30:14,720
specific

886
00:30:14,720 --> 00:30:17,919
iep and server that the former server

887
00:30:17,919 --> 00:30:18,960
served them

888
00:30:18,960 --> 00:30:20,880
and they're getting in return a new type

889
00:30:20,880 --> 00:30:22,000
of malware and for

890
00:30:22,000 --> 00:30:25,440
the last stage it's unknown activity for

891
00:30:25,440 --> 00:30:27,600
my end because i'm not sure which memory

892
00:30:27,600 --> 00:30:27,840
they

893
00:30:27,840 --> 00:30:30,240
do they're they're downloading for the

894
00:30:30,240 --> 00:30:31,279
reported cases

895
00:30:31,279 --> 00:30:33,760
so far they have used a second stage

896
00:30:33,760 --> 00:30:35,279
model called khaleesi

897
00:30:35,279 --> 00:30:37,039
but obviously we all understand it can

898
00:30:37,039 --> 00:30:39,760
change because this is a classic

899
00:30:39,760 --> 00:30:42,960
uh downloader scheme but what's not

900
00:30:42,960 --> 00:30:45,360
classic about it is the first stage

901
00:30:45,360 --> 00:30:47,039
and this really funny looking domain

902
00:30:47,039 --> 00:30:48,720
name and this is what we're going to

903
00:30:48,720 --> 00:30:50,559
focus about and what the system is going

904
00:30:50,559 --> 00:30:52,000
to detect

905
00:30:52,000 --> 00:30:54,960
so what did we detect in traffic all of

906
00:30:54,960 --> 00:30:57,279
your smoking guns pointed correctly

907
00:30:57,279 --> 00:30:58,960
we detected this very funny looking

908
00:30:58,960 --> 00:31:00,960
domain name because it looked like it's

909
00:31:00,960 --> 00:31:03,360
coming from a pattern that is

910
00:31:03,360 --> 00:31:06,799
a dga domain uh generated and we get we

911
00:31:06,799 --> 00:31:07,679
detected about

912
00:31:07,679 --> 00:31:10,799
1400 domains that are coming from this

913
00:31:10,799 --> 00:31:11,919
operation

914
00:31:11,919 --> 00:31:13,760
and the specific pattern that we

915
00:31:13,760 --> 00:31:16,399
understood coming from traffic is this

916
00:31:16,399 --> 00:31:18,159
pattern written right here

917
00:31:18,159 --> 00:31:20,640
it's the prefix letter m and then a

918
00:31:20,640 --> 00:31:21,440
number between

919
00:31:21,440 --> 00:31:24,799
0 and 43 and then for this is for the

920
00:31:24,799 --> 00:31:27,120
sub domain and then for the domain part

921
00:31:27,120 --> 00:31:29,600
it's a domain generated by a dga a very

922
00:31:29,600 --> 00:31:31,519
specific regular expression

923
00:31:31,519 --> 00:31:34,799
and then one of those tlts now this is

924
00:31:34,799 --> 00:31:37,600
exactly as reported by centurylink in

925
00:31:37,600 --> 00:31:38,559
their blog

926
00:31:38,559 --> 00:31:42,080
about a year and a half ago but wait is

927
00:31:42,080 --> 00:31:44,559
it everything that we detected

928
00:31:44,559 --> 00:31:47,919
no we actually detected much more than

929
00:31:47,919 --> 00:31:48,559
that

930
00:31:48,559 --> 00:31:50,480
but we understood that this is my robot

931
00:31:50,480 --> 00:31:52,799
because we saw the blogging on

932
00:31:52,799 --> 00:31:54,480
some of the detections that our system

933
00:31:54,480 --> 00:31:56,080
made now

934
00:31:56,080 --> 00:31:58,159
what we actually saw and the system

935
00:31:58,159 --> 00:31:59,200
alerted us

936
00:31:59,200 --> 00:32:01,600
on is actually what we understand to be

937
00:32:01,600 --> 00:32:03,519
four different variants

938
00:32:03,519 --> 00:32:05,679
of these specific botnets and we

939
00:32:05,679 --> 00:32:08,480
actually detected about 8 000 domains

940
00:32:08,480 --> 00:32:10,880
that are all looking for a very similar

941
00:32:10,880 --> 00:32:11,760
pattern

942
00:32:11,760 --> 00:32:13,600
and i gave the example of the patterns

943
00:32:13,600 --> 00:32:15,679
here so you can see the variant number

944
00:32:15,679 --> 00:32:16,159
one

945
00:32:16,159 --> 00:32:18,159
we call it the m variant because it's

946
00:32:18,159 --> 00:32:19,840
the prefix m

947
00:32:19,840 --> 00:32:21,840
then for the second variant it looks

948
00:32:21,840 --> 00:32:22,880
exactly the same

949
00:32:22,880 --> 00:32:24,799
like the m variant but the prefix is the

950
00:32:24,799 --> 00:32:28,159
letter x so we call it the x variant

951
00:32:28,159 --> 00:32:29,919
then for the third variant we saw

952
00:32:29,919 --> 00:32:31,279
something a bit different than

953
00:32:31,279 --> 00:32:31,919
interesting

954
00:32:31,919 --> 00:32:34,000
because it starts with the prefix and

955
00:32:34,000 --> 00:32:35,120
the word

956
00:32:35,120 --> 00:32:38,480
green and then the numbers which is a

957
00:32:38,480 --> 00:32:40,559
bit different but we call it the variant

958
00:32:40,559 --> 00:32:41,600
green

959
00:32:41,600 --> 00:32:44,240
and lastly we saw a variant that is

960
00:32:44,240 --> 00:32:45,519
prefixed with the

961
00:32:45,519 --> 00:32:48,799
letter v and the number one we didn't

962
00:32:48,799 --> 00:32:49,200
see

963
00:32:49,200 --> 00:32:51,360
any of the other numbers zero between 43

964
00:32:51,360 --> 00:32:52,640
like the others

965
00:32:52,640 --> 00:32:55,760
and what's interesting here is that

966
00:32:55,760 --> 00:32:58,000
once you understand my system and you do

967
00:32:58,000 --> 00:33:00,320
you understand that all of these queries

968
00:33:00,320 --> 00:33:03,519
came somewhat together and my system

969
00:33:03,519 --> 00:33:05,039
decided that they are all fitting the

970
00:33:05,039 --> 00:33:07,200
same pattern and this is why i'm going

971
00:33:07,200 --> 00:33:07,600
to

972
00:33:07,600 --> 00:33:09,519
attribute all of them in the name

973
00:33:09,519 --> 00:33:10,880
unknown number

974
00:33:10,880 --> 00:33:14,240
56 i don't know what number it was but

975
00:33:14,240 --> 00:33:16,559
once i saw that and i saw the blocking i

976
00:33:16,559 --> 00:33:18,240
thought okay i need to understand this

977
00:33:18,240 --> 00:33:19,279
more like

978
00:33:19,279 --> 00:33:22,000
is my system making a mistake are they

979
00:33:22,000 --> 00:33:23,039
really connected

980
00:33:23,039 --> 00:33:25,760
like is it the same malware like am i

981
00:33:25,760 --> 00:33:26,799
sure that this is

982
00:33:26,799 --> 00:33:29,600
the correct detection or is it a mistake

983
00:33:29,600 --> 00:33:31,919
by design

984
00:33:31,919 --> 00:33:33,519
so what we did at the time and this was

985
00:33:33,519 --> 00:33:36,480
the beginning of june 2019

986
00:33:36,480 --> 00:33:38,799
is that we decided to take the domain

987
00:33:38,799 --> 00:33:40,640
names that we saw that are actually

988
00:33:40,640 --> 00:33:42,240
resolving in traffic

989
00:33:42,240 --> 00:33:44,240
meaning domain names that the attackers

990
00:33:44,240 --> 00:33:45,919
actually registered and used for

991
00:33:45,919 --> 00:33:48,880
communication for commanded control

992
00:33:48,880 --> 00:33:51,200
and we wanted to see if there is any

993
00:33:51,200 --> 00:33:52,159
connection

994
00:33:52,159 --> 00:33:55,279
between the variants and again i may i

995
00:33:55,279 --> 00:33:58,159
remind you that i don't have any access

996
00:33:58,159 --> 00:34:00,720
to the end point so all i can do is the

997
00:34:00,720 --> 00:34:01,679
network research

998
00:34:01,679 --> 00:34:04,559
and everything from the outside so this

999
00:34:04,559 --> 00:34:06,320
specifically screen what you're seeing

1000
00:34:06,320 --> 00:34:09,440
here is a map that we created using

1001
00:34:09,440 --> 00:34:11,599
virus total graph

1002
00:34:11,599 --> 00:34:13,679
and every time you see a blue globe on

1003
00:34:13,679 --> 00:34:14,719
this map

1004
00:34:14,719 --> 00:34:16,560
it means that the entity we're looking

1005
00:34:16,560 --> 00:34:18,480
at is a domain or a subdomain

1006
00:34:18,480 --> 00:34:20,239
and every time you see a flag in this

1007
00:34:20,239 --> 00:34:22,639
graph it means that it's an ip

1008
00:34:22,639 --> 00:34:24,879
and the flag represents the autonomous

1009
00:34:24,879 --> 00:34:26,159
system it's coming from

1010
00:34:26,159 --> 00:34:28,560
originating from and what we saw here

1011
00:34:28,560 --> 00:34:29,440
was really cool

1012
00:34:29,440 --> 00:34:31,760
you can see here on the left two domain

1013
00:34:31,760 --> 00:34:33,520
names that were resolving for the

1014
00:34:33,520 --> 00:34:36,079
m variant and i also added the sub

1015
00:34:36,079 --> 00:34:37,199
domains here

1016
00:34:37,199 --> 00:34:39,520
so you can see that uh the pattern that

1017
00:34:39,520 --> 00:34:41,440
i'm importing is is true and you can see

1018
00:34:41,440 --> 00:34:43,359
a lot of queries that are reported by

1019
00:34:43,359 --> 00:34:45,599
aristotle to this specific pattern

1020
00:34:45,599 --> 00:34:47,839
and you can see a lot of ips that they

1021
00:34:47,839 --> 00:34:49,280
are resolving to

1022
00:34:49,280 --> 00:34:51,760
but what was interesting in this case is

1023
00:34:51,760 --> 00:34:53,440
that here on the right

1024
00:34:53,440 --> 00:34:55,440
you see the domain that was was rolling

1025
00:34:55,440 --> 00:34:57,520
at the time for the x variant

1026
00:34:57,520 --> 00:34:59,520
and you can see that they're resolving

1027
00:34:59,520 --> 00:35:01,359
to the same eyepiece

1028
00:35:01,359 --> 00:35:03,520
and in this case we're thinking okay so

1029
00:35:03,520 --> 00:35:05,119
they have to be connected like

1030
00:35:05,119 --> 00:35:06,480
they're forming the commander control

1031
00:35:06,480 --> 00:35:08,079
communication with the same ip

1032
00:35:08,079 --> 00:35:10,240
infrastructure

1033
00:35:10,240 --> 00:35:12,079
another interesting thing that we saw

1034
00:35:12,079 --> 00:35:13,839
again back at the time

1035
00:35:13,839 --> 00:35:15,760
was this portuguese flag or this

1036
00:35:15,760 --> 00:35:17,280
portuguese ip

1037
00:35:17,280 --> 00:35:20,160
when we tried to research further and

1038
00:35:20,160 --> 00:35:22,000
understand what's standing behind the

1039
00:35:22,000 --> 00:35:24,320
ideas and in the hopes of understanding

1040
00:35:24,320 --> 00:35:25,599
the attacker

1041
00:35:25,599 --> 00:35:29,280
we realized that this might be a company

1042
00:35:29,280 --> 00:35:30,000
cyber security

1043
00:35:30,000 --> 00:35:33,200
vendor that is trying to sinkhole this

1044
00:35:33,200 --> 00:35:34,960
and this makes a lot of sense right

1045
00:35:34,960 --> 00:35:37,040
because as i said back at the end of

1046
00:35:37,040 --> 00:35:39,760
2018 they were blogging about under

1047
00:35:39,760 --> 00:35:40,480
finding this

1048
00:35:40,480 --> 00:35:43,359
m variant so it makes a lot of sense

1049
00:35:43,359 --> 00:35:43,680
that

1050
00:35:43,680 --> 00:35:45,760
the m-variant domains are resolving to

1051
00:35:45,760 --> 00:35:47,359
their specific ip

1052
00:35:47,359 --> 00:35:49,839
but as you can see as we understand it

1053
00:35:49,839 --> 00:35:51,920
the sinkholing efforts didn't work quite

1054
00:35:51,920 --> 00:35:52,800
well because

1055
00:35:52,800 --> 00:35:54,960
the malware is still managing to create

1056
00:35:54,960 --> 00:35:55,839
the command

1057
00:35:55,839 --> 00:35:58,880
communication channel through other ips

1058
00:35:58,880 --> 00:36:02,400
and i think that

1059
00:36:02,400 --> 00:36:05,200
it means that maybe this operation of

1060
00:36:05,200 --> 00:36:06,320
the environment

1061
00:36:06,320 --> 00:36:09,040
even continued further but then we want

1062
00:36:09,040 --> 00:36:10,800
we went even further we understood that

1063
00:36:10,800 --> 00:36:12,560
there is connection between m and the x

1064
00:36:12,560 --> 00:36:13,200
variant

1065
00:36:13,200 --> 00:36:16,240
what about the other variants and again

1066
00:36:16,240 --> 00:36:18,000
we saw the same thing happening for the

1067
00:36:18,000 --> 00:36:19,440
green variant and the

1068
00:36:19,440 --> 00:36:22,079
uh and the m variant again they are

1069
00:36:22,079 --> 00:36:24,000
resolving to the same ip

1070
00:36:24,000 --> 00:36:26,000
and they're also resolving to other ips

1071
00:36:26,000 --> 00:36:28,079
but you can see the connection here

1072
00:36:28,079 --> 00:36:29,599
but another thing that was interesting

1073
00:36:29,599 --> 00:36:31,920
here is this variant that we saw that

1074
00:36:31,920 --> 00:36:33,440
looked a little bit different

1075
00:36:33,440 --> 00:36:36,000
but again my system decided they're all

1076
00:36:36,000 --> 00:36:36,960
grouped together

1077
00:36:36,960 --> 00:36:39,920
that is called the v1 variant and there

1078
00:36:39,920 --> 00:36:43,599
was 671 domains that were all resolving

1079
00:36:43,599 --> 00:36:45,680
to again our favorite sinkholing effort

1080
00:36:45,680 --> 00:36:46,000
the

1081
00:36:46,000 --> 00:36:49,440
portuguese ib and from what we

1082
00:36:49,440 --> 00:36:51,520
understand then our working theory is is

1083
00:36:51,520 --> 00:36:52,480
that the viva

1084
00:36:52,480 --> 00:36:54,800
v1 variant is actually the earliest

1085
00:36:54,800 --> 00:36:55,839
variant

1086
00:36:55,839 --> 00:36:58,880
of this botnet and was maybe some kind

1087
00:36:58,880 --> 00:37:01,119
of toy variant and this was already

1088
00:37:01,119 --> 00:37:03,040
successfully sinkholed

1089
00:37:03,040 --> 00:37:06,160
in the past by this company

1090
00:37:06,160 --> 00:37:08,560
but you can see that the other two

1091
00:37:08,560 --> 00:37:10,320
variants are still much

1092
00:37:10,320 --> 00:37:13,440
working and managing to communicate

1093
00:37:13,440 --> 00:37:16,400
now coming for this presentation i

1094
00:37:16,400 --> 00:37:18,320
wanted to give an update and i wanted to

1095
00:37:18,320 --> 00:37:18,880
see

1096
00:37:18,880 --> 00:37:21,359
how does it look in traffic and as i

1097
00:37:21,359 --> 00:37:22,800
mentioned my system is

1098
00:37:22,800 --> 00:37:24,800
fully automatic if there are new domains

1099
00:37:24,800 --> 00:37:26,000
it's detecting it

1100
00:37:26,000 --> 00:37:28,160
and it's adding it to the pattern and

1101
00:37:28,160 --> 00:37:30,079
calling it milobot in the appropriate

1102
00:37:30,079 --> 00:37:31,040
group so

1103
00:37:31,040 --> 00:37:33,040
i just needed to do this kind of

1104
00:37:33,040 --> 00:37:35,359
analysis again

1105
00:37:35,359 --> 00:37:37,200
and this is the map that i pulled i

1106
00:37:37,200 --> 00:37:39,280
think maybe a few weeks ago specifically

1107
00:37:39,280 --> 00:37:41,119
for this presentation

1108
00:37:41,119 --> 00:37:44,400
2020 of my robot infrastructure and wow

1109
00:37:44,400 --> 00:37:46,240
first of all you can see the shot the

1110
00:37:46,240 --> 00:37:48,160
size change and how large it is now

1111
00:37:48,160 --> 00:37:48,880
because

1112
00:37:48,880 --> 00:37:51,560
i think maybe it indicates how

1113
00:37:51,560 --> 00:37:52,720
enthusiastic

1114
00:37:52,720 --> 00:37:55,119
milobot attackers are right now because

1115
00:37:55,119 --> 00:37:55,760
you can see

1116
00:37:55,760 --> 00:37:57,839
a lot more resolving domains and a lot

1117
00:37:57,839 --> 00:37:59,839
more ips and a lot of things going on

1118
00:37:59,839 --> 00:38:00,880
here

1119
00:38:00,880 --> 00:38:03,760
so what you can see here again 2020

1120
00:38:03,760 --> 00:38:05,520
there are new resolving domains

1121
00:38:05,520 --> 00:38:07,760
and the operation is still much in the

1122
00:38:07,760 --> 00:38:09,680
works and you can see the connection

1123
00:38:09,680 --> 00:38:11,520
between the two variants again with a

1124
00:38:11,520 --> 00:38:13,359
lot of resolving eyepiece

1125
00:38:13,359 --> 00:38:16,480
you can again see the portuguese company

1126
00:38:16,480 --> 00:38:18,079
trying to sinkhole this but i'm not sure

1127
00:38:18,079 --> 00:38:20,320
that it's that successfully

1128
00:38:20,320 --> 00:38:22,800
but another interesting thing that we

1129
00:38:22,800 --> 00:38:24,480
decided to do for this analysis this

1130
00:38:24,480 --> 00:38:24,880
time

1131
00:38:24,880 --> 00:38:27,119
is okay we wanted to see if we can find

1132
00:38:27,119 --> 00:38:29,760
the communicating malicious file

1133
00:38:29,760 --> 00:38:32,960
so what we did here is that we saw a lot

1134
00:38:32,960 --> 00:38:33,200
of

1135
00:38:33,200 --> 00:38:34,720
files that are communicating to these

1136
00:38:34,720 --> 00:38:36,240
eyepiece and you can see that there's a

1137
00:38:36,240 --> 00:38:36,720
lot of

1138
00:38:36,720 --> 00:38:38,400
shared communication between all of

1139
00:38:38,400 --> 00:38:39,760
these ips

1140
00:38:39,760 --> 00:38:42,800
for these files which is the m variant

1141
00:38:42,800 --> 00:38:44,880
but there are two interesting cases here

1142
00:38:44,880 --> 00:38:47,040
you can see at the top that there are

1143
00:38:47,040 --> 00:38:49,119
two files here that are communicating to

1144
00:38:49,119 --> 00:38:49,359
an

1145
00:38:49,359 --> 00:38:51,359
ip from the end variant and the ip from

1146
00:38:51,359 --> 00:38:52,720
the x variant

1147
00:38:52,720 --> 00:38:54,640
although those ips are completely

1148
00:38:54,640 --> 00:38:56,240
different and not shared

1149
00:38:56,240 --> 00:38:59,440
so maybe this is representing to

1150
00:38:59,440 --> 00:39:02,480
a file that is the same malware but

1151
00:39:02,480 --> 00:39:04,079
with different configuration it's

1152
00:39:04,079 --> 00:39:05,920
running either the x variant or the m

1153
00:39:05,920 --> 00:39:06,880
variant

1154
00:39:06,880 --> 00:39:08,480
and for the same case you can see here

1155
00:39:08,480 --> 00:39:10,480
the bottom of the map another two files

1156
00:39:10,480 --> 00:39:12,640
that you can see communicating to an ip

1157
00:39:12,640 --> 00:39:14,320
for the x variant and for the m variants

1158
00:39:14,320 --> 00:39:15,760
that are not shared

1159
00:39:15,760 --> 00:39:18,800
so we are feeling pretty confident with

1160
00:39:18,800 --> 00:39:20,240
the connection between

1161
00:39:20,240 --> 00:39:21,920
all of these different malwares

1162
00:39:21,920 --> 00:39:23,520
especially because our system made the

1163
00:39:23,520 --> 00:39:24,480
connection but

1164
00:39:24,480 --> 00:39:26,160
it was really cool to see it from the

1165
00:39:26,160 --> 00:39:27,760
network perspective that

1166
00:39:27,760 --> 00:39:29,760
wow this is really interesting and

1167
00:39:29,760 --> 00:39:31,359
increasing issue

1168
00:39:31,359 --> 00:39:32,880
and then i wanted to look how it looks

1169
00:39:32,880 --> 00:39:34,640
in traffic

1170
00:39:34,640 --> 00:39:37,920
so i wanted to give you um some

1171
00:39:37,920 --> 00:39:39,520
intuition and understanding of how

1172
00:39:39,520 --> 00:39:42,800
things look when you own such a huge dns

1173
00:39:42,800 --> 00:39:45,440
empire and here what you can see in this

1174
00:39:45,440 --> 00:39:45,920
graph

1175
00:39:45,920 --> 00:39:47,440
is that you can see the amount of

1176
00:39:47,440 --> 00:39:49,119
queries done

1177
00:39:49,119 --> 00:39:52,480
over a network to milobot cmc domains

1178
00:39:52,480 --> 00:39:54,960
over time and just to make sure that you

1179
00:39:54,960 --> 00:39:56,000
are all noticing this

1180
00:39:56,000 --> 00:39:59,280
correctly the y scale here is in

1181
00:39:59,280 --> 00:40:02,720
billion requests a day it means that at

1182
00:40:02,720 --> 00:40:04,480
the lowest point that we are at right

1183
00:40:04,480 --> 00:40:05,280
now

1184
00:40:05,280 --> 00:40:09,280
there are 0.2 billion dns requests a day

1185
00:40:09,280 --> 00:40:13,280
made to my lobotomy which is 200 million

1186
00:40:13,280 --> 00:40:17,200
and for comparison i wrote the amount of

1187
00:40:17,200 --> 00:40:19,920
queries that we see daily to other

1188
00:40:19,920 --> 00:40:20,400
really

1189
00:40:20,400 --> 00:40:22,839
well-known and prominent botnets in our

1190
00:40:22,839 --> 00:40:24,160
traffic so

1191
00:40:24,160 --> 00:40:27,839
pike spa is the next um best

1192
00:40:27,839 --> 00:40:29,520
i don't know if they call it best but

1193
00:40:29,520 --> 00:40:31,359
it's the next most prominent botnet on

1194
00:40:31,359 --> 00:40:32,160
our network

1195
00:40:32,160 --> 00:40:34,880
and we see about 1 million dns requests

1196
00:40:34,880 --> 00:40:35,760
a day

1197
00:40:35,760 --> 00:40:37,760
and then for q snatch we also see about

1198
00:40:37,760 --> 00:40:39,359
one million requests a day

1199
00:40:39,359 --> 00:40:41,280
for imitate half a million and so on so

1200
00:40:41,280 --> 00:40:42,640
you understand that this is

1201
00:40:42,640 --> 00:40:46,240
200 times more traffic than we see from

1202
00:40:46,240 --> 00:40:47,920
every other button so this is a really

1203
00:40:47,920 --> 00:40:50,319
noisy botnet

1204
00:40:50,319 --> 00:40:51,920
and then we wanted to try understand

1205
00:40:51,920 --> 00:40:54,079
okay so how many infected users are

1206
00:40:54,079 --> 00:40:54,400
there

1207
00:40:54,400 --> 00:40:56,560
in the world with botnet and this is

1208
00:40:56,560 --> 00:40:58,000
only coming from understanding the

1209
00:40:58,000 --> 00:40:59,599
traffic patterns

1210
00:40:59,599 --> 00:41:02,400
now what you see here is the amount of

1211
00:41:02,400 --> 00:41:04,160
entities that we see

1212
00:41:04,160 --> 00:41:07,440
communicating to my robot cncs over time

1213
00:41:07,440 --> 00:41:09,760
now i would like to point out that when

1214
00:41:09,760 --> 00:41:11,440
i'm saying entities

1215
00:41:11,440 --> 00:41:14,160
i'm it could be either a single user and

1216
00:41:14,160 --> 00:41:15,920
their whole computer but it could also

1217
00:41:15,920 --> 00:41:17,680
be an app it could also be

1218
00:41:17,680 --> 00:41:19,359
some kind of enterprise or corporate

1219
00:41:19,359 --> 00:41:21,520
gateway which means that a single

1220
00:41:21,520 --> 00:41:23,760
entity from my point of view could

1221
00:41:23,760 --> 00:41:24,720
represent

1222
00:41:24,720 --> 00:41:27,280
tens of thousands of computers so this

1223
00:41:27,280 --> 00:41:28,800
graph could actually be

1224
00:41:28,800 --> 00:41:31,599
much higher and this phenomena could be

1225
00:41:31,599 --> 00:41:32,880
much prominent that we actually

1226
00:41:32,880 --> 00:41:34,160
understand it

1227
00:41:34,160 --> 00:41:37,200
and even though we are masking some kind

1228
00:41:37,200 --> 00:41:38,880
of the user that we're seeing

1229
00:41:38,880 --> 00:41:41,200
you can still see that back at the end

1230
00:41:41,200 --> 00:41:42,800
of 2019

1231
00:41:42,800 --> 00:41:45,839
we had about 3 000 or 4 000 infected

1232
00:41:45,839 --> 00:41:46,720
entities

1233
00:41:46,720 --> 00:41:48,720
and to our understanding currently what

1234
00:41:48,720 --> 00:41:49,920
we're seeing is

1235
00:41:49,920 --> 00:41:51,440
between seven thousand and eight

1236
00:41:51,440 --> 00:41:53,599
thousand in fact user between

1237
00:41:53,599 --> 00:41:57,040
milobot managed to double their infected

1238
00:41:57,040 --> 00:41:57,839
users

1239
00:41:57,839 --> 00:42:01,359
over the course of this almost last year

1240
00:42:01,359 --> 00:42:05,040
so even circling back to the question

1241
00:42:05,040 --> 00:42:06,960
that i was asked for the warm-up

1242
00:42:06,960 --> 00:42:10,160
here you can see the evolution of this

1243
00:42:10,160 --> 00:42:10,800
botnet

1244
00:42:10,800 --> 00:42:14,839
and how fast it was able to spread

1245
00:42:14,839 --> 00:42:18,400
widely so so far we've covered a lot of

1246
00:42:18,400 --> 00:42:18,880
things

1247
00:42:18,880 --> 00:42:21,200
and i wanted to touch base on every

1248
00:42:21,200 --> 00:42:23,200
single thing i shared and then

1249
00:42:23,200 --> 00:42:25,520
share with you some takeaways from this

1250
00:42:25,520 --> 00:42:27,119
so first of all i hope that you all

1251
00:42:27,119 --> 00:42:28,960
understand what is dga

1252
00:42:28,960 --> 00:42:30,880
that it is a piece of code that some

1253
00:42:30,880 --> 00:42:33,040
hours have that generate domain names

1254
00:42:33,040 --> 00:42:33,280
for

1255
00:42:33,280 --> 00:42:36,240
cnc channels secondly i shared with you

1256
00:42:36,240 --> 00:42:38,079
our defense system that we actually

1257
00:42:38,079 --> 00:42:38,880
built

1258
00:42:38,880 --> 00:42:41,760
and we're actually using on live traffic

1259
00:42:41,760 --> 00:42:43,599
to detect the domains and then block

1260
00:42:43,599 --> 00:42:44,000
them

1261
00:42:44,000 --> 00:42:46,400
and that is based on a deep neural

1262
00:42:46,400 --> 00:42:48,079
network and that is not something to be

1263
00:42:48,079 --> 00:42:49,599
feared from

1264
00:42:49,599 --> 00:42:52,319
and lastly i shared with our most

1265
00:42:52,319 --> 00:42:54,319
interesting detection so far

1266
00:42:54,319 --> 00:42:57,200
that is this botnet called milobot and i

1267
00:42:57,200 --> 00:42:59,200
shared with you how prominent it is and

1268
00:42:59,200 --> 00:43:00,640
how super active it is

1269
00:43:00,640 --> 00:43:03,520
and that you all should look out for it

1270
00:43:03,520 --> 00:43:05,119
i hope that your main takeaways from

1271
00:43:05,119 --> 00:43:06,720
this is that first of all there are

1272
00:43:06,720 --> 00:43:08,240
counter measures for milo

1273
00:43:08,240 --> 00:43:10,880
as i just explained by monitoring dns

1274
00:43:10,880 --> 00:43:12,240
traffic we were able

1275
00:43:12,240 --> 00:43:13,599
to detect it and then block it

1276
00:43:13,599 --> 00:43:15,839
effectively secondly

1277
00:43:15,839 --> 00:43:17,920
i will publish all of those iocs that i

1278
00:43:17,920 --> 00:43:19,760
see and i will share a blog that you can

1279
00:43:19,760 --> 00:43:20,560
all

1280
00:43:20,560 --> 00:43:22,720
touch base with but i would encourage

1281
00:43:22,720 --> 00:43:24,000
you that

1282
00:43:24,000 --> 00:43:26,480
using deep learning and not being

1283
00:43:26,480 --> 00:43:28,079
fearful of that

1284
00:43:28,079 --> 00:43:30,319
gave me at least the power to build this

1285
00:43:30,319 --> 00:43:32,560
beast of a detection like it's blocking

1286
00:43:32,560 --> 00:43:36,079
by itself and doing phenomenal work

1287
00:43:36,079 --> 00:43:38,000
and lastly even though reverse

1288
00:43:38,000 --> 00:43:39,599
engineering is probably a hobby for a

1289
00:43:39,599 --> 00:43:41,200
lot of us

1290
00:43:41,200 --> 00:43:42,720
the threat intelligence and the network

1291
00:43:42,720 --> 00:43:44,240
perspective was really interesting here

1292
00:43:44,240 --> 00:43:45,760
and we were able to get

1293
00:43:45,760 --> 00:43:48,319
really interesting results by only

1294
00:43:48,319 --> 00:43:49,760
investigating the patterns the new

1295
00:43:49,760 --> 00:43:51,680
domains and then researching them

1296
00:43:51,680 --> 00:43:53,839
back on some open source platforms that

1297
00:43:53,839 --> 00:43:55,280
i would encourage you

1298
00:43:55,280 --> 00:43:58,400
to do the same but on the same note

1299
00:43:58,400 --> 00:43:59,839
if any of you is interested in

1300
00:43:59,839 --> 00:44:01,680
collaborating about this and they've

1301
00:44:01,680 --> 00:44:03,440
seen this malware they want to talk to

1302
00:44:03,440 --> 00:44:04,319
us so

1303
00:44:04,319 --> 00:44:06,720
feel free to reach out and and touch and

1304
00:44:06,720 --> 00:44:08,400
touch base and connect with us because

1305
00:44:08,400 --> 00:44:09,680
we would love

1306
00:44:09,680 --> 00:44:11,760
um to share and help the defense

1307
00:44:11,760 --> 00:44:12,800
community

1308
00:44:12,800 --> 00:44:14,480
defense as much as possible from these

1309
00:44:14,480 --> 00:44:16,800
threats and if you see anything that is

1310
00:44:16,800 --> 00:44:18,560
related to dga feel free to

1311
00:44:18,560 --> 00:44:21,680
um to connect with us and

1312
00:44:21,680 --> 00:44:24,800
this is my my contacts if anyone is

1313
00:44:24,800 --> 00:44:25,520
interested

1314
00:44:25,520 --> 00:44:27,440
and i would like to thank you all for

1315
00:44:27,440 --> 00:44:28,560
listening

1316
00:44:28,560 --> 00:44:37,119
and studio back to you

