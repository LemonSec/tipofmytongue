1
00:00:01,930 --> 00:00:08,050
hello everyone<font color="#E5E5E5"> so let me show you</font>

2
00:00:05,980 --> 00:00:11,429
something that<font color="#E5E5E5"> a</font><font color="#CCCCCC"> lot of people who are</font>

3
00:00:08,050 --> 00:00:13,750
actually<font color="#CCCCCC"> asking after confidence 2017</font>

4
00:00:11,429 --> 00:00:16,240
<font color="#E5E5E5">something that we called a massive</font>

5
00:00:13,750 --> 00:00:18,550
network security monitoring at<font color="#E5E5E5"> Mozilla</font>

6
00:00:16,239 --> 00:00:20,830
<font color="#E5E5E5">so let's start with a story</font><font color="#CCCCCC"> and</font>

7
00:00:18,550 --> 00:00:23,350
throughout the presentation there will

8
00:00:20,830 --> 00:00:25,959
<font color="#E5E5E5">be a lot of stories kind of trying to</font>

9
00:00:23,350 --> 00:00:28,720
illustrate everything<font color="#E5E5E5"> this way so on a</font>

10
00:00:25,960 --> 00:00:32,850
bright shiny day<font color="#E5E5E5"> something like this</font>

11
00:00:28,720 --> 00:00:36,640
happened<font color="#E5E5E5"> and what you can see</font><font color="#CCCCCC"> here is</font>

12
00:00:32,850 --> 00:00:39,370
some internal systems<font color="#E5E5E5"> try to resolve a</font>

13
00:00:36,640 --> 00:00:42,249
bunch of domain names<font color="#E5E5E5"> nothing</font><font color="#CCCCCC"> special</font>

14
00:00:39,370 --> 00:00:44,800
about it<font color="#CCCCCC"> but those domain names belong</font>

15
00:00:42,249 --> 00:00:49,149
to<font color="#CCCCCC"> a known</font><font color="#E5E5E5"> command and control malware</font>

16
00:00:44,800 --> 00:00:52,599
server so I'm like<font color="#CCCCCC"> hmm I really like to</font>

17
00:00:49,149 --> 00:00:55,440
know why<font color="#CCCCCC"> internal system from a data</font>

18
00:00:52,600 --> 00:01:01,719
center suddenly started the resolving

19
00:00:55,440 --> 00:01:03,339
known<font color="#CCCCCC"> CLC server</font><font color="#E5E5E5"> and second thing but</font>

20
00:01:01,719 --> 00:01:05,620
has anyone<font color="#E5E5E5"> actually connected</font><font color="#CCCCCC"> to it</font>

21
00:01:03,339 --> 00:01:09,670
because if you<font color="#CCCCCC"> had been</font><font color="#E5E5E5"> in the detection</font>

22
00:01:05,620 --> 00:01:11,440
for a while you<font color="#E5E5E5"> know that FAT FAT</font>

23
00:01:09,670 --> 00:01:12,670
intelligence can be<font color="#CCCCCC"> good sometimes but</font>

24
00:01:11,440 --> 00:01:15,640
you will have a lot<font color="#CCCCCC"> of false positives</font>

25
00:01:12,670 --> 00:01:18,010
<font color="#CCCCCC">so a given</font><font color="#E5E5E5"> system can resolve a</font>

26
00:01:15,640 --> 00:01:20,650
malicious domain name but maybe nothing

27
00:01:18,010 --> 00:01:25,030
will connect in the future<font color="#E5E5E5"> so what we</font>

28
00:01:20,650 --> 00:01:29,140
did I voted quickly<font color="#CCCCCC"> to I pivoted quickly</font>

29
00:01:25,030 --> 00:01:32,380
to our<font color="#CCCCCC"> login the local regulation system</font>

30
00:01:29,140 --> 00:01:35,620
and I asked some extra queries I was

31
00:01:32,380 --> 00:01:38,190
like<font color="#CCCCCC"> ok most def ok bro ideas</font><font color="#E5E5E5"> please</font>

32
00:01:35,620 --> 00:01:40,780
<font color="#E5E5E5">tell me</font><font color="#CCCCCC"> everything that you know about</font>

33
00:01:38,190 --> 00:01:42,580
<font color="#E5E5E5">system connecting to this domain</font>

34
00:01:40,780 --> 00:01:44,320
resolving<font color="#E5E5E5"> this domain I just don't I</font>

35
00:01:42,580 --> 00:01:46,900
<font color="#E5E5E5">don't want to only know if something</font>

36
00:01:44,320 --> 00:01:49,360
resolved malicious domain name<font color="#CCCCCC"> I want</font><font color="#E5E5E5"> to</font>

37
00:01:46,900 --> 00:01:53,200
know if<font color="#E5E5E5"> someone connected and if they</font>

38
00:01:49,360 --> 00:01:55,270
did<font color="#E5E5E5"> what happened so as you can</font><font color="#CCCCCC"> see the</font>

39
00:01:53,200 --> 00:01:58,270
<font color="#E5E5E5">detailed level that we have here allowed</font>

40
00:01:55,270 --> 00:02:00,820
us to say that not<font color="#CCCCCC"> only the malicious</font>

41
00:01:58,270 --> 00:02:04,449
domain name was resolved but<font color="#E5E5E5"> also the</font>

42
00:02:00,820 --> 00:02:07,300
malicious server<font color="#E5E5E5"> actually sent us SSL</font>

43
00:02:04,450 --> 00:02:09,729
certificate and by the way I do know

44
00:02:07,300 --> 00:02:13,239
<font color="#E5E5E5">were</font><font color="#CCCCCC"> a birth certificate</font><font color="#E5E5E5"> and the proper</font>

45
00:02:09,729 --> 00:02:15,280
name is x.509 certificate<font color="#E5E5E5"> but I will</font>

46
00:02:13,239 --> 00:02:17,410
<font color="#E5E5E5">just use an excuse and</font>

47
00:02:15,280 --> 00:02:20,920
<font color="#E5E5E5">recall it as a</font><font color="#CCCCCC"> self certificate</font><font color="#E5E5E5"> because</font>

48
00:02:17,410 --> 00:02:23,770
it's so much<font color="#CCCCCC"> easier to pronounce so we</font>

49
00:02:20,920 --> 00:02:27,519
can see SSL<font color="#CCCCCC"> connection</font><font color="#E5E5E5"> took place</font><font color="#CCCCCC"> HTTP</font>

50
00:02:23,770 --> 00:02:30,970
connection took place so I pivoted over

51
00:02:27,520 --> 00:02:32,709
to the HTTP you might see or you might

52
00:02:30,970 --> 00:02:35,109
not see what is<font color="#E5E5E5"> at the bottom of the</font>

53
00:02:32,709 --> 00:02:38,800
slide<font color="#CCCCCC"> but basically I was quickly able</font>

54
00:02:35,110 --> 00:02:41,200
<font color="#E5E5E5">to locate that first of all the user</font>

55
00:02:38,800 --> 00:02:43,660
agent<font color="#CCCCCC"> so the user agent for this</font>

56
00:02:41,200 --> 00:02:45,519
connection<font color="#E5E5E5"> is</font><font color="#CCCCCC"> queue BitTorrent I'd</font>

57
00:02:43,660 --> 00:02:48,220
really like<font color="#E5E5E5"> to know one one of my</font>

58
00:02:45,520 --> 00:02:51,760
internal systems<font color="#E5E5E5"> presents itself as</font>

59
00:02:48,220 --> 00:02:55,540
<font color="#CCCCCC">qubit</font><font color="#E5E5E5"> torrent and I can see the full URL</font>

60
00:02:51,760 --> 00:02:57,280
<font color="#E5E5E5">to the actual bittorrent tracker file so</font>

61
00:02:55,540 --> 00:03:00,370
it seems<font color="#E5E5E5"> like someone was actually</font>

62
00:02:57,280 --> 00:03:03,760
<font color="#E5E5E5">trending using the internal jump cost as</font>

63
00:03:00,370 --> 00:03:06,370
a proxy for whatever reasons<font color="#E5E5E5"> so the only</font>

64
00:03:03,760 --> 00:03:08,799
thing left<font color="#CCCCCC"> for me to do was to</font><font color="#E5E5E5"> delegate</font>

65
00:03:06,370 --> 00:03:10,810
<font color="#E5E5E5">it</font><font color="#CCCCCC"> to end-user services why am i</font><font color="#E5E5E5"> showing</font>

66
00:03:08,800 --> 00:03:13,660
you<font color="#E5E5E5"> a half of a story like</font><font color="#CCCCCC"> this will</font>

67
00:03:10,810 --> 00:03:15,750
become more<font color="#CCCCCC"> clear in</font><font color="#E5E5E5"> the couple next</font>

68
00:03:13,660 --> 00:03:19,540
<font color="#E5E5E5">slides</font>

69
00:03:15,750 --> 00:03:22,390
so basically after the<font color="#E5E5E5"> confidence 2017 I</font>

70
00:03:19,540 --> 00:03:25,209
got this<font color="#CCCCCC"> feedback</font><font color="#E5E5E5"> you know</font><font color="#CCCCCC"> okay story</font>

71
00:03:22,390 --> 00:03:27,309
but we expected<font color="#CCCCCC"> you to talk more about</font>

72
00:03:25,209 --> 00:03:30,820
<font color="#E5E5E5">your network</font><font color="#CCCCCC"> security</font><font color="#E5E5E5"> monitoring browser</font>

73
00:03:27,310 --> 00:03:36,040
<font color="#E5E5E5">regatta so you know be careful what you</font>

74
00:03:30,820 --> 00:03:40,480
<font color="#CCCCCC">wish for</font><font color="#E5E5E5"> and that's that's me presenting</font>

75
00:03:36,040 --> 00:03:43,329
<font color="#CCCCCC">ideas in 2018</font><font color="#E5E5E5"> and you would be like that</font>

76
00:03:40,480 --> 00:03:47,500
<font color="#CCCCCC">kind</font><font color="#E5E5E5"> of boring because I already have</font>

77
00:03:43,330 --> 00:03:51,010
mine and<font color="#CCCCCC"> gee firewall powered by IP D</font><font color="#E5E5E5"> as</font>

78
00:03:47,500 --> 00:03:53,500
consuming<font color="#E5E5E5"> TTP IOC oh my god</font><font color="#CCCCCC"> who knows</font>

79
00:03:51,010 --> 00:03:58,269
what<font color="#E5E5E5"> else</font><font color="#CCCCCC"> all these super things that</font>

80
00:03:53,500 --> 00:03:59,739
<font color="#E5E5E5">make you sell everything else but I'm</font>

81
00:03:58,269 --> 00:04:02,500
here to show you<font color="#E5E5E5"> something else</font><font color="#CCCCCC"> I'm here</font>

82
00:03:59,739 --> 00:04:04,840
<font color="#CCCCCC">to show</font><font color="#E5E5E5"> you the most unusual approach to</font>

83
00:04:02,500 --> 00:04:07,510
<font color="#E5E5E5">network detection that you might have</font>

84
00:04:04,840 --> 00:04:12,220
ever seen<font color="#E5E5E5"> and it all starts with a story</font>

85
00:04:07,510 --> 00:04:15,399
<font color="#E5E5E5">in 2012 my boss told me I got</font><font color="#CCCCCC"> you some</font>

86
00:04:12,220 --> 00:04:17,380
<font color="#CCCCCC">new servers and I'm like new servers I</font>

87
00:04:15,400 --> 00:04:21,370
don't know about you<font color="#CCCCCC"> but I can take some</font>

88
00:04:17,380 --> 00:04:24,070
new servers<font color="#E5E5E5"> always and he had this crazy</font>

89
00:04:21,370 --> 00:04:27,340
<font color="#E5E5E5">idea what if we could store metadata</font>

90
00:04:24,070 --> 00:04:28,719
<font color="#E5E5E5">about literally every connection</font><font color="#CCCCCC"> I want</font>

91
00:04:27,340 --> 00:04:31,299
every<font color="#E5E5E5"> connection in</font>

92
00:04:28,719 --> 00:04:33,129
every one of our<font color="#E5E5E5"> networks metadata about</font>

93
00:04:31,299 --> 00:04:34,929
<font color="#E5E5E5">this connection</font><font color="#CCCCCC"> to be saved to disk I'm</font>

94
00:04:33,129 --> 00:04:37,509
like you're crazy

95
00:04:34,929 --> 00:04:40,058
and by every connection<font color="#CCCCCC"> I mean if there</font>

96
00:04:37,509 --> 00:04:42,519
was<font color="#E5E5E5"> for</font><font color="#CCCCCC"> example HTTP session 2 something</font>

97
00:04:40,059 --> 00:04:46,539
<font color="#E5E5E5">I want to see details</font><font color="#CCCCCC"> about this HTTP</font>

98
00:04:42,519 --> 00:04:48,099
session<font color="#CCCCCC"> I want to see the DNS represent</font>

99
00:04:46,539 --> 00:04:50,349
that took place<font color="#E5E5E5"> before</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> connection</font>

100
00:04:48,099 --> 00:04:53,649
took place<font color="#E5E5E5"> if that file was transferred</font>

101
00:04:50,349 --> 00:04:56,409
<font color="#E5E5E5">I want to see this file</font><font color="#CCCCCC"> if it was like</font>

102
00:04:53,649 --> 00:04:58,209
an<font color="#CCCCCC"> ssl connection yes of</font><font color="#E5E5E5"> course</font><font color="#CCCCCC"> I do</font>

103
00:04:56,409 --> 00:05:00,699
want to<font color="#E5E5E5"> see details of this</font><font color="#CCCCCC"> ssl</font>

104
00:04:58,209 --> 00:05:03,429
connection<font color="#E5E5E5"> I want even I want to even</font>

105
00:05:00,699 --> 00:05:05,259
store a copy<font color="#E5E5E5"> of</font><font color="#CCCCCC"> that certificate so</font>

106
00:05:03,429 --> 00:05:07,359
basically it's creating like a time

107
00:05:05,259 --> 00:05:10,749
<font color="#CCCCCC">machine</font><font color="#E5E5E5"> for everything that you have in</font>

108
00:05:07,360 --> 00:05:13,419
your<font color="#CCCCCC"> network</font><font color="#E5E5E5"> and by storing insane</font>

109
00:05:10,749 --> 00:05:18,149
amount of<font color="#E5E5E5"> data inside amount of logging</font>

110
00:05:13,419 --> 00:05:22,089
<font color="#CCCCCC">information that's basically what I mean</font>

111
00:05:18,149 --> 00:05:24,639
<font color="#E5E5E5">here is</font><font color="#CCCCCC"> an</font><font color="#E5E5E5"> example from showing detailed</font>

112
00:05:22,089 --> 00:05:26,860
level<font color="#E5E5E5"> of the logs from for</font><font color="#CCCCCC"> example SSL</font>

113
00:05:24,639 --> 00:05:29,619
log that we have so just<font color="#E5E5E5"> imagine that</font>

114
00:05:26,860 --> 00:05:31,779
<font color="#E5E5E5">for every SSL session in the internal</font>

115
00:05:29,619 --> 00:05:34,329
<font color="#CCCCCC">network and</font><font color="#E5E5E5"> from the internal network to</font>

116
00:05:31,779 --> 00:05:36,999
the external<font color="#CCCCCC"> network</font><font color="#E5E5E5"> we store this</font>

117
00:05:34,329 --> 00:05:39,129
amount<font color="#E5E5E5"> of information and much more</font><font color="#CCCCCC"> all</font>

118
00:05:36,999 --> 00:05:40,989
<font color="#E5E5E5">of the metadata you</font><font color="#CCCCCC"> can pretty much</font>

119
00:05:39,129 --> 00:05:45,369
reconstruct everything<font color="#CCCCCC"> that happened</font>

120
00:05:40,989 --> 00:05:47,318
here<font color="#E5E5E5"> my boss also told me</font><font color="#CCCCCC"> that he wants</font>

121
00:05:45,369 --> 00:05:49,569
to<font color="#E5E5E5"> be able to write arbitrary detection</font>

122
00:05:47,319 --> 00:05:52,509
logic and let me just<font color="#CCCCCC"> give you an</font>

123
00:05:49,569 --> 00:05:55,269
example<font color="#E5E5E5"> of this let's say two hosts talk</font>

124
00:05:52,509 --> 00:05:59,409
to each other<font color="#E5E5E5"> over SSL</font><font color="#CCCCCC"> and we are</font><font color="#E5E5E5"> super</font>

125
00:05:55,269 --> 00:06:01,779
paranoid<font color="#E5E5E5"> about SSL</font><font color="#CCCCCC"> and my network</font>

126
00:05:59,409 --> 00:06:05,110
security monitoring what it does it

127
00:06:01,779 --> 00:06:07,449
<font color="#CCCCCC">basically tries</font><font color="#E5E5E5"> to chain the CI up to</font>

128
00:06:05,110 --> 00:06:09,819
the<font color="#CCCCCC"> root trying</font><font color="#E5E5E5"> to say</font><font color="#CCCCCC"> okay do I know</font>

129
00:06:07,449 --> 00:06:12,099
about<font color="#E5E5E5"> that certificate</font><font color="#CCCCCC"> that was used</font><font color="#E5E5E5"> for</font>

130
00:06:09,819 --> 00:06:14,739
this<font color="#E5E5E5"> SSL connection if it does not know</font>

131
00:06:12,099 --> 00:06:16,989
about the<font color="#E5E5E5"> CI it is the first time it saw</font>

132
00:06:14,739 --> 00:06:19,328
those certificates<font color="#CCCCCC"> I want some</font><font color="#E5E5E5"> kind of</font>

133
00:06:16,989 --> 00:06:24,128
<font color="#CCCCCC">low-level</font><font color="#E5E5E5"> alert to be investigated</font>

134
00:06:19,329 --> 00:06:26,289
lighter and we also want to<font color="#E5E5E5"> be able</font><font color="#CCCCCC"> to</font>

135
00:06:24,129 --> 00:06:29,619
save<font color="#E5E5E5"> some parts of the network traffic</font>

136
00:06:26,289 --> 00:06:32,318
to<font color="#CCCCCC"> disk</font><font color="#E5E5E5"> we have no way to save entire</font>

137
00:06:29,619 --> 00:06:35,289
network traffic<font color="#CCCCCC"> to disk</font><font color="#E5E5E5"> but let's say I</font>

138
00:06:32,319 --> 00:06:36,939
have<font color="#E5E5E5"> a windows PE file which can be like</font>

139
00:06:35,289 --> 00:06:38,889
executable or<font color="#E5E5E5"> a DLL</font>

140
00:06:36,939 --> 00:06:40,780
flowing over<font color="#E5E5E5"> a plain</font><font color="#CCCCCC"> text connection</font>

141
00:06:38,889 --> 00:06:43,570
that's<font color="#E5E5E5"> unusual these days</font>

142
00:06:40,780 --> 00:06:46,270
<font color="#CCCCCC">I want to save this file to</font><font color="#E5E5E5"> disk</font><font color="#CCCCCC"> to have</font>

143
00:06:43,570 --> 00:06:49,900
it analyzed<font color="#E5E5E5"> later and by analyzed</font><font color="#CCCCCC"> I mean</font>

144
00:06:46,270 --> 00:06:52,270
I want to capture this file<font color="#E5E5E5"> from the</font>

145
00:06:49,900 --> 00:06:55,239
wire<font color="#E5E5E5"> save it to disk</font><font color="#CCCCCC"> and have something</font>

146
00:06:52,270 --> 00:06:57,969
<font color="#CCCCCC">like era</font><font color="#E5E5E5"> or</font><font color="#CCCCCC"> virustotal to pick it up and</font>

147
00:06:55,240 --> 00:07:00,040
<font color="#CCCCCC">ask hey what</font><font color="#E5E5E5"> do you know about this PE</font>

148
00:06:57,970 --> 00:07:01,570
file<font color="#E5E5E5"> like automatically did know</font>

149
00:07:00,040 --> 00:07:04,300
<font color="#E5E5E5">something wrong</font><font color="#CCCCCC"> if you know something</font>

150
00:07:01,570 --> 00:07:07,599
<font color="#CCCCCC">bad about it yeah I'd like to get an</font>

151
00:07:04,300 --> 00:07:10,840
alert<font color="#E5E5E5"> on it so the big idea</font><font color="#CCCCCC"> to recap</font>

152
00:07:07,600 --> 00:07:13,360
this part is network security monitoring

153
00:07:10,840 --> 00:07:16,570
sniffing<font color="#CCCCCC"> everything on the network layer</font>

154
00:07:13,360 --> 00:07:19,180
even<font color="#E5E5E5"> internal networks storing metadata</font>

155
00:07:16,570 --> 00:07:22,630
<font color="#E5E5E5">about everything and writing any</font>

156
00:07:19,180 --> 00:07:24,700
detection logic value ever wanted so

157
00:07:22,630 --> 00:07:27,730
<font color="#E5E5E5">that's what I heard from my boss</font><font color="#CCCCCC"> and I</font>

158
00:07:24,700 --> 00:07:30,460
raised a number of concerns<font color="#E5E5E5"> like I was</font>

159
00:07:27,730 --> 00:07:32,080
like<font color="#E5E5E5"> it's 2012</font><font color="#CCCCCC"> you cannot do it</font>

160
00:07:30,460 --> 00:07:36,969
everything<font color="#E5E5E5"> is encrypted</font><font color="#CCCCCC"> it makes no</font>

161
00:07:32,080 --> 00:07:41,050
sense<font color="#CCCCCC"> it's too much</font><font color="#E5E5E5"> of a data so I just</font>

162
00:07:36,970 --> 00:07:42,850
put a stamp<font color="#E5E5E5"> cannot be done and the words</font>

163
00:07:41,050 --> 00:07:44,740
got to be a<font color="#E5E5E5"> reason for the back of my</font>

164
00:07:42,850 --> 00:07:47,320
laptop<font color="#CCCCCC"> this is the</font><font color="#E5E5E5"> actual back of my</font>

165
00:07:44,740 --> 00:07:49,419
laptop<font color="#CCCCCC"> it says question</font><font color="#E5E5E5"> authority</font><font color="#CCCCCC"> and</font>

166
00:07:47,320 --> 00:07:55,840
that's pretty much what my<font color="#E5E5E5"> boss looks at</font>

167
00:07:49,419 --> 00:07:58,120
throughout<font color="#E5E5E5"> entire diet but</font><font color="#CCCCCC"> you know if</font>

168
00:07:55,840 --> 00:08:00,460
you have<font color="#E5E5E5"> sometimes you have</font><font color="#CCCCCC"> like a great</font>

169
00:07:58,120 --> 00:08:02,110
<font color="#E5E5E5">leader of which can</font><font color="#CCCCCC"> infect</font><font color="#E5E5E5"> you with the</font>

170
00:08:00,460 --> 00:08:04,570
<font color="#E5E5E5">idea that will not let you sleep at</font>

171
00:08:02,110 --> 00:08:08,800
night<font color="#CCCCCC"> so where you go fast forward to</font>

172
00:08:04,570 --> 00:08:10,690
2018<font color="#E5E5E5"> will have something that works and</font>

173
00:08:08,800 --> 00:08:14,110
let me show you why we<font color="#E5E5E5"> decided</font><font color="#CCCCCC"> to build</font>

174
00:08:10,690 --> 00:08:16,479
a<font color="#CCCCCC"> system like this</font><font color="#E5E5E5"> so like I said we</font>

175
00:08:14,110 --> 00:08:19,750
<font color="#E5E5E5">want</font><font color="#CCCCCC"> to be able to colleague locks</font><font color="#E5E5E5"> so I</font>

176
00:08:16,479 --> 00:08:22,750
decided if you want to record<font color="#E5E5E5"> threat</font>

177
00:08:19,750 --> 00:08:25,150
<font color="#E5E5E5">actors activity there is no way to do it</font>

178
00:08:22,750 --> 00:08:27,550
<font color="#E5E5E5">without recording our own actions we</font>

179
00:08:25,150 --> 00:08:29,890
were recording<font color="#CCCCCC"> our own activity then you</font>

180
00:08:27,550 --> 00:08:33,190
<font color="#CCCCCC">might be</font><font color="#E5E5E5"> able</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> catch some parts of</font>

181
00:08:29,890 --> 00:08:36,490
<font color="#CCCCCC">read actor activity we want</font><font color="#E5E5E5"> to be able</font>

182
00:08:33,190 --> 00:08:38,020
<font color="#CCCCCC">to match iosys and my iOS's are not only</font>

183
00:08:36,490 --> 00:08:40,630
<font color="#CCCCCC">different as you're</font><font color="#E5E5E5"> going to see in a</font>

184
00:08:38,020 --> 00:08:42,520
while but<font color="#CCCCCC"> we</font><font color="#E5E5E5"> are in a very different and</font>

185
00:08:40,630 --> 00:08:46,600
<font color="#CCCCCC">very strange places</font><font color="#E5E5E5"> that you might never</font>

186
00:08:42,520 --> 00:08:49,060
<font color="#E5E5E5">look for</font><font color="#CCCCCC"> IOC and I want to be able to</font>

187
00:08:46,600 --> 00:08:51,370
detect<font color="#CCCCCC"> ETP</font><font color="#E5E5E5"> everyone is crazy about TTP</font>

188
00:08:49,060 --> 00:08:53,479
right now every vendor sells a product

189
00:08:51,370 --> 00:08:55,940
for detecting tactics<font color="#CCCCCC"> to</font>

190
00:08:53,480 --> 00:08:57,649
procedures of<font color="#CCCCCC"> efferent actor I want to</font>

191
00:08:55,940 --> 00:09:02,750
do some<font color="#E5E5E5"> of these detection also at the</font>

192
00:08:57,649 --> 00:09:04,519
network layer so if you have been in the

193
00:09:02,750 --> 00:09:07,670
security<font color="#CCCCCC"> industry for a while</font><font color="#E5E5E5"> you saw</font>

194
00:09:04,519 --> 00:09:10,839
the ideas in 90s<font color="#E5E5E5"> and it was basically</font>

195
00:09:07,670 --> 00:09:15,019
like<font color="#E5E5E5"> intrusion detection system and like</font>

196
00:09:10,839 --> 00:09:16,940
<font color="#CCCCCC">25,000</font><font color="#E5E5E5"> or</font><font color="#CCCCCC"> rolls</font><font color="#E5E5E5"> full of things you</font>

197
00:09:15,019 --> 00:09:18,680
cannot really understand<font color="#CCCCCC"> and when I</font>

198
00:09:16,940 --> 00:09:22,370
deployed<font color="#E5E5E5"> something similar I had like</font>

199
00:09:18,680 --> 00:09:24,138
<font color="#CCCCCC">100,000 false positives per day</font><font color="#E5E5E5"> I tuned</font>

200
00:09:22,370 --> 00:09:26,449
it from this time but it can<font color="#E5E5E5"> still kind</font>

201
00:09:24,139 --> 00:09:28,899
of show you<font color="#CCCCCC"> that the early intrusion</font>

202
00:09:26,449 --> 00:09:31,579
detection systems were just<font color="#E5E5E5"> limited to</font>

203
00:09:28,899 --> 00:09:34,399
consuming<font color="#E5E5E5"> insane amount of rolls</font>

204
00:09:31,579 --> 00:09:37,819
matching traffic against those<font color="#CCCCCC"> rolls</font><font color="#E5E5E5"> if</font>

205
00:09:34,399 --> 00:09:40,670
something matches<font color="#E5E5E5"> raise an alert and as</font>

206
00:09:37,820 --> 00:09:43,760
some in 2018 is very different<font color="#E5E5E5"> it is</font><font color="#CCCCCC"> not</font>

207
00:09:40,670 --> 00:09:46,279
longer<font color="#E5E5E5"> IDs it is a collection of several</font>

208
00:09:43,760 --> 00:09:48,260
ideas<font color="#E5E5E5"> and joins and it is nothing else</font>

209
00:09:46,279 --> 00:09:51,230
but<font color="#E5E5E5"> the big</font><font color="#CCCCCC"> event-driven</font>

210
00:09:48,260 --> 00:09:53,630
engine<font color="#E5E5E5"> so if you are for example a</font>

211
00:09:51,230 --> 00:09:55,930
Python programmer or<font color="#CCCCCC"> a C programmer</font><font color="#E5E5E5"> you</font>

212
00:09:53,630 --> 00:10:00,589
know that you can have this framework

213
00:09:55,930 --> 00:10:02,779
<font color="#E5E5E5">kind of like here traffic flows into</font>

214
00:10:00,589 --> 00:10:05,240
<font color="#E5E5E5">your network</font><font color="#CCCCCC"> security monitoring system</font>

215
00:10:02,779 --> 00:10:08,300
and what it does<font color="#E5E5E5"> instead of having a</font>

216
00:10:05,240 --> 00:10:10,760
number<font color="#E5E5E5"> of hard-coded rules it triggers a</font>

217
00:10:08,300 --> 00:10:13,040
bunch of<font color="#CCCCCC"> events and it's up to you to</font>

218
00:10:10,760 --> 00:10:14,930
<font color="#CCCCCC">write the code to handle</font><font color="#E5E5E5"> those events</font>

219
00:10:13,040 --> 00:10:16,219
<font color="#E5E5E5">what do you do handling those events</font><font color="#CCCCCC"> I</font>

220
00:10:14,930 --> 00:10:19,069
don't know up<font color="#CCCCCC"> to you</font>

221
00:10:16,220 --> 00:10:22,370
write your own alerting logic<font color="#E5E5E5"> and very</font>

222
00:10:19,069 --> 00:10:26,750
like thousands of events<font color="#E5E5E5"> to intercept so</font>

223
00:10:22,370 --> 00:10:31,310
let me show<font color="#E5E5E5"> you an example let's say the</font>

224
00:10:26,750 --> 00:10:33,230
event<font color="#E5E5E5"> HTTP header has been triggered</font><font color="#CCCCCC"> and</font>

225
00:10:31,310 --> 00:10:35,268
I want to that example again<font color="#E5E5E5"> open proxy</font>

226
00:10:33,230 --> 00:10:38,149
<font color="#E5E5E5">in my network</font><font color="#CCCCCC"> we have huge proxies</font>

227
00:10:35,269 --> 00:10:40,310
people<font color="#CCCCCC"> instil various things and</font><font color="#E5E5E5"> I want</font>

228
00:10:38,149 --> 00:10:42,980
to be<font color="#CCCCCC"> able when I want</font><font color="#E5E5E5"> to be able</font><font color="#CCCCCC"> to say</font>

229
00:10:40,310 --> 00:10:46,189
that someone<font color="#E5E5E5"> started</font><font color="#CCCCCC"> a new let's say</font>

230
00:10:42,980 --> 00:10:48,260
squid server<font color="#E5E5E5"> but I don't know about so I</font>

231
00:10:46,190 --> 00:10:50,630
look for a<font color="#E5E5E5"> local system reaching out to</font>

232
00:10:48,260 --> 00:10:52,490
the Internet<font color="#E5E5E5"> this local system has</font>

233
00:10:50,630 --> 00:10:55,490
somewhere in the HTTP session

234
00:10:52,490 --> 00:10:57,829
<font color="#E5E5E5">x-forwarded-for</font><font color="#CCCCCC"> header and this system</font>

235
00:10:55,490 --> 00:11:01,190
is not on my whitelist<font color="#E5E5E5"> of null proxies</font>

236
00:10:57,829 --> 00:11:02,540
and<font color="#CCCCCC"> I want to know about it I will not</font>

237
00:11:01,190 --> 00:11:04,790
show you<font color="#E5E5E5"> the code because it's kind of</font>

238
00:11:02,540 --> 00:11:06,769
interesting<font color="#E5E5E5"> but it's a couple lines of</font>

239
00:11:04,790 --> 00:11:07,660
<font color="#CCCCCC">code and</font><font color="#E5E5E5"> you have have a deduction like</font>

240
00:11:06,769 --> 00:11:11,720
this

241
00:11:07,660 --> 00:11:13,339
why we go to such a great extent<font color="#E5E5E5"> and do</font>

242
00:11:11,720 --> 00:11:15,980
something like network security

243
00:11:13,340 --> 00:11:17,900
monitoring<font color="#CCCCCC"> si code everything</font><font color="#E5E5E5"> as I guess</font>

244
00:11:15,980 --> 00:11:19,970
<font color="#E5E5E5">a code right now your infrastructure is</font>

245
00:11:17,900 --> 00:11:22,490
a code<font color="#E5E5E5"> why not your network security</font>

246
00:11:19,970 --> 00:11:24,320
<font color="#E5E5E5">monitoring well we basically want</font><font color="#CCCCCC"> to</font>

247
00:11:22,490 --> 00:11:27,470
answer the<font color="#CCCCCC"> most important question in</font>

248
00:11:24,320 --> 00:11:31,960
<font color="#E5E5E5">the universe</font><font color="#CCCCCC"> the most important</font><font color="#E5E5E5"> question</font>

249
00:11:27,470 --> 00:11:31,960
in<font color="#E5E5E5"> the universe for me is this question</font>

250
00:11:35,170 --> 00:11:42,110
so when a new apt report is published

251
00:11:40,160 --> 00:11:44,780
that's basically what a<font color="#E5E5E5"> Mozilla</font><font color="#CCCCCC"> threat</font>

252
00:11:42,110 --> 00:11:48,110
management team does we dig in<font color="#E5E5E5"> into our</font>

253
00:11:44,780 --> 00:11:50,120
<font color="#E5E5E5">logs and various kinds of logs and I'm</font>

254
00:11:48,110 --> 00:11:52,190
not<font color="#E5E5E5"> trying to say it's only understand</font>

255
00:11:50,120 --> 00:11:53,410
that we use we dig into various kinds<font color="#CCCCCC"> of</font>

256
00:11:52,190 --> 00:11:58,910
<font color="#E5E5E5">logs</font>

257
00:11:53,410 --> 00:12:03,439
how do you like the<font color="#E5E5E5"> folks</font><font color="#CCCCCC"> so let's take</font>

258
00:11:58,910 --> 00:12:05,959
a look<font color="#E5E5E5"> what the example</font><font color="#CCCCCC"> thread hunting</font>

259
00:12:03,440 --> 00:12:08,060
<font color="#E5E5E5">looks like I don't have an example from</font>

260
00:12:05,960 --> 00:12:10,820
the apt report but what I do<font color="#E5E5E5"> is an</font>

261
00:12:08,060 --> 00:12:13,910
example<font color="#E5E5E5"> from the abuse that CH and if</font>

262
00:12:10,820 --> 00:12:16,220
you use<font color="#E5E5E5"> abuse that CH</font><font color="#CCCCCC"> you should keep</font>

263
00:12:13,910 --> 00:12:18,500
using it if you don't use abuse th<font color="#E5E5E5"> you</font>

264
00:12:16,220 --> 00:12:23,030
probably start using it what it is<font color="#E5E5E5"> it is</font>

265
00:12:18,500 --> 00:12:25,850
<font color="#E5E5E5">a database of for example fingerprints</font>

266
00:12:23,030 --> 00:12:29,569
for the SSL traffic things like SSL

267
00:12:25,850 --> 00:12:31,280
<font color="#CCCCCC">Certificates for a known malware traffic</font>

268
00:12:29,570 --> 00:12:35,480
for a<font color="#E5E5E5"> for</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> traffic to a known commodity</font>

269
00:12:31,280 --> 00:12:37,370
control servers so<font color="#E5E5E5"> I want to see if any</font>

270
00:12:35,480 --> 00:12:40,010
<font color="#CCCCCC">of my</font><font color="#E5E5E5"> systems</font><font color="#CCCCCC"> actually connected to a</font>

271
00:12:37,370 --> 00:12:40,700
malicious<font color="#E5E5E5"> system described by this SSL</font>

272
00:12:40,010 --> 00:12:43,700
blacklist

273
00:12:40,700 --> 00:12:47,330
so what I do I do a simple query<font color="#E5E5E5"> and in</font>

274
00:12:43,700 --> 00:12:51,200
this<font color="#CCCCCC"> query I look for a serial number</font><font color="#E5E5E5"> in</font>

275
00:12:47,330 --> 00:12:53,720
the SSL certificate<font color="#CCCCCC"> and unfortunately</font>

276
00:12:51,200 --> 00:12:57,320
what you<font color="#E5E5E5"> can see I have some hits here</font>

277
00:12:53,720 --> 00:12:59,030
so some<font color="#CCCCCC"> of</font><font color="#E5E5E5"> my internal systems actually</font>

278
00:12:57,320 --> 00:13:01,850
connected to<font color="#CCCCCC"> the</font><font color="#E5E5E5"> known malicious server</font>

279
00:12:59,030 --> 00:13:03,680
and<font color="#E5E5E5"> downloaded something from it I don't</font>

280
00:13:01,850 --> 00:13:05,930
know what it was<font color="#CCCCCC"> because it's over SSL</font>

281
00:13:03,680 --> 00:13:08,660
<font color="#E5E5E5">but at least</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> amble to tell something</font>

282
00:13:05,930 --> 00:13:09,800
<font color="#E5E5E5">like this happened and if you see if you</font>

283
00:13:08,660 --> 00:13:13,130
<font color="#CCCCCC">take</font><font color="#E5E5E5"> a look at this table</font>

284
00:13:09,800 --> 00:13:14,750
<font color="#CCCCCC">it's</font><font color="#E5E5E5"> basically for</font><font color="#CCCCCC"> every for every</font>

285
00:13:13,130 --> 00:13:16,610
system<font color="#CCCCCC"> that I have it tells you</font>

286
00:13:14,750 --> 00:13:17,150
something like a connection new<font color="#CCCCCC"> ID</font><font color="#E5E5E5"> it</font>

287
00:13:16,610 --> 00:13:20,780
tells you

288
00:13:17,150 --> 00:13:22,790
what the<font color="#E5E5E5"> destination server was it gives</font>

289
00:13:20,780 --> 00:13:25,430
you a lot of metadata<font color="#CCCCCC"> I</font><font color="#E5E5E5"> can pivot from</font>

290
00:13:22,790 --> 00:13:28,459
here<font color="#E5E5E5"> to for</font><font color="#CCCCCC"> example the SSL certificate</font>

291
00:13:25,430 --> 00:13:31,520
<font color="#CCCCCC">the actual</font><font color="#E5E5E5"> SSL certificate where was</font>

292
00:13:28,460 --> 00:13:33,950
downloaded<font color="#CCCCCC"> from a remote</font><font color="#E5E5E5"> server to</font><font color="#CCCCCC"> tell</font>

293
00:13:31,520 --> 00:13:37,010
if it<font color="#E5E5E5"> is not a false positive</font><font color="#CCCCCC"> I compare</font>

294
00:13:33,950 --> 00:13:39,380
this data against abuse<font color="#E5E5E5"> dot CH it's a</font>

295
00:13:37,010 --> 00:13:42,020
match<font color="#CCCCCC"> I know I have a true positive I</font>

296
00:13:39,380 --> 00:13:45,110
know who<font color="#E5E5E5"> tried to connect to those hosts</font>

297
00:13:42,020 --> 00:13:47,030
<font color="#E5E5E5">and by pivoting</font><font color="#CCCCCC"> through</font><font color="#E5E5E5"> various kinds of</font>

298
00:13:45,110 --> 00:13:48,890
logs by pivoting<font color="#E5E5E5"> from various kinds</font><font color="#CCCCCC"> of</font>

299
00:13:47,030 --> 00:13:50,930
metadata<font color="#CCCCCC"> that I store</font><font color="#E5E5E5"> about every</font>

300
00:13:48,890 --> 00:13:55,310
connection<font color="#CCCCCC"> my network I am able to</font>

301
00:13:50,930 --> 00:13:57,770
confirm<font color="#E5E5E5"> the infection this way</font><font color="#CCCCCC"> what I</font>

302
00:13:55,310 --> 00:14:01,130
really like to<font color="#CCCCCC"> do after</font><font color="#E5E5E5"> I see something</font>

303
00:13:57,770 --> 00:14:03,290
<font color="#CCCCCC">like suspicious</font><font color="#E5E5E5"> communication from a</font>

304
00:14:01,130 --> 00:14:05,210
given host<font color="#E5E5E5"> it is a really good</font><font color="#CCCCCC"> idea</font><font color="#E5E5E5"> to</font>

305
00:14:03,290 --> 00:14:07,130
look<font color="#E5E5E5"> for the further network activity</font>

306
00:14:05,210 --> 00:14:10,130
<font color="#E5E5E5">from the</font><font color="#CCCCCC"> host value think it might be</font>

307
00:14:07,130 --> 00:14:12,080
<font color="#CCCCCC">infected if let's say your internal host</font>

308
00:14:10,130 --> 00:14:14,270
downloaded something<font color="#E5E5E5"> suspicious</font><font color="#CCCCCC"> you are</font>

309
00:14:12,080 --> 00:14:16,640
like I<font color="#E5E5E5"> want</font><font color="#CCCCCC"> to see what happened next</font>

310
00:14:14,270 --> 00:14:20,000
<font color="#E5E5E5">maybe it connects to some other parts of</font>

311
00:14:16,640 --> 00:14:23,780
the attackers<font color="#E5E5E5"> infrastructure maybe I</font>

312
00:14:20,000 --> 00:14:25,670
will uncover something else<font color="#E5E5E5"> nothing to</font>

313
00:14:23,780 --> 00:14:28,100
see<font color="#E5E5E5"> because that's pretty</font><font color="#CCCCCC"> much what I</font>

314
00:14:25,670 --> 00:14:31,329
can show<font color="#E5E5E5"> about this particular incident</font>

315
00:14:28,100 --> 00:14:34,070
<font color="#E5E5E5">but let me just tell</font><font color="#CCCCCC"> you why by default</font>

316
00:14:31,330 --> 00:14:36,350
<font color="#E5E5E5">using an open source</font><font color="#CCCCCC"> solution like</font><font color="#E5E5E5"> bro</font>

317
00:14:34,070 --> 00:14:39,470
allowed us to analyze all<font color="#E5E5E5"> of these</font>

318
00:14:36,350 --> 00:14:42,620
protocols that you see here and<font color="#E5E5E5"> all of</font>

319
00:14:39,470 --> 00:14:44,780
these protocols<font color="#E5E5E5"> analyzers generate logs</font>

320
00:14:42,620 --> 00:14:46,340
by default<font color="#E5E5E5"> so you just throw bro into</font>

321
00:14:44,780 --> 00:14:48,230
your<font color="#E5E5E5"> network and you</font><font color="#CCCCCC"> have all these</font>

322
00:14:46,340 --> 00:14:53,840
<font color="#E5E5E5">protocols analyzed at the detailed level</font>

323
00:14:48,230 --> 00:14:57,530
<font color="#E5E5E5">and yes varies like varies like ntlm and</font>

324
00:14:53,840 --> 00:14:58,850
Kerberos<font color="#CCCCCC"> and</font><font color="#E5E5E5"> whatnot if if you see a</font>

325
00:14:57,530 --> 00:15:01,550
protocol<font color="#CCCCCC"> that you'd like to have</font>

326
00:14:58,850 --> 00:15:04,430
analyzed<font color="#E5E5E5"> is not here you can have your</font>

327
00:15:01,550 --> 00:15:07,189
own analyzer very easily<font color="#E5E5E5"> and it's all</font>

328
00:15:04,430 --> 00:15:10,729
port independent if<font color="#CCCCCC"> the traffic flows</font>

329
00:15:07,190 --> 00:15:13,130
over not standard port<font color="#E5E5E5"> there's not a</font>

330
00:15:10,730 --> 00:15:16,460
problem<font color="#CCCCCC"> and every piece of information</font>

331
00:15:13,130 --> 00:15:18,680
is connected<font color="#E5E5E5"> but you IDs the</font><font color="#CCCCCC"> why UID is</font>

332
00:15:16,460 --> 00:15:21,700
calculated it's a standard<font color="#E5E5E5"> five double</font>

333
00:15:18,680 --> 00:15:24,530
IP source destination ports whatever

334
00:15:21,700 --> 00:15:26,570
<font color="#CCCCCC">this connection ID is preserved</font><font color="#E5E5E5"> across</font>

335
00:15:24,530 --> 00:15:27,620
various logs<font color="#E5E5E5"> and I will show you in a</font>

336
00:15:26,570 --> 00:15:30,110
second how it works

337
00:15:27,620 --> 00:15:30,649
<font color="#E5E5E5">the good news is that the</font><font color="#CCCCCC"> broad ideas</font>

338
00:15:30,110 --> 00:15:33,170
and<font color="#E5E5E5"> sir</font>

339
00:15:30,649 --> 00:15:35,509
got ideas and network vendors<font color="#E5E5E5"> they</font>

340
00:15:33,170 --> 00:15:38,628
started to cooperate<font color="#CCCCCC"> so you will</font><font color="#E5E5E5"> be like</font>

341
00:15:35,509 --> 00:15:40,519
able<font color="#E5E5E5"> to pivot between logs from let's</font>

342
00:15:38,629 --> 00:15:42,170
say so ricotta detected<font color="#CCCCCC"> something you go</font>

343
00:15:40,519 --> 00:15:44,779
to bro you<font color="#E5E5E5"> have the same connection ID</font>

344
00:15:42,170 --> 00:15:46,490
<font color="#E5E5E5">you</font><font color="#CCCCCC"> ask bro what it detected when you</font>

345
00:15:44,779 --> 00:15:52,309
pivot to<font color="#CCCCCC"> your sis compliance your</font>

346
00:15:46,490 --> 00:15:54,139
<font color="#E5E5E5">juniper appliance</font><font color="#CCCCCC"> what not</font><font color="#E5E5E5"> so let's take</font>

347
00:15:52,309 --> 00:15:56,929
an<font color="#CCCCCC"> example let's take</font><font color="#E5E5E5"> a look at an</font>

348
00:15:54,139 --> 00:15:58,939
example<font color="#E5E5E5"> let's say I want to see who</font>

349
00:15:56,929 --> 00:16:01,579
downloaded<font color="#E5E5E5"> some suspicious Windows PE</font>

350
00:15:58,939 --> 00:16:07,639
file<font color="#E5E5E5"> suspicious for me in these guys</font>

351
00:16:01,579 --> 00:16:09,859
means it's been not<font color="#E5E5E5"> 64-bit and I have a</font>

352
00:16:07,639 --> 00:16:12,170
log because<font color="#E5E5E5"> what brought us by default</font>

353
00:16:09,860 --> 00:16:17,569
<font color="#E5E5E5">if it can see a Windows PE file</font><font color="#CCCCCC"> it</font>

354
00:16:12,170 --> 00:16:19,790
<font color="#E5E5E5">analyzes it analyzes this file and right</font>

355
00:16:17,569 --> 00:16:21,649
away<font color="#E5E5E5"> you can see why I'm worried about a</font>

356
00:16:19,790 --> 00:16:25,610
file like<font color="#E5E5E5"> this it's compatible</font><font color="#CCCCCC"> with</font>

357
00:16:21,649 --> 00:16:28,279
Windows 95 windows NT<font color="#E5E5E5"> 4 0 it has</font><font color="#CCCCCC"> upx</font>

358
00:16:25,610 --> 00:16:31,100
headers and it<font color="#CCCCCC"> misses pretty much every</font>

359
00:16:28,279 --> 00:16:34,309
hardening feature that is our binary

360
00:16:31,100 --> 00:16:38,509
hardening feature that is out<font color="#CCCCCC"> there</font><font color="#E5E5E5"> many</font>

361
00:16:34,309 --> 00:16:40,129
of malware sample is like<font color="#E5E5E5"> look-alike so</font>

362
00:16:38,509 --> 00:16:41,540
I want<font color="#CCCCCC"> to know who downloaded</font><font color="#E5E5E5"> this file</font>

363
00:16:40,129 --> 00:16:44,569
<font color="#E5E5E5">and what happened next</font>

364
00:16:41,540 --> 00:16:47,719
so where<font color="#CCCCCC"> you go</font><font color="#E5E5E5"> I can pivot from the PE</font>

365
00:16:44,569 --> 00:16:49,998
<font color="#CCCCCC">log to http log to what not</font><font color="#E5E5E5"> to what else</font>

366
00:16:47,720 --> 00:16:52,120
<font color="#E5E5E5">and</font><font color="#CCCCCC"> no I will not spend next time</font><font color="#E5E5E5"> next</font>

367
00:16:49,999 --> 00:16:55,420
<font color="#CCCCCC">10</font><font color="#E5E5E5"> minutes</font><font color="#CCCCCC"> trying to</font><font color="#E5E5E5"> go for this diagram</font>

368
00:16:52,120 --> 00:16:57,679
but<font color="#CCCCCC"> the point here is</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> show that you</font>

369
00:16:55,420 --> 00:16:59,599
<font color="#CCCCCC">catch some suspicious in pieces of</font>

370
00:16:57,679 --> 00:17:01,490
information you can<font color="#CCCCCC"> get some</font><font color="#E5E5E5"> contextual</font>

371
00:16:59,600 --> 00:17:04,099
information to raise your contextual

372
00:17:01,490 --> 00:17:06,559
awareness<font color="#E5E5E5"> so I started looking what bro</font>

373
00:17:04,099 --> 00:17:09,469
knows about this<font color="#E5E5E5"> file and the bro was</font>

374
00:17:06,559 --> 00:17:14,178
like hey I saw<font color="#CCCCCC"> this host doubling this</font>

375
00:17:09,470 --> 00:17:16,640
file<font color="#E5E5E5"> over HTTP</font><font color="#CCCCCC"> got okay let's see</font><font color="#E5E5E5"> what</font>

376
00:17:14,179 --> 00:17:19,630
<font color="#E5E5E5">else do we have here so I pivot to the</font>

377
00:17:16,640 --> 00:17:22,819
HTTP<font color="#E5E5E5"> log and the HTTP lock talons me the</font>

378
00:17:19,630 --> 00:17:24,559
suspicious GPX file was downloaded<font color="#CCCCCC"> from</font>

379
00:17:22,819 --> 00:17:27,470
something called<font color="#CCCCCC"> webpagetest</font>

380
00:17:24,559 --> 00:17:30,070
<font color="#CCCCCC">I don't know what is webpagetest but at</font>

381
00:17:27,470 --> 00:17:33,529
least I know who did<font color="#CCCCCC"> what</font><font color="#E5E5E5"> and</font>

382
00:17:30,070 --> 00:17:36,049
<font color="#E5E5E5">unfortunately if you take a look at the</font>

383
00:17:33,529 --> 00:17:40,490
URL<font color="#E5E5E5"> what was also recorded</font><font color="#CCCCCC"> by</font><font color="#E5E5E5"> our system</font>

384
00:17:36,049 --> 00:17:42,710
it is a path<font color="#CCCCCC"> to</font><font color="#E5E5E5"> the nightly browser so I</font>

385
00:17:40,490 --> 00:17:43,790
learned two things first<font color="#E5E5E5"> of all my</font>

386
00:17:42,710 --> 00:17:46,610
system is not in fact

387
00:17:43,790 --> 00:17:50,510
that second<font color="#E5E5E5"> we pack some installers with</font>

388
00:17:46,610 --> 00:17:52,879
<font color="#CCCCCC">upx I don't know why but I will raise</font>

389
00:17:50,510 --> 00:17:55,010
some<font color="#E5E5E5"> objections internally so the lesson</font>

390
00:17:52,880 --> 00:17:56,930
<font color="#CCCCCC">learned here is first of</font><font color="#E5E5E5"> all you can</font>

391
00:17:55,010 --> 00:17:58,310
pivot through various kinds<font color="#CCCCCC"> of locks in</font>

392
00:17:56,930 --> 00:18:01,010
brought to give you a contextual

393
00:17:58,310 --> 00:18:03,320
information<font color="#E5E5E5"> second in mozilla detection</font>

394
00:18:01,010 --> 00:18:07,160
is difficult<font color="#E5E5E5"> because nothing is what it</font>

395
00:18:03,320 --> 00:18:09,139
seems to<font color="#CCCCCC"> be and by the way a quick</font><font color="#E5E5E5"> look</font>

396
00:18:07,160 --> 00:18:11,240
at the<font color="#CCCCCC"> Samba protocol</font><font color="#E5E5E5"> if you have a</font>

397
00:18:09,140 --> 00:18:13,760
Samba<font color="#CCCCCC"> network if</font><font color="#E5E5E5"> you have a</font><font color="#CCCCCC"> Active</font>

398
00:18:11,240 --> 00:18:16,850
<font color="#CCCCCC">Directory Network what you are looking</font>

399
00:18:13,760 --> 00:18:20,690
at is an<font color="#E5E5E5"> actual sample file open</font>

400
00:18:16,850 --> 00:18:22,490
operation<font color="#E5E5E5"> from from a</font><font color="#CCCCCC"> shell in</font><font color="#E5E5E5"> Active</font>

401
00:18:20,690 --> 00:18:24,710
<font color="#E5E5E5">Directory</font><font color="#CCCCCC"> network showing you the</font>

402
00:18:22,490 --> 00:18:26,480
hostname the domain the full path to the

403
00:18:24,710 --> 00:18:28,220
file on<font color="#CCCCCC"> the</font><font color="#E5E5E5"> server</font>

404
00:18:26,480 --> 00:18:30,860
pretty much everything<font color="#CCCCCC"> you can</font><font color="#E5E5E5"> give us</font>

405
00:18:28,220 --> 00:18:37,130
<font color="#E5E5E5">from here to actual connections so</font>

406
00:18:30,860 --> 00:18:39,139
that's kind of useful<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is a break so</font>

407
00:18:37,130 --> 00:18:41,150
I can actually<font color="#E5E5E5"> drink something</font><font color="#CCCCCC"> but the</font>

408
00:18:39,140 --> 00:18:43,550
quality of<font color="#CCCCCC"> a bro talk is closely related</font>

409
00:18:41,150 --> 00:18:45,740
to<font color="#E5E5E5"> the number</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the pyramids in the</font>

410
00:18:43,550 --> 00:18:50,180
presentation<font color="#E5E5E5"> so I decided to go like a</font>

411
00:18:45,740 --> 00:18:54,710
<font color="#CCCCCC">full-scale here we have this internal</font>

412
00:18:50,180 --> 00:18:56,930
joke in the broad ideas community but

413
00:18:54,710 --> 00:19:02,810
every presentation<font color="#E5E5E5"> has to feature at</font>

414
00:18:56,930 --> 00:19:04,790
<font color="#CCCCCC">least one</font><font color="#E5E5E5"> parameter so</font><font color="#CCCCCC"> 2015 2016 broken</font>

415
00:19:02,810 --> 00:19:06,679
which is a broad conference<font color="#E5E5E5"> pretty much</font>

416
00:19:04,790 --> 00:19:09,260
every presentation<font color="#E5E5E5"> has a buyer on it</font>

417
00:19:06,680 --> 00:19:11,180
so it was<font color="#E5E5E5"> like what I am I was like I</font>

418
00:19:09,260 --> 00:19:13,610
cannot be any worse<font color="#E5E5E5"> and I started</font>

419
00:19:11,180 --> 00:19:14,690
<font color="#E5E5E5">learning some Adobe tools so that's as</font>

420
00:19:13,610 --> 00:19:18,550
good as it<font color="#CCCCCC"> gets</font>

421
00:19:14,690 --> 00:19:22,670
I'm an engineer<font color="#CCCCCC"> I spent 4 hours on it</font>

422
00:19:18,550 --> 00:19:24,379
and the point<font color="#E5E5E5"> I am showing you is first</font>

423
00:19:22,670 --> 00:19:27,230
of all to win the pyramid content

424
00:19:24,380 --> 00:19:29,570
contest<font color="#E5E5E5"> and second to show you that we</font>

425
00:19:27,230 --> 00:19:30,500
use network security monitoring<font color="#E5E5E5"> at every</font>

426
00:19:29,570 --> 00:19:32,360
<font color="#E5E5E5">layer</font><font color="#CCCCCC"> of detection</font>

427
00:19:30,500 --> 00:19:35,690
you know this<font color="#CCCCCC"> pyramid this is a pyramid</font>

428
00:19:32,360 --> 00:19:37,820
of pain and you can detect<font color="#E5E5E5"> IP addresses</font>

429
00:19:35,690 --> 00:19:40,730
hash values domain names pretty easily

430
00:19:37,820 --> 00:19:44,000
with everything and the attacker can add

431
00:19:40,730 --> 00:19:46,610
a single<font color="#CCCCCC"> byte to your file and the harsh</font>

432
00:19:44,000 --> 00:19:48,860
changes the IP can be changed<font color="#CCCCCC"> very</font>

433
00:19:46,610 --> 00:19:51,590
easily<font color="#E5E5E5"> but we also look for something</font>

434
00:19:48,860 --> 00:19:53,479
<font color="#CCCCCC">that is wrong on the network layer we</font>

435
00:19:51,590 --> 00:19:55,340
might not<font color="#E5E5E5"> yet know what is wrong</font><font color="#CCCCCC"> want to</font>

436
00:19:53,480 --> 00:19:57,670
be able<font color="#E5E5E5"> to detect tools on the network</font>

437
00:19:55,340 --> 00:20:00,129
layer<font color="#E5E5E5"> and you are like how</font>

438
00:19:57,670 --> 00:20:03,850
the tech tools on the network layer<font color="#CCCCCC"> and</font>

439
00:20:00,130 --> 00:20:05,650
I'm like those<font color="#E5E5E5"> Salesforce people from</font>

440
00:20:03,850 --> 00:20:09,159
yet<font color="#E5E5E5"> this size first they actually</font><font color="#CCCCCC"> run</font><font color="#E5E5E5"> a</font>

441
00:20:05,650 --> 00:20:11,200
giant broadcaster<font color="#CCCCCC"> we</font><font color="#E5E5E5"> were smart enough</font>

442
00:20:09,160 --> 00:20:13,360
<font color="#E5E5E5">to notice something interesting</font><font color="#CCCCCC"> they</font>

443
00:20:11,200 --> 00:20:17,020
<font color="#E5E5E5">were like the SSL proposal</font><font color="#CCCCCC"> it's very</font>

444
00:20:13,360 --> 00:20:19,750
unique<font color="#E5E5E5"> what if we took when two systems</font>

445
00:20:17,020 --> 00:20:22,360
start<font color="#CCCCCC"> to communicate</font><font color="#E5E5E5"> over SSL the client</font>

446
00:20:19,750 --> 00:20:24,340
sends<font color="#E5E5E5"> the SSL handshake telling</font><font color="#CCCCCC"> okay</font>

447
00:20:22,360 --> 00:20:26,850
these are things that<font color="#E5E5E5"> I support these</font>

448
00:20:24,340 --> 00:20:30,340
are the<font color="#E5E5E5"> protocols</font><font color="#CCCCCC"> I can talk</font><font color="#E5E5E5"> to you over</font>

449
00:20:26,850 --> 00:20:33,010
and a number<font color="#CCCCCC"> of</font><font color="#E5E5E5"> information sent by the</font>

450
00:20:30,340 --> 00:20:36,220
client<font color="#E5E5E5"> is</font><font color="#CCCCCC"> very unique so what they do is</font>

451
00:20:33,010 --> 00:20:40,270
they calculate md5 hash and then<font color="#E5E5E5"> you</font>

452
00:20:36,220 --> 00:20:42,010
have a<font color="#E5E5E5"> unique fingerprint pair up</font><font color="#CCCCCC"> it's</font>

453
00:20:40,270 --> 00:20:45,430
so cool<font color="#E5E5E5"> I cannot even begin to describe</font>

454
00:20:42,010 --> 00:20:47,920
<font color="#E5E5E5">it</font><font color="#CCCCCC"> so basically</font><font color="#E5E5E5"> if</font><font color="#CCCCCC"> you know your network</font>

455
00:20:45,430 --> 00:20:50,830
<font color="#E5E5E5">well you might whitelist every known</font>

456
00:20:47,920 --> 00:20:52,890
fingerprint and alert or anything else

457
00:20:50,830 --> 00:20:55,120
<font color="#E5E5E5">that's what some people do in the</font>

458
00:20:52,890 --> 00:20:56,860
industrial control networks<font color="#E5E5E5"> in the</font>

459
00:20:55,120 --> 00:20:58,629
industrial control networks<font color="#E5E5E5"> you should</font>

460
00:20:56,860 --> 00:21:00,340
be able to know every fingerprint<font color="#E5E5E5"> of</font>

461
00:20:58,630 --> 00:21:02,080
<font color="#E5E5E5">application</font><font color="#CCCCCC"> that you have inside</font><font color="#E5E5E5"> and</font>

462
00:21:00,340 --> 00:21:04,659
when you alert on something that has

463
00:21:02,080 --> 00:21:06,250
never<font color="#CCCCCC"> been in there</font><font color="#E5E5E5"> before</font><font color="#CCCCCC"> or maybe</font><font color="#E5E5E5"> you</font>

464
00:21:04,660 --> 00:21:08,170
want to like me<font color="#E5E5E5"> you don't know</font>

465
00:21:06,250 --> 00:21:11,170
<font color="#E5E5E5">everything</font><font color="#CCCCCC"> but you</font><font color="#E5E5E5"> want to hunt for</font>

466
00:21:08,170 --> 00:21:14,140
unusual<font color="#E5E5E5"> fingerprints so you are like I</font>

467
00:21:11,170 --> 00:21:16,720
have<font color="#E5E5E5"> like millions</font><font color="#CCCCCC"> of these</font><font color="#E5E5E5"> fingerprints</font>

468
00:21:14,140 --> 00:21:19,150
<font color="#E5E5E5">but I have only ten fingerprints coming</font>

469
00:21:16,720 --> 00:21:20,380
from like<font color="#E5E5E5"> three systems for something I</font>

470
00:21:19,150 --> 00:21:24,220
<font color="#E5E5E5">don't know what it is you</font><font color="#CCCCCC"> might take</font><font color="#E5E5E5"> a</font>

471
00:21:20,380 --> 00:21:26,350
closer look<font color="#E5E5E5"> at those systems so</font><font color="#CCCCCC"> vert is</font>

472
00:21:24,220 --> 00:21:28,120
<font color="#E5E5E5">a reason my friends look at me like this</font>

473
00:21:26,350 --> 00:21:32,560
and<font color="#E5E5E5"> we think that's basically what</font><font color="#CCCCCC"> my</font>

474
00:21:28,120 --> 00:21:38,770
day of work looks<font color="#CCCCCC"> like</font><font color="#E5E5E5"> switch</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> quickly</font>

475
00:21:32,560 --> 00:21:41,409
to the<font color="#E5E5E5"> IOC part of</font><font color="#CCCCCC"> their presentation in</font>

476
00:21:38,770 --> 00:21:44,170
the hunt for IOC<font color="#E5E5E5"> so when you think I</font>

477
00:21:41,410 --> 00:21:46,870
will see you think like IP source IP

478
00:21:44,170 --> 00:21:49,060
destination maybe some domain name but

479
00:21:46,870 --> 00:21:51,729
we have some<font color="#CCCCCC"> very unusual iosys</font><font color="#E5E5E5"> I want</font>

480
00:21:49,060 --> 00:21:54,280
to be able<font color="#E5E5E5"> to match MAC address the URL</font>

481
00:21:51,730 --> 00:21:56,890
<font color="#CCCCCC">I want to be able to merge some file</font>

482
00:21:54,280 --> 00:22:00,370
cache or maybe a certificate serial

483
00:21:56,890 --> 00:22:03,220
number or maybe another<font color="#E5E5E5"> hash</font><font color="#CCCCCC"> or maybe I</font>

484
00:22:00,370 --> 00:22:05,620
want<font color="#CCCCCC"> to match everything</font><font color="#E5E5E5"> that was issued</font>

485
00:22:03,220 --> 00:22:08,590
<font color="#E5E5E5">by some particular CI and this</font><font color="#CCCCCC"> yay got</font>

486
00:22:05,620 --> 00:22:10,719
compromised<font color="#CCCCCC"> I want to be able to merge</font>

487
00:22:08,590 --> 00:22:12,428
on certain<font color="#E5E5E5"> other fields in the SSL</font>

488
00:22:10,720 --> 00:22:16,720
difficult because<font color="#E5E5E5"> everything goes over</font>

489
00:22:12,429 --> 00:22:18,730
<font color="#CCCCCC">as a cell</font><font color="#E5E5E5"> maybe I want to match on</font>

490
00:22:16,720 --> 00:22:23,610
avarice SLE certificate that was issued

491
00:22:18,730 --> 00:22:23,610
<font color="#E5E5E5">past or before some date</font><font color="#CCCCCC"> or maybe</font><font color="#E5E5E5"> even</font>

492
00:22:24,179 --> 00:22:30,549
the<font color="#E5E5E5"> user-agent used and not only my</font><font color="#CCCCCC"> IOC</font>

493
00:22:28,480 --> 00:22:32,890
<font color="#CCCCCC">s are very strange I want to look</font><font color="#E5E5E5"> for</font>

494
00:22:30,549 --> 00:22:35,139
IOC s in a very strange places if you

495
00:22:32,890 --> 00:22:38,350
<font color="#E5E5E5">think</font><font color="#CCCCCC"> inter-domain the standard and</font>

496
00:22:35,140 --> 00:22:41,230
classic way too much<font color="#CCCCCC"> dns name is in the</font>

497
00:22:38,350 --> 00:22:43,899
<font color="#E5E5E5">DNS logs but I want to look for DNS name</font>

498
00:22:41,230 --> 00:22:46,929
in the SSL certificate<font color="#CCCCCC"> the server number</font>

499
00:22:43,900 --> 00:22:49,179
<font color="#CCCCCC">was requested the HTTP host header and</font>

500
00:22:46,929 --> 00:22:52,360
basically everywhere when<font color="#E5E5E5"> the domain</font>

501
00:22:49,179 --> 00:22:55,480
name<font color="#E5E5E5"> can exist same thing for IP address</font>

502
00:22:52,360 --> 00:22:58,120
<font color="#E5E5E5">with sniff traffic between back-end and</font>

503
00:22:55,480 --> 00:22:59,770
<font color="#CCCCCC">load balancers and</font><font color="#E5E5E5"> this traffic has a</font>

504
00:22:58,120 --> 00:23:02,229
source IP<font color="#CCCCCC"> of the load balancers</font>

505
00:22:59,770 --> 00:23:05,350
obviously so the true client IP<font color="#E5E5E5"> is</font>

506
00:23:02,230 --> 00:23:07,150
hidden in some custom HTTP header so

507
00:23:05,350 --> 00:23:10,959
what I did with like five lines<font color="#E5E5E5"> of code</font>

508
00:23:07,150 --> 00:23:12,760
<font color="#CCCCCC">I implemented</font><font color="#E5E5E5"> client IP header matching</font>

509
00:23:10,960 --> 00:23:17,289
<font color="#CCCCCC">against the intelligence framework so I</font>

510
00:23:12,760 --> 00:23:19,539
can match<font color="#CCCCCC"> their if matching</font><font color="#E5E5E5"> a single IOC</font>

511
00:23:17,289 --> 00:23:22,450
is not enough for<font color="#E5E5E5"> you</font><font color="#CCCCCC"> you can</font><font color="#E5E5E5"> totally do</font>

512
00:23:19,539 --> 00:23:25,169
something like<font color="#E5E5E5"> a combined</font><font color="#CCCCCC"> iOS</font><font color="#E5E5E5"> and let's</font>

513
00:23:22,450 --> 00:23:27,210
say and<font color="#CCCCCC"> heavily CI has been compromised</font>

514
00:23:25,169 --> 00:23:29,740
<font color="#E5E5E5">you want too much every single</font>

515
00:23:27,210 --> 00:23:32,080
certificate<font color="#E5E5E5"> past the compromised or</font>

516
00:23:29,740 --> 00:23:36,220
previous or whatever you can combine

517
00:23:32,080 --> 00:23:38,980
things if you want to deploy many of

518
00:23:36,220 --> 00:23:41,380
these functionalities with some vendors

519
00:23:38,980 --> 00:23:44,230
they are happy<font color="#E5E5E5"> to deploy it for you if</font>

520
00:23:41,380 --> 00:23:46,539
you<font color="#CCCCCC"> send enough cash I might not have</font>

521
00:23:44,230 --> 00:23:48,549
<font color="#E5E5E5">enough cash</font><font color="#CCCCCC"> around because</font><font color="#E5E5E5"> I just load a</font>

522
00:23:46,539 --> 00:23:52,658
single text file with enough code and

523
00:23:48,549 --> 00:23:55,059
yeah<font color="#E5E5E5"> so that's just an example of log</font>

524
00:23:52,659 --> 00:24:00,460
file here we merged malicious domain

525
00:23:55,059 --> 00:24:02,639
<font color="#E5E5E5">inside of the SSL</font><font color="#CCCCCC"> certificate and here</font>

526
00:24:00,460 --> 00:24:06,100
we merged

527
00:24:02,640 --> 00:24:08,409
<font color="#E5E5E5">client source IP in the</font><font color="#CCCCCC"> custom HTTP</font>

528
00:24:06,100 --> 00:24:12,639
header<font color="#CCCCCC"> that does not</font><font color="#E5E5E5"> exist probably</font>

529
00:24:08,409 --> 00:24:14,230
anywhere outside of Mozilla and I got a

530
00:24:12,640 --> 00:24:20,010
question<font color="#E5E5E5"> for</font><font color="#CCCCCC"> you when do you think</font>

531
00:24:14,230 --> 00:24:20,010
<font color="#E5E5E5">matching</font><font color="#CCCCCC"> iosys</font><font color="#E5E5E5"> is most important</font>

532
00:24:21,330 --> 00:24:25,789
so matching IOC<font color="#CCCCCC"> s for us is most</font>

533
00:24:23,580 --> 00:24:28,110
important during<font color="#E5E5E5"> the internal response</font>

534
00:24:25,789 --> 00:24:33,210
<font color="#CCCCCC">because you are doing something</font><font color="#E5E5E5"> like</font>

535
00:24:28,110 --> 00:24:36,090
this<font color="#CCCCCC"> you detect some compromised</font><font color="#E5E5E5"> asset</font>

536
00:24:33,210 --> 00:24:38,009
and this asset has a back<font color="#E5E5E5"> door on it you</font>

537
00:24:36,090 --> 00:24:40,139
take it<font color="#E5E5E5"> and it is back door for</font><font color="#CCCCCC"> example</font>

538
00:24:38,009 --> 00:24:44,519
communicates with a CNC server on the

539
00:24:40,139 --> 00:24:47,428
<font color="#CCCCCC">internet</font><font color="#E5E5E5"> you take this IP</font><font color="#CCCCCC"> of the CNC</font>

540
00:24:44,519 --> 00:24:52,110
server<font color="#E5E5E5"> you deploy</font><font color="#CCCCCC"> it into</font><font color="#E5E5E5"> the back into</font>

541
00:24:47,429 --> 00:24:56,460
<font color="#CCCCCC">the NSM</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> NSM in five minutes later</font><font color="#E5E5E5"> is</font>

542
00:24:52,110 --> 00:25:01,379
like<font color="#CCCCCC"> hey I found</font><font color="#E5E5E5"> some more</font><font color="#CCCCCC"> hosts</font><font color="#E5E5E5"> talking</font>

543
00:24:56,460 --> 00:25:16,580
<font color="#E5E5E5">to the CNC server how are you doing on</font>

544
00:25:01,379 --> 00:25:16,580
time how are<font color="#CCCCCC"> we doing</font><font color="#E5E5E5"> on time</font><font color="#CCCCCC"> ok ok</font>

545
00:25:18,340 --> 00:25:23,389
some other<font color="#CCCCCC"> questions</font><font color="#E5E5E5"> that we like</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> ask</font>

546
00:25:20,780 --> 00:25:28,760
<font color="#CCCCCC">I like to analyze like a back door</font>

547
00:25:23,390 --> 00:25:31,970
traffic as well and the<font color="#E5E5E5"> last thing that</font>

548
00:25:28,760 --> 00:25:34,310
<font color="#E5E5E5">I really like to</font><font color="#CCCCCC"> use</font><font color="#E5E5E5"> the NSM for is to</font>

549
00:25:31,970 --> 00:25:36,140
prove some people wrong<font color="#CCCCCC"> someone holding</font>

550
00:25:34,310 --> 00:25:37,879
<font color="#E5E5E5">that is impossible</font><font color="#CCCCCC"> to sniff and</font>

551
00:25:36,140 --> 00:25:42,530
correctly assemble the traffic between

552
00:25:37,880 --> 00:25:45,620
load balancers<font color="#E5E5E5"> and the</font><font color="#CCCCCC"> backend if the</font>

553
00:25:42,530 --> 00:25:47,810
load balancer does HTTP multiplexing<font color="#E5E5E5"> so</font>

554
00:25:45,620 --> 00:25:49,729
first of<font color="#E5E5E5"> all do not ever tell me</font>

555
00:25:47,810 --> 00:25:52,330
something is impossible<font color="#CCCCCC"> because I will</font>

556
00:25:49,730 --> 00:25:56,660
spend a lot of time on it<font color="#CCCCCC"> and second</font>

557
00:25:52,330 --> 00:25:59,659
unfortunately I had<font color="#CCCCCC"> to spend no time on</font>

558
00:25:56,660 --> 00:26:03,650
it because everything<font color="#CCCCCC"> is supported</font><font color="#E5E5E5"> out</font>

559
00:25:59,660 --> 00:26:06,470
<font color="#E5E5E5">of the box some other things that we do</font>

560
00:26:03,650 --> 00:26:08,960
I want to know when internal system

561
00:26:06,470 --> 00:26:11,120
started scanning<font color="#CCCCCC"> internet</font><font color="#E5E5E5"> if the</font>

562
00:26:08,960 --> 00:26:14,420
<font color="#CCCCCC">internet is scanning</font><font color="#E5E5E5"> us that's true for</font>

563
00:26:11,120 --> 00:26:16,610
every one of you but<font color="#E5E5E5"> I want to know when</font>

564
00:26:14,420 --> 00:26:21,200
one<font color="#CCCCCC"> of my systems suddenly started</font>

565
00:26:16,610 --> 00:26:23,959
scanning my network why and everything

566
00:26:21,200 --> 00:26:26,060
<font color="#E5E5E5">really like is</font><font color="#CCCCCC"> to use</font><font color="#E5E5E5"> an SM for the</font>

567
00:26:23,960 --> 00:26:28,280
vulnerability management<font color="#E5E5E5"> we do the</font>

568
00:26:26,060 --> 00:26:29,419
traditional vulnerability management but

569
00:26:28,280 --> 00:26:34,790
sometimes we don't<font color="#E5E5E5"> have enough</font>

570
00:26:29,420 --> 00:26:37,970
visibility<font color="#E5E5E5"> so when our operations team</font>

571
00:26:34,790 --> 00:26:39,770
<font color="#CCCCCC">asked</font><font color="#E5E5E5"> me hey do we run this protocol do</font>

572
00:26:37,970 --> 00:26:43,820
we run<font color="#E5E5E5"> this application I'm asked</font><font color="#CCCCCC"> you're</font>

573
00:26:39,770 --> 00:26:48,620
asking me and second excellent<font color="#CCCCCC"> choice</font>

574
00:26:43,820 --> 00:26:51,230
<font color="#CCCCCC">because we probably</font><font color="#E5E5E5"> know about it so</font>

575
00:26:48,620 --> 00:26:53,209
when something<font color="#E5E5E5"> like poodle attack</font>

576
00:26:51,230 --> 00:26:56,090
happened and you had to disable SSL free

577
00:26:53,210 --> 00:26:58,970
or you had<font color="#CCCCCC"> to disable our C</font><font color="#E5E5E5"> for our</font>

578
00:26:56,090 --> 00:27:00,830
management<font color="#E5E5E5"> wanted to know what will fail</font>

579
00:26:58,970 --> 00:27:02,750
what what parts of clients will be

580
00:27:00,830 --> 00:27:06,139
impacted and will not be<font color="#E5E5E5"> able to</font><font color="#CCCCCC"> connect</font>

581
00:27:02,750 --> 00:27:08,180
to<font color="#E5E5E5"> us anymore because you know we</font><font color="#CCCCCC"> just</font>

582
00:27:06,140 --> 00:27:11,300
cannot<font color="#E5E5E5"> fail so we have to switch over</font>

583
00:27:08,180 --> 00:27:14,390
every server<font color="#CCCCCC"> buzz was using SSL</font><font color="#E5E5E5"> to</font>

584
00:27:11,300 --> 00:27:16,450
something else<font color="#E5E5E5"> so if a simple query like</font>

585
00:27:14,390 --> 00:27:16,450
<font color="#E5E5E5">this</font>

586
00:27:23,830 --> 00:27:31,580
so<font color="#CCCCCC"> if with a simple query like</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> we</font>

587
00:27:29,750 --> 00:27:35,900
were<font color="#CCCCCC"> able to discover our system using</font>

588
00:27:31,580 --> 00:27:38,480
<font color="#E5E5E5">SSL free we also use it to kind of look</font>

589
00:27:35,900 --> 00:27:40,900
at<font color="#E5E5E5"> the appliance compliance kind of</font>

590
00:27:38,480 --> 00:27:43,309
thing<font color="#CCCCCC"> sometimes you can do a traditional</font>

591
00:27:40,900 --> 00:27:45,920
vulnerability scanning<font color="#E5E5E5"> sometimes you</font>

592
00:27:43,309 --> 00:27:48,530
<font color="#CCCCCC">cannot</font><font color="#E5E5E5"> but I can see user agents coming</font>

593
00:27:45,920 --> 00:27:51,200
out of the appliance<font color="#CCCCCC"> I can see I</font><font color="#E5E5E5"> can do</font>

594
00:27:48,530 --> 00:27:53,809
some<font color="#E5E5E5"> fingerprinting of the traffic so in</font>

595
00:27:51,200 --> 00:27:57,890
a scenario<font color="#CCCCCC"> like this</font><font color="#E5E5E5"> what I do is I</font>

596
00:27:53,809 --> 00:28:00,290
treat the appliance like<font color="#E5E5E5"> a black box and</font>

597
00:27:57,890 --> 00:28:05,090
I try to learn something<font color="#E5E5E5"> about the black</font>

598
00:28:00,290 --> 00:28:07,790
box but<font color="#CCCCCC"> I cannot</font><font color="#E5E5E5"> login into let's say</font>

599
00:28:05,090 --> 00:28:10,370
<font color="#CCCCCC">you were fighting</font><font color="#E5E5E5"> with</font><font color="#CCCCCC"> like the poodle</font>

600
00:28:07,790 --> 00:28:12,740
<font color="#E5E5E5">attack and you don't have the SSL free</font>

601
00:28:10,370 --> 00:28:15,139
protocol<font color="#CCCCCC"> in your network</font><font color="#E5E5E5"> anymore</font><font color="#CCCCCC"> when</font>

602
00:28:12,740 --> 00:28:16,820
some team buys an appliance<font color="#E5E5E5"> and this</font>

603
00:28:15,140 --> 00:28:17,990
appliance vendor does not care about<font color="#CCCCCC"> the</font>

604
00:28:16,820 --> 00:28:19,970
<font color="#E5E5E5">security at all</font>

605
00:28:17,990 --> 00:28:22,940
they<font color="#CCCCCC"> deploy this appliance</font><font color="#E5E5E5"> and this</font>

606
00:28:19,970 --> 00:28:24,890
appliance<font color="#E5E5E5"> speaks SSL version free if you</font>

607
00:28:22,940 --> 00:28:27,770
don't<font color="#E5E5E5"> have monitoring on</font><font color="#CCCCCC"> the network</font>

608
00:28:24,890 --> 00:28:29,720
layer<font color="#E5E5E5"> you would probably miss something</font>

609
00:28:27,770 --> 00:28:33,770
like this<font color="#E5E5E5"> after a year</font><font color="#CCCCCC"> or so so I like</font>

610
00:28:29,720 --> 00:28:38,750
<font color="#CCCCCC">to keep this</font><font color="#E5E5E5"> detection in place or maybe</font>

611
00:28:33,770 --> 00:28:40,960
<font color="#E5E5E5">this appliance does not have it does</font><font color="#CCCCCC"> not</font>

612
00:28:38,750 --> 00:28:43,790
produce any<font color="#E5E5E5"> kind of useful logging data</font>

613
00:28:40,960 --> 00:28:45,140
<font color="#E5E5E5">well at least I can observe the network</font>

614
00:28:43,790 --> 00:28:48,500
<font color="#E5E5E5">traffic to the appliance and tell</font>

615
00:28:45,140 --> 00:28:53,000
<font color="#E5E5E5">something about</font><font color="#CCCCCC"> it if you</font><font color="#E5E5E5"> remember the</font>

616
00:28:48,500 --> 00:28:54,980
heartbleed attack<font color="#CCCCCC"> we were we were</font>

617
00:28:53,000 --> 00:28:57,650
changing every single private<font color="#E5E5E5"> key every</font>

618
00:28:54,980 --> 00:29:00,320
single<font color="#E5E5E5"> secret every single public key</font>

619
00:28:57,650 --> 00:29:02,690
whatever<font color="#E5E5E5"> everything just to</font><font color="#CCCCCC"> be paranoid</font>

620
00:29:00,320 --> 00:29:04,928
we changed every single SSL certificate

621
00:29:02,690 --> 00:29:07,490
and every single<font color="#CCCCCC"> private key</font><font color="#E5E5E5"> out there</font>

622
00:29:04,929 --> 00:29:09,799
<font color="#E5E5E5">even</font><font color="#CCCCCC"> not having</font><font color="#E5E5E5"> been compromised</font>

623
00:29:07,490 --> 00:29:11,660
<font color="#CCCCCC">we are not compromised by the heartbleed</font>

624
00:29:09,799 --> 00:29:14,629
attack<font color="#CCCCCC"> but we changed everything</font>

625
00:29:11,660 --> 00:29:18,410
just in case so I wrote this<font color="#E5E5E5"> detection</font>

626
00:29:14,630 --> 00:29:20,480
logic<font color="#CCCCCC"> so my network security monitoring</font>

627
00:29:18,410 --> 00:29:23,990
<font color="#E5E5E5">would tell me about all the</font><font color="#CCCCCC"> CAS</font>

628
00:29:20,480 --> 00:29:26,090
certificates<font color="#E5E5E5"> not yet being changed so we</font>

629
00:29:23,990 --> 00:29:28,760
<font color="#CCCCCC">could catch them one by one and</font><font color="#E5E5E5"> after a</font>

630
00:29:26,090 --> 00:29:29,990
while<font color="#CCCCCC"> NSM was like I saw you changing</font>

631
00:29:28,760 --> 00:29:32,300
and

632
00:29:29,990 --> 00:29:37,730
<font color="#E5E5E5">SSL certificate here and here but you</font>

633
00:29:32,300 --> 00:29:40,820
forgot<font color="#E5E5E5"> about</font><font color="#CCCCCC"> all of these</font><font color="#E5E5E5"> servers some</font>

634
00:29:37,730 --> 00:29:43,340
other questions<font color="#E5E5E5"> that</font><font color="#CCCCCC"> we asked</font><font color="#E5E5E5"> is it's</font>

635
00:29:40,820 --> 00:29:45,830
one thing to detect like an old<font color="#E5E5E5"> Java at</font>

636
00:29:43,340 --> 00:29:48,889
the office<font color="#CCCCCC"> it is completely different</font>

637
00:29:45,830 --> 00:29:50,990
<font color="#E5E5E5">thing</font><font color="#CCCCCC"> to see all the Java user agent</font>

638
00:29:48,890 --> 00:29:53,600
<font color="#E5E5E5">talking to someone who is on the IOC</font>

639
00:29:50,990 --> 00:29:56,570
list<font color="#E5E5E5"> and it is yet another</font><font color="#CCCCCC"> thing</font><font color="#E5E5E5"> to see</font>

640
00:29:53,600 --> 00:29:58,429
<font color="#E5E5E5">this same host with</font><font color="#CCCCCC"> old Java</font><font color="#E5E5E5"> talking to</font>

641
00:29:56,570 --> 00:30:01,070
a known malicious server<font color="#CCCCCC"> fetch an</font>

642
00:29:58,430 --> 00:30:05,570
executable later<font color="#E5E5E5"> that is interesting</font><font color="#CCCCCC"> I</font>

643
00:30:01,070 --> 00:30:08,419
want to know about it some other

644
00:30:05,570 --> 00:30:11,120
<font color="#CCCCCC">questions we</font><font color="#E5E5E5"> asked is why is this SMB</font>

645
00:30:08,420 --> 00:30:13,250
protocol leaving my network<font color="#E5E5E5"> or when you</font>

646
00:30:11,120 --> 00:30:16,189
remember<font color="#E5E5E5"> the recent attacks under</font>

647
00:30:13,250 --> 00:30:18,890
ransomware<font color="#CCCCCC"> why is the SMB protocol</font>

648
00:30:16,190 --> 00:30:23,240
<font color="#E5E5E5">entering my network I don't want an SMB</font>

649
00:30:18,890 --> 00:30:26,030
<font color="#CCCCCC">crossing my network same thing about</font>

650
00:30:23,240 --> 00:30:29,120
<font color="#CCCCCC">MySQL I don't want my SQL to cross my</font>

651
00:30:26,030 --> 00:30:32,120
network boundary<font color="#CCCCCC"> unencrypted bro is by</font>

652
00:30:29,120 --> 00:30:35,149
the way<font color="#E5E5E5"> very efficient MySQL replicator</font>

653
00:30:32,120 --> 00:30:37,459
<font color="#CCCCCC">you just sniff the MySQL network traffic</font>

654
00:30:35,150 --> 00:30:39,950
<font color="#E5E5E5">and you can create a copy of a network</font>

655
00:30:37,460 --> 00:30:43,670
<font color="#E5E5E5">database</font><font color="#CCCCCC"> network</font><font color="#E5E5E5"> copy of a database like</font>

656
00:30:39,950 --> 00:30:45,520
<font color="#E5E5E5">entire database you should</font><font color="#CCCCCC"> be</font><font color="#E5E5E5"> careful</font>

657
00:30:43,670 --> 00:30:50,000
with<font color="#CCCCCC"> some kind of logs</font>

658
00:30:45,520 --> 00:30:51,830
or why are our<font color="#E5E5E5"> iPods leaving our office</font>

659
00:30:50,000 --> 00:30:54,770
<font color="#CCCCCC">I mean like physically</font><font color="#E5E5E5"> leaving</font><font color="#CCCCCC"> our</font>

660
00:30:51,830 --> 00:30:57,260
office so we have a bunch of iPads<font color="#CCCCCC"> at</font>

661
00:30:54,770 --> 00:30:59,389
conference rooms for managing the

662
00:30:57,260 --> 00:31:01,850
<font color="#E5E5E5">audio/video equipment and we had like a</font>

663
00:30:59,390 --> 00:31:04,730
physical bridge into one of our<font color="#E5E5E5"> offices</font>

664
00:31:01,850 --> 00:31:08,270
<font color="#CCCCCC">it does not hold any secrets</font><font color="#E5E5E5"> so stay put</font>

665
00:31:04,730 --> 00:31:10,100
but this office had a bunch of<font color="#CCCCCC"> iPads</font>

666
00:31:08,270 --> 00:31:12,680
stolen but someone who wanted to<font color="#E5E5E5"> sell</font><font color="#CCCCCC"> it</font>

667
00:31:10,100 --> 00:31:16,610
<font color="#E5E5E5">on a black market and for some reasons</font>

668
00:31:12,680 --> 00:31:20,180
<font color="#E5E5E5">the</font><font color="#CCCCCC"> CT TV was broken</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> we didn't really</font>

669
00:31:16,610 --> 00:31:22,159
know when the<font color="#CCCCCC"> actual event took place so</font>

670
00:31:20,180 --> 00:31:25,730
my manager<font color="#E5E5E5"> was like</font><font color="#CCCCCC"> you know I heard</font>

671
00:31:22,160 --> 00:31:28,400
this idea<font color="#E5E5E5"> I know what has happened</font><font color="#CCCCCC"> I got</font>

672
00:31:25,730 --> 00:31:30,500
these informations from<font color="#E5E5E5"> bra</font><font color="#CCCCCC"> I'm but how</font>

673
00:31:28,400 --> 00:31:33,050
and it was like because<font color="#E5E5E5"> all of these</font>

674
00:31:30,500 --> 00:31:36,560
iPads were<font color="#E5E5E5"> beaconing to Apple servers</font>

675
00:31:33,050 --> 00:31:42,110
<font color="#E5E5E5">and at some point they stopped okay</font>

676
00:31:36,560 --> 00:31:43,169
that's when<font color="#E5E5E5"> iPads were probably taken we</font>

677
00:31:42,110 --> 00:31:45,300
also<font color="#E5E5E5"> detect a lot of</font>

678
00:31:43,170 --> 00:31:49,020
protocol anomalies<font color="#CCCCCC"> I want to know</font>

679
00:31:45,300 --> 00:31:52,530
whenever<font color="#E5E5E5"> on port 80 something is not</font>

680
00:31:49,020 --> 00:31:55,560
HTTP or I want to<font color="#CCCCCC"> know about</font><font color="#E5E5E5"> SSL on some</font>

681
00:31:52,530 --> 00:31:58,080
unknown<font color="#E5E5E5"> parts or some unusual ports</font>

682
00:31:55,560 --> 00:32:00,179
<font color="#E5E5E5">other than for for free a couple of</font>

683
00:31:58,080 --> 00:32:02,639
things<font color="#CCCCCC"> like this this is</font><font color="#E5E5E5"> the anomaly</font>

684
00:32:00,180 --> 00:32:07,140
detection part on the<font color="#E5E5E5"> pyramid of</font><font color="#CCCCCC"> pain</font>

685
00:32:02,640 --> 00:32:10,890
basically we even watch our vendors<font color="#E5E5E5"> so</font>

686
00:32:07,140 --> 00:32:14,520
we use Gmail so we have a<font color="#E5E5E5"> bunch of</font><font color="#CCCCCC"> roles</font>

687
00:32:10,890 --> 00:32:18,000
<font color="#E5E5E5">looking for certificates that pretend to</font>

688
00:32:14,520 --> 00:32:21,570
<font color="#CCCCCC">be Gmail</font><font color="#E5E5E5"> issued by some even a trusted</font>

689
00:32:18,000 --> 00:32:23,940
<font color="#CCCCCC">CI</font><font color="#E5E5E5"> but it is not</font><font color="#CCCCCC"> a Google CI</font><font color="#E5E5E5"> so kind of</font>

690
00:32:21,570 --> 00:32:26,010
<font color="#E5E5E5">and some of</font><font color="#CCCCCC"> our</font><font color="#E5E5E5"> employees if this</font>

691
00:32:23,940 --> 00:32:28,380
employee would actually<font color="#E5E5E5"> click on a link</font>

692
00:32:26,010 --> 00:32:30,930
leading<font color="#E5E5E5"> to a phishing site presenting an</font>

693
00:32:28,380 --> 00:32:33,420
SSL certificate<font color="#CCCCCC"> with a fake Google CI I</font>

694
00:32:30,930 --> 00:32:35,520
want to know about it<font color="#E5E5E5"> and Google wants</font>

695
00:32:33,420 --> 00:32:39,900
<font color="#E5E5E5">to know about</font><font color="#CCCCCC"> it I literally like send</font>

696
00:32:35,520 --> 00:32:42,000
them<font color="#CCCCCC"> information about</font><font color="#E5E5E5"> it and</font><font color="#CCCCCC"> I could</font>

697
00:32:39,900 --> 00:32:43,410
like go<font color="#CCCCCC"> on and</font><font color="#E5E5E5"> on and on and on</font><font color="#CCCCCC"> I have a</font>

698
00:32:42,000 --> 00:32:45,600
bunch of things<font color="#CCCCCC"> but we check on</font><font color="#E5E5E5"> the</font>

699
00:32:43,410 --> 00:32:47,130
network layer we are paranoid<font color="#E5E5E5"> about the</font>

700
00:32:45,600 --> 00:32:50,189
<font color="#CCCCCC">cypresses</font><font color="#E5E5E5"> parameters</font>

701
00:32:47,130 --> 00:32:52,200
SSL<font color="#E5E5E5"> keys</font><font color="#CCCCCC"> I don't want any base64</font>

702
00:32:50,190 --> 00:32:53,930
authentication those are the things<font color="#CCCCCC"> that</font>

703
00:32:52,200 --> 00:32:56,490
we check on<font color="#E5E5E5"> the network layer as well</font>

704
00:32:53,930 --> 00:32:59,310
you<font color="#E5E5E5"> don't have to write your</font><font color="#CCCCCC"> own scripts</font>

705
00:32:56,490 --> 00:33:01,470
<font color="#E5E5E5">that's the most important part you just</font>

706
00:32:59,310 --> 00:33:04,530
deploy most of the scripts for something

707
00:33:01,470 --> 00:33:07,020
called<font color="#E5E5E5"> the broad package manager</font><font color="#CCCCCC"> and it</font>

708
00:33:04,530 --> 00:33:09,420
contains a<font color="#E5E5E5"> bunch of scripts written by</font>

709
00:33:07,020 --> 00:33:11,820
people who way smarter than<font color="#E5E5E5"> me like for</font>

710
00:33:09,420 --> 00:33:14,250
<font color="#E5E5E5">example these people from coral</font><font color="#CCCCCC"> ID</font><font color="#E5E5E5"> this</font>

711
00:33:11,820 --> 00:33:16,950
is kind of like a DLP functionality<font color="#E5E5E5"> long</font>

712
00:33:14,250 --> 00:33:20,730
connections or bursting connections<font color="#E5E5E5"> a</font>

713
00:33:16,950 --> 00:33:22,830
very short but<font color="#E5E5E5"> high speed connection</font>

714
00:33:20,730 --> 00:33:25,070
that sends something somewhere<font color="#E5E5E5"> maybe I</font>

715
00:33:22,830 --> 00:33:29,159
want<font color="#E5E5E5"> to know about</font><font color="#CCCCCC"> be cunning like this</font>

716
00:33:25,070 --> 00:33:32,250
so<font color="#E5E5E5"> to summarize this part we</font><font color="#CCCCCC"> are</font>

717
00:33:29,160 --> 00:33:39,480
minimizing<font color="#E5E5E5"> our attack surface from 2012</font>

718
00:33:32,250 --> 00:33:41,580
<font color="#CCCCCC">and now this is</font><font color="#E5E5E5"> not at the end you're</font>

719
00:33:39,480 --> 00:33:44,310
looking at it<font color="#E5E5E5"> and you're</font><font color="#CCCCCC"> like it will</font>

720
00:33:41,580 --> 00:33:47,100
not work in our network<font color="#E5E5E5"> because you have</font>

721
00:33:44,310 --> 00:33:49,230
<font color="#CCCCCC">network which is has like 100 gigs per</font>

722
00:33:47,100 --> 00:33:52,320
second<font color="#E5E5E5"> you are thinking</font><font color="#CCCCCC"> about like</font>

723
00:33:49,230 --> 00:33:54,390
capture cards hardware acceleration<font color="#CCCCCC"> what</font>

724
00:33:52,320 --> 00:33:55,210
<font color="#CCCCCC">not well let me</font><font color="#E5E5E5"> tell you what we do it</font>

725
00:33:54,390 --> 00:33:58,330
on

726
00:33:55,210 --> 00:34:00,370
<font color="#E5E5E5">a bunch of fairly beefy servers</font>

727
00:33:58,330 --> 00:34:01,270
expensive servers<font color="#E5E5E5"> but nothing special</font>

728
00:34:00,370 --> 00:34:03,250
<font color="#E5E5E5">about them</font>

729
00:34:01,270 --> 00:34:05,980
generally Linux installation generally

730
00:34:03,250 --> 00:34:08,649
Linux kernel<font color="#CCCCCC"> AF packet for those of you</font>

731
00:34:05,980 --> 00:34:10,240
that know AF packet<font color="#E5E5E5"> it was a source</font><font color="#CCCCCC"> of</font>

732
00:34:08,649 --> 00:34:12,668
<font color="#E5E5E5">all kinds of problem in the past</font>

733
00:34:10,239 --> 00:34:14,319
right now<font color="#E5E5E5"> the AF packet is amazing and</font>

734
00:34:12,668 --> 00:34:18,190
the AF<font color="#CCCCCC"> packet team actually</font><font color="#E5E5E5"> knows about</font>

735
00:34:14,320 --> 00:34:19,359
those use cases and we were able<font color="#CCCCCC"> to</font>

736
00:34:18,190 --> 00:34:23,710
speed up<font color="#CCCCCC"> so ricotta</font>

737
00:34:19,359 --> 00:34:26,969
<font color="#E5E5E5">not brass or ricotta 248 per second on</font>

738
00:34:23,710 --> 00:34:31,480
generic<font color="#E5E5E5"> hardware generic</font><font color="#CCCCCC"> network card</font>

739
00:34:26,969 --> 00:34:32,888
network card<font color="#E5E5E5"> which costs like</font><font color="#CCCCCC"> $400 if</font>

740
00:34:31,480 --> 00:34:34,449
you<font color="#E5E5E5"> want to know more slides will</font><font color="#CCCCCC"> be</font>

741
00:34:32,889 --> 00:34:38,980
published and<font color="#E5E5E5"> very be links to a</font>

742
00:34:34,449 --> 00:34:41,799
research about<font color="#E5E5E5"> this one of the last</font>

743
00:34:38,980 --> 00:34:43,330
things<font color="#E5E5E5"> I'd like to present is I told you</font>

744
00:34:41,800 --> 00:34:45,700
that we sniff a lot of network traffic

745
00:34:43,330 --> 00:34:47,710
<font color="#E5E5E5">so that's basically what we do you can</font>

746
00:34:45,699 --> 00:34:49,928
see that we sniff network traffic not

747
00:34:47,710 --> 00:34:51,820
<font color="#E5E5E5">only between border of our network and</font>

748
00:34:49,929 --> 00:34:54,339
<font color="#E5E5E5">the internet which</font><font color="#CCCCCC"> is the traditional</font>

749
00:34:51,820 --> 00:34:57,040
<font color="#CCCCCC">way to do it with sniff traffic in our</font>

750
00:34:54,339 --> 00:35:00,000
internal<font color="#CCCCCC"> network so when</font><font color="#E5E5E5"> I host from</font>

751
00:34:57,040 --> 00:35:02,470
villain a talks to a host from<font color="#E5E5E5"> villain</font><font color="#CCCCCC"> B</font>

752
00:35:00,000 --> 00:35:04,720
we sniff this<font color="#CCCCCC"> traffic as well every</font>

753
00:35:02,470 --> 00:35:06,819
<font color="#E5E5E5">single time I host crosses a villain</font><font color="#CCCCCC"> we</font>

754
00:35:04,720 --> 00:35:08,830
sniff this<font color="#CCCCCC"> traffic for</font><font color="#E5E5E5"> offices we even</font>

755
00:35:06,820 --> 00:35:11,859
sniff some internal<font color="#E5E5E5"> traffic not leaving</font>

756
00:35:08,830 --> 00:35:16,990
the villain<font color="#E5E5E5"> going like for</font><font color="#CCCCCC"> example</font><font color="#E5E5E5"> all</font>

757
00:35:11,859 --> 00:35:19,750
<font color="#CCCCCC">hosts on the</font><font color="#E5E5E5"> same level and we do it</font>

758
00:35:16,990 --> 00:35:23,919
over three<font color="#CCCCCC"> continents nine offices we do</font>

759
00:35:19,750 --> 00:35:25,780
it also in AWS and<font color="#CCCCCC"> we send</font><font color="#E5E5E5"> 10,000 events</font>

760
00:35:23,920 --> 00:35:31,240
per second to our system to store

761
00:35:25,780 --> 00:35:33,520
metadata about connections nothing

762
00:35:31,240 --> 00:35:35,529
<font color="#CCCCCC">special about how we store those logs</font>

763
00:35:33,520 --> 00:35:38,890
it's like a generic<font color="#CCCCCC"> blogging pipeline</font>

764
00:35:35,530 --> 00:35:41,520
<font color="#E5E5E5">logs are written</font><font color="#CCCCCC"> to disk where is my</font>

765
00:35:38,890 --> 00:35:43,900
<font color="#E5E5E5">disk here</font>

766
00:35:41,520 --> 00:35:46,300
<font color="#E5E5E5">locks are actually being picked up at</font>

767
00:35:43,900 --> 00:35:48,670
<font color="#E5E5E5">the by the syslog-ng those are JSON</font>

768
00:35:46,300 --> 00:35:50,740
native files<font color="#E5E5E5"> but there are a number of</font>

769
00:35:48,670 --> 00:35:53,680
possibilities of<font color="#E5E5E5"> what you</font><font color="#CCCCCC"> can</font><font color="#E5E5E5"> extract</font>

770
00:35:50,740 --> 00:35:56,250
from<font color="#E5E5E5"> bro</font><font color="#CCCCCC"> Kafka is supported streaming</font>

771
00:35:53,680 --> 00:35:59,410
JSON without writing<font color="#E5E5E5"> is supported and</font>

772
00:35:56,250 --> 00:36:02,890
<font color="#CCCCCC">elastic Serge is</font><font color="#E5E5E5"> supported but we use</font>

773
00:35:59,410 --> 00:36:05,920
this<font color="#CCCCCC"> Lagrange's</font><font color="#E5E5E5"> and things over</font><font color="#CCCCCC"> AMQP</font><font color="#E5E5E5"> to</font>

774
00:36:02,890 --> 00:36:09,020
Mos Def<font color="#CCCCCC"> and syslog-ng on my host</font>

775
00:36:05,920 --> 00:36:12,200
<font color="#E5E5E5">sending</font><font color="#CCCCCC"> 10,000 events has like</font>

776
00:36:09,020 --> 00:36:15,650
<font color="#E5E5E5">percent of the CPU</font><font color="#CCCCCC"> usage and like 200</font>

777
00:36:12,200 --> 00:36:19,040
megabytes<font color="#E5E5E5"> usage memory</font><font color="#CCCCCC"> so wherever it</font>

778
00:36:15,650 --> 00:36:21,850
works we<font color="#CCCCCC"> are clear Linux</font><font color="#E5E5E5"> we used to be</font>

779
00:36:19,040 --> 00:36:24,710
using Ubuntu<font color="#CCCCCC"> with which to clear Linux</font>

780
00:36:21,850 --> 00:36:29,450
<font color="#CCCCCC">and we use fairly</font><font color="#E5E5E5"> generic</font><font color="#CCCCCC"> intern</font>

781
00:36:24,710 --> 00:36:31,160
<font color="#E5E5E5">hardware what if you wanted to start</font>

782
00:36:29,450 --> 00:36:34,009
with something<font color="#CCCCCC"> like this the learning</font>

783
00:36:31,160 --> 00:36:35,960
curve can<font color="#E5E5E5"> be very steep it can be</font>

784
00:36:34,010 --> 00:36:37,730
difficult<font color="#CCCCCC"> to do it so I</font><font color="#E5E5E5"> will recommend</font>

785
00:36:35,960 --> 00:36:40,400
starting with<font color="#CCCCCC"> something like a security</font>

786
00:36:37,730 --> 00:36:43,670
<font color="#CCCCCC">onion</font><font color="#E5E5E5"> or even going to the web page</font><font color="#CCCCCC"> try</font>

787
00:36:40,400 --> 00:36:46,400
bro<font color="#CCCCCC"> org</font><font color="#E5E5E5"> it is a web page</font><font color="#CCCCCC"> that lets you</font>

788
00:36:43,670 --> 00:36:47,540
upload some pickups<font color="#CCCCCC"> you do you</font><font color="#E5E5E5"> don't</font>

789
00:36:46,400 --> 00:36:49,520
have<font color="#E5E5E5"> to do anything else you take</font><font color="#CCCCCC"> a</font>

790
00:36:47,540 --> 00:36:51,140
<font color="#E5E5E5">pickup you upload to this web page and</font>

791
00:36:49,520 --> 00:36:53,450
<font color="#CCCCCC">you see</font><font color="#E5E5E5"> what kind of logs will be</font>

792
00:36:51,140 --> 00:36:57,580
generated for you<font color="#E5E5E5"> even exercise like</font>

793
00:36:53,450 --> 00:37:00,470
<font color="#CCCCCC">this can be</font><font color="#E5E5E5"> kind of enlightening</font><font color="#CCCCCC"> if you</font>

794
00:36:57,580 --> 00:37:03,470
don't want to upload some sensitive pick

795
00:37:00,470 --> 00:37:06,020
up to this<font color="#E5E5E5"> web page</font><font color="#CCCCCC"> no problem you can</font>

796
00:37:03,470 --> 00:37:08,959
<font color="#CCCCCC">actually fetch an entire docker image</font>

797
00:37:06,020 --> 00:37:11,120
and deploy this<font color="#CCCCCC"> Triborough org</font><font color="#E5E5E5"> in a</font>

798
00:37:08,960 --> 00:37:13,610
docker and<font color="#E5E5E5"> there I did locally</font><font color="#CCCCCC"> write it</font>

799
00:37:11,120 --> 00:37:17,299
in a sandbox<font color="#E5E5E5"> and use it as yet</font><font color="#CCCCCC"> another</font>

800
00:37:13,610 --> 00:37:18,500
tool in your<font color="#E5E5E5"> sandbox on the Triboro</font><font color="#CCCCCC"> or</font>

801
00:37:17,300 --> 00:37:19,340
<font color="#E5E5E5">cover is actually a</font><font color="#CCCCCC"> step-by-step</font>

802
00:37:18,500 --> 00:37:21,200
<font color="#E5E5E5">tutorial</font>

803
00:37:19,340 --> 00:37:23,360
written by<font color="#E5E5E5"> someone</font><font color="#CCCCCC"> who had this</font>

804
00:37:21,200 --> 00:37:25,399
assumption that this<font color="#CCCCCC"> tutorial is written</font>

805
00:37:23,360 --> 00:37:30,290
for people who never<font color="#E5E5E5"> experienced this</font>

806
00:37:25,400 --> 00:37:33,530
kind of language and were a<font color="#E5E5E5"> bunch of</font>

807
00:37:30,290 --> 00:37:35,779
like<font color="#E5E5E5"> our materials as well so with this</font>

808
00:37:33,530 --> 00:37:39,980
<font color="#E5E5E5">I'd like to proceed to the QA if we</font>

809
00:37:35,780 --> 00:37:41,870
still have time<font color="#CCCCCC"> okay</font><font color="#E5E5E5"> I will be taking</font>

810
00:37:39,980 --> 00:37:45,160
questions<font color="#E5E5E5"> in any language</font><font color="#CCCCCC"> polish English</font>

811
00:37:41,870 --> 00:37:45,160
I<font color="#E5E5E5"> will translate if necessary</font>

812
00:37:48,430 --> 00:37:54,250
<font color="#E5E5E5">Thanks I have many questions but I'll</font>

813
00:37:51,820 --> 00:37:58,510
try to limit<font color="#E5E5E5"> myself to three</font><font color="#CCCCCC"> Oh me</font>

814
00:37:54,250 --> 00:38:04,060
so you mentioned<font color="#CCCCCC"> so first one is how</font>

815
00:37:58,510 --> 00:38:06,010
<font color="#CCCCCC">actually how how big your traffic is you</font>

816
00:38:04,060 --> 00:38:09,279
have to handle<font color="#E5E5E5"> yeah so right</font><font color="#CCCCCC"> now we</font>

817
00:38:06,010 --> 00:38:14,920
handle up<font color="#CCCCCC"> to 60 gigabits of traffic with</font>

818
00:38:09,280 --> 00:38:19,300
<font color="#CCCCCC">eight</font><font color="#E5E5E5"> broad servers</font><font color="#CCCCCC"> to store ekata</font>

819
00:38:14,920 --> 00:38:23,970
servers<font color="#E5E5E5"> okay so for how long do you keep</font>

820
00:38:19,300 --> 00:38:23,970
<font color="#E5E5E5">your logs</font><font color="#CCCCCC"> we keep our logs for 90 days</font>

821
00:38:24,300 --> 00:38:31,270
<font color="#CCCCCC">how do you</font><font color="#E5E5E5"> handle domain fronting how do</font>

822
00:38:28,750 --> 00:38:35,830
you handle what<font color="#E5E5E5"> domain fronting so the</font>

823
00:38:31,270 --> 00:38:38,500
attack<font color="#E5E5E5"> the</font><font color="#CCCCCC"> city's is utilizing the</font><font color="#E5E5E5"> some</font>

824
00:38:35,830 --> 00:38:40,750
third party which is trusted so there

825
00:38:38,500 --> 00:38:42,670
<font color="#E5E5E5">are two answers</font><font color="#CCCCCC"> to it</font><font color="#E5E5E5"> we do not allow</font>

826
00:38:40,750 --> 00:38:45,070
<font color="#E5E5E5">the domain fronting on our</font><font color="#CCCCCC"> site so we</font>

827
00:38:42,670 --> 00:38:46,630
<font color="#E5E5E5">are not used as the</font><font color="#CCCCCC"> front-end to connect</font>

828
00:38:45,070 --> 00:38:49,390
to someone<font color="#E5E5E5"> else but on the client side</font>

829
00:38:46,630 --> 00:38:51,160
<font color="#CCCCCC">if someone uses</font><font color="#E5E5E5"> a domain fronting from</font>

830
00:38:49,390 --> 00:38:53,230
Google<font color="#E5E5E5"> starting connections from our</font>

831
00:38:51,160 --> 00:39:00,700
network<font color="#E5E5E5"> will be blind</font><font color="#CCCCCC"> there is</font><font color="#E5E5E5"> nothing</font>

832
00:38:53,230 --> 00:39:03,970
we can do about<font color="#E5E5E5"> it what was the effort</font>

833
00:39:00,700 --> 00:39:09,279
<font color="#CCCCCC">of you to deal with the</font><font color="#E5E5E5"> GDP</font><font color="#CCCCCC"> our</font><font color="#E5E5E5"> rules</font>

834
00:39:03,970 --> 00:39:14,470
and how much time<font color="#E5E5E5"> did</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> spend what was</font>

835
00:39:09,280 --> 00:39:16,000
the so the effort was insane<font color="#E5E5E5"> and it took</font>

836
00:39:14,470 --> 00:39:17,680
me several years<font color="#E5E5E5"> to build everything</font>

837
00:39:16,000 --> 00:39:20,410
from scratch<font color="#CCCCCC"> this</font><font color="#E5E5E5"> is not the case</font>

838
00:39:17,680 --> 00:39:23,290
<font color="#E5E5E5">anymore</font><font color="#CCCCCC"> throughout the exercise</font><font color="#E5E5E5"> of</font>

839
00:39:20,410 --> 00:39:25,629
building<font color="#E5E5E5"> this system we uncovered a</font>

840
00:39:23,290 --> 00:39:28,090
bunch of<font color="#E5E5E5"> performance issues and</font>

841
00:39:25,630 --> 00:39:30,310
<font color="#E5E5E5">scalability issues in</font><font color="#CCCCCC"> bro so we were</font>

842
00:39:28,090 --> 00:39:32,620
like uncovering something<font color="#CCCCCC"> bro</font><font color="#E5E5E5"> was fixing</font>

843
00:39:30,310 --> 00:39:34,450
it<font color="#E5E5E5"> giving us a patch who were testing it</font>

844
00:39:32,620 --> 00:39:42,910
<font color="#E5E5E5">and it was going back</font><font color="#CCCCCC"> to bro so that's</font>

845
00:39:34,450 --> 00:39:46,419
why it took<font color="#CCCCCC"> so long and</font><font color="#E5E5E5"> more about some</font>

846
00:39:42,910 --> 00:39:48,279
<font color="#E5E5E5">legal issues</font><font color="#CCCCCC"> some</font><font color="#E5E5E5"> of the issues were it</font>

847
00:39:46,420 --> 00:39:50,410
<font color="#E5E5E5">could not handle this much traffic</font>

848
00:39:48,280 --> 00:39:53,710
<font color="#CCCCCC">without dropping the traffic and our</font>

849
00:39:50,410 --> 00:39:56,350
issues were some of the scripts will

850
00:39:53,710 --> 00:39:58,630
actually kill bro<font color="#E5E5E5"> so we I have this</font>

851
00:39:56,350 --> 00:40:01,299
<font color="#E5E5E5">example when</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> was trying to keep a</font>

852
00:39:58,630 --> 00:40:01,990
state for<font color="#E5E5E5"> every client but connected to</font>

853
00:40:01,300 --> 00:40:04,240
us

854
00:40:01,990 --> 00:40:06,160
<font color="#E5E5E5">do a modeling for example for every</font>

855
00:40:04,240 --> 00:40:08,529
client<font color="#CCCCCC"> I</font><font color="#E5E5E5"> know I want to know the ratio</font>

856
00:40:06,160 --> 00:40:10,930
<font color="#E5E5E5">between the good</font><font color="#CCCCCC"> requests and the bad</font>

857
00:40:08,530 --> 00:40:13,360
requests and if the connection is<font color="#CCCCCC"> all</font>

858
00:40:10,930 --> 00:40:15,640
the bad<font color="#E5E5E5"> requests I want an alert</font><font color="#CCCCCC"> I was</font>

859
00:40:13,360 --> 00:40:17,890
trying to<font color="#E5E5E5"> keep a state for every</font><font color="#CCCCCC"> client</font>

860
00:40:15,640 --> 00:40:20,230
that<font color="#E5E5E5"> connected</font><font color="#CCCCCC"> to us</font><font color="#E5E5E5"> and with 400</font>

861
00:40:17,890 --> 00:40:28,839
millions of Firefox users it was just

862
00:40:20,230 --> 00:40:30,369
<font color="#E5E5E5">crushing good</font><font color="#CCCCCC"> a question</font><font color="#E5E5E5"> about this even</font>

863
00:40:28,840 --> 00:40:32,590
generating system that you mentioned in

864
00:40:30,369 --> 00:40:33,640
the beginning is it part of<font color="#CCCCCC"> mos def or</font>

865
00:40:32,590 --> 00:40:37,840
it's something<font color="#E5E5E5"> else</font>

866
00:40:33,640 --> 00:40:39,940
<font color="#E5E5E5">so this</font><font color="#CCCCCC"> evening</font><font color="#E5E5E5"> else so this event</font>

867
00:40:37,840 --> 00:40:50,320
generation system is part of the broad

868
00:40:39,940 --> 00:40:54,250
ideas what sort of GUI<font color="#E5E5E5"> are you using you</font>

869
00:40:50,320 --> 00:41:00,130
your internally developed one<font color="#CCCCCC"> or some</font>

870
00:40:54,250 --> 00:41:02,800
commercial or open source we use<font color="#CCCCCC"> for</font>

871
00:41:00,130 --> 00:41:04,810
this project<font color="#CCCCCC"> only open source tools open</font>

872
00:41:02,800 --> 00:41:07,810
<font color="#E5E5E5">source</font><font color="#CCCCCC"> solutions so the entire project</font>

873
00:41:04,810 --> 00:41:10,660
<font color="#E5E5E5">is 100% open source at the cost of my</font>

874
00:41:07,810 --> 00:41:13,690
time<font color="#E5E5E5"> and at the cost of couple months of</font>

875
00:41:10,660 --> 00:41:15,819
work but there are circumstantial

876
00:41:13,690 --> 00:41:16,750
solutions for it<font color="#E5E5E5"> if you just want to</font>

877
00:41:15,820 --> 00:41:18,910
deploy bro

878
00:41:16,750 --> 00:41:22,410
<font color="#E5E5E5">there are companies happy to help with</font>

879
00:41:18,910 --> 00:41:22,410
<font color="#E5E5E5">it so you don't have to go for it</font>

880
00:41:29,960 --> 00:41:34,410
<font color="#E5E5E5">okay</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> don't see any more</font><font color="#CCCCCC"> questions if</font>

881
00:41:32,730 --> 00:41:36,660
you have<font color="#CCCCCC"> some more</font><font color="#E5E5E5"> questions</font><font color="#CCCCCC"> I will be</font>

882
00:41:34,410 --> 00:41:38,580
<font color="#CCCCCC">here for like the full</font><font color="#E5E5E5"> two days feel</font>

883
00:41:36,660 --> 00:41:40,710
<font color="#E5E5E5">free to approach me and ask me pretty</font>

884
00:41:38,580 --> 00:41:42,569
<font color="#E5E5E5">much any question</font><font color="#CCCCCC"> about</font><font color="#E5E5E5"> it</font><font color="#CCCCCC"> I might</font><font color="#E5E5E5"> even</font>

885
00:41:40,710 --> 00:41:47,240
tell you a little<font color="#CCCCCC"> bit more than I</font><font color="#E5E5E5"> was</font>

886
00:41:42,570 --> 00:41:47,240
able<font color="#CCCCCC"> to tell from the stage</font><font color="#E5E5E5"> thank you</font>

