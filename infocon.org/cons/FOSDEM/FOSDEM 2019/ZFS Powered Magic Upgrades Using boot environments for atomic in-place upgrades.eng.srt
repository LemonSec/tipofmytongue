1
00:00:04,620 --> 00:00:11,040
<font color="#E5E5E5">okay so my</font><font color="#CCCCCC"> talk today is going to</font><font color="#E5E5E5"> be</font>

2
00:00:08,220 --> 00:00:13,920
about how I do<font color="#CCCCCC"> ZFS powered magic</font>

3
00:00:11,040 --> 00:00:15,750
upgrades<font color="#E5E5E5"> so using</font><font color="#CCCCCC"> setup as food</font>

4
00:00:13,920 --> 00:00:20,090
environments to replace the operating

5
00:00:15,750 --> 00:00:25,140
system of servers<font color="#CCCCCC"> in the field in its</font>

6
00:00:20,090 --> 00:00:27,270
quickly and as safely as<font color="#CCCCCC"> possible so</font><font color="#E5E5E5"> my</font>

7
00:00:25,140 --> 00:00:29,279
name<font color="#CCCCCC"> is Alan Jude I'm on FreeBSD core</font>

8
00:00:27,270 --> 00:00:33,210
team<font color="#E5E5E5"> and I'm an open ZFS developer and</font>

9
00:00:29,279 --> 00:00:35,160
then for my day job<font color="#CCCCCC"> I work at Clara</font>

10
00:00:33,210 --> 00:00:40,250
<font color="#CCCCCC">which is a FreeBSD professional services</font>

11
00:00:35,160 --> 00:00:42,779
<font color="#CCCCCC">and support company so</font><font color="#E5E5E5"> quickly</font>

12
00:00:40,250 --> 00:00:45,390
<font color="#CCCCCC">a quick</font><font color="#E5E5E5"> overview of what we'll talk</font>

13
00:00:42,780 --> 00:00:46,829
<font color="#CCCCCC">about today</font><font color="#E5E5E5"> is first explaining what a</font>

14
00:00:45,390 --> 00:00:49,379
boot<font color="#CCCCCC"> environment is in case you haven't</font>

15
00:00:46,829 --> 00:00:51,829
used them before<font color="#E5E5E5"> and how they work and</font>

16
00:00:49,379 --> 00:00:57,899
<font color="#E5E5E5">then we'll talk about how we actually</font>

17
00:00:51,829 --> 00:00:59,850
create system images and make golden

18
00:00:57,899 --> 00:01:02,789
images of using<font color="#CCCCCC"> boot environments and</font>

19
00:00:59,850 --> 00:01:04,140
then how we<font color="#E5E5E5"> deployed those to various</font>

20
00:01:02,789 --> 00:01:06,990
environments<font color="#E5E5E5"> including remote machines</font>

21
00:01:04,140 --> 00:01:09,090
and appliances<font color="#E5E5E5"> and then how we can</font>

22
00:01:06,990 --> 00:01:11,869
<font color="#E5E5E5">improve the</font><font color="#CCCCCC"> process even</font><font color="#E5E5E5"> further than</font>

23
00:01:09,090 --> 00:01:11,869
<font color="#E5E5E5">what I've come up</font><font color="#CCCCCC"> with so far</font>

24
00:01:12,229 --> 00:01:17,759
so starting in the past<font color="#CCCCCC"> looking at how</font>

25
00:01:15,569 --> 00:01:20,729
this was done<font color="#CCCCCC"> on FreeBSD before the days</font>

26
00:01:17,759 --> 00:01:21,450
of ZFS so this is how things like

27
00:01:20,729 --> 00:01:23,700
<font color="#CCCCCC">pfSense</font>

28
00:01:21,450 --> 00:01:25,200
and<font color="#CCCCCC"> FreeNAS and so on worked until they</font>

29
00:01:23,700 --> 00:01:27,810
switched is that a<font color="#E5E5E5"> best over the last</font>

30
00:01:25,200 --> 00:01:29,789
<font color="#E5E5E5">couple of years so we have a system</font>

31
00:01:27,810 --> 00:01:31,170
<font color="#E5E5E5">called</font><font color="#CCCCCC"> nano</font><font color="#E5E5E5"> BSD which was a build system</font>

32
00:01:29,789 --> 00:01:34,470
for<font color="#E5E5E5"> building an embedded version of</font>

33
00:01:31,170 --> 00:01:36,479
<font color="#E5E5E5">FreeBSD for appliances and and images</font>

34
00:01:34,470 --> 00:01:38,610
like that<font color="#E5E5E5"> so what it would do is take</font>

35
00:01:36,479 --> 00:01:42,270
the hard drive<font color="#E5E5E5"> and partition it</font><font color="#CCCCCC"> into two</font>

36
00:01:38,610 --> 00:01:43,800
halves one half you would install the

37
00:01:42,270 --> 00:01:46,590
latest version<font color="#CCCCCC"> of pfsense or whatever in</font>

38
00:01:43,800 --> 00:01:48,569
and you would run off that<font color="#E5E5E5"> and it would</font>

39
00:01:46,590 --> 00:01:50,160
<font color="#E5E5E5">that part of the system images mostly</font>

40
00:01:48,569 --> 00:01:52,470
read-only<font color="#CCCCCC"> and there was a small</font>

41
00:01:50,160 --> 00:01:54,630
<font color="#E5E5E5">partition at the end where it kept the</font>

42
00:01:52,470 --> 00:01:56,640
configuration files<font color="#E5E5E5"> when it was time to</font>

43
00:01:54,630 --> 00:01:58,589
<font color="#CCCCCC">upgrade you would write the new version</font>

44
00:01:56,640 --> 00:02:00,420
into the second partition<font color="#CCCCCC"> and you would</font>

45
00:01:58,590 --> 00:02:03,209
set a flag and<font color="#E5E5E5"> GPT</font>

46
00:02:00,420 --> 00:02:04,410
saying<font color="#E5E5E5"> next</font><font color="#CCCCCC"> time we boot boot the second</font>

47
00:02:03,209 --> 00:02:06,479
partition instead of the first partition

48
00:02:04,410 --> 00:02:07,649
the bootloader would then erase that

49
00:02:06,479 --> 00:02:09,989
flag once it had done<font color="#CCCCCC"> at once</font>

50
00:02:07,649 --> 00:02:11,849
<font color="#E5E5E5">so even if the image didn't boot just by</font>

51
00:02:09,989 --> 00:02:14,250
power cycling<font color="#E5E5E5"> again you get back to the</font>

52
00:02:11,849 --> 00:02:15,988
<font color="#E5E5E5">working image so if it's a device like a</font>

53
00:02:14,250 --> 00:02:17,519
PF sense that might not<font color="#E5E5E5"> even have a</font>

54
00:02:15,989 --> 00:02:18,120
<font color="#CCCCCC">video screen</font><font color="#E5E5E5"> or something</font>

55
00:02:17,519 --> 00:02:20,370
<font color="#E5E5E5">to</font>

56
00:02:18,120 --> 00:02:21,720
connect to it would allow you<font color="#E5E5E5"> to just do</font>

57
00:02:20,370 --> 00:02:23,159
the upgrade if it doesn't work<font color="#CCCCCC"> power</font>

58
00:02:21,720 --> 00:02:25,170
cycle<font color="#E5E5E5"> it and it would go</font><font color="#CCCCCC"> back to the</font>

59
00:02:23,159 --> 00:02:28,019
<font color="#CCCCCC">working image</font><font color="#E5E5E5"> if it did work</font><font color="#CCCCCC"> you would</font>

60
00:02:25,170 --> 00:02:29,458
stay running<font color="#E5E5E5"> off the second image set a</font>

61
00:02:28,019 --> 00:02:31,590
flag to<font color="#E5E5E5"> make that permanently the</font>

62
00:02:29,459 --> 00:02:33,030
default<font color="#E5E5E5"> boot and then in the future when</font>

63
00:02:31,590 --> 00:02:34,799
you need<font color="#E5E5E5"> to upgrade again you would just</font>

64
00:02:33,030 --> 00:02:37,019
overwrite the first partition<font color="#E5E5E5"> and just</font>

65
00:02:34,799 --> 00:02:39,030
<font color="#CCCCCC">ping pong back and forth always</font><font color="#E5E5E5"> being</font>

66
00:02:37,019 --> 00:02:43,530
able to<font color="#E5E5E5"> go back one revision if</font>

67
00:02:39,030 --> 00:02:45,299
something<font color="#E5E5E5"> went wrong</font><font color="#CCCCCC"> and that worked</font>

68
00:02:43,530 --> 00:02:47,340
quite<font color="#CCCCCC"> well but it has some</font><font color="#E5E5E5"> limitations</font>

69
00:02:45,299 --> 00:02:49,260
<font color="#E5E5E5">including you have to partition your</font>

70
00:02:47,340 --> 00:02:51,060
storage in half<font color="#E5E5E5"> so if your image gets a</font>

71
00:02:49,260 --> 00:02:52,349
little<font color="#E5E5E5"> bit bigger than you don't maybe</font>

72
00:02:51,060 --> 00:02:53,760
have<font color="#E5E5E5"> enough room especially if you're</font>

73
00:02:52,349 --> 00:02:58,828
constrained<font color="#E5E5E5"> with like an SD</font><font color="#CCCCCC"> card or</font>

74
00:02:53,760 --> 00:03:01,739
<font color="#CCCCCC">something so comparing that to ZFS boot</font>

75
00:02:58,829 --> 00:03:03,870
environments because ZFS is taking all

76
00:03:01,739 --> 00:03:05,870
<font color="#CCCCCC">of</font><font color="#E5E5E5"> your available</font><font color="#CCCCCC"> storage and making a</font>

77
00:03:03,870 --> 00:03:08,400
pool out of that and then<font color="#E5E5E5"> using</font>

78
00:03:05,870 --> 00:03:10,230
basically thin<font color="#E5E5E5"> provision file systems on</font>

79
00:03:08,400 --> 00:03:12,560
<font color="#CCCCCC">top of that where each file system only</font>

80
00:03:10,230 --> 00:03:14,970
<font color="#E5E5E5">takes space from the pool as it needs it</font>

81
00:03:12,560 --> 00:03:16,560
meaning that<font color="#E5E5E5"> all of your free space is</font>

82
00:03:14,970 --> 00:03:20,400
<font color="#CCCCCC">available to anyone of the file systems</font>

83
00:03:16,560 --> 00:03:22,079
<font color="#E5E5E5">or all</font><font color="#CCCCCC"> of them so what we can</font><font color="#E5E5E5"> do is</font>

84
00:03:20,400 --> 00:03:25,049
actually have<font color="#CCCCCC"> multiple versions of</font><font color="#E5E5E5"> the</font>

85
00:03:22,079 --> 00:03:26,190
root<font color="#E5E5E5"> filesystem so we have a version of</font>

86
00:03:25,049 --> 00:03:28,680
<font color="#CCCCCC">flash with the current version of the</font>

87
00:03:26,190 --> 00:03:31,049
software we can snapshot and clone that

88
00:03:28,680 --> 00:03:34,290
and keep<font color="#CCCCCC"> that as the before</font><font color="#E5E5E5"> image and</font>

89
00:03:31,049 --> 00:03:37,230
then upgrade<font color="#CCCCCC"> the system</font><font color="#E5E5E5"> in place and</font>

90
00:03:34,290 --> 00:03:40,290
then if the upgrade doesn't work we just

91
00:03:37,230 --> 00:03:43,828
<font color="#E5E5E5">reboot</font><font color="#CCCCCC"> onto the older version so same</font>

92
00:03:40,290 --> 00:03:46,379
<font color="#E5E5E5">idea as nano</font><font color="#CCCCCC"> bsd except for you're</font><font color="#E5E5E5"> not</font>

93
00:03:43,829 --> 00:03:48,359
limited to<font color="#E5E5E5"> two images</font><font color="#CCCCCC"> you can keep the</font>

94
00:03:46,379 --> 00:03:52,230
last<font color="#CCCCCC"> ten or whatever</font><font color="#E5E5E5"> however much space</font>

95
00:03:48,359 --> 00:03:54,239
you<font color="#CCCCCC"> have available and the</font><font color="#E5E5E5"> other big</font>

96
00:03:52,230 --> 00:03:56,608
<font color="#E5E5E5">difference is you separate out the other</font>

97
00:03:54,239 --> 00:03:57,780
file<font color="#E5E5E5"> systems you don't do this in nano</font>

98
00:03:56,609 --> 00:03:59,489
<font color="#E5E5E5">bsd</font><font color="#CCCCCC"> cuz you end up with so many</font>

99
00:03:57,780 --> 00:04:01,769
<font color="#CCCCCC">partitions you would run out of space</font>

100
00:03:59,489 --> 00:04:03,810
<font color="#CCCCCC">but was</font><font color="#E5E5E5"> that a fast we can make</font><font color="#CCCCCC"> sure</font>

101
00:04:01,769 --> 00:04:07,019
<font color="#CCCCCC">that your home directory lives in a</font>

102
00:04:03,810 --> 00:04:09,480
different<font color="#CCCCCC"> partition</font><font color="#E5E5E5"> so for example</font><font color="#CCCCCC"> I</font>

103
00:04:07,019 --> 00:04:10,650
updated<font color="#E5E5E5"> the OS of my laptop and then</font>

104
00:04:09,480 --> 00:04:13,709
when I tried<font color="#CCCCCC"> to give my talk earlier</font>

105
00:04:10,650 --> 00:04:18,418
today<font color="#E5E5E5"> the HDMI I didn't want to work so</font>

106
00:04:13,709 --> 00:04:20,668
I rebooted selected the Thursday image

107
00:04:18,418 --> 00:04:24,210
<font color="#E5E5E5">from my laptop and then it worked again</font>

108
00:04:20,668 --> 00:04:26,099
<font color="#E5E5E5">but when I rolled back</font><font color="#CCCCCC"> I didn't lose the</font>

109
00:04:24,210 --> 00:04:28,469
changes to my slides that I had done on

110
00:04:26,099 --> 00:04:30,240
<font color="#E5E5E5">Friday because</font><font color="#CCCCCC"> they were in my home</font>

111
00:04:28,469 --> 00:04:31,810
directory<font color="#E5E5E5"> which didn't get rolled back</font><font color="#CCCCCC"> I</font>

112
00:04:30,240 --> 00:04:34,630
only<font color="#E5E5E5"> rolled back the</font><font color="#CCCCCC"> Opera</font>

113
00:04:31,810 --> 00:04:36,400
system in the packages not my log files

114
00:04:34,630 --> 00:04:37,450
in<font color="#E5E5E5"> my home directory or the</font><font color="#CCCCCC"> database on</font>

115
00:04:36,400 --> 00:04:41,229
my server or whatever

116
00:04:37,450 --> 00:04:43,030
and since<font color="#E5E5E5"> snapshots are instantaneous</font>

117
00:04:41,230 --> 00:04:45,610
<font color="#E5E5E5">and don't actually take any space until</font>

118
00:04:43,030 --> 00:04:47,080
you overwrite stuff<font color="#E5E5E5"> you have no reason</font>

119
00:04:45,610 --> 00:04:51,790
not<font color="#CCCCCC"> to</font><font color="#E5E5E5"> keep lots of snapshots instead of</font>

120
00:04:47,080 --> 00:04:54,130
s so it's easy<font color="#E5E5E5"> to go backwards this</font><font color="#CCCCCC"> way</font>

121
00:04:51,790 --> 00:04:57,520
<font color="#CCCCCC">you keep as many working images as you</font>

122
00:04:54,130 --> 00:04:58,930
want<font color="#E5E5E5"> and so no matter how</font><font color="#CCCCCC"> long ago it</font>

123
00:04:57,520 --> 00:05:03,609
turns out you<font color="#CCCCCC"> introduce the bug you can</font>

124
00:04:58,930 --> 00:05:05,590
<font color="#E5E5E5">always go back</font><font color="#CCCCCC"> to before</font><font color="#E5E5E5"> it so we</font>

125
00:05:03,610 --> 00:05:08,500
basically have multiple<font color="#E5E5E5"> versions of the</font>

126
00:05:05,590 --> 00:05:10,060
root<font color="#E5E5E5"> filesystem</font><font color="#CCCCCC"> and then you can use the</font>

127
00:05:08,500 --> 00:05:13,750
menu<font color="#E5E5E5"> in the</font><font color="#CCCCCC"> bootloader to select which</font>

128
00:05:10,060 --> 00:05:16,750
one<font color="#CCCCCC"> you</font><font color="#E5E5E5"> want to start from and you can</font>

129
00:05:13,750 --> 00:05:18,970
<font color="#E5E5E5">always choose to revert and go back and</font>

130
00:05:16,750 --> 00:05:20,620
again<font color="#CCCCCC"> you don't lose changes to the rest</font>

131
00:05:18,970 --> 00:05:23,470
of the system<font color="#E5E5E5"> only the operating system</font>

132
00:05:20,620 --> 00:05:26,169
<font color="#CCCCCC">I have a slide coming up that shows how</font>

133
00:05:23,470 --> 00:05:28,570
we layout the<font color="#CCCCCC"> filesystem to separate the</font>

134
00:05:26,169 --> 00:05:30,070
operating system and packages<font color="#E5E5E5"> from the</font>

135
00:05:28,570 --> 00:05:33,010
rest of<font color="#E5E5E5"> the system so</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> you can</font>

136
00:05:30,070 --> 00:05:34,719
achieve this<font color="#CCCCCC"> undo the operating system</font>

137
00:05:33,010 --> 00:05:40,120
changes but not all the<font color="#E5E5E5"> other changes on</font>

138
00:05:34,720 --> 00:05:42,220
<font color="#CCCCCC">your system</font><font color="#E5E5E5"> so because of the</font>

139
00:05:40,120 --> 00:05:45,520
flexibility you<font color="#E5E5E5"> get from stead of s you</font>

140
00:05:42,220 --> 00:05:47,710
get to decide what lives<font color="#E5E5E5"> as part</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the</font>

141
00:05:45,520 --> 00:05:50,770
system<font color="#CCCCCC"> image</font><font color="#E5E5E5"> and what stays persistent</font>

142
00:05:47,710 --> 00:05:52,719
across upgrades or whatever so any files

143
00:05:50,770 --> 00:05:55,150
that<font color="#E5E5E5"> end up in the</font><font color="#CCCCCC"> root file system</font>

144
00:05:52,720 --> 00:05:58,240
<font color="#CCCCCC">slash are considered part of the</font>

145
00:05:55,150 --> 00:05:59,950
operating<font color="#CCCCCC"> system so you'll see in a</font>

146
00:05:58,240 --> 00:06:02,890
second<font color="#CCCCCC"> how we actually create a data set</font>

147
00:05:59,950 --> 00:06:04,719
<font color="#CCCCCC">a file system</font><font color="#E5E5E5"> for /usr but we don't</font>

148
00:06:02,890 --> 00:06:07,330
actually mount it so<font color="#E5E5E5"> that all the files</font>

149
00:06:04,720 --> 00:06:09,970
<font color="#E5E5E5">in</font><font color="#CCCCCC"> u.s. our bin end up in slash and will</font>

150
00:06:07,330 --> 00:06:14,349
be rolled back or forward<font color="#E5E5E5"> as part</font><font color="#CCCCCC"> of the</font>

151
00:06:09,970 --> 00:06:16,990
there's boot<font color="#CCCCCC"> environment</font><font color="#E5E5E5"> you do have the</font>

152
00:06:14,350 --> 00:06:18,760
choice of whether<font color="#E5E5E5"> or not you want to</font>

153
00:06:16,990 --> 00:06:20,140
include<font color="#E5E5E5"> user local in the boot</font>

154
00:06:18,760 --> 00:06:23,680
environment<font color="#CCCCCC"> or have it at be a</font><font color="#E5E5E5"> separate</font>

155
00:06:20,140 --> 00:06:24,789
<font color="#E5E5E5">file system I on my</font><font color="#CCCCCC"> laptop</font><font color="#E5E5E5"> I always</font>

156
00:06:23,680 --> 00:06:27,340
<font color="#E5E5E5">include it as part</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the operating</font>

157
00:06:24,789 --> 00:06:29,830
<font color="#E5E5E5">system</font><font color="#CCCCCC"> because it's more</font><font color="#E5E5E5"> often</font><font color="#CCCCCC"> that X</font>

158
00:06:27,340 --> 00:06:32,429
<font color="#E5E5E5">something breaks</font><font color="#CCCCCC"> than FreeBSD breaks</font><font color="#E5E5E5"> and</font>

159
00:06:29,830 --> 00:06:35,200
that's<font color="#E5E5E5"> what I want to be able to undo</font>

160
00:06:32,430 --> 00:06:37,539
<font color="#CCCCCC">but on some of our servers we</font><font color="#E5E5E5"> actually</font>

161
00:06:35,200 --> 00:06:39,280
keep the software separate so that<font color="#E5E5E5"> we</font>

162
00:06:37,539 --> 00:06:42,330
can update the OS without having to

163
00:06:39,280 --> 00:06:42,330
touch<font color="#CCCCCC"> the software if we don't want</font>

164
00:06:43,550 --> 00:06:50,849
so this is the layout<font color="#E5E5E5"> of the default</font>

165
00:06:48,419 --> 00:06:52,979
file system<font color="#CCCCCC"> setup if you use the</font><font color="#E5E5E5"> ZFS</font>

166
00:06:50,849 --> 00:06:57,119
installer on<font color="#CCCCCC"> FreeBSD</font><font color="#E5E5E5"> so we have the root</font>

167
00:06:52,979 --> 00:06:58,949
of the pool<font color="#E5E5E5"> which we mount to</font><font color="#CCCCCC"> /z root</font>

168
00:06:57,119 --> 00:07:02,159
this<font color="#CCCCCC"> is so that when</font><font color="#E5E5E5"> you create a new</font>

169
00:06:58,949 --> 00:07:04,469
<font color="#E5E5E5">data set</font><font color="#CCCCCC"> so if you create</font><font color="#E5E5E5"> Z</font><font color="#CCCCCC"> root /foo</font><font color="#E5E5E5"> it</font>

170
00:07:02,159 --> 00:07:08,430
gets mounted<font color="#E5E5E5"> 2/0 /foo like the default</font>

171
00:07:04,469 --> 00:07:09,869
<font color="#E5E5E5">ins NFS and then we have this root which</font>

172
00:07:08,430 --> 00:07:11,580
<font color="#CCCCCC">is a container for all your boot</font>

173
00:07:09,869 --> 00:07:14,069
environments<font color="#E5E5E5"> and we don't mount it at</font>

174
00:07:11,580 --> 00:07:15,449
all and<font color="#CCCCCC"> then default is the boot</font>

175
00:07:14,069 --> 00:07:17,879
<font color="#CCCCCC">environment created by</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> installer</font><font color="#E5E5E5"> and</font>

176
00:07:15,449 --> 00:07:20,610
it's your slash<font color="#CCCCCC"> filesystem as you</font><font color="#E5E5E5"> can</font>

177
00:07:17,879 --> 00:07:22,199
see it contains<font color="#E5E5E5"> the 1.6 gigs of stuff</font>

178
00:07:20,610 --> 00:07:25,589
that<font color="#E5E5E5"> exists on my laptop</font><font color="#CCCCCC"> as the</font>

179
00:07:22,199 --> 00:07:28,889
<font color="#E5E5E5">operating</font><font color="#CCCCCC"> system and my temp is empty</font>

180
00:07:25,589 --> 00:07:30,869
but you see here<font color="#E5E5E5"> slash USR well it</font>

181
00:07:28,889 --> 00:07:34,139
<font color="#CCCCCC">actually contains twelve point three</font>

182
00:07:30,869 --> 00:07:37,229
gigs of stuff it's empty because<font color="#E5E5E5"> we're</font>

183
00:07:34,139 --> 00:07:39,209
not actually mounting slash USR so that

184
00:07:37,229 --> 00:07:41,039
all the files in user bin and user s bin

185
00:07:39,209 --> 00:07:43,559
and use the<font color="#CCCCCC"> labels so on</font><font color="#E5E5E5"> fall through in</font>

186
00:07:41,039 --> 00:07:46,589
the slash but we can create other

187
00:07:43,559 --> 00:07:48,449
directories like user obj<font color="#CCCCCC"> if I'm</font>

188
00:07:46,589 --> 00:07:50,399
compiling stuff<font color="#E5E5E5"> I don't want to lose</font>

189
00:07:48,449 --> 00:07:52,199
that<font color="#E5E5E5"> progress if I rewind the version of</font>

190
00:07:50,399 --> 00:07:54,930
<font color="#E5E5E5">the operating</font><font color="#CCCCCC"> system</font><font color="#E5E5E5"> or if I compile a</font>

191
00:07:52,199 --> 00:07:57,360
new kernel and it<font color="#E5E5E5"> crashes I want to back</font>

192
00:07:54,930 --> 00:07:59,039
up<font color="#E5E5E5"> to a not newer kernel but I want my</font>

193
00:07:57,360 --> 00:08:00,930
next<font color="#E5E5E5"> build for the fakes to be</font>

194
00:07:59,039 --> 00:08:05,068
<font color="#CCCCCC">incremental and only take a</font><font color="#E5E5E5"> couple</font>

195
00:08:00,930 --> 00:08:08,089
<font color="#E5E5E5">minutes instead of longer we use the and</font>

196
00:08:05,069 --> 00:08:11,009
then again<font color="#E5E5E5"> user home is separate</font><font color="#CCCCCC"> so that</font>

197
00:08:08,089 --> 00:08:12,709
when I revert the version<font color="#E5E5E5"> of my OS I</font>

198
00:08:11,009 --> 00:08:14,639
don't revert the version<font color="#E5E5E5"> of my slides</font>

199
00:08:12,709 --> 00:08:17,729
<font color="#E5E5E5">because then there</font><font color="#CCCCCC"> would be fewer slides</font>

200
00:08:14,639 --> 00:08:19,289
and you would be upset and we do the

201
00:08:17,729 --> 00:08:22,619
<font color="#E5E5E5">same trick with slash bar where again</font>

202
00:08:19,289 --> 00:08:24,269
it's not mounted so that<font color="#E5E5E5"> VAR DB</font><font color="#CCCCCC"> package</font>

203
00:08:22,619 --> 00:08:27,269
and so on end up in the boot<font color="#CCCCCC"> environment</font>

204
00:08:24,269 --> 00:08:30,869
<font color="#CCCCCC">but</font><font color="#E5E5E5"> we keep the audit logs to crash logs</font>

205
00:08:27,269 --> 00:08:32,459
and the regular logs<font color="#E5E5E5"> and my mail in</font>

206
00:08:30,869 --> 00:08:36,060
separate file<font color="#CCCCCC"> system so they don't get</font>

207
00:08:32,458 --> 00:08:37,169
reverted so<font color="#CCCCCC"> we pick and choose what</font>

208
00:08:36,059 --> 00:08:39,598
things are part of the<font color="#CCCCCC"> operating system</font>

209
00:08:37,169 --> 00:08:41,909
<font color="#CCCCCC">and</font><font color="#E5E5E5"> what are</font><font color="#CCCCCC"> not and</font><font color="#E5E5E5"> that way we can</font>

210
00:08:39,599 --> 00:08:49,050
control<font color="#E5E5E5"> what we want to rollback and</font>

211
00:08:41,909 --> 00:08:50,579
what we want to persist so when we

212
00:08:49,050 --> 00:08:53,010
<font color="#E5E5E5">wanted to deploy</font><font color="#CCCCCC"> our servers around</font><font color="#E5E5E5"> the</font>

213
00:08:50,579 --> 00:08:55,170
world and upgrade them constantly<font color="#CCCCCC"> we</font>

214
00:08:53,010 --> 00:08:57,360
wanted<font color="#E5E5E5"> to basically replace the entire</font>

215
00:08:55,170 --> 00:08:59,939
operating<font color="#CCCCCC"> system with a newer version</font>

216
00:08:57,360 --> 00:09:02,460
and not have to deal with<font color="#E5E5E5"> merging config</font>

217
00:08:59,940 --> 00:09:04,650
files you know<font color="#CCCCCC"> et Cie update or merge</font>

218
00:09:02,460 --> 00:09:07,200
master or previously updates merging

219
00:09:04,650 --> 00:09:12,449
thing made<font color="#CCCCCC"> me pull out my hair and I</font>

220
00:09:07,200 --> 00:09:14,490
don't have very<font color="#E5E5E5"> much so our goal with</font>

221
00:09:12,450 --> 00:09:16,920
the way we were designing the<font color="#CCCCCC"> new set up</font>

222
00:09:14,490 --> 00:09:18,810
for<font color="#CCCCCC"> boot environments was just I'm gonna</font>

223
00:09:16,920 --> 00:09:20,550
<font color="#E5E5E5">just drop down a new version of FreeBSD</font>

224
00:09:18,810 --> 00:09:22,380
<font color="#CCCCCC">and it's gonna have all the new config</font>

225
00:09:20,550 --> 00:09:25,290
files<font color="#E5E5E5"> and I'm not gonna have to merge</font>

226
00:09:22,380 --> 00:09:26,880
anything I'll<font color="#E5E5E5"> just overwrite but you</font>

227
00:09:25,290 --> 00:09:28,589
know there are some files in UTC that

228
00:09:26,880 --> 00:09:30,540
actually matter<font color="#E5E5E5"> like the</font><font color="#CCCCCC"> machine needs</font>

229
00:09:28,590 --> 00:09:34,260
<font color="#CCCCCC">to know what its IP address is they're</font>

230
00:09:30,540 --> 00:09:36,390
<font color="#E5E5E5">not using DHCP or anything so how do</font><font color="#CCCCCC"> i</font>

231
00:09:34,260 --> 00:09:39,900
persist<font color="#E5E5E5"> the config files like care</font><font color="#CCCCCC"> about</font>

232
00:09:36,390 --> 00:09:43,050
and not you know<font color="#E5E5E5"> every file in our CD</font>

233
00:09:39,900 --> 00:09:45,390
where the version control header changed

234
00:09:43,050 --> 00:09:49,650
and previously update wanted me to merge

235
00:09:45,390 --> 00:09:51,210
them<font color="#E5E5E5"> all so I thought we'll just make</font><font color="#CCCCCC"> ET</font>

236
00:09:49,650 --> 00:09:55,770
see its own file system<font color="#E5E5E5"> and maybe you</font>

237
00:09:51,210 --> 00:09:59,480
only<font color="#E5E5E5"> have to deal with that anybody have</font>

238
00:09:55,770 --> 00:09:59,480
any idea why that<font color="#CCCCCC"> won't work</font>

239
00:09:59,690 --> 00:10:08,700
yes ah you know<font color="#E5E5E5"> FS tab is in et Cie and</font>

240
00:10:03,960 --> 00:10:11,580
RC is in et<font color="#E5E5E5"> Cie and so you can't find</font>

241
00:10:08,700 --> 00:10:13,290
other file<font color="#CCCCCC"> systems to mount or give the</font>

242
00:10:11,580 --> 00:10:20,850
<font color="#E5E5E5">system</font><font color="#CCCCCC"> the instructions to mount</font><font color="#E5E5E5"> et</font><font color="#CCCCCC"> Cie</font>

243
00:10:13,290 --> 00:10:22,469
if there's not an<font color="#CCCCCC"> e GC</font><font color="#E5E5E5"> directory so yes</font>

244
00:10:20,850 --> 00:10:24,420
<font color="#E5E5E5">as it turns out lots of</font><font color="#CCCCCC"> things in the</font>

245
00:10:22,470 --> 00:10:27,270
boot process depend on<font color="#CCCCCC"> ET cie being</font>

246
00:10:24,420 --> 00:10:29,250
there and having<font color="#E5E5E5"> the files in it so</font>

247
00:10:27,270 --> 00:10:31,980
<font color="#E5E5E5">without</font><font color="#CCCCCC"> it you have no FS tab so you</font>

248
00:10:29,250 --> 00:10:34,050
don't get swap or any non ZFS file

249
00:10:31,980 --> 00:10:37,980
systems you might<font color="#E5E5E5"> want</font><font color="#CCCCCC"> to mount</font><font color="#E5E5E5"> no ET</font>

250
00:10:34,050 --> 00:10:39,420
<font color="#CCCCCC">CRC means nothing starts no RC Kampf</font>

251
00:10:37,980 --> 00:10:41,430
means your machine doesn't<font color="#E5E5E5"> have an IP</font>

252
00:10:39,420 --> 00:10:45,240
<font color="#CCCCCC">address or know what</font><font color="#E5E5E5"> its interfaces are</font>

253
00:10:41,430 --> 00:10:47,579
or what what's a VLAN<font color="#CCCCCC"> I don't know and</font>

254
00:10:45,240 --> 00:10:48,650
no<font color="#E5E5E5"> TTY is mean your serial console</font>

255
00:10:47,580 --> 00:10:54,540
probably doesn't work<font color="#E5E5E5"> either</font>

256
00:10:48,650 --> 00:10:56,550
so good luck fixing<font color="#CCCCCC"> it</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> that's problem</font>

257
00:10:54,540 --> 00:11:00,150
but I still really<font color="#CCCCCC"> really don't want to</font>

258
00:10:56,550 --> 00:11:03,510
have to merge<font color="#E5E5E5"> master so I stole an idea</font>

259
00:11:00,150 --> 00:11:07,199
<font color="#E5E5E5">from nano</font><font color="#CCCCCC"> BST because the system images</font>

260
00:11:03,510 --> 00:11:09,720
are read-only<font color="#E5E5E5"> they have</font><font color="#CCCCCC"> et Cie actually</font>

261
00:11:07,200 --> 00:11:11,579
mounted as an<font color="#CCCCCC"> MF s or temp FS</font>

262
00:11:09,720 --> 00:11:14,430
and then at boot they copy<font color="#CCCCCC"> the</font>

263
00:11:11,579 --> 00:11:17,310
persistent files from CFG<font color="#CCCCCC"> over top of ET</font>

264
00:11:14,430 --> 00:11:18,930
<font color="#CCCCCC">see if you've</font><font color="#E5E5E5"> ever used something that</font>

265
00:11:17,310 --> 00:11:20,670
<font color="#CCCCCC">uses Nano BSD you might have</font><font color="#E5E5E5"> gone and</font>

266
00:11:18,930 --> 00:11:22,529
changed<font color="#CCCCCC"> RC Kampf rebooted and wondered</font>

267
00:11:20,670 --> 00:11:23,819
why it<font color="#E5E5E5"> went away</font><font color="#CCCCCC"> it's because it</font>

268
00:11:22,529 --> 00:11:25,709
actually<font color="#E5E5E5"> you have to change the file</font>

269
00:11:23,819 --> 00:11:27,240
over<font color="#CCCCCC"> here</font><font color="#E5E5E5"> which will get written into</font>

270
00:11:25,709 --> 00:11:31,560
<font color="#CCCCCC">the memory file system that</font><font color="#E5E5E5"> just gets</font>

271
00:11:27,240 --> 00:11:34,699
blown away<font color="#E5E5E5"> every time but I didn't</font>

272
00:11:31,560 --> 00:11:37,410
<font color="#E5E5E5">really want a memory file system</font><font color="#CCCCCC"> so</font>

273
00:11:34,699 --> 00:11:39,689
while digging<font color="#E5E5E5"> into it</font><font color="#CCCCCC"> I accidentally</font>

274
00:11:37,410 --> 00:11:42,949
came<font color="#CCCCCC"> across this variable omit</font>

275
00:11:39,689 --> 00:11:46,170
underscore script in the<font color="#E5E5E5"> FreeBSD loader</font>

276
00:11:42,949 --> 00:11:47,939
<font color="#E5E5E5">it was originally designed for a system</font>

277
00:11:46,170 --> 00:11:52,889
where you<font color="#CCCCCC"> could actually boot the system</font>

278
00:11:47,939 --> 00:11:56,069
in a<font color="#CCCCCC"> C troop so in the loader conf you</font>

279
00:11:52,889 --> 00:11:58,230
would set the omits each<font color="#E5E5E5"> route to a</font>

280
00:11:56,069 --> 00:12:00,269
directory<font color="#CCCCCC"> and in its script was a script</font>

281
00:11:58,230 --> 00:12:02,850
<font color="#E5E5E5">that would run first to set up that</font><font color="#CCCCCC"> C</font>

282
00:12:00,269 --> 00:12:05,189
<font color="#CCCCCC">troop</font><font color="#E5E5E5"> to make sure it had you know</font><font color="#CCCCCC"> a</font>

283
00:12:02,850 --> 00:12:07,370
<font color="#CCCCCC">/dev</font><font color="#E5E5E5"> and any other things you needed in</font>

284
00:12:05,189 --> 00:12:10,469
there before<font color="#E5E5E5"> you see through to into it</font>

285
00:12:07,370 --> 00:12:13,230
so I'm not<font color="#CCCCCC"> using the C troop part but</font>

286
00:12:10,470 --> 00:12:16,439
I'm using or<font color="#E5E5E5"> abusing this thing which</font>

287
00:12:13,230 --> 00:12:19,110
causes the<font color="#CCCCCC"> system</font><font color="#E5E5E5"> to run</font><font color="#CCCCCC"> this shell</font>

288
00:12:16,439 --> 00:12:22,889
<font color="#E5E5E5">script before it tries to do</font><font color="#CCCCCC"> anything</font>

289
00:12:19,110 --> 00:12:25,800
like run<font color="#E5E5E5"> RC and so the script I'm using</font>

290
00:12:22,889 --> 00:12:28,500
is on the next<font color="#E5E5E5"> slide</font><font color="#CCCCCC"> so we set up this</font>

291
00:12:25,800 --> 00:12:30,209
little<font color="#E5E5E5"> script so</font><font color="#CCCCCC"> that mounts slash TFG</font>

292
00:12:28,500 --> 00:12:33,209
very early while we're still<font color="#E5E5E5"> in single</font>

293
00:12:30,209 --> 00:12:33,869
<font color="#E5E5E5">user mode so that</font><font color="#CCCCCC"> when we actually try</font>

294
00:12:33,209 --> 00:12:35,910
<font color="#CCCCCC">to boot</font>

295
00:12:33,870 --> 00:12:40,769
it'll be able<font color="#E5E5E5"> to find FS tab and all the</font>

296
00:12:35,910 --> 00:12:41,969
other files<font color="#E5E5E5"> and</font><font color="#CCCCCC"> since we have snapshots</font>

297
00:12:40,769 --> 00:12:43,709
and<font color="#E5E5E5"> so on we don't have to keep</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> as a</font>

298
00:12:41,970 --> 00:12:44,759
separate<font color="#E5E5E5"> file system</font><font color="#CCCCCC"> like</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> net OB SD to</font>

299
00:12:43,709 --> 00:12:48,779
make sure you don't<font color="#E5E5E5"> corrupt it or</font>

300
00:12:44,759 --> 00:12:51,209
something<font color="#CCCCCC"> so we have CFG with a couple</font>

301
00:12:48,779 --> 00:12:53,699
of<font color="#E5E5E5"> important config files in it and then</font>

302
00:12:51,209 --> 00:12:56,849
we<font color="#E5E5E5"> just</font><font color="#CCCCCC"> replaced those same files in et</font>

303
00:12:53,699 --> 00:12:58,410
<font color="#CCCCCC">Cie with a symlink</font><font color="#E5E5E5"> pointing to CFG so</font>

304
00:12:56,850 --> 00:13:00,839
when we slap down<font color="#E5E5E5"> the new image it</font>

305
00:12:58,410 --> 00:13:04,319
already has the sim link in it<font color="#CCCCCC"> and it</font>

306
00:13:00,839 --> 00:13:08,879
knows to<font color="#E5E5E5"> read our C comp from CFG</font>

307
00:13:04,319 --> 00:13:09,269
instead of<font color="#CCCCCC"> /et</font><font color="#E5E5E5"> C so the script is pretty</font>

308
00:13:08,879 --> 00:13:10,980
simple

309
00:13:09,269 --> 00:13:12,839
<font color="#E5E5E5">it runs the mount command with the</font>

310
00:13:10,980 --> 00:13:14,699
parsable flag so prints out

311
00:13:12,839 --> 00:13:17,250
<font color="#CCCCCC">tab-delimited</font><font color="#E5E5E5"> instead of trying to line</font>

312
00:13:14,699 --> 00:13:18,870
up columns<font color="#E5E5E5"> for humans and then we just</font>

313
00:13:17,250 --> 00:13:20,790
<font color="#CCCCCC">use the simple shell script to read the</font>

314
00:13:18,870 --> 00:13:21,509
device<font color="#CCCCCC"> the mount</font><font color="#E5E5E5"> point the type and the</font>

315
00:13:20,790 --> 00:13:23,610
rest of<font color="#CCCCCC"> the line</font>

316
00:13:21,509 --> 00:13:25,950
if the mount<font color="#E5E5E5"> point is slash</font>

317
00:13:23,610 --> 00:13:28,050
we keep<font color="#E5E5E5"> going otherwise we continue and</font>

318
00:13:25,950 --> 00:13:31,380
<font color="#E5E5E5">read the next line if the type is</font><font color="#CCCCCC"> that</font>

319
00:13:28,050 --> 00:13:33,390
<font color="#CCCCCC">if s then we extract the pool so get all</font>

320
00:13:31,380 --> 00:13:36,089
of the device variable up till the first

321
00:13:33,390 --> 00:13:39,149
slash and then<font color="#E5E5E5"> we just mount that pool</font>

322
00:13:36,089 --> 00:13:41,880
name slash CFG<font color="#E5E5E5"> and now the CFG data set</font>

323
00:13:39,149 --> 00:13:43,769
will<font color="#CCCCCC"> be mounted</font><font color="#E5E5E5"> before</font><font color="#CCCCCC"> we</font><font color="#E5E5E5"> get to the</font>

324
00:13:41,880 --> 00:13:46,050
<font color="#E5E5E5">point where normally all your file</font>

325
00:13:43,769 --> 00:13:49,459
systems other than slash<font color="#CCCCCC"> for ZFS are</font>

326
00:13:46,050 --> 00:13:52,560
mounted by<font color="#CCCCCC"> the RC or the ZFS RC service</font>

327
00:13:49,459 --> 00:13:55,229
<font color="#E5E5E5">which gets run from our</font><font color="#CCCCCC"> CD comp which</font>

328
00:13:52,560 --> 00:13:57,529
obviously if you<font color="#E5E5E5"> don't have a CFG but</font>

329
00:13:55,230 --> 00:13:59,940
your RC<font color="#CCCCCC"> dog hump is it won't</font><font color="#E5E5E5"> happen so</font>

330
00:13:57,529 --> 00:14:01,589
<font color="#CCCCCC">we mount the one file system early and</font>

331
00:13:59,940 --> 00:14:03,209
then the regular<font color="#CCCCCC"> process takes care of</font>

332
00:14:01,589 --> 00:14:07,410
the<font color="#E5E5E5"> rest of the file systems</font><font color="#CCCCCC"> just</font><font color="#E5E5E5"> like a</font>

333
00:14:03,209 --> 00:14:09,630
normal<font color="#E5E5E5"> boot so we end up with</font><font color="#CCCCCC"> about</font><font color="#E5E5E5"> 10</font>

334
00:14:07,410 --> 00:14:13,529
files that we care about<font color="#E5E5E5"> in</font><font color="#CCCCCC"> slash CFG</font>

335
00:14:09,630 --> 00:14:14,730
and any other file<font color="#E5E5E5"> we ship the version</font>

336
00:14:13,529 --> 00:14:17,510
we want as<font color="#E5E5E5"> part of the operating system</font>

337
00:14:14,730 --> 00:14:20,730
<font color="#CCCCCC">and it's never unique on any one server</font>

338
00:14:17,510 --> 00:14:23,189
so all<font color="#E5E5E5"> that we really</font><font color="#CCCCCC"> care about is the</font>

339
00:14:20,730 --> 00:14:26,279
network settings<font color="#E5E5E5"> our servers have a</font>

340
00:14:23,190 --> 00:14:29,640
slash<font color="#E5E5E5"> 29 of static IPS from each</font>

341
00:14:26,279 --> 00:14:32,100
provider<font color="#E5E5E5"> we need certain</font><font color="#CCCCCC"> sissy TLS we</font>

342
00:14:29,640 --> 00:14:34,020
set for tuning the network and so on the

343
00:14:32,100 --> 00:14:35,850
SSH keys<font color="#CCCCCC"> the important thing was when we</font>

344
00:14:34,020 --> 00:14:39,870
upgrade<font color="#CCCCCC"> the system</font><font color="#E5E5E5"> we didn't want our</font>

345
00:14:35,850 --> 00:14:42,060
SSH keys to<font color="#E5E5E5"> change or to</font><font color="#CCCCCC"> have the same</font>

346
00:14:39,870 --> 00:14:44,459
SSH key on every machine<font color="#E5E5E5"> didn't want</font>

347
00:14:42,060 --> 00:14:45,660
that either so we keep them the FS tab

348
00:14:44,459 --> 00:14:47,250
<font color="#E5E5E5">because we have different swap</font>

349
00:14:45,660 --> 00:14:49,290
configurations depending how many<font color="#CCCCCC"> disks</font>

350
00:14:47,250 --> 00:14:52,560
the<font color="#E5E5E5"> machine has it might have more swap</font>

351
00:14:49,290 --> 00:14:54,510
or mirrored swap or whatever<font color="#CCCCCC"> ah</font>

352
00:14:52,560 --> 00:14:55,829
<font color="#CCCCCC">and yeah the rest of</font><font color="#E5E5E5"> UTC we can just</font>

353
00:14:54,510 --> 00:14:58,319
overwrite with the stock files every

354
00:14:55,829 --> 00:15:01,680
time we treat<font color="#E5E5E5"> almost all of</font><font color="#CCCCCC"> e.t.c as if</font>

355
00:14:58,320 --> 00:15:02,730
it was the defaults directory ah<font color="#CCCCCC"> nice</font>

356
00:15:01,680 --> 00:15:05,279
thing about this is you<font color="#E5E5E5"> never get</font>

357
00:15:02,730 --> 00:15:07,740
<font color="#E5E5E5">leftover merge markers in your files</font>

358
00:15:05,279 --> 00:15:10,020
<font color="#E5E5E5">causing them not to parse and you don't</font>

359
00:15:07,740 --> 00:15:14,360
have to ever think<font color="#E5E5E5"> about that</font><font color="#CCCCCC"> again or</font>

360
00:15:10,020 --> 00:15:17,220
merge all<font color="#E5E5E5"> our CID files because of the</font>

361
00:15:14,360 --> 00:15:19,610
version of<font color="#CCCCCC"> the revision control stuff</font>

362
00:15:17,220 --> 00:15:19,610
changing

363
00:15:22,140 --> 00:15:29,830
well the files we care<font color="#CCCCCC"> about going CFG</font>

364
00:15:25,720 --> 00:15:31,600
<font color="#E5E5E5">and would stay as a symlink because we</font>

365
00:15:29,830 --> 00:15:34,360
produce the image<font color="#E5E5E5"> that we're replacing</font>

366
00:15:31,600 --> 00:15:36,460
the OS with so it's got the<font color="#CCCCCC"> ten files we</font>

367
00:15:34,360 --> 00:15:38,680
care about change<font color="#E5E5E5"> the system links and</font>

368
00:15:36,460 --> 00:15:40,090
every<font color="#E5E5E5"> other file gets upgraded to the</font>

369
00:15:38,680 --> 00:15:44,500
vanilla<font color="#E5E5E5"> one from whatever version of</font>

370
00:15:40,090 --> 00:15:46,960
<font color="#CCCCCC">FreeBSD we're upgrading to so the way we</font>

371
00:15:44,500 --> 00:15:49,570
used to<font color="#E5E5E5"> do this originally was spin up a</font>

372
00:15:46,960 --> 00:15:51,550
<font color="#E5E5E5">VM</font><font color="#CCCCCC"> install FreeBSD</font><font color="#E5E5E5"> then like delete the</font>

373
00:15:49,570 --> 00:15:54,690
<font color="#E5E5E5">SSH keys and try to clean up and so on</font>

374
00:15:51,550 --> 00:15:57,550
but<font color="#CCCCCC"> that never worked out</font><font color="#E5E5E5"> very well</font>

375
00:15:54,690 --> 00:16:00,040
we'll get<font color="#E5E5E5"> to that</font><font color="#CCCCCC"> in a</font><font color="#E5E5E5"> minute so now</font>

376
00:15:57,550 --> 00:16:01,750
that we have<font color="#CCCCCC"> created this boot</font>

377
00:16:00,040 --> 00:16:05,050
<font color="#CCCCCC">environment</font><font color="#E5E5E5"> how can we need</font><font color="#CCCCCC"> apply it to</font>

378
00:16:01,750 --> 00:16:08,130
many servers<font color="#E5E5E5"> so on the virtual machine</font>

379
00:16:05,050 --> 00:16:10,329
where we've created our image of<font color="#E5E5E5"> the</font>

380
00:16:08,130 --> 00:16:12,670
<font color="#CCCCCC">newer version of FreeBSD that we want to</font>

381
00:16:10,330 --> 00:16:15,370
<font color="#E5E5E5">use we just</font><font color="#CCCCCC"> take a</font><font color="#E5E5E5"> snapshot of the boot</font>

382
00:16:12,670 --> 00:16:17,620
environment<font color="#CCCCCC"> and you</font><font color="#E5E5E5"> set up ascend to</font>

383
00:16:15,370 --> 00:16:20,980
pipe it into<font color="#E5E5E5"> a file and we'll exit it as</font>

384
00:16:17,620 --> 00:16:22,750
well<font color="#E5E5E5"> just to</font><font color="#CCCCCC"> make it smaller then on</font>

385
00:16:20,980 --> 00:16:25,420
each of the hundreds<font color="#CCCCCC"> of machines</font><font color="#E5E5E5"> we want</font>

386
00:16:22,750 --> 00:16:30,610
to upgrade we just run fetch<font color="#E5E5E5"> output to</font>

387
00:16:25,420 --> 00:16:33,939
standard out the HTTP path to the file

388
00:16:30,610 --> 00:16:36,280
we created<font color="#E5E5E5"> like that an unaccepted</font><font color="#CCCCCC"> is</font>

389
00:16:33,940 --> 00:16:38,680
<font color="#CCCCCC">Eva's receive and give it the</font><font color="#E5E5E5"> name of</font>

390
00:16:36,280 --> 00:16:42,209
<font color="#CCCCCC">the new boot environment</font><font color="#E5E5E5"> and that file</font>

391
00:16:38,680 --> 00:16:44,890
<font color="#E5E5E5">system will suddenly appear</font><font color="#CCCCCC"> then we use</font>

392
00:16:42,210 --> 00:16:47,560
<font color="#CCCCCC">those NFS boot CFG which is the way you</font>

393
00:16:44,890 --> 00:16:52,449
do<font color="#E5E5E5"> that one boot thank so you say you</font>

394
00:16:47,560 --> 00:16:54,550
know one boot<font color="#E5E5E5"> one boot only and say boot</font>

395
00:16:52,450 --> 00:16:56,440
<font color="#E5E5E5">this data set so it writes into the ZFS</font>

396
00:16:54,550 --> 00:16:58,689
label the name of the data set you

397
00:16:56,440 --> 00:17:00,580
selected the loader<font color="#E5E5E5"> will then read that</font>

398
00:16:58,690 --> 00:17:03,970
and<font color="#E5E5E5"> immediately write it</font><font color="#CCCCCC"> over with</font><font color="#E5E5E5"> zeros</font>

399
00:17:00,580 --> 00:17:05,290
and boot<font color="#CCCCCC"> the data set you selected if it</font>

400
00:17:03,970 --> 00:17:07,800
doesn't work or whatever<font color="#E5E5E5"> again your</font>

401
00:17:05,290 --> 00:17:09,940
power cycle<font color="#E5E5E5"> when it comes back up that</font>

402
00:17:07,800 --> 00:17:10,720
override is full of<font color="#E5E5E5"> zeros so it ignores</font>

403
00:17:09,940 --> 00:17:13,750
<font color="#E5E5E5">it and boots</font>

404
00:17:10,720 --> 00:17:15,339
the original food environment<font color="#E5E5E5"> but from</font>

405
00:17:13,750 --> 00:17:16,720
before the upgrade<font color="#E5E5E5"> so if something</font>

406
00:17:15,339 --> 00:17:18,819
doesn't<font color="#E5E5E5"> work you get back your working</font>

407
00:17:16,720 --> 00:17:21,790
<font color="#E5E5E5">system which is a power cycle but if it</font>

408
00:17:18,819 --> 00:17:27,760
does work<font color="#CCCCCC"> you're booted up in a newer</font>

409
00:17:21,790 --> 00:17:28,780
version of FreeBSD at this<font color="#E5E5E5"> point in the</font>

410
00:17:27,760 --> 00:17:31,810
process<font color="#E5E5E5"> we still had to deal with</font>

411
00:17:28,780 --> 00:17:33,040
actually upgrading the packages<font color="#CCCCCC"> because</font>

412
00:17:31,810 --> 00:17:35,200
<font color="#E5E5E5">we didn't ship</font>

413
00:17:33,040 --> 00:17:36,820
on our servers<font color="#CCCCCC"> we keep using local</font>

414
00:17:35,200 --> 00:17:39,850
separate from the the boot<font color="#CCCCCC"> environment</font>

415
00:17:36,820 --> 00:17:42,010
but<font color="#E5E5E5"> you could choose not to do that and</font>

416
00:17:39,850 --> 00:17:45,030
then we<font color="#E5E5E5"> also had</font><font color="#CCCCCC"> upgrade each jail again</font>

417
00:17:42,010 --> 00:17:47,970
<font color="#E5E5E5">upgrading the packages in it and</font>

418
00:17:45,030 --> 00:17:50,920
building images was painful<font color="#CCCCCC"> of</font><font color="#E5E5E5"> manual</font>

419
00:17:47,970 --> 00:17:53,380
using that<font color="#E5E5E5"> VM always forget something</font>

420
00:17:50,920 --> 00:17:57,190
<font color="#CCCCCC">whether it was fix one</font><font color="#E5E5E5"> of the</font><font color="#CCCCCC"> sim links</font>

421
00:17:53,380 --> 00:17:59,410
or Rhea Rhea<font color="#CCCCCC"> stew SSH keys or</font><font color="#E5E5E5"> oh it</font>

422
00:17:57,190 --> 00:18:01,240
regenerated<font color="#CCCCCC"> the</font><font color="#E5E5E5"> host ID file again or</font>

423
00:17:59,410 --> 00:18:03,040
something<font color="#CCCCCC"> so I wanted a much better way</font>

424
00:18:01,240 --> 00:18:04,600
<font color="#CCCCCC">to generate</font><font color="#E5E5E5"> these images that I was</font>

425
00:18:03,040 --> 00:18:06,940
going<font color="#E5E5E5"> to push</font><font color="#CCCCCC"> to all the</font><font color="#E5E5E5"> servers because</font>

426
00:18:04,600 --> 00:18:08,889
<font color="#CCCCCC">I</font><font color="#E5E5E5"> needed them to be right every</font><font color="#CCCCCC"> time</font><font color="#E5E5E5"> not</font>

427
00:18:06,940 --> 00:18:12,490
slightly wrong in a different way<font color="#CCCCCC"> every</font>

428
00:18:08,890 --> 00:18:14,500
time<font color="#CCCCCC"> and the other</font><font color="#E5E5E5"> problem you had is</font>

429
00:18:12,490 --> 00:18:16,570
when<font color="#E5E5E5"> we want to actually install a</font>

430
00:18:14,500 --> 00:18:17,800
server for the first time we'd still

431
00:18:16,570 --> 00:18:22,389
<font color="#CCCCCC">have</font><font color="#E5E5E5"> to do it the old-fashioned way</font><font color="#CCCCCC"> and</font>

432
00:18:17,800 --> 00:18:24,100
<font color="#E5E5E5">then upgrade</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> to this and it was not</font>

433
00:18:22,390 --> 00:18:26,740
something<font color="#E5E5E5"> anyone other than me</font><font color="#CCCCCC"> could</font>

434
00:18:24,100 --> 00:18:31,929
<font color="#E5E5E5">really do and that wasn't</font><font color="#CCCCCC"> useful to</font>

435
00:18:26,740 --> 00:18:34,420
<font color="#CCCCCC">anybody so in</font><font color="#E5E5E5"> our environment at scale</font>

436
00:18:31,930 --> 00:18:36,130
engine we<font color="#CCCCCC"> have over 100 servers spread</font>

437
00:18:34,420 --> 00:18:38,920
across 38 data centers in 11<font color="#E5E5E5"> different</font>

438
00:18:36,130 --> 00:18:41,320
countries<font color="#E5E5E5"> as</font><font color="#CCCCCC"> use</font><font color="#E5E5E5"> even though the numbers</font>

439
00:18:38,920 --> 00:18:44,140
on average there's<font color="#E5E5E5"> two or three servers</font>

440
00:18:41,320 --> 00:18:45,820
<font color="#E5E5E5">in each data center so we don't have the</font>

441
00:18:44,140 --> 00:18:47,290
kind of<font color="#CCCCCC"> setup</font><font color="#E5E5E5"> where you can</font><font color="#CCCCCC"> pixie boot</font>

442
00:18:45,820 --> 00:18:49,379
the machines or something because

443
00:18:47,290 --> 00:18:53,290
<font color="#CCCCCC">there's</font><font color="#E5E5E5"> only a couple in each place and</font>

444
00:18:49,380 --> 00:18:56,650
<font color="#CCCCCC">so you kind of have to manually manage</font>

445
00:18:53,290 --> 00:18:58,540
them and<font color="#E5E5E5"> the team there for</font><font color="#CCCCCC"> sis admin's</font>

446
00:18:56,650 --> 00:19:01,600
was really myself<font color="#E5E5E5"> and one</font><font color="#CCCCCC"> full-time</font>

447
00:18:58,540 --> 00:19:03,639
<font color="#E5E5E5">system in and that was it so they</font>

448
00:19:01,600 --> 00:19:04,540
anything<font color="#CCCCCC"> labor</font><font color="#E5E5E5"> intensive was going to be</font>

449
00:19:03,640 --> 00:19:06,940
right out

450
00:19:04,540 --> 00:19:11,260
and we weren't<font color="#E5E5E5"> using the same version of</font>

451
00:19:06,940 --> 00:19:14,320
<font color="#CCCCCC">FreeBSD on everything</font><font color="#E5E5E5"> we finally got</font><font color="#CCCCCC"> rid</font>

452
00:19:11,260 --> 00:19:16,660
of the last 11.1 machines so that's good

453
00:19:14,320 --> 00:19:20,919
<font color="#E5E5E5">but we still</font><font color="#CCCCCC"> have a</font><font color="#E5E5E5"> lot of</font><font color="#CCCCCC"> 11:2 machines</font>

454
00:19:16,660 --> 00:19:22,570
that<font color="#E5E5E5"> need to get up</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> 12 and doing</font>

455
00:19:20,920 --> 00:19:23,650
previously<font color="#E5E5E5"> update was just to manual and</font>

456
00:19:22,570 --> 00:19:26,290
<font color="#E5E5E5">to slow</font>

457
00:19:23,650 --> 00:19:27,550
fetching<font color="#CCCCCC"> 40000 patches just doesn't make</font>

458
00:19:26,290 --> 00:19:30,370
<font color="#E5E5E5">sense</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> the server with a gigabit</font>

459
00:19:27,550 --> 00:19:32,770
<font color="#E5E5E5">connection when you could just</font><font color="#CCCCCC"> download</font>

460
00:19:30,370 --> 00:19:37,120
the whole thing is one big<font color="#E5E5E5"> tar file and</font>

461
00:19:32,770 --> 00:19:38,560
it would be done so again we have the

462
00:19:37,120 --> 00:19:42,250
process where we<font color="#E5E5E5"> just set</font><font color="#CCCCCC"> up as receive</font>

463
00:19:38,560 --> 00:19:45,790
us one boot<font color="#E5E5E5"> reboot machines</font><font color="#CCCCCC"> backup as</font>

464
00:19:42,250 --> 00:19:46,510
<font color="#E5E5E5">fast as it can reboot</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> if it works we</font>

465
00:19:45,790 --> 00:19:48,668
just stamp

466
00:19:46,510 --> 00:19:50,770
<font color="#E5E5E5">food environment as the default from now</font>

467
00:19:48,669 --> 00:19:52,600
on<font color="#E5E5E5"> if it doesn't one more power cycle</font>

468
00:19:50,770 --> 00:19:55,110
and<font color="#E5E5E5"> it's back to how it was</font><font color="#CCCCCC"> and you</font>

469
00:19:52,600 --> 00:19:58,240
figure out<font color="#E5E5E5"> what was going wrong later</font>

470
00:19:55,110 --> 00:20:00,159
this<font color="#E5E5E5"> was very nice especially some of</font>

471
00:19:58,240 --> 00:20:02,500
<font color="#E5E5E5">the servers are</font><font color="#CCCCCC"> in remote countries like</font>

472
00:20:00,160 --> 00:20:06,160
Singapore<font color="#E5E5E5"> and we don't even have console</font>

473
00:20:02,500 --> 00:20:06,340
<font color="#CCCCCC">access so really try hard not to</font><font color="#E5E5E5"> break</font>

474
00:20:06,160 --> 00:20:09,280
it

475
00:20:06,340 --> 00:20:15,699
and so just power cycle it<font color="#E5E5E5"> and it comes</font>

476
00:20:09,280 --> 00:20:18,160
<font color="#CCCCCC">back is really useful so in my</font>

477
00:20:15,700 --> 00:20:20,260
investigation<font color="#E5E5E5"> of ways to make the images</font>

478
00:20:18,160 --> 00:20:22,480
nicer<font color="#E5E5E5"> I've actually stumbled across food</font>

479
00:20:20,260 --> 00:20:25,809
rare so food rare if you don't know is

480
00:20:22,480 --> 00:20:27,429
the tool used to build the binary

481
00:20:25,809 --> 00:20:30,070
packages for<font color="#CCCCCC"> third-party</font><font color="#E5E5E5"> programs on</font>

482
00:20:27,429 --> 00:20:32,020
<font color="#CCCCCC">FreeBSD</font><font color="#E5E5E5"> so it builds all the ports in</font>

483
00:20:30,070 --> 00:20:34,418
<font color="#E5E5E5">the ports tree as packages that you can</font>

484
00:20:32,020 --> 00:20:37,720
<font color="#CCCCCC">download</font><font color="#E5E5E5"> it does this in an interesting</font>

485
00:20:34,419 --> 00:20:39,790
way it<font color="#E5E5E5"> uses a jail to build inside of</font>

486
00:20:37,720 --> 00:20:41,110
and it does one jail for each<font color="#CCCCCC"> CPU you</font>

487
00:20:39,790 --> 00:20:43,899
give it and does<font color="#E5E5E5"> many things</font>

488
00:20:41,110 --> 00:20:46,899
concurrently<font color="#CCCCCC"> because it turns out</font><font color="#E5E5E5"> that's</font>

489
00:20:43,900 --> 00:20:49,150
usually keeps the<font color="#E5E5E5"> CPU busy better than</font>

490
00:20:46,900 --> 00:20:52,630
trying to do one multi-threaded build<font color="#E5E5E5"> at</font>

491
00:20:49,150 --> 00:20:54,280
a time<font color="#E5E5E5"> because you know during dot slash</font>

492
00:20:52,630 --> 00:20:58,030
configure and so on it's not actually

493
00:20:54,280 --> 00:21:00,668
<font color="#E5E5E5">using all of your course so running more</font>

494
00:20:58,030 --> 00:21:03,190
build<font color="#CCCCCC"> single threaded at once turned</font><font color="#E5E5E5"> out</font>

495
00:21:00,669 --> 00:21:04,809
<font color="#CCCCCC">to be better and the jails mean that</font>

496
00:21:03,190 --> 00:21:07,179
you're<font color="#E5E5E5"> getting a fresh image with no</font>

497
00:21:04,809 --> 00:21:09,970
<font color="#E5E5E5">pollution in every time and</font><font color="#CCCCCC"> it can use</font>

498
00:21:07,179 --> 00:21:15,250
<font color="#CCCCCC">ZFS</font><font color="#E5E5E5"> to revert the jail back to pristine</font>

499
00:21:09,970 --> 00:21:16,419
every time and it does nice<font color="#CCCCCC"> things</font>

500
00:21:15,250 --> 00:21:18,669
because<font color="#E5E5E5"> you can</font><font color="#CCCCCC"> have</font><font color="#E5E5E5"> multiple different</font>

501
00:21:16,419 --> 00:21:20,590
<font color="#E5E5E5">ports trees that you build from you can</font>

502
00:21:18,669 --> 00:21:22,120
build<font color="#E5E5E5"> each of those port trees for every</font>

503
00:21:20,590 --> 00:21:24,610
<font color="#E5E5E5">version of</font><font color="#CCCCCC"> freebsd that you care about</font>

504
00:21:22,120 --> 00:21:26,530
on each architecture that you<font color="#E5E5E5"> care</font><font color="#CCCCCC"> about</font>

505
00:21:24,610 --> 00:21:28,600
and you<font color="#CCCCCC"> can build multiple</font><font color="#E5E5E5"> package sets</font>

506
00:21:26,530 --> 00:21:34,899
for<font color="#CCCCCC"> each one</font><font color="#E5E5E5"> so you can end</font><font color="#CCCCCC"> up with a</font>

507
00:21:28,600 --> 00:21:37,360
lot effects<font color="#E5E5E5"> so while I was struggling</font>

508
00:21:34,900 --> 00:21:40,299
<font color="#E5E5E5">with some of</font><font color="#CCCCCC"> this I</font><font color="#E5E5E5"> happen to get to sit</font>

509
00:21:37,360 --> 00:21:43,928
on<font color="#E5E5E5"> a picnic table a side in the nice</font>

510
00:21:40,299 --> 00:21:45,639
warm air in Taiwan with<font color="#E5E5E5"> Baptiste</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> he</font>

511
00:21:43,929 --> 00:21:48,040
<font color="#E5E5E5">told me about food rare image that he</font>

512
00:21:45,640 --> 00:21:50,799
had worked<font color="#E5E5E5"> on at Gandhi to build VM</font>

513
00:21:48,040 --> 00:21:51,639
images<font color="#E5E5E5"> for their public cloud and</font><font color="#CCCCCC"> it was</font>

514
00:21:50,799 --> 00:21:54,220
specifically designed<font color="#E5E5E5"> to build</font>

515
00:21:51,640 --> 00:21:55,950
customized<font color="#E5E5E5"> VM images with like the cloud</font>

516
00:21:54,220 --> 00:21:59,830
<font color="#E5E5E5">where package is</font><font color="#CCCCCC"> pre-installed and stuff</font>

517
00:21:55,950 --> 00:22:02,950
or to build<font color="#CCCCCC"> USB stick images</font>

518
00:21:59,830 --> 00:22:05,260
so I looked at<font color="#E5E5E5"> that and saw that it</font>

519
00:22:02,950 --> 00:22:08,880
could<font color="#E5E5E5"> do most of what I wanted it can</font>

520
00:22:05,260 --> 00:22:13,090
build ISOs<font color="#CCCCCC"> MF s based ISOs USB sticks</font>

521
00:22:08,880 --> 00:22:15,760
<font color="#E5E5E5">raw</font><font color="#CCCCCC"> disks tar files firmware images for</font>

522
00:22:13,090 --> 00:22:19,330
<font color="#E5E5E5">things like</font><font color="#CCCCCC"> nano BSD</font><font color="#E5E5E5"> or for embedded</font>

523
00:22:15,760 --> 00:22:23,790
images for like raspberry<font color="#E5E5E5"> PI's or pining</font>

524
00:22:19,330 --> 00:22:23,790
<font color="#E5E5E5">60</font><font color="#CCCCCC"> force because menu helped</font><font color="#E5E5E5"> with</font><font color="#CCCCCC"> it</font>

525
00:22:24,850 --> 00:22:29,980
so my immediate reaction<font color="#CCCCCC"> is alright I</font>

526
00:22:27,130 --> 00:22:32,220
will<font color="#CCCCCC"> add ZFS send as a file format to</font>

527
00:22:29,980 --> 00:22:37,360
<font color="#E5E5E5">this so one of the output you can get is</font>

528
00:22:32,220 --> 00:22:39,760
<font color="#E5E5E5">the stuff to recreate a ZFS pool</font><font color="#CCCCCC"> so I</font>

529
00:22:37,360 --> 00:22:43,030
did<font color="#E5E5E5"> that you get two new</font><font color="#CCCCCC"> options one is</font>

530
00:22:39,760 --> 00:22:44,950
<font color="#E5E5E5">ZFS send which will take the entire pool</font>

531
00:22:43,030 --> 00:22:47,950
<font color="#CCCCCC">Aegis</font><font color="#E5E5E5"> created and send that as a</font>

532
00:22:44,950 --> 00:22:50,380
<font color="#CCCCCC">replication stream or which is what we</font>

533
00:22:47,950 --> 00:22:52,330
would<font color="#E5E5E5"> use</font><font color="#CCCCCC"> to do a new install or you can</font>

534
00:22:50,380 --> 00:22:53,679
do set of SN<font color="#E5E5E5"> plus B</font><font color="#CCCCCC"> E</font><font color="#E5E5E5"> and you'll get</font>

535
00:22:52,330 --> 00:22:55,960
<font color="#E5E5E5">only the boot environment</font><font color="#CCCCCC"> part and</font>

536
00:22:53,679 --> 00:22:59,679
you'll ignore<font color="#E5E5E5"> the rest and that's the</font>

537
00:22:55,960 --> 00:23:02,620
<font color="#E5E5E5">image you use to do an upgrade</font><font color="#CCCCCC"> I've</font>

538
00:22:59,679 --> 00:23:04,660
modified the overlay handling so<font color="#E5E5E5"> Poudre</font>

539
00:23:02,620 --> 00:23:06,459
image has the<font color="#CCCCCC"> ability to say here's a</font>

540
00:23:04,660 --> 00:23:07,929
directory full of<font color="#E5E5E5"> files I want</font><font color="#CCCCCC"> you to</font>

541
00:23:06,460 --> 00:23:11,170
put over<font color="#CCCCCC"> top of</font><font color="#E5E5E5"> the image before</font><font color="#CCCCCC"> you</font>

542
00:23:07,929 --> 00:23:13,000
package it<font color="#CCCCCC"> up but it it followed</font>

543
00:23:11,170 --> 00:23:15,250
symlinks instead of copying siblings<font color="#CCCCCC"> so</font>

544
00:23:13,000 --> 00:23:17,650
I changed I made the option to do it

545
00:23:15,250 --> 00:23:19,390
<font color="#E5E5E5">this way so</font><font color="#CCCCCC"> that it would install</font><font color="#E5E5E5"> all my</font>

546
00:23:17,650 --> 00:23:23,320
simulates<font color="#CCCCCC"> in et</font><font color="#E5E5E5"> Cie pointing to slash</font>

547
00:23:19,390 --> 00:23:25,990
CFG<font color="#CCCCCC"> and</font><font color="#E5E5E5"> I added support for defining the</font>

548
00:23:23,320 --> 00:23:27,790
<font color="#CCCCCC">ZFS</font><font color="#E5E5E5"> layout instead of you being stuck</font>

549
00:23:25,990 --> 00:23:29,320
with how I like to<font color="#E5E5E5"> do it you write a</font>

550
00:23:27,790 --> 00:23:31,240
text file with<font color="#CCCCCC"> a list of</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> datasets</font>

551
00:23:29,320 --> 00:23:33,250
<font color="#E5E5E5">you want and the properties</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> want and</font>

552
00:23:31,240 --> 00:23:35,950
it<font color="#E5E5E5"> will lay out the pool that it creates</font>

553
00:23:33,250 --> 00:23:38,170
that<font color="#E5E5E5"> way so you can tweak it to have the</font>

554
00:23:35,950 --> 00:23:39,820
<font color="#CCCCCC">datasets you want and pick and</font><font color="#E5E5E5"> choose</font>

555
00:23:38,170 --> 00:23:42,940
which files end up as part<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the boot</font>

556
00:23:39,820 --> 00:23:45,250
<font color="#CCCCCC">environment that you create and it uses</font>

557
00:23:42,940 --> 00:23:46,570
the<font color="#E5E5E5"> same format as</font><font color="#CCCCCC"> BSD install</font><font color="#E5E5E5"> so if</font>

558
00:23:45,250 --> 00:23:49,360
you've already written a customized<font color="#CCCCCC"> and</font>

559
00:23:46,570 --> 00:24:00,669
<font color="#CCCCCC">script</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> crypt installs</font><font color="#E5E5E5"> you can just</font>

560
00:23:49,360 --> 00:24:03,520
copy<font color="#E5E5E5"> and paste</font><font color="#CCCCCC"> that it does data sets</font>

561
00:24:00,670 --> 00:24:04,870
<font color="#E5E5E5">but you can recursively do data set</font><font color="#CCCCCC"> and</font>

562
00:24:03,520 --> 00:24:07,780
all<font color="#CCCCCC"> those children and if</font><font color="#E5E5E5"> you do that to</font>

563
00:24:04,870 --> 00:24:09,909
the<font color="#E5E5E5"> top then it's the whole pool so in</font>

564
00:24:07,780 --> 00:24:11,530
this mode<font color="#E5E5E5"> you basically it sends the</font>

565
00:24:09,910 --> 00:24:12,890
whole pool as<font color="#E5E5E5"> the stream and this one it</font>

566
00:24:11,530 --> 00:24:14,750
<font color="#E5E5E5">sends only</font><font color="#CCCCCC"> the one data set</font>

567
00:24:12,890 --> 00:24:18,590
so basically<font color="#E5E5E5"> controlling</font><font color="#CCCCCC"> whether uses -</font>

568
00:24:14,750 --> 00:24:19,910
capital<font color="#CCCCCC"> are turn on</font><font color="#E5E5E5"> and yes for example</font>

569
00:24:18,590 --> 00:24:21,889
you can control whether you want<font color="#E5E5E5"> user</font>

570
00:24:19,910 --> 00:24:23,960
local the packages to<font color="#CCCCCC"> be</font><font color="#E5E5E5"> part</font><font color="#CCCCCC"> of the</font>

571
00:24:21,890 --> 00:24:26,480
boot environment<font color="#CCCCCC"> or</font><font color="#E5E5E5"> not because the</font>

572
00:24:23,960 --> 00:24:28,070
other<font color="#CCCCCC"> thing</font><font color="#E5E5E5"> put your image can do is pre</font>

573
00:24:26,480 --> 00:24:29,990
install all the packages you care about

574
00:24:28,070 --> 00:24:32,450
as part<font color="#CCCCCC"> of</font><font color="#E5E5E5"> the boot environment so if</font>

575
00:24:29,990 --> 00:24:34,400
you make user local not its own file

576
00:24:32,450 --> 00:24:36,380
system<font color="#CCCCCC"> you can also feed prove your</font>

577
00:24:34,400 --> 00:24:38,720
image the list of 100<font color="#CCCCCC"> packages</font><font color="#E5E5E5"> and</font>

578
00:24:36,380 --> 00:24:41,179
they'll already be installed<font color="#CCCCCC"> and so when</font>

579
00:24:38,720 --> 00:24:42,740
you do the upgrades with it by<font color="#CCCCCC"> just set</font>

580
00:24:41,179 --> 00:24:44,720
<font color="#CCCCCC">up as receiving it it'll also take care</font>

581
00:24:42,740 --> 00:24:49,010
<font color="#E5E5E5">of upgrading the packages</font><font color="#CCCCCC"> even which</font>

582
00:24:44,720 --> 00:24:50,030
could be really nice<font color="#E5E5E5"> so then our</font><font color="#CCCCCC"> other</font>

583
00:24:49,010 --> 00:24:54,559
problem was<font color="#E5E5E5"> dealing</font><font color="#CCCCCC"> with the fresh</font>

584
00:24:50,030 --> 00:24:56,780
installs<font color="#E5E5E5"> so I use Poudre images</font><font color="#CCCCCC"> ISO EMFs</font>

585
00:24:54,559 --> 00:24:58,580
support to write my<font color="#E5E5E5"> own installer we're</font>

586
00:24:56,780 --> 00:25:02,240
basically prompts for<font color="#E5E5E5"> the IP</font>

587
00:24:58,580 --> 00:25:04,490
<font color="#E5E5E5">configuration and then just creates a</font>

588
00:25:02,240 --> 00:25:06,200
new pool and ZFS receives the full image

589
00:25:04,490 --> 00:25:09,730
down<font color="#E5E5E5"> to</font><font color="#CCCCCC"> onto it</font><font color="#E5E5E5"> automatically and</font>

590
00:25:06,200 --> 00:25:09,730
doesn't ask any other<font color="#E5E5E5"> questions</font>

591
00:25:12,710 --> 00:25:16,340
so my work in progress for<font color="#CCCCCC"> the patches</font>

592
00:25:14,480 --> 00:25:18,860
<font color="#CCCCCC">for food raters</font><font color="#E5E5E5"> up on my github</font><font color="#CCCCCC"> I'm</font>

593
00:25:16,340 --> 00:25:21,799
still<font color="#E5E5E5"> finishing some of the</font><font color="#CCCCCC"> cleanup</font>

594
00:25:18,860 --> 00:25:23,209
there<font color="#E5E5E5"> I would like to fix some of the</font>

595
00:25:21,799 --> 00:25:25,610
<font color="#E5E5E5">naming for the image formats</font><font color="#CCCCCC"> because</font>

596
00:25:23,210 --> 00:25:28,100
there's one called ZFS raw<font color="#E5E5E5"> disk but it's</font>

597
00:25:25,610 --> 00:25:30,949
not what you think it<font color="#CCCCCC"> is it</font><font color="#E5E5E5"> doesn't you</font>

598
00:25:28,100 --> 00:25:32,750
can't just boot it that way<font color="#CCCCCC"> we need to</font>

599
00:25:30,950 --> 00:25:37,960
<font color="#CCCCCC">not go away because Gandhi uses it for</font>

600
00:25:32,750 --> 00:25:37,960
<font color="#E5E5E5">their the images they create for</font><font color="#CCCCCC"> VMs</font><font color="#E5E5E5"> but</font>

601
00:25:38,650 --> 00:25:42,290
it's too easy<font color="#CCCCCC"> for someone</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> think it's</font>

602
00:25:40,880 --> 00:25:46,429
the image<font color="#CCCCCC"> that they want because</font><font color="#E5E5E5"> the</font>

603
00:25:42,290 --> 00:25:47,600
name isn't descriptive enough so you can

604
00:25:46,429 --> 00:25:51,380
use this to create your own custom

605
00:25:47,600 --> 00:25:54,230
images and upgrade them like that the

606
00:25:51,380 --> 00:25:56,720
nice<font color="#CCCCCC"> thing is</font><font color="#E5E5E5"> the images when you're</font>

607
00:25:54,230 --> 00:25:58,610
trying<font color="#E5E5E5"> to build a new image</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> uses the</font>

608
00:25:56,720 --> 00:26:01,220
<font color="#E5E5E5">jails you're already building to build</font>

609
00:25:58,610 --> 00:26:03,260
packages<font color="#E5E5E5"> with so if you've</font><font color="#CCCCCC"> already</font>

610
00:26:01,220 --> 00:26:05,510
compiled your custom version of<font color="#E5E5E5"> FreeBSD</font>

611
00:26:03,260 --> 00:26:07,910
to compile<font color="#E5E5E5"> your packages for it it will</font>

612
00:26:05,510 --> 00:26:09,740
<font color="#E5E5E5">just take the files from that</font><font color="#CCCCCC"> jail which</font>

613
00:26:07,910 --> 00:26:11,390
also means<font color="#E5E5E5"> that you can</font><font color="#CCCCCC"> tell it</font><font color="#E5E5E5"> to</font>

614
00:26:09,740 --> 00:26:13,490
<font color="#E5E5E5">create a jail I'll release ISO and not</font>

615
00:26:11,390 --> 00:26:15,830
have to compile anything<font color="#E5E5E5"> so if you just</font>

616
00:26:13,490 --> 00:26:17,750
want to customize<font color="#E5E5E5"> FreeBSD by taking the</font>

617
00:26:15,830 --> 00:26:20,510
release<font color="#E5E5E5"> adding an overlay of your own</font>

618
00:26:17,750 --> 00:26:21,770
files<font color="#E5E5E5"> and a list of</font><font color="#CCCCCC"> packages you want to</font>

619
00:26:20,510 --> 00:26:23,660
pre install you<font color="#CCCCCC"> could do all that</font><font color="#E5E5E5"> and</font>

620
00:26:21,770 --> 00:26:26,780
not have to compile anything<font color="#E5E5E5"> it's quite</font>

621
00:26:23,660 --> 00:26:30,860
nice<font color="#CCCCCC"> and I'd like to look at adding</font>

622
00:26:26,780 --> 00:26:34,520
more<font color="#E5E5E5"> additional image output formats to</font>

623
00:26:30,860 --> 00:26:36,260
it like making<font color="#E5E5E5"> more virtual machine</font>

624
00:26:34,520 --> 00:26:39,760
images like we do for the<font color="#E5E5E5"> install images</font>

625
00:26:36,260 --> 00:26:45,710
or<font color="#E5E5E5"> the official</font><font color="#CCCCCC"> FreeBSD builds</font>

626
00:26:39,760 --> 00:26:47,030
<font color="#E5E5E5">supporting for MBR and GPT</font><font color="#CCCCCC"> and all the</font>

627
00:26:45,710 --> 00:26:49,580
other combinations that<font color="#E5E5E5"> you might want</font>

628
00:26:47,030 --> 00:26:51,110
<font color="#CCCCCC">to</font><font color="#E5E5E5"> build your image with because you</font>

629
00:26:49,580 --> 00:26:53,990
could also use this to<font color="#E5E5E5"> build hard drive</font>

630
00:26:51,110 --> 00:26:55,879
images that you could spot down just

631
00:26:53,990 --> 00:27:00,950
dding<font color="#E5E5E5"> onto the hard drive to do your</font>

632
00:26:55,880 --> 00:27:02,270
install or whatever some of the

633
00:27:00,950 --> 00:27:05,150
<font color="#CCCCCC">enhancers you'd like to</font><font color="#E5E5E5"> look</font><font color="#CCCCCC"> - like I</font>

634
00:27:02,270 --> 00:27:07,310
said<font color="#E5E5E5"> changing</font><font color="#CCCCCC"> the naming</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> the image</font>

635
00:27:05,150 --> 00:27:09,800
<font color="#CCCCCC">type so that</font><font color="#E5E5E5"> it's more obvious what each</font>

636
00:27:07,310 --> 00:27:14,120
one<font color="#CCCCCC"> does and maybe</font><font color="#E5E5E5"> just spelling those</font>

637
00:27:09,800 --> 00:27:17,690
out better in the<font color="#E5E5E5"> main page and adding a</font>

638
00:27:14,120 --> 00:27:18,649
lot more combinations<font color="#E5E5E5"> although maybe we</font>

639
00:27:17,690 --> 00:27:20,870
want<font color="#CCCCCC"> to actually limit</font><font color="#E5E5E5"> the number of</font>

640
00:27:18,650 --> 00:27:22,570
<font color="#CCCCCC">combinations so that it's more obvious</font>

641
00:27:20,870 --> 00:27:25,399
which<font color="#CCCCCC"> one you probably want to use</font>

642
00:27:22,570 --> 00:27:28,070
<font color="#E5E5E5">there's another tool that I helped</font>

643
00:27:25,400 --> 00:27:30,500
<font color="#E5E5E5">Warner</font><font color="#CCCCCC"> Losh right under in the</font><font color="#E5E5E5"> search</font>

644
00:27:28,070 --> 00:27:35,689
<font color="#E5E5E5">tree under tools</font><font color="#CCCCCC"> but-- root gen and it</font>

645
00:27:30,500 --> 00:27:38,000
generates qmu image of every possible

646
00:27:35,690 --> 00:27:40,070
combination<font color="#CCCCCC"> of images</font><font color="#E5E5E5"> to test the</font>

647
00:27:38,000 --> 00:27:43,220
<font color="#E5E5E5">bootloader and it fires each one up in</font>

648
00:27:40,070 --> 00:27:45,139
<font color="#E5E5E5">qmu with a telnet console and allows you</font>

649
00:27:43,220 --> 00:27:46,280
<font color="#E5E5E5">to run</font><font color="#CCCCCC"> expect or whatever to make sure</font>

650
00:27:45,140 --> 00:27:48,890
that each one's actually booting

651
00:27:46,280 --> 00:27:50,510
properly and it'd be<font color="#E5E5E5"> nice</font><font color="#CCCCCC"> to actually</font>

652
00:27:48,890 --> 00:27:52,040
<font color="#E5E5E5">use the Poudre image support</font><font color="#CCCCCC"> to do</font><font color="#E5E5E5"> this</font>

653
00:27:50,510 --> 00:27:55,220
so that<font color="#E5E5E5"> you would have evolved less</font>

654
00:27:52,040 --> 00:27:58,010
compiling and so on<font color="#E5E5E5"> and it'd</font><font color="#CCCCCC"> be nice to</font>

655
00:27:55,220 --> 00:27:59,780
<font color="#E5E5E5">also</font><font color="#CCCCCC"> consider having</font><font color="#E5E5E5"> it better able to</font>

656
00:27:58,010 --> 00:28:01,820
<font color="#E5E5E5">just have a flag</font><font color="#CCCCCC"> to automatically bundle</font>

657
00:27:59,780 --> 00:28:02,060
the cloud<font color="#CCCCCC"> wear stuff like BSD cloud in</font>

658
00:28:01,820 --> 00:28:04,100
it

659
00:28:02,060 --> 00:28:05,720
so that<font color="#E5E5E5"> when</font><font color="#CCCCCC"> you spin up</font><font color="#E5E5E5"> an image that</font>

660
00:28:04,100 --> 00:28:07,310
you've created like this<font color="#E5E5E5"> on a cloud</font>

661
00:28:05,720 --> 00:28:10,400
service<font color="#E5E5E5"> it automatically configures</font>

662
00:28:07,310 --> 00:28:11,810
everything for you or supports the user

663
00:28:10,400 --> 00:28:15,350
<font color="#E5E5E5">data stuff where you</font><font color="#CCCCCC"> provide the command</font>

664
00:28:11,810 --> 00:28:17,060
you want to<font color="#E5E5E5"> run</font><font color="#CCCCCC"> on first boot be</font>

665
00:28:15,350 --> 00:28:19,040
interesting to actually<font color="#E5E5E5"> look at updating</font>

666
00:28:17,060 --> 00:28:21,040
<font color="#E5E5E5">some</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the way we build releases on</font>

667
00:28:19,040 --> 00:28:23,210
FreeBSD to use this<font color="#CCCCCC"> Poudre image support</font>

668
00:28:21,040 --> 00:28:24,409
<font color="#E5E5E5">since it's so nice</font><font color="#CCCCCC"> and since we've</font>

669
00:28:23,210 --> 00:28:26,990
already going to<font color="#E5E5E5"> have to build these</font>

670
00:28:24,410 --> 00:28:29,750
images for packages and<font color="#E5E5E5"> stuff we could</font>

671
00:28:26,990 --> 00:28:34,070
save some<font color="#E5E5E5"> effort</font><font color="#CCCCCC"> too and make it</font><font color="#E5E5E5"> more</font>

672
00:28:29,750 --> 00:28:36,470
easily automated another thing<font color="#CCCCCC"> I would</font>

673
00:28:34,070 --> 00:28:37,790
<font color="#CCCCCC">like to add is support</font><font color="#E5E5E5"> for post build</font>

674
00:28:36,470 --> 00:28:40,290
scripts

675
00:28:37,790 --> 00:28:42,300
after it does<font color="#E5E5E5"> the overlay I'd like to</font>

676
00:28:40,290 --> 00:28:44,040
see each<font color="#CCCCCC"> route into their</font><font color="#E5E5E5"> run a bunch of</font>

677
00:28:42,300 --> 00:28:46,820
scripts to set up<font color="#E5E5E5"> more complicated stuff</font>

678
00:28:44,040 --> 00:28:49,290
<font color="#E5E5E5">and then create the image from it</font>

679
00:28:46,820 --> 00:28:51,090
because eventually<font color="#E5E5E5"> what I'm going to</font>

680
00:28:49,290 --> 00:28:52,110
<font color="#E5E5E5">want</font><font color="#CCCCCC"> to do to the image before I ship it</font>

681
00:28:51,090 --> 00:28:54,419
is going<font color="#E5E5E5"> to be a bit more complicated</font>

682
00:28:52,110 --> 00:28:58,590
<font color="#CCCCCC">than just copy these files over top of</font>

683
00:28:54,420 --> 00:29:00,120
<font color="#CCCCCC">these</font><font color="#E5E5E5"> other files and I'd like to look</font>

684
00:28:58,590 --> 00:29:03,600
at adding<font color="#CCCCCC"> more features for building</font>

685
00:29:00,120 --> 00:29:06,000
appliances<font color="#E5E5E5"> you know</font><font color="#CCCCCC"> if one of the</font><font color="#E5E5E5"> things</font>

686
00:29:03,600 --> 00:29:08,250
that previously<font color="#CCCCCC"> is very popular for</font>

687
00:29:06,000 --> 00:29:09,420
building appliances but<font color="#E5E5E5"> each appliance</font>

688
00:29:08,250 --> 00:29:11,910
<font color="#E5E5E5">vendor is kind of left on their own to</font>

689
00:29:09,420 --> 00:29:13,890
<font color="#E5E5E5">come up with an upgrade mechanism and if</font>

690
00:29:11,910 --> 00:29:16,230
we can make something<font color="#E5E5E5"> a little more</font>

691
00:29:13,890 --> 00:29:18,420
solid then every appliance based on

692
00:29:16,230 --> 00:29:21,450
previous<font color="#E5E5E5"> D will do</font><font color="#CCCCCC"> upgrade incorrectly</font>

693
00:29:18,420 --> 00:29:24,179
<font color="#E5E5E5">instead of their own special way each</font>

694
00:29:21,450 --> 00:29:25,890
<font color="#CCCCCC">time</font><font color="#E5E5E5"> but if you're interested</font><font color="#CCCCCC"> in the</font>

695
00:29:24,179 --> 00:29:29,370
appliance stuff<font color="#E5E5E5"> definitely talk to me</font>

696
00:29:25,890 --> 00:29:31,140
<font color="#E5E5E5">and if you have other</font><font color="#CCCCCC"> ideas I'm open</font><font color="#E5E5E5"> to</font>

697
00:29:29,370 --> 00:29:56,760
looking at them but I don't<font color="#E5E5E5"> know how</font>

698
00:29:31,140 --> 00:29:59,190
much free time<font color="#CCCCCC"> I'll have so questions so</font>

699
00:29:56,760 --> 00:30:01,290
the question was about<font color="#CCCCCC"> house</font><font color="#E5E5E5"> edifice</font>

700
00:29:59,190 --> 00:30:02,730
<font color="#CCCCCC">boot</font><font color="#E5E5E5"> CFG rights the next boot</font>

701
00:30:01,290 --> 00:30:06,149
environment<font color="#CCCCCC"> and wants</font><font color="#E5E5E5"> to boot into the</font>

702
00:30:02,730 --> 00:30:08,610
<font color="#E5E5E5">ZFS label</font><font color="#CCCCCC"> it does it in one of the</font>

703
00:30:06,150 --> 00:30:13,490
reserved areas so it's not going to

704
00:30:08,610 --> 00:30:13,490
confuse<font color="#E5E5E5"> Solaris or make it</font><font color="#CCCCCC"> incompatible</font>

705
00:30:13,910 --> 00:30:21,750
<font color="#E5E5E5">the way Solaris does it I think uses the</font>

706
00:30:19,309 --> 00:30:24,480
they call it no<font color="#E5E5E5"> I'm persistent comma or</font>

707
00:30:21,750 --> 00:30:26,580
whatever<font color="#CCCCCC"> and the problem with that is if</font>

708
00:30:24,480 --> 00:30:28,800
something<font color="#E5E5E5"> goes</font><font color="#CCCCCC"> wrong early</font><font color="#E5E5E5"> up in the</font>

709
00:30:26,580 --> 00:30:31,050
boot process where the file systems

710
00:30:28,800 --> 00:30:36,690
still read-only<font color="#CCCCCC"> you can't set it back to</font>

711
00:30:31,050 --> 00:30:40,790
<font color="#E5E5E5">no and so it can end up booting that way</font>

712
00:30:36,690 --> 00:30:40,790
more<font color="#E5E5E5"> than once</font><font color="#CCCCCC"> or permanently</font><font color="#E5E5E5"> ah</font>

713
00:30:51,890 --> 00:30:58,110
yeah so the the problem<font color="#E5E5E5"> with the FreeBSD</font>

714
00:30:56,190 --> 00:31:00,360
loader is well it's not<font color="#E5E5E5"> really</font><font color="#CCCCCC"> a problem</font>

715
00:30:58,110 --> 00:31:02,760
but it purposely only<font color="#E5E5E5"> has read-only</font>

716
00:31:00,360 --> 00:31:04,139
support for ZFS<font color="#E5E5E5"> because writing to ZFS</font>

717
00:31:02,760 --> 00:31:07,830
is much too complicated to do in the

718
00:31:04,140 --> 00:31:09,600
loader<font color="#CCCCCC"> and so said of</font><font color="#E5E5E5"> his boot CFG is</font>

719
00:31:07,830 --> 00:31:11,790
actually done in<font color="#E5E5E5"> the thing before</font><font color="#CCCCCC"> the</font>

720
00:31:09,600 --> 00:31:13,379
loader<font color="#E5E5E5"> and it knows the specific offset</font>

721
00:31:11,790 --> 00:31:15,180
in the label which<font color="#CCCCCC"> is at a fixed</font>

722
00:31:13,380 --> 00:31:18,150
position on the disk<font color="#E5E5E5"> or</font><font color="#CCCCCC"> in the</font><font color="#E5E5E5"> partition</font>

723
00:31:15,180 --> 00:31:19,650
<font color="#CCCCCC">that it's safe to write to and it writes</font>

724
00:31:18,150 --> 00:31:21,930
the<font color="#E5E5E5"> string in there and then the</font>

725
00:31:19,650 --> 00:31:23,910
bootloader sees that reads it and then

726
00:31:21,930 --> 00:31:25,170
over<font color="#E5E5E5"> writes it with zeros with the</font>

727
00:31:23,910 --> 00:31:26,850
<font color="#CCCCCC">pre-calculated</font><font color="#E5E5E5"> checksum</font><font color="#CCCCCC"> of what's</font>

728
00:31:25,170 --> 00:31:30,050
supposed to<font color="#E5E5E5"> be there</font><font color="#CCCCCC"> so the label</font>

729
00:31:26,850 --> 00:31:34,530
checksum still<font color="#E5E5E5"> always matches that way</font>

730
00:31:30,050 --> 00:31:36,960
yes maybe not<font color="#CCCCCC"> all</font><font color="#E5E5E5"> for I'd have to</font><font color="#CCCCCC"> double</font>

731
00:31:34,530 --> 00:31:38,399
<font color="#CCCCCC">check but</font><font color="#E5E5E5"> yes</font><font color="#CCCCCC"> it uses</font><font color="#E5E5E5"> the ZFS label code</font>

732
00:31:36,960 --> 00:31:40,350
and it puts it<font color="#E5E5E5"> in one of the spaces</font>

733
00:31:38,400 --> 00:31:42,180
<font color="#CCCCCC">that's safe for</font><font color="#E5E5E5"> us to put</font><font color="#CCCCCC"> that kind</font><font color="#E5E5E5"> of</font>

734
00:31:40,350 --> 00:31:46,770
thing in and it updates the checksum

735
00:31:42,180 --> 00:31:48,150
correctly so the label is valid del phix

736
00:31:46,770 --> 00:31:51,420
end up doing the<font color="#CCCCCC"> same thing on</font><font color="#E5E5E5"> there</font>

737
00:31:48,150 --> 00:31:53,190
illumise images but instead of<font color="#E5E5E5"> the boot</font>

738
00:31:51,420 --> 00:31:56,250
environment<font color="#CCCCCC"> they keep track of how many</font>

739
00:31:53,190 --> 00:31:57,390
<font color="#E5E5E5">times</font><font color="#CCCCCC"> they've tried to boot and then</font>

740
00:31:56,250 --> 00:32:01,740
they reset it to<font color="#E5E5E5"> zero when the boot</font>

741
00:31:57,390 --> 00:32:04,050
successfully and so what their load<font color="#CCCCCC"> er</font>

742
00:32:01,740 --> 00:32:06,300
does is after<font color="#CCCCCC"> it sees three failed boots</font>

743
00:32:04,050 --> 00:32:07,860
<font color="#E5E5E5">it purposely boots into</font><font color="#CCCCCC"> a rescue</font><font color="#E5E5E5"> system</font>

744
00:32:06,300 --> 00:32:10,530
that<font color="#CCCCCC"> phones home and say I'm having</font>

745
00:32:07,860 --> 00:32:12,840
trouble booting come fix me<font color="#CCCCCC"> because</font>

746
00:32:10,530 --> 00:32:14,760
<font color="#CCCCCC">their appliance runs</font><font color="#E5E5E5"> in Amazon</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> they</font>

747
00:32:12,840 --> 00:32:16,500
has no<font color="#E5E5E5"> console so it's the only way they</font>

748
00:32:14,760 --> 00:32:18,000
<font color="#E5E5E5">could fix them</font><font color="#CCCCCC"> so they</font><font color="#E5E5E5"> just keep</font>

749
00:32:16,500 --> 00:32:20,790
rebooting it until it<font color="#E5E5E5"> fails enough times</font>

750
00:32:18,000 --> 00:32:23,700
to boot the rescue system I've looked at

751
00:32:20,790 --> 00:32:25,649
wanting to<font color="#E5E5E5"> extend what ZFS</font><font color="#CCCCCC"> brut</font><font color="#E5E5E5"> CFG does</font>

752
00:32:23,700 --> 00:32:27,720
instead of just writing<font color="#E5E5E5"> a string we</font>

753
00:32:25,650 --> 00:32:29,880
write a packed env list or<font color="#E5E5E5"> something we</font>

754
00:32:27,720 --> 00:32:31,890
could<font color="#CCCCCC"> actually</font><font color="#E5E5E5"> have support for both</font>

755
00:32:29,880 --> 00:32:34,590
things<font color="#E5E5E5"> like say I want to boot this one</font>

756
00:32:31,890 --> 00:32:36,450
next<font color="#E5E5E5"> time only or keep a fail counter</font>

757
00:32:34,590 --> 00:32:39,030
and if it fails<font color="#E5E5E5"> I want to boot this</font>

758
00:32:36,450 --> 00:32:43,710
other boot environment<font color="#E5E5E5"> called rescue or</font>

759
00:32:39,030 --> 00:32:45,270
whatever<font color="#CCCCCC"> I think it's like 16 kilobytes</font>

760
00:32:43,710 --> 00:32:49,230
so<font color="#E5E5E5"> that's more than enough</font><font color="#CCCCCC"> to store a</font>

761
00:32:45,270 --> 00:32:51,410
<font color="#E5E5E5">pack 10 B list of like</font><font color="#CCCCCC"> 5 or 6</font><font color="#E5E5E5"> features</font>

762
00:32:49,230 --> 00:32:51,410
<font color="#CCCCCC">like that</font>

763
00:33:07,610 --> 00:33:17,310
the minimum file system size<font color="#CCCCCC"> in CFS is</font>

764
00:33:12,450 --> 00:33:18,960
100 megabytes<font color="#E5E5E5"> so</font><font color="#CCCCCC"> no you're gonna want</font>

765
00:33:17,310 --> 00:33:22,919
something<font color="#E5E5E5"> more like nano</font><font color="#CCCCCC"> BSE if you only</font>

766
00:33:18,960 --> 00:33:27,240
have<font color="#CCCCCC"> 8 or</font><font color="#E5E5E5"> 16 megabytes of</font><font color="#CCCCCC"> space because</font>

767
00:33:22,920 --> 00:33:29,940
<font color="#E5E5E5">yeah yes I've done</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> same thing with</font>

768
00:33:27,240 --> 00:33:31,260
the<font color="#CCCCCC"> the</font><font color="#E5E5E5"> TP link that had 16 megabytes</font>

769
00:33:29,940 --> 00:33:33,330
yeah

770
00:33:31,260 --> 00:33:34,890
and it's awfully hard to squish enough

771
00:33:33,330 --> 00:34:03,389
of<font color="#E5E5E5"> FreeBSD down just to have a useful</font>

772
00:33:34,890 --> 00:34:04,590
<font color="#E5E5E5">router with only 16</font><font color="#CCCCCC"> depending what</font>

773
00:34:03,390 --> 00:34:07,080
you're doing you could actually make<font color="#E5E5E5"> the</font>

774
00:34:04,590 --> 00:34:09,090
root filesystem read-only<font color="#E5E5E5"> right if if</font>

775
00:34:07,080 --> 00:34:11,370
we're using<font color="#E5E5E5"> size CFG for the config</font>

776
00:34:09,090 --> 00:34:13,290
files we actually expect to<font color="#E5E5E5"> change and</font>

777
00:34:11,370 --> 00:34:16,969
we've moved<font color="#E5E5E5"> the log files and so on off</font>

778
00:34:13,290 --> 00:34:16,969
<font color="#E5E5E5">you could decide</font><font color="#CCCCCC"> to make it read-only</font>

779
00:34:17,840 --> 00:34:29,130
right yes yes yeah<font color="#E5E5E5"> yeah</font><font color="#CCCCCC"> I don't know</font>

780
00:34:26,550 --> 00:34:31,260
<font color="#CCCCCC">there's a good way to solve that</font><font color="#E5E5E5"> to tell</font>

781
00:34:29,130 --> 00:34:32,550
people<font color="#E5E5E5"> you don't create just a directory</font>

782
00:34:31,260 --> 00:34:33,780
you<font color="#E5E5E5"> have to create a new file system</font><font color="#CCCCCC"> if</font>

783
00:34:32,550 --> 00:34:35,990
you want<font color="#E5E5E5"> that file to persist or</font>

784
00:34:33,780 --> 00:34:35,990
whatever

785
00:34:40,570 --> 00:34:45,440
yeah a quarter would<font color="#E5E5E5"> be a good way to at</font>

786
00:34:42,980 --> 00:34:47,270
least catch the<font color="#E5E5E5"> problem early before</font><font color="#CCCCCC"> you</font>

787
00:34:45,440 --> 00:34:49,250
write you know a terabyte of data<font color="#E5E5E5"> into</font>

788
00:34:47,270 --> 00:35:03,350
the root<font color="#CCCCCC"> filesystem forgetting that</font><font color="#E5E5E5"> oh I</font>

789
00:34:49,250 --> 00:35:05,480
need<font color="#E5E5E5"> to create</font><font color="#CCCCCC"> a filesystem</font><font color="#E5E5E5"> first right</font>

790
00:35:03,350 --> 00:35:08,170
we don't do zpool upgrade until we're

791
00:35:05,480 --> 00:35:13,910
sure<font color="#E5E5E5"> we're not gonna want to go back</font>

792
00:35:08,170 --> 00:35:17,210
yeah<font color="#E5E5E5"> usually you know I'm not after the</font>

793
00:35:13,910 --> 00:35:18,950
newest set<font color="#E5E5E5"> efest feature anyway but yes</font>

794
00:35:17,210 --> 00:35:20,420
if you're gonna go back<font color="#E5E5E5"> to quite a few</font>

795
00:35:18,950 --> 00:35:23,089
versions<font color="#E5E5E5"> or something or if you're going</font>

796
00:35:20,420 --> 00:35:26,060
back in time major version then yes

797
00:35:23,090 --> 00:35:27,680
<font color="#E5E5E5">features could be a problem</font><font color="#CCCCCC"> it depends</font>

798
00:35:26,060 --> 00:35:29,870
on the features some<font color="#E5E5E5"> of them like device</font>

799
00:35:27,680 --> 00:35:32,060
removal works as<font color="#CCCCCC"> long as you don't use</font>

800
00:35:29,870 --> 00:35:33,200
it so<font color="#CCCCCC"> as long</font><font color="#E5E5E5"> as you you can</font><font color="#CCCCCC"> upgrade the</font>

801
00:35:32,060 --> 00:35:34,610
thing but<font color="#E5E5E5"> as long as you haven't tried</font>

802
00:35:33,200 --> 00:35:37,009
<font color="#E5E5E5">to remove a hard drive you</font><font color="#CCCCCC"> can still</font>

803
00:35:34,610 --> 00:35:38,180
boot from<font color="#E5E5E5"> it</font><font color="#CCCCCC"> even if</font><font color="#E5E5E5"> you're booting from</font>

804
00:35:37,010 --> 00:35:39,830
a<font color="#CCCCCC"> version that doesn't support device</font>

805
00:35:38,180 --> 00:35:42,169
removal<font color="#E5E5E5"> as long as you've never</font><font color="#CCCCCC"> actually</font>

806
00:35:39,830 --> 00:35:44,230
removed a hard drive it's fine<font color="#CCCCCC"> or even</font>

807
00:35:42,170 --> 00:35:46,190
<font color="#CCCCCC">if you're going</font><font color="#E5E5E5"> back into older freebsd</font>

808
00:35:44,230 --> 00:35:48,200
<font color="#E5E5E5">when we added the support for the new</font>

809
00:35:46,190 --> 00:35:49,970
<font color="#CCCCCC">checksum algorithms as long as you've</font>

810
00:35:48,200 --> 00:35:52,970
not created<font color="#E5E5E5"> a</font><font color="#CCCCCC"> they said</font><font color="#E5E5E5"> that uses one</font><font color="#CCCCCC"> of</font>

811
00:35:49,970 --> 00:35:54,470
those it's fine<font color="#E5E5E5"> or even</font><font color="#CCCCCC"> if you as long</font>

812
00:35:52,970 --> 00:35:55,730
<font color="#E5E5E5">as you've destroyed the last data set</font>

813
00:35:54,470 --> 00:35:57,410
that<font color="#E5E5E5"> was still</font><font color="#CCCCCC"> using the new valgar</font>

814
00:35:55,730 --> 00:35:58,580
<font color="#CCCCCC">ithen you can still import it on an</font>

815
00:35:57,410 --> 00:36:01,100
older<font color="#E5E5E5"> version that doesn't</font><font color="#CCCCCC"> support the</font>

816
00:35:58,580 --> 00:36:03,980
feature so the the feature tracking<font color="#CCCCCC"> in</font>

817
00:36:01,100 --> 00:36:07,610
ZFS a feature becomes enabled<font color="#E5E5E5"> once you</font>

818
00:36:03,980 --> 00:36:09,020
can use it but it's safe as long<font color="#CCCCCC"> as</font><font color="#E5E5E5"> it's</font>

819
00:36:07,610 --> 00:36:11,260
<font color="#E5E5E5">not active which means there's a file</font>

820
00:36:09,020 --> 00:36:14,210
<font color="#CCCCCC">system that has used it at some point</font>

821
00:36:11,260 --> 00:36:16,310
<font color="#E5E5E5">and active stays if any file systems</font>

822
00:36:14,210 --> 00:36:19,030
using it or file system was and hasn't

823
00:36:16,310 --> 00:36:19,029
<font color="#CCCCCC">been</font><font color="#E5E5E5"> destroyed yet</font>

824
00:36:24,530 --> 00:36:33,870
FreeBSD does not have a good<font color="#CCCCCC"> Union</font><font color="#E5E5E5"> file</font>

825
00:36:27,060 --> 00:36:43,009
system that<font color="#CCCCCC"> doesn't crash</font><font color="#E5E5E5"> many Union FS</font>

826
00:36:33,870 --> 00:36:43,009
or yeah yeah<font color="#CCCCCC"> wall</font><font color="#E5E5E5"> eight</font>

827
00:36:45,260 --> 00:36:57,540
we're running<font color="#CCCCCC"> previously thirteen so on</font>

828
00:36:55,380 --> 00:37:00,120
previously we have support<font color="#CCCCCC"> for booting</font>

829
00:36:57,540 --> 00:37:02,279
from<font color="#CCCCCC"> Delhi encrypted disks</font><font color="#E5E5E5"> I wrote that</font>

830
00:37:00,120 --> 00:37:06,359
<font color="#CCCCCC">in</font><font color="#E5E5E5"> the loader</font><font color="#CCCCCC"> and I presented at FOSDEM</font>

831
00:37:02,280 --> 00:37:08,520
<font color="#CCCCCC">a year or two ago zenefits native</font>

832
00:37:06,360 --> 00:37:10,770
encryption hasn't landed yet<font color="#CCCCCC"> and when it</font>

833
00:37:08,520 --> 00:37:15,390
does<font color="#CCCCCC"> I don't expect the bootloader to</font>

834
00:37:10,770 --> 00:37:18,200
support it right away<font color="#E5E5E5"> yeah it's not</font>

835
00:37:15,390 --> 00:37:20,520
<font color="#E5E5E5">really full disk encryption anyway it's</font>

836
00:37:18,200 --> 00:37:23,100
the point of<font color="#E5E5E5"> it is let you have specific</font>

837
00:37:20,520 --> 00:37:25,410
<font color="#CCCCCC">data sets</font><font color="#E5E5E5"> so most likely it wouldn't be</font>

838
00:37:23,100 --> 00:37:31,650
your boot<font color="#CCCCCC"> environment because that's</font>

839
00:37:25,410 --> 00:37:34,470
<font color="#E5E5E5">FreeBSD</font><font color="#CCCCCC"> but if you want to know more</font>

840
00:37:31,650 --> 00:37:36,900
<font color="#CCCCCC">I've</font><font color="#E5E5E5"> Michael Lucas and I wrote two books</font>

841
00:37:34,470 --> 00:37:39,299
<font color="#E5E5E5">previously masteries NFS an advanced set</font>

842
00:37:36,900 --> 00:37:41,370
of s they're not<font color="#E5E5E5"> really that free base T</font>

843
00:37:39,300 --> 00:37:44,490
specific so if you're using set of<font color="#CCCCCC"> S</font><font color="#E5E5E5"> on</font>

844
00:37:41,370 --> 00:37:46,920
<font color="#CCCCCC">a</font><font color="#E5E5E5"> Lumos or Linux or</font><font color="#CCCCCC"> Mac</font><font color="#E5E5E5"> OS or Windows in</font>

845
00:37:44,490 --> 00:37:49,259
case you didn't know<font color="#CCCCCC"> that as</font><font color="#E5E5E5"> thing the</font>

846
00:37:46,920 --> 00:37:51,570
<font color="#CCCCCC">book still then the ZFS commands are the</font>

847
00:37:49,260 --> 00:37:52,920
same across all<font color="#E5E5E5"> of them it's just some</font>

848
00:37:51,570 --> 00:37:53,940
of<font color="#CCCCCC"> the things like partitioning might be</font>

849
00:37:52,920 --> 00:37:56,940
a little<font color="#E5E5E5"> different for each operating</font>

850
00:37:53,940 --> 00:37:59,910
system<font color="#E5E5E5"> but the kind</font><font color="#CCCCCC"> of those books is is</font>

851
00:37:56,940 --> 00:38:01,920
good for all the operating<font color="#E5E5E5"> systems and</font>

852
00:37:59,910 --> 00:38:05,520
you<font color="#E5E5E5"> can get it as a DRM free</font><font color="#CCCCCC"> ebook at</font>

853
00:38:01,920 --> 00:38:08,520
<font color="#CCCCCC">ZFS book calm or you can buy</font><font color="#E5E5E5"> it in print</font>

854
00:38:05,520 --> 00:38:12,630
on Amazon or<font color="#CCCCCC"> whatever what's the other</font>

855
00:38:08,520 --> 00:38:15,630
big<font color="#E5E5E5"> European one yeah and every week</font>

856
00:38:12,630 --> 00:38:18,330
<font color="#E5E5E5">Benedict than I do the BSD</font><font color="#CCCCCC"> no TV video</font>

857
00:38:15,630 --> 00:38:21,750
podcast and we<font color="#CCCCCC"> answer questions about</font>

858
00:38:18,330 --> 00:38:22,920
all the<font color="#CCCCCC"> BS DS and ZFS on there so if you</font>

859
00:38:21,750 --> 00:38:25,500
<font color="#E5E5E5">have more</font><font color="#CCCCCC"> questions you can write them</font>

860
00:38:22,920 --> 00:38:27,510
<font color="#E5E5E5">in to feedback at BSD now that TV and</font>

861
00:38:25,500 --> 00:38:29,780
we'll answer them<font color="#E5E5E5"> in some future week on</font>

862
00:38:27,510 --> 00:38:29,780
the podcast

863
00:38:31,150 --> 00:38:42,030
thank you

864
00:38:31,680 --> 00:38:42,029
[Applause]

