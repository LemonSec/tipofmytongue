1
00:00:06,640 --> 00:00:11,600
and next<font color="#E5E5E5"> up</font><font color="#CCCCCC"> we have Brian</font><font color="#E5E5E5"> Burke I'm just</font>

2
00:00:09,889 --> 00:00:15,399
<font color="#CCCCCC">going to talk about to go garbage</font>

3
00:00:11,600 --> 00:00:15,399
collector<font color="#CCCCCC"> run of applause</font>

4
00:00:18,080 --> 00:00:25,070
hello<font color="#E5E5E5"> well thank you for coming</font><font color="#CCCCCC"> along</font><font color="#E5E5E5"> so</font>

5
00:00:22,890 --> 00:00:25,070
late

6
00:00:25,550 --> 00:00:36,420
who who has tuned a garbage collector

7
00:00:31,940 --> 00:00:39,379
<font color="#E5E5E5">okay</font><font color="#CCCCCC"> not too many people okay</font><font color="#E5E5E5"> so I was</font>

8
00:00:36,420 --> 00:00:42,090
<font color="#E5E5E5">wondering who would show up to</font><font color="#CCCCCC"> this talk</font>

9
00:00:39,379 --> 00:00:45,599
anyway let's I'm gonna talk about<font color="#E5E5E5"> tuning</font>

10
00:00:42,090 --> 00:00:48,140
<font color="#E5E5E5">the</font><font color="#CCCCCC"> gold garbage collector all of the</font>

11
00:00:45,600 --> 00:00:51,300
settings you<font color="#E5E5E5"> can use to do that with</font>

12
00:00:48,140 --> 00:00:54,180
that's a joke<font color="#CCCCCC"> that nobody got</font><font color="#E5E5E5"> okay</font>

13
00:00:51,300 --> 00:00:56,819
we'll get there we'll<font color="#E5E5E5"> get there so first</font>

14
00:00:54,180 --> 00:00:58,979
<font color="#CCCCCC">of</font><font color="#E5E5E5"> all let me introduce myself</font><font color="#CCCCCC"> my name</font>

15
00:00:56,820 --> 00:01:01,140
<font color="#CCCCCC">is Bryan Boram you can follow me on</font>

16
00:00:58,979 --> 00:01:04,890
<font color="#CCCCCC">Twitter and ask any questions you like</font>

17
00:01:01,140 --> 00:01:08,159
afterwards<font color="#CCCCCC"> that way I work for a company</font>

18
00:01:04,890 --> 00:01:10,080
<font color="#E5E5E5">called</font><font color="#CCCCCC"> weave works we do like DevOps</font>

19
00:01:08,159 --> 00:01:11,010
tools continuous deployment stuff like

20
00:01:10,080 --> 00:01:16,620
that

21
00:01:11,010 --> 00:01:19,829
I like making<font color="#E5E5E5"> code go faster</font><font color="#CCCCCC"> it's like a</font>

22
00:01:16,620 --> 00:01:21,180
video<font color="#CCCCCC"> game</font><font color="#E5E5E5"> for me so that's kind of why</font>

23
00:01:19,829 --> 00:01:24,000
that's<font color="#E5E5E5"> the that's where I'm coming from</font>

24
00:01:21,180 --> 00:01:26,450
when<font color="#CCCCCC"> I when</font><font color="#E5E5E5"> I want to tune the garbage</font>

25
00:01:24,000 --> 00:01:26,450
collector

26
00:01:30,180 --> 00:01:34,860
oh I need<font color="#CCCCCC"> to stay</font><font color="#E5E5E5"> here I need to not</font>

27
00:01:32,460 --> 00:01:46,199
walk sorry<font color="#CCCCCC"> I</font><font color="#E5E5E5"> could I can walk around</font>

28
00:01:34,860 --> 00:01:49,620
<font color="#E5E5E5">here it's too far</font><font color="#CCCCCC"> no yeah so let me let</font>

29
00:01:46,200 --> 00:01:51,480
me<font color="#E5E5E5"> tell you about my terrible life so</font>

30
00:01:49,620 --> 00:01:56,220
the first the<font color="#CCCCCC"> first UNIX machines are</font>

31
00:01:51,480 --> 00:01:59,010
programmed had<font color="#CCCCCC"> four megabytes of</font><font color="#E5E5E5"> RAM and</font>

32
00:01:56,220 --> 00:02:01,260
I used<font color="#E5E5E5"> to we had a server with</font><font color="#CCCCCC"> sixteen I</font>

33
00:01:59,010 --> 00:02:04,260
used to<font color="#E5E5E5"> sneak on to the server to do my</font>

34
00:02:01,260 --> 00:02:08,369
compiles<font color="#E5E5E5"> because I didn't have enough</font>

35
00:02:04,260 --> 00:02:11,610
RAM<font color="#E5E5E5"> and fast forward at</font><font color="#CCCCCC"> weave works we</font>

36
00:02:08,369 --> 00:02:15,300
run the<font color="#CCCCCC"> SAS this cloud system on Amazon</font>

37
00:02:11,610 --> 00:02:18,060
we we had these<font color="#E5E5E5"> 32 gig machines a couple</font>

38
00:02:15,300 --> 00:02:20,070
years ago and<font color="#CCCCCC"> we prepaid a year</font><font color="#E5E5E5"> and we</font>

39
00:02:18,060 --> 00:02:24,120
spent basically<font color="#CCCCCC"> a whole year</font><font color="#E5E5E5"> running out</font>

40
00:02:20,070 --> 00:02:26,700
<font color="#CCCCCC">of RAM on 32 gig machines</font><font color="#E5E5E5"> and tuning it</font>

41
00:02:24,120 --> 00:02:29,280
and and then finally the prepay ran out

42
00:02:26,700 --> 00:02:31,470
<font color="#E5E5E5">and</font><font color="#CCCCCC"> we</font><font color="#E5E5E5"> went to 64 gig machines</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> their</font>

43
00:02:29,280 --> 00:02:35,220
room<font color="#CCCCCC"> I'm certainly much more relaxed now</font>

44
00:02:31,470 --> 00:02:37,530
<font color="#E5E5E5">so yeah so so we care about the garbage</font>

45
00:02:35,220 --> 00:02:40,260
<font color="#CCCCCC">because you know if you</font><font color="#E5E5E5"> don't take out</font>

46
00:02:37,530 --> 00:02:45,150
<font color="#CCCCCC">the garbage it fills up and your life is</font>

47
00:02:40,260 --> 00:02:46,950
a<font color="#CCCCCC"> mess and so on and so on</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> I this</font>

48
00:02:45,150 --> 00:02:48,150
<font color="#E5E5E5">these are</font><font color="#CCCCCC"> some slides</font><font color="#E5E5E5"> from</font><font color="#CCCCCC"> a talk I did</font>

49
00:02:46,950 --> 00:02:51,209
last year<font color="#E5E5E5"> I might just skip through</font>

50
00:02:48,150 --> 00:02:54,000
<font color="#E5E5E5">those in the interests</font><font color="#CCCCCC"> of time</font><font color="#E5E5E5"> basically</font>

51
00:02:51,209 --> 00:02:56,580
<font color="#E5E5E5">the point I was making is is you every</font>

52
00:02:54,000 --> 00:02:58,890
<font color="#E5E5E5">time you garbage collect it kind of runs</font>

53
00:02:56,580 --> 00:03:03,030
all the way through memory<font color="#E5E5E5"> than your</font>

54
00:02:58,890 --> 00:03:06,480
process<font color="#E5E5E5"> so you have stuff in cache can</font>

55
00:03:03,030 --> 00:03:08,550
we can I<font color="#E5E5E5"> move the mouse</font><font color="#CCCCCC"> around</font><font color="#E5E5E5"> yeah the</font>

56
00:03:06,480 --> 00:03:11,369
cache is over here<font color="#E5E5E5"> so the cache has got</font>

57
00:03:08,550 --> 00:03:13,410
stuff in<font color="#E5E5E5"> it and</font><font color="#CCCCCC"> then after the garbage</font>

58
00:03:11,370 --> 00:03:14,850
collector runs<font color="#E5E5E5"> it's kind of</font><font color="#CCCCCC"> it's kind of</font>

59
00:03:13,410 --> 00:03:17,370
run<font color="#E5E5E5"> through your whole the whole memory</font>

60
00:03:14,850 --> 00:03:18,930
space looking<font color="#E5E5E5"> at stuff and</font><font color="#CCCCCC"> basically</font>

61
00:03:17,370 --> 00:03:22,799
<font color="#E5E5E5">emptied your cache</font><font color="#CCCCCC"> and it slows down</font>

62
00:03:18,930 --> 00:03:25,709
<font color="#E5E5E5">your program in ways that you might not</font>

63
00:03:22,799 --> 00:03:28,440
<font color="#E5E5E5">expect you know certainly</font><font color="#CCCCCC"> it's garbage</font>

64
00:03:25,709 --> 00:03:30,000
collection slows you down more<font color="#CCCCCC"> than just</font>

65
00:03:28,440 --> 00:03:32,450
the time<font color="#E5E5E5"> it spends garbage collecting</font>

66
00:03:30,000 --> 00:03:39,150
because<font color="#E5E5E5"> it interferes with the</font><font color="#CCCCCC"> cache</font>

67
00:03:32,450 --> 00:03:41,970
<font color="#E5E5E5">behavior of the machine so this is</font>

68
00:03:39,150 --> 00:03:43,580
another<font color="#E5E5E5"> picture to try and make the same</font>

69
00:03:41,970 --> 00:03:45,750
point

70
00:03:43,580 --> 00:03:48,720
stuff you have on<font color="#E5E5E5"> the stack it's very</font>

71
00:03:45,750 --> 00:03:49,860
easy<font color="#E5E5E5"> to clean</font><font color="#CCCCCC"> up you know when you when</font>

72
00:03:48,720 --> 00:03:52,590
you finished using<font color="#E5E5E5"> something on the</font>

73
00:03:49,860 --> 00:03:56,090
stack we just go zip just move the stack

74
00:03:52,590 --> 00:03:58,290
pointer it's all gone<font color="#CCCCCC"> stuff</font><font color="#E5E5E5"> on the heap</font>

75
00:03:56,090 --> 00:04:02,790
<font color="#CCCCCC">the</font><font color="#E5E5E5"> garbage collector has to go all the</font>

76
00:03:58,290 --> 00:04:04,620
<font color="#CCCCCC">way</font><font color="#E5E5E5"> through it looking</font><font color="#CCCCCC"> carefully and and</font>

77
00:04:02,790 --> 00:04:06,440
saying<font color="#E5E5E5"> is this thing still in use can we</font>

78
00:04:04,620 --> 00:04:08,760
find it from<font color="#CCCCCC"> somewhere else and so</font>

79
00:04:06,440 --> 00:04:13,230
that's my like introduction<font color="#CCCCCC"> to the</font>

80
00:04:08,760 --> 00:04:14,489
theory<font color="#CCCCCC"> of</font><font color="#E5E5E5"> garbage collection</font><font color="#CCCCCC"> so we</font><font color="#E5E5E5"> need</font>

81
00:04:13,230 --> 00:04:20,610
to worry about<font color="#E5E5E5"> it it's going on</font><font color="#CCCCCC"> all the</font>

82
00:04:14,490 --> 00:04:22,380
<font color="#CCCCCC">time and you're in the go runtime</font><font color="#E5E5E5"> we we</font>

83
00:04:20,610 --> 00:04:28,530
are impacted<font color="#CCCCCC"> by it whether we notice or</font>

84
00:04:22,380 --> 00:04:31,490
not<font color="#E5E5E5"> so let's look at the options to tune</font>

85
00:04:28,530 --> 00:04:31,489
the garbage collector

86
00:04:42,700 --> 00:04:52,930
these are all the options<font color="#CCCCCC"> you get to</font>

87
00:04:45,610 --> 00:04:55,750
tune the garbage collector in<font color="#E5E5E5"> Java</font><font color="#CCCCCC"> yeah</font>

88
00:04:52,930 --> 00:04:57,430
okay they're<font color="#E5E5E5"> not all these are these</font><font color="#CCCCCC"> are</font>

89
00:04:55,750 --> 00:05:02,440
<font color="#CCCCCC">all the ones I could find in like 20</font>

90
00:04:57,430 --> 00:05:04,060
minutes<font color="#CCCCCC"> of googling yeah let's let's</font>

91
00:05:02,440 --> 00:05:06,250
look at the list of options you<font color="#E5E5E5"> get to</font>

92
00:05:04,060 --> 00:05:16,420
tune the garbage collector in go<font color="#E5E5E5"> you</font>

93
00:05:06,250 --> 00:05:23,560
ready<font color="#E5E5E5"> there is</font><font color="#CCCCCC"> one option I signed up to</font>

94
00:05:16,420 --> 00:05:24,310
do a<font color="#CCCCCC"> 30-minute talk about one option</font><font color="#E5E5E5"> 25</font>

95
00:05:23,560 --> 00:05:27,210
<font color="#E5E5E5">minutes okay</font>

96
00:05:24,310 --> 00:05:29,740
and actually the timer is<font color="#CCCCCC"> not</font><font color="#E5E5E5"> running so</font>

97
00:05:27,210 --> 00:05:36,810
who knows who knows<font color="#E5E5E5"> how long this takes</font>

98
00:05:29,740 --> 00:05:36,810
<font color="#E5E5E5">you can get good yeah okay</font><font color="#CCCCCC"> so let's look</font>

99
00:05:38,490 --> 00:05:44,920
I'm<font color="#CCCCCC"> gonna hopefully</font><font color="#E5E5E5"> do a live demo if</font>

100
00:05:41,350 --> 00:05:50,490
the live demo<font color="#E5E5E5"> doesn't work I have screen</font>

101
00:05:44,920 --> 00:05:54,940
captures<font color="#CCCCCC"> so I'm running a client-server</font>

102
00:05:50,490 --> 00:05:57,850
<font color="#E5E5E5">micro service set up as my demo the</font>

103
00:05:54,940 --> 00:06:03,370
server<font color="#E5E5E5"> is a thing called pod info from</font>

104
00:05:57,850 --> 00:06:05,680
<font color="#E5E5E5">my colleague</font><font color="#CCCCCC"> Stephan the client is from</font>

105
00:06:03,370 --> 00:06:09,880
<font color="#E5E5E5">Jana</font><font color="#CCCCCC"> doggin who was here</font><font color="#E5E5E5"> this morning</font>

106
00:06:05,680 --> 00:06:11,530
<font color="#CCCCCC">but it's</font><font color="#E5E5E5"> not here now</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> there my client</font>

107
00:06:09,880 --> 00:06:17,680
is<font color="#E5E5E5"> the thing called</font><font color="#CCCCCC"> hey</font><font color="#E5E5E5"> that just just</font>

108
00:06:11,530 --> 00:06:27,640
<font color="#CCCCCC">like generates HTTP load</font><font color="#E5E5E5"> so let me see</font>

109
00:06:17,680 --> 00:06:35,140
if I can get my demo going<font color="#CCCCCC"> okay</font><font color="#E5E5E5"> so so</font>

110
00:06:27,640 --> 00:06:38,320
the first<font color="#CCCCCC"> set</font><font color="#E5E5E5"> up is a a big server</font>

111
00:06:35,140 --> 00:06:41,469
process<font color="#CCCCCC"> a big server process that has</font>

112
00:06:38,320 --> 00:06:44,260
some<font color="#E5E5E5"> kind of large amount of data in</font>

113
00:06:41,470 --> 00:06:47,950
memory<font color="#CCCCCC"> that basically sits there all</font><font color="#E5E5E5"> the</font>

114
00:06:44,260 --> 00:06:50,140
time<font color="#E5E5E5"> like a cache of results or you know</font>

115
00:06:47,950 --> 00:06:52,469
some data set<font color="#CCCCCC"> that</font><font color="#E5E5E5"> it's processing or or</font>

116
00:06:50,140 --> 00:06:56,039
something like that

117
00:06:52,470 --> 00:07:02,370
and I have simulated<font color="#E5E5E5"> this by</font>

118
00:06:56,040 --> 00:07:04,110
I scrolled<font color="#E5E5E5"> it up too far</font><font color="#CCCCCC"> yeah I I put</font>

119
00:07:02,370 --> 00:07:07,200
actually added that option to<font color="#E5E5E5"> Stefan's</font>

120
00:07:04,110 --> 00:07:13,080
program<font color="#E5E5E5"> I just allocated half a gigabyte</font>

121
00:07:07,200 --> 00:07:14,849
of<font color="#CCCCCC"> memory just in a byte slice</font><font color="#E5E5E5"> this I</font>

122
00:07:13,080 --> 00:07:19,380
could<font color="#E5E5E5"> probably try and make a bit bigger</font>

123
00:07:14,850 --> 00:07:22,080
<font color="#CCCCCC">hey they go</font><font color="#E5E5E5"> so what I want to point out</font>

124
00:07:19,380 --> 00:07:24,840
is the this<font color="#CCCCCC"> is</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> easiest</font><font color="#E5E5E5"> like garbage</font>

125
00:07:22,080 --> 00:07:27,090
collection in action<font color="#CCCCCC"> I</font><font color="#E5E5E5"> am I'm hitting it</font>

126
00:07:24,840 --> 00:07:28,440
with like five requests a second so it's

127
00:07:27,090 --> 00:07:33,690
it's<font color="#E5E5E5"> not</font><font color="#CCCCCC"> really doing very much</font><font color="#E5E5E5"> it's</font>

128
00:07:28,440 --> 00:07:35,460
using basically nearly<font color="#CCCCCC"> zero CPU</font><font color="#E5E5E5"> but the</font>

129
00:07:33,690 --> 00:07:37,140
memory is<font color="#E5E5E5"> going up and up and up and</font>

130
00:07:35,460 --> 00:07:39,570
<font color="#CCCCCC">then back down again up and up and up</font>

131
00:07:37,140 --> 00:07:43,380
bang<font color="#E5E5E5"> down again everybody really</font><font color="#CCCCCC"> got</font>

132
00:07:39,570 --> 00:07:48,270
that so this<font color="#CCCCCC"> is garbage collection in</font>

133
00:07:43,380 --> 00:07:50,520
action you<font color="#E5E5E5"> good thank you</font><font color="#CCCCCC"> and this</font><font color="#E5E5E5"> is</font>

134
00:07:48,270 --> 00:07:53,130
<font color="#E5E5E5">the default behavior</font><font color="#CCCCCC"> of the</font><font color="#E5E5E5"> goal garbage</font>

135
00:07:50,520 --> 00:07:55,070
collector<font color="#E5E5E5"> is it will it will clean</font>

136
00:07:53,130 --> 00:07:58,620
everything<font color="#CCCCCC"> up</font><font color="#E5E5E5"> as much as it can and then</font>

137
00:07:55,070 --> 00:08:09,740
<font color="#CCCCCC">the next time it</font><font color="#E5E5E5"> garbage</font><font color="#CCCCCC"> click collects</font>

138
00:07:58,620 --> 00:08:13,260
will be at twice<font color="#E5E5E5"> that value okay so the</font>

139
00:08:09,740 --> 00:08:14,610
<font color="#CCCCCC">III</font><font color="#E5E5E5"> hogged half a gigabyte of</font><font color="#CCCCCC"> memory</font><font color="#E5E5E5"> in</font>

140
00:08:13,260 --> 00:08:16,560
my program<font color="#CCCCCC"> my programs</font><font color="#E5E5E5"> not doing</font>

141
00:08:14,610 --> 00:08:17,880
anything<font color="#E5E5E5"> it's just like returning some</font>

142
00:08:16,560 --> 00:08:23,610
string saying it's alive or something

143
00:08:17,880 --> 00:08:26,340
<font color="#CCCCCC">like that</font><font color="#E5E5E5"> but the the program as a</font><font color="#CCCCCC"> whole</font>

144
00:08:23,610 --> 00:08:29,610
is using an extra half a gigabyte<font color="#E5E5E5"> of</font>

145
00:08:26,340 --> 00:08:30,840
memory<font color="#E5E5E5"> over and above what</font><font color="#CCCCCC"> I allocated</font>

146
00:08:29,610 --> 00:08:33,750
because<font color="#E5E5E5"> that's the behavior</font><font color="#CCCCCC"> of the</font><font color="#E5E5E5"> go</font>

147
00:08:30,840 --> 00:08:36,780
garbage collector<font color="#E5E5E5"> and</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> so that</font>

148
00:08:33,750 --> 00:08:38,190
<font color="#E5E5E5">setting go GC is a percentage and the</font>

149
00:08:36,780 --> 00:08:40,260
default percentage is a hundred<font color="#CCCCCC"> percent</font>

150
00:08:38,190 --> 00:08:46,260
<font color="#CCCCCC">so it gets a hundred percent</font><font color="#E5E5E5"> bigger and</font>

151
00:08:40,260 --> 00:08:48,030
then it<font color="#E5E5E5"> collects so I mean the way I got</font>

152
00:08:46,260 --> 00:08:49,530
<font color="#E5E5E5">to learn about this actually the this I</font>

153
00:08:48,030 --> 00:08:51,480
found<font color="#E5E5E5"> this setting in the prometheus</font>

154
00:08:49,530 --> 00:08:53,250
<font color="#E5E5E5">system</font><font color="#CCCCCC"> Prometheus is a good example of a</font>

155
00:08:51,480 --> 00:08:57,270
<font color="#CCCCCC">program that</font><font color="#E5E5E5"> sits there</font><font color="#CCCCCC"> very large in</font>

156
00:08:53,250 --> 00:09:01,170
memory and the Prometheus authors<font color="#E5E5E5"> tuned</font>

157
00:08:57,270 --> 00:09:02,760
the go GC value down so let's just try

158
00:09:01,170 --> 00:09:06,290
<font color="#E5E5E5">and do that</font><font color="#CCCCCC"> I'm going</font><font color="#E5E5E5"> to put the</font>

159
00:09:02,760 --> 00:09:06,290
microphone<font color="#CCCCCC"> down and take for a second</font>

160
00:09:10,529 --> 00:09:21,359
okay so I'm terminating my server<font color="#CCCCCC"> so I'm</font>

161
00:09:16,229 --> 00:09:23,399
<font color="#CCCCCC">gonna run the same server I'm typing</font>

162
00:09:21,359 --> 00:09:28,889
one-handed so that I would probably use

163
00:09:23,399 --> 00:09:32,519
<font color="#CCCCCC">ctrl Keys and</font><font color="#E5E5E5"> things go GC equals 50</font><font color="#CCCCCC"> oh</font>

164
00:09:28,889 --> 00:09:34,259
<font color="#E5E5E5">I typed I typed good GC with a small</font>

165
00:09:32,519 --> 00:09:34,949
letter so let me just<font color="#CCCCCC"> ctrl</font><font color="#E5E5E5"> see that and</font>

166
00:09:34,259 --> 00:09:39,049
do<font color="#CCCCCC"> it again</font>

167
00:09:34,949 --> 00:09:39,049
thank you very<font color="#E5E5E5"> much mr. microphone stand</font>

168
00:09:39,679 --> 00:09:45,899
<font color="#E5E5E5">so I'm running pod</font><font color="#CCCCCC"> info inside a</font>

169
00:09:42,809 --> 00:09:49,589
container that<font color="#E5E5E5"> has nothing to do with</font>

170
00:09:45,899 --> 00:09:52,049
the demo<font color="#CCCCCC"> I'm monitoring it using</font>

171
00:09:49,589 --> 00:09:54,749
<font color="#CCCCCC">Prometheus that again has nothing to do</font>

172
00:09:52,049 --> 00:09:56,848
with<font color="#CCCCCC"> the demo and I'm visualizing it</font>

173
00:09:54,749 --> 00:09:58,799
using graph<font color="#E5E5E5"> on ax which is drawing these</font>

174
00:09:56,849 --> 00:10:00,509
charts

175
00:09:58,799 --> 00:10:04,589
who knew Griffin I could do white as

176
00:10:00,509 --> 00:10:05,969
well as black<font color="#E5E5E5"> right yeah like they go</font>

177
00:10:04,589 --> 00:10:09,989
the<font color="#CCCCCC"> you learn</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> learned</font><font color="#E5E5E5"> something else</font>

178
00:10:05,969 --> 00:10:14,489
<font color="#E5E5E5">so so what I've done I left</font><font color="#CCCCCC"> the load</font>

179
00:10:09,989 --> 00:10:28,049
generator going<font color="#E5E5E5"> and I changed go GC</font><font color="#CCCCCC"> to</font>

180
00:10:14,489 --> 00:10:29,309
<font color="#CCCCCC">50</font><font color="#E5E5E5"> right here okay</font><font color="#CCCCCC"> and so what is</font><font color="#E5E5E5"> going</font>

181
00:10:28,049 --> 00:10:33,059
to<font color="#E5E5E5"> take a few seconds</font><font color="#CCCCCC"> just to flow</font>

182
00:10:29,309 --> 00:10:36,209
through on the chart<font color="#E5E5E5"> but what we can see</font>

183
00:10:33,059 --> 00:10:40,699
is it's now garbage collecting closer to

184
00:10:36,209 --> 00:10:42,748
<font color="#E5E5E5">the to the the kind of</font><font color="#CCCCCC"> baseline right</font>

185
00:10:40,699 --> 00:10:47,128
<font color="#E5E5E5">and in fact what it should kind</font><font color="#CCCCCC"> of</font>

186
00:10:42,749 --> 00:10:48,899
steady<font color="#E5E5E5"> out at the 750 level so this is</font>

187
00:10:47,129 --> 00:10:51,839
this<font color="#E5E5E5"> is a trick you</font><font color="#CCCCCC"> can use</font><font color="#E5E5E5"> you just set</font>

188
00:10:48,899 --> 00:10:55,069
that environment variable<font color="#E5E5E5"> go GC if if</font>

189
00:10:51,839 --> 00:10:58,079
the situation you're in<font color="#E5E5E5"> is your program</font>

190
00:10:55,069 --> 00:10:59,909
naturally has a huge amount<font color="#CCCCCC"> of</font><font color="#E5E5E5"> memory I</font>

191
00:10:58,079 --> 00:11:03,419
mean you know<font color="#E5E5E5"> our Prometheus server sit</font>

192
00:10:59,909 --> 00:11:06,179
at 20 gigabytes<font color="#E5E5E5"> in fact we run we've</font>

193
00:11:03,419 --> 00:11:08,759
works runs a hosted<font color="#CCCCCC"> Prometheus as a</font>

194
00:11:06,179 --> 00:11:10,019
service and we<font color="#CCCCCC"> actually we have this</font>

195
00:11:08,759 --> 00:11:11,699
thing<font color="#E5E5E5"> called cortex which</font><font color="#CCCCCC"> is like a</font>

196
00:11:10,019 --> 00:11:13,439
multi-tenant Prometheus and<font color="#E5E5E5"> those</font>

197
00:11:11,699 --> 00:11:15,478
servers<font color="#E5E5E5"> we have like a bunch of them</font>

198
00:11:13,439 --> 00:11:17,488
<font color="#CCCCCC">that</font><font color="#E5E5E5"> sit at 20 gigabytes so we do not</font>

199
00:11:15,479 --> 00:11:20,759
want to spend<font color="#E5E5E5"> an extra 20 gigabytes of</font>

200
00:11:17,489 --> 00:11:23,860
RAM just just<font color="#E5E5E5"> doing that just kind of</font>

201
00:11:20,759 --> 00:11:28,240
<font color="#E5E5E5">letting the garbage collector chill out</font>

202
00:11:23,860 --> 00:11:31,760
so we use this<font color="#CCCCCC"> variable in</font><font color="#E5E5E5"> production</font>

203
00:11:28,240 --> 00:11:39,470
<font color="#E5E5E5">tuned down for the processes that have a</font>

204
00:11:31,760 --> 00:11:41,300
big stable<font color="#E5E5E5"> memory base load okay and my</font>

205
00:11:39,470 --> 00:11:44,870
<font color="#CCCCCC">chart you know my charts kind of working</font>

206
00:11:41,300 --> 00:11:50,599
<font color="#CCCCCC">I did one earlier</font><font color="#E5E5E5"> they just find that</font>

207
00:11:44,870 --> 00:11:53,710
the back<font color="#E5E5E5"> to slides</font><font color="#CCCCCC"> so a large</font><font color="#E5E5E5"> stable</font>

208
00:11:50,600 --> 00:11:56,090
data sir yeah<font color="#CCCCCC"> so if</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> turn it to</font><font color="#E5E5E5"> 50</font>

209
00:11:53,710 --> 00:11:59,870
<font color="#CCCCCC">the garbage collector lets it go</font><font color="#E5E5E5"> 50</font>

210
00:11:56,090 --> 00:12:02,750
bigger and<font color="#E5E5E5"> and everyone's happy</font>

211
00:11:59,870 --> 00:12:06,020
what's the next<font color="#E5E5E5"> one</font><font color="#CCCCCC"> high GC rate small</font>

212
00:12:02,750 --> 00:12:08,800
heap okay let's try and let's try<font color="#E5E5E5"> and</font>

213
00:12:06,020 --> 00:12:12,260
emulate that so shut<font color="#E5E5E5"> down that server</font>

214
00:12:08,800 --> 00:12:18,829
<font color="#E5E5E5">yeah go</font><font color="#CCCCCC"> on just</font><font color="#E5E5E5"> trying on that server</font>

215
00:12:12,260 --> 00:12:26,150
<font color="#CCCCCC">we're gonna not hog the memory</font><font color="#E5E5E5"> and we're</font>

216
00:12:18,830 --> 00:12:30,620
gonna leave go GC on the default okay

217
00:12:26,150 --> 00:12:31,370
<font color="#CCCCCC">and then we were running hey like</font><font color="#E5E5E5"> five a</font>

218
00:12:30,620 --> 00:12:36,080
second

219
00:12:31,370 --> 00:12:38,600
I'm<font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> run</font><font color="#CCCCCC"> so this command is</font><font color="#E5E5E5"> 10</font>

220
00:12:36,080 --> 00:12:40,850
<font color="#E5E5E5">concurrent threads doing 20 seconds so</font>

221
00:12:38,600 --> 00:12:44,750
200 a second and it's going<font color="#E5E5E5"> to run it's</font>

222
00:12:40,850 --> 00:12:52,310
gonna<font color="#E5E5E5"> run for two minutes</font><font color="#CCCCCC"> so let's take</font>

223
00:12:44,750 --> 00:12:55,520
a<font color="#E5E5E5"> look at the charts oops right so just</font>

224
00:12:52,310 --> 00:12:57,469
<font color="#E5E5E5">for clarity I have I have totally</font>

225
00:12:55,520 --> 00:13:00,230
changed<font color="#E5E5E5"> my perspective the first example</font>

226
00:12:57,470 --> 00:13:03,140
was even though I'm running<font color="#E5E5E5"> the same</font>

227
00:13:00,230 --> 00:13:06,560
program I'm in a different pretend<font color="#E5E5E5"> now</font>

228
00:13:03,140 --> 00:13:08,270
the the first case I was<font color="#E5E5E5"> pretending I</font>

229
00:13:06,560 --> 00:13:10,969
had a<font color="#CCCCCC"> program</font><font color="#E5E5E5"> that ran with a really big</font>

230
00:13:08,270 --> 00:13:12,439
<font color="#E5E5E5">stable data</font><font color="#CCCCCC"> set</font><font color="#E5E5E5"> so now</font><font color="#CCCCCC"> I've moved</font><font color="#E5E5E5"> to</font>

231
00:13:10,970 --> 00:13:15,950
pretending I'm working with a program

232
00:13:12,440 --> 00:13:18,950
<font color="#CCCCCC">that uses very little memory like</font>

233
00:13:15,950 --> 00:13:21,520
something like a reverse<font color="#CCCCCC"> proxy it turns</font>

234
00:13:18,950 --> 00:13:27,170
out we have<font color="#CCCCCC"> one of them at work as well</font>

235
00:13:21,520 --> 00:13:29,319
<font color="#CCCCCC">and so what we observe</font><font color="#E5E5E5"> let's rather than</font>

236
00:13:27,170 --> 00:13:34,219
let<font color="#E5E5E5"> it run the full two minutes</font><font color="#CCCCCC"> let me</font>

237
00:13:29,320 --> 00:13:35,990
put the the<font color="#E5E5E5"> pre-canned stuff up on the</font>

238
00:13:34,220 --> 00:13:41,670
screen

239
00:13:35,990 --> 00:13:44,819
the<font color="#E5E5E5"> the CPU sorry the heap the heat was</font>

240
00:13:41,670 --> 00:13:46,319
like tiny<font color="#E5E5E5"> like</font><font color="#CCCCCC"> four megabytes or</font>

241
00:13:44,819 --> 00:13:47,790
something like<font color="#E5E5E5"> that</font><font color="#CCCCCC"> and I hit it with</font>

242
00:13:46,319 --> 00:13:52,769
these<font color="#CCCCCC"> two hundred requests a second and</font>

243
00:13:47,790 --> 00:13:55,469
it went up<font color="#E5E5E5"> to like</font><font color="#CCCCCC"> ten megabytes the</font><font color="#E5E5E5"> CPU</font>

244
00:13:52,769 --> 00:13:58,649
<font color="#E5E5E5">usage went way up the garbage collection</font>

245
00:13:55,470 --> 00:14:00,120
<font color="#E5E5E5">rate went way up you know before I was</font>

246
00:13:58,649 --> 00:14:03,209
showing you<font color="#E5E5E5"> is garbage collecting like</font>

247
00:14:00,120 --> 00:14:07,379
once a<font color="#CCCCCC"> minute now it's garbage</font>

248
00:14:03,209 --> 00:14:08,790
<font color="#E5E5E5">collecting</font><font color="#CCCCCC"> 60 times a second so we</font><font color="#E5E5E5"> can</font>

249
00:14:07,379 --> 00:14:12,389
go in the opposite<font color="#E5E5E5"> direction we can</font>

250
00:14:08,790 --> 00:14:14,069
raise<font color="#CCCCCC"> Gogi see we can say dear</font><font color="#E5E5E5"> mr.</font><font color="#CCCCCC"> Gore</font>

251
00:14:12,389 --> 00:14:18,870
garbage collector I would like you to

252
00:14:14,069 --> 00:14:24,420
use more memory<font color="#E5E5E5"> just like chill chill</font>

253
00:14:18,870 --> 00:14:28,470
out man<font color="#E5E5E5"> and use more memory</font><font color="#CCCCCC"> so this</font><font color="#E5E5E5"> is</font>

254
00:14:24,420 --> 00:14:32,550
go<font color="#E5E5E5"> G C equals 200</font><font color="#CCCCCC"> I could run the live</font>

255
00:14:28,470 --> 00:14:35,970
demo<font color="#CCCCCC"> but you probably</font><font color="#E5E5E5"> get bored go G C</font>

256
00:14:32,550 --> 00:14:38,609
equals 200<font color="#CCCCCC"> so now we're letting the</font>

257
00:14:35,970 --> 00:14:40,139
program use twice as much heap<font color="#E5E5E5"> right we</font>

258
00:14:38,610 --> 00:14:43,800
can kind of see that sawtooth effect

259
00:14:40,139 --> 00:14:46,050
<font color="#E5E5E5">here it's it's kind of leveling out at</font>

260
00:14:43,800 --> 00:14:50,008
<font color="#E5E5E5">about</font><font color="#CCCCCC"> 10 it's still not using</font><font color="#E5E5E5"> very much</font>

261
00:14:46,050 --> 00:14:51,420
<font color="#E5E5E5">more memory</font><font color="#CCCCCC"> but if you if you compare</font><font color="#E5E5E5"> to</font>

262
00:14:50,009 --> 00:14:55,050
<font color="#CCCCCC">the previous slide it's garbage</font>

263
00:14:51,420 --> 00:14:58,110
collecting half as often<font color="#E5E5E5"> so like you</font>

264
00:14:55,050 --> 00:14:59,670
<font color="#CCCCCC">know I told you my life story I my whole</font>

265
00:14:58,110 --> 00:15:02,309
machine had<font color="#CCCCCC"> four megabytes</font><font color="#E5E5E5"> to begin with</font>

266
00:14:59,670 --> 00:15:03,809
but<font color="#CCCCCC"> now we have we use 32 big machines</font>

267
00:15:02,309 --> 00:15:07,500
or whatever<font color="#CCCCCC"> we can spend</font><font color="#E5E5E5"> more memory</font>

268
00:15:03,809 --> 00:15:12,930
than<font color="#E5E5E5"> 10 megabytes</font><font color="#CCCCCC"> so so let's set go G C</font>

269
00:15:07,500 --> 00:15:14,699
equals a thousand there are we go so<font color="#E5E5E5"> now</font>

270
00:15:12,930 --> 00:15:17,849
we're<font color="#CCCCCC"> using</font><font color="#E5E5E5"> you know it's a tiny tiny</font>

271
00:15:14,699 --> 00:15:23,040
<font color="#E5E5E5">demo program but we're using like 30</font>

272
00:15:17,850 --> 00:15:24,600
megabytes of memory here<font color="#E5E5E5"> the go this is</font>

273
00:15:23,040 --> 00:15:31,170
<font color="#E5E5E5">the point where I ran it you can barely</font>

274
00:15:24,600 --> 00:15:33,839
see<font color="#CCCCCC"> you can barely see that</font><font color="#E5E5E5"> GT rate went</font>

275
00:15:31,170 --> 00:15:36,689
to about<font color="#CCCCCC"> 5</font><font color="#E5E5E5"> or something</font><font color="#CCCCCC"> like that and</font>

276
00:15:33,839 --> 00:15:39,779
the latency<font color="#CCCCCC"> is lower</font><font color="#E5E5E5"> they just skip back</font>

277
00:15:36,689 --> 00:15:42,509
let me<font color="#E5E5E5"> let me use this thing</font><font color="#CCCCCC"> so that was</font>

278
00:15:39,779 --> 00:15:46,980
the original<font color="#E5E5E5"> one the latency was like 10</font>

279
00:15:42,509 --> 00:15:48,780
milliseconds<font color="#E5E5E5"> and the latency just by</font>

280
00:15:46,980 --> 00:15:53,240
setting<font color="#CCCCCC"> the GC</font>

281
00:15:48,780 --> 00:15:53,240
just to use like<font color="#E5E5E5"> 50 mag instead of for</font>

282
00:15:53,300 --> 00:16:00,750
latency came down like<font color="#E5E5E5"> a third so in in</font>

283
00:15:58,890 --> 00:16:02,699
certainly<font color="#E5E5E5"> in my production life getting</font>

284
00:16:00,750 --> 00:16:07,620
getting your latency<font color="#E5E5E5"> down by third this</font>

285
00:16:02,700 --> 00:16:10,500
<font color="#E5E5E5">is</font><font color="#CCCCCC"> a pretty</font><font color="#E5E5E5"> damn good result</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> that is</font>

286
00:16:07,620 --> 00:16:13,160
the second thing you can<font color="#E5E5E5"> do with go GC</font>

287
00:16:10,500 --> 00:16:18,230
<font color="#E5E5E5">so first thing</font><font color="#CCCCCC"> you can</font><font color="#E5E5E5"> do is set it down</font>

288
00:16:13,160 --> 00:16:20,430
<font color="#CCCCCC">second thing</font><font color="#E5E5E5"> you can do is set</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> up is</font>

289
00:16:18,230 --> 00:16:26,490
there<font color="#CCCCCC"> anything</font><font color="#E5E5E5"> else you can do</font><font color="#CCCCCC"> with it</font>

290
00:16:20,430 --> 00:16:30,900
Brian you<font color="#CCCCCC"> have a</font><font color="#E5E5E5"> question it's a</font>

291
00:16:26,490 --> 00:16:34,550
percentage go<font color="#E5E5E5"> GC is a percentage the</font>

292
00:16:30,900 --> 00:16:39,270
question was what is<font color="#CCCCCC"> the</font><font color="#E5E5E5"> unit of go GC</font>

293
00:16:34,550 --> 00:16:42,990
<font color="#E5E5E5">and it is a percentage of the minimum</font>

294
00:16:39,270 --> 00:16:44,790
<font color="#E5E5E5">heap size so when it garbage collected</font>

295
00:16:42,990 --> 00:16:48,600
in<font color="#E5E5E5"> this example it collected all the way</font>

296
00:16:44,790 --> 00:16:51,500
down to about<font color="#CCCCCC"> four megabytes times a</font>

297
00:16:48,600 --> 00:16:53,880
thousand<font color="#CCCCCC"> percent</font><font color="#E5E5E5"> is</font><font color="#CCCCCC"> forty megabytes so</font>

298
00:16:51,500 --> 00:16:57,470
<font color="#CCCCCC">that's where it gets</font><font color="#E5E5E5"> up</font><font color="#CCCCCC"> to about</font><font color="#E5E5E5"> about</font>

299
00:16:53,880 --> 00:16:57,470
here<font color="#CCCCCC"> somewhere as forty megabytes</font><font color="#E5E5E5"> right</font>

300
00:17:01,340 --> 00:17:07,319
yeah so it's a percentage relative to

301
00:17:04,380 --> 00:17:08,910
the minimum<font color="#E5E5E5"> size so I'll give you</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> link</font>

302
00:17:07,319 --> 00:17:12,300
at the<font color="#CCCCCC"> end</font><font color="#E5E5E5"> there's a really</font><font color="#CCCCCC"> really good</font>

303
00:17:08,910 --> 00:17:14,400
presentation<font color="#E5E5E5"> that goes through the the</font>

304
00:17:12,300 --> 00:17:15,810
like<font color="#CCCCCC"> five-year</font><font color="#E5E5E5"> history last five year</font>

305
00:17:14,400 --> 00:17:17,640
history of the go garbage collector and

306
00:17:15,810 --> 00:17:20,490
<font color="#CCCCCC">all the reasons why they</font><font color="#E5E5E5"> did things and</font>

307
00:17:17,640 --> 00:17:23,010
<font color="#CCCCCC">the background and so on and one of</font>

308
00:17:20,490 --> 00:17:25,140
their aims is to<font color="#CCCCCC"> make this thing</font><font color="#E5E5E5"> kind of</font>

309
00:17:23,010 --> 00:17:27,180
self tuning and self adaptive that's why

310
00:17:25,140 --> 00:17:30,150
everything is relative<font color="#CCCCCC"> that's why it</font>

311
00:17:27,180 --> 00:17:33,270
doesn't<font color="#CCCCCC"> look like the java page so this</font>

312
00:17:30,150 --> 00:17:36,390
<font color="#E5E5E5">is a relative measure but there we go</font>

313
00:17:33,270 --> 00:17:38,129
so go GC<font color="#E5E5E5"> set it to</font><font color="#CCCCCC"> ten times the</font>

314
00:17:36,390 --> 00:17:41,040
original and my latency went down by

315
00:17:38,130 --> 00:17:43,470
third my<font color="#E5E5E5"> CPU usage went down to you know</font>

316
00:17:41,040 --> 00:17:48,690
about<font color="#CCCCCC"> two-thirds the the GC rate went</font>

317
00:17:43,470 --> 00:17:54,260
down<font color="#E5E5E5"> by</font><font color="#CCCCCC"> factor of</font><font color="#E5E5E5"> ten</font><font color="#CCCCCC"> so that's that's a</font>

318
00:17:48,690 --> 00:17:56,730
<font color="#E5E5E5">pretty good result</font><font color="#CCCCCC"> so I the there's a</font>

319
00:17:54,260 --> 00:17:59,070
there's another<font color="#E5E5E5"> thing you can kind of</font>

320
00:17:56,730 --> 00:18:01,680
see it<font color="#CCCCCC"> in this</font><font color="#E5E5E5"> picture as well</font><font color="#CCCCCC"> when the</font>

321
00:17:59,070 --> 00:18:03,270
load went away we

322
00:18:01,680 --> 00:18:08,070
actually get all<font color="#CCCCCC"> the</font><font color="#E5E5E5"> way up to</font><font color="#CCCCCC"> 40</font>

323
00:18:03,270 --> 00:18:09,540
<font color="#E5E5E5">megabytes</font><font color="#CCCCCC"> right and in in this</font><font color="#E5E5E5"> example</font>

324
00:18:08,070 --> 00:18:11,700
you<font color="#E5E5E5"> can barely see</font><font color="#CCCCCC"> it this</font><font color="#E5E5E5"> is when it</font>

325
00:18:09,540 --> 00:18:16,290
<font color="#E5E5E5">was like ticking</font><font color="#CCCCCC"> over on the on the</font><font color="#E5E5E5"> 500</font>

326
00:18:11,700 --> 00:18:17,730
<font color="#E5E5E5">Meg case</font><font color="#CCCCCC"> so it turns out there is</font>

327
00:18:16,290 --> 00:18:20,970
<font color="#CCCCCC">another setting for the go garbage</font>

328
00:18:17,730 --> 00:18:24,840
collector<font color="#CCCCCC"> but</font><font color="#E5E5E5"> it's not a setting that</font>

329
00:18:20,970 --> 00:18:28,320
<font color="#E5E5E5">you're allowed to</font><font color="#CCCCCC"> set the</font><font color="#E5E5E5"> goal garbage</font>

330
00:18:24,840 --> 00:18:34,080
collector<font color="#CCCCCC"> will run every</font><font color="#E5E5E5"> two minutes</font><font color="#CCCCCC"> if</font>

331
00:18:28,320 --> 00:18:36,000
it has<font color="#E5E5E5"> otherwise not run</font><font color="#CCCCCC"> and so that's</font>

332
00:18:34,080 --> 00:18:37,620
<font color="#E5E5E5">useful if you</font><font color="#CCCCCC"> like did something very</font>

333
00:18:36,000 --> 00:18:40,500
intensively in your program and then

334
00:18:37,620 --> 00:18:43,679
stopped<font color="#CCCCCC"> your program just wait</font><font color="#E5E5E5"> it for</font>

335
00:18:40,500 --> 00:18:45,240
input then<font color="#CCCCCC"> you know by the rules of</font>

336
00:18:43,680 --> 00:18:47,070
garbage collect when you hit a limit<font color="#E5E5E5"> it</font>

337
00:18:45,240 --> 00:18:48,870
would like never run the<font color="#E5E5E5"> garbage</font>

338
00:18:47,070 --> 00:18:49,860
collector<font color="#E5E5E5"> and so your program would sit</font>

339
00:18:48,870 --> 00:18:52,669
there hogging<font color="#CCCCCC"> all the memory in your</font>

340
00:18:49,860 --> 00:18:55,229
<font color="#CCCCCC">machine so they run it</font><font color="#E5E5E5"> every two minutes</font>

341
00:18:52,670 --> 00:18:58,950
<font color="#CCCCCC">two times</font><font color="#E5E5E5"> ten to the nine nanoseconds</font>

342
00:18:55,230 --> 00:19:00,570
<font color="#E5E5E5">every two minutes and they will actually</font>

343
00:18:58,950 --> 00:19:02,880
<font color="#E5E5E5">free the</font><font color="#CCCCCC"> memory back to</font><font color="#E5E5E5"> the operating</font>

344
00:19:00,570 --> 00:19:07,409
<font color="#E5E5E5">system</font><font color="#CCCCCC"> if you're no longer using it in</font>

345
00:19:02,880 --> 00:19:08,580
<font color="#E5E5E5">in that</font><font color="#CCCCCC"> scenario</font><font color="#E5E5E5"> so so that's this this</font>

346
00:19:07,410 --> 00:19:12,930
sawtooth which I didn't actually know

347
00:19:08,580 --> 00:19:15,149
<font color="#E5E5E5">about until I did these slides</font><font color="#CCCCCC"> I didn't</font>

348
00:19:12,930 --> 00:19:19,950
know there was<font color="#E5E5E5"> a two minute max on the</font>

349
00:19:15,150 --> 00:19:23,450
garbage collector it is<font color="#E5E5E5"> it is a variable</font>

350
00:19:19,950 --> 00:19:28,050
<font color="#E5E5E5">but it's an unexploited variable in the</font>

351
00:19:23,450 --> 00:19:35,250
<font color="#CCCCCC">4300 line file that I had to read to</font>

352
00:19:28,050 --> 00:19:39,450
<font color="#E5E5E5">find it okay one</font><font color="#CCCCCC"> last trick</font><font color="#E5E5E5"> there is one</font>

353
00:19:35,250 --> 00:19:43,740
more thing<font color="#E5E5E5"> you</font><font color="#CCCCCC"> can do with go GC</font><font color="#E5E5E5"> you can</font>

354
00:19:39,450 --> 00:19:47,310
set it to<font color="#E5E5E5"> the word off so why would you</font>

355
00:19:43,740 --> 00:19:50,700
<font color="#E5E5E5">do that</font><font color="#CCCCCC"> you would do</font><font color="#E5E5E5"> that if you had a</font>

356
00:19:47,310 --> 00:19:52,230
truly infinite<font color="#E5E5E5"> amount of RAM that's know</font>

357
00:19:50,700 --> 00:19:54,240
nobody has an infinite amount<font color="#E5E5E5"> of RAM</font>

358
00:19:52,230 --> 00:19:56,910
<font color="#E5E5E5">okay but it turns out basically there's</font>

359
00:19:54,240 --> 00:20:00,900
there's a<font color="#E5E5E5"> certain set of programs that</font>

360
00:19:56,910 --> 00:20:08,340
just will terminate before they've used

361
00:20:00,900 --> 00:20:12,890
<font color="#E5E5E5">a huge amount</font><font color="#CCCCCC"> of RAM so let</font><font color="#E5E5E5"> me see do I</font>

362
00:20:08,340 --> 00:20:12,889
want to do the demo<font color="#E5E5E5"> no I'm scared</font>

363
00:20:15,110 --> 00:20:22,879
at the pre-canned version so<font color="#E5E5E5"> I just I</font>

364
00:20:19,070 --> 00:20:26,060
built the pot in full program that<font color="#E5E5E5"> that</font>

365
00:20:22,880 --> 00:20:29,840
<font color="#CCCCCC">I'm using for the demo</font><font color="#E5E5E5"> and it builds in</font>

366
00:20:26,060 --> 00:20:35,030
like seven seven<font color="#E5E5E5"> and a third seconds on</font>

367
00:20:29,840 --> 00:20:36,470
my laptop<font color="#CCCCCC"> if I turn off</font><font color="#E5E5E5"> garbage</font>

368
00:20:35,030 --> 00:20:40,310
<font color="#E5E5E5">collection it builds in five and a half</font>

369
00:20:36,470 --> 00:20:43,340
seconds<font color="#E5E5E5"> and this is a four year</font><font color="#CCCCCC"> old</font>

370
00:20:40,310 --> 00:20:49,909
<font color="#CCCCCC">macbook so</font><font color="#E5E5E5"> you know I don't have</font>

371
00:20:43,340 --> 00:20:51,980
<font color="#E5E5E5">infinite</font><font color="#CCCCCC"> RAM</font><font color="#E5E5E5"> yeah I think the the</font>

372
00:20:49,910 --> 00:20:53,840
compilation<font color="#E5E5E5"> of that program which like</font>

373
00:20:51,980 --> 00:20:55,400
<font color="#E5E5E5">vendors kubernetes libraries and stuff</font>

374
00:20:53,840 --> 00:21:02,929
<font color="#CCCCCC">like that you</font><font color="#E5E5E5"> know it's not</font><font color="#CCCCCC"> a not a</font>

375
00:20:55,400 --> 00:21:06,680
trivial<font color="#CCCCCC"> program the the compilation</font><font color="#E5E5E5"> runs</font>

376
00:21:02,930 --> 00:21:08,090
in 50 50 Meg of RAM<font color="#E5E5E5"> or something like</font>

377
00:21:06,680 --> 00:21:11,690
<font color="#E5E5E5">that</font><font color="#CCCCCC"> it just does not need to garbage</font>

378
00:21:08,090 --> 00:21:14,840
<font color="#E5E5E5">collect</font><font color="#CCCCCC"> and it sounds a little</font><font color="#E5E5E5"> trick you</font>

379
00:21:11,690 --> 00:21:16,490
<font color="#E5E5E5">can</font><font color="#CCCCCC"> try</font><font color="#E5E5E5"> you can turn off garbage</font>

380
00:21:14,840 --> 00:21:20,510
collection in<font color="#E5E5E5"> your compilations or if</font>

381
00:21:16,490 --> 00:21:22,220
you have some<font color="#E5E5E5"> other kind of batch</font><font color="#CCCCCC"> you</font>

382
00:21:20,510 --> 00:21:24,379
know batch operation<font color="#CCCCCC"> and</font><font color="#E5E5E5"> written and go</font>

383
00:21:22,220 --> 00:21:26,870
that just<font color="#E5E5E5"> runs for a bit and then</font>

384
00:21:24,380 --> 00:21:30,140
terminates<font color="#CCCCCC"> you can just turn</font><font color="#E5E5E5"> the garbage</font>

385
00:21:26,870 --> 00:21:34,219
collector off and you might get a speed

386
00:21:30,140 --> 00:21:35,690
benefit or you might get a crash<font color="#CCCCCC"> I you</font>

387
00:21:34,220 --> 00:21:38,140
<font color="#E5E5E5">know this is open source</font><font color="#CCCCCC"> no</font><font color="#E5E5E5"> no</font>

388
00:21:35,690 --> 00:21:38,140
guarantees

389
00:21:40,960 --> 00:21:49,610
<font color="#E5E5E5">okay</font><font color="#CCCCCC"> fantastic picture from Ashlee</font>

390
00:21:45,050 --> 00:21:52,280
McNamara<font color="#E5E5E5"> there we might get more go</font>

391
00:21:49,610 --> 00:21:58,129
garbage collector settings to tweak in

392
00:21:52,280 --> 00:22:02,840
the future we might approach the<font color="#CCCCCC"> Java</font>

393
00:21:58,130 --> 00:22:07,040
page<font color="#E5E5E5"> over time</font><font color="#CCCCCC"> so there</font><font color="#E5E5E5"> are two</font><font color="#CCCCCC"> that you</font>

394
00:22:02,840 --> 00:22:11,209
can read<font color="#E5E5E5"> about clearly talked about one</font>

395
00:22:07,040 --> 00:22:13,220
is set<font color="#E5E5E5"> max-heap because you know this</font>

396
00:22:11,210 --> 00:22:15,710
<font color="#E5E5E5">thing about I'll</font><font color="#CCCCCC"> just go twice as big as</font>

397
00:22:13,220 --> 00:22:18,290
I was last time<font color="#E5E5E5"> you</font><font color="#CCCCCC"> know at some point</font>

398
00:22:15,710 --> 00:22:21,040
<font color="#E5E5E5">it goes back</font><font color="#CCCCCC"> oh</font><font color="#E5E5E5"> this is this was my life</font>

399
00:22:18,290 --> 00:22:26,530
right for<font color="#E5E5E5"> most of the last year our</font>

400
00:22:21,040 --> 00:22:26,530
<font color="#CCCCCC">processes would crash in production</font><font color="#E5E5E5"> and</font>

401
00:22:26,800 --> 00:22:31,250
so<font color="#E5E5E5"> just telling the garbage collector</font>

402
00:22:29,210 --> 00:22:33,410
like yeah I love<font color="#E5E5E5"> your sawtooth but just</font>

403
00:22:31,250 --> 00:22:36,050
<font color="#E5E5E5">don't go above 20 gigabytes</font><font color="#CCCCCC"> oh you know</font>

404
00:22:33,410 --> 00:22:38,150
whatever whatever number you pick so

405
00:22:36,050 --> 00:22:41,540
what that does<font color="#E5E5E5"> is it trades performance</font>

406
00:22:38,150 --> 00:22:43,130
for safety<font color="#E5E5E5"> right because if you actually</font>

407
00:22:41,540 --> 00:22:44,480
<font color="#E5E5E5">need that much</font><font color="#CCCCCC"> memory you you're</font>

408
00:22:43,130 --> 00:22:46,670
<font color="#CCCCCC">sawtooth is going to get faster and</font>

409
00:22:44,480 --> 00:22:48,380
<font color="#CCCCCC">faster and faster</font><font color="#E5E5E5"> until eventually the</font>

410
00:22:46,670 --> 00:22:50,680
<font color="#E5E5E5">program does nothing because it's just</font>

411
00:22:48,380 --> 00:22:52,960
garbage collecting all the time

412
00:22:50,680 --> 00:22:57,830
but<font color="#CCCCCC"> that so this</font><font color="#E5E5E5"> is in an experimental</font>

413
00:22:52,960 --> 00:23:00,470
branch of the<font color="#E5E5E5"> goal</font><font color="#CCCCCC"> run time</font><font color="#E5E5E5"> that I</font>

414
00:22:57,830 --> 00:23:01,820
couldn't actually find but I can<font color="#E5E5E5"> I can</font>

415
00:23:00,470 --> 00:23:05,720
read<font color="#CCCCCC"> about it and</font><font color="#E5E5E5"> you can</font><font color="#CCCCCC"> google it you</font>

416
00:23:01,820 --> 00:23:08,600
can find all that<font color="#CCCCCC"> stuff</font><font color="#E5E5E5"> on the other</font>

417
00:23:05,720 --> 00:23:12,140
side there is<font color="#CCCCCC"> also I think accepted</font>

418
00:23:08,600 --> 00:23:13,850
support for a minimum heap size<font color="#E5E5E5"> so this</font>

419
00:23:12,140 --> 00:23:17,960
is this<font color="#E5E5E5"> is basically the same thing</font><font color="#CCCCCC"> as I</font>

420
00:23:13,850 --> 00:23:21,740
did<font color="#E5E5E5"> with setting go GC very high saying</font>

421
00:23:17,960 --> 00:23:23,420
look I want<font color="#CCCCCC"> you to use</font><font color="#E5E5E5"> more memory but</font>

422
00:23:21,740 --> 00:23:26,240
it's like a safer way to do it because

423
00:23:23,420 --> 00:23:27,740
<font color="#E5E5E5">the the</font><font color="#CCCCCC"> multiplier has</font><font color="#E5E5E5"> that dangerous</font>

424
00:23:26,240 --> 00:23:31,400
effect that the<font color="#CCCCCC"> sawtooth might get out</font>

425
00:23:27,740 --> 00:23:32,570
of hand<font color="#E5E5E5"> so good go GC min I think that</font>

426
00:23:31,400 --> 00:23:36,110
will show up that's<font color="#E5E5E5"> a that's so much</font>

427
00:23:32,570 --> 00:23:40,429
simpler<font color="#E5E5E5"> change to the runtime so</font>

428
00:23:36,110 --> 00:23:44,530
probably<font color="#E5E5E5"> show up fast faster sooner okay</font>

429
00:23:40,430 --> 00:23:52,250
I am done<font color="#CCCCCC"> with my talk</font>

430
00:23:44,530 --> 00:23:55,250
[Applause]

431
00:23:52,250 --> 00:23:55,250
questions

432
00:23:58,490 --> 00:24:10,280
<font color="#E5E5E5">No okay couple of</font><font color="#CCCCCC"> Link's open question</font>

433
00:24:04,640 --> 00:24:15,560
yeah<font color="#CCCCCC"> do I do I run with</font><font color="#E5E5E5"> the mic thank</font>

434
00:24:10,280 --> 00:24:17,870
you<font color="#E5E5E5"> so what about GC x r GC x</font><font color="#CCCCCC"> strictly</font>

435
00:24:15,560 --> 00:24:22,040
linearly dependent with the amount of

436
00:24:17,870 --> 00:24:24,530
<font color="#CCCCCC">ram</font><font color="#E5E5E5"> that needs to be wiped</font>

437
00:24:22,040 --> 00:24:28,399
or is there a sweet spot between GC x

438
00:24:24,530 --> 00:24:32,210
and<font color="#CCCCCC"> them okay so I think</font><font color="#E5E5E5"> you're you're</font>

439
00:24:28,400 --> 00:24:36,920
<font color="#E5E5E5">asking about the</font><font color="#CCCCCC"> time the garbage</font>

440
00:24:32,210 --> 00:24:38,360
collector<font color="#E5E5E5"> takes to run and and I was so</font>

441
00:24:36,920 --> 00:24:40,070
number one that I will say the the

442
00:24:38,360 --> 00:24:42,409
impact<font color="#E5E5E5"> of garbage collection on</font>

443
00:24:40,070 --> 00:24:45,500
performance is way bigger<font color="#E5E5E5"> than the time</font>

444
00:24:42,410 --> 00:24:47,870
the garbage collector takes to run so so

445
00:24:45,500 --> 00:24:50,570
that go over<font color="#CCCCCC"> the last few revisions</font><font color="#E5E5E5"> move</font>

446
00:24:47,870 --> 00:24:53,330
to a largely<font color="#E5E5E5"> garbage collecting in the</font>

447
00:24:50,570 --> 00:24:55,220
<font color="#E5E5E5">background so the actual</font><font color="#CCCCCC"> time it</font><font color="#E5E5E5"> stops</font>

448
00:24:53,330 --> 00:24:58,669
<font color="#E5E5E5">your program for is is under most</font>

449
00:24:55,220 --> 00:25:02,270
circumstances tiny tiny tiny<font color="#CCCCCC"> their edge</font>

450
00:24:58,670 --> 00:25:04,430
cases<font color="#E5E5E5"> that whole slide about the like</font>

451
00:25:02,270 --> 00:25:07,010
the<font color="#CCCCCC"> cash</font><font color="#E5E5E5"> and so on garbage collection</font>

452
00:25:04,430 --> 00:25:10,010
will slug your program will really<font color="#E5E5E5"> slow</font>

453
00:25:07,010 --> 00:25:11,510
<font color="#E5E5E5">it down in ways that are really hard</font><font color="#CCCCCC"> to</font>

454
00:25:10,010 --> 00:25:12,920
understand you know it's<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> just this</font>

455
00:25:11,510 --> 00:25:15,020
fact<font color="#CCCCCC"> that it's trolling through</font>

456
00:25:12,920 --> 00:25:17,150
<font color="#E5E5E5">everything in your program so so there</font>

457
00:25:15,020 --> 00:25:19,400
is no metric you can other than other

458
00:25:17,150 --> 00:25:21,650
<font color="#E5E5E5">than</font><font color="#CCCCCC"> the end result</font><font color="#E5E5E5"> like my latency went</font>

459
00:25:19,400 --> 00:25:24,050
down by a third<font color="#CCCCCC"> so that was the</font><font color="#E5E5E5"> impact</font>

460
00:25:21,650 --> 00:25:27,560
that GC was having on my program<font color="#E5E5E5"> there</font>

461
00:25:24,050 --> 00:25:33,379
<font color="#E5E5E5">is no measurement of GC time that will</font>

462
00:25:27,560 --> 00:25:36,889
add up<font color="#CCCCCC"> to</font><font color="#E5E5E5"> a third and I so you know</font>

463
00:25:33,380 --> 00:25:39,200
<font color="#E5E5E5">sorry that I do this a lot</font><font color="#CCCCCC"> and that</font><font color="#E5E5E5"> is</font>

464
00:25:36,890 --> 00:25:42,170
absolutely<font color="#E5E5E5"> my finding there's there</font><font color="#CCCCCC"> is</font>

465
00:25:39,200 --> 00:25:43,580
no simple relationship between<font color="#E5E5E5"> anything</font>

466
00:25:42,170 --> 00:25:45,080
<font color="#E5E5E5">and anything you've got</font><font color="#CCCCCC"> to kind of try</font>

467
00:25:43,580 --> 00:25:50,270
the different<font color="#E5E5E5"> values and see what hum</font>

468
00:25:45,080 --> 00:25:52,540
comes out<font color="#E5E5E5"> okay out of time thank you</font>

469
00:25:50,270 --> 00:25:52,540
<font color="#E5E5E5">very much</font>

470
00:25:53,070 --> 00:25:55,129
you

