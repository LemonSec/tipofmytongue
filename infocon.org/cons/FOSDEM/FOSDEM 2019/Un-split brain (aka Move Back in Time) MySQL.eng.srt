1
00:00:05,110 --> 00:00:11,389
hi everyone<font color="#E5E5E5"> thank you for</font><font color="#CCCCCC"> coming my name</font>

2
00:00:08,660 --> 00:00:13,309
is<font color="#CCCCCC"> Ashe La Mina this is an unlit brain</font>

3
00:00:11,389 --> 00:00:14,780
<font color="#E5E5E5">MySQL session</font>

4
00:00:13,309 --> 00:00:18,470
I'm with the<font color="#CCCCCC"> Gaeta database</font>

5
00:00:14,780 --> 00:00:21,980
infrastructure team<font color="#CCCCCC"> I guess</font><font color="#E5E5E5"> you know get</font>

6
00:00:18,470 --> 00:00:25,729
<font color="#E5E5E5">up the incentive</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> this session was an</font>

7
00:00:21,980 --> 00:00:29,000
unfortunate outage<font color="#E5E5E5"> that we took a few</font>

8
00:00:25,730 --> 00:00:32,558
months<font color="#CCCCCC"> ago we had</font><font color="#E5E5E5"> a split brain scenario</font>

9
00:00:29,000 --> 00:00:36,260
<font color="#E5E5E5">and I would like to quickly illustrate</font>

10
00:00:32,558 --> 00:00:39,769
my skill wise<font color="#E5E5E5"> what happened and then</font>

11
00:00:36,260 --> 00:00:42,829
discuss the rest of this<font color="#E5E5E5"> session</font><font color="#CCCCCC"> so what</font>

12
00:00:39,770 --> 00:00:44,989
we had what we<font color="#CCCCCC"> had basically</font><font color="#E5E5E5"> is a data</font>

13
00:00:42,829 --> 00:00:47,960
center network<font color="#E5E5E5"> petition problem</font><font color="#CCCCCC"> right an</font>

14
00:00:44,989 --> 00:00:49,730
<font color="#CCCCCC">entire DC went down</font><font color="#E5E5E5"> petitioned so</font>

15
00:00:47,960 --> 00:00:50,989
imagine we had this class<font color="#E5E5E5"> so we had</font>

16
00:00:49,730 --> 00:00:53,989
multiple<font color="#CCCCCC"> clusters of</font><font color="#E5E5E5"> course but let's</font>

17
00:00:50,989 --> 00:00:57,410
<font color="#E5E5E5">discuss just this one</font><font color="#CCCCCC"> Wow</font>

18
00:00:53,989 --> 00:01:00,230
we had<font color="#E5E5E5"> this database</font><font color="#CCCCCC"> cluster with this</font>

19
00:00:57,410 --> 00:01:03,620
master and the master<font color="#CCCCCC"> and the replicas</font>

20
00:01:00,230 --> 00:01:05,810
got<font color="#CCCCCC"> networked isolated in our</font>

21
00:01:03,620 --> 00:01:08,539
<font color="#CCCCCC">Orchestrator failure mechanism kicked in</font>

22
00:01:05,810 --> 00:01:10,490
and failed<font color="#E5E5E5"> everything</font><font color="#CCCCCC"> all the databases</font>

23
00:01:08,540 --> 00:01:12,409
<font color="#E5E5E5">- so all the masters all the writers</font>

24
00:01:10,490 --> 00:01:14,890
<font color="#CCCCCC">failed over</font><font color="#E5E5E5"> to the other DC</font><font color="#CCCCCC"> - the</font>

25
00:01:12,409 --> 00:01:18,350
<font color="#E5E5E5">failover they see and so</font><font color="#CCCCCC"> Orchestrator</font>

26
00:01:14,890 --> 00:01:22,340
promoted this half of the cluster and

27
00:01:18,350 --> 00:01:25,399
<font color="#E5E5E5">made this the</font><font color="#CCCCCC"> master but during that</font>

28
00:01:22,340 --> 00:01:28,159
time<font color="#E5E5E5"> when this was</font><font color="#CCCCCC"> network isolated</font><font color="#E5E5E5"> the</font>

29
00:01:25,400 --> 00:01:32,360
old<font color="#E5E5E5"> master still took some rights from</font>

30
00:01:28,159 --> 00:01:34,400
local applications<font color="#E5E5E5"> and so when this was</font>

31
00:01:32,360 --> 00:01:37,760
promoted<font color="#E5E5E5"> and the entire</font><font color="#CCCCCC"> ghetto failed</font>

32
00:01:34,400 --> 00:01:40,490
over<font color="#E5E5E5"> using this master this already</font>

33
00:01:37,760 --> 00:01:42,860
<font color="#E5E5E5">diverged now this was expected behavior</font>

34
00:01:40,490 --> 00:01:44,929
<font color="#E5E5E5">it was actually written we we knew about</font>

35
00:01:42,860 --> 00:01:48,590
<font color="#E5E5E5">it and</font><font color="#CCCCCC"> that was supposed to</font><font color="#E5E5E5"> have been</font>

36
00:01:44,930 --> 00:01:51,710
fine but<font color="#CCCCCC"> unfortunately</font><font color="#E5E5E5"> and for reasons</font>

37
00:01:48,590 --> 00:01:55,070
outside<font color="#CCCCCC"> the scope of</font><font color="#E5E5E5"> this session we had</font>

38
00:01:51,710 --> 00:01:59,929
to fail back to this cluster<font color="#CCCCCC"> - this</font><font color="#E5E5E5"> DC</font>

39
00:01:55,070 --> 00:02:02,240
we<font color="#CCCCCC"> we just</font><font color="#E5E5E5"> had to and by the time we</font>

40
00:01:59,930 --> 00:02:04,640
realized<font color="#E5E5E5"> we have to fail back there was</font>

41
00:02:02,240 --> 00:02:07,939
like in half an hour's worth of<font color="#CCCCCC"> Rights</font>

42
00:02:04,640 --> 00:02:10,759
on<font color="#E5E5E5"> the newly promoted master we couldn't</font>

43
00:02:07,939 --> 00:02:13,160
just<font color="#E5E5E5"> throw them away</font><font color="#CCCCCC"> was half an hour</font>

44
00:02:10,758 --> 00:02:15,619
it's a lot of production traffic<font color="#E5E5E5"> now</font>

45
00:02:13,160 --> 00:02:18,390
this master only<font color="#E5E5E5"> took a few seconds</font>

46
00:02:15,620 --> 00:02:20,820
worth of bad traffic<font color="#E5E5E5"> right</font>

47
00:02:18,390 --> 00:02:23,670
maybe<font color="#E5E5E5"> just a thousand transactions or so</font>

48
00:02:20,820 --> 00:02:26,700
it's not too<font color="#E5E5E5"> much maybe a half minute</font>

49
00:02:23,670 --> 00:02:30,299
depends on the master<font color="#E5E5E5"> but they diverged</font>

50
00:02:26,700 --> 00:02:32,429
<font color="#E5E5E5">we couldn't fail back without losing the</font>

51
00:02:30,300 --> 00:02:34,470
data and we couldn't set up replication

52
00:02:32,430 --> 00:02:37,200
<font color="#E5E5E5">between the two because they diverged</font><font color="#CCCCCC"> we</font>

53
00:02:34,470 --> 00:02:39,420
would no longer cooperate<font color="#E5E5E5"> so the big</font>

54
00:02:37,200 --> 00:02:42,920
<font color="#E5E5E5">outage time was due to the time it took</font>

55
00:02:39,420 --> 00:02:45,600
us<font color="#E5E5E5"> to restore from backup all these</font>

56
00:02:42,920 --> 00:02:47,420
dozens and dozens of servers<font color="#CCCCCC"> in this DC</font>

57
00:02:45,600 --> 00:02:50,760
and catch up<font color="#CCCCCC"> with</font><font color="#E5E5E5"> the replication and</font>

58
00:02:47,420 --> 00:02:54,329
<font color="#E5E5E5">etc so you know the</font><font color="#CCCCCC"> Delian the question</font>

59
00:02:50,760 --> 00:02:57,470
was could we<font color="#E5E5E5"> have somehow just roll back</font>

60
00:02:54,330 --> 00:03:00,959
these bad<font color="#CCCCCC"> 1,000 transactions and</font>

61
00:02:57,470 --> 00:03:03,570
magically amend the database to be<font color="#E5E5E5"> back</font>

62
00:03:00,959 --> 00:03:05,820
in sync<font color="#E5E5E5"> and so</font><font color="#CCCCCC"> I would like</font><font color="#E5E5E5"> to introduce</font>

63
00:03:03,570 --> 00:03:08,940
<font color="#CCCCCC">g-dubs my skill rewind</font><font color="#E5E5E5"> that's new tool</font>

64
00:03:05,820 --> 00:03:13,650
<font color="#CCCCCC">that does just that what it allows us</font><font color="#E5E5E5"> to</font>

65
00:03:08,940 --> 00:03:16,740
<font color="#CCCCCC">do is given a partitioned</font><font color="#E5E5E5"> or split brain</font>

66
00:03:13,650 --> 00:03:19,970
scenario<font color="#E5E5E5"> I'd be able to take one server</font>

67
00:03:16,740 --> 00:03:23,220
at<font color="#E5E5E5"> a time and connect it into the</font>

68
00:03:19,970 --> 00:03:25,350
healthy cluster and it will be fine

69
00:03:23,220 --> 00:03:27,390
it will be<font color="#E5E5E5"> fixed it will be replicating</font>

70
00:03:25,350 --> 00:03:30,540
the<font color="#E5E5E5"> cache will be warm and</font><font color="#CCCCCC"> will will be</font>

71
00:03:27,390 --> 00:03:32,488
<font color="#E5E5E5">happy so I'd like</font><font color="#CCCCCC"> to illustrate how</font><font color="#E5E5E5"> this</font>

72
00:03:30,540 --> 00:03:35,429
works this<font color="#E5E5E5"> is this is the session</font>

73
00:03:32,489 --> 00:03:38,700
<font color="#E5E5E5">illustrates the steps to making this</font>

74
00:03:35,430 --> 00:03:40,860
work<font color="#E5E5E5"> so there are a few components to</font>

75
00:03:38,700 --> 00:03:44,130
this<font color="#E5E5E5"> solution and one of them the first</font>

76
00:03:40,860 --> 00:03:48,330
<font color="#E5E5E5">is</font><font color="#CCCCCC"> GE</font><font color="#E5E5E5"> ID so we run magical Oracle MySQL</font>

77
00:03:44,130 --> 00:03:51,540
GE IDs and<font color="#CCCCCC"> GE IDs</font><font color="#E5E5E5"> have many properties</font>

78
00:03:48,330 --> 00:03:53,930
<font color="#CCCCCC">I'd like to illustrate</font><font color="#E5E5E5"> one of them one</font>

79
00:03:51,540 --> 00:03:59,429
property of GE ID is<font color="#E5E5E5"> that each server</font>

80
00:03:53,930 --> 00:04:03,239
remembers forever<font color="#CCCCCC"> the entire</font><font color="#E5E5E5"> change log</font>

81
00:03:59,430 --> 00:04:06,930
or the<font color="#CCCCCC"> entire set of GE IDs that have</font>

82
00:04:03,239 --> 00:04:11,430
ever been<font color="#E5E5E5"> applied on that server right</font>

83
00:04:06,930 --> 00:04:14,220
<font color="#E5E5E5">so you can expect these numbers to be in</font>

84
00:04:11,430 --> 00:04:17,910
the<font color="#CCCCCC"> millions in milliards</font><font color="#E5E5E5"> whatever right</font>

85
00:04:14,220 --> 00:04:20,660
<font color="#CCCCCC">a server has its own</font><font color="#E5E5E5"> UUID and</font><font color="#CCCCCC"> then it</font>

86
00:04:17,910 --> 00:04:23,910
says yeah I have GD IDs<font color="#CCCCCC"> 1 to something</font>

87
00:04:20,660 --> 00:04:26,130
but then as bile in binary logs get

88
00:04:23,910 --> 00:04:28,560
purged<font color="#CCCCCC"> the server also</font><font color="#E5E5E5"> maintains the</font>

89
00:04:26,130 --> 00:04:30,630
<font color="#E5E5E5">identities of the</font><font color="#CCCCCC"> deities that have been</font>

90
00:04:28,560 --> 00:04:31,260
thrown away<font color="#CCCCCC"> just for the records but it</font>

91
00:04:30,630 --> 00:04:32,960
<font color="#CCCCCC">can</font>

92
00:04:31,260 --> 00:04:35,460
them in the records<font color="#E5E5E5"> it knows that</font>

93
00:04:32,960 --> 00:04:36,960
<font color="#E5E5E5">sometime in</font><font color="#CCCCCC"> the future</font><font color="#E5E5E5"> it has applied</font>

94
00:04:35,460 --> 00:04:41,340
those entries and they're not here<font color="#E5E5E5"> today</font>

95
00:04:36,960 --> 00:04:44,299
<font color="#CCCCCC">but</font><font color="#E5E5E5"> I know about them this property is</font>

96
00:04:41,340 --> 00:04:48,330
very helpful<font color="#E5E5E5"> to us see let's look at the</font>

97
00:04:44,300 --> 00:04:51,780
<font color="#E5E5E5">the cluster before</font><font color="#CCCCCC"> the outage</font><font color="#E5E5E5"> and then</font>

98
00:04:48,330 --> 00:04:54,060
at the to split brains<font color="#E5E5E5"> so before the</font>

99
00:04:51,780 --> 00:04:59,460
<font color="#CCCCCC">average the master applied some binary</font>

100
00:04:54,060 --> 00:05:02,220
<font color="#CCCCCC">logs and after the spirit bring the the</font>

101
00:04:59,460 --> 00:05:04,229
old master applied some extra bed<font color="#E5E5E5"> rights</font>

102
00:05:02,220 --> 00:05:06,750
<font color="#E5E5E5">right those</font><font color="#CCCCCC"> are</font><font color="#E5E5E5"> the ones we want to get</font>

103
00:05:04,230 --> 00:05:09,930
rid of and the newly promoted master

104
00:05:06,750 --> 00:05:14,130
took normal production<font color="#CCCCCC"> traffic</font><font color="#E5E5E5"> it's the</font>

105
00:05:09,930 --> 00:05:16,350
green one<font color="#CCCCCC"> over</font><font color="#E5E5E5"> here and both keep track</font>

106
00:05:14,130 --> 00:05:19,200
of exactly what has been<font color="#E5E5E5"> applied and it</font>

107
00:05:16,350 --> 00:05:23,190
turns out I<font color="#E5E5E5"> can mathematically subtract</font>

108
00:05:19,200 --> 00:05:26,070
<font color="#E5E5E5">do this -</font><font color="#CCCCCC"> they -</font><font color="#E5E5E5"> this to get the</font>

109
00:05:23,190 --> 00:05:28,260
identities of the<font color="#CCCCCC"> GD</font><font color="#E5E5E5"> ID entries that</font>

110
00:05:26,070 --> 00:05:31,890
have<font color="#E5E5E5"> been applied</font><font color="#CCCCCC"> on this server and not</font>

111
00:05:28,260 --> 00:05:34,140
on this<font color="#E5E5E5"> server</font><font color="#CCCCCC"> so the new master used to</font>

112
00:05:31,890 --> 00:05:37,710
replicate<font color="#E5E5E5"> from that one and</font><font color="#CCCCCC"> so all this</font>

113
00:05:34,140 --> 00:05:41,789
history<font color="#E5E5E5"> is valid but then we just need</font>

114
00:05:37,710 --> 00:05:44,159
to identify what parts are<font color="#CCCCCC"> I</font><font color="#E5E5E5"> read GD IDs</font>

115
00:05:41,790 --> 00:05:45,000
<font color="#CCCCCC">so basically it's a substrate subtract</font>

116
00:05:44,160 --> 00:05:47,930
right<font color="#E5E5E5"> I do</font>

117
00:05:45,000 --> 00:05:51,960
GD ID<font color="#CCCCCC"> executed</font><font color="#E5E5E5"> of this master - this one</font>

118
00:05:47,930 --> 00:05:55,740
<font color="#E5E5E5">this is the set of Jerry IDs that are</font>

119
00:05:51,960 --> 00:06:00,299
the offensive entries right so now we

120
00:05:55,740 --> 00:06:02,670
know which transactions were<font color="#CCCCCC"> bad the</font>

121
00:06:00,300 --> 00:06:04,620
next<font color="#CCCCCC"> thing is that we're using</font><font color="#E5E5E5"> row based</font>

122
00:06:02,670 --> 00:06:06,870
<font color="#E5E5E5">replication</font><font color="#CCCCCC"> and with Robin certification</font>

123
00:06:04,620 --> 00:06:09,960
and with<font color="#E5E5E5"> bin log row image equals full</font>

124
00:06:06,870 --> 00:06:12,210
we have this thing<font color="#CCCCCC"> in the</font><font color="#E5E5E5"> binary log</font>

125
00:06:09,960 --> 00:06:15,479
swear if<font color="#CCCCCC"> you run my</font><font color="#E5E5E5"> still being log and</font>

126
00:06:12,210 --> 00:06:18,870
variables etc each entry in<font color="#CCCCCC"> the binary</font>

127
00:06:15,480 --> 00:06:22,320
<font color="#CCCCCC">log</font><font color="#E5E5E5"> each update delete and</font><font color="#CCCCCC"> insert tells</font>

128
00:06:18,870 --> 00:06:24,390
you the entire image of the row before

129
00:06:22,320 --> 00:06:27,150
the change<font color="#E5E5E5"> and the entire image of the</font>

130
00:06:24,390 --> 00:06:29,820
row<font color="#E5E5E5"> after the change so for an update</font>

131
00:06:27,150 --> 00:06:31,710
that<font color="#E5E5E5"> means all the columns before the</font>

132
00:06:29,820 --> 00:06:33,510
change are listed with<font color="#CCCCCC"> our values all</font>

133
00:06:31,710 --> 00:06:35,430
the<font color="#CCCCCC"> columns</font><font color="#E5E5E5"> after the change</font><font color="#CCCCCC"> risk with</font>

134
00:06:33,510 --> 00:06:39,200
<font color="#CCCCCC">our values the same</font><font color="#E5E5E5"> for instance</font><font color="#CCCCCC"> in</font>

135
00:06:35,430 --> 00:06:42,630
<font color="#CCCCCC">delete and that makes it possible to</font>

136
00:06:39,200 --> 00:06:44,068
<font color="#E5E5E5">know what you need to revert if you just</font>

137
00:06:42,630 --> 00:06:47,710
replace<font color="#E5E5E5"> these</font><font color="#CCCCCC"> two</font>

138
00:06:44,069 --> 00:06:50,349
you basically revert the operation<font color="#E5E5E5"> now</font>

139
00:06:47,710 --> 00:06:52,719
we don't<font color="#E5E5E5"> need to</font><font color="#CCCCCC"> do that by hand maria</font>

140
00:06:50,349 --> 00:06:56,110
<font color="#CCCCCC">de Bie has the</font><font color="#E5E5E5"> flashback option this is</font>

141
00:06:52,720 --> 00:06:59,530
<font color="#CCCCCC">a contribution</font><font color="#E5E5E5"> by Alibaba contributed</font>

142
00:06:56,110 --> 00:07:02,650
<font color="#E5E5E5">many years ago</font><font color="#CCCCCC"> and incorporated by</font><font color="#E5E5E5"> Maria</font>

143
00:06:59,530 --> 00:07:05,590
<font color="#CCCCCC">DB so in</font><font color="#E5E5E5"> innovative is my</font><font color="#CCCCCC"> skill bin log</font>

144
00:07:02,650 --> 00:07:08,138
binary you have this flash<font color="#E5E5E5"> - flash</font><font color="#CCCCCC"> map</font>

145
00:07:05,590 --> 00:07:10,090
<font color="#E5E5E5">option and what it does is</font><font color="#CCCCCC"> as follows</font>

146
00:07:08,139 --> 00:07:12,250
imagine this is the<font color="#E5E5E5"> normal binary</font><font color="#CCCCCC"> loop</font>

147
00:07:10,090 --> 00:07:16,119
right<font color="#E5E5E5"> you have inserts you have updates</font>

148
00:07:12,250 --> 00:07:18,190
<font color="#E5E5E5">another insert a delete if you run my</font>

149
00:07:16,120 --> 00:07:20,080
skill<font color="#CCCCCC"> being log that's what you'll</font><font color="#E5E5E5"> see</font>

150
00:07:18,190 --> 00:07:22,360
<font color="#CCCCCC">if you run less you're being</font><font color="#E5E5E5"> log - -</font>

151
00:07:20,080 --> 00:07:25,120
<font color="#CCCCCC">flashback what you'll get is the image</font>

152
00:07:22,360 --> 00:07:28,740
on the<font color="#CCCCCC"> right</font><font color="#E5E5E5"> it's the reverse order of</font>

153
00:07:25,120 --> 00:07:32,229
<font color="#E5E5E5">ante statements right it's the undo log</font>

154
00:07:28,740 --> 00:07:34,780
<font color="#E5E5E5">the first insert here is the ante</font>

155
00:07:32,229 --> 00:07:36,849
statement of<font color="#E5E5E5"> this delete this delete is</font>

156
00:07:34,780 --> 00:07:40,059
the<font color="#CCCCCC"> ante statement of this insert this</font>

157
00:07:36,849 --> 00:07:43,900
<font color="#E5E5E5">is the ante of these updates etc etc so</font>

158
00:07:40,060 --> 00:07:46,840
<font color="#CCCCCC">if I</font><font color="#E5E5E5"> apply this binary log and then this</font>

159
00:07:43,900 --> 00:07:49,810
I've<font color="#E5E5E5"> I've done</font><font color="#CCCCCC"> nothing in</font><font color="#E5E5E5"> effect right</font>

160
00:07:46,840 --> 00:07:53,198
<font color="#E5E5E5">I've notified all the operation and</font>

161
00:07:49,810 --> 00:07:56,530
that's the basis<font color="#CCCCCC"> for our rewind tool so</font>

162
00:07:53,199 --> 00:07:59,409
what we have so<font color="#CCCCCC"> far GED tells us what</font>

163
00:07:56,530 --> 00:08:03,309
transactions are bad flashback<font color="#E5E5E5"> gives us</font>

164
00:07:59,409 --> 00:08:05,050
the mechanism to undo transactions but

165
00:08:03,310 --> 00:08:06,430
we're still missing a lot here<font color="#E5E5E5"> we're</font>

166
00:08:05,050 --> 00:08:08,289
<font color="#E5E5E5">missing</font><font color="#CCCCCC"> the connection</font><font color="#E5E5E5"> between the GE</font>

167
00:08:06,430 --> 00:08:11,169
80s and the<font color="#CCCCCC"> binary logs and the entries</font>

168
00:08:08,289 --> 00:08:15,219
<font color="#CCCCCC">and</font><font color="#E5E5E5"> the entities in the binary log so</font>

169
00:08:11,169 --> 00:08:16,930
let's look at this again<font color="#E5E5E5"> we have we have</font>

170
00:08:15,219 --> 00:08:18,819
the two masters<font color="#E5E5E5"> and one has they've</font>

171
00:08:16,930 --> 00:08:22,270
urged from the other we<font color="#E5E5E5"> want to take</font>

172
00:08:18,819 --> 00:08:24,219
that bad master<font color="#CCCCCC"> that this contaminated</font>

173
00:08:22,270 --> 00:08:24,698
master so to speak and move it back<font color="#E5E5E5"> in</font>

174
00:08:24,219 --> 00:08:27,340
time

175
00:08:24,699 --> 00:08:30,610
ideally we would move<font color="#E5E5E5"> it to</font><font color="#CCCCCC"> exactly the</font>

176
00:08:27,340 --> 00:08:33,159
point of the split<font color="#E5E5E5"> but it is also valid</font>

177
00:08:30,610 --> 00:08:36,339
to move it a<font color="#E5E5E5"> little farther in time</font>

178
00:08:33,159 --> 00:08:39,760
<font color="#E5E5E5">right because at any point</font><font color="#CCCCCC"> on this line</font>

179
00:08:36,339 --> 00:08:41,829
<font color="#E5E5E5">is consistent it's</font><font color="#CCCCCC"> okay we waste a</font><font color="#E5E5E5"> bit</font>

180
00:08:39,760 --> 00:08:45,880
of<font color="#E5E5E5"> effort but it's</font><font color="#CCCCCC"> okay if we take it a</font>

181
00:08:41,828 --> 00:08:48,149
little<font color="#CCCCCC"> further back in time</font><font color="#E5E5E5"> now if we</font>

182
00:08:45,880 --> 00:08:53,350
look<font color="#E5E5E5"> at</font><font color="#CCCCCC"> the binary logs on the</font>

183
00:08:48,149 --> 00:08:55,240
<font color="#E5E5E5">contaminated master those bad GE IDs are</font>

184
00:08:53,350 --> 00:08:57,699
somewhere within the binary logs right

185
00:08:55,240 --> 00:09:01,109
<font color="#E5E5E5">they could be within a single binary</font>

186
00:08:57,699 --> 00:09:05,229
or<font color="#E5E5E5"> between two or</font><font color="#CCCCCC"> three or whatever</font>

187
00:09:01,109 --> 00:09:06,999
<font color="#E5E5E5">turns out it's pretty easy to</font><font color="#CCCCCC"> identify</font>

188
00:09:05,230 --> 00:09:10,089
where these entries<font color="#E5E5E5"> are in</font><font color="#CCCCCC"> the binary</font>

189
00:09:06,999 --> 00:09:12,790
<font color="#E5E5E5">log see every binary log has a header</font>

190
00:09:10,089 --> 00:09:14,499
that<font color="#CCCCCC"> says</font><font color="#E5E5E5"> previous</font><font color="#CCCCCC"> video so at the</font>

191
00:09:12,790 --> 00:09:17,618
<font color="#E5E5E5">beginning of every binary log it says</font>

192
00:09:14,499 --> 00:09:20,889
<font color="#E5E5E5">what what have been all the</font><font color="#CCCCCC"> gtas thus</font>

193
00:09:17,619 --> 00:09:22,389
far<font color="#E5E5E5"> right this is my history</font><font color="#CCCCCC"> and now I'm</font>

194
00:09:20,889 --> 00:09:24,040
a new<font color="#CCCCCC"> binary log and</font><font color="#E5E5E5"> this is what's</font>

195
00:09:22,389 --> 00:09:26,079
going to happen<font color="#E5E5E5"> next</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> if you take all</font>

196
00:09:24,040 --> 00:09:27,608
the existing<font color="#E5E5E5"> binary logs and you know</font>

197
00:09:26,079 --> 00:09:29,469
<font color="#CCCCCC">parts the headers for mail all of them</font>

198
00:09:27,609 --> 00:09:32,139
you<font color="#E5E5E5"> can slice</font><font color="#CCCCCC"> it and you you know</font>

199
00:09:29,470 --> 00:09:36,579
<font color="#CCCCCC">exactly what GE</font><font color="#E5E5E5"> IDs are executed within</font>

200
00:09:32,139 --> 00:09:38,970
<font color="#E5E5E5">each and every binary log and so we're</font>

201
00:09:36,579 --> 00:09:42,819
able<font color="#E5E5E5"> to figure out</font><font color="#CCCCCC"> that the badge it is</font>

202
00:09:38,970 --> 00:09:46,569
<font color="#CCCCCC">our we then say these two</font><font color="#E5E5E5"> binary log 62</font>

203
00:09:42,819 --> 00:09:48,729
and 63 and so on the<font color="#E5E5E5"> next step is we</font>

204
00:09:46,569 --> 00:09:51,519
identify the badge<font color="#E5E5E5"> LEDs we know where we</font>

205
00:09:48,730 --> 00:09:53,980
are<font color="#E5E5E5"> where they</font><font color="#CCCCCC"> are in the binary</font><font color="#E5E5E5"> logs we</font>

206
00:09:51,519 --> 00:09:56,199
generate<font color="#CCCCCC"> we use masculine log - -</font>

207
00:09:53,980 --> 00:09:58,959
flashback to generate the anti binary

208
00:09:56,199 --> 00:10:01,508
log of these two binary logs<font color="#E5E5E5"> right we</font>

209
00:09:58,959 --> 00:10:03,939
generate the anti binary log of 6<font color="#E5E5E5"> to 3</font>

210
00:10:01,509 --> 00:10:07,059
and the anti binary log of 6 to 2 and

211
00:10:03,939 --> 00:10:11,469
then we<font color="#CCCCCC"> apply</font><font color="#E5E5E5"> them to</font><font color="#CCCCCC"> my</font><font color="#E5E5E5"> skill does that</font>

212
00:10:07,059 --> 00:10:13,839
make sense<font color="#E5E5E5"> not so simple</font><font color="#CCCCCC"> because Maria</font>

213
00:10:11,470 --> 00:10:18,730
<font color="#CCCCCC">De Beers my skill be log has no notion</font>

214
00:10:13,839 --> 00:10:21,519
<font color="#E5E5E5">of my skill</font><font color="#CCCCCC"> GID</font><font color="#E5E5E5"> it's a different product</font>

215
00:10:18,730 --> 00:10:23,609
<font color="#CCCCCC">it doesn't</font><font color="#E5E5E5"> speak my skill</font><font color="#CCCCCC"> G ready but we</font>

216
00:10:21,519 --> 00:10:27,879
need<font color="#E5E5E5"> might still</font><font color="#CCCCCC"> generate it to tell</font><font color="#E5E5E5"> us</font>

217
00:10:23,609 --> 00:10:29,709
<font color="#E5E5E5">what went wrong and so we need to</font><font color="#CCCCCC"> do a</font>

218
00:10:27,879 --> 00:10:32,410
<font color="#E5E5E5">little bit of hacking like this simple</font>

219
00:10:29,709 --> 00:10:34,388
<font color="#CCCCCC">or concede strip which I clearly don't</font>

220
00:10:32,410 --> 00:10:37,689
need to explain<font color="#E5E5E5"> it's Suffolk explanatory</font>

221
00:10:34,389 --> 00:10:40,569
and we do a little bit<font color="#E5E5E5"> of hacking we</font>

222
00:10:37,689 --> 00:10:43,299
inject some<font color="#CCCCCC"> GDS and we throw that back</font>

223
00:10:40,569 --> 00:10:46,829
into<font color="#CCCCCC"> mice QL and</font><font color="#E5E5E5"> we literally move my</font>

224
00:10:43,299 --> 00:10:51,689
squirrel back in time so far so good

225
00:10:46,829 --> 00:10:55,329
yes not<font color="#E5E5E5"> so good we moved back in time</font>

226
00:10:51,689 --> 00:10:58,299
<font color="#CCCCCC">the big question right now is where are</font>

227
00:10:55,329 --> 00:11:01,179
<font color="#E5E5E5">we is this the Renaissance is this</font>

228
00:10:58,299 --> 00:11:03,850
differential<font color="#E5E5E5"> revolution you know all</font>

229
00:11:01,179 --> 00:11:06,309
these movies you<font color="#CCCCCC"> move back</font><font color="#E5E5E5"> in time you</font>

230
00:11:03,850 --> 00:11:07,869
need to<font color="#E5E5E5"> figure out where you are we are</font>

231
00:11:06,309 --> 00:11:10,990
<font color="#CCCCCC">not in a good position right now</font><font color="#E5E5E5"> because</font>

232
00:11:07,869 --> 00:11:13,029
we can't<font color="#E5E5E5"> just join back the replication</font>

233
00:11:10,990 --> 00:11:15,760
<font color="#E5E5E5">streamers yet if we look</font><font color="#CCCCCC"> at the</font><font color="#E5E5E5"> behind</font>

234
00:11:13,029 --> 00:11:18,760
<font color="#CCCCCC">area</font><font color="#E5E5E5"> logs right now on that</font><font color="#CCCCCC"> you know</font>

235
00:11:15,760 --> 00:11:23,200
demoted master we had those normal

236
00:11:18,760 --> 00:11:26,890
entries<font color="#E5E5E5"> we then had those bad entries we</font>

237
00:11:23,200 --> 00:11:29,950
just applied more weird<font color="#E5E5E5"> entries right</font>

238
00:11:26,890 --> 00:11:32,350
the<font color="#CCCCCC"> dataset is consistent with</font><font color="#E5E5E5"> some</font>

239
00:11:29,950 --> 00:11:35,920
<font color="#CCCCCC">point in time</font><font color="#E5E5E5"> but</font><font color="#CCCCCC"> the binary logs do not</font>

240
00:11:32,350 --> 00:11:39,279
agree<font color="#E5E5E5"> the</font><font color="#CCCCCC"> G di di executed on that</font>

241
00:11:35,920 --> 00:11:41,079
<font color="#E5E5E5">master thinks it's it's someplace</font>

242
00:11:39,279 --> 00:11:44,170
completely<font color="#E5E5E5"> different like something</font><font color="#CCCCCC"> is</font>

243
00:11:41,080 --> 00:11:47,370
really<font color="#E5E5E5"> really messed up right</font><font color="#CCCCCC"> now</font><font color="#E5E5E5"> and so</font>

244
00:11:44,170 --> 00:11:49,959
now what we<font color="#CCCCCC"> need to do is to match this</font>

245
00:11:47,370 --> 00:11:50,830
with the data set we<font color="#CCCCCC"> need to tell our</font>

246
00:11:49,959 --> 00:11:54,849
<font color="#CCCCCC">time machine</font>

247
00:11:50,830 --> 00:11:58,270
yes it's now 1995 right you've jumped

248
00:11:54,850 --> 00:11:59,890
back in time to this<font color="#CCCCCC"> and</font><font color="#E5E5E5"> that date and</font>

249
00:11:58,270 --> 00:12:02,680
we turns out we can<font color="#CCCCCC"> actually do that</font>

250
00:11:59,890 --> 00:12:05,020
because we<font color="#CCCCCC"> roll back</font><font color="#E5E5E5"> like say we roll</font>

251
00:12:02,680 --> 00:12:07,300
<font color="#E5E5E5">back to binary</font><font color="#CCCCCC"> logs</font><font color="#E5E5E5"> we know what G</font><font color="#CCCCCC"> dat</font>

252
00:12:05,020 --> 00:12:09,069
entries are in<font color="#E5E5E5"> these binary logs we can</font>

253
00:12:07,300 --> 00:12:11,649
<font color="#E5E5E5">compute the difference between the</font>

254
00:12:09,070 --> 00:12:14,680
current state minus the entries in the

255
00:12:11,649 --> 00:12:18,790
binary<font color="#CCCCCC"> log and predict</font><font color="#E5E5E5"> and project what</font>

256
00:12:14,680 --> 00:12:21,989
<font color="#E5E5E5">would be the time ETA where we land</font><font color="#CCCCCC"> does</font>

257
00:12:18,790 --> 00:12:25,209
that make sense<font color="#CCCCCC"> okay before we continue</font>

258
00:12:21,990 --> 00:12:28,450
and at this point at this point<font color="#E5E5E5"> we can</font>

259
00:12:25,209 --> 00:12:31,540
just<font color="#E5E5E5"> do reset master and set J dat</font>

260
00:12:28,450 --> 00:12:35,079
purged<font color="#CCCCCC"> into that value</font><font color="#E5E5E5"> and we like we</font>

261
00:12:31,540 --> 00:12:38,410
erase my skills memory<font color="#E5E5E5"> and it thinks</font>

262
00:12:35,079 --> 00:12:42,040
it's now in 1995 and it's up and<font color="#E5E5E5"> running</font>

263
00:12:38,410 --> 00:12:43,899
<font color="#E5E5E5">and it's</font><font color="#CCCCCC"> able to change master to master</font>

264
00:12:42,040 --> 00:12:45,969
o to position equals<font color="#CCCCCC"> 1 join the</font>

265
00:12:43,899 --> 00:12:47,860
replication stream a little bit of

266
00:12:45,970 --> 00:12:50,079
replication lag whatever<font color="#E5E5E5"> but then it's</font>

267
00:12:47,860 --> 00:12:56,470
healthy it<font color="#E5E5E5"> can replicate and it's and</font>

268
00:12:50,079 --> 00:12:58,180
it's fine it's in sync<font color="#CCCCCC"> okay a</font><font color="#E5E5E5"> few</font>

269
00:12:56,470 --> 00:13:01,990
limitations<font color="#E5E5E5"> but we have more to talk</font>

270
00:12:58,180 --> 00:13:05,199
<font color="#CCCCCC">about so limitations are you cannot</font>

271
00:13:01,990 --> 00:13:07,120
rewind<font color="#CCCCCC"> the DL it can be done manually it</font>

272
00:13:05,200 --> 00:13:09,100
would be painful<font color="#CCCCCC"> but if someone altered</font>

273
00:13:07,120 --> 00:13:12,910
<font color="#E5E5E5">table during that time</font><font color="#CCCCCC"> that doesn't rule</font>

274
00:13:09,100 --> 00:13:15,430
that it's it's a mess<font color="#CCCCCC"> my skew L end</font>

275
00:13:12,910 --> 00:13:18,100
flashback<font color="#CCCCCC"> neither</font><font color="#E5E5E5"> support JSON or points</font>

276
00:13:15,430 --> 00:13:21,520
<font color="#E5E5E5">or the newer data types so</font><font color="#CCCCCC"> that won't</font>

277
00:13:18,100 --> 00:13:24,420
<font color="#E5E5E5">work</font><font color="#CCCCCC"> we do</font><font color="#E5E5E5"> roll back a little bit more</font>

278
00:13:21,520 --> 00:13:26,459
than we need<font color="#CCCCCC"> to because we move like</font>

279
00:13:24,420 --> 00:13:28,769
<font color="#E5E5E5">we roll that complete binary looks it's</font>

280
00:13:26,459 --> 00:13:31,290
much more convenient<font color="#CCCCCC"> and</font><font color="#E5E5E5"> I think a bit</font>

281
00:13:28,769 --> 00:13:33,450
safer to do that but then it it gets us

282
00:13:31,290 --> 00:13:37,709
farther<font color="#E5E5E5"> back in time than we strictly</font>

283
00:13:33,450 --> 00:13:40,170
<font color="#E5E5E5">need right we we go way back which means</font>

284
00:13:37,709 --> 00:13:41,819
we do apply a<font color="#CCCCCC"> lot</font><font color="#E5E5E5"> of transactions that</font>

285
00:13:40,170 --> 00:13:44,310
we don't really need<font color="#E5E5E5"> to do apply</font><font color="#CCCCCC"> and</font>

286
00:13:41,820 --> 00:13:48,990
<font color="#CCCCCC">then we need to</font><font color="#E5E5E5"> reapply them so it takes</font>

287
00:13:44,310 --> 00:13:52,109
more time<font color="#CCCCCC"> and currently that</font><font color="#E5E5E5"> tool runs</font>

288
00:13:48,990 --> 00:13:53,910
on each and<font color="#E5E5E5"> every server but yesterday I</font>

289
00:13:52,110 --> 00:13:59,490
got<font color="#E5E5E5"> some nice comments on how</font><font color="#CCCCCC"> that can</font>

290
00:13:53,910 --> 00:14:01,860
be<font color="#E5E5E5"> improved so the big question</font><font color="#CCCCCC"> now is</font>

291
00:13:59,490 --> 00:14:03,389
this look we took two different<font color="#E5E5E5"> tools</font>

292
00:14:01,860 --> 00:14:05,070
<font color="#CCCCCC">they don't talk</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> each other</font><font color="#E5E5E5"> and don't</font>

293
00:14:03,389 --> 00:14:06,930
<font color="#E5E5E5">speak the same language</font><font color="#CCCCCC"> we have</font><font color="#E5E5E5"> Oracle</font>

294
00:14:05,070 --> 00:14:10,079
and<font color="#CCCCCC"> GPS we have flash but it doesn't</font>

295
00:14:06,930 --> 00:14:13,229
talk<font color="#CCCCCC"> about unities we threw in some</font>

296
00:14:10,079 --> 00:14:15,060
macaroni<font color="#E5E5E5"> said in orc script to make that</font>

297
00:14:13,230 --> 00:14:17,790
look as if they<font color="#CCCCCC"> talk to</font><font color="#E5E5E5"> each other</font>

298
00:14:15,060 --> 00:14:19,800
through that<font color="#E5E5E5"> in my skill and then did</font>

299
00:14:17,790 --> 00:14:21,719
some mathematical computation<font color="#CCCCCC"> to predict</font>

300
00:14:19,800 --> 00:14:23,490
the time<font color="#CCCCCC"> at which we will land and say</font>

301
00:14:21,720 --> 00:14:27,449
yes the data matches that time

302
00:14:23,490 --> 00:14:31,250
does that make<font color="#CCCCCC"> you very confident would</font>

303
00:14:27,449 --> 00:14:36,449
you<font color="#CCCCCC"> run this in production so sure</font>

304
00:14:31,250 --> 00:14:38,790
<font color="#E5E5E5">whatever</font><font color="#CCCCCC"> so yeah we actually have this</font>

305
00:14:36,449 --> 00:14:40,800
being tested in production continuously

306
00:14:38,790 --> 00:14:42,349
daily as we speak right<font color="#CCCCCC"> now</font><font color="#E5E5E5"> this is</font>

307
00:14:40,800 --> 00:14:44,910
being<font color="#E5E5E5"> tested in production and</font>

308
00:14:42,350 --> 00:14:45,449
continuously reporting success or

309
00:14:44,910 --> 00:14:48,540
failure

310
00:14:45,449 --> 00:14:52,439
hopefully success<font color="#E5E5E5"> so I'd like</font><font color="#CCCCCC"> to</font>

311
00:14:48,540 --> 00:14:55,469
illustrate<font color="#E5E5E5"> how this works</font><font color="#CCCCCC"> the basic idea</font>

312
00:14:52,440 --> 00:14:58,589
<font color="#CCCCCC">is that ideally I would like</font><font color="#E5E5E5"> check some</font>

313
00:14:55,470 --> 00:15:01,860
of<font color="#E5E5E5"> the data on the server do something</font>

314
00:14:58,589 --> 00:15:04,260
bad rewind<font color="#CCCCCC"> check some the data</font><font color="#E5E5E5"> again and</font>

315
00:15:01,860 --> 00:15:07,410
would find the exact same<font color="#CCCCCC"> checksum</font><font color="#E5E5E5"> make</font>

316
00:15:04,260 --> 00:15:09,779
sense<font color="#CCCCCC"> there's two char two problems with</font>

317
00:15:07,410 --> 00:15:11,250
that first my data set is to be like

318
00:15:09,779 --> 00:15:13,230
checks on in the<font color="#CCCCCC"> entire dataset would</font>

319
00:15:11,250 --> 00:15:16,230
<font color="#E5E5E5">take days that's not very friendly for</font>

320
00:15:13,230 --> 00:15:17,610
testing so<font color="#CCCCCC"> if something does go wrong it</font>

321
00:15:16,230 --> 00:15:20,100
will<font color="#CCCCCC"> taking a couple</font><font color="#E5E5E5"> of months</font><font color="#CCCCCC"> just</font><font color="#E5E5E5"> to</font>

322
00:15:17,610 --> 00:15:24,839
figure<font color="#E5E5E5"> out what happened</font><font color="#CCCCCC"> the other</font><font color="#E5E5E5"> thing</font>

323
00:15:20,100 --> 00:15:27,449
is that we're taking<font color="#E5E5E5"> a checksum right</font>

324
00:15:24,839 --> 00:15:29,760
now but how can<font color="#E5E5E5"> we predict</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> the time</font>

325
00:15:27,449 --> 00:15:33,959
travel will return us<font color="#CCCCCC"> to the exact same</font>

326
00:15:29,760 --> 00:15:37,510
point<font color="#E5E5E5"> that's that's a bit a bit of a</font>

327
00:15:33,959 --> 00:15:40,500
<font color="#E5E5E5">problem so we</font><font color="#CCCCCC"> did figure</font><font color="#E5E5E5"> this one out</font>

328
00:15:37,510 --> 00:15:42,550
very quickly it goes<font color="#E5E5E5"> like this we take a</font>

329
00:15:40,500 --> 00:15:44,290
replica right it's a testing replica

330
00:15:42,550 --> 00:15:46,000
it's not part of<font color="#CCCCCC"> production</font><font color="#E5E5E5"> but it's</font><font color="#CCCCCC"> a</font>

331
00:15:44,290 --> 00:15:49,270
it's it's<font color="#E5E5E5"> a replication in the cluster</font>

332
00:15:46,000 --> 00:15:52,120
<font color="#E5E5E5">we</font><font color="#CCCCCC"> stop replication we issue a change</font>

333
00:15:49,270 --> 00:15:53,920
master<font color="#CCCCCC"> - which resets the</font><font color="#E5E5E5"> relay load it</font>

334
00:15:52,120 --> 00:15:56,380
clears the relay logs<font color="#E5E5E5"> we rotate it into</font>

335
00:15:53,920 --> 00:15:59,290
<font color="#E5E5E5">a new related we</font><font color="#CCCCCC"> flash the binary logs</font>

336
00:15:56,380 --> 00:16:01,360
<font color="#CCCCCC">we rotate it into a new binary</font><font color="#E5E5E5"> dog right</font>

337
00:15:59,290 --> 00:16:07,000
everything is clean<font color="#E5E5E5"> we call this point</font>

338
00:16:01,360 --> 00:16:10,060
zero we grab<font color="#E5E5E5"> 30 minutes 30 seconds worth</font>

339
00:16:07,000 --> 00:16:12,580
of replication from<font color="#CCCCCC"> the master</font><font color="#E5E5E5"> from</font>

340
00:16:10,060 --> 00:16:16,199
production but we<font color="#E5E5E5"> don't apply it we just</font>

341
00:16:12,580 --> 00:16:19,240
run the<font color="#E5E5E5"> SDIO thread not the</font><font color="#CCCCCC"> ESCO</font><font color="#E5E5E5"> thread</font>

342
00:16:16,200 --> 00:16:21,220
now our relay logs are full with real

343
00:16:19,240 --> 00:16:24,070
actual production<font color="#E5E5E5"> 30 seconds worth of</font>

344
00:16:21,220 --> 00:16:25,990
data the<font color="#E5E5E5"> next thing we do is that we</font>

345
00:16:24,070 --> 00:16:28,390
parse this relay dose and figure out

346
00:16:25,990 --> 00:16:31,030
<font color="#E5E5E5">what tables are actually being affected</font>

347
00:16:28,390 --> 00:16:33,310
in these<font color="#E5E5E5"> 30 seconds these are not all</font><font color="#CCCCCC"> of</font>

348
00:16:31,030 --> 00:16:35,110
<font color="#CCCCCC">Gibbs tables we can reduce the problem</font>

349
00:16:33,310 --> 00:16:36,819
by only<font color="#E5E5E5"> you know we don't need to</font><font color="#CCCCCC"> check</font>

350
00:16:35,110 --> 00:16:39,820
some tables that aren't the<font color="#CCCCCC"> ineffective</font>

351
00:16:36,820 --> 00:16:43,500
right now<font color="#CCCCCC"> and so we analyze the tables</font>

352
00:16:39,820 --> 00:16:46,240
that<font color="#E5E5E5"> that's also too big we only take</font>

353
00:16:43,500 --> 00:16:49,000
reasonably small tables<font color="#E5E5E5"> and one random</font>

354
00:16:46,240 --> 00:16:52,180
big table which leaves us still with

355
00:16:49,000 --> 00:16:54,040
like 30<font color="#E5E5E5"> 40 50</font><font color="#CCCCCC"> tables each run which we</font>

356
00:16:52,180 --> 00:16:55,359
decide<font color="#CCCCCC"> okay these</font><font color="#E5E5E5"> are the tables being</font>

357
00:16:54,040 --> 00:16:56,980
affected<font color="#E5E5E5"> in the</font><font color="#CCCCCC"> raid levels and these</font>

358
00:16:55,360 --> 00:16:58,030
<font color="#E5E5E5">are the tables</font><font color="#CCCCCC"> we're going to</font><font color="#E5E5E5"> check</font>

359
00:16:56,980 --> 00:17:00,790
something<font color="#E5E5E5"> that's going to take like</font>

360
00:16:58,030 --> 00:17:03,120
between minutes and a<font color="#E5E5E5"> few hours to check</font>

361
00:17:00,790 --> 00:17:07,839
<font color="#CCCCCC">some all these tables</font><font color="#E5E5E5"> we take a checksum</font>

362
00:17:03,120 --> 00:17:11,109
the next thing we do we kick the SQL

363
00:17:07,839 --> 00:17:13,629
thread we apply those<font color="#CCCCCC"> changes on the</font>

364
00:17:11,109 --> 00:17:16,599
server which generates binary logs<font color="#E5E5E5"> okay</font>

365
00:17:13,630 --> 00:17:21,430
so far<font color="#E5E5E5"> good now we've applied 30 seconds</font>

366
00:17:16,599 --> 00:17:24,099
worth of<font color="#E5E5E5"> production data next</font><font color="#CCCCCC"> thing for</font>

367
00:17:21,430 --> 00:17:26,170
each of those tables we listed before<font color="#E5E5E5"> we</font>

368
00:17:24,099 --> 00:17:28,719
randomly delete<font color="#CCCCCC"> 10 rows we just do</font>

369
00:17:26,170 --> 00:17:30,970
<font color="#E5E5E5">damage right you just whatever we do</font>

370
00:17:28,720 --> 00:17:32,260
<font color="#E5E5E5">damage we try to delete rows from</font><font color="#CCCCCC"> the</font>

371
00:17:30,970 --> 00:17:35,050
end of<font color="#E5E5E5"> the table</font><font color="#CCCCCC"> because those are like</font>

372
00:17:32,260 --> 00:17:37,360
<font color="#E5E5E5">high contention rows which are likely to</font>

373
00:17:35,050 --> 00:17:40,930
<font color="#E5E5E5">be used shortly like the damage is</font>

374
00:17:37,360 --> 00:17:43,479
bigger and just to not necessarily

375
00:17:40,930 --> 00:17:45,460
strict it but for<font color="#E5E5E5"> fun in glory we also</font>

376
00:17:43,480 --> 00:17:47,320
say okay now<font color="#E5E5E5"> that we've corrupted the</font>

377
00:17:45,460 --> 00:17:51,100
data let's start<font color="#CCCCCC"> replication for fun</font><font color="#E5E5E5"> and</font>

378
00:17:47,320 --> 00:17:53,800
try to<font color="#CCCCCC"> to</font><font color="#E5E5E5"> apply even more production</font>

379
00:17:51,100 --> 00:17:56,610
for us this<font color="#E5E5E5"> like within a second or two</font>

380
00:17:53,800 --> 00:17:59,379
of these<font color="#CCCCCC"> breaks because</font><font color="#E5E5E5"> there will be a</font>

381
00:17:56,610 --> 00:18:00,790
replication problem<font color="#E5E5E5"> right we just</font>

382
00:17:59,380 --> 00:18:02,620
<font color="#E5E5E5">deleted</font><font color="#CCCCCC"> the role someone else is trying</font>

383
00:18:00,790 --> 00:18:04,360
<font color="#E5E5E5">to update replication will break we've</font>

384
00:18:02,620 --> 00:18:07,360
made a mess everything is broken and

385
00:18:04,360 --> 00:18:11,439
this is where we throw<font color="#CCCCCC"> ditch mask you'll</font>

386
00:18:07,360 --> 00:18:12,729
rewind<font color="#E5E5E5"> into the game and it fixes it</font>

387
00:18:11,440 --> 00:18:16,330
uses the algorithm<font color="#E5E5E5"> we described earlier</font>

388
00:18:12,730 --> 00:18:20,590
<font color="#E5E5E5">fixes the situation and moves us back in</font>

389
00:18:16,330 --> 00:18:24,429
time<font color="#CCCCCC"> now we intentionally rotated the</font>

390
00:18:20,590 --> 00:18:27,189
logs and we intentionally<font color="#CCCCCC"> grab an amount</font>

391
00:18:24,430 --> 00:18:30,310
a reasonable amount<font color="#E5E5E5"> of production data</font>

392
00:18:27,190 --> 00:18:33,400
that we can predict<font color="#E5E5E5"> that it</font><font color="#CCCCCC"> will return</font>

393
00:18:30,310 --> 00:18:36,220
<font color="#E5E5E5">us</font><font color="#CCCCCC"> to exactly</font><font color="#E5E5E5"> point</font><font color="#CCCCCC"> zero</font><font color="#E5E5E5"> the exact</font><font color="#CCCCCC"> point</font>

394
00:18:33,400 --> 00:18:37,900
where we took the initial checksum so

395
00:18:36,220 --> 00:18:43,060
whether our prediction was correct

396
00:18:37,900 --> 00:18:45,550
<font color="#E5E5E5">we'll</font><font color="#CCCCCC"> say now that it has rewinded us we</font>

397
00:18:43,060 --> 00:18:48,040
check some of<font color="#E5E5E5"> the tables again we expect</font>

398
00:18:45,550 --> 00:18:50,320
<font color="#E5E5E5">to find 100% match to</font><font color="#CCCCCC"> the original</font>

399
00:18:48,040 --> 00:18:53,649
checksum that we took<font color="#E5E5E5"> before</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> test</font>

400
00:18:50,320 --> 00:18:55,750
began and we know this<font color="#E5E5E5"> actually works</font>

401
00:18:53,650 --> 00:18:57,130
this<font color="#E5E5E5"> runs continuously all the time</font>

402
00:18:55,750 --> 00:18:58,930
right

403
00:18:57,130 --> 00:19:01,810
the test is complete we put the

404
00:18:58,930 --> 00:19:04,060
replication back into the<font color="#CCCCCC"> cluster it</font>

405
00:19:01,810 --> 00:19:05,950
catches<font color="#CCCCCC"> up with</font><font color="#E5E5E5"> replication lag</font><font color="#CCCCCC"> we do it</font>

406
00:19:04,060 --> 00:19:07,659
again<font color="#CCCCCC"> and again and again</font><font color="#E5E5E5"> and again and</font>

407
00:19:05,950 --> 00:19:09,010
<font color="#E5E5E5">again this gives us the confidence that</font>

408
00:19:07,660 --> 00:19:14,680
the tool is<font color="#CCCCCC"> actually doing</font><font color="#E5E5E5"> what it's</font>

409
00:19:09,010 --> 00:19:17,140
supposed<font color="#CCCCCC"> to do we don't really</font><font color="#E5E5E5"> want to</font>

410
00:19:14,680 --> 00:19:19,900
<font color="#E5E5E5">use that</font><font color="#CCCCCC"> tool</font><font color="#E5E5E5"> ever ever we don't want to</font>

411
00:19:17,140 --> 00:19:23,500
be in that<font color="#E5E5E5"> situation ever</font><font color="#CCCCCC"> again it was</font>

412
00:19:19,900 --> 00:19:25,390
<font color="#E5E5E5">nothing</font><font color="#CCCCCC"> not a good place to</font><font color="#E5E5E5"> be so we're</font>

413
00:19:23,500 --> 00:19:27,460
really<font color="#E5E5E5"> hoping to not do that we are</font>

414
00:19:25,390 --> 00:19:30,190
moving<font color="#E5E5E5"> in multiple directions to never</font>

415
00:19:27,460 --> 00:19:33,400
be<font color="#E5E5E5"> in</font><font color="#CCCCCC"> that situation again</font><font color="#E5E5E5"> to have plan</font>

416
00:19:30,190 --> 00:19:37,660
b c d e and<font color="#CCCCCC"> f to mitigate the problem</font>

417
00:19:33,400 --> 00:19:40,000
right but if we do we<font color="#E5E5E5"> expect this tool</font>

418
00:19:37,660 --> 00:19:42,520
to help<font color="#E5E5E5"> us recover a server within</font>

419
00:19:40,000 --> 00:19:45,670
<font color="#E5E5E5">minutes as opposed to many many many</font>

420
00:19:42,520 --> 00:19:48,010
hours and you<font color="#E5E5E5"> know the server is up and</font>

421
00:19:45,670 --> 00:19:50,380
<font color="#E5E5E5">the cache is warm so</font><font color="#CCCCCC"> it's</font><font color="#E5E5E5"> going to be</font>

422
00:19:48,010 --> 00:19:52,960
very<font color="#E5E5E5"> good</font><font color="#CCCCCC"> on the replication lag</font><font color="#E5E5E5"> etc so</font>

423
00:19:50,380 --> 00:19:56,140
those are<font color="#E5E5E5"> our</font><font color="#CCCCCC"> expectations that we never</font>

424
00:19:52,960 --> 00:19:58,360
expect to see again<font color="#CCCCCC"> this</font><font color="#E5E5E5"> that is right</font>

425
00:19:56,140 --> 00:20:01,030
now this<font color="#E5E5E5"> is a shell script</font><font color="#CCCCCC"> this is</font><font color="#E5E5E5"> just</font>

426
00:19:58,360 --> 00:20:03,100
a two hundred lines of shell script just

427
00:20:01,030 --> 00:20:03,720
using Oracle's<font color="#E5E5E5"> my skilled in logging</font>

428
00:20:03,100 --> 00:20:08,760
<font color="#E5E5E5">Maria the beers</font>

429
00:20:03,720 --> 00:20:11,370
being<font color="#E5E5E5"> log and some shell</font><font color="#CCCCCC"> and oak at some</font>

430
00:20:08,760 --> 00:20:13,320
point in the future<font color="#CCCCCC"> I'd like to</font>

431
00:20:11,370 --> 00:20:14,789
incorporate<font color="#E5E5E5"> that into</font><font color="#CCCCCC"> Orchestrator which</font>

432
00:20:13,320 --> 00:20:17,700
is a little bit of a problem<font color="#E5E5E5"> because</font><font color="#CCCCCC"> I'm</font>

433
00:20:14,789 --> 00:20:18,090
using external<font color="#E5E5E5"> tools to to make that</font>

434
00:20:17,700 --> 00:20:22,140
<font color="#CCCCCC">happen</font>

435
00:20:18,090 --> 00:20:26,129
and fortunately<font color="#E5E5E5"> there's</font><font color="#CCCCCC"> ongoing work I</font>

436
00:20:22,140 --> 00:20:29,669
don't know<font color="#CCCCCC"> if safe-harbor etc but I</font>

437
00:20:26,130 --> 00:20:33,150
happen to<font color="#E5E5E5"> know that this was represented</font>

438
00:20:29,669 --> 00:20:35,280
yesterday that Oracle have begun<font color="#CCCCCC"> some</font>

439
00:20:33,150 --> 00:20:37,770
work<font color="#E5E5E5"> into this so you would be able</font><font color="#CCCCCC"> to</font>

440
00:20:35,280 --> 00:20:41,039
<font color="#E5E5E5">like say what are the</font><font color="#CCCCCC"> GD entries in my</font>

441
00:20:37,770 --> 00:20:44,129
binary logs<font color="#E5E5E5"> and let's undo select undo</font>

442
00:20:41,039 --> 00:20:45,870
transaction<font color="#E5E5E5"> of a given G</font><font color="#CCCCCC"> reset so any</font>

443
00:20:44,130 --> 00:20:48,690
client could do that and<font color="#E5E5E5"> that would</font><font color="#CCCCCC"> be</font>

444
00:20:45,870 --> 00:20:50,610
<font color="#E5E5E5">really awesome so I really want to ask</font>

445
00:20:48,690 --> 00:20:54,690
Oracle to<font color="#E5E5E5"> keep on working that please</font>

446
00:20:50,610 --> 00:20:57,270
please<font color="#E5E5E5"> that would be really nice</font><font color="#CCCCCC"> and</font>

447
00:20:54,690 --> 00:21:02,270
with that I'm done<font color="#CCCCCC"> I have time for a</font>

448
00:20:57,270 --> 00:21:02,270
couple questions yes<font color="#CCCCCC"> questions</font><font color="#E5E5E5"> yes sir</font>

449
00:21:17,250 --> 00:21:22,020
what I did was rolled back everything<font color="#E5E5E5"> I</font>

450
00:21:19,380 --> 00:21:22,890
sorry<font color="#E5E5E5"> okay the question was if we have a</font>

451
00:21:22,020 --> 00:21:25,168
conflict

452
00:21:22,890 --> 00:21:26,640
<font color="#CCCCCC">what about conflict resolution if we had</font>

453
00:21:25,169 --> 00:21:30,150
two transaction is updating the<font color="#E5E5E5"> same</font>

454
00:21:26,640 --> 00:21:32,520
table<font color="#E5E5E5"> what what I did is I magically</font>

455
00:21:30,150 --> 00:21:35,220
brought up an image<font color="#CCCCCC"> from</font><font color="#E5E5E5"> the past and</font>

456
00:21:32,520 --> 00:21:37,408
made my skills memory like I reset<font color="#CCCCCC"> the</font>

457
00:21:35,220 --> 00:21:39,870
memory<font color="#E5E5E5"> and said yeah you're in 1995</font>

458
00:21:37,409 --> 00:21:42,870
right<font color="#CCCCCC"> all memory of those two</font>

459
00:21:39,870 --> 00:21:45,360
transactions<font color="#E5E5E5"> is lost they do not exist</font>

460
00:21:42,870 --> 00:21:46,080
<font color="#CCCCCC">anymore</font><font color="#E5E5E5"> right the binary log is is</font>

461
00:21:45,360 --> 00:21:50,039
linear

462
00:21:46,080 --> 00:21:53,039
right<font color="#CCCCCC"> it's serialized</font><font color="#E5E5E5"> it was printed in</font>

463
00:21:50,039 --> 00:21:56,640
a<font color="#CCCCCC"> serialized form originally and we D</font>

464
00:21:53,039 --> 00:21:58,980
applied it in a serialized form<font color="#E5E5E5"> so there</font>

465
00:21:56,640 --> 00:22:05,179
is no concurrent transaction resolution

466
00:21:58,980 --> 00:22:05,179
<font color="#E5E5E5">needed here so to speak okay</font><font color="#CCCCCC"> yes</font><font color="#E5E5E5"> sir</font>

467
00:22:08,100 --> 00:22:14,610
and the feedback<font color="#E5E5E5"> is that doesn't work</font>

468
00:22:13,260 --> 00:22:16,740
<font color="#CCCCCC">for many</font><font color="#E5E5E5"> workers</font><font color="#CCCCCC"> first you</font><font color="#E5E5E5"> need</font>

469
00:22:14,610 --> 00:22:31,350
rule-based<font color="#E5E5E5"> education which is not the</font>

470
00:22:16,740 --> 00:22:33,570
case all<font color="#CCCCCC"> the time okay so the gentleman</font>

471
00:22:31,350 --> 00:22:35,070
<font color="#E5E5E5">says we already try this with</font>

472
00:22:33,570 --> 00:22:36,899
replication manager which<font color="#CCCCCC"> is also</font><font color="#E5E5E5"> a</font>

473
00:22:35,070 --> 00:22:39,780
fellow of<font color="#CCCCCC"> the mechanism and there was a</font>

474
00:22:36,900 --> 00:22:41,520
<font color="#E5E5E5">feedback saying yeah did</font><font color="#CCCCCC"> they all done</font>

475
00:22:39,780 --> 00:22:43,590
some work and<font color="#E5E5E5"> you rope in</font><font color="#CCCCCC"> love format</font>

476
00:22:41,520 --> 00:22:47,908
and so you're using file system

477
00:22:43,590 --> 00:22:51,240
snapshots to fix the<font color="#E5E5E5"> problem okay zero</font>

478
00:22:47,909 --> 00:22:53,460
<font color="#E5E5E5">phase</font><font color="#CCCCCC"> cool yeah</font><font color="#E5E5E5"> we use being</font><font color="#CCCCCC"> Luke robe</font>

479
00:22:51,240 --> 00:22:55,440
is not<font color="#E5E5E5"> formats and we're willing we</font>

480
00:22:53,460 --> 00:23:07,679
don't we're willing to<font color="#E5E5E5"> to give this a</font>

481
00:22:55,440 --> 00:23:11,039
try so<font color="#CCCCCC"> let's know</font><font color="#E5E5E5"> last question I I</font>

482
00:23:07,679 --> 00:23:13,020
<font color="#E5E5E5">don't know because we do use</font><font color="#CCCCCC"> GBA so I my</font>

483
00:23:11,039 --> 00:23:16,320
state of<font color="#E5E5E5"> mind was let's try and use that</font>

484
00:23:13,020 --> 00:23:18,590
<font color="#CCCCCC">I don't know right okay thank you</font><font color="#E5E5E5"> very</font>

485
00:23:16,320 --> 00:23:18,590
<font color="#CCCCCC">much</font>

486
00:23:21,680 --> 00:23:23,740
<font color="#CCCCCC">you</font>

