1
00:00:12,269 --> 00:00:18,220
<font color="#E5E5E5">okay so unfortunately one</font><font color="#CCCCCC"> of our</font>

2
00:00:16,000 --> 00:00:21,060
<font color="#E5E5E5">speakers had to</font><font color="#CCCCCC"> cancel</font><font color="#E5E5E5"> and normally that</font>

3
00:00:18,220 --> 00:00:21,060
<font color="#E5E5E5">would have been at all</font>

4
00:00:23,740 --> 00:00:32,839
now we will have Holger<font color="#E5E5E5"> Walter</font><font color="#CCCCCC"> talk</font>

5
00:00:27,410 --> 00:00:47,989
instead<font color="#CCCCCC"> about the AC BHV acquits</font><font color="#E5E5E5"> older</font>

6
00:00:32,840 --> 00:00:51,050
<font color="#E5E5E5">is also a member of co-founder yes</font><font color="#CCCCCC"> thank</font>

7
00:00:47,989 --> 00:00:55,699
you<font color="#CCCCCC"> very much</font><font color="#E5E5E5"> yeah as you said my name</font>

8
00:00:51,050 --> 00:00:57,979
<font color="#CCCCCC">is yeah</font><font color="#E5E5E5"> my name is</font><font color="#CCCCCC"> Goga</font>

9
00:00:55,699 --> 00:00:59,420
um I'm looking for fortune globe<font color="#E5E5E5"> we are</font>

10
00:00:57,979 --> 00:01:02,479
<font color="#E5E5E5">doing e-commerce for the fashion</font>

11
00:00:59,420 --> 00:01:05,659
industry<font color="#CCCCCC"> you can find me on Twitter and</font>

12
00:01:02,479 --> 00:01:07,579
on github and<font color="#E5E5E5"> on several other places as</font>

13
00:01:05,659 --> 00:01:10,610
he<font color="#CCCCCC"> mentioned I'm running the</font><font color="#E5E5E5"> PHP user</font>

14
00:01:07,579 --> 00:01:14,089
group or<font color="#CCCCCC"> this I'm one of the runners of</font>

15
00:01:10,610 --> 00:01:16,340
the PHP is a group so and today<font color="#CCCCCC"> I want</font>

16
00:01:14,090 --> 00:01:20,899
to talk<font color="#E5E5E5"> about</font><font color="#CCCCCC"> PHP and as</font><font color="#E5E5E5"> in kernels</font>

17
00:01:16,340 --> 00:01:23,979
requests and PHP PHP and<font color="#E5E5E5"> s</font><font color="#CCCCCC"> Inc always</font>

18
00:01:20,899 --> 00:01:27,500
was kind of love hate relationship

19
00:01:23,979 --> 00:01:32,690
<font color="#CCCCCC">because as Acronis</font><font color="#E5E5E5"> requests are not</font>

20
00:01:27,500 --> 00:01:34,940
<font color="#E5E5E5">built in to PHP so not really um so to</font>

21
00:01:32,690 --> 00:01:37,610
<font color="#CCCCCC">demonstrate the whole thing I chose this</font>

22
00:01:34,940 --> 00:01:40,190
<font color="#CCCCCC">very simple</font><font color="#E5E5E5"> use case</font><font color="#CCCCCC"> let's consider we</font>

23
00:01:37,610 --> 00:01:44,479
have<font color="#CCCCCC"> a PHP creation</font><font color="#E5E5E5"> a PDF creation</font>

24
00:01:40,190 --> 00:01:47,990
service which basically on<font color="#E5E5E5"> management</font>

25
00:01:44,479 --> 00:01:51,049
level looks like this yeah so user sends

26
00:01:47,990 --> 00:01:55,850
a request to<font color="#E5E5E5"> the web service</font><font color="#CCCCCC"> and the web</font>

27
00:01:51,049 --> 00:01:59,390
service creates<font color="#E5E5E5"> three PDF files so if we</font>

28
00:01:55,850 --> 00:02:02,839
have only<font color="#CCCCCC"> three</font><font color="#E5E5E5"> pretty F files we can</font>

29
00:01:59,390 --> 00:02:05,720
produce<font color="#E5E5E5"> them sequentially which is kind</font>

30
00:02:02,840 --> 00:02:10,429
of<font color="#CCCCCC"> ok</font><font color="#E5E5E5"> because it's not consuming too</font>

31
00:02:05,720 --> 00:02:12,140
many too much time but what if we have a

32
00:02:10,429 --> 00:02:15,680
lot of<font color="#CCCCCC"> clears that we have to create</font><font color="#E5E5E5"> in</font>

33
00:02:12,140 --> 00:02:19,970
the same time<font color="#CCCCCC"> if</font><font color="#E5E5E5"> we do that sequentially</font>

34
00:02:15,680 --> 00:02:21,700
<font color="#E5E5E5">so we had to create nine PDFs now that</font>

35
00:02:19,970 --> 00:02:24,019
probably will<font color="#E5E5E5"> take a lot of time and</font>

36
00:02:21,700 --> 00:02:26,409
it's maybe not fast enough<font color="#E5E5E5"> for the user</font>

37
00:02:24,019 --> 00:02:29,569
and<font color="#CCCCCC"> for your web</font><font color="#E5E5E5"> service and everything</font>

38
00:02:26,409 --> 00:02:32,840
so what<font color="#E5E5E5"> we are basically doing or neat</font>

39
00:02:29,569 --> 00:02:36,880
is we<font color="#CCCCCC"> need to parallelized those</font>

40
00:02:32,840 --> 00:02:40,750
requests all those creation of the PDF

41
00:02:36,880 --> 00:02:43,130
to make it faster for<font color="#E5E5E5"> the</font><font color="#CCCCCC"> end-user</font>

42
00:02:40,750 --> 00:02:48,890
<font color="#CCCCCC">because we are</font><font color="#E5E5E5"> doing multiple</font><font color="#CCCCCC"> jobs at</font>

43
00:02:43,130 --> 00:02:52,190
the same time so let's look back how did

44
00:02:48,890 --> 00:02:56,000
<font color="#E5E5E5">we try to do a synchronous</font><font color="#CCCCCC"> big quests</font>

45
00:02:52,190 --> 00:02:59,720
and PHP<font color="#E5E5E5"> in the past so I have some code</font>

46
00:02:56,000 --> 00:03:02,239
snippets<font color="#CCCCCC"> please take</font><font color="#E5E5E5"> them funny because</font>

47
00:02:59,720 --> 00:03:07,010
<font color="#CCCCCC">they are yeah</font><font color="#E5E5E5"> we did something like</font><font color="#CCCCCC"> that</font>

48
00:03:02,239 --> 00:03:09,350
right create PF def no throw<font color="#E5E5E5"> it away</font><font color="#CCCCCC"> you</font>

49
00:03:07,010 --> 00:03:12,109
<font color="#CCCCCC">can do the same</font><font color="#E5E5E5"> thing with</font><font color="#CCCCCC"> shellacs AG</font>

50
00:03:09,350 --> 00:03:16,660
or pro<font color="#CCCCCC"> open it's basically all the same</font>

51
00:03:12,110 --> 00:03:19,459
thing that<font color="#E5E5E5"> works since pH</font><font color="#CCCCCC"> before yeah</font><font color="#E5E5E5"> so</font>

52
00:03:16,660 --> 00:03:23,930
even if you run very<font color="#CCCCCC"> old PHP you can do</font>

53
00:03:19,459 --> 00:03:28,040
that<font color="#E5E5E5"> so that works of course but we</font><font color="#CCCCCC"> have</font>

54
00:03:23,930 --> 00:03:30,860
a lot<font color="#CCCCCC"> of downsides here first we need</font><font color="#E5E5E5"> to</font>

55
00:03:28,040 --> 00:03:32,540
call the script in CLI mode which is a

56
00:03:30,860 --> 00:03:36,799
<font color="#E5E5E5">completely different environment and our</font>

57
00:03:32,540 --> 00:03:40,220
web<font color="#E5E5E5"> service</font><font color="#CCCCCC"> if we have a long command</font>

58
00:03:36,799 --> 00:03:44,299
with a lot of<font color="#E5E5E5"> options</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> the PDF that</font>

59
00:03:40,220 --> 00:03:48,109
command<font color="#E5E5E5"> gets quite messy</font><font color="#CCCCCC"> yeah Darla's</font>

60
00:03:44,299 --> 00:03:51,799
handling is based on the<font color="#E5E5E5"> odd</font><font color="#CCCCCC"> v are from</font>

61
00:03:48,109 --> 00:03:53,299
the CLI<font color="#E5E5E5"> and we don't get</font><font color="#CCCCCC"> any response</font>

62
00:03:51,799 --> 00:03:59,049
back because we<font color="#E5E5E5"> are sending everything</font>

63
00:03:53,299 --> 00:04:03,829
<font color="#E5E5E5">to dev node yeah try</font><font color="#CCCCCC"> that on</font><font color="#E5E5E5"> debugging</font>

64
00:03:59,049 --> 00:04:05,810
<font color="#E5E5E5">especially in production so let's do</font>

65
00:04:03,829 --> 00:04:08,870
some HTTP because<font color="#E5E5E5"> everybody can HTTP</font>

66
00:04:05,810 --> 00:04:13,730
right so uh<font color="#E5E5E5"> yeah next thing is we are</font>

67
00:04:08,870 --> 00:04:15,769
<font color="#E5E5E5">doing curl</font><font color="#CCCCCC"> request same script and the</font>

68
00:04:13,730 --> 00:04:18,620
clue is here the time the<font color="#E5E5E5"> least second</font>

69
00:04:15,769 --> 00:04:21,858
one that makes it really sent us<font color="#CCCCCC"> on</font>

70
00:04:18,620 --> 00:04:26,870
<font color="#CCCCCC">Chrome asleep so the curl is coming back</font>

71
00:04:21,858 --> 00:04:29,840
here and closest after sort of script<font color="#E5E5E5"> is</font>

72
00:04:26,870 --> 00:04:31,910
running<font color="#E5E5E5"> and the curl the curry sauce is</font>

73
00:04:29,840 --> 00:04:33,799
closed<font color="#CCCCCC"> so basically it's</font><font color="#E5E5E5"> the same</font>

74
00:04:31,910 --> 00:04:35,570
behavior we<font color="#E5E5E5"> are sending everything to</font>

75
00:04:33,800 --> 00:04:39,889
<font color="#E5E5E5">dev not because we</font><font color="#CCCCCC"> don't get any</font>

76
00:04:35,570 --> 00:04:41,599
response back so the problem here<font color="#CCCCCC"> is</font><font color="#E5E5E5"> we</font>

77
00:04:39,889 --> 00:04:44,840
have<font color="#CCCCCC"> a web</font><font color="#E5E5E5"> server involved because</font><font color="#CCCCCC"> we</font>

78
00:04:41,600 --> 00:04:47,090
are sending<font color="#CCCCCC"> a</font><font color="#E5E5E5"> natural HTTP request</font><font color="#CCCCCC"> the</font>

79
00:04:44,840 --> 00:04:49,679
web server<font color="#CCCCCC"> can be overhead of course</font>

80
00:04:47,090 --> 00:04:53,280
<font color="#E5E5E5">because HTTP has some</font>

81
00:04:49,680 --> 00:04:56,310
and can also be<font color="#E5E5E5"> an error error source</font>

82
00:04:53,280 --> 00:04:59,169
whence come when it<font color="#E5E5E5"> comes to debugging</font>

83
00:04:56,310 --> 00:05:01,780
so maybe<font color="#CCCCCC"> even a local answer is involved</font>

84
00:04:59,170 --> 00:05:06,340
<font color="#E5E5E5">so you have another system in front of</font>

85
00:05:01,780 --> 00:05:09,400
that<font color="#E5E5E5"> so you have two environments that</font>

86
00:05:06,340 --> 00:05:13,690
<font color="#E5E5E5">you have to maintain at</font><font color="#CCCCCC"> least you need</font>

87
00:05:09,400 --> 00:05:17,679
<font color="#E5E5E5">to curl extension in PHP again the</font>

88
00:05:13,690 --> 00:05:19,660
response is thrown away and the call

89
00:05:17,680 --> 00:05:22,510
<font color="#CCCCCC">squared must be</font><font color="#E5E5E5"> exposed another document</font>

90
00:05:19,660 --> 00:05:24,130
root so that<font color="#CCCCCC"> could be</font><font color="#E5E5E5"> a also a</font><font color="#CCCCCC"> security</font>

91
00:05:22,510 --> 00:05:26,590
issue<font color="#CCCCCC"> depending on the job that you are</font>

92
00:05:24,130 --> 00:05:28,810
<font color="#CCCCCC">doing in the background in</font><font color="#E5E5E5"> this case</font>

93
00:05:26,590 --> 00:05:33,760
when<font color="#E5E5E5"> you want to call it over in URL you</font>

94
00:05:28,810 --> 00:05:36,730
have to expose it to<font color="#E5E5E5"> the web server so</font>

95
00:05:33,760 --> 00:05:40,599
we also tried very hard<font color="#E5E5E5"> doing some stuff</font>

96
00:05:36,730 --> 00:05:42,250
by just<font color="#E5E5E5"> building up queues right so just</font>

97
00:05:40,600 --> 00:05:45,220
put<font color="#E5E5E5"> that script in the queue and then</font>

98
00:05:42,250 --> 00:05:50,410
create a cron tap that is<font color="#E5E5E5"> running every</font>

99
00:05:45,220 --> 00:05:53,710
<font color="#E5E5E5">minute and it's running those scripts so</font>

100
00:05:50,410 --> 00:05:58,990
of<font color="#E5E5E5"> course also that works</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> you don't</font>

101
00:05:53,710 --> 00:06:02,080
have on the amount execution so it's not

102
00:05:58,990 --> 00:06:04,170
suitable<font color="#E5E5E5"> for web service of course it</font>

103
00:06:02,080 --> 00:06:07,150
needs<font color="#CCCCCC"> a lot of</font><font color="#E5E5E5"> locking and logging</font>

104
00:06:04,170 --> 00:06:10,260
<font color="#E5E5E5">because your concurrency</font><font color="#CCCCCC"> and you need to</font>

105
00:06:07,150 --> 00:06:14,890
show what<font color="#CCCCCC"> is happening in the background</font>

106
00:06:10,260 --> 00:06:17,560
<font color="#CCCCCC">yeah easily have</font><font color="#E5E5E5"> race conditions and you</font>

107
00:06:14,890 --> 00:06:21,849
also can have well if one of those jobs

108
00:06:17,560 --> 00:06:25,060
is running it's going wild<font color="#E5E5E5"> you kind of</font>

109
00:06:21,850 --> 00:06:28,120
fun because yeah like I said<font color="#CCCCCC"> it's</font>

110
00:06:25,060 --> 00:06:34,330
<font color="#CCCCCC">running every minute so yeah your</font>

111
00:06:28,120 --> 00:06:35,800
<font color="#E5E5E5">service may</font><font color="#CCCCCC"> be soon very dead</font><font color="#E5E5E5"> so um and</font>

112
00:06:34,330 --> 00:06:38,409
<font color="#E5E5E5">you also have have you thought of a slow</font>

113
00:06:35,800 --> 00:06:41,290
because<font color="#CCCCCC"> you</font><font color="#E5E5E5"> are technically you're using</font>

114
00:06:38,410 --> 00:06:41,590
technically<font color="#CCCCCC"> elusive data which is a bad</font>

115
00:06:41,290 --> 00:06:44,620
idea

116
00:06:41,590 --> 00:06:46,270
of course<font color="#CCCCCC"> idea</font><font color="#E5E5E5"> of the you have to</font>

117
00:06:44,620 --> 00:06:49,570
maintain<font color="#E5E5E5"> something outside</font><font color="#CCCCCC"> of your</font><font color="#E5E5E5"> PHP</font>

118
00:06:46,270 --> 00:06:53,430
<font color="#E5E5E5">project the cron job so you have to go</font>

119
00:06:49,570 --> 00:06:58,090
or have<font color="#E5E5E5"> to access some develop material</font>

120
00:06:53,430 --> 00:07:01,180
and of course this is how to test in<font color="#CCCCCC"> the</font>

121
00:06:58,090 --> 00:07:04,049
scenario of creating multiple multiple

122
00:07:01,180 --> 00:07:04,050
jobs at the same time

123
00:07:04,139 --> 00:07:10,659
so yeah we also<font color="#CCCCCC"> tried to be clever doing</font>

124
00:07:09,189 --> 00:07:14,409
<font color="#E5E5E5">something like this</font>

125
00:07:10,659 --> 00:07:16,120
<font color="#E5E5E5">register shutdown function</font><font color="#CCCCCC"> doing a</font>

126
00:07:14,409 --> 00:07:20,770
redirect and the shutdown function is

127
00:07:16,120 --> 00:07:23,289
running after<font color="#E5E5E5"> the redirect also works</font>

128
00:07:20,770 --> 00:07:26,438
but again there's a<font color="#CCCCCC"> webserver</font><font color="#E5E5E5"> involved</font>

129
00:07:23,289 --> 00:07:28,210
<font color="#CCCCCC">we have no response if something is</font>

130
00:07:26,439 --> 00:07:32,379
<font color="#E5E5E5">running with shutdown function you will</font>

131
00:07:28,210 --> 00:07:34,020
have memory<font color="#CCCCCC"> leaks and you cannot throw</font>

132
00:07:32,379 --> 00:07:36,849
exceptions in the shutdown function

133
00:07:34,020 --> 00:07:40,198
<font color="#CCCCCC">because there is no exception handler</font>

134
00:07:36,849 --> 00:07:42,400
anymore<font color="#CCCCCC"> which also is pretty bad idea</font>

135
00:07:40,199 --> 00:07:43,840
yeah and you have no execution time

136
00:07:42,400 --> 00:07:46,870
limit because you are already in a

137
00:07:43,840 --> 00:07:51,159
shutdown function so<font color="#E5E5E5"> please don't try</font><font color="#CCCCCC"> to</font>

138
00:07:46,870 --> 00:07:56,050
be clever yeah of<font color="#CCCCCC"> course</font><font color="#E5E5E5"> they are</font><font color="#CCCCCC"> where</font>

139
00:07:51,159 --> 00:07:59,580
a lot of people<font color="#E5E5E5"> rapping at their head</font>

140
00:07:56,050 --> 00:08:02,860
around<font color="#CCCCCC"> other oness and multi-threading</font>

141
00:07:59,580 --> 00:08:06,188
so there's the extension called<font color="#E5E5E5"> P</font>

142
00:08:02,860 --> 00:08:09,759
<font color="#E5E5E5">threads</font><font color="#CCCCCC"> and when you look at the</font>

143
00:08:06,189 --> 00:08:12,870
<font color="#CCCCCC">requirements of</font><font color="#E5E5E5"> periods you see that you</font>

144
00:08:09,759 --> 00:08:17,740
<font color="#E5E5E5">need to enable the</font><font color="#CCCCCC"> sense thread safety</font>

145
00:08:12,870 --> 00:08:20,740
<font color="#CCCCCC">dps which must</font><font color="#E5E5E5"> be enabled on PHP build</font>

146
00:08:17,740 --> 00:08:24,270
time so if you<font color="#CCCCCC"> have a standard PHP</font>

147
00:08:20,740 --> 00:08:28,210
installation that<font color="#E5E5E5"> is not enabled</font><font color="#CCCCCC"> and</font>

148
00:08:24,270 --> 00:08:34,328
thus you<font color="#E5E5E5"> are not able to install or run</font>

149
00:08:28,210 --> 00:08:36,218
pieces and P threads are only for CLI

150
00:08:34,328 --> 00:08:38,679
based applications<font color="#E5E5E5"> so know that</font>

151
00:08:36,219 --> 00:08:40,000
environment and<font color="#CCCCCC"> you there's a big</font>

152
00:08:38,679 --> 00:08:43,510
<font color="#E5E5E5">warning that you should use it in better</font>

153
00:08:40,000 --> 00:08:47,709
environments<font color="#CCCCCC"> so it's not</font><font color="#E5E5E5"> very suitable</font>

154
00:08:43,510 --> 00:08:50,890
<font color="#E5E5E5">for our use case so again need to custom</font>

155
00:08:47,709 --> 00:08:53,680
PHP build<font color="#E5E5E5"> not all extensions are thread</font>

156
00:08:50,890 --> 00:08:56,350
safe<font color="#E5E5E5"> so when you enable this thread</font>

157
00:08:53,680 --> 00:08:58,540
safety<font color="#E5E5E5"> you may have problems with other</font>

158
00:08:56,350 --> 00:09:00,510
extensions in PHP<font color="#E5E5E5"> because not all</font>

159
00:08:58,540 --> 00:09:02,469
extensions<font color="#CCCCCC"> also it safe</font>

160
00:09:00,510 --> 00:09:06,279
yeah it's not<font color="#E5E5E5"> working</font><font color="#CCCCCC"> in that</font>

161
00:09:02,470 --> 00:09:08,860
<font color="#CCCCCC">environment um</font><font color="#E5E5E5"> you have to have a basic</font>

162
00:09:06,279 --> 00:09:12,839
<font color="#CCCCCC">knowledge about multi-threading because</font>

163
00:09:08,860 --> 00:09:15,910
P threads is really multi-threading<font color="#E5E5E5"> and</font>

164
00:09:12,839 --> 00:09:18,300
yeah probably<font color="#E5E5E5"> you can leave out</font><font color="#CCCCCC"> the</font>

165
00:09:15,910 --> 00:09:20,290
because you need<font color="#E5E5E5"> knowledge about</font>

166
00:09:18,300 --> 00:09:24,000
multi-threading<font color="#E5E5E5"> when you use</font><font color="#CCCCCC"> pthreads</font>

167
00:09:20,290 --> 00:09:24,000
<font color="#E5E5E5">it's very complex</font>

168
00:09:24,450 --> 00:09:29,620
yeah you have a lot<font color="#CCCCCC"> of feature and</font>

169
00:09:26,970 --> 00:09:33,490
conflict<font color="#CCCCCC"> overheads for</font><font color="#E5E5E5"> such a simple</font>

170
00:09:29,620 --> 00:09:36,520
<font color="#CCCCCC">task like an</font><font color="#E5E5E5"> awesome request yeah and</font>

171
00:09:33,490 --> 00:09:37,960
you<font color="#E5E5E5"> have to</font><font color="#CCCCCC"> process the</font><font color="#E5E5E5"> handle the</font>

172
00:09:36,520 --> 00:09:42,460
complete process<font color="#E5E5E5"> and</font><font color="#CCCCCC"> threat</font><font color="#E5E5E5"> management</font>

173
00:09:37,960 --> 00:09:44,620
yourself so there's also another

174
00:09:42,460 --> 00:09:49,410
extension which<font color="#CCCCCC"> is called process</font>

175
00:09:44,620 --> 00:09:53,020
control or PC<font color="#CCCCCC"> ntl that you can install</font>

176
00:09:49,410 --> 00:09:58,689
<font color="#E5E5E5">again you need to build PHP with a flag</font>

177
00:09:53,020 --> 00:10:05,650
called an able<font color="#E5E5E5"> PC IDL yeah and it only</font>

178
00:09:58,690 --> 00:10:07,720
<font color="#E5E5E5">works on UNIX um so the windows sorry so</font>

179
00:10:05,650 --> 00:10:09,939
<font color="#CCCCCC">needs a custom PHP</font><font color="#E5E5E5"> build it's not</font>

180
00:10:07,720 --> 00:10:13,120
working on<font color="#CCCCCC"> Windows</font><font color="#E5E5E5"> so everybody who's</font>

181
00:10:09,940 --> 00:10:15,390
developing on<font color="#E5E5E5"> Windows machines cannot</font>

182
00:10:13,120 --> 00:10:15,390
use it

183
00:10:15,810 --> 00:10:22,300
you also need basic knowledge about UNIX

184
00:10:18,910 --> 00:10:24,100
process is<font color="#E5E5E5"> here and the complete process</font>

185
00:10:22,300 --> 00:10:28,270
management itself is up to you so you

186
00:10:24,100 --> 00:10:32,950
<font color="#E5E5E5">have</font><font color="#CCCCCC"> to fork</font><font color="#E5E5E5"> things catch them again</font>

187
00:10:28,270 --> 00:10:35,290
<font color="#E5E5E5">when they are finished and there's</font>

188
00:10:32,950 --> 00:10:40,590
another option<font color="#CCCCCC"> um what is called Gilman</font>

189
00:10:35,290 --> 00:10:44,589
<font color="#E5E5E5">I think it's</font><font color="#CCCCCC"> a little</font><font color="#E5E5E5"> bit older already</font>

190
00:10:40,590 --> 00:10:48,160
yeah that<font color="#E5E5E5"> extension has a lot of</font>

191
00:10:44,590 --> 00:10:51,580
<font color="#E5E5E5">requirements because you need lip</font><font color="#CCCCCC"> care</font>

192
00:10:48,160 --> 00:10:55,600
man you need lip event you need UID<font color="#CCCCCC"> and</font>

193
00:10:51,580 --> 00:10:57,790
<font color="#CCCCCC">you need a</font><font color="#E5E5E5"> given server so you need a</font>

194
00:10:55,600 --> 00:11:01,990
complete completely other piece<font color="#CCCCCC"> of</font>

195
00:10:57,790 --> 00:11:05,020
infrastructure<font color="#CCCCCC"> plus a PHP extension so</font>

196
00:11:01,990 --> 00:11:08,440
again<font color="#E5E5E5"> a lot of overhead and</font><font color="#CCCCCC"> a lot of</font>

197
00:11:05,020 --> 00:11:10,689
<font color="#E5E5E5">configuration</font><font color="#CCCCCC"> that we have in a</font><font color="#E5E5E5"> lot of</font>

198
00:11:08,440 --> 00:11:13,210
<font color="#E5E5E5">setup especially especially on</font>

199
00:11:10,690 --> 00:11:18,510
development environments<font color="#E5E5E5"> to get that up</font>

200
00:11:13,210 --> 00:11:21,100
and running so what do we<font color="#CCCCCC"> actually</font><font color="#E5E5E5"> want</font>

201
00:11:18,510 --> 00:11:24,580
we won't make a synchronous<font color="#E5E5E5"> call to PHP</font>

202
00:11:21,100 --> 00:11:27,550
obviously eventually we want<font color="#E5E5E5"> to get the</font>

203
00:11:24,580 --> 00:11:28,770
<font color="#E5E5E5">responses of those calls we don't want</font>

204
00:11:27,550 --> 00:11:31,880
any<font color="#CCCCCC"> additional infrastructure</font>

205
00:11:28,770 --> 00:11:35,399
we don't want any<font color="#E5E5E5"> additional extensions</font>

206
00:11:31,880 --> 00:11:38,459
<font color="#CCCCCC">you would like to have web-like requests</font>

207
00:11:35,399 --> 00:11:40,800
<font color="#CCCCCC">that are handling because we are used to</font>

208
00:11:38,459 --> 00:11:43,520
it<font color="#E5E5E5"> so when we</font><font color="#CCCCCC"> are on a web service we</font>

209
00:11:40,800 --> 00:11:46,680
don't want to switch to CLI mode<font color="#E5E5E5"> right</font>

210
00:11:43,520 --> 00:11:48,600
<font color="#CCCCCC">you want to take advantage</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> up cash</font>

211
00:11:46,680 --> 00:11:52,079
<font color="#CCCCCC">because when you have a web request</font><font color="#E5E5E5"> on</font>

212
00:11:48,600 --> 00:11:55,940
up cash comes into play<font color="#CCCCCC"> on the</font><font color="#E5E5E5"> CLI mode</font>

213
00:11:52,080 --> 00:11:55,940
<font color="#E5E5E5">of course it's already always disabled</font>

214
00:11:56,000 --> 00:12:03,060
<font color="#E5E5E5">beside</font><font color="#CCCCCC"> you enabled</font><font color="#E5E5E5"> especially but</font>

215
00:11:59,779 --> 00:12:06,360
usually when you use CLI<font color="#CCCCCC"> boat</font><font color="#E5E5E5"> you don't</font>

216
00:12:03,060 --> 00:12:08,010
have it in<font color="#E5E5E5"> your</font><font color="#CCCCCC"> cache so</font><font color="#E5E5E5"> but our</font>

217
00:12:06,360 --> 00:12:10,350
background workers should<font color="#CCCCCC"> not be</font><font color="#E5E5E5"> exposed</font>

218
00:12:08,010 --> 00:12:13,680
to the<font color="#CCCCCC"> public</font><font color="#E5E5E5"> so that's the point from</font>

219
00:12:10,350 --> 00:12:16,670
the slide before and we want to have

220
00:12:13,680 --> 00:12:20,489
some<font color="#E5E5E5"> kind of tunable process management</font>

221
00:12:16,670 --> 00:12:23,729
<font color="#E5E5E5">okay</font><font color="#CCCCCC"> now what if I</font><font color="#E5E5E5"> told you</font><font color="#CCCCCC"> that we have</font>

222
00:12:20,490 --> 00:12:27,270
a<font color="#E5E5E5"> bulletproof process manager already</font>

223
00:12:23,730 --> 00:12:31,640
shook with<font color="#CCCCCC"> BG yeah and you're probably</font>

224
00:12:27,270 --> 00:12:37,100
already using<font color="#E5E5E5"> it</font><font color="#CCCCCC"> so who's using PHP fpm</font>

225
00:12:31,640 --> 00:12:39,990
who set up a<font color="#E5E5E5"> PHP</font><font color="#CCCCCC"> fbm by itself okay good</font>

226
00:12:37,100 --> 00:12:44,370
<font color="#E5E5E5">so yeah we are talking about PHP</font><font color="#CCCCCC"> fbm</font>

227
00:12:39,990 --> 00:12:46,100
it's the PHP for<font color="#E5E5E5"> CGI process manager so</font>

228
00:12:44,370 --> 00:12:48,779
how it usually works<font color="#E5E5E5"> when</font><font color="#CCCCCC"> we are doing</font>

229
00:12:46,100 --> 00:12:50,160
simple web requests is we have a web

230
00:12:48,779 --> 00:12:52,500
<font color="#E5E5E5">server</font><font color="#CCCCCC"> and genetics or Apache or</font>

231
00:12:50,160 --> 00:12:56,790
something like that which is talking<font color="#CCCCCC"> to</font>

232
00:12:52,500 --> 00:13:01,470
PHP<font color="#CCCCCC"> fpm</font><font color="#E5E5E5"> via far</font><font color="#CCCCCC"> cgi protocol and the PHP</font>

233
00:12:56,790 --> 00:13:06,469
<font color="#CCCCCC">fpm has a default pool called DTV www</font>

234
00:13:01,470 --> 00:13:08,940
sorry<font color="#E5E5E5"> which spawns want to end</font><font color="#CCCCCC"> process</font>

235
00:13:06,470 --> 00:13:11,459
<font color="#E5E5E5">so that looks</font><font color="#CCCCCC"> like this</font>

236
00:13:08,940 --> 00:13:13,740
so we<font color="#CCCCCC"> also declined we have the</font><font color="#E5E5E5"> master</font>

237
00:13:11,459 --> 00:13:18,750
process<font color="#E5E5E5"> and this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> the default</font>

238
00:13:13,740 --> 00:13:20,910
configuration<font color="#E5E5E5"> yeah I'm free</font>

239
00:13:18,750 --> 00:13:26,660
<font color="#E5E5E5">three worker processes that are waiting</font>

240
00:13:20,910 --> 00:13:26,660
<font color="#CCCCCC">for requests so um</font>

241
00:13:27,760 --> 00:13:32,560
the<font color="#E5E5E5"> initially idea of this talk and the</font>

242
00:13:30,670 --> 00:13:35,680
library that<font color="#E5E5E5"> I will introduce</font><font color="#CCCCCC"> and the</font>

243
00:13:32,560 --> 00:13:40,029
next slides<font color="#E5E5E5"> a came from a talk by</font><font color="#CCCCCC"> honor</font>

244
00:13:35,680 --> 00:13:43,050
blankets and the PHP<font color="#E5E5E5"> international PHP</font>

245
00:13:40,029 --> 00:13:45,550
conference<font color="#CCCCCC"> in Berlin</font><font color="#E5E5E5"> he was showing a</font>

246
00:13:43,050 --> 00:13:50,019
JavaScript application<font color="#CCCCCC"> that was talking</font>

247
00:13:45,550 --> 00:13:53,199
<font color="#CCCCCC">to PHP fbn by a library called</font><font color="#E5E5E5"> J as</font><font color="#CCCCCC"> far</font>

248
00:13:50,019 --> 00:13:55,949
<font color="#CCCCCC">cgi whatever</font><font color="#E5E5E5"> and I said okay why can't</font>

249
00:13:53,199 --> 00:14:00,099
<font color="#E5E5E5">JavaScript talk to PHP</font><font color="#CCCCCC"> fbm but</font><font color="#E5E5E5"> we can't</font>

250
00:13:55,949 --> 00:14:03,130
<font color="#E5E5E5">because we are</font><font color="#CCCCCC"> doing bitch feet right so</font>

251
00:14:00,100 --> 00:14:06,130
I look on github<font color="#CCCCCC"> if there is a PHP</font>

252
00:14:03,130 --> 00:14:06,790
library that can<font color="#E5E5E5"> talk to the FASTA GI</font>

253
00:14:06,130 --> 00:14:09,639
client or

254
00:14:06,790 --> 00:14:14,610
<font color="#E5E5E5">Fosse GI</font><font color="#CCCCCC"> call but compatible and can</font>

255
00:14:09,639 --> 00:14:17,769
<font color="#CCCCCC">talk to the PHP fbm client server</font><font color="#E5E5E5"> and I</font>

256
00:14:14,610 --> 00:14:25,810
actually found one from<font color="#CCCCCC"> Pierre rickshaw</font>

257
00:14:17,769 --> 00:14:28,959
<font color="#E5E5E5">and it was from</font><font color="#CCCCCC"> 2005 or</font><font color="#E5E5E5"> six I</font><font color="#CCCCCC"> think I</font>

258
00:14:25,810 --> 00:14:32,290
was not maintained for<font color="#E5E5E5"> a couple of years</font>

259
00:14:28,959 --> 00:14:35,859
<font color="#E5E5E5">and it was also missing from my part of</font>

260
00:14:32,290 --> 00:14:38,949
<font color="#CCCCCC">view missing some important features so</font>

261
00:14:35,860 --> 00:14:42,269
that<font color="#CCCCCC"> was the point where I started to</font>

262
00:14:38,949 --> 00:14:44,859
write or to rewrite the whole library<font color="#CCCCCC"> oh</font>

263
00:14:42,269 --> 00:14:49,050
<font color="#CCCCCC">there's</font><font color="#E5E5E5"> still</font><font color="#CCCCCC"> original code from Pyrrhic</font>

264
00:14:44,860 --> 00:14:53,199
in that library<font color="#E5E5E5"> and he's still</font><font color="#CCCCCC"> in there</font>

265
00:14:49,050 --> 00:14:56,649
in the office list<font color="#CCCCCC"> so um</font><font color="#E5E5E5"> but yeah I</font>

266
00:14:53,199 --> 00:14:59,410
<font color="#CCCCCC">think 90% of the code is new</font><font color="#E5E5E5"> so because</font>

267
00:14:56,649 --> 00:15:02,500
his<font color="#CCCCCC"> library was PHP 5 this is 7 1</font>

268
00:14:59,410 --> 00:15:04,870
upwards<font color="#E5E5E5"> so it works from seven one two</font>

269
00:15:02,500 --> 00:15:07,120
seven three<font color="#E5E5E5"> yeah</font>

270
00:15:04,870 --> 00:15:11,260
I recently released<font color="#CCCCCC"> two five Oh</font><font color="#E5E5E5"> last</font>

271
00:15:07,120 --> 00:15:16,660
<font color="#E5E5E5">week with a little bit better handling</font>

272
00:15:11,260 --> 00:15:21,370
<font color="#CCCCCC">and</font><font color="#E5E5E5"> yeah it's quite accepted already so</font>

273
00:15:16,660 --> 00:15:26,889
what<font color="#E5E5E5"> does this library do let's talk</font>

274
00:15:21,370 --> 00:15:28,990
<font color="#E5E5E5">about this those</font><font color="#CCCCCC"> fpm pools first thing</font>

275
00:15:26,889 --> 00:15:31,959
<font color="#E5E5E5">that we</font><font color="#CCCCCC"> add on a slide was we</font><font color="#E5E5E5"> don't want</font>

276
00:15:28,990 --> 00:15:35,050
to make our scripts that<font color="#E5E5E5"> we run in the</font>

277
00:15:31,959 --> 00:15:39,010
<font color="#E5E5E5">background public right so</font><font color="#CCCCCC"> and we also</font>

278
00:15:35,050 --> 00:15:40,410
want<font color="#CCCCCC"> to</font><font color="#E5E5E5"> have it in a</font><font color="#CCCCCC"> isolated process</font>

279
00:15:39,010 --> 00:15:44,189
<font color="#E5E5E5">running</font>

280
00:15:40,410 --> 00:15:48,449
and<font color="#CCCCCC"> fpm gives us the possibility to</font>

281
00:15:44,190 --> 00:15:53,879
<font color="#E5E5E5">create one or more pools which are</font>

282
00:15:48,449 --> 00:15:56,628
isolating resources for us so what I<font color="#CCCCCC"> can</font>

283
00:15:53,879 --> 00:16:00,180
do is I can define<font color="#E5E5E5"> a background pool</font>

284
00:15:56,629 --> 00:16:04,529
<font color="#CCCCCC">which has</font><font color="#E5E5E5"> configured to have no</font>

285
00:16:00,180 --> 00:16:08,399
processes<font color="#E5E5E5"> when it starts and can spawn</font>

286
00:16:04,529 --> 00:16:10,769
up to<font color="#E5E5E5"> end processes yeah</font>

287
00:16:08,399 --> 00:16:15,420
depends on how I configure it<font color="#E5E5E5"> so</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> will</font>

288
00:16:10,769 --> 00:16:18,569
show<font color="#E5E5E5"> you a config later so um what does</font>

289
00:16:15,420 --> 00:16:22,740
PHP<font color="#CCCCCC"> fpm to PHP fpm</font><font color="#E5E5E5"> sense to request to</font>

290
00:16:18,569 --> 00:16:26,459
the pool and the pool is<font color="#CCCCCC"> cueing the</font>

291
00:16:22,740 --> 00:16:28,379
<font color="#CCCCCC">request some kind of and when the</font>

292
00:16:26,459 --> 00:16:30,660
request is handled it returns the

293
00:16:28,379 --> 00:16:32,899
response back to<font color="#E5E5E5"> the PHP</font><font color="#CCCCCC"> fpm and to PHP</font>

294
00:16:30,660 --> 00:16:38,910
<font color="#CCCCCC">fbm returns</font><font color="#E5E5E5"> the response back to</font><font color="#CCCCCC"> the</font>

295
00:16:32,899 --> 00:16:41,639
this case<font color="#E5E5E5"> the worst server so this is</font>

296
00:16:38,910 --> 00:16:45,800
how those<font color="#E5E5E5"> this</font><font color="#CCCCCC"> background pool looks</font>

297
00:16:41,639 --> 00:16:48,959
like this is<font color="#E5E5E5"> the minimal configuration</font>

298
00:16:45,800 --> 00:16:53,279
<font color="#E5E5E5">so we say</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> is the name the</font>

299
00:16:48,959 --> 00:16:57,180
background<font color="#E5E5E5"> we need</font><font color="#CCCCCC"> to set user and group</font>

300
00:16:53,279 --> 00:17:02,850
for permissions<font color="#CCCCCC"> also for the listening</font>

301
00:16:57,180 --> 00:17:05,428
permissions<font color="#E5E5E5"> and we can choose if we use</font>

302
00:17:02,850 --> 00:17:08,069
a local socket for<font color="#CCCCCC"> the communication or</font>

303
00:17:05,429 --> 00:17:11,520
if we use<font color="#CCCCCC"> a network socket</font><font color="#E5E5E5"> so we can</font>

304
00:17:08,069 --> 00:17:14,520
also go a network socket<font color="#CCCCCC"> and a port so</font>

305
00:17:11,520 --> 00:17:17,209
we<font color="#CCCCCC"> can also listen to port</font><font color="#E5E5E5"> 9001</font>

306
00:17:14,520 --> 00:17:20,658
or something like<font color="#E5E5E5"> that so the default</font>

307
00:17:17,209 --> 00:17:23,549
default pool is listening<font color="#CCCCCC"> to port 9000</font>

308
00:17:20,659 --> 00:17:28,110
which is pretty cool<font color="#CCCCCC"> because xdebug</font><font color="#E5E5E5"> is</font>

309
00:17:23,549 --> 00:17:31,440
listening<font color="#CCCCCC"> to the</font><font color="#E5E5E5"> same port by default</font>

310
00:17:28,109 --> 00:17:34,110
<font color="#CCCCCC">yeah and what we are doing here is there</font>

311
00:17:31,440 --> 00:17:37,169
<font color="#CCCCCC">are different</font><font color="#E5E5E5"> kinds of process managers</font>

312
00:17:34,110 --> 00:17:39,209
which you can adjust here and when you

313
00:17:37,169 --> 00:17:42,690
say<font color="#E5E5E5"> my process manager is the on-demand</font>

314
00:17:39,210 --> 00:17:46,080
<font color="#E5E5E5">manager then you will you won't have a</font>

315
00:17:42,690 --> 00:17:49,200
master process<font color="#E5E5E5"> and no child processes</font>

316
00:17:46,080 --> 00:17:52,480
<font color="#E5E5E5">when there's pools thoughts so the</font>

317
00:17:49,200 --> 00:17:54,890
default value is<font color="#E5E5E5"> dynamic and dynamic</font>

318
00:17:52,480 --> 00:17:56,900
says<font color="#E5E5E5"> okay we have a master process and</font>

319
00:17:54,890 --> 00:17:59,890
we<font color="#E5E5E5"> have child processes waiting for</font>

320
00:17:56,900 --> 00:18:03,289
<font color="#CCCCCC">requests so and we say</font><font color="#E5E5E5"> okay you</font><font color="#CCCCCC"> can have</font>

321
00:17:59,890 --> 00:18:05,779
maximum<font color="#CCCCCC"> handle children</font><font color="#E5E5E5"> and you should</font>

322
00:18:03,289 --> 00:18:09,400
close<font color="#E5E5E5"> your children after 10 seconds of</font>

323
00:18:05,779 --> 00:18:12,679
idle time<font color="#E5E5E5"> so</font><font color="#CCCCCC"> it's</font><font color="#E5E5E5"> basically all we need</font>

324
00:18:09,400 --> 00:18:16,970
<font color="#E5E5E5">you just put that file in the</font>

325
00:18:12,679 --> 00:18:20,390
<font color="#E5E5E5">configuration folder or country of PHP</font><font color="#CCCCCC"> F</font>

326
00:18:16,970 --> 00:18:25,970
<font color="#E5E5E5">p.m. and restart PHP F p.m. and you're</font>

327
00:18:20,390 --> 00:18:28,870
good<font color="#E5E5E5"> to go</font><font color="#CCCCCC"> so um</font><font color="#E5E5E5"> when you are using the</font>

328
00:18:25,970 --> 00:18:31,909
client<font color="#E5E5E5"> now</font><font color="#CCCCCC"> I'm told it's the library now</font>

329
00:18:28,870 --> 00:18:34,250
<font color="#CCCCCC">we just</font><font color="#E5E5E5"> open a</font><font color="#CCCCCC"> new unique stock UNIX</font>

330
00:18:31,909 --> 00:18:36,950
domain socket with<font color="#E5E5E5"> the same path that</font><font color="#CCCCCC"> we</font>

331
00:18:34,250 --> 00:18:39,710
have<font color="#E5E5E5"> given in the pool configuration</font>

332
00:18:36,950 --> 00:18:42,950
yeah<font color="#CCCCCC"> that's the</font><font color="#E5E5E5"> only thing that you need</font>

333
00:18:39,710 --> 00:18:45,830
<font color="#E5E5E5">the we have read and write and connect</font>

334
00:18:42,950 --> 00:18:49,640
<font color="#E5E5E5">time outs here that</font><font color="#CCCCCC"> are</font><font color="#E5E5E5"> default values</font>

335
00:18:45,830 --> 00:18:52,908
so you<font color="#CCCCCC"> don't have</font><font color="#E5E5E5"> to give them and then</font>

336
00:18:49,640 --> 00:18:54,169
you<font color="#E5E5E5"> just</font><font color="#CCCCCC"> create the client so like I</font>

337
00:18:52,909 --> 00:18:56,630
said<font color="#E5E5E5"> you can do the same thing with a</font>

338
00:18:54,169 --> 00:19:00,529
<font color="#E5E5E5">network socket which is just another</font>

339
00:18:56,630 --> 00:19:02,770
class<font color="#CCCCCC"> yeah and just</font><font color="#E5E5E5"> give it an IP at the</font>

340
00:19:00,529 --> 00:19:02,770
port

341
00:19:04,750 --> 00:19:10,190
so yeah that would<font color="#CCCCCC"> be</font><font color="#E5E5E5"> the config for the</font>

342
00:19:07,820 --> 00:19:14,360
network socket<font color="#E5E5E5"> so it's basically the</font>

343
00:19:10,190 --> 00:19:17,630
<font color="#E5E5E5">same thing and now after we created the</font>

344
00:19:14,360 --> 00:19:22,510
client<font color="#E5E5E5"> yeah we</font><font color="#CCCCCC"> just can send a request</font>

345
00:19:17,630 --> 00:19:26,240
<font color="#CCCCCC">to a specific file on our</font><font color="#E5E5E5"> b2b</font><font color="#CCCCCC"> fpm server</font>

346
00:19:22,510 --> 00:19:28,789
so very important is that file path here

347
00:19:26,240 --> 00:19:32,750
it's like the script file that you<font color="#E5E5E5"> have</font>

348
00:19:28,789 --> 00:19:35,779
or<font color="#CCCCCC"> that your nginx calling on your</font><font color="#E5E5E5"> PHP</font>

349
00:19:32,750 --> 00:19:39,039
server<font color="#CCCCCC"> but you</font><font color="#E5E5E5"> don't have an engine X</font>

350
00:19:35,779 --> 00:19:39,039
and you don't<font color="#E5E5E5"> have document route</font>

351
00:19:39,260 --> 00:19:44,929
what was it called yeah document dude is

352
00:19:42,679 --> 00:19:49,100
not<font color="#E5E5E5"> replaced so that must be an absolute</font>

353
00:19:44,929 --> 00:19:50,750
<font color="#CCCCCC">path with no</font><font color="#E5E5E5"> past traversal in it and no</font>

354
00:19:49,100 --> 00:19:54,350
relative cost<font color="#E5E5E5"> so it must be an absolute</font>

355
00:19:50,750 --> 00:19:56,960
<font color="#E5E5E5">path on your server</font><font color="#CCCCCC"> otherwise PHP fbn</font>

356
00:19:54,350 --> 00:19:58,520
won't found it<font color="#E5E5E5"> because PHP</font><font color="#CCCCCC"> fbm has no</font>

357
00:19:56,960 --> 00:20:00,710
clue<font color="#CCCCCC"> about any document routes or</font>

358
00:19:58,520 --> 00:20:02,680
something like<font color="#E5E5E5"> that so I just need to</font>

359
00:20:00,710 --> 00:20:05,830
<font color="#E5E5E5">find that file on your file</font><font color="#CCCCCC"> system</font>

360
00:20:02,680 --> 00:20:08,620
so um yeah there's a big hint<font color="#E5E5E5"> and they</font>

361
00:20:05,830 --> 00:20:11,590
<font color="#CCCCCC">root me</font><font color="#E5E5E5"> because but I was failing</font>

362
00:20:08,620 --> 00:20:15,699
everyone<font color="#E5E5E5"> yeah and then you give the</font>

363
00:20:11,590 --> 00:20:19,899
content which is basically just a<font color="#E5E5E5"> URL</font>

364
00:20:15,700 --> 00:20:21,940
<font color="#E5E5E5">encoded string</font><font color="#CCCCCC"> and then you can send the</font>

365
00:20:19,900 --> 00:20:24,450
<font color="#CCCCCC">request and get a response</font><font color="#E5E5E5"> and get the</font>

366
00:20:21,940 --> 00:20:28,570
body<font color="#E5E5E5"> so in this case of course this is a</font>

367
00:20:24,450 --> 00:20:30,850
synchronous<font color="#E5E5E5"> requests I don't want just</font>

368
00:20:28,570 --> 00:20:33,120
<font color="#CCCCCC">to</font><font color="#E5E5E5"> show you how the response looks like</font>

369
00:20:30,850 --> 00:20:35,980
so<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is the</font><font color="#E5E5E5"> interface of the response</font>

370
00:20:33,120 --> 00:20:39,219
you get a request ID<font color="#E5E5E5"> you get the headers</font>

371
00:20:35,980 --> 00:20:41,530
back you can ask<font color="#E5E5E5"> for specific headers</font>

372
00:20:39,220 --> 00:20:43,360
<font color="#E5E5E5">you get the body you get the raw</font>

373
00:20:41,530 --> 00:20:45,910
response which is the<font color="#CCCCCC"> body including</font><font color="#E5E5E5"> the</font>

374
00:20:43,360 --> 00:20:47,740
headers<font color="#CCCCCC"> and</font><font color="#E5E5E5"> you get a duration and the</font>

375
00:20:45,910 --> 00:20:53,260
duration<font color="#E5E5E5"> is how long did your request</font>

376
00:20:47,740 --> 00:20:57,490
<font color="#E5E5E5">took from request to response so um</font>

377
00:20:53,260 --> 00:20:59,770
let's send an awesome request it's just

378
00:20:57,490 --> 00:21:02,320
another<font color="#E5E5E5"> method so send it I think and</font>

379
00:20:59,770 --> 00:21:07,000
<font color="#E5E5E5">this I think request will give you a</font>

380
00:21:02,320 --> 00:21:08,139
request<font color="#CCCCCC"> ID back which you can just print</font>

381
00:21:07,000 --> 00:21:10,450
out so in this case<font color="#CCCCCC"> it's a</font>

382
00:21:08,140 --> 00:21:14,170
fire-and-forget<font color="#CCCCCC"> so we don't do anything</font>

383
00:21:10,450 --> 00:21:17,890
with response if you want to get the

384
00:21:14,170 --> 00:21:20,860
response<font color="#CCCCCC"> um</font><font color="#E5E5E5"> you can say</font><font color="#CCCCCC"> okay sent the</font>

385
00:21:17,890 --> 00:21:23,770
request<font color="#E5E5E5"> awesome conversely do something</font>

386
00:21:20,860 --> 00:21:25,810
in the meanwhile and at the end of<font color="#CCCCCC"> your</font>

387
00:21:23,770 --> 00:21:29,500
script<font color="#E5E5E5"> just read the response for that</font>

388
00:21:25,810 --> 00:21:34,050
<font color="#E5E5E5">particular request ID and yeah print the</font>

389
00:21:29,500 --> 00:21:37,720
body so I have a short<font color="#CCCCCC"> demo later so um</font>

390
00:21:34,050 --> 00:21:41,440
at the end what I for example<font color="#E5E5E5"> added to</font>

391
00:21:37,720 --> 00:21:43,180
the library<font color="#E5E5E5"> is callbacks because that</font>

392
00:21:41,440 --> 00:21:44,620
was<font color="#E5E5E5"> the</font><font color="#CCCCCC"> first question when I published</font>

393
00:21:43,180 --> 00:21:46,510
a library<font color="#E5E5E5"> hey why are there are no</font>

394
00:21:44,620 --> 00:21:48,189
callbacks for responses<font color="#E5E5E5"> and because</font>

395
00:21:46,510 --> 00:21:50,620
<font color="#E5E5E5">everybody's using holidays in JavaScript</font>

396
00:21:48,190 --> 00:21:54,460
and well don't you use colleagues and

397
00:21:50,620 --> 00:21:57,189
PHP yeah<font color="#E5E5E5"> so you can for</font><font color="#CCCCCC"> each request you</font>

398
00:21:54,460 --> 00:22:00,700
<font color="#CCCCCC">can add a response Kovac and to failure</font>

399
00:21:57,190 --> 00:22:04,000
Kovac<font color="#CCCCCC"> so just like you know</font><font color="#E5E5E5"> it from</font>

400
00:22:00,700 --> 00:22:05,820
JavaScript maybe the response<font color="#CCCCCC"> Kovac of</font>

401
00:22:04,000 --> 00:22:08,200
course gives you the response<font color="#E5E5E5"> back</font><font color="#CCCCCC"> and</font>

402
00:22:05,820 --> 00:22:10,540
<font color="#CCCCCC">the failure callback will give you a</font>

403
00:22:08,200 --> 00:22:14,050
throwable<font color="#E5E5E5"> which can be any error or</font>

404
00:22:10,540 --> 00:22:16,240
exception and again<font color="#CCCCCC"> you</font><font color="#E5E5E5"> just have to</font>

405
00:22:14,050 --> 00:22:19,770
send a send<font color="#CCCCCC"> a link request</font>

406
00:22:16,240 --> 00:22:24,130
you will<font color="#E5E5E5"> automatically notified about</font>

407
00:22:19,770 --> 00:22:25,720
your<font color="#E5E5E5"> callback automatically notified and</font>

408
00:22:24,130 --> 00:22:29,350
later on I also edit a<font color="#CCCCCC"> path through</font>

409
00:22:25,720 --> 00:22:32,560
<font color="#E5E5E5">callback</font><font color="#CCCCCC"> because I had a use case where</font>

410
00:22:29,350 --> 00:22:35,199
<font color="#E5E5E5">I send something to the to the worker</font>

411
00:22:32,560 --> 00:22:38,080
script<font color="#E5E5E5"> in the background</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> I wanted to</font>

412
00:22:35,200 --> 00:22:42,130
stream<font color="#E5E5E5"> the output of that worker script</font>

413
00:22:38,080 --> 00:22:44,740
directly<font color="#E5E5E5"> to my browser</font><font color="#CCCCCC"> so and then</font>

414
00:22:42,130 --> 00:22:48,010
output<font color="#E5E5E5"> comes in buffers</font><font color="#CCCCCC"> of course</font>

415
00:22:44,740 --> 00:22:50,110
because PHP<font color="#E5E5E5"> is output buffering</font><font color="#CCCCCC"> and it's</font>

416
00:22:48,010 --> 00:22:53,320
<font color="#E5E5E5">really hard to completely disable output</font>

417
00:22:50,110 --> 00:22:56,070
buffering in PHP trust me

418
00:22:53,320 --> 00:22:59,470
yeah and that buffer is passed<font color="#CCCCCC"> to that</font>

419
00:22:56,070 --> 00:23:02,500
<font color="#CCCCCC">password</font><font color="#E5E5E5"> Kovac so you can handle on your</font>

420
00:22:59,470 --> 00:23:08,620
client<font color="#E5E5E5"> side or when a request aside also</font>

421
00:23:02,500 --> 00:23:10,870
<font color="#E5E5E5">the output of your worker so then there</font>

422
00:23:08,620 --> 00:23:14,500
are<font color="#E5E5E5"> multiple ways to wait for the</font>

423
00:23:10,870 --> 00:23:17,229
responses so if you just wait<font color="#CCCCCC"> just go</font>

424
00:23:14,500 --> 00:23:20,710
<font color="#E5E5E5">wait for</font><font color="#CCCCCC"> responses then your all your</font>

425
00:23:17,230 --> 00:23:23,740
callbacks will be notified<font color="#E5E5E5"> and it's</font>

426
00:23:20,710 --> 00:23:27,400
basically the<font color="#E5E5E5"> same as having a true</font>

427
00:23:23,740 --> 00:23:29,020
while true loop<font color="#E5E5E5"> asking if a particular</font>

428
00:23:27,400 --> 00:23:34,150
<font color="#E5E5E5">request ID has a response and then</font>

429
00:23:29,020 --> 00:23:36,520
handle the response<font color="#CCCCCC"> so</font><font color="#E5E5E5"> I chose to</font><font color="#CCCCCC"> yeah</font>

430
00:23:34,150 --> 00:23:38,710
have an inner and<font color="#CCCCCC"> an outer loop</font><font color="#E5E5E5"> so that</font>

431
00:23:36,520 --> 00:23:41,620
<font color="#CCCCCC">you can hide everything about looping</font>

432
00:23:38,710 --> 00:23:43,720
inside<font color="#CCCCCC"> of the client but if you already</font>

433
00:23:41,620 --> 00:23:45,399
have something like react PHP or

434
00:23:43,720 --> 00:23:47,650
something where<font color="#CCCCCC"> you already have a an</font>

435
00:23:45,400 --> 00:23:49,600
<font color="#E5E5E5">event loop or</font><font color="#CCCCCC"> something like that you</font>

436
00:23:47,650 --> 00:23:53,290
can integrate the client in that<font color="#E5E5E5"> loop</font>

437
00:23:49,600 --> 00:23:58,719
that's why we have multiple<font color="#E5E5E5"> methods to</font>

438
00:23:53,290 --> 00:24:05,260
yeah<font color="#CCCCCC"> ask for has a our</font><font color="#E5E5E5"> response ready or</font>

439
00:23:58,720 --> 00:24:08,350
not<font color="#E5E5E5"> so um that is a pretty</font><font color="#CCCCCC"> easy example</font>

440
00:24:05,260 --> 00:24:10,570
because<font color="#CCCCCC"> it's only one request</font><font color="#E5E5E5"> right so</font>

441
00:24:08,350 --> 00:24:15,159
but we<font color="#CCCCCC"> have multiple requests in our use</font>

442
00:24:10,570 --> 00:24:17,860
case what we can<font color="#CCCCCC"> do is we can collect</font>

443
00:24:15,160 --> 00:24:21,910
<font color="#E5E5E5">our request IDs from the async request</font>

444
00:24:17,860 --> 00:24:25,290
from from the<font color="#E5E5E5"> request can print them out</font>

445
00:24:21,910 --> 00:24:28,450
<font color="#CCCCCC">and say ok read all the ready responses</font>

446
00:24:25,290 --> 00:24:29,730
from the source request IDs and print

447
00:24:28,450 --> 00:24:34,149
their body

448
00:24:29,730 --> 00:24:39,070
the problem here is that will<font color="#E5E5E5"> be end up</font>

449
00:24:34,149 --> 00:24:41,110
in sequential<font color="#E5E5E5"> responding so the response</font>

450
00:24:39,070 --> 00:24:44,379
<font color="#E5E5E5">will</font><font color="#CCCCCC"> be look like this so the first</font>

451
00:24:41,110 --> 00:24:46,269
<font color="#E5E5E5">request will respond respond first the</font>

452
00:24:44,379 --> 00:24:48,730
second second and the third<font color="#CCCCCC"> touch</font><font color="#E5E5E5"> and so</font>

453
00:24:46,269 --> 00:24:52,809
<font color="#E5E5E5">on so no matter how</font><font color="#CCCCCC"> long</font><font color="#E5E5E5"> each worker</font>

454
00:24:48,730 --> 00:24:58,210
needs to do their job<font color="#CCCCCC"> the responses</font><font color="#E5E5E5"> will</font>

455
00:24:52,809 --> 00:25:01,750
come in the same order as<font color="#CCCCCC"> the request so</font>

456
00:24:58,210 --> 00:25:04,899
that's maybe not<font color="#E5E5E5"> that what we want it</font>

457
00:25:01,750 --> 00:25:06,940
because<font color="#E5E5E5"> we want to save time and if one</font>

458
00:25:04,899 --> 00:25:11,110
worker is faster than the<font color="#CCCCCC"> other then you</font>

459
00:25:06,940 --> 00:25:14,950
<font color="#CCCCCC">should also respond faster and that is</font>

460
00:25:11,110 --> 00:25:17,139
what we call reactive yeah so what you

461
00:25:14,950 --> 00:25:21,220
can do is do the<font color="#CCCCCC"> same thing</font><font color="#E5E5E5"> send three</font>

462
00:25:17,139 --> 00:25:24,789
requests and you can say<font color="#CCCCCC"> okay</font><font color="#E5E5E5"> I will</font>

463
00:25:21,220 --> 00:25:26,559
<font color="#E5E5E5">wait</font><font color="#CCCCCC"> for unhindered responses or</font><font color="#E5E5E5"> until</font>

464
00:25:24,789 --> 00:25:29,169
there are no under and<font color="#CCCCCC"> hundred responses</font>

465
00:25:26,559 --> 00:25:35,230
<font color="#E5E5E5">anymore</font><font color="#CCCCCC"> and then read the ready</font>

466
00:25:29,169 --> 00:25:40,000
responses<font color="#CCCCCC"> it's the same thing as again</font>

467
00:25:35,230 --> 00:25:42,250
it's in an<font color="#E5E5E5"> outer loop strategy and that</font>

468
00:25:40,000 --> 00:25:46,230
<font color="#E5E5E5">would end</font><font color="#CCCCCC"> up</font><font color="#E5E5E5"> in this for</font><font color="#CCCCCC"> example</font><font color="#E5E5E5"> so if</font>

469
00:25:42,250 --> 00:25:50,590
the second requests<font color="#E5E5E5"> is the fastest one</font>

470
00:25:46,230 --> 00:25:53,919
<font color="#E5E5E5">we will</font><font color="#CCCCCC"> have</font><font color="#E5E5E5"> different order</font><font color="#CCCCCC"> of the</font>

471
00:25:50,590 --> 00:25:59,620
responses and it's<font color="#E5E5E5"> it overall it</font><font color="#CCCCCC"> is</font>

472
00:25:53,919 --> 00:26:01,120
faster because let's<font color="#E5E5E5"> assume this yeah</font>

473
00:25:59,620 --> 00:26:05,529
the first one<font color="#E5E5E5"> is the slowest</font><font color="#CCCCCC"> one</font><font color="#E5E5E5"> so</font>

474
00:26:01,120 --> 00:26:07,830
let's assume in the previous output when

475
00:26:05,529 --> 00:26:10,210
the<font color="#E5E5E5"> first one is the slowest</font><font color="#CCCCCC"> one</font>

476
00:26:07,830 --> 00:26:11,620
<font color="#E5E5E5">everybody else all the</font><font color="#CCCCCC"> other responses</font>

477
00:26:10,210 --> 00:26:15,190
have<font color="#E5E5E5"> to wait until the first one is</font>

478
00:26:11,620 --> 00:26:17,320
<font color="#E5E5E5">finished and then we'll print their</font>

479
00:26:15,190 --> 00:26:21,639
results<font color="#E5E5E5"> and in this case we will get the</font>

480
00:26:17,320 --> 00:26:23,379
second<font color="#CCCCCC"> one as first so this is</font><font color="#E5E5E5"> all a pie</font>

481
00:26:21,639 --> 00:26:27,370
response time and this is exactly<font color="#CCCCCC"> what</font>

482
00:26:23,379 --> 00:26:30,850
<font color="#CCCCCC">we want so yeah like</font><font color="#E5E5E5"> I said again this</font>

483
00:26:27,370 --> 00:26:34,600
is in an outer loop so<font color="#CCCCCC"> we can say</font><font color="#E5E5E5"> wait</font>

484
00:26:30,850 --> 00:26:35,909
<font color="#E5E5E5">for all the responses or</font><font color="#CCCCCC"> off for 100</font>

485
00:26:34,600 --> 00:26:39,330
<font color="#E5E5E5">responses and</font>

486
00:26:35,910 --> 00:26:43,200
and of the<font color="#E5E5E5"> rail responses</font><font color="#CCCCCC"> so you see we</font>

487
00:26:39,330 --> 00:26:46,230
have different namings here for weight

488
00:26:43,200 --> 00:26:49,410
<font color="#CCCCCC">and handle and read and so on so always</font>

489
00:26:46,230 --> 00:26:52,020
when you see a reed method<font color="#CCCCCC"> it tries to</font>

490
00:26:49,410 --> 00:26:55,230
read the response directly<font color="#E5E5E5"> and the</font>

491
00:26:52,020 --> 00:26:58,220
handle or returns the response and the

492
00:26:55,230 --> 00:27:03,270
handler methods<font color="#CCCCCC"> are calling the</font>

493
00:26:58,220 --> 00:27:05,309
callbacks<font color="#E5E5E5"> so if you at any convex you</font>

494
00:27:03,270 --> 00:27:11,120
will<font color="#E5E5E5"> need to have to use the</font><font color="#CCCCCC"> handler</font>

495
00:27:05,309 --> 00:27:11,120
methods so<font color="#E5E5E5"> okay I</font><font color="#CCCCCC"> promise a quick demo</font>

496
00:27:12,169 --> 00:27:19,770
yeah<font color="#E5E5E5"> so I'm a Beckett developer so I</font>

497
00:27:16,679 --> 00:27:24,299
suck at front-end and I just want to

498
00:27:19,770 --> 00:27:28,230
show you so basically the fondant of our

499
00:27:24,299 --> 00:27:30,570
web service I can create a<font color="#E5E5E5"> single PDF on</font>

500
00:27:28,230 --> 00:27:40,830
the right<font color="#E5E5E5"> side is</font><font color="#CCCCCC"> the output</font><font color="#E5E5E5"> of the PHP</font>

501
00:27:30,570 --> 00:27:43,080
<font color="#CCCCCC">fpm pool in real time</font><font color="#E5E5E5"> hopefully yeah so</font>

502
00:27:40,830 --> 00:27:45,090
there's a background<font color="#E5E5E5"> pool client that</font><font color="#CCCCCC"> it</font>

503
00:27:43,080 --> 00:27:49,970
<font color="#CCCCCC">spawned</font><font color="#E5E5E5"> and it's going away after a</font>

504
00:27:45,090 --> 00:27:49,970
couple<font color="#CCCCCC"> of seconds</font><font color="#E5E5E5"> because I told him so</font>

505
00:27:50,030 --> 00:27:58,080
now we have the<font color="#CCCCCC"> example with multiple</font>

506
00:27:53,429 --> 00:28:01,980
PDF creations but in the<font color="#CCCCCC"> yeah in the</font>

507
00:27:58,080 --> 00:28:08,100
same<font color="#E5E5E5"> order as the requests so as you can</font>

508
00:28:01,980 --> 00:28:09,750
<font color="#E5E5E5">see we have 21 processes now yeah and it</font>

509
00:28:08,100 --> 00:28:13,289
takes<font color="#E5E5E5"> some time because there's a random</font>

510
00:28:09,750 --> 00:28:15,980
sleep in the worker so all the requests

511
00:28:13,289 --> 00:28:17,760
are<font color="#CCCCCC"> having different lengths</font>

512
00:28:15,980 --> 00:28:25,919
actually they're all<font color="#E5E5E5"> doing the same</font>

513
00:28:17,760 --> 00:28:27,809
<font color="#E5E5E5">thing</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> we need roughly 19 seconds yeah</font>

514
00:28:25,919 --> 00:28:30,049
let's wait until<font color="#E5E5E5"> the workers are going</font>

515
00:28:27,809 --> 00:28:30,049
<font color="#CCCCCC">away</font>

516
00:28:37,210 --> 00:28:45,700
and now we have the multi requests<font color="#E5E5E5"> in</font>

517
00:28:41,500 --> 00:28:53,050
reactive<font color="#CCCCCC"> order so as you can see the</font>

518
00:28:45,700 --> 00:28:56,650
numbers are not in<font color="#CCCCCC"> order and we need</font>

519
00:28:53,050 --> 00:29:02,980
hopefully very much less time yeah

520
00:28:56,650 --> 00:29:06,000
<font color="#CCCCCC">12 seconds okay before we 8 seconds so</font>

521
00:29:02,980 --> 00:29:20,380
<font color="#E5E5E5">it was very</font><font color="#CCCCCC"> long sir</font>

522
00:29:06,000 --> 00:29:23,550
<font color="#E5E5E5">okay</font><font color="#CCCCCC"> and we actually created so we just</font>

523
00:29:20,380 --> 00:29:26,520
created<font color="#CCCCCC"> a lot of PDFs in the background</font>

524
00:29:23,550 --> 00:29:35,350
<font color="#E5E5E5">actually while there was no PDF because</font>

525
00:29:26,520 --> 00:29:36,879
<font color="#CCCCCC">VK w K HTML</font><font color="#E5E5E5"> to PDF library sucks it</font>

526
00:29:35,350 --> 00:29:39,310
cannot have a so<font color="#E5E5E5"> many requests in the</font>

527
00:29:36,880 --> 00:29:43,330
<font color="#E5E5E5">same time yeah so</font><font color="#CCCCCC"> as you as you</font><font color="#E5E5E5"> have</font>

528
00:29:39,310 --> 00:29:45,460
seen there it's<font color="#E5E5E5"> very little</font>

529
00:29:43,330 --> 00:29:47,230
configuration that<font color="#E5E5E5"> you have to do and</font>

530
00:29:45,460 --> 00:29:49,030
probably<font color="#E5E5E5"> its configuration that you</font>

531
00:29:47,230 --> 00:29:53,140
already<font color="#E5E5E5"> know because you have set up a</font>

532
00:29:49,030 --> 00:29:55,330
<font color="#E5E5E5">PHP</font><font color="#CCCCCC"> fpm pool that library you just have</font>

533
00:29:53,140 --> 00:29:57,010
to pull by a composer and then you can

534
00:29:55,330 --> 00:29:59,889
play<font color="#E5E5E5"> around with the</font><font color="#CCCCCC"> requests of the</font>

535
00:29:57,010 --> 00:30:03,930
<font color="#E5E5E5">responses and can do things in the</font>

536
00:29:59,890 --> 00:30:03,930
meanwhile any<font color="#E5E5E5"> questions</font>

