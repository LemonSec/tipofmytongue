1
00:00:05,040 --> 00:00:08,240
hello everyone welcome to texas cyber

2
00:00:08,240 --> 00:00:10,080
summit i hope that you're going to have

3
00:00:10,080 --> 00:00:12,480
a great summit this is one of the first

4
00:00:12,480 --> 00:00:15,200
talk that you are able to see and i hope

5
00:00:15,200 --> 00:00:16,880
that you'll enjoy it

6
00:00:16,880 --> 00:00:20,160
my name is matsusonye and as tanya jenka

7
00:00:20,160 --> 00:00:21,840
would put it this is the slide where i'm

8
00:00:21,840 --> 00:00:24,640
supposed to tell you why i'm fit to pro

9
00:00:24,640 --> 00:00:27,119
to give my own talk

10
00:00:27,119 --> 00:00:29,519
i'm a technical director of advanced

11
00:00:29,519 --> 00:00:32,960
security at syntax system we are a

12
00:00:32,960 --> 00:00:36,640
managed erp company and we also offer

13
00:00:36,640 --> 00:00:38,960
managed security services for our

14
00:00:38,960 --> 00:00:40,160
customer

15
00:00:40,160 --> 00:00:42,800
i'm also a core mentor for defcon blue

16
00:00:42,800 --> 00:00:44,559
team village

17
00:00:44,559 --> 00:00:46,800
i specialized in tread hunting and

18
00:00:46,800 --> 00:00:49,920
adversary detection i love giving talks

19
00:00:49,920 --> 00:00:53,039
and i had the honor to do so at derbycon

20
00:00:53,039 --> 00:00:56,000
defcon blue team village nordsec

21
00:00:56,000 --> 00:00:59,120
sector a few b-sides and even some sam

22
00:00:59,120 --> 00:01:01,199
summit this year

23
00:01:01,199 --> 00:01:05,360
you can find me on twitter at scooby-mtl

24
00:01:05,360 --> 00:01:06,720
now this is what we're going to talk

25
00:01:06,720 --> 00:01:08,880
about today so this is what i call the

26
00:01:08,880 --> 00:01:11,119
full circle detection

27
00:01:11,119 --> 00:01:13,680
so we're going to start with an idea or

28
00:01:13,680 --> 00:01:15,680
what we call sometimes interesting the

29
00:01:15,680 --> 00:01:17,200
hypothesis

30
00:01:17,200 --> 00:01:18,560
then we're going to see how we can

31
00:01:18,560 --> 00:01:20,560
generate events

32
00:01:20,560 --> 00:01:21,520
on

33
00:01:21,520 --> 00:01:23,360
like automatically and all the time

34
00:01:23,360 --> 00:01:25,040
whenever we need them

35
00:01:25,040 --> 00:01:27,920
we can build detections

36
00:01:27,920 --> 00:01:29,680
how we can actually share those

37
00:01:29,680 --> 00:01:31,920
detection with the community because

38
00:01:31,920 --> 00:01:33,920
sharing is caring

39
00:01:33,920 --> 00:01:35,600
then we're going to see how we can do

40
00:01:35,600 --> 00:01:38,960
some continuous testing of our detection

41
00:01:38,960 --> 00:01:41,600
how we can build effective incident

42
00:01:41,600 --> 00:01:43,600
response playbooks

43
00:01:43,600 --> 00:01:47,040
and finally how we can act train our

44
00:01:47,040 --> 00:01:49,920
analysts in order to be able to properly

45
00:01:49,920 --> 00:01:52,399
respond to those detection that we are

46
00:01:52,399 --> 00:01:54,560
building

47
00:01:54,560 --> 00:01:56,960
now i've just added this uh

48
00:01:56,960 --> 00:02:00,320
screen here this uh this slide i mean um

49
00:02:00,320 --> 00:02:02,240
and this slide starts with the threat

50
00:02:02,240 --> 00:02:04,320
and thing in its center even though if

51
00:02:04,320 --> 00:02:05,200
it's

52
00:02:05,200 --> 00:02:08,000
under and it's show you how the

53
00:02:08,000 --> 00:02:09,199
different

54
00:02:09,199 --> 00:02:12,480
piece of security operation center or or

55
00:02:12,480 --> 00:02:16,160
setups actually interact with each other

56
00:02:16,160 --> 00:02:19,200
so first of all tread hunting is often

57
00:02:19,200 --> 00:02:20,959
an input

58
00:02:20,959 --> 00:02:23,599
of the incident response process

59
00:02:23,599 --> 00:02:25,599
it also feeds up vulnerability

60
00:02:25,599 --> 00:02:27,760
management if there's any vulnerability

61
00:02:27,760 --> 00:02:30,239
that are found or misconfiguration that

62
00:02:30,239 --> 00:02:33,360
that can easily be abused by an attacker

63
00:02:33,360 --> 00:02:35,680
it also feeds of course detection

64
00:02:35,680 --> 00:02:37,440
engineering like we're going to see in

65
00:02:37,440 --> 00:02:39,840
this presentation

66
00:02:39,840 --> 00:02:43,040
and then threat hunting itself is fed by

67
00:02:43,040 --> 00:02:45,760
a threat intel of course and by

68
00:02:45,760 --> 00:02:50,400
offensive security that will provide

69
00:02:50,400 --> 00:02:53,519
so tactic techniques and procedures

70
00:02:53,519 --> 00:02:55,519
and here just for

71
00:02:55,519 --> 00:02:58,000
the sake of being more complete here are

72
00:02:58,000 --> 00:03:00,159
the other links between all of those

73
00:03:00,159 --> 00:03:02,879
things uh someone doubted this slide the

74
00:03:02,879 --> 00:03:05,440
olympic ring of infosec

75
00:03:05,440 --> 00:03:07,120
i like the name so

76
00:03:07,120 --> 00:03:09,280
you can use it

77
00:03:09,280 --> 00:03:11,680
if you like what you see here

78
00:03:11,680 --> 00:03:16,159
roberto rodriguez did a keynote at sans

79
00:03:16,159 --> 00:03:18,480
threat hunting summit and he talks about

80
00:03:18,480 --> 00:03:21,440
some of those things in in other words

81
00:03:21,440 --> 00:03:23,760
so not very surprising i didn't see a

82
00:03:23,760 --> 00:03:25,440
stock when i presented this i actually

83
00:03:25,440 --> 00:03:27,920
presented this just before his talk

84
00:03:27,920 --> 00:03:29,200
this slide

85
00:03:29,200 --> 00:03:32,159
but um yeah it's not very surprising

86
00:03:32,159 --> 00:03:34,720
that we think i like roberto is a very

87
00:03:34,720 --> 00:03:37,519
strong inspiration for me and his work

88
00:03:37,519 --> 00:03:40,640
and also his work ethic of course

89
00:03:40,640 --> 00:03:42,159
um

90
00:03:42,159 --> 00:03:43,440
now

91
00:03:43,440 --> 00:03:46,080
if you haven't noticed this is a venom

92
00:03:46,080 --> 00:03:47,200
themed

93
00:03:47,200 --> 00:03:49,599
presentation and these full screen

94
00:03:49,599 --> 00:03:51,599
picture are here solely so i can drink

95
00:03:51,599 --> 00:03:54,798
water on the list

96
00:03:57,280 --> 00:03:59,840
so let's start with the idea or the

97
00:03:59,840 --> 00:04:02,640
hypothesis there's a ton of places where

98
00:04:02,640 --> 00:04:05,439
you can actually get ideas on what to

99
00:04:05,439 --> 00:04:08,319
hunt for my favorite is twitter there's

100
00:04:08,319 --> 00:04:10,000
always a lot of people on twitter that

101
00:04:10,000 --> 00:04:11,760
shares very good

102
00:04:11,760 --> 00:04:14,640
information very good ideas even some

103
00:04:14,640 --> 00:04:16,000
queries

104
00:04:16,000 --> 00:04:17,680
some people say there's too much drama

105
00:04:17,680 --> 00:04:19,839
on twitter i would argue that it really

106
00:04:19,839 --> 00:04:21,839
depends on who you are following

107
00:04:21,839 --> 00:04:23,440
i try to keep my

108
00:04:23,440 --> 00:04:25,680
the people i follow to a very

109
00:04:25,680 --> 00:04:29,040
low number and i'm usually very easily

110
00:04:29,040 --> 00:04:31,840
steer away from all of the drum

111
00:04:31,840 --> 00:04:34,479
another great place to

112
00:04:34,479 --> 00:04:37,440
get ideas for hunting is mitre attack

113
00:04:37,440 --> 00:04:38,960
framework

114
00:04:38,960 --> 00:04:40,800
also other places that i like to look

115
00:04:40,800 --> 00:04:43,680
for are some slack community for example

116
00:04:43,680 --> 00:04:45,759
the blood down slack and the tread

117
00:04:45,759 --> 00:04:48,080
hunting slack if you need invitation for

118
00:04:48,080 --> 00:04:50,800
those let me know i can provide them at

119
00:04:50,800 --> 00:04:52,960
the end of this talk there's also now a

120
00:04:52,960 --> 00:04:55,600
lot of community that moved from slack

121
00:04:55,600 --> 00:04:57,680
towards this card and it's the case from

122
00:04:57,680 --> 00:04:59,120
trusted sec

123
00:04:59,120 --> 00:05:01,199
black hills and fosek

124
00:05:01,199 --> 00:05:03,680
and the defcon blue theme village again

125
00:05:03,680 --> 00:05:05,759
if you need invitation for those i'll be

126
00:05:05,759 --> 00:05:08,080
able to provide them

127
00:05:08,080 --> 00:05:09,600
there's also a lot of people that likes

128
00:05:09,600 --> 00:05:13,840
to go through um infosec news website

129
00:05:13,840 --> 00:05:16,880
um i use them a lot less but

130
00:05:16,880 --> 00:05:19,280
they're still very valid points usually

131
00:05:19,280 --> 00:05:22,000
i see the art the interesting article or

132
00:05:22,000 --> 00:05:25,759
posted in twitter then i go read them um

133
00:05:25,759 --> 00:05:26,960
so yeah

134
00:05:26,960 --> 00:05:28,800
and you might be lucky enough to have

135
00:05:28,800 --> 00:05:32,080
your own uh internal threat intel team

136
00:05:32,080 --> 00:05:35,120
or maybe you're buying a tread feed from

137
00:05:35,120 --> 00:05:37,360
a third party vendor so those are also

138
00:05:37,360 --> 00:05:39,520
other good places to

139
00:05:39,520 --> 00:05:41,840
start and get some ideas on what to hunt

140
00:05:41,840 --> 00:05:44,080
for

141
00:05:44,479 --> 00:05:46,720
so in this talk we're going to start

142
00:05:46,720 --> 00:05:49,680
with the hypothesis from an article that

143
00:05:49,680 --> 00:05:52,800
was published by mdsec the article was

144
00:05:52,800 --> 00:05:55,440
called a fresh outlook on mail-based

145
00:05:55,440 --> 00:05:57,759
persistence if you haven't read this

146
00:05:57,759 --> 00:06:00,160
article this is the link it is an

147
00:06:00,160 --> 00:06:02,080
extremely good

148
00:06:02,080 --> 00:06:04,720
article i highly suggest you read it

149
00:06:04,720 --> 00:06:07,199
it's now almost a year old

150
00:06:07,199 --> 00:06:09,440
but it's still very relevant and very

151
00:06:09,440 --> 00:06:12,479
interesting to read the tldr of this

152
00:06:12,479 --> 00:06:15,680
article is that you can create macro as

153
00:06:15,680 --> 00:06:18,479
a user with just the user permission

154
00:06:18,479 --> 00:06:20,720
that will control

155
00:06:20,720 --> 00:06:22,960
what happens when outlook receive an

156
00:06:22,960 --> 00:06:25,520
email so basically each time you receive

157
00:06:25,520 --> 00:06:28,000
an email you can actually launch a vba

158
00:06:28,000 --> 00:06:30,240
script that will execute any type of

159
00:06:30,240 --> 00:06:32,479
command for example establishing a

160
00:06:32,479 --> 00:06:34,800
reverse connection

161
00:06:34,800 --> 00:06:36,880
or a connection to your c2 to your

162
00:06:36,880 --> 00:06:39,199
infrastructure install the service

163
00:06:39,199 --> 00:06:41,280
whatever you can think of because with

164
00:06:41,280 --> 00:06:43,680
vba you can run powershell and then of

165
00:06:43,680 --> 00:06:44,639
course

166
00:06:44,639 --> 00:06:46,080
we all know what you can do with

167
00:06:46,080 --> 00:06:47,680
powershell which is pretty much

168
00:06:47,680 --> 00:06:50,560
everything that you can think about

169
00:06:50,560 --> 00:06:52,319
in our test

170
00:06:52,319 --> 00:06:54,160
this

171
00:06:54,160 --> 00:06:58,319
bypassed our edr and we successfully pop

172
00:06:58,319 --> 00:07:00,080
calc.exe

173
00:07:00,080 --> 00:07:03,360
so let's get into um the gist of it so

174
00:07:03,360 --> 00:07:06,160
here is the exploit that you need to put

175
00:07:06,160 --> 00:07:08,960
in the vba project.otm i don't mean

176
00:07:08,960 --> 00:07:11,280
sorry not the exploit but the code

177
00:07:11,280 --> 00:07:14,080
um and as you can see here this is where

178
00:07:14,080 --> 00:07:17,360
uh when you receive uh when you receive

179
00:07:17,360 --> 00:07:18,160
a

180
00:07:18,160 --> 00:07:21,039
an email with the subject md sec you

181
00:07:21,039 --> 00:07:23,280
actually pop a box that says hack the

182
00:07:23,280 --> 00:07:26,319
planet and also run

183
00:07:26,319 --> 00:07:29,039
calc from the shell and then it deletes

184
00:07:29,039 --> 00:07:31,680
the email so three things that are done

185
00:07:31,680 --> 00:07:34,720
whenever an email is received with mdsec

186
00:07:34,720 --> 00:07:37,520
so in our cases that's what we did

187
00:07:37,520 --> 00:07:39,759
um and

188
00:07:39,759 --> 00:07:41,759
and then we started looking

189
00:07:41,759 --> 00:07:43,599
we're looking for that sorry and then we

190
00:07:43,599 --> 00:07:45,840
start

191
00:07:45,840 --> 00:07:49,039
i'm sorry i'll start this slide again

192
00:07:49,039 --> 00:07:50,720
so because i'm desect are such great

193
00:07:50,720 --> 00:07:52,960
folks in all of their article they also

194
00:07:52,960 --> 00:07:55,440
includes what you need to look for for

195
00:07:55,440 --> 00:07:56,800
the detection

196
00:07:56,800 --> 00:07:59,199
so here there's two things that you need

197
00:07:59,199 --> 00:08:01,520
to look for first of all

198
00:08:01,520 --> 00:08:06,639
the creation or modification of the file

199
00:08:06,800 --> 00:08:09,599
vba project dot otm

200
00:08:09,599 --> 00:08:11,120
and the

201
00:08:11,120 --> 00:08:13,759
modification or creation of the registry

202
00:08:13,759 --> 00:08:16,560
key that is listed here and specifically

203
00:08:16,560 --> 00:08:19,759
if the value is put to one because one

204
00:08:19,759 --> 00:08:23,840
is the value for a run without

205
00:08:23,840 --> 00:08:26,840
notification

206
00:08:27,280 --> 00:08:28,960
if you don't have sysmon here's the

207
00:08:28,960 --> 00:08:31,199
sysmon ids but if you don't have sysmod

208
00:08:31,199 --> 00:08:32,799
you can still detect those thing with

209
00:08:32,799 --> 00:08:36,240
any good edr or with the windows

210
00:08:36,240 --> 00:08:38,719
event log system so there's no

211
00:08:38,719 --> 00:08:40,799
no real reason nothing really holding

212
00:08:40,799 --> 00:08:41,599
you

213
00:08:41,599 --> 00:08:43,360
forcing you to have cis month for this

214
00:08:43,360 --> 00:08:46,399
specific detection

215
00:08:46,399 --> 00:08:49,040
so what we did we did what i called a

216
00:08:49,040 --> 00:08:51,200
group hunt or some people call it an

217
00:08:51,200 --> 00:08:53,200
expedition so

218
00:08:53,200 --> 00:08:55,680
every two weeks we have an hour of

219
00:08:55,680 --> 00:08:58,800
learning um that we call we learn

220
00:08:58,800 --> 00:09:00,160
wednesdays

221
00:09:00,160 --> 00:09:03,519
um and then we read the article and then

222
00:09:03,519 --> 00:09:05,519
we started looking for the artifact in

223
00:09:05,519 --> 00:09:08,160
our environment

224
00:09:08,160 --> 00:09:10,640
luckily we didn't find any so our

225
00:09:10,640 --> 00:09:12,959
environment seemed to be clean and then

226
00:09:12,959 --> 00:09:14,720
we started planting the evidence so we

227
00:09:14,720 --> 00:09:17,920
modified the registry and we edited the

228
00:09:17,920 --> 00:09:20,640
vba project to copy the code that was in

229
00:09:20,640 --> 00:09:23,600
the mdsec article then we

230
00:09:23,600 --> 00:09:26,640
sent an email we pop calc as i mentioned

231
00:09:26,640 --> 00:09:28,959
earlier and then we hunt

232
00:09:28,959 --> 00:09:31,200
again using our queries and now sure

233
00:09:31,200 --> 00:09:33,600
enough the event was there so that was a

234
00:09:33,600 --> 00:09:35,440
very interesting i think everybody in

235
00:09:35,440 --> 00:09:39,440
the team learned a lot um even myself if

236
00:09:39,440 --> 00:09:41,839
i even if i was leading that tripod

237
00:09:41,839 --> 00:09:43,120
thing and there's a lot of things that i

238
00:09:43,120 --> 00:09:46,399
didn't knew i was really new um in my

239
00:09:46,399 --> 00:09:48,480
team at that time and i didn't know

240
00:09:48,480 --> 00:09:51,440
very much how the scene was working and

241
00:09:51,440 --> 00:09:53,600
doing that allowed me to understand more

242
00:09:53,600 --> 00:09:55,600
how to build query for this particular

243
00:09:55,600 --> 00:09:58,480
scene so everybody was winning and it's

244
00:09:58,480 --> 00:10:02,760
very interesting activity

245
00:10:10,160 --> 00:10:11,200
now

246
00:10:11,200 --> 00:10:12,640
um

247
00:10:12,640 --> 00:10:15,360
when you do your hunting do you find any

248
00:10:15,360 --> 00:10:16,399
event

249
00:10:16,399 --> 00:10:17,760
well actually when we're tread time

250
00:10:17,760 --> 00:10:20,079
thing we kind of hope that we won't find

251
00:10:20,079 --> 00:10:21,920
anything because if we do

252
00:10:21,920 --> 00:10:24,800
and it's often time a compromision and

253
00:10:24,800 --> 00:10:26,640
nobody likes to

254
00:10:26,640 --> 00:10:29,360
start an incident response full scale or

255
00:10:29,360 --> 00:10:31,279
you need to deal with the false positive

256
00:10:31,279 --> 00:10:33,440
which is not always fun

257
00:10:33,440 --> 00:10:33,860
um

258
00:10:33,860 --> 00:10:35,519
[Music]

259
00:10:35,519 --> 00:10:37,600
and if you don't find anything doesn't

260
00:10:37,600 --> 00:10:40,000
mean also that your query are not good

261
00:10:40,000 --> 00:10:41,760
like we saw in our own example we're

262
00:10:41,760 --> 00:10:43,839
looking for something we generated the

263
00:10:43,839 --> 00:10:46,959
events and then we found

264
00:10:46,959 --> 00:10:49,360
the traces using the the same query we

265
00:10:49,360 --> 00:10:51,519
used before

266
00:10:51,519 --> 00:10:54,079
so how can we easily generate event kind

267
00:10:54,079 --> 00:10:55,760
of on demand

268
00:10:55,760 --> 00:10:58,399
well there's the atomic red team project

269
00:10:58,399 --> 00:11:01,200
that is built exactly for that these are

270
00:11:01,200 --> 00:11:03,279
highly portable tests

271
00:11:03,279 --> 00:11:05,839
very modular that you can run

272
00:11:05,839 --> 00:11:08,720
at will in your environment

273
00:11:08,720 --> 00:11:10,640
and generate events

274
00:11:10,640 --> 00:11:13,200
so i'm going to look a little bit how we

275
00:11:13,200 --> 00:11:16,480
can build an atomic red team test so

276
00:11:16,480 --> 00:11:19,600
this is an existing test that looks very

277
00:11:19,600 --> 00:11:22,160
much like the one that we want to create

278
00:11:22,160 --> 00:11:24,079
so i took this

279
00:11:24,079 --> 00:11:25,760
and then

280
00:11:25,760 --> 00:11:27,600
this is what i created here as you can

281
00:11:27,600 --> 00:11:29,279
see i just had to

282
00:11:29,279 --> 00:11:32,560
change the attack technique id the name

283
00:11:32,560 --> 00:11:35,279
the description which was very easy and

284
00:11:35,279 --> 00:11:36,640
then

285
00:11:36,640 --> 00:11:39,120
right here is the command or the core of

286
00:11:39,120 --> 00:11:41,920
the test so it's three command and it's

287
00:11:41,920 --> 00:11:43,200
three

288
00:11:43,200 --> 00:11:44,399
windows

289
00:11:44,399 --> 00:11:46,800
command line so

290
00:11:46,800 --> 00:11:49,040
registry add and then we add our

291
00:11:49,040 --> 00:11:51,040
registry key with the value of one to be

292
00:11:51,040 --> 00:11:53,760
able to run the macro without generating

293
00:11:53,760 --> 00:11:55,279
any events

294
00:11:55,279 --> 00:11:56,880
any alerts sorry

295
00:11:56,880 --> 00:12:00,079
and then we make a directory the

296
00:12:00,079 --> 00:12:02,639
app data microsoft outlook

297
00:12:02,639 --> 00:12:05,839
and then we create a fake file called

298
00:12:05,839 --> 00:12:07,760
vba.otm

299
00:12:07,760 --> 00:12:09,920
in this type of test we don't need a

300
00:12:09,920 --> 00:12:11,040
working

301
00:12:11,040 --> 00:12:12,399
vba

302
00:12:12,399 --> 00:12:15,120
or a working otn we just need to see if

303
00:12:15,120 --> 00:12:16,959
we can catch the creation or

304
00:12:16,959 --> 00:12:20,320
modification of that file

305
00:12:20,320 --> 00:12:22,000
and then down here there's the cleanup

306
00:12:22,000 --> 00:12:23,839
fit so this is what you run

307
00:12:23,839 --> 00:12:25,760
after you've run your test after your

308
00:12:25,760 --> 00:12:27,279
detection and

309
00:12:27,279 --> 00:12:28,959
cut the

310
00:12:28,959 --> 00:12:31,920
events and here we are deleting our

311
00:12:31,920 --> 00:12:35,120
registry key and we are also deleting

312
00:12:35,120 --> 00:12:37,440
the otm file

313
00:12:37,440 --> 00:12:39,200
most of your computer won't have that

314
00:12:39,200 --> 00:12:41,839
file but be careful to not run these

315
00:12:41,839 --> 00:12:43,680
tests on production

316
00:12:43,680 --> 00:12:45,760
because this is deleting everything

317
00:12:45,760 --> 00:12:48,079
whether there was something before or

318
00:12:48,079 --> 00:12:48,880
not

319
00:12:48,880 --> 00:12:51,360
so if you run this on

320
00:12:51,360 --> 00:12:52,720
on the computer of someone and he

321
00:12:52,720 --> 00:12:55,600
actually has some macros legit macros in

322
00:12:55,600 --> 00:12:58,800
vba project.ltm you'll just delete them

323
00:12:58,800 --> 00:13:01,200
and they might not be that thrilled

324
00:13:01,200 --> 00:13:02,959
about that

325
00:13:02,959 --> 00:13:05,959
um

326
00:13:06,399 --> 00:13:07,839
yeah another thing i want to say about

327
00:13:07,839 --> 00:13:10,720
atomic red team is if you

328
00:13:10,720 --> 00:13:13,040
create a test like this one

329
00:13:13,040 --> 00:13:15,200
you'll be featured in their

330
00:13:15,200 --> 00:13:17,680
monthly newsletter and you might even

331
00:13:17,680 --> 00:13:21,040
win a t-shirt so that to that there are

332
00:13:21,040 --> 00:13:24,000
two pretty good incentive i believe to

333
00:13:24,000 --> 00:13:27,519
create atomic red t-test to create this

334
00:13:27,519 --> 00:13:30,320
test it took me about

335
00:13:30,320 --> 00:13:32,800
10 15 minutes

336
00:13:32,800 --> 00:13:35,040
and one of the most difficult thing to

337
00:13:35,040 --> 00:13:36,959
do or to find was actually how to

338
00:13:36,959 --> 00:13:38,800
generate the

339
00:13:38,800 --> 00:13:39,130
um

340
00:13:39,130 --> 00:13:40,639
[Music]

341
00:13:40,639 --> 00:13:42,959
unique number on line number four here

342
00:13:42,959 --> 00:13:45,120
where it says auto generate

343
00:13:45,120 --> 00:13:48,240
uh good so yeah i actually had to read

344
00:13:48,240 --> 00:13:50,959
the documentation to understand how to

345
00:13:50,959 --> 00:13:52,800
generate that

346
00:13:52,800 --> 00:13:54,240
that number

347
00:13:54,240 --> 00:13:56,240
i know i know reading the manual who

348
00:13:56,240 --> 00:13:58,160
likes to do that

349
00:13:58,160 --> 00:14:00,320
now that you have a working

350
00:14:00,320 --> 00:14:02,639
test that you can generate all the time

351
00:14:02,639 --> 00:14:04,240
and that you have a hunt query that

352
00:14:04,240 --> 00:14:07,279
detects your event it's time to convert

353
00:14:07,279 --> 00:14:10,320
your hunt into detection but be careful

354
00:14:10,320 --> 00:14:13,120
it's not all of your hunt or all of your

355
00:14:13,120 --> 00:14:17,440
query that will be worthy of an alert

356
00:14:17,440 --> 00:14:20,079
right sometimes um and for me an alert

357
00:14:20,079 --> 00:14:22,320
is is equal equivalent to a ticket that

358
00:14:22,320 --> 00:14:24,000
you send to your sock but there's some

359
00:14:24,000 --> 00:14:26,320
things that are better suited for a

360
00:14:26,320 --> 00:14:29,360
report or maybe to a dashboard that your

361
00:14:29,360 --> 00:14:31,040
analysts will review

362
00:14:31,040 --> 00:14:33,360
daily weekly maybe even a month there's

363
00:14:33,360 --> 00:14:35,360
some things that are very low

364
00:14:35,360 --> 00:14:38,320
uh fidelity that you might want to

365
00:14:38,320 --> 00:14:41,360
review just once in a while

366
00:14:41,360 --> 00:14:44,320
um so yeah i said worthy of transforming

367
00:14:44,320 --> 00:14:46,720
and here we have venom uh

368
00:14:46,720 --> 00:14:48,399
and thor

369
00:14:48,399 --> 00:14:50,720
not sure if you got the analogy but yeah

370
00:14:50,720 --> 00:14:52,560
that was it

371
00:14:52,560 --> 00:14:54,959
and here this little character here is

372
00:14:54,959 --> 00:14:57,279
called sigma and that's why it is on the

373
00:14:57,279 --> 00:14:59,680
slide um so how do you share your

374
00:14:59,680 --> 00:15:02,320
detection with the community well

375
00:15:02,320 --> 00:15:04,880
there's a project called sigma that

376
00:15:04,880 --> 00:15:07,199
exists and it's built just for that and

377
00:15:07,199 --> 00:15:09,519
i've talked about this project in

378
00:15:09,519 --> 00:15:11,120
many of my talks it's one of the

379
00:15:11,120 --> 00:15:14,240
projects that i really really love

380
00:15:14,240 --> 00:15:16,720
and it's again very portable

381
00:15:16,720 --> 00:15:18,000
detection

382
00:15:18,000 --> 00:15:19,839
built in yaml

383
00:15:19,839 --> 00:15:22,399
and then you can convert to pretty much

384
00:15:22,399 --> 00:15:25,040
any seam you are currently using it's

385
00:15:25,040 --> 00:15:27,120
very easy to share the logic of your

386
00:15:27,120 --> 00:15:30,079
detection you can share the known

387
00:15:30,079 --> 00:15:32,160
os exclusion

388
00:15:32,160 --> 00:15:34,959
uh and i and i i can almost hear you

389
00:15:34,959 --> 00:15:38,160
guys even if i'm re-recording

390
00:15:38,160 --> 00:15:39,360
that

391
00:15:39,360 --> 00:15:41,680
you're you're you're telling me yeah but

392
00:15:41,680 --> 00:15:44,480
uh if i provide my detection the

393
00:15:44,480 --> 00:15:46,480
adversary will know what i'm looking for

394
00:15:46,480 --> 00:15:48,880
and then they can bypass it this is my

395
00:15:48,880 --> 00:15:51,120
intellectual properties

396
00:15:51,120 --> 00:15:52,160
um

397
00:15:52,160 --> 00:15:54,000
i'm not sure it's your intellectual

398
00:15:54,000 --> 00:15:56,880
property in this case this detections

399
00:15:56,880 --> 00:16:00,240
and this technique is in a blog post

400
00:16:00,240 --> 00:16:03,199
from mdsec it's public knowledge

401
00:16:03,199 --> 00:16:06,320
it's if it's anyone's intellectual

402
00:16:06,320 --> 00:16:09,040
property it's in the sec so you're

403
00:16:09,040 --> 00:16:11,600
you're not showing whatever you're doing

404
00:16:11,600 --> 00:16:13,360
to the adversary you're just applying

405
00:16:13,360 --> 00:16:15,360
something that is common knowledge and

406
00:16:15,360 --> 00:16:17,360
you're protecting yourself and the

407
00:16:17,360 --> 00:16:20,720
broader community

408
00:16:20,800 --> 00:16:22,800
and personally when i'm looking for a

409
00:16:22,800 --> 00:16:25,120
partner for security i'm way more

410
00:16:25,120 --> 00:16:28,079
inclined to go over someone who shares

411
00:16:28,079 --> 00:16:29,120
um

412
00:16:29,120 --> 00:16:31,040
with the community than someone that

413
00:16:31,040 --> 00:16:34,320
claims that they have blockchain ai

414
00:16:34,320 --> 00:16:36,880
stuff that blocks everything i rather

415
00:16:36,880 --> 00:16:39,519
see what they're doing how well they do

416
00:16:39,519 --> 00:16:42,320
things and how modular their detections

417
00:16:42,320 --> 00:16:44,720
are but maybe that's

418
00:16:44,720 --> 00:16:46,079
not me

419
00:16:46,079 --> 00:16:48,399
um

420
00:16:48,560 --> 00:16:51,279
so let's see how we can create a rule a

421
00:16:51,279 --> 00:16:53,839
sigma rule so here we have an existing

422
00:16:53,839 --> 00:16:56,639
sigma rules and we have our new rule

423
00:16:56,639 --> 00:16:58,639
uh side by side and as you can see they

424
00:16:58,639 --> 00:17:00,880
are pretty much the same

425
00:17:00,880 --> 00:17:02,240
um

426
00:17:02,240 --> 00:17:06,160
so here's a closer look at our

427
00:17:06,160 --> 00:17:09,039
sigma rules and again there's a lot of

428
00:17:09,039 --> 00:17:11,919
information the title the id which is

429
00:17:11,919 --> 00:17:13,439
the exact same

430
00:17:13,439 --> 00:17:16,160
tool that we used in atomic rating to

431
00:17:16,160 --> 00:17:18,400
generate the id by the way

432
00:17:18,400 --> 00:17:20,480
um and then the description the

433
00:17:20,480 --> 00:17:21,839
reference

434
00:17:21,839 --> 00:17:25,119
the author myself in this case and then

435
00:17:25,119 --> 00:17:27,760
what are the tags so what are the minor

436
00:17:27,760 --> 00:17:29,120
attack

437
00:17:29,120 --> 00:17:33,280
techniques that apply to this detection

438
00:17:33,280 --> 00:17:34,240
and then

439
00:17:34,240 --> 00:17:34,980
towards the

440
00:17:34,980 --> 00:17:36,320
[Music]

441
00:17:36,320 --> 00:17:38,720
the end here we have the log sources

442
00:17:38,720 --> 00:17:41,280
where we see that it's a registry event

443
00:17:41,280 --> 00:17:44,240
in windows and then below we have the

444
00:17:44,240 --> 00:17:46,880
registry in question right here where we

445
00:17:46,880 --> 00:17:48,240
see that the

446
00:17:48,240 --> 00:17:51,280
target key and the target value

447
00:17:51,280 --> 00:17:53,440
so if we see this combination we

448
00:17:53,440 --> 00:17:55,200
generate an alert

449
00:17:55,200 --> 00:17:58,559
so again this took me maybe

450
00:17:58,559 --> 00:17:59,440
i don't know

451
00:17:59,440 --> 00:18:01,840
five minutes ten minutes to build this

452
00:18:01,840 --> 00:18:04,559
detection and the longest part here was

453
00:18:04,559 --> 00:18:06,559
to actually figure out which miter

454
00:18:06,559 --> 00:18:10,320
attack technique applied to this

455
00:18:10,320 --> 00:18:12,480
now here is the second rule that we have

456
00:18:12,480 --> 00:18:14,320
to detect the other part so we have

457
00:18:14,320 --> 00:18:17,280
another existing rule that we modify our

458
00:18:17,280 --> 00:18:19,120
rule is just the side and again you can

459
00:18:19,120 --> 00:18:21,679
see that they're very very similar

460
00:18:21,679 --> 00:18:23,280
let's get

461
00:18:23,280 --> 00:18:25,440
closer and we'll see that we are

462
00:18:25,440 --> 00:18:26,840
using the

463
00:18:26,840 --> 00:18:30,880
t1546 which is event trigger execution

464
00:18:30,880 --> 00:18:32,440
and

465
00:18:32,440 --> 00:18:36,480
t1008 which is fallback channel

466
00:18:36,480 --> 00:18:37,520
um

467
00:18:37,520 --> 00:18:40,640
so here it is and you can see again very

468
00:18:40,640 --> 00:18:42,799
easily in the the detection and the

469
00:18:42,799 --> 00:18:45,440
selection here is just we look for a

470
00:18:45,440 --> 00:18:48,400
target file name with the name with that

471
00:18:48,400 --> 00:18:51,360
hands with microsoft outlook vba project

472
00:18:51,360 --> 00:18:53,039
dot otm

473
00:18:53,039 --> 00:18:56,320
so if we take those two sigma rules plus

474
00:18:56,320 --> 00:18:59,760
the atomic rate team this is about

475
00:18:59,760 --> 00:19:02,880
30 minutes of my time that it took me to

476
00:19:02,880 --> 00:19:05,120
put that and give that knowledge back to

477
00:19:05,120 --> 00:19:06,720
the community

478
00:19:06,720 --> 00:19:07,760
now

479
00:19:07,760 --> 00:19:10,080
you'll have a very hard time convincing

480
00:19:10,080 --> 00:19:12,720
me that you do not have 30 minutes

481
00:19:12,720 --> 00:19:16,080
in your week or in your month to help

482
00:19:16,080 --> 00:19:18,559
the whole community

483
00:19:18,559 --> 00:19:20,480
if you have an argument against that

484
00:19:20,480 --> 00:19:22,880
again i'll be very happy to chat and try

485
00:19:22,880 --> 00:19:25,520
to change your mind

486
00:19:25,520 --> 00:19:27,760
if you want to know more about how to

487
00:19:27,760 --> 00:19:31,039
create sigma rules there was a

488
00:19:31,039 --> 00:19:33,120
two-pager from

489
00:19:33,120 --> 00:19:36,799
chris sanders and josh brauer

490
00:19:36,799 --> 00:19:39,200
from active network defense

491
00:19:39,200 --> 00:19:41,760
um they also have a

492
00:19:41,760 --> 00:19:44,480
a class i think it's um i think it's a

493
00:19:44,480 --> 00:19:48,160
two day class on how to build effective

494
00:19:48,160 --> 00:19:49,840
sigma rules

495
00:19:49,840 --> 00:19:52,240
disclaimer i didn't take the course so i

496
00:19:52,240 --> 00:19:54,000
don't know if it's good if it's bad but

497
00:19:54,000 --> 00:19:56,240
i do know that chris uh

498
00:19:56,240 --> 00:19:59,440
create very good material in general but

499
00:19:59,440 --> 00:20:02,720
i haven't seen this particular one

500
00:20:02,720 --> 00:20:05,200
now a pro tip you can also use

501
00:20:05,200 --> 00:20:06,880
encoder.io

502
00:20:06,880 --> 00:20:10,480
to convert your sigma rules into the

503
00:20:10,480 --> 00:20:13,440
language of your scene if you

504
00:20:13,440 --> 00:20:15,280
if you don't know how if you're very new

505
00:20:15,280 --> 00:20:17,440
to this most of the time you just need

506
00:20:17,440 --> 00:20:19,200
to look at the

507
00:20:19,200 --> 00:20:21,600
detection and you can figure it out but

508
00:20:21,600 --> 00:20:23,280
if you don't and if you're very new

509
00:20:23,280 --> 00:20:25,200
there's no problem as you can see here

510
00:20:25,200 --> 00:20:27,120
on the screenshot you have

511
00:20:27,120 --> 00:20:30,640
elastic query qradar splunk i know a

512
00:20:30,640 --> 00:20:33,679
last alert is there as well

513
00:20:33,679 --> 00:20:34,640
side

514
00:20:34,640 --> 00:20:35,919
and

515
00:20:35,919 --> 00:20:38,640
a few other as well but yeah

516
00:20:38,640 --> 00:20:41,120
they got you covered so keep this site

517
00:20:41,120 --> 00:20:43,840
in mind if you're very new at working

518
00:20:43,840 --> 00:20:47,600
with uh with the sigma rules

519
00:20:47,600 --> 00:20:49,120
now it's time to talk about the

520
00:20:49,120 --> 00:20:52,799
detection pipeline

521
00:20:55,520 --> 00:20:58,880
it happened way too often in my career

522
00:20:58,880 --> 00:21:01,520
that i've seen a good detection

523
00:21:01,520 --> 00:21:04,159
stop working and they stop working for a

524
00:21:04,159 --> 00:21:06,240
lot of different reasons it might be

525
00:21:06,240 --> 00:21:08,080
because you have installed a new os

526
00:21:08,080 --> 00:21:09,919
version or a new version of your

527
00:21:09,919 --> 00:21:12,480
software uh maybe you installed a new

528
00:21:12,480 --> 00:21:14,400
version of the parser from the sim

529
00:21:14,400 --> 00:21:17,520
vendor or maybe and when you do that

530
00:21:17,520 --> 00:21:19,760
sometimes the same vendor just change

531
00:21:19,760 --> 00:21:22,159
the mapping either the name change or

532
00:21:22,159 --> 00:21:24,080
even the value themselves sometimes they

533
00:21:24,080 --> 00:21:26,640
change from one field to the other and

534
00:21:26,640 --> 00:21:28,559
there's a lot of different reason also

535
00:21:28,559 --> 00:21:31,919
that can happen maybe a firewall rule

536
00:21:31,919 --> 00:21:34,159
um was put in place and now your traffic

537
00:21:34,159 --> 00:21:36,240
from one of your zone doesn't reach your

538
00:21:36,240 --> 00:21:39,360
sam anymore many many things can happen

539
00:21:39,360 --> 00:21:42,000
um and we put a lot of effort and pride

540
00:21:42,000 --> 00:21:44,480
in building those detection so we want

541
00:21:44,480 --> 00:21:46,480
to make sure that they are always

542
00:21:46,480 --> 00:21:48,960
working it also give us a false sense of

543
00:21:48,960 --> 00:21:50,720
security sometimes because we think

544
00:21:50,720 --> 00:21:54,080
everything is working when it's not

545
00:21:54,080 --> 00:21:55,760
and we want to test all the way from

546
00:21:55,760 --> 00:21:58,559
generating the events to the creation of

547
00:21:58,559 --> 00:22:00,720
the ticket or the population of our

548
00:22:00,720 --> 00:22:03,200
dashboards and report

549
00:22:03,200 --> 00:22:04,720
um

550
00:22:04,720 --> 00:22:06,960
and i saw a new project that is called

551
00:22:06,960 --> 00:22:08,320
automata

552
00:22:08,320 --> 00:22:10,080
that seems very interesting i didn't

553
00:22:10,080 --> 00:22:12,720
have time yet to look into it but if

554
00:22:12,720 --> 00:22:16,000
you're into automation and pipelines i

555
00:22:16,000 --> 00:22:18,159
really suggest you give it a shot

556
00:22:18,159 --> 00:22:20,720
it's an open source project so

557
00:22:20,720 --> 00:22:22,880
go ahead and if you use it let me know

558
00:22:22,880 --> 00:22:26,559
how good it is

559
00:22:26,559 --> 00:22:28,400
so yeah we want to

560
00:22:28,400 --> 00:22:32,400
to run our atomic red team as often as

561
00:22:32,400 --> 00:22:34,320
possible to make sure that the whole

562
00:22:34,320 --> 00:22:36,799
pipeline is working one of the easiest

563
00:22:36,799 --> 00:22:39,679
way to do that is to actually use a

564
00:22:39,679 --> 00:22:43,280
scheduled task on windows or cron job in

565
00:22:43,280 --> 00:22:44,400
linux

566
00:22:44,400 --> 00:22:46,799
we can also use docker if you're a bit

567
00:22:46,799 --> 00:22:49,679
more advanced and if you're into uh

568
00:22:49,679 --> 00:22:50,799
counter

569
00:22:50,799 --> 00:22:52,400
containers and

570
00:22:52,400 --> 00:22:54,559
all of these good things

571
00:22:54,559 --> 00:22:57,760
might be even more efficient but still a

572
00:22:57,760 --> 00:23:01,039
crumb job or a schedule task will

573
00:23:01,039 --> 00:23:03,360
will get you started very quickly it

574
00:23:03,360 --> 00:23:07,360
takes a few minutes to run these things

575
00:23:07,360 --> 00:23:08,640
um

576
00:23:08,640 --> 00:23:11,120
you need to put that source system into

577
00:23:11,120 --> 00:23:12,880
an allow or ignore this because you

578
00:23:12,880 --> 00:23:14,000
don't want to

579
00:23:14,000 --> 00:23:17,039
flood your analyst with alerts every day

580
00:23:17,039 --> 00:23:19,360
if you run this every every even if you

581
00:23:19,360 --> 00:23:21,120
start running you know every hour to

582
00:23:21,120 --> 00:23:22,720
test your pipeline it's going to be

583
00:23:22,720 --> 00:23:26,000
crazy if you have like 40 50 hundreds of

584
00:23:26,000 --> 00:23:28,799
detection that you're testing every

585
00:23:28,799 --> 00:23:32,240
every day or even worse every hour um

586
00:23:32,240 --> 00:23:33,679
your analysts will

587
00:23:33,679 --> 00:23:36,080
will hate you all right um so you need

588
00:23:36,080 --> 00:23:38,880
to put these tickets into a different

589
00:23:38,880 --> 00:23:40,720
ticket queue because you still need to

590
00:23:40,720 --> 00:23:43,120
ma to make sure that the ticket is being

591
00:23:43,120 --> 00:23:44,320
created

592
00:23:44,320 --> 00:23:46,000
now what you can do though is if you

593
00:23:46,000 --> 00:23:48,240
know that you have 50 tests and you

594
00:23:48,240 --> 00:23:51,200
receive 48 tickets now you can generate

595
00:23:51,200 --> 00:23:54,080
a real ticket to your team

596
00:23:54,080 --> 00:23:55,840
in order to investigate why two of your

597
00:23:55,840 --> 00:23:58,240
alerts didn't fire

598
00:23:58,240 --> 00:23:58,750
um

599
00:23:58,750 --> 00:24:02,029
[Music]

600
00:24:02,400 --> 00:24:04,480
yeah i think that this is the link for

601
00:24:04,480 --> 00:24:07,279
the um automata

602
00:24:07,279 --> 00:24:08,640
tool

603
00:24:08,640 --> 00:24:11,039
below there

604
00:24:11,039 --> 00:24:12,799
now it's time to talk about incidence

605
00:24:12,799 --> 00:24:15,600
response playbook uh for me instance

606
00:24:15,600 --> 00:24:18,480
response playbook are processes for your

607
00:24:18,480 --> 00:24:20,640
sock analyst and sometimes playbook

608
00:24:20,640 --> 00:24:22,799
means very different things to different

609
00:24:22,799 --> 00:24:24,880
people so that's why i want to go a

610
00:24:24,880 --> 00:24:27,679
little bit more in details here

611
00:24:27,679 --> 00:24:29,679
but in this case it would be business

612
00:24:29,679 --> 00:24:32,400
email compromise or bec

613
00:24:32,400 --> 00:24:34,880
for sure that we see a lot used in the

614
00:24:34,880 --> 00:24:36,240
industry

615
00:24:36,240 --> 00:24:38,400
so here i just want to show you plan

616
00:24:38,400 --> 00:24:40,480
like incident response plan versus

617
00:24:40,480 --> 00:24:42,799
incidence response playbooks versus what

618
00:24:42,799 --> 00:24:46,720
i called micro plays or work instruction

619
00:24:46,720 --> 00:24:47,760
so

620
00:24:47,760 --> 00:24:50,080
usually when you when you think about an

621
00:24:50,080 --> 00:24:53,520
incident response plan this is in cisp

622
00:24:53,520 --> 00:24:55,840
terms what you could also reference to

623
00:24:55,840 --> 00:24:57,679
as a policy

624
00:24:57,679 --> 00:24:58,799
whereas

625
00:24:58,799 --> 00:25:00,960
the you sometimes the suck manager and

626
00:25:00,960 --> 00:25:02,880
the more advanced analysts they'll be

627
00:25:02,880 --> 00:25:05,520
more interested in the process so the

628
00:25:05,520 --> 00:25:07,679
process would be how do you deal at a

629
00:25:07,679 --> 00:25:09,840
high level with a rent somewhere with

630
00:25:09,840 --> 00:25:12,320
business email compromise with the fish

631
00:25:12,320 --> 00:25:14,400
with with account compromise and all of

632
00:25:14,400 --> 00:25:17,440
those generic subject

633
00:25:17,440 --> 00:25:19,520
and then at the microplace or the work

634
00:25:19,520 --> 00:25:22,240
instruction it's really a step-by-step

635
00:25:22,240 --> 00:25:26,000
guide for your analyst or a procedure

636
00:25:26,000 --> 00:25:29,200
again for the cisd fan in the house

637
00:25:29,200 --> 00:25:31,200
and that would be things like how do you

638
00:25:31,200 --> 00:25:34,240
submit a hash to virustotal or hybrid

639
00:25:34,240 --> 00:25:36,960
analysis how do you retrieve a pcap

640
00:25:36,960 --> 00:25:39,840
maybe from your waff or from your ips if

641
00:25:39,840 --> 00:25:42,720
you're an mssp and you have different

642
00:25:42,720 --> 00:25:43,840
um

643
00:25:43,840 --> 00:25:45,919
waff that you're managing maybe you have

644
00:25:45,919 --> 00:25:47,200
you have one for

645
00:25:47,200 --> 00:25:50,720
laf1 and one procedure for washb

646
00:25:50,720 --> 00:25:52,720
how do you create user in all of your

647
00:25:52,720 --> 00:25:55,600
security tools how do you contact your

648
00:25:55,600 --> 00:25:57,760
clients and here i'm think talking about

649
00:25:57,760 --> 00:26:00,880
clients as a very broad term

650
00:26:00,880 --> 00:26:03,120
you don't need to be an mssp

651
00:26:03,120 --> 00:26:04,799
to be able to contact client maybe

652
00:26:04,799 --> 00:26:06,240
sometimes you'll have some different

653
00:26:06,240 --> 00:26:08,880
business unit that runs that owns

654
00:26:08,880 --> 00:26:10,640
different systems so you wouldn't want

655
00:26:10,640 --> 00:26:12,880
to call the sysadmin

656
00:26:12,880 --> 00:26:14,640
for the wrong machines it's just going

657
00:26:14,640 --> 00:26:16,400
to lose time so these are things that

658
00:26:16,400 --> 00:26:19,200
you need in your procedure as a stock

659
00:26:19,200 --> 00:26:21,600
analyst to speed up the investigation

660
00:26:21,600 --> 00:26:24,640
and the response time you have other

661
00:26:24,640 --> 00:26:27,279
example here but that that's the the

662
00:26:27,279 --> 00:26:29,679
idea here policy

663
00:26:29,679 --> 00:26:30,880
process

664
00:26:30,880 --> 00:26:34,240
procedures and here we're talking about

665
00:26:34,240 --> 00:26:36,080
process

666
00:26:36,080 --> 00:26:38,880
um so there's two open

667
00:26:38,880 --> 00:26:41,200
uh frameworks that i would recommend

668
00:26:41,200 --> 00:26:44,000
there's the react one and and here is

669
00:26:44,000 --> 00:26:46,960
the address and there's the syntax one

670
00:26:46,960 --> 00:26:50,400
that we released in july at the sans dev

671
00:26:50,400 --> 00:26:53,520
summit here are two links for the that

672
00:26:53,520 --> 00:26:56,240
presentation if you want to know more

673
00:26:56,240 --> 00:26:58,640
about our incident response playbook

674
00:26:58,640 --> 00:27:00,240
that we've open source the first thing

675
00:27:00,240 --> 00:27:01,600
is the original

676
00:27:01,600 --> 00:27:05,039
um release at sans differe and the other

677
00:27:05,039 --> 00:27:07,120
one is

678
00:27:07,120 --> 00:27:08,400
a web

679
00:27:08,400 --> 00:27:11,200
a hacking cast from wild west acting

680
00:27:11,200 --> 00:27:14,480
fest that was recorded

681
00:27:14,480 --> 00:27:16,320
well a few days ago

682
00:27:16,320 --> 00:27:19,120
which is maybe a little bit longer

683
00:27:19,120 --> 00:27:21,120
so it covers a little bit

684
00:27:21,120 --> 00:27:23,360
maybe a little bit more things you know

685
00:27:23,360 --> 00:27:25,679
as i do these talks a second time a

686
00:27:25,679 --> 00:27:28,559
third time i try to add more things and

687
00:27:28,559 --> 00:27:30,320
you'll see some of the slides in this

688
00:27:30,320 --> 00:27:33,120
deck were stolen from that deck and the

689
00:27:33,120 --> 00:27:35,360
other way around as well so i really

690
00:27:35,360 --> 00:27:37,120
think that these two talks kind of go

691
00:27:37,120 --> 00:27:39,039
hand in hand

692
00:27:39,039 --> 00:27:42,240
now just a very high level review of

693
00:27:42,240 --> 00:27:45,760
react it's from the atc project project

694
00:27:45,760 --> 00:27:48,399
sorry it is extremely modular

695
00:27:48,399 --> 00:27:50,960
it is open source it is more of a

696
00:27:50,960 --> 00:27:52,960
framework so it kind of you can think of

697
00:27:52,960 --> 00:27:55,120
it as lego blocks so you have all of

698
00:27:55,120 --> 00:27:57,039
these lego blocks that you can pick and

699
00:27:57,039 --> 00:27:59,440
choose to build your perfect incident

700
00:27:59,440 --> 00:28:01,919
response playbook for

701
00:28:01,919 --> 00:28:05,039
whatever you want to respond to it is

702
00:28:05,039 --> 00:28:08,880
currently very much a work in progress

703
00:28:08,880 --> 00:28:11,600
project they have a lot of container a

704
00:28:11,600 --> 00:28:13,760
lot of blocks but they don't have a lot

705
00:28:13,760 --> 00:28:16,399
of depth into it right now

706
00:28:16,399 --> 00:28:19,279
but they usually work in sprints so i'm

707
00:28:19,279 --> 00:28:21,200
sure that they will go into it in their

708
00:28:21,200 --> 00:28:23,279
next print and add a lot of things they

709
00:28:23,279 --> 00:28:24,800
are a very huge um

710
00:28:24,800 --> 00:28:26,159
[Music]

711
00:28:26,159 --> 00:28:28,559
contributor to the two project that i

712
00:28:28,559 --> 00:28:31,840
mentioned before atomic rate team and

713
00:28:31,840 --> 00:28:34,080
sigma so really really highly recommend

714
00:28:34,080 --> 00:28:36,240
you look into these guys they're great

715
00:28:36,240 --> 00:28:38,320
we talked about merging our project at

716
00:28:38,320 --> 00:28:40,240
the beginning but we had a slightly

717
00:28:40,240 --> 00:28:42,399
different approach where i needed

718
00:28:42,399 --> 00:28:44,960
content very specifically and for a very

719
00:28:44,960 --> 00:28:46,880
limited number of playbooks and they

720
00:28:46,880 --> 00:28:49,039
were more trying to build a framework

721
00:28:49,039 --> 00:28:51,440
it's now not out of the question that

722
00:28:51,440 --> 00:28:53,679
the two project might merge in the

723
00:28:53,679 --> 00:28:56,240
future but right now we chose slightly

724
00:28:56,240 --> 00:28:58,799
different path but still i encourage you

725
00:28:58,799 --> 00:29:01,279
very much awesome project

726
00:29:01,279 --> 00:29:02,720
now let's go over a little bit of what

727
00:29:02,720 --> 00:29:06,240
we have at syntax for our playbook it's

728
00:29:06,240 --> 00:29:08,960
all stood in git it's built in markdown

729
00:29:08,960 --> 00:29:12,880
and all the workflow are in draw io

730
00:29:12,880 --> 00:29:15,200
it is open and free of course and it's

731
00:29:15,200 --> 00:29:18,080
very easy to modify because of markdown

732
00:29:18,080 --> 00:29:20,799
and draw io is mostly built as you can

733
00:29:20,799 --> 00:29:23,600
see here on workflow but we have under

734
00:29:23,600 --> 00:29:24,880
that

735
00:29:24,880 --> 00:29:27,679
some explanation of what actually goes

736
00:29:27,679 --> 00:29:30,720
into that process and then under that we

737
00:29:30,720 --> 00:29:32,720
have a markdown file

738
00:29:32,720 --> 00:29:33,600
and

739
00:29:33,600 --> 00:29:35,679
the the goal here is that all of those

740
00:29:35,679 --> 00:29:36,720
points

741
00:29:36,720 --> 00:29:38,559
brings you to the procedure so you're

742
00:29:38,559 --> 00:29:40,640
looking at the process but you have a

743
00:29:40,640 --> 00:29:43,200
link to the procedure on how to do

744
00:29:43,200 --> 00:29:46,559
various tasks that are in the process

745
00:29:46,559 --> 00:29:49,120
so that's the philosophy behind it

746
00:29:49,120 --> 00:29:51,279
i hope that someday this project becomes

747
00:29:51,279 --> 00:29:54,399
the atomic red team or sigma

748
00:29:54,399 --> 00:29:55,600
of

749
00:29:55,600 --> 00:29:57,279
detection or

750
00:29:57,279 --> 00:30:00,799
incident response playbook sorry

751
00:30:00,960 --> 00:30:03,440
and now it's time to train your analyst

752
00:30:03,440 --> 00:30:05,520
because it's not because you or your

753
00:30:05,520 --> 00:30:06,880
tread hunter

754
00:30:06,880 --> 00:30:09,840
now master this

755
00:30:09,840 --> 00:30:12,480
outlook technique that all of your

756
00:30:12,480 --> 00:30:14,720
analysts will understand when they see a

757
00:30:14,720 --> 00:30:18,080
vba project that otm file alerts i mean

758
00:30:18,080 --> 00:30:20,559
i would have any idea before i read this

759
00:30:20,559 --> 00:30:22,640
and build all of this so you need to

760
00:30:22,640 --> 00:30:24,559
transfer the knowledge to your level

761
00:30:24,559 --> 00:30:27,520
ones and you need to do that in a in an

762
00:30:27,520 --> 00:30:30,000
easy to consume way

763
00:30:30,000 --> 00:30:32,159
personally i really love videos so

764
00:30:32,159 --> 00:30:34,320
people can watch them on demand when you

765
00:30:34,320 --> 00:30:36,000
get a new analyst in the team you have

766
00:30:36,000 --> 00:30:38,080
your library of video that you can go

767
00:30:38,080 --> 00:30:40,480
through and it's very easy

768
00:30:40,480 --> 00:30:43,279
i think you also need something quicker

769
00:30:43,279 --> 00:30:45,279
such as powerpoints to support your

770
00:30:45,279 --> 00:30:48,880
video but also some wiki

771
00:30:48,880 --> 00:30:50,559
article or something like that like a

772
00:30:50,559 --> 00:30:53,919
web page that an analyst that actually

773
00:30:53,919 --> 00:30:55,840
did the thing but maybe just once or

774
00:30:55,840 --> 00:30:58,240
twice uh can go and quickly get a

775
00:30:58,240 --> 00:31:00,159
reference so they don't need to go

776
00:31:00,159 --> 00:31:02,240
through the video to find the answer

777
00:31:02,240 --> 00:31:03,919
they're looking for they add it

778
00:31:03,919 --> 00:31:06,110
somewhere in a page

779
00:31:06,110 --> 00:31:07,679
[Music]

780
00:31:07,679 --> 00:31:10,240
palantir has a great

781
00:31:10,240 --> 00:31:12,799
framework for that that is called ads

782
00:31:12,799 --> 00:31:14,640
you can look into it and that's a good

783
00:31:14,640 --> 00:31:16,240
way i think to

784
00:31:16,240 --> 00:31:17,990
document all of your

785
00:31:17,990 --> 00:31:19,760
[Music]

786
00:31:19,760 --> 00:31:22,320
all of your detections and you can put

787
00:31:22,320 --> 00:31:24,080
links in those a

788
00:31:24,080 --> 00:31:27,600
ads 5 files

789
00:31:27,600 --> 00:31:29,519
to all of these things to the video to

790
00:31:29,519 --> 00:31:31,279
the powerpoint to the wiki depending on

791
00:31:31,279 --> 00:31:33,840
what you have

792
00:31:34,399 --> 00:31:36,640
now it's time for a little bonus um

793
00:31:36,640 --> 00:31:39,440
those are maybe for a more advanced team

794
00:31:39,440 --> 00:31:41,120
but it's now time to think about

795
00:31:41,120 --> 00:31:43,120
automation when we think about

796
00:31:43,120 --> 00:31:46,640
automation we think about soar security

797
00:31:46,640 --> 00:31:49,840
orchestration automation and response

798
00:31:49,840 --> 00:31:51,919
here are two products that are open

799
00:31:51,919 --> 00:31:53,200
source

800
00:31:53,200 --> 00:31:55,120
that you can use

801
00:31:55,120 --> 00:31:58,000
shuffle and walk off i did not use them

802
00:31:58,000 --> 00:32:00,720
myself but i just put them here so that

803
00:32:00,720 --> 00:32:03,120
you actually have at least somewhere to

804
00:32:03,120 --> 00:32:06,559
start that is free

805
00:32:06,559 --> 00:32:08,960
here i put some some website

806
00:32:08,960 --> 00:32:11,360
but you know most of the secret analysts

807
00:32:11,360 --> 00:32:13,279
will go to virus total

808
00:32:13,279 --> 00:32:15,840
many times in a day and this is they're

809
00:32:15,840 --> 00:32:18,159
losing time going there you know when

810
00:32:18,159 --> 00:32:20,320
you have an alert your alert should

811
00:32:20,320 --> 00:32:23,120
fetch that information for them every

812
00:32:23,120 --> 00:32:24,720
time so they don't need to go there so

813
00:32:24,720 --> 00:32:26,640
that's why i say that automation is

814
00:32:26,640 --> 00:32:28,799
important you'll say five minutes maybe

815
00:32:28,799 --> 00:32:32,320
three minutes per incident and or per

816
00:32:32,320 --> 00:32:34,960
alerts so in the end of the day you save

817
00:32:34,960 --> 00:32:36,720
a lot of time and they

818
00:32:36,720 --> 00:32:38,880
the more you automate the more time the

819
00:32:38,880 --> 00:32:40,799
human has time to do

820
00:32:40,799 --> 00:32:43,200
what they're good for and it's using the

821
00:32:43,200 --> 00:32:46,159
brain and not do repetitive tasks so i

822
00:32:46,159 --> 00:32:48,480
put some other uh example here like gray

823
00:32:48,480 --> 00:32:50,640
noise for um

824
00:32:50,640 --> 00:32:53,840
getting the ip reputation or spam house

825
00:32:53,840 --> 00:32:57,840
if we're dealing with fish

826
00:32:58,799 --> 00:33:01,679
so this is uh the end of the deck

827
00:33:01,679 --> 00:33:03,120
already

828
00:33:03,120 --> 00:33:05,760
and i really like this image because for

829
00:33:05,760 --> 00:33:09,200
me it represents how we the defender can

830
00:33:09,200 --> 00:33:11,679
stand up to the adversary or the red

831
00:33:11,679 --> 00:33:14,000
teams if we unite

832
00:33:14,000 --> 00:33:17,200
we are bigger we far outnumber them and

833
00:33:17,200 --> 00:33:20,000
yet in most cases i feel that we're

834
00:33:20,000 --> 00:33:22,880
always trying to catch up with them

835
00:33:22,880 --> 00:33:25,360
it's always a game of catch and mouse a

836
00:33:25,360 --> 00:33:26,799
cat and mouse

837
00:33:26,799 --> 00:33:27,919
and the

838
00:33:27,919 --> 00:33:30,159
red teamer in particular are sharing a

839
00:33:30,159 --> 00:33:33,440
lot more tools uh and techniques among

840
00:33:33,440 --> 00:33:36,559
themselves that the blue teamer are or

841
00:33:36,559 --> 00:33:38,399
at least i feel like there's a lot more

842
00:33:38,399 --> 00:33:40,799
of prominent figure in the red team

843
00:33:40,799 --> 00:33:43,039
industry and i really want to encourage

844
00:33:43,039 --> 00:33:46,159
you once again to share more with the

845
00:33:46,159 --> 00:33:49,200
community so that we can be stronger

846
00:33:49,200 --> 00:33:52,559
together with that i want to thank texas

847
00:33:52,559 --> 00:33:55,120
cyber summit for having me

848
00:33:55,120 --> 00:33:57,200
this year i want to thank syntax my

849
00:33:57,200 --> 00:33:58,960
employer for allowing me to share these

850
00:33:58,960 --> 00:34:01,679
things with you i know that all not all

851
00:34:01,679 --> 00:34:03,919
employers would do that and i want to

852
00:34:03,919 --> 00:34:05,760
thank you

853
00:34:05,760 --> 00:34:09,199
the listener to be here and support

854
00:34:09,199 --> 00:34:11,440
all of these and make this possible

855
00:34:11,440 --> 00:34:13,040
thank you very much everyone have a

856
00:34:13,040 --> 00:34:17,000
great rest of the conference

