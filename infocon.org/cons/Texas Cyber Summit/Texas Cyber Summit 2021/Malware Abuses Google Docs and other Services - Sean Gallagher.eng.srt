1
00:00:03,040 --> 00:00:04,240
good morning

2
00:00:04,240 --> 00:00:06,240
my name is sean gallagher

3
00:00:06,240 --> 00:00:08,400
i am a senior threat researcher at

4
00:00:08,400 --> 00:00:09,920
sophos labs

5
00:00:09,920 --> 00:00:11,599
last time i got to speak at texas cyber

6
00:00:11,599 --> 00:00:13,679
summit which was in person a few years

7
00:00:13,679 --> 00:00:16,000
ago i was the i.t and national security

8
00:00:16,000 --> 00:00:17,840
editor at arts technica

9
00:00:17,840 --> 00:00:19,199
uh glad to be back wish you could be

10
00:00:19,199 --> 00:00:21,279
there in person but

11
00:00:21,279 --> 00:00:23,439
that's how things are these days uh

12
00:00:23,439 --> 00:00:24,800
today i want to talk to you about how

13
00:00:24,800 --> 00:00:25,920
malware

14
00:00:25,920 --> 00:00:27,599
and other malicious act and malicious

15
00:00:27,599 --> 00:00:29,760
actors can abuse google docs and other

16
00:00:29,760 --> 00:00:32,558
legitimate services we've seen

17
00:00:32,558 --> 00:00:34,719
a rise in this type of behavior over the

18
00:00:34,719 --> 00:00:36,079
past

19
00:00:36,079 --> 00:00:38,079
year or so and

20
00:00:38,079 --> 00:00:39,600
there's some interesting

21
00:00:39,600 --> 00:00:41,600
aspects of this that

22
00:00:41,600 --> 00:00:44,079
you should be aware of if you're a blue

23
00:00:44,079 --> 00:00:45,360
team member

24
00:00:45,360 --> 00:00:46,719
and if you're

25
00:00:46,719 --> 00:00:48,800
red team here are some things you can

26
00:00:48,800 --> 00:00:50,960
learn to exploit to make

27
00:00:50,960 --> 00:00:52,480
your defenders lives a little bit more

28
00:00:52,480 --> 00:00:54,879
miserable

29
00:00:55,360 --> 00:00:57,199
so

30
00:00:57,199 --> 00:00:59,760
the defining reason why

31
00:00:59,760 --> 00:01:02,399
we're gonna by why malicious actors use

32
00:01:02,399 --> 00:01:04,159
these legitimate services is because

33
00:01:04,159 --> 00:01:05,438
they're free

34
00:01:05,438 --> 00:01:08,159
why buy or steal or hack

35
00:01:08,159 --> 00:01:10,479
a c2 together from

36
00:01:10,479 --> 00:01:12,320
uh components you have to manage

37
00:01:12,320 --> 00:01:14,479
yourself on various services of private

38
00:01:14,479 --> 00:01:16,720
servers things like that when you can

39
00:01:16,720 --> 00:01:20,159
ride for free on google docs or any of

40
00:01:20,159 --> 00:01:22,479
these other legitimate services and get

41
00:01:22,479 --> 00:01:24,560
the benefits of using them

42
00:01:24,560 --> 00:01:27,360
as part of your activity

43
00:01:27,360 --> 00:01:30,159
since they're legitimate services well

44
00:01:30,159 --> 00:01:31,520
there's a number of advantages that come

45
00:01:31,520 --> 00:01:34,240
along with using

46
00:01:34,240 --> 00:01:37,280
for example uh they're all tls protected

47
00:01:37,280 --> 00:01:38,640
so unless

48
00:01:38,640 --> 00:01:42,000
you have some form of

49
00:01:42,000 --> 00:01:43,200
ssl

50
00:01:43,200 --> 00:01:46,479
introspection or proxy running at your

51
00:01:46,479 --> 00:01:48,880
firewall or on your on your

52
00:01:48,880 --> 00:01:50,960
other systems to allow

53
00:01:50,960 --> 00:01:53,040
inspection of traffic going across the

54
00:01:53,040 --> 00:01:54,479
wire

55
00:01:54,479 --> 00:01:55,520
you're not going to see any of this

56
00:01:55,520 --> 00:01:57,920
malicious traffic

57
00:01:57,920 --> 00:02:00,640
they're free as i mentioned uh you can

58
00:02:00,640 --> 00:02:02,159
easily set up an account on any of these

59
00:02:02,159 --> 00:02:03,280
services

60
00:02:03,280 --> 00:02:04,079
and

61
00:02:04,079 --> 00:02:05,759
easily burn that

62
00:02:05,759 --> 00:02:08,000
as i stated here

63
00:02:08,000 --> 00:02:09,520
once you lose an account you can set up

64
00:02:09,520 --> 00:02:11,440
a new one and

65
00:02:11,440 --> 00:02:13,840
it's easy to quickly migrate what you've

66
00:02:13,840 --> 00:02:15,760
done over to another

67
00:02:15,760 --> 00:02:18,319
service another service login or even

68
00:02:18,319 --> 00:02:20,800
another service entirely

69
00:02:20,800 --> 00:02:22,879
and because they are

70
00:02:22,879 --> 00:02:25,680
uh legitimate services the hosts that

71
00:02:25,680 --> 00:02:27,520
they reside upon are

72
00:02:27,520 --> 00:02:28,959
generically trusted by most

73
00:02:28,959 --> 00:02:30,400
organizations

74
00:02:30,400 --> 00:02:32,000
and that means that you have less

75
00:02:32,000 --> 00:02:34,480
likelihood of being blocked

76
00:02:34,480 --> 00:02:35,680
uh when

77
00:02:35,680 --> 00:02:38,000
you're doing an initial compromise or

78
00:02:38,000 --> 00:02:39,360
when you're launching malware for the

79
00:02:39,360 --> 00:02:42,640
first time and once those

80
00:02:42,640 --> 00:02:45,040
urls associated with your malicious

81
00:02:45,040 --> 00:02:47,840
activity are caught you can easily just

82
00:02:47,840 --> 00:02:51,200
burn them and move on to another set of

83
00:02:51,200 --> 00:02:53,360
infrastructure using the same platform

84
00:02:53,360 --> 00:02:54,879
in a different account

85
00:02:54,879 --> 00:02:56,160
new ids

86
00:02:56,160 --> 00:02:58,560
and because these services are so

87
00:02:58,560 --> 00:03:00,800
commonly used across organizations

88
00:03:00,800 --> 00:03:02,159
they're not going to

89
00:03:02,159 --> 00:03:03,519
they're not going to wholesale block

90
00:03:03,519 --> 00:03:06,239
these domains

91
00:03:06,959 --> 00:03:08,400
so we did a little bit of research this

92
00:03:08,400 --> 00:03:10,879
year uh early in the year to take a look

93
00:03:10,879 --> 00:03:13,040
at how much

94
00:03:13,040 --> 00:03:15,040
of malware activity

95
00:03:15,040 --> 00:03:17,519
was based on tls

96
00:03:17,519 --> 00:03:19,920
and that's when i discovered

97
00:03:19,920 --> 00:03:23,040
that a huge proportion of the malware

98
00:03:23,040 --> 00:03:24,480
column traffic

99
00:03:24,480 --> 00:03:25,920
that was

100
00:03:25,920 --> 00:03:29,280
linked to tls traffic was going to

101
00:03:29,280 --> 00:03:30,720
google cloud

102
00:03:30,720 --> 00:03:32,480
and we decided to dive a little bit

103
00:03:32,480 --> 00:03:34,239
deeper into that and found that this

104
00:03:34,239 --> 00:03:36,080
wasn't all google cloud

105
00:03:36,080 --> 00:03:36,799
but

106
00:03:36,799 --> 00:03:39,440
across the board we found that many of

107
00:03:39,440 --> 00:03:41,040
these

108
00:03:41,040 --> 00:03:42,480
many of these call home destinations

109
00:03:42,480 --> 00:03:45,120
were tied to legitimate services that

110
00:03:45,120 --> 00:03:46,640
were being exploited

111
00:03:46,640 --> 00:03:48,400
uh by malware

112
00:03:48,400 --> 00:03:50,720
in some form

113
00:03:50,720 --> 00:03:51,920
in some cases

114
00:03:51,920 --> 00:03:52,799
it was

115
00:03:52,799 --> 00:03:55,840
based on uh spam that was trying to do

116
00:03:55,840 --> 00:03:57,760
phishing attacks so they were really

117
00:03:57,760 --> 00:04:00,400
just links back to phishing sites some

118
00:04:00,400 --> 00:04:02,480
of these were running within a google

119
00:04:02,480 --> 00:04:05,040
app or running uh in google forms as

120
00:04:05,040 --> 00:04:06,959
i've discussed in a little while

121
00:04:06,959 --> 00:04:07,920
but

122
00:04:07,920 --> 00:04:10,159
a vast majority of it was

123
00:04:10,159 --> 00:04:12,879
actually going and grabbing data from

124
00:04:12,879 --> 00:04:16,079
a remote location on a google service or

125
00:04:16,079 --> 00:04:17,759
on other services that use google's

126
00:04:17,759 --> 00:04:20,400
infrastructure

127
00:04:21,199 --> 00:04:23,199
again it was only nine percent overall

128
00:04:23,199 --> 00:04:26,479
of tls traffic uh from malware but that

129
00:04:26,479 --> 00:04:28,800
does not include other forms of

130
00:04:28,800 --> 00:04:32,320
communications that we looked at

131
00:04:34,000 --> 00:04:34,720
so

132
00:04:34,720 --> 00:04:36,800
you know there are very few downsides

133
00:04:36,800 --> 00:04:38,800
for using legitimate services as part of

134
00:04:38,800 --> 00:04:40,080
your infrastructure for your malware

135
00:04:40,080 --> 00:04:41,520
operator

136
00:04:41,520 --> 00:04:43,440
you can get your account or your ip

137
00:04:43,440 --> 00:04:45,120
address blocked

138
00:04:45,120 --> 00:04:46,720
as a result of the activity if it gets

139
00:04:46,720 --> 00:04:47,240
reported

140
00:04:47,240 --> 00:04:48,880
[Music]

141
00:04:48,880 --> 00:04:51,840
if it gets caught by

142
00:04:51,840 --> 00:04:54,560
malware protection services

143
00:04:54,560 --> 00:04:56,720
it could be added to

144
00:04:56,720 --> 00:05:00,479
a list of a bad reputation list uh and

145
00:05:00,479 --> 00:05:02,720
prevent further abuse

146
00:05:02,720 --> 00:05:04,479
of that url associated with your

147
00:05:04,479 --> 00:05:06,160
infrastructure

148
00:05:06,160 --> 00:05:08,080
the content can be reported and removed

149
00:05:08,080 --> 00:05:09,680
if it's on services

150
00:05:09,680 --> 00:05:11,280
where it's not clear

151
00:05:11,280 --> 00:05:12,080
who

152
00:05:12,080 --> 00:05:13,840
posted the content because in some cases

153
00:05:13,840 --> 00:05:16,400
it isn't uh but all of these are not

154
00:05:16,400 --> 00:05:18,400
really a problem for malware operators

155
00:05:18,400 --> 00:05:20,080
especially since they can these accounts

156
00:05:20,080 --> 00:05:21,680
are fungible you can create a new

157
00:05:21,680 --> 00:05:25,320
account and move on

158
00:05:28,400 --> 00:05:30,720
so these are the types of legitimate

159
00:05:30,720 --> 00:05:32,880
service abuse we see the most

160
00:05:32,880 --> 00:05:36,400
and they cover all the bases

161
00:05:36,400 --> 00:05:39,600
from stamp standpoint of hosting uh

162
00:05:39,600 --> 00:05:43,120
you can store anything you can uh base64

163
00:05:43,120 --> 00:05:46,240
in code or even

164
00:05:46,639 --> 00:05:49,360
raw in code in some cases uh

165
00:05:49,360 --> 00:05:51,840
raw raw executables in some cases

166
00:05:51,840 --> 00:05:53,680
anything you can put into these

167
00:05:53,680 --> 00:05:56,560
environments can be used and referred to

168
00:05:56,560 --> 00:05:58,479
directly by url

169
00:05:58,479 --> 00:06:01,199
in delivery of malware

170
00:06:01,199 --> 00:06:02,960
either components

171
00:06:02,960 --> 00:06:04,479
scripts

172
00:06:04,479 --> 00:06:07,600
or other elements such as keys

173
00:06:07,600 --> 00:06:09,919
ip addresses for communication

174
00:06:09,919 --> 00:06:12,080
kill switches that prevent

175
00:06:12,080 --> 00:06:14,160
certain functionality from working these

176
00:06:14,160 --> 00:06:16,720
can all be stored in documents or in

177
00:06:16,720 --> 00:06:21,319
files stored in these services

178
00:06:21,520 --> 00:06:24,800
the same goes for exfiltration

179
00:06:24,800 --> 00:06:28,560
there are apis available for

180
00:06:28,560 --> 00:06:30,880
creating documents that

181
00:06:30,880 --> 00:06:33,120
will act as a phishing site

182
00:06:33,120 --> 00:06:35,440
and in some cases the services

183
00:06:35,440 --> 00:06:37,360
themselves can be used for phishing for

184
00:06:37,360 --> 00:06:39,600
example google forms

185
00:06:39,600 --> 00:06:40,479
uh

186
00:06:40,479 --> 00:06:41,759
also

187
00:06:41,759 --> 00:06:44,319
there are other ways to tie

188
00:06:44,319 --> 00:06:45,120
uh

189
00:06:45,120 --> 00:06:48,000
content into these services that allow

190
00:06:48,000 --> 00:06:51,120
for spoofing of logins to

191
00:06:51,120 --> 00:06:52,960
collect that information as well as

192
00:06:52,960 --> 00:06:55,440
other pii

193
00:06:55,440 --> 00:06:56,479
but

194
00:06:56,479 --> 00:06:57,360
what's

195
00:06:57,360 --> 00:06:58,880
more interesting

196
00:06:58,880 --> 00:07:01,599
is that we are in seeing the increased

197
00:07:01,599 --> 00:07:02,880
use of these services for the

198
00:07:02,880 --> 00:07:04,960
programmatic export of system data and

199
00:07:04,960 --> 00:07:06,960
user data so

200
00:07:06,960 --> 00:07:09,440
in these cases malware

201
00:07:09,440 --> 00:07:10,880
can

202
00:07:10,880 --> 00:07:11,919
read

203
00:07:11,919 --> 00:07:15,120
local system data execute

204
00:07:15,120 --> 00:07:17,360
powershell commands or other commands uh

205
00:07:17,360 --> 00:07:19,919
nwmi commands to grab information about

206
00:07:19,919 --> 00:07:21,039
the user

207
00:07:21,039 --> 00:07:21,840
uh

208
00:07:21,840 --> 00:07:23,039
export

209
00:07:23,039 --> 00:07:24,880
hash tables export

210
00:07:24,880 --> 00:07:27,039
cookies export

211
00:07:27,039 --> 00:07:30,000
other data from browsers uh that they

212
00:07:30,000 --> 00:07:31,680
may be able to grab

213
00:07:31,680 --> 00:07:34,319
and put them all into

214
00:07:34,319 --> 00:07:35,759
some form

215
00:07:35,759 --> 00:07:39,759
that can be posted via an http

216
00:07:39,759 --> 00:07:43,360
post or directly written through an api

217
00:07:43,360 --> 00:07:44,400
to

218
00:07:44,400 --> 00:07:48,560
a remote document or remote storage

219
00:07:49,599 --> 00:07:52,160
and the third way is messaging so

220
00:07:52,160 --> 00:07:54,400
we have seen

221
00:07:54,400 --> 00:07:56,879
many of these services used

222
00:07:56,879 --> 00:07:59,599
for synchronous or asynchronous

223
00:07:59,599 --> 00:08:01,120
communication

224
00:08:01,120 --> 00:08:03,039
of information

225
00:08:03,039 --> 00:08:05,039
to and from malware

226
00:08:05,039 --> 00:08:06,639
uh we've seen

227
00:08:06,639 --> 00:08:08,720
the apis used for delivering

228
00:08:08,720 --> 00:08:11,039
notification success of installation of

229
00:08:11,039 --> 00:08:13,360
malware uh as well as other data

230
00:08:13,360 --> 00:08:15,120
collected by malware in the exploration

231
00:08:15,120 --> 00:08:17,759
phase and we've also seen messages going

232
00:08:17,759 --> 00:08:19,039
the other way

233
00:08:19,039 --> 00:08:21,919
from operators to malware sending

234
00:08:21,919 --> 00:08:23,280
changes to

235
00:08:23,280 --> 00:08:27,039
hosting information and to

236
00:08:27,039 --> 00:08:28,720
the ex-fil locations or changes to

237
00:08:28,720 --> 00:08:33,360
gateways for tools to connect to

238
00:08:33,360 --> 00:08:36,320
these are all cape all can be done uh in

239
00:08:36,320 --> 00:08:39,440
ways that are not necessarily observable

240
00:08:39,440 --> 00:08:43,599
by people not who are just

241
00:08:43,599 --> 00:08:46,160
casually observing the documents or

242
00:08:46,160 --> 00:08:48,560
services that these are connected to

243
00:08:48,560 --> 00:08:50,480
in some cases

244
00:08:50,480 --> 00:08:52,240
these services provide an entirely

245
00:08:52,240 --> 00:08:53,279
private

246
00:08:53,279 --> 00:08:54,880
communication channel

247
00:08:54,880 --> 00:08:56,880
that

248
00:08:56,880 --> 00:08:58,480
is isolated from the rest of the users

249
00:08:58,480 --> 00:09:01,120
of the service

250
00:09:05,360 --> 00:09:06,320
so

251
00:09:06,320 --> 00:09:08,320
as i mentioned google docs and other

252
00:09:08,320 --> 00:09:10,160
google services are

253
00:09:10,160 --> 00:09:11,360
something we saw as one of the more

254
00:09:11,360 --> 00:09:13,120
frequently viewed services and malware

255
00:09:13,120 --> 00:09:16,399
activity uh but these four services

256
00:09:16,399 --> 00:09:17,839
account for

257
00:09:17,839 --> 00:09:20,000
uh the lion's share

258
00:09:20,000 --> 00:09:23,120
of malicious activity on legitimate

259
00:09:23,120 --> 00:09:25,360
services that we've observed so far they

260
00:09:25,360 --> 00:09:28,959
are not by any means the only ones uh we

261
00:09:28,959 --> 00:09:31,040
have seen abuse of

262
00:09:31,040 --> 00:09:33,920
other services including um

263
00:09:33,920 --> 00:09:35,040
slack

264
00:09:35,040 --> 00:09:37,600
and other collaboration platforms

265
00:09:37,600 --> 00:09:39,440
but generally speaking

266
00:09:39,440 --> 00:09:42,720
these are the the top four so google

267
00:09:42,720 --> 00:09:44,000
docs

268
00:09:44,000 --> 00:09:45,680
discord

269
00:09:45,680 --> 00:09:48,080
which you might be familiar with

270
00:09:48,080 --> 00:09:51,839
paste bin and telegram

271
00:09:51,839 --> 00:09:53,920
google docs uh widely used by

272
00:09:53,920 --> 00:09:56,720
organizations especially right now

273
00:09:56,720 --> 00:09:59,200
in pandemic times

274
00:09:59,200 --> 00:10:02,240
there are many organizations that have

275
00:10:02,240 --> 00:10:04,720
gone to google docs as their default

276
00:10:04,720 --> 00:10:07,839
desktop collaboration environment

277
00:10:07,839 --> 00:10:10,240
uh discord also has been picked up by

278
00:10:10,240 --> 00:10:12,240
many organizations as a collaboration

279
00:10:12,240 --> 00:10:14,720
environment and is

280
00:10:14,720 --> 00:10:17,519
widely used in gaming and by people uh

281
00:10:17,519 --> 00:10:19,600
in other communities

282
00:10:19,600 --> 00:10:20,800
paste bin

283
00:10:20,800 --> 00:10:23,200
uh well it's been abused for quite some

284
00:10:23,200 --> 00:10:25,279
time in other in many ways

285
00:10:25,279 --> 00:10:28,959
but it's also heavily used in

286
00:10:28,959 --> 00:10:31,279
collaboration space and used amongst

287
00:10:31,279 --> 00:10:32,560
developers

288
00:10:32,560 --> 00:10:34,399
and telegram

289
00:10:34,399 --> 00:10:35,920
telegram is a

290
00:10:35,920 --> 00:10:38,000
freedom of speech oriented

291
00:10:38,000 --> 00:10:39,680
communication service

292
00:10:39,680 --> 00:10:42,720
that has it hosts communities

293
00:10:42,720 --> 00:10:45,760
and as we've seen recently it's started

294
00:10:45,760 --> 00:10:47,200
to host a number at communities that

295
00:10:47,200 --> 00:10:48,640
have been pushed out of other social

296
00:10:48,640 --> 00:10:50,640
media environments but it's also being

297
00:10:50,640 --> 00:10:53,200
used for legitimate serv purposes by

298
00:10:53,200 --> 00:10:56,240
organizations uh because it's free and

299
00:10:56,240 --> 00:10:58,320
it's secure end to end when using the

300
00:10:58,320 --> 00:11:01,760
client and it allows organizations to

301
00:11:01,760 --> 00:11:02,800
have

302
00:11:02,800 --> 00:11:04,720
channels of communication that

303
00:11:04,720 --> 00:11:07,200
are redundant and

304
00:11:07,200 --> 00:11:09,519
won't be observable

305
00:11:09,519 --> 00:11:11,279
in theory

306
00:11:11,279 --> 00:11:12,959
so for the most part we see these

307
00:11:12,959 --> 00:11:14,959
services not being blocked by

308
00:11:14,959 --> 00:11:17,519
organizations paste bin might be more

309
00:11:17,519 --> 00:11:20,160
frequently but we very seldom see any of

310
00:11:20,160 --> 00:11:24,000
these services blocked by organizations

311
00:11:26,160 --> 00:11:29,680
telegram uh in particular uh

312
00:11:29,680 --> 00:11:33,680
it has a very sophisticated api

313
00:11:33,680 --> 00:11:35,760
that can be used for bots

314
00:11:35,760 --> 00:11:38,560
uh we've seen that bot api implemented

315
00:11:38,560 --> 00:11:42,399
by a number of remote access tools

316
00:11:42,399 --> 00:11:44,000
things that steal

317
00:11:44,000 --> 00:11:46,640
information off of devices

318
00:11:46,640 --> 00:11:50,160
and including toxic guy a one a

319
00:11:50,160 --> 00:11:52,399
particular flavor of rat

320
00:11:52,399 --> 00:11:54,639
we've also seen it used by raccoon

321
00:11:54,639 --> 00:11:57,519
steeler and other rats

322
00:11:57,519 --> 00:11:59,040
as well as

323
00:11:59,040 --> 00:12:01,760
other malware

324
00:12:02,399 --> 00:12:03,760
you can use this messaging

325
00:12:03,760 --> 00:12:05,680
infrastructure to

326
00:12:05,680 --> 00:12:08,320
do things like sending messages but it

327
00:12:08,320 --> 00:12:10,959
also allows for

328
00:12:10,959 --> 00:12:14,000
file transfers as i'll show in a moment

329
00:12:14,000 --> 00:12:15,760
and uh we see we've also seen

330
00:12:15,760 --> 00:12:17,279
communication not through actual

331
00:12:17,279 --> 00:12:18,959
messages but through channel names and

332
00:12:18,959 --> 00:12:21,680
descriptions uh within

333
00:12:21,680 --> 00:12:23,600
telegram allowing

334
00:12:23,600 --> 00:12:27,200
just simple web scraping of data out of

335
00:12:27,200 --> 00:12:28,959
a telegram channel

336
00:12:28,959 --> 00:12:30,560
to change the

337
00:12:30,560 --> 00:12:33,760
behavior of malware

338
00:12:34,160 --> 00:12:35,360
also

339
00:12:35,360 --> 00:12:38,079
since we've seen more use of telegram by

340
00:12:38,079 --> 00:12:39,600
communities

341
00:12:39,600 --> 00:12:40,959
there's the opportunity for malware

342
00:12:40,959 --> 00:12:42,959
distribution through social engineering

343
00:12:42,959 --> 00:12:44,880
so you can upload files up to 50

344
00:12:44,880 --> 00:12:46,160
megabytes

345
00:12:46,160 --> 00:12:47,120
uh

346
00:12:47,120 --> 00:12:49,600
they can be zipped in

347
00:12:49,600 --> 00:12:51,519
in advertised documents

348
00:12:51,519 --> 00:12:53,279
and

349
00:12:53,279 --> 00:12:54,720
if they can be delivered either by

350
00:12:54,720 --> 00:12:56,720
private message or in a channel

351
00:12:56,720 --> 00:12:58,000
and

352
00:12:58,000 --> 00:12:59,120
it's

353
00:12:59,120 --> 00:13:00,880
depending upon who the audience is what

354
00:13:00,880 --> 00:13:03,040
it's labeled as you can spoof what the

355
00:13:03,040 --> 00:13:05,519
contents is and get people to download

356
00:13:05,519 --> 00:13:06,480
them

357
00:13:06,480 --> 00:13:07,600
and

358
00:13:07,600 --> 00:13:10,560
distribute your malware

359
00:13:13,839 --> 00:13:16,880
so this is uh the

360
00:13:17,120 --> 00:13:22,399
send document api for for telegram

361
00:13:22,399 --> 00:13:23,680
uh

362
00:13:23,680 --> 00:13:25,279
you can

363
00:13:25,279 --> 00:13:27,839
as you can see they've given

364
00:13:27,839 --> 00:13:30,560
they have a rich api for sending

365
00:13:30,560 --> 00:13:32,079
documents

366
00:13:32,079 --> 00:13:33,839
this allows not only for a document to

367
00:13:33,839 --> 00:13:36,160
be uploaded but once it's uploaded it

368
00:13:36,160 --> 00:13:38,240
gets a url so

369
00:13:38,240 --> 00:13:39,839
it can be used

370
00:13:39,839 --> 00:13:43,199
both for exfiltration by a bot so a bot

371
00:13:43,199 --> 00:13:45,680
could collect data on the local system

372
00:13:45,680 --> 00:13:47,680
put it into a file and upload it and

373
00:13:47,680 --> 00:13:49,760
send it as a message back to the to the

374
00:13:49,760 --> 00:13:51,279
malware operator

375
00:13:51,279 --> 00:13:54,160
or it can simply be uploaded into

376
00:13:54,160 --> 00:13:57,279
a channel and then it becomes a url that

377
00:13:57,279 --> 00:13:58,959
can be scraped out and used by other

378
00:13:58,959 --> 00:14:01,959
bots

379
00:14:04,240 --> 00:14:06,320
in the case of telegram or pardon me in

380
00:14:06,320 --> 00:14:08,880
the case of raccoon stealer we saw

381
00:14:08,880 --> 00:14:11,360
telegram channel descriptions used

382
00:14:11,360 --> 00:14:13,120
to advertise

383
00:14:13,120 --> 00:14:16,000
the changing address of the c2 gateway

384
00:14:16,000 --> 00:14:18,480
for exfiltrating data so as you can see

385
00:14:18,480 --> 00:14:19,279
here

386
00:14:19,279 --> 00:14:21,600
we have an older to the right there's an

387
00:14:21,600 --> 00:14:23,440
older

388
00:14:23,440 --> 00:14:24,560
grab

389
00:14:24,560 --> 00:14:27,440
from a web arc a web archive of this

390
00:14:27,440 --> 00:14:30,320
particular telegram channel and then to

391
00:14:30,320 --> 00:14:32,720
the left is a more recent grab of the

392
00:14:32,720 --> 00:14:34,800
same channel from a client

393
00:14:34,800 --> 00:14:35,920
and

394
00:14:35,920 --> 00:14:38,240
as the uh

395
00:14:38,240 --> 00:14:41,279
depending upon the activity of the rat

396
00:14:41,279 --> 00:14:45,360
or as the infrastructure changes

397
00:14:45,360 --> 00:14:47,279
the raccoon steeler

398
00:14:47,279 --> 00:14:49,839
operators can push out

399
00:14:49,839 --> 00:14:51,360
these encoded

400
00:14:51,360 --> 00:14:55,519
post addresses for their c2 gateways

401
00:14:55,519 --> 00:14:57,279
to redirect

402
00:14:57,279 --> 00:15:00,240
where the malware sends data

403
00:15:00,240 --> 00:15:02,320
now raccoon steeler is a

404
00:15:02,320 --> 00:15:04,399
steeler as a service

405
00:15:04,399 --> 00:15:05,600
so

406
00:15:05,600 --> 00:15:08,560
these gateways are operated for multiple

407
00:15:08,560 --> 00:15:10,240
attackers

408
00:15:10,240 --> 00:15:12,959
raccoon steelers sells the malware

409
00:15:12,959 --> 00:15:14,959
as a subscription service

410
00:15:14,959 --> 00:15:17,120
to people who are looking to steal

411
00:15:17,120 --> 00:15:18,320
credentials

412
00:15:18,320 --> 00:15:20,399
they deploy it in various ways

413
00:15:20,399 --> 00:15:21,279
and

414
00:15:21,279 --> 00:15:23,519
the back end connects through this

415
00:15:23,519 --> 00:15:26,959
telegram channel's address to a gateway

416
00:15:26,959 --> 00:15:28,959
that connects to

417
00:15:28,959 --> 00:15:30,160
a

418
00:15:30,160 --> 00:15:32,399
an encrypt a a tor

419
00:15:32,399 --> 00:15:35,040
panel that the attackers can look at to

420
00:15:35,040 --> 00:15:38,519
collect their data

421
00:15:40,000 --> 00:15:42,320
so the next service up for grabs here is

422
00:15:42,320 --> 00:15:45,680
pastebin uh again uh you can if you

423
00:15:45,680 --> 00:15:48,639
create an account you get an api key so

424
00:15:48,639 --> 00:15:50,320
it's a free api

425
00:15:50,320 --> 00:15:54,240
uh you can programmatically export data

426
00:15:54,240 --> 00:15:55,920
from a script

427
00:15:55,920 --> 00:15:59,279
to create a new paste so you could paste

428
00:15:59,279 --> 00:16:01,040
directly paste

429
00:16:01,040 --> 00:16:02,480
contents of

430
00:16:02,480 --> 00:16:05,199
a hash table things like that to a

431
00:16:05,199 --> 00:16:06,320
document

432
00:16:06,320 --> 00:16:09,120
on pastebin uh

433
00:16:09,120 --> 00:16:12,480
you can also easily scrape raw text uh

434
00:16:12,480 --> 00:16:15,120
by requesting the raw version of the

435
00:16:15,120 --> 00:16:16,160
page

436
00:16:16,160 --> 00:16:18,720
to get uh

437
00:16:18,720 --> 00:16:21,199
get ascii in script

438
00:16:21,199 --> 00:16:23,839
script you get scripts and download them

439
00:16:23,839 --> 00:16:26,399
that allows you to execute directly once

440
00:16:26,399 --> 00:16:28,079
they're written to disk

441
00:16:28,079 --> 00:16:29,199
um

442
00:16:29,199 --> 00:16:32,160
and like the other services all https so

443
00:16:32,160 --> 00:16:34,880
there's no reading of the content

444
00:16:34,880 --> 00:16:36,399
by by

445
00:16:36,399 --> 00:16:38,959
uh firewalls or other

446
00:16:38,959 --> 00:16:42,319
uh other malware protection

447
00:16:43,759 --> 00:16:45,519
so we've seen a number of bad actors

448
00:16:45,519 --> 00:16:48,000
using pastebin as part of their activity

449
00:16:48,000 --> 00:16:50,959
and in this case uh this is a ransomware

450
00:16:50,959 --> 00:16:55,120
operator who was loading a batch file

451
00:16:55,120 --> 00:16:56,399
up to

452
00:16:56,399 --> 00:16:59,199
pastebin as part of their activity and

453
00:16:59,199 --> 00:17:02,399
they would retrieve this directly off of

454
00:17:02,399 --> 00:17:06,000
pastebin for deployment on their targets

455
00:17:06,000 --> 00:17:08,799
uh to the left is

456
00:17:08,799 --> 00:17:10,720
another set of data that was found on

457
00:17:10,720 --> 00:17:12,720
pastebin associated directly with this

458
00:17:12,720 --> 00:17:13,679
group

459
00:17:13,679 --> 00:17:16,000
they are dotless ip addresses that were

460
00:17:16,000 --> 00:17:19,319
used for exfiltration

461
00:17:24,720 --> 00:17:27,439
so pastebin is

462
00:17:27,439 --> 00:17:28,559
different from some of these other

463
00:17:28,559 --> 00:17:30,640
services that there are many clones of

464
00:17:30,640 --> 00:17:33,360
the service we've seen a number of pace

465
00:17:33,360 --> 00:17:36,559
bin like services pop up

466
00:17:36,559 --> 00:17:39,120
they all have legitimate users as well

467
00:17:39,120 --> 00:17:41,360
as illegitimate ones we've seen a

468
00:17:41,360 --> 00:17:44,880
particular amount of malicious use of

469
00:17:44,880 --> 00:17:48,480
ghost bin for example as part of

470
00:17:48,480 --> 00:17:50,080
different malware campaigns including

471
00:17:50,080 --> 00:17:54,240
the the raccoon steeler campaign um

472
00:17:54,240 --> 00:17:55,039
and

473
00:17:55,039 --> 00:17:57,440
these pop-up dailies there's open source

474
00:17:57,440 --> 00:17:59,200
code available for these

475
00:17:59,200 --> 00:18:01,679
so if you do want to invest in running a

476
00:18:01,679 --> 00:18:04,480
private server you can take

477
00:18:04,480 --> 00:18:06,000
the open source code for one of these

478
00:18:06,000 --> 00:18:09,520
services and create your own and

479
00:18:09,520 --> 00:18:11,280
to the eyes of everyone else in the

480
00:18:11,280 --> 00:18:12,960
world this is a legitimate service but

481
00:18:12,960 --> 00:18:15,440
it's simply

482
00:18:15,440 --> 00:18:17,760
a it can be used as a private

483
00:18:17,760 --> 00:18:21,440
exfiltration platform

484
00:18:25,280 --> 00:18:27,760
so let's talk about discord a bit so

485
00:18:27,760 --> 00:18:29,600
discord

486
00:18:29,600 --> 00:18:31,200
it's discord's popularity has

487
00:18:31,200 --> 00:18:32,720
skyrocketed over the past few years it's

488
00:18:32,720 --> 00:18:35,440
big in the gaming community it is also

489
00:18:35,440 --> 00:18:37,440
increasingly used by organizations as a

490
00:18:37,440 --> 00:18:39,360
communications platform

491
00:18:39,360 --> 00:18:40,240
um

492
00:18:40,240 --> 00:18:43,520
easy to set up a private server uh

493
00:18:43,520 --> 00:18:45,520
private server in quotes here because

494
00:18:45,520 --> 00:18:47,679
it's it's just an instance of vm

495
00:18:47,679 --> 00:18:50,400
instance within their environment uh

496
00:18:50,400 --> 00:18:53,280
these run within the google compute

497
00:18:53,280 --> 00:18:54,640
infrastructure

498
00:18:54,640 --> 00:18:55,520
so

499
00:18:55,520 --> 00:18:58,000
they show up as google uh when we look

500
00:18:58,000 --> 00:19:00,080
at malware call homes that are referred

501
00:19:00,080 --> 00:19:02,000
to um

502
00:19:02,000 --> 00:19:03,360
because you can set up a private server

503
00:19:03,360 --> 00:19:05,120
it means there's no virtually no

504
00:19:05,120 --> 00:19:07,520
external moderation on them

505
00:19:07,520 --> 00:19:10,320
uh you moderate your own platform in

506
00:19:10,320 --> 00:19:11,520
discord

507
00:19:11,520 --> 00:19:13,120
that means that you can have any kind of

508
00:19:13,120 --> 00:19:14,960
activity going on there that you want as

509
00:19:14,960 --> 00:19:17,440
long as you aren't inviting new users

510
00:19:17,440 --> 00:19:19,039
into it who will complain

511
00:19:19,039 --> 00:19:21,039
uh and if all of your users or bots

512
00:19:21,039 --> 00:19:22,840
that's going to be simple

513
00:19:22,840 --> 00:19:26,080
um however on the open servers on open

514
00:19:26,080 --> 00:19:29,200
public servers uh community servers uh

515
00:19:29,200 --> 00:19:30,559
we've seen a great deal of social

516
00:19:30,559 --> 00:19:32,080
engineering going on for deployment of

517
00:19:32,080 --> 00:19:35,760
malware so in channels related to gaming

518
00:19:35,760 --> 00:19:38,080
uh we see people dropping malware as

519
00:19:38,080 --> 00:19:40,720
files into chat telling people that

520
00:19:40,720 --> 00:19:42,320
they're used for

521
00:19:42,320 --> 00:19:43,840
improving their game performance and

522
00:19:43,840 --> 00:19:45,360
things like that

523
00:19:45,360 --> 00:19:47,600
as well as other uh social engineering

524
00:19:47,600 --> 00:19:50,320
spoofs um

525
00:19:50,320 --> 00:19:53,120
we've also seen the bot apis for discord

526
00:19:53,120 --> 00:19:55,760
being used by malware to communicate

527
00:19:55,760 --> 00:19:58,320
back to the malware operator in a

528
00:19:58,320 --> 00:20:00,880
discord channel

529
00:20:00,880 --> 00:20:01,919
and

530
00:20:01,919 --> 00:20:04,960
once you post a file into chat

531
00:20:04,960 --> 00:20:08,159
in any cloudflare server in part in any

532
00:20:08,159 --> 00:20:10,159
discord environment

533
00:20:10,159 --> 00:20:13,840
it becomes a cloudflare cdn delivered

534
00:20:13,840 --> 00:20:15,200
url

535
00:20:15,200 --> 00:20:17,880
so everything goes to

536
00:20:17,880 --> 00:20:21,200
cdn.discordapp.com uh and which

537
00:20:21,200 --> 00:20:24,400
front-ends a google storage environment

538
00:20:24,400 --> 00:20:27,039
it's through cloudflare

539
00:20:27,039 --> 00:20:28,400
and

540
00:20:28,400 --> 00:20:29,440
so

541
00:20:29,440 --> 00:20:31,679
you have an instant url that can be

542
00:20:31,679 --> 00:20:33,679
referred to by malware to retrieve and

543
00:20:33,679 --> 00:20:36,400
download components

544
00:20:36,400 --> 00:20:37,840
this means that you can use a private

545
00:20:37,840 --> 00:20:41,120
server as essentially a

546
00:20:41,120 --> 00:20:42,799
staging ground for malware and malware

547
00:20:42,799 --> 00:20:45,280
components as well as a place to store

548
00:20:45,280 --> 00:20:47,039
exfiltrated malware

549
00:20:47,039 --> 00:20:49,360
permanently exfiltrated data

550
00:20:49,360 --> 00:20:52,240
using the api

551
00:20:53,360 --> 00:20:54,880
so when we went looking at what was

552
00:20:54,880 --> 00:20:58,480
going on discord we found a lot of

553
00:20:58,480 --> 00:21:01,039
malware actual malware existing within

554
00:21:01,039 --> 00:21:02,400
the discord environment

555
00:21:02,400 --> 00:21:04,400
uh over eighteen thousand specific

556
00:21:04,400 --> 00:21:07,039
instances and eighteen thousand

557
00:21:07,039 --> 00:21:09,840
samples of malware that were posted

558
00:21:09,840 --> 00:21:11,520
within a six month period

559
00:21:11,520 --> 00:21:14,080
uh we've been working with discord uh

560
00:21:14,080 --> 00:21:16,159
providing them with data about what we

561
00:21:16,159 --> 00:21:17,039
found

562
00:21:17,039 --> 00:21:20,640
uh to help them clean up things but

563
00:21:20,640 --> 00:21:23,919
we saw at one point as many as 8 000 new

564
00:21:23,919 --> 00:21:25,600
pieces of malware a month being posted

565
00:21:25,600 --> 00:21:26,960
into discord

566
00:21:26,960 --> 00:21:29,760
so it's sort of a whack-a-mole situation

567
00:21:29,760 --> 00:21:31,520
unless you're specifically looking for

568
00:21:31,520 --> 00:21:33,760
the malware or scanning it as it gets

569
00:21:33,760 --> 00:21:35,679
uploaded into your environment

570
00:21:35,679 --> 00:21:37,600
which i believe discord is moving

571
00:21:37,600 --> 00:21:38,640
towards

572
00:21:38,640 --> 00:21:40,159
it's difficult to stay on top of the

573
00:21:40,159 --> 00:21:43,720
abuse of the service

574
00:21:44,799 --> 00:21:46,640
one of the pieces of malware we stumbled

575
00:21:46,640 --> 00:21:49,320
upon uh linked to this domain

576
00:21:49,320 --> 00:21:52,000
monster.casa um

577
00:21:52,000 --> 00:21:56,480
it actually has a javascript or jscript

578
00:21:56,480 --> 00:21:58,400
executable javascript

579
00:21:58,400 --> 00:22:00,799
script that's at this domain that was

580
00:22:00,799 --> 00:22:03,039
being retrieved by a loader

581
00:22:03,039 --> 00:22:05,520
uh that was actually being distributed

582
00:22:05,520 --> 00:22:07,360
through discord as well as through other

583
00:22:07,360 --> 00:22:08,320
places

584
00:22:08,320 --> 00:22:09,679
um

585
00:22:09,679 --> 00:22:10,480
the

586
00:22:10,480 --> 00:22:12,720
jscript

587
00:22:12,720 --> 00:22:13,919
executes

588
00:22:13,919 --> 00:22:17,440
uh some commands that steal

589
00:22:17,440 --> 00:22:19,120
information from

590
00:22:19,120 --> 00:22:21,679
the machine they execute on so that

591
00:22:21,679 --> 00:22:24,840
included cookies uh passwords from

592
00:22:24,840 --> 00:22:26,799
browsers and

593
00:22:26,799 --> 00:22:29,120
and discord oauth talk tokens so they

594
00:22:29,120 --> 00:22:31,280
were stealing the accounts of discord

595
00:22:31,280 --> 00:22:33,679
users in addition to other passwords and

596
00:22:33,679 --> 00:22:36,559
data off of the targeted machines

597
00:22:36,559 --> 00:22:37,600
and it was

598
00:22:37,600 --> 00:22:39,120
then sent back

599
00:22:39,120 --> 00:22:41,120
through the discord api to a private

600
00:22:41,120 --> 00:22:43,439
server

601
00:22:47,440 --> 00:22:49,120
google docs

602
00:22:49,120 --> 00:22:50,960
is probably the richest of all these

603
00:22:50,960 --> 00:22:54,240
services in terms of the types of apis

604
00:22:54,240 --> 00:22:55,280
and

605
00:22:55,280 --> 00:22:58,640
content you can push into using this

606
00:22:58,640 --> 00:23:00,640
environment it's also probably the one

607
00:23:00,640 --> 00:23:03,760
that's least likely to be blocked by an

608
00:23:03,760 --> 00:23:05,919
organization since so many organizations

609
00:23:05,919 --> 00:23:08,720
are using google docs to begin with

610
00:23:08,720 --> 00:23:11,200
and google mail

611
00:23:11,200 --> 00:23:14,799
as a well-documented api it's easy to

612
00:23:14,799 --> 00:23:16,880
use for abuse because you can just

613
00:23:16,880 --> 00:23:19,360
scrape and parse content from

614
00:23:19,360 --> 00:23:22,960
from web reads but you can also directly

615
00:23:22,960 --> 00:23:25,039
interact with the content of these

616
00:23:25,039 --> 00:23:28,480
services through the api through

617
00:23:28,480 --> 00:23:30,320
through scripts and

618
00:23:30,320 --> 00:23:32,720
executables

619
00:23:32,720 --> 00:23:34,880
google forms in particular

620
00:23:34,880 --> 00:23:37,840
is really easy to abuse as i will show

621
00:23:37,840 --> 00:23:39,520
later in this presentation

622
00:23:39,520 --> 00:23:43,360
because it uses an html post command

623
00:23:43,360 --> 00:23:46,080
that you can identify the elements of

624
00:23:46,080 --> 00:23:47,919
once you set up the form and then that

625
00:23:47,919 --> 00:23:50,080
can be put into any scripting language

626
00:23:50,080 --> 00:23:50,960
used

627
00:23:50,960 --> 00:23:53,600
and used to take data that has been

628
00:23:53,600 --> 00:23:55,360
extracted

629
00:23:55,360 --> 00:23:59,360
and put into a spreadsheet back end

630
00:23:59,360 --> 00:24:02,559
we've seen google docs the word the the

631
00:24:02,559 --> 00:24:04,799
word processing application and sheets

632
00:24:04,799 --> 00:24:07,120
used to host code

633
00:24:07,120 --> 00:24:10,159
for malware as well as other things uh

634
00:24:10,159 --> 00:24:12,559
these other components and then

635
00:24:12,559 --> 00:24:14,799
we've seen docs sheets and forms all

636
00:24:14,799 --> 00:24:18,520
used for data exfiltration

637
00:24:22,400 --> 00:24:24,080
so google docs

638
00:24:24,080 --> 00:24:27,039
is easy to use for malware to retrieve

639
00:24:27,039 --> 00:24:29,200
data uh there's

640
00:24:29,200 --> 00:24:30,960
a hard way and easy way

641
00:24:30,960 --> 00:24:32,880
you can use a google docs api if you

642
00:24:32,880 --> 00:24:34,159
want to dive into it it's a very

643
00:24:34,159 --> 00:24:36,799
sophisticated api uh there may be some

644
00:24:36,799 --> 00:24:38,159
limits on what you can pull down through

645
00:24:38,159 --> 00:24:40,640
the ap api in free mode

646
00:24:40,640 --> 00:24:43,440
but it it's it's very usable by malware

647
00:24:43,440 --> 00:24:44,720
operators if they want to get into

648
00:24:44,720 --> 00:24:46,960
programming it or if you want to do it

649
00:24:46,960 --> 00:24:49,679
quick and dirty uh you can

650
00:24:49,679 --> 00:24:52,720
use any google docs source

651
00:24:52,720 --> 00:24:53,760
and

652
00:24:53,760 --> 00:24:56,799
download it directly in in a format that

653
00:24:56,799 --> 00:24:59,039
can be parsed by your malware or your

654
00:24:59,039 --> 00:25:01,760
your unwanted application or whatever

655
00:25:01,760 --> 00:25:04,720
form you wanted your script whatever um

656
00:25:04,720 --> 00:25:08,000
just using this particular ul url format

657
00:25:08,000 --> 00:25:10,880
uh you can tell it we wanted text csv if

658
00:25:10,880 --> 00:25:13,120
it's if it's a sheets document and it

659
00:25:13,120 --> 00:25:14,880
will download to

660
00:25:14,880 --> 00:25:19,440
the local device uh you can then parse

661
00:25:19,440 --> 00:25:20,159
it

662
00:25:20,159 --> 00:25:23,039
using your local code so for example you

663
00:25:23,039 --> 00:25:26,480
use python and pandas to go through a

664
00:25:26,480 --> 00:25:28,960
spreadsheet and and extract individual

665
00:25:28,960 --> 00:25:31,840
cells as elements to be used in a script

666
00:25:31,840 --> 00:25:34,480
for malware

667
00:25:36,720 --> 00:25:39,200
uh in this case uh

668
00:25:39,200 --> 00:25:41,120
we found that an encryption key was

669
00:25:41,120 --> 00:25:42,400
being used

670
00:25:42,400 --> 00:25:44,640
by the olympian portuguese banking

671
00:25:44,640 --> 00:25:46,880
trojan

672
00:25:46,880 --> 00:25:49,520
during the operation period of

673
00:25:49,520 --> 00:25:50,480
that

674
00:25:50,480 --> 00:25:51,919
trojan

675
00:25:51,919 --> 00:25:53,760
this document was used during this

676
00:25:53,760 --> 00:25:57,440
campaign it carried a key that activated

677
00:25:57,440 --> 00:25:58,830
the malware

678
00:25:58,830 --> 00:26:00,000
[Music]

679
00:26:00,000 --> 00:26:01,600
the owner put it in trash but it was

680
00:26:01,600 --> 00:26:03,760
still visible on google docs when we

681
00:26:03,760 --> 00:26:05,120
went looking for it

682
00:26:05,120 --> 00:26:08,480
in our telemetry

683
00:26:08,480 --> 00:26:10,159
so this is just one way that google docs

684
00:26:10,159 --> 00:26:12,480
can be used now this was using a

685
00:26:12,480 --> 00:26:13,679
text

686
00:26:13,679 --> 00:26:14,720
view

687
00:26:14,720 --> 00:26:16,960
of the format so when it was loaded it

688
00:26:16,960 --> 00:26:19,120
was raw text and it could be directly

689
00:26:19,120 --> 00:26:22,640
processed uh as a as a text returned

690
00:26:22,640 --> 00:26:25,039
by the malware by the the banking

691
00:26:25,039 --> 00:26:27,840
version itself

692
00:26:28,799 --> 00:26:30,720
here's a little more sophisticated use

693
00:26:30,720 --> 00:26:33,919
of google docs on the back end uh lock

694
00:26:33,919 --> 00:26:37,360
bit during a campaign last october

695
00:26:37,360 --> 00:26:38,799
was using

696
00:26:38,799 --> 00:26:42,480
a google sheets cell in a spanish

697
00:26:42,480 --> 00:26:44,080
document to

698
00:26:44,080 --> 00:26:45,039
hide

699
00:26:45,039 --> 00:26:48,320
powershell code and the malware that was

700
00:26:48,320 --> 00:26:51,039
in the loader was going directly the

701
00:26:51,039 --> 00:26:52,640
loader which was a powershell loader

702
00:26:52,640 --> 00:26:55,919
itself was calling this cell

703
00:26:55,919 --> 00:26:58,080
of the malware and retrieving an

704
00:26:58,080 --> 00:27:01,039
additional shell command

705
00:27:01,039 --> 00:27:04,000
executing more power shell

706
00:27:04,000 --> 00:27:05,840
and this power

707
00:27:05,840 --> 00:27:07,679
opened up a back door

708
00:27:07,679 --> 00:27:10,320
that allowed the attackers to drop

709
00:27:10,320 --> 00:27:14,720
additional files and execute ransomware

710
00:27:18,159 --> 00:27:20,000
google forms

711
00:27:20,000 --> 00:27:22,080
so google forms is

712
00:27:22,080 --> 00:27:24,480
stupid simple and

713
00:27:24,480 --> 00:27:26,399
it's being used

714
00:27:26,399 --> 00:27:28,320
in many legitimate ways by organizations

715
00:27:28,320 --> 00:27:30,000
but it's also being used

716
00:27:30,000 --> 00:27:32,080
very heavily by people in the spamming

717
00:27:32,080 --> 00:27:33,440
world

718
00:27:33,440 --> 00:27:36,000
for data collection and especially for

719
00:27:36,000 --> 00:27:38,720
phishing so in this case we i went

720
00:27:38,720 --> 00:27:40,559
through some recent spam that we

721
00:27:40,559 --> 00:27:42,799
intercepted to looking for links to

722
00:27:42,799 --> 00:27:44,880
google forms and i found

723
00:27:44,880 --> 00:27:47,360
two examples that are particularly

724
00:27:47,360 --> 00:27:49,679
the stand up in particular this one is

725
00:27:49,679 --> 00:27:52,240
targeting uh

726
00:27:52,240 --> 00:27:55,760
microsoft outlook users and or msn users

727
00:27:55,760 --> 00:27:58,080
says um

728
00:27:58,080 --> 00:28:01,600
but it's uh it was as a link to it it

729
00:28:01,600 --> 00:28:03,520
tells people tells the victim or the

730
00:28:03,520 --> 00:28:07,520
target that they need to go in and

731
00:28:07,520 --> 00:28:08,399
check

732
00:28:08,399 --> 00:28:10,880
their password and everything to ensure

733
00:28:10,880 --> 00:28:13,520
they continue to have their microsoft

734
00:28:13,520 --> 00:28:14,559
account

735
00:28:14,559 --> 00:28:16,880
and despite the fact that it says that

736
00:28:16,880 --> 00:28:19,440
this is a google form at the bottom and

737
00:28:19,440 --> 00:28:21,360
that you should never submit passwords

738
00:28:21,360 --> 00:28:25,120
for passwords through google forms uh

739
00:28:25,120 --> 00:28:27,200
we believe based on

740
00:28:27,200 --> 00:28:29,279
the traffic we've seen that people

741
00:28:29,279 --> 00:28:31,840
did actually use this form

742
00:28:31,840 --> 00:28:33,679
and fill it out so

743
00:28:33,679 --> 00:28:36,320
despite all that

744
00:28:36,320 --> 00:28:38,960
that fishing training you're doing uh

745
00:28:38,960 --> 00:28:42,000
it's still happening

746
00:28:42,000 --> 00:28:43,840
here's a slightly more sophisticated

747
00:28:43,840 --> 00:28:47,200
version of the same sort of attack uh

748
00:28:47,200 --> 00:28:48,399
in this case

749
00:28:48,399 --> 00:28:50,960
it's a pretty bare bones email looks

750
00:28:50,960 --> 00:28:52,320
like it's from

751
00:28:52,320 --> 00:28:53,279
uh

752
00:28:53,279 --> 00:28:55,039
an organizational administrator for

753
00:28:55,039 --> 00:28:56,840
office 365

754
00:28:56,840 --> 00:29:02,080
and again it it urges the user to click

755
00:29:02,080 --> 00:29:06,399
on the link to go to google docs to

756
00:29:06,399 --> 00:29:08,159
update their information

757
00:29:08,159 --> 00:29:09,760
to ensure they continue to have access

758
00:29:09,760 --> 00:29:11,279
to their account

759
00:29:11,279 --> 00:29:13,279
um saying that they had received a

760
00:29:13,279 --> 00:29:14,399
request

761
00:29:14,399 --> 00:29:17,200
from the target to terminate their their

762
00:29:17,200 --> 00:29:19,600
account on office 365.

763
00:29:19,600 --> 00:29:21,200
so

764
00:29:21,200 --> 00:29:23,679
again the bottom of this form says is a

765
00:29:23,679 --> 00:29:25,600
google form the url in this form is

766
00:29:25,600 --> 00:29:28,320
docs.google.com

767
00:29:28,320 --> 00:29:30,880
whatever the document name is

768
00:29:30,880 --> 00:29:32,559
and uh

769
00:29:32,559 --> 00:29:34,480
people are still going to click on this

770
00:29:34,480 --> 00:29:37,720
it's inevitable

771
00:29:41,520 --> 00:29:42,320
so

772
00:29:42,320 --> 00:29:44,640
there are two ways to do google docs

773
00:29:44,640 --> 00:29:47,520
exfiltration

774
00:29:47,760 --> 00:29:50,640
aside from phishing uh

775
00:29:50,640 --> 00:29:52,399
again you can use google docs api to

776
00:29:52,399 --> 00:29:54,880
write directly to a document so you

777
00:29:54,880 --> 00:29:58,159
could have malware create a google docs

778
00:29:58,159 --> 00:30:00,320
document that contains

779
00:30:00,320 --> 00:30:03,200
uh all of the hashes all of the encoded

780
00:30:03,200 --> 00:30:05,039
content that you pull out

781
00:30:05,039 --> 00:30:07,600
with malware to a document that can then

782
00:30:07,600 --> 00:30:08,880
be downloaded

783
00:30:08,880 --> 00:30:11,520
by the malware operator

784
00:30:11,520 --> 00:30:13,120
or

785
00:30:13,120 --> 00:30:15,600
you can simply use google forms with an

786
00:30:15,600 --> 00:30:18,480
html post to create a spreadsheet full

787
00:30:18,480 --> 00:30:20,159
of the data from all the victims that

788
00:30:20,159 --> 00:30:22,880
you've hit with this

789
00:30:23,360 --> 00:30:25,520
and we've seen a couple of examples of

790
00:30:25,520 --> 00:30:28,158
exactly that

791
00:30:30,960 --> 00:30:34,080
so this is an italian

792
00:30:34,080 --> 00:30:35,200
malware

793
00:30:35,200 --> 00:30:36,399
it was actually

794
00:30:36,399 --> 00:30:37,760
classified as a potentially unwanted

795
00:30:37,760 --> 00:30:42,720
application uh it advertises itself as a

796
00:30:42,720 --> 00:30:45,600
module to be added to

797
00:30:45,600 --> 00:30:46,960
your browser

798
00:30:46,960 --> 00:30:48,640
in this case it checks it says it's

799
00:30:48,640 --> 00:30:50,530
checking internet explorer

800
00:30:50,530 --> 00:30:53,609
[Music]

801
00:30:55,360 --> 00:30:57,200
when you run this when this gets

802
00:30:57,200 --> 00:31:00,080
executed it pops up this window but one

803
00:31:00,080 --> 00:31:02,320
of the things it does is it sends

804
00:31:02,320 --> 00:31:04,640
a get request

805
00:31:04,640 --> 00:31:06,320
to

806
00:31:06,320 --> 00:31:07,840
google docs

807
00:31:07,840 --> 00:31:09,919
to this specific form

808
00:31:09,919 --> 00:31:12,559
and it posts

809
00:31:12,559 --> 00:31:15,279
the data that fills this form out

810
00:31:15,279 --> 00:31:18,799
without user interaction

811
00:31:18,799 --> 00:31:20,399
and

812
00:31:20,399 --> 00:31:22,799
we've seen another another couple cases

813
00:31:22,799 --> 00:31:25,840
of this going on in one case it was

814
00:31:25,840 --> 00:31:28,640
some malware that was installing

815
00:31:28,640 --> 00:31:29,600
uh

816
00:31:29,600 --> 00:31:33,840
a set of coin coin miners that

817
00:31:33,840 --> 00:31:36,320
clinks to a russian language form that

818
00:31:36,320 --> 00:31:38,880
was exporting data that included uh

819
00:31:38,880 --> 00:31:41,360
window the windows

820
00:31:41,360 --> 00:31:43,440
driver for information about the drive

821
00:31:43,440 --> 00:31:46,080
which video card driver was installed

822
00:31:46,080 --> 00:31:48,320
and the screen resolution so they could

823
00:31:48,320 --> 00:31:50,640
determine whether or not it was worth

824
00:31:50,640 --> 00:31:55,200
trying to use the gpu to do coin mining

825
00:31:56,320 --> 00:31:57,840
again dirt simple in that case it was

826
00:31:57,840 --> 00:31:59,760
using a curl command to do so so there

827
00:31:59,760 --> 00:32:01,039
was no

828
00:32:01,039 --> 00:32:02,640
specific it was using

829
00:32:02,640 --> 00:32:05,200
local resources it was using

830
00:32:05,200 --> 00:32:06,799
the curl script already built into

831
00:32:06,799 --> 00:32:09,039
windows to execute

832
00:32:09,039 --> 00:32:09,840
that

833
00:32:09,840 --> 00:32:12,840
post

834
00:32:16,080 --> 00:32:18,240
so how easy this to do well i'll show

835
00:32:18,240 --> 00:32:20,080
you how easy this is to do

836
00:32:20,080 --> 00:32:22,960
so the first step is to create a form

837
00:32:22,960 --> 00:32:24,480
in google forms if you have a google

838
00:32:24,480 --> 00:32:26,399
account you make one up

839
00:32:26,399 --> 00:32:29,200
create a google account uh and then go

840
00:32:29,200 --> 00:32:32,159
into google docs and create a form and

841
00:32:32,159 --> 00:32:34,080
in this case i just created a simple

842
00:32:34,080 --> 00:32:35,760
three

843
00:32:35,760 --> 00:32:38,240
three entry form uh called tell me about

844
00:32:38,240 --> 00:32:41,039
the rabbits george

845
00:32:41,519 --> 00:32:43,039
and

846
00:32:43,039 --> 00:32:44,399
once you create this form you can

847
00:32:44,399 --> 00:32:45,679
identify

848
00:32:45,679 --> 00:32:47,840
the form fields

849
00:32:47,840 --> 00:32:52,000
by an id by looking in developer mode on

850
00:32:52,000 --> 00:32:56,000
firefox or on chrome

851
00:32:56,000 --> 00:33:00,640
then i executed a sample post to capture

852
00:33:00,640 --> 00:33:02,960
the form data that was being transmitted

853
00:33:02,960 --> 00:33:06,080
to verify those form

854
00:33:06,080 --> 00:33:08,640
ids and as you can see on the right

855
00:33:08,640 --> 00:33:10,960
the transaction gave me the form the

856
00:33:10,960 --> 00:33:12,640
form data was being posted as part of

857
00:33:12,640 --> 00:33:15,120
this i intercepted this with

858
00:33:15,120 --> 00:33:16,320
firefox

859
00:33:16,320 --> 00:33:18,080
and uh

860
00:33:18,080 --> 00:33:21,679
the first three are the form fields

861
00:33:21,679 --> 00:33:24,080
and then there's some other data there

862
00:33:24,080 --> 00:33:26,480
that is honestly

863
00:33:26,480 --> 00:33:28,320
disposable it doesn't necessarily have

864
00:33:28,320 --> 00:33:30,000
to be in the transaction this is just

865
00:33:30,000 --> 00:33:32,080
part of the transaction from the form

866
00:33:32,080 --> 00:33:34,720
but i've done it without these and it's

867
00:33:34,720 --> 00:33:36,720
still successful

868
00:33:36,720 --> 00:33:39,039
so

869
00:33:39,039 --> 00:33:40,720
next step

870
00:33:40,720 --> 00:33:42,399
is to take that

871
00:33:42,399 --> 00:33:43,760
method post

872
00:33:43,760 --> 00:33:47,279
and turn it into code so i wrote a quick

873
00:33:47,279 --> 00:33:49,039
python script

874
00:33:49,039 --> 00:33:50,159
to help me

875
00:33:50,159 --> 00:33:52,399
do the same transaction

876
00:33:52,399 --> 00:33:53,519
uh it

877
00:33:53,519 --> 00:33:56,000
uses subpresses to run powershell

878
00:33:56,000 --> 00:33:57,919
commands to grab data about the local

879
00:33:57,919 --> 00:34:00,720
system and it dumps them into variables

880
00:34:00,720 --> 00:34:01,760
here

881
00:34:01,760 --> 00:34:03,120
and then

882
00:34:03,120 --> 00:34:04,480
it creates

883
00:34:04,480 --> 00:34:06,399
a form response

884
00:34:06,399 --> 00:34:09,040
constructed from

885
00:34:09,040 --> 00:34:11,760
the data i grabbed and from the

886
00:34:11,760 --> 00:34:14,000
information about the form id that i

887
00:34:14,000 --> 00:34:15,440
that i set up

888
00:34:15,440 --> 00:34:18,800
and then it sends that request back to

889
00:34:18,800 --> 00:34:21,918
google forms and i just had a print

890
00:34:21,918 --> 00:34:24,079
there to make it work

891
00:34:24,079 --> 00:34:26,639
um this can be done easily with curl it

892
00:34:26,639 --> 00:34:28,639
can be done with powershell i've been

893
00:34:28,639 --> 00:34:30,320
working on a powershell version to pull

894
00:34:30,320 --> 00:34:31,359
this off

895
00:34:31,359 --> 00:34:35,760
even more effectively and filelessly um

896
00:34:35,760 --> 00:34:37,040
but uh

897
00:34:37,040 --> 00:34:38,239
it works

898
00:34:38,239 --> 00:34:39,280
and

899
00:34:39,280 --> 00:34:41,839
uh it's it's clean and simple and as you

900
00:34:41,839 --> 00:34:44,560
can see from the next slide

901
00:34:44,560 --> 00:34:47,280
uh the output is a little rough because

902
00:34:47,280 --> 00:34:49,040
it was pulling the exact

903
00:34:49,040 --> 00:34:52,239
uh console returns from these

904
00:34:52,239 --> 00:34:54,960
uh these powershell commands and in text

905
00:34:54,960 --> 00:34:57,200
form and dumping them in as part of a

906
00:34:57,200 --> 00:34:58,400
form entry

907
00:34:58,400 --> 00:35:00,640
um but it gives me a lot of i got a lot

908
00:35:00,640 --> 00:35:03,040
of data about the local system uh

909
00:35:03,040 --> 00:35:05,200
if i wanted to i could have gone looking

910
00:35:05,200 --> 00:35:07,119
for cookies and things like that and

911
00:35:07,119 --> 00:35:09,280
post them here as well

912
00:35:09,280 --> 00:35:10,240
so

913
00:35:10,240 --> 00:35:12,720
really very simple to execute uh and

914
00:35:12,720 --> 00:35:14,400
this is why i think we're gonna see more

915
00:35:14,400 --> 00:35:16,640
of these types of attacks we've seen

916
00:35:16,640 --> 00:35:18,560
several so far but more of these types

917
00:35:18,560 --> 00:35:19,920
of uses of this

918
00:35:19,920 --> 00:35:22,560
of this service of use as part of

919
00:35:22,560 --> 00:35:24,480
malware operations

920
00:35:24,480 --> 00:35:26,160
or as part of hands-on keyboard

921
00:35:26,160 --> 00:35:28,320
operations because

922
00:35:28,320 --> 00:35:29,520
why do you want to mess around with

923
00:35:29,520 --> 00:35:31,920
having to

924
00:35:31,920 --> 00:35:34,400
create files locally uh when you can

925
00:35:34,400 --> 00:35:36,160
just run a command

926
00:35:36,160 --> 00:35:38,720
that instantly exfiltrates all the data

927
00:35:38,720 --> 00:35:39,680
that you're trying to grab with the

928
00:35:39,680 --> 00:35:42,400
commands back to a legitimate service

929
00:35:42,400 --> 00:35:43,760
the only way people wouldn't know what

930
00:35:43,760 --> 00:35:45,200
was going on is if they watched to see

931
00:35:45,200 --> 00:35:46,160
if there were

932
00:35:46,160 --> 00:35:47,400
requests to

933
00:35:47,400 --> 00:35:49,119
docs.google.com coming from their

934
00:35:49,119 --> 00:35:51,599
servers

935
00:35:54,640 --> 00:35:56,839
so there are a lot of ways you

936
00:35:56,839 --> 00:36:00,400
can the malware side make this work even

937
00:36:00,400 --> 00:36:02,240
better uh you can do things like

938
00:36:02,240 --> 00:36:04,320
changing the user agent to spoof user

939
00:36:04,320 --> 00:36:06,720
interaction uh make it look like it's

940
00:36:06,720 --> 00:36:10,880
the browser of choice on user systems to

941
00:36:10,880 --> 00:36:14,079
avoid user agent screening

942
00:36:14,079 --> 00:36:17,359
when people are doing uh introspection

943
00:36:17,359 --> 00:36:18,480
uh

944
00:36:18,480 --> 00:36:21,280
you can use field names and forms as a

945
00:36:21,280 --> 00:36:23,839
source of commands so you can look at a

946
00:36:23,839 --> 00:36:25,760
form and now you interact with it other

947
00:36:25,760 --> 00:36:30,079
than to view it and you could have

948
00:36:31,200 --> 00:36:32,320
kill switch

949
00:36:32,320 --> 00:36:34,720
information encoded

950
00:36:34,720 --> 00:36:37,359
ip addresses encoded urls that are read

951
00:36:37,359 --> 00:36:38,720
by the malware

952
00:36:38,720 --> 00:36:41,920
as uh commanding control

953
00:36:41,920 --> 00:36:43,760
as i said you can do this as a file do

954
00:36:43,760 --> 00:36:47,680
list filelessly with powershell um

955
00:36:47,680 --> 00:36:48,480
and

956
00:36:48,480 --> 00:36:50,560
the real problem for defenders here is

957
00:36:50,560 --> 00:36:52,960
that i've seen a number of legitimate

958
00:36:52,960 --> 00:36:55,280
corporate applications that use a lot of

959
00:36:55,280 --> 00:36:57,760
these techniques already you use the use

960
00:36:57,760 --> 00:36:59,440
these services already in what would

961
00:36:59,440 --> 00:37:02,640
appear to be a malicious way

962
00:37:02,880 --> 00:37:06,240
i've seen a lot of use of batch files

963
00:37:06,240 --> 00:37:08,160
and powershell commands that interact

964
00:37:08,160 --> 00:37:10,720
with google docs and other services

965
00:37:10,720 --> 00:37:12,640
that are being used by administrators to

966
00:37:12,640 --> 00:37:14,800
do things that you would think we would

967
00:37:14,800 --> 00:37:16,079
be doing

968
00:37:16,079 --> 00:37:18,640
in other legitimate ways but

969
00:37:18,640 --> 00:37:21,200
because these methods help people get

970
00:37:21,200 --> 00:37:22,720
around

971
00:37:22,720 --> 00:37:24,640
company policy to do specific

972
00:37:24,640 --> 00:37:26,030
applications

973
00:37:26,030 --> 00:37:27,200
[Music]

974
00:37:27,200 --> 00:37:29,119
they are being used for legitimate

975
00:37:29,119 --> 00:37:30,480
purposes and therefore it's difficult

976
00:37:30,480 --> 00:37:34,200
for us to stop them

977
00:37:36,480 --> 00:37:39,599
so with that uh i am open for questions

978
00:37:39,599 --> 00:37:42,320
and i hope to have a few of them from

979
00:37:42,320 --> 00:37:44,079
you uh

980
00:37:44,079 --> 00:37:46,160
look forward to having an open

981
00:37:46,160 --> 00:37:47,200
discussion with you about some of the

982
00:37:47,200 --> 00:37:49,359
other research we're doing i look

983
00:37:49,359 --> 00:37:51,119
forward to pretending to an opportunity

984
00:37:51,119 --> 00:37:52,560
to come back to texas cyber summit in

985
00:37:52,560 --> 00:37:55,119
person next year and uh thank you for

986
00:37:55,119 --> 00:37:56,800
your time i'll take your questions now

987
00:37:56,800 --> 00:38:00,040
in the channel

988
00:38:14,000 --> 00:38:16,079
you

