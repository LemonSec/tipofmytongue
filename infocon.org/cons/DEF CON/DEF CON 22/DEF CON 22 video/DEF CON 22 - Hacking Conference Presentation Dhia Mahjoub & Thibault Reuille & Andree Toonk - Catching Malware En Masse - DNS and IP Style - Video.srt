1
00:00:00,292 --> 00:00:06,458
>> All right hi everyone. So
it's really a great thrill to be
here to talk to you about our

2
00:00:06,458 --> 00:00:11,417
research. Ills basically
catching malware En Masse DNS
and IP style. My name is Dhia

3
00:00:11,417 --> 00:00:18,625
and I work at OpenDNS, I work as
a Senior Security Researcher.
This is Thibault, our guru in

4
00:00:18,625 --> 00:00:24,625
data visualization, very smart
guy and Andree the director of
our network operations. Very

5
00:00:27,583 --> 00:00:35,292
smart dude in terms of internet
and DNS. Let's look at the
agenda today. So we'll start

6
00:00:35,292 --> 00:00:42,292
with an introduction about open
DNS global presence then dive
into the main parts of the talk.

7
00:00:42,292 --> 00:00:48,000
The first one is about catching
malware from a DNS perspective
and the second is looking at the

8
00:00:48,000 --> 00:00:53,958
IP structure and within the
cases we will discuss and
support that with a 3D

9
00:00:53,958 --> 00:00:59,958
visualization that we have. We
open sourced this week. So open
DNS has 22 data centers across

10
00:01:05,375 --> 00:01:11,875
the globe, 4 continents and that
allows us to see a lot of
traffic. Mainly DNS of two

11
00:01:11,875 --> 00:01:17,667
times. Recursive and
authoritative. That allows us to
build a lot of useful models.

12
00:01:17,667 --> 00:01:23,208
Now the first will be about
catching malware in a DNS
perspective but before that

13
00:01:23,208 --> 00:01:29,208
let's look at the, kind of
crimeware ecosystem. Mainly of
today to give some foundations.

14
00:01:32,458 --> 00:01:37,375
So here we see 4 components
maybe. The top part is when you
visit the website that is

15
00:01:37,375 --> 00:01:44,208
compromised or delivering
malicious ads you get some
exploits, scripts running your

16
00:01:44,208 --> 00:01:48,250
machine seeing you have
vulnerability and if that
succeeds you will have a malware

17
00:01:48,250 --> 00:01:54,500
payload dropped on your box and
it will try to phone back to
some CnCs. Usually they are

18
00:01:54,500 --> 00:01:59,458
domains and in this case they
are hosted on fast flux proxy
networks. This is the focus of

19
00:01:59,458 --> 00:02:05,458
this part today. And we'll be
focusing on the Zbot one and
they have a characteristic of

20
00:02:08,875 --> 00:02:14,875
TTL of 150 seconds. And that's
the focus of today. Now a little
bit about our research process,

21
00:02:19,833 --> 00:02:25,083
we start focusing on the Zbot
proxy networks. One is using
hadoop data. Most of it is on

22
00:02:25,083 --> 00:02:31,083
hdsf, the other one is using a
streaming dns traffic, because
we have streaming authoritative

23
00:02:34,083 --> 00:02:39,708
dns traffic coming in so use
that. With that we can identify
the malware and we also

24
00:02:39,708 --> 00:02:47,292
discovered a phony panel hosted
on one of these proxy network
domains. And then at the end we

25
00:02:47,292 --> 00:02:53,833
will share some stats on the
botanic, samples and clients.
What is Fast Flux? I'm sure most

26
00:02:53,833 --> 00:02:57,708
of you know about it. It's a
dominion resolving to a lot of
IPs scattered around the world

27
00:02:57,708 --> 00:03:03,792
or a single IP with a very low
TTL. If we are talking about the
Fast Flux proxy network it's a

28
00:03:03,792 --> 00:03:08,125
cloud in the middle with a lot
of infected bugs they act as an
intermediator or a shield for

29
00:03:08,125 --> 00:03:13,500
communication between the back
on the left and the targets on
the right. Targets is usually in

30
00:03:13,500 --> 00:03:19,250
machines because they have
valuable information you want to
steal. Then the communication

31
00:03:19,250 --> 00:03:24,750
would happen in two directions.
So if the targets get infected
they will phone back to announce

32
00:03:24,750 --> 00:03:30,583
their existence, their status or
data and the back fends they
want to push extra payload they

33
00:03:30,583 --> 00:03:37,708
drop it on the box and further
later it will be dropped on the
target machines. This case we

34
00:03:37,708 --> 00:03:45,333
look at the Zbot proxy fast
network which has a TTL of 150
seconds. Now we mentioned Zeus.

35
00:03:45,333 --> 00:03:51,333
What is Zeus? It's one of the
most advanced crime world tool
kits around. [Applause]. These

36
00:03:57,000 --> 00:04:04,167
are the Zeus guys. So they're
going to load us with Zeus. So
Zeus is one of the most advanced

37
00:04:04,167 --> 00:04:10,750
crime ware tool kits around. You
feed it with an input which is
usually a configuration file and

38
00:04:10,750 --> 00:04:16,750
web injects and the
configuration file will have the
binary ULSs and you give that to

39
00:04:18,792 --> 00:04:24,792
the builder and it will spit out
the binary file. (URL's). Now on
the other side you have a

40
00:04:30,042 --> 00:04:37,667
control panel and that one will
let the adversary control his
bot net because he will see what

41
00:04:37,667 --> 00:04:45,333
kind of machines got infected
and he can monitor his gains.
This slide shows Zeus over the

42
00:04:45,333 --> 00:04:51,333
years. >> Be quiet we don't care
about Zeus. We care about our
new speakers. Cheers.

43
00:04:59,167 --> 00:05:05,167
[Applause]. >> All right thank
you guys. So yeah we were
talking about Zeus. >> Cyber! >>

44
00:05:33,708 --> 00:05:39,708
Move on. >> Venous. Okay we are
in Vegas. So venous has a lot of
CRC's and Fast Flux buttons and

45
00:05:48,542 --> 00:05:54,542
that's the focus of today.
Venous deserves files, binary
files and drop zones. How do we

46
00:06:03,250 --> 00:06:09,250
catch the CNC domains we have
two methods. The first one just
for reference we use a language

47
00:06:13,000 --> 00:06:19,000
that allows it to process the
data and we extract from a set
of files within a certain time

48
00:06:23,250 --> 00:06:29,250
frame we'll extract Fast Flux
domains then we build a graph
then we extract the largest

49
00:06:32,000 --> 00:06:38,542
component. That will give you
empirically the bulk of the
domains and IPs. The other

50
00:06:38,542 --> 00:06:44,708
method is using the stream and
it looks like that. So we have a
lot of fields that are of

51
00:06:44,708 --> 00:06:50,125
interest to you. It's faster
than doing like a batch
processing from HDFS but you

52
00:06:50,125 --> 00:06:55,125
have to have your own filters to
catch what you need because it's
going fast. So for that we can

53
00:06:55,125 --> 00:06:59,333
start with Zbot domains and milk
them for IPs so you build a pool
of IPs and you have the stream

54
00:06:59,333 --> 00:07:05,333
coming so you can grab the
domains that have an IP or name
server IP within that pool. So

55
00:07:09,333 --> 00:07:15,458
having had that what wreck do is
do more investigation using data
visualization and people will

56
00:07:15,458 --> 00:07:23,042
tell us about it. >> Thank you.
So he explained two different
methods to extract some data

57
00:07:23,042 --> 00:07:30,500
linking Zbot and domains with
their IPs. So first let's look
at how to visualize. First we

58
00:07:30,500 --> 00:07:36,500
have the source data. Then we
can convert data using our own
library and visualize it. So

59
00:07:40,417 --> 00:07:46,208
this library this is a small
library. As you can see it's
simple. You can import the

60
00:07:46,208 --> 00:07:50,083
library here and create the
graph and create a couple nodes
and connect them using the nod

61
00:07:50,083 --> 00:07:56,083
keys then you can have ties and
attributes. That gives you the
equivalent of the diagram you

62
00:08:02,708 --> 00:08:10,167
have on the right. Let's look at
how it looks like once we've
extracted the data. So what

63
00:08:10,167 --> 00:08:16,167
we're looking at here  ‑ ‑
[Applause]. Thank you. So what
we're looking at here are the

64
00:08:18,917 --> 00:08:24,917
domains in red and IPs in blue.
Then finally we can play that
over time. Three months. So we

65
00:08:27,833 --> 00:08:35,750
can not that we have a growing
field of the IPs are recycled
and the domains go from one IP

66
00:08:35,750 --> 00:08:42,458
to another. The way we
constructed this animation is we
took all the domains and IPs the

67
00:08:42,458 --> 00:08:48,875
first time and we monitored that
over time and finally we can
create a time line to see all

68
00:08:48,875 --> 00:08:54,875
the events and play it on the
3D. >> Thank you Thibault.
Thanks to this investigation

69
00:08:58,167 --> 00:09:04,167
using visualization and it
helped us confirm a few things.
The next step is to figure out

70
00:09:06,500 --> 00:09:11,917
what are these domains used for.
So it's okay to catch these
domains, relatively easy but we

71
00:09:11,917 --> 00:09:17,708
see here that they are
multipurpose. On the left
they're used by Zeus the generic

72
00:09:17,708 --> 00:09:24,042
Citadel, KINS and ICE IX in
delivering the 3 types of URLs.
The other side you have Asprox

73
00:09:24,042 --> 00:09:29,250
which is a click fraud botanic
and also a fishing in
miscellaneous cases and you will

74
00:09:29,250 --> 00:09:35,250
find it in the white paper so I
have it here for reference. We
saw Zeus URL's and also Citadel

75
00:09:38,917 --> 00:09:45,917
URL's on the Fast Flux domains,
fishing URL's and Asprox a lot
of click fraud traffic using the

76
00:09:45,917 --> 00:09:53,667
CNC domains. Then this
interesting case, this is what
we call a DDoS block. Here it's

77
00:09:53,667 --> 00:09:59,667
announcing the operating system
it's running. And furthermore
what we did, these are some more

78
00:10:05,958 --> 00:10:13,083
cases of other malware using the
domains. Now this someone an
interesting case where we

79
00:10:13,083 --> 00:10:19,083
discovered the hosted on one of
these Fast Flux domains. Pointy
tries to steal passwords from a

80
00:10:21,500 --> 00:10:29,417
variety of applications on your
machine and delivered by exploit
kits or spam. This is how it's

81
00:10:29,417 --> 00:10:36,458
advertised on some hacking
forums. Then this is how it's
detected by some vendors. Now if

82
00:10:36,458 --> 00:10:42,083
we look further into the
structure of the website we'll
see some interesting things. But

83
00:10:42,083 --> 00:10:47,458
that's a base here for example
it has a character set of
(unknown) and a timezone is

84
00:10:47,458 --> 00:10:54,292
Moscow which is an indication of
the origin of the writer or user
of the panel. We also see that

85
00:10:54,292 --> 00:11:00,292
it has the list of all of the
applications it tries to steal
passwords from. Now just some

86
00:11:02,375 --> 00:11:09,292
snap shots for your reference.
You can find them in the white
paper. And a few more here. Now

87
00:11:09,292 --> 00:11:14,917
the next thing we did was to
search for some key words we
found on the panel and try to

88
00:11:14,917 --> 00:11:20,833
find anything related or
similar. And we found like this
website that is hosting another

89
00:11:20,833 --> 00:11:26,833
piece of malware and this one
happens to be [andromida] botnet
malware. And then we looked

90
00:11:30,167 --> 00:11:36,167
more websites having the same
structure as the original panel.
Now let's look at the domains

91
00:11:39,125 --> 00:11:44,000
and how they are, what's their
structure or like where do they
come from. So they are using

92
00:11:44,000 --> 00:11:51,333
mostly dot RU and SU, so this is
the origin or the geographical
location of the actors I would

93
00:11:51,333 --> 00:11:56,542
say. If you look at the bots,
where are they mostly located,
you see them mainly in Russia

94
00:11:56,542 --> 00:12:03,375
and Ukraine. This is an Eastern
European operation to some
extent. However if you look at

95
00:12:03,375 --> 00:12:08,250
the clients looking up the
domains over 24 hours you can
see they're in the U.S. Well,

96
00:12:08,250 --> 00:12:14,917
you can say that's mainly it's
because of traffic in the U.S.
but also maybe because a lot of

97
00:12:14,917 --> 00:12:20,958
valuable information is in a lot
of North American machines,
mainly banking machines. Zeus is

98
00:12:20,958 --> 00:12:26,958
a banking Trojan so it would
make sense. Finally what we did
with the Fast Flux domains is we

99
00:12:29,125 --> 00:12:35,000
saw what malware is going back
to them. We saw with no surprise
that Zbot is the top list and

100
00:12:35,000 --> 00:12:41,500
also Upatre. Upatre is like a
first stage bring down on your
machine. It brings down your

101
00:12:41,500 --> 00:12:48,833
machine extra maliciousness and
in this case it's involved with
Zeus came over like a variant of

102
00:12:48,833 --> 00:12:55,500
Zeus. So in summary about
dealing with DNS we shared with
you information and research

103
00:12:55,500 --> 00:13:00,083
about the Zbot Fast Flux proxy
network. Fast Flux has been
around. In this case fast flocks

104
00:13:00,083 --> 00:13:06,083
proxy network is alive, it's
very active and multipurpose and
used by a variety of malware and

105
00:13:09,042 --> 00:13:13,125
it's merely hosted in Russia and
Ukraine targeting machines in
North America and mostly abusing

106
00:13:13,125 --> 00:13:16,583
.ru and .su .com most abused
TLDs. That's kind of interesting
to look at this very current

107
00:13:16,583 --> 00:13:22,333
threat. Now having covered the
venous style how about the IP
style because that's the

108
00:13:22,333 --> 00:13:28,333
complement of the study here. So
for that we looked at two
different things. Usually

109
00:13:31,875 --> 00:13:39,667
reputation systems they assign
scores to IPs, prefixes or ASNs
but counting the number of IPs

110
00:13:39,667 --> 00:13:47,167
or domains in the structures or
entities. In our study we wanted
to enrich that because that's

111
00:13:47,167 --> 00:13:51,917
kind of weak sometimes and we
wanted to look at the
granularity. In one case finer

112
00:13:51,917 --> 00:13:58,292
than the BgB prefix which is sub
allocated ranges. Say you have a
prefix of /16 you want to look

113
00:13:58,292 --> 00:14:04,500
at smaller granularity, like /28
and 29. On the other end you
want the ASN graph because it's

114
00:14:04,500 --> 00:14:10,667
larger than the single ASN, if
you're just counting numbers,
and that gives us a lot of

115
00:14:10,667 --> 00:14:17,292
valuable intelligence and we
were able to build some really
cool models. So the first one is

116
00:14:17,292 --> 00:14:22,542
about the malicious sub
allocated ranges. The
investigation process is always

117
00:14:22,542 --> 00:14:27,917
trying to start with domains and
IPs and in this case we
investigated the sub allocate

118
00:14:27,917 --> 00:14:32,458
the ranges and we did the same
thing to see what kind of
servers they were running. With

119
00:14:32,458 --> 00:14:38,000
that we were able to follow the
TTP of the adversaries like the
way they operate and how they

120
00:14:38,000 --> 00:14:43,625
bring the infrastructure online
and the timing. Then after that
we were able to generalize the

121
00:14:43,625 --> 00:14:48,458
predictions to block before they
started delivering the attacks.
That was really like ground

122
00:14:48,458 --> 00:14:54,458
breaking. Then over time we were
able to see the shift in the
operations of the adversaries.

123
00:14:59,500 --> 00:15:04,333
So we'll start with this example
that we covered over several
months. This was about nuclear

124
00:15:04,333 --> 00:15:11,208
exploited domains and they were
abusing in Canada for months.
They were basically reserving

125
00:15:11,208 --> 00:15:18,750
IPs, certain customers
suspicious ones, and these IPs
they were ones like /28, 29, 30.

126
00:15:18,750 --> 00:15:24,667
Brought online all at once,
altogether and that lasted for
several months delivering

127
00:15:24,667 --> 00:15:30,667
nuclear exploit kit domains.
After a few months they shifted
to a Ukraine hosted provider

128
00:15:30,667 --> 00:15:37,500
than lasted for 7 days. In this
case however, they shifting MO
because OVH Canada is in the air

129
00:15:37,500 --> 00:15:43,292
space and you were able to grab
information about customers
reserving IPs by looking at the

130
00:15:43,292 --> 00:15:50,917
'who is'. Ukraine is in the ripe
space and that's much difficult
because it's scarce. Also the

131
00:15:50,917 --> 00:15:56,917
IPs were brought online one at a
time and also in randomized
fashion. This is a way to evade

132
00:16:01,292 --> 00:16:07,292
detection. Then they shifted to
another provider. This one is in
Russia. So the Russian one was

133
00:16:11,375 --> 00:16:17,375
keeping the same MO and then
they went back to OVH. In this
case it was the same people

134
00:16:19,750 --> 00:16:25,458
reserving the IPs, the ranges
but the MO changed a little bit.
Now they are using recycled IPs.

135
00:16:25,458 --> 00:16:33,375
IPs that hosted old content or
have a rather clean score. And
again these are like ways to

136
00:16:33,375 --> 00:16:38,167
evade IP reputation system that
is a lot of security vendor's
use. These guys are really

137
00:16:38,167 --> 00:16:44,625
smart. They react and adapt and
try to evade you and give you a
hard time. However over this

138
00:16:44,625 --> 00:16:51,083
period the name servers were
hosted on OVH space. So you
might think name servers are

139
00:16:51,083 --> 00:16:56,167
much more difficult to prove to
be malicious whereas the domains
themselves they are easier if

140
00:16:56,167 --> 00:17:00,750
you can grab it and that's kind
of easier to prove it's related
to a certain exploit kit. Now

141
00:17:00,750 --> 00:17:07,917
this animation shows you the
(unrecognized) pattern of these
domains. You have a lot of them

142
00:17:07,917 --> 00:17:13,917
pop on a single IP, kind of a
firework pattern. It's kind of a
high works pattern here over

143
00:17:16,417 --> 00:17:20,542
time and they just like die out
after a few minutes or few
hours. So it's a very

144
00:17:20,542 --> 00:17:25,292
interesting case here.
Registering domains, delivering
the attacks then just dying and

145
00:17:25,292 --> 00:17:31,875
never coming back. Now we did
the blog back in February about
the study and we also took down

146
00:17:31,875 --> 00:17:37,625
a lot of the domains in
corporation with the research
group malware must die. Having

147
00:17:37,625 --> 00:17:45,375
said that how can we push this
further and kind of give a hard
time back to the adversaries? >>

148
00:17:45,375 --> 00:17:51,375
What's your prediction look
like? >> Prediction? >> Yes,
prediction? [Inaudible].

149
00:18:05,875 --> 00:18:11,875
[Applause]. >> Okay this one is
one of my favorite ones. So
Mr. T is inflicting pain on

150
00:18:17,083 --> 00:18:21,958
Rocky. Real try to do the same
on these adversaries. Let's look
at this case here, this

151
00:18:21,958 --> 00:18:28,375
automatic thing...  Okay stop
there. So we looked at these
reserved IP ranges over time and

152
00:18:28,375 --> 00:18:34,375
we see that they reserved 28
ranges December and within them
1e6 IPs, 86 are used and 63 

153
00:18:40,708 --> 00:18:46,000
percent of them are malicious
and you see the trend growing.
Like in February it was 92 

154
00:18:46,000 --> 00:18:51,875
percent maliciousness. The point
I'm trying to make here is these
guys reserve these ranges, they

155
00:18:51,875 --> 00:18:56,708
deliver the attacks with a high
percentage on these IPs. So it's
no coincidence they're not using

156
00:18:56,708 --> 00:19:04,458
them for other purposes. It's
specifically targeted and trying
to abuse the hosting provider.

157
00:19:04,458 --> 00:19:10,250
Now the point here is that if
you look at the bgb prefixes
where these IPs are living you

158
00:19:10,250 --> 00:19:16,667
will see it's a very course
granularity. It's a huge one,
17/18/19. You got a lot of IPs

159
00:19:16,667 --> 00:19:23,000
to look at in these big ranges.
So you cannot get that nice
laser sharp view of what is

160
00:19:23,000 --> 00:19:30,542
going on. Whereas if you do the
IP ranges finer study that gives
you a lot more visibility into

161
00:19:30,542 --> 00:19:36,667
what's going on and how the bad
actors or adversaries are
thinking. Now the other

162
00:19:36,667 --> 00:19:40,458
interesting thing we did this
tried to fingerprint the IPs.
When we discovered them we know

163
00:19:40,458 --> 00:19:45,250
they're reserved by the same
guys they had the same exact
server set up. The first is

164
00:19:45,250 --> 00:19:51,208
Ukraine then the Russian and
it's the same with OVH Canada.
So the point here is, by looking

165
00:19:51,208 --> 00:19:58,875
at the by the same guys and same
fingerprints and we saw over
time they always serve the

166
00:19:58,875 --> 00:20:05,708
attacks, again this is a
preestablished operation being
carried over and over again and

167
00:20:05,708 --> 00:20:10,000
it's no coincidence so it's
interesting to see that knowing
those facts we're able to

168
00:20:10,000 --> 00:20:15,083
predictively block these IPs
before any domains start
resolving to them. So that's

169
00:20:15,083 --> 00:20:21,458
kind of the breakthrough in the
study. Now over time we also saw
the adversaries were shifting

170
00:20:21,458 --> 00:20:27,458
MO. Now they know what we know.
Sought trend we saw growing is
that they started abusing

171
00:20:29,917 --> 00:20:35,917
compromised domains like domains
were like benign, injected with
sub domains under them and we

172
00:20:39,833 --> 00:20:44,000
did a study about that. So we
started detecting that and we
collected we collected the sub

173
00:20:44,000 --> 00:20:49,917
IPs that were the sub domains
and we had a list of all the
most abused ASNs. We were

174
00:20:49,917 --> 00:20:55,792
looking also at the finer
granularity than the big ASN's
so we looked at small scale

175
00:20:55,792 --> 00:21:01,792
providers trying to see if they
were abused or rogue. Then over
time we were able to kind of see

176
00:21:04,083 --> 00:21:09,458
the evolution of the techniques
and methods of these
adversaries. And that was quite

177
00:21:09,458 --> 00:21:15,375
interesting. So in this case
these malicious sub domains were
delivering exploit kits mainly

178
00:21:15,375 --> 00:21:20,375
and they were dropping Zeus
variance if the infection change
succeeds and go daddy was the

179
00:21:20,375 --> 00:21:26,667
most abused in this case
unfortunately for them. Now
looking at the top abused ASNs

180
00:21:26,667 --> 00:21:32,667
again OVH is on top. 18  percent
of the IPs were malicious were
from OVH and we also have ASNs

181
00:21:37,292 --> 00:21:45,000
scattered across Europe or into
North America. Now this table
here summarizes the evolution of

182
00:21:45,000 --> 00:21:49,208
the TTP of the adversaries. This
one is really cool. I like it
because it kind of gives you the

183
00:21:49,208 --> 00:21:55,000
whole picture. So before like a
few months ago and now is the
current state. So they used to

184
00:21:55,000 --> 00:22:01,125
abuse registered domains under
certain ccTLDs and exclusively
use them for the attacks. Now

185
00:22:01,125 --> 00:22:05,542
days they complement that with
abused sub domains. The second
thing is the IPs they reserved

186
00:22:10,083 --> 00:22:14,875
were all exclusively for
attacks. Now a days they
complement with recycled IPs and

187
00:22:14,875 --> 00:22:20,375
legit stuff. And third they used
to bring the IPs all in
continuous chunks altogether.

188
00:22:20,375 --> 00:22:25,583
Now days it's like randomized
one at a time whenever they feel
like it. Again it's like evasion

189
00:22:25,583 --> 00:22:33,208
techniques. Finally we said they
used to abuse OVH Canada and it
was possible to take advantage

190
00:22:33,208 --> 00:22:41,042
of the air who is because it
tells the customers reserving
the IPs. Now they using OVH

191
00:22:41,042 --> 00:22:47,292
Europe and its the ripe space
which is crossing details and on
top of that they are using

192
00:22:47,292 --> 00:22:52,750
different countries IP pools. So
this is clearly a very
interesting way they shift

193
00:22:52,750 --> 00:23:00,208
operations and methods. But we
were able to kind of follow them
over time. This one here is

194
00:23:00,208 --> 00:23:06,292
about the fine grain hosting
perspective so these are like
small scalable hosting

195
00:23:06,292 --> 00:23:14,292
providers. Mainly serving
maliciousness. This guy here,
another one in Russia and

196
00:23:14,292 --> 00:23:21,750
another in Bulgaria and this one
electric kitten unfortunately
abused in North America. Then a

197
00:23:21,750 --> 00:23:27,625
few more for your reference.
Finally what we did here is look
at the sub domains like the

198
00:23:27,625 --> 00:23:34,583
labels that are injected under
let's say Go Daddy domains.
Usually it's like 3 labels. You

199
00:23:34,583 --> 00:23:42,042
have police.homebusiness.com. So
the top used one were police and
alert police. We thought maybe

200
00:23:42,042 --> 00:23:48,083
this is related to the theme of
the attack and that was the
case. Like the first two they

201
00:23:48,083 --> 00:23:54,458
were used for browser based ware
which is a web page in pops up
saying you've been looking at

202
00:23:54,458 --> 00:23:59,333
weird stuff, porn or what not
and the FBI or local police will
come after you if you don't pay

203
00:23:59,333 --> 00:24:06,000
a ransom. You can kill it by
killing the scripts or the
browser process. It's kind of a

204
00:24:06,000 --> 00:24:13,042
nuisance more than a threat. But
still the labels related to the
attacks in this case. The rest

205
00:24:13,042 --> 00:24:19,042
were mainly randomized but
extracted from English like
dictionaries. So, I know we have

206
00:24:22,958 --> 00:24:28,917
covered a lot. It was mostly DNS
perspective and IPS perspective
by looking at sub allocated

207
00:24:28,917 --> 00:24:35,083
ranges and we mentioned earlier
the view of the ASN graph
topology. So, before we get into

208
00:24:35,083 --> 00:24:41,083
that, we want to know more more
details about the internet
structure. >> Oh, man he's

209
00:24:43,708 --> 00:24:49,708
awake. So yeah the next section
we'll take a closer look at how
we can use ASN relationships and

210
00:24:53,042 --> 00:24:59,000
relationships on the internet
with prefixes to detect more
malware. Before we do that we

211
00:24:59,000 --> 00:25:02,458
need to make sure we're on the
same page and understand how the
internet works . When we talked

212
00:25:02,458 --> 00:25:10,333
to different people we got
different replies. For example,
if I ask my dad what the

213
00:25:10,333 --> 00:25:17,292
internet looks like he will
probably point to the cable
modem. If I ask the sales guy he

214
00:25:17,292 --> 00:25:23,292
says something different and the
next room is where the IT guy is
and I say do you know what it

215
00:25:30,167 --> 00:25:35,083
looks like or can you explain it
to me and giggle because it
reminds him of one episode of

216
00:25:35,083 --> 00:25:40,125
the IT Crowd where you got to
borrow the internet for a day,
the elders of the internet. It

217
00:25:40,125 --> 00:25:46,125
was this magic black book, it
had blinking lights on it as you
can see and wireless. But

218
00:25:48,792 --> 00:25:54,125
obviously the internet is no
magic black book. In fact it is
much moor beautiful. I guess if

219
00:25:54,125 --> 00:25:58,500
you wanted to paint a picture of
the internet, this is sort of
what it would look like. We have

220
00:25:58,500 --> 00:26:05,500
a few more. We do a lot of
visualization so in the next few
slides you will see more. But

221
00:26:05,500 --> 00:26:10,208
the internet obviously as you
know it's a network of networks,
and it's a graph, we love

222
00:26:10,208 --> 00:26:15,958
graphs. So in this picture each
dot represents an autonomous
system and an autonomous system

223
00:26:15,958 --> 00:26:21,167
on the internet is basically one
organization. So open DNS is
autonomous system, Google is an

224
00:26:21,167 --> 00:26:25,458
autonomous system, AT&T is an
autonomous system, Verizon and
so on and so forth. And each of

225
00:26:25,458 --> 00:26:32,792
these systems is identified by a
number which we call an AS
number or sometimes an ASM. Then

226
00:26:32,792 --> 00:26:38,792
each ASM has been allocated or
announces one or more IP 4 or 6
prefixes. It can be one or it

227
00:26:41,250 --> 00:26:46,958
can be several thousands. That's
basically how it works. So we
have all these ASMs, they are

228
00:26:46,958 --> 00:26:54,833
connected to one another or at
least one other because you need
connectivity to others. So, now

229
00:26:54,833 --> 00:26:58,833
imagine you are on the left-hand
side of this graph and want to
get to the right-hand side. You

230
00:26:58,833 --> 00:27:04,500
need to know how to get there,
and so that is why we need a
routing protocol which is called

231
00:27:04,500 --> 00:27:09,417
VGP. VGP will distribute all
this information. VGP in itself
is a really interesting talk

232
00:27:09,417 --> 00:27:14,417
especially what you can do with
that. It's a little out of scope
for this but basically we're

233
00:27:14,417 --> 00:27:22,417
building a graph using VGP
data.You can find all kinds of
public data, Routeviews, we use

234
00:27:22,417 --> 00:27:29,000
our own data. Just so you know
there's about half a million
prefixes out there and about

235
00:27:29,000 --> 00:27:35,875
48,000 ASM so you can build a
really large one which has
challenges when you start to

236
00:27:35,875 --> 00:27:42,792
visualize. That these are just
some references but yeah this is
how you build it. Focus on the

237
00:27:42,792 --> 00:27:48,792
last line, which are 2 items.
One is the actual prefix which
is 67.215.94.0/24, then the next

238
00:27:52,125 --> 00:27:57,708
part is the AS and that shows
how ASM he is are connected to
each other. You can infer all

239
00:27:57,708 --> 00:28:02,167
kinds of interesting data from
this. In this case the one on
the right hand side, 36692 is

240
00:28:02,167 --> 00:28:08,250
open DNS and connected and it's
connected to 2914 from that I
know that's MTT so open up from

241
00:28:08,250 --> 00:28:14,708
MTT so on and so forth. You can
see all kinds of interesting
data from that. Then basically

242
00:28:14,708 --> 00:28:21,542
produce it rough then we can use
that for further analysis. >>
Thank you Andree. So he just

243
00:28:21,542 --> 00:28:27,375
described how to create the
graph data set from the bgb
routing tables. So same thing.

244
00:28:27,375 --> 00:28:35,167
We create with the same concept,
the same library we can create a
graph data set. Then we need to

245
00:28:35,167 --> 00:28:41,458
use very, very simple particle
physics. So even if you're not
math nerds don't run away it's

246
00:28:41,458 --> 00:28:46,667
very simple. Essentially the
concept is very simple, you take
your graph and all pair of nods

247
00:28:46,667 --> 00:28:51,000
that's connected and attract
themselves to a certain point
and every pair of nods not

248
00:28:51,000 --> 00:28:56,375
connected will repulse each
other. So, you can see here two
different forces here.

249
00:28:56,375 --> 00:29:02,125
Attractive force and repulsive
force. They all depend on
distance and they can be

250
00:29:02,125 --> 00:29:07,500
manipulated by constant C. Which
is like multiplied by the square
root of the already divided by

251
00:29:07,500 --> 00:29:14,375
number, lot of complicated words
just to say factor the density.
You can control the density of

252
00:29:14,375 --> 00:29:20,250
the layout just by this constant
C. Okay, so what's it look like.
We start with other nodes in the

253
00:29:20,250 --> 00:29:26,167
same position, random fashion,
cube, or sphere. Doesn't really
matter than then we start

254
00:29:26,167 --> 00:29:30,583
running the particle physics.
What you see here is the
explosion, the graphic expanding

255
00:29:30,583 --> 00:29:36,000
in space. So all the nodes are
connected together and they will
stick together and all the nodes

256
00:29:36,000 --> 00:29:42,000
that disconnect will repulse. So
you can see the layout looks
like molecules which makes sense

257
00:29:44,167 --> 00:29:49,667
because the force directed
algorithm is inspired by
electrical forces and also

258
00:29:49,667 --> 00:29:53,833
forces for celestial bodies.
It's not exactly the same model
because it's way too complicated

259
00:29:53,833 --> 00:30:00,000
to implement but still it's very
close. Then finally you can see
the nodes are vibrating. This

260
00:30:00,000 --> 00:30:06,750
means other forces are becoming
even and that usually the graph
has reached an equilibrium

261
00:30:06,750 --> 00:30:12,750
state. [Inaudible]. This is
really cool but doesn't work
well on scale so we have to take

262
00:30:16,208 --> 00:30:21,167
advantage of parallelization. So
essentially we run the same
thing on the GPU and use a

263
00:30:21,167 --> 00:30:26,125
library called Open CL. Actually
it's more like a specification
because it can be implemented

264
00:30:26,125 --> 00:30:33,750
GA, CPUs, etc. But anyway
essentially Open CL is very
simple. It exposes a couple of

265
00:30:33,750 --> 00:30:39,667
work groups and like work items
which are pretty much cores and
threads in the GPU, and

266
00:30:39,667 --> 00:30:44,583
different kinds of memory like
local memory, private memory.
Private memory is pretty much

267
00:30:44,583 --> 00:30:50,208
the resisters and google memory
is the memory of the GPU.
Essentially it's like a tradeoff

268
00:30:50,208 --> 00:30:55,375
between the ease of access of
the memory and the performance
because the private memory is

269
00:30:55,375 --> 00:31:02,250
actually very fast to access.
Okay main points. Why are we
doing this? We look at the

270
00:31:02,250 --> 00:31:08,042
pictures, okay that's really
cool but what's the point in the
main point is the layout is data

271
00:31:08,042 --> 00:31:13,708
driven versus user driven. As
you can see the layout depends
on the forces and forces depend

272
00:31:13,708 --> 00:31:18,167
on the connections between the
nod. So the results is a layout
and depends on the data

273
00:31:18,167 --> 00:31:23,542
structure you're looking at. It
is much closer to what I like to
call the natural shape of the

274
00:31:23,542 --> 00:31:29,042
data model that you're looking
at. We take advantage of the GPU
for acceleration. We know GPU is

275
00:31:29,042 --> 00:31:36,750
becoming insanely fast to
operate. So it would be a shame
not to take advantage of that

276
00:31:36,750 --> 00:31:43,667
and finally main point humans
are so much better at processing
shapes and color than text data.

277
00:31:43,667 --> 00:31:49,792
So let's see what it looks like.
We'll look at the whole process.
So we take the whole DNS graph.

278
00:31:49,792 --> 00:31:55,792
So, like I said, it's placed in
a random fashion. A big mess of
ASN nods. Rotate around. So on

279
00:31:58,500 --> 00:32:03,833
this layout you don't see the
edges because usually the
process runs off line. It's just

280
00:32:03,833 --> 00:32:10,792
for the performance case we're
trying to go as fast as possible
here. Then we start the force

281
00:32:10,792 --> 00:32:16,042
directed process. As you can see
it's a very heavy process. Every
iteration, I think I had like

282
00:32:16,042 --> 00:32:23,417
0.3 durations per second. So
like close to 3 durations per
second. 0.3 durations per

283
00:32:23,417 --> 00:32:29,417
second. So that runs a GTX550. A
graphic that's like 3, 4 years
old - something like that. Then

284
00:32:33,750 --> 00:32:40,250
that runs for an hour. The
results is something like this.
So as you can see Andree will

285
00:32:40,250 --> 00:32:48,000
give us his expertise on the
graph but you can see the
network is densely connected and

286
00:32:48,000 --> 00:32:54,958
has a strong core and we have
kind of a sparse noids around.
Then we can extract or create

287
00:32:54,958 --> 00:33:00,958
pictures that looks like this.
>> : If you are a network geek
this is sort of what it looks

288
00:33:05,417 --> 00:33:11,792
like and network engineering we
use sort of the loosely defined
terms, loosely defined, tier 1,

289
00:33:11,792 --> 00:33:16,250
tier 2, tier 3, tier 1 is the
core of the internet. There's
only a dozen or so of them

290
00:33:16,250 --> 00:33:22,250
...oops, sorry, ATT, NTT, some
of those. Then around that so
those are the pink ones are sort

291
00:33:25,375 --> 00:33:30,917
of the regional larger regional
networks then at the edge is
where you have your web posters

292
00:33:30,917 --> 00:33:38,708
and people like open DNS, FB and
people like that who don't
provide connectivity to others.

293
00:33:38,708 --> 00:33:44,042
This is another picture where
you can really clearly see that.
But in this you can see the

294
00:33:44,042 --> 00:33:49,292
different clusters which show
sort of the regional networks
and typically these different

295
00:33:49,292 --> 00:33:56,125
clusters represent different
countries. This is an animation
of the internet in the Ukraine

296
00:33:56,125 --> 00:34:04,000
and it shows that Ukraine is
relying on only a few sort of
upstream networks. So if you

297
00:34:04,000 --> 00:34:08,458
want to do something bad if you
are able to take that autonomous
system out of rotation then you

298
00:34:08,458 --> 00:34:13,708
would probably be able to put up
a significant portion of a
country and we've seen similar

299
00:34:13,708 --> 00:34:20,042
things like that in Egypt. Egypt
being taken off line. It's only
possible because there were 3 or

300
00:34:20,042 --> 00:34:25,208
4 major carriers this that
country and more recently in
Syria where there's only one

301
00:34:25,208 --> 00:34:30,875
national Telco, if you shut that
down the whole country is off
line. It's ironic because the

302
00:34:30,875 --> 00:34:35,458
internet was made to survive
nuclear warfare and blah blah
blah and no single points of

303
00:34:35,458 --> 00:34:39,917
failure. The way the internet is
built in a lot of countries is
they're still relying on one or

304
00:34:39,917 --> 00:34:44,833
two networks and if you take
that one out you will be able to
take a significant portion of

305
00:34:44,833 --> 00:34:50,833
it. So I think this is a really
good picture to represent that.
So...  [Applause]. >> This stuff

306
00:34:59,583 --> 00:35:05,583
is awesome. So thank you for
this perspective of the ASN
network. Now the thing is we're

307
00:35:07,833 --> 00:35:14,167
looking after maliciousness.
That was the core of the
research. Now how can we use the

308
00:35:14,167 --> 00:35:21,292
graph to extract maliciousness?
We're introducing the concept of
suspicious or sick blink

309
00:35:21,292 --> 00:35:28,417
peripheral ASNs then we look for
suspicious ones. We look at
domains and IPs and study the

310
00:35:28,417 --> 00:35:33,792
fingerprints and ranges that we
are focused on then that allows
us to build relationships

311
00:35:33,792 --> 00:35:39,792
between the ASNs by considering
the toe poling and then we can
verify the AS Ns. This is kind

312
00:35:49,458 --> 00:35:56,208
of a breakthrough in case. You
will see. Now the malware we're
looking at is some kind of a

313
00:35:56,208 --> 00:36:02,208
Trojan here hosted on the/24,/24
and we took a sample of these
IPs. This is how it's described

314
00:36:04,958 --> 00:36:11,750
by AV vendors and we took the
sample of IPs and we did the
fingerprinting again and we saw

315
00:36:11,750 --> 00:36:15,958
an interesting case of the
previous study which often have
the same server set up. So we

316
00:36:15,958 --> 00:36:21,958
have two clusters of server set
ups. This is set up in bulk. Now
looking at the ASN graph

317
00:36:24,292 --> 00:36:30,292
topology: These here are kind of
brothers and sisters. Peripheral
because they have no downstream

318
00:36:35,000 --> 00:36:37,750
providers. They are on the out
skirts or periphery of the
internet. Now we look for

319
00:36:37,750 --> 00:36:41,250
suspicious ones in this case. So
this is a graph we took a snap
shot from the Ukrainian Russian

320
00:36:41,250 --> 00:36:45,875
IP pace in January and we see
ASNs, siblings and peripheral
and one of the parents is doing

321
00:36:45,875 --> 00:36:51,875
the same. A month and a half
later one of the parents stopped
advertising the kid's prefixes

322
00:36:58,875 --> 00:37:04,875
and more of the children are now
hosting the malicious payload.
Now the thing is we looked at

323
00:37:08,125 --> 00:37:15,375
the entire pool of IPs and we
saw a lot of domains hosted on
them and we also saw the payload

324
00:37:15,375 --> 00:37:21,250
URL's were live. So the point
here is that this is an
operation established in bulk in

325
00:37:21,250 --> 00:37:26,708
advance to deliver this Trojan
payload and the thing is we saw
this across different kind of IP

326
00:37:26,708 --> 00:37:31,875
spaces. So this was a case we
are talking about but we wanted
to scale it up and use it on a

327
00:37:31,875 --> 00:37:37,875
global fashion and here is the
introduction from T‑ bow
perspective. >> : Sure I would

328
00:37:41,042 --> 00:37:47,042
like to give an official
approach of the model so we're
all on the same page and make

329
00:37:51,458 --> 00:37:57,458
sure we're talking about the
same thing. So when we look at
the graph, when we study graph

330
00:38:06,167 --> 00:38:12,167
topology usually we interested
in the number of connections.
Then we can classify all the

331
00:38:15,000 --> 00:38:20,625
Noids depending on the number of
connections that we have. So as
you can see here there's a blue

332
00:38:20,625 --> 00:38:28,167
nod called a sync nod because it
has in coming connections and
the green is the leaf nod. It

333
00:38:28,167 --> 00:38:34,083
only has one outgoing connection
and finally the red one is the
source nods and the source nods

334
00:38:34,083 --> 00:38:38,708
are like two or more outgoing
connections and the white ones
don't respond to the same

335
00:38:38,708 --> 00:38:44,708
criteria. So when we apply the
detection this is what happens.
Essentially we keep only the

336
00:38:47,125 --> 00:38:52,250
peripheral nod which are the
nods that don't have any in
coming connections. Like the

337
00:38:52,250 --> 00:38:58,250
suburbs. Then we keep their
parents and the results is
pretty much a graph with all the

338
00:39:00,417 --> 00:39:05,625
peripheral nodes and their
siblings. Including their
parents as well. So we can apply

339
00:39:05,625 --> 00:39:12,458
this on the same data set for
example if Ukraine which is
relevant in this case, so the

340
00:39:12,458 --> 00:39:17,875
same data set before, same color
code so you can see the
peripheral nodes are red and

341
00:39:17,875 --> 00:39:23,875
green ones and finally when we
apply the filter when we extract
we pretty much prune the core of

342
00:39:26,125 --> 00:39:32,125
the DNS network. This one has a
couple of leaves connected to
the same parents. So that would

343
00:39:37,250 --> 00:39:42,500
be like an interesting candidate
for us to look at. Now if you
look at the whole DNS network

344
00:39:42,500 --> 00:39:47,167
here, I mean the Ukrainian one
you can see there's a lot of
candidates so another better

345
00:39:47,167 --> 00:39:53,583
approach to start from one noid
malicious ASN and see if it has
siblings. >> Okay cool. So I

346
00:39:53,583 --> 00:39:59,583
want to do one step back and
sort of summarize what was just
said. What we found was

347
00:40:06,417 --> 00:40:12,375
basically a whole bunch of
prefixes that were hosted by
different ASMs. The ones in red

348
00:40:12,375 --> 00:40:17,292
were hosting similar type of
malware and when we scanned them
we had the same exact

349
00:40:17,292 --> 00:40:24,875
fingerprints. And at some point
some were used to hosting
malware but others we knew they

350
00:40:24,875 --> 00:40:31,917
were coming on in the future.
Why is this interesting? Because
typically we look at malware on

351
00:40:31,917 --> 00:40:38,167
maybe a domain level or IP name
level and sometimes on an AS
level but what seems to be the

352
00:40:38,167 --> 00:40:44,167
case here is these bad guys or
guys hosting this were actually
hide not guilty different ASMs

353
00:40:46,667 --> 00:40:52,333
and typically an ASN is one of
administrative domain. So it
seems like this group of ASN is

354
00:40:52,333 --> 00:40:58,792
one of administrative domain.
Owned and operated by one guy.
So how can we prove that? It's

355
00:40:58,792 --> 00:41:05,000
our hypothesis. So we figured
maybe if one of these ASN's goes
down and they were owned and

356
00:41:05,000 --> 00:41:08,417
operated by the same guy
returning the same
infrastructure all the others

357
00:41:08,417 --> 00:41:12,250
must go down as well because
they're running the same
infrastructure. That was the

358
00:41:12,250 --> 00:41:14,250
idea. How can we prove that? We
looked at the data. So we used
data from the guys, they had

359
00:41:14,250 --> 00:41:18,542
like 2 years worth of all the
outages on the internet. You can
look at update messages, those

360
00:41:18,542 --> 00:41:24,542
are the two main BGP messages
and I will not go into detail
but if you look at it and the

361
00:41:30,708 --> 00:41:36,708
prefix is unreachable and an
hour later there's an update
then you can correlate when

362
00:41:43,542 --> 00:41:50,667
there's an outage. So that's
what we did and looked at all
DNSs and looked for outages and

363
00:41:50,667 --> 00:41:58,458
this was the result. Basically
it's a table showing the ASNs
and the overlapping at the same

364
00:41:58,458 --> 00:42:04,458
time and the main take away is
the numbers are really high over
the course of 6 months or so. So

365
00:42:06,917 --> 00:42:12,917
I'm zooming in to the upstream
ASN. If the upstream goes down
then elders must go down as

366
00:42:16,792 --> 00:42:22,000
well. Makes sense. But what we
see in this case is the upstream
one provider maintained up and

367
00:42:22,000 --> 00:42:28,750
running for most of the time but
the two other ones went down 22
times at the exact same time

368
00:42:28,750 --> 00:42:35,542
over the course of 6 months.
Here are two examples. This is
just for the month of July.

369
00:42:35,542 --> 00:42:41,250
Again a bunch of text but you
can see that or what it shows is
two of these AS Ns went down at

370
00:42:41,250 --> 00:42:47,250
the exact same time., exact same
time, exact same start time, end
time, duration. What does that

371
00:42:52,417 --> 00:42:57,542
mean? I think we proved that
these different ASN recent
actually owned and operated by

372
00:42:57,542 --> 00:43:05,208
the same guys. They just hide.
So we're sure they rely on the
same infrastructure. It could be

373
00:43:05,208 --> 00:43:11,500
the same data center or router
or switch. But we're definitely
sure that it's the same

374
00:43:11,500 --> 00:43:17,083
organization and in fact you
might even go further and say it
could be hosted on the same

375
00:43:17,083 --> 00:43:25,042
physical hardware, same servers
are multiple IP addresses. But
it's a unique approach to find

376
00:43:25,042 --> 00:43:32,000
these sibling ASNs that could be
related and it allows us to
quickly if we know about ASNs

377
00:43:32,000 --> 00:43:36,083
we'll run it and it tells us
which ones are related and we
can then zoom into that. So

378
00:43:36,083 --> 00:43:42,083
that's pretty cool actually.
[Applause]. >> Thanks Thibault
and Andree for the perspective

379
00:43:47,750 --> 00:43:55,667
on the ANS network. So in
conclusion what we shared with
you was the research about

380
00:43:55,667 --> 00:44:01,792
catching maliciousness on the
internet for DNS and IP. How can
we use the ASN graph to extract

381
00:44:01,792 --> 00:44:07,542
the maliciousness we are after.
We are introducing the concept
of suspicious or actually

382
00:44:07,542 --> 00:44:12,583
sibling peripheral ASNs and then
we look for suspicious ones. We
look at IPS and domains and

383
00:44:12,583 --> 00:44:16,042
study fingerprints and the
ranges that we are focused on.
And that allows us begin a

384
00:44:16,042 --> 00:44:19,250
relationship between the ASNs by
considering the ASN topology,
the ASN graph topology. And then

385
00:44:19,250 --> 00:44:23,750
thanks to that we can build a
model and finally we are
proposing a novel approach, we

386
00:44:23,750 --> 00:44:31,292
will talk about it later, to
verify the relationships between
ASN by monitoring bgp outages.

387
00:44:31,292 --> 00:44:37,292
This is kind of a break through
in this case. Now, the malware
we're looking at was some kind

388
00:44:42,583 --> 00:44:48,583
of a trojan here hosted on /23
or /24s. And we took a sample of
these IPs. This is how it's

389
00:44:55,125 --> 00:45:02,333
described on vt by some av
vendors. We took the samples of
the fingerprints again and we

390
00:45:02,333 --> 00:45:04,333
saw the case of the previous
study which is all of them have
the same server set up. Two

391
00:45:04,333 --> 00:45:06,333
clusters of server set ups here.
So this is an operation set up
in bulk in advance. Now looking

392
00:45:06,333 --> 00:45:08,333
at the ASN graph topology we
introduced the concept of SPN.
SNP is sibling peripheral nods.

393
00:45:08,333 --> 00:45:10,333
Sibling in the sense that, you
see the top ASN, they share the
same upstream provider at the

394
00:45:10,333 --> 00:45:12,333
bottom, they rely on him to
provide the advertise his
prefixes. So they are kind of

395
00:45:12,333 --> 00:45:14,333
brothers and sisters in a way.
And peripheral because they have
no downstream providers. So they

396
00:45:14,333 --> 00:45:16,333
are on the peripheral or outside
of the internet. So we look for
suspicious ones in this case. So

397
00:45:16,333 --> 00:45:18,333
this is a subgraph we took. From
the Ukraine, Russia space in
January. You see a bunch of

398
00:45:18,333 --> 00:45:20,333
these ASNs hosting, because they
are in red, the malicious
payload. And one of the parents

399
00:45:20,333 --> 00:45:22,333
is also doing the same. A month
and a half later one of the
parents detached itself and

400
00:45:22,333 --> 00:45:24,333
stopped advertising the kids bpg
prefixes. More of the children
are now hosting the malicious

401
00:45:24,333 --> 00:45:26,333
payload. Now the thing is, we
looked at the entire pool of IPs
and we sw a lot of domains

402
00:45:26,333 --> 00:45:28,333
hosted on them. We also saw the
payloads were live before any
domains started resolving to

403
00:45:28,333 --> 00:45:30,333
them. So the point here is, that
this is an operation established
in bulk in advance and delivered

404
00:45:30,333 --> 00:45:32,333
this Trojan payload and others
across different kinds of IP
spaces. So, this is a case we

405
00:45:32,333 --> 00:45:34,333
are talking about but we wanted
to scale it up and use it on a
global fashion. And here comes

406
00:45:34,333 --> 00:45:36,333
the introduction of SPN from
Thibault's perspective. >> I
like to give a visual approach

407
00:45:36,333 --> 00:45:38,333
of the SPN models so we are all
on the same page and talking
about the same things. When we

408
00:45:38,333 --> 00:45:40,333
study graph topology usually we
are interested in different
fetters. One of them is the

409
00:45:40,333 --> 00:45:42,333
green of the nods, the number of
connections. And we can classify
the number of the noids

410
00:45:42,333 --> 00:45:44,333
depending on the number of
connections we have. There is a
blue noid, called the synch

411
00:45:44,333 --> 00:45:46,333
noid, it has incoming
connections. You have the green,
it's called the leaf. It only

412
00:45:46,333 --> 00:45:48,333
has one outgoing connection,
then finally the red ones, they
are like the source noids. The

413
00:45:48,333 --> 00:45:50,333
source noids have 2 or more
outgoing connections. And the
white ones are the ones that

414
00:45:50,333 --> 00:45:52,333
really don't respond to. So when
we apply the SPN detection, this
is what happens. Essentially we

415
00:45:52,333 --> 00:45:54,333
only keep the peripheral noids,
which are the noids that don't
have any incoming connections.

416
00:45:54,333 --> 00:45:56,333
It's like the suburbs. And then
we keep their parents, it's
pretty much with the peripheral

417
00:45:56,333 --> 00:45:58,333
and their siblings, and
including their parents as well.
So we can apply this on the same

418
00:45:58,333 --> 00:46:00,333
data set for example in Ukraine
which was an (unclear) in this
case. So this is the same data

419
00:46:00,333 --> 00:46:02,333
set, same code, so you can see
all the noids, peripheral ones,
red and green ones. And finally

420
00:46:02,333 --> 00:46:04,333
when we apply the filter we
extract the SPN graph you know.
That will pretty much prune the

421
00:46:04,333 --> 00:46:06,333
core of the SPN network. Then we
can select a couple candidates,
like this one for example. This

422
00:46:06,333 --> 00:46:08,333
one has a couple of leaves
connected together to the same
parents. So that would be a very

423
00:46:08,333 --> 00:46:10,333
interesting candidate for us to
look at. So, if you look at the
whole DNS network, here the

424
00:46:10,333 --> 00:46:12,333
Ukrainian one. You can see there
are a lot of candidates. So
another better approach , to

425
00:46:12,333 --> 00:46:14,333
start with known malicious
suspicious with siblings. It's a
peripheral noid if it has

426
00:46:14,333 --> 00:46:16,333
siblings. >> So, I want to do
one step back and summarize what
Dhia just said. So what we found

427
00:46:16,333 --> 00:46:18,333
was a whole bunch of prefixes
that were hosted by different
ANSs - the ones in red were

428
00:46:18,333 --> 00:46:20,333
hosting similar types of malware
and they had the exact same
fingerprints. And at some point

429
00:46:20,333 --> 00:46:22,333
some were used for hosting
malware and others not yet. They
were coming on in the future.

430
00:46:22,333 --> 00:46:24,333
What is interesting is typically
with blocking malware it will be
on a domain name level, an IP

431
00:46:24,333 --> 00:46:26,333
name level or even sometimes on
a complete AS level. But what
appeared to be the case here was

432
00:46:26,333 --> 00:46:28,333
these bad guys, the guys
hosting, were actually hiding in
different ASNs. And typically

433
00:46:28,333 --> 00:46:30,333
one ASN is one administrative
domain right. So this looks like
this one group of ASN is one

434
00:46:30,333 --> 00:46:32,333
domain, owned and operated by
one guy. Okay, so we say, how
can we prove that. So our

435
00:46:32,333 --> 00:46:34,333
assumption, our hypothesis. So
we figure if maybe, if one of
these ASNs goes down and is

436
00:46:34,333 --> 00:46:36,333
actually owned and operated by
guy running on one
infrastructure then all the

437
00:46:36,333 --> 00:46:38,333
others must go down as well.
That was sort of the idea. So we
looked at how can we prove that.

438
00:46:38,333 --> 00:46:40,333
So we looked at BGP outages
data. So we used data
bgpmon.net. They have all the

439
00:46:40,333 --> 00:46:42,333
information from the past 2
years for all the outages on the
internet that you can query. How

440
00:46:42,333 --> 00:46:44,333
does that work. You can look at
update messages, withdrawal
messages. These are the 2 main

441
00:46:44,333 --> 00:46:46,333
BPG messages and I'm not going
to go into withdrawals. Prefixes
are unreachable and then an hour

442
00:46:46,333 --> 00:46:48,333
later is an update and you do
that from hundreds of routers at
the same time. Then you

443
00:46:48,333 --> 00:46:50,333
basically correlate when there's
an outage. So, that's what we
did. We checked to see if there

444
00:46:50,333 --> 00:46:52,333
were overlaying outages. And
this was a lot of text I know, a
lot of numbers. It's basically

445
00:46:52,333 --> 00:46:54,333
an overlaying table of the ASNs
and the overlaying and outages
at the same time. And the main

446
00:46:54,333 --> 00:46:56,333
take away here is that the
numbers are really high. This is
over the course of 6 months or

447
00:46:56,333 --> 00:46:58,333
so. So, I'm zooming in to 3
ASNs, one is the upstream,
because obviously if the

448
00:46:58,333 --> 00:47:00,333
upstream goes down, it's called
48361 then all the rest must go
down. Makes total sense. But

449
00:47:00,333 --> 00:47:02,333
what we see in this one is the
upstream provider maintains up
and running for most of the time

450
00:47:02,333 --> 00:47:04,333
the 2 other ones went down 22
times at the exact same time
over the course of 6 months. So,

451
00:47:04,333 --> 00:47:06,333
here are 2 examples, just for
the month of July, again a bunch
of text but you can see, what it

452
00:47:06,333 --> 00:47:08,333
shows that 2 of these ASNs went
down at the exact same time,
some for 479 minutes, 33

453
00:47:08,333 --> 00:47:10,333
minutes, 63 minutes, etc. Exact
same start time, end time,
duration. So what does that

454
00:47:10,333 --> 00:47:12,333
mean? I think it proves that
with these different ASNs are
actually owned and operated by

455
00:47:12,333 --> 00:47:14,333
the same guys. They just have
multiple ASNs and hiding behind
that. So we can be sure they are

456
00:47:14,333 --> 00:47:16,333
relying on the same data
structure, could be the same
router, the same switch. The

457
00:47:16,333 --> 00:47:18,333
switch goes down, the whole
thing goes down. But we are
definitely sure it is the same

458
00:47:18,333 --> 00:47:20,333
organization and you might go
further and say it's even being
hosted on the same physical

459
00:47:20,333 --> 00:47:22,333
hardware, same servers have
multiple IP addresses running on
different ASNs. Anyway, it is a

460
00:47:22,333 --> 00:47:24,333
unique way to find these sibling
ASNs that could be related and
it also allows us to quickly if

461
00:47:24,333 --> 00:47:26,333
we know about ASN, we will just
run the script and it will tell
us which ASN script is related,

462
00:47:26,333 --> 00:47:28,333
the outages and then we can zoom
into that. So, that's pretty
cool I think. [Applause]. >> So,

463
00:47:28,333 --> 00:47:30,333
in conclusion what we shared
with you was about capturing
maliciousness on the internet

464
00:47:30,333 --> 00:47:32,333
from a DNS perspective. For DNS
we looked at the Zbot fast flux
proxy network. We described how

465
00:47:32,333 --> 00:47:34,333
catch the domains and how it's
purpose is highly used by
malware. And then on the IP side

466
00:47:34,333 --> 00:47:36,333
we looked at two granularities.
We introduced a novel approach
to monitor relationships based

467
00:47:36,333 --> 00:47:38,333
on the outages and we also
proposed the model of SPN which
is also catching related ones

468
00:47:38,333 --> 00:47:40,333
that have the same kind of
suspicious purpose and finally
we opened sourced our 3D

469
00:47:40,333 --> 00:47:42,333
visualization engine that
Thibault described so you should
use it and contribute back. It's

470
00:47:42,333 --> 00:47:44,333
all for the community and we'll
be very happy to see you
contribute back. [Applause]. >>

471
00:47:44,333 --> 00:47:46,333
Some of the references we used
then you can follow us on
Twitter to keep in touch and

472
00:47:46,333 --> 00:47:48,333
thank you again and if you have
any questions and we have the
time feel free to ask.

473
00:47:48,333 --> 00:47:50,333
[Applause].

