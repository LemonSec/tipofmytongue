00:00:00.000-->00:00:05.005
>>Dr Holtmanns. [applause]
>>Thanks a lot. I’m quite happy
to be here to see so many people

00:00:09.610-->00:00:15.616
interested in mobile phone
security. So the talk will be
basically having 2 parts. Uh

00:00:15.616-->00:00:21.121
because most of you are actually
not from the mobile phone
industry, so I will explain to

00:00:21.121-->00:00:26.159
you how business is done in
mobile phone industry, what we
are facing there, what we are

00:00:26.159-->00:00:31.064
seeing there. And the second
part of the talk I will talk
about really the attack

00:00:31.064-->00:00:35.602
scenarios, we will go into
Wireshark protocol details and
so on so we will have a sort of

00:00:35.602-->00:00:40.607
splitted talk. Um. However,
okay. So I’m here from
industrial research um. And you

00:00:42.876-->00:00:47.881
might ask “Okay do I see now
small advertisement?” No, you
will not. Um but industrial

00:00:52.085-->00:00:57.958
research has some advantages um.
I went to industrial research
at- at academy because I really

00:00:57.958-->00:01:04.164
wanted to do real stuff and the
advantage is I get- I really get
to see the customer data. I see

00:01:04.164-->00:01:10.304
the pcap files and also sort of
when I understand this stuff, I
can go to the product units and

00:01:10.304-->00:01:15.008
tell them “Hey this is s**t,
please do it differently.” So I
really can make an impact and

00:01:15.008-->00:01:20.013
change things. Um the- on the
downside I cannot go to a talk
like this here and say “The

00:01:23.050-->00:01:28.622
industry should fix this!” No
way. I would get beaten up. Uh I
need to come up with all the

00:01:28.622-->00:01:33.627
solutions. And solutions that
are- can be- are worth some
money. I cannot just say “Well,

00:01:36.163-->00:01:41.034
invent mobile phone networks.”
No. So that’s- that’s not an
option for our chief financial

00:01:41.034-->00:01:46.306
officer so I cannot come up with
these kinds of solutions. Uh
also shareholders don’t like

00:01:46.306-->00:01:51.645
that so I have to come back with
things, how to fix things,
without sort of really fully

00:01:51.645-->00:01:56.950
breaking them. So that’s
industrial research so on the 1
side there's a bit of plus but

00:01:56.950-->00:02:02.522
on the other side, well I also
have to think about the
financial aspects. Um so let’s

00:02:02.522-->00:02:07.527
go into the technology a bit. So
roaming. Many people here are
let’s say from Asia so you have

00:02:12.899-->00:02:19.740
subscriptions from China Mobile,
from Airtel, from MegaFon in
Russia, or Telenor in Pakistan.

00:02:19.740-->00:02:24.745
But you’re here in US that means
that you’re most likely connect
to AT&T, Verizon, T-Mobile, or

00:02:28.081-->00:02:34.321
Sprint. And I’m from Finland
which means I’m- have a
subscription from Elisa, but

00:02:34.321-->00:02:40.794
there are also Telia and DNA. So
and the idea is that you switch
on your phone, you go to another

00:02:40.794-->00:02:45.799
country and it works, and it’s
very, actually it’s surprising
that it works, even if you

00:02:48.035-->00:02:53.774
don’t- because I mean these are
different business entities. I
mean they are different

00:02:53.774-->00:02:59.613
countries which don’t like each
other potentially and still it
works. Anybody can call anybody

00:02:59.613-->00:03:04.551
and it works. And this is due to
the so called roaming network,
or Interconnection Network. It’s

00:03:07.387-->00:03:12.392
a big network on the slides you
see the main undersea water
cables and it’s very very big.

00:03:15.062-->00:03:18.398
There are some hubs for example
in Great Britain, there are some
hubs in Frankfurt, there are

00:03:18.398-->00:03:25.005
some hubs on the west coast, on
the east coast are some hubs. So
uh the routing base through this

00:03:25.005-->00:03:30.010
network is based on pricing. So
on the money. So the cheapest
route wins. So this is actually

00:03:32.112-->00:03:38.518
how the network operators
communicate with each other when
you set up a call, international

00:03:38.518-->00:03:43.790
call, or any sort of
communication. And you can think
about it there’s no single

00:03:43.790-->00:03:48.962
controlling entity which is sort
of the most interesting point.
There’s not a government agency

00:03:48.962-->00:03:54.901
controlling all of that. They’re
all independent, all different
governments, regulations,

00:03:54.901-->00:03:59.906
everyone here has its own
regulation. So it’s a very mixed
network. So when you switch-

00:04:04.211-->00:04:09.749
when I switch on my phone, here
it connects probably to some of
the antennas I suppose that most

00:04:09.749-->00:04:15.222
of the hotels here have some
base stations some antennas on
top of it. And then it goes to

00:04:15.222-->00:04:20.727
the local core network of the
operator here. A big of bunch of
servers AT&T or Verizon or

00:04:20.727-->00:04:27.167
whoever I connect to. And they
don’t know me, who I am,
somebody strange from Finland.

00:04:27.167-->00:04:32.539
Ok can we give that person a
service? So what happens then
they basically send a message

00:04:32.539-->00:04:37.544
first to UK over this undersea
cable and then from this IPX
carrier to the Frankfurt most

00:04:39.980-->00:04:46.019
likely, and then to Finland. And
Finland my home network then
says “Yep. Corporate

00:04:46.019-->00:04:51.124
subscription. Data flat rate.
Don’t worry. You’ll be paid.”
And also checking the

00:04:51.124-->00:04:57.430
authentication credentials. So I
get to come back to that picture
later on when I go about the

00:04:57.430-->00:05:02.369
fraud attack. So let’s talk a
bit about the network. Um this
secret network. Well so to

00:05:06.540-->00:05:10.677
understand the security problems
that we face there you need to
understand basically where this

00:05:10.677-->00:05:15.682
network is coming from. And uh
this network was invented in the
Nordic countries in Europe and

00:05:17.884-->00:05:21.955
we do business there slightly
different. I will, sort of.
That’s a business meeting in

00:05:21.955-->00:05:27.194
Finland it’s actually from
Kauppalehti and it’s really a
business meeting. It’s a young

00:05:27.194-->00:05:31.698
entrepreneur meeting in that
case. Uh I had to- got the
copyright for that picture sort

00:05:31.698-->00:05:37.771
of from the nice newspaper that.
And but I'm pretty sure that the
first Nordic Operator meeting in

00:05:37.771-->00:05:43.910
1981 was looking like that. I’m
100 percent sure. Or as my
colleagues all too- too tru- too

00:05:43.910-->00:05:49.516
close to the truth. So Finland
Sweden Norway Denmark and
Iceland and they had pretty

00:05:49.516-->00:05:55.522
serious problems. So they had
problems like they wanted to
talk to each other to exchange

00:05:55.522-->00:05:59.392
vital information like
temperature of sauna, is the
beer already cold? So they had

00:05:59.392-->00:06:04.898
really serious issue. So they
decided “Let’s set up uh that
our networks talk to each

00:06:04.898-->00:06:11.238
other.” And then they were going
into some technical problems.
Sort of okay, underwater cables

00:06:11.238-->00:06:16.343
were needed and uh still
worrying about beer. And there
was a lot of let’s get down to

00:06:16.343-->00:06:23.149
the details. Um. [laughter] I
have- I’ve been in such meetings
myself so they are really like

00:06:23.149-->00:06:26.786
that. It- it’s not- it’s
actually no joke [laughs]. Um so
they were discussing then sort

00:06:26.786-->00:06:31.791
of okay protocols are needed, do
we need security? Ah no not
needed. We all know each other

00:06:37.297-->00:06:42.302
we are just 5 countries. Um
operators [Audio breaks] And so
that’s how basically this- this

00:06:47.507-->00:06:52.512
network was initiated. Um that
was about 35 years ago and it
was built on trust. Eh a lot of

00:06:58.785-->00:07:04.858
n- stuff in Nordic countries
works on trust. Um they had to
sink the system Number 7

00:07:04.858-->00:07:09.863
protocol and that was used on
the communication between the
networks and the networks were

00:07:12.165-->00:07:19.139
[audio breaks] and nowadays we
move from using System 7 to the
4g protocols like diameter for

00:07:19.139-->00:07:24.144
LTE. So summary. 5 Nordic
operators [audio breaks] Um it’s
very mixed membership so you

00:07:42.395-->00:07:48.702
have for example this is here
from Amazon that’s um where they
send you a 1 time password where

00:07:48.702-->00:07:53.707
an SMS. So this is an SMS ag-
aggregator they are called. They
send you these messages. [audio

00:07:56.476-->00:08:01.548
breaks] Connected to the
Interconnection network. And
also the networks themselves are

00:08:01.548-->00:08:06.553
very mixed for example there is
dot TV. People probably know
that ending. It’s for Tuvalu.

00:08:08.788-->00:08:13.460
Tuvalu is an island in the
Pacific. It has
telecommunication network. And

00:08:13.460-->00:08:19.065
they have 47 employees and 1300
subscribers and are happy
probably about everybody who is

00:08:19.065-->00:08:23.503
born there sort of because then
they have 1 subscriber more. On
the other hand we have for

00:08:23.503-->00:08:28.508
example China Mobile which has
roughly uh half a million
employees and 873 million

00:08:31.711-->00:08:37.617
subscribers so it’s quite
different to the uh homogeneous
structure in the beginning where

00:08:37.617-->00:08:44.224
there were just basically every
c- Nordic country has about 5 to
7 million people. So we have now

00:08:44.224-->00:08:49.229
a lot of different entities in
there and I’m pretty sure that
the Tuvalu telecommunication

00:08:51.865-->00:08:57.103
doesn’t have a lot of security
experts. Maybe 1 if they are
lucky. China Mobile has probably

00:08:57.103-->00:09:02.041
money for some more. So well and
the network itself it's nowadays
a mix and match of everything.

00:09:04.444-->00:09:09.449
So as we had in the morning
talks or yesterday at the
Qualcomm talk. And also in 2014

00:09:11.451-->00:09:18.224
we had our first major
incidence. Security awareness
basically started then. And now

00:09:18.224-->00:09:25.065
you might think “Ok, I’m not
roaming, I’m not traveling, why
should I give something about

00:09:25.065-->00:09:32.005
it?” So well [coughs] I’m sorry.
Because with all those connected
IoT devices and self driving

00:09:32.005-->00:09:37.010
cars and webcams and whatever,
they use cellular stuff. So so
there we are. So we need these

00:09:42.715-->00:09:49.522
kinds of things. So also
emergency car systems and so on.
So you are always reachable from

00:09:49.522-->00:09:53.593
the interconnect network just in
case somebody wants to call you.
Somebody is going off- your

00:09:53.593-->00:09:57.730
friend is going off to a
vacation and wants to call you.
So you’re always reachable from

00:09:57.730-->00:10:02.735
this interconnection network. So
security. Uh let’s go first:
sort of who would hack this

00:10:04.737-->00:10:08.575
network? Ah nobody would hack
this network! What- why should
you hack this network? Ok there

00:10:08.575-->00:10:14.047
are sort of different types of
hackers. In this talk we will
fall- focus on fraudsters but

00:10:14.047-->00:10:19.052
the other ones are also sort of
in the stew. So we have um had
some ink there. The first 1 in

00:10:21.254-->00:10:27.560
the corner is uh location
tracking so something like track
your spouse service. Uh the 1

00:10:27.560-->00:10:33.700
below is where they were uh
getting 1 time passwords for the
bank accounts in Germany. Um

00:10:33.700-->00:10:37.737
actually that operator was quite
quick they within a couple of
hours they noticed that

00:10:37.737-->00:10:42.742
something fishy was ongoing and
managed to stop that but of
course, um it get- got into the

00:10:45.211-->00:10:49.182
press and then some damage was
done. But actually they were
quite quick compared to other

00:10:49.182-->00:10:54.187
incident, so. Then there are uh
governmental agencies. I think
in the morning we heard a long

00:10:57.991-->00:11:01.694
talk from the NSA that uh
everybody else hacks the mobile
phone network um I’m afraid they

00:11:01.694-->00:11:12.438
also do. Um this Logic GCHQ that
is a UK agencies but um I also
get lots on my table and I’ve

00:11:12.438-->00:11:16.976
seen many other countries. But
on the other hand you never know
exactly where the attacks are

00:11:16.976-->00:11:22.115
coming from. You just see an IP
address and you know nothing. So
and then there are so called

00:11:22.115-->00:11:30.590
service companies um there are
darknet service companies and
there are governmental service

00:11:30.590-->00:11:37.330
companies because not every
government develops the um
offender stuff themselves. They

00:11:37.330-->00:11:44.270
also very often just buy it from
third parties, as product, as
services. So these guys you find

00:11:44.270-->00:11:50.009
in the network in that
interconnection network. So
these are the attacks that exist

00:11:50.009-->00:11:54.881
nowadays for SS7 and that’s:
location tracking,
eavesdropping, fraud, denial of

00:11:54.881-->00:12:00.887
service, cryptographic key
theft, data session that’s
actually GTP and not SS7, and

00:12:00.887-->00:12:07.827
SMS interception is probably
most important because that
means that these are your 1 time

00:12:07.827-->00:12:14.100
passwords for WhatsApp for- wait
wait not WhatsApp, for Telegram,
Facebook, and so on. So but it’s

00:12:14.100-->00:12:19.472
important to understand that not
networks are equal. They are not
all equal. So some have

00:12:19.472-->00:12:23.643
protection measures in place.
And some have nothing protect-
in place. And some have

00:12:23.643-->00:12:31.284
something in place. So, so you
start wondering “Okay if that’s
a closed and private network,

00:12:31.284-->00:12:40.827
how did get those guys actually
get in?” Well, um we saw you can
rent it as a service, it’s not

00:12:40.827-->00:12:48.635
so expensive so. Um you just go
to the darknet and rent it. You
can fraud ah uh an SMS deception

00:12:48.635-->00:12:53.906
for example or voice
interception you can rent it.
You can, some governments have a

00:12:53.906-->00:12:58.845
very close relationship with the
operator. You must remember that
the government approves the

00:12:58.845-->00:13:03.683
license spectrum. So if the
government doesn’t like the
operator, the operator doesn’t

00:13:03.683-->00:13:11.524
have a license to operate making
money. Hmm. So basically it’s
[phht]. [laughs] So some op-

00:13:11.524-->00:13:20.199
some governments use this uh to
get access to the IPX network.
Um or sort of convincing them

00:13:20.199-->00:13:27.006
and the other way is sometimes
you see notes, mobile
telecommunication notes, which

00:13:27.006-->00:13:32.512
shouldn’t be on the internet but
they are on the internet. You
can find them in Shodan. If you

00:13:32.512-->00:13:36.816
know what you look for, you can
find those notes on Shodan.
Somebody’s just put them on the

00:13:36.816-->00:13:39.652
internet because they wanted to
put the web server on it or they
wanted to work remotely from

00:13:39.652-->00:13:45.224
home and uf want to have some
convenient access because they
didn't want to be 24 hours in

00:13:45.224-->00:13:52.765
the office. So another way is to
become an operator. That’s a
pretty cool thing. You go to an

00:13:52.765-->00:13:57.103
operator, to an existing
operator, and say “hey I want to
have- I want to become a virtual

00:13:57.103-->00:14:05.812
network operator for, mm
Logistic Fleets.” Let’s say-
let’s say Hertz or sort of some

00:14:05.812-->00:14:11.818
rental car agency, Hertz or
something. And you want to be a
sort of service provider. In

00:14:11.818-->00:14:17.490
Europe they have to give you the
access then because it’s- else
it’s anticompetitive. This um

00:14:17.490-->00:14:24.831
antitrust thingy. So because of
competitive reasons they have to
give you access. So and then

00:14:24.831-->00:14:29.068
there are of course the
classical ways, you can be
bribing an employee, you can do

00:14:29.068-->00:14:35.541
social engineering, and so on.
So well you might say “Okay this
is all press and this is not

00:14:35.541-->00:14:43.216
true and uh this is just!” But
actually this here I found very
interesting. Um that was uh I

00:14:43.216-->00:14:49.822
did that SOC in June. That’s
from Shodan and that’s a scanner
that crawled through the

00:14:49.822-->00:14:56.462
internet. And looking for other
notes that talk GTP. Now we need
to know the GTP GPRS tunneling

00:14:56.462-->00:15:02.001
protocol it’s really just a
TelCo protocol. It’s really only
spoken in TelCo nobody else in

00:15:02.001-->00:15:09.442
internet speaks GTP. So um and
it has a lot of ports all like
that. So so uh I’ve been

00:15:09.442-->00:15:13.746
discussing with my colleagues so
like if there’s a legitimate
reason they can think of why

00:15:13.746-->00:15:18.251
this thingy would be on the
internet and we couldn’t come up
with an idea. Might be- maybe

00:15:18.251-->00:15:23.956
somebody has a smart idea but
well at least nobody in our unit
had a good idea why this would

00:15:23.956-->00:15:34.567
be on the internet. Okay now we
move to- from the old protocol
SS7 to the new protocol, and you

00:15:34.567-->00:15:38.538
can ask okay new protocol
everything is better. We no
longer have any problems on new

00:15:38.538-->00:15:44.143
protocol Diameter LTE. And in
this talk we will focus on the
fraud part, but it can be very

00:15:44.143-->00:15:48.714
easily used for denial of
service because if you improve
somebody's service you can

00:15:48.714-->00:15:56.956
easily the same way put it down.
Uh when I switch on my phone as
said uh I connect to the antenna

00:15:56.956-->00:16:04.397
and then the local operator here
in US wants to know um basically
if I pay my bills, what kind of

00:16:04.397-->00:16:11.604
services are I’m allowed, I’m
allowed to have 4G or not. And
so what they do then they

00:16:11.604-->00:16:20.279
contact over the S9 interface.
The- my home operator and ask
for the uh quality of service

00:16:20.279-->00:16:27.720
rules that I have and for the
policy and charging rules. So
now you’ll see a mobile call

00:16:27.720-->00:16:34.927
network, don’t be too afraid of
it, it looks awful. So so what
you- we all need we’ll use those

00:16:34.927-->00:16:40.566
notes which I’ll just highlight
here. My colleague Isha who is
not able to come today, she will

00:16:40.566-->00:16:47.740
talk you through it in a minute,
so these are the notes. And the
other ones we will not talk

00:16:47.740-->00:16:54.213
about, just ignore them. So um
sorry you have still quite some
notes there but mobile networks

00:16:54.213-->00:16:59.652
are extremely complex, and this
is only 4G. Now imagine that you
have all the other types of

00:16:59.652-->00:17:07.460
network also plugged into it. Um
so this actually is network we
use also for testing. So as I

00:17:07.460-->00:17:14.233
said I work for a company and we
cannot just roll out software to
our customers. If we screw up

00:17:14.233-->00:17:17.570
their network they don’t make
money, and they’re very unhappy
with us if they don’t make

00:17:17.570-->00:17:24.343
money. So what we have we have
internal test networks. And this
is some software of it that we

00:17:24.343-->00:17:29.382
use for testing software
rollouts. So that we are sure
that we don’t screw up our

00:17:29.382-->00:17:43.629
customers’ networks. So and that
we used also for- for testing of
this attack. So so this is here

00:17:43.629-->00:17:47.033
the LTE emulator and my
colleague Isha. >>[robotic voice
speaks] software implementation

00:17:47.033-->00:17:53.906
of LTE network designed by Nokia
experts with GTP specifications.
This is the basic architecture

00:17:53.906-->00:18:04.016
of EPSP or UE user is connected
to the EPC or E-UTRAN the erode
node B is the base station for

00:18:04.016-->00:18:13.759
ENB radio. MME is the mobility
management entity handles
signaling related to mobility

00:18:13.759-->00:18:21.634
and security for the E-UTRAN
access. HSS home subscriber
server is the data released that

00:18:21.634-->00:18:28.607
contains user related and
subscriber related information.
S gateway, serving gate way,

00:18:28.607-->00:18:36.882
serves the UE by routing the
incoming and I- outgoing IP
packets. Pedian gate way is the

00:18:36.882-->00:18:43.255
point of interconnection between
the EPC and the external IP
network. PCRF policy and

00:18:43.255-->00:18:49.128
charging rules function supports
service data flow, detection,
policy enforcement, and flow

00:18:49.128-->00:18:59.305
based charging. Diamond or Esmin
interface is between HPCRF and
APCI are responsible for PCC

00:18:59.305-->00:19:05.811
route installation,
modification, and removal.
>>Okay to make it less painful

00:19:05.811-->00:19:12.652
um my suggestion would be is you
focus on the S9 and the PCRF.
PCRF is basically everything

00:19:12.652-->00:19:19.058
sort of related to policy and
charging, so that’s a policy and
charging rule function. This is-

00:19:19.058-->00:19:23.229
this thing this box controls
basically uh what you are
allowed to do or not to do in

00:19:23.229-->00:19:30.970
your network. So basically it
interprets the rules on on what
kind of um activities and

00:19:30.970-->00:19:36.609
services you can use with your-
with your subscription. All the
other notes in there they also

00:19:36.609-->00:19:44.483
have tasks like data based
mobility and IP assignment and
so on so, basically you can just

00:19:44.483-->00:19:52.158
ignore them for now. So focus on
the PCRF that’s with regard to
charging and billing. >>[speaker

00:19:52.158-->00:19:59.698
on slides begins to repeat
herself] >>Uh so-, ahh! So
sorry, it shouldn’t start again.

00:19:59.698-->00:20:04.336
So basically you can think about
the IPX and all those networks
with their nice infrastructure

00:20:04.336-->00:20:09.775
connect to each other via this
IPX and using the S9 interface
to communicate these kind of

00:20:09.775-->00:20:16.215
charging related things with
each other. So this is currently
diameter has currently rolled

00:20:16.215-->00:20:22.721
out in this IPX network, and S9
is not the most common
interface; the most common

00:20:22.721-->00:20:29.161
interface is the S6A interface,
but still S9 is the roaming
interface and it’s critical in

00:20:29.161-->00:20:35.167
the sense that if something goes
wrong there, um then it directly
relates to monetary aspects and

00:20:35.167-->00:20:44.743
potential loss of money. Sorry
that was. So basically here is
the sort of summary of it and we

00:20:44.743-->00:20:50.983
will talk about here about this
S9 where it- we talk to the rest
of the world. Um that’s how the

00:20:50.983-->00:20:56.088
emulator looks like which I will
briefly show you the emulator
and the different notes, which

00:20:56.088-->00:21:11.237
the most important is the PCRF.
>>These are the highlighted LTE
emulator notes. UE controlling

00:21:11.237-->00:21:24.850
process. UE user claim process,
ENB control train, ENB user
plane, MME, S gateway, HSS,

00:21:24.850-->00:21:32.925
PCRF, P gateway, UE escalated to
ENB through the attach
statement, as soon as we attach,

00:21:32.925-->00:21:44.603
we can see the IMSI number of
the UE on all the notes, uh HHS,
PCRF. On P gateway as well as on

00:21:44.603-->00:21:52.478
the S gateway. >>So that’s
basically the emulator we used
with all of the uh virtual notes

00:21:52.478-->00:21:58.517
in there. And this is actually
the normal message flow.
Remember the picture with the of

00:21:58.517-->00:22:04.223
the flags? So basically first
the visited network in this case
it would be US would be asking

00:22:04.223-->00:22:10.496
my home network sort of “Okay
does she have credit?” Yes, or
no. And “what kind of service is

00:22:10.496-->00:22:15.568
this person allowed to use?”
This is sent in the CCR method
to credit- credit control

00:22:15.568-->00:22:20.439
request. And then the credit
control answer. These are
standardized public documents,

00:22:20.439-->00:22:27.346
everybody can read them, they
are on Swedish BP service. Um
then then the home network can

00:22:27.346-->00:22:32.284
do, it’s optional it doesn't
need to but it can send a
re-authentication request and

00:22:32.284-->00:22:37.489
basically this is for example
useful in the case that my
subscription has been cancelled

00:22:37.489-->00:22:42.394
because I have been laid off
because I gave a speech to
DefCon. Uh so for this case the

00:22:42.394-->00:22:47.032
home network can give the
re-authentication request and
say “ha! Cancelled this

00:22:47.032-->00:22:51.670
subscription.” So this is the
purpose of the message, that’s
how it’s supposed to work, but

00:22:51.670-->00:23:02.848
we will show now how we
basically can trick that into a
fraud attack. So what is a PCC?

00:23:02.848-->00:23:07.186
It’s a policy and charging
control. It’s- everybody in this
room has a PCC. Um it defines

00:23:07.186-->00:23:13.459
everything about your
subscription; the data types,
thecdata rate, what kind of

00:23:13.459-->00:23:19.164
cellular services you use or
not. For example for kids they
might have a subscription

00:23:19.164-->00:23:23.769
without data or things like
that. That’s all in this PCC,
nicely defined. And for example

00:23:23.769-->00:23:29.942
I work for a company, so I am a
quite generous subscription, I
work for comp- phone comp-

00:23:29.942-->00:23:35.914
mobile phone company. Or not
mobile phone company but the
supplier of it. So well, they

00:23:35.914-->00:23:41.754
pay my bills. So no matter how
much data I use so basically I
have a flat rate. And this is

00:23:41.754-->00:23:47.860
very attractive for an attacker,
so because well, company
policies are complex things, so

00:23:47.860-->00:23:53.933
if they steal my subscription
basically uh it probably takes a
while to pop up in the system

00:23:53.933-->00:23:59.371
until somebody rings somebody
and saying “Here’s something
fishy.” If they notice at all.

00:23:59.371-->00:24:05.244
Um but before we go into the
attack I’ll explain something
about diameter routing. Uh

00:24:05.244-->00:24:13.519
because diameter routing there
are 2 ways to route. And
basically if an attacker sends

00:24:13.519-->00:24:21.093
something um and basically
pretends to be the home network,
and puts in the origin realm

00:24:21.093-->00:24:29.234
that I am a Finnish operator and
sends it to US. Then it goes by
these hops, and actually the

00:24:29.234-->00:24:35.207
answer there are 2 ways for the
answer to be routed. Either it’s
routed by origin realm and

00:24:35.207-->00:24:39.411
origin host which is sort of
slightly more complicated
because all the intermediate

00:24:39.411-->00:24:44.983
notes have to configure it. Or
what also sometimes happens is
that they route by Hop-by-hop

00:24:44.983-->00:24:50.122
ID. Which means that basically
the origin realm and so it’s
completely ignored meaning that

00:24:50.122-->00:24:57.663
somebody can very easily
impersonate the home network.
And no there is no TLS and no

00:24:57.663-->00:25:04.036
IPsec, just to avoid the
question. So it’s not there. So
it’s very easy if the routing is

00:25:04.036-->00:25:12.411
done hop-by-hop to spoof
messages. It’s, so. Um the
attack what we will do. We will

00:25:12.411-->00:25:19.718
steal a subscription from a
subscription, a good
subscription like my

00:25:19.718-->00:25:24.857
subscription. The PCC that’s the
string and once we know this
string this key string we will

00:25:24.857-->00:25:31.563
update another subscription with
this string. So basically that
means we upgrade the other

00:25:31.563-->00:25:37.703
subscription to a Nokia
subscription. So suddenly Nokia
has an employee more! I’m not

00:25:37.703-->00:25:43.375
sure they’re happy about that
but, so that’s how it goes. Um
remember IPX was designed

00:25:43.375-->00:25:52.151
without security and we have 2
possibilities. So once we pull
from the home network, so if

00:25:52.151-->00:25:59.324
there’s no proper configuration
there which is sometimes the
case, yes, uh you can pull from

00:25:59.324-->00:26:06.632
the whole network and send
messages to my home network, the
attacker. So and for that you

00:26:06.632-->00:26:12.037
need the IMSI. The IMSI I will
not go into detail as how to
catch the IMSI but you might

00:26:12.037-->00:26:18.177
have heard of Stingrays. I think
they are commonly used in US.
Then there’s the possibility to

00:26:18.177-->00:26:23.415
get them from a wireless phone
exit port that was shown in
BlackHat 2016. Or you can

00:26:23.415-->00:26:29.988
request them also from this
interconnection network in- with
an SMS trick, basically.

00:26:29.988-->00:26:34.560
Basically you claim you have an
SMS that you want to deliver and
then you get the IMSI. Um so

00:26:34.560-->00:26:40.332
there are some ways to get the
IMSI so we will not go into that
how we get- actually for the

00:26:40.332-->00:26:47.239
test we actually had uh 4th base
station in in Helsinki and uh
we’re testing it. It works

00:26:47.239-->00:26:53.378
nicely. Um before any questions
come, it’s legal. Nokia is even
an operator. So [chuckles] so

00:26:53.378-->00:27:02.621
just to avoid questions. We just
did it on site on our test site.
Um so what we will do we send a

00:27:02.621-->00:27:07.493
re-authentication request with
the IMSI and then we will
basically say “We want to have

00:27:07.493-->00:27:19.538
the PCC.” And here is how it
works. >>UE is attached. Then
the PCRF triggers the RAR that

00:27:19.538-->00:27:25.677
is re-authentication request
message. The H-PCRF replies with
the REE that is

00:27:25.677-->00:27:34.520
re-authentication consort. The
message can be captured and
viewed through WireShark. >>

00:27:34.520-->00:27:41.360
Okay. And that’s an uh. >>UE is
>> Okay, yeah. Here is the
WireShark part. >> In Wireshark

00:27:41.360-->00:27:50.335
we can see diameter packets the
RAR instance of quality of
service, and charging rules for

00:27:50.335-->00:28:02.114
the respective UE. >>Okay I see
that’s a bit small. Um actually
just above the blue line the the

00:28:02.114-->00:28:09.555
one that’s moving right now.
>>The highlighted are the PCC
rules for UE1. Which can be seen

00:28:09.555-->00:28:16.695
on the diameter captured packets
also. >>So what we basically
know then. We know the key

00:28:16.695-->00:28:20.899
string that’s behind basically
describing my subscription those
are the yellow marked strings.

00:28:20.899-->00:28:28.373
So these strings define actually
what services I’m allowed to be-
use or not to use. So these

00:28:28.373-->00:28:33.478
strings are the key strings and
we don’t actually know what’s
behind them but we don’t need to

00:28:33.478-->00:28:42.354
know. Because just know: ok
company employee, they pay. So-
and the next step is then to

00:28:42.354-->00:28:48.927
push these strings to another
subscription and basically
upgrade that subscription. And

00:28:48.927-->00:28:57.002
that’s how you up- upgrade it.
So what you do is over the S9
interface, you say “Call it your

00:28:57.002-->00:29:02.774
service rule install” and the
answer, you don’t even need this
diameter routing trick because

00:29:02.774-->00:29:07.279
you just want to push something
and want the receiving network
to install the stuff. And that’s

00:29:07.279-->00:29:11.783
what it’s do, it’s supposed to
do that. So as I explained this
message is usually for the case

00:29:11.783-->00:29:16.388
that my subscription is
cancelled or something or
something on my subscription

00:29:16.388-->00:29:20.759
changes. And the home network
wants to inform the other
network that uh this service has

00:29:20.759-->00:29:29.368
been now changed. So it’s- it’s
supposed to do that. So. And
there’s another 1 where you can

00:29:29.368-->00:29:38.176
go if you are abroad so that in
the network when you go abroad
there’s a mess, you call it your

00:29:38.176-->00:29:43.315
service or your services are
changed. That’s the other trick.
So there are 2 scenarios

00:29:43.315-->00:29:46.418
basically for the attack. 1
where in the home network the
stuff is changed, and 1 where in

00:29:46.418-->00:29:54.593
the visitor network is stuff is
changed. And that’s how it looks
like. >>After changing the PCC

00:29:54.593-->00:30:05.103
rules for the UE 1 when the PCRF
figures the RAR message again.
Now we can see the change to PCC

00:30:05.103-->00:30:14.246
rules through the capture with
WireShark. >>Oh kay. And here’s
the WireShark where you

00:30:14.246-->00:30:19.818
basically can, uh I’m not sure
you can see it. Well, let’s see.
>>Here we have captured the

00:30:19.818-->00:30:44.643
latest REE message packet and we
can see the change to PCC rules.
Here we have captured the latest

00:30:44.643-->00:30:52.384
REE message. >>Okay sorry that
was a duplication slide. So
basically that’s an an um uh a

00:30:52.384-->00:30:57.856
screenshot of the of the change.
In the- in the top you see that
the numbers are differently and

00:30:57.856-->00:31:02.327
in the bottom we set- set them
all the same. So actually that’s
going to be more of a denial of

00:31:02.327-->00:31:06.698
service type of attack. So but
we can switch it 1 way or the
other way it doesn't matter

00:31:06.698-->00:31:12.337
basically we just need to know
what the strings are looking
like and we can sort of put them

00:31:12.337-->00:31:16.041
to any subscription as we like.
So we can do a denial of service
or we can upgrade a

00:31:16.041-->00:31:23.582
subscription. Whatever we want
to do. So. So what does it mean?
Uh the attacker he can offer

00:31:23.582-->00:31:28.487
better services so in a sense
that he upgrades basically
somebody else’s subscription and

00:31:28.487-->00:31:34.025
shifting the cost to somebody
else and letting somebody else
potentially pay for the phone

00:31:34.025-->00:31:42.734
bill. There’s also this
reselling opportunity as I said
if somebody goes abroad and you

00:31:42.734-->00:31:47.372
get uh basically free data for
somebody going abroad. Um in
Europe this is not so

00:31:47.372-->00:31:52.544
interesting but in let’s say
between US and Canada I heard or
let’s say to the Caribbean where

00:31:52.544-->00:31:57.649
the costs are sometimes very
higher for roamers. That’s might
be interesting. Or if you go on

00:31:57.649-->00:32:04.890
a cruise. They are famous for
robbing people. Um so for users
that might be that you’re billed

00:32:04.890-->00:32:13.231
for something that you actually
didn’t do. So and particularly
for company subscriptions this

00:32:13.231-->00:32:16.701
is very critical because they
have often large amounts of
people and they might not be

00:32:16.701-->00:32:22.941
able to keep track of everybody.
So that’s that’s an issue ‘til
this is found. For the operator

00:32:22.941-->00:32:28.847
that means there could be bill
disputes, uh loss of corporate
customers, and also remember

00:32:28.847-->00:32:34.686
this way the messages were
routed through UK and Germany
and so on. Each of those guys in

00:32:34.686-->00:32:40.158
between get a bit of the cake.
So each 1 of them gets a bit of
money for for messages and so on

00:32:40.158-->00:32:50.068
and for data traffic also. So if
there’s a fraudulent data
traffic user, pff those guys in

00:32:50.068-->00:32:54.973
the middle they still want to
get their money, believe me. So
it’s really bad in the sense

00:32:54.973-->00:33:01.179
that you might lose really money
on it. Um countermeasures. I
said in the beginning, uh I

00:33:01.179-->00:33:09.721
don’t have the luxury of saying
“Hey, so.” I cannot say, mm mm I
cannot- I cannot say “switch if

00:33:09.721-->00:33:16.628
off” or “build the network from
scratch.” That doesn't work. So
this is an huge network it’s

00:33:16.628-->00:33:23.902
cost h**l of a lot of money and
also I will just have to
acknowledge the realities. This

00:33:23.902-->00:33:34.212
is Tuvalu operator with 47
employees. I cannot expect those
guys to or 1300 um employees- or

00:33:34.212-->00:33:38.984
subscribers, I cannot expect
those guys to pay a lot of money
for a very specific security

00:33:38.984-->00:33:46.424
feature. And also there’s no
central authority which could
regulate the everything. US is

00:33:46.424-->00:33:52.898
regulating somewhat in form of
recommendations; um but in the
morning for example in the DHS

00:33:52.898-->00:33:59.537
talk we heard already basically
a plea for help. Where cause
they don’t, well these are

00:33:59.537-->00:34:05.911
privately owned companies and
for them it’s a risk question.
Between risk how much is

00:34:05.911-->00:34:10.916
something worth and how much
they have to spend, on the
money. So but on the other hand

00:34:10.916-->00:34:16.254
there are some countermeasures
which sort of kill a lot. Might
not be 100 percent foolproof but

00:34:16.254-->00:34:23.695
already help a lot. So actually
the operators themselves in the
DSMA that’s the operator

00:34:23.695-->00:34:30.335
association, they have thought
about these things at least to
some degree. So in particular to

00:34:30.335-->00:34:38.209
this attack um S9 interface well
you can use IP sector, I mean it
runs on top of IP. So you can

00:34:38.209-->00:34:45.884
use it with trusted partners
directly and not with all these
hop-by-hop thingies. That’s at

00:34:45.884-->00:34:49.187
least very useful for partners
which have a lot of interaction,
I suppose that there’s a lot of

00:34:49.187-->00:34:54.092
interaction between US and
Canada for example or US and
Mexico. For those communications

00:34:54.092-->00:34:59.297
it’s quite worth while to set up
this IP Intersec tunnel. I’m not
sure it’s worth while setting up

00:34:59.297-->00:35:04.202
an IPsec tunnel to TuVaLu.
That’s probably not worth the
effort. So for those kinds you

00:35:04.202-->00:35:12.477
might just say “Okay I take the
risk. ”Um then S9 interface it
should only be opened if it’s

00:35:12.477-->00:35:19.618
really needed. Might be obvious
to IT people but for uh for
telecorps that’s not so- IT

00:35:19.618-->00:35:25.390
we’re still sort of learning a
lot. Let’s put it that way. Um
then on the routing part so to

00:35:25.390-->00:35:30.462
make the attacker’s life hard
the routing should be by origin
realm and origin host, not by

00:35:30.462-->00:35:36.801
hop-by-hop ID. Then there are
things that are more TelCo
specific. Um IMSI range remember

00:35:36.801-->00:35:46.711
IMSI is the um user identity in
the mobile network. It’s not
your phone number it’s IMSI. And

00:35:46.711-->00:35:52.083
each operator has assigned a
range which he is supposed to
use. So you can basically check

00:35:52.083-->00:35:58.156
if this is really from that
operator or not. This avoids for
example these kind of

00:35:58.156-->00:36:05.430
governmental attacks, makes it
harder. Um 1 important thing is
also to check that you don’t get

00:36:05.430-->00:36:13.038
messages which co- seem to come
from your own notes. Um other 1
logical separation in the notes

00:36:13.038-->00:36:21.046
of your visitors, incoming
roamers, and your home
subscribers. So to have them

00:36:21.046-->00:36:27.018
separated and not just if a
request comes in and you just
execute it with no feeling if it

00:36:27.018-->00:36:33.358
makes sense or not. And then
there’s the location distance
check where you can basically

00:36:33.358-->00:36:40.365
check if somebody can physically
be here. So if I’ve been, 2
minutes ago I had last location

00:36:40.365-->00:36:50.475
update in in Finland I cannot
have 5 minutes later uh charging
message here in US. That just

00:36:50.475-->00:36:56.281
not feasible. So and then there
are sort of more advanced stuff,
like fingerprinting partners so

00:36:56.281-->00:37:02.220
you can take the traffic throw
it into very nice machine
learning, so magic magic, and

00:37:02.220-->00:37:08.893
sort of because each- each
partner has a specific way to
send messages, to configure

00:37:08.893-->00:37:12.997
them, which feature thier
support and so on. And by that
you can kind of fingerprint the

00:37:12.997-->00:37:20.371
traffic. And these flows you can
easily then sort of identify and
see if there are something

00:37:20.371-->00:37:28.012
strange in there. And that
moment you can sort of raise
some flags. So this is not

00:37:28.012-->00:37:33.017
rocket science, eh but it helps
a lot and it can be put on a
running network if our sort of

00:37:33.017-->00:37:38.022
too big costs. For normal users:
check your bill and keep an eye
on the news. That’s my best

00:37:38.022-->00:37:48.299
suggestion. Um for corporate
users um in general I think
security should be something

00:37:48.299-->00:37:54.739
like bandwidth or coverage.
Because it’s a quality thingy.
Security doesn't come for free.

00:37:54.739-->00:38:01.212
I’m paid, most of you are
somehow paid so we don’t work
for free. We are experts in our

00:38:01.212-->00:38:07.819
fields and it’s the same with
bandwidth. People which blow up
the bandwidth and invented 5G

00:38:07.819-->00:38:13.191
the radio path. They get also
paid so I think it’s a quality
indicator and it should be part

00:38:13.191-->00:38:19.063
of business contracts. Because
if something goes wrong, it
usually costs money. So this is

00:38:19.063-->00:38:27.438
something very important to
understand and also sort of when
things go wrong so that there’s

00:38:27.438-->00:38:34.345
also some punishments for not
investing properly in the
security. Um and the rest are

00:38:34.345-->00:38:40.385
recommendations more details if
operators interested in it. And
that’s basically the end of my

00:38:40.385-->00:38:48.293
talk. So this has been partially
funded by the EU, they do this
kind of research and that’s it.

00:38:48.293-->00:39:10.682
Thanks a lot. [applause] >>So I-
I can take some questions. This
gentlemen there. >>[questions

00:39:10.682-->00:39:28.600
being asked off mic] >>Okay that
is so not gonna work. Come. >>Um
hi I was wondering about the

00:39:28.600-->00:39:32.904
billing. So you’d mentioned that
this uh this could potentially
billed- be billed to the company

00:39:32.904-->00:39:36.674
or to a user, different
subscriber. But it looked like
the only thing that was being

00:39:36.674-->00:39:41.879
changed was the uh level of
service given to a different
user right? >>Yeah >>Uh so how

00:39:41.879-->00:39:49.520
does it affect the billing of
someone else? >>Um so the
question was about sort of how

00:39:49.520-->00:39:53.725
it affects the um bill of
somebody else. If you have the
case you have group

00:39:53.725-->00:39:58.563
subscriptions like co-
corporates have then umm it
affects somebody else bill. But

00:39:58.563-->00:40:03.434
it can also sort of- I could
upgrade your or downgrade your
subscription basically to a

00:40:03.434-->00:40:09.440
denial of service attack. So
that’s the other way around. But
for somebody else bill that

00:40:09.440-->00:40:14.078
would be the corporate case, and
the individual case would be
denial of service, basically. So

00:40:14.078-->00:40:29.661
I could basically k- downgrade
you to 2G forever [laughs.] Oh
yeah. Yep. >>Uh I was just

00:40:29.661-->00:40:35.333
curious um how preci- >>Uh okay
hold on. Excuse me. You have
another question. >>Yeah yea

00:40:35.333-->00:40:40.672
okay. >>I was curious um how
persistent is that change? Like
when will that get reset? >>Um

00:40:40.672-->00:40:50.848
the question was how persistent
is that change? Umm let me
think. For the visited case it

00:40:50.848-->00:40:57.455
would be persistent for the time
that you are abroad, and,
>>[speaking off mic] >>Hmm?

00:40:57.455-->00:41:10.935
>>[question off mic] >>Yeah the
time the handset is on
registered on the network, in

00:41:10.935-->00:41:15.173
the foreign network. For the
home network, that’s a good
question. It- >>[speaking off

00:41:15.173-->00:41:20.478
mic] >>Yeah yeah yeah it would
be needed so to distribute
through the network to be

00:41:20.478-->00:41:30.188
persistent. Yes. It is a lot,
quite a pain. [laughs]Yeah and
this gentlemen down- >>We have

00:41:30.188-->00:41:34.392
time for 1 more >>Yeah >>What’s
the fastest mobile network speed
you’ve seen on a phone or just

00:41:34.392-->00:41:39.831
in general. >>I don’t measure
the network speed, honestly, so
I’m looking more at the security

00:41:39.831-->00:00:00.000
at the back-end so. Thanks a
lot.

