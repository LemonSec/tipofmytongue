1
00:00:00,480 --> 00:00:04,480
hello everyone and welcome to my

2
00:00:02,399 --> 00:00:06,480
presentation my name is samuel kimmins

3
00:00:04,480 --> 00:00:08,639
and my talk is titled look at me i'm the

4
00:00:06,480 --> 00:00:10,880
adversary now an introduction to

5
00:00:08,639 --> 00:00:12,960
adversary emulation and its place in

6
00:00:10,880 --> 00:00:14,639
security operations

7
00:00:12,960 --> 00:00:16,640
before i jump into the overview i just

8
00:00:14,639 --> 00:00:19,439
wanted to give a big shout out to the

9
00:00:16,640 --> 00:00:20,720
adversary village i'm very excited to

10
00:00:19,439 --> 00:00:23,119
speak to you all and all of you

11
00:00:20,720 --> 00:00:24,480
attending today all right so a quick

12
00:00:23,119 --> 00:00:26,320
overview of what i'm going to cover in

13
00:00:24,480 --> 00:00:28,240
my presentation i'll go through the

14
00:00:26,320 --> 00:00:30,560
typical introduction of the who am i

15
00:00:28,240 --> 00:00:33,200
slide i'll jump into

16
00:00:30,560 --> 00:00:35,120
an introduction to adversary emulation

17
00:00:33,200 --> 00:00:37,360
and the types of emulation and yes i

18
00:00:35,120 --> 00:00:39,280
believe there are more than one types of

19
00:00:37,360 --> 00:00:40,719
one type of emulation

20
00:00:39,280 --> 00:00:42,719
and then i'll jump into

21
00:00:40,719 --> 00:00:45,680
where adversary emulation fits into

22
00:00:42,719 --> 00:00:47,920
security operations and we'll talk about

23
00:00:45,680 --> 00:00:49,200
threat intelligence place in adversary

24
00:00:47,920 --> 00:00:51,680
emulation

25
00:00:49,200 --> 00:00:53,920
we'll talk about emulation for detection

26
00:00:51,680 --> 00:00:56,480
testing and purple teaming

27
00:00:53,920 --> 00:00:58,399
and then emulation as a training tool

28
00:00:56,480 --> 00:01:00,879
and of course i'll finish finish this up

29
00:00:58,399 --> 00:01:02,800
by giving you some resources so that you

30
00:01:00,879 --> 00:01:03,760
can get started with adversary emulation

31
00:01:02,800 --> 00:01:06,320
today

32
00:01:03,760 --> 00:01:08,400
and then we'll cover the conclusion

33
00:01:06,320 --> 00:01:09,840
all right so who am i my name is samuel

34
00:01:08,400 --> 00:01:11,680
kimmins as i mentioned earlier i'm

35
00:01:09,840 --> 00:01:14,000
currently a red teamer at an

36
00:01:11,680 --> 00:01:16,400
organization called cognizant i was

37
00:01:14,000 --> 00:01:18,479
formerly formerly at a company called

38
00:01:16,400 --> 00:01:21,920
recon infosec where i focused 100

39
00:01:18,479 --> 00:01:25,040
percent on adversariation so replicating

40
00:01:21,920 --> 00:01:27,040
ttps malware and c2

41
00:01:25,040 --> 00:01:29,840
i like to consider myself a purple

42
00:01:27,040 --> 00:01:32,000
teamer and absolute emulator at hearts

43
00:01:29,840 --> 00:01:34,159
and before we con infosec i was in the

44
00:01:32,000 --> 00:01:36,640
united states air force started out as a

45
00:01:34,159 --> 00:01:38,479
sysadmin help desk type person moved up

46
00:01:36,640 --> 00:01:40,720
to stock analyst and then on to

47
00:01:38,479 --> 00:01:42,399
pintester and red teaming and advanced

48
00:01:40,720 --> 00:01:44,640
emulation and so where i kind of got

49
00:01:42,399 --> 00:01:46,880
tuned in on adversariation and where it

50
00:01:44,640 --> 00:01:49,759
could fit into security operations was

51
00:01:46,880 --> 00:01:52,320
my time in between sock analyst and red

52
00:01:49,759 --> 00:01:54,720
teaming i started to really kind of dig

53
00:01:52,320 --> 00:01:56,560
into the tcps of how they infected an

54
00:01:54,720 --> 00:01:58,560
environment and what kind of behaviors

55
00:01:56,560 --> 00:02:00,159
we could look for and from the offensive

56
00:01:58,560 --> 00:02:02,960
side of how can i replicate these

57
00:02:00,159 --> 00:02:04,640
behaviors to help my organization

58
00:02:02,960 --> 00:02:06,320
and so you can find me on twitter at

59
00:02:04,640 --> 00:02:09,039
valket underscore k

60
00:02:06,320 --> 00:02:11,520
or on github at falcon

61
00:02:09,039 --> 00:02:12,959
k and the quick disclaimer that everyone

62
00:02:11,520 --> 00:02:15,040
has to throw out uh thoughts and

63
00:02:12,959 --> 00:02:17,200
opinions expressed by me in this talk

64
00:02:15,040 --> 00:02:19,680
are my own and do not represent those of

65
00:02:17,200 --> 00:02:21,840
my employer

66
00:02:19,680 --> 00:02:24,160
okay so let's jump into adversary

67
00:02:21,840 --> 00:02:26,080
emulation and what it actually is so you

68
00:02:24,160 --> 00:02:29,360
might be thinking isn't that just red

69
00:02:26,080 --> 00:02:32,160
teaming well hint it isn't it may be

70
00:02:29,360 --> 00:02:34,080
performed by red teams or

71
00:02:32,160 --> 00:02:36,080
or pin testing teams depending on what

72
00:02:34,080 --> 00:02:38,239
your organization has but i feel like

73
00:02:36,080 --> 00:02:41,519
adversary emulation falls under that

74
00:02:38,239 --> 00:02:43,680
broader umbrella of offensive security

75
00:02:41,519 --> 00:02:45,680
meaning that it has its place but

76
00:02:43,680 --> 00:02:49,840
different teams may conduct those types

77
00:02:45,680 --> 00:02:51,760
of operations and to me the active

78
00:02:49,840 --> 00:02:54,080
is being as true as possible to the

79
00:02:51,760 --> 00:02:55,840
threat intelligence when conducting

80
00:02:54,080 --> 00:02:57,360
offensive operations because without

81
00:02:55,840 --> 00:02:59,680
threat intelligence you don't really

82
00:02:57,360 --> 00:03:01,440
have adversary emulation because at that

83
00:02:59,680 --> 00:03:04,159
point you're doing kind of thrabulation

84
00:03:01,440 --> 00:03:05,200
or your standard adversary simulation

85
00:03:04,159 --> 00:03:07,840
and you're going to hear me throughout

86
00:03:05,200 --> 00:03:09,200
this talk constantly repeat threat until

87
00:03:07,840 --> 00:03:12,879
threat until threat until because it's

88
00:03:09,200 --> 00:03:15,280
very important to this topic

89
00:03:12,879 --> 00:03:17,760
so the two primary types of emulation

90
00:03:15,280 --> 00:03:19,440
that i consider to be important so of

91
00:03:17,760 --> 00:03:22,400
course we have adversary emulation where

92
00:03:19,440 --> 00:03:25,360
we're replicating unknown threat actors

93
00:03:22,400 --> 00:03:27,680
ttps or behaviors and of course this is

94
00:03:25,360 --> 00:03:29,680
based on threat intelligence

95
00:03:27,680 --> 00:03:31,840
and an interesting thing i like to bring

96
00:03:29,680 --> 00:03:34,959
up is something i saw on a blog post

97
00:03:31,840 --> 00:03:37,120
from the former red team lead at walmart

98
00:03:34,959 --> 00:03:38,480
was that we're essentially just copy

99
00:03:37,120 --> 00:03:41,040
cats you know because

100
00:03:38,480 --> 00:03:42,720
we can only emulate a threat actor to a

101
00:03:41,040 --> 00:03:44,640
certain degree

102
00:03:42,720 --> 00:03:46,000
and that's typically because we only

103
00:03:44,640 --> 00:03:47,760
have a certain amount of threat

104
00:03:46,000 --> 00:03:49,040
intelligence on a threat actors

105
00:03:47,760 --> 00:03:49,840
behaviors

106
00:03:49,040 --> 00:03:51,920
and

107
00:03:49,840 --> 00:03:52,879
this isn't uncommon right unless you

108
00:03:51,920 --> 00:03:55,200
have

109
00:03:52,879 --> 00:03:57,280
uh you know a view into an adversary's

110
00:03:55,200 --> 00:03:58,319
entire kill train kill chain you're

111
00:03:57,280 --> 00:04:00,480
probably not going to be able to

112
00:03:58,319 --> 00:04:03,280
replicate it to 100

113
00:04:00,480 --> 00:04:04,879
and to be honest that's okay because as

114
00:04:03,280 --> 00:04:07,200
long as you're getting a benefit out of

115
00:04:04,879 --> 00:04:08,640
the tcps or the behaviors that you're

116
00:04:07,200 --> 00:04:11,599
able to replicate

117
00:04:08,640 --> 00:04:13,680
in your specified scenario

118
00:04:11,599 --> 00:04:15,120
and so the other one threat emulation

119
00:04:13,680 --> 00:04:17,440
this one is kind of one of my favorites

120
00:04:15,120 --> 00:04:19,120
too because you're not really focused on

121
00:04:17,440 --> 00:04:22,479
a particular threat actor you're more

122
00:04:19,120 --> 00:04:24,320
focused on emulating ttp so let's say we

123
00:04:22,479 --> 00:04:26,720
go to miter attack matrix and we select

124
00:04:24,320 --> 00:04:28,880
one we want to select w make for lateral

125
00:04:26,720 --> 00:04:30,960
movement and we want to replicate that

126
00:04:28,880 --> 00:04:32,800
ttp in our environment to you know

127
00:04:30,960 --> 00:04:34,880
determine if our detections are capable

128
00:04:32,800 --> 00:04:36,479
of detecting that or preventing that

129
00:04:34,880 --> 00:04:38,960
type of activity

130
00:04:36,479 --> 00:04:40,880
and so it's cool because it's not tied

131
00:04:38,960 --> 00:04:43,040
to a specific director several threat

132
00:04:40,880 --> 00:04:44,800
actors may use this technique and in

133
00:04:43,040 --> 00:04:46,880
that case you know a cluster of threat

134
00:04:44,800 --> 00:04:48,080
actors may use it but they're not really

135
00:04:46,880 --> 00:04:49,919
important to us

136
00:04:48,080 --> 00:04:51,520
when we talk about advertising and

137
00:04:49,919 --> 00:04:52,880
threat intelligence we're usually doing

138
00:04:51,520 --> 00:04:54,840
that because

139
00:04:52,880 --> 00:04:57,360
this threat actor has been known to

140
00:04:54,840 --> 00:04:59,680
target our organization so we want to be

141
00:04:57,360 --> 00:05:02,240
able to replicate what they can do in

142
00:04:59,680 --> 00:05:04,479
our own environment

143
00:05:02,240 --> 00:05:05,840
so where does it fit into security

144
00:05:04,479 --> 00:05:08,960
operations

145
00:05:05,840 --> 00:05:10,720
so in my mind you know it fits into the

146
00:05:08,960 --> 00:05:12,560
processes and people side of security

147
00:05:10,720 --> 00:05:14,479
ops and typically you would see

148
00:05:12,560 --> 00:05:16,479
sec ops broken down into three pieces

149
00:05:14,479 --> 00:05:18,479
right so processes people and technology

150
00:05:16,479 --> 00:05:20,960
but like i mentioned i'm going to focus

151
00:05:18,479 --> 00:05:23,199
on the processes and the people side

152
00:05:20,960 --> 00:05:26,400
because honestly the technology changes

153
00:05:23,199 --> 00:05:28,320
but the people and the processes not

154
00:05:26,400 --> 00:05:30,560
necessarily remain the same but those

155
00:05:28,320 --> 00:05:32,960
grow and continue to change with time as

156
00:05:30,560 --> 00:05:34,880
well but it should be the methodologies

157
00:05:32,960 --> 00:05:37,199
that are solid from one tool to the

158
00:05:34,880 --> 00:05:39,520
other so from a defensive perspective

159
00:05:37,199 --> 00:05:41,680
regardless of what type of log analysis

160
00:05:39,520 --> 00:05:43,440
tool you're using like a splunk or a

161
00:05:41,680 --> 00:05:45,120
different different scene you should be

162
00:05:43,440 --> 00:05:47,919
able to still look for the same types of

163
00:05:45,120 --> 00:05:49,440
behavior just using different syntax so

164
00:05:47,919 --> 00:05:50,840
the methodologies are there it's just

165
00:05:49,440 --> 00:05:52,639
the tools

166
00:05:50,840 --> 00:05:55,759
change

167
00:05:52,639 --> 00:05:57,199
so on the processes side of security so

168
00:05:55,759 --> 00:05:59,919
processes need

169
00:05:57,199 --> 00:06:01,199
development testing and refining

170
00:05:59,919 --> 00:06:03,120
and you may be thinking where does

171
00:06:01,199 --> 00:06:05,840
adversary emulation fit into this

172
00:06:03,120 --> 00:06:08,319
portion of psychops in my mind it fits

173
00:06:05,840 --> 00:06:10,000
into purple teaming perfectly because

174
00:06:08,319 --> 00:06:11,360
you're able to test those response

175
00:06:10,000 --> 00:06:14,319
procedures

176
00:06:11,360 --> 00:06:17,440
and also train your folks

177
00:06:14,319 --> 00:06:20,000
against specific ttps specific

178
00:06:17,440 --> 00:06:22,639
adversarial ttps and this is great

179
00:06:20,000 --> 00:06:24,479
especially anyone from ranging from tier

180
00:06:22,639 --> 00:06:27,280
one soccer stock analyst all the way up

181
00:06:24,479 --> 00:06:29,360
to your tier three sock engineer or

182
00:06:27,280 --> 00:06:31,759
threat hunter everyone needs that

183
00:06:29,360 --> 00:06:34,720
exposure to these types of ttps and we

184
00:06:31,759 --> 00:06:37,280
can do that through purple teaming

185
00:06:34,720 --> 00:06:38,639
and so i kind of bled into the people's

186
00:06:37,280 --> 00:06:40,319
side of security apps when i was talking

187
00:06:38,639 --> 00:06:41,840
about processes because you know you

188
00:06:40,319 --> 00:06:42,720
don't have the processes without the

189
00:06:41,840 --> 00:06:45,120
people

190
00:06:42,720 --> 00:06:46,479
and so people need ways to improve and

191
00:06:45,120 --> 00:06:47,919
test their skills

192
00:06:46,479 --> 00:06:50,639
and i believe that training through

193
00:06:47,919 --> 00:06:52,880
adversary emulation exercises is one of

194
00:06:50,639 --> 00:06:54,160
the best ways to do this now you may be

195
00:06:52,880 --> 00:06:57,759
thinking what about you know your

196
00:06:54,160 --> 00:06:59,840
traditional red versus blue exercises um

197
00:06:57,759 --> 00:07:02,000
typically those are objective focused

198
00:06:59,840 --> 00:07:03,759
right like the red team has an objective

199
00:07:02,000 --> 00:07:05,680
that they're trying to accomplish and it

200
00:07:03,759 --> 00:07:07,360
may not necessarily be to train the blue

201
00:07:05,680 --> 00:07:09,520
team sure overall it's to make the

202
00:07:07,360 --> 00:07:12,000
security posture of the organization

203
00:07:09,520 --> 00:07:14,319
better but that may not be their primary

204
00:07:12,000 --> 00:07:16,080
objectives and and so when you throw in

205
00:07:14,319 --> 00:07:17,919
the adversary emulation exercise they

206
00:07:16,080 --> 00:07:20,800
become even more natural sparring

207
00:07:17,919 --> 00:07:23,759
partners where they're working in tandem

208
00:07:20,800 --> 00:07:26,319
to improve each other's skill set while

209
00:07:23,759 --> 00:07:29,199
improving the overall security posture

210
00:07:26,319 --> 00:07:29,199
of the organization

211
00:07:29,360 --> 00:07:34,639
so which type of emulation is the right

212
00:07:31,840 --> 00:07:36,720
one uh to me you follow this simple

213
00:07:34,639 --> 00:07:38,160
formula for success

214
00:07:36,720 --> 00:07:40,240
first we'll need to determine if this

215
00:07:38,160 --> 00:07:42,400
will be the for the processes or the

216
00:07:40,240 --> 00:07:44,960
people side of security ops and ask

217
00:07:42,400 --> 00:07:47,440
yourself the following three questions

218
00:07:44,960 --> 00:07:49,599
number one are you trying to detect or

219
00:07:47,440 --> 00:07:52,000
defend against a specific threat actors

220
00:07:49,599 --> 00:07:54,160
ttps or behaviors

221
00:07:52,000 --> 00:07:55,759
and now in my mind this is leaning more

222
00:07:54,160 --> 00:07:58,160
towards adversary emulation because

223
00:07:55,759 --> 00:08:00,879
we're focused on a specific threat actor

224
00:07:58,160 --> 00:08:02,240
their ttps and their behaviors

225
00:08:00,879 --> 00:08:04,319
on to number two

226
00:08:02,240 --> 00:08:07,520
are you simply wanting to improve your

227
00:08:04,319 --> 00:08:09,360
detections against general ttps

228
00:08:07,520 --> 00:08:11,759
now we're more leaning more towards that

229
00:08:09,360 --> 00:08:12,639
threat emulation adversarial simulation

230
00:08:11,759 --> 00:08:14,479
side of

231
00:08:12,639 --> 00:08:16,879
side of offensive security where we're

232
00:08:14,479 --> 00:08:19,440
focused on improving the detections of

233
00:08:16,879 --> 00:08:20,960
our detection and response team

234
00:08:19,440 --> 00:08:22,639
as opposed to

235
00:08:20,960 --> 00:08:25,280
trying to stop or

236
00:08:22,639 --> 00:08:26,879
detect a specific threat actor and these

237
00:08:25,280 --> 00:08:29,199
kind of go back and forth right so we

238
00:08:26,879 --> 00:08:31,199
can apply uh adversarial relation to

239
00:08:29,199 --> 00:08:33,599
this one as to this one as well but

240
00:08:31,199 --> 00:08:34,399
we're more focused on the tcp rather

241
00:08:33,599 --> 00:08:37,120
than

242
00:08:34,399 --> 00:08:39,039
who the threat intel says it's tied to

243
00:08:37,120 --> 00:08:41,440
and number three are you wanting to

244
00:08:39,039 --> 00:08:43,919
train your defenders if so you can apply

245
00:08:41,440 --> 00:08:45,120
a variation of the previous questions to

246
00:08:43,919 --> 00:08:47,360
the scenario

247
00:08:45,120 --> 00:08:49,600
so for example we could say that we want

248
00:08:47,360 --> 00:08:51,839
to emulate a specific threat actor

249
00:08:49,600 --> 00:08:53,760
because we want our defenders to

250
00:08:51,839 --> 00:08:55,120
have exposure to that threat actor

251
00:08:53,760 --> 00:08:57,440
because they're known to target for

252
00:08:55,120 --> 00:08:59,279
example our organization a finance

253
00:08:57,440 --> 00:09:01,839
organization

254
00:08:59,279 --> 00:09:03,600
but we're also testing our detections

255
00:09:01,839 --> 00:09:05,040
against ttps

256
00:09:03,600 --> 00:09:06,959
sure they may not be specific to that

257
00:09:05,040 --> 00:09:09,839
threat actor that we're trying to detect

258
00:09:06,959 --> 00:09:11,760
but by combining these two we can

259
00:09:09,839 --> 00:09:13,120
actually have a pretty great exercise

260
00:09:11,760 --> 00:09:14,800
where we're benefiting both the

261
00:09:13,120 --> 00:09:17,120
processes and the people because we're

262
00:09:14,800 --> 00:09:18,560
testing those response procedures and

263
00:09:17,120 --> 00:09:20,320
we're improving the skills of our

264
00:09:18,560 --> 00:09:21,680
defenders

265
00:09:20,320 --> 00:09:23,839
you may be wondering i keep mentioning

266
00:09:21,680 --> 00:09:26,320
threat intelligence for adversariation

267
00:09:23,839 --> 00:09:28,240
what does it fit into these questions

268
00:09:26,320 --> 00:09:29,839
well when we look at number one without

269
00:09:28,240 --> 00:09:31,519
threat intelligence we don't have

270
00:09:29,839 --> 00:09:33,680
adversary emulation

271
00:09:31,519 --> 00:09:34,959
and even on number two sure we're

272
00:09:33,680 --> 00:09:37,920
talking about

273
00:09:34,959 --> 00:09:39,600
just detecting general ttps but if we

274
00:09:37,920 --> 00:09:42,800
look at something like red canary's

275
00:09:39,600 --> 00:09:44,480
report on the top ttps we can see that

276
00:09:42,800 --> 00:09:46,720
several threat actors

277
00:09:44,480 --> 00:09:48,640
are using these ctps and that's based on

278
00:09:46,720 --> 00:09:50,160
threat intelligence collected

279
00:09:48,640 --> 00:09:53,680
found in the field or in their

280
00:09:50,160 --> 00:09:53,680
organizations they're defending

281
00:09:54,160 --> 00:09:56,800
but where does it fit into adversary

282
00:09:55,600 --> 00:09:58,480
emulation

283
00:09:56,800 --> 00:10:00,720
i mentioned this several times you can't

284
00:09:58,480 --> 00:10:03,360
accurately replicate a threat actor

285
00:10:00,720 --> 00:10:05,760
without threatened intelligence

286
00:10:03,360 --> 00:10:08,480
intelligence allows us to get as true as

287
00:10:05,760 --> 00:10:10,399
possible to an adversary's actions and

288
00:10:08,480 --> 00:10:12,399
remember i said early on in the first

289
00:10:10,399 --> 00:10:15,200
two or three slides that you may not be

290
00:10:12,399 --> 00:10:16,640
able to get one to the 100 mark right

291
00:10:15,200 --> 00:10:20,720
and that's okay

292
00:10:16,640 --> 00:10:21,920
because if we're aiming at replicating a

293
00:10:20,720 --> 00:10:24,720
thread actors

294
00:10:21,920 --> 00:10:27,120
c2 we might be able to do that with open

295
00:10:24,720 --> 00:10:29,279
source tools or custom develop custom

296
00:10:27,120 --> 00:10:31,440
develop tools but if we're talking about

297
00:10:29,279 --> 00:10:33,760
endpoint analytics we can probably

298
00:10:31,440 --> 00:10:36,560
replicate those to generate those types

299
00:10:33,760 --> 00:10:38,160
of logs or events we may not be able to

300
00:10:36,560 --> 00:10:40,240
replicate the exact

301
00:10:38,160 --> 00:10:42,640
uh programming language that a threat

302
00:10:40,240 --> 00:10:45,600
actor uses if we don't have that threat

303
00:10:42,640 --> 00:10:47,519
intelligence and that's okay too

304
00:10:45,600 --> 00:10:50,240
but emulating an adversary who is known

305
00:10:47,519 --> 00:10:53,519
to target your organization is much more

306
00:10:50,240 --> 00:10:55,200
valuable than standard threat emulation

307
00:10:53,519 --> 00:10:57,360
and esco that goes for adversary

308
00:10:55,200 --> 00:10:58,480
simulation as well that your typical red

309
00:10:57,360 --> 00:11:00,480
team would do

310
00:10:58,480 --> 00:11:02,240
and that's okay because they're focusing

311
00:11:00,480 --> 00:11:03,839
on specific objectives they may not be

312
00:11:02,240 --> 00:11:05,040
tying in threat intelligence to their

313
00:11:03,839 --> 00:11:06,480
operations

314
00:11:05,040 --> 00:11:09,600
but they may happen to cover some of

315
00:11:06,480 --> 00:11:11,760
those ttps a threat actor might use

316
00:11:09,600 --> 00:11:13,519
but if it's not tied to one that might

317
00:11:11,760 --> 00:11:15,200
target your organization

318
00:11:13,519 --> 00:11:16,720
that could throw off the importance of

319
00:11:15,200 --> 00:11:18,720
the findings

320
00:11:16,720 --> 00:11:21,279
so let's talk about emulation for

321
00:11:18,720 --> 00:11:23,440
detection testing and purple teaming but

322
00:11:21,279 --> 00:11:25,120
first i'm going to cover kind of my view

323
00:11:23,440 --> 00:11:27,040
on the purple team methodology i'm sure

324
00:11:25,120 --> 00:11:29,200
it's a pretty common one out there so

325
00:11:27,040 --> 00:11:31,680
first we'll start out by selecting a ttp

326
00:11:29,200 --> 00:11:34,160
or an adversary ttp see we can apply

327
00:11:31,680 --> 00:11:36,320
both threat emulation and adversary

328
00:11:34,160 --> 00:11:37,839
emulation to this uh purple team

329
00:11:36,320 --> 00:11:39,760
engagement

330
00:11:37,839 --> 00:11:41,440
formulate a plan of action that means

331
00:11:39,760 --> 00:11:42,720
all parties involved will formulate a

332
00:11:41,440 --> 00:11:44,880
plan of action

333
00:11:42,720 --> 00:11:47,200
they will execute their plan of action

334
00:11:44,880 --> 00:11:48,959
they will validate their findings and

335
00:11:47,200 --> 00:11:50,320
they'll move on to the final step but

336
00:11:48,959 --> 00:11:52,480
it's not a final step because it's a

337
00:11:50,320 --> 00:11:54,399
continuous process so if there's no

338
00:11:52,480 --> 00:11:56,959
detection they will either tune or

339
00:11:54,399 --> 00:12:00,000
create and start again

340
00:11:56,959 --> 00:12:02,160
so let's take a look at a more detailed

341
00:12:00,000 --> 00:12:04,240
version of that purple team methodology

342
00:12:02,160 --> 00:12:05,920
so we'll start out with the ttp

343
00:12:04,240 --> 00:12:09,519
we're going to select lateral movement

344
00:12:05,920 --> 00:12:11,040
via wmic because aptx uses this method

345
00:12:09,519 --> 00:12:12,800
and they just so happen to target our

346
00:12:11,040 --> 00:12:15,839
organization so we want to be able to

347
00:12:12,800 --> 00:12:17,200
detect and possibly prevent that type of

348
00:12:15,839 --> 00:12:19,279
activity

349
00:12:17,200 --> 00:12:21,920
during the development stage

350
00:12:19,279 --> 00:12:24,399
both the offensive and defensive team

351
00:12:21,920 --> 00:12:26,560
will develop their capabilities so the

352
00:12:24,399 --> 00:12:28,480
offensive team will develop the ctp

353
00:12:26,560 --> 00:12:31,040
based on threat intelligence the

354
00:12:28,480 --> 00:12:33,200
defensive team will develop a signature

355
00:12:31,040 --> 00:12:34,560
based on threat intelligence if one is

356
00:12:33,200 --> 00:12:36,720
available

357
00:12:34,560 --> 00:12:38,399
in the testing this is key because all

358
00:12:36,720 --> 00:12:39,519
teams need to execute their plan of

359
00:12:38,399 --> 00:12:41,279
actions because

360
00:12:39,519 --> 00:12:43,600
if the offensive team executes their

361
00:12:41,279 --> 00:12:45,519
plan of action and there's no response

362
00:12:43,600 --> 00:12:46,959
from the defensive team we may be in

363
00:12:45,519 --> 00:12:49,200
trouble so we may need to go back to the

364
00:12:46,959 --> 00:12:50,480
beginning of our wheel and re-develop

365
00:12:49,200 --> 00:12:52,399
our plan

366
00:12:50,480 --> 00:12:55,040
and so on the validation stage this is

367
00:12:52,399 --> 00:12:56,959
really important because we it's it goes

368
00:12:55,040 --> 00:12:58,480
several ways so the offensive team will

369
00:12:56,959 --> 00:13:00,079
either determine if they were

370
00:12:58,480 --> 00:13:01,680
successfully able to

371
00:13:00,079 --> 00:13:03,600
execute their task

372
00:13:01,680 --> 00:13:06,079
or was the blue team or the defensive

373
00:13:03,600 --> 00:13:07,760
team able to successfully detect it

374
00:13:06,079 --> 00:13:09,279
those are very important to keep in mind

375
00:13:07,760 --> 00:13:12,079
when doing type when doing purple

376
00:13:09,279 --> 00:13:14,160
teaming with adversary emulation

377
00:13:12,079 --> 00:13:16,160
and so if it was detected we could move

378
00:13:14,160 --> 00:13:17,920
on to the next ttp

379
00:13:16,160 --> 00:13:20,000
but if it wasn't detected we can start

380
00:13:17,920 --> 00:13:22,320
the cycle from the beginning where the

381
00:13:20,000 --> 00:13:23,519
detection team can develop or tune the

382
00:13:22,320 --> 00:13:25,279
signature

383
00:13:23,519 --> 00:13:27,279
and you're probably wondering this this

384
00:13:25,279 --> 00:13:28,880
seems like a lot of work and very

385
00:13:27,279 --> 00:13:30,800
resource and process of intense

386
00:13:28,880 --> 00:13:32,959
intensive and it can be depending on

387
00:13:30,800 --> 00:13:35,440
what you're trying to replicate from a

388
00:13:32,959 --> 00:13:37,760
specific adversary or specific tool set

389
00:13:35,440 --> 00:13:40,399
or a specific piece of malware

390
00:13:37,760 --> 00:13:42,560
and yes it can be automated it will take

391
00:13:40,399 --> 00:13:44,399
a little bit of development or

392
00:13:42,560 --> 00:13:46,320
purchasing a specific tool that allows

393
00:13:44,399 --> 00:13:48,480
you to automate it i won't name any

394
00:13:46,320 --> 00:13:50,720
because there are plenty out there but

395
00:13:48,480 --> 00:13:53,120
using the local resources you have

396
00:13:50,720 --> 00:13:55,120
even the offensive team could add this

397
00:13:53,120 --> 00:13:56,959
payload or add this technique to a

398
00:13:55,120 --> 00:13:58,720
script a powershell script if we're in a

399
00:13:56,959 --> 00:14:00,959
windows environment and then the

400
00:13:58,720 --> 00:14:03,680
defensive team can execute it whenever

401
00:14:00,959 --> 00:14:07,040
they'd like to improve that the

402
00:14:03,680 --> 00:14:09,440
detection technique or the ttp

403
00:14:07,040 --> 00:14:11,680
it and it can go both ways right we can

404
00:14:09,440 --> 00:14:14,079
automate a lot of the defensive piece uh

405
00:14:11,680 --> 00:14:16,480
using a tool like a sore so once the

406
00:14:14,079 --> 00:14:18,480
offensive team develops that ttp

407
00:14:16,480 --> 00:14:22,399
they feed it into the sore so then we

408
00:14:18,480 --> 00:14:24,000
have another method of automating it

409
00:14:22,399 --> 00:14:26,240
so to break down kind of the threat

410
00:14:24,000 --> 00:14:28,839
intelligence piece to developing this

411
00:14:26,240 --> 00:14:31,519
purple team for our adversary emulation

412
00:14:28,839 --> 00:14:33,680
exercise so we're starting out with wmic

413
00:14:31,519 --> 00:14:37,279
four lateral movement and that is

414
00:14:33,680 --> 00:14:39,360
technique t1047 from miter attack matrix

415
00:14:37,279 --> 00:14:41,920
and you can see the link on screen

416
00:14:39,360 --> 00:14:44,560
uh what do you know not petya the

417
00:14:41,920 --> 00:14:46,639
malware happens to use this

418
00:14:44,560 --> 00:14:48,480
so it may not be tied to a specific

419
00:14:46,639 --> 00:14:50,560
threat actor and that's okay

420
00:14:48,480 --> 00:14:52,480
could be we're covering a pretty broad

421
00:14:50,560 --> 00:14:54,240
technique one of the top methods for

422
00:14:52,480 --> 00:14:55,920
lateral movement

423
00:14:54,240 --> 00:14:58,720
and then we see on number three that the

424
00:14:55,920 --> 00:15:00,880
new ransomware variant nedia also

425
00:14:58,720 --> 00:15:03,199
compromises systems worldwide and

426
00:15:00,880 --> 00:15:04,880
happens to use this technique if we look

427
00:15:03,199 --> 00:15:07,199
into the threat intelligence available

428
00:15:04,880 --> 00:15:10,560
on miter attack a blog from talos

429
00:15:07,199 --> 00:15:13,440
intelligence shows us the exact command

430
00:15:10,560 --> 00:15:16,160
that this malware or threat actor uses

431
00:15:13,440 --> 00:15:17,120
to execute commands remotely on another

432
00:15:16,160 --> 00:15:18,560
system

433
00:15:17,120 --> 00:15:20,279
and so this is great this type of

434
00:15:18,560 --> 00:15:22,800
intelligence is great for

435
00:15:20,279 --> 00:15:25,519
adversariation for both the offensive

436
00:15:22,800 --> 00:15:27,360
and defensive side so the offensive side

437
00:15:25,519 --> 00:15:29,279
we already have the command ready to go

438
00:15:27,360 --> 00:15:31,360
we may need to do a little bit of

439
00:15:29,279 --> 00:15:33,040
development so it runs in our specific

440
00:15:31,360 --> 00:15:35,199
specific environment

441
00:15:33,040 --> 00:15:37,360
and then the defensive side is also

442
00:15:35,199 --> 00:15:39,360
ready to go because they can build

443
00:15:37,360 --> 00:15:40,880
signatures around the specific command

444
00:15:39,360 --> 00:15:43,279
line parameters

445
00:15:40,880 --> 00:15:44,480
and there may be some obfuscation that

446
00:15:43,279 --> 00:15:46,399
can take place

447
00:15:44,480 --> 00:15:48,000
but that's why that continuous loop

448
00:15:46,399 --> 00:15:50,800
happens for the purple team engagements

449
00:15:48,000 --> 00:15:53,680
with advocation because we can feed that

450
00:15:50,800 --> 00:15:56,880
back through and build new signatures or

451
00:15:53,680 --> 00:15:56,880
look for those detections

452
00:15:57,440 --> 00:15:59,519
so

453
00:15:58,320 --> 00:16:02,240
when you're first starting out with

454
00:15:59,519 --> 00:16:03,920
doing advertising for purple teaming it

455
00:16:02,240 --> 00:16:06,160
can be tough to keep track of the

456
00:16:03,920 --> 00:16:07,440
signatures or the ttps you want to

457
00:16:06,160 --> 00:16:10,000
signaturize

458
00:16:07,440 --> 00:16:10,880
and honestly a simple spreadsheet like

459
00:16:10,000 --> 00:16:12,720
this

460
00:16:10,880 --> 00:16:14,880
can help you get started

461
00:16:12,720 --> 00:16:17,440
are you documenting the ttp do we have a

462
00:16:14,880 --> 00:16:19,839
signature for it have we tested it is

463
00:16:17,440 --> 00:16:21,680
this a high or low priority is there any

464
00:16:19,839 --> 00:16:23,279
relevant threat intelligence key

465
00:16:21,680 --> 00:16:25,440
adversariation relevant threat

466
00:16:23,279 --> 00:16:27,920
intelligence and do we have a date that

467
00:16:25,440 --> 00:16:29,839
we would like to test this on

468
00:16:27,920 --> 00:16:31,759
and honestly this is

469
00:16:29,839 --> 00:16:33,920
as basic as it gets low resource

470
00:16:31,759 --> 00:16:37,279
intensive and it helps you keep track of

471
00:16:33,920 --> 00:16:39,440
what you need to test

472
00:16:37,279 --> 00:16:41,920
so adversary emulation as a training

473
00:16:39,440 --> 00:16:43,920
tool and this leans more on the people

474
00:16:41,920 --> 00:16:45,519
side of security ops

475
00:16:43,920 --> 00:16:47,440
so i've mentioned this several times

476
00:16:45,519 --> 00:16:49,040
because it's really important getting

477
00:16:47,440 --> 00:16:51,759
getting your defenders getting them

478
00:16:49,040 --> 00:16:54,560
exposure to threat actor ttps and their

479
00:16:51,759 --> 00:16:57,040
behaviors is very important because when

480
00:16:54,560 --> 00:16:58,240
they do in a training situation like you

481
00:16:57,040 --> 00:17:00,000
can with some of these public and

482
00:16:58,240 --> 00:17:02,079
private trainings and then they happen

483
00:17:00,000 --> 00:17:04,480
to see that type of activity

484
00:17:02,079 --> 00:17:07,199
in their own networks that really helps

485
00:17:04,480 --> 00:17:09,280
them clue in on what to pivot on or

486
00:17:07,199 --> 00:17:11,600
okay i'm i'm familiar with what comes

487
00:17:09,280 --> 00:17:13,919
after this ttp normally that a threat

488
00:17:11,600 --> 00:17:15,520
actor would so for example once a threat

489
00:17:13,919 --> 00:17:17,760
actor drops a payload they start

490
00:17:15,520 --> 00:17:20,079
enumerating active directory they might

491
00:17:17,760 --> 00:17:21,679
be looking to move laterally so

492
00:17:20,079 --> 00:17:23,760
if we catch it at that point from a

493
00:17:21,679 --> 00:17:24,880
defensive standpoint we can say okay

494
00:17:23,760 --> 00:17:26,559
let's look for lateral movement

495
00:17:24,880 --> 00:17:29,039
techniques oh what do you know we just

496
00:17:26,559 --> 00:17:31,440
talked about one using wmic so let's

497
00:17:29,039 --> 00:17:33,120
look at that for potential movement

498
00:17:31,440 --> 00:17:34,480
across the network

499
00:17:33,120 --> 00:17:36,240
and so i mentioned there's public and

500
00:17:34,480 --> 00:17:38,080
private private trainings for this a lot

501
00:17:36,240 --> 00:17:40,080
of them are happening at def con and

502
00:17:38,080 --> 00:17:42,640
black hat and other conferences or you

503
00:17:40,080 --> 00:17:45,600
can talk to those companies individually

504
00:17:42,640 --> 00:17:46,960
but on the free side free as in free to

505
00:17:45,600 --> 00:17:49,679
attend but you might have to pay for a

506
00:17:46,960 --> 00:17:50,880
conference to get in cts like open socks

507
00:17:49,679 --> 00:17:52,240
so i'm a little biased because i used to

508
00:17:50,880 --> 00:17:54,720
work at recon and do a lot of

509
00:17:52,240 --> 00:17:58,240
development on the openstack ctf which

510
00:17:54,720 --> 00:17:59,840
is ran at defcon every year

511
00:17:58,240 --> 00:18:02,880
that's one of the best ways to get

512
00:17:59,840 --> 00:18:04,880
exposure to real adversarial emulation

513
00:18:02,880 --> 00:18:07,200
because when i was doing it i had to

514
00:18:04,880 --> 00:18:08,799
actually develop the same exact payloads

515
00:18:07,200 --> 00:18:11,039
and malware that the threat actor might

516
00:18:08,799 --> 00:18:12,720
use and then we move over to boss of the

517
00:18:11,039 --> 00:18:14,400
sock from splunk

518
00:18:12,720 --> 00:18:16,960
obviously the splunk tool is in free but

519
00:18:14,400 --> 00:18:19,360
there is a free-ish version you can get

520
00:18:16,960 --> 00:18:20,799
to use for boss of the stock uh the data

521
00:18:19,360 --> 00:18:22,559
set that's available

522
00:18:20,799 --> 00:18:24,400
um but that threat

523
00:18:22,559 --> 00:18:26,320
threat research team that puts that out

524
00:18:24,400 --> 00:18:28,480
is amazing they put a lot of content out

525
00:18:26,320 --> 00:18:31,280
there to give you the exposure

526
00:18:28,480 --> 00:18:33,600
to real world ttps and while it may be

527
00:18:31,280 --> 00:18:35,520
focused on using their tool set

528
00:18:33,600 --> 00:18:37,679
like i mentioned before it's the

529
00:18:35,520 --> 00:18:39,280
methodologies that are key and not the

530
00:18:37,679 --> 00:18:41,679
tools so you can take those same

531
00:18:39,280 --> 00:18:43,360
concepts and bring them over to gray log

532
00:18:41,679 --> 00:18:45,360
or another tool

533
00:18:43,360 --> 00:18:48,320
and then we have something like net wars

534
00:18:45,360 --> 00:18:49,120
from sans uh cost a little bit to try it

535
00:18:48,320 --> 00:18:51,280
out

536
00:18:49,120 --> 00:18:53,440
but it is a great exposure to

537
00:18:51,280 --> 00:18:55,679
a general amount of ttps not really

538
00:18:53,440 --> 00:18:57,200
specifically tied to a threat actor but

539
00:18:55,679 --> 00:18:58,559
it's great if you're first starting out

540
00:18:57,200 --> 00:19:00,080
and you want to kind of get exposure to

541
00:18:58,559 --> 00:19:03,360
those or you want to try out some of

542
00:19:00,080 --> 00:19:05,600
those offensive ttp's yourself and then

543
00:19:03,360 --> 00:19:08,480
there are hundreds of cts that go on

544
00:19:05,600 --> 00:19:10,160
every year check out ctftime.org

545
00:19:08,480 --> 00:19:12,000
there's probably one going on every

546
00:19:10,160 --> 00:19:14,000
single weekend this year

547
00:19:12,000 --> 00:19:16,400
and while a lot of them are focused on

548
00:19:14,000 --> 00:19:18,960
you know just hacking specifically into

549
00:19:16,400 --> 00:19:20,880
a crazy puzzle it's a great way to get

550
00:19:18,960 --> 00:19:22,640
you familiar with the tool sets and the

551
00:19:20,880 --> 00:19:24,799
methodologies of

552
00:19:22,640 --> 00:19:26,799
conducting exploitation or moving

553
00:19:24,799 --> 00:19:28,960
laterally and then you can take those

554
00:19:26,799 --> 00:19:30,320
and apply those to your actual offensive

555
00:19:28,960 --> 00:19:35,120
engagements

556
00:19:30,320 --> 00:19:35,120
where necessary or where where possible

557
00:19:35,520 --> 00:19:39,039
so my favorite slide in the talk is

558
00:19:37,840 --> 00:19:41,679
because this is where i give you the

559
00:19:39,039 --> 00:19:43,520
resources so you can get started so

560
00:19:41,679 --> 00:19:44,559
let's talk about labs

561
00:19:43,520 --> 00:19:46,160
so

562
00:19:44,559 --> 00:19:47,679
the labs can be a controversial

563
00:19:46,160 --> 00:19:48,400
controversial thing because it's either

564
00:19:47,679 --> 00:19:50,240
you

565
00:19:48,400 --> 00:19:52,480
have a lot of resources to build one or

566
00:19:50,240 --> 00:19:55,679
you have very minimal resources and so

567
00:19:52,480 --> 00:19:58,160
try to choose a a good range of things

568
00:19:55,679 --> 00:20:00,480
that can be done on multiple types of

569
00:19:58,160 --> 00:20:02,799
systems with resources limitations in

570
00:20:00,480 --> 00:20:05,280
mind so detection lab that one's more on

571
00:20:02,799 --> 00:20:08,400
the higher resources then because it'll

572
00:20:05,280 --> 00:20:10,640
pull down several images a dc

573
00:20:08,400 --> 00:20:13,280
i believe they even put in a

574
00:20:10,640 --> 00:20:14,799
sql server on there recently

575
00:20:13,280 --> 00:20:16,480
within the last year

576
00:20:14,799 --> 00:20:17,600
i think i think the developers even

577
00:20:16,480 --> 00:20:19,840
trying to work on the print nightmare

578
00:20:17,600 --> 00:20:21,360
one as well putting that exploit in

579
00:20:19,840 --> 00:20:22,720
there so you could actually exploit and

580
00:20:21,360 --> 00:20:24,880
test and see what it looks like and

581
00:20:22,720 --> 00:20:26,080
that's cool thing about detection lab is

582
00:20:24,880 --> 00:20:27,280
it allows you to spin up that

583
00:20:26,080 --> 00:20:29,120
environment

584
00:20:27,280 --> 00:20:31,120
look at the logs do some detection

585
00:20:29,120 --> 00:20:34,159
engineering or getting familiar with

586
00:20:31,120 --> 00:20:36,320
different attacks in that environment

587
00:20:34,159 --> 00:20:39,840
keep in mind that it's download several

588
00:20:36,320 --> 00:20:41,039
images uh iso files that take quite a

589
00:20:39,840 --> 00:20:42,960
while depending on your internet

590
00:20:41,039 --> 00:20:45,120
connection so keep that in mind

591
00:20:42,960 --> 00:20:46,880
and your hard drive space

592
00:20:45,120 --> 00:20:48,960
and then we move on to splunk's attack

593
00:20:46,880 --> 00:20:52,000
range the splunk team does an amazing

594
00:20:48,960 --> 00:20:54,000
job of developing different ttps they

595
00:20:52,000 --> 00:20:56,559
have a way of incorporating

596
00:20:54,000 --> 00:20:59,200
atomic red team from red canary it's a

597
00:20:56,559 --> 00:21:00,640
great way to get exposure to new new

598
00:20:59,200 --> 00:21:02,240
techniques that are out there or you

599
00:21:00,640 --> 00:21:04,240
want to help build your own detections

600
00:21:02,240 --> 00:21:06,080
if your company happens to use splunk

601
00:21:04,240 --> 00:21:08,480
but as i mentioned before

602
00:21:06,080 --> 00:21:10,720
using splunk isn't you know the end-all

603
00:21:08,480 --> 00:21:12,799
be-all because those same methodologies

604
00:21:10,720 --> 00:21:16,000
we'll move over to a different analysis

605
00:21:12,799 --> 00:21:17,200
tool or a different data analysis tool

606
00:21:16,000 --> 00:21:18,799
and then

607
00:21:17,200 --> 00:21:20,640
the best place to start if you're just

608
00:21:18,799 --> 00:21:21,840
getting started or you want to simply

609
00:21:20,640 --> 00:21:24,080
test something

610
00:21:21,840 --> 00:21:26,640
before you run an operation is a few

611
00:21:24,080 --> 00:21:29,120
virtual me for a few virtual machines

612
00:21:26,640 --> 00:21:32,720
and a log analysis tool so

613
00:21:29,120 --> 00:21:35,840
a windows 10 box uh set up a uh help

614
00:21:32,720 --> 00:21:37,919
server from cyberwardog very minimal i

615
00:21:35,840 --> 00:21:38,960
think there's a four gig configuration

616
00:21:37,919 --> 00:21:41,840
you can run

617
00:21:38,960 --> 00:21:44,080
to feed those logs into

618
00:21:41,840 --> 00:21:45,760
an elk stack so you can actually analyze

619
00:21:44,080 --> 00:21:47,600
what your activity is doing in an

620
00:21:45,760 --> 00:21:50,720
environment and that's like the most

621
00:21:47,600 --> 00:21:53,600
basic way i think you can get away with

622
00:21:50,720 --> 00:21:56,480
maybe like eight gigs of memory uh

623
00:21:53,600 --> 00:21:58,960
across those potentially two or three

624
00:21:56,480 --> 00:22:00,000
os's running at the same time

625
00:21:58,960 --> 00:22:03,200
so keep that in mind when you're

626
00:22:00,000 --> 00:22:04,720
building out a server or a system so

627
00:22:03,200 --> 00:22:06,080
that you can do this type of testing on

628
00:22:04,720 --> 00:22:07,600
your own this type of adversary

629
00:22:06,080 --> 00:22:09,200
emulation testing

630
00:22:07,600 --> 00:22:11,600
so let's talk more about the tools to

631
00:22:09,200 --> 00:22:13,919
help you feed into those labs or that

632
00:22:11,600 --> 00:22:15,840
custom lab you happen to build

633
00:22:13,919 --> 00:22:16,880
so we mentioned atomic red team from red

634
00:22:15,840 --> 00:22:19,520
canary

635
00:22:16,880 --> 00:22:21,120
the developers on that are super active

636
00:22:19,520 --> 00:22:22,720
and they're all amazing i suggest go

637
00:22:21,120 --> 00:22:24,880
check out their slack channel and of

638
00:22:22,720 --> 00:22:28,159
course their github repo and they're all

639
00:22:24,880 --> 00:22:30,320
they seem to be always adding new ttps

640
00:22:28,159 --> 00:22:32,320
to their tool set um and i really

641
00:22:30,320 --> 00:22:34,480
suggest you want to take that throw it

642
00:22:32,320 --> 00:22:37,360
in your lab get familiar with different

643
00:22:34,480 --> 00:22:38,640
ttps different miter attack techniques

644
00:22:37,360 --> 00:22:40,320
and especially if you're on the

645
00:22:38,640 --> 00:22:43,280
defensive or the detection engineering

646
00:22:40,320 --> 00:22:45,120
side this is a great way to get exposure

647
00:22:43,280 --> 00:22:47,679
without having to worry about getting

648
00:22:45,120 --> 00:22:50,240
your hands on the latest and greatest c2

649
00:22:47,679 --> 00:22:52,159
tool or latest and grades

650
00:22:50,240 --> 00:22:53,760
malware right because when it comes down

651
00:22:52,159 --> 00:22:56,080
to it they're just replicating specific

652
00:22:53,760 --> 00:22:57,039
ttps and you can do that with atomic red

653
00:22:56,080 --> 00:22:58,400
team

654
00:22:57,039 --> 00:23:00,480
if you want to get a little more

655
00:22:58,400 --> 00:23:03,360
adventurous you can look at something

656
00:23:00,480 --> 00:23:05,120
called caldera from mitre

657
00:23:03,360 --> 00:23:07,360
recently they started putting in more

658
00:23:05,120 --> 00:23:08,799
development time to it it's becoming a

659
00:23:07,360 --> 00:23:10,960
great tool

660
00:23:08,799 --> 00:23:12,640
it's kind of like a pseudo red team tool

661
00:23:10,960 --> 00:23:15,600
it allows you to build a payload a

662
00:23:12,640 --> 00:23:17,360
binary payload throw it on a target host

663
00:23:15,600 --> 00:23:19,919
execute commands through that payload

664
00:23:17,360 --> 00:23:22,720
just like you would with c2 tools like

665
00:23:19,919 --> 00:23:25,679
cobalt strike or powershell empire those

666
00:23:22,720 --> 00:23:27,440
kind of things or mythic is one another

667
00:23:25,679 --> 00:23:29,600
one and then the other option is custom

668
00:23:27,440 --> 00:23:31,360
development so i mentioned that in an

669
00:23:29,600 --> 00:23:33,679
earlier slide where i was talking about

670
00:23:31,360 --> 00:23:35,679
you know can this be automated

671
00:23:33,679 --> 00:23:37,120
yes using custom development we can have

672
00:23:35,679 --> 00:23:38,720
our offensive team

673
00:23:37,120 --> 00:23:40,559
even if it's your pin testing team and

674
00:23:38,720 --> 00:23:42,480
you don't have a red team you can have

675
00:23:40,559 --> 00:23:45,679
the pin testing team or the offensive

676
00:23:42,480 --> 00:23:48,880
team develop custom tools or custom

677
00:23:45,679 --> 00:23:52,000
scripts to run these adversary emulation

678
00:23:48,880 --> 00:23:53,919
exercises in your lab right or in your

679
00:23:52,000 --> 00:23:55,679
production environment obviously be

680
00:23:53,919 --> 00:23:56,880
smart about what you're doing but you

681
00:23:55,679 --> 00:23:58,320
can run them in your detection

682
00:23:56,880 --> 00:24:00,240
environment so that you can build

683
00:23:58,320 --> 00:24:01,840
detections or help refine those

684
00:24:00,240 --> 00:24:05,039
processes using that purple team

685
00:24:01,840 --> 00:24:07,360
methodology we talked about and so on my

686
00:24:05,039 --> 00:24:09,120
github i actually put a script on there

687
00:24:07,360 --> 00:24:11,360
that will help you automate a lot of the

688
00:24:09,120 --> 00:24:13,919
stuff if you're going for that simple

689
00:24:11,360 --> 00:24:15,600
few virtual me you few virtual machines

690
00:24:13,919 --> 00:24:18,000
set up like a windows 10

691
00:24:15,600 --> 00:24:20,480
an ubuntu server for logging and maybe a

692
00:24:18,000 --> 00:24:22,640
cali for an attack host this script will

693
00:24:20,480 --> 00:24:24,000
basically download

694
00:24:22,640 --> 00:24:26,080
sysmon

695
00:24:24,000 --> 00:24:28,080
winlogbeat it'll help you set up

696
00:24:26,080 --> 00:24:30,400
forwarding all the logs and then also

697
00:24:28,080 --> 00:24:32,640
download atomic red team so you're good

698
00:24:30,400 --> 00:24:35,039
to go all you have to do is type in the

699
00:24:32,640 --> 00:24:37,279
atomic red team invoke atomic red team

700
00:24:35,039 --> 00:24:39,600
run the uh the ttp you want to run and

701
00:24:37,279 --> 00:24:42,000
now you have logs shipping

702
00:24:39,600 --> 00:24:43,520
to your help or your elk stack depending

703
00:24:42,000 --> 00:24:45,600
on what you decide to set up and keep in

704
00:24:43,520 --> 00:24:47,679
mind the resources can be intensive

705
00:24:45,600 --> 00:24:49,360
depending on what you're trying to do

706
00:24:47,679 --> 00:24:50,720
and some great references to help you

707
00:24:49,360 --> 00:24:53,039
get started with looking at threat

708
00:24:50,720 --> 00:24:55,360
intelligence for adversariation

709
00:24:53,039 --> 00:24:56,159
is first off miter attack metric minor

710
00:24:55,360 --> 00:24:58,320
attack

711
00:24:56,159 --> 00:25:00,000
you'll cure it probably

712
00:24:58,320 --> 00:25:02,880
all day every day at every conference

713
00:25:00,000 --> 00:25:04,799
you go to or every blog post you see but

714
00:25:02,880 --> 00:25:06,960
it's very important right because it's

715
00:25:04,799 --> 00:25:08,960
got a way of breaking down ttps in a

716
00:25:06,960 --> 00:25:11,039
readable manner and they're also great

717
00:25:08,960 --> 00:25:14,080
about including threat intelligence to

718
00:25:11,039 --> 00:25:15,600
back up those ttps and that's a great

719
00:25:14,080 --> 00:25:17,279
point when it comes to threat research

720
00:25:15,600 --> 00:25:20,320
that's your pivot point right so i found

721
00:25:17,279 --> 00:25:21,919
my ttp i found relatable intelligence

722
00:25:20,320 --> 00:25:23,760
i'm going to go keep searching for that

723
00:25:21,919 --> 00:25:26,320
type of intel or these types of threat

724
00:25:23,760 --> 00:25:28,880
actors that might actually use these

725
00:25:26,320 --> 00:25:30,080
ttps or these tools

726
00:25:28,880 --> 00:25:33,200
and so

727
00:25:30,080 --> 00:25:35,520
my favorite one is uh it

728
00:25:33,200 --> 00:25:37,279
it's not really a minor attack matrix

729
00:25:35,520 --> 00:25:38,080
style website but it's called malpedia

730
00:25:37,279 --> 00:25:40,080
right

731
00:25:38,080 --> 00:25:41,919
and uh it's one of my favorite places

732
00:25:40,080 --> 00:25:44,799
for threat intelligence gathering is

733
00:25:41,919 --> 00:25:46,720
because you simply search the

734
00:25:44,799 --> 00:25:50,240
type of malware or

735
00:25:46,720 --> 00:25:52,799
uh c2 or threat actor

736
00:25:50,240 --> 00:25:54,559
that you're interested in right so for

737
00:25:52,799 --> 00:25:57,039
for this one i looked up pepya right and

738
00:25:54,559 --> 00:25:59,679
i came up with the eternal petya they

739
00:25:57,039 --> 00:26:02,159
can show you which types of uh families

740
00:25:59,679 --> 00:26:04,480
it's a part of it'll link different blog

741
00:26:02,159 --> 00:26:06,960
posts different uh

742
00:26:04,480 --> 00:26:08,559
different reports from different vendors

743
00:26:06,960 --> 00:26:09,919
uh the open source ones that you can get

744
00:26:08,559 --> 00:26:11,120
access to without paying for a

745
00:26:09,919 --> 00:26:13,840
subscription

746
00:26:11,120 --> 00:26:16,159
it's an amazing place i don't believe

747
00:26:13,840 --> 00:26:18,000
it's easy to get an account on there but

748
00:26:16,159 --> 00:26:19,919
a lot of the stuff is free you just

749
00:26:18,000 --> 00:26:21,360
simply go to their search page and start

750
00:26:19,919 --> 00:26:24,080
typing away

751
00:26:21,360 --> 00:26:25,440
i used to use it all the time and i

752
00:26:24,080 --> 00:26:27,279
still use it all the time when i'm

753
00:26:25,440 --> 00:26:29,440
interested in finding out how to

754
00:26:27,279 --> 00:26:31,039
replicate a specific threat actor

755
00:26:29,440 --> 00:26:32,799
because a lot of the times when you go

756
00:26:31,039 --> 00:26:34,799
to something like minor attack matrix

757
00:26:32,799 --> 00:26:36,400
they'll have four or five

758
00:26:34,799 --> 00:26:38,240
possible

759
00:26:36,400 --> 00:26:39,520
references at the bottom right but

760
00:26:38,240 --> 00:26:41,279
honestly that's not enough when you're

761
00:26:39,520 --> 00:26:43,039
building out a full campaign or you want

762
00:26:41,279 --> 00:26:44,880
to build on a full purple team operation

763
00:26:43,039 --> 00:26:46,480
using address simulation

764
00:26:44,880 --> 00:26:48,640
or simply when you want to train your

765
00:26:46,480 --> 00:26:51,440
defenders against a multitude of a

766
00:26:48,640 --> 00:26:53,039
threat actors ctps one report from minor

767
00:26:51,440 --> 00:26:55,520
attack matrix might give you one or two

768
00:26:53,039 --> 00:26:58,480
ttps you come over to malpedia and

769
00:26:55,520 --> 00:27:01,039
you'll probably find 10 to 15 different

770
00:26:58,480 --> 00:27:02,159
articles or blog posts about a specific

771
00:27:01,039 --> 00:27:04,400
threat actor

772
00:27:02,159 --> 00:27:06,320
and information surrounding their

773
00:27:04,400 --> 00:27:07,919
objectives and that's something else i

774
00:27:06,320 --> 00:27:10,080
didn't mention is when you're doing

775
00:27:07,919 --> 00:27:12,159
adversary emulation you want to be

776
00:27:10,080 --> 00:27:14,559
objective focused just like you are with

777
00:27:12,159 --> 00:27:17,039
red team engagements because the

778
00:27:14,559 --> 00:27:19,120
adversary has an objective it's you know

779
00:27:17,039 --> 00:27:21,520
it could be to gain access just simply

780
00:27:19,120 --> 00:27:22,880
to sell access or they want to gain

781
00:27:21,520 --> 00:27:24,880
access to

782
00:27:22,880 --> 00:27:27,520
ransomware your data or collect your

783
00:27:24,880 --> 00:27:29,679
data and sell it somewhere else there's

784
00:27:27,520 --> 00:27:31,840
always an objective in mind and it's

785
00:27:29,679 --> 00:27:33,279
most likely financially motivated so

786
00:27:31,840 --> 00:27:35,840
keep that in mind when you're doing your

787
00:27:33,279 --> 00:27:35,840
research

788
00:27:36,080 --> 00:27:39,360
okay so

789
00:27:37,440 --> 00:27:41,679
my favorite part in addition to the

790
00:27:39,360 --> 00:27:44,320
resources slide is how can you get

791
00:27:41,679 --> 00:27:47,279
started so i gave you the resources to

792
00:27:44,320 --> 00:27:50,320
get started on a lab to get started with

793
00:27:47,279 --> 00:27:53,360
some pseudo adversarial activity using

794
00:27:50,320 --> 00:27:55,360
red canary's atomic red team and miters

795
00:27:53,360 --> 00:27:56,799
caldera and then of course custom

796
00:27:55,360 --> 00:27:58,159
development because i always encourage

797
00:27:56,799 --> 00:28:00,080
that that's the best way to learn is to

798
00:27:58,159 --> 00:28:02,559
get your hands on the code and start

799
00:28:00,080 --> 00:28:05,440
writing these ttps yourself even if it's

800
00:28:02,559 --> 00:28:07,600
simply wmic you know process call create

801
00:28:05,440 --> 00:28:09,440
on the target host that's enough to get

802
00:28:07,600 --> 00:28:11,360
started so

803
00:28:09,440 --> 00:28:13,360
there's three steps i like to include

804
00:28:11,360 --> 00:28:14,640
when i'm doing advertising or i'm you

805
00:28:13,360 --> 00:28:17,440
know i'm building out an adversary

806
00:28:14,640 --> 00:28:19,520
emulation scenario is first off threat

807
00:28:17,440 --> 00:28:21,120
intelligence is key i mentioned that

808
00:28:19,520 --> 00:28:22,480
several times because it is key you

809
00:28:21,120 --> 00:28:24,720
don't have

810
00:28:22,480 --> 00:28:25,919
adversariation without threat

811
00:28:24,720 --> 00:28:27,279
intelligence well you don't have

812
00:28:25,919 --> 00:28:29,520
successful

813
00:28:27,279 --> 00:28:31,520
adversary emulation without threat

814
00:28:29,520 --> 00:28:33,919
intelligence so step one we're going to

815
00:28:31,520 --> 00:28:36,159
select our threat actor and our relevant

816
00:28:33,919 --> 00:28:37,279
threat until so we're going to pick aptx

817
00:28:36,159 --> 00:28:38,880
we're going to go to mitre we're going

818
00:28:37,279 --> 00:28:41,919
to look at the specific references they

819
00:28:38,880 --> 00:28:44,480
have what ttps they happen to use we'll

820
00:28:41,919 --> 00:28:46,240
hop over to malpedia look for subsequent

821
00:28:44,480 --> 00:28:48,240
articles or blog posts about

822
00:28:46,240 --> 00:28:50,799
interactions with these types of threat

823
00:28:48,240 --> 00:28:52,480
actors in different environments what

824
00:28:50,799 --> 00:28:53,520
what they do in their environments what

825
00:28:52,480 --> 00:28:54,880
they're do what they do when they're in

826
00:28:53,520 --> 00:28:55,760
the environments what their objectives

827
00:28:54,880 --> 00:28:58,000
are

828
00:28:55,760 --> 00:28:59,679
they'll move on to step two so this is

829
00:28:58,000 --> 00:29:00,960
the most resource intensive part

830
00:28:59,679 --> 00:29:02,799
depending on what you're trying to

831
00:29:00,960 --> 00:29:04,640
replicate if you're trying to replicate

832
00:29:02,799 --> 00:29:07,039
a throat actor specific

833
00:29:04,640 --> 00:29:09,200
malware or c2 depending on the

834
00:29:07,039 --> 00:29:11,600
capabilities of your team this could be

835
00:29:09,200 --> 00:29:13,120
resource intensive so but in this step

836
00:29:11,600 --> 00:29:15,679
we're going to develop and replicate

837
00:29:13,120 --> 00:29:17,679
those ttps if it's a simple command line

838
00:29:15,679 --> 00:29:19,279
action that's easy that's straight from

839
00:29:17,679 --> 00:29:21,279
the threat until we just need to modify

840
00:29:19,279 --> 00:29:23,679
it a little bit if it's an actual

841
00:29:21,279 --> 00:29:25,200
payload that may take some time so keep

842
00:29:23,679 --> 00:29:27,120
that in mind when you're doing this type

843
00:29:25,200 --> 00:29:28,480
of development if you're trying to be

844
00:29:27,120 --> 00:29:30,320
time sensitive

845
00:29:28,480 --> 00:29:33,279
and then step three we're going to

846
00:29:30,320 --> 00:29:34,960
execute our actions and depending on how

847
00:29:33,279 --> 00:29:36,720
we went if we went specifically for a

848
00:29:34,960 --> 00:29:39,679
purple team operation or simply just

849
00:29:36,720 --> 00:29:40,640
giving our defenders exposure to these

850
00:29:39,679 --> 00:29:42,880
actions

851
00:29:40,640 --> 00:29:45,360
this is the final step and so when you

852
00:29:42,880 --> 00:29:48,000
add all three of these together you get

853
00:29:45,360 --> 00:29:49,919
successful adversary emulation and i'm

854
00:29:48,000 --> 00:29:52,720
going to mention it again because it's

855
00:29:49,919 --> 00:29:55,279
very important threat intelligence is

856
00:29:52,720 --> 00:29:57,919
the key to successful adversary

857
00:29:55,279 --> 00:29:57,919
emulation

858
00:29:58,000 --> 00:30:02,559
okay so i just wanted to give another

859
00:29:59,840 --> 00:30:04,480
big shout out to adversary village

860
00:30:02,559 --> 00:30:07,200
all of the people watching today thank

861
00:30:04,480 --> 00:30:08,880
you so much for attending my talk and my

862
00:30:07,200 --> 00:30:11,279
final parting thoughts on adverse

863
00:30:08,880 --> 00:30:13,919
emulation so adversary emulation can

864
00:30:11,279 --> 00:30:16,159
help you improve the overall security

865
00:30:13,919 --> 00:30:18,720
posture of your organization

866
00:30:16,159 --> 00:30:20,960
through testing validating capabilities

867
00:30:18,720 --> 00:30:23,120
or simply improving the people behind

868
00:30:20,960 --> 00:30:25,360
the processes because when it comes down

869
00:30:23,120 --> 00:30:28,000
to security ops or the defensive side of

870
00:30:25,360 --> 00:30:28,880
security and even the offensive side the

871
00:30:28,000 --> 00:30:30,799
people

872
00:30:28,880 --> 00:30:33,200
are the most important and they need to

873
00:30:30,799 --> 00:30:35,679
be able to refine those processes that

874
00:30:33,200 --> 00:30:40,039
help them defend their organizations so

875
00:30:35,679 --> 00:30:40,039
once again thank you so much

