1
00:00:00,320 --> 00:00:01,920
and thanks for having me i'm really

2
00:00:01,920 --> 00:00:03,679
excited to present uh this year in the

3
00:00:03,679 --> 00:00:05,520
cloud village i've presented in many

4
00:00:05,520 --> 00:00:08,160
club villages and and defcon in general

5
00:00:08,160 --> 00:00:09,760
but uh the cloud village is a new one

6
00:00:09,760 --> 00:00:12,719
for me so super excited about this um as

7
00:00:12,719 --> 00:00:14,639
jeff mentioned uh the title of this

8
00:00:14,639 --> 00:00:16,320
presentation is identifying toxic

9
00:00:16,320 --> 00:00:18,640
combinations of permissions in your

10
00:00:18,640 --> 00:00:20,800
cloud infrastructure so

11
00:00:20,800 --> 00:00:23,279
this is a mashup of a lot of research

12
00:00:23,279 --> 00:00:24,320
we've done

13
00:00:24,320 --> 00:00:26,400
over a few years now in doing risk

14
00:00:26,400 --> 00:00:29,599
assessments for organizations and

15
00:00:29,599 --> 00:00:33,680
largely focused around aws azure and gcp

16
00:00:33,680 --> 00:00:35,280
so we'll give you some examples some

17
00:00:35,280 --> 00:00:37,120
more stories things like that to really

18
00:00:37,120 --> 00:00:39,760
help you think more about a lot of these

19
00:00:39,760 --> 00:00:42,559
complex permissions in the cloud and

20
00:00:42,559 --> 00:00:44,079
with that i'll go ahead and jump right

21
00:00:44,079 --> 00:00:46,399
into it

22
00:00:49,360 --> 00:00:50,879
so really won't talk too much about

23
00:00:50,879 --> 00:00:52,640
myself but rather instead i'll just tell

24
00:00:52,640 --> 00:00:54,320
you a funny story how i got into cyber

25
00:00:54,320 --> 00:00:56,879
security you know uh hanging out at def

26
00:00:56,879 --> 00:00:58,960
con for many years that there's always

27
00:00:58,960 --> 00:01:00,719
really fun and interesting stories about

28
00:01:00,719 --> 00:01:02,320
how each and every person has gotten

29
00:01:02,320 --> 00:01:04,000
into cyber security

30
00:01:04,000 --> 00:01:06,159
for me i was actually working for one of

31
00:01:06,159 --> 00:01:09,280
the stock markets and at that time

32
00:01:09,280 --> 00:01:11,280
i was a unix system administrator and an

33
00:01:11,280 --> 00:01:12,720
oracle dba

34
00:01:12,720 --> 00:01:15,680
this is around circa 1993

35
00:01:15,680 --> 00:01:17,840
and i was always one of those uh one of

36
00:01:17,840 --> 00:01:19,119
those folks that's always kind of

37
00:01:19,119 --> 00:01:21,520
tinkering around with stuff and

38
00:01:21,520 --> 00:01:23,600
there was a tool from dan farmer you may

39
00:01:23,600 --> 00:01:24,880
remember dan

40
00:01:24,880 --> 00:01:27,439
in the old school days of defcon 1 and

41
00:01:27,439 --> 00:01:28,479
beyond

42
00:01:28,479 --> 00:01:30,079
and dan authored a lot of different

43
00:01:30,079 --> 00:01:32,000
tools out there for doing

44
00:01:32,000 --> 00:01:33,680
security assessments things like that he

45
00:01:33,680 --> 00:01:36,000
had a tool called satan which was an

46
00:01:36,000 --> 00:01:38,159
acronym for kind of a security

47
00:01:38,159 --> 00:01:40,720
assessment tool set um for unix

48
00:01:40,720 --> 00:01:43,119
platforms at that time so i downloaded

49
00:01:43,119 --> 00:01:45,360
it ran it full bore on the network and

50
00:01:45,360 --> 00:01:46,960
knocked over a server in the middle of

51
00:01:46,960 --> 00:01:49,520
the trading day on the trading floor so

52
00:01:49,520 --> 00:01:52,399
um obviously was not a good day for me

53
00:01:52,399 --> 00:01:54,240
i was called into the csos office at

54
00:01:54,240 --> 00:01:55,680
that time although they didn't call him

55
00:01:55,680 --> 00:01:57,680
csos back then they called him vp of

56
00:01:57,680 --> 00:01:59,280
information security

57
00:01:59,280 --> 00:02:00,960
and he effectively said listen i'm here

58
00:02:00,960 --> 00:02:02,560
to offer you one of two options you're

59
00:02:02,560 --> 00:02:05,040
either fired or you can take a promotion

60
00:02:05,040 --> 00:02:06,880
so i really couldn't go home until my

61
00:02:06,880 --> 00:02:08,318
wife had been fired so i took the

62
00:02:08,318 --> 00:02:10,399
promotion and asked questions later but

63
00:02:10,399 --> 00:02:12,400
he effectively said listen you know i've

64
00:02:12,400 --> 00:02:14,560
got some auditors on my team but nobody

65
00:02:14,560 --> 00:02:16,640
really thinking about the network from a

66
00:02:16,640 --> 00:02:19,040
hacker perspective and you know you

67
00:02:19,040 --> 00:02:21,040
already manage the firewalls dns and

68
00:02:21,040 --> 00:02:23,120
vine and a bunch of other stuff it'll be

69
00:02:23,120 --> 00:02:25,280
your job to now protect the network and

70
00:02:25,280 --> 00:02:26,959
build out a team doing that and that was

71
00:02:26,959 --> 00:02:29,280
how i got into cyber security so i hope

72
00:02:29,280 --> 00:02:32,239
you enjoyed that story

73
00:02:33,120 --> 00:02:34,239
all right so in getting into the

74
00:02:34,239 --> 00:02:37,200
presentation then um

75
00:02:37,200 --> 00:02:39,519
in terms of you know presenting this

76
00:02:39,519 --> 00:02:41,360
talk and a lot of this different types

77
00:02:41,360 --> 00:02:43,760
of content you know over the last few

78
00:02:43,760 --> 00:02:46,239
years you know really kind of begins

79
00:02:46,239 --> 00:02:48,480
with really begging the question of you

80
00:02:48,480 --> 00:02:50,239
know like what am i really looking for

81
00:02:50,239 --> 00:02:52,640
here how do i identify toxic

82
00:02:52,640 --> 00:02:54,959
combinations of permissions how do i

83
00:02:54,959 --> 00:02:57,120
look at that from a proactive

84
00:02:57,120 --> 00:03:01,440
alive and a reactive perspective too

85
00:03:01,440 --> 00:03:03,840
furthermore you know i'm a big believer

86
00:03:03,840 --> 00:03:06,480
like dan farmer in you know the best way

87
00:03:06,480 --> 00:03:08,560
to really understand the risks and

88
00:03:08,560 --> 00:03:10,480
vulnerabilities in your environment is

89
00:03:10,480 --> 00:03:13,040
to do you know various forms of pen

90
00:03:13,040 --> 00:03:14,800
testing and the security assessments

91
00:03:14,800 --> 00:03:16,959
obviously in a planned and you know both

92
00:03:16,959 --> 00:03:19,120
a black box you know type of scenario

93
00:03:19,120 --> 00:03:21,599
and all of that but in understanding how

94
00:03:21,599 --> 00:03:22,720
a lot of these

95
00:03:22,720 --> 00:03:24,959
breaches occurred is really breaking

96
00:03:24,959 --> 00:03:27,200
down the the ttps of those tactics

97
00:03:27,200 --> 00:03:28,560
techniques and procedures to really

98
00:03:28,560 --> 00:03:30,640
understand how they occurred to better

99
00:03:30,640 --> 00:03:32,400
understand how to protect our own cloud

100
00:03:32,400 --> 00:03:35,120
infrastructures

101
00:03:35,200 --> 00:03:36,879
in addition um

102
00:03:36,879 --> 00:03:39,440
we'll kind of map that to

103
00:03:39,440 --> 00:03:40,959
what we've modeled out in terms of a

104
00:03:40,959 --> 00:03:43,760
cyber kill chain but now for the cloud

105
00:03:43,760 --> 00:03:45,440
and then we'll start to break this down

106
00:03:45,440 --> 00:03:47,920
not only in terms of aws and azure but

107
00:03:47,920 --> 00:03:50,000
also gcp and then we'll wrap up with

108
00:03:50,000 --> 00:03:53,200
some additional resources

109
00:03:54,959 --> 00:03:56,560
so at the end of the day you know what

110
00:03:56,560 --> 00:03:58,640
am i really looking for there's a lot of

111
00:03:58,640 --> 00:04:00,480
different aspects you can look for in

112
00:04:00,480 --> 00:04:02,400
cloud infrastructure

113
00:04:02,400 --> 00:04:05,120
specifically around identity in account

114
00:04:05,120 --> 00:04:07,280
activity not only in terms of human

115
00:04:07,280 --> 00:04:09,360
accounts but remember service accounts

116
00:04:09,360 --> 00:04:12,080
outnumber human accounts today five to

117
00:04:12,080 --> 00:04:13,599
one and that's going to increase over

118
00:04:13,599 --> 00:04:16,798
the next few years they say by 2023

119
00:04:16,798 --> 00:04:18,478
service accounts will outnumber human

120
00:04:18,478 --> 00:04:21,279
accounts 20 to 1. so it speaks a lot to

121
00:04:21,279 --> 00:04:23,280
the automation and at the pace at which

122
00:04:23,280 --> 00:04:24,880
we're building in the cloud that there

123
00:04:24,880 --> 00:04:27,120
is a plethora of automation going on and

124
00:04:27,120 --> 00:04:30,400
that's going to obviously continue

125
00:04:30,400 --> 00:04:32,320
there's also a lot of new services in

126
00:04:32,320 --> 00:04:34,240
the cloud that you may or may not be you

127
00:04:34,240 --> 00:04:35,840
know familiar with

128
00:04:35,840 --> 00:04:37,440
i think a lot of people who have been

129
00:04:37,440 --> 00:04:39,040
you know working in the cloud already

130
00:04:39,040 --> 00:04:41,280
are familiar with the nomenclature

131
00:04:41,280 --> 00:04:43,919
surrounding ec2 instances or vms within

132
00:04:43,919 --> 00:04:45,040
aws

133
00:04:45,040 --> 00:04:48,240
s3 buckets or storage within aws azure

134
00:04:48,240 --> 00:04:50,479
blobs and container or storage within

135
00:04:50,479 --> 00:04:52,240
azure but there's so many different

136
00:04:52,240 --> 00:04:54,720
services coming out each and every day

137
00:04:54,720 --> 00:04:56,800
keeping up at the pace of this is really

138
00:04:56,800 --> 00:04:59,120
really difficult

139
00:04:59,120 --> 00:05:01,039
also when i think back at my days

140
00:05:01,039 --> 00:05:02,960
working at the stock market you know

141
00:05:02,960 --> 00:05:06,000
circa 1993 we would have different teams

142
00:05:06,000 --> 00:05:08,080
that would build out the network the

143
00:05:08,080 --> 00:05:10,080
servers loading the operating system

144
00:05:10,080 --> 00:05:12,240
loading the databases these things would

145
00:05:12,240 --> 00:05:14,880
take a week two weeks to deploy end to

146
00:05:14,880 --> 00:05:16,880
end and we'd have different teams deploy

147
00:05:16,880 --> 00:05:17,680
that

148
00:05:17,680 --> 00:05:20,400
in today's world many organizations give

149
00:05:20,400 --> 00:05:22,880
developers access to the whole stack so

150
00:05:22,880 --> 00:05:25,039
in 15 minutes or less they can deploy

151
00:05:25,039 --> 00:05:27,600
all of that and begin their work but

152
00:05:27,600 --> 00:05:31,199
also that power becomes you know

153
00:05:31,199 --> 00:05:33,600
less and less focused on separation of

154
00:05:33,600 --> 00:05:35,440
duties and how do you start to

155
00:05:35,440 --> 00:05:37,840
distinguish what should i developers and

156
00:05:37,840 --> 00:05:40,400
what should i not and how do i further

157
00:05:40,400 --> 00:05:42,080
control that especially in a production

158
00:05:42,080 --> 00:05:44,639
standpoint

159
00:05:44,720 --> 00:05:46,400
also how you access the cloud

160
00:05:46,400 --> 00:05:48,960
infrastructure has changed we still have

161
00:05:48,960 --> 00:05:52,240
things like secure shell and rdp but now

162
00:05:52,240 --> 00:05:55,039
in aws for example you have aws access

163
00:05:55,039 --> 00:05:56,560
keys which give you access from the

164
00:05:56,560 --> 00:05:58,880
command line interface so developers

165
00:05:58,880 --> 00:06:01,440
administrators tend to use that for

166
00:06:01,440 --> 00:06:04,000
managing and doing things within the aws

167
00:06:04,000 --> 00:06:06,000
environment

168
00:06:06,000 --> 00:06:08,319
and then as you start to think about the

169
00:06:08,319 --> 00:06:10,240
risks and the cyber kill chain the

170
00:06:10,240 --> 00:06:12,240
lateral movement privilege escalation

171
00:06:12,240 --> 00:06:14,479
exfiltration all of these things

172
00:06:14,479 --> 00:06:16,560
starting to understand of all of these

173
00:06:16,560 --> 00:06:18,560
different permissions and policies and

174
00:06:18,560 --> 00:06:19,360
more

175
00:06:19,360 --> 00:06:21,440
how do i really start to map those out

176
00:06:21,440 --> 00:06:23,520
from a cloud perspective versus how we

177
00:06:23,520 --> 00:06:25,199
traditionally look at it from a network

178
00:06:25,199 --> 00:06:27,759
perspective

179
00:06:30,800 --> 00:06:33,280
so what we've learned in doing over 100

180
00:06:33,280 --> 00:06:34,800
risk assessments in the cloud for

181
00:06:34,800 --> 00:06:36,639
various organizations is that there are

182
00:06:36,639 --> 00:06:38,319
tens of thousands of permissions in the

183
00:06:38,319 --> 00:06:41,360
cloud aws by default if you don't modify

184
00:06:41,360 --> 00:06:43,440
it for a user you're giving that user

185
00:06:43,440 --> 00:06:45,440
over 10 000 permissions

186
00:06:45,440 --> 00:06:47,680
same thing for azure as well over ten

187
00:06:47,680 --> 00:06:50,800
thousand permissions and also for gcp

188
00:06:50,800 --> 00:06:54,319
thousands and thousands of permissions

189
00:06:54,319 --> 00:06:57,120
and again unless these are restricted

190
00:06:57,120 --> 00:06:59,599
the uh you know the probability that a

191
00:06:59,599 --> 00:07:01,599
user is going to have admin type

192
00:07:01,599 --> 00:07:03,199
permissions where they could use that to

193
00:07:03,199 --> 00:07:05,360
destroy the infrastructure

194
00:07:05,360 --> 00:07:07,199
you're accidentally you know giving them

195
00:07:07,199 --> 00:07:09,440
a lot of those permissions and roughly

196
00:07:09,440 --> 00:07:11,759
50 of those permissions allow that

197
00:07:11,759 --> 00:07:14,080
capability whether you realize it or not

198
00:07:14,080 --> 00:07:17,599
and and furthermore you know since we

199
00:07:17,599 --> 00:07:19,360
look at each and every identity in the

200
00:07:19,360 --> 00:07:21,840
cloud we find out that that on average

201
00:07:21,840 --> 00:07:24,240
95 of the identities in the cloud have

202
00:07:24,240 --> 00:07:26,400
these permissions yet the majority of

203
00:07:26,400 --> 00:07:28,160
them don't need it nor should they have

204
00:07:28,160 --> 00:07:29,520
it

205
00:07:29,520 --> 00:07:32,880
and what's really alarming is that

206
00:07:32,880 --> 00:07:34,560
you know what we've talked about up into

207
00:07:34,560 --> 00:07:36,240
this moment is really permissions that

208
00:07:36,240 --> 00:07:37,919
have been assigned but what are

209
00:07:37,919 --> 00:07:39,520
permissions that our people are actually

210
00:07:39,520 --> 00:07:41,520
using what does their activity really

211
00:07:41,520 --> 00:07:44,160
expose well their activity exposes that

212
00:07:44,160 --> 00:07:46,000
they're using less than one percent of

213
00:07:46,000 --> 00:07:48,240
the permissions assigned so clearly

214
00:07:48,240 --> 00:07:50,479
there's a huge leased privileges problem

215
00:07:50,479 --> 00:07:52,160
and there's a huge issue with over

216
00:07:52,160 --> 00:07:56,160
permissioned access in the cloud

217
00:07:57,120 --> 00:07:58,800
the cloud security alliance did an

218
00:07:58,800 --> 00:07:59,759
awesome

219
00:07:59,759 --> 00:08:02,000
research paper around 11 prominent

220
00:08:02,000 --> 00:08:04,400
breaches most of these organizations are

221
00:08:04,400 --> 00:08:06,240
household names not for only us in the

222
00:08:06,240 --> 00:08:08,639
cyber security space but just even to

223
00:08:08,639 --> 00:08:10,400
your mom dad and other people that you

224
00:08:10,400 --> 00:08:11,680
know

225
00:08:11,680 --> 00:08:13,759
and one of the systemic threads across

226
00:08:13,759 --> 00:08:15,840
all of this was really over permissioned

227
00:08:15,840 --> 00:08:16,879
access

228
00:08:16,879 --> 00:08:19,199
and really you know

229
00:08:19,199 --> 00:08:21,599
really exposes the fact that least

230
00:08:21,599 --> 00:08:23,520
privileges are more important than ever

231
00:08:23,520 --> 00:08:25,199
because across all these different

232
00:08:25,199 --> 00:08:28,000
breaches was a lot of permissions that

233
00:08:28,000 --> 00:08:30,560
the user or service account had never

234
00:08:30,560 --> 00:08:33,039
used yet were used by the attacker for

235
00:08:33,039 --> 00:08:36,080
performing the breach

236
00:08:37,360 --> 00:08:39,120
there are some really powerful commands

237
00:08:39,120 --> 00:08:40,479
within the cloud

238
00:08:40,479 --> 00:08:42,799
a single line or script can definitely

239
00:08:42,799 --> 00:08:44,640
destroy a portion of if not all of your

240
00:08:44,640 --> 00:08:47,600
cloud infrastructure

241
00:08:48,320 --> 00:08:50,880
so as we start to map this out to a

242
00:08:50,880 --> 00:08:53,120
cyber kill chain but now in the context

243
00:08:53,120 --> 00:08:54,720
of cloud infrastructure

244
00:08:54,720 --> 00:08:56,480
we can take all of those things that

245
00:08:56,480 --> 00:08:58,320
we've mapped out traditionally in terms

246
00:08:58,320 --> 00:09:01,040
of reconnaissance infiltration privilege

247
00:09:01,040 --> 00:09:02,720
escalation lateral movement and

248
00:09:02,720 --> 00:09:04,800
exfiltration then now look at it through

249
00:09:04,800 --> 00:09:07,200
the lens of the cloud

250
00:09:07,200 --> 00:09:09,040
a lot of organizations have shored up

251
00:09:09,040 --> 00:09:11,200
their security in terms of the perimeter

252
00:09:11,200 --> 00:09:13,519
so there's a lot of different you know

253
00:09:13,519 --> 00:09:16,000
virtualized perimeter type products out

254
00:09:16,000 --> 00:09:18,240
there that help you identify what may be

255
00:09:18,240 --> 00:09:21,120
exposed to the outside world

256
00:09:21,120 --> 00:09:23,120
but in terms of the permissions and you

257
00:09:23,120 --> 00:09:24,800
start to take a look at these toxic

258
00:09:24,800 --> 00:09:26,160
combinations

259
00:09:26,160 --> 00:09:27,839
if they've got tens of thousands of

260
00:09:27,839 --> 00:09:29,040
permissions

261
00:09:29,040 --> 00:09:30,880
and someone's able to initially

262
00:09:30,880 --> 00:09:33,120
penetrate my cloud infrastructure even

263
00:09:33,120 --> 00:09:35,200
as a normal user are they going to have

264
00:09:35,200 --> 00:09:37,120
a lot of excessive permissions that they

265
00:09:37,120 --> 00:09:39,839
can exploit that that normal user never

266
00:09:39,839 --> 00:09:41,920
actually uses and the short answer is

267
00:09:41,920 --> 00:09:45,920
yes and that leads to many other things

268
00:09:45,920 --> 00:09:47,519
within the cloud you also have this

269
00:09:47,519 --> 00:09:48,959
concept of role chaining or

270
00:09:48,959 --> 00:09:51,200
cross-account access you may have

271
00:09:51,200 --> 00:09:53,519
multiple subscriptions or accounts or

272
00:09:53,519 --> 00:09:56,160
projects in the cloud and cross-account

273
00:09:56,160 --> 00:09:58,959
access for example in aws allows you to

274
00:09:58,959 --> 00:10:01,519
set up roles and policies that such as

275
00:10:01,519 --> 00:10:04,079
the sts assume role to allow you to

276
00:10:04,079 --> 00:10:06,480
actually jump from account to account or

277
00:10:06,480 --> 00:10:08,560
subscription to subscription and move

278
00:10:08,560 --> 00:10:10,720
around in this cloud infrastructure and

279
00:10:10,720 --> 00:10:13,600
as you might expect if misconfigured can

280
00:10:13,600 --> 00:10:16,399
allow also an attacker to move around

281
00:10:16,399 --> 00:10:17,839
and not only perform privilege

282
00:10:17,839 --> 00:10:20,640
escalation but lateral movement

283
00:10:20,640 --> 00:10:22,399
and this really starts to kind of bring

284
00:10:22,399 --> 00:10:24,320
out the fact that role-based access

285
00:10:24,320 --> 00:10:26,160
control how we traditionally approach

286
00:10:26,160 --> 00:10:28,399
this is really kind of becoming old

287
00:10:28,399 --> 00:10:29,839
school because it's really kind of based

288
00:10:29,839 --> 00:10:31,519
on assumptions and you really need to

289
00:10:31,519 --> 00:10:33,120
look more and more at the activity of

290
00:10:33,120 --> 00:10:35,120
what's going on in the cloud to really

291
00:10:35,120 --> 00:10:36,880
bring that second ingredient to the

292
00:10:36,880 --> 00:10:39,680
table to better understand gee i've got

293
00:10:39,680 --> 00:10:41,519
a lot of over permissioned folks in the

294
00:10:41,519 --> 00:10:45,120
cloud i need to really prune this back

295
00:10:45,120 --> 00:10:48,480
and remember the ability for read only

296
00:10:48,480 --> 00:10:50,880
in the cloud read only to storage that

297
00:10:50,880 --> 00:10:53,200
alone can allow exfiltration right so

298
00:10:53,200 --> 00:10:54,959
even read-only access can be quite

299
00:10:54,959 --> 00:10:57,959
dangerous

300
00:11:00,000 --> 00:11:01,920
so if we start to break down some recent

301
00:11:01,920 --> 00:11:03,600
breaches and then we'll start to kind of

302
00:11:03,600 --> 00:11:06,240
dive deeper and deeper into this

303
00:11:06,240 --> 00:11:07,839
you know there was one really prominent

304
00:11:07,839 --> 00:11:09,839
breach with a financial services

305
00:11:09,839 --> 00:11:11,680
institution that once their web

306
00:11:11,680 --> 00:11:14,399
application firewall was breached via

307
00:11:14,399 --> 00:11:17,519
server-side request forgery once access

308
00:11:17,519 --> 00:11:20,320
to that i am role was obtained allowed

309
00:11:20,320 --> 00:11:22,640
the attacker to start to exploit the

310
00:11:22,640 --> 00:11:24,720
over-permissioned access all those toxic

311
00:11:24,720 --> 00:11:26,640
combinations of permissions and we'll

312
00:11:26,640 --> 00:11:28,160
break down those permissions for you a

313
00:11:28,160 --> 00:11:29,600
little bit later in the presentation

314
00:11:29,600 --> 00:11:31,120
that at a high level

315
00:11:31,120 --> 00:11:34,640
allowed the attacker to uncover and map

316
00:11:34,640 --> 00:11:37,680
out over 700 other s3 buckets that were

317
00:11:37,680 --> 00:11:39,680
in the environment that had never been

318
00:11:39,680 --> 00:11:42,640
used before by that particular role

319
00:11:42,640 --> 00:11:44,480
and furthermore

320
00:11:44,480 --> 00:11:46,560
with that read-only access determined

321
00:11:46,560 --> 00:11:49,279
that one of those s3 buckets contained

322
00:11:49,279 --> 00:11:51,360
more than 100 million customer records

323
00:11:51,360 --> 00:11:53,120
and with that read-only access allowed

324
00:11:53,120 --> 00:11:57,639
that attacker to download those records

325
00:12:00,720 --> 00:12:02,639
if we start to kind of dive deeper into

326
00:12:02,639 --> 00:12:04,639
this what is the cause for this well a

327
00:12:04,639 --> 00:12:06,800
lot of it stems initially from default

328
00:12:06,800 --> 00:12:08,959
policies so you may have your json

329
00:12:08,959 --> 00:12:11,120
policy here with things like resource

330
00:12:11,120 --> 00:12:13,200
star and these different permissions

331
00:12:13,200 --> 00:12:14,959
that are actually allowing broad or

332
00:12:14,959 --> 00:12:19,518
administrator access in the environment

333
00:12:20,160 --> 00:12:22,399
but by looking at activity we can better

334
00:12:22,399 --> 00:12:24,959
distinguish for example what permissions

335
00:12:24,959 --> 00:12:26,639
have been assigned versus what's being

336
00:12:26,639 --> 00:12:28,800
used this starts to help us uncover a

337
00:12:28,800 --> 00:12:30,959
lot of these unnecessary permissions

338
00:12:30,959 --> 00:12:34,719
being assigned to everybody in the cloud

339
00:12:36,079 --> 00:12:37,920
if we dive deeper into this and we take

340
00:12:37,920 --> 00:12:40,959
a look at this now from aws access keys

341
00:12:40,959 --> 00:12:42,480
for example

342
00:12:42,480 --> 00:12:44,480
in this particular example this was a

343
00:12:44,480 --> 00:12:46,079
prominent security vendor i won't

344
00:12:46,079 --> 00:12:49,200
mention the vendor by name but

345
00:12:49,200 --> 00:12:51,519
one of the developers had

346
00:12:51,519 --> 00:12:54,720
actually developed code embedded the aws

347
00:12:54,720 --> 00:12:56,079
access keys

348
00:12:56,079 --> 00:12:59,279
in that code and had posted it to github

349
00:12:59,279 --> 00:13:00,959
and an attacker had found that these

350
00:13:00,959 --> 00:13:02,800
were sitting out there and furthermore

351
00:13:02,800 --> 00:13:04,639
uncovered that

352
00:13:04,639 --> 00:13:07,040
a developer had actually made a backup

353
00:13:07,040 --> 00:13:10,240
of the rds database or snapshot and used

354
00:13:10,240 --> 00:13:13,680
those api or aws access keys to then

355
00:13:13,680 --> 00:13:15,920
access that backup snapshot which

356
00:13:15,920 --> 00:13:18,000
actually uncovered user accounts

357
00:13:18,000 --> 00:13:20,880
password hashes and um being a longtime

358
00:13:20,880 --> 00:13:23,279
employee of verisign way back i would

359
00:13:23,279 --> 00:13:24,800
argue even the bigger issue being

360
00:13:24,800 --> 00:13:26,560
exposing the certificates and their

361
00:13:26,560 --> 00:13:28,800
private keys for every one of those web

362
00:13:28,800 --> 00:13:31,200
application firewalls around the world

363
00:13:31,200 --> 00:13:32,079
so

364
00:13:32,079 --> 00:13:35,440
at the end of the day more than 13 000

365
00:13:35,440 --> 00:13:37,920
uh customer certs private keys and the

366
00:13:37,920 --> 00:13:42,000
password hashes were exposed

367
00:13:45,199 --> 00:13:48,639
and aws you know and amazon in general

368
00:13:48,639 --> 00:13:50,800
you know recommends as part of their

369
00:13:50,800 --> 00:13:52,560
well architected framework that these

370
00:13:52,560 --> 00:13:55,199
keys be rotated every 90 days but when

371
00:13:55,199 --> 00:13:56,639
we do our risk assessments for

372
00:13:56,639 --> 00:13:58,720
organizations we find many times these

373
00:13:58,720 --> 00:14:00,880
keys are not being rotated one of the

374
00:14:00,880 --> 00:14:02,880
key reasons for that is they end up

375
00:14:02,880 --> 00:14:04,639
creating keys for everybody in the

376
00:14:04,639 --> 00:14:06,399
environment but some of the people are

377
00:14:06,399 --> 00:14:08,160
not even using them and so those keys

378
00:14:08,160 --> 00:14:10,880
sit out there forever and unused

379
00:14:10,880 --> 00:14:12,959
so this isn't a silver bullet i mean if

380
00:14:12,959 --> 00:14:15,279
you you know rotate access keys it

381
00:14:15,279 --> 00:14:17,279
doesn't prevent you know developers from

382
00:14:17,279 --> 00:14:18,880
from posting them out you know on the

383
00:14:18,880 --> 00:14:21,600
web accidentally embedded within code

384
00:14:21,600 --> 00:14:23,680
but you know although it's not a silver

385
00:14:23,680 --> 00:14:26,160
bullet um it is you know kind of one of

386
00:14:26,160 --> 00:14:28,399
the pieces of the security hygiene so

387
00:14:28,399 --> 00:14:30,240
ideally if you're rotating these keys

388
00:14:30,240 --> 00:14:32,240
every 90 days maybe by the time a

389
00:14:32,240 --> 00:14:33,920
developer posts it and someone else

390
00:14:33,920 --> 00:14:35,760
discovers it's sitting out there you've

391
00:14:35,760 --> 00:14:37,760
already rotated the key and maybe that

392
00:14:37,760 --> 00:14:39,920
old key is unusable so it's just one of

393
00:14:39,920 --> 00:14:41,680
many things and we'll talk more about

394
00:14:41,680 --> 00:14:43,760
other things you can do for mitigating

395
00:14:43,760 --> 00:14:47,360
these risks in the environment

396
00:14:47,839 --> 00:14:50,000
all right i'm a big believer left-hand

397
00:14:50,000 --> 00:14:52,880
farmer in really getting to the heart of

398
00:14:52,880 --> 00:14:55,120
the matter and really providing some

399
00:14:55,120 --> 00:14:57,920
real world examples we said that there's

400
00:14:57,920 --> 00:15:01,120
10 000 permissions plus you know within

401
00:15:01,120 --> 00:15:05,519
aws but what are a few examples of that

402
00:15:05,519 --> 00:15:07,199
so one of those um

403
00:15:07,199 --> 00:15:09,680
is how you define your virtual firewall

404
00:15:09,680 --> 00:15:11,680
policies something called a security

405
00:15:11,680 --> 00:15:13,760
group within aws

406
00:15:13,760 --> 00:15:16,880
and if you give a user um all 10 000

407
00:15:16,880 --> 00:15:19,519
permissions which we frequently find um

408
00:15:19,519 --> 00:15:21,920
they have access to this uh permission

409
00:15:21,920 --> 00:15:24,320
which is authorized group ingress

410
00:15:24,320 --> 00:15:26,560
security group ingress for ec2

411
00:15:26,560 --> 00:15:28,399
meaning they can change the firewall

412
00:15:28,399 --> 00:15:31,360
policy for your vm

413
00:15:31,360 --> 00:15:32,959
so think about this for a minute in an

414
00:15:32,959 --> 00:15:34,639
old school perspective would you ever

415
00:15:34,639 --> 00:15:36,639
give an average user or a developer the

416
00:15:36,639 --> 00:15:38,639
ability to change firewall rules

417
00:15:38,639 --> 00:15:41,120
obviously not right but by giving this

418
00:15:41,120 --> 00:15:43,440
default permission to every user that's

419
00:15:43,440 --> 00:15:46,720
effectively what you're doing

420
00:15:47,040 --> 00:15:48,639
also if you start to think about this

421
00:15:48,639 --> 00:15:50,320
from an insider threat

422
00:15:50,320 --> 00:15:52,480
another dangerous permission is iem

423
00:15:52,480 --> 00:15:55,199
create user this allows a user to create

424
00:15:55,199 --> 00:15:56,880
another user id

425
00:15:56,880 --> 00:15:59,199
it may be for another developer or it

426
00:15:59,199 --> 00:16:01,360
may be a dummy account used for insider

427
00:16:01,360 --> 00:16:02,720
threat

428
00:16:02,720 --> 00:16:04,560
so when giving out this permission

429
00:16:04,560 --> 00:16:06,880
you're inadvertently giving all users

430
00:16:06,880 --> 00:16:08,639
the ability to create other user

431
00:16:08,639 --> 00:16:10,639
accounts so from an administrative

432
00:16:10,639 --> 00:16:12,720
standpoint would you ever consider that

433
00:16:12,720 --> 00:16:14,399
in a normal environment

434
00:16:14,399 --> 00:16:16,399
obviously not right there's a reason

435
00:16:16,399 --> 00:16:18,399
there's administrators right but

436
00:16:18,399 --> 00:16:19,759
effectively you're giving that

437
00:16:19,759 --> 00:16:21,680
permission you know in that ability by

438
00:16:21,680 --> 00:16:24,800
giving them that permission

439
00:16:24,880 --> 00:16:26,800
we also talked about role changing

440
00:16:26,800 --> 00:16:28,399
across account access and this is

441
00:16:28,399 --> 00:16:30,720
related to the update assume rule policy

442
00:16:30,720 --> 00:16:33,600
and the sts assume rule

443
00:16:33,600 --> 00:16:35,600
by giving out this permission you can

444
00:16:35,600 --> 00:16:37,519
allow developers and other people to

445
00:16:37,519 --> 00:16:39,920
change how people can move around from

446
00:16:39,920 --> 00:16:41,759
account to account or subscription to

447
00:16:41,759 --> 00:16:43,839
subscription also quite dangerous

448
00:16:43,839 --> 00:16:45,759
especially if they're going from a

449
00:16:45,759 --> 00:16:48,160
development account to a production

450
00:16:48,160 --> 00:16:49,199
account

451
00:16:49,199 --> 00:16:51,120
so this can also be quite dangerous and

452
00:16:51,120 --> 00:16:54,000
then furthermore the iem put user policy

453
00:16:54,000 --> 00:16:56,480
allows them to modify policies to change

454
00:16:56,480 --> 00:16:59,279
access to resources and other things so

455
00:16:59,279 --> 00:17:01,360
again just four of these 10 000

456
00:17:01,360 --> 00:17:04,360
permissions

457
00:17:05,439 --> 00:17:08,880
what about gcp well there are similar um

458
00:17:08,880 --> 00:17:11,520
policies and permissions and tasks you

459
00:17:11,520 --> 00:17:14,480
know within gcp or google cloud so i've

460
00:17:14,480 --> 00:17:16,240
mapped these out for you as well i won't

461
00:17:16,240 --> 00:17:18,559
go through them in detail but by virtue

462
00:17:18,559 --> 00:17:20,079
of the presentation

463
00:17:20,079 --> 00:17:21,839
and probably the recording you know you

464
00:17:21,839 --> 00:17:23,520
can always go back and review these but

465
00:17:23,520 --> 00:17:25,679
again in terms of external access

466
00:17:25,679 --> 00:17:27,359
insider threat lateral movement and

467
00:17:27,359 --> 00:17:29,120
privilege escalation that map these out

468
00:17:29,120 --> 00:17:30,880
for you as well if you have a google

469
00:17:30,880 --> 00:17:33,280
cloud environment

470
00:17:33,280 --> 00:17:34,960
so what about azure

471
00:17:34,960 --> 00:17:37,679
so within azure um we're all you know

472
00:17:37,679 --> 00:17:39,840
familiar with the the solarwinds breach

473
00:17:39,840 --> 00:17:41,360
and one of the things that came out of

474
00:17:41,360 --> 00:17:43,679
that was a lot of customers coming to us

475
00:17:43,679 --> 00:17:45,280
you know as part of our risk assessment

476
00:17:45,280 --> 00:17:47,200
saying hey i want to make sure i'm not

477
00:17:47,200 --> 00:17:49,520
exposed within azure as well and

478
00:17:49,520 --> 00:17:51,360
microsoft you know had a really great

479
00:17:51,360 --> 00:17:53,760
article cve and everything around this

480
00:17:53,760 --> 00:17:56,160
around tracking and monitoring role

481
00:17:56,160 --> 00:17:58,320
assignments right and ability for people

482
00:17:58,320 --> 00:18:01,280
to change role assignments so that's a

483
00:18:01,280 --> 00:18:03,039
really important permission we consider

484
00:18:03,039 --> 00:18:04,799
within azure that you should at least

485
00:18:04,799 --> 00:18:06,400
monitor you know whether you've got some

486
00:18:06,400 --> 00:18:08,720
kind of ids logs however you're

487
00:18:08,720 --> 00:18:10,720
monitoring that with your sim really

488
00:18:10,720 --> 00:18:12,000
really important amount of that you're

489
00:18:12,000 --> 00:18:13,360
going to have people that are normally

490
00:18:13,360 --> 00:18:16,080
using this on a regular basis but

491
00:18:16,080 --> 00:18:17,919
tracking that and having an audit trail

492
00:18:17,919 --> 00:18:19,840
of that is super important we'll talk

493
00:18:19,840 --> 00:18:23,280
more about audit trails later

494
00:18:24,080 --> 00:18:25,760
and then preventing it

495
00:18:25,760 --> 00:18:27,600
get to least privileges for each and

496
00:18:27,600 --> 00:18:29,760
every one of your users review what

497
00:18:29,760 --> 00:18:31,360
permissions are being used based on

498
00:18:31,360 --> 00:18:33,840
their activity and use that to get do

499
00:18:33,840 --> 00:18:35,200
away with all the permissions they've

500
00:18:35,200 --> 00:18:36,400
never used

501
00:18:36,400 --> 00:18:38,160
most of these cloud infrastructure

502
00:18:38,160 --> 00:18:40,559
environments provide privilege on demand

503
00:18:40,559 --> 00:18:42,320
permissions on demand just in time

504
00:18:42,320 --> 00:18:44,480
access so if you remove a permission

505
00:18:44,480 --> 00:18:46,240
that someone uses once a year and they

506
00:18:46,240 --> 00:18:48,799
suddenly need it that's exactly why just

507
00:18:48,799 --> 00:18:50,400
in time permissions

508
00:18:50,400 --> 00:18:52,799
exist allow them to go ahead and request

509
00:18:52,799 --> 00:18:55,280
that permission and it gets added but

510
00:18:55,280 --> 00:18:57,360
you know it is a balancing act but does

511
00:18:57,360 --> 00:18:59,520
it make sense to leave those other 9000

512
00:18:59,520 --> 00:19:01,440
permissions they've never used including

513
00:19:01,440 --> 00:19:03,679
admin permissions sitting out there

514
00:19:03,679 --> 00:19:05,440
probably not right so you have to kind

515
00:19:05,440 --> 00:19:07,360
of weigh the cost of you know getting to

516
00:19:07,360 --> 00:19:09,120
least privileges versus removing that

517
00:19:09,120 --> 00:19:10,720
one permission they might use once a

518
00:19:10,720 --> 00:19:12,880
year

519
00:19:13,679 --> 00:19:15,280
all right so bringing this back to the

520
00:19:15,280 --> 00:19:16,799
cyber kill chain

521
00:19:16,799 --> 00:19:19,200
we talked about aspects of infiltration

522
00:19:19,200 --> 00:19:21,039
privilege escalation lateral movement

523
00:19:21,039 --> 00:19:23,919
and exfiltration and discussed under

524
00:19:23,919 --> 00:19:25,440
each and every one of these some

525
00:19:25,440 --> 00:19:28,400
examples of that

526
00:19:32,400 --> 00:19:34,160
we also kind of gathered some key

527
00:19:34,160 --> 00:19:36,080
metrics across these three

528
00:19:36,080 --> 00:19:37,919
key platforms to kind of bring out where

529
00:19:37,919 --> 00:19:41,039
we find the most prominent risks

530
00:19:41,039 --> 00:19:44,480
so within aws we find that more than 65

531
00:19:44,480 --> 00:19:47,039
percent of all enterprises have an ec2

532
00:19:47,039 --> 00:19:50,000
instance or more with access to all s3

533
00:19:50,000 --> 00:19:51,679
buckets whereas that ideally should

534
00:19:51,679 --> 00:19:54,320
probably be a lot more restricted for

535
00:19:54,320 --> 00:19:56,720
the the actual access do we want

536
00:19:56,720 --> 00:19:58,160
somebody to gain access to the

537
00:19:58,160 --> 00:20:00,240
environment by accident have access to

538
00:20:00,240 --> 00:20:03,760
all s3 buckets or narrow that by really

539
00:20:03,760 --> 00:20:06,159
restricting that broad access to what is

540
00:20:06,159 --> 00:20:08,159
really ideally need needed for that

541
00:20:08,159 --> 00:20:10,080
particular vm in that particular

542
00:20:10,080 --> 00:20:13,120
workload and environment

543
00:20:13,120 --> 00:20:14,960
in addition more than 50 percent of the

544
00:20:14,960 --> 00:20:16,559
enterprises have identities with

545
00:20:16,559 --> 00:20:19,120
privilege escalation so we talked about

546
00:20:19,120 --> 00:20:20,880
briefly privilege escalation but they

547
00:20:20,880 --> 00:20:23,200
have those super admin permissions and

548
00:20:23,200 --> 00:20:24,320
roles

549
00:20:24,320 --> 00:20:26,960
and again you know usually the number of

550
00:20:26,960 --> 00:20:28,720
administrators compared to developers

551
00:20:28,720 --> 00:20:30,400
and everybody else is usually less than

552
00:20:30,400 --> 00:20:33,039
one or two percent so should 50 of the

553
00:20:33,039 --> 00:20:34,400
people in the environment have those

554
00:20:34,400 --> 00:20:38,320
admin permissions probably not

555
00:20:39,280 --> 00:20:41,919
within azure um we find more than 85

556
00:20:41,919 --> 00:20:43,600
percent of enterprises have over

557
00:20:43,600 --> 00:20:46,000
permissive users and service principals

558
00:20:46,000 --> 00:20:47,520
a lot of this stuff's actually been

559
00:20:47,520 --> 00:20:50,159
orphaned and left behind after a project

560
00:20:50,159 --> 00:20:51,840
so a lot of this stuff isn't even being

561
00:20:51,840 --> 00:20:54,400
used anymore so again looking at the

562
00:20:54,400 --> 00:20:56,880
activity will help you identify these

563
00:20:56,880 --> 00:20:58,960
leftover service principles roles and

564
00:20:58,960 --> 00:21:00,400
more across all these cloud

565
00:21:00,400 --> 00:21:02,799
infrastructures to say gee a lot of this

566
00:21:02,799 --> 00:21:04,400
stuff is old it hasn't been touched in a

567
00:21:04,400 --> 00:21:05,919
year or two let's go ahead and

568
00:21:05,919 --> 00:21:08,640
decommission it

569
00:21:09,200 --> 00:21:10,960
and then more than 70 percent of the

570
00:21:10,960 --> 00:21:13,120
subscriptions have identities both users

571
00:21:13,120 --> 00:21:14,640
and service principles with over

572
00:21:14,640 --> 00:21:17,200
permissive contributor roles remember

573
00:21:17,200 --> 00:21:19,120
identities with a contributor role can

574
00:21:19,120 --> 00:21:21,200
significantly increase the risk because

575
00:21:21,200 --> 00:21:23,760
they have the ability to delete delete

576
00:21:23,760 --> 00:21:25,760
critical infrastructure so again you

577
00:21:25,760 --> 00:21:26,799
want to be careful with those

578
00:21:26,799 --> 00:21:28,400
contributor roles and we find them

579
00:21:28,400 --> 00:21:30,960
excessively used overly used

580
00:21:30,960 --> 00:21:31,919
yet

581
00:21:31,919 --> 00:21:34,159
or over-permissioned but under-used

582
00:21:34,159 --> 00:21:37,360
within a lot of these environments

583
00:21:37,360 --> 00:21:39,200
and then in google cloud we find more

584
00:21:39,200 --> 00:21:41,440
than 85 percent have user-managed keys

585
00:21:41,440 --> 00:21:42,960
for service accounts that are not

586
00:21:42,960 --> 00:21:44,880
rotated we talked about that in the

587
00:21:44,880 --> 00:21:47,280
context of an aws environment and more

588
00:21:47,280 --> 00:21:49,520
than 80 have service accounts with over

589
00:21:49,520 --> 00:21:51,840
permissive owner or editor roles uh

590
00:21:51,840 --> 00:21:53,679
either directly attached or inherited

591
00:21:53,679 --> 00:21:56,559
from a folder or organization so again

592
00:21:56,559 --> 00:22:00,320
just speaks to the least privileges

593
00:22:00,400 --> 00:22:02,000
all right so the other half of the

594
00:22:02,000 --> 00:22:04,240
presentation how do i fix all of this

595
00:22:04,240 --> 00:22:05,840
stuff

596
00:22:05,840 --> 00:22:07,679
it's really really difficult to do this

597
00:22:07,679 --> 00:22:09,440
manually when you have tens of thousands

598
00:22:09,440 --> 00:22:11,360
of permissions and and

599
00:22:11,360 --> 00:22:12,880
when you start to think about this if

600
00:22:12,880 --> 00:22:15,200
you're multi-cloud or hybrid cloud now

601
00:22:15,200 --> 00:22:18,480
your problem goes up exponentially

602
00:22:18,480 --> 00:22:20,880
how you perform this and the experience

603
00:22:20,880 --> 00:22:22,559
behind it really requires a good

604
00:22:22,559 --> 00:22:24,720
understanding of the authorization model

605
00:22:24,720 --> 00:22:26,720
for each cloud infrastructure

606
00:22:26,720 --> 00:22:28,240
do you have different teams that manage

607
00:22:28,240 --> 00:22:30,240
different cloud infrastructures most

608
00:22:30,240 --> 00:22:33,039
likely right so how this is done may be

609
00:22:33,039 --> 00:22:34,799
done by different teams but it needs to

610
00:22:34,799 --> 00:22:38,640
be done in a cohesive way

611
00:22:38,640 --> 00:22:40,880
and it does require deep visibility

612
00:22:40,880 --> 00:22:42,320
right we're not just looking at what

613
00:22:42,320 --> 00:22:44,320
permissions have been assigned but in

614
00:22:44,320 --> 00:22:46,080
identifying not only those toxic

615
00:22:46,080 --> 00:22:48,000
combinations of permissions what

616
00:22:48,000 --> 00:22:49,679
permissions are people actually using

617
00:22:49,679 --> 00:22:51,520
based on the activity

618
00:22:51,520 --> 00:22:53,200
so really a lot of this can be pretty

619
00:22:53,200 --> 00:22:54,640
daunting but there's a lot of tools and

620
00:22:54,640 --> 00:22:57,600
approaches that you can use

621
00:22:57,600 --> 00:23:00,080
within aws you've got cloudtrail access

622
00:23:00,080 --> 00:23:02,000
analyzer access and advisor some people

623
00:23:02,000 --> 00:23:03,840
using cloudwatch

624
00:23:03,840 --> 00:23:05,679
within azure they've kind of merged

625
00:23:05,679 --> 00:23:07,760
together microsoft graph and azure graph

626
00:23:07,760 --> 00:23:09,280
and security center is actually pretty

627
00:23:09,280 --> 00:23:11,679
awesome now and then within gcp you have

628
00:23:11,679 --> 00:23:14,000
a variety of google cloud logs

629
00:23:14,000 --> 00:23:15,679
there's a lot of different products both

630
00:23:15,679 --> 00:23:17,760
commercial and open source

631
00:23:17,760 --> 00:23:20,240
that are out there to help you analyze

632
00:23:20,240 --> 00:23:22,000
these logs because they can be quite

633
00:23:22,000 --> 00:23:24,000
extensive you could have easily have

634
00:23:24,000 --> 00:23:27,919
millions of entries on a daily basis

635
00:23:28,400 --> 00:23:30,799
so how do i analyze these logs let's

636
00:23:30,799 --> 00:23:33,760
dive into the next rock layer here

637
00:23:33,760 --> 00:23:37,039
within aws you can kind of log into

638
00:23:37,039 --> 00:23:39,679
the cloud portal and in doing so you can

639
00:23:39,679 --> 00:23:42,240
view each event within the history but

640
00:23:42,240 --> 00:23:43,679
again if you've got a million events

641
00:23:43,679 --> 00:23:45,600
you'll never make it through in one day

642
00:23:45,600 --> 00:23:46,640
right

643
00:23:46,640 --> 00:23:47,440
so

644
00:23:47,440 --> 00:23:50,080
if you download the json for example you

645
00:23:50,080 --> 00:23:51,679
can start to kind of comb through this

646
00:23:51,679 --> 00:23:53,760
data and leverage some of these open

647
00:23:53,760 --> 00:23:55,279
source tools or some of your own

648
00:23:55,279 --> 00:23:57,279
automation to kind of go through these

649
00:23:57,279 --> 00:23:59,200
but let's break down what are some of

650
00:23:59,200 --> 00:24:01,279
the elements within

651
00:24:01,279 --> 00:24:04,960
for example one of these events

652
00:24:04,960 --> 00:24:07,279
in this first example we have one where

653
00:24:07,279 --> 00:24:10,640
it lists out the a um the access key id

654
00:24:10,640 --> 00:24:12,720
so this is revealing the authentication

655
00:24:12,720 --> 00:24:15,279
method which means it's using aws access

656
00:24:15,279 --> 00:24:17,520
keys not the username and password

657
00:24:17,520 --> 00:24:19,520
credentials like you would within the

658
00:24:19,520 --> 00:24:21,120
web portal

659
00:24:21,120 --> 00:24:23,039
uh in addition keep in mind that by

660
00:24:23,039 --> 00:24:24,480
default there's no multi-factor

661
00:24:24,480 --> 00:24:26,400
authentication with access keys that's

662
00:24:26,400 --> 00:24:28,320
why hackers love to attack using this

663
00:24:28,320 --> 00:24:31,600
method so maintaining rotating these

664
00:24:31,600 --> 00:24:33,360
keeping tight control around these

665
00:24:33,360 --> 00:24:35,200
access keys is just like how you

666
00:24:35,200 --> 00:24:39,039
probably handle secure shell today

667
00:24:39,520 --> 00:24:41,360
also you can see what activities being

668
00:24:41,360 --> 00:24:43,760
performed by the event name in this case

669
00:24:43,760 --> 00:24:46,240
list buckets so based on a role policy

670
00:24:46,240 --> 00:24:48,400
permissions in this case listing s3

671
00:24:48,400 --> 00:24:49,919
buckets for your storage in the

672
00:24:49,919 --> 00:24:52,000
environment and then furthermore the

673
00:24:52,000 --> 00:24:53,360
source id

674
00:24:53,360 --> 00:24:55,360
and the type of browser being used which

675
00:24:55,360 --> 00:24:57,200
are kind of traditional things that many

676
00:24:57,200 --> 00:24:59,039
of us may look at in other environments

677
00:24:59,039 --> 00:25:01,360
but again you know are key elements

678
00:25:01,360 --> 00:25:03,360
within one of these events that you may

679
00:25:03,360 --> 00:25:06,479
find within cloudtra

680
00:25:07,600 --> 00:25:10,240
this example is um

681
00:25:10,240 --> 00:25:11,840
one that

682
00:25:11,840 --> 00:25:14,720
instead implies that there's something

683
00:25:14,720 --> 00:25:17,279
nefarious going on in the environment

684
00:25:17,279 --> 00:25:19,360
here we have an event that looks similar

685
00:25:19,360 --> 00:25:21,520
but is a little different than the other

686
00:25:21,520 --> 00:25:23,600
in this case we have the same access key

687
00:25:23,600 --> 00:25:26,400
id the same aws access key and list

688
00:25:26,400 --> 00:25:28,080
buckets being performed but now it's

689
00:25:28,080 --> 00:25:29,760
coming from a different ip and a

690
00:25:29,760 --> 00:25:31,039
different browser

691
00:25:31,039 --> 00:25:32,559
and while although this is a really

692
00:25:32,559 --> 00:25:35,279
simple fundamental example it does start

693
00:25:35,279 --> 00:25:37,360
to send some light on how you look at

694
00:25:37,360 --> 00:25:39,360
this data and then furthermore how you

695
00:25:39,360 --> 00:25:43,000
can identify anomalies

696
00:25:45,039 --> 00:25:48,799
um aws authored a really cool um

697
00:25:48,799 --> 00:25:50,640
pre-provisioning tool kind of creating a

698
00:25:50,640 --> 00:25:52,960
clean room almost like you would uh in

699
00:25:52,960 --> 00:25:54,640
forensics right so

700
00:25:54,640 --> 00:25:56,960
all of us have seen csi shows where

701
00:25:56,960 --> 00:25:58,559
there's a clean room they're all wearing

702
00:25:58,559 --> 00:26:00,720
like white clothing and everything as

703
00:26:00,720 --> 00:26:02,159
they take a look at evidence they've

704
00:26:02,159 --> 00:26:04,320
gathered from the field

705
00:26:04,320 --> 00:26:06,559
from a digital perspective right now

706
00:26:06,559 --> 00:26:08,640
many organizations and and law

707
00:26:08,640 --> 00:26:10,159
enforcement and others do this in terms

708
00:26:10,159 --> 00:26:11,840
of mobile devices and laptops and things

709
00:26:11,840 --> 00:26:14,159
like that and now in the cloud you can

710
00:26:14,159 --> 00:26:15,840
create um a clean room and there's

711
00:26:15,840 --> 00:26:17,520
templates sitting out there such as a

712
00:26:17,520 --> 00:26:19,360
cloud formation template that'll help

713
00:26:19,360 --> 00:26:21,520
you quickly create that and be prepared

714
00:26:21,520 --> 00:26:25,799
if you need to do forensics in the cloud

715
00:26:25,919 --> 00:26:27,760
the cloud security alliance authored a

716
00:26:27,760 --> 00:26:29,840
really cool paper surrounding this that

717
00:26:29,840 --> 00:26:31,200
gets into

718
00:26:31,200 --> 00:26:32,720
how you can

719
00:26:32,720 --> 00:26:34,799
fundamentally have a playbook around

720
00:26:34,799 --> 00:26:37,200
your cleanroom forensics

721
00:26:37,200 --> 00:26:39,600
and how you can take this along with a

722
00:26:39,600 --> 00:26:41,360
cloud formation template spin that up

723
00:26:41,360 --> 00:26:43,279
and actually perform this in an isolated

724
00:26:43,279 --> 00:26:45,760
environment

725
00:26:49,520 --> 00:26:51,600
as we jump a little bit over into azure

726
00:26:51,600 --> 00:26:52,720
more

727
00:26:52,720 --> 00:26:54,720
now within azure within the web

728
00:26:54,720 --> 00:26:56,480
interface you have the ability to go

729
00:26:56,480 --> 00:26:58,480
straight to the command line for bash or

730
00:26:58,480 --> 00:27:00,159
powershell making it really really

731
00:27:00,159 --> 00:27:02,720
convenient

732
00:27:02,720 --> 00:27:04,960
and here we can actually see what each

733
00:27:04,960 --> 00:27:07,520
of these two environments look like

734
00:27:07,520 --> 00:27:11,440
whether it be bash or powershell

735
00:27:12,240 --> 00:27:13,840
and a lot of organizations and

736
00:27:13,840 --> 00:27:15,440
administrators and developers and other

737
00:27:15,440 --> 00:27:17,440
people will use this but again be

738
00:27:17,440 --> 00:27:19,200
careful of some of the you know

739
00:27:19,200 --> 00:27:20,960
potential dangers here in terms of

740
00:27:20,960 --> 00:27:23,840
security hygiene

741
00:27:23,840 --> 00:27:27,279
in terms of um your azure cloud shell

742
00:27:27,279 --> 00:27:29,200
bash or powershell

743
00:27:29,200 --> 00:27:30,960
it can keep some files within your

744
00:27:30,960 --> 00:27:33,760
storage account within your subscription

745
00:27:33,760 --> 00:27:35,919
and if you make any kind of mistakes and

746
00:27:35,919 --> 00:27:37,760
you're using the powershell commandlets

747
00:27:37,760 --> 00:27:39,760
and there's some error logs they may end

748
00:27:39,760 --> 00:27:42,480
up in the dot azure folder in your img

749
00:27:42,480 --> 00:27:44,720
or image file system

750
00:27:44,720 --> 00:27:46,320
and one of those as highlighted by

751
00:27:46,320 --> 00:27:47,679
netspy

752
00:27:47,679 --> 00:27:50,159
is a new um

753
00:27:50,159 --> 00:27:52,320
azure vm commandlet that can be

754
00:27:52,320 --> 00:27:54,080
vulnerable so it will log their

755
00:27:54,080 --> 00:27:56,159
credentials

756
00:27:56,159 --> 00:27:59,760
when creating new virtual machines

757
00:27:59,760 --> 00:28:02,559
in their example they showed how

758
00:28:02,559 --> 00:28:05,120
by looking at one of these files that

759
00:28:05,120 --> 00:28:06,559
you could find

760
00:28:06,559 --> 00:28:08,159
different things like an administrator

761
00:28:08,159 --> 00:28:10,080
username and password so again you want

762
00:28:10,080 --> 00:28:11,760
to be careful with the security hygiene

763
00:28:11,760 --> 00:28:13,039
surrounding this

764
00:28:13,039 --> 00:28:15,279
the the risk

765
00:28:15,279 --> 00:28:17,600
is you know if uh if someone gained

766
00:28:17,600 --> 00:28:20,000
access to a normal user account could

767
00:28:20,000 --> 00:28:22,640
they then open up um for example the

768
00:28:22,640 --> 00:28:25,360
powershell go into this look at the logs

769
00:28:25,360 --> 00:28:26,880
and see if they could find a privileged

770
00:28:26,880 --> 00:28:31,320
account like an administrator account

771
00:28:32,960 --> 00:28:35,039
security center within azure has

772
00:28:35,039 --> 00:28:36,640
improved dramatically and there's a lot

773
00:28:36,640 --> 00:28:38,080
of good data here

774
00:28:38,080 --> 00:28:39,520
this will depend on the type of

775
00:28:39,520 --> 00:28:41,360
subscription you have but at the bottom

776
00:28:41,360 --> 00:28:43,440
right you can see that there's a section

777
00:28:43,440 --> 00:28:45,679
for most prevalent alerts

778
00:28:45,679 --> 00:28:47,440
and this will tell you some of the most

779
00:28:47,440 --> 00:28:49,440
prevalent alerts or risks going on

780
00:28:49,440 --> 00:28:51,679
within the environment and you can drill

781
00:28:51,679 --> 00:28:53,760
deeper into that this will expose for

782
00:28:53,760 --> 00:28:54,559
you

783
00:28:54,559 --> 00:28:55,919
a particular

784
00:28:55,919 --> 00:28:57,440
event like this one here the failed

785
00:28:57,440 --> 00:29:00,159
secure shell brute force attack going on

786
00:29:00,159 --> 00:29:02,480
when it occurred what frequency is it

787
00:29:02,480 --> 00:29:04,399
repetitive or not

788
00:29:04,399 --> 00:29:05,840
and you can drill into one of those

789
00:29:05,840 --> 00:29:07,520
individually to see what accounts

790
00:29:07,520 --> 00:29:09,120
they're targeting

791
00:29:09,120 --> 00:29:11,520
and furthermore from what ip and other

792
00:29:11,520 --> 00:29:13,279
things that may help in terms of your

793
00:29:13,279 --> 00:29:15,760
analysis

794
00:29:19,679 --> 00:29:21,520
in this presentation we're really not

795
00:29:21,520 --> 00:29:24,480
talking about office 365 but just be

796
00:29:24,480 --> 00:29:26,240
careful that traditionally within the

797
00:29:26,240 --> 00:29:29,200
exchange online environments that a user

798
00:29:29,200 --> 00:29:32,080
by default any user may be given

799
00:29:32,080 --> 00:29:34,720
powershell access now this is for the

800
00:29:34,720 --> 00:29:36,240
default um

801
00:29:36,240 --> 00:29:37,200
user

802
00:29:37,200 --> 00:29:38,960
and it's just for their user account not

803
00:29:38,960 --> 00:29:40,720
like an administrator with more broad

804
00:29:40,720 --> 00:29:42,320
power shell access

805
00:29:42,320 --> 00:29:44,399
but again if that's not needed for the

806
00:29:44,399 --> 00:29:46,559
user you may want to turn off powershell

807
00:29:46,559 --> 00:29:48,960
for most of your exchange users your

808
00:29:48,960 --> 00:29:51,120
exchange online users that is

809
00:29:51,120 --> 00:29:53,520
if they're not using it because if any

810
00:29:53,520 --> 00:29:57,918
person's exchange online account is um

811
00:29:58,080 --> 00:29:59,919
you know breached um you could

812
00:29:59,919 --> 00:30:02,240
effectively maybe use powershell to do

813
00:30:02,240 --> 00:30:04,559
automation to further target other

814
00:30:04,559 --> 00:30:07,039
accounts download distribution lists

815
00:30:07,039 --> 00:30:10,799
delete sent emails mark emails as unread

816
00:30:10,799 --> 00:30:12,320
things like that and you want to look

817
00:30:12,320 --> 00:30:14,320
for evidence of that within your unified

818
00:30:14,320 --> 00:30:16,799
audit logs keep in mind that the unified

819
00:30:16,799 --> 00:30:19,120
audit logs may only be

820
00:30:19,120 --> 00:30:21,840
saved for 7 or 30 days depending on your

821
00:30:21,840 --> 00:30:24,000
level of subscription so if you need to

822
00:30:24,000 --> 00:30:26,320
go back six months you may not have that

823
00:30:26,320 --> 00:30:28,640
data so some great powershell scripts

824
00:30:28,640 --> 00:30:31,360
available from microsoft to actually

825
00:30:31,360 --> 00:30:33,840
extend your unified audit logs save them

826
00:30:33,840 --> 00:30:35,760
in a blob container and definitely

827
00:30:35,760 --> 00:30:40,080
consider start doing that moving forward

828
00:30:43,200 --> 00:30:45,279
we mentioned briefly around anomalous

829
00:30:45,279 --> 00:30:46,720
behavior

830
00:30:46,720 --> 00:30:48,799
and this can really be leveraged very

831
00:30:48,799 --> 00:30:50,880
well in the cloud to identify a number

832
00:30:50,880 --> 00:30:52,480
of things

833
00:30:52,480 --> 00:30:54,480
for example when a critical resource is

834
00:30:54,480 --> 00:30:56,480
accessed for the first time you're going

835
00:30:56,480 --> 00:30:58,640
to have a lot of users by default with a

836
00:30:58,640 --> 00:31:00,480
lot of excessive permissions and

837
00:31:00,480 --> 00:31:02,640
excessive access to resources they've

838
00:31:02,640 --> 00:31:05,600
never used so identifying when a user is

839
00:31:05,600 --> 00:31:08,000
using a new resource can become really

840
00:31:08,000 --> 00:31:09,919
important in in terms of

841
00:31:09,919 --> 00:31:12,480
identifying initial iocs or indicators

842
00:31:12,480 --> 00:31:14,799
of compromise

843
00:31:14,799 --> 00:31:16,399
also if they're using that permission

844
00:31:16,399 --> 00:31:18,480
for the first time signing in from

845
00:31:18,480 --> 00:31:20,720
different or multiple ip addresses a

846
00:31:20,720 --> 00:31:22,880
strange time of the day or multiple

847
00:31:22,880 --> 00:31:26,799
attempts to gain unauthorized access

848
00:31:28,480 --> 00:31:31,279
in terms of mitigation strategies

849
00:31:31,279 --> 00:31:33,039
ideally you're also going to find you

850
00:31:33,039 --> 00:31:34,720
probably have a lot of inactive

851
00:31:34,720 --> 00:31:36,799
identities these may still be people

852
00:31:36,799 --> 00:31:39,120
that work for the organization but have

853
00:31:39,120 --> 00:31:41,840
never used their account within adbas

854
00:31:41,840 --> 00:31:43,760
azure or gcp

855
00:31:43,760 --> 00:31:46,320
this is low hanging fruit in terms of

856
00:31:46,320 --> 00:31:48,559
mitigation and locking things down

857
00:31:48,559 --> 00:31:50,880
either disable or remove those inactive

858
00:31:50,880 --> 00:31:52,159
identities

859
00:31:52,159 --> 00:31:54,240
to cut down on all of that excessive

860
00:31:54,240 --> 00:31:57,440
access and permissions

861
00:31:57,440 --> 00:31:59,440
and then you can set a policy it may be

862
00:31:59,440 --> 00:32:01,440
90 days or something different in terms

863
00:32:01,440 --> 00:32:03,600
of high risk permissions does dave the

864
00:32:03,600 --> 00:32:06,320
developer need you know all of those you

865
00:32:06,320 --> 00:32:08,720
know 5 000 you know permissions of the

866
00:32:08,720 --> 00:32:11,760
10 000 that give him or her you know

867
00:32:11,760 --> 00:32:14,320
access to any of those you know uh super

868
00:32:14,320 --> 00:32:16,559
admin kind of permissions probably not

869
00:32:16,559 --> 00:32:18,320
so you can remove that and again you can

870
00:32:18,320 --> 00:32:20,080
base that on activity you've never used

871
00:32:20,080 --> 00:32:21,279
them dave i'm going to go ahead and get

872
00:32:21,279 --> 00:32:23,679
rid of them

873
00:32:24,080 --> 00:32:25,519
and then just really starting to get

874
00:32:25,519 --> 00:32:27,440
more and more to least privileges and

875
00:32:27,440 --> 00:32:29,360
then leverage your just in time access

876
00:32:29,360 --> 00:32:31,360
if somebody says hey i need access for

877
00:32:31,360 --> 00:32:32,880
something new well that's what it's

878
00:32:32,880 --> 00:32:35,519
designed for

879
00:32:36,720 --> 00:32:39,039
and then in terms of your your hygiene

880
00:32:39,039 --> 00:32:41,360
um for cloud permissions activities that

881
00:32:41,360 --> 00:32:44,080
is uh you know again taking a look at

882
00:32:44,080 --> 00:32:46,000
the high risk permissions if you're not

883
00:32:46,000 --> 00:32:47,679
sure what they are because there's 10

884
00:32:47,679 --> 00:32:49,600
000 permissions overall there's some

885
00:32:49,600 --> 00:32:51,440
great tools that will help you identify

886
00:32:51,440 --> 00:32:53,760
that what we know in doing our risk

887
00:32:53,760 --> 00:32:55,440
assessments is that on average for

888
00:32:55,440 --> 00:32:58,799
example in aws 5000 of the 10 000 are

889
00:32:58,799 --> 00:33:00,720
considered high risk or admin kind of

890
00:33:00,720 --> 00:33:03,279
permissions so roughly half which is a

891
00:33:03,279 --> 00:33:05,360
lot

892
00:33:05,360 --> 00:33:06,880
determine what high risk permissions

893
00:33:06,880 --> 00:33:08,720
have been assigned to identify what and

894
00:33:08,720 --> 00:33:09,600
where

895
00:33:09,600 --> 00:33:12,159
and then furthermore um revise those to

896
00:33:12,159 --> 00:33:14,399
remove the unnecessary permissions how

897
00:33:14,399 --> 00:33:17,360
do you do that again we usually point

898
00:33:17,360 --> 00:33:18,960
organizations to looking at their

899
00:33:18,960 --> 00:33:21,120
activity saying like listen they haven't

900
00:33:21,120 --> 00:33:23,760
used you know 9 500 of these permissions

901
00:33:23,760 --> 00:33:25,440
so you can probably get rid of all of

902
00:33:25,440 --> 00:33:27,279
those and then leave them with the 500

903
00:33:27,279 --> 00:33:30,480
permissions they normally use

904
00:33:30,720 --> 00:33:32,320
and then the anomaly in outlier

905
00:33:32,320 --> 00:33:36,080
detection and rinse and repeat

906
00:33:36,720 --> 00:33:38,399
so just winding things down

907
00:33:38,399 --> 00:33:41,120
some great uh additional resources scott

908
00:33:41,120 --> 00:33:43,600
piper uh runs summit route dot com and a

909
00:33:43,600 --> 00:33:46,640
blog great stuff around avs security

910
00:33:46,640 --> 00:33:50,559
rhino security um has uh um some great

911
00:33:50,559 --> 00:33:54,320
reverse engineering type blogs the aws

912
00:33:54,320 --> 00:33:56,320
forensic readiness one that i mentioned

913
00:33:56,320 --> 00:33:58,399
earlier there's the link there and for

914
00:33:58,399 --> 00:34:00,000
microsoft they have the azure hacker

915
00:34:00,000 --> 00:34:02,320
hunting series

916
00:34:02,320 --> 00:34:04,960
so last slide

917
00:34:04,960 --> 00:34:08,079
stephen schmidt in a letter to a senator

918
00:34:08,079 --> 00:34:10,239
following a prominent breach said this

919
00:34:10,239 --> 00:34:12,079
even if a customer misconfigures a

920
00:34:12,079 --> 00:34:14,159
resource if the customer properly

921
00:34:14,159 --> 00:34:16,239
implements a lease privilege policy

922
00:34:16,239 --> 00:34:18,159
there's relatively little an actor has

923
00:34:18,159 --> 00:34:20,239
access to once they are authenticated

924
00:34:20,239 --> 00:34:22,159
significantly diminishing the customer's

925
00:34:22,159 --> 00:34:24,159
risk what we're really talking about

926
00:34:24,159 --> 00:34:27,119
here is really that ongoing cycle around

927
00:34:27,119 --> 00:34:29,119
least privileges to get rid of a lot of

928
00:34:29,119 --> 00:34:30,960
those excessive permissions and toxic

929
00:34:30,960 --> 00:34:33,119
combinations

930
00:34:33,119 --> 00:34:35,199
and with that thank you so much i really

931
00:34:35,199 --> 00:34:38,078
appreciate it i

