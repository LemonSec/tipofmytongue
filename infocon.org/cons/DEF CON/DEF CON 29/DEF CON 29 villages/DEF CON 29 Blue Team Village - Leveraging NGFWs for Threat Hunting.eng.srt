1
00:00:09,200 --> 00:00:11,440
connection firewalls for threat hunting

2
00:00:11,440 --> 00:00:13,360
i'm sean wallace a cyber security

3
00:00:13,360 --> 00:00:15,200
research strategist

4
00:00:15,200 --> 00:00:17,600
for five years i've invested time

5
00:00:17,600 --> 00:00:19,359
designing and implementing a passive

6
00:00:19,359 --> 00:00:21,199
mixture and firewall

7
00:00:21,199 --> 00:00:23,920
this has led me to understand that it

8
00:00:23,920 --> 00:00:25,680
can be used as a great thread hunting

9
00:00:25,680 --> 00:00:26,320
tool

10
00:00:26,320 --> 00:00:27,920
and in this talk i'm going to spend some

11
00:00:27,920 --> 00:00:29,599
time showing how you can achieve

12
00:00:29,599 --> 00:00:32,000
visibility with these nation firewalls

13
00:00:32,000 --> 00:00:35,600
test new features to help mitigate risk

14
00:00:35,600 --> 00:00:37,200
from your production traffic

15
00:00:37,200 --> 00:00:39,360
and apply bleeding its functionality

16
00:00:39,360 --> 00:00:40,800
signatures

17
00:00:40,800 --> 00:00:43,280
to those next-gen firewalls to get some

18
00:00:43,280 --> 00:00:44,640
early visibility

19
00:00:44,640 --> 00:00:46,719
and enhance and complement your threat

20
00:00:46,719 --> 00:00:49,280
hunting tools

21
00:00:49,280 --> 00:00:52,239
first a bit about myself again i'm sean

22
00:00:52,239 --> 00:00:54,000
wallace i'm a research strategist at a

23
00:00:54,000 --> 00:00:55,520
top u.s bank

24
00:00:55,520 --> 00:00:57,120
i'm a network security domain

25
00:00:57,120 --> 00:00:59,120
specialists things like

26
00:00:59,120 --> 00:01:01,920
firewalls ids thread hunting tools

27
00:01:01,920 --> 00:01:04,000
packet capture tools

28
00:01:04,000 --> 00:01:06,479
and email are things that i have a lot

29
00:01:06,479 --> 00:01:09,119
of history and experience working on

30
00:01:09,119 --> 00:01:11,360
i'm an advisor to a threat intel as a

31
00:01:11,360 --> 00:01:13,280
service company by the name of silent

32
00:01:13,280 --> 00:01:14,320
bush

33
00:01:14,320 --> 00:01:16,400
i'm a defcon goon and a black hat

34
00:01:16,400 --> 00:01:17,840
volunteer and i live in the san

35
00:01:17,840 --> 00:01:20,880
francisco bay area

36
00:01:22,000 --> 00:01:24,720
so how did this come about as i was

37
00:01:24,720 --> 00:01:27,040
looking at next-gen firewalls

38
00:01:27,040 --> 00:01:29,759
i noticed and observed an operational

39
00:01:29,759 --> 00:01:30,880
risk that

40
00:01:30,880 --> 00:01:33,680
application id could potentially cause

41
00:01:33,680 --> 00:01:35,840
impact of production traffic

42
00:01:35,840 --> 00:01:37,200
and i started to look at ways to

43
00:01:37,200 --> 00:01:38,960
mitigate that risk

44
00:01:38,960 --> 00:01:41,840
a traditional firewall has firewall

45
00:01:41,840 --> 00:01:42,320
rules

46
00:01:42,320 --> 00:01:44,799
in what's called the five tuple looking

47
00:01:44,799 --> 00:01:45,920
at source ip

48
00:01:45,920 --> 00:01:48,240
source port destination ip destination

49
00:01:48,240 --> 00:01:50,479
port and protocol

50
00:01:50,479 --> 00:01:53,119
with application firewalls we add

51
00:01:53,119 --> 00:01:54,479
application id

52
00:01:54,479 --> 00:01:56,240
as well as some other features such as

53
00:01:56,240 --> 00:01:58,399
user identity which can be used

54
00:01:58,399 --> 00:02:01,759
to write those firewall rules

55
00:02:01,759 --> 00:02:03,360
so in this example that i'm showing

56
00:02:03,360 --> 00:02:06,960
below we can apply that only http proxy

57
00:02:06,960 --> 00:02:08,160
traffic could be allowed

58
00:02:08,160 --> 00:02:11,599
through a rule meaning application

59
00:02:11,599 --> 00:02:14,080
traffic matching ssh could not thus you

60
00:02:14,080 --> 00:02:16,400
can block ssh traffic

61
00:02:16,400 --> 00:02:18,560
you could of course also put in a rule

62
00:02:18,560 --> 00:02:19,920
above that says

63
00:02:19,920 --> 00:02:23,839
deny ssh traffic for the application

64
00:02:24,400 --> 00:02:26,400
so now that i have this application

65
00:02:26,400 --> 00:02:27,599
logic

66
00:02:27,599 --> 00:02:29,920
what happens if that logic changes on

67
00:02:29,920 --> 00:02:30,879
the firewall

68
00:02:30,879 --> 00:02:33,120
applications are ever changing and what

69
00:02:33,120 --> 00:02:35,440
if the firewall either can't keep up

70
00:02:35,440 --> 00:02:38,480
or what if the firewall starts to think

71
00:02:38,480 --> 00:02:41,200
that that application is something else

72
00:02:41,200 --> 00:02:45,440
we had a similar incident that happened

73
00:02:45,440 --> 00:02:48,000
very early on where we had some impact

74
00:02:48,000 --> 00:02:48,720
with a

75
00:02:48,720 --> 00:02:51,280
tool just something such as tacx where

76
00:02:51,280 --> 00:02:54,080
the application logic of that changed

77
00:02:54,080 --> 00:02:56,080
in the firewall and started to block the

78
00:02:56,080 --> 00:02:58,400
traffic

79
00:02:58,400 --> 00:03:00,959
so you know again we considered how can

80
00:03:00,959 --> 00:03:01,599
we

81
00:03:01,599 --> 00:03:03,840
mitigate that risk and i thought of

82
00:03:03,840 --> 00:03:05,599
putting a passive next-gen firewall

83
00:03:05,599 --> 00:03:08,480
side-by-side that we could update

84
00:03:08,480 --> 00:03:09,680
quickly

85
00:03:09,680 --> 00:03:13,120
and monitor such changes you might ask

86
00:03:13,120 --> 00:03:14,640
why couldn't you just do this in a lab

87
00:03:14,640 --> 00:03:15,760
environment

88
00:03:15,760 --> 00:03:17,519
well with a large network with so many

89
00:03:17,519 --> 00:03:19,360
different applications it's hard to test

90
00:03:19,360 --> 00:03:21,599
every single one of them in the lab

91
00:03:21,599 --> 00:03:24,480
so having this allows us that luxury of

92
00:03:24,480 --> 00:03:25,760
being able to see what's on the

93
00:03:25,760 --> 00:03:27,599
production network and observing those

94
00:03:27,599 --> 00:03:28,799
changes

95
00:03:28,799 --> 00:03:32,159
as well as nothing ever works in the lab

96
00:03:32,159 --> 00:03:35,359
like it does in production

97
00:03:36,159 --> 00:03:38,720
so the solution i came up with again is

98
00:03:38,720 --> 00:03:41,360
let's deploy a passive nixon firewall

99
00:03:41,360 --> 00:03:43,599
this gave us that mitigation to observe

100
00:03:43,599 --> 00:03:45,200
application ids

101
00:03:45,200 --> 00:03:47,200
as well is now we can test new

102
00:03:47,200 --> 00:03:48,959
configurations new features

103
00:03:48,959 --> 00:03:51,360
new signatures or deploy custom

104
00:03:51,360 --> 00:03:52,400
signatures

105
00:03:52,400 --> 00:03:55,280
or new versions the added benefit of all

106
00:03:55,280 --> 00:03:55,840
this

107
00:03:55,840 --> 00:03:57,599
is we can turn on all the security

108
00:03:57,599 --> 00:03:59,920
features the passive security features

109
00:03:59,920 --> 00:04:00,959
we want

110
00:04:00,959 --> 00:04:03,120
and get the most value of our next gen

111
00:04:03,120 --> 00:04:04,959
firewall to help complement our threat

112
00:04:04,959 --> 00:04:06,799
hunting tools

113
00:04:06,799 --> 00:04:09,519
this isn't necessarily a brand new idea

114
00:04:09,519 --> 00:04:11,439
this has been done with ids vendors

115
00:04:11,439 --> 00:04:12,319
before

116
00:04:12,319 --> 00:04:14,159
a lot of them call these their various

117
00:04:14,159 --> 00:04:15,840
lighthouse systems

118
00:04:15,840 --> 00:04:18,000
where these systems are observing

119
00:04:18,000 --> 00:04:19,759
traffic on the network

120
00:04:19,759 --> 00:04:21,759
and reporting back so they roll out

121
00:04:21,759 --> 00:04:24,320
these new signatures to various

122
00:04:24,320 --> 00:04:26,560
lighthouse systems and make sure that

123
00:04:26,560 --> 00:04:28,000
they aren't seeing various false

124
00:04:28,000 --> 00:04:29,680
positives

125
00:04:29,680 --> 00:04:32,639
before rolling them out now that a lot

126
00:04:32,639 --> 00:04:34,560
of systems are moving to cloud

127
00:04:34,560 --> 00:04:36,400
they pretty much do this without even

128
00:04:36,400 --> 00:04:39,198
having to tell you

129
00:04:39,520 --> 00:04:42,320
but you might ask don't i already have

130
00:04:42,320 --> 00:04:44,320
other threat hunting tools

131
00:04:44,320 --> 00:04:46,000
what's really the benefits from why do i

132
00:04:46,000 --> 00:04:47,360
need this

133
00:04:47,360 --> 00:04:51,120
well you know i'd like you to ask

134
00:04:51,120 --> 00:04:52,720
how many of your threat hunting tools

135
00:04:52,720 --> 00:04:55,040
have application id intelligence

136
00:04:55,040 --> 00:04:57,600
i know we have quite a few and they just

137
00:04:57,600 --> 00:04:59,520
haven't gotten there yet with app id

138
00:04:59,520 --> 00:05:00,800
intelligence yet

139
00:05:00,800 --> 00:05:02,720
unless they're from a big vendor that

140
00:05:02,720 --> 00:05:04,000
already has

141
00:05:04,000 --> 00:05:05,919
this baked into an action firewall where

142
00:05:05,919 --> 00:05:07,199
they've been able to

143
00:05:07,199 --> 00:05:11,280
port that over to various tools

144
00:05:11,280 --> 00:05:13,440
merging threats how often do these

145
00:05:13,440 --> 00:05:15,039
various tools push down

146
00:05:15,039 --> 00:05:18,000
new signatures or new content and are

147
00:05:18,000 --> 00:05:19,600
they at the pace that you would see in

148
00:05:19,600 --> 00:05:20,479
ids

149
00:05:20,479 --> 00:05:24,639
box or what not pushing content

150
00:05:24,639 --> 00:05:26,160
most of these tools don't have ids

151
00:05:26,160 --> 00:05:27,840
signatures themselves either

152
00:05:27,840 --> 00:05:30,240
most packet capture systems i know of

153
00:05:30,240 --> 00:05:30,880
don't

154
00:05:30,880 --> 00:05:32,320
either although some have been

155
00:05:32,320 --> 00:05:35,840
investigating going in that route

156
00:05:35,840 --> 00:05:38,639
file movement i know a couple packet

157
00:05:38,639 --> 00:05:40,479
capture systems as well as other thread

158
00:05:40,479 --> 00:05:41,919
hunting tools which

159
00:05:41,919 --> 00:05:44,479
have issues to coding various files on

160
00:05:44,479 --> 00:05:47,680
the network if they are non-web apps

161
00:05:47,680 --> 00:05:50,160
however what i've seen with um

162
00:05:50,160 --> 00:05:52,160
connection firewalls is it's

163
00:05:52,160 --> 00:05:54,880
very uh very key to be able to decode

164
00:05:54,880 --> 00:05:55,440
that

165
00:05:55,440 --> 00:05:57,840
as it's needed that for some of its uh

166
00:05:57,840 --> 00:06:00,319
feature and functionality

167
00:06:00,319 --> 00:06:02,880
strategic placement you may decide that

168
00:06:02,880 --> 00:06:04,880
where i have my firewalls and where

169
00:06:04,880 --> 00:06:06,560
um i have my packet capture or other

170
00:06:06,560 --> 00:06:08,160
thread hunting tools maybe i have them

171
00:06:08,160 --> 00:06:09,440
at different choke points or different

172
00:06:09,440 --> 00:06:11,120
locations so you can get some added

173
00:06:11,120 --> 00:06:11,680
benefit

174
00:06:11,680 --> 00:06:14,400
out of this because of that and

175
00:06:14,400 --> 00:06:15,759
decryption

176
00:06:15,759 --> 00:06:17,919
surprisingly there's still quite a high

177
00:06:17,919 --> 00:06:19,199
value

178
00:06:19,199 --> 00:06:21,440
without encryption here so i think

179
00:06:21,440 --> 00:06:24,639
that's an option to consider

180
00:06:24,800 --> 00:06:26,319
now i'm going to look at a couple

181
00:06:26,319 --> 00:06:28,240
different architectures and discuss them

182
00:06:28,240 --> 00:06:29,759
that could

183
00:06:29,759 --> 00:06:32,800
that you could deploy in in this one

184
00:06:32,800 --> 00:06:33,759
this is without

185
00:06:33,759 --> 00:06:36,080
decryption you can see the user traffic

186
00:06:36,080 --> 00:06:38,240
is um accessing either a router or a

187
00:06:38,240 --> 00:06:39,520
packet broker

188
00:06:39,520 --> 00:06:41,440
and then that traffic spanned off to

189
00:06:41,440 --> 00:06:43,120
your passive next-gen firewall for

190
00:06:43,120 --> 00:06:44,800
inspection

191
00:06:44,800 --> 00:06:46,880
however your production traffic your

192
00:06:46,880 --> 00:06:48,560
active traffic's going through number

193
00:06:48,560 --> 00:06:49,759
three here

194
00:06:49,759 --> 00:06:51,360
and flowing out to the internet as

195
00:06:51,360 --> 00:06:53,759
normal

196
00:06:54,080 --> 00:06:55,599
here we have one with decryption where

197
00:06:55,599 --> 00:06:57,840
we add that packet broker to

198
00:06:57,840 --> 00:07:00,080
parse over and decrypt that traffic and

199
00:07:00,080 --> 00:07:02,880
then send it back to the packet broker

200
00:07:02,880 --> 00:07:04,960
in this case a passive next-gen firewall

201
00:07:04,960 --> 00:07:06,720
is getting that decrypted traffic

202
00:07:06,720 --> 00:07:08,639
but your active traffic is still going

203
00:07:08,639 --> 00:07:10,400
through next-gen firewall inspection as

204
00:07:10,400 --> 00:07:11,840
normal

205
00:07:11,840 --> 00:07:14,800
one thing i'll add here is the next-gen

206
00:07:14,800 --> 00:07:16,000
firewall can also do

207
00:07:16,000 --> 00:07:18,560
encryption and wouldn't it be great if

208
00:07:18,560 --> 00:07:20,560
instead of having this added box of a

209
00:07:20,560 --> 00:07:22,400
packet broker that the next-gen firewall

210
00:07:22,400 --> 00:07:23,520
could just span

211
00:07:23,520 --> 00:07:26,000
that traffic over this is something we

212
00:07:26,000 --> 00:07:27,039
definitely have been working with

213
00:07:27,039 --> 00:07:28,880
various vendors on figuring out if we

214
00:07:28,880 --> 00:07:30,080
can do to help

215
00:07:30,080 --> 00:07:32,800
simplify this diagram and reduce the

216
00:07:32,800 --> 00:07:35,199
number of hops traffic has to access

217
00:07:35,199 --> 00:07:36,479
and the number of times we have to

218
00:07:36,479 --> 00:07:39,280
decrypt traffic

219
00:07:39,520 --> 00:07:41,919
so the high level concept here is with

220
00:07:41,919 --> 00:07:44,080
all of these features

221
00:07:44,080 --> 00:07:46,240
can we deploy a passive nicshan firewall

222
00:07:46,240 --> 00:07:48,800
essentially as a pre-prod environment

223
00:07:48,800 --> 00:07:51,680
where we can see live traffic but also

224
00:07:51,680 --> 00:07:52,160
leverage

225
00:07:52,160 --> 00:07:54,000
all these benefits of features

226
00:07:54,000 --> 00:07:55,360
functionalities

227
00:07:55,360 --> 00:07:57,120
and versions coming from a next-gen

228
00:07:57,120 --> 00:07:58,879
firewall

229
00:07:58,879 --> 00:08:00,960
again you can have early adoption of

230
00:08:00,960 --> 00:08:02,240
hardware software

231
00:08:02,240 --> 00:08:05,039
new threat signatures new features and

232
00:08:05,039 --> 00:08:07,039
new functionality

233
00:08:07,039 --> 00:08:09,120
the one other thing i really like about

234
00:08:09,120 --> 00:08:10,400
this approach

235
00:08:10,400 --> 00:08:12,560
is most threat tools or packet capture

236
00:08:12,560 --> 00:08:14,639
systems that i've worked with

237
00:08:14,639 --> 00:08:17,840
really have leveraged a custom ui where

238
00:08:17,840 --> 00:08:19,919
you're always in that ui doing your

239
00:08:19,919 --> 00:08:21,360
hunting and looking

240
00:08:21,360 --> 00:08:23,120
but nixon firewalls are really good

241
00:08:23,120 --> 00:08:25,280
about logging and we're interacting with

242
00:08:25,280 --> 00:08:26,560
a sim

243
00:08:26,560 --> 00:08:28,720
so this gives you the benefit of giving

244
00:08:28,720 --> 00:08:30,720
all that data over the sim

245
00:08:30,720 --> 00:08:32,399
leveraging reports and alerts and

246
00:08:32,399 --> 00:08:33,839
anything that you have in there

247
00:08:33,839 --> 00:08:36,159
as well as other logic or other sub

248
00:08:36,159 --> 00:08:37,440
searches that you can

249
00:08:37,440 --> 00:08:40,159
enrich your data with that you may not

250
00:08:40,159 --> 00:08:40,479
get

251
00:08:40,479 --> 00:08:44,000
in other threat hunting tools

252
00:08:45,040 --> 00:08:46,240
so now we're going to go through and

253
00:08:46,240 --> 00:08:47,440
kind of look through some of the

254
00:08:47,440 --> 00:08:49,040
features and some of the things that

255
00:08:49,040 --> 00:08:50,480
stand out

256
00:08:50,480 --> 00:08:52,160
obviously the firewall logs are going to

257
00:08:52,160 --> 00:08:53,600
allow you to see all the traffic and

258
00:08:53,600 --> 00:08:55,120
this is important because if you don't

259
00:08:55,120 --> 00:08:56,480
enable them

260
00:08:56,480 --> 00:08:58,240
you'll maybe only see all the threat

261
00:08:58,240 --> 00:09:00,320
traffic that can be good or bad

262
00:09:00,320 --> 00:09:02,160
depending on your solution

263
00:09:02,160 --> 00:09:04,080
if you want the app id enrichment though

264
00:09:04,080 --> 00:09:06,000
you're going to need all of that traffic

265
00:09:06,000 --> 00:09:07,760
logged

266
00:09:07,760 --> 00:09:09,519
depending on what your other firewall

267
00:09:09,519 --> 00:09:11,200
solution is this could either be new

268
00:09:11,200 --> 00:09:11,839
traffic

269
00:09:11,839 --> 00:09:15,040
or just enrichment

270
00:09:15,040 --> 00:09:17,519
or a different source depending on again

271
00:09:17,519 --> 00:09:18,160
what that

272
00:09:18,160 --> 00:09:21,519
other traffic is if you do have other

273
00:09:21,519 --> 00:09:23,279
firewalls this traffic can also be

274
00:09:23,279 --> 00:09:24,320
duplicate

275
00:09:24,320 --> 00:09:26,080
that's something to consider because

276
00:09:26,080 --> 00:09:28,160
it's essentially is doubling your log

277
00:09:28,160 --> 00:09:30,080
size or even more if you're starting to

278
00:09:30,080 --> 00:09:31,519
enable a lot of features and

279
00:09:31,519 --> 00:09:34,480
functionalities

280
00:09:34,560 --> 00:09:36,640
but if you really want to compare your

281
00:09:36,640 --> 00:09:38,720
application id traffic it's very

282
00:09:38,720 --> 00:09:40,480
important to enable this

283
00:09:40,480 --> 00:09:42,320
you need to be able to see if the

284
00:09:42,320 --> 00:09:44,480
application traffic between your passive

285
00:09:44,480 --> 00:09:46,240
environment and active environment are

286
00:09:46,240 --> 00:09:48,399
the same

287
00:09:48,399 --> 00:09:52,080
i should note here that various vendors

288
00:09:52,080 --> 00:09:53,519
log differently

289
00:09:53,519 --> 00:09:55,040
some of them log at the beginning of a

290
00:09:55,040 --> 00:09:56,959
session some of them log at the end of

291
00:09:56,959 --> 00:09:57,680
the session

292
00:09:57,680 --> 00:09:59,040
the end of the session you're going to

293
00:09:59,040 --> 00:10:02,000
find out how did the session terminate

294
00:10:02,000 --> 00:10:04,000
how many bytes were in the session

295
00:10:04,000 --> 00:10:05,200
sometimes you'll find out

296
00:10:05,200 --> 00:10:07,920
whether it's in timeout or not you don't

297
00:10:07,920 --> 00:10:09,600
necessarily get that in the beginning of

298
00:10:09,600 --> 00:10:11,279
the session data

299
00:10:11,279 --> 00:10:14,000
all the firewalls do allow you to enable

300
00:10:14,000 --> 00:10:14,480
both

301
00:10:14,480 --> 00:10:16,560
logging at the beginning and in so this

302
00:10:16,560 --> 00:10:18,240
is a strong consideration that

303
00:10:18,240 --> 00:10:20,399
maybe you want that data to be able to

304
00:10:20,399 --> 00:10:23,440
really kind of help you

305
00:10:24,480 --> 00:10:27,760
application id nixon firewalls

306
00:10:27,760 --> 00:10:29,920
introduce application id now they're

307
00:10:29,920 --> 00:10:31,920
giving you more contacts than just a

308
00:10:31,920 --> 00:10:34,079
destination ip and a port

309
00:10:34,079 --> 00:10:35,839
they're giving you what is this

310
00:10:35,839 --> 00:10:38,000
application and what is it doing

311
00:10:38,000 --> 00:10:39,680
so if you look at the example here i

312
00:10:39,680 --> 00:10:42,000
have some sample common applications

313
00:10:42,000 --> 00:10:45,600
or uncommon i should say you see spn go

314
00:10:45,600 --> 00:10:48,320
you see facebook facebook social plug-in

315
00:10:48,320 --> 00:10:50,399
you see google cloud storage download

316
00:10:50,399 --> 00:10:52,640
you see the context of what that user is

317
00:10:52,640 --> 00:10:55,040
doing they're downloading or uploading

318
00:10:55,040 --> 00:10:56,720
that can be very valuable in thread

319
00:10:56,720 --> 00:10:58,480
hunting if you want to start

320
00:10:58,480 --> 00:11:00,320
writing your searches to filter on

321
00:11:00,320 --> 00:11:01,839
people uploading data

322
00:11:01,839 --> 00:11:05,279
or perhaps downloading data then you can

323
00:11:05,279 --> 00:11:06,880
also start to pair that with your

324
00:11:06,880 --> 00:11:09,519
various threat data to see exactly

325
00:11:09,519 --> 00:11:10,800
where it came from and what they were

326
00:11:10,800 --> 00:11:12,560
doing so

327
00:11:12,560 --> 00:11:14,880
some ideas how i use the application

328
00:11:14,880 --> 00:11:16,720
data is looking at those rare ones i

329
00:11:16,720 --> 00:11:18,160
always like to see

330
00:11:18,160 --> 00:11:20,160
what am i what would i expect on my

331
00:11:20,160 --> 00:11:22,079
network what am i seeing that's

332
00:11:22,079 --> 00:11:22,560
different

333
00:11:22,560 --> 00:11:25,440
or not expecting and why why are people

334
00:11:25,440 --> 00:11:28,480
suddenly going there

335
00:11:28,480 --> 00:11:31,760
you can also leverage the context that i

336
00:11:31,760 --> 00:11:33,279
mentioned to see what people are doing

337
00:11:33,279 --> 00:11:35,920
within those applications maybe they're

338
00:11:35,920 --> 00:11:37,360
uploading when they shouldn't be or

339
00:11:37,360 --> 00:11:39,040
maybe they're uploading to a place you

340
00:11:39,040 --> 00:11:40,800
didn't expect

341
00:11:40,800 --> 00:11:42,000
and then of course you can look at

342
00:11:42,000 --> 00:11:44,399
various anomalies this is very important

343
00:11:44,399 --> 00:11:45,920
as you can start to see those sharp

344
00:11:45,920 --> 00:11:47,680
increases and this can lead you to

345
00:11:47,680 --> 00:11:48,800
various

346
00:11:48,800 --> 00:11:54,240
uh dlp type information or perhaps c2

347
00:11:54,399 --> 00:11:56,399
in this example i'm showing we're

348
00:11:56,399 --> 00:11:58,240
looking at github traffic and again you

349
00:11:58,240 --> 00:11:59,760
can see that context

350
00:11:59,760 --> 00:12:02,079
um this data is from palo alto it's

351
00:12:02,079 --> 00:12:04,160
publicly available and it's totally free

352
00:12:04,160 --> 00:12:07,519
from applopedia.palo optonetworks.com

353
00:12:07,519 --> 00:12:09,600
most firewall vendors have this

354
00:12:09,600 --> 00:12:10,800
information for free

355
00:12:10,800 --> 00:12:14,079
i just pick palo i kind of like the the

356
00:12:14,079 --> 00:12:16,240
interface of how it shows and it made it

357
00:12:16,240 --> 00:12:18,880
easy for me to talk about

358
00:12:18,880 --> 00:12:22,079
so in this case you think about this if

359
00:12:22,079 --> 00:12:22,880
you want to

360
00:12:22,880 --> 00:12:25,279
write the same content on another thread

361
00:12:25,279 --> 00:12:26,320
hunting tool

362
00:12:26,320 --> 00:12:28,000
essentially you probably could do it

363
00:12:28,000 --> 00:12:29,839
right we've done this before in

364
00:12:29,839 --> 00:12:31,680
various packet capture systems where i

365
00:12:31,680 --> 00:12:33,440
want to focus on

366
00:12:33,440 --> 00:12:36,240
uploading or posting of information but

367
00:12:36,240 --> 00:12:36,800
you know

368
00:12:36,800 --> 00:12:39,360
if i if i'm looking for uploading i'm

369
00:12:39,360 --> 00:12:40,399
looking for posts

370
00:12:40,399 --> 00:12:42,240
but then i have to go and do additional

371
00:12:42,240 --> 00:12:44,000
leg work how do i distinguish between a

372
00:12:44,000 --> 00:12:45,440
post and an upload

373
00:12:45,440 --> 00:12:49,120
you know here or edit of a github system

374
00:12:49,120 --> 00:12:51,519
here um the next gen firewall vendor's

375
00:12:51,519 --> 00:12:53,040
done all the legwork for you

376
00:12:53,040 --> 00:12:54,639
so it really can simplify and you can

377
00:12:54,639 --> 00:12:57,279
focus more on the content rather than

378
00:12:57,279 --> 00:13:00,639
you know getting the content

379
00:13:00,720 --> 00:13:02,480
and another example here i'm looking at

380
00:13:02,480 --> 00:13:03,920
ssh

381
00:13:03,920 --> 00:13:06,800
you can see in ssh you can start to see

382
00:13:06,800 --> 00:13:08,480
how you can leverage looking at the

383
00:13:08,480 --> 00:13:10,160
uncommon ports you can see

384
00:13:10,160 --> 00:13:12,079
the ports i would expect to see on my

385
00:13:12,079 --> 00:13:14,639
network 22 80 22

386
00:13:14,639 --> 00:13:17,600
and some of the 22 22. now i start to

387
00:13:17,600 --> 00:13:19,360
see some more of the uncommon ones are

388
00:13:19,360 --> 00:13:20,000
ones that i'm

389
00:13:20,000 --> 00:13:22,800
not really expecting the one that stands

390
00:13:22,800 --> 00:13:25,040
out to me obviously is 8080 because

391
00:13:25,040 --> 00:13:26,639
that's my web proxy

392
00:13:26,639 --> 00:13:28,480
that means somebody is essentially

393
00:13:28,480 --> 00:13:31,600
probably trying to tunnel over ssh

394
00:13:31,600 --> 00:13:33,519
with any of these i can now pivot off

395
00:13:33,519 --> 00:13:35,760
the ip addresses that are provided

396
00:13:35,760 --> 00:13:37,200
perhaps see what other things they're

397
00:13:37,200 --> 00:13:38,959
doing or whether applications they're

398
00:13:38,959 --> 00:13:40,959
triggering or maybe threats

399
00:13:40,959 --> 00:13:44,160
and that's very valuable

400
00:13:44,639 --> 00:13:48,000
moving on to ids threat and malware

401
00:13:48,000 --> 00:13:49,199
i think they greatly speak for

402
00:13:49,199 --> 00:13:51,760
themselves obviously ideas can be used

403
00:13:51,760 --> 00:13:54,240
to identify potential threats

404
00:13:54,240 --> 00:13:56,079
malware inspection can inspect files

405
00:13:56,079 --> 00:13:58,959
traversing from malicious malware

406
00:13:58,959 --> 00:14:00,800
you can set up immediate updates as i

407
00:14:00,800 --> 00:14:02,399
mentioned before

408
00:14:02,399 --> 00:14:04,639
and as soon as zero day threats come out

409
00:14:04,639 --> 00:14:07,760
start to monitor those

410
00:14:08,079 --> 00:14:10,800
hunting for those new vulnerabilities

411
00:14:10,800 --> 00:14:11,839
you can find out

412
00:14:11,839 --> 00:14:15,199
internal threats perhaps new networks

413
00:14:15,199 --> 00:14:16,160
that are um

414
00:14:16,160 --> 00:14:18,959
have scanning that you didn't expect to

415
00:14:18,959 --> 00:14:20,480
or who are the people out on the

416
00:14:20,480 --> 00:14:22,639
internet who are really hitting you

417
00:14:22,639 --> 00:14:26,240
with zero-day scanning

418
00:14:26,639 --> 00:14:29,040
one thing i would mention be very

419
00:14:29,040 --> 00:14:29,920
cautious of

420
00:14:29,920 --> 00:14:32,240
enabling low and informational

421
00:14:32,240 --> 00:14:33,360
signatures

422
00:14:33,360 --> 00:14:36,399
that data can be overwhelming noise the

423
00:14:36,399 --> 00:14:38,639
reason for that is

424
00:14:38,639 --> 00:14:41,760
um a lot of those are just meant to

425
00:14:41,760 --> 00:14:44,320
identify various types of traffic not

426
00:14:44,320 --> 00:14:46,240
necessarily meant to

427
00:14:46,240 --> 00:14:48,800
look for threats for threat signatures

428
00:14:48,800 --> 00:14:50,480
one example of that

429
00:14:50,480 --> 00:14:53,519
is we had enabled all loan information

430
00:14:53,519 --> 00:14:55,279
when we first started it out

431
00:14:55,279 --> 00:14:56,720
and one of the signatures was

432
00:14:56,720 --> 00:14:58,560
identifying various

433
00:14:58,560 --> 00:15:00,560
active directory traffic it was

434
00:15:00,560 --> 00:15:02,000
essentially saying

435
00:15:02,000 --> 00:15:04,480
hey there's an active directory server

436
00:15:04,480 --> 00:15:05,920
here there's an active directory server

437
00:15:05,920 --> 00:15:06,639
here

438
00:15:06,639 --> 00:15:08,959
every single packet and i'm like yeah

439
00:15:08,959 --> 00:15:10,079
there's supposed to be an active

440
00:15:10,079 --> 00:15:11,680
directory server here

441
00:15:11,680 --> 00:15:14,720
so it's just one of those that i'm like

442
00:15:14,720 --> 00:15:15,440
okay

443
00:15:15,440 --> 00:15:18,639
i'm not sure that i needed to know this

444
00:15:18,639 --> 00:15:20,079
information but

445
00:15:20,079 --> 00:15:22,000
it was an awful lot of noise and also

446
00:15:22,000 --> 00:15:27,839
had a huge cpu impact due to that

447
00:15:29,440 --> 00:15:32,560
moving on the url filtering categories

448
00:15:32,560 --> 00:15:34,639
nixon firewalls also have the capability

449
00:15:34,639 --> 00:15:36,720
to log all urls

450
00:15:36,720 --> 00:15:39,759
and then take those urls and

451
00:15:39,759 --> 00:15:42,480
match them to a category that can be

452
00:15:42,480 --> 00:15:43,360
very

453
00:15:43,360 --> 00:15:45,839
beneficial if you're using a web proxy

454
00:15:45,839 --> 00:15:46,959
you probably already have this

455
00:15:46,959 --> 00:15:48,240
functionality

456
00:15:48,240 --> 00:15:51,360
but what if they don't match

457
00:15:51,360 --> 00:15:53,839
in this example you can see one of these

458
00:15:53,839 --> 00:15:55,440
is not like the other

459
00:15:55,440 --> 00:15:58,880
here we have three public categories

460
00:15:58,880 --> 00:15:59,839
heights

461
00:15:59,839 --> 00:16:03,360
cisco checkpoint broadcom and palo alto

462
00:16:03,360 --> 00:16:05,120
and three of them are showing this

463
00:16:05,120 --> 00:16:06,959
category this particular site

464
00:16:06,959 --> 00:16:09,040
is shopping whereas we have the fourth

465
00:16:09,040 --> 00:16:12,480
one palo alto showing it as malware

466
00:16:12,480 --> 00:16:13,680
i'm sure if you talk to each of the

467
00:16:13,680 --> 00:16:16,240
vendors they're going to say that their

468
00:16:16,240 --> 00:16:18,399
threat intelligence is probably better

469
00:16:18,399 --> 00:16:19,920
or comes from a different source than

470
00:16:19,920 --> 00:16:20,880
others

471
00:16:20,880 --> 00:16:23,920
however and they probably have more

472
00:16:23,920 --> 00:16:25,440
insight than others and that's

473
00:16:25,440 --> 00:16:27,839
perhaps why one is different it's for

474
00:16:27,839 --> 00:16:29,040
you to decide

475
00:16:29,040 --> 00:16:31,360
but taking as many different sources as

476
00:16:31,360 --> 00:16:32,720
possible

477
00:16:32,720 --> 00:16:34,639
could help you with better enhancement

478
00:16:34,639 --> 00:16:38,320
of your threat data on your network

479
00:16:41,120 --> 00:16:43,120
moving on to file protection this is my

480
00:16:43,120 --> 00:16:45,440
favorite part

481
00:16:45,440 --> 00:16:47,440
file protection is allowing the ceo

482
00:16:47,440 --> 00:16:50,000
files traverse across your network

483
00:16:50,000 --> 00:16:52,000
not just for web applications which i

484
00:16:52,000 --> 00:16:53,440
think is very exciting

485
00:16:53,440 --> 00:16:55,279
you can start to see other traffic such

486
00:16:55,279 --> 00:16:57,279
as smb and other

487
00:16:57,279 --> 00:16:59,759
applications that leverage this in this

488
00:16:59,759 --> 00:17:01,920
example here i can show you

489
00:17:01,920 --> 00:17:04,480
i'm showing you how just looking at the

490
00:17:04,480 --> 00:17:05,439
file name

491
00:17:05,439 --> 00:17:08,000
searching for password star essentially

492
00:17:08,000 --> 00:17:09,679
you're seeing various file names that

493
00:17:09,679 --> 00:17:11,760
have passwords in them

494
00:17:11,760 --> 00:17:14,480
these obviously look very suspicious and

495
00:17:14,480 --> 00:17:16,319
um the first case here you can see that

496
00:17:16,319 --> 00:17:17,359
sober smb

497
00:17:17,359 --> 00:17:20,959
v1 v1 is not encrypted

498
00:17:20,959 --> 00:17:22,959
so i can go in my packet capture tool

499
00:17:22,959 --> 00:17:24,640
pull this file out

500
00:17:24,640 --> 00:17:27,760
and guess what i have some 2021

501
00:17:27,760 --> 00:17:28,720
passwords

502
00:17:28,720 --> 00:17:30,720
and probably so do other people if they

503
00:17:30,720 --> 00:17:32,000
essentially are trying to pull these

504
00:17:32,000 --> 00:17:34,160
files off our network

505
00:17:34,160 --> 00:17:37,280
this is just an example um that i'm

506
00:17:37,280 --> 00:17:38,320
showing here but

507
00:17:38,320 --> 00:17:40,000
i wanted to kind of give that of seeing

508
00:17:40,000 --> 00:17:42,240
how this could be valuable

509
00:17:42,240 --> 00:17:44,080
further going in this example again i'm

510
00:17:44,080 --> 00:17:46,880
showing palo alto's applopedia here

511
00:17:46,880 --> 00:17:50,080
where it distinguishes between v1 v2 and

512
00:17:50,080 --> 00:17:51,280
v3

513
00:17:51,280 --> 00:17:53,360
this can help you search on your network

514
00:17:53,360 --> 00:17:54,480
and find out

515
00:17:54,480 --> 00:17:56,480
do i have v1 on my network where i

516
00:17:56,480 --> 00:17:58,559
shouldn't and you can track down

517
00:17:58,559 --> 00:18:00,400
those various systems and have them

518
00:18:00,400 --> 00:18:01,760
cleaned up

519
00:18:01,760 --> 00:18:04,160
then you can extract those juicy files

520
00:18:04,160 --> 00:18:06,320
from the system

521
00:18:06,320 --> 00:18:09,440
uh one thing to note is um

522
00:18:09,440 --> 00:18:11,520
and i learned this i didn't necessarily

523
00:18:11,520 --> 00:18:13,520
know a lot about smb when i went down

524
00:18:13,520 --> 00:18:14,480
this path

525
00:18:14,480 --> 00:18:16,160
so this was a good learning experience

526
00:18:16,160 --> 00:18:17,520
for me

527
00:18:17,520 --> 00:18:20,080
the file pointer in smb is not encrypted

528
00:18:20,080 --> 00:18:21,840
so even in v2 and v3

529
00:18:21,840 --> 00:18:24,559
i am seeing that file pointer so i can

530
00:18:24,559 --> 00:18:28,080
see file traversal across the network

531
00:18:28,080 --> 00:18:32,480
smbv3 and such also introduced

532
00:18:32,480 --> 00:18:34,960
multi-channel i put a link in here that

533
00:18:34,960 --> 00:18:35,760
is a

534
00:18:35,760 --> 00:18:39,520
really good breakdown of what that means

535
00:18:39,520 --> 00:18:42,400
however the long and the short of it is

536
00:18:42,400 --> 00:18:43,760
it uses now multiple

537
00:18:43,760 --> 00:18:46,400
sessions to exchange files so we lose

538
00:18:46,400 --> 00:18:48,080
some of this visibility

539
00:18:48,080 --> 00:18:49,919
various vendors are still working

540
00:18:49,919 --> 00:18:52,240
through support for multi-channel

541
00:18:52,240 --> 00:18:54,720
so when using this uh in the future we

542
00:18:54,720 --> 00:18:55,760
will be able to see

543
00:18:55,760 --> 00:18:57,360
the same visibility we have again and

544
00:18:57,360 --> 00:18:59,200
that i think is very exciting

545
00:18:59,200 --> 00:19:00,799
i do know there are some vendors that

546
00:19:00,799 --> 00:19:03,440
already have this rolled out

547
00:19:03,440 --> 00:19:06,320
so i i would encourage people to look

548
00:19:06,320 --> 00:19:08,400
into this if this is something that

549
00:19:08,400 --> 00:19:11,600
you know little about and may be missing

550
00:19:11,600 --> 00:19:14,799
visibility on your network

551
00:19:15,039 --> 00:19:18,160
moving on to dlp there are dlp policies

552
00:19:18,160 --> 00:19:20,000
that you can enable

553
00:19:20,000 --> 00:19:22,320
uh in my experience though i leave that

554
00:19:22,320 --> 00:19:24,559
to the experts i attempted to turn this

555
00:19:24,559 --> 00:19:26,720
on and it was nothing but noise

556
00:19:26,720 --> 00:19:28,480
it was going to be very difficult for me

557
00:19:28,480 --> 00:19:30,720
to write a lot of these signatures

558
00:19:30,720 --> 00:19:32,799
and a lot of the advanced eop tools

559
00:19:32,799 --> 00:19:33,760
already have

560
00:19:33,760 --> 00:19:36,080
better detection than the signatures

561
00:19:36,080 --> 00:19:38,559
that i had the capability of writing

562
00:19:38,559 --> 00:19:40,160
i would encourage you to partner with

563
00:19:40,160 --> 00:19:42,720
your experts and see if maybe there is

564
00:19:42,720 --> 00:19:44,960
some benefit to do this and maybe it's

565
00:19:44,960 --> 00:19:46,480
worthwhile to reach out to them

566
00:19:46,480 --> 00:19:49,280
and chat about it

567
00:19:49,520 --> 00:19:51,919
moving on to email email is also one of

568
00:19:51,919 --> 00:19:53,200
the weakest areas

569
00:19:53,200 --> 00:19:54,799
the reason for this is the next-gen

570
00:19:54,799 --> 00:19:57,679
firewalls don't run as an email server

571
00:19:57,679 --> 00:20:01,039
they run simply as a active we're gonna

572
00:20:01,039 --> 00:20:03,039
pass the traffic through

573
00:20:03,039 --> 00:20:04,880
in an email server you're terminating

574
00:20:04,880 --> 00:20:07,600
the session gathering all that metadata

575
00:20:07,600 --> 00:20:09,679
and then starting up a new session it's

576
00:20:09,679 --> 00:20:10,880
very possible for the

577
00:20:10,880 --> 00:20:12,640
next-gen firewalls to capture this

578
00:20:12,640 --> 00:20:14,000
information

579
00:20:14,000 --> 00:20:15,360
i just don't think they've invested the

580
00:20:15,360 --> 00:20:17,679
time or effort um nor maybe

581
00:20:17,679 --> 00:20:21,039
do they want to to kind of do this

582
00:20:21,039 --> 00:20:23,360
for that reason there's been a lot of

583
00:20:23,360 --> 00:20:25,440
parsing issues with the data that i've

584
00:20:25,440 --> 00:20:27,919
seen in my experience

585
00:20:27,919 --> 00:20:29,440
i do have a lot of experience on the

586
00:20:29,440 --> 00:20:31,200
email front and i've noticed

587
00:20:31,200 --> 00:20:33,039
the log messages are just so much better

588
00:20:33,039 --> 00:20:34,799
coming out of the email gateway that i

589
00:20:34,799 --> 00:20:37,600
tend to result in looking at that

590
00:20:37,600 --> 00:20:40,080
one area i can note about this though is

591
00:20:40,080 --> 00:20:40,799
that you can

592
00:20:40,799 --> 00:20:44,159
leverage email for looking at malware

593
00:20:44,159 --> 00:20:46,799
and threats that are coming across email

594
00:20:46,799 --> 00:20:49,440
for what data you do have so that is

595
00:20:49,440 --> 00:20:51,520
very valuable as another source maybe

596
00:20:51,520 --> 00:20:53,280
it's a different type of sandbox maybe

597
00:20:53,280 --> 00:20:55,440
it's a different type of technology

598
00:20:55,440 --> 00:20:59,280
more sources the better in this case

599
00:20:59,760 --> 00:21:02,080
two other areas are dns and user

600
00:21:02,080 --> 00:21:04,000
identity

601
00:21:04,000 --> 00:21:07,280
dns protections in most cases are active

602
00:21:07,280 --> 00:21:08,240
protections

603
00:21:08,240 --> 00:21:10,720
on next-gen firewalls so there isn't a

604
00:21:10,720 --> 00:21:12,960
lot you can do here nor a lot of value

605
00:21:12,960 --> 00:21:14,240
of enabling that

606
00:21:14,240 --> 00:21:16,799
it requires you to actually point to the

607
00:21:16,799 --> 00:21:18,240
next-gen firewall

608
00:21:18,240 --> 00:21:20,480
then actively kind of take that data and

609
00:21:20,480 --> 00:21:22,159
do something with it

610
00:21:22,159 --> 00:21:23,760
and if you have a passive environment

611
00:21:23,760 --> 00:21:25,600
well you can't necessarily do that it

612
00:21:25,600 --> 00:21:27,440
requires that kind of

613
00:21:27,440 --> 00:21:30,480
active interception uh in that case i

614
00:21:30,480 --> 00:21:31,200
haven't spent

615
00:21:31,200 --> 00:21:33,280
a lot of time looking on that list i

616
00:21:33,280 --> 00:21:34,640
wish there was more

617
00:21:34,640 --> 00:21:37,120
kind of anomaly detection for a passive

618
00:21:37,120 --> 00:21:39,679
environment built in

619
00:21:39,679 --> 00:21:41,679
user identity on the other hand is is

620
00:21:41,679 --> 00:21:42,799
great you can tie this

621
00:21:42,799 --> 00:21:44,400
after directory and start to get a

622
00:21:44,400 --> 00:21:46,720
relationship of what your users are

623
00:21:46,720 --> 00:21:48,799
what your user anomaly behavior is and

624
00:21:48,799 --> 00:21:49,919
etc

625
00:21:49,919 --> 00:21:51,520
i haven't spent a lot of time on this

626
00:21:51,520 --> 00:21:53,039
either because

627
00:21:53,039 --> 00:21:56,000
it requires a somewhere to grab that

628
00:21:56,000 --> 00:21:57,360
database from

629
00:21:57,360 --> 00:21:59,760
i've noticed that various different

630
00:21:59,760 --> 00:22:00,880
implementations

631
00:22:00,880 --> 00:22:03,840
do this differently there's you know

632
00:22:03,840 --> 00:22:04,240
there

633
00:22:04,240 --> 00:22:06,559
hasn't been necessarily a common trend

634
00:22:06,559 --> 00:22:07,520
to do this

635
00:22:07,520 --> 00:22:09,600
and that's been one kind of turn off for

636
00:22:09,600 --> 00:22:10,880
me on doing this

637
00:22:10,880 --> 00:22:12,400
the other is this is an act of

638
00:22:12,400 --> 00:22:14,320
connection and it's talking actively to

639
00:22:14,320 --> 00:22:16,159
after trihetry

640
00:22:16,159 --> 00:22:18,480
um that can be in a large environment

641
00:22:18,480 --> 00:22:20,320
that could be very impactful and have

642
00:22:20,320 --> 00:22:21,840
some production risk

643
00:22:21,840 --> 00:22:24,000
so we kind of stayed away from that as

644
00:22:24,000 --> 00:22:25,120
well until

645
00:22:25,120 --> 00:22:27,360
we're a little more ready and active to

646
00:22:27,360 --> 00:22:30,080
look into this

647
00:22:30,240 --> 00:22:33,200
overall um i want to you know say in

648
00:22:33,200 --> 00:22:34,080
conclusion

649
00:22:34,080 --> 00:22:36,080
i really think next gen firewalls have a

650
00:22:36,080 --> 00:22:38,000
legitimate place here for next

651
00:22:38,000 --> 00:22:41,919
for thread hunting i really want various

652
00:22:41,919 --> 00:22:44,320
vendors to kind of take this seriously

653
00:22:44,320 --> 00:22:45,200
kind of

654
00:22:45,200 --> 00:22:48,720
consider that hey yes we may have a

655
00:22:48,720 --> 00:22:52,080
use case here that other people and

656
00:22:52,080 --> 00:22:54,320
businesses may find as well as a risk

657
00:22:54,320 --> 00:22:55,600
mitigation

658
00:22:55,600 --> 00:22:57,760
part form networks to make sure if

659
00:22:57,760 --> 00:22:58,880
they're

660
00:22:58,880 --> 00:23:01,200
a little scared or a little shy to get

661
00:23:01,200 --> 00:23:02,799
their feet wet because

662
00:23:02,799 --> 00:23:05,840
of these various impactful changes

663
00:23:05,840 --> 00:23:08,960
they're all alternatives to do this i

664
00:23:08,960 --> 00:23:10,559
also really want to thank the community

665
00:23:10,559 --> 00:23:12,320
for letting me speak i'd really love to

666
00:23:12,320 --> 00:23:13,760
hear from more people

667
00:23:13,760 --> 00:23:16,320
who have similar experiences or further

668
00:23:16,320 --> 00:23:18,080
interest in the subject

669
00:23:18,080 --> 00:23:21,120
i definitely you know as i said i'm very

670
00:23:21,120 --> 00:23:22,799
passionate about this and would love to

671
00:23:22,799 --> 00:23:25,039
move forward myself with this

672
00:23:25,039 --> 00:23:26,640
there are any questions please let me

673
00:23:26,640 --> 00:23:28,720
know feel free to reach out

674
00:23:28,720 --> 00:23:32,000
thanks so much

