1
00:00:00,000 --> 00:00:04,400
hi everybody welcome to my devcon 29

2
00:00:03,199 --> 00:00:06,799
adversary village

3
00:00:04,400 --> 00:00:08,960
talk it's called exploiting blue team

4
00:00:06,799 --> 00:00:10,160
opsec failures with red elk my name is

5
00:00:08,960 --> 00:00:12,799
marksmates

6
00:00:10,160 --> 00:00:14,960
and hope you like the presentation i

7
00:00:12,799 --> 00:00:18,240
will be available in the

8
00:00:14,960 --> 00:00:20,640
discord room or you can ask me questions

9
00:00:18,240 --> 00:00:22,320
anytime later after talk you can hit me

10
00:00:20,640 --> 00:00:25,599
up via twitter or some other

11
00:00:22,320 --> 00:00:26,720
way that you can can find me so let's

12
00:00:25,599 --> 00:00:28,880
dive into the talk

13
00:00:26,720 --> 00:00:30,240
exploiting blue team object figures with

14
00:00:28,880 --> 00:00:33,680
red dog a lot to the

15
00:00:30,240 --> 00:00:36,559
dive in two a little bit about

16
00:00:33,680 --> 00:00:37,520
me for who doesn't know who i am my name

17
00:00:36,559 --> 00:00:41,360
is mark smith

18
00:00:37,520 --> 00:00:44,399
um hobby wise i'm from infosec class of

19
00:00:41,360 --> 00:00:46,399
1998 professionally since 2006

20
00:00:44,399 --> 00:00:47,840
and i have a very big background in

21
00:00:46,399 --> 00:00:50,000
system network engineering

22
00:00:47,840 --> 00:00:51,199
and from 2006 i started doing pen

23
00:00:50,000 --> 00:00:54,320
testing

24
00:00:51,199 --> 00:00:56,239
in 2016 i co-founded a company called

25
00:00:54,320 --> 00:00:57,440
outflank which you might know or might

26
00:00:56,239 --> 00:01:00,320
not know

27
00:00:57,440 --> 00:01:01,440
my core roles in there are red team

28
00:01:00,320 --> 00:01:03,760
operations

29
00:01:01,440 --> 00:01:05,040
as well as building some tools and doing

30
00:01:03,760 --> 00:01:07,920
some of the trainings that we have

31
00:01:05,040 --> 00:01:09,680
created within outflank

32
00:01:07,920 --> 00:01:12,080
mainly on the offensive side mainly on

33
00:01:09,680 --> 00:01:13,520
the red side i also have a

34
00:01:12,080 --> 00:01:15,119
little bit of experience on the blue

35
00:01:13,520 --> 00:01:16,640
team side

36
00:01:15,119 --> 00:01:18,320
some of our clients where i had some

37
00:01:16,640 --> 00:01:21,920
threatening experience which is

38
00:01:18,320 --> 00:01:25,360
actually pretty fun to do so that's me

39
00:01:21,920 --> 00:01:27,840
the company outflank we are a boutique

40
00:01:25,360 --> 00:01:28,960
firm and we specialize in red teaming as

41
00:01:27,840 --> 00:01:31,200
well as trainings

42
00:01:28,960 --> 00:01:32,400
mainly aimed for blue although nowadays

43
00:01:31,200 --> 00:01:35,759
we also have a red

44
00:01:32,400 --> 00:01:37,840
aimed training and we have tooling

45
00:01:35,759 --> 00:01:39,439
since the beginning since 2016 we have

46
00:01:37,840 --> 00:01:41,040
created lots of tools given lots of

47
00:01:39,439 --> 00:01:43,360
presentations

48
00:01:41,040 --> 00:01:45,680
and the majority of our tools are

49
00:01:43,360 --> 00:01:48,000
available on our github

50
00:01:45,680 --> 00:01:49,840
although during the time we have become

51
00:01:48,000 --> 00:01:50,880
aware of the fact that some tools are

52
00:01:49,840 --> 00:01:54,000
simply too

53
00:01:50,880 --> 00:01:55,600
powerful to be shared publicly online

54
00:01:54,000 --> 00:01:57,200
and that's why we have created just a

55
00:01:55,600 --> 00:01:59,840
few months ago our

56
00:01:57,200 --> 00:02:01,680
outflank security tooling service which

57
00:01:59,840 --> 00:02:02,960
is basically our private toolset of all

58
00:02:01,680 --> 00:02:04,960
the tools that we use during our

59
00:02:02,960 --> 00:02:08,560
engagements that are too powerful to be

60
00:02:04,960 --> 00:02:11,200
used during operations adds up

61
00:02:08,560 --> 00:02:12,640
those tools also integrate into what is

62
00:02:11,200 --> 00:02:14,319
red elk

63
00:02:12,640 --> 00:02:16,000
and that's where this is the topic of

64
00:02:14,319 --> 00:02:18,640
today so

65
00:02:16,000 --> 00:02:20,840
we're busting gluten object flavors with

66
00:02:18,640 --> 00:02:22,560
red elk reduce the tooling and i want to

67
00:02:20,840 --> 00:02:24,160
dive through

68
00:02:22,560 --> 00:02:26,640
well the whole concept of redrock what

69
00:02:24,160 --> 00:02:29,360
it is why we have created it and

70
00:02:26,640 --> 00:02:32,800
how you can use it and then of course

71
00:02:29,360 --> 00:02:35,280
there is the whole blue team side

72
00:02:32,800 --> 00:02:36,959
and the blue team makes mistakes as well

73
00:02:35,280 --> 00:02:38,560
object mistakes the same as red team

74
00:02:36,959 --> 00:02:39,519
does so those are the main two topics

75
00:02:38,560 --> 00:02:42,720
for today but

76
00:02:39,519 --> 00:02:46,080
before we dive into that product

77
00:02:42,720 --> 00:02:49,599
since we need to discuss how we

78
00:02:46,080 --> 00:02:50,720
and with me we i mean outflank as well

79
00:02:49,599 --> 00:02:54,080
as myself

80
00:02:50,720 --> 00:02:56,000
how we see red teaming if there's one

81
00:02:54,080 --> 00:02:56,560
thing that i would like you to take away

82
00:02:56,000 --> 00:02:59,599
from this

83
00:02:56,560 --> 00:03:03,440
talk is that we believe the red

84
00:02:59,599 --> 00:03:07,120
exists solely to improve blue

85
00:03:03,440 --> 00:03:09,519
um yes we do simulated attacks

86
00:03:07,120 --> 00:03:10,560
uh but it's not a wrecking ball approach

87
00:03:09,519 --> 00:03:14,159
it's not that we

88
00:03:10,560 --> 00:03:16,239
come by smash everything apart

89
00:03:14,159 --> 00:03:18,720
uh knock down the blue team walk away

90
00:03:16,239 --> 00:03:20,879
loot the gold and start laughing no

91
00:03:18,720 --> 00:03:23,040
no far from we see it as a sparring

92
00:03:20,879 --> 00:03:23,680
match we see it as a training for blue

93
00:03:23,040 --> 00:03:25,280
which

94
00:03:23,680 --> 00:03:26,799
means that it's fundamentally a

95
00:03:25,280 --> 00:03:30,159
different goal

96
00:03:26,799 --> 00:03:31,200
we try to try to train the weaknesses of

97
00:03:30,159 --> 00:03:33,200
the blue team

98
00:03:31,200 --> 00:03:34,720
and try to improve them for actually

99
00:03:33,200 --> 00:03:38,000
when the real deal

100
00:03:34,720 --> 00:03:40,000
happens with the real attackers yes our

101
00:03:38,000 --> 00:03:43,040
simulations our red team engagements

102
00:03:40,000 --> 00:03:46,159
contain real punches real movements

103
00:03:43,040 --> 00:03:47,200
it actually may hurt both sides

104
00:03:46,159 --> 00:03:48,879
but it's always better to have a

105
00:03:47,200 --> 00:03:50,959
practice hit on your face than a real

106
00:03:48,879 --> 00:03:54,799
hit on your face

107
00:03:50,959 --> 00:03:57,200
so we exist to train blue

108
00:03:54,799 --> 00:03:58,959
no wrecking ball when we are talking

109
00:03:57,200 --> 00:04:01,840
about our

110
00:03:58,959 --> 00:04:03,280
boxing ring if you like just a quick

111
00:04:01,840 --> 00:04:05,280
overview of how a modern

112
00:04:03,280 --> 00:04:06,480
offensive infrastructure would look like

113
00:04:05,280 --> 00:04:08,640
most likely yours

114
00:04:06,480 --> 00:04:09,599
looks about the same conceptually wise

115
00:04:08,640 --> 00:04:10,159
although there are many different

116
00:04:09,599 --> 00:04:13,280
technical

117
00:04:10,159 --> 00:04:16,079
bits and pieces going from right

118
00:04:13,280 --> 00:04:17,759
to left we first have our own attacking

119
00:04:16,079 --> 00:04:18,720
infrastructure while we have a commander

120
00:04:17,759 --> 00:04:21,040
control service

121
00:04:18,720 --> 00:04:22,720
multiple most likely we have our

122
00:04:21,040 --> 00:04:23,520
delivery services web service where we

123
00:04:22,720 --> 00:04:25,600
do tracking

124
00:04:23,520 --> 00:04:27,680
we have all kinds of decoy things we

125
00:04:25,600 --> 00:04:30,000
might have social media profiles all on

126
00:04:27,680 --> 00:04:32,560
the true

127
00:04:30,000 --> 00:04:34,800
infrastructure that is on your own span

128
00:04:32,560 --> 00:04:37,759
of control

129
00:04:34,800 --> 00:04:39,440
on the complete left side there is the

130
00:04:37,759 --> 00:04:40,160
victim network or the target network

131
00:04:39,440 --> 00:04:41,520
where you

132
00:04:40,160 --> 00:04:44,160
eventually have your implant running

133
00:04:41,520 --> 00:04:45,040
that calls back via http or or dns or

134
00:04:44,160 --> 00:04:47,680
some other spooky

135
00:04:45,040 --> 00:04:50,639
protocol that you have as well as

136
00:04:47,680 --> 00:04:52,479
internally within that 50 network

137
00:04:50,639 --> 00:04:55,360
you've got your things running your

138
00:04:52,479 --> 00:04:57,280
implants connected things like that

139
00:04:55,360 --> 00:04:58,720
in the middle there is what we roughly

140
00:04:57,280 --> 00:05:01,919
call reader characters or

141
00:04:58,720 --> 00:05:04,639
deflecting ways it's in the

142
00:05:01,919 --> 00:05:06,080
modern nature of the modern times with

143
00:05:04,639 --> 00:05:07,759
uh

144
00:05:06,080 --> 00:05:09,360
cloud enabled infrastructure it's very

145
00:05:07,759 --> 00:05:11,520
easy to have lots of

146
00:05:09,360 --> 00:05:12,400
flexible disposable resilient systems in

147
00:05:11,520 --> 00:05:16,080
there that

148
00:05:12,400 --> 00:05:18,240
is just simply a layer in between

149
00:05:16,080 --> 00:05:19,680
to obfuscate some of your own true

150
00:05:18,240 --> 00:05:21,759
attacking infrastructure

151
00:05:19,680 --> 00:05:22,840
as well as making some smart decisions

152
00:05:21,759 --> 00:05:26,240
in the

153
00:05:22,840 --> 00:05:27,600
indigo nothing near here i hope

154
00:05:26,240 --> 00:05:29,759
but there is a reason that i'm telling

155
00:05:27,600 --> 00:05:33,199
you this because this concept

156
00:05:29,759 --> 00:05:35,919
can become quite big if you count the

157
00:05:33,199 --> 00:05:37,919
amount of components that you have

158
00:05:35,919 --> 00:05:39,919
for your offensive infrastructure during

159
00:05:37,919 --> 00:05:41,600
operations so let's talk about

160
00:05:39,919 --> 00:05:43,280
a single engagement which might have

161
00:05:41,600 --> 00:05:45,440
several scenarios

162
00:05:43,280 --> 00:05:46,960
for example if you use a tiebreaker

163
00:05:45,440 --> 00:05:48,560
based approach for a head team you will

164
00:05:46,960 --> 00:05:51,520
have multiple scenarios

165
00:05:48,560 --> 00:05:52,960
within the same operation which also

166
00:05:51,520 --> 00:05:53,840
means that you will have multiple c2

167
00:05:52,960 --> 00:05:56,240
servers

168
00:05:53,840 --> 00:05:58,479
typical engagement for us around five

169
00:05:56,240 --> 00:06:00,080
different c2 servers we

170
00:05:58,479 --> 00:06:02,000
also have multiple heat effectors

171
00:06:00,080 --> 00:06:03,919
reverse proxies and things like that

172
00:06:02,000 --> 00:06:05,680
they want the main fronting cdn type of

173
00:06:03,919 --> 00:06:07,120
players multiple

174
00:06:05,680 --> 00:06:08,800
you'll be creating multiple fake id

175
00:06:07,120 --> 00:06:10,080
entities to do well

176
00:06:08,800 --> 00:06:12,720
the whole social networking thing you

177
00:06:10,080 --> 00:06:14,319
might create a website one or two

178
00:06:12,720 --> 00:06:16,560
tracking pixels everywhere we track

179
00:06:14,319 --> 00:06:17,759
everything both in emails as in delivery

180
00:06:16,560 --> 00:06:19,440
as an ultimate multiple different

181
00:06:17,759 --> 00:06:20,960
aspects tracking pixels tracking pixel

182
00:06:19,440 --> 00:06:22,479
tracking pixels

183
00:06:20,960 --> 00:06:24,080
you need to be catching them you need to

184
00:06:22,479 --> 00:06:26,400
be setting them up

185
00:06:24,080 --> 00:06:28,080
it's things to manage and i know a whole

186
00:06:26,400 --> 00:06:30,160
delivery side we got multiple web

187
00:06:28,080 --> 00:06:31,759
servers multiple email boxes maybe some

188
00:06:30,160 --> 00:06:33,199
file sharing services messaging

189
00:06:31,759 --> 00:06:35,199
platforms whatever

190
00:06:33,199 --> 00:06:36,720
all the new hot stuff there there is but

191
00:06:35,199 --> 00:06:37,680
there's multiple aspects that you need

192
00:06:36,720 --> 00:06:40,880
to manage

193
00:06:37,680 --> 00:06:44,080
that's all front facing on your

194
00:06:40,880 --> 00:06:45,680
backhand side you will have generic

195
00:06:44,080 --> 00:06:47,039
backhand components let's talk about

196
00:06:45,680 --> 00:06:49,039
communication channels that you have

197
00:06:47,039 --> 00:06:50,880
internally with your team or also with

198
00:06:49,039 --> 00:06:52,960
the right team you will have your own

199
00:06:50,880 --> 00:06:53,840
test labs you will have all kinds of log

200
00:06:52,960 --> 00:06:55,840
aggregation

201
00:06:53,840 --> 00:06:58,479
and log aggregation is where red elf

202
00:06:55,840 --> 00:07:00,840
actually comes in

203
00:06:58,479 --> 00:07:02,960
the reason i'm telling you this is that

204
00:07:00,840 --> 00:07:05,039
it

205
00:07:02,960 --> 00:07:07,599
this is our boxing ring this is what we

206
00:07:05,039 --> 00:07:09,840
need to use

207
00:07:07,599 --> 00:07:12,080
and it's becoming quite big per

208
00:07:09,840 --> 00:07:15,120
operation and even if you have

209
00:07:12,080 --> 00:07:18,400
multiple operations at the same time

210
00:07:15,120 --> 00:07:19,599
which many writing firms actually do to

211
00:07:18,400 --> 00:07:22,160
keep

212
00:07:19,599 --> 00:07:23,039
track of that infrastructure is actually

213
00:07:22,160 --> 00:07:24,880
becoming

214
00:07:23,039 --> 00:07:26,319
challenging it's not something that

215
00:07:24,880 --> 00:07:27,039
cannot be solved but it's becoming

216
00:07:26,319 --> 00:07:30,319
challenging

217
00:07:27,039 --> 00:07:31,440
so when we look at our offensive

218
00:07:30,319 --> 00:07:35,199
infrastructure we have

219
00:07:31,440 --> 00:07:38,319
two main typical challenges one being

220
00:07:35,199 --> 00:07:41,440
oversight the other one being inside

221
00:07:38,319 --> 00:07:41,840
with oversight i mean just keeping track

222
00:07:41,440 --> 00:07:43,919
of

223
00:07:41,840 --> 00:07:45,840
where your infrastructure is what the

224
00:07:43,919 --> 00:07:46,560
state of it is it up is it running is it

225
00:07:45,840 --> 00:07:49,680
is it okay

226
00:07:46,560 --> 00:07:51,759
is it in some way you are

227
00:07:49,680 --> 00:07:54,240
hurting your own infrastructure multiple

228
00:07:51,759 --> 00:07:55,919
components multiple different things

229
00:07:54,240 --> 00:07:58,080
multiple engagements all together a lot

230
00:07:55,919 --> 00:08:01,680
of data components to keep

231
00:07:58,080 --> 00:08:04,800
track of insight is more oriented on the

232
00:08:01,680 --> 00:08:06,879
fact well besides if it's up and running

233
00:08:04,800 --> 00:08:09,120
is there data in there that can help us

234
00:08:06,879 --> 00:08:10,960
to do a better operation

235
00:08:09,120 --> 00:08:12,879
do we have a proper insight over

236
00:08:10,960 --> 00:08:15,280
infrastructure

237
00:08:12,879 --> 00:08:17,199
looking at other fields we see quite a

238
00:08:15,280 --> 00:08:19,810
resemblance if you look on how

239
00:08:17,199 --> 00:08:21,120
those challenges are being solved

240
00:08:19,810 --> 00:08:24,479
[Music]

241
00:08:21,120 --> 00:08:24,879
so if we look at cowboys i just said the

242
00:08:24,479 --> 00:08:28,080
name

243
00:08:24,879 --> 00:08:30,400
of the term herding to some extent

244
00:08:28,080 --> 00:08:31,759
we need to hurt our own infrastructure

245
00:08:30,400 --> 00:08:35,039
and cowboys have the same

246
00:08:31,759 --> 00:08:37,200
way of hurting their cattle and

247
00:08:35,039 --> 00:08:39,760
use dogs to keep everything in control

248
00:08:37,200 --> 00:08:44,240
and that gives them some way to

249
00:08:39,760 --> 00:08:46,480
manage the hurt in that sense um

250
00:08:44,240 --> 00:08:47,760
if you look at the inside i'd like to

251
00:08:46,480 --> 00:08:50,959
refer back to

252
00:08:47,760 --> 00:08:53,120
mr edmund lokar which was actually the

253
00:08:50,959 --> 00:08:54,560
true shirley bones it was a french

254
00:08:53,120 --> 00:08:57,040
the french shell of holmes and he was

255
00:08:54,560 --> 00:09:00,240
the one who put forensic science into

256
00:08:57,040 --> 00:09:03,360
the field of forensics he was the one

257
00:09:00,240 --> 00:09:07,440
first to start measuring things having

258
00:09:03,360 --> 00:09:09,200
forensic approaches to having a

259
00:09:07,440 --> 00:09:11,680
academic approaches to to forensic

260
00:09:09,200 --> 00:09:14,880
science scientific approaches

261
00:09:11,680 --> 00:09:17,519
early 20th century and why do i

262
00:09:14,880 --> 00:09:19,519
uh bring in this guy into the talk

263
00:09:17,519 --> 00:09:21,760
because his most family known for his

264
00:09:19,519 --> 00:09:23,279
is on the low-cost exchange principle

265
00:09:21,760 --> 00:09:26,800
which means every

266
00:09:23,279 --> 00:09:27,760
contact leaves a trace and this is

267
00:09:26,800 --> 00:09:31,760
actually very much

268
00:09:27,760 --> 00:09:34,720
true for our own operation as you know

269
00:09:31,760 --> 00:09:36,160
every offensive action that we do it

270
00:09:34,720 --> 00:09:39,200
will leave a trace on the system

271
00:09:36,160 --> 00:09:42,240
it's up to blue to digest to see

272
00:09:39,200 --> 00:09:44,959
and digest and inspect the trace

273
00:09:42,240 --> 00:09:46,560
but it's impossible to touch a system to

274
00:09:44,959 --> 00:09:49,040
perform an action to

275
00:09:46,560 --> 00:09:50,880
remotely do something without leaving a

276
00:09:49,040 --> 00:09:53,839
trace

277
00:09:50,880 --> 00:09:54,959
but now it's the fun thing it also goes

278
00:09:53,839 --> 00:09:57,200
the other way around

279
00:09:54,959 --> 00:10:00,640
it's impossible for blue to do things

280
00:09:57,200 --> 00:10:00,640
without leaving a trace

281
00:10:00,720 --> 00:10:05,200
so if you know where you need to look

282
00:10:02,399 --> 00:10:06,000
for both blue side as well as red sides

283
00:10:05,200 --> 00:10:08,320
you can see

284
00:10:06,000 --> 00:10:09,680
actions of the other ones going and if

285
00:10:08,320 --> 00:10:13,360
you're looking if you're talking about

286
00:10:09,680 --> 00:10:15,519
traces by adversaries by red teams

287
00:10:13,360 --> 00:10:16,640
it's quite common to have a thing like a

288
00:10:15,519 --> 00:10:18,640
scene or have

289
00:10:16,640 --> 00:10:20,160
a security operation center or cyber

290
00:10:18,640 --> 00:10:22,399
defense center or

291
00:10:20,160 --> 00:10:23,600
anyway a team of people investigating

292
00:10:22,399 --> 00:10:27,920
traces and

293
00:10:23,600 --> 00:10:31,360
seeing things the other way around

294
00:10:27,920 --> 00:10:34,480
well during operations

295
00:10:31,360 --> 00:10:37,600
we were in need of such a thing so

296
00:10:34,480 --> 00:10:38,399
looking at the tools that we had at wait

297
00:10:37,600 --> 00:10:41,120
so there is

298
00:10:38,399 --> 00:10:42,880
ways of hurting your infrastructure and

299
00:10:41,120 --> 00:10:45,200
we needed a way to actually do some

300
00:10:42,880 --> 00:10:46,560
investigation on our infrastructure

301
00:10:45,200 --> 00:10:48,240
we started looking in the open source

302
00:10:46,560 --> 00:10:49,839
world and we didn't find anything and

303
00:10:48,240 --> 00:10:53,680
that is what actually red dock came

304
00:10:49,839 --> 00:10:56,160
about red elk is a tool ready to be used

305
00:10:53,680 --> 00:10:58,079
open sourced it's available on our

306
00:10:56,160 --> 00:11:01,440
github and you can use it for

307
00:10:58,079 --> 00:11:04,399
keeping oversight of your infrastructure

308
00:11:01,440 --> 00:11:06,720
as well as having insight into what is

309
00:11:04,399 --> 00:11:08,399
happening in the operation

310
00:11:06,720 --> 00:11:10,240
and it's important to understand both

311
00:11:08,399 --> 00:11:12,880
aspects of this um

312
00:11:10,240 --> 00:11:14,480
and red elk is during operation by us

313
00:11:12,880 --> 00:11:15,360
and by the other ones we use it most

314
00:11:14,480 --> 00:11:18,480
often used

315
00:11:15,360 --> 00:11:20,000
uh you've got your live hacking console

316
00:11:18,480 --> 00:11:22,560
of your c2 infrastructure

317
00:11:20,000 --> 00:11:23,680
uh your c2 server your construct client

318
00:11:22,560 --> 00:11:25,279
for example

319
00:11:23,680 --> 00:11:26,880
you do your live hacky hacky hacky

320
00:11:25,279 --> 00:11:28,560
commands and then there is a

321
00:11:26,880 --> 00:11:30,079
second window open where you have the

322
00:11:28,560 --> 00:11:33,120
red dog interface

323
00:11:30,079 --> 00:11:34,480
web interface rather available and it

324
00:11:33,120 --> 00:11:36,000
helps you with just having

325
00:11:34,480 --> 00:11:38,000
well the oversight of the operation

326
00:11:36,000 --> 00:11:40,839
inside and you will see traffic data

327
00:11:38,000 --> 00:11:42,160
coming in operation data coming in etc

328
00:11:40,839 --> 00:11:45,440
etc

329
00:11:42,160 --> 00:11:47,120
like i said it's available on a github

330
00:11:45,440 --> 00:11:48,800
and i've written a few blog posts

331
00:11:47,120 --> 00:11:50,959
explaining why we need it

332
00:11:48,800 --> 00:11:52,639
getting you up and running and achieving

333
00:11:50,959 --> 00:11:54,079
operational oversight and in the next

334
00:11:52,639 --> 00:11:54,560
few months there will be some more

335
00:11:54,079 --> 00:11:58,720
blocks

336
00:11:54,560 --> 00:11:58,720
probably coming out um

337
00:11:59,440 --> 00:12:03,839
red elk the name of course comes from

338
00:12:02,000 --> 00:12:05,760
red being offensively oriented

339
00:12:03,839 --> 00:12:07,680
and elk being elasticsearch lobster

340
00:12:05,760 --> 00:12:10,320
kibana the technical

341
00:12:07,680 --> 00:12:11,040
stack that we choose for actually making

342
00:12:10,320 --> 00:12:14,320
this

343
00:12:11,040 --> 00:12:17,920
this tool so

344
00:12:14,320 --> 00:12:19,279
diving into red oak looking at your

345
00:12:17,920 --> 00:12:22,480
infrastructure again

346
00:12:19,279 --> 00:12:24,720
a slightly different approach to this

347
00:12:22,480 --> 00:12:25,680
on the most left you have the target

348
00:12:24,720 --> 00:12:27,279
network

349
00:12:25,680 --> 00:12:28,880
you've got your implant running so

350
00:12:27,279 --> 00:12:30,720
there's attack and c2 traffic

351
00:12:28,880 --> 00:12:32,720
going first to your three defectors or

352
00:12:30,720 --> 00:12:34,800
your first line infra

353
00:12:32,720 --> 00:12:37,120
and from there on it's being filtered

354
00:12:34,800 --> 00:12:38,079
and is being put on to your c2 service

355
00:12:37,120 --> 00:12:41,200
that you have in your

356
00:12:38,079 --> 00:12:43,040
in your back end nothing new here how

357
00:12:41,200 --> 00:12:46,000
does red dot fit into this whole process

358
00:12:43,040 --> 00:12:46,720
well here you've got a red hook it's in

359
00:12:46,000 --> 00:12:49,279
your

360
00:12:46,720 --> 00:12:50,720
local infrastructure we have it on-prem

361
00:12:49,279 --> 00:12:51,760
you could be running it in cloud we

362
00:12:50,720 --> 00:12:54,639
prefer to have it

363
00:12:51,760 --> 00:12:55,279
on-prem but there are connectors

364
00:12:54,639 --> 00:12:57,600
installed

365
00:12:55,279 --> 00:12:59,279
both on your d-detectors as well as on

366
00:12:57,600 --> 00:13:02,160
your c2 servers

367
00:12:59,279 --> 00:13:03,200
data connectors data feeds we use file

368
00:13:02,160 --> 00:13:07,680
beats a lot

369
00:13:03,200 --> 00:13:10,079
and from there on it is put into

370
00:13:07,680 --> 00:13:11,040
a log stack filtering and it's put into

371
00:13:10,079 --> 00:13:12,800
an elastic

372
00:13:11,040 --> 00:13:14,800
nosql database and kibana is the

373
00:13:12,800 --> 00:13:17,200
interface the web interface actually

374
00:13:14,800 --> 00:13:18,720
searching through the data and that goes

375
00:13:17,200 --> 00:13:20,959
both for the heat effectors as well for

376
00:13:18,720 --> 00:13:22,240
the c2 server components or you could be

377
00:13:20,959 --> 00:13:23,839
hosting your own uh

378
00:13:22,240 --> 00:13:25,680
website or whatever you can pull the

379
00:13:23,839 --> 00:13:29,120
data and actually put it into

380
00:13:25,680 --> 00:13:33,040
the index of coretta and there's also

381
00:13:29,120 --> 00:13:34,240
data copy um happening on the backside

382
00:13:33,040 --> 00:13:36,720
so there are some rsync scripts

383
00:13:34,240 --> 00:13:39,680
happening to actually copy

384
00:13:36,720 --> 00:13:40,399
downloaded files to have screenshots and

385
00:13:39,680 --> 00:13:43,440
all kinds of other

386
00:13:40,399 --> 00:13:44,399
operational data of your uh data of your

387
00:13:43,440 --> 00:13:47,120
operation

388
00:13:44,399 --> 00:13:48,959
and put it back to your central red dog

389
00:13:47,120 --> 00:13:50,880
server

390
00:13:48,959 --> 00:13:52,880
because well in the end you will have

391
00:13:50,880 --> 00:13:54,240
five six or whatever c2 service for a

392
00:13:52,880 --> 00:13:56,480
single operation

393
00:13:54,240 --> 00:13:58,480
you do not want to be logging into every

394
00:13:56,480 --> 00:14:00,959
specific c2

395
00:13:58,480 --> 00:14:02,160
server to search for that specific

396
00:14:00,959 --> 00:14:02,880
screenshot you want to have it all

397
00:14:02,160 --> 00:14:06,720
centrally

398
00:14:02,880 --> 00:14:09,279
locally in your header instance

399
00:14:06,720 --> 00:14:11,440
reddog does a few things it indexes data

400
00:14:09,279 --> 00:14:14,160
it enriches data that is coming in

401
00:14:11,440 --> 00:14:15,680
it has lots of dashboards in there you

402
00:14:14,160 --> 00:14:16,959
can create your own dashboards and

403
00:14:15,680 --> 00:14:19,920
there's lots of search

404
00:14:16,959 --> 00:14:21,920
well it's it's a search based solution

405
00:14:19,920 --> 00:14:25,199
so that's the core functionality of any

406
00:14:21,920 --> 00:14:26,880
logstash or elastic stack it's based on

407
00:14:25,199 --> 00:14:28,160
open source tools use so you can modify

408
00:14:26,880 --> 00:14:30,320
it yourself and change

409
00:14:28,160 --> 00:14:31,839
dashboards or whatever you can you can

410
00:14:30,320 --> 00:14:34,720
are freely free to do that

411
00:14:31,839 --> 00:14:37,040
for yourself in recent versions we have

412
00:14:34,720 --> 00:14:40,079
also added

413
00:14:37,040 --> 00:14:42,959
a neo4j docker instance as well as a

414
00:14:40,079 --> 00:14:44,160
jupyter notebook docker instance meaning

415
00:14:42,959 --> 00:14:47,360
that the neo4j

416
00:14:44,160 --> 00:14:50,800
is used to import

417
00:14:47,360 --> 00:14:52,240
output from bloodhounds so besides the

418
00:14:50,800 --> 00:14:53,839
elastic stack

419
00:14:52,240 --> 00:14:55,760
you will have also a docker instance

420
00:14:53,839 --> 00:14:56,959
with neo4j and you have a jupyter

421
00:14:55,760 --> 00:14:59,760
notebook for

422
00:14:56,959 --> 00:15:01,279
quick searching through data and this is

423
00:14:59,760 --> 00:15:02,639
really awesome because now you have

424
00:15:01,279 --> 00:15:04,079
operational data of your c2

425
00:15:02,639 --> 00:15:06,480
infrastructure as well as from

426
00:15:04,079 --> 00:15:08,240
traffic data but you also have knowledge

427
00:15:06,480 --> 00:15:09,600
about the active directory environment

428
00:15:08,240 --> 00:15:10,959
of your target

429
00:15:09,600 --> 00:15:12,560
and by using the power of jupyter

430
00:15:10,959 --> 00:15:14,639
notebooks you can make very quick

431
00:15:12,560 --> 00:15:17,120
queries on

432
00:15:14,639 --> 00:15:19,360
pulling data or matching data both

433
00:15:17,120 --> 00:15:21,440
output from the c2 server as well as

434
00:15:19,360 --> 00:15:23,440
data that is within the neo4j instance

435
00:15:21,440 --> 00:15:26,800
for example you could be

436
00:15:23,440 --> 00:15:29,440
searching for usernames that are

437
00:15:26,800 --> 00:15:30,880
or new incoming beacons and pick out the

438
00:15:29,440 --> 00:15:33,199
username and immediately

439
00:15:30,880 --> 00:15:34,720
go through your neo4j instance and see

440
00:15:33,199 --> 00:15:37,440
what if this is a path

441
00:15:34,720 --> 00:15:38,399
going to actually domain admin or any

442
00:15:37,440 --> 00:15:40,399
type of

443
00:15:38,399 --> 00:15:41,680
input that you would like and the

444
00:15:40,399 --> 00:15:42,560
jupyter the notebooks is a way to

445
00:15:41,680 --> 00:15:44,480
actually

446
00:15:42,560 --> 00:15:46,639
quickly make those queries and actually

447
00:15:44,480 --> 00:15:48,480
quick generate quick output

448
00:15:46,639 --> 00:15:50,000
it's really awesome and once you get

449
00:15:48,480 --> 00:15:52,480
used to this really powerful junior

450
00:15:50,000 --> 00:15:52,480
operation

451
00:15:53,440 --> 00:15:57,759
that's the core red elk um with both the

452
00:15:56,240 --> 00:15:58,720
red team and you might as well give the

453
00:15:57,759 --> 00:16:00,800
white team some

454
00:15:58,720 --> 00:16:01,920
access to dashboards and as well as you

455
00:16:00,800 --> 00:16:05,040
on the whole interface

456
00:16:01,920 --> 00:16:05,839
uh right now we mainly use for the red

457
00:16:05,040 --> 00:16:08,000
team

458
00:16:05,839 --> 00:16:09,839
and we use jupiter notebooks to make

459
00:16:08,000 --> 00:16:10,639
data extracts that we can give to the

460
00:16:09,839 --> 00:16:12,959
white team but

461
00:16:10,639 --> 00:16:14,560
hey do your thing you can quickly give

462
00:16:12,959 --> 00:16:18,800
access to your white team

463
00:16:14,560 --> 00:16:18,800
you get the volume access to readout

464
00:16:19,680 --> 00:16:23,759
but looking at the oversight there's

465
00:16:21,360 --> 00:16:24,720
still a target sock or a sock within the

466
00:16:23,759 --> 00:16:27,600
target network

467
00:16:24,720 --> 00:16:28,240
and as analysts do they start analyzing

468
00:16:27,600 --> 00:16:31,360
when they have

469
00:16:28,240 --> 00:16:33,759
a hunch of something that's going bad so

470
00:16:31,360 --> 00:16:34,480
they are doing several things they are

471
00:16:33,759 --> 00:16:38,959
in

472
00:16:34,480 --> 00:16:41,440
analyzing investigating uh your info

473
00:16:38,959 --> 00:16:42,480
so they might be querying your specific

474
00:16:41,440 --> 00:16:45,120
data vectors

475
00:16:42,480 --> 00:16:46,880
or they will put data onto what i call

476
00:16:45,120 --> 00:16:48,320
online security search providers think

477
00:16:46,880 --> 00:16:51,120
spam house firewall

478
00:16:48,320 --> 00:16:52,000
ibm x4 multiple different domain

479
00:16:51,120 --> 00:16:55,600
classifiers

480
00:16:52,000 --> 00:16:57,759
span sandboxes all kinds of different

481
00:16:55,600 --> 00:17:00,079
ways of analyzing pieces of malware as

482
00:16:57,759 --> 00:17:03,360
well as infrastructure

483
00:17:00,079 --> 00:17:05,760
now it's the fun thing that

484
00:17:03,360 --> 00:17:06,559
those security service providers as well

485
00:17:05,760 --> 00:17:08,319
will be

486
00:17:06,559 --> 00:17:09,839
there's these are automated things they

487
00:17:08,319 --> 00:17:12,240
start querying your infrastructure as

488
00:17:09,839 --> 00:17:13,760
well so if you look at the log data of

489
00:17:12,240 --> 00:17:15,199
your reader hectare you will see

490
00:17:13,760 --> 00:17:17,600
you might have the option of actually

491
00:17:15,199 --> 00:17:19,439
having a stock analyst

492
00:17:17,600 --> 00:17:20,880
investigating as well as some online

493
00:17:19,439 --> 00:17:22,240
security server providers they might be

494
00:17:20,880 --> 00:17:23,919
investigating your infrastructure they

495
00:17:22,240 --> 00:17:26,559
might be querying it they might be

496
00:17:23,919 --> 00:17:27,679
looking at your specific ui path of your

497
00:17:26,559 --> 00:17:30,160
implant

498
00:17:27,679 --> 00:17:32,640
with different user agents for example

499
00:17:30,160 --> 00:17:35,840
and now we're getting into the whole

500
00:17:32,640 --> 00:17:39,440
scene part because if you have

501
00:17:35,840 --> 00:17:42,720
a big pile of laws

502
00:17:39,440 --> 00:17:43,360
about your operations t2 servers as well

503
00:17:42,720 --> 00:17:47,039
as

504
00:17:43,360 --> 00:17:49,280
from your reader vectors uh traffic data

505
00:17:47,039 --> 00:17:50,480
you've got a big pile of logs and you

506
00:17:49,280 --> 00:17:52,799
have a whole base

507
00:17:50,480 --> 00:17:55,280
approach of looking for things that

508
00:17:52,799 --> 00:17:58,080
might be suspicious

509
00:17:55,280 --> 00:17:58,720
in your own data as well as querying

510
00:17:58,080 --> 00:18:01,679
online

511
00:17:58,720 --> 00:18:02,320
resources like virustotal to see if an

512
00:18:01,679 --> 00:18:04,480
iuc

513
00:18:02,320 --> 00:18:05,919
of your own implant or your own uploaded

514
00:18:04,480 --> 00:18:08,000
file

515
00:18:05,919 --> 00:18:09,039
is already known at virustotal for

516
00:18:08,000 --> 00:18:12,240
example

517
00:18:09,039 --> 00:18:15,280
well all of a sudden you have a c

518
00:18:12,240 --> 00:18:17,360
type of functionality um

519
00:18:15,280 --> 00:18:19,760
so this is where redderflux fits in into

520
00:18:17,360 --> 00:18:21,440
the bigger picture

521
00:18:19,760 --> 00:18:22,799
if you look at the logs of your video

522
00:18:21,440 --> 00:18:24,720
effect as well as you see two servers

523
00:18:22,799 --> 00:18:26,880
you will see that there's not that much

524
00:18:24,720 --> 00:18:28,320
data in there so we will be needing to

525
00:18:26,880 --> 00:18:29,760
do some attachments

526
00:18:28,320 --> 00:18:31,520
and this is where well the data

527
00:18:29,760 --> 00:18:33,039
enrichment that we have with red dot

528
00:18:31,520 --> 00:18:36,240
comes in

529
00:18:33,039 --> 00:18:39,360
we do multiple things if we talk about

530
00:18:36,240 --> 00:18:40,160
traffic data we map it to guip data we

531
00:18:39,360 --> 00:18:43,120
check if it's a

532
00:18:40,160 --> 00:18:45,520
talk based address we take the ownership

533
00:18:43,120 --> 00:18:46,240
from iana databases we look at reverse

534
00:18:45,520 --> 00:18:48,960
dns

535
00:18:46,240 --> 00:18:50,320
and all that type of data we are putting

536
00:18:48,960 --> 00:18:51,520
into the same record and it's stored

537
00:18:50,320 --> 00:18:54,960
within the

538
00:18:51,520 --> 00:18:56,000
stack within the database we also query

539
00:18:54,960 --> 00:18:58,240
grey noise and for those

540
00:18:56,000 --> 00:19:00,240
who do not know grey noise grey noise is

541
00:18:58,240 --> 00:19:04,160
an excellent tool

542
00:19:00,240 --> 00:19:06,000
for seeing if it's the traffic that hits

543
00:19:04,160 --> 00:19:08,400
you if it's background noise or the

544
00:19:06,000 --> 00:19:10,400
internet yes or no

545
00:19:08,400 --> 00:19:11,679
background noise of the internet is just

546
00:19:10,400 --> 00:19:13,919
the commons cameras

547
00:19:11,679 --> 00:19:15,200
could be google indexing or could be

548
00:19:13,919 --> 00:19:18,720
common uh

549
00:19:15,200 --> 00:19:20,080
type of or c2 bot nets uh or it could be

550
00:19:18,720 --> 00:19:21,760
regular buttons that are just squaring

551
00:19:20,080 --> 00:19:25,120
the internet scanners

552
00:19:21,760 --> 00:19:27,520
things like that it is

553
00:19:25,120 --> 00:19:28,720
created for blue teams but also for red

554
00:19:27,520 --> 00:19:30,480
oriented

555
00:19:28,720 --> 00:19:31,919
aim it's also very interesting because

556
00:19:30,480 --> 00:19:34,400
if an address that

557
00:19:31,919 --> 00:19:37,120
is querying our infrastructure on a very

558
00:19:34,400 --> 00:19:40,799
specific path that matches or is our

559
00:19:37,120 --> 00:19:44,400
implant path and it's not

560
00:19:40,799 --> 00:19:44,960
known by gray noise then most likely you

561
00:19:44,400 --> 00:19:47,280
want to be

562
00:19:44,960 --> 00:19:49,120
aware of it and most likely an analyst

563
00:19:47,280 --> 00:19:51,840
is actually looking into it

564
00:19:49,120 --> 00:19:52,400
into looking into your operation if it's

565
00:19:51,840 --> 00:19:53,919
just

566
00:19:52,400 --> 00:19:55,840
if it's known by very nice it's most

567
00:19:53,919 --> 00:19:58,060
likely just something like the

568
00:19:55,840 --> 00:19:59,840
background noise of the internet

569
00:19:58,060 --> 00:20:03,600
[Music]

570
00:19:59,840 --> 00:20:05,679
online resources we can check at hybrid

571
00:20:03,600 --> 00:20:08,880
analysis for aristotle the abuse

572
00:20:05,679 --> 00:20:11,440
databases ibm xforce multiple

573
00:20:08,880 --> 00:20:12,720
online resources that we can query and

574
00:20:11,440 --> 00:20:15,520
take data from

575
00:20:12,720 --> 00:20:16,960
and use that for enrichment of the data

576
00:20:15,520 --> 00:20:20,559
within our

577
00:20:16,960 --> 00:20:22,799
stack and if you talk about c2

578
00:20:20,559 --> 00:20:24,159
data uh there is a component within

579
00:20:22,799 --> 00:20:27,120
headache that takes

580
00:20:24,159 --> 00:20:28,320
the locks from the c2 frameworks it

581
00:20:27,120 --> 00:20:30,159
needs to be aware of how

582
00:20:28,320 --> 00:20:31,919
it is locks are being set up and eastern

583
00:20:30,159 --> 00:20:34,000
enriched and that's what we do we have

584
00:20:31,919 --> 00:20:34,960
full support for cobblestrike up to the

585
00:20:34,000 --> 00:20:37,679
latest version

586
00:20:34,960 --> 00:20:39,039
as well as our own custom outflank stage

587
00:20:37,679 --> 00:20:40,960
1 c2

588
00:20:39,039 --> 00:20:42,400
which is also part of our two name

589
00:20:40,960 --> 00:20:44,400
offering

590
00:20:42,400 --> 00:20:46,080
full support in there and we are working

591
00:20:44,400 --> 00:20:49,120
for the other public ones

592
00:20:46,080 --> 00:20:50,720
c2 is let's say halfway basic logs are

593
00:20:49,120 --> 00:20:52,720
being ingested but the

594
00:20:50,720 --> 00:20:54,720
data copying of screenshots and things

595
00:20:52,720 --> 00:20:57,600
like that is not

596
00:20:54,720 --> 00:20:59,200
yet fully done about the same stage for

597
00:20:57,600 --> 00:21:01,919
from ethic

598
00:20:59,200 --> 00:21:02,880
mythic has created an option seam

599
00:21:01,919 --> 00:21:05,679
logging option

600
00:21:02,880 --> 00:21:06,000
that you need to enable if you install

601
00:21:05,679 --> 00:21:07,840
the

602
00:21:06,000 --> 00:21:09,919
the team server from there on if you

603
00:21:07,840 --> 00:21:12,480
install the catalog

604
00:21:09,919 --> 00:21:14,000
component it actually takes away takes

605
00:21:12,480 --> 00:21:16,960
up the logs

606
00:21:14,000 --> 00:21:18,799
ingests them properly um but there's no

607
00:21:16,960 --> 00:21:19,280
data copying happening on screenshots

608
00:21:18,799 --> 00:21:21,760
just yet

609
00:21:19,280 --> 00:21:23,360
working on that on the longer roadmap

610
00:21:21,760 --> 00:21:23,840
we're also working at covenant as well

611
00:21:23,360 --> 00:21:27,280
as

612
00:21:23,840 --> 00:21:30,000
skype and you are free to

613
00:21:27,280 --> 00:21:30,960
make your own connected to your own ic2

614
00:21:30,000 --> 00:21:34,480
infrastructure or

615
00:21:30,960 --> 00:21:35,120
your own c2 tool uh in the end it's just

616
00:21:34,480 --> 00:21:37,679
based on

617
00:21:35,120 --> 00:21:39,039
normal log stage rules it's all open

618
00:21:37,679 --> 00:21:43,919
source and you can

619
00:21:39,039 --> 00:21:46,400
go nuts if you like okay data enrichment

620
00:21:43,919 --> 00:21:48,159
it's a lot about talking about

621
00:21:46,400 --> 00:21:50,799
what we do let's see how it works into

622
00:21:48,159 --> 00:21:52,559
practice let's start with the interface

623
00:21:50,799 --> 00:21:53,840
that you as a veteran operator will see

624
00:21:52,559 --> 00:21:54,960
and from there on we go into

625
00:21:53,840 --> 00:21:57,840
investigation

626
00:21:54,960 --> 00:21:58,559
of our blue team's bluetooth activity

627
00:21:57,840 --> 00:22:01,200
first about

628
00:21:58,559 --> 00:22:03,840
let's see how it works kibana is the web

629
00:22:01,200 --> 00:22:07,280
interface and from here on you just

630
00:22:03,840 --> 00:22:09,120
log in to the interface username

631
00:22:07,280 --> 00:22:09,520
password based and from here on you will

632
00:22:09,120 --> 00:22:13,840
see

633
00:22:09,520 --> 00:22:13,840
that it's a normal kibana interface

634
00:22:13,919 --> 00:22:17,440
and we have several pre-made views for

635
00:22:17,039 --> 00:22:20,799
you

636
00:22:17,440 --> 00:22:22,720
that are most often used meaning that it

637
00:22:20,799 --> 00:22:23,280
has the right columns and red names and

638
00:22:22,720 --> 00:22:25,120
the right

639
00:22:23,280 --> 00:22:26,640
filters already made so i click here on

640
00:22:25,120 --> 00:22:28,320
the heat effect traffic

641
00:22:26,640 --> 00:22:29,679
meaning that it will give you a tabular

642
00:22:28,320 --> 00:22:31,200
view of

643
00:22:29,679 --> 00:22:32,799
in this case the last seven days of

644
00:22:31,200 --> 00:22:36,240
traffic that came in

645
00:22:32,799 --> 00:22:37,679
on anywhere where the data has been

646
00:22:36,240 --> 00:22:39,760
taken from you will see that there is a

647
00:22:37,679 --> 00:22:42,480
time stamp an attack scenario

648
00:22:39,760 --> 00:22:43,360
the back end name of the heat effector

649
00:22:42,480 --> 00:22:46,640
the

650
00:22:43,360 --> 00:22:47,520
traffic source fp source dns and the

651
00:22:46,640 --> 00:22:49,600
extra http

652
00:22:47,520 --> 00:22:51,039
request the attack scenario is an

653
00:22:49,600 --> 00:22:52,320
important one because during an

654
00:22:51,039 --> 00:22:54,640
operation you will

655
00:22:52,320 --> 00:22:56,880
most likely have short haul long haul or

656
00:22:54,640 --> 00:22:58,880
scenario one scenario scenario x if

657
00:22:56,880 --> 00:23:02,559
you're using a tiger so multiple

658
00:22:58,880 --> 00:23:04,480
scenarios during that specific attack

659
00:23:02,559 --> 00:23:06,480
and all the other names actually make

660
00:23:04,480 --> 00:23:07,919
sense if you look at the specific index

661
00:23:06,480 --> 00:23:09,440
that we're talking about so if we talk

662
00:23:07,919 --> 00:23:12,000
about redirected traffic

663
00:23:09,440 --> 00:23:12,559
let's go actually use that so let's

664
00:23:12,000 --> 00:23:14,080
filter

665
00:23:12,559 --> 00:23:15,840
this is just normal kibana interface

666
00:23:14,080 --> 00:23:19,039
stuff let's filter on

667
00:23:15,840 --> 00:23:22,880
only seeing a duck scenario a short haul

668
00:23:19,039 --> 00:23:25,679
you can expand the

669
00:23:22,880 --> 00:23:28,720
the data component or the object and you

670
00:23:25,679 --> 00:23:31,360
will see that there is guip data being

671
00:23:28,720 --> 00:23:33,760
enriched you will see the full log

672
00:23:31,360 --> 00:23:36,080
message as it was provided within the

673
00:23:33,760 --> 00:23:37,679
log and you will see several aspects as

674
00:23:36,080 --> 00:23:38,720
in the actual ip address of the font

675
00:23:37,679 --> 00:23:41,200
address the

676
00:23:38,720 --> 00:23:43,760
the the name that you use that uh the

677
00:23:41,200 --> 00:23:46,480
refresh proxy name so the content name

678
00:23:43,760 --> 00:23:46,960
um the program that was used in this

679
00:23:46,480 --> 00:23:50,559
case was

680
00:23:46,960 --> 00:23:53,440
apache you will also see that it knows

681
00:23:50,559 --> 00:23:55,600
how to digest the different headers

682
00:23:53,440 --> 00:23:58,880
in this case it makes sense because it

683
00:23:55,600 --> 00:24:02,559
was done via a cdn network

684
00:23:58,880 --> 00:24:04,799
and the cdn actually puts in the proper

685
00:24:02,559 --> 00:24:05,760
exported four headers etc that's being

686
00:24:04,799 --> 00:24:08,880
taken up by

687
00:24:05,760 --> 00:24:11,440
spread elk and it replaces two f has the

688
00:24:08,880 --> 00:24:13,520
proper source iphone there lots of

689
00:24:11,440 --> 00:24:16,840
chopping data in there happening

690
00:24:13,520 --> 00:24:20,080
and it presents you an easy incredible

691
00:24:16,840 --> 00:24:23,279
interface if we talk about

692
00:24:20,080 --> 00:24:25,360
c2 logs so no traffic log spots talking

693
00:24:23,279 --> 00:24:28,080
about your own c2 logs then we have

694
00:24:25,360 --> 00:24:29,760
the same approach it's still the same

695
00:24:28,080 --> 00:24:31,520
division between multiple attack

696
00:24:29,760 --> 00:24:33,679
scenarios

697
00:24:31,520 --> 00:24:35,120
you will already see that there isn't a

698
00:24:33,679 --> 00:24:37,760
target username target of the

699
00:24:35,120 --> 00:24:39,679
android ip internet internal ip address

700
00:24:37,760 --> 00:24:42,720
hosting things like that

701
00:24:39,679 --> 00:24:45,760
um that is

702
00:24:42,720 --> 00:24:46,720
the normal log message from cobblestrike

703
00:24:45,760 --> 00:24:50,240
and you will see

704
00:24:46,720 --> 00:24:53,120
that for every action within

705
00:24:50,240 --> 00:24:54,799
a cobblestone being done it has mapped

706
00:24:53,120 --> 00:24:55,840
the data from the top line being the

707
00:24:54,799 --> 00:24:58,400
username

708
00:24:55,840 --> 00:24:59,360
appears etc you can click on the link to

709
00:24:58,400 --> 00:25:01,679
have the full

710
00:24:59,360 --> 00:25:03,200
beacon lock and which most of often can

711
00:25:01,679 --> 00:25:04,960
be pretty big and from here on within

712
00:25:03,200 --> 00:25:05,840
your browser you can just simply control

713
00:25:04,960 --> 00:25:09,279
f to

714
00:25:05,840 --> 00:25:11,120
do quicker viewing sometimes just having

715
00:25:09,279 --> 00:25:12,080
such beacon log in text base is actually

716
00:25:11,120 --> 00:25:13,679
easier to use

717
00:25:12,080 --> 00:25:15,279
than the keyboard interface so from the

718
00:25:13,679 --> 00:25:16,159
kibana interface you have immediately

719
00:25:15,279 --> 00:25:19,520
just clicky

720
00:25:16,159 --> 00:25:21,870
uh you will have the actual beacon log

721
00:25:19,520 --> 00:25:23,600
same goes for the other c2 frameworks

722
00:25:21,870 --> 00:25:25,600
[Music]

723
00:25:23,600 --> 00:25:26,720
now in some cases you have during the

724
00:25:25,600 --> 00:25:28,240
operation you have made multiple

725
00:25:26,720 --> 00:25:30,720
screenshots and

726
00:25:28,240 --> 00:25:31,520
going back you will remember while there

727
00:25:30,720 --> 00:25:33,120
was this one

728
00:25:31,520 --> 00:25:34,960
system where i had the screenshot that

729
00:25:33,120 --> 00:25:37,200
kind of looks like

730
00:25:34,960 --> 00:25:39,200
it had this specific application in

731
00:25:37,200 --> 00:25:40,080
there well kibana or reddock has an

732
00:25:39,200 --> 00:25:42,400
interface with

733
00:25:40,080 --> 00:25:43,679
quick previews as well as full click to

734
00:25:42,400 --> 00:25:46,320
full resolution

735
00:25:43,679 --> 00:25:47,440
screenshots directly available to your

736
00:25:46,320 --> 00:25:48,559
web interface so

737
00:25:47,440 --> 00:25:50,159
because it's pulling from all the

738
00:25:48,559 --> 00:25:51,440
different team servers there's no need

739
00:25:50,159 --> 00:25:52,530
to log into all the different team

740
00:25:51,440 --> 00:25:53,840
servers

741
00:25:52,530 --> 00:25:55,679
[Music]

742
00:25:53,840 --> 00:25:57,039
the same approach goes for keystrokes as

743
00:25:55,679 --> 00:26:00,400
well as downloaded files

744
00:25:57,039 --> 00:26:02,720
another one is a central overview of all

745
00:26:00,400 --> 00:26:03,360
your iocs as you know that copper strike

746
00:26:02,720 --> 00:26:06,559
and your

747
00:26:03,360 --> 00:26:09,919
c2 framework will generate an ioc

748
00:26:06,559 --> 00:26:11,679
indicator that is being adjusted and

749
00:26:09,919 --> 00:26:13,919
from here on you have that view you can

750
00:26:11,679 --> 00:26:17,360
search through it but

751
00:26:13,919 --> 00:26:18,320
with the power of kibana you also have

752
00:26:17,360 --> 00:26:21,520
the option to

753
00:26:18,320 --> 00:26:23,200
quickly just export the data

754
00:26:21,520 --> 00:26:25,120
and present it to your white team so you

755
00:26:23,200 --> 00:26:27,120
go to share you will click on csv

756
00:26:25,120 --> 00:26:28,640
report you will generate the csv file it

757
00:26:27,120 --> 00:26:30,960
will take some time but now the red dot

758
00:26:28,640 --> 00:26:33,840
interface or the redex service is

759
00:26:30,960 --> 00:26:36,000
making the interface the file for you

760
00:26:33,840 --> 00:26:38,159
and it's just a csv based off the

761
00:26:36,000 --> 00:26:39,840
tab that you see right now the same can

762
00:26:38,159 --> 00:26:41,279
be done with jupiter notebooks but from

763
00:26:39,840 --> 00:26:44,400
here on it's just a quick

764
00:26:41,279 --> 00:26:46,000
quick click clicky way of having data in

765
00:26:44,400 --> 00:26:49,279
there

766
00:26:46,000 --> 00:26:51,120
easy to use this is about operation uh

767
00:26:49,279 --> 00:26:52,720
might be already that you think well

768
00:26:51,120 --> 00:26:54,400
this might be useful for your operation

769
00:26:52,720 --> 00:26:56,159
well i hope you do because it actually

770
00:26:54,400 --> 00:26:59,279
is really useful during your

771
00:26:56,159 --> 00:26:59,279
event operations

772
00:26:59,600 --> 00:27:03,200
let's talk about spotting bluetooth

773
00:27:01,600 --> 00:27:06,000
activity

774
00:27:03,200 --> 00:27:08,400
there are multiple ways of multiple

775
00:27:06,000 --> 00:27:09,039
areas and where we could be spotting any

776
00:27:08,400 --> 00:27:13,360
action

777
00:27:09,039 --> 00:27:14,400
of well action of a blue team and where

778
00:27:13,360 --> 00:27:17,279
they leave traces

779
00:27:14,400 --> 00:27:18,880
i'm talking about directly to your

780
00:27:17,279 --> 00:27:21,120
influence or traffic that is directly

781
00:27:18,880 --> 00:27:23,679
hitting our offensive infrastructure

782
00:27:21,120 --> 00:27:25,600
got a few examples in here we of also

783
00:27:23,679 --> 00:27:27,679
got indirect where we are querying

784
00:27:25,600 --> 00:27:29,840
online security service providers

785
00:27:27,679 --> 00:27:31,600
for any bluetooth activity and then

786
00:27:29,840 --> 00:27:34,640
there is a third category where

787
00:27:31,600 --> 00:27:35,200
we talk about internal checks so checks

788
00:27:34,640 --> 00:27:37,440
that your

789
00:27:35,200 --> 00:27:38,799
implant that is already inside the

790
00:27:37,440 --> 00:27:41,200
target network running

791
00:27:38,799 --> 00:27:42,960
it can do some queries and if it's doing

792
00:27:41,200 --> 00:27:44,640
the proper queries you will

793
00:27:42,960 --> 00:27:46,559
might spot some activity of the blue

794
00:27:44,640 --> 00:27:48,559
team

795
00:27:46,559 --> 00:27:50,159
some of these are fully included into

796
00:27:48,559 --> 00:27:52,080
red elk uh

797
00:27:50,159 --> 00:27:53,600
some we are working on and some are for

798
00:27:52,080 --> 00:27:55,039
a longer approach but

799
00:27:53,600 --> 00:27:56,720
first we want to talk about the concept

800
00:27:55,039 --> 00:27:58,159
and then we can talk about

801
00:27:56,720 --> 00:28:00,559
specifics that are implemented in the

802
00:27:58,159 --> 00:28:02,559
catalog as well and if you believe that

803
00:28:00,559 --> 00:28:04,640
we are not quick enough with development

804
00:28:02,559 --> 00:28:07,279
it's an open source project come join us

805
00:28:04,640 --> 00:28:07,279
can help us

806
00:28:08,080 --> 00:28:13,679
we need to discuss how the redirectors

807
00:28:11,360 --> 00:28:15,600
make the decision and how a red arc

808
00:28:13,679 --> 00:28:17,760
feeds into this so when we're talking

809
00:28:15,600 --> 00:28:20,159
about traffic that is already generating

810
00:28:17,760 --> 00:28:21,919
from the actual implant

811
00:28:20,159 --> 00:28:24,000
that's one way the other traffic that

812
00:28:21,919 --> 00:28:26,080
might be hitting a redirector is

813
00:28:24,000 --> 00:28:27,679
non-target related could be scanners

814
00:28:26,080 --> 00:28:31,039
could be just a regular internet

815
00:28:27,679 --> 00:28:31,840
traffic your redirector makes a decision

816
00:28:31,039 --> 00:28:33,679
based on

817
00:28:31,840 --> 00:28:36,640
whatever rule you put in there so this

818
00:28:33,679 --> 00:28:39,039
is just a h.a proxy or apache or any way

819
00:28:36,640 --> 00:28:41,360
that you configure your reverse proxy

820
00:28:39,039 --> 00:28:43,200
and it will make a decision to either

821
00:28:41,360 --> 00:28:46,880
forward that

822
00:28:43,200 --> 00:28:48,159
session to your back end your true c2

823
00:28:46,880 --> 00:28:50,320
backend or

824
00:28:48,159 --> 00:28:52,799
a decoder website or forwarded to a

825
00:28:50,320 --> 00:28:54,640
different website

826
00:28:52,799 --> 00:28:57,120
the logs that are being put out by aj

827
00:28:54,640 --> 00:28:58,640
proxy or apache or nginx or whatever

828
00:28:57,120 --> 00:29:00,640
reverse property that you use

829
00:28:58,640 --> 00:29:03,520
those are being ingested by red elf and

830
00:29:00,640 --> 00:29:06,640
you will you saw them in the interface

831
00:29:03,520 --> 00:29:08,720
but for weather it's important to

832
00:29:06,640 --> 00:29:10,399
have the proper logging so when you do

833
00:29:08,720 --> 00:29:14,240
the installation you actually need to

834
00:29:10,399 --> 00:29:17,039
change the logging of your proxy tooling

835
00:29:14,240 --> 00:29:20,240
but also specific requirements for the

836
00:29:17,039 --> 00:29:22,960
naming of your backhands

837
00:29:20,240 --> 00:29:25,600
if you rather need to be aware of what

838
00:29:22,960 --> 00:29:28,159
is a decoy and what is a c2 backhand so

839
00:29:25,600 --> 00:29:29,279
any type of c2 could be or should be

840
00:29:28,159 --> 00:29:32,720
named with c2

841
00:29:29,279 --> 00:29:33,520
dash whatever any type of decoy or

842
00:29:32,720 --> 00:29:36,399
deflecting

843
00:29:33,520 --> 00:29:38,000
should be starting with decoy dash and

844
00:29:36,399 --> 00:29:40,159
whatever

845
00:29:38,000 --> 00:29:43,120
based on that decision reload will also

846
00:29:40,159 --> 00:29:43,120
help you with alarms

847
00:29:44,000 --> 00:29:47,120
the redirect is making decisions that's

848
00:29:45,840 --> 00:29:48,799
important

849
00:29:47,120 --> 00:29:50,640
okay once you have that up and running

850
00:29:48,799 --> 00:29:51,760
you will see in the interface of radar

851
00:29:50,640 --> 00:29:55,279
that

852
00:29:51,760 --> 00:29:56,080
well an analyst might be connecting to

853
00:29:55,279 --> 00:29:58,559
your

854
00:29:56,080 --> 00:30:00,159
infra could be well eventually being

855
00:29:58,559 --> 00:30:02,880
hooded to a decoy website or

856
00:30:00,159 --> 00:30:04,399
both to or to a c2 back end and

857
00:30:02,880 --> 00:30:06,799
especially traffic going to

858
00:30:04,399 --> 00:30:08,799
euro c2 back and it's interesting and

859
00:30:06,799 --> 00:30:10,799
more than once you will see

860
00:30:08,799 --> 00:30:12,159
at least we have seen and i guess you

861
00:30:10,799 --> 00:30:13,760
will as well that

862
00:30:12,159 --> 00:30:15,600
when a blue team is doing investigation

863
00:30:13,760 --> 00:30:17,200
manual investigation they're using

864
00:30:15,600 --> 00:30:21,360
python or crew or maybe

865
00:30:17,200 --> 00:30:23,279
powershell or and not very

866
00:30:21,360 --> 00:30:24,799
not every time they will be changing the

867
00:30:23,279 --> 00:30:26,480
actual

868
00:30:24,799 --> 00:30:28,799
uh user agent so where you will see

869
00:30:26,480 --> 00:30:30,960
python user agents coming in

870
00:30:28,799 --> 00:30:33,919
and more than once we've seen that they

871
00:30:30,960 --> 00:30:36,559
first tried it from the

872
00:30:33,919 --> 00:30:37,360
breakout point of their sock internet

873
00:30:36,559 --> 00:30:39,360
uplink

874
00:30:37,360 --> 00:30:41,360
but also maybe via a top address so

875
00:30:39,360 --> 00:30:42,799
multiple ways that will be querying your

876
00:30:41,360 --> 00:30:44,080
depending on the actual path and the

877
00:30:42,799 --> 00:30:45,840
backhand that is being chosen by your

878
00:30:44,080 --> 00:30:46,159
lead effector this is interesting to see

879
00:30:45,840 --> 00:30:48,399
well

880
00:30:46,159 --> 00:30:50,559
is there any happening any investigation

881
00:30:48,399 --> 00:30:53,120
going on

882
00:30:50,559 --> 00:30:54,320
another one that once you have the logs

883
00:30:53,120 --> 00:30:56,000
in there

884
00:30:54,320 --> 00:30:57,440
is interesting to see is that if they

885
00:30:56,000 --> 00:31:01,360
are the blue team is

886
00:30:57,440 --> 00:31:03,679
sharing uh the url of

887
00:31:01,360 --> 00:31:04,960
a thing to be investigated some instant

888
00:31:03,679 --> 00:31:08,480
messaging clients

889
00:31:04,960 --> 00:31:11,600
actually tried to preview that specific

890
00:31:08,480 --> 00:31:13,840
uh website so in this

891
00:31:11,600 --> 00:31:14,640
case it's an example of telegram but all

892
00:31:13,840 --> 00:31:17,600
the other ones

893
00:31:14,640 --> 00:31:18,799
are basically the same they will try to

894
00:31:17,600 --> 00:31:21,279
make a preview

895
00:31:18,799 --> 00:31:23,120
and as you type they for every new

896
00:31:21,279 --> 00:31:25,600
character they will be trying to

897
00:31:23,120 --> 00:31:26,320
get a preview of the voice so they will

898
00:31:25,600 --> 00:31:29,679
be connecting

899
00:31:26,320 --> 00:31:33,039
to that host interesting to see

900
00:31:29,679 --> 00:31:35,120
and a clear indicator if well you see

901
00:31:33,039 --> 00:31:37,039
these types of

902
00:31:35,120 --> 00:31:39,360
instant messaging apps with a user agent

903
00:31:37,039 --> 00:31:40,080
come by and querying your c2 backend

904
00:31:39,360 --> 00:31:43,120
infrastructure

905
00:31:40,080 --> 00:31:44,720
that's interesting so that's directly

906
00:31:43,120 --> 00:31:47,279
oriented at your

907
00:31:44,720 --> 00:31:50,720
own infra let's talk about in effect so

908
00:31:47,279 --> 00:31:53,120
far online security service providers

909
00:31:50,720 --> 00:31:55,279
what i'm showing you here is the

910
00:31:53,120 --> 00:31:56,159
interface that a blue team would have in

911
00:31:55,279 --> 00:32:01,360
this case for

912
00:31:56,159 --> 00:32:04,240
a semantic the adr product synthetic atp

913
00:32:01,360 --> 00:32:05,840
and i've highlighted those little checks

914
00:32:04,240 --> 00:32:07,840
or options where it says

915
00:32:05,840 --> 00:32:10,320
submit to sandbox or submit to

916
00:32:07,840 --> 00:32:12,320
virustotal

917
00:32:10,320 --> 00:32:13,600
well you might think that's not smart to

918
00:32:12,320 --> 00:32:15,919
do

919
00:32:13,600 --> 00:32:17,760
because once again virustotal it will

920
00:32:15,919 --> 00:32:19,760
have a hash and we as an

921
00:32:17,760 --> 00:32:21,279
uh red team we know the hashes over our

922
00:32:19,760 --> 00:32:22,960
pieces of malware so we can query

923
00:32:21,279 --> 00:32:24,640
various total well have you got results

924
00:32:22,960 --> 00:32:25,440
for this specific hash and viruses will

925
00:32:24,640 --> 00:32:27,600
tell you

926
00:32:25,440 --> 00:32:29,600
no it's not or if it's there then most

927
00:32:27,600 --> 00:32:30,559
likely as we have not uploaded the

928
00:32:29,600 --> 00:32:32,559
malware piece

929
00:32:30,559 --> 00:32:34,399
ourselves the blue team has and then

930
00:32:32,559 --> 00:32:36,159
there is a big indicator that

931
00:32:34,399 --> 00:32:38,320
you have been compromised but the attack

932
00:32:36,159 --> 00:32:40,799
is compromised

933
00:32:38,320 --> 00:32:42,880
any blue team should know this but it's

934
00:32:40,799 --> 00:32:44,880
made very easy for them to still click

935
00:32:42,880 --> 00:32:48,720
on that button this is semantic

936
00:32:44,880 --> 00:32:50,880
this is microsoft uh the wd

937
00:32:48,720 --> 00:32:53,279
atp so the modera protection central

938
00:32:50,880 --> 00:32:54,399
portal there is a check for virustotal

939
00:32:53,279 --> 00:32:57,039
and there is

940
00:32:54,399 --> 00:32:57,840
an option of clicking into or submitted

941
00:32:57,039 --> 00:33:02,640
to the

942
00:32:57,840 --> 00:33:02,640
deep analysis which is just a sandbox

943
00:33:02,799 --> 00:33:06,320
it's made very easy for them to click on

944
00:33:05,519 --> 00:33:09,600
those links

945
00:33:06,320 --> 00:33:11,679
talking about sandboxes um

946
00:33:09,600 --> 00:33:13,919
you could be deflecting traffic from

947
00:33:11,679 --> 00:33:15,120
your coming from sandboxes based on

948
00:33:13,919 --> 00:33:17,840
source ip address

949
00:33:15,120 --> 00:33:18,880
uh to a specific b chord backend or your

950
00:33:17,840 --> 00:33:20,640
heat director or you

951
00:33:18,880 --> 00:33:22,399
could just let them come in either way

952
00:33:20,640 --> 00:33:25,600
you could be

953
00:33:22,399 --> 00:33:28,799
check the characteristics of that

954
00:33:25,600 --> 00:33:29,840
av sandbox connection uh and have an

955
00:33:28,799 --> 00:33:33,760
alarm in there

956
00:33:29,840 --> 00:33:36,320
having a clear indicator so

957
00:33:33,760 --> 00:33:37,120
doing some tests during the training

958
00:33:36,320 --> 00:33:39,840
that we did

959
00:33:37,120 --> 00:33:40,559
uh this is just a mapping of i believe

960
00:33:39,840 --> 00:33:42,960
it was over

961
00:33:40,559 --> 00:33:44,080
an eight hour period when on purpose we

962
00:33:42,960 --> 00:33:46,320
actually tried to hit sandbox

963
00:33:44,080 --> 00:33:47,919
connections just have a bigger data set

964
00:33:46,320 --> 00:33:49,760
of how sandbox connections looks like

965
00:33:47,919 --> 00:33:50,880
and this most likely maps back to your

966
00:33:49,760 --> 00:33:52,000
own experience that you might have for

967
00:33:50,880 --> 00:33:54,960
the sandbox connection

968
00:33:52,000 --> 00:33:56,880
the funny thing is that they are not

969
00:33:54,960 --> 00:33:59,039
very creative with the naming so

970
00:33:56,880 --> 00:34:00,080
on the right side you will see the

971
00:33:59,039 --> 00:34:03,279
actual names

972
00:34:00,080 --> 00:34:04,640
of the computers and on the horizontal

973
00:34:03,279 --> 00:34:05,919
bar you will see the different students

974
00:34:04,640 --> 00:34:09,280
that they have tried to create

975
00:34:05,919 --> 00:34:09,919
and the amount of new av beacons that

976
00:34:09,280 --> 00:34:12,079
are

977
00:34:09,919 --> 00:34:13,599
connected so let me just zoom in you

978
00:34:12,079 --> 00:34:15,760
will see the names that you will

979
00:34:13,599 --> 00:34:17,280
probably recognize at npc john pc

980
00:34:15,760 --> 00:34:20,320
tequila boom boom

981
00:34:17,280 --> 00:34:23,119
virtual pc admin dash something when

982
00:34:20,320 --> 00:34:24,079
dash all the typical windows evaluation

983
00:34:23,119 --> 00:34:26,960
images

984
00:34:24,079 --> 00:34:28,240
not very creative so this is a clear

985
00:34:26,960 --> 00:34:30,159
indicator

986
00:34:28,240 --> 00:34:33,599
which of course you already know is that

987
00:34:30,159 --> 00:34:34,800
there is something fishy going on

988
00:34:33,599 --> 00:34:36,399
but we could also generate a launch

989
00:34:34,800 --> 00:34:37,119
based on this even if it's not going

990
00:34:36,399 --> 00:34:40,800
back to

991
00:34:37,119 --> 00:34:42,800
the c2 record another one that i want to

992
00:34:40,800 --> 00:34:45,200
highlight is domain classification

993
00:34:42,800 --> 00:34:46,639
here you will see where log already does

994
00:34:45,200 --> 00:34:48,399
this there is a config file where you

995
00:34:46,639 --> 00:34:50,879
enter domain names and from there on

996
00:34:48,399 --> 00:34:53,280
in this case i entered outflank.now and

997
00:34:50,879 --> 00:34:54,720
it's querying ibm x4s mcafee as well as

998
00:34:53,280 --> 00:34:57,760
blue code

999
00:34:54,720 --> 00:35:00,079
in a periodic way and you will see that

1000
00:34:57,760 --> 00:35:01,599
for some reason at ibm exports we have

1001
00:35:00,079 --> 00:35:03,119
an error getting reputation but that's

1002
00:35:01,599 --> 00:35:06,000
okay we still have two left

1003
00:35:03,119 --> 00:35:06,560
and what's interesting here to see or to

1004
00:35:06,000 --> 00:35:10,240
look for

1005
00:35:06,560 --> 00:35:12,240
is changes in those classifications

1006
00:35:10,240 --> 00:35:14,079
and to see if it's actually a bad

1007
00:35:12,240 --> 00:35:15,599
reputation so if it's a rogue type of

1008
00:35:14,079 --> 00:35:17,040
thing

1009
00:35:15,599 --> 00:35:19,440
we went through all the different data

1010
00:35:17,040 --> 00:35:22,000
are the different classification groups

1011
00:35:19,440 --> 00:35:22,720
that those domain classifiers have we

1012
00:35:22,000 --> 00:35:25,359
picked out the

1013
00:35:22,720 --> 00:35:26,800
the rogue ones and as soon as there is a

1014
00:35:25,359 --> 00:35:27,680
mapping of your domain into one of those

1015
00:35:26,800 --> 00:35:31,839
categories

1016
00:35:27,680 --> 00:35:31,839
you should be getting

1017
00:35:32,480 --> 00:35:36,320
interesting other area where you can do

1018
00:35:34,560 --> 00:35:38,560
spoiling using activity is on the

1019
00:35:36,320 --> 00:35:39,359
internal so it checks on the internal

1020
00:35:38,560 --> 00:35:41,599
wave

1021
00:35:39,359 --> 00:35:42,800
coming from your implant on the internal

1022
00:35:41,599 --> 00:35:44,800
network and let me

1023
00:35:42,800 --> 00:35:46,560
give you just a few examples first of

1024
00:35:44,800 --> 00:35:50,240
all

1025
00:35:46,560 --> 00:35:52,800
the damn nasty kirby tgt many networks

1026
00:35:50,240 --> 00:35:54,800
still have not an automated way of

1027
00:35:52,800 --> 00:35:57,920
changing the password of the kv-tg

1028
00:35:54,800 --> 00:36:00,320
so if you come into a network and you

1029
00:35:57,920 --> 00:36:02,480
will see that in this case even 2010 the

1030
00:36:00,320 --> 00:36:03,760
last password set of that specific

1031
00:36:02,480 --> 00:36:05,440
contrast 2010

1032
00:36:03,760 --> 00:36:06,960
and later on in your operation all of a

1033
00:36:05,440 --> 00:36:09,520
sudden is being reset

1034
00:36:06,960 --> 00:36:10,880
well chances are big that it was a blue

1035
00:36:09,520 --> 00:36:14,320
team initiated

1036
00:36:10,880 --> 00:36:15,599
change so the tgt is very specific but

1037
00:36:14,320 --> 00:36:18,160
you can use the

1038
00:36:15,599 --> 00:36:21,520
the the the same thing for specific

1039
00:36:18,160 --> 00:36:24,720
admin accounts or other accounts and

1040
00:36:21,520 --> 00:36:28,079
it's hard to judge when a normal

1041
00:36:24,720 --> 00:36:30,000
password change would be but if you have

1042
00:36:28,079 --> 00:36:31,440
five admin accounts and all of a sudden

1043
00:36:30,000 --> 00:36:33,760
they are

1044
00:36:31,440 --> 00:36:34,560
changed in the last day it's a clear

1045
00:36:33,760 --> 00:36:36,240
indicator that

1046
00:36:34,560 --> 00:36:38,400
well if all admins start changing their

1047
00:36:36,240 --> 00:36:41,040
passwords they are on to something

1048
00:36:38,400 --> 00:36:42,240
so blue check is an uh thing that helps

1049
00:36:41,040 --> 00:36:45,920
you with actually

1050
00:36:42,240 --> 00:36:47,359
outputting this information it's a uh

1051
00:36:45,920 --> 00:36:48,960
it's a calm based thing that

1052
00:36:47,359 --> 00:36:52,400
communicates via etsy

1053
00:36:48,960 --> 00:36:54,560
um and it outputs in a certain way that

1054
00:36:52,400 --> 00:36:57,119
haddock actually is able to ingest

1055
00:36:54,560 --> 00:36:57,680
i'm not sure if we have open sourced it

1056
00:36:57,119 --> 00:37:01,200
just

1057
00:36:57,680 --> 00:37:04,240
yet how about

1058
00:37:01,200 --> 00:37:07,520
certificates uh here we do

1059
00:37:04,240 --> 00:37:11,200
a sect check for a specific website our

1060
00:37:07,520 --> 00:37:13,920
athletic website and this

1061
00:37:11,200 --> 00:37:16,160
check gets the data from the certificate

1062
00:37:13,920 --> 00:37:16,160
out

1063
00:37:17,839 --> 00:37:22,000
it checks to see if it's being ssl

1064
00:37:19,839 --> 00:37:24,560
intercepted or if there's a

1065
00:37:22,000 --> 00:37:27,760
ssl intercepting a corporate proxy in a

1066
00:37:24,560 --> 00:37:30,400
way if this changes during an operation

1067
00:37:27,760 --> 00:37:31,599
then the blue team has well enabled as

1068
00:37:30,400 --> 00:37:33,359
interceptions

1069
00:37:31,599 --> 00:37:34,480
which they might often not always do

1070
00:37:33,359 --> 00:37:35,760
from the beginning and it's a clear

1071
00:37:34,480 --> 00:37:36,160
indicator that well something has

1072
00:37:35,760 --> 00:37:39,599
changed

1073
00:37:36,160 --> 00:37:42,880
you need to be aware of

1074
00:37:39,599 --> 00:37:44,400
of blue team investigations okay as a

1075
00:37:42,880 --> 00:37:47,440
summary if we talk about

1076
00:37:44,400 --> 00:37:48,320
direct based types of indicators

1077
00:37:47,440 --> 00:37:50,720
invested

1078
00:37:48,320 --> 00:37:52,800
investigation or maybe we should call it

1079
00:37:50,720 --> 00:37:53,760
indicator of analysis or indicator of

1080
00:37:52,800 --> 00:37:56,160
detection

1081
00:37:53,760 --> 00:37:58,480
i don't know i don't care uh but if we

1082
00:37:56,160 --> 00:38:00,800
look at the directly based things we can

1083
00:37:58,480 --> 00:38:03,280
check for analyst traffic so specific

1084
00:38:00,800 --> 00:38:04,640
torque ip addresses curl user agents

1085
00:38:03,280 --> 00:38:06,640
could that are going straight to your c

1086
00:38:04,640 --> 00:38:07,040
to the back end that's a clear indicator

1087
00:38:06,640 --> 00:38:10,320
for

1088
00:38:07,040 --> 00:38:12,320
analysis deflected traffic

1089
00:38:10,320 --> 00:38:14,160
for some reason your redirector logic

1090
00:38:12,320 --> 00:38:17,680
has said well we need to deflect this to

1091
00:38:14,160 --> 00:38:20,720
our decoy website or some to other thing

1092
00:38:17,680 --> 00:38:22,720
we can make alarms based on that blue

1093
00:38:20,720 --> 00:38:23,599
code other specific view defenders have

1094
00:38:22,720 --> 00:38:25,359
very

1095
00:38:23,599 --> 00:38:28,720
specific ways of querying your

1096
00:38:25,359 --> 00:38:30,960
infrastructure and

1097
00:38:28,720 --> 00:38:33,040
you can have insight into the data and

1098
00:38:30,960 --> 00:38:36,400
later on we can have alarms on that

1099
00:38:33,040 --> 00:38:38,400
as well it's messaging i show you

1100
00:38:36,400 --> 00:38:40,640
a funny thing is if you have if you know

1101
00:38:38,400 --> 00:38:43,440
the ip ranges of

1102
00:38:40,640 --> 00:38:46,000
blue teams which you might know over

1103
00:38:43,440 --> 00:38:49,119
some time

1104
00:38:46,000 --> 00:38:51,280
if those ip ranges are connecting to

1105
00:38:49,119 --> 00:38:53,520
your infrastructure

1106
00:38:51,280 --> 00:38:55,359
and even if they go to a decoy if they

1107
00:38:53,520 --> 00:38:58,160
are going to deflected decoy

1108
00:38:55,359 --> 00:38:58,800
back end or if they go to your true c2

1109
00:38:58,160 --> 00:39:00,880
back end

1110
00:38:58,800 --> 00:39:02,160
you want to be aware of any type of

1111
00:39:00,880 --> 00:39:04,240
built-in

1112
00:39:02,160 --> 00:39:05,839
ip address accessing your infrastructure

1113
00:39:04,240 --> 00:39:08,560
because it's immediately

1114
00:39:05,839 --> 00:39:10,640
is that suspicious and then there's

1115
00:39:08,560 --> 00:39:12,000
generic c2 scanners and av sandboxes

1116
00:39:10,640 --> 00:39:15,680
having red dock you will have

1117
00:39:12,000 --> 00:39:17,119
proper here insight into what those c2

1118
00:39:15,680 --> 00:39:18,480
scanners are doing and where they're

1119
00:39:17,119 --> 00:39:20,560
coming from

1120
00:39:18,480 --> 00:39:22,880
not directly alarm related but it's very

1121
00:39:20,560 --> 00:39:24,640
helpful to have that insight

1122
00:39:22,880 --> 00:39:26,640
that's on the direct traffic if we talk

1123
00:39:24,640 --> 00:39:28,480
about indirect we're talking about av

1124
00:39:26,640 --> 00:39:30,240
hash let's check virus total hybrid

1125
00:39:28,480 --> 00:39:31,040
analysis but it's also an infra

1126
00:39:30,240 --> 00:39:34,240
blacklist so

1127
00:39:31,040 --> 00:39:36,960
if you have configured to reduce

1128
00:39:34,240 --> 00:39:38,000
if they are if it's aware of the urls

1129
00:39:36,960 --> 00:39:39,359
that you use if they are

1130
00:39:38,000 --> 00:39:41,119
if your route ip addresses of your

1131
00:39:39,359 --> 00:39:44,240
infrastructure specifically

1132
00:39:41,119 --> 00:39:45,760
so the the hash of yourself we can check

1133
00:39:44,240 --> 00:39:48,320
that data onto

1134
00:39:45,760 --> 00:39:50,560
well public lists of known ip bad ip

1135
00:39:48,320 --> 00:39:52,560
addresses urls and certificates

1136
00:39:50,560 --> 00:39:56,079
and the domain classifiers i already

1137
00:39:52,560 --> 00:39:58,480
showed you

1138
00:39:56,079 --> 00:40:00,320
looking at the internal side uh we can

1139
00:39:58,480 --> 00:40:02,000
check for the password resets the tls

1140
00:40:00,320 --> 00:40:03,599
interception another one that we have

1141
00:40:02,000 --> 00:40:06,079
already included is the

1142
00:40:03,599 --> 00:40:07,680
security tool checks so an unexpected

1143
00:40:06,079 --> 00:40:09,440
change of the edl tool is being

1144
00:40:07,680 --> 00:40:11,200
installed

1145
00:40:09,440 --> 00:40:12,720
that's a clear indicator all of a sudden

1146
00:40:11,200 --> 00:40:14,800
they have done something for more

1147
00:40:12,720 --> 00:40:16,319
investigation

1148
00:40:14,800 --> 00:40:18,160
we are working on checks for look

1149
00:40:16,319 --> 00:40:19,040
forwarding security config as well as

1150
00:40:18,160 --> 00:40:21,440
accounts login

1151
00:40:19,040 --> 00:40:23,200
where we lock forwarding if there is a

1152
00:40:21,440 --> 00:40:25,040
change all of a sudden ref is being

1153
00:40:23,200 --> 00:40:26,640
enabled or

1154
00:40:25,040 --> 00:40:28,400
winlock weed is being enabled things

1155
00:40:26,640 --> 00:40:29,839
like that it's a clear indicator that

1156
00:40:28,400 --> 00:40:31,440
something has changed that you need to

1157
00:40:29,839 --> 00:40:34,720
be aware of and most likely is

1158
00:40:31,440 --> 00:40:34,720
related to blue team activity

1159
00:40:35,040 --> 00:40:39,680
we can check for six specific security

1160
00:40:38,640 --> 00:40:42,880
conflict changes

1161
00:40:39,680 --> 00:40:44,640
um this is a very broad topic but it is

1162
00:40:42,880 --> 00:40:46,400
a category that needs to be mentioned so

1163
00:40:44,640 --> 00:40:48,000
if you have an implant doing some checks

1164
00:40:46,400 --> 00:40:49,359
and all of a sudden

1165
00:40:48,000 --> 00:40:51,040
well you can check many different

1166
00:40:49,359 --> 00:40:52,880
security parameters

1167
00:40:51,040 --> 00:40:55,359
local security policies and if those

1168
00:40:52,880 --> 00:40:56,800
change why would they be changing during

1169
00:40:55,359 --> 00:40:59,760
operation

1170
00:40:56,800 --> 00:41:00,400
and then there is an unexpected change

1171
00:40:59,760 --> 00:41:02,079
of the

1172
00:41:00,400 --> 00:41:03,760
accounts are logging in if you land on

1173
00:41:02,079 --> 00:41:06,720
the box and if you go through the

1174
00:41:03,760 --> 00:41:08,480
windows event view of the past 10 logins

1175
00:41:06,720 --> 00:41:11,760
or the past 100 logins you will

1176
00:41:08,480 --> 00:41:13,119
most often see a clear approach of

1177
00:41:11,760 --> 00:41:14,960
what accounts are logging into this

1178
00:41:13,119 --> 00:41:16,800
machine all of a sudden you see

1179
00:41:14,960 --> 00:41:18,400
service accounts logging in or all kinds

1180
00:41:16,800 --> 00:41:20,480
of different things it might be aware

1181
00:41:18,400 --> 00:41:22,079
it might be an indicator for you that

1182
00:41:20,480 --> 00:41:24,319
you're not as stealthy as you

1183
00:41:22,079 --> 00:41:24,319
think

1184
00:41:25,599 --> 00:41:29,839
how to get started um i need to tell you

1185
00:41:29,119 --> 00:41:33,280
a few

1186
00:41:29,839 --> 00:41:36,560
things on the planning side a radar

1187
00:41:33,280 --> 00:41:39,040
installation is intended per operation

1188
00:41:36,560 --> 00:41:40,000
could be having multiple scenarios but

1189
00:41:39,040 --> 00:41:42,079
it's for one

1190
00:41:40,000 --> 00:41:43,839
client if you like so do not mix clients

1191
00:41:42,079 --> 00:41:44,560
do not make a central redux over where

1192
00:41:43,839 --> 00:41:47,119
you put into

1193
00:41:44,560 --> 00:41:48,400
everything together you want to nuke the

1194
00:41:47,119 --> 00:41:50,240
system because again

1195
00:41:48,400 --> 00:41:51,520
it contains highly confidential data you

1196
00:41:50,240 --> 00:41:54,960
want to nuke the system

1197
00:41:51,520 --> 00:41:57,760
after your operation it has three main

1198
00:41:54,960 --> 00:42:00,160
components the redox server itself

1199
00:41:57,760 --> 00:42:01,599
a connector that you install on your c2

1200
00:42:00,160 --> 00:42:05,119
servers and a connector

1201
00:42:01,599 --> 00:42:07,280
that you install on your redirectors

1202
00:42:05,119 --> 00:42:08,960
there are several imported identifiers

1203
00:42:07,280 --> 00:42:09,440
used during the operation and you want

1204
00:42:08,960 --> 00:42:11,280
to

1205
00:42:09,440 --> 00:42:13,280
make them clear at the beginning of your

1206
00:42:11,280 --> 00:42:14,480
installation that is the attack scenario

1207
00:42:13,280 --> 00:42:16,160
name that you use as well as the

1208
00:42:14,480 --> 00:42:17,760
component name that you use

1209
00:42:16,160 --> 00:42:19,119
the component name is interesting or

1210
00:42:17,760 --> 00:42:21,599
relevant for the c2 servers and the

1211
00:42:19,119 --> 00:42:24,000
reader vectors and the attack scenario

1212
00:42:21,599 --> 00:42:25,680
as as well those are also parameters

1213
00:42:24,000 --> 00:42:30,160
that you need to put onto the installer

1214
00:42:25,680 --> 00:42:31,440
on the c2 server as a retargeter

1215
00:42:30,160 --> 00:42:33,440
an important thing to know and i

1216
00:42:31,440 --> 00:42:36,000
mentioned it before is that the default

1217
00:42:33,440 --> 00:42:36,960
logging of apache or ajay proxy or any

1218
00:42:36,000 --> 00:42:40,560
type of other

1219
00:42:36,960 --> 00:42:42,560
reverse proxy is not sufficient

1220
00:42:40,560 --> 00:42:45,119
we've put on the wiki which is on github

1221
00:42:42,560 --> 00:42:49,040
and both on the blog post series we

1222
00:42:45,119 --> 00:42:49,440
have told you or we put examples configs

1223
00:42:49,040 --> 00:42:52,480
in

1224
00:42:49,440 --> 00:42:53,599
the header code as well how you change

1225
00:42:52,480 --> 00:42:57,119
the login to be

1226
00:42:53,599 --> 00:43:00,160
specifically ready for apache to include

1227
00:42:57,119 --> 00:43:01,839
header logging and there's explicit

1228
00:43:00,160 --> 00:43:03,280
names of the font in the backend

1229
00:43:01,839 --> 00:43:04,319
and things like that it's already in

1230
00:43:03,280 --> 00:43:05,359
there but you need to enable it

1231
00:43:04,319 --> 00:43:09,520
otherwise well

1232
00:43:05,359 --> 00:43:09,520
that dock is blind for traffic data

1233
00:43:10,000 --> 00:43:13,040
then you do the installation you get the

1234
00:43:11,440 --> 00:43:14,560
latest release from github or you can

1235
00:43:13,040 --> 00:43:15,280
just try the master branch whatever you

1236
00:43:14,560 --> 00:43:18,240
like

1237
00:43:15,280 --> 00:43:19,200
then there is a first step in creating

1238
00:43:18,240 --> 00:43:20,880
certificates

1239
00:43:19,200 --> 00:43:22,960
and the installation packages for both

1240
00:43:20,880 --> 00:43:24,240
the elk server the c2 server as well as

1241
00:43:22,960 --> 00:43:26,960
the heat effector you do that with the

1242
00:43:24,240 --> 00:43:29,040
initial setup you generate certificates

1243
00:43:26,960 --> 00:43:31,680
that are being used for the transport

1244
00:43:29,040 --> 00:43:33,200
of the data from those other components

1245
00:43:31,680 --> 00:43:34,800
back to the fedex server

1246
00:43:33,200 --> 00:43:36,480
it's encrypted t-less encrypted you need

1247
00:43:34,800 --> 00:43:38,400
to configure that

1248
00:43:36,480 --> 00:43:40,319
and from there on you run the installers

1249
00:43:38,400 --> 00:43:41,839
on your readers on your c2 servers as

1250
00:43:40,319 --> 00:43:45,200
well on the main headlock server

1251
00:43:41,839 --> 00:43:47,359
and very important there are post

1252
00:43:45,200 --> 00:43:49,200
installation

1253
00:43:47,359 --> 00:43:50,880
configurations that need to be done you

1254
00:43:49,200 --> 00:43:53,040
will find that on the elk server

1255
00:43:50,880 --> 00:43:54,079
at the specific project you will see

1256
00:43:53,040 --> 00:43:56,960
there

1257
00:43:54,079 --> 00:43:58,640
there you enable specific alarms and

1258
00:43:56,960 --> 00:44:00,880
other kinds of things and it's all

1259
00:43:58,640 --> 00:44:02,319
explained into the

1260
00:44:00,880 --> 00:44:06,160
documentation that we have both on

1261
00:44:02,319 --> 00:44:08,400
github as well in the blog post series

1262
00:44:06,160 --> 00:44:11,599
a little bit about the map uh version

1263
00:44:08,400 --> 00:44:14,720
one which was 2018 2019 i believe

1264
00:44:11,599 --> 00:44:17,680
we focused mainly on oversight and not

1265
00:44:14,720 --> 00:44:19,760
very much on the alarms we had support

1266
00:44:17,680 --> 00:44:21,839
for cobblestride aj proxy and as well as

1267
00:44:19,760 --> 00:44:24,160
effectually detectors

1268
00:44:21,839 --> 00:44:25,520
but version 2 where i've been working on

1269
00:44:24,160 --> 00:44:28,640
since

1270
00:44:25,520 --> 00:44:31,119
it is 19 i believe

1271
00:44:28,640 --> 00:44:31,920
it's at it's still a better stage but

1272
00:44:31,119 --> 00:44:33,680
almost there

1273
00:44:31,920 --> 00:44:35,599
it's a major improvement both on the

1274
00:44:33,680 --> 00:44:37,760
setup but most

1275
00:44:35,599 --> 00:44:39,839
majority on the types of alarms as well

1276
00:44:37,760 --> 00:44:43,040
as the ops data and support attack so

1277
00:44:39,839 --> 00:44:46,640
lots of more c2 is supported part c2

1278
00:44:43,040 --> 00:44:49,040
but also nginx and their own c2

1279
00:44:46,640 --> 00:44:50,720
framework and of course like i mentioned

1280
00:44:49,040 --> 00:44:52,880
we have the integrated neo4j and the

1281
00:44:50,720 --> 00:44:54,960
jupyter notebooks

1282
00:44:52,880 --> 00:44:56,960
it's in constant development more alarms

1283
00:44:54,960 --> 00:44:57,680
more improved dashboards and things like

1284
00:44:56,960 --> 00:44:59,599
that and we'll

1285
00:44:57,680 --> 00:45:02,839
also working on other c2 frameworks and

1286
00:44:59,599 --> 00:45:05,839
you're happy to join us if you

1287
00:45:02,839 --> 00:45:08,000
like in summary

1288
00:45:05,839 --> 00:45:08,880
we believe red teaming is to make blue

1289
00:45:08,000 --> 00:45:12,079
teams better

1290
00:45:08,880 --> 00:45:15,680
that's why we do proper sparring uh

1291
00:45:12,079 --> 00:45:17,680
and we having that insight

1292
00:45:15,680 --> 00:45:19,839
of movement of your opponent during a

1293
00:45:17,680 --> 00:45:22,400
sparring fight is actually better so

1294
00:45:19,839 --> 00:45:23,599
catalog helps you with that specific

1295
00:45:22,400 --> 00:45:26,880
case it will help you

1296
00:45:23,599 --> 00:45:27,200
to see activities that the blue teams

1297
00:45:26,880 --> 00:45:30,400
are

1298
00:45:27,200 --> 00:45:31,200
doing and dear blue think if you're

1299
00:45:30,400 --> 00:45:32,800
upset

1300
00:45:31,200 --> 00:45:34,800
you can make use of radarock you will

1301
00:45:32,800 --> 00:45:36,000
find it on a github and you will find

1302
00:45:34,800 --> 00:45:38,480
information about this

1303
00:45:36,000 --> 00:45:39,119
also on my blog and with that i would

1304
00:45:38,480 --> 00:45:42,640
like to

1305
00:45:39,119 --> 00:45:42,640
thank you for your time

