1
00:00:00,160 --> 00:00:03,919
so as mentioned um i am

2
00:00:03,919 --> 00:00:05,759
currently a senior scientist at security

3
00:00:05,759 --> 00:00:08,800
risk advisors uh which is actually um a

4
00:00:08,800 --> 00:00:10,639
new job for me and very excited about

5
00:00:10,639 --> 00:00:12,960
that so i do a lot of uh research and

6
00:00:12,960 --> 00:00:14,880
innovation and focus on cloud security

7
00:00:14,880 --> 00:00:17,359
engineering and architecture before that

8
00:00:17,359 --> 00:00:21,119
i was um an 865 sysadmin so that's kind

9
00:00:21,119 --> 00:00:23,039
of my area of expertise a little bit

10
00:00:23,039 --> 00:00:25,680
more so than many other things um and

11
00:00:25,680 --> 00:00:27,279
i'm also grad student computer science

12
00:00:27,279 --> 00:00:29,199
so basically i'm just damascus and have

13
00:00:29,199 --> 00:00:31,519
no free time um as well as being a blue

14
00:00:31,519 --> 00:00:33,360
team village organizer so here at def

15
00:00:33,360 --> 00:00:34,880
con you'll probably see me around quite

16
00:00:34,880 --> 00:00:37,280
a lot if you stop into blue team village

17
00:00:37,280 --> 00:00:39,680
to our discord or wherever else

18
00:00:39,680 --> 00:00:42,160
and so i'm gonna just hop right into it

19
00:00:42,160 --> 00:00:43,120
um

20
00:00:43,120 --> 00:00:44,879
so the title of this talk is exploiting

21
00:00:44,879 --> 00:00:47,520
the o365 duo two factor

22
00:00:47,520 --> 00:00:50,719
um loophole or misconfiguration so i'm

23
00:00:50,719 --> 00:00:52,160
going to talk a little bit about what

24
00:00:52,160 --> 00:00:53,920
the scope of this actually is this

25
00:00:53,920 --> 00:00:57,920
applies to office 365 uh on azure's or

26
00:00:57,920 --> 00:01:01,440
on an azure tenant um on which all basic

27
00:01:01,440 --> 00:01:04,080
authentication is not fully blocked and

28
00:01:04,080 --> 00:01:05,600
we'll touch on that a little bit uh

29
00:01:05,600 --> 00:01:07,200
later as well

30
00:01:07,200 --> 00:01:09,280
um and this is

31
00:01:09,280 --> 00:01:11,200
happening on tenants where two-factor

32
00:01:11,200 --> 00:01:12,479
authentication or two-factor

33
00:01:12,479 --> 00:01:15,439
verification with uh duo is implemented

34
00:01:15,439 --> 00:01:17,759
um and it's applies to configurations

35
00:01:17,759 --> 00:01:19,920
most likely implemented prior to august

36
00:01:19,920 --> 00:01:22,000
2020 or thereabouts

37
00:01:22,000 --> 00:01:24,400
which i will get into

38
00:01:24,400 --> 00:01:26,960
um so for a quick background in order to

39
00:01:26,960 --> 00:01:28,799
understand kind of what's going on here

40
00:01:28,799 --> 00:01:31,040
um there are a couple o365

41
00:01:31,040 --> 00:01:33,280
authentication types so

42
00:01:33,280 --> 00:01:35,200
microsoft being microsoft uses its own

43
00:01:35,200 --> 00:01:36,880
terminology

44
00:01:36,880 --> 00:01:38,880
so what it refers to as legacy auth is

45
00:01:38,880 --> 00:01:40,640
is basic authentication

46
00:01:40,640 --> 00:01:42,000
and these are protocols that send

47
00:01:42,000 --> 00:01:45,520
username password in header um

48
00:01:45,520 --> 00:01:48,079
in plain text essentially unless they're

49
00:01:48,079 --> 00:01:50,159
unless they're sent via https or some

50
00:01:50,159 --> 00:01:52,240
other protocol uh modern authentication

51
00:01:52,240 --> 00:01:54,799
refers to a slightly different

52
00:01:54,799 --> 00:01:56,240
methodology with client server

53
00:01:56,240 --> 00:01:58,479
authentication uses access and refresh

54
00:01:58,479 --> 00:01:59,759
tokens

55
00:01:59,759 --> 00:02:01,600
and importantly

56
00:02:01,600 --> 00:02:04,159
modern authentication is a requirement

57
00:02:04,159 --> 00:02:06,240
in order for two-factor verification or

58
00:02:06,240 --> 00:02:08,639
any other mfa service to actually work

59
00:02:08,639 --> 00:02:11,120
so that's a very important point

60
00:02:11,120 --> 00:02:12,400
and then we also have some email

61
00:02:12,400 --> 00:02:14,239
protocols that may be familiar to people

62
00:02:14,239 --> 00:02:16,560
pop imap smtp are all legacy

63
00:02:16,560 --> 00:02:18,720
authentication protocols although there

64
00:02:18,720 --> 00:02:20,560
is support for modern being built into

65
00:02:20,560 --> 00:02:21,280
them

66
00:02:21,280 --> 00:02:22,959
the second one activesync is going to be

67
00:02:22,959 --> 00:02:24,480
the most important one here and then

68
00:02:24,480 --> 00:02:26,319
there are other ones like mappy rpc and

69
00:02:26,319 --> 00:02:28,959
these are used uh for

70
00:02:28,959 --> 00:02:32,560
services like microsoft outlook

71
00:02:32,560 --> 00:02:33,360
so

72
00:02:33,360 --> 00:02:35,760
what is this misconfiguration

73
00:02:35,760 --> 00:02:37,760
so the first thing i want to clarify duo

74
00:02:37,760 --> 00:02:39,120
is not actually part of the

75
00:02:39,120 --> 00:02:41,440
misconfiguration this is entirely on the

76
00:02:41,440 --> 00:02:44,480
office 365 side of the equation

77
00:02:44,480 --> 00:02:46,800
duo's documentation explicitly notes

78
00:02:46,800 --> 00:02:48,000
that

79
00:02:48,000 --> 00:02:50,000
modern authentication is required in

80
00:02:50,000 --> 00:02:52,640
order for for this duo to be triggered

81
00:02:52,640 --> 00:02:54,480
so that is a very important point here

82
00:02:54,480 --> 00:02:57,200
that they actually do make clear

83
00:02:57,200 --> 00:02:59,200
um the second part of this is

84
00:02:59,200 --> 00:03:01,200
conditional access policy is an azure

85
00:03:01,200 --> 00:03:05,440
active directory so o365 as a tenant use

86
00:03:05,440 --> 00:03:07,840
it's essentially backed by azure active

87
00:03:07,840 --> 00:03:10,000
directory and all access is run through

88
00:03:10,000 --> 00:03:12,319
active directory um and the

89
00:03:12,319 --> 00:03:15,120
configuration that duo requires in order

90
00:03:15,120 --> 00:03:17,440
to work with o365 actually involves

91
00:03:17,440 --> 00:03:19,519
conditional access policy

92
00:03:19,519 --> 00:03:22,319
and what's called a custom control

93
00:03:22,319 --> 00:03:26,879
that basically enforces an action e-i-e

94
00:03:26,879 --> 00:03:29,040
triggering a dual authentication

95
00:03:29,040 --> 00:03:30,000
to

96
00:03:30,000 --> 00:03:33,200
a selected set of users uh cloud apps or

97
00:03:33,200 --> 00:03:35,519
actions and conditions

98
00:03:35,519 --> 00:03:38,159
uh if configured and then finally will

99
00:03:38,159 --> 00:03:39,360
you know you can write a policy to

100
00:03:39,360 --> 00:03:41,599
either perform an action or deny access

101
00:03:41,599 --> 00:03:43,280
period

102
00:03:43,280 --> 00:03:46,480
and this access grant is where the duo

103
00:03:46,480 --> 00:03:47,760
integration

104
00:03:47,760 --> 00:03:50,080
actually happens and what sends it off

105
00:03:50,080 --> 00:03:51,760
to to duo to be

106
00:03:51,760 --> 00:03:54,000
to go through that second factor

107
00:03:54,000 --> 00:03:55,920
um so let's take a look at what that

108
00:03:55,920 --> 00:03:57,360
looks like

109
00:03:57,360 --> 00:03:59,360
so essentially under when you're

110
00:03:59,360 --> 00:04:01,280
configuring conditional access policy

111
00:04:01,280 --> 00:04:04,000
you have all of those previously listed

112
00:04:04,000 --> 00:04:06,959
uh assignments and access um under the

113
00:04:06,959 --> 00:04:08,799
uh configuration in azure active

114
00:04:08,799 --> 00:04:11,360
directory in the security portion um

115
00:04:11,360 --> 00:04:14,959
under conditional access so importantly

116
00:04:14,959 --> 00:04:16,560
when you have conditions you have

117
00:04:16,560 --> 00:04:19,040
options to kind of scope an action a

118
00:04:19,040 --> 00:04:20,959
grant or deny by

119
00:04:20,959 --> 00:04:22,720
something that you select one of those

120
00:04:22,720 --> 00:04:25,600
things being client apps so this was in

121
00:04:25,600 --> 00:04:28,880
preview before august 2020 which is kind

122
00:04:28,880 --> 00:04:29,919
of why

123
00:04:29,919 --> 00:04:31,120
this uh

124
00:04:31,120 --> 00:04:33,360
is this misconfiguration has happened

125
00:04:33,360 --> 00:04:35,199
probably as widely as it has

126
00:04:35,199 --> 00:04:38,240
um so you'll notice that first of all

127
00:04:38,240 --> 00:04:39,680
so this year right here is actually the

128
00:04:39,680 --> 00:04:41,520
current one um and i'll show you a

129
00:04:41,520 --> 00:04:42,720
little bit what the previous one looks

130
00:04:42,720 --> 00:04:44,320
like and why that would be an issue but

131
00:04:44,320 --> 00:04:45,840
you'll notice that activesync is listed

132
00:04:45,840 --> 00:04:48,160
separately and in the new configuration

133
00:04:48,160 --> 00:04:49,919
it's listed as legacy authentication

134
00:04:49,919 --> 00:04:52,160
client so there are some exchange active

135
00:04:52,160 --> 00:04:53,680
sync clients that are actually

136
00:04:53,680 --> 00:04:55,919
integrated with modern authentication

137
00:04:55,919 --> 00:04:58,800
but that is not necessarily um not

138
00:04:58,800 --> 00:05:00,639
necessarily the case and it doesn't

139
00:05:00,639 --> 00:05:02,320
really indicate that it's always going

140
00:05:02,320 --> 00:05:04,400
to be under modern off if it has a basic

141
00:05:04,400 --> 00:05:05,600
authentication

142
00:05:05,600 --> 00:05:06,880
workflow

143
00:05:06,880 --> 00:05:07,840
so

144
00:05:07,840 --> 00:05:11,280
if not checked in this is this example

145
00:05:11,280 --> 00:05:13,919
this duo policy which operates under the

146
00:05:13,919 --> 00:05:16,240
condition of whatever users you select

147
00:05:16,240 --> 00:05:18,720
conditions client apps all these three

148
00:05:18,720 --> 00:05:21,120
or just the top two which would be make

149
00:05:21,120 --> 00:05:23,520
sense to most people um it essentially

150
00:05:23,520 --> 00:05:25,680
means that uh activesync would not be

151
00:05:25,680 --> 00:05:29,120
triggered um to to be pushed out to to

152
00:05:29,120 --> 00:05:30,240
duo

153
00:05:30,240 --> 00:05:31,919
and then another previous um

154
00:05:31,919 --> 00:05:33,919
configuration that people have used is

155
00:05:33,919 --> 00:05:35,520
actually creating a second conditional

156
00:05:35,520 --> 00:05:39,039
access policy that explicitly blocks

157
00:05:39,039 --> 00:05:41,680
uh legacy authentication clients however

158
00:05:41,680 --> 00:05:43,520
in the previous configuration the only

159
00:05:43,520 --> 00:05:44,960
one that this actually applied to would

160
00:05:44,960 --> 00:05:46,880
be other clients

161
00:05:46,880 --> 00:05:49,440
the way it it actually appeared because

162
00:05:49,440 --> 00:05:51,199
those are the commonly listed ones like

163
00:05:51,199 --> 00:05:53,520
pop and imap so activesync is kind of

164
00:05:53,520 --> 00:05:55,840
this weird uh protocol that's hanging

165
00:05:55,840 --> 00:05:56,960
out separately and is a bit

166
00:05:56,960 --> 00:05:59,120
misunderstood when someone like a

167
00:05:59,120 --> 00:06:00,639
systems administrator who may not be as

168
00:06:00,639 --> 00:06:02,160
familiar with it

169
00:06:02,160 --> 00:06:05,600
is configuring this policy

170
00:06:05,680 --> 00:06:06,960
so

171
00:06:06,960 --> 00:06:08,479
if we leave out activesync what does

172
00:06:08,479 --> 00:06:09,759
this look like

173
00:06:09,759 --> 00:06:12,400
so if you go into uh

174
00:06:12,400 --> 00:06:13,440
ios

175
00:06:13,440 --> 00:06:15,280
mail the regular mail application not

176
00:06:15,280 --> 00:06:17,199
outlook for ios

177
00:06:17,199 --> 00:06:19,039
and you go and you you hit you know

178
00:06:19,039 --> 00:06:21,919
microsoft exchange account you sign in

179
00:06:21,919 --> 00:06:23,600
if you sign in with a company account

180
00:06:23,600 --> 00:06:25,280
you'll get a pop-up from microsoft you

181
00:06:25,280 --> 00:06:27,919
enter your password this window

182
00:06:27,919 --> 00:06:28,639
will

183
00:06:28,639 --> 00:06:30,800
uh will trigger the duo prompt to

184
00:06:30,800 --> 00:06:32,720
actually happen so it's essentially this

185
00:06:32,720 --> 00:06:34,720
is reaching out even if activesync is

186
00:06:34,720 --> 00:06:36,240
not actually triggered

187
00:06:36,240 --> 00:06:37,039
so

188
00:06:37,039 --> 00:06:39,680
there is basically ios has support for

189
00:06:39,680 --> 00:06:40,880
supporting

190
00:06:40,880 --> 00:06:42,400
modern authentication and triggering

191
00:06:42,400 --> 00:06:44,880
that duo prompt

192
00:06:44,880 --> 00:06:46,960
right in its own application

193
00:06:46,960 --> 00:06:48,400
so after signing the dual prompt would

194
00:06:48,400 --> 00:06:51,120
show up cool enter your password and

195
00:06:51,120 --> 00:06:52,560
bob's your uncle or whatever that weird

196
00:06:52,560 --> 00:06:54,639
expression is that's the normal workflow

197
00:06:54,639 --> 00:06:56,880
that's how people normal users would

198
00:06:56,880 --> 00:06:59,360
actually expect to be able to configure

199
00:06:59,360 --> 00:07:02,800
uh mail on the apple ios application

200
00:07:02,800 --> 00:07:04,800
however

201
00:07:04,800 --> 00:07:06,880
if you actually cancel out of that

202
00:07:06,880 --> 00:07:08,319
previous window

203
00:07:08,319 --> 00:07:09,360
or

204
00:07:09,360 --> 00:07:11,280
configure manually you can actually

205
00:07:11,280 --> 00:07:14,560
configure the the active sync

206
00:07:14,560 --> 00:07:16,560
basic authentication side of the

207
00:07:16,560 --> 00:07:18,880
equation and wind up skipping the prompt

208
00:07:18,880 --> 00:07:19,919
entirely

209
00:07:19,919 --> 00:07:22,240
and that is literally how this that how

210
00:07:22,240 --> 00:07:24,000
this exploit actually works

211
00:07:24,000 --> 00:07:27,520
it's essentially fail out of the the uh

212
00:07:27,520 --> 00:07:30,000
duo two factor prompt or skip it

213
00:07:30,000 --> 00:07:31,919
configure manually for activesync and

214
00:07:31,919 --> 00:07:33,919
because we have that hole where con

215
00:07:33,919 --> 00:07:35,680
conditional access policy was not

216
00:07:35,680 --> 00:07:38,400
actually applied uh to

217
00:07:38,400 --> 00:07:41,440
to that conditional access policy

218
00:07:41,440 --> 00:07:43,280
then this is what we wind up with the

219
00:07:43,280 --> 00:07:45,680
ability to do this and honestly you know

220
00:07:45,680 --> 00:07:47,919
this is something that when researching

221
00:07:47,919 --> 00:07:49,280
you kind of go through this from this

222
00:07:49,280 --> 00:07:51,120
perspective of an end user who is just

223
00:07:51,120 --> 00:07:52,639
going to be able to all they want to do

224
00:07:52,639 --> 00:07:53,680
is sign up for their email and they're

225
00:07:53,680 --> 00:07:54,800
not going to notice whether or not

226
00:07:54,800 --> 00:07:56,639
they're you know being prompted for for

227
00:07:56,639 --> 00:07:58,160
duo or not in fact they'll probably be

228
00:07:58,160 --> 00:08:00,400
happy not to be prompted for it

229
00:08:00,400 --> 00:08:02,879
but that is essentially how to do it on

230
00:08:02,879 --> 00:08:04,560
ios and it still works i've actually

231
00:08:04,560 --> 00:08:07,039
tested it this week

232
00:08:07,039 --> 00:08:09,280
so um and this is also important to note

233
00:08:09,280 --> 00:08:10,800
because activesync is a protocol

234
00:08:10,800 --> 00:08:12,000
something that you can build right into

235
00:08:12,000 --> 00:08:14,240
an application or you know run a script

236
00:08:14,240 --> 00:08:16,479
and password spray on an ec2 instance in

237
00:08:16,479 --> 00:08:19,039
aws if you want to

238
00:08:19,039 --> 00:08:21,199
basic authentication literally is just a

239
00:08:21,199 --> 00:08:23,919
basic c4 encoded header edition that

240
00:08:23,919 --> 00:08:25,680
states what the authorization is it's

241
00:08:25,680 --> 00:08:27,759
basic includes username and password

242
00:08:27,759 --> 00:08:30,240
that's it pretty easy um in addition to

243
00:08:30,240 --> 00:08:33,120
that activesync gives clients access to

244
00:08:33,120 --> 00:08:34,559
email contacts calendars and other

245
00:08:34,559 --> 00:08:36,559
things not just email

246
00:08:36,559 --> 00:08:40,159
but it also has no ability to enforce uh

247
00:08:40,159 --> 00:08:41,679
authorization

248
00:08:41,679 --> 00:08:42,958
uh aside from that initial

249
00:08:42,958 --> 00:08:44,560
authentication so it essentially grants

250
00:08:44,560 --> 00:08:46,160
access to everything which is why it can

251
00:08:46,160 --> 00:08:47,920
be such a

252
00:08:47,920 --> 00:08:49,519
lucrative exploit if you would like it

253
00:08:49,519 --> 00:08:51,519
to be or why you should be a little

254
00:08:51,519 --> 00:08:54,240
nervous if you don't want it to be so

255
00:08:54,240 --> 00:08:56,160
why does this happen

256
00:08:56,160 --> 00:08:58,880
uh prior to august 2020 on the left side

257
00:08:58,880 --> 00:09:01,120
this image shows that

258
00:09:01,120 --> 00:09:02,959
activesync was actually not listed or

259
00:09:02,959 --> 00:09:05,440
explicitly mentioned as being a legacy

260
00:09:05,440 --> 00:09:07,680
authentication protocol

261
00:09:07,680 --> 00:09:10,720
so uh when um

262
00:09:10,720 --> 00:09:13,519
when customers have configured things

263
00:09:13,519 --> 00:09:16,560
like um this second policy is mentioning

264
00:09:16,560 --> 00:09:18,160
to actually block

265
00:09:18,160 --> 00:09:20,160
um basic authentication they may have

266
00:09:20,160 --> 00:09:21,760
gone right to that other clients notice

267
00:09:21,760 --> 00:09:23,279
that that had pop imap and thought that

268
00:09:23,279 --> 00:09:25,200
that's all that they that

269
00:09:25,200 --> 00:09:27,360
that was needed to block and that's not

270
00:09:27,360 --> 00:09:28,800
necessarily the case

271
00:09:28,800 --> 00:09:30,320
the updated version of configuration

272
00:09:30,320 --> 00:09:33,279
makes it a lot more clear fortunately

273
00:09:33,279 --> 00:09:36,399
um the other thing is that client apps

274
00:09:36,399 --> 00:09:39,760
was in preview before august 2020

275
00:09:39,760 --> 00:09:41,200
and

276
00:09:41,200 --> 00:09:42,959
previously

277
00:09:42,959 --> 00:09:44,880
it actually stated that

278
00:09:44,880 --> 00:09:46,720
conditional access policies by default

279
00:09:46,720 --> 00:09:49,279
applied to browser-based applications

280
00:09:49,279 --> 00:09:50,800
and applications that utilize modern

281
00:09:50,800 --> 00:09:52,800
authentication protocols which meant it

282
00:09:52,800 --> 00:09:54,800
only applied when it was able to apply

283
00:09:54,800 --> 00:09:56,880
and did not impose any kind of automatic

284
00:09:56,880 --> 00:10:00,880
block or um implicit deny behavior

285
00:10:00,880 --> 00:10:04,800
um in 2020 that actually uh changed so

286
00:10:04,800 --> 00:10:07,839
when you apply a policy even if it's

287
00:10:07,839 --> 00:10:09,360
you know if you select active sync and

288
00:10:09,360 --> 00:10:11,760
it does not um

289
00:10:11,760 --> 00:10:13,360
and and your client is using basic

290
00:10:13,360 --> 00:10:15,760
authentication it at least sees that

291
00:10:15,760 --> 00:10:18,320
it's supposed to be enforcing with

292
00:10:18,320 --> 00:10:20,000
modern authentication and prompting and

293
00:10:20,000 --> 00:10:21,839
it actually fails out

294
00:10:21,839 --> 00:10:25,040
that behavior is is newer

295
00:10:25,040 --> 00:10:26,640
and then the behavior of the client apps

296
00:10:26,640 --> 00:10:29,760
condition as well was updated in 2020 so

297
00:10:29,760 --> 00:10:31,600
previously uh you know it wouldn't

298
00:10:31,600 --> 00:10:34,399
implicitly block anything or apply to

299
00:10:34,399 --> 00:10:35,440
to for

300
00:10:35,440 --> 00:10:37,519
all those four um

301
00:10:37,519 --> 00:10:39,680
options on the right hand side

302
00:10:39,680 --> 00:10:42,640
um and as of after 2020

303
00:10:42,640 --> 00:10:44,399
it actually checks all of them by

304
00:10:44,399 --> 00:10:46,880
default so if a configuration was done

305
00:10:46,880 --> 00:10:48,720
after august 2020

306
00:10:48,720 --> 00:10:50,880
with similar steps everything would be

307
00:10:50,880 --> 00:10:52,880
checked off by default and this hole

308
00:10:52,880 --> 00:10:56,079
would not exist because of that

309
00:10:56,079 --> 00:10:57,200
um

310
00:10:57,200 --> 00:10:58,720
so i know i'm really probably pretty

311
00:10:58,720 --> 00:11:01,040
sure on time at this point

312
00:11:01,040 --> 00:11:04,079
so um just a quick um note for for

313
00:11:04,079 --> 00:11:06,000
actually finding this in a client if

314
00:11:06,000 --> 00:11:08,240
you're office 365 administrator and have

315
00:11:08,240 --> 00:11:10,320
access to the azure active directory uh

316
00:11:10,320 --> 00:11:12,959
blade in azure um if you actually search

317
00:11:12,959 --> 00:11:14,880
for client app exchange activesync

318
00:11:14,880 --> 00:11:16,320
you'll actually see it and that is only

319
00:11:16,320 --> 00:11:17,200
going to show you the basic

320
00:11:17,200 --> 00:11:19,440
authentication side of activesync

321
00:11:19,440 --> 00:11:22,240
clients um it fully re-authenticates so

322
00:11:22,240 --> 00:11:24,720
you'll actually see frequent um

323
00:11:24,720 --> 00:11:26,800
frequent authentication actions which is

324
00:11:26,800 --> 00:11:28,959
actually pretty cool um just a quick

325
00:11:28,959 --> 00:11:30,320
note on this though

326
00:11:30,320 --> 00:11:32,000
the few minutes

327
00:11:32,000 --> 00:11:33,600
thank you

328
00:11:33,600 --> 00:11:34,560
um

329
00:11:34,560 --> 00:11:36,640
so uh note about this i just dropped a

330
00:11:36,640 --> 00:11:38,399
quick little splunk query in here this

331
00:11:38,399 --> 00:11:39,839
should catch most of everything and give

332
00:11:39,839 --> 00:11:41,360
you kind of a breakdown of who's using

333
00:11:41,360 --> 00:11:43,040
it um

334
00:11:43,040 --> 00:11:44,560
but the sign-in logs are actually more

335
00:11:44,560 --> 00:11:46,000
accurate when they're

336
00:11:46,000 --> 00:11:48,399
used accessed through the um

337
00:11:48,399 --> 00:11:50,000
i think the um

338
00:11:50,000 --> 00:11:52,880
people say you at uac united

339
00:11:52,880 --> 00:11:56,079
unified activity log that's it um

340
00:11:56,079 --> 00:11:58,320
unified audit logs in powershell and

341
00:11:58,320 --> 00:12:00,880
also in logs as as they're configured

342
00:12:00,880 --> 00:12:02,560
propagated to splunk rather than in the

343
00:12:02,560 --> 00:12:03,839
portal because

344
00:12:03,839 --> 00:12:06,000
in the portal it shows you in the list

345
00:12:06,000 --> 00:12:07,519
before you click details it will show

346
00:12:07,519 --> 00:12:08,560
you the client app and they'll say

347
00:12:08,560 --> 00:12:10,720
conditional access success even if

348
00:12:10,720 --> 00:12:12,880
conditional access was not applied as

349
00:12:12,880 --> 00:12:14,320
you can see in that graphic there this

350
00:12:14,320 --> 00:12:16,240
is really important because if your

351
00:12:16,240 --> 00:12:17,839
sysadmins just looking really quickly

352
00:12:17,839 --> 00:12:18,959
they're going to think that conditional

353
00:12:18,959 --> 00:12:21,120
access is working when it is actually

354
00:12:21,120 --> 00:12:23,120
not even being applied so very important

355
00:12:23,120 --> 00:12:24,639
point right here

356
00:12:24,639 --> 00:12:26,240
um so the first thing you can do to fix

357
00:12:26,240 --> 00:12:28,160
this is tweak conditional access policy

358
00:12:28,160 --> 00:12:30,639
just include everything um again it's

359
00:12:30,639 --> 00:12:32,880
much easier now that this has been

360
00:12:32,880 --> 00:12:35,519
reworked by microsoft to actually

361
00:12:35,519 --> 00:12:37,600
do an implicit deny

362
00:12:37,600 --> 00:12:39,680
on um on the applications that don't

363
00:12:39,680 --> 00:12:42,000
meet the protocol for what uh for what

364
00:12:42,000 --> 00:12:43,200
this is

365
00:12:43,200 --> 00:12:44,639
um and the end behavior is the client

366
00:12:44,639 --> 00:12:46,720
can authentic active sync and it looks

367
00:12:46,720 --> 00:12:48,079
like they can load an account but they

368
00:12:48,079 --> 00:12:49,279
can't view anything and we'll get a

369
00:12:49,279 --> 00:12:50,959
message saying hey you don't have access

370
00:12:50,959 --> 00:12:53,120
to anything which is actually pretty

371
00:12:53,120 --> 00:12:54,880
cool too and they were um and then you

372
00:12:54,880 --> 00:12:56,160
can also just disable legacy

373
00:12:56,160 --> 00:12:58,399
authentication altogether please do it

374
00:12:58,399 --> 00:12:59,600
please kill

375
00:12:59,600 --> 00:13:00,959
legacy off

376
00:13:00,959 --> 00:13:02,399
it is bad

377
00:13:02,399 --> 00:13:04,000
that's kind of a uh

378
00:13:04,000 --> 00:13:07,200
a universal truth uh but realistically

379
00:13:07,200 --> 00:13:09,279
we know that many um clients are still

380
00:13:09,279 --> 00:13:10,399
using it you're always gonna have that

381
00:13:10,399 --> 00:13:12,399
person who just has to use thunderbird

382
00:13:12,399 --> 00:13:14,079
or pine or whatever and uh they're

383
00:13:14,079 --> 00:13:15,519
probably a vip

384
00:13:15,519 --> 00:13:18,399
so um just make sure to do due diligence

385
00:13:18,399 --> 00:13:21,360
if you're enrolling users into factor

386
00:13:21,360 --> 00:13:22,639
via duo you're going to want to make

387
00:13:22,639 --> 00:13:24,560
sure that your conditional access policy

388
00:13:24,560 --> 00:13:26,959
covers everything basic is auth is

389
00:13:26,959 --> 00:13:29,519
disabled for new tenants uh 365 tenants

390
00:13:29,519 --> 00:13:31,120
and existing tenants that have zero use

391
00:13:31,120 --> 00:13:33,200
of basic off so if you've got one user

392
00:13:33,200 --> 00:13:35,200
your tenant has not disabled basic

393
00:13:35,200 --> 00:13:36,639
authentication

394
00:13:36,639 --> 00:13:38,160
plenty more resources on this happy to

395
00:13:38,160 --> 00:13:39,839
answer questions

396
00:13:39,839 --> 00:13:44,000
and that's it that's all i got

