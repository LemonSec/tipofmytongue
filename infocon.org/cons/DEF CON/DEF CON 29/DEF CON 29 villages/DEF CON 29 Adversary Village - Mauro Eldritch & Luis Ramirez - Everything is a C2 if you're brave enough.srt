1
00:00:00,480 --> 00:00:04,160
welcome to world talk everything is a

2
00:00:02,159 --> 00:00:06,160
situ if you are brave enough bye luis

3
00:00:04,160 --> 00:00:08,720
angel ramirez mendoza and mauro eltich

4
00:00:06,160 --> 00:00:11,040
from dc5411

5
00:00:08,720 --> 00:00:12,480
okay before we start i would like to

6
00:00:11,040 --> 00:00:14,400
make a brief introduction about

7
00:00:12,480 --> 00:00:16,480
ourselves the speakers and about the

8
00:00:14,400 --> 00:00:19,359
topic of this talk which is a

9
00:00:16,480 --> 00:00:20,640
rather crazy one also i would like to

10
00:00:19,359 --> 00:00:22,240
take this chance to

11
00:00:20,640 --> 00:00:24,400
say that we are really happy to be here

12
00:00:22,240 --> 00:00:27,840
at the adversary village

13
00:00:24,400 --> 00:00:29,760
and i really hope that you enjoyed this

14
00:00:27,840 --> 00:00:30,000
talk as much as we have enjoyed making

15
00:00:29,760 --> 00:00:33,120
it

16
00:00:30,000 --> 00:00:37,760
this was a really crazy thing for

17
00:00:33,120 --> 00:00:41,040
us i'm mauro elrich i'm from argentina

18
00:00:37,760 --> 00:00:42,719
i am the founder of dca and dc5411

19
00:00:41,040 --> 00:00:44,800
the defcon group that comprehends

20
00:00:42,719 --> 00:00:46,879
argentina and uruguay

21
00:00:44,800 --> 00:00:49,120
i spoke at different conferences before

22
00:00:46,879 --> 00:00:51,039
including defcon a couple of times

23
00:00:49,120 --> 00:00:52,239
and other conferences around the world

24
00:00:51,039 --> 00:00:55,840
including

25
00:00:52,239 --> 00:00:59,039
russia brazil colombia iran spain

26
00:00:55,840 --> 00:01:00,800
india pakistan panama peru and there are

27
00:00:59,039 --> 00:01:03,199
more to come

28
00:01:00,800 --> 00:01:04,879
my code speaker today is recently

29
00:01:03,199 --> 00:01:07,280
ramirez mendoza and he's going to

30
00:01:04,879 --> 00:01:10,080
introduce himself now

31
00:01:07,280 --> 00:01:12,080
thank you mauro hello everyone my name

32
00:01:10,080 --> 00:01:14,080
is luisa ramirez mendoza

33
00:01:12,080 --> 00:01:16,960
angorki under harvard security

34
00:01:14,080 --> 00:01:20,400
engineering and wilmingham cyber art

35
00:01:16,960 --> 00:01:22,320
and member group pc5411

36
00:01:20,400 --> 00:01:23,759
the speaker and different company

37
00:01:22,320 --> 00:01:27,360
included escom

38
00:01:23,759 --> 00:01:27,360
visa newcastle yaskon

39
00:01:37,600 --> 00:01:44,159
thanks luis so the topic of this talk

40
00:01:40,720 --> 00:01:46,960
as i said before is a rather crazy one

41
00:01:44,159 --> 00:01:47,439
we are going to try to demonstrate the

42
00:01:46,960 --> 00:01:50,159
most

43
00:01:47,439 --> 00:01:51,840
crazy unexpected and you might call it

44
00:01:50,159 --> 00:01:54,720
interesting two

45
00:01:51,840 --> 00:01:56,479
ways of setting up a situ server we're

46
00:01:54,720 --> 00:01:58,320
going to use different platforms

47
00:01:56,479 --> 00:02:00,560
different online profiles

48
00:01:58,320 --> 00:02:03,040
certain streaming platforms gaming

49
00:02:00,560 --> 00:02:06,880
platforms and even video games

50
00:02:03,040 --> 00:02:11,039
to try to build a situ server

51
00:02:06,880 --> 00:02:14,800
so let me explain this

52
00:02:11,039 --> 00:02:16,319
we try to make this talk as friendly as

53
00:02:14,800 --> 00:02:18,879
possible

54
00:02:16,319 --> 00:02:19,599
to every public so we will explain from

55
00:02:18,879 --> 00:02:22,080
scratch

56
00:02:19,599 --> 00:02:24,800
on this topic the construction and how

57
00:02:22,080 --> 00:02:28,400
to use a basic situ server

58
00:02:24,800 --> 00:02:30,879
and we are going to mutate

59
00:02:28,400 --> 00:02:31,840
this server to use different

60
00:02:30,879 --> 00:02:36,800
applications

61
00:02:31,840 --> 00:02:40,160
that are common to almost everyone here

62
00:02:36,800 --> 00:02:42,239
so the point is that we will

63
00:02:40,160 --> 00:02:44,480
we will part from a really basic c2

64
00:02:42,239 --> 00:02:47,360
server and we'll try to expand it to use

65
00:02:44,480 --> 00:02:48,400
different platforms for this we have

66
00:02:47,360 --> 00:02:51,040
created a

67
00:02:48,400 --> 00:02:52,239
fake a toy ransomware which will try to

68
00:02:51,040 --> 00:02:55,280
call home

69
00:02:52,239 --> 00:02:57,840
to leak some information to coordinate

70
00:02:55,280 --> 00:02:58,720
an attack this is a an encryption

71
00:02:57,840 --> 00:03:02,239
operation

72
00:02:58,720 --> 00:03:05,760
which we will see in a few that is not

73
00:03:02,239 --> 00:03:08,800
as dangerous as it seems and

74
00:03:05,760 --> 00:03:10,080
it will try to use the most crazy and

75
00:03:08,800 --> 00:03:11,680
unexpected ways

76
00:03:10,080 --> 00:03:15,040
to carry out these sections to

77
00:03:11,680 --> 00:03:15,040
communicate these actions

78
00:03:16,239 --> 00:03:21,599
just as a disclaimer both the ransomware

79
00:03:19,440 --> 00:03:22,000
and the situ samples here are unable to

80
00:03:21,599 --> 00:03:24,480
deal

81
00:03:22,000 --> 00:03:25,440
any kind of damage to their targets they

82
00:03:24,480 --> 00:03:28,879
have been built for

83
00:03:25,440 --> 00:03:32,080
educational proposals only and they

84
00:03:28,879 --> 00:03:35,120
can deal any damage at all not even

85
00:03:32,080 --> 00:03:37,360
accidentally these artifacts

86
00:03:35,120 --> 00:03:38,480
are not to be considered real water

87
00:03:37,360 --> 00:03:40,959
samples

88
00:03:38,480 --> 00:03:42,640
they are merely illustrative so some

89
00:03:40,959 --> 00:03:45,280
features that

90
00:03:42,640 --> 00:03:46,319
may be present on large skull or real

91
00:03:45,280 --> 00:03:49,599
world

92
00:03:46,319 --> 00:03:54,000
tools or samples will be missing here

93
00:03:49,599 --> 00:03:56,159
they won't be something implemented

94
00:03:54,000 --> 00:03:57,599
we haven't been involved in any kind of

95
00:03:56,159 --> 00:04:00,799
illegal activity

96
00:03:57,599 --> 00:04:03,280
and it will be really hard to do so with

97
00:04:00,799 --> 00:04:06,080
the samples

98
00:04:03,280 --> 00:04:07,120
so let's start with the introduction

99
00:04:06,080 --> 00:04:10,000
let's take a

100
00:04:07,120 --> 00:04:11,200
first glance at a basic situ we had

101
00:04:10,000 --> 00:04:14,720
built

102
00:04:11,200 --> 00:04:17,280
and from now on if you have never seen

103
00:04:14,720 --> 00:04:18,959
or you if you have no idea of how a situ

104
00:04:17,280 --> 00:04:22,000
works you will have the real

105
00:04:18,959 --> 00:04:23,919
the really basic knowledge to know what

106
00:04:22,000 --> 00:04:25,199
we are talking about and then this talk

107
00:04:23,919 --> 00:04:28,400
will go

108
00:04:25,199 --> 00:04:30,560
on more bizarre ways and we'll

109
00:04:28,400 --> 00:04:32,960
we'll start seeing some crazy things

110
00:04:30,560 --> 00:04:35,120
from now on

111
00:04:32,960 --> 00:04:37,120
so the obvious question here is what is

112
00:04:35,120 --> 00:04:40,080
a c2 server

113
00:04:37,120 --> 00:04:42,479
c2 stands for command and control server

114
00:04:40,080 --> 00:04:45,759
it's a server controlled by a bad actor

115
00:04:42,479 --> 00:04:47,680
an attacker which is used mostly to

116
00:04:45,759 --> 00:04:49,600
coordinate and distribute orders to

117
00:04:47,680 --> 00:04:52,800
infected systems

118
00:04:49,600 --> 00:04:53,360
these orders can carry out information

119
00:04:52,800 --> 00:04:55,840
leak

120
00:04:53,360 --> 00:04:56,479
lateral movement encryption operations

121
00:04:55,840 --> 00:04:58,240
and

122
00:04:56,479 --> 00:05:00,240
almost anything that you can picture in

123
00:04:58,240 --> 00:05:03,360
your head

124
00:05:00,240 --> 00:05:05,840
this traffic which is sent

125
00:05:03,360 --> 00:05:07,360
from an infected system to the common

126
00:05:05,840 --> 00:05:10,720
uncontrolled server

127
00:05:07,360 --> 00:05:13,680
tends to be hidden tends to

128
00:05:10,720 --> 00:05:15,120
tries to blend itself among normal

129
00:05:13,680 --> 00:05:17,440
applications or among

130
00:05:15,120 --> 00:05:18,639
other kind of traffic to disguise itself

131
00:05:17,440 --> 00:05:21,440
because

132
00:05:18,639 --> 00:05:23,120
otherwise it will be really easy to

133
00:05:21,440 --> 00:05:26,720
identify it to tag it

134
00:05:23,120 --> 00:05:28,240
and to block it now there are different

135
00:05:26,720 --> 00:05:30,320
connection models which

136
00:05:28,240 --> 00:05:32,000
won't be discussed here because we are

137
00:05:30,320 --> 00:05:32,960
trying to build something really basic

138
00:05:32,000 --> 00:05:36,560
just

139
00:05:32,960 --> 00:05:41,039
to give an example but there's not

140
00:05:36,560 --> 00:05:43,440
a single way on how the situ servers

141
00:05:41,039 --> 00:05:43,440
behave

142
00:05:44,639 --> 00:05:48,080
so for our example we set up as i said

143
00:05:47,680 --> 00:05:52,080
before

144
00:05:48,080 --> 00:05:54,720
a really basic situ server and client

145
00:05:52,080 --> 00:05:56,800
which should be able to do the following

146
00:05:54,720 --> 00:05:57,600
to register a new victim this is to

147
00:05:56,800 --> 00:06:01,199
identify

148
00:05:57,600 --> 00:06:01,759
correctly a new victim to generate and

149
00:06:01,199 --> 00:06:05,360
share an

150
00:06:01,759 --> 00:06:09,280
encryption key in order to encrypt

151
00:06:05,360 --> 00:06:12,240
the this victim actually this key

152
00:06:09,280 --> 00:06:12,560
won't be a real encryption key it will

153
00:06:12,240 --> 00:06:15,759
be

154
00:06:12,560 --> 00:06:17,919
a public ssh key which

155
00:06:15,759 --> 00:06:20,400
with the help of openssl you can use to

156
00:06:17,919 --> 00:06:22,479
encrypt files and different things

157
00:06:20,400 --> 00:06:23,680
but if this is out of scope we are not

158
00:06:22,479 --> 00:06:26,560
going to encrypt anything

159
00:06:23,680 --> 00:06:28,800
actually it will then try to leak

160
00:06:26,560 --> 00:06:31,280
information from the target

161
00:06:28,800 --> 00:06:32,880
and then encrypt the target file system

162
00:06:31,280 --> 00:06:36,080
which is the final

163
00:06:32,880 --> 00:06:38,639
objective of this malware

164
00:06:36,080 --> 00:06:40,240
but actually we are not going to encrypt

165
00:06:38,639 --> 00:06:42,160
anything as i said before

166
00:06:40,240 --> 00:06:43,600
we will only leave a ransom note on the

167
00:06:42,160 --> 00:06:46,639
desktop asking for

168
00:06:43,600 --> 00:06:48,160
a payment and something that we are not

169
00:06:46,639 --> 00:06:50,319
going to do yet

170
00:06:48,160 --> 00:06:51,919
is to disguise the traffic of this situ

171
00:06:50,319 --> 00:06:54,160
server using

172
00:06:51,919 --> 00:06:55,039
another well-known application or

173
00:06:54,160 --> 00:07:00,400
service

174
00:06:55,039 --> 00:07:00,400
or platform not yet as i said before

175
00:07:00,560 --> 00:07:04,240
so it's trying time and to make things

176
00:07:02,720 --> 00:07:06,880
funnier and

177
00:07:04,240 --> 00:07:08,960
to try to stick more to the real world

178
00:07:06,880 --> 00:07:10,720
we'll impersonate a new ransomware gang

179
00:07:08,960 --> 00:07:12,720
we are going to be the capybara gang

180
00:07:10,720 --> 00:07:14,800
dedicated to stealing capybara coins

181
00:07:12,720 --> 00:07:17,280
from unsuspecting victims

182
00:07:14,800 --> 00:07:19,360
around ransom notes will ask for payment

183
00:07:17,280 --> 00:07:21,840
in capybara coins exclusively

184
00:07:19,360 --> 00:07:23,440
capivaras artis friendly and nice

185
00:07:21,840 --> 00:07:24,160
looking lads that you can see in this

186
00:07:23,440 --> 00:07:26,240
picture

187
00:07:24,160 --> 00:07:28,880
and are common to brazil uruguay and

188
00:07:26,240 --> 00:07:31,919
argentina

189
00:07:28,880 --> 00:07:33,759
so uh a curious

190
00:07:31,919 --> 00:07:35,360
piece of information is that the capital

191
00:07:33,759 --> 00:07:37,280
coins are something real and actually

192
00:07:35,360 --> 00:07:39,759
fiat currencies that are

193
00:07:37,280 --> 00:07:41,680
our official currency in uruguay and

194
00:07:39,759 --> 00:07:42,560
they they feature one of these lovely

195
00:07:41,680 --> 00:07:45,919
lads

196
00:07:42,560 --> 00:07:47,120
uh obviously that's enough and a valid

197
00:07:45,919 --> 00:07:51,120
reason to want

198
00:07:47,120 --> 00:07:54,879
all of them so

199
00:07:51,120 --> 00:07:57,680
back to the technical field our server

200
00:07:54,879 --> 00:07:59,840
will use ruby and sinatra for

201
00:07:57,680 --> 00:08:01,599
establishing an api

202
00:07:59,840 --> 00:08:03,440
something that i must clarify here is

203
00:08:01,599 --> 00:08:06,560
that interpreted languages are

204
00:08:03,440 --> 00:08:08,720
not something common and i risk to say

205
00:08:06,560 --> 00:08:12,000
that

206
00:08:08,720 --> 00:08:14,479
i don't think they are used at all

207
00:08:12,000 --> 00:08:15,759
on on this kind of software on this kind

208
00:08:14,479 --> 00:08:17,840
of malware

209
00:08:15,759 --> 00:08:19,039
but it will be way more understandable

210
00:08:17,840 --> 00:08:21,440
to use these than

211
00:08:19,039 --> 00:08:22,319
any other language for this talk believe

212
00:08:21,440 --> 00:08:26,879
me

213
00:08:22,319 --> 00:08:28,800
we prefer to use ruby because it may

214
00:08:26,879 --> 00:08:31,520
it may help us in building something

215
00:08:28,800 --> 00:08:34,560
minimal a minimal artifact

216
00:08:31,520 --> 00:08:36,240
and the language is quite understandable

217
00:08:34,560 --> 00:08:39,519
for almost anybody

218
00:08:36,240 --> 00:08:40,000
so we decided to stick to this rather

219
00:08:39,519 --> 00:08:42,640
than

220
00:08:40,000 --> 00:08:44,880
sticking to c or or to any other

221
00:08:42,640 --> 00:08:48,720
language

222
00:08:44,880 --> 00:08:51,279
so let me explain the code really quick

223
00:08:48,720 --> 00:08:53,040
we require common libraries like sinatra

224
00:08:51,279 --> 00:08:57,040
and colorize in order to

225
00:08:53,040 --> 00:09:00,640
being able to output colored output

226
00:08:57,040 --> 00:09:04,000
and the rest net http and uri

227
00:09:00,640 --> 00:09:06,480
are part of the ruby core

228
00:09:04,000 --> 00:09:07,040
so we define a password for our situ

229
00:09:06,480 --> 00:09:08,800
server

230
00:09:07,040 --> 00:09:10,640
because we don't want anybody snooping

231
00:09:08,800 --> 00:09:13,839
around and stealing our

232
00:09:10,640 --> 00:09:13,839
complexity server

233
00:09:14,320 --> 00:09:20,399
we define some real basic endpoints

234
00:09:17,680 --> 00:09:22,480
addressing the previously tailored needs

235
00:09:20,399 --> 00:09:24,880
how to reserve and assign an id to

236
00:09:22,480 --> 00:09:26,320
expecting how to generate a key pair for

237
00:09:24,880 --> 00:09:29,279
each of them

238
00:09:26,320 --> 00:09:31,040
um asking to leak specific information

239
00:09:29,279 --> 00:09:32,480
from the host in this case it will only

240
00:09:31,040 --> 00:09:35,920
leak

241
00:09:32,480 --> 00:09:37,920
an ip address and a port like sort of a

242
00:09:35,920 --> 00:09:40,800
connection string in order to get back

243
00:09:37,920 --> 00:09:44,800
from the server to the client

244
00:09:40,800 --> 00:09:48,160
and actually we are going to

245
00:09:44,800 --> 00:09:51,040
to give up an encrypt endpoint

246
00:09:48,160 --> 00:09:51,440
in order to notify that we are going to

247
00:09:51,040 --> 00:09:55,120
start

248
00:09:51,440 --> 00:09:56,720
encryption operations on a given client

249
00:09:55,120 --> 00:09:58,399
again this is not going to encrypt

250
00:09:56,720 --> 00:10:00,240
anything

251
00:09:58,399 --> 00:10:02,160
and we have a last endpoint which will

252
00:10:00,240 --> 00:10:04,560
allow us to connect remotely

253
00:10:02,160 --> 00:10:06,240
to the compromise at host obviously

254
00:10:04,560 --> 00:10:08,399
using the information liquid before the

255
00:10:06,240 --> 00:10:10,399
connection string that i mentioned it

256
00:10:08,399 --> 00:10:12,320
we are going to query the telemetry

257
00:10:10,399 --> 00:10:13,920
endpoint and issue a houston comma in

258
00:10:12,320 --> 00:10:14,800
this case we only have the encrypt

259
00:10:13,920 --> 00:10:17,519
command

260
00:10:14,800 --> 00:10:18,000
nothing else and obviously this will

261
00:10:17,519 --> 00:10:19,839
require

262
00:10:18,000 --> 00:10:23,680
a password because we don't want anybody

263
00:10:19,839 --> 00:10:23,680
stealing our pressure circuit server

264
00:10:24,480 --> 00:10:30,880
the client it's pretty simple again it

265
00:10:27,680 --> 00:10:32,079
will query the server endpoints in order

266
00:10:30,880 --> 00:10:33,760
to do

267
00:10:32,079 --> 00:10:35,279
everything that we had mentioned before

268
00:10:33,760 --> 00:10:38,880
to register itself

269
00:10:35,279 --> 00:10:41,760
to get a victim id to get a victim key

270
00:10:38,880 --> 00:10:43,200
encryption key also leaking the

271
00:10:41,760 --> 00:10:45,600
compromises host

272
00:10:43,200 --> 00:10:47,519
ip address and port in order to create

273
00:10:45,600 --> 00:10:48,800
this connection string that the server

274
00:10:47,519 --> 00:10:52,160
needs

275
00:10:48,800 --> 00:10:55,360
and then after running all this routine

276
00:10:52,160 --> 00:10:56,880
it will place a ransom node once the

277
00:10:55,360 --> 00:11:01,839
server

278
00:10:56,880 --> 00:11:01,839
issues the encryption command

279
00:11:02,160 --> 00:11:06,000
now let's see how things turn out and

280
00:11:04,880 --> 00:11:07,680
then

281
00:11:06,000 --> 00:11:09,920
once you have this base and that you

282
00:11:07,680 --> 00:11:10,399
have you have a good understanding of

283
00:11:09,920 --> 00:11:12,240
what

284
00:11:10,399 --> 00:11:13,600
we are going to achieve here we are

285
00:11:12,240 --> 00:11:16,880
going to move to the

286
00:11:13,600 --> 00:11:20,000
wacky or not so orthodox methods

287
00:11:16,880 --> 00:11:22,800
so let's start with the demo

288
00:11:20,000 --> 00:11:24,480
okay as you can see here we have three

289
00:11:22,800 --> 00:11:26,640
different terminals

290
00:11:24,480 --> 00:11:28,240
the one on the upper left is the situ

291
00:11:26,640 --> 00:11:31,839
server it's going to run the

292
00:11:28,240 --> 00:11:33,440
capibata server this

293
00:11:31,839 --> 00:11:35,760
other terminal will send the crypt

294
00:11:33,440 --> 00:11:37,519
command once that we have everything set

295
00:11:35,760 --> 00:11:40,399
and ready to go

296
00:11:37,519 --> 00:11:41,120
and the lower one is a docker container

297
00:11:40,399 --> 00:11:44,399
which

298
00:11:41,120 --> 00:11:46,720
as it says here it's the victim so we

299
00:11:44,399 --> 00:11:49,760
will basically run the server

300
00:11:46,720 --> 00:11:52,639
run the client on the victim sites

301
00:11:49,760 --> 00:11:54,160
the claim will register itself and then

302
00:11:52,639 --> 00:11:56,399
when everything seems

303
00:11:54,160 --> 00:12:00,000
nice and smooth we are going to send the

304
00:11:56,399 --> 00:12:00,000
crypt command from this terminal

305
00:12:00,639 --> 00:12:03,519
let's make it roll

306
00:12:03,680 --> 00:12:12,399
so it started on the 4567 port

307
00:12:09,279 --> 00:12:14,800
we are going to launch the client on the

308
00:12:12,399 --> 00:12:14,800
victim

309
00:12:19,279 --> 00:12:25,760
wait oh okay now it should connect

310
00:12:23,680 --> 00:12:27,519
the exchange should happen real fast

311
00:12:25,760 --> 00:12:30,480
here well as you can see

312
00:12:27,519 --> 00:12:31,920
it already happened and it's already

313
00:12:30,480 --> 00:12:35,519
waiting

314
00:12:31,920 --> 00:12:39,200
as you can see for some input

315
00:12:35,519 --> 00:12:42,320
the victim was generated

316
00:12:39,200 --> 00:12:44,320
we have generated the key pair

317
00:12:42,320 --> 00:12:46,800
we have looked at the connection string

318
00:12:44,320 --> 00:12:48,800
the hostname and the connection string

319
00:12:46,800 --> 00:12:50,800
in this case it's a docker container as

320
00:12:48,800 --> 00:12:53,040
i said before

321
00:12:50,800 --> 00:12:53,959
it will start running a listener on the

322
00:12:53,040 --> 00:12:56,959
on this port

323
00:12:53,959 --> 00:12:56,959
13337

324
00:12:57,120 --> 00:13:00,639
which is established here in the

325
00:12:58,320 --> 00:13:04,399
connection string and it will wait

326
00:13:00,639 --> 00:13:05,760
for the input now we are going to send

327
00:13:04,399 --> 00:13:08,160
the crypt command

328
00:13:05,760 --> 00:13:10,079
versus going to make a c url we are

329
00:13:08,160 --> 00:13:12,240
going to make a post

330
00:13:10,079 --> 00:13:14,880
order encryption and password adversary

331
00:13:12,240 --> 00:13:17,200
as it says there

332
00:13:14,880 --> 00:13:20,480
this should be enough to start

333
00:13:17,200 --> 00:13:23,360
encryption operation

334
00:13:20,480 --> 00:13:24,160
okay it's done send an encrypt order to

335
00:13:23,360 --> 00:13:26,560
all

336
00:13:24,160 --> 00:13:27,600
attempting to encrypt this victim

337
00:13:26,560 --> 00:13:31,360
fetching

338
00:13:27,600 --> 00:13:34,160
the endpoint and now if we go to the

339
00:13:31,360 --> 00:13:37,440
desktop we should have a

340
00:13:34,160 --> 00:13:40,720
creepy ransom note

341
00:13:37,440 --> 00:13:40,720
if everything went smooth

342
00:13:41,920 --> 00:13:45,600
yeah it's there now what are these

343
00:13:44,160 --> 00:13:49,839
crooks up to

344
00:13:45,600 --> 00:13:49,839
what do they want from us

345
00:13:50,959 --> 00:13:54,959
ah i knew it from the start they were

346
00:13:52,639 --> 00:13:58,480
not capybara coins

347
00:13:54,959 --> 00:13:59,120
okay that's how the basic c2 interaction

348
00:13:58,480 --> 00:14:01,760
works

349
00:13:59,120 --> 00:14:02,800
now that you have seen how it behaves we

350
00:14:01,760 --> 00:14:07,680
are going to

351
00:14:02,800 --> 00:14:09,920
move on to the not so orthodox methods

352
00:14:07,680 --> 00:14:12,560
remember this is a basic diagram once

353
00:14:09,920 --> 00:14:14,959
again of what we have done so far

354
00:14:12,560 --> 00:14:16,399
we have the client which is the victim

355
00:14:14,959 --> 00:14:19,360
the server

356
00:14:16,399 --> 00:14:22,959
and the remote activator that can reside

357
00:14:19,360 --> 00:14:26,000
inside the server itself if you want to

358
00:14:22,959 --> 00:14:27,040
so let's move on to the fun part now the

359
00:14:26,000 --> 00:14:28,959
walkie clients

360
00:14:27,040 --> 00:14:30,320
how to hide situ traffic in the most

361
00:14:28,959 --> 00:14:33,839
unexpected way

362
00:14:30,320 --> 00:14:36,560
wacky crazy ways that you can

363
00:14:33,839 --> 00:14:36,560
ever picture

364
00:14:36,880 --> 00:14:40,560
so what's next so far our c2 is able to

365
00:14:40,160 --> 00:14:43,279
do

366
00:14:40,560 --> 00:14:44,000
a couple of things register a new victim

367
00:14:43,279 --> 00:14:47,040
that's done

368
00:14:44,000 --> 00:14:48,720
check share an encryption key check the

369
00:14:47,040 --> 00:14:51,839
information from the target

370
00:14:48,720 --> 00:14:54,480
check encrypt quoted

371
00:14:51,839 --> 00:14:56,240
the target's file system check and now

372
00:14:54,480 --> 00:14:58,800
we have something pending

373
00:14:56,240 --> 00:14:59,600
we have to disguise our traffic using

374
00:14:58,800 --> 00:15:01,760
some

375
00:14:59,600 --> 00:15:03,519
well-known applications platforms or

376
00:15:01,760 --> 00:15:07,279
service

377
00:15:03,519 --> 00:15:11,440
so let's start doing that

378
00:15:07,279 --> 00:15:13,760
thank you moro you too clean

379
00:15:11,440 --> 00:15:14,800
have you ever seen to wear youtube

380
00:15:13,760 --> 00:15:17,920
channel

381
00:15:14,800 --> 00:15:21,839
fail with nothing video of about

382
00:15:17,920 --> 00:15:24,959
5 seconds so of the art cal

383
00:15:21,839 --> 00:15:28,399
calibration or testing video channel

384
00:15:24,959 --> 00:15:30,959
under fuel via dimensions tool

385
00:15:28,399 --> 00:15:31,759
and sample with right torso and

386
00:15:30,959 --> 00:15:34,880
favorable

387
00:15:31,759 --> 00:15:37,199
semi-circle this was the original

388
00:15:34,880 --> 00:15:40,720
inspiration for this tall

389
00:15:37,199 --> 00:15:41,680
why not rely eonin or the naming

390
00:15:40,720 --> 00:15:45,680
calibration

391
00:15:41,680 --> 00:15:49,519
task for orchestrating or attack

392
00:15:45,680 --> 00:15:53,199
using youtube free apa we design

393
00:15:49,519 --> 00:15:54,800
to create fit video name as the minion

394
00:15:53,199 --> 00:15:58,000
city of command

395
00:15:54,800 --> 00:16:01,920
a secure star get kicked

396
00:15:58,000 --> 00:16:05,440
lead info crit sqn

397
00:16:01,920 --> 00:16:10,160
be contained not in both descent

398
00:16:05,440 --> 00:16:13,839
frozen frame for hull and mini

399
00:16:10,160 --> 00:16:18,399
we online car for the title

400
00:16:13,839 --> 00:16:22,160
nothing else no decretion except for

401
00:16:18,399 --> 00:16:25,360
get kicked for reason

402
00:16:22,160 --> 00:16:26,079
the claim would look to the video which

403
00:16:25,360 --> 00:16:29,839
were

404
00:16:26,079 --> 00:16:32,399
proplaid order and execute other

405
00:16:29,839 --> 00:16:33,920
when the title mass and a specific

406
00:16:32,399 --> 00:16:37,040
pander

407
00:16:33,920 --> 00:16:38,000
existing video can be rebooted a new

408
00:16:37,040 --> 00:16:42,160
video

409
00:16:38,000 --> 00:16:46,079
included is selling via youtube apa

410
00:16:42,160 --> 00:16:50,240
this can be do in antique with minutes

411
00:16:46,079 --> 00:16:53,040
minimal a favor and for free

412
00:16:50,240 --> 00:16:54,560
so let's see how things turn out here

413
00:16:53,040 --> 00:16:55,519
and obviously if you like this video

414
00:16:54,560 --> 00:16:58,480
don't forget to like

415
00:16:55,519 --> 00:16:59,279
and subscribe to our channel give me a

416
00:16:58,480 --> 00:17:02,480
second

417
00:16:59,279 --> 00:17:05,600
okay as you can see we have here this is

418
00:17:02,480 --> 00:17:08,640
another darker container the one below

419
00:17:05,600 --> 00:17:10,959
this is our channel which is crowded

420
00:17:08,640 --> 00:17:14,400
with subscribers and a lot of people

421
00:17:10,959 --> 00:17:16,839
who are interested in our things

422
00:17:14,400 --> 00:17:18,480
that's why we have so much visits on our

423
00:17:16,839 --> 00:17:21,919
videos

424
00:17:18,480 --> 00:17:24,400
and i apologize for the interface being

425
00:17:21,919 --> 00:17:27,600
in spanish

426
00:17:24,400 --> 00:17:28,240
so let's start we will show that the

427
00:17:27,600 --> 00:17:31,600
root

428
00:17:28,240 --> 00:17:32,000
and desktop folders are empty that's our

429
00:17:31,600 --> 00:17:35,280
channel

430
00:17:32,000 --> 00:17:37,280
id which is what we query via the api

431
00:17:35,280 --> 00:17:38,960
we have the different videos that mean

432
00:17:37,280 --> 00:17:40,799
different orders

433
00:17:38,960 --> 00:17:43,840
they are in reverse order here we are

434
00:17:40,799 --> 00:17:43,840
going to send the client

435
00:17:44,320 --> 00:17:49,120
it found the channel it found the videos

436
00:17:46,559 --> 00:17:50,799
it already has access to read the titles

437
00:17:49,120 --> 00:17:52,720
that's all it needs it doesn't need to

438
00:17:50,799 --> 00:17:54,160
watch the videos it doesn't need to do

439
00:17:52,720 --> 00:17:56,880
anything else

440
00:17:54,160 --> 00:17:57,919
it only asks for each one of these

441
00:17:56,880 --> 00:18:01,039
videos titled

442
00:17:57,919 --> 00:18:03,679
and the description only when it needs

443
00:18:01,039 --> 00:18:06,080
the ssh key here which is on the get key

444
00:18:03,679 --> 00:18:06,080
video

445
00:18:06,559 --> 00:18:09,679
that's right there it is it will take

446
00:18:09,200 --> 00:18:14,240
this

447
00:18:09,679 --> 00:18:17,600
this description field and use it as

448
00:18:14,240 --> 00:18:20,320
a real encryption key

449
00:18:17,600 --> 00:18:21,360
now let's see what these crooks are up

450
00:18:20,320 --> 00:18:26,720
to

451
00:18:21,360 --> 00:18:30,320
and they have once again

452
00:18:26,720 --> 00:18:33,120
hacked us okay so

453
00:18:30,320 --> 00:18:35,120
that's it for the youtube client this is

454
00:18:33,120 --> 00:18:36,240
a summary of how it works it's quite

455
00:18:35,120 --> 00:18:38,320
simple

456
00:18:36,240 --> 00:18:40,400
remember that all of these samples will

457
00:18:38,320 --> 00:18:43,200
be available at github

458
00:18:40,400 --> 00:18:44,960
after the talk so don't worry about it

459
00:18:43,200 --> 00:18:46,799
if you want to test them

460
00:18:44,960 --> 00:18:49,280
the only thing is that you will have to

461
00:18:46,799 --> 00:18:49,760
issue your own api keys but that's not a

462
00:18:49,280 --> 00:18:53,280
problem

463
00:18:49,760 --> 00:18:55,120
it's pretty easy to do so

464
00:18:53,280 --> 00:18:56,799
now let's move on to another client the

465
00:18:55,120 --> 00:19:00,559
spotify client

466
00:18:56,799 --> 00:19:03,919
i think almost all of us know spotify

467
00:19:00,559 --> 00:19:07,039
and we have been using their platform

468
00:19:03,919 --> 00:19:08,960
free api to craft a special playlist

469
00:19:07,039 --> 00:19:12,080
that you can see here

470
00:19:08,960 --> 00:19:13,760
the official capybaragang playlist the

471
00:19:12,080 --> 00:19:17,120
title of this playlist

472
00:19:13,760 --> 00:19:19,520
is quite fishy quite suspicious but this

473
00:19:17,120 --> 00:19:21,679
hasn't been valid so far so we're going

474
00:19:19,520 --> 00:19:23,840
to leave it as is

475
00:19:21,679 --> 00:19:25,679
it's composed of four different sections

476
00:19:23,840 --> 00:19:28,799
the first one is the wake word

477
00:19:25,679 --> 00:19:32,000
hits the second one is a

478
00:19:28,799 --> 00:19:35,200
dash dash separated ip address

479
00:19:32,000 --> 00:19:35,840
for the situ server and the third and

480
00:19:35,200 --> 00:19:39,120
fourth

481
00:19:35,840 --> 00:19:39,600
are pieces of the encryption key you may

482
00:19:39,120 --> 00:19:42,960
ask

483
00:19:39,600 --> 00:19:45,120
why are you storing them there well

484
00:19:42,960 --> 00:19:46,240
the description box contains the rest of

485
00:19:45,120 --> 00:19:49,520
the key

486
00:19:46,240 --> 00:19:51,679
but it is splitted due to the

487
00:19:49,520 --> 00:19:52,799
limitations that it has that the field

488
00:19:51,679 --> 00:19:56,000
has

489
00:19:52,799 --> 00:19:59,360
so we have to resort to

490
00:19:56,000 --> 00:20:01,200
this creative way of doing things which

491
00:19:59,360 --> 00:20:03,600
in turn seems to be a little bit messy

492
00:20:01,200 --> 00:20:05,760
but it works

493
00:20:03,600 --> 00:20:07,440
the playlist is made up of different

494
00:20:05,760 --> 00:20:09,440
songs obviously

495
00:20:07,440 --> 00:20:11,520
but the important thing about these

496
00:20:09,440 --> 00:20:13,760
songs is their title

497
00:20:11,520 --> 00:20:15,760
their titles verbally represent one of

498
00:20:13,760 --> 00:20:18,159
the comments to be executed

499
00:20:15,760 --> 00:20:20,159
here we have added a couple of new

500
00:20:18,159 --> 00:20:22,480
comments because this is a

501
00:20:20,159 --> 00:20:24,480
new work lion that had been a little bit

502
00:20:22,480 --> 00:20:26,880
further developed

503
00:20:24,480 --> 00:20:28,640
so so alive from love and rockets is the

504
00:20:26,880 --> 00:20:31,840
sequence start

505
00:20:28,640 --> 00:20:33,280
fix from the sisters of mercy is the

506
00:20:31,840 --> 00:20:35,280
common to fix the key

507
00:20:33,280 --> 00:20:37,440
to start exchanging the keys and to

508
00:20:35,280 --> 00:20:40,240
reassemble the key

509
00:20:37,440 --> 00:20:41,440
date and switch from km fdm is leak

510
00:20:40,240 --> 00:20:43,840
information

511
00:20:41,440 --> 00:20:45,039
thank from jogo canon on the seatbelts

512
00:20:43,840 --> 00:20:48,320
is start encryption

513
00:20:45,039 --> 00:20:48,640
or start the attack adios from km fdm

514
00:20:48,320 --> 00:20:51,760
it's

515
00:20:48,640 --> 00:20:55,120
sequence end then

516
00:20:51,760 --> 00:20:57,200
we have added this as a special case

517
00:20:55,120 --> 00:20:58,320
i started something that i could finish

518
00:20:57,200 --> 00:21:00,000
from the smiths

519
00:20:58,320 --> 00:21:02,559
actually means that we have interrupted

520
00:21:00,000 --> 00:21:02,960
jobs and a sleep from the smiths once

521
00:21:02,559 --> 00:21:06,320
again

522
00:21:02,960 --> 00:21:10,720
is weight these comments were briefly

523
00:21:06,320 --> 00:21:14,400
implemented for having mind

524
00:21:10,720 --> 00:21:17,280
special needs from other users

525
00:21:14,400 --> 00:21:18,880
so this is how the playlist will look

526
00:21:17,280 --> 00:21:21,280
take a look at this

527
00:21:18,880 --> 00:21:22,640
so alright will be reflected here so you

528
00:21:21,280 --> 00:21:24,720
can start

529
00:21:22,640 --> 00:21:26,480
i started something i can't finish we'll

530
00:21:24,720 --> 00:21:27,919
say warning some previous jobs who are

531
00:21:26,480 --> 00:21:31,760
interrupted

532
00:21:27,919 --> 00:21:34,400
fix we try to recover the key

533
00:21:31,760 --> 00:21:35,440
thank will start the encryption cycle

534
00:21:34,400 --> 00:21:38,559
and adios

535
00:21:35,440 --> 00:21:41,360
which means goodbye in spanish will

536
00:21:38,559 --> 00:21:42,240
be the sequence end so let's move on to

537
00:21:41,360 --> 00:21:43,919
the demo

538
00:21:42,240 --> 00:21:46,080
in order to see this in action because

539
00:21:43,919 --> 00:21:48,880
it may seem a little bit crazy now but

540
00:21:46,080 --> 00:21:48,880
it's quite simple

541
00:21:49,200 --> 00:21:54,720
ah before i forget

542
00:21:52,480 --> 00:21:55,520
as with the youtube client these songs

543
00:21:54,720 --> 00:21:58,320
can be

544
00:21:55,520 --> 00:21:59,919
added and removed really easy using the

545
00:21:58,320 --> 00:22:02,559
platform's api

546
00:21:59,919 --> 00:22:03,840
this costs minimal ford it's really fast

547
00:22:02,559 --> 00:22:07,200
and free

548
00:22:03,840 --> 00:22:08,159
so let's see now how things turn out and

549
00:22:07,200 --> 00:22:10,000
if you like

550
00:22:08,159 --> 00:22:13,360
our musical taste join the official

551
00:22:10,000 --> 00:22:16,400
copywhat again playlist

552
00:22:13,360 --> 00:22:19,280
okay again

553
00:22:16,400 --> 00:22:20,799
we have the container you know the

554
00:22:19,280 --> 00:22:22,880
docker container which is going to be

555
00:22:20,799 --> 00:22:25,440
the eternal victim

556
00:22:22,880 --> 00:22:27,039
we have this playlist with these eight

557
00:22:25,440 --> 00:22:30,559
songs

558
00:22:27,039 --> 00:22:30,559
and let's see how they behave

559
00:22:32,240 --> 00:22:37,280
it has already found our user and

560
00:22:34,559 --> 00:22:39,280
everything went really fast and smooth

561
00:22:37,280 --> 00:22:40,720
we have found the tainted playlist we

562
00:22:39,280 --> 00:22:41,919
are started reading the commands so

563
00:22:40,720 --> 00:22:44,880
we're live

564
00:22:41,919 --> 00:22:46,799
the c2 is recovered from the playlist

565
00:22:44,880 --> 00:22:50,400
title

566
00:22:46,799 --> 00:22:53,120
the key is recovered from the title

567
00:22:50,400 --> 00:22:55,440
ii there are some unfinished jobs here

568
00:22:53,120 --> 00:22:57,919
some interrupted jobs

569
00:22:55,440 --> 00:23:00,159
fix have already recovered the key and

570
00:22:57,919 --> 00:23:04,400
it looks to be good

571
00:23:00,159 --> 00:23:04,400
remember that it's splitted on three

572
00:23:06,840 --> 00:23:12,240
parts

573
00:23:08,080 --> 00:23:12,240
okay this is from the description field

574
00:23:12,880 --> 00:23:17,120
now don't have information to leak

575
00:23:14,720 --> 00:23:18,880
remember this is a dummy command

576
00:23:17,120 --> 00:23:21,120
we started the encryption cycle which

577
00:23:18,880 --> 00:23:24,240
will only leave

578
00:23:21,120 --> 00:23:25,919
this note two shadows is another comment

579
00:23:24,240 --> 00:23:27,919
that has been dropped

580
00:23:25,919 --> 00:23:29,440
from jean-love's jessica which will try

581
00:23:27,919 --> 00:23:31,919
to delete shadow copies

582
00:23:29,440 --> 00:23:34,320
as nib will wait anna dios will send

583
00:23:31,919 --> 00:23:36,880
obviously a sequence end

584
00:23:34,320 --> 00:23:38,880
now what happens if i delete two shadows

585
00:23:36,880 --> 00:23:41,679
as a leap and i started something

586
00:23:38,880 --> 00:23:41,679
from motorcycle

587
00:23:42,080 --> 00:23:45,600
this is to show that this happens in

588
00:23:44,799 --> 00:23:47,039
real time

589
00:23:45,600 --> 00:23:51,120
the client will read the comments in

590
00:23:47,039 --> 00:23:52,640
real time as you can see now there are

591
00:23:51,120 --> 00:23:56,320
no interrupted jobs

592
00:23:52,640 --> 00:23:59,760
nobody is waiting for anything and also

593
00:23:56,320 --> 00:24:04,000
we don't have uh the shadow

594
00:23:59,760 --> 00:24:06,799
delete command the two shadow song

595
00:24:04,000 --> 00:24:08,960
now oh no we have this strange file here

596
00:24:06,799 --> 00:24:12,880
and somebody's asking for

597
00:24:08,960 --> 00:24:12,880
capybara coins oh man

598
00:24:13,679 --> 00:24:18,400
okay i think it's time to move on to

599
00:24:15,520 --> 00:24:20,640
another client

600
00:24:18,400 --> 00:24:22,320
so this is the final summary as you can

601
00:24:20,640 --> 00:24:24,080
see different songs mean different

602
00:24:22,320 --> 00:24:27,600
comments

603
00:24:24,080 --> 00:24:29,520
so it's worth to give it a try now let's

604
00:24:27,600 --> 00:24:32,720
move to the next one

605
00:24:29,520 --> 00:24:35,760
wikipedia client you can use

606
00:24:32,720 --> 00:24:39,200
wikimedia's free api to query

607
00:24:35,760 --> 00:24:39,600
any article on wikipedia or being real

608
00:24:39,200 --> 00:24:42,880
here

609
00:24:39,600 --> 00:24:44,880
any other wikimedia instance

610
00:24:42,880 --> 00:24:46,799
after you register your user it is

611
00:24:44,880 --> 00:24:47,360
possible to read its profile page and

612
00:24:46,799 --> 00:24:51,520
add

613
00:24:47,360 --> 00:24:54,240
almost anything that you can imagine

614
00:24:51,520 --> 00:24:56,080
and once generated this is a special

615
00:24:54,240 --> 00:24:57,200
entry which is considered to be an

616
00:24:56,080 --> 00:25:00,559
article and can be

617
00:24:57,200 --> 00:25:03,760
queried via api it will have the form of

618
00:25:00,559 --> 00:25:05,919
user and your username

619
00:25:03,760 --> 00:25:07,600
so as we don't want to disturb a project

620
00:25:05,919 --> 00:25:10,960
like wikipedia

621
00:25:07,600 --> 00:25:14,400
we have only edited my own profile

622
00:25:10,960 --> 00:25:15,440
and we have only done one api query to

623
00:25:14,400 --> 00:25:17,679
read it once

624
00:25:15,440 --> 00:25:20,320
so there won't be a live demonstration

625
00:25:17,679 --> 00:25:24,400
of this client

626
00:25:20,320 --> 00:25:28,799
also we try to discourage any user to

627
00:25:24,400 --> 00:25:31,760
start using wikipedia to make testings

628
00:25:28,799 --> 00:25:33,200
as you can see that's my own page you

629
00:25:31,760 --> 00:25:33,679
have sequence start let me tell you a

630
00:25:33,200 --> 00:25:36,720
secret

631
00:25:33,679 --> 00:25:38,480
what's up do it and sequence end

632
00:25:36,720 --> 00:25:40,320
then we have a special client which will

633
00:25:38,480 --> 00:25:43,120
connect to the wikipedia api

634
00:25:40,320 --> 00:25:43,360
will fetch a specific tainted user which

635
00:25:43,120 --> 00:25:46,159
in

636
00:25:43,360 --> 00:25:47,919
which in this case is mine it will try

637
00:25:46,159 --> 00:25:50,559
to recover the comments from the page

638
00:25:47,919 --> 00:25:52,240
and parse them we have sequence start we

639
00:25:50,559 --> 00:25:54,080
have received the key

640
00:25:52,240 --> 00:25:56,080
there's no information to leak from our

641
00:25:54,080 --> 00:26:00,080
site start an encryption cycle

642
00:25:56,080 --> 00:26:02,480
and receive it sequence hand that's it

643
00:26:00,080 --> 00:26:04,880
again this page has been reverted as

644
00:26:02,480 --> 00:26:08,640
it's my own profile on wikipedia

645
00:26:04,880 --> 00:26:09,600
and we try to encourage if you want to

646
00:26:08,640 --> 00:26:12,880
test this to

647
00:26:09,600 --> 00:26:13,679
raise your own wikimedia server it's

648
00:26:12,880 --> 00:26:16,880
quite easy to

649
00:26:13,679 --> 00:26:19,600
be a docker or via virtual instance or

650
00:26:16,880 --> 00:26:22,559
whatever you want but it's worth to give

651
00:26:19,600 --> 00:26:25,600
it a try on a private instance

652
00:26:22,559 --> 00:26:26,080
so the next one uh here is when we start

653
00:26:25,600 --> 00:26:29,919
doing

654
00:26:26,080 --> 00:26:30,720
some way crazier things we say why not

655
00:26:29,919 --> 00:26:35,440
try

656
00:26:30,720 --> 00:26:39,600
world of warcraft or any other role game

657
00:26:35,440 --> 00:26:42,240
and we say okay why not give it a try

658
00:26:39,600 --> 00:26:43,200
we are using trinity core which is an

659
00:26:42,240 --> 00:26:45,919
awesome project

660
00:26:43,200 --> 00:26:48,240
an awesome project which is a private

661
00:26:45,919 --> 00:26:50,720
world of warcraft server emulator

662
00:26:48,240 --> 00:26:52,640
which you can use to easily create your

663
00:26:50,720 --> 00:26:54,960
own future instance

664
00:26:52,640 --> 00:26:56,320
now you may say wait how are you going

665
00:26:54,960 --> 00:26:58,799
to use this game

666
00:26:56,320 --> 00:27:00,880
maliciously and as you can see on the

667
00:26:58,799 --> 00:27:02,080
picture on the right it's something that

668
00:27:00,880 --> 00:27:05,120
you can ask but

669
00:27:02,080 --> 00:27:07,679
you know the answer we we have done it

670
00:27:05,120 --> 00:27:08,720
after creating a character the player

671
00:27:07,679 --> 00:27:11,840
can

672
00:27:08,720 --> 00:27:14,159
build any custom macros and also run

673
00:27:11,840 --> 00:27:17,039
minified lua scripts

674
00:27:14,159 --> 00:27:17,760
but bear in mind that the banded lua

675
00:27:17,039 --> 00:27:20,080
version of

676
00:27:17,760 --> 00:27:22,240
world of warcraft does not provide

677
00:27:20,080 --> 00:27:25,039
access to same time

678
00:27:22,240 --> 00:27:26,080
core functions like operating system

679
00:27:25,039 --> 00:27:30,880
operations

680
00:27:26,080 --> 00:27:35,039
or networking operations so you will be

681
00:27:30,880 --> 00:27:38,000
more or less caged inside the game so

682
00:27:35,039 --> 00:27:39,840
this may be something that we can still

683
00:27:38,000 --> 00:27:43,520
use in our favor

684
00:27:39,840 --> 00:27:43,520
as you can see now

685
00:27:43,600 --> 00:27:47,760
these macros and scripts can rust almost

686
00:27:46,240 --> 00:27:48,880
anything that you can do with your

687
00:27:47,760 --> 00:27:52,080
keyboard and mouse

688
00:27:48,880 --> 00:27:52,799
almost i can say for sure if it can run

689
00:27:52,080 --> 00:27:55,520
everything

690
00:27:52,799 --> 00:27:57,360
but so far it's it was able to do

691
00:27:55,520 --> 00:28:00,000
everything we needed

692
00:27:57,360 --> 00:28:01,279
so we could easily automate the flow of

693
00:28:00,000 --> 00:28:06,000
our situ

694
00:28:01,279 --> 00:28:06,000
routine in a very friendly and a very

695
00:28:06,159 --> 00:28:11,440
easy way so we have created

696
00:28:09,279 --> 00:28:13,279
the capybara macro that you can see on

697
00:28:11,440 --> 00:28:16,960
the right

698
00:28:13,279 --> 00:28:19,120
with that cute pow but

699
00:28:16,960 --> 00:28:20,320
it will only click certain buttons we

700
00:28:19,120 --> 00:28:24,399
can make it click

701
00:28:20,320 --> 00:28:27,760
on an action bar an action button

702
00:28:24,399 --> 00:28:29,279
but this is the question what do we want

703
00:28:27,760 --> 00:28:31,840
to do with those patterns

704
00:28:29,279 --> 00:28:32,720
so we started figuring out how we could

705
00:28:31,840 --> 00:28:37,039
start building

706
00:28:32,720 --> 00:28:39,120
short functions because as you can see

707
00:28:37,039 --> 00:28:40,240
on the lower part of the screenshot to

708
00:28:39,120 --> 00:28:44,240
the right

709
00:28:40,240 --> 00:28:47,520
we have used 126 characters

710
00:28:44,240 --> 00:28:49,840
out of 255

711
00:28:47,520 --> 00:28:51,679
which is pretty short pretty sure to

712
00:28:49,840 --> 00:28:54,799
build something

713
00:28:51,679 --> 00:28:56,880
on a comfortable way so we have to rely

714
00:28:54,799 --> 00:28:59,679
on a lot of creativity here

715
00:28:56,880 --> 00:29:00,960
in order to do minimalistic things which

716
00:28:59,679 --> 00:29:04,000
will

717
00:29:00,960 --> 00:29:04,000
be tied together

718
00:29:04,080 --> 00:29:08,480
so after a little research and a lot of

719
00:29:07,279 --> 00:29:11,039
tampering

720
00:29:08,480 --> 00:29:13,279
we have been able to create our level 14

721
00:29:11,039 --> 00:29:14,159
hacker which is ready to claim back

722
00:29:13,279 --> 00:29:17,200
waters and gold

723
00:29:14,159 --> 00:29:18,960
or take part in a ride as you can see

724
00:29:17,200 --> 00:29:23,919
this is the

725
00:29:18,960 --> 00:29:25,919
hackers toolbar the hacker's skills

726
00:29:23,919 --> 00:29:27,840
and now you may say okay but how are you

727
00:29:25,919 --> 00:29:28,159
going to distribute these commands or

728
00:29:27,840 --> 00:29:32,559
these

729
00:29:28,159 --> 00:29:34,640
skills luckily

730
00:29:32,559 --> 00:29:36,080
and this is some old information but we

731
00:29:34,640 --> 00:29:40,799
have discovered it just

732
00:29:36,080 --> 00:29:43,840
a few days ago trinity core

733
00:29:40,799 --> 00:29:46,399
provides a way of logging

734
00:29:43,840 --> 00:29:47,760
all of our chat inside the server all

735
00:29:46,399 --> 00:29:50,159
the chat that goes

736
00:29:47,760 --> 00:29:51,679
on on the server during each server

737
00:29:50,159 --> 00:29:55,039
session

738
00:29:51,679 --> 00:29:58,399
so using the chat function seemed like a

739
00:29:55,039 --> 00:30:01,440
nice idea and the right way to do things

740
00:29:58,399 --> 00:30:05,360
now we say okay we have the chats

741
00:30:01,440 --> 00:30:07,919
we have them recorded on a file but

742
00:30:05,360 --> 00:30:09,200
now we need to distribute them we need

743
00:30:07,919 --> 00:30:11,760
to filter them

744
00:30:09,200 --> 00:30:13,200
we don't want any player saying okay

745
00:30:11,760 --> 00:30:14,480
send this command theirs and this

746
00:30:13,200 --> 00:30:17,039
command here

747
00:30:14,480 --> 00:30:20,480
so we need to have a way to filter all

748
00:30:17,039 --> 00:30:20,480
of this and publish all of this

749
00:30:21,120 --> 00:30:25,440
as you can see in this screenshot we

750
00:30:22,720 --> 00:30:28,480
were able to pipe our chats

751
00:30:25,440 --> 00:30:29,520
to a file and we were tailing that file

752
00:30:28,480 --> 00:30:32,799
inside unix

753
00:30:29,520 --> 00:30:35,120
so far so good but this isn't going

754
00:30:32,799 --> 00:30:38,159
anywhere still

755
00:30:35,120 --> 00:30:41,440
yet we are not going anywhere with this

756
00:30:38,159 --> 00:30:41,760
so we have the chat i was able to parse

757
00:30:41,440 --> 00:30:45,120
them

758
00:30:41,760 --> 00:30:47,600
i was able to filter them only by

759
00:30:45,120 --> 00:30:51,679
drake my player which is in no way a

760
00:30:47,600 --> 00:30:54,480
reference to francis direct the pilot

761
00:30:51,679 --> 00:30:55,840
and we say okay now we have to pipe that

762
00:30:54,480 --> 00:30:59,120
very same file

763
00:30:55,840 --> 00:31:01,279
that log file somewhere we have to

764
00:30:59,120 --> 00:31:03,200
publish them over the network

765
00:31:01,279 --> 00:31:04,640
so the next point is to distribute the

766
00:31:03,200 --> 00:31:07,840
chat messages

767
00:31:04,640 --> 00:31:09,200
with sinatra that's it 8 lines of code

768
00:31:07,840 --> 00:31:12,080
and we can do it in

769
00:31:09,200 --> 00:31:12,799
way less i think but we wanted to keep

770
00:31:12,080 --> 00:31:16,000
the code

771
00:31:12,799 --> 00:31:17,200
as friendly as possible we are only

772
00:31:16,000 --> 00:31:19,519
going to read

773
00:31:17,200 --> 00:31:21,200
the last 10 entries from the chat log

774
00:31:19,519 --> 00:31:24,640
every time somebody requests an

775
00:31:21,200 --> 00:31:26,559
endpoint i know this is

776
00:31:24,640 --> 00:31:28,080
not the best way to do things we can

777
00:31:26,559 --> 00:31:31,679
also stream the file but

778
00:31:28,080 --> 00:31:33,039
things will do for now so now let's

779
00:31:31,679 --> 00:31:34,799
start the demo and let's

780
00:31:33,039 --> 00:31:38,080
participate in a ride this will be a

781
00:31:34,799 --> 00:31:43,120
little bit longer than the other videos

782
00:31:38,080 --> 00:31:46,240
give me a second okay

783
00:31:43,120 --> 00:31:49,279
now let me pause here we are on

784
00:31:46,240 --> 00:31:51,679
somewhere around westfall here

785
00:31:49,279 --> 00:31:52,640
we have three terminals here we have the

786
00:31:51,679 --> 00:31:56,640
first one which is

787
00:31:52,640 --> 00:31:59,600
situ i have made a little bit smaller

788
00:31:56,640 --> 00:32:01,120
because this is really a really crowded

789
00:31:59,600 --> 00:32:03,440
window

790
00:32:01,120 --> 00:32:04,240
we have the chat lock monitor here which

791
00:32:03,440 --> 00:32:07,360
will

792
00:32:04,240 --> 00:32:10,640
be tailing the chat log file and

793
00:32:07,360 --> 00:32:12,880
obviously the eternal victim this poor

794
00:32:10,640 --> 00:32:16,880
docker container which will receive

795
00:32:12,880 --> 00:32:20,320
again all the hits we have

796
00:32:16,880 --> 00:32:22,960
our macros here and action bar

797
00:32:20,320 --> 00:32:22,960
let's roll

798
00:32:26,399 --> 00:32:33,760
okay we'll start by turning on

799
00:32:30,559 --> 00:32:35,600
the capivada server okay awaiting

800
00:32:33,760 --> 00:32:38,240
connections

801
00:32:35,600 --> 00:32:39,120
now we're going to tail the file

802
00:32:38,240 --> 00:32:43,840
constantly

803
00:32:39,120 --> 00:32:43,840
so everything will be streamed here

804
00:32:44,399 --> 00:32:48,799
okay these are the dots that i sent to

805
00:32:47,039 --> 00:32:51,120
the file before

806
00:32:48,799 --> 00:32:51,840
and the victim will wait for a couple

807
00:32:51,120 --> 00:32:54,880
seconds now

808
00:32:51,840 --> 00:32:58,640
this is the capibara

809
00:32:54,880 --> 00:32:59,600
ramson c2 which will click sequentially

810
00:32:58,640 --> 00:33:02,240
on all of these

811
00:32:59,600 --> 00:33:04,159
little macros or lua scripts that are

812
00:33:02,240 --> 00:33:07,200
laying around here

813
00:33:04,159 --> 00:33:10,799
we have the encrypt getkey

814
00:33:07,200 --> 00:33:11,600
lickinfo reroll key reroll server if

815
00:33:10,799 --> 00:33:15,360
available

816
00:33:11,600 --> 00:33:18,559
sequence n sequence start and set key

817
00:33:15,360 --> 00:33:20,480
so now this will happen real quick take

818
00:33:18,559 --> 00:33:23,760
a look at the chat window

819
00:33:20,480 --> 00:33:26,960
once i click here the window will be

820
00:33:23,760 --> 00:33:26,960
crowded automatically

821
00:33:27,360 --> 00:33:29,679
okay

822
00:33:31,440 --> 00:33:35,679
now this is already piper there the

823
00:33:33,519 --> 00:33:39,600
client will look only for things

824
00:33:35,679 --> 00:33:42,640
that drake said

825
00:33:39,600 --> 00:33:45,440
now the client will connect

826
00:33:42,640 --> 00:33:46,080
to the server the server will stream the

827
00:33:45,440 --> 00:33:48,960
file

828
00:33:46,080 --> 00:33:49,360
or actually takes a couple of lines and

829
00:33:48,960 --> 00:33:53,840
boom

830
00:33:49,360 --> 00:33:57,279
this already happened as we were talking

831
00:33:53,840 --> 00:33:57,279
the docker container connected

832
00:33:58,080 --> 00:34:01,919
the hose won't be enrolled that's

833
00:33:59,600 --> 00:34:04,960
something that we have clarified before

834
00:34:01,919 --> 00:34:07,519
this is just a dummy function and

835
00:34:04,960 --> 00:34:09,200
your files are encrypted ransom node is

836
00:34:07,519 --> 00:34:12,159
once again present

837
00:34:09,200 --> 00:34:15,440
i think we should consider a cyber

838
00:34:12,159 --> 00:34:15,440
insurance company right now

839
00:34:16,079 --> 00:34:22,639
okay that's enough and wait

840
00:34:19,359 --> 00:34:22,639
i shouldn't go so fast

841
00:34:25,359 --> 00:34:33,440
yeah that should do so

842
00:34:29,440 --> 00:34:34,000
let's move on the same client this is by

843
00:34:33,440 --> 00:34:37,599
far

844
00:34:34,000 --> 00:34:39,599
the trickiest one we

845
00:34:37,599 --> 00:34:41,760
weren't really able to do a lot of

846
00:34:39,599 --> 00:34:43,520
things with steam's api

847
00:34:41,760 --> 00:34:45,200
which turned out to be really

848
00:34:43,520 --> 00:34:48,240
restrictive

849
00:34:45,200 --> 00:34:48,879
almost to the point on thinking that we

850
00:34:48,240 --> 00:34:52,320
should leave

851
00:34:48,879 --> 00:34:55,599
that behind and use another thing but

852
00:34:52,320 --> 00:34:57,839
luckily we find we found a workaround

853
00:34:55,599 --> 00:35:00,400
we decided on using the player profile

854
00:34:57,839 --> 00:35:02,800
page as a starting point

855
00:35:00,400 --> 00:35:03,760
because the api wasn't leading us

856
00:35:02,800 --> 00:35:07,040
anywhere

857
00:35:03,760 --> 00:35:08,480
so once we jumped into using this

858
00:35:07,040 --> 00:35:11,119
profile page

859
00:35:08,480 --> 00:35:11,760
we found that we don't have a lot of

860
00:35:11,119 --> 00:35:13,760
fields

861
00:35:11,760 --> 00:35:16,079
a lot of space to store things like a

862
00:35:13,760 --> 00:35:19,680
key or a situ address

863
00:35:16,079 --> 00:35:22,400
so we started once again

864
00:35:19,680 --> 00:35:24,320
thinking on a possible workaround for

865
00:35:22,400 --> 00:35:26,880
this

866
00:35:24,320 --> 00:35:27,760
we found that the optional field real

867
00:35:26,880 --> 00:35:32,079
name

868
00:35:27,760 --> 00:35:34,240
could be handy on this case

869
00:35:32,079 --> 00:35:35,599
as you can see here this is quite a

870
00:35:34,240 --> 00:35:38,400
strange real name

871
00:35:35,599 --> 00:35:40,560
i can tell you for sure that in

872
00:35:38,400 --> 00:35:44,480
argentina we don't use so

873
00:35:40,560 --> 00:35:46,800
so complicated names so

874
00:35:44,480 --> 00:35:49,599
you are okay if you think that this is

875
00:35:46,800 --> 00:35:49,599
something fishy

876
00:35:50,000 --> 00:35:53,599
as i say pretty strange name right so

877
00:35:52,240 --> 00:35:56,000
the content of this fill

878
00:35:53,599 --> 00:35:57,680
actually represents two different pastes

879
00:35:56,000 --> 00:36:00,480
on base bin

880
00:35:57,680 --> 00:36:03,119
the first contains the situ address and

881
00:36:00,480 --> 00:36:05,440
the second one contains the key

882
00:36:03,119 --> 00:36:06,160
now by reading the player profile via

883
00:36:05,440 --> 00:36:10,160
api

884
00:36:06,160 --> 00:36:12,480
we have enough information to start but

885
00:36:10,160 --> 00:36:14,160
how do we issue comments we are out of

886
00:36:12,480 --> 00:36:16,000
space we don't have a lot of things to

887
00:36:14,160 --> 00:36:19,200
modify here

888
00:36:16,000 --> 00:36:22,160
and using commands here will will be

889
00:36:19,200 --> 00:36:25,520
something pretty hard to implement

890
00:36:22,160 --> 00:36:28,560
so we decided to support

891
00:36:25,520 --> 00:36:31,520
two different modes on this client

892
00:36:28,560 --> 00:36:31,920
games and friends by using the games

893
00:36:31,520 --> 00:36:34,720
mode

894
00:36:31,920 --> 00:36:36,079
the c2 administrator can map a list of

895
00:36:34,720 --> 00:36:38,320
games owned by that

896
00:36:36,079 --> 00:36:40,160
account by the account we are using when

897
00:36:38,320 --> 00:36:42,160
the profile we're using

898
00:36:40,160 --> 00:36:43,359
we can map those games to a list of c2

899
00:36:42,160 --> 00:36:45,760
commands

900
00:36:43,359 --> 00:36:47,599
each game can represent a command and

901
00:36:45,760 --> 00:36:49,040
can be listed and deleted from the

902
00:36:47,599 --> 00:36:51,040
profile at will

903
00:36:49,040 --> 00:36:52,800
but this is not an easy process let me

904
00:36:51,040 --> 00:36:55,440
tell you

905
00:36:52,800 --> 00:36:56,400
by using the friends mode the the situ

906
00:36:55,440 --> 00:36:59,119
administrator can

907
00:36:56,400 --> 00:37:00,400
map this list of friends to a list of

908
00:36:59,119 --> 00:37:03,680
commands

909
00:37:00,400 --> 00:37:05,040
now each friend becomes a possible c2

910
00:37:03,680 --> 00:37:07,359
command

911
00:37:05,040 --> 00:37:08,720
again friends can be removed and added

912
00:37:07,359 --> 00:37:11,520
at will

913
00:37:08,720 --> 00:37:12,960
but again we discourage the use of this

914
00:37:11,520 --> 00:37:15,440
one specifically since

915
00:37:12,960 --> 00:37:16,800
both modes are not easily maintainable

916
00:37:15,440 --> 00:37:19,119
and my encoding bands

917
00:37:16,800 --> 00:37:20,839
seems pretty restrictive with bands at

918
00:37:19,119 --> 00:37:25,119
least on us

919
00:37:20,839 --> 00:37:27,520
so creating multiple accounts or using

920
00:37:25,119 --> 00:37:29,760
this for experimenting can turn your

921
00:37:27,520 --> 00:37:32,560
account into something usable

922
00:37:29,760 --> 00:37:32,560
so take care

923
00:37:34,000 --> 00:37:38,079
as you can see we have here a list of my

924
00:37:36,160 --> 00:37:39,280
friends which are not quite a lot

925
00:37:38,079 --> 00:37:41,839
actually

926
00:37:39,280 --> 00:37:44,400
so i mapped each one of them you can see

927
00:37:41,839 --> 00:37:48,880
this in line 41 which is commented

928
00:37:44,400 --> 00:37:51,119
each one is mapped to a command

929
00:37:48,880 --> 00:37:52,960
we start reading things and you can see

930
00:37:51,119 --> 00:37:53,599
that it says okay i found a pastebin

931
00:37:52,960 --> 00:37:54,960
clue

932
00:37:53,599 --> 00:37:56,640
this one and searching for the

933
00:37:54,960 --> 00:38:00,000
encryption key there

934
00:37:56,640 --> 00:38:01,839
and i found it now i have found

935
00:38:00,000 --> 00:38:03,520
another page with clue i'm searching for

936
00:38:01,839 --> 00:38:06,960
the c2ip there

937
00:38:03,520 --> 00:38:09,599
i found it and then it's try to start

938
00:38:06,960 --> 00:38:09,599
the routine

939
00:38:09,920 --> 00:38:19,280
let's see how the games mode work

940
00:38:14,240 --> 00:38:22,800
warhammer seems to be the sequence start

941
00:38:19,280 --> 00:38:25,359
lego set key kingdom rash league info

942
00:38:22,800 --> 00:38:28,400
dark extension script start and another

943
00:38:25,359 --> 00:38:30,400
warhammer is sequence end

944
00:38:28,400 --> 00:38:33,680
this will be exactly the same behavior

945
00:38:30,400 --> 00:38:36,560
it will start to look for

946
00:38:33,680 --> 00:38:37,280
the ip address and encryption key on

947
00:38:36,560 --> 00:38:40,720
placement

948
00:38:37,280 --> 00:38:44,839
but we'll use the games as uh

949
00:38:40,720 --> 00:38:48,160
as as a list of commands

950
00:38:44,839 --> 00:38:50,640
now the problem is that certain games

951
00:38:48,160 --> 00:38:52,000
are paid so it now supports free games

952
00:38:50,640 --> 00:38:55,040
too

953
00:38:52,000 --> 00:38:56,640
but again steam apis is

954
00:38:55,040 --> 00:38:58,320
a little bit restrictive so you have to

955
00:38:56,640 --> 00:39:00,960
explicitly ask for

956
00:38:58,320 --> 00:39:01,839
listing free games so as you may see

957
00:39:00,960 --> 00:39:05,040
this is the most

958
00:39:01,839 --> 00:39:09,359
wacky one so far let's see a demo

959
00:39:05,040 --> 00:39:12,800
about it give me a second once again

960
00:39:09,359 --> 00:39:14,880
okay this is my profile the base bins

961
00:39:12,800 --> 00:39:17,920
as you can see one contains the key the

962
00:39:14,880 --> 00:39:20,800
other one contains the plain ip address

963
00:39:17,920 --> 00:39:24,720
which are listed as my real name don't

964
00:39:20,800 --> 00:39:24,720
judge me by the games i play please

965
00:39:25,119 --> 00:39:29,920
now we're going to start using the

966
00:39:27,119 --> 00:39:33,200
method friends

967
00:39:29,920 --> 00:39:33,200
we'll start reading the commands

968
00:39:33,440 --> 00:39:38,240
again this is the placement this is the

969
00:39:36,000 --> 00:39:40,560
other placement

970
00:39:38,240 --> 00:39:43,280
and it will have placed already the

971
00:39:40,560 --> 00:39:43,280
ransom note

972
00:39:44,880 --> 00:39:47,440
let me check

973
00:39:49,920 --> 00:39:52,720
yeah it did

974
00:39:55,359 --> 00:40:00,480
oh man not these guys again

975
00:39:58,480 --> 00:40:01,839
so this was the last client we had the

976
00:40:00,480 --> 00:40:04,960
show today

977
00:40:01,839 --> 00:40:06,640
and sadly it's time to go

978
00:40:04,960 --> 00:40:08,000
we are really happy to be here today at

979
00:40:06,640 --> 00:40:10,880
the adversary village

980
00:40:08,000 --> 00:40:12,640
and we have really enjoyed doing this

981
00:40:10,880 --> 00:40:13,839
talk creating this all the research in

982
00:40:12,640 --> 00:40:16,640
these crazy topics

983
00:40:13,839 --> 00:40:18,160
and we really hope that you have enjoyed

984
00:40:16,640 --> 00:40:20,400
it too

985
00:40:18,160 --> 00:40:22,640
so let's jump to the conclusions on the

986
00:40:20,400 --> 00:40:24,400
q a

987
00:40:22,640 --> 00:40:25,760
our conclusions are simple these

988
00:40:24,400 --> 00:40:28,800
examples

989
00:40:25,760 --> 00:40:29,119
do not pose a real world danger but they

990
00:40:28,800 --> 00:40:32,720
can

991
00:40:29,119 --> 00:40:35,359
easily be used to be able to do so

992
00:40:32,720 --> 00:40:37,520
with a little bit of tweaking when

993
00:40:35,359 --> 00:40:38,480
talking about traffic never assume what

994
00:40:37,520 --> 00:40:40,400
might seem to be

995
00:40:38,480 --> 00:40:42,079
normal traffic to encyclopedias or

996
00:40:40,400 --> 00:40:43,839
streaming services could be hiding

997
00:40:42,079 --> 00:40:46,000
something else

998
00:40:43,839 --> 00:40:46,960
sometimes on plain sight sometimes a

999
00:40:46,000 --> 00:40:50,000
little bit more

1000
00:40:46,960 --> 00:40:53,040
complex like more cryptic way

1001
00:40:50,000 --> 00:40:54,560
like the spotify client i showed you and

1002
00:40:53,040 --> 00:40:56,480
if you want to build a nice hacker in

1003
00:40:54,560 --> 00:40:57,599
world of warcraft use raw clues

1004
00:40:56,480 --> 00:41:00,480
engineering

1005
00:40:57,599 --> 00:41:01,280
which are pretty nice choices if you are

1006
00:41:00,480 --> 00:41:04,880
brave enough

1007
00:41:01,280 --> 00:41:06,960
anything can be a situ don't be afraid

1008
00:41:04,880 --> 00:41:09,200
to reach out on twitter on github

1009
00:41:06,960 --> 00:41:12,240
we're always working on crazy things

1010
00:41:09,200 --> 00:41:14,480
mostly on hardware hacking projects but

1011
00:41:12,240 --> 00:41:16,160
sometimes we jump to software like we

1012
00:41:14,480 --> 00:41:18,839
did today

1013
00:41:16,160 --> 00:41:21,680
so get in touch don't be afraid to

1014
00:41:18,839 --> 00:41:24,800
approach we are going to publish this on

1015
00:41:21,680 --> 00:41:27,599
github so feel free to clone

1016
00:41:24,800 --> 00:41:29,440
the only thing you need to do yourself

1017
00:41:27,599 --> 00:41:30,880
is to get your api keys

1018
00:41:29,440 --> 00:41:33,040
because we are not going to obviously

1019
00:41:30,880 --> 00:41:35,440
upload hours

1020
00:41:33,040 --> 00:41:37,200
so we really hope you enjoyed this and

1021
00:41:35,440 --> 00:41:39,200
we want to thank all the adversary

1022
00:41:37,200 --> 00:41:41,119
village team for inviting us today

1023
00:41:39,200 --> 00:41:43,599
if you have any questions we are happy

1024
00:41:41,119 --> 00:41:46,079
to discuss them at the discord server

1025
00:41:43,599 --> 00:41:46,079
thank you

