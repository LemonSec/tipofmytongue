1
00:00:02,639 --> 00:00:04,480
hello thank you very much for being here

2
00:00:04,480 --> 00:00:06,160
with us

3
00:00:06,160 --> 00:00:08,080
my name is javier perez and i work as a

4
00:00:08,080 --> 00:00:09,840
director of research and development for

5
00:00:09,840 --> 00:00:11,519
dream data technologies

6
00:00:11,519 --> 00:00:14,240
and i'm juan escobar and i work as a

7
00:00:14,240 --> 00:00:16,320
senior cyber security consultant for

8
00:00:16,320 --> 00:00:18,240
dreamlab technologies

9
00:00:18,240 --> 00:00:20,240
this talk is basically in our experience

10
00:00:20,240 --> 00:00:22,320
in the field of security audits instead

11
00:00:22,320 --> 00:00:24,480
of response as well as in the research

12
00:00:24,480 --> 00:00:26,480
of new vulnerabilities and how they are

13
00:00:26,480 --> 00:00:30,720
applied in the ics cyber kill change

14
00:00:30,720 --> 00:00:33,200
ics are devices that generally operate

15
00:00:33,200 --> 00:00:35,280
in critical infrastructures these are

16
00:00:35,280 --> 00:00:37,040
not well known since they operate in a

17
00:00:37,040 --> 00:00:38,879
different environment compared with

18
00:00:38,879 --> 00:00:40,719
companies that have common information

19
00:00:40,719 --> 00:00:42,000
technologies

20
00:00:42,000 --> 00:00:42,960
also

21
00:00:42,960 --> 00:00:45,520
many incidents involving ics devices and

22
00:00:45,520 --> 00:00:47,520
the ot environment have had very

23
00:00:47,520 --> 00:00:49,760
important geopolitical connotations

24
00:00:49,760 --> 00:00:51,520
which has changed the world related to

25
00:00:51,520 --> 00:00:54,320
the vulnerabilities existing in them

26
00:00:54,320 --> 00:00:56,399
which has led governments to take

27
00:00:56,399 --> 00:00:58,160
measures that classify them as a

28
00:00:58,160 --> 00:01:01,919
critical element of the nation

29
00:01:02,239 --> 00:01:04,559
as many of you probably know today we

30
00:01:04,559 --> 00:01:08,080
are in what is called industry 4.0 which

31
00:01:08,080 --> 00:01:09,600
is characterized by broad

32
00:01:09,600 --> 00:01:12,080
interconnectivity data collection

33
00:01:12,080 --> 00:01:14,720
analysis and communication which results

34
00:01:14,720 --> 00:01:16,880
in the optimization of the flow and

35
00:01:16,880 --> 00:01:19,200
quality processes

36
00:01:19,200 --> 00:01:21,600
although the benefits are many this

37
00:01:21,600 --> 00:01:24,320
convergence between the it and others

38
00:01:24,320 --> 00:01:26,720
increases the attack surface

39
00:01:26,720 --> 00:01:29,040
and as well as the number of new

40
00:01:29,040 --> 00:01:32,400
controls to implement

41
00:01:33,200 --> 00:01:35,360
basing on this province

42
00:01:35,360 --> 00:01:37,680
is that in the 90s theodore

43
00:01:37,680 --> 00:01:39,360
williams along with members of the

44
00:01:39,360 --> 00:01:41,520
purdue university consortium developed

45
00:01:41,520 --> 00:01:43,280
the purdue enterprise reference

46
00:01:43,280 --> 00:01:46,560
architecture as a model for enterprise

47
00:01:46,560 --> 00:01:48,799
architectures where the puritan model

48
00:01:48,799 --> 00:01:50,640
defines the different levels of critical

49
00:01:50,640 --> 00:01:52,720
infrastructure that are used in

50
00:01:52,720 --> 00:01:54,960
production lines and the way to secure

51
00:01:54,960 --> 00:01:57,680
them but as we know is very difficult to

52
00:01:57,680 --> 00:02:00,320
implement maintain and monitor all cyber

53
00:02:00,320 --> 00:02:03,279
security system

54
00:02:05,360 --> 00:02:07,759
we must remember that not all companies

55
00:02:07,759 --> 00:02:08,878
are the same

56
00:02:08,878 --> 00:02:11,120
therefore the security mechanisms and

57
00:02:11,120 --> 00:02:13,280
architectures are different but at the

58
00:02:13,280 --> 00:02:15,599
base and activities to be carried out by

59
00:02:15,599 --> 00:02:17,840
an attacker will almost always be the

60
00:02:17,840 --> 00:02:18,959
same

61
00:02:18,959 --> 00:02:21,360
that is why michael assant and robert

62
00:02:21,360 --> 00:02:23,760
lee adapted the cyber kill change model

63
00:02:23,760 --> 00:02:26,400
created by lockheed martin to the ics

64
00:02:26,400 --> 00:02:28,879
world to understand visualize and

65
00:02:28,879 --> 00:02:30,800
organize the steps required for an

66
00:02:30,800 --> 00:02:34,000
adversary to reach their goal so the ic

67
00:02:34,000 --> 00:02:36,400
ics cyber kill chain consists of two

68
00:02:36,400 --> 00:02:37,440
phases

69
00:02:37,440 --> 00:02:39,280
cyber intrusion

70
00:02:39,280 --> 00:02:42,080
preparation and execution is related to

71
00:02:42,080 --> 00:02:44,239
the id war and the ics attack

72
00:02:44,239 --> 00:02:47,040
development and execution is related to

73
00:02:47,040 --> 00:02:50,239
the i.t world

74
00:02:50,239 --> 00:02:51,200
so

75
00:02:51,200 --> 00:02:54,560
in this tool we will try to emulate

76
00:02:54,560 --> 00:02:57,360
the most common vector attacks

77
00:02:57,360 --> 00:03:00,640
to get access to a remote

78
00:03:00,640 --> 00:03:04,040
power plant

79
00:03:05,519 --> 00:03:07,599
let's see what these steps are for the

80
00:03:07,599 --> 00:03:11,760
stage one the first one is recognizance

81
00:03:11,760 --> 00:03:13,920
recognizing is an activity to obtain

82
00:03:13,920 --> 00:03:16,159
information about something

83
00:03:16,159 --> 00:03:18,480
through observation and or other

84
00:03:18,480 --> 00:03:20,959
detection methods this activity is

85
00:03:20,959 --> 00:03:23,120
divided into passive and active

86
00:03:23,120 --> 00:03:25,280
recognitions where the passive is in

87
00:03:25,280 --> 00:03:27,120
charge of searching for the information

88
00:03:27,120 --> 00:03:29,680
available in public sources and the

89
00:03:29,680 --> 00:03:31,360
active interacts directly with the

90
00:03:31,360 --> 00:03:35,360
target for the collection information

91
00:03:36,000 --> 00:03:37,760
okay let's continue

92
00:03:37,760 --> 00:03:40,080
first let's define our target and the

93
00:03:40,080 --> 00:03:42,159
attacker in this case the target is a

94
00:03:42,159 --> 00:03:44,400
nuclear power plant called macros and

95
00:03:44,400 --> 00:03:46,879
the attackers will be a group called

96
00:03:46,879 --> 00:03:49,760
apt-666

97
00:03:49,760 --> 00:03:51,840
if we search for this nuclear nuclear

98
00:03:51,840 --> 00:03:54,879
plant in google we have a result

99
00:03:54,879 --> 00:03:56,799
and we can see

100
00:03:56,799 --> 00:03:58,799
that this plan

101
00:03:58,799 --> 00:04:01,760
is located in switzerland also has

102
00:04:01,760 --> 00:04:03,120
another

103
00:04:03,120 --> 00:04:06,080
energy project

104
00:04:09,599 --> 00:04:11,519
continuing with passive recognizance we

105
00:04:11,519 --> 00:04:14,560
can do search in cholan or sumai where

106
00:04:14,560 --> 00:04:16,720
probably there is not much information

107
00:04:16,720 --> 00:04:20,238
which always should be the case

108
00:04:20,238 --> 00:04:22,880
in linkedin we find one profile related

109
00:04:22,880 --> 00:04:24,960
to the company and not much else in

110
00:04:24,960 --> 00:04:27,199
internet

111
00:04:27,199 --> 00:04:29,199
it is when the attackers carry out an

112
00:04:29,199 --> 00:04:31,759
active recognizance obviously both

113
00:04:31,759 --> 00:04:33,919
activities can be carried out in

114
00:04:33,919 --> 00:04:36,400
parallel

115
00:04:36,400 --> 00:04:38,479
as we know the plan is located in

116
00:04:38,479 --> 00:04:40,639
switzerland so we proceed to scan the

117
00:04:40,639 --> 00:04:42,960
entire country looking for any reference

118
00:04:42,960 --> 00:04:44,320
to the company

119
00:04:44,320 --> 00:04:47,759
one of the protocols consulted is snmp

120
00:04:47,759 --> 00:04:48,880
although there are not many

121
00:04:48,880 --> 00:04:51,040
vulnerabilities for it it provides

122
00:04:51,040 --> 00:04:53,759
information that may be important to

123
00:04:53,759 --> 00:04:55,759
carry out an attack

124
00:04:55,759 --> 00:04:58,400
for this purpose an automatic tool is

125
00:04:58,400 --> 00:05:01,600
created and launched nationwide using

126
00:05:01,600 --> 00:05:03,759
the default community stream to perform

127
00:05:03,759 --> 00:05:05,360
the authentication

128
00:05:05,360 --> 00:05:06,960
as a result

129
00:05:06,960 --> 00:05:08,800
we can see there is an ipa related to

130
00:05:08,800 --> 00:05:11,840
the company

131
00:05:14,560 --> 00:05:16,479
so in this tool

132
00:05:16,479 --> 00:05:17,919
we will set

133
00:05:17,919 --> 00:05:22,719
the name of the database the community

134
00:05:23,440 --> 00:05:27,280
and the files with the eyepiece

135
00:05:30,880 --> 00:05:33,120
so in switzerland there is around 20

136
00:05:33,120 --> 00:05:36,320
million psip so this will take a

137
00:05:36,320 --> 00:05:37,360
like a

138
00:05:37,360 --> 00:05:39,680
couple of hours to finish

139
00:05:39,680 --> 00:05:41,600
but now we can see

140
00:05:41,600 --> 00:05:45,199
and that we have the result related to

141
00:05:45,199 --> 00:05:46,000
the

142
00:05:46,000 --> 00:05:49,520
macros electric power

143
00:05:50,840 --> 00:05:52,800
plant so

144
00:05:52,800 --> 00:05:57,520
in this ip address that was not a

145
00:05:57,600 --> 00:06:00,479
link of any

146
00:06:00,639 --> 00:06:03,280
site like showdown or sumai

147
00:06:03,280 --> 00:06:06,240
we will scan to see what it is in this

148
00:06:06,240 --> 00:06:08,319
iep address related to

149
00:06:08,319 --> 00:06:11,919
the macro selected power plant

150
00:06:13,840 --> 00:06:15,840
now we will see what information this

151
00:06:15,840 --> 00:06:18,080
service can give us for this we can use

152
00:06:18,080 --> 00:06:20,400
several tools but now we will use one

153
00:06:20,400 --> 00:06:23,759
called snmp check that will give us the

154
00:06:23,759 --> 00:06:26,479
data in an orderly way

155
00:06:26,479 --> 00:06:27,600
as we see

156
00:06:27,600 --> 00:06:29,680
it give us quite a lot of information

157
00:06:29,680 --> 00:06:32,160
but an interesting piece of information

158
00:06:32,160 --> 00:06:36,160
correspond the network connections

159
00:06:36,240 --> 00:06:38,400
here we can highlight a connection

160
00:06:38,400 --> 00:06:42,318
established to port 22

161
00:06:45,280 --> 00:06:47,120
which is generally used for remote

162
00:06:47,120 --> 00:06:49,919
administration and we can see that it's

163
00:06:49,919 --> 00:06:52,560
accessible

164
00:06:52,560 --> 00:06:55,280
now we know that someone is connected so

165
00:06:55,280 --> 00:06:57,599
we can assume that is someone who

166
00:06:57,599 --> 00:06:59,280
manages this system

167
00:06:59,280 --> 00:07:04,400
let's see what we find in this source ip

168
00:07:04,400 --> 00:07:07,039
we launch a quick scan and see that for

169
00:07:07,039 --> 00:07:09,599
ads open

170
00:07:09,599 --> 00:07:11,360
we exit through the browser and see

171
00:07:11,360 --> 00:07:13,599
there is a login page

172
00:07:13,599 --> 00:07:15,599
with a little more research we see that

173
00:07:15,599 --> 00:07:18,240
type of device it is and what part of

174
00:07:18,240 --> 00:07:22,800
the world the expert is assigned

175
00:07:22,960 --> 00:07:24,479
this is a

176
00:07:24,479 --> 00:07:26,479
home router

177
00:07:26,479 --> 00:07:31,120
located in the united states as we take

178
00:07:31,120 --> 00:07:32,000
a look

179
00:07:32,000 --> 00:07:33,919
and do some research about it and we

180
00:07:33,919 --> 00:07:35,840
don't have any vulnerabilities on this

181
00:07:35,840 --> 00:07:38,239
device

182
00:07:38,560 --> 00:07:40,560
so as a summary of the first step we

183
00:07:40,560 --> 00:07:43,280
have one link hidden account one website

184
00:07:43,280 --> 00:07:46,240
one linux servers one snmp service one

185
00:07:46,240 --> 00:07:47,120
in

186
00:07:47,120 --> 00:07:49,680
one interesting ip address and one

187
00:07:49,680 --> 00:07:51,680
internet border device with not no

188
00:07:51,680 --> 00:07:54,560
vulnerabilities

189
00:07:54,639 --> 00:07:56,240
next step

190
00:07:56,240 --> 00:07:58,479
the preparation

191
00:07:58,479 --> 00:08:00,400
in this step there is weaponization and

192
00:08:00,400 --> 00:08:02,800
targeting both can take place but this

193
00:08:02,800 --> 00:08:05,039
is not required basically this step is

194
00:08:05,039 --> 00:08:06,720
to prepare the tools according to

195
00:08:06,720 --> 00:08:08,400
identify objective

196
00:08:08,400 --> 00:08:10,639
in this case we will use two vectors the

197
00:08:10,639 --> 00:08:12,400
social engineering one

198
00:08:12,400 --> 00:08:13,919
and the other we will call it

199
00:08:13,919 --> 00:08:16,720
infrastructure

200
00:08:16,720 --> 00:08:18,400
our goal for the social engineering

201
00:08:18,400 --> 00:08:20,080
vector is that the victim visit a

202
00:08:20,080 --> 00:08:22,319
malicious website and exploit abundant

203
00:08:22,319 --> 00:08:24,720
ability in order to take control of her

204
00:08:24,720 --> 00:08:28,080
computer our school excuse will be an

205
00:08:28,080 --> 00:08:30,080
interview for a magazine specialized in

206
00:08:30,080 --> 00:08:32,240
cyber security issues in industrial

207
00:08:32,240 --> 00:08:35,039
environments

208
00:08:37,039 --> 00:08:38,399
so for this

209
00:08:38,399 --> 00:08:40,419
vector we will create a

210
00:08:40,419 --> 00:08:42,000
[Music]

211
00:08:42,000 --> 00:08:43,919
fake website

212
00:08:43,919 --> 00:08:45,920
where we locate

213
00:08:45,920 --> 00:08:46,880
our

214
00:08:46,880 --> 00:08:48,080
exploit

215
00:08:48,080 --> 00:08:50,160
for browser

216
00:08:50,160 --> 00:08:51,360
and also

217
00:08:51,360 --> 00:08:55,040
we create a fake linkedin account

218
00:08:55,040 --> 00:08:56,720
for a journalist

219
00:08:56,720 --> 00:08:59,680
who is working on this fake

220
00:08:59,680 --> 00:09:01,680
magazine called

221
00:09:01,680 --> 00:09:04,680
scalawire.com

222
00:09:06,720 --> 00:09:09,360
okay and now our plan for the vector 2

223
00:09:09,360 --> 00:09:11,519
infrastructure is also similar to the

224
00:09:11,519 --> 00:09:14,160
previous one we want to redirect all the

225
00:09:14,160 --> 00:09:17,279
web traffic to our malicious sites

226
00:09:17,279 --> 00:09:19,200
but since we don't know who is behind

227
00:09:19,200 --> 00:09:21,519
this device we need to hack the device

228
00:09:21,519 --> 00:09:23,519
and change the configuration of the dns

229
00:09:23,519 --> 00:09:26,240
server so in this way the traffic can be

230
00:09:26,240 --> 00:09:30,959
redirected to our malicious dns server

231
00:09:31,600 --> 00:09:32,560
so i

232
00:09:32,560 --> 00:09:34,240
we don't know the password we have to

233
00:09:34,240 --> 00:09:37,040
find a way to enter to this device

234
00:09:37,040 --> 00:09:39,120
so what we're going to do is try to find

235
00:09:39,120 --> 00:09:41,680
a vulnerability

236
00:09:41,680 --> 00:09:45,200
so we will try to find our zero day

237
00:09:45,200 --> 00:09:46,000
uh

238
00:09:46,000 --> 00:09:50,240
what we going to do is try to fast

239
00:09:50,240 --> 00:09:52,080
the parameters

240
00:09:52,080 --> 00:09:54,959
of this web application and try to find

241
00:09:54,959 --> 00:09:57,440
some kind of

242
00:09:57,440 --> 00:09:59,440
remote code execution because these

243
00:09:59,440 --> 00:10:00,640
devices

244
00:10:00,640 --> 00:10:03,519
are common vulnerability to this kind of

245
00:10:03,519 --> 00:10:06,480
vulnerabilities

246
00:10:06,480 --> 00:10:09,760
so we will try to fast

247
00:10:09,760 --> 00:10:14,560
all these parameters in the pos regions

248
00:10:15,680 --> 00:10:18,800
so what we did was

249
00:10:18,800 --> 00:10:20,880
using a

250
00:10:20,880 --> 00:10:22,480
dictionary with

251
00:10:22,480 --> 00:10:24,160
a lot of comments

252
00:10:24,160 --> 00:10:28,240
in unix try to find a way to

253
00:10:28,240 --> 00:10:31,040
execute some commands and we can see in

254
00:10:31,040 --> 00:10:33,760
payload 6 and playbook 7

255
00:10:33,760 --> 00:10:35,760
we have the answer

256
00:10:35,760 --> 00:10:38,160
what we need so in this moment we find

257
00:10:38,160 --> 00:10:41,040
our remote code execution

258
00:10:41,040 --> 00:10:43,920
on this device so this is a zero day

259
00:10:43,920 --> 00:10:46,920
vulnerability

260
00:10:48,240 --> 00:10:50,640
so now in the

261
00:10:50,640 --> 00:10:52,800
field keypad

262
00:10:52,800 --> 00:10:56,640
sending a specific request concatenated

263
00:10:56,640 --> 00:10:57,839
to the

264
00:10:57,839 --> 00:11:00,800
parameter we have a remote current

265
00:11:00,800 --> 00:11:03,200
execution in this case we send the

266
00:11:03,200 --> 00:11:04,720
command id

267
00:11:04,720 --> 00:11:07,120
to identify who is running the process

268
00:11:07,120 --> 00:11:08,959
in this case it's a remote code

269
00:11:08,959 --> 00:11:11,518
execution

270
00:11:13,120 --> 00:11:16,240
with root privilege

271
00:11:16,720 --> 00:11:17,600
so

272
00:11:17,600 --> 00:11:19,839
now we finish the preparation and

273
00:11:19,839 --> 00:11:23,519
weaponization and targeting now we go to

274
00:11:23,519 --> 00:11:25,519
the next step is cyber nutrition

275
00:11:25,519 --> 00:11:27,920
management enablement and sustainment

276
00:11:27,920 --> 00:11:30,079
entrenchment development

277
00:11:30,079 --> 00:11:32,240
and execution

278
00:11:32,240 --> 00:11:36,640
so basically and this is the moment and

279
00:11:36,640 --> 00:11:38,240
we can act

280
00:11:38,240 --> 00:11:40,560
so can we deliberately explore install

281
00:11:40,560 --> 00:11:43,519
or modify

282
00:11:43,519 --> 00:11:47,279
to gain access to the system of the

283
00:11:47,279 --> 00:11:48,320
victim

284
00:11:48,320 --> 00:11:50,560
and we launched

285
00:11:50,560 --> 00:11:52,880
our command and control

286
00:11:52,880 --> 00:11:54,880
and using methods as a connection to

287
00:11:54,880 --> 00:11:56,480
previously installed

288
00:11:56,480 --> 00:11:57,839
capability

289
00:11:57,839 --> 00:11:59,760
or abusive trusted communications such

290
00:11:59,760 --> 00:12:01,519
as the vpn

291
00:12:01,519 --> 00:12:03,440
and then we have the entertainment

292
00:12:03,440 --> 00:12:05,519
arrangement development and execution

293
00:12:05,519 --> 00:12:06,399
phase

294
00:12:06,399 --> 00:12:09,360
when in this phase documents a variety

295
00:12:09,360 --> 00:12:12,480
of angles that an adversary may have in

296
00:12:12,480 --> 00:12:14,079
this space

297
00:12:14,079 --> 00:12:16,560
is when the adversary acts

298
00:12:16,560 --> 00:12:21,040
so we can discover doom lateral movement

299
00:12:21,040 --> 00:12:22,880
everything we know in

300
00:12:22,880 --> 00:12:25,519
in common i.t

301
00:12:25,519 --> 00:12:27,600
attack

302
00:12:27,600 --> 00:12:30,000
so now our first

303
00:12:30,000 --> 00:12:32,880
victim will be

304
00:12:33,279 --> 00:12:34,880
an operator

305
00:12:34,880 --> 00:12:36,639
of the scada

306
00:12:36,639 --> 00:12:39,360
of the company macros powerplant and now

307
00:12:39,360 --> 00:12:42,079
we will send her a message

308
00:12:42,079 --> 00:12:43,839
uh through linkedin

309
00:12:43,839 --> 00:12:45,600
so we will

310
00:12:45,600 --> 00:12:47,839
put a link of our

311
00:12:47,839 --> 00:12:49,760
scada

312
00:12:49,760 --> 00:12:51,519
wire magazine

313
00:12:51,519 --> 00:12:54,720
and now we will try to exploit

314
00:12:54,720 --> 00:12:57,519
vulnerability and her browser

315
00:12:57,519 --> 00:13:01,279
so for this first we need to

316
00:13:01,760 --> 00:13:03,440
activate

317
00:13:03,440 --> 00:13:07,839
our exploit on the website

318
00:13:09,680 --> 00:13:12,800
and now we can send

319
00:13:14,880 --> 00:13:18,040
the message

320
00:13:32,880 --> 00:13:34,639
so we said i mentioned

321
00:13:34,639 --> 00:13:36,320
saying that i'm a journalist for a

322
00:13:36,320 --> 00:13:38,000
magazine and

323
00:13:38,000 --> 00:13:40,320
if she wants to participate in an

324
00:13:40,320 --> 00:13:41,839
interview and

325
00:13:41,839 --> 00:13:46,680
we add the link for the website

326
00:13:50,079 --> 00:13:52,639
so now we can see in

327
00:13:52,639 --> 00:13:55,519
the linkedin profile of the victim she

328
00:13:55,519 --> 00:13:57,440
received

329
00:13:57,440 --> 00:13:58,639
the message

330
00:13:58,639 --> 00:14:02,519
and she probably links

331
00:14:02,560 --> 00:14:03,839
click the link

332
00:14:03,839 --> 00:14:05,839
and she will have access

333
00:14:05,839 --> 00:14:07,440
to the

334
00:14:07,440 --> 00:14:09,199
website

335
00:14:09,199 --> 00:14:12,000
and see there is a normal

336
00:14:12,000 --> 00:14:13,920
magazine related to

337
00:14:13,920 --> 00:14:17,639
industrial technologies

338
00:14:18,160 --> 00:14:21,920
but in the background you will see

339
00:14:21,920 --> 00:14:22,800
we

340
00:14:22,800 --> 00:14:25,199
execute the exploit on the browser and

341
00:14:25,199 --> 00:14:28,560
we have immediately access

342
00:14:28,560 --> 00:14:31,680
to her machine so we can start to look

343
00:14:31,680 --> 00:14:33,440
for

344
00:14:33,440 --> 00:14:36,000
credentials

345
00:14:36,000 --> 00:14:37,199
and

346
00:14:37,199 --> 00:14:39,440
also we can

347
00:14:39,440 --> 00:14:41,680
look for interesting files

348
00:14:41,680 --> 00:14:42,839
like

349
00:14:42,839 --> 00:14:46,560
vpn or

350
00:14:46,880 --> 00:14:51,600
software like for password management

351
00:14:51,760 --> 00:14:54,320
like keypads for example

352
00:14:54,320 --> 00:14:57,920
and also we can start look for some

353
00:14:57,920 --> 00:14:59,440
files

354
00:14:59,440 --> 00:15:03,920
related to the related to the company

355
00:15:03,920 --> 00:15:05,440
and so for the

356
00:15:05,440 --> 00:15:08,079
second vector infrastructure we already

357
00:15:08,079 --> 00:15:10,560
find a remote execution so we will try

358
00:15:10,560 --> 00:15:12,240
to get some information about that

359
00:15:12,240 --> 00:15:14,639
device

360
00:15:16,800 --> 00:15:19,199
in this case we have the credentials of

361
00:15:19,199 --> 00:15:20,560
the device

362
00:15:20,560 --> 00:15:25,319
so we will now try to crack it

363
00:15:36,880 --> 00:15:38,560
so now we have the password of the

364
00:15:38,560 --> 00:15:41,560
device

365
00:15:44,240 --> 00:15:48,399
so now we can login in the device

366
00:15:52,800 --> 00:15:56,240
and we're now going to change

367
00:15:57,120 --> 00:16:00,839
the dns server

368
00:16:08,639 --> 00:16:12,000
so now we apply the change

369
00:16:14,639 --> 00:16:16,800
so now we can take a look on the victim

370
00:16:16,800 --> 00:16:19,279
machine

371
00:16:20,160 --> 00:16:23,279
and we can see

372
00:16:23,279 --> 00:16:25,600
the dns has changed

373
00:16:25,600 --> 00:16:29,680
so for example if it goes to

374
00:16:30,959 --> 00:16:33,959
gmail.com

375
00:16:39,839 --> 00:16:42,720
so we can see

376
00:16:43,199 --> 00:16:48,199
let's try to connect to gmail

377
00:16:53,199 --> 00:16:54,480
so

378
00:16:54,480 --> 00:16:55,519
any

379
00:16:55,519 --> 00:16:57,519
domain he wrote in

380
00:16:57,519 --> 00:17:01,600
the euro bar is re is redirected to our

381
00:17:01,600 --> 00:17:02,720
malicious

382
00:17:02,720 --> 00:17:05,720
site

383
00:17:07,599 --> 00:17:10,240
so now we can see we have almost the

384
00:17:10,240 --> 00:17:12,160
same information like

385
00:17:12,160 --> 00:17:14,400
credentials

386
00:17:14,400 --> 00:17:17,599
a lot of vpn

387
00:17:17,599 --> 00:17:20,399
config files

388
00:17:22,160 --> 00:17:24,400
and probably more information that we

389
00:17:24,400 --> 00:17:26,079
need for

390
00:17:26,079 --> 00:17:29,919
prepare the next step for the attack

391
00:17:29,919 --> 00:17:30,960
so as

392
00:17:30,960 --> 00:17:32,880
a part of command and control we are

393
00:17:32,880 --> 00:17:35,520
using the same application and this case

394
00:17:35,520 --> 00:17:37,440
is metasploit

395
00:17:37,440 --> 00:17:38,559
and as

396
00:17:38,559 --> 00:17:40,559
we showed previously we have a lot of

397
00:17:40,559 --> 00:17:43,200
information related to

398
00:17:43,200 --> 00:17:45,840
the victims in this case

399
00:17:45,840 --> 00:17:48,400
we have the windows credentials and we

400
00:17:48,400 --> 00:17:49,440
can see

401
00:17:49,440 --> 00:17:51,600
this person is working not only for

402
00:17:51,600 --> 00:17:54,400
macro selectors also for another

403
00:17:54,400 --> 00:17:56,080
power plant

404
00:17:56,080 --> 00:17:58,320
companies

405
00:17:58,320 --> 00:18:00,960
and we can get of course some password

406
00:18:00,960 --> 00:18:03,039
manager like uh keepass

407
00:18:03,039 --> 00:18:06,960
and some sensitive files like uh

408
00:18:06,960 --> 00:18:10,720
details of the infrastructure

409
00:18:10,720 --> 00:18:13,679
so if we take a screenshot of the

410
00:18:13,679 --> 00:18:15,360
big team we can see is a system

411
00:18:15,360 --> 00:18:18,000
administrator for an external company

412
00:18:18,000 --> 00:18:21,760
work for macros powerplant

413
00:18:21,919 --> 00:18:24,720
also we can

414
00:18:24,720 --> 00:18:27,600
use keyloggers for have the password for

415
00:18:27,600 --> 00:18:29,840
the key pass and we can see

416
00:18:29,840 --> 00:18:32,720
he have the system for

417
00:18:32,720 --> 00:18:34,320
almost a lot of

418
00:18:34,320 --> 00:18:35,520
sensitive

419
00:18:35,520 --> 00:18:38,320
infrastructure like the cm scada and the

420
00:18:38,320 --> 00:18:40,240
active directory

421
00:18:40,240 --> 00:18:42,320
so probably this will give us domain

422
00:18:42,320 --> 00:18:44,400
admin immediately without any other

423
00:18:44,400 --> 00:18:46,720
attack

424
00:18:46,720 --> 00:18:50,559
also sensitive files same for lisa

425
00:18:50,559 --> 00:18:53,840
lisa is a operator of this class so we

426
00:18:53,840 --> 00:18:55,360
are interested

427
00:18:55,360 --> 00:18:57,600
also in their

428
00:18:57,600 --> 00:18:59,200
password management

429
00:18:59,200 --> 00:19:02,160
database so we

430
00:19:02,160 --> 00:19:03,679
add a key lawyer

431
00:19:03,679 --> 00:19:05,440
in the attack

432
00:19:05,440 --> 00:19:08,640
so as a summary and we have access to

433
00:19:08,640 --> 00:19:10,480
two important

434
00:19:10,480 --> 00:19:13,200
computers and now we have remote access

435
00:19:13,200 --> 00:19:14,480
to the plan

436
00:19:14,480 --> 00:19:16,960
with the config files

437
00:19:16,960 --> 00:19:19,120
they have in their computer also we can

438
00:19:19,120 --> 00:19:21,679
pivot from their computers too we have

439
00:19:21,679 --> 00:19:23,679
credentials for almost all the

440
00:19:23,679 --> 00:19:26,240
infrastructure and the details of the

441
00:19:26,240 --> 00:19:29,039
infrastructure

442
00:19:29,919 --> 00:19:31,039
so next

443
00:19:31,039 --> 00:19:34,559
is the stage two and i give you

444
00:19:34,559 --> 00:19:36,640
um honest cover

445
00:19:36,640 --> 00:19:40,000
to explain this part

446
00:19:40,240 --> 00:19:43,280
thank you javier um continue with the ic

447
00:19:43,280 --> 00:19:46,400
a cyber kill chamber in its second stage

448
00:19:46,400 --> 00:19:50,640
more especially in the development phase

449
00:19:50,960 --> 00:19:53,039
in this phase the attacking group tries

450
00:19:53,039 --> 00:19:56,400
to create new offensive abilities using

451
00:19:56,400 --> 00:19:58,799
the information from the previous stage

452
00:19:58,799 --> 00:20:00,480
and this is possible because the

453
00:20:00,480 --> 00:20:02,559
attackers have discovered excel

454
00:20:02,559 --> 00:20:04,960
documents with a list of devices in this

455
00:20:04,960 --> 00:20:08,400
case we can see on snyder electric plc

456
00:20:08,400 --> 00:20:11,760
using the modbus protocol

457
00:20:11,760 --> 00:20:14,000
and first it's necessary to understand

458
00:20:14,000 --> 00:20:16,720
the modbus protocol luckily for us this

459
00:20:16,720 --> 00:20:19,280
protocol is really very simple

460
00:20:19,280 --> 00:20:22,159
we are going into

461
00:20:22,159 --> 00:20:24,000
too much details the first seven bytes

462
00:20:24,000 --> 00:20:25,360
of the packets

463
00:20:25,360 --> 00:20:28,080
in red correspond to the header fields

464
00:20:28,080 --> 00:20:30,799
continue with one byte result to the

465
00:20:30,799 --> 00:20:34,720
claria function this can be bt1

466
00:20:34,720 --> 00:20:36,919
to

467
00:20:36,919 --> 00:20:39,600
127 in hexadecimal

468
00:20:39,600 --> 00:20:42,640
finally we have the attack segment the

469
00:20:42,640 --> 00:20:45,200
content of this field will depend on the

470
00:20:45,200 --> 00:20:49,240
function code we use

471
00:20:50,320 --> 00:20:52,080
as you can see the request is very

472
00:20:52,080 --> 00:20:53,360
simple

473
00:20:53,360 --> 00:20:55,520
this one is a value request using the

474
00:20:55,520 --> 00:20:58,559
function called one or read coils

475
00:20:58,559 --> 00:21:01,200
and if a request is valid the response

476
00:21:01,200 --> 00:21:02,880
will keep the function a field

477
00:21:02,880 --> 00:21:06,480
corresponding to 8 byte with the same

478
00:21:06,480 --> 00:21:10,159
value as the original request

479
00:21:11,440 --> 00:21:12,720
but what happens

480
00:21:12,720 --> 00:21:14,960
when the request contains an error in

481
00:21:14,960 --> 00:21:17,200
this case the response will to will

482
00:21:17,200 --> 00:21:19,760
return to buys results

483
00:21:19,760 --> 00:21:20,480
for

484
00:21:20,480 --> 00:21:23,280
exception we have a session function

485
00:21:23,280 --> 00:21:25,200
code which is one byte

486
00:21:25,200 --> 00:21:27,919
and exception code

487
00:21:27,919 --> 00:21:29,679
the first the assertion function call is

488
00:21:29,679 --> 00:21:32,320
equal to the total sum of the value of

489
00:21:32,320 --> 00:21:34,320
the function used

490
00:21:34,320 --> 00:21:38,240
one in this case plus 80 in hexadecimal

491
00:21:38,240 --> 00:21:40,080
so for example if the function call in

492
00:21:40,080 --> 00:21:42,559
the response will be

493
00:21:42,559 --> 00:21:45,919
the value 81

494
00:21:45,919 --> 00:21:49,200
if you will if we use the function call

495
00:21:49,200 --> 00:21:50,159
one

496
00:21:50,159 --> 00:21:52,640
and if we use for example from zero on

497
00:21:52,640 --> 00:21:54,880
code two the response

498
00:21:54,880 --> 00:21:57,360
if the request contains an error will be

499
00:21:57,360 --> 00:21:58,400
82

500
00:21:58,400 --> 00:22:01,440
and we use function 3 and we in the

501
00:22:01,440 --> 00:22:03,440
request contain an error will be

502
00:22:03,440 --> 00:22:07,120
83 and so on

503
00:22:08,799 --> 00:22:11,200
and the second field the exception code

504
00:22:11,200 --> 00:22:14,159
is represented by a numerical value

505
00:22:14,159 --> 00:22:17,200
that will depend on the following flow

506
00:22:17,200 --> 00:22:19,679
so if a request can pass the first

507
00:22:19,679 --> 00:22:22,480
condition illegal function

508
00:22:22,480 --> 00:22:25,280
this means that the function is valid

509
00:22:25,280 --> 00:22:27,280
in other words if the exception call is

510
00:22:27,280 --> 00:22:30,080
different from one the function is valid

511
00:22:30,080 --> 00:22:32,880
so by saying the error messages it's

512
00:22:32,880 --> 00:22:35,760
possible to determine either existency

513
00:22:35,760 --> 00:22:38,320
or the existence of implemented function

514
00:22:38,320 --> 00:22:39,760
and this is very

515
00:22:39,760 --> 00:22:41,919
helpful to build various attacks

516
00:22:41,919 --> 00:22:44,400
it's also important to consider uh an

517
00:22:44,400 --> 00:22:46,000
enabled multiple functions with a

518
00:22:46,000 --> 00:22:48,480
possible attack

519
00:22:48,480 --> 00:22:51,120
so with this knowledge it is possible to

520
00:22:51,120 --> 00:22:53,120
build a tool that can lead the

521
00:22:53,120 --> 00:22:55,760
implemented function the toolsense valid

522
00:22:55,760 --> 00:22:57,919
modbus frames always trying to force

523
00:22:57,919 --> 00:22:59,840
error messages and lease all the

524
00:22:59,840 --> 00:23:01,360
possible functions

525
00:23:01,360 --> 00:23:03,280
or the attack better

526
00:23:03,280 --> 00:23:06,080
so to continue our simulation we or the

527
00:23:06,080 --> 00:23:09,520
attackers will focus in function 43

528
00:23:09,520 --> 00:23:12,320
which is a read device identification

529
00:23:12,320 --> 00:23:15,039
and also function and id

530
00:23:15,039 --> 00:23:17,840
umass which is on a schneider electric

531
00:23:17,840 --> 00:23:20,320
proprietary function differential was

532
00:23:20,320 --> 00:23:22,159
discovery

533
00:23:22,159 --> 00:23:24,799
with a new enumeration tool

534
00:23:24,799 --> 00:23:28,559
so what is a function for t3 in short it

535
00:23:28,559 --> 00:23:29,919
is a function

536
00:23:29,919 --> 00:23:32,159
that will provide device information so

537
00:23:32,159 --> 00:23:35,360
for example a vendor name product code

538
00:23:35,360 --> 00:23:38,400
revision number etc

539
00:23:38,400 --> 00:23:40,159
here are some first tests with

540
00:23:40,159 --> 00:23:44,000
description function 43 so we can see

541
00:23:44,000 --> 00:23:46,799
some information about the plc

542
00:23:46,799 --> 00:23:50,080
and the project

543
00:23:50,080 --> 00:23:52,720
uh the other interested function of a

544
00:23:52,720 --> 00:23:54,480
snyder electric device is the function

545
00:23:54,480 --> 00:23:56,240
called knighting

546
00:23:56,240 --> 00:23:58,640
among the many functionalities or

547
00:23:58,640 --> 00:24:01,279
functions available we are interested in

548
00:24:01,279 --> 00:24:03,760
the following three

549
00:24:03,760 --> 00:24:05,200
40

550
00:24:05,200 --> 00:24:07,120
41 and 20.

551
00:24:07,120 --> 00:24:10,159
we are star plc short pills and read

552
00:24:10,159 --> 00:24:12,880
memory block

553
00:24:12,880 --> 00:24:15,279
so for the final attack we are looking

554
00:24:15,279 --> 00:24:18,000
for a request that can easily generate a

555
00:24:18,000 --> 00:24:22,000
stop on the target device

556
00:24:22,080 --> 00:24:24,320
for which in our controlled environment

557
00:24:24,320 --> 00:24:27,360
request has been sent to our plc using

558
00:24:27,360 --> 00:24:30,840
only function 19 which are in

559
00:24:30,840 --> 00:24:32,640
hexadecimal a

560
00:24:32,640 --> 00:24:34,240
5a

561
00:24:34,240 --> 00:24:36,720
but with random data

562
00:24:36,720 --> 00:24:39,679
so finally it was possible to generate a

563
00:24:39,679 --> 00:24:42,000
denial of service condition by sending

564
00:24:42,000 --> 00:24:44,840
two null bytes as you can see

565
00:24:44,840 --> 00:24:47,840
here in the function

566
00:24:47,840 --> 00:24:48,960
create a

567
00:24:48,960 --> 00:24:52,000
memory block

568
00:24:52,799 --> 00:24:55,200
finally a tool that was developed for

569
00:24:55,200 --> 00:25:00,200
this attack which we call modbus killer

570
00:25:00,559 --> 00:25:04,000
so uh the next phase is validation

571
00:25:04,000 --> 00:25:06,720
in the validation phase uh the aim is to

572
00:25:06,720 --> 00:25:10,880
certify the new abilities or development

573
00:25:10,880 --> 00:25:12,480
in a controlled environment with a

574
00:25:12,480 --> 00:25:15,200
specific hardware

575
00:25:15,200 --> 00:25:17,200
all tests have been performed in a

576
00:25:17,200 --> 00:25:20,559
laboratory environment just as the one

577
00:25:20,559 --> 00:25:23,918
we show below

578
00:25:24,080 --> 00:25:27,279
so the following demo evidence denial of

579
00:25:27,279 --> 00:25:32,360
service with the modbus killer tool

580
00:25:42,080 --> 00:25:43,840
so here we are uh

581
00:25:43,840 --> 00:25:47,200
setting a value a

582
00:25:47,200 --> 00:25:49,679
one for the

583
00:25:49,679 --> 00:25:51,919
sl slide id

584
00:25:51,919 --> 00:25:53,120
one

585
00:25:53,120 --> 00:25:56,880
using the function called f5

586
00:25:56,880 --> 00:25:58,480
to start the

587
00:25:58,480 --> 00:25:59,600
motor

588
00:25:59,600 --> 00:26:01,840
and then we person some panoramic with

589
00:26:01,840 --> 00:26:04,559
the check argument with the modbus

590
00:26:04,559 --> 00:26:06,480
killer

591
00:26:06,480 --> 00:26:08,880
script this is performing a banner run

592
00:26:08,880 --> 00:26:11,679
using function 43 and then we are

593
00:26:11,679 --> 00:26:15,520
sending the exclude argument we will use

594
00:26:15,520 --> 00:26:17,360
a function umass

595
00:26:17,360 --> 00:26:20,400
or function call 90

596
00:26:20,400 --> 00:26:23,120
so we can see that the motor or the

597
00:26:23,120 --> 00:26:25,200
device is stopped

598
00:26:25,200 --> 00:26:29,360
when we send the the two null bytes

599
00:26:30,159 --> 00:26:32,559
so as you call observe the resulting

600
00:26:32,559 --> 00:26:35,039
denial of service or off all the plc

601
00:26:35,039 --> 00:26:37,279
functionalities and also disconnect it

602
00:26:37,279 --> 00:26:39,279
from the network forcing a physical

603
00:26:39,279 --> 00:26:41,840
restart

604
00:26:42,720 --> 00:26:46,080
and the final phase is called ics attack

605
00:26:46,080 --> 00:26:48,480
this stage is used to deploying and

606
00:26:48,480 --> 00:26:52,760
executing the attack

607
00:26:53,600 --> 00:26:56,080
so we have another video that simulates

608
00:26:56,080 --> 00:26:57,279
the final

609
00:26:57,279 --> 00:26:58,720
step

610
00:26:58,720 --> 00:27:03,440
in us in the simulate a macros

611
00:27:03,440 --> 00:27:07,799
plant electric plant

612
00:27:12,240 --> 00:27:16,080
so as you can see we send um the kill

613
00:27:16,080 --> 00:27:19,520
command and the device was

614
00:27:19,520 --> 00:27:22,399
unresponsive

615
00:27:27,200 --> 00:27:30,000
so this is a system to control the

616
00:27:30,000 --> 00:27:32,320
temperature of the weather

617
00:27:32,320 --> 00:27:35,200
and when the plc has stopped

618
00:27:35,200 --> 00:27:36,320
working

619
00:27:36,320 --> 00:27:38,480
the alarm will be

620
00:27:38,480 --> 00:27:41,440
reactivated

621
00:27:43,520 --> 00:27:48,200
and also the temperature will rise

622
00:27:54,880 --> 00:27:57,880
so

623
00:28:05,279 --> 00:28:08,320
uh so just in case these vulnerabilities

624
00:28:08,320 --> 00:28:10,960
we we found have already been reported

625
00:28:10,960 --> 00:28:13,440
to the manufacturers and have their

626
00:28:13,440 --> 00:28:17,799
respective security patch

627
00:28:17,840 --> 00:28:19,840
and here are some a recommendation

628
00:28:19,840 --> 00:28:23,279
overview that you can apply to about

629
00:28:23,279 --> 00:28:26,640
this type of attacks

630
00:28:27,360 --> 00:28:30,080
and finally thank you very much for your

631
00:28:30,080 --> 00:28:33,360
time and do not forget visit us in

632
00:28:33,360 --> 00:28:36,880
our ics research blog and our github

633
00:28:36,880 --> 00:28:38,640
where we probably is exploits and tools

634
00:28:38,640 --> 00:28:41,200
that can help you in your security

635
00:28:41,200 --> 00:28:45,320
audits thank you

