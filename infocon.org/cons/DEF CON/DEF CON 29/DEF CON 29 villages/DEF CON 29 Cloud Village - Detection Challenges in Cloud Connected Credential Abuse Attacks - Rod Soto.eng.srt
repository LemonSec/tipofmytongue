1
00:00:03,120 --> 00:00:04,799
hello and welcome

2
00:00:04,799 --> 00:00:06,640
my name is ron soto

3
00:00:06,640 --> 00:00:08,880
and i'm here today to speak to you

4
00:00:08,880 --> 00:00:11,519
about detection challenges

5
00:00:11,519 --> 00:00:13,759
in cloud-connected

6
00:00:13,759 --> 00:00:16,800
credential abuse attacks so let's get

7
00:00:16,800 --> 00:00:19,279
started

8
00:00:19,760 --> 00:00:21,439
my name is ron soto

9
00:00:21,439 --> 00:00:23,760
i've been in the industry for around

10
00:00:23,760 --> 00:00:26,080
10-15 years

11
00:00:26,080 --> 00:00:27,519
i used to work that

12
00:00:27,519 --> 00:00:29,439
for lexic

13
00:00:29,439 --> 00:00:31,119
currently working

14
00:00:31,119 --> 00:00:33,520
as a principal security research

15
00:00:33,520 --> 00:00:35,360
engineer splunk

16
00:00:35,360 --> 00:00:37,360
and like i said before i used to work at

17
00:00:37,360 --> 00:00:41,120
burlex then i worked at caspita

18
00:00:41,680 --> 00:00:44,719
a little bit of time and akamai

19
00:00:44,719 --> 00:00:47,520
i co-founded had miami

20
00:00:47,520 --> 00:00:50,480
in pacific hackers i also created my own

21
00:00:50,480 --> 00:00:52,160
ctfs

22
00:00:52,160 --> 00:00:54,079
and some of them you may have heard them

23
00:00:54,079 --> 00:00:56,960
one of them was command and control

24
00:00:56,960 --> 00:00:59,840
and the other one is

25
00:01:00,079 --> 00:01:03,680
um no quarter cdf

26
00:01:04,799 --> 00:01:05,920
so

27
00:01:05,920 --> 00:01:06,880
let's

28
00:01:06,880 --> 00:01:09,360
let's talk a little bit

29
00:01:09,360 --> 00:01:13,200
about this how the cloud permeates

30
00:01:13,200 --> 00:01:16,159
or permeates inside the perimeter

31
00:01:16,159 --> 00:01:18,159
i think it's

32
00:01:18,159 --> 00:01:21,280
pretty clear at this point in many

33
00:01:21,280 --> 00:01:23,040
environments

34
00:01:23,040 --> 00:01:25,600
even in small businesses

35
00:01:25,600 --> 00:01:26,640
where

36
00:01:26,640 --> 00:01:30,400
i myself i used to be a system engineer

37
00:01:30,400 --> 00:01:33,840
have my own little it company

38
00:01:33,840 --> 00:01:36,240
and i used to actually install microsoft

39
00:01:36,240 --> 00:01:38,840
smb server i remember setting up

40
00:01:38,840 --> 00:01:42,320
exchanges uh which

41
00:01:42,320 --> 00:01:44,560
sounds crazy but yeah i used to set up

42
00:01:44,560 --> 00:01:46,479
exchange servers

43
00:01:46,479 --> 00:01:47,520
in

44
00:01:47,520 --> 00:01:51,680
offices of 12 to 15 to 20 people

45
00:01:51,680 --> 00:01:53,759
or even crazier things such as a

46
00:01:53,759 --> 00:01:55,840
blackberry

47
00:01:55,840 --> 00:01:59,680
enterprise server as small businesses

48
00:01:59,680 --> 00:02:01,040
so because as

49
00:02:01,040 --> 00:02:03,680
basically that was the the way things

50
00:02:03,680 --> 00:02:05,920
were supposed to go and we didn't have

51
00:02:05,920 --> 00:02:09,199
the evolution of the cloud nowadays

52
00:02:09,199 --> 00:02:10,878
you really don't need a domain

53
00:02:10,878 --> 00:02:12,720
controller for example in small

54
00:02:12,720 --> 00:02:14,400
businesses

55
00:02:14,400 --> 00:02:17,040
and many large enterprises you you still

56
00:02:17,040 --> 00:02:18,000
do

57
00:02:18,000 --> 00:02:21,040
although we see things such as opta

58
00:02:21,040 --> 00:02:23,040
taking over a lot of the

59
00:02:23,040 --> 00:02:25,680
the the market

60
00:02:25,680 --> 00:02:28,720
but basically as you can see here

61
00:02:28,720 --> 00:02:31,760
uh even microsoft uh has

62
00:02:31,760 --> 00:02:34,239
made a huge move into the cloud so we

63
00:02:34,239 --> 00:02:35,200
have

64
00:02:35,200 --> 00:02:38,959
office 365 exchange online you no longer

65
00:02:38,959 --> 00:02:40,720
need to have

66
00:02:40,720 --> 00:02:41,840
a

67
00:02:41,840 --> 00:02:44,640
microsoft smp server

68
00:02:44,640 --> 00:02:48,400
or an exchange server

69
00:02:48,400 --> 00:02:49,440
or

70
00:02:49,440 --> 00:02:52,000
if you don't want microsoft

71
00:02:52,000 --> 00:02:54,560
you can have pretty much

72
00:02:54,560 --> 00:02:56,080
most of it

73
00:02:56,080 --> 00:02:59,519
uh by using google apps and then you can

74
00:02:59,519 --> 00:03:03,040
have email presentation messenger

75
00:03:03,040 --> 00:03:04,560
telephony

76
00:03:04,560 --> 00:03:08,480
video conference you name it so

77
00:03:08,480 --> 00:03:10,480
these are some of the examples of how

78
00:03:10,480 --> 00:03:11,920
the cloud

79
00:03:11,920 --> 00:03:15,200
now gets into

80
00:03:15,280 --> 00:03:17,599
inside the perimeter many of those all

81
00:03:17,599 --> 00:03:21,360
servers many of those uh infrastructure

82
00:03:21,360 --> 00:03:24,959
which uh some of them referred now as

83
00:03:24,959 --> 00:03:28,319
mutable uh infrastructure have gone away

84
00:03:28,319 --> 00:03:29,760
the uh

85
00:03:29,760 --> 00:03:31,519
infrastructure at the cloud level is

86
00:03:31,519 --> 00:03:33,360
referred as immutable

87
00:03:33,360 --> 00:03:36,080
where usually the

88
00:03:36,080 --> 00:03:37,440
providers

89
00:03:37,440 --> 00:03:39,680
basically apply

90
00:03:39,680 --> 00:03:41,200
the setup

91
00:03:41,200 --> 00:03:43,440
and

92
00:03:44,319 --> 00:03:47,920
updates and patches to it um you can

93
00:03:47,920 --> 00:03:50,640
also see uh in this slide that i

94
00:03:50,640 --> 00:03:52,959
actually placed a graph

95
00:03:52,959 --> 00:03:54,720
where uh

96
00:03:54,720 --> 00:03:56,239
other examples

97
00:03:56,239 --> 00:03:58,319
of things that we

98
00:03:58,319 --> 00:04:00,799
use almost on a daily basis such as

99
00:04:00,799 --> 00:04:02,799
code repositories for example like

100
00:04:02,799 --> 00:04:04,000
github

101
00:04:04,000 --> 00:04:05,519
or gitlab

102
00:04:05,519 --> 00:04:07,519
or we have things

103
00:04:07,519 --> 00:04:10,319
that we use for uh deployment of

104
00:04:10,319 --> 00:04:12,720
technology or development of software

105
00:04:12,720 --> 00:04:16,320
such as circleci

106
00:04:16,320 --> 00:04:18,000
or any other

107
00:04:18,000 --> 00:04:19,120
technology

108
00:04:19,120 --> 00:04:20,478
that is

109
00:04:20,478 --> 00:04:22,479
applied to the same

110
00:04:22,479 --> 00:04:24,960
end goal

111
00:04:25,520 --> 00:04:27,280
so here's an example

112
00:04:27,280 --> 00:04:29,360
of

113
00:04:29,360 --> 00:04:31,120
basically

114
00:04:31,120 --> 00:04:32,800
how

115
00:04:32,800 --> 00:04:34,639
the cloud

116
00:04:34,639 --> 00:04:36,160
in

117
00:04:36,160 --> 00:04:38,000
the perimeter

118
00:04:38,000 --> 00:04:39,600
can basically

119
00:04:39,600 --> 00:04:42,800
merge together we're going to talk about

120
00:04:42,800 --> 00:04:44,160
the

121
00:04:44,160 --> 00:04:47,120
what we call a converge parameter

122
00:04:47,120 --> 00:04:49,440
and in this case we're looking at two

123
00:04:49,440 --> 00:04:51,680
couple of examples in this example we're

124
00:04:51,680 --> 00:04:53,120
looking at

125
00:04:53,120 --> 00:04:55,600
amazon transit gateway

126
00:04:55,600 --> 00:04:59,759
or a shirt being it as you can see here

127
00:04:59,759 --> 00:05:02,080
we basically are

128
00:05:02,080 --> 00:05:05,360
seeing environments where

129
00:05:05,360 --> 00:05:07,520
this type of service

130
00:05:07,520 --> 00:05:08,840
basically

131
00:05:08,840 --> 00:05:10,400
um

132
00:05:10,400 --> 00:05:11,680
allows

133
00:05:11,680 --> 00:05:14,000
the cloud real estate

134
00:05:14,000 --> 00:05:16,479
to be part of your perimeter

135
00:05:16,479 --> 00:05:18,720
and for all intents and purposes for

136
00:05:18,720 --> 00:05:20,560
your users this is

137
00:05:20,560 --> 00:05:23,919
invisible they may be placing codes

138
00:05:23,919 --> 00:05:26,960
saving code moving files

139
00:05:26,960 --> 00:05:29,360
doing all kinds of operations

140
00:05:29,360 --> 00:05:33,360
logging into a server by ssh

141
00:05:33,520 --> 00:05:36,240
copying files across the one

142
00:05:36,240 --> 00:05:38,400
pushing updates and

143
00:05:38,400 --> 00:05:39,680
basically

144
00:05:39,680 --> 00:05:42,240
uh they won't be able to realize that

145
00:05:42,240 --> 00:05:44,479
some of those instances that they are

146
00:05:44,479 --> 00:05:45,840
interacting with

147
00:05:45,840 --> 00:05:50,240
are actually not part of

148
00:05:50,240 --> 00:05:53,919
your formal perimeter they are in the

149
00:05:53,919 --> 00:05:55,360
least uh

150
00:05:55,360 --> 00:05:57,840
property or lease or rented property if

151
00:05:57,840 --> 00:05:59,280
you want to call it

152
00:05:59,280 --> 00:06:01,280
from the cloud providers

153
00:06:01,280 --> 00:06:02,240
so

154
00:06:02,240 --> 00:06:05,120
in this case uh two clear examples of

155
00:06:05,120 --> 00:06:07,199
how this can happen

156
00:06:07,199 --> 00:06:09,600
this can also happen in an informal way

157
00:06:09,600 --> 00:06:11,759
which i will cover later on in this

158
00:06:11,759 --> 00:06:12,970
presentation

159
00:06:12,970 --> 00:06:14,160
[Music]

160
00:06:14,160 --> 00:06:15,840
for example

161
00:06:15,840 --> 00:06:17,840
i call this the

162
00:06:17,840 --> 00:06:19,840
the whole potato why because there's

163
00:06:19,840 --> 00:06:21,600
always seems to be a no

164
00:06:21,600 --> 00:06:24,479
not a clear idea it's very clear for the

165
00:06:24,479 --> 00:06:27,199
providers but for the customers

166
00:06:27,199 --> 00:06:29,759
uh it's almost like a hot potato uh is

167
00:06:29,759 --> 00:06:32,560
it mine is it not did i pass it around

168
00:06:32,560 --> 00:06:33,440
um

169
00:06:33,440 --> 00:06:35,680
the truth is that many of these

170
00:06:35,680 --> 00:06:37,840
providers do have

171
00:06:37,840 --> 00:06:41,199
a line they they draw into

172
00:06:41,199 --> 00:06:44,080
what your responsibility is as a

173
00:06:44,080 --> 00:06:46,240
customer that have

174
00:06:46,240 --> 00:06:47,759
um

175
00:06:47,759 --> 00:06:49,280
plenty of

176
00:06:49,280 --> 00:06:50,160
uh

177
00:06:50,160 --> 00:06:52,880
cloud real estate and what they provided

178
00:06:52,880 --> 00:06:54,960
you and depending on the service model

179
00:06:54,960 --> 00:06:58,319
we know some of the service models uh or

180
00:06:58,319 --> 00:07:00,560
the most popular surface models from the

181
00:07:00,560 --> 00:07:03,440
cloud providers are things such as

182
00:07:03,440 --> 00:07:05,120
software as a service

183
00:07:05,120 --> 00:07:07,599
platform as a service and infrastructure

184
00:07:07,599 --> 00:07:09,280
as a service

185
00:07:09,280 --> 00:07:11,840
in contrast with on-premise which is

186
00:07:11,840 --> 00:07:14,800
basically when you own buy

187
00:07:14,800 --> 00:07:17,360
everything you have it in a way

188
00:07:17,360 --> 00:07:18,240
where

189
00:07:18,240 --> 00:07:19,680
um

190
00:07:19,680 --> 00:07:21,520
you can do whatever you want but once

191
00:07:21,520 --> 00:07:23,759
you start mixing up these things you

192
00:07:23,759 --> 00:07:25,599
have to be alert

193
00:07:25,599 --> 00:07:29,039
and be conscious that some of this stuff

194
00:07:29,039 --> 00:07:30,560
you might just not leave it to the

195
00:07:30,560 --> 00:07:32,720
provider there seems to be this false

196
00:07:32,720 --> 00:07:33,759
notion

197
00:07:33,759 --> 00:07:35,520
that because for example we're talking

198
00:07:35,520 --> 00:07:38,000
about like i said before a mutable

199
00:07:38,000 --> 00:07:42,479
uh uh infrastructure where many times

200
00:07:42,479 --> 00:07:45,039
the cloud providers do

201
00:07:45,039 --> 00:07:47,440
actually a great job

202
00:07:47,440 --> 00:07:50,160
updating and hardening their resources

203
00:07:50,160 --> 00:07:53,440
that still does not guarantee

204
00:07:53,440 --> 00:07:55,280
the fact that this

205
00:07:55,280 --> 00:07:57,039
infrastructure can be vulnerable or can

206
00:07:57,039 --> 00:07:59,599
be attack i'll give you an example

207
00:07:59,599 --> 00:08:01,280
many years ago there was something

208
00:08:01,280 --> 00:08:02,720
called

209
00:08:02,720 --> 00:08:04,080
hard blade

210
00:08:04,080 --> 00:08:07,280
and i was working on a company that

211
00:08:07,280 --> 00:08:10,240
basically we're looking at

212
00:08:10,240 --> 00:08:13,520
30 percent of the internet at times and

213
00:08:13,520 --> 00:08:15,360
what happens is

214
00:08:15,360 --> 00:08:17,440
then the amount of servers even with

215
00:08:17,440 --> 00:08:19,440
environment i repeat

216
00:08:19,440 --> 00:08:22,240
even with embargo because we were

217
00:08:22,240 --> 00:08:24,479
within an organization where there were

218
00:08:24,479 --> 00:08:27,280
embargoes for disclosure of such

219
00:08:27,280 --> 00:08:29,680
vulnerabilities and this in particular

220
00:08:29,680 --> 00:08:32,240
was uh under embargo even with the town

221
00:08:32,240 --> 00:08:34,559
of embargo the amount of service we had

222
00:08:34,559 --> 00:08:36,479
to patch it was almost impossible to

223
00:08:36,479 --> 00:08:37,919
finish it

224
00:08:37,919 --> 00:08:40,000
in time

225
00:08:40,000 --> 00:08:42,399
and the reason why i'm saying this is

226
00:08:42,399 --> 00:08:43,919
because these things happen and will

227
00:08:43,919 --> 00:08:46,320
continue to happen so when you have

228
00:08:46,320 --> 00:08:48,720
a

229
00:08:49,200 --> 00:08:51,279
number of different technologies you may

230
00:08:51,279 --> 00:08:52,240
have

231
00:08:52,240 --> 00:08:54,560
containers that run alpine for example

232
00:08:54,560 --> 00:08:56,640
you may have servers around ubuntu you

233
00:08:56,640 --> 00:08:57,760
may have

234
00:08:57,760 --> 00:08:58,720
a

235
00:08:58,720 --> 00:09:01,279
windows servers out there as well

236
00:09:01,279 --> 00:09:03,600
which you can set up at amazon or on

237
00:09:03,600 --> 00:09:05,120
azure

238
00:09:05,120 --> 00:09:06,320
definitely

239
00:09:06,320 --> 00:09:11,200
it adds to to the mix it adds to the

240
00:09:11,200 --> 00:09:12,880
the attack surface

241
00:09:12,880 --> 00:09:16,480
uh considerations and in scenarios like

242
00:09:16,480 --> 00:09:18,480
this um

243
00:09:18,480 --> 00:09:22,640
even as these things are mutable even as

244
00:09:22,640 --> 00:09:24,399
the cloud providers do their best to

245
00:09:24,399 --> 00:09:26,160
protect and harden them

246
00:09:26,160 --> 00:09:27,760
you're still responsible for it that

247
00:09:27,760 --> 00:09:30,399
your data is yours applications are

248
00:09:30,399 --> 00:09:32,959
running in there that may be attacked as

249
00:09:32,959 --> 00:09:35,360
well because there's there they became

250
00:09:35,360 --> 00:09:36,399
vulnerable

251
00:09:36,399 --> 00:09:38,880
uh because of the disclosure or even in

252
00:09:38,880 --> 00:09:42,560
zero day these are your responsibilities

253
00:09:42,560 --> 00:09:45,040
uh and these are uh uh

254
00:09:45,040 --> 00:09:46,160
some of the

255
00:09:46,160 --> 00:09:47,440
considerations that we're gonna see

256
00:09:47,440 --> 00:09:49,920
today as i uh walk you through some of

257
00:09:49,920 --> 00:09:51,440
the attacks

258
00:09:51,440 --> 00:09:53,839
that i was able to research

259
00:09:53,839 --> 00:09:58,399
during this year and how to address them

260
00:09:58,640 --> 00:10:01,760
so coming back to this right

261
00:10:01,760 --> 00:10:04,800
we are talking about a

262
00:10:04,800 --> 00:10:06,800
converged perimeter converge perimeter

263
00:10:06,800 --> 00:10:07,760
is

264
00:10:07,760 --> 00:10:08,880
basically

265
00:10:08,880 --> 00:10:11,360
the cloud real estate that you're using

266
00:10:11,360 --> 00:10:13,440
leasing or whatever form or commercial

267
00:10:13,440 --> 00:10:15,519
use

268
00:10:15,519 --> 00:10:17,200
that you're you're doing or you're

269
00:10:17,200 --> 00:10:20,079
giving it plus your perimeter perimeter

270
00:10:20,079 --> 00:10:22,720
technically ends either with

271
00:10:22,720 --> 00:10:24,560
the border

272
00:10:24,560 --> 00:10:25,920
or your when

273
00:10:25,920 --> 00:10:29,839
or your internet gateway or routers

274
00:10:29,839 --> 00:10:32,160
and then once you have things such as

275
00:10:32,160 --> 00:10:34,640
the examples i just gave you then you

276
00:10:34,640 --> 00:10:37,200
have a converge parameter you basically

277
00:10:37,200 --> 00:10:40,240
if we if we're looking back at

278
00:10:40,240 --> 00:10:42,560
this figure where you have

279
00:10:42,560 --> 00:10:45,360
uh real estate from a provider plus your

280
00:10:45,360 --> 00:10:46,399
perimeter

281
00:10:46,399 --> 00:10:49,279
and your users are

282
00:10:49,279 --> 00:10:51,920
formally or even informally

283
00:10:51,920 --> 00:10:54,640
accessing cloud resources then what this

284
00:10:54,640 --> 00:10:57,760
means is basically that this is part of

285
00:10:57,760 --> 00:10:59,200
your perimeter it's a converged

286
00:10:59,200 --> 00:11:01,839
perimeter even though you are leasing

287
00:11:01,839 --> 00:11:02,640
or

288
00:11:02,640 --> 00:11:04,480
renting

289
00:11:04,480 --> 00:11:07,440
cloud real estate

290
00:11:09,040 --> 00:11:11,120
so

291
00:11:11,120 --> 00:11:13,279
the reason why i named it like this is

292
00:11:13,279 --> 00:11:15,360
because we

293
00:11:15,360 --> 00:11:17,839
are going to look at certain type of

294
00:11:17,839 --> 00:11:19,279
attacks

295
00:11:19,279 --> 00:11:21,680
which is basically an abuse

296
00:11:21,680 --> 00:11:22,959
of

297
00:11:22,959 --> 00:11:25,279
reuse credentials which is how microsoft

298
00:11:25,279 --> 00:11:28,560
has looked at it and the reason why this

299
00:11:28,560 --> 00:11:30,160
happens

300
00:11:30,160 --> 00:11:31,839
uh and and

301
00:11:31,839 --> 00:11:32,800
hence

302
00:11:32,800 --> 00:11:35,200
the title of this slide is because

303
00:11:35,200 --> 00:11:37,839
basically when you have

304
00:11:37,839 --> 00:11:40,079
as i am bringing you up

305
00:11:40,079 --> 00:11:43,760
in my past lines disparate technologies

306
00:11:43,760 --> 00:11:45,680
right all kinds of operating system

307
00:11:45,680 --> 00:11:48,560
versions all kinds of applications

308
00:11:48,560 --> 00:11:50,399
you need passage

309
00:11:50,399 --> 00:11:51,600
through this

310
00:11:51,600 --> 00:11:53,120
uh entities

311
00:11:53,120 --> 00:11:57,079
for many reasons functionality

312
00:11:57,600 --> 00:11:59,200
continuous delivery continuous

313
00:11:59,200 --> 00:12:00,720
integration

314
00:12:00,720 --> 00:12:03,279
deployment of technology

315
00:12:03,279 --> 00:12:06,000
you need mechanisms or

316
00:12:06,000 --> 00:12:07,279
in this case

317
00:12:07,279 --> 00:12:10,320
tokens or credentials or secrets that

318
00:12:10,320 --> 00:12:12,279
allow you to establish

319
00:12:12,279 --> 00:12:13,920
authentication

320
00:12:13,920 --> 00:12:15,519
authorization

321
00:12:15,519 --> 00:12:18,560
um and some sort of a trust

322
00:12:18,560 --> 00:12:21,519
in in this infrastructures

323
00:12:21,519 --> 00:12:24,079
that are now more complicated because

324
00:12:24,079 --> 00:12:25,600
you have a converged perimeter and you

325
00:12:25,600 --> 00:12:27,040
have to interact with all kinds of

326
00:12:27,040 --> 00:12:29,680
desperate technologies so

327
00:12:29,680 --> 00:12:30,639
yeah

328
00:12:30,639 --> 00:12:34,240
it is a feature these secrets these

329
00:12:34,240 --> 00:12:37,600
tokens or certificates for example

330
00:12:37,600 --> 00:12:39,360
you may have

331
00:12:39,360 --> 00:12:40,959
federation services which we're going to

332
00:12:40,959 --> 00:12:42,240
look at

333
00:12:42,240 --> 00:12:43,360
later on

334
00:12:43,360 --> 00:12:46,480
you can use also certificates for

335
00:12:46,480 --> 00:12:48,720
for

336
00:12:48,800 --> 00:12:50,399
authentication

337
00:12:50,399 --> 00:12:52,480
are things that

338
00:12:52,480 --> 00:12:56,000
are used to facilitate the operation in

339
00:12:56,000 --> 00:12:59,200
passage many times of

340
00:12:59,200 --> 00:13:01,519
data many times of code

341
00:13:01,519 --> 00:13:04,079
many times of

342
00:13:04,079 --> 00:13:07,680
deployment of technology so uh here's

343
00:13:07,680 --> 00:13:10,399
where we're focusing at this point

344
00:13:10,399 --> 00:13:12,639
because obviously

345
00:13:12,639 --> 00:13:15,680
uh these are the the key elements that

346
00:13:15,680 --> 00:13:17,519
we're gonna be looking at

347
00:13:17,519 --> 00:13:18,399
because

348
00:13:18,399 --> 00:13:21,440
by obtaining this type of secrets token

349
00:13:21,440 --> 00:13:23,200
certificates

350
00:13:23,200 --> 00:13:26,320
attackers can do a lot

351
00:13:26,880 --> 00:13:28,240
so

352
00:13:28,240 --> 00:13:30,240
coming back from

353
00:13:30,240 --> 00:13:32,399
what i just said

354
00:13:32,399 --> 00:13:34,959
when you are in a federated environment

355
00:13:34,959 --> 00:13:36,320
and you use

356
00:13:36,320 --> 00:13:37,839
this type of

357
00:13:37,839 --> 00:13:40,240
technologies obviously as you can see

358
00:13:40,240 --> 00:13:43,040
here is a graph where basically we are

359
00:13:43,040 --> 00:13:45,120
looking at this part of technologies but

360
00:13:45,120 --> 00:13:47,440
this disparate technologies can indeed

361
00:13:47,440 --> 00:13:49,120
communicate

362
00:13:49,120 --> 00:13:51,040
by using

363
00:13:51,040 --> 00:13:52,959
let's say you could use a federation for

364
00:13:52,959 --> 00:13:54,880
example where you use either oauth

365
00:13:54,880 --> 00:13:58,399
tokens or you can use saml

366
00:13:58,399 --> 00:14:01,120
which is a

367
00:14:01,120 --> 00:14:02,399
a mechanism

368
00:14:02,399 --> 00:14:04,079
of basically

369
00:14:04,079 --> 00:14:07,199
uh authenticating between entities

370
00:14:07,199 --> 00:14:10,240
and what this shows here is that this is

371
00:14:10,240 --> 00:14:12,560
the realities of what we're

372
00:14:12,560 --> 00:14:15,440
facing today when we're looking at the

373
00:14:15,440 --> 00:14:18,800
interaction of cloud technologies

374
00:14:18,800 --> 00:14:22,399
and all kinds of

375
00:14:24,240 --> 00:14:27,760
operating systems mobile systems

376
00:14:27,760 --> 00:14:30,240
remote offices you name it you need

377
00:14:30,240 --> 00:14:31,760
something that will allow the

378
00:14:31,760 --> 00:14:35,120
interaction operation and passage

379
00:14:35,120 --> 00:14:36,639
and most of all

380
00:14:36,639 --> 00:14:38,240
you need

381
00:14:38,240 --> 00:14:40,160
the users at the end of the day the

382
00:14:40,160 --> 00:14:41,519
operators

383
00:14:41,519 --> 00:14:42,639
to

384
00:14:42,639 --> 00:14:44,800
use efficiently technology

385
00:14:44,800 --> 00:14:46,480
if we were to put

386
00:14:46,480 --> 00:14:50,000
or force for example

387
00:14:51,199 --> 00:14:53,920
multi-factor authentication for example

388
00:14:53,920 --> 00:14:56,480
between many of these internal systems

389
00:14:56,480 --> 00:14:59,760
an external assistance every time this

390
00:14:59,760 --> 00:15:01,519
basically will become

391
00:15:01,519 --> 00:15:03,600
suboptimal and and

392
00:15:03,600 --> 00:15:06,160
and basically all the benefits

393
00:15:06,160 --> 00:15:09,199
that we use we we take from things such

394
00:15:09,199 --> 00:15:11,760
as continuous delivery continuous

395
00:15:11,760 --> 00:15:13,519
integration or even deployment of

396
00:15:13,519 --> 00:15:16,160
technology that that basically knows it

397
00:15:16,160 --> 00:15:17,600
that basically

398
00:15:17,600 --> 00:15:20,320
uh was slower to a point where

399
00:15:20,320 --> 00:15:21,920
you had to consider is this even worth

400
00:15:21,920 --> 00:15:24,079
it

401
00:15:24,800 --> 00:15:27,920
so let's look at some key points of

402
00:15:27,920 --> 00:15:29,920
federated environments since we're going

403
00:15:29,920 --> 00:15:32,079
to be talking about abuse

404
00:15:32,079 --> 00:15:34,399
of uh cloud-connected federated

405
00:15:34,399 --> 00:15:36,959
environments uh things

406
00:15:36,959 --> 00:15:39,440
that we need to look at are for example

407
00:15:39,440 --> 00:15:41,519
uh formal connections

408
00:15:41,519 --> 00:15:43,199
uh of perimeter

409
00:15:43,199 --> 00:15:45,360
and cloud real estate resources what i

410
00:15:45,360 --> 00:15:47,839
call the converge perimeter

411
00:15:47,839 --> 00:15:50,639
uh they help this this this the reason

412
00:15:50,639 --> 00:15:51,360
and

413
00:15:51,360 --> 00:15:52,839
and

414
00:15:52,839 --> 00:15:57,440
uh to bring it up uh in a way uh

415
00:15:57,440 --> 00:15:59,440
what why is it that we're looking at

416
00:15:59,440 --> 00:16:01,199
federal environments and why are they

417
00:16:01,199 --> 00:16:03,839
important well they they they allow the

418
00:16:03,839 --> 00:16:06,399
increase of cloud utilization

419
00:16:06,399 --> 00:16:10,000
so as we said before move on move on uh

420
00:16:10,000 --> 00:16:13,120
on-premise resources to the cloud

421
00:16:13,120 --> 00:16:16,720
uh the increased uh this uh utilization

422
00:16:16,720 --> 00:16:19,680
also provides the ability to increase

423
00:16:19,680 --> 00:16:22,959
uh the resource availability or even

424
00:16:22,959 --> 00:16:25,040
geographical reach we're talking about

425
00:16:25,040 --> 00:16:27,839
what they call silicon valley

426
00:16:27,839 --> 00:16:30,720
elastic technologies you can expand or

427
00:16:30,720 --> 00:16:33,040
shrink as you need it

428
00:16:33,040 --> 00:16:35,759
you had to have a local data center or

429
00:16:35,759 --> 00:16:38,480
you can have the the minimum you can

430
00:16:38,480 --> 00:16:40,240
have inside the perimeter but take

431
00:16:40,240 --> 00:16:42,639
advantage of this and this obviously

432
00:16:42,639 --> 00:16:44,880
it's not the same thing to use

433
00:16:44,880 --> 00:16:46,160
or

434
00:16:46,160 --> 00:16:49,040
to create environments that you may need

435
00:16:49,040 --> 00:16:51,839
at the moment and then pay for usage

436
00:16:51,839 --> 00:16:54,160
that is a wonderful thing that has

437
00:16:54,160 --> 00:16:56,720
helped a lot of companies

438
00:16:56,720 --> 00:16:58,480
and like i said before

439
00:16:58,480 --> 00:17:01,839
uh we're looking at standards that

440
00:17:01,839 --> 00:17:03,440
allows the passenger of data

441
00:17:03,440 --> 00:17:05,919
identification authentication that's why

442
00:17:05,919 --> 00:17:08,079
we're looking at things such as tokens

443
00:17:08,079 --> 00:17:10,160
certificates

444
00:17:10,160 --> 00:17:12,000
even passwords

445
00:17:12,000 --> 00:17:14,000
and api keys of course

446
00:17:14,000 --> 00:17:16,319
formal federations

447
00:17:16,319 --> 00:17:20,160
are usually the ones where there is a uh

448
00:17:20,160 --> 00:17:22,640
to put it in a certain way a formal

449
00:17:22,640 --> 00:17:25,520
technology in place that i identifies

450
00:17:25,520 --> 00:17:27,039
and authenticates

451
00:17:27,039 --> 00:17:29,039
entities between each other

452
00:17:29,039 --> 00:17:32,080
uh and that implements obviously a

453
00:17:32,080 --> 00:17:33,120
stricter

454
00:17:33,120 --> 00:17:37,440
uh control access of this resources

455
00:17:37,440 --> 00:17:39,760
and facilitates the use of it like a

456
00:17:39,760 --> 00:17:42,000
single sign-on for example

457
00:17:42,000 --> 00:17:45,919
uh at the at the at the uh the gui level

458
00:17:45,919 --> 00:17:48,240
and at the user level but you can also

459
00:17:48,240 --> 00:17:50,080
have what i call informal federations

460
00:17:50,080 --> 00:17:53,360
the formal federations are places where

461
00:17:53,360 --> 00:17:56,559
because of the usage of so many cloud

462
00:17:56,559 --> 00:17:57,919
technologies

463
00:17:57,919 --> 00:17:58,799
in

464
00:17:58,799 --> 00:18:01,919
the state of address

465
00:18:01,919 --> 00:18:04,000
credentials

466
00:18:04,000 --> 00:18:05,360
secrets

467
00:18:05,360 --> 00:18:06,880
certificates

468
00:18:06,880 --> 00:18:08,559
api keys

469
00:18:08,559 --> 00:18:09,520
that are

470
00:18:09,520 --> 00:18:10,799
inside

471
00:18:10,799 --> 00:18:13,840
your perimeter for example by developers

472
00:18:13,840 --> 00:18:16,480
even though you have a formal federation

473
00:18:16,480 --> 00:18:18,640
an attacker

474
00:18:18,640 --> 00:18:21,520
if such attacker access

475
00:18:21,520 --> 00:18:23,840
those resources they can people into the

476
00:18:23,840 --> 00:18:26,640
cloud and even in some cases depending

477
00:18:26,640 --> 00:18:28,799
on how your setup is they can even

478
00:18:28,799 --> 00:18:30,720
people from the cloud

479
00:18:30,720 --> 00:18:33,120
to your perimeter and that's

480
00:18:33,120 --> 00:18:35,520
what we're trying to focus here today

481
00:18:35,520 --> 00:18:37,679
that we had to understand

482
00:18:37,679 --> 00:18:38,960
the risks

483
00:18:38,960 --> 00:18:40,880
of the expansion

484
00:18:40,880 --> 00:18:43,520
the the

485
00:18:43,520 --> 00:18:47,840
the subject of the converged perimeter

486
00:18:48,000 --> 00:18:49,919
so the converge perimeter risks

487
00:18:49,919 --> 00:18:52,559
scenarios some of them

488
00:18:52,559 --> 00:18:54,160
obviously we have

489
00:18:54,160 --> 00:18:55,919
credential leakage in public

490
00:18:55,919 --> 00:18:57,679
repositories

491
00:18:57,679 --> 00:19:00,240
we have for example use of vulnerable

492
00:19:00,240 --> 00:19:02,400
components from cloud like for example

493
00:19:02,400 --> 00:19:04,960
open source libraries or containers

494
00:19:04,960 --> 00:19:07,280
usually download it

495
00:19:07,280 --> 00:19:08,400
embedded

496
00:19:08,400 --> 00:19:12,240
they go through uh either for deployment

497
00:19:12,240 --> 00:19:14,640
uh because they're hosting a database or

498
00:19:14,640 --> 00:19:16,000
they're hosting an application that's

499
00:19:16,000 --> 00:19:19,120
needed or in some cases in development

500
00:19:19,120 --> 00:19:21,280
where uh they have the perfect

501
00:19:21,280 --> 00:19:24,160
environment to host a specific

502
00:19:24,160 --> 00:19:25,760
application or

503
00:19:25,760 --> 00:19:28,559
a specific api that's needed they don't

504
00:19:28,559 --> 00:19:30,880
get scanned they get downloaded from

505
00:19:30,880 --> 00:19:32,799
public places and

506
00:19:32,799 --> 00:19:35,600
there's that is a big risk

507
00:19:35,600 --> 00:19:37,120
you can also

508
00:19:37,120 --> 00:19:39,280
take a look at this posture of cloud

509
00:19:39,280 --> 00:19:40,960
apps

510
00:19:40,960 --> 00:19:42,640
and infrastructure

511
00:19:42,640 --> 00:19:44,640
that may lead to

512
00:19:44,640 --> 00:19:46,640
internal access

513
00:19:46,640 --> 00:19:47,840
and

514
00:19:47,840 --> 00:19:50,880
i will give you an example of a campaign

515
00:19:50,880 --> 00:19:53,760
uh several companies actually rather

516
00:19:53,760 --> 00:19:56,480
that we have observed where where

517
00:19:56,480 --> 00:19:59,440
specifically this scenario

518
00:19:59,440 --> 00:20:02,080
interesting enough provided

519
00:20:02,080 --> 00:20:03,679
from cloud

520
00:20:03,679 --> 00:20:08,080
to internal access the reuse

521
00:20:08,080 --> 00:20:11,360
of federated credentials

522
00:20:11,840 --> 00:20:14,720
attacks such as the golden saml

523
00:20:14,720 --> 00:20:17,280
discovered by cyber arc

524
00:20:17,280 --> 00:20:20,720
or things such as uh off

525
00:20:20,720 --> 00:20:23,600
talking hijacks uh or past the cookie

526
00:20:23,600 --> 00:20:25,679
for example we'll see some examples of

527
00:20:25,679 --> 00:20:28,159
it with actual examples

528
00:20:28,159 --> 00:20:30,080
and then

529
00:20:30,080 --> 00:20:31,200
we can see

530
00:20:31,200 --> 00:20:32,840
in the case of

531
00:20:32,840 --> 00:20:36,720
federations people from cloud providers

532
00:20:36,720 --> 00:20:39,200
from one cloud provider to the other i

533
00:20:39,200 --> 00:20:42,400
actually seen that i researched it

534
00:20:42,400 --> 00:20:43,760
and then from there

535
00:20:43,760 --> 00:20:46,158
try to

536
00:20:46,320 --> 00:20:47,760
move into

537
00:20:47,760 --> 00:20:49,919
the converged perimeter the internal

538
00:20:49,919 --> 00:20:52,400
resources

539
00:20:54,320 --> 00:20:56,559
so here's some of the examples

540
00:20:56,559 --> 00:20:59,280
of uh

541
00:20:59,280 --> 00:21:01,600
cloud connected credential

542
00:21:01,600 --> 00:21:06,559
um here's a a an attack

543
00:21:06,720 --> 00:21:08,720
which is not that difficult

544
00:21:08,720 --> 00:21:11,200
what you see on the top left is mimi

545
00:21:11,200 --> 00:21:12,720
cats

546
00:21:12,720 --> 00:21:17,280
that was run against a windows host

547
00:21:17,280 --> 00:21:20,320
and then on the right you see

548
00:21:20,320 --> 00:21:21,919
for

549
00:21:21,919 --> 00:21:25,039
purposes of approval concert you see how

550
00:21:25,039 --> 00:21:26,480
i was

551
00:21:26,480 --> 00:21:30,080
not logged in i downloaded or rather

552
00:21:30,080 --> 00:21:32,080
discover or reveal

553
00:21:32,080 --> 00:21:34,880
mimikatz against a windows host that was

554
00:21:34,880 --> 00:21:36,799
able to get the

555
00:21:36,799 --> 00:21:38,480
specific cookie

556
00:21:38,480 --> 00:21:39,840
then

557
00:21:39,840 --> 00:21:42,840
via the the same browser

558
00:21:42,840 --> 00:21:45,120
functionality inserted a cookie and

559
00:21:45,120 --> 00:21:47,679
there i was i was able to basically

560
00:21:47,679 --> 00:21:49,760
login back

561
00:21:49,760 --> 00:21:51,200
this is not new

562
00:21:51,200 --> 00:21:53,440
but it still works

563
00:21:53,440 --> 00:21:55,520
i did it recently and this is something

564
00:21:55,520 --> 00:21:57,679
that can be done by somebody that

565
00:21:57,679 --> 00:22:01,520
has the possibility of

566
00:22:01,919 --> 00:22:03,120
access

567
00:22:03,120 --> 00:22:05,919
to in this case an employee so

568
00:22:05,919 --> 00:22:08,559
this is the first example

569
00:22:08,559 --> 00:22:11,200
here's a second example which was part

570
00:22:11,200 --> 00:22:14,159
of the research i did with uh

571
00:22:14,159 --> 00:22:16,640
jingle one from netscope

572
00:22:16,640 --> 00:22:19,120
and here uh jengkol actually did an

573
00:22:19,120 --> 00:22:22,159
amazing job uh by uh

574
00:22:22,159 --> 00:22:24,080
identifying uh

575
00:22:24,080 --> 00:22:24,960
things

576
00:22:24,960 --> 00:22:27,200
such as the uh off

577
00:22:27,200 --> 00:22:30,480
uh talking hijack from gcp basically as

578
00:22:30,480 --> 00:22:32,559
you can see in

579
00:22:32,559 --> 00:22:36,480
uh this slide you can extract the token

580
00:22:36,480 --> 00:22:38,480
and then once you strike the token

581
00:22:38,480 --> 00:22:40,640
this can be done basically by either

582
00:22:40,640 --> 00:22:41,679
access

583
00:22:41,679 --> 00:22:44,400
to an endpoint or

584
00:22:44,400 --> 00:22:45,360
a

585
00:22:45,360 --> 00:22:47,520
physical possession

586
00:22:47,520 --> 00:22:51,039
of a device that has obviously the sdk

587
00:22:51,039 --> 00:22:53,520
uh or the uh

588
00:22:53,520 --> 00:22:54,559
cli

589
00:22:54,559 --> 00:22:57,360
for gcp and then all you have to do is

590
00:22:57,360 --> 00:22:59,520
refresh the token

591
00:22:59,520 --> 00:23:01,840
and just so you know mfa does not

592
00:23:01,840 --> 00:23:03,679
protect against this because if the

593
00:23:03,679 --> 00:23:05,600
token has been authenticated already you

594
00:23:05,600 --> 00:23:07,120
can keep refreshing it for example

595
00:23:07,120 --> 00:23:10,159
that's another case scenario

596
00:23:10,159 --> 00:23:11,679
of

597
00:23:11,679 --> 00:23:13,120
oauth tokens

598
00:23:13,120 --> 00:23:15,600
hijack

599
00:23:16,480 --> 00:23:20,840
here's a uh one that had a lot of uh

600
00:23:20,840 --> 00:23:22,880
um uh

601
00:23:22,880 --> 00:23:26,640
i guess uh chatter uh doing part because

602
00:23:26,640 --> 00:23:28,080
of uh

603
00:23:28,080 --> 00:23:29,919
its use in

604
00:23:29,919 --> 00:23:31,360
in the

605
00:23:31,360 --> 00:23:35,120
apparent use in the campaign uh during

606
00:23:35,120 --> 00:23:38,400
solar winds uh according to sisa and uh

607
00:23:38,400 --> 00:23:39,840
here's the

608
00:23:39,840 --> 00:23:43,678
the i took this uh

609
00:23:44,080 --> 00:23:47,440
graph from this uh signia advisory uh

610
00:23:47,440 --> 00:23:50,799
cyber arc did also an amazing job and

611
00:23:50,799 --> 00:23:53,200
one of the researchers uh actually

612
00:23:53,200 --> 00:23:56,080
created a tool

613
00:23:56,080 --> 00:23:58,559
that uh basically stretched

614
00:23:58,559 --> 00:24:00,960
uh the saml assertion uh creates a

615
00:24:00,960 --> 00:24:01,919
forged

616
00:24:01,919 --> 00:24:03,360
saml assertion

617
00:24:03,360 --> 00:24:07,360
and then passes it so once you do that

618
00:24:07,360 --> 00:24:10,799
as you can see in this

619
00:24:11,039 --> 00:24:13,279
graph this is a federated environment

620
00:24:13,279 --> 00:24:15,200
and in this federated environment we

621
00:24:15,200 --> 00:24:18,159
have basically likely on the main

622
00:24:18,159 --> 00:24:21,039
controller and in this domain controller

623
00:24:21,039 --> 00:24:23,600
we have active directory federation

624
00:24:23,600 --> 00:24:25,679
services you set up a

625
00:24:25,679 --> 00:24:26,640
uh

626
00:24:26,640 --> 00:24:28,240
federation

627
00:24:28,240 --> 00:24:29,760
and then from there

628
00:24:29,760 --> 00:24:32,320
you communicate and make it easy for

629
00:24:32,320 --> 00:24:34,400
your users to basically use either

630
00:24:34,400 --> 00:24:36,320
office 365

631
00:24:36,320 --> 00:24:39,520
or exchange online

632
00:24:39,520 --> 00:24:44,000
and what happens is if you're able to

633
00:24:44,000 --> 00:24:46,559
basically

634
00:24:46,720 --> 00:24:48,320
forge

635
00:24:48,320 --> 00:24:50,240
and it's not easy not to say that it's

636
00:24:50,240 --> 00:24:52,799
not easy to forge it

637
00:24:52,799 --> 00:24:55,840
the providers have gotten very smart

638
00:24:55,840 --> 00:24:58,159
they have become

639
00:24:58,159 --> 00:25:00,640
especially very restricted on the

640
00:25:00,640 --> 00:25:02,960
attributes because that's where you can

641
00:25:02,960 --> 00:25:04,159
change things

642
00:25:04,159 --> 00:25:06,480
such as the duration or

643
00:25:06,480 --> 00:25:07,600
uh

644
00:25:07,600 --> 00:25:08,559
the

645
00:25:08,559 --> 00:25:09,760
the user

646
00:25:09,760 --> 00:25:11,520
uh so

647
00:25:11,520 --> 00:25:13,360
when you look at the seminal assertions

648
00:25:13,360 --> 00:25:16,000
there are things such as attributes and

649
00:25:16,000 --> 00:25:17,600
then these attributes are usually

650
00:25:17,600 --> 00:25:18,559
checked

651
00:25:18,559 --> 00:25:21,520
uh based on the identity provider

652
00:25:21,520 --> 00:25:22,640
basically

653
00:25:22,640 --> 00:25:23,760
uh

654
00:25:23,760 --> 00:25:25,919
to prove uh in

655
00:25:25,919 --> 00:25:27,440
a certain way

656
00:25:27,440 --> 00:25:28,799
before

657
00:25:28,799 --> 00:25:32,320
that they you're allowed access um

658
00:25:32,320 --> 00:25:34,880
and the reason why this attack

659
00:25:34,880 --> 00:25:37,760
was so successful is because if you

660
00:25:37,760 --> 00:25:40,000
this can still happen by the way if you

661
00:25:40,000 --> 00:25:41,440
are

662
00:25:41,440 --> 00:25:44,080
taking saml assertions uh

663
00:25:44,080 --> 00:25:45,679
not likely with this providers these

664
00:25:45,679 --> 00:25:47,679
providers actually make it very

665
00:25:47,679 --> 00:25:50,240
difficult for you to do a a

666
00:25:50,240 --> 00:25:52,880
sort of a golden seminal attack but if i

667
00:25:52,880 --> 00:25:56,080
know that there are other open source in

668
00:25:56,080 --> 00:25:57,760
other

669
00:25:57,760 --> 00:26:00,240
even internal cloud setups and you are

670
00:26:00,240 --> 00:26:01,520
not

671
00:26:01,520 --> 00:26:04,320
strict on the checking of

672
00:26:04,320 --> 00:26:06,320
saml assertion attributes

673
00:26:06,320 --> 00:26:08,000
this attack will work

674
00:26:08,000 --> 00:26:09,760
and it's very dangerous because it

675
00:26:09,760 --> 00:26:11,679
basically allows access

676
00:26:11,679 --> 00:26:15,520
uh to every single resource that um

677
00:26:15,520 --> 00:26:17,279
is dependent on

678
00:26:17,279 --> 00:26:21,600
the interaction with such assertion

679
00:26:22,159 --> 00:26:24,480
so here's another uh tool

680
00:26:24,480 --> 00:26:27,360
that obviously had to do

681
00:26:27,360 --> 00:26:30,000
although it's a tool that is ran

682
00:26:30,000 --> 00:26:31,840
against um

683
00:26:31,840 --> 00:26:33,679
a

684
00:26:33,679 --> 00:26:35,279
likely

685
00:26:35,279 --> 00:26:37,840
active directory environment however can

686
00:26:37,840 --> 00:26:41,120
provide a lot and make work

687
00:26:41,120 --> 00:26:43,440
in federated environments

688
00:26:43,440 --> 00:26:44,880
less

689
00:26:44,880 --> 00:26:47,440
coming back to the industry microsoft is

690
00:26:47,440 --> 00:26:51,440
still the leader microsoft is

691
00:26:51,760 --> 00:26:53,520
for the most part the

692
00:26:53,520 --> 00:26:55,919
enterprise operating system uh active

693
00:26:55,919 --> 00:26:58,880
directory and um

694
00:26:58,880 --> 00:27:02,000
there are tools such as adfs dump which

695
00:27:02,000 --> 00:27:04,880
are uh not only you have to compile them

696
00:27:04,880 --> 00:27:07,440
every time you run them which makes it

697
00:27:07,440 --> 00:27:11,039
incredibly difficult to detect

698
00:27:11,039 --> 00:27:12,559
but

699
00:27:12,559 --> 00:27:14,799
they are

700
00:27:14,799 --> 00:27:18,158
great at obtaining

701
00:27:18,240 --> 00:27:22,799
keys uh that will help you forge

702
00:27:22,799 --> 00:27:26,320
uh certificates or um

703
00:27:26,320 --> 00:27:29,279
even um

704
00:27:29,279 --> 00:27:32,000
use these keys to

705
00:27:32,000 --> 00:27:34,000
um

706
00:27:34,000 --> 00:27:37,120
forge sessions or make requests for

707
00:27:37,120 --> 00:27:38,000
further

708
00:27:38,000 --> 00:27:40,640
uh identification and recon

709
00:27:40,640 --> 00:27:42,000
of

710
00:27:42,000 --> 00:27:44,799
the active directory

711
00:27:44,799 --> 00:27:47,120
uh environment where you are so these

712
00:27:47,120 --> 00:27:48,399
are things that

713
00:27:48,399 --> 00:27:50,960
you had to consider because

714
00:27:50,960 --> 00:27:54,640
very hard to detect and we do have

715
00:27:54,640 --> 00:27:57,200
um a little bit of a

716
00:27:57,200 --> 00:28:01,120
way of sort of

717
00:28:01,600 --> 00:28:03,440
looking at this from a certain

718
00:28:03,440 --> 00:28:05,600
perspective however there's not a silver

719
00:28:05,600 --> 00:28:09,039
bullet against tools like this

720
00:28:10,159 --> 00:28:12,480
so here's a a

721
00:28:12,480 --> 00:28:14,159
like i told you before

722
00:28:14,159 --> 00:28:18,159
uh some of the actual um

723
00:28:18,159 --> 00:28:21,520
campaigns that we have seen uh whereas

724
00:28:21,520 --> 00:28:23,840
um

725
00:28:24,000 --> 00:28:27,600
you go uh basically full circle

726
00:28:27,600 --> 00:28:30,720
um and how you go full circle well okay

727
00:28:30,720 --> 00:28:34,080
so let's say you have exchange online

728
00:28:34,080 --> 00:28:35,919
or you have

729
00:28:35,919 --> 00:28:37,600
uh

730
00:28:37,600 --> 00:28:39,840
yeah exchange let's start with exchanges

731
00:28:39,840 --> 00:28:41,360
let's list let's say you have an

732
00:28:41,360 --> 00:28:43,679
exchange online uh you can

733
00:28:43,679 --> 00:28:46,640
many times we've seen

734
00:28:46,640 --> 00:28:48,080
environments where there is no

735
00:28:48,080 --> 00:28:50,000
multi-factor authenticator

736
00:28:50,000 --> 00:28:52,240
authentication

737
00:28:52,240 --> 00:28:53,200
so

738
00:28:53,200 --> 00:28:54,880
credentials

739
00:28:54,880 --> 00:28:56,640
actually remember we talk about

740
00:28:56,640 --> 00:29:00,799
federated active directory right passage

741
00:29:00,799 --> 00:29:02,320
authentication

742
00:29:02,320 --> 00:29:03,760
identification

743
00:29:03,760 --> 00:29:05,679
throughout many environments

744
00:29:05,679 --> 00:29:06,880
so

745
00:29:06,880 --> 00:29:09,039
we have for example a

746
00:29:09,039 --> 00:29:11,200
exchange online right

747
00:29:11,200 --> 00:29:13,840
we have tools that can we don't even

748
00:29:13,840 --> 00:29:16,240
need tools we can actually if this is

749
00:29:16,240 --> 00:29:17,840
for example was a

750
00:29:17,840 --> 00:29:20,080
misconfigured exchange server you can

751
00:29:20,080 --> 00:29:21,919
actually use powershell

752
00:29:21,919 --> 00:29:24,799
to to elicit a response that will give

753
00:29:24,799 --> 00:29:25,520
you

754
00:29:25,520 --> 00:29:28,080
sort of a directory information

755
00:29:28,080 --> 00:29:30,960
usernames in some cases even

756
00:29:30,960 --> 00:29:33,600
depends on how it was configured

757
00:29:33,600 --> 00:29:35,360
a

758
00:29:35,360 --> 00:29:37,200
way

759
00:29:37,200 --> 00:29:40,080
a bunch of information that may allow

760
00:29:40,080 --> 00:29:42,399
you to target users or you can just

761
00:29:42,399 --> 00:29:44,960
simply turn a board for brute forces and

762
00:29:44,960 --> 00:29:46,640
let's say you're able to brute force it

763
00:29:46,640 --> 00:29:48,159
and because this is obviously a

764
00:29:48,159 --> 00:29:51,600
federated active directory environment

765
00:29:51,600 --> 00:29:55,200
most likely the user repeats it's the

766
00:29:55,200 --> 00:29:57,919
same password for other services so all

767
00:29:57,919 --> 00:30:00,720
you need to do next is to find

768
00:30:00,720 --> 00:30:02,799
the vpn

769
00:30:02,799 --> 00:30:04,880
of this company or

770
00:30:04,880 --> 00:30:08,720
rdps or servers that might be

771
00:30:08,720 --> 00:30:11,120
uh exposed to the internet

772
00:30:11,120 --> 00:30:14,879
so you are uh

773
00:30:15,120 --> 00:30:16,640
technically able

774
00:30:16,640 --> 00:30:18,000
to log in

775
00:30:18,000 --> 00:30:20,159
because you have obtained

776
00:30:20,159 --> 00:30:22,559
the password right so you have obtained

777
00:30:22,559 --> 00:30:24,960
the credentials uh you were able to log

778
00:30:24,960 --> 00:30:27,279
in in exchange online you were able

779
00:30:27,279 --> 00:30:28,799
there are other tools

780
00:30:28,799 --> 00:30:30,720
that you can use or even do it by a

781
00:30:30,720 --> 00:30:33,679
powershell and obtain format information

782
00:30:33,679 --> 00:30:37,120
uh depending on what level of privileges

783
00:30:37,120 --> 00:30:39,840
you were able to obtain these user

784
00:30:39,840 --> 00:30:42,880
credentials and this user in particular

785
00:30:42,880 --> 00:30:44,799
and then from there

786
00:30:44,799 --> 00:30:48,320
you can attack login and attack

787
00:30:48,320 --> 00:30:51,200
extract for the credentials use things

788
00:30:51,200 --> 00:30:53,679
such as um

789
00:30:53,679 --> 00:30:56,320
imicates for example we looked at it in

790
00:30:56,320 --> 00:30:57,360
the

791
00:30:57,360 --> 00:30:58,880
past the cookie

792
00:30:58,880 --> 00:31:02,000
example or adfs dump which we also

793
00:31:02,000 --> 00:31:03,120
looked at

794
00:31:03,120 --> 00:31:05,200
and then forged credentials and then

795
00:31:05,200 --> 00:31:06,799
here's the full circle you go back to

796
00:31:06,799 --> 00:31:09,279
the cloud now here in

797
00:31:09,279 --> 00:31:11,440
gcb you're in

798
00:31:11,440 --> 00:31:15,679
aws you're in an acer

799
00:31:15,679 --> 00:31:18,320
and this is what i wanted to bring up to

800
00:31:18,320 --> 00:31:20,799
your attention today this is happening

801
00:31:20,799 --> 00:31:23,120
right now uh unfortunately

802
00:31:23,120 --> 00:31:26,880
many times the expansion of the cloud

803
00:31:26,880 --> 00:31:29,440
and the connection of such cloud

804
00:31:29,440 --> 00:31:31,440
uh that has brought a lot of benefits

805
00:31:31,440 --> 00:31:33,120
you know nothing better

806
00:31:33,120 --> 00:31:34,480
that you know

807
00:31:34,480 --> 00:31:36,799
the old times i want to my all wa i

808
00:31:36,799 --> 00:31:39,279
remember i used to put all the uas

809
00:31:39,279 --> 00:31:40,640
with

810
00:31:40,640 --> 00:31:42,320
with no multi-factor authentication or

811
00:31:42,320 --> 00:31:45,039
even vpn it was it was seen as how cool

812
00:31:45,039 --> 00:31:46,880
we can access it and check our email we

813
00:31:46,880 --> 00:31:49,279
don't have to go into the office right

814
00:31:49,279 --> 00:31:51,519
that was that was actually the the

815
00:31:51,519 --> 00:31:53,360
original purpose of this thing so well

816
00:31:53,360 --> 00:31:54,720
there they

817
00:31:54,720 --> 00:31:56,720
times have changed and these things can

818
00:31:56,720 --> 00:31:58,480
no longer be exposed to the internet

819
00:31:58,480 --> 00:32:01,360
without some sort of protections

820
00:32:01,360 --> 00:32:02,720
or

821
00:32:02,720 --> 00:32:05,120
we've seen actually cases

822
00:32:05,120 --> 00:32:06,799
where

823
00:32:06,799 --> 00:32:08,799
hardcore keys

824
00:32:08,799 --> 00:32:10,240
api keys

825
00:32:10,240 --> 00:32:12,840
passwords in

826
00:32:12,840 --> 00:32:18,080
um a code uh had led to uh

827
00:32:18,080 --> 00:32:20,640
breaking through uh either vbn

828
00:32:20,640 --> 00:32:22,480
uh this happened this just happened by

829
00:32:22,480 --> 00:32:23,600
the way this happens at colonial

830
00:32:23,600 --> 00:32:25,600
pipeline they broke in via vpn they

831
00:32:25,600 --> 00:32:28,080
didn't have multi-factor authentication

832
00:32:28,080 --> 00:32:31,039
or you can even exploit the vpn uh like

833
00:32:31,039 --> 00:32:33,360
it has happened sometimes

834
00:32:33,360 --> 00:32:34,559
and

835
00:32:34,559 --> 00:32:38,240
there are and i can tell you this

836
00:32:38,399 --> 00:32:40,960
because i see it and i've seen it there

837
00:32:40,960 --> 00:32:43,760
are tons of rdp servers that don't have

838
00:32:43,760 --> 00:32:46,320
multi-factor authentication and many of

839
00:32:46,320 --> 00:32:47,039
them

840
00:32:47,039 --> 00:32:48,880
are federated

841
00:32:48,880 --> 00:32:50,799
and with that then obviously you just

842
00:32:50,799 --> 00:32:53,360
have to execute your tools the best to

843
00:32:53,360 --> 00:32:54,960
your ability

844
00:32:54,960 --> 00:32:57,679
and then if you wanted to be in the

845
00:32:57,679 --> 00:32:59,360
perimeter

846
00:32:59,360 --> 00:33:02,320
either because you access by a vpn

847
00:33:02,320 --> 00:33:06,799
or by rdp then you can expand further

848
00:33:06,799 --> 00:33:09,740
into whatever real estate

849
00:33:09,740 --> 00:33:10,799
[Music]

850
00:33:10,799 --> 00:33:12,480
cloud properties

851
00:33:12,480 --> 00:33:16,000
this vulnerable environments have

852
00:33:16,000 --> 00:33:18,720
which could be in any of the

853
00:33:18,720 --> 00:33:20,480
main providers

854
00:33:20,480 --> 00:33:22,159
that we all know

855
00:33:22,159 --> 00:33:24,399
and were aware of so as you can see it's

856
00:33:24,399 --> 00:33:25,919
almost like a circle you can go full

857
00:33:25,919 --> 00:33:29,279
circle um and now um

858
00:33:29,279 --> 00:33:32,080
let's say i was able to get in into

859
00:33:32,080 --> 00:33:34,240
or even break and let's look at the

860
00:33:34,240 --> 00:33:36,399
other side let's say i was able to break

861
00:33:36,399 --> 00:33:39,120
into a certain a logging server that is

862
00:33:39,120 --> 00:33:42,799
part of a connected formally connected

863
00:33:42,799 --> 00:33:44,000
uh

864
00:33:44,000 --> 00:33:45,679
environment by one of those services

865
00:33:45,679 --> 00:33:47,440
that we just talked about

866
00:33:47,440 --> 00:33:49,519
you will be able to basically

867
00:33:49,519 --> 00:33:52,640
access service or or even

868
00:33:52,640 --> 00:33:53,679
endpoints

869
00:33:53,679 --> 00:33:56,240
that will be reachable

870
00:33:56,240 --> 00:33:59,360
because of this extended

871
00:33:59,360 --> 00:34:00,480
network

872
00:34:00,480 --> 00:34:02,080
and converge perimeter

873
00:34:02,080 --> 00:34:03,360
so

874
00:34:03,360 --> 00:34:05,200
this is basically

875
00:34:05,200 --> 00:34:08,639
something that complicates

876
00:34:08,879 --> 00:34:11,760
the current situation that we have and

877
00:34:11,760 --> 00:34:13,839
sometimes it gets even more complicated

878
00:34:13,839 --> 00:34:15,839
with uh

879
00:34:15,839 --> 00:34:18,560
where lines are not clear of ownership

880
00:34:18,560 --> 00:34:20,800
between the providers

881
00:34:20,800 --> 00:34:23,520
and the clients and now

882
00:34:23,520 --> 00:34:25,679
we're seeing an increase in this type of

883
00:34:25,679 --> 00:34:29,119
attacks that obviously require the use

884
00:34:29,119 --> 00:34:31,119
of a

885
00:34:31,119 --> 00:34:32,719
feather edit

886
00:34:32,719 --> 00:34:34,560
cloud-connected environments which which

887
00:34:34,560 --> 00:34:36,879
i would say are the the perfect

888
00:34:36,879 --> 00:34:41,118
environment to do these types of attacks

889
00:34:41,440 --> 00:34:42,639
all right

890
00:34:42,639 --> 00:34:44,560
so with that in mind

891
00:34:44,560 --> 00:34:47,359
how do we approach these attacks

892
00:34:47,359 --> 00:34:49,760
is there anything we can do

893
00:34:49,760 --> 00:34:51,440
yes we can do

894
00:34:51,440 --> 00:34:54,800
uh we can do a lot we can approach

895
00:34:54,800 --> 00:34:56,480
this attacks

896
00:34:56,480 --> 00:34:58,560
and this is something that has

897
00:34:58,560 --> 00:35:01,119
hopefully has started to happen

898
00:35:01,119 --> 00:35:04,160
in many enterprises but because bringing

899
00:35:04,160 --> 00:35:06,560
back what i said initially but because

900
00:35:06,560 --> 00:35:09,520
there's this false notion that somehow

901
00:35:09,520 --> 00:35:12,400
your provider is going to protect you

902
00:35:12,400 --> 00:35:15,040
or you don't have to worry about it

903
00:35:15,040 --> 00:35:18,079
it was not very clear and it didn't help

904
00:35:18,079 --> 00:35:19,760
to be honest

905
00:35:19,760 --> 00:35:21,599
and this was one of the things that i

906
00:35:21,599 --> 00:35:24,640
realized as i was doing my research

907
00:35:24,640 --> 00:35:26,800
the cloud providers they want you to

908
00:35:26,800 --> 00:35:30,320
stay with them as far as analytics and

909
00:35:30,320 --> 00:35:33,280
as far as uh um

910
00:35:33,280 --> 00:35:36,480
uh even obtaining locks from them

911
00:35:36,480 --> 00:35:39,280
is incredibly difficult uh it was uh it

912
00:35:39,280 --> 00:35:42,000
has become easier lately but before it

913
00:35:42,000 --> 00:35:42,880
was

914
00:35:42,880 --> 00:35:44,720
like talking different

915
00:35:44,720 --> 00:35:45,920
languages

916
00:35:45,920 --> 00:35:47,680
schemas

917
00:35:47,680 --> 00:35:50,800
and that poses a challenge for system

918
00:35:50,800 --> 00:35:52,000
admins

919
00:35:52,000 --> 00:35:53,040
for

920
00:35:53,040 --> 00:35:56,240
aws administrators asian administrators

921
00:35:56,240 --> 00:35:57,680
there is

922
00:35:57,680 --> 00:36:00,000
companies are trying to avoid uh

923
00:36:00,000 --> 00:36:02,720
marrying to a single uh vendor

924
00:36:02,720 --> 00:36:04,480
so when every single vendor does not

925
00:36:04,480 --> 00:36:06,480
want to play with the other all what

926
00:36:06,480 --> 00:36:08,400
this does unfortunately i have to tell

927
00:36:08,400 --> 00:36:10,320
you because i've seen it myself it's in

928
00:36:10,320 --> 00:36:13,119
pairs and the other customers because

929
00:36:13,119 --> 00:36:15,280
when you have a an environment that has

930
00:36:15,280 --> 00:36:17,920
multiple vendors the best ways for all

931
00:36:17,920 --> 00:36:20,640
of them to collaborate the the best way

932
00:36:20,640 --> 00:36:23,119
for all of them is to provide

933
00:36:23,119 --> 00:36:25,839
the easiest way to uh

934
00:36:25,839 --> 00:36:28,400
disability into their environments and

935
00:36:28,400 --> 00:36:30,320
that's what i'm trying to approach here

936
00:36:30,320 --> 00:36:32,320
the approach that we did here is we

937
00:36:32,320 --> 00:36:34,240
already know

938
00:36:34,240 --> 00:36:35,920
we can observe

939
00:36:35,920 --> 00:36:38,800
uh and analyze the endpoint right so

940
00:36:38,800 --> 00:36:41,440
give you some of the things that i seen

941
00:36:41,440 --> 00:36:44,240
uh and related or associated in this

942
00:36:44,240 --> 00:36:46,480
attacks things such as the the

943
00:36:46,480 --> 00:36:49,200
extraction the certificates or keys

944
00:36:49,200 --> 00:36:53,119
tools like insert util.exe

945
00:36:53,119 --> 00:36:55,920
on common processes running in servers

946
00:36:55,920 --> 00:36:58,800
uh all of a sudden that may give away

947
00:36:58,800 --> 00:37:01,839
for example the user adfs dump

948
00:37:01,839 --> 00:37:02,640
uh

949
00:37:02,640 --> 00:37:07,440
things such as registration or or

950
00:37:07,440 --> 00:37:09,920
registry keys rather

951
00:37:09,920 --> 00:37:12,480
used for privileged escalation or the

952
00:37:12,480 --> 00:37:14,800
use of mimikats which

953
00:37:14,800 --> 00:37:16,240
for the most part a lot of the vendors

954
00:37:16,240 --> 00:37:18,240
can detect pretty good

955
00:37:18,240 --> 00:37:19,359
and then

956
00:37:19,359 --> 00:37:21,760
we can take a look at the cloud

957
00:37:21,760 --> 00:37:23,119
providers

958
00:37:23,119 --> 00:37:25,119
and in this uh

959
00:37:25,119 --> 00:37:27,599
when we look at cloud providers uh

960
00:37:27,599 --> 00:37:30,480
obviously we had to we had to focus on

961
00:37:30,480 --> 00:37:32,560
the specific of every

962
00:37:32,560 --> 00:37:34,480
technology right there are no universal

963
00:37:34,480 --> 00:37:37,839
technologies for federations

964
00:37:37,839 --> 00:37:40,960
some of the standards like the samoa and

965
00:37:40,960 --> 00:37:42,880
the oath are being used

966
00:37:42,880 --> 00:37:43,920
by

967
00:37:43,920 --> 00:37:46,160
these providers however the products

968
00:37:46,160 --> 00:37:49,280
themselves use it in different manners

969
00:37:49,280 --> 00:37:52,000
that is why i'm putting some examples

970
00:37:52,000 --> 00:37:53,680
there of some of the things that we

971
00:37:53,680 --> 00:37:56,000
looked at and i'm about to show you

972
00:37:56,000 --> 00:37:57,040
uh

973
00:37:57,040 --> 00:37:59,599
things that are even more specific that

974
00:37:59,599 --> 00:38:00,800
we believe

975
00:38:00,800 --> 00:38:02,720
will help you detect these attacks

976
00:38:02,720 --> 00:38:04,720
because it's challenging i can tell you

977
00:38:04,720 --> 00:38:06,480
if we take away

978
00:38:06,480 --> 00:38:08,079
one side

979
00:38:08,079 --> 00:38:10,880
of this slide you will not be able to

980
00:38:10,880 --> 00:38:12,560
detect this

981
00:38:12,560 --> 00:38:14,000
you will not

982
00:38:14,000 --> 00:38:15,599
like the pass

983
00:38:15,599 --> 00:38:17,520
the pass the cookie for example or the

984
00:38:17,520 --> 00:38:20,640
oauth i look at both loggings

985
00:38:20,640 --> 00:38:22,720
from the longman perspective

986
00:38:22,720 --> 00:38:24,640
it looks like anybody

987
00:38:24,640 --> 00:38:26,320
and sometimes you can use for example

988
00:38:26,320 --> 00:38:28,240
security groups

989
00:38:28,240 --> 00:38:31,280
even using security security groups

990
00:38:31,280 --> 00:38:34,240
depending on

991
00:38:34,240 --> 00:38:36,320
the policies that you have

992
00:38:36,320 --> 00:38:39,599
uh you may not be able to see it

993
00:38:39,599 --> 00:38:40,960
and even worse if you don't have

994
00:38:40,960 --> 00:38:44,240
visibility at the end point level so as

995
00:38:44,240 --> 00:38:46,720
we have expanded

996
00:38:46,720 --> 00:38:49,119
into a converged perimeter

997
00:38:49,119 --> 00:38:51,040
we need to expand our visibility and

998
00:38:51,040 --> 00:38:52,880
that includes

999
00:38:52,880 --> 00:38:55,119
the cloud real estate so we have things

1000
00:38:55,119 --> 00:38:56,000
that

1001
00:38:56,000 --> 00:38:58,079
we need to look at and we need to get

1002
00:38:58,079 --> 00:38:59,440
alerts from it if you don't if you're

1003
00:38:59,440 --> 00:39:01,920
not getting alerts like for example if

1004
00:39:01,920 --> 00:39:04,800
you have an ultra 65 that has excessive

1005
00:39:04,800 --> 00:39:06,240
loading errors

1006
00:39:06,240 --> 00:39:08,800
then you're missing out you you you may

1007
00:39:08,800 --> 00:39:10,560
be under attack right now and you don't

1008
00:39:10,560 --> 00:39:11,359
know

1009
00:39:11,359 --> 00:39:14,079
but consider this if you have an old 365

1010
00:39:14,079 --> 00:39:16,320
from a federal server where where

1011
00:39:16,320 --> 00:39:18,800
passwords are repeated then the the

1012
00:39:18,800 --> 00:39:21,760
scenario that i just gave you it is

1013
00:39:21,760 --> 00:39:24,560
likely to occur it's even worse as we go

1014
00:39:24,560 --> 00:39:27,359
higher in privileges do you have

1015
00:39:27,359 --> 00:39:31,280
soup evidence you have admins per one or

1016
00:39:31,280 --> 00:39:33,680
admins per

1017
00:39:33,680 --> 00:39:36,640
land segments i seen that

1018
00:39:36,640 --> 00:39:39,119
layers of administrators

1019
00:39:39,119 --> 00:39:40,400
these are things that you had to

1020
00:39:40,400 --> 00:39:41,839
consider

1021
00:39:41,839 --> 00:39:44,000
that if they get compromised

1022
00:39:44,000 --> 00:39:46,400
they may indeed provide access

1023
00:39:46,400 --> 00:39:49,599
to all these resources

1024
00:39:49,839 --> 00:39:52,560
here's a

1025
00:39:52,560 --> 00:39:54,720
breakdown of

1026
00:39:54,720 --> 00:39:57,440
the actual uh detection searches that we

1027
00:39:57,440 --> 00:40:01,280
uh uh in my i developed this with my

1028
00:40:01,280 --> 00:40:03,599
with my teammates at the splunk threat

1029
00:40:03,599 --> 00:40:06,240
research team um and this is part of

1030
00:40:06,240 --> 00:40:08,880
what we do uh so

1031
00:40:08,880 --> 00:40:11,119
here's some of the ttps that we're

1032
00:40:11,119 --> 00:40:13,359
looking at endpoint for example they use

1033
00:40:13,359 --> 00:40:16,160
the searchutil.exe

1034
00:40:16,160 --> 00:40:18,160
which basically

1035
00:40:18,160 --> 00:40:20,560
allows you to see

1036
00:40:20,560 --> 00:40:22,240
the execution of it

1037
00:40:22,240 --> 00:40:24,640
which is usually very rare this is not

1038
00:40:24,640 --> 00:40:27,599
something that happens commonly um on

1039
00:40:27,599 --> 00:40:30,160
common process is an endpoint

1040
00:40:30,160 --> 00:40:31,520
which

1041
00:40:31,520 --> 00:40:35,119
may give you um

1042
00:40:35,200 --> 00:40:37,440
the presence of the execution tools such

1043
00:40:37,440 --> 00:40:39,599
as adfs

1044
00:40:39,599 --> 00:40:41,599
dump for example

1045
00:40:41,599 --> 00:40:43,760
registry keys to use

1046
00:40:43,760 --> 00:40:45,920
for privileged escalation

1047
00:40:45,920 --> 00:40:49,680
and persistence this is uh

1048
00:40:51,040 --> 00:40:51,560
one t1546

1049
00:40:51,680 --> 00:40:52,640
um

1050
00:40:52,640 --> 00:40:55,119
then we have things such as mimikats

1051
00:40:55,119 --> 00:40:57,119
which is we can detect pretty good this

1052
00:40:57,119 --> 00:40:59,200
is uh potential axis

1053
00:40:59,200 --> 00:41:00,400
uh

1054
00:41:00,400 --> 00:41:03,800
which is t103.01

1055
00:41:05,200 --> 00:41:09,520
this is obviously my third dtps

1056
00:41:09,520 --> 00:41:12,000
and we even have a no one that is

1057
00:41:12,000 --> 00:41:13,040
actually

1058
00:41:13,040 --> 00:41:15,359
mimicked by a powershell

1059
00:41:15,359 --> 00:41:17,640
in event code

1060
00:41:17,640 --> 00:41:22,640
4703 remember for you to have this

1061
00:41:22,640 --> 00:41:25,440
you need a system on policy

1062
00:41:25,440 --> 00:41:28,000
and you need a gpo

1063
00:41:28,000 --> 00:41:30,720
that will allow you to get the event id

1064
00:41:30,720 --> 00:41:31,920
that you need

1065
00:41:31,920 --> 00:41:35,920
most of these event ids are not audited

1066
00:41:35,920 --> 00:41:38,400
by default so you need visibility but

1067
00:41:38,400 --> 00:41:40,720
the visibility requires several steps

1068
00:41:40,720 --> 00:41:42,720
just like the cloud

1069
00:41:42,720 --> 00:41:44,880
you have to select a

1070
00:41:44,880 --> 00:41:47,440
sometimes you need to sort of sync your

1071
00:41:47,440 --> 00:41:50,160
log somewhere and then they need to get

1072
00:41:50,160 --> 00:41:51,839
picked up by some service that then

1073
00:41:51,839 --> 00:41:55,040
sends it somewhere else and uh this this

1074
00:41:55,040 --> 00:41:57,119
can be actually cumbersome

1075
00:41:57,119 --> 00:41:58,960
you have to do your homework at the

1076
00:41:58,960 --> 00:42:02,480
endpoint as well you have to have a

1077
00:42:02,480 --> 00:42:04,000
a strict

1078
00:42:04,000 --> 00:42:06,000
system policy with all these

1079
00:42:06,000 --> 00:42:07,520
consequences you know there will be a

1080
00:42:07,520 --> 00:42:10,079
lot of logs um they may have to be

1081
00:42:10,079 --> 00:42:13,440
rotated uh there's a lot like log life

1082
00:42:13,440 --> 00:42:16,079
cycle that you're gonna have to consider

1083
00:42:16,079 --> 00:42:19,599
and of course with uh evtx type of

1084
00:42:19,599 --> 00:42:22,640
auditing you had to know the right gpos

1085
00:42:22,640 --> 00:42:25,839
and uh uh apply them and and after that

1086
00:42:25,839 --> 00:42:27,599
obviously you need a place to retrieve

1087
00:42:27,599 --> 00:42:29,200
this it doesn't have to be a spoon it

1088
00:42:29,200 --> 00:42:30,800
can be eok

1089
00:42:30,800 --> 00:42:32,400
or any other

1090
00:42:32,400 --> 00:42:33,280
sim

1091
00:42:33,280 --> 00:42:35,440
or you can build your own sim right but

1092
00:42:35,440 --> 00:42:37,359
the bottom line is the events will be

1093
00:42:37,359 --> 00:42:38,560
the same

1094
00:42:38,560 --> 00:42:40,480
the logs will be the same

1095
00:42:40,480 --> 00:42:42,240
so let's move on and now let's take a

1096
00:42:42,240 --> 00:42:43,200
look

1097
00:42:43,200 --> 00:42:45,599
at the actual cloud

1098
00:42:45,599 --> 00:42:48,800
ttps so for example

1099
00:42:48,800 --> 00:42:51,520
we have things such as aws ml access by

1100
00:42:51,520 --> 00:42:54,079
provider user in principle

1101
00:42:54,079 --> 00:42:55,760
we have

1102
00:42:55,760 --> 00:42:58,960
this one as a giveaway aws saml of the

1103
00:42:58,960 --> 00:43:01,760
update entity provider is usually when

1104
00:43:01,760 --> 00:43:03,280
some of the

1105
00:43:03,280 --> 00:43:04,960
attributes are modified this is

1106
00:43:04,960 --> 00:43:07,520
something that is not very common and

1107
00:43:07,520 --> 00:43:10,240
that you should have an alert for

1108
00:43:10,240 --> 00:43:12,000
any needs obviously to be locked

1109
00:43:12,000 --> 00:43:13,200
properly

1110
00:43:13,200 --> 00:43:14,079
um

1111
00:43:14,079 --> 00:43:16,800
you have things such as uh excessive

1112
00:43:16,800 --> 00:43:19,119
single sign on logan errors

1113
00:43:19,119 --> 00:43:20,240
um

1114
00:43:20,240 --> 00:43:22,640
service principle in order 65 that's

1115
00:43:22,640 --> 00:43:23,839
also

1116
00:43:23,839 --> 00:43:26,560
an event in itself that needs to be

1117
00:43:26,560 --> 00:43:28,160
monitored

1118
00:43:28,160 --> 00:43:30,480
or the addition of a service principle

1119
00:43:30,480 --> 00:43:35,040
is also an event that needs to be

1120
00:43:36,720 --> 00:43:37,839
considered

1121
00:43:37,839 --> 00:43:40,640
an event to be monitored by itself

1122
00:43:40,640 --> 00:43:44,319
uh and of course uh o365 neo-federated

1123
00:43:44,319 --> 00:43:45,760
domain remember when i told you about

1124
00:43:45,760 --> 00:43:46,880
people think

1125
00:43:46,880 --> 00:43:48,480
from cloud to cloud i was able to do

1126
00:43:48,480 --> 00:43:49,359
that

1127
00:43:49,359 --> 00:43:51,599
by uh by basically adding a new

1128
00:43:51,599 --> 00:43:53,359
federated domain

1129
00:43:53,359 --> 00:43:55,760
so these are the type of

1130
00:43:55,760 --> 00:43:58,880
detections that will give you

1131
00:43:58,880 --> 00:44:01,040
a way to address

1132
00:44:01,040 --> 00:44:02,800
the abuse

1133
00:44:02,800 --> 00:44:04,640
of

1134
00:44:04,640 --> 00:44:06,640
federated

1135
00:44:06,640 --> 00:44:09,839
credential abuse

1136
00:44:10,240 --> 00:44:13,110
so here's a an example of a

1137
00:44:13,110 --> 00:44:14,960
[Music]

1138
00:44:14,960 --> 00:44:18,480
search i created uh at the

1139
00:44:18,480 --> 00:44:21,119
using spl code in splunk

1140
00:44:21,119 --> 00:44:23,200
and basically what this does is give you

1141
00:44:23,200 --> 00:44:25,200
obviously a deleted stuff

1142
00:44:25,200 --> 00:44:26,560
so um

1143
00:44:26,560 --> 00:44:29,040
or rather sanitize it

1144
00:44:29,040 --> 00:44:30,400
not to give away

1145
00:44:30,400 --> 00:44:31,920
uh

1146
00:44:31,920 --> 00:44:33,119
some of the

1147
00:44:33,119 --> 00:44:35,119
sensitive stuff in it but basically what

1148
00:44:35,119 --> 00:44:36,560
you get here is when somebody went and

1149
00:44:36,560 --> 00:44:39,359
said hey let me change the uh the samo

1150
00:44:39,359 --> 00:44:41,040
provider and that was me by the way

1151
00:44:41,040 --> 00:44:43,680
trying to replicate some of the attacks

1152
00:44:43,680 --> 00:44:45,359
and

1153
00:44:45,359 --> 00:44:48,560
this is a way to not only

1154
00:44:48,560 --> 00:44:51,280
investigate but in combination with all

1155
00:44:51,280 --> 00:44:53,760
of the other searches

1156
00:44:53,760 --> 00:44:55,359
at the end point

1157
00:44:55,359 --> 00:44:58,400
and at the cloud level then we can get a

1158
00:44:58,400 --> 00:45:01,040
very good disability not saying we will

1159
00:45:01,040 --> 00:45:03,359
detect a hundred percent of everything

1160
00:45:03,359 --> 00:45:05,760
but we get a good shot

1161
00:45:05,760 --> 00:45:09,359
uh of detecting this type of uh

1162
00:45:09,359 --> 00:45:10,560
attacks

1163
00:45:10,560 --> 00:45:14,160
the abuse of federated credentials in

1164
00:45:14,160 --> 00:45:17,879
cloud-connected environments

1165
00:45:18,000 --> 00:45:20,480
here's another example

1166
00:45:20,480 --> 00:45:22,640
you can find this if you're interested

1167
00:45:22,640 --> 00:45:23,599
if you're

1168
00:45:23,599 --> 00:45:26,240
uh interested in looking more the code

1169
00:45:26,240 --> 00:45:27,760
we have a github

1170
00:45:27,760 --> 00:45:29,280
where you can actually see the actual

1171
00:45:29,280 --> 00:45:31,680
code this can be translated into other

1172
00:45:31,680 --> 00:45:35,280
technologies and other languages

1173
00:45:35,280 --> 00:45:37,359
but again i'm just showing how this

1174
00:45:37,359 --> 00:45:40,319
translate into that technology just like

1175
00:45:40,319 --> 00:45:41,599
i showed you the attacks i wanted to

1176
00:45:41,599 --> 00:45:42,720
show you

1177
00:45:42,720 --> 00:45:46,759
the detections and the investigations

1178
00:45:46,880 --> 00:45:49,359
and with that in mind

1179
00:45:49,359 --> 00:45:51,119
i'd like to thank you

1180
00:45:51,119 --> 00:45:54,720
for coming today and watching this talk

1181
00:45:54,720 --> 00:45:55,599
and

1182
00:45:55,599 --> 00:45:57,680
we're going to open for q a remember you

1183
00:45:57,680 --> 00:45:58,839
can find me

1184
00:45:58,839 --> 00:46:03,440
at rodzotto.net my twitter is

1185
00:46:03,440 --> 00:46:05,040
rodso

1186
00:46:05,040 --> 00:46:07,440
and if you have any questions please let

1187
00:46:07,440 --> 00:46:09,119
me know you can

1188
00:46:09,119 --> 00:46:12,560
email me as well at rod rotsar.net

1189
00:46:12,560 --> 00:46:14,880
and i hope you enjoyed this presentation

1190
00:46:14,880 --> 00:46:18,040
thank you

