1
00:00:00,610 --> 00:00:03,700
- Hello, and welcome to
DoS: Denial of Shopping,

2
00:00:03,700 --> 00:00:05,280
Analyzing and Exploiting Physical

3
00:00:05,280 --> 00:00:07,440
Shopping Cart Immobilization Systems.

4
00:00:07,440 --> 00:00:08,910
In this talk, we'll be talking about

5
00:00:08,910 --> 00:00:10,280
shopping cart security wheels,

6
00:00:10,280 --> 00:00:13,020
as well as the basics of
RF reverse engineering

7
00:00:13,020 --> 00:00:14,360
and some of the tools and techniques

8
00:00:14,360 --> 00:00:16,940
that you can use to capture
signals in the wild,

9
00:00:16,940 --> 00:00:20,680
analyze them and replay them
later for fun and profit.

10
00:00:20,680 --> 00:00:21,893
Before we go much further,

11
00:00:21,893 --> 00:00:23,730
I want to give a brief disclaimer,

12
00:00:23,730 --> 00:00:25,660
this is a personal project.

13
00:00:25,660 --> 00:00:27,950
There's no reflection here on my employer

14
00:00:27,950 --> 00:00:29,310
or any other organization

15
00:00:29,310 --> 00:00:32,350
unless explicitly stated otherwise.

16
00:00:32,350 --> 00:00:34,310
That out of the way,
you might be wondering,

17
00:00:34,310 --> 00:00:36,670
who are you and how'd you get in here?

18
00:00:36,670 --> 00:00:39,700
Well, my name's Joseph Gabay
and amongst other things,

19
00:00:39,700 --> 00:00:43,090
I am a hacker, a maker, flat
moon conspiracy theorist,

20
00:00:43,090 --> 00:00:46,940
collector of silly domain names
and random certifications.

21
00:00:46,940 --> 00:00:48,740
By day, I build robots.

22
00:00:48,740 --> 00:00:51,780
By night, I hack shopping carts.

23
00:00:51,780 --> 00:00:54,900
And really this is just
an example of something

24
00:00:54,900 --> 00:00:55,810
that caught my interest

25
00:00:55,810 --> 00:00:58,720
and I decided to go
down the rabbit hole on

26
00:00:58,720 --> 00:01:02,060
because I think as you'll
find out in this talk,

27
00:01:02,060 --> 00:01:03,510
there's some pretty cool technology

28
00:01:03,510 --> 00:01:06,800
that you really take for granted
every time you go shopping.

29
00:01:06,800 --> 00:01:08,550
So for those of you who aren't familiar

30
00:01:08,550 --> 00:01:10,380
with shopping carts security wheels,

31
00:01:10,380 --> 00:01:12,040
and they're not everywhere,

32
00:01:12,040 --> 00:01:14,460
usually you only see them in pedestrian

33
00:01:14,460 --> 00:01:16,520
accessible parking lots

34
00:01:16,520 --> 00:01:18,710
where there's a risk
of somebody walking off

35
00:01:18,710 --> 00:01:20,250
with a shopping cart.

36
00:01:20,250 --> 00:01:23,050
What it is is basically an invisible sense

37
00:01:23,050 --> 00:01:26,230
for shopping carts, no really.

38
00:01:26,230 --> 00:01:27,500
When you take a shopping cart

39
00:01:27,500 --> 00:01:30,330
outside of an approved
boundary, usually a parking lot,

40
00:01:30,330 --> 00:01:33,130
one of the wheels will
sense this and lock itself

41
00:01:33,130 --> 00:01:34,440
using an internal mechanism

42
00:01:34,440 --> 00:01:36,903
and you can't take the cart any further.

43
00:01:39,070 --> 00:01:42,190
You might be wondering
why shopping cart wheels?

44
00:01:42,190 --> 00:01:45,720
Why was this a rabbit
hole I decided to go down?

45
00:01:45,720 --> 00:01:49,400
And really the first time
I saw one of these signs,

46
00:01:49,400 --> 00:01:51,670
a warning that these devices were in use,

47
00:01:51,670 --> 00:01:52,960
I got real curious,

48
00:01:52,960 --> 00:01:55,010
how does the wheel know that it's outside

49
00:01:55,010 --> 00:01:55,910
an approved boundary?

50
00:01:55,910 --> 00:01:59,290
How does the wheel actually
lock and stop itself?

51
00:01:59,290 --> 00:02:01,700
How does the wheel get power?

52
00:02:01,700 --> 00:02:04,360
And all of these questions
were turning over in my mind

53
00:02:04,360 --> 00:02:06,900
until I eventually started
doing some research

54
00:02:06,900 --> 00:02:08,420
and that led to more questions

55
00:02:08,420 --> 00:02:10,383
and that led to a Defcon talk.

56
00:02:11,380 --> 00:02:13,010
But I really think it can be summed up

57
00:02:13,010 --> 00:02:15,190
by Terry Pratchett's quote,

58
00:02:15,190 --> 00:02:17,840
it's not worth doing something
unless someone somewhere

59
00:02:17,840 --> 00:02:20,240
would much rather you weren't doing it.

60
00:02:20,240 --> 00:02:22,950
Fundamentally, I see this as a challenge,

61
00:02:22,950 --> 00:02:27,700
just like someone can see a
particularly difficult lock

62
00:02:27,700 --> 00:02:29,890
as a challenge in the locksport community.

63
00:02:29,890 --> 00:02:32,730
A bunch of very smart people
spent a lot of time and money

64
00:02:32,730 --> 00:02:34,990
designing a system to prevent people

65
00:02:34,990 --> 00:02:37,680
from doing something that
they didn't want them to do.

66
00:02:37,680 --> 00:02:40,360
And this is a technical challenge.

67
00:02:40,360 --> 00:02:43,100
And for me, I was curious
to see whether or not

68
00:02:43,100 --> 00:02:45,340
I could overcome it and dissect it.

69
00:02:45,340 --> 00:02:47,573
And that's what this talk is.

70
00:02:49,480 --> 00:02:51,500
So how does the system work?

71
00:02:51,500 --> 00:02:53,460
It's a magnetic loop system

72
00:02:53,460 --> 00:02:55,720
where there's an
underground perimeter wire

73
00:02:55,720 --> 00:02:57,227
that's sending out a signal.

74
00:02:57,227 --> 00:02:59,370
Now you might recall from physics class

75
00:02:59,370 --> 00:03:01,130
that when you push current through a wire,

76
00:03:01,130 --> 00:03:05,190
it produces a magnetic
field in a radius around it,

77
00:03:05,190 --> 00:03:06,920
according to the right hand rule.

78
00:03:06,920 --> 00:03:09,210
So there is a buried wire

79
00:03:09,210 --> 00:03:11,540
around the perimeter of the parking lot

80
00:03:11,540 --> 00:03:13,700
and that's sending out the signal.

81
00:03:13,700 --> 00:03:17,250
When the cart crosses over
this signal, it senses it,

82
00:03:17,250 --> 00:03:20,750
and it uses an internal
mechanism to lock up the wheel

83
00:03:20,750 --> 00:03:23,170
and the store employees have a remote

84
00:03:23,170 --> 00:03:25,030
that they can come by later and unlock it

85
00:03:25,030 --> 00:03:26,180
and bring it back into service

86
00:03:26,180 --> 00:03:29,010
and we'll get into that
in just a little bit.

87
00:03:29,010 --> 00:03:31,070
So I was actually fortunate enough

88
00:03:31,070 --> 00:03:35,670
to have a grocery store nearby
me replacing their sidewalk,

89
00:03:35,670 --> 00:03:39,810
and you can actually see
this buried wire in action

90
00:03:39,810 --> 00:03:41,170
and let me zoom in a little bit,

91
00:03:41,170 --> 00:03:44,600
and you can see highlighted
where that wire is.

92
00:03:44,600 --> 00:03:46,030
And I don't know,

93
00:03:46,030 --> 00:03:48,060
it's rare that you get
to see how this works

94
00:03:48,060 --> 00:03:51,280
cause it's usually cut into
the asphalt and buried.

95
00:03:51,280 --> 00:03:53,250
So that's the wire right there.

96
00:03:53,250 --> 00:03:54,863
That's how the magic happens.

97
00:03:55,970 --> 00:03:57,870
How does it work inside the wheel?

98
00:03:57,870 --> 00:03:59,370
Well, let's take a look at the anatomy

99
00:03:59,370 --> 00:04:00,650
of a shopping cart wheel.

100
00:04:00,650 --> 00:04:01,670
There's two main parts.

101
00:04:01,670 --> 00:04:02,930
There's the outer housing

102
00:04:02,930 --> 00:04:06,000
and you'll notice that on
the inside diameter here,

103
00:04:06,000 --> 00:04:07,450
there's pairs of ridges

104
00:04:07,450 --> 00:04:09,880
and that becomes very important later.

105
00:04:09,880 --> 00:04:11,470
And down on the bottom,

106
00:04:11,470 --> 00:04:14,220
you have the whole internal
assembly and that houses

107
00:04:14,220 --> 00:04:15,980
all the electronics, the motors, all that,

108
00:04:15,980 --> 00:04:18,550
but the thing to note here is that ring

109
00:04:18,550 --> 00:04:19,570
going around the outside.

110
00:04:19,570 --> 00:04:24,320
That's a flexible ring and
it can expand or contract

111
00:04:24,320 --> 00:04:26,740
as that plunger goes up and down.

112
00:04:26,740 --> 00:04:29,020
Here's a closeup of that mechanism here

113
00:04:29,020 --> 00:04:32,450
and basically there's a motor that drives

114
00:04:32,450 --> 00:04:35,840
that little plunger up and
that causes the ring to expand

115
00:04:35,840 --> 00:04:38,740
and if it drives it down,
it causes it to contract.

116
00:04:38,740 --> 00:04:41,440
When the ring is in the expanded position,

117
00:04:41,440 --> 00:04:45,010
the ridges on the inner
diameter of the outer housing

118
00:04:45,010 --> 00:04:49,580
and the outer diameter of
the inner ring interlock

119
00:04:49,580 --> 00:04:51,400
and prevent the wheel from rotating.

120
00:04:51,400 --> 00:04:53,310
It's really a clever mechanism.

121
00:04:53,310 --> 00:04:54,950
I've got to give gatekeeper system

122
00:04:54,950 --> 00:04:56,300
some major credit for that.

123
00:04:57,620 --> 00:05:01,030
Taking a look at the other
side of the inner assembly,

124
00:05:01,030 --> 00:05:03,740
we can see what also makes it tick.

125
00:05:03,740 --> 00:05:05,960
We have a lithium battery here.

126
00:05:05,960 --> 00:05:08,700
That's just a three volt
non-rechargeable lithium battery

127
00:05:08,700 --> 00:05:11,340
and assuming it's in standby mode,

128
00:05:11,340 --> 00:05:13,500
that should last for a good long while.

129
00:05:13,500 --> 00:05:16,960
Obviously running a high current
application like that motor

130
00:05:16,960 --> 00:05:19,910
a whole bunch is going to
reduce the life of the wheel,

131
00:05:19,910 --> 00:05:23,380
but modern microcontrollers
can sip on a few microamps

132
00:05:23,380 --> 00:05:27,390
of current and do stuff
like monitoring RF systems.

133
00:05:27,390 --> 00:05:31,130
So I can really see this
lasting for quite a while.

134
00:05:31,130 --> 00:05:33,300
Below that, you have the PCB assembly

135
00:05:33,300 --> 00:05:35,400
that houses all of the electronics,

136
00:05:35,400 --> 00:05:38,260
as well as the antennas
and other radio equipment.

137
00:05:38,260 --> 00:05:41,310
And then you have a motor
which connects to a gearbox

138
00:05:41,310 --> 00:05:44,480
that drives the mechanism
we saw on the last slide.

139
00:05:44,480 --> 00:05:46,770
Taking a closer look at the PCB,

140
00:05:46,770 --> 00:05:48,580
we see a few interesting things.

141
00:05:48,580 --> 00:05:51,500
First of all, there's
two separate antennas.

142
00:05:51,500 --> 00:05:52,710
Up top highlighted,

143
00:05:52,710 --> 00:05:57,670
you can see a PCB trace
antenna for 2.4 gigahertz.

144
00:05:57,670 --> 00:05:59,550
We'll talk more about that later.

145
00:05:59,550 --> 00:06:01,770
And on the underside of the PCB,

146
00:06:01,770 --> 00:06:03,850
you can see that little black cylinder.

147
00:06:03,850 --> 00:06:07,270
What that is is it's
just an inductor that...

148
00:06:07,270 --> 00:06:09,870
And that's the element that
senses the magnetic field

149
00:06:09,870 --> 00:06:11,160
from the buried wire.

150
00:06:11,160 --> 00:06:14,950
These systems generally
use a very low frequency.

151
00:06:14,950 --> 00:06:17,410
And in this case, as we'll find out later,

152
00:06:17,410 --> 00:06:19,893
this is running at 7.8 kilohertz.

153
00:06:21,000 --> 00:06:24,070
Going back to the top view,
we see a couple other things.

154
00:06:24,070 --> 00:06:25,330
You see the microcontroller,

155
00:06:25,330 --> 00:06:29,570
which is a Texas Instrument
CC 2510 microcontroller.

156
00:06:29,570 --> 00:06:32,610
It has a built-in 2.4
gigahertz transceiver,

157
00:06:32,610 --> 00:06:36,130
and is designed around the
idea of low power standby modes

158
00:06:36,130 --> 00:06:38,570
for the radio to maximize the life

159
00:06:38,570 --> 00:06:40,620
and that makes sense in this application.

160
00:06:41,540 --> 00:06:45,730
To the right of it, you can
see there is a whole mess of

161
00:06:45,730 --> 00:06:47,900
what looks like amplifiers
and transistors,

162
00:06:47,900 --> 00:06:50,520
and I'm not entirely sure
what's going on there,

163
00:06:50,520 --> 00:06:53,260
but I'm fairly sure that
that's the amplifier circuit

164
00:06:53,260 --> 00:06:56,230
that turns the signal from
the inductor that it picks up

165
00:06:56,230 --> 00:06:58,670
from the magnetic field
and turns into something

166
00:06:58,670 --> 00:07:01,660
that the microcontroller can reliably use.

167
00:07:01,660 --> 00:07:04,380
Below the microcontroller
are a couple more transistors

168
00:07:04,380 --> 00:07:07,310
and that is the motor driver
circuit that actually drives

169
00:07:07,310 --> 00:07:10,040
that DC motor to lock and unlock it.

170
00:07:10,040 --> 00:07:11,420
And to the left of it,

171
00:07:11,420 --> 00:07:13,070
it's kind of covered up
by one of the arrows,

172
00:07:13,070 --> 00:07:15,790
you can see a 10 pin JTAG port

173
00:07:15,790 --> 00:07:19,040
and you can do plenty of fun
things with the JTAG port.

174
00:07:19,040 --> 00:07:21,400
You can try dumping firmware,

175
00:07:21,400 --> 00:07:23,940
you can load it up into a debugger.

176
00:07:23,940 --> 00:07:26,190
You can do some pretty interesting things,

177
00:07:26,190 --> 00:07:29,043
but all of that's outside
of the scope of this talk.

178
00:07:31,000 --> 00:07:33,620
So let's say we want to learn more

179
00:07:33,620 --> 00:07:36,850
about how this works at a signal's level.

180
00:07:36,850 --> 00:07:38,450
There's a couple of good places to start.

181
00:07:38,450 --> 00:07:41,500
The first one is of course fcc.gov,

182
00:07:41,500 --> 00:07:45,290
any consumer product that
is going out into the wild

183
00:07:45,290 --> 00:07:49,420
that has RF systems has
to be approved by the FCC.

184
00:07:49,420 --> 00:07:53,860
You basically have to undergo
some pretty rigorous testing

185
00:07:53,860 --> 00:07:55,160
and submit a test report,

186
00:07:55,160 --> 00:07:58,440
proving that it's not going to
cause any undue interference

187
00:07:58,440 --> 00:08:01,323
to nearby devices or pollute the airwaves.

188
00:08:02,835 --> 00:08:05,250
All of these documents
are public record though

189
00:08:05,250 --> 00:08:07,760
and you can see from
the screenshot up there,

190
00:08:07,760 --> 00:08:09,480
there's a lot of juicy things.

191
00:08:09,480 --> 00:08:10,700
You'll generally be able to find out

192
00:08:10,700 --> 00:08:12,380
what frequency something uses,

193
00:08:12,380 --> 00:08:15,063
sometimes information about
the modulation method,

194
00:08:16,236 --> 00:08:17,069
as well as in this case,

195
00:08:17,069 --> 00:08:19,830
the user manual for the
wheel and the remote system,

196
00:08:19,830 --> 00:08:22,730
which had a lot of good information.

197
00:08:22,730 --> 00:08:23,870
So when we go on,

198
00:08:23,870 --> 00:08:27,070
we can see what we learned
from these documents.

199
00:08:27,070 --> 00:08:28,940
The two big things we learned is that

200
00:08:28,940 --> 00:08:31,640
the low frequency is below nine kilohertz,

201
00:08:31,640 --> 00:08:34,610
which provides a bit of a problem

202
00:08:34,610 --> 00:08:37,590
that we'll go into on
capturing that signal

203
00:08:37,590 --> 00:08:42,003
as well as the 2.4 gigahertz
ISM band which we already knew.

204
00:08:42,860 --> 00:08:45,710
An interesting tidbit that
we learned from it is that

205
00:08:45,710 --> 00:08:49,490
it uses either MSK or FSK
for modulation on the 2.4.

206
00:08:50,430 --> 00:08:52,860
And we'll see later that it uses FSK,

207
00:08:52,860 --> 00:08:54,533
which is frequency shift king.

208
00:08:56,640 --> 00:08:59,160
Let's talk about the VLF signals,

209
00:08:59,160 --> 00:09:01,300
the sub nine kilohertz signal

210
00:09:01,300 --> 00:09:04,790
and why it's so difficult to capture that.

211
00:09:04,790 --> 00:09:07,130
So generally speaking
in radio applications,

212
00:09:07,130 --> 00:09:09,690
you want your antenna to be a...

213
00:09:09,690 --> 00:09:12,290
You want your antenna's
link to be a multiple

214
00:09:12,290 --> 00:09:14,530
of the wavelength of the
signal you're trying to catch.

215
00:09:14,530 --> 00:09:16,090
For high-frequency signals,

216
00:09:16,090 --> 00:09:18,260
this is usually fairly small,

217
00:09:18,260 --> 00:09:21,160
it's in the millimeters
or centimeters range,

218
00:09:21,160 --> 00:09:22,960
fairly easy to do.

219
00:09:22,960 --> 00:09:25,920
As you get to lower frequency signals,

220
00:09:25,920 --> 00:09:27,540
that wavelengths gets big.

221
00:09:27,540 --> 00:09:28,520
Below nine kilohertz,

222
00:09:28,520 --> 00:09:30,710
you're looking at something
in the tens of kilometers,

223
00:09:30,710 --> 00:09:33,210
which is a little bit
outside of my capacity

224
00:09:33,210 --> 00:09:35,400
to build an antenna for.

225
00:09:35,400 --> 00:09:37,230
And further complicating this,

226
00:09:37,230 --> 00:09:40,250
most software defined
radios and RF amplifiers

227
00:09:40,250 --> 00:09:43,560
are designed to work with
frequencies above one megahertz

228
00:09:43,560 --> 00:09:44,960
because anything below that

229
00:09:44,960 --> 00:09:47,660
and you're running into the
problems I just mentioned.

230
00:09:49,240 --> 00:09:54,090
Now some wonderful hackers
out of France at templab.org

231
00:09:54,090 --> 00:09:55,210
were also playing around

232
00:09:55,210 --> 00:09:57,970
with these shopping
cart wheels around 2008.

233
00:09:57,970 --> 00:10:01,010
And they had a very
interesting observation,

234
00:10:01,010 --> 00:10:03,930
which is nine kilohertz
is in the audio range.

235
00:10:03,930 --> 00:10:06,170
We can use regular audio amplifier

236
00:10:06,170 --> 00:10:09,173
and audio processing equipment
to work with these signals.

237
00:10:10,570 --> 00:10:13,840
Before I go into that, I
want to give a brief apology

238
00:10:13,840 --> 00:10:15,830
to any RF engineers in the audience.

239
00:10:15,830 --> 00:10:18,630
I'm about to do some pretty janky things

240
00:10:18,630 --> 00:10:20,560
to capture this signal.

241
00:10:20,560 --> 00:10:22,730
I'm sure there's better
ways I could have done this

242
00:10:22,730 --> 00:10:24,910
and I'm sure there's worse ways,

243
00:10:24,910 --> 00:10:26,670
but if there's something I missed

244
00:10:26,670 --> 00:10:29,060
or an approach that I
could've taken, please,

245
00:10:29,060 --> 00:10:31,510
my contact info is at
the end of this talk,

246
00:10:31,510 --> 00:10:32,900
shoot me an email.

247
00:10:32,900 --> 00:10:35,800
I'd love to learn how I
could have done this better,

248
00:10:35,800 --> 00:10:39,540
but let's move on to some abominations.

249
00:10:39,540 --> 00:10:42,240
So right here is a
homemade antenna I made.

250
00:10:42,240 --> 00:10:43,650
It's called a loop stick antenna

251
00:10:43,650 --> 00:10:45,790
because it's a stick with
a whole bunch of loops

252
00:10:45,790 --> 00:10:46,820
of conductor around it.

253
00:10:46,820 --> 00:10:48,650
This is a ferrite core

254
00:10:48,650 --> 00:10:51,940
with a bunch of magnet
wire wound around it.

255
00:10:51,940 --> 00:10:56,200
And that's wired into a 3.5
millimeter headphone jack.

256
00:10:56,200 --> 00:10:59,456
I included a little resistor
there and that actually tricks

257
00:10:59,456 --> 00:11:03,100
a phone or audio device into thinking that

258
00:11:03,100 --> 00:11:05,180
what's plugged into it
is a microphone line

259
00:11:05,180 --> 00:11:06,660
and not a speaker line

260
00:11:06,660 --> 00:11:10,440
so it'll let you record
audio from that antenna.

261
00:11:10,440 --> 00:11:13,610
And with that, I plugged it into my phone

262
00:11:13,610 --> 00:11:16,410
and took it to the local shopping center

263
00:11:16,410 --> 00:11:19,570
that has one of these,
plopped it on the buried line

264
00:11:19,570 --> 00:11:22,750
and hit record in a spectrogram app.

265
00:11:22,750 --> 00:11:25,470
And I was actually very
surprised to see that

266
00:11:25,470 --> 00:11:30,237
we see a signal and a fairly
clear signal so I'm in.

267
00:11:33,420 --> 00:11:35,620
Loading this into a spectrogram app,

268
00:11:35,620 --> 00:11:37,790
we can see that there is indeed

269
00:11:37,790 --> 00:11:41,610
a very low frequency signal
there at 7.8 kilohertz

270
00:11:41,610 --> 00:11:44,840
as well as one at 15.6 kilohertz,

271
00:11:44,840 --> 00:11:49,333
but that's just the resonance
of the 7.8 kilohertz signal,

272
00:11:49,333 --> 00:11:51,650
and we can fairly safely ignore that.

273
00:11:51,650 --> 00:11:54,380
Zooming in a bit and we
loaded this into Audacity

274
00:11:54,380 --> 00:11:56,490
because as far as anything is concerned,

275
00:11:56,490 --> 00:11:59,300
this is just a regular audio file.

276
00:11:59,300 --> 00:12:01,540
So we load it into Audacity and we can see

277
00:12:01,540 --> 00:12:05,180
the wave form of the signal
and start diving into it

278
00:12:05,180 --> 00:12:06,380
and see what's going on.

279
00:12:07,520 --> 00:12:11,940
Zooming in a bit further,
we see that the lock signal

280
00:12:11,940 --> 00:12:14,030
takes about an eighth of a second

281
00:12:14,030 --> 00:12:16,270
and is followed by an eighth
of a second of silence

282
00:12:16,270 --> 00:12:19,530
by another lock signal and
this signal just gets repeated

283
00:12:19,530 --> 00:12:21,073
for infinity and beyond.

284
00:12:22,270 --> 00:12:24,920
Zooming into an individual
one of these signals,

285
00:12:24,920 --> 00:12:27,430
we can see that it is an eight bit signal

286
00:12:27,430 --> 00:12:29,720
composing of 10 parts.

287
00:12:29,720 --> 00:12:32,460
You have a start bit that
signals microcontroller

288
00:12:32,460 --> 00:12:35,270
that's starting to send the
signal and you have a series

289
00:12:35,270 --> 00:12:38,930
of long or short blips that
correspond to ones and zeros.

290
00:12:38,930 --> 00:12:42,100
And after eight of these,
you have another longer blip.

291
00:12:42,100 --> 00:12:45,170
That's the stop bit and
tells the microcontroller

292
00:12:45,170 --> 00:12:46,560
we're done transmitting.

293
00:12:46,560 --> 00:12:50,853
And from that, that's all you
need to lock a shopping cart.

294
00:12:51,980 --> 00:12:54,050
What about unlocking a shopping cart?

295
00:12:54,050 --> 00:12:57,840
Unfortunately, in order
to get samples for this,

296
00:12:57,840 --> 00:13:00,100
I needed one of the actual CartKeys

297
00:13:00,100 --> 00:13:01,760
to take samples from.

298
00:13:01,760 --> 00:13:05,320
Thankfully eBay is a
magical, magical place

299
00:13:05,320 --> 00:13:09,310
and these CartKeys are available on eBay.

300
00:13:09,310 --> 00:13:12,620
So I went ahead and bought one and

301
00:13:12,620 --> 00:13:14,320
I played around with a bit and you can see

302
00:13:14,320 --> 00:13:16,290
that's the CartKey model two up there.

303
00:13:16,290 --> 00:13:19,357
I purchased both a CartKey
one and a CartKey two.

304
00:13:20,600 --> 00:13:22,920
The big difference is the
CartKey two implements

305
00:13:22,920 --> 00:13:26,940
the 2.4 gigahertz signal for unlock only.

306
00:13:26,940 --> 00:13:30,520
The CartKey one only
uses the 7.8 kilohertz.

307
00:13:30,520 --> 00:13:35,520
So let's go ahead and see
what these signals look like.

308
00:13:36,370 --> 00:13:39,550
So I used the same loop stick
antenna and phone set up here

309
00:13:39,550 --> 00:13:41,830
and just sat it next to the CartKey

310
00:13:41,830 --> 00:13:44,510
as I hit the lock and unlock signals

311
00:13:44,510 --> 00:13:46,650
and this is what it looks like.

312
00:13:46,650 --> 00:13:48,530
You can see the unlock signal

313
00:13:48,530 --> 00:13:50,270
looks slightly different
from the lock signal

314
00:13:50,270 --> 00:13:53,070
just in terms of how
many times it's repeated

315
00:13:53,070 --> 00:13:54,580
and the spacing between them.

316
00:13:54,580 --> 00:13:56,730
But when we zoom in and
compare them directly,

317
00:13:56,730 --> 00:13:59,410
we can see that for both devices,

318
00:13:59,410 --> 00:14:02,623
the lock and unlock
signal is the exact same.

319
00:14:04,370 --> 00:14:06,790
If we compare the lock and unlock signals

320
00:14:06,790 --> 00:14:08,900
and decode them, interestingly enough,

321
00:14:08,900 --> 00:14:11,130
we see that the unlock signal

322
00:14:11,130 --> 00:14:13,910
is just the inverse of the lock signal

323
00:14:13,910 --> 00:14:15,530
where there's a one and there's a zero

324
00:14:15,530 --> 00:14:18,180
and when there's a zero, there's a one.

325
00:14:18,180 --> 00:14:21,900
Interesting, but let's go a bit further.

326
00:14:21,900 --> 00:14:24,740
Let's see if we can use this.

327
00:14:24,740 --> 00:14:27,860
So we're trying to perform
what's called a replay attack.

328
00:14:27,860 --> 00:14:29,780
And for those of you who
aren't familiar with it,

329
00:14:29,780 --> 00:14:32,500
a replay attack is when
you capture a signal

330
00:14:32,500 --> 00:14:34,330
and replay it back,

331
00:14:34,330 --> 00:14:37,293
trying to pretend you're
the original device.

332
00:14:38,210 --> 00:14:40,900
There's lots of ways to
protect against this,

333
00:14:40,900 --> 00:14:43,320
various authentication
schemes or incrementing

334
00:14:43,320 --> 00:14:44,960
a number that's sent.

335
00:14:44,960 --> 00:14:47,050
Being shopping cart wheels,

336
00:14:47,050 --> 00:14:48,230
they don't implement any of this.

337
00:14:48,230 --> 00:14:51,113
It's the same signal all the
time, which is very good us.

338
00:14:52,160 --> 00:14:55,250
So another interesting thing of note is

339
00:14:55,250 --> 00:14:59,350
you can perform this
attack without an antenna.

340
00:14:59,350 --> 00:15:01,830
You can use either a pair of headphones

341
00:15:01,830 --> 00:15:05,740
or even your phone speaker
as a really crappy antenna.

342
00:15:05,740 --> 00:15:06,880
Because if you think about it,

343
00:15:06,880 --> 00:15:11,880
what a speaker is is a coil
of wire attached to a membrane

344
00:15:12,580 --> 00:15:15,190
with a magnet on it and you
send signals through the wire

345
00:15:15,190 --> 00:15:16,560
and it causes the membrane

346
00:15:16,560 --> 00:15:19,020
to vibrate back and forth producing sound.

347
00:15:19,020 --> 00:15:22,210
And because you're sending
current through a wire,

348
00:15:22,210 --> 00:15:25,250
you do get a bit of a magnetic field.

349
00:15:25,250 --> 00:15:29,560
Now generally, this is
undesirable and its parasitic EMF.

350
00:15:29,560 --> 00:15:31,330
But in this case,

351
00:15:31,330 --> 00:15:34,190
that's close enough to
the very loop of wire

352
00:15:34,190 --> 00:15:36,650
for the original signal where it works.

353
00:15:36,650 --> 00:15:38,840
So you can take an MP3 file

354
00:15:38,840 --> 00:15:41,570
of those signals, play
it on your speaker phone,

355
00:15:41,570 --> 00:15:44,910
hold it up next to a cart
and it'll lock or unlock.

356
00:15:44,910 --> 00:15:47,970
Also big shout out to the
folks at TempLab again.

357
00:15:47,970 --> 00:15:50,760
They gave this idea and
they have a couple demos

358
00:15:50,760 --> 00:15:51,760
of doing just that.

359
00:15:51,760 --> 00:15:53,010
Please go check them out.

360
00:15:54,090 --> 00:15:56,440
So here's a video of
me doing exactly this.

361
00:15:56,440 --> 00:15:59,460
In this case, I didn't use
the speaker or headphones.

362
00:15:59,460 --> 00:16:02,990
I just plugged my antenna back
in and instead of receiving,

363
00:16:02,990 --> 00:16:04,840
I'm using it to transmit.

364
00:16:04,840 --> 00:16:07,090
So let's take a look at
what this looks like.

365
00:16:08,960 --> 00:16:12,621
Here I go locking it,
playing the lock MP3 file.

366
00:16:12,621 --> 00:16:14,020
When I play the unlock MP3 file,

367
00:16:14,020 --> 00:16:15,930
you can see the roomba contracting.

368
00:16:15,930 --> 00:16:19,140
And this is literally just off screen,

369
00:16:19,140 --> 00:16:20,680
but that headphone jack

370
00:16:20,680 --> 00:16:23,130
is plugged directly into
that loop stick antenna.

371
00:16:25,140 --> 00:16:27,890
So it's fairly short range as it is.

372
00:16:27,890 --> 00:16:31,000
Loop stick antennas aren't
particularly good transmitters

373
00:16:31,000 --> 00:16:32,820
and that was a pretty small one.

374
00:16:32,820 --> 00:16:34,790
And I was curious to see

375
00:16:34,790 --> 00:16:36,500
how much further I could get it to go.

376
00:16:36,500 --> 00:16:40,260
So I picked up a large
solenoid coil at the MIT Flea

377
00:16:40,260 --> 00:16:43,810
as well as a 10 watt audio amplifier.

378
00:16:43,810 --> 00:16:46,070
I hooked it all up and played the signal

379
00:16:46,070 --> 00:16:47,120
and I got it to work

380
00:16:47,120 --> 00:16:51,080
and I was getting a range
of maybe two to three feet

381
00:16:51,080 --> 00:16:52,130
at 10 watts.

382
00:16:52,130 --> 00:16:55,690
And that's not great, but pretty good.

383
00:16:55,690 --> 00:16:57,680
Unfortunately, we're hitting an area

384
00:16:57,680 --> 00:16:59,040
of diminishing returns here

385
00:16:59,040 --> 00:17:02,140
because we're fighting
against the laws of physics.

386
00:17:02,140 --> 00:17:05,740
Magnetic signals, the K,

387
00:17:05,740 --> 00:17:08,169
according to the inverse square rule,

388
00:17:08,169 --> 00:17:09,900
which means to double the range,

389
00:17:09,900 --> 00:17:11,743
you need to quadruple the power.

390
00:17:14,778 --> 00:17:17,370
It gets kind of tricky
to pump a lot of power

391
00:17:17,370 --> 00:17:19,970
through a small bit of
magnet wire like that,

392
00:17:19,970 --> 00:17:22,110
not without things getting hot and melty

393
00:17:22,110 --> 00:17:26,070
so there is an upper limit
to how far you can lock

394
00:17:26,070 --> 00:17:28,073
or unlock a cart using this approach.

395
00:17:29,770 --> 00:17:33,350
So let's take a look at the
2.4 gigahertz signal now.

396
00:17:33,350 --> 00:17:36,110
Much easier to work with
and we can use a HackRF,

397
00:17:36,110 --> 00:17:39,470
which is a software
defined radio that operates

398
00:17:39,470 --> 00:17:41,510
in the range of one
megahertz to six gigahertz,

399
00:17:41,510 --> 00:17:44,850
which is a fantastically large
range and will be pretty good

400
00:17:44,850 --> 00:17:48,040
for any signal you might
encounter in the wild.

401
00:17:48,040 --> 00:17:50,990
So using Gqrx, I played around a bit

402
00:17:50,990 --> 00:17:54,220
and I found the frequencies
that it was transmitting on it.

403
00:17:54,220 --> 00:17:57,483
You can see the unlock
signal being broadcast here.

404
00:17:58,810 --> 00:18:01,190
Loading this into ultimate radio hacker,

405
00:18:01,190 --> 00:18:03,660
which is another great program for this,

406
00:18:03,660 --> 00:18:07,610
you can see that it is
a series of three pulses

407
00:18:07,610 --> 00:18:10,030
and down here, you can see that it uses

408
00:18:10,030 --> 00:18:12,050
frequency shift key modulation.

409
00:18:12,050 --> 00:18:14,070
If we zoom in on that, we can decode it

410
00:18:14,070 --> 00:18:17,480
and we can see that it's 010,

411
00:18:17,480 --> 00:18:19,510
and then a bit of space, 010.

412
00:18:19,510 --> 00:18:22,270
And all of this is happening
on a center frequency

413
00:18:22,270 --> 00:18:27,270
of 2.417 gigahertz and it's
using a frequency shift king.

414
00:18:27,490 --> 00:18:28,920
There's two frequencies.

415
00:18:28,920 --> 00:18:32,690
One frequency is a zero,
the other frequency's a one.

416
00:18:32,690 --> 00:18:34,860
Pretty basic, pretty easy to implement

417
00:18:34,860 --> 00:18:36,443
and pretty fool proof.

418
00:18:37,840 --> 00:18:40,083
So let's try replaying this.

419
00:18:40,930 --> 00:18:43,580
The HackRF can act as
a transmitter as well,

420
00:18:43,580 --> 00:18:48,260
and URH can export files as WAV files,

421
00:18:48,260 --> 00:18:51,430
which means we can import
them into Audacity.

422
00:18:51,430 --> 00:18:54,230
It results in a absolutely
insane sample rate

423
00:18:54,230 --> 00:18:57,620
of eight megahertz, but it works.

424
00:18:57,620 --> 00:19:00,890
You have to get a little spicy

425
00:19:00,890 --> 00:19:03,160
with some of your settings
to make everything work,

426
00:19:03,160 --> 00:19:05,070
but it works.

427
00:19:05,070 --> 00:19:07,590
So from here, I was able to
slice and dice the wave form

428
00:19:07,590 --> 00:19:10,310
that I just captured as
well as make new commands

429
00:19:10,310 --> 00:19:11,330
from pure tone.

430
00:19:11,330 --> 00:19:15,980
So say I want a tone of
this frequency for this long

431
00:19:15,980 --> 00:19:20,980
and duplicate how the
original unlock signal worked.

432
00:19:21,030 --> 00:19:22,820
And I can export this as a wave file.

433
00:19:22,820 --> 00:19:27,140
And don't you know, URH lets
you directly play wave files

434
00:19:27,140 --> 00:19:29,500
through HackRF, it's great.

435
00:19:29,500 --> 00:19:31,970
This is the reconstructed signal I made

436
00:19:31,970 --> 00:19:33,150
with some of the length data,

437
00:19:33,150 --> 00:19:36,120
but this is just made
from scratch in Audacity.

438
00:19:36,120 --> 00:19:38,140
And if I play it through the HackRF

439
00:19:38,140 --> 00:19:40,893
through this interface
here, this is what we get.

440
00:19:42,920 --> 00:19:45,240
And it takes a bit longer to do it

441
00:19:45,240 --> 00:19:47,440
and they're up close right now

442
00:19:47,440 --> 00:19:49,390
just because I want it for the video,

443
00:19:49,390 --> 00:19:52,050
but this will work from across the room.

444
00:19:52,050 --> 00:19:53,733
So a much, much better range.

445
00:19:54,930 --> 00:19:58,260
Now you're probably wondering
because you're all hackers,

446
00:19:58,260 --> 00:20:00,360
can you lock it from a long range?

447
00:20:00,360 --> 00:20:04,610
Is there a lock signal on the
2.4 gigahertz spectrum end?

448
00:20:04,610 --> 00:20:06,993
The answer is unfortunately,
I don't think so.

449
00:20:08,350 --> 00:20:09,850
It'd be a lot easier to transmit,

450
00:20:09,850 --> 00:20:13,650
but I tried all the different
combinations of three bits,

451
00:20:13,650 --> 00:20:16,570
ones and zeros and none
of them triggered a lock

452
00:20:16,570 --> 00:20:18,420
when I broadcast them.

453
00:20:18,420 --> 00:20:21,210
It's likely that gatekeeper
systems did this on purpose

454
00:20:21,210 --> 00:20:24,490
so you either don't accidentally
lock a whole bunch of carts

455
00:20:24,490 --> 00:20:26,520
or people like us don't go out there

456
00:20:26,520 --> 00:20:29,880
and lock a whole bunch
of carts all at once

457
00:20:29,880 --> 00:20:31,783
with nobody knowing what's going on.

458
00:20:33,550 --> 00:20:36,520
So what can we do with this knowledge?

459
00:20:36,520 --> 00:20:37,840
Yeah, not a whole lot.

460
00:20:37,840 --> 00:20:40,730
We can lock carts that
were within a few feet of.

461
00:20:40,730 --> 00:20:43,770
You can unlock shopping
carts that have been locked,

462
00:20:43,770 --> 00:20:47,250
but if your goal is to walk
off with a shopping cart,

463
00:20:47,250 --> 00:20:50,170
there's a lot easier ways to do it

464
00:20:50,170 --> 00:20:53,650
than pulling out a software
defined radio and MP3 files

465
00:20:53,650 --> 00:20:55,080
and being a hacker.

466
00:20:55,080 --> 00:20:57,623
At the end of the day,
don't be a dick with this.

467
00:20:58,861 --> 00:21:01,150
The only persons whose
day you'll make worse

468
00:21:01,150 --> 00:21:04,020
is the random grocery store employee

469
00:21:04,020 --> 00:21:05,840
who has to go around unlocking carts

470
00:21:05,840 --> 00:21:07,683
and that's just not cool.

471
00:21:09,890 --> 00:21:11,710
Very briefly, here's the references

472
00:21:11,710 --> 00:21:13,550
and some of the software I used.

473
00:21:13,550 --> 00:21:16,260
And I'd also like to
extend a special thanks

474
00:21:16,260 --> 00:21:18,380
to the Electronic Frontier Foundation

475
00:21:18,380 --> 00:21:20,220
and its Coders Rights Project

476
00:21:20,220 --> 00:21:23,300
for giving me advice and
guidance as I prepared this talk

477
00:21:23,300 --> 00:21:25,260
to make sure I didn't
cross any legal lines

478
00:21:25,260 --> 00:21:26,860
and get myself into trouble.

479
00:21:26,860 --> 00:21:28,970
They're a fantastic resource for hackers

480
00:21:28,970 --> 00:21:32,040
and are happy to work with the community

481
00:21:32,040 --> 00:21:35,010
for answering questions
about responsible disclosure

482
00:21:35,010 --> 00:21:38,340
and the intricacies of computer law,

483
00:21:38,340 --> 00:21:40,170
which is not a simple field.

484
00:21:40,170 --> 00:21:42,403
So huge, huge, thanks to them.

485
00:21:44,242 --> 00:21:49,030
If you're ever in a spot of
questions, give them a call.

486
00:21:49,030 --> 00:21:51,020
So thank you for coming to this talk.

487
00:21:51,020 --> 00:21:53,340
If you have any questions,
anything I missed,

488
00:21:53,340 --> 00:21:55,430
please feel free to reach out to me.

489
00:21:55,430 --> 00:22:00,190
For projects and hobby contacts,
Joseph@begaydocrime.com.

490
00:22:00,190 --> 00:22:05,130
For any professional
inquiries, Joseph@tethys.cc.

491
00:22:05,130 --> 00:22:08,040
You can check me out on
Twitter, I'm @stoppingcart.

492
00:22:08,040 --> 00:22:09,240
Real pleased with that.

493
00:22:09,240 --> 00:22:14,240
I post yearly thereabouts
so follow me if you want.

494
00:22:14,590 --> 00:22:16,830
And any files I'm able to share

495
00:22:16,830 --> 00:22:20,900
will be up on begaydocrime.com/carts.

496
00:22:20,900 --> 00:22:21,800
Thanks for coming.

