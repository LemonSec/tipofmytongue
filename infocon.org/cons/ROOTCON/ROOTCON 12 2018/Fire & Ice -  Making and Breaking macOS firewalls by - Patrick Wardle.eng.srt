1
00:00:00,030 --> 00:00:08,428
<font color="#CCCCCC">all right Aloha and welcome to my talk</font>

2
00:00:03,210 --> 00:00:13,230
on meeting and breaking<font color="#CCCCCC"> Mack</font><font color="#E5E5E5"> Clarence it</font>

3
00:00:08,429 --> 00:00:16,680
is Patrick<font color="#E5E5E5"> world</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> work at</font><font color="#CCCCCC"> a macaron</font>

4
00:00:13,230 --> 00:00:19,800
places<font color="#CCCCCC"> I am the chief research officer</font>

5
00:00:16,680 --> 00:00:22,050
<font color="#E5E5E5">at did you know the security every</font>

6
00:00:19,800 --> 00:00:25,019
<font color="#CCCCCC">brinkley each the security we are</font>

7
00:00:22,050 --> 00:00:28,859
<font color="#CCCCCC">working to create cyber security tools</font>

8
00:00:25,019 --> 00:00:31,948
for the back<font color="#E5E5E5"> near bus</font><font color="#CCCCCC"> i also a creator</font>

9
00:00:28,859 --> 00:00:36,690
of the security website<font color="#E5E5E5"> and in tool</font>

10
00:00:31,949 --> 00:00:39,600
suite<font color="#CCCCCC"> objectives e ok so today we're</font>

11
00:00:36,690 --> 00:00:43,339
going to be talking about<font color="#CCCCCC"> first creating</font>

12
00:00:39,600 --> 00:00:47,129
and then breaking firewalls on<font color="#E5E5E5"> manulis</font>

13
00:00:43,340 --> 00:00:59,430
now in terms of creating firewalls

14
00:00:47,129 --> 00:01:02,968
we'll look at<font color="#E5E5E5"> a white black or</font><font color="#CCCCCC"> grey</font><font color="#E5E5E5"> and</font>

15
00:00:59,430 --> 00:01:08,840
we'll talk about<font color="#E5E5E5"> bugs and bypasses in</font>

16
00:01:02,969 --> 00:01:14,700
all<font color="#CCCCCC"> third party</font><font color="#E5E5E5"> mac box</font><font color="#CCCCCC"> okay so imagine</font>

17
00:01:08,840 --> 00:01:17,400
you decide<font color="#CCCCCC"> hey in this section</font><font color="#E5E5E5"> of the</font>

18
00:01:14,700 --> 00:01:19,650
talk we will articulate<font color="#E5E5E5"> or describe</font>

19
00:01:17,400 --> 00:01:23,310
exactly how<font color="#E5E5E5"> you would go about doing</font>

20
00:01:19,650 --> 00:01:25,250
<font color="#E5E5E5">this now there are many reasons you</font>

21
00:01:23,310 --> 00:01:27,689
<font color="#E5E5E5">might want</font><font color="#CCCCCC"> to create the</font><font color="#E5E5E5"> firewall</font><font color="#CCCCCC"> for</font>

22
00:01:25,250 --> 00:01:30,540
<font color="#E5E5E5">max today we're going to be more</font>

23
00:01:27,689 --> 00:01:33,960
focusing<font color="#E5E5E5"> on firewalls</font><font color="#CCCCCC"> as a cyber</font>

24
00:01:30,540 --> 00:01:38,490
security<font color="#E5E5E5"> mechanism versus say apprentice</font>

25
00:01:33,960 --> 00:01:42,089
<font color="#E5E5E5">america so our goal</font><font color="#CCCCCC"> therefore</font><font color="#E5E5E5"> then is to</font>

26
00:01:38,490 --> 00:01:44,130
<font color="#E5E5E5">be able to monitor all members and with</font>

27
00:01:42,090 --> 00:01:46,950
the ability<font color="#CCCCCC"> to</font><font color="#E5E5E5"> monitor all network</font>

28
00:01:44,130 --> 00:01:51,649
traffic<font color="#E5E5E5"> we want to be able to allow</font>

29
00:01:46,950 --> 00:01:51,649
traffic<font color="#E5E5E5"> that is trusted or legitimate</font>

30
00:01:52,399 --> 00:01:59,040
and then for any traffic<font color="#E5E5E5"> that is</font>

31
00:01:56,119 --> 00:02:01,619
something<font color="#E5E5E5"> actually don't recognize or</font>

32
00:01:59,040 --> 00:02:04,979
track that is from a malicious<font color="#E5E5E5"> process</font>

33
00:02:01,619 --> 00:02:06,930
we want<font color="#E5E5E5"> to obviously water and then</font>

34
00:02:04,979 --> 00:02:08,649
armed with<font color="#E5E5E5"> this capability that is being</font>

35
00:02:06,930 --> 00:02:12,140
<font color="#E5E5E5">able to monitor</font>

36
00:02:08,649 --> 00:02:15,230
we should be able<font color="#CCCCCC"> to in theory</font><font color="#E5E5E5"> detect</font>

37
00:02:12,140 --> 00:02:17,659
generically most<font color="#E5E5E5"> infections so imagine</font>

38
00:02:15,230 --> 00:02:19,819
an attacker has somehow<font color="#E5E5E5"> gained code</font>

39
00:02:17,659 --> 00:02:22,909
execution on your<font color="#E5E5E5"> Maxis perhaps he</font><font color="#CCCCCC"> even</font>

40
00:02:19,819 --> 00:02:25,548
have a<font color="#E5E5E5"> zero beta or the relevant and</font>

41
00:02:22,909 --> 00:02:28,819
they've been<font color="#E5E5E5"> able to persistently</font>

42
00:02:25,549 --> 00:02:32,150
install something<font color="#CCCCCC"> when that</font><font color="#E5E5E5"> persistent</font>

43
00:02:28,819 --> 00:02:35,149
back<font color="#E5E5E5"> order implant wakes up and tries to</font>

44
00:02:32,150 --> 00:02:37,879
<font color="#E5E5E5">connect to its command control servers</font>

45
00:02:35,150 --> 00:02:40,819
<font color="#E5E5E5">masking or perhaps tries to exfiltrate</font>

46
00:02:37,879 --> 00:02:43,489
<font color="#E5E5E5">data this will obviously generate time</font>

47
00:02:40,819 --> 00:02:45,379
and if you have a firewall<font color="#E5E5E5"> and so on</font>

48
00:02:43,489 --> 00:02:47,780
your system<font color="#E5E5E5"> that's monitoring all</font>

49
00:02:45,379 --> 00:02:50,720
traffic<font color="#E5E5E5"> it will be able to generically</font>

50
00:02:47,780 --> 00:02:53,180
<font color="#CCCCCC">be title this</font><font color="#E5E5E5"> is new untrusted traffic</font>

51
00:02:50,720 --> 00:02:53,659
<font color="#E5E5E5">and</font><font color="#CCCCCC"> thus alertly</font><font color="#E5E5E5"> that something's</font><font color="#CCCCCC"> going</font>

52
00:02:53,180 --> 00:02:55,519
on

53
00:02:53,659 --> 00:02:57,679
so<font color="#E5E5E5"> very easy to see that</font><font color="#CCCCCC"> these firewalls</font>

54
00:02:55,519 --> 00:03:00,349
are actually a<font color="#E5E5E5"> very powerful protection</font>

55
00:02:57,680 --> 00:03:04,239
mechanisms that can generically detect

56
00:03:00,349 --> 00:03:07,310
and cover even<font color="#E5E5E5"> brand new memory</font><font color="#CCCCCC"> drugs</font>

57
00:03:04,239 --> 00:03:09,590
now since we want to<font color="#E5E5E5"> be</font><font color="#CCCCCC"> able to monitor</font>

58
00:03:07,310 --> 00:03:12,079
<font color="#CCCCCC">all traffic</font><font color="#E5E5E5"> globally and you're going to</font>

59
00:03:09,590 --> 00:03:15,889
<font color="#E5E5E5">have to write a kernel extension read</font>

60
00:03:12,079 --> 00:03:19,729
text in Mac OS apple provides<font color="#E5E5E5"> something</font>

61
00:03:15,889 --> 00:03:23,479
called<font color="#CCCCCC"> Network</font><font color="#E5E5E5"> curly extensions or</font><font color="#CCCCCC"> NK DS</font>

62
00:03:19,729 --> 00:03:26,389
and they provide a way<font color="#CCCCCC"> to extend</font><font color="#E5E5E5"> or</font>

63
00:03:23,479 --> 00:03:30,579
modify the<font color="#E5E5E5"> network</font><font color="#CCCCCC"> infrastructure</font><font color="#E5E5E5"> in</font>

64
00:03:26,389 --> 00:03:34,729
turn and one type of<font color="#CCCCCC"> enemy is a socket</font>

65
00:03:30,579 --> 00:03:38,780
<font color="#E5E5E5">and which as its name implies allows you</font>

66
00:03:34,729 --> 00:03:44,440
to filter never<font color="#CCCCCC"> timing max I wish for</font>

67
00:03:38,780 --> 00:03:47,569
<font color="#E5E5E5">firewall is exactly</font><font color="#CCCCCC"> one now in order</font><font color="#E5E5E5"> to</font>

68
00:03:44,440 --> 00:03:50,389
<font color="#E5E5E5">filter network traffic via a psychic</font>

69
00:03:47,569 --> 00:03:52,399
filter will describe the steps<font color="#E5E5E5"> taken to</font>

70
00:03:50,389 --> 00:03:55,489
<font color="#CCCCCC">accomplish and the first thing you have</font>

71
00:03:52,400 --> 00:03:59,000
<font color="#CCCCCC">to</font><font color="#E5E5E5"> do is register your sake culture with</font>

72
00:03:55,489 --> 00:04:03,799
us<font color="#E5E5E5"> now there's this great book called</font><font color="#CCCCCC"> OS</font>

73
00:03:59,000 --> 00:04:06,139
X and iOS<font color="#CCCCCC"> kernel and it describes many</font>

74
00:04:03,799 --> 00:04:07,759
ways for<font color="#E5E5E5"> many types of activities you</font>

75
00:04:06,139 --> 00:04:12,680
<font color="#E5E5E5">want to do in the kernel one of them is</font>

76
00:04:07,759 --> 00:04:14,238
a brief chapter<font color="#E5E5E5"> on creating a combo so</font>

77
00:04:12,680 --> 00:04:17,719
everything described<font color="#E5E5E5"> in a book the</font><font color="#CCCCCC"> first</font>

78
00:04:14,239 --> 00:04:18,470
<font color="#E5E5E5">thing you should do when registering a</font>

79
00:04:17,719 --> 00:04:20,839
<font color="#E5E5E5">socket</font>

80
00:04:18,470 --> 00:04:23,090
filter currently<font color="#E5E5E5"> expansion is to fill</font>

81
00:04:20,839 --> 00:04:25,010
<font color="#E5E5E5">out something called a socket filter</font>

82
00:04:23,090 --> 00:04:27,739
destruction<font color="#E5E5E5"> we have the definitions for</font>

83
00:04:25,010 --> 00:04:30,530
<font color="#E5E5E5">this structure on this slide we can see</font>

84
00:04:27,740 --> 00:04:33,380
that<font color="#E5E5E5"> the structure has various callbacks</font>

85
00:04:30,530 --> 00:04:35,929
<font color="#E5E5E5">and when you populate these callbacks</font>

86
00:04:33,380 --> 00:04:39,080
and register the structure<font color="#CCCCCC"> anytime a</font>

87
00:04:35,930 --> 00:04:41,450
<font color="#E5E5E5">socket operation hers</font><font color="#CCCCCC"> you're all backs</font>

88
00:04:39,080 --> 00:04:44,750
will be votes<font color="#E5E5E5"> allowing universe to</font>

89
00:04:41,450 --> 00:04:47,000
examined the operation<font color="#E5E5E5"> so for example</font>

90
00:04:44,750 --> 00:04:49,190
when a new<font color="#E5E5E5"> socket is created when data</font>

91
00:04:47,000 --> 00:04:51,790
<font color="#E5E5E5">is sent recede again the operating</font>

92
00:04:49,190 --> 00:04:54,410
system will<font color="#E5E5E5"> in</font><font color="#CCCCCC"> no clear</font><font color="#E5E5E5"> context</font>

93
00:04:51,790 --> 00:04:57,470
so once you've ovulated this socket

94
00:04:54,410 --> 00:04:59,960
filter you invoke the<font color="#E5E5E5"> SFL TV underscore</font>

95
00:04:57,470 --> 00:05:03,200
<font color="#CCCCCC">register function and this will register</font>

96
00:04:59,960 --> 00:05:05,900
<font color="#E5E5E5">or install your socket filter kernel in</font>

97
00:05:03,200 --> 00:05:07,880
session<font color="#E5E5E5"> now besides that populated in</font>

98
00:05:05,900 --> 00:05:10,250
socket filter<font color="#E5E5E5"> structure that we just</font>

99
00:05:07,880 --> 00:05:13,700
talked about this<font color="#E5E5E5"> function also takes</font>

100
00:05:10,250 --> 00:05:15,680
the socket domain type input so this

101
00:05:13,700 --> 00:05:18,440
means if<font color="#CCCCCC"> you want to monitor various</font>

102
00:05:15,680 --> 00:05:20,930
socket types you<font color="#CCCCCC"> have to invoke this</font>

103
00:05:18,440 --> 00:05:22,730
function<font color="#E5E5E5"> multiple times so for example</font>

104
00:05:20,930 --> 00:05:25,850
if you want<font color="#E5E5E5"> to monitor to CP and you</font>

105
00:05:22,730 --> 00:05:27,440
need to call this function twice for

106
00:05:25,850 --> 00:05:29,930
that<font color="#E5E5E5"> and</font><font color="#CCCCCC"> also if you want to do for</font>

107
00:05:27,440 --> 00:05:32,830
<font color="#CCCCCC">example monitor both ipv4</font><font color="#E5E5E5"> and ipv6</font>

108
00:05:29,930 --> 00:05:36,020
traffic<font color="#E5E5E5"> you have to invoke this function</font>

109
00:05:32,830 --> 00:05:40,130
for each<font color="#CCCCCC"> of those soft at the main title</font>

110
00:05:36,020 --> 00:05:42,740
and performers<font color="#CCCCCC"> alright so now let's</font><font color="#E5E5E5"> talk</font>

111
00:05:40,130 --> 00:05:44,510
<font color="#E5E5E5">briefly about those callbacks which as I</font>

112
00:05:42,740 --> 00:05:47,530
<font color="#CCCCCC">noted the</font><font color="#E5E5E5"> operating system will invoke</font>

113
00:05:44,510 --> 00:05:51,409
<font color="#CCCCCC">any</font><font color="#E5E5E5"> time</font><font color="#CCCCCC"> the socket operation centers</font>

114
00:05:47,530 --> 00:05:53,960
<font color="#CCCCCC">first</font><font color="#E5E5E5"> we have me attachment and as we</font>

115
00:05:51,410 --> 00:05:56,810
can<font color="#CCCCCC"> see on the slide that statement says</font>

116
00:05:53,960 --> 00:06:00,710
this will be automatically invoked<font color="#E5E5E5"> any</font>

117
00:05:56,810 --> 00:06:02,390
<font color="#E5E5E5">time a new socket is being created and</font>

118
00:06:00,710 --> 00:06:05,870
it's called<font color="#E5E5E5"> with the socket and then</font>

119
00:06:02,390 --> 00:06:09,380
also a cookie<font color="#E5E5E5"> runner that's designed</font><font color="#CCCCCC"> to</font>

120
00:06:05,870 --> 00:06:11,390
hold her socket<font color="#E5E5E5"> data so you can store</font>

121
00:06:09,380 --> 00:06:13,730
anything<font color="#E5E5E5"> anyone it's basically just a</font>

122
00:06:11,390 --> 00:06:15,740
parameter<font color="#E5E5E5"> for your firewall or for your</font>

123
00:06:13,730 --> 00:06:18,169
<font color="#E5E5E5">pull back to store perhaps the</font>

124
00:06:15,740 --> 00:06:20,240
information about<font color="#E5E5E5"> the slider so</font><font color="#CCCCCC"> what we</font>

125
00:06:18,169 --> 00:06:21,799
do is we allocate<font color="#CCCCCC"> a chunk of</font><font color="#E5E5E5"> memory and</font>

126
00:06:20,240 --> 00:06:24,919
<font color="#E5E5E5">we store and</font>

127
00:06:21,800 --> 00:06:28,009
based on the<font color="#CCCCCC"> hit of the</font><font color="#E5E5E5"> process</font><font color="#CCCCCC"> if we've</font>

128
00:06:24,919 --> 00:06:30,889
seen that<font color="#CCCCCC"> process before</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> there's a</font>

129
00:06:28,009 --> 00:06:33,830
trusted system<font color="#E5E5E5"> process perhaps the DNS</font>

130
00:06:30,889 --> 00:06:36,500
demon or some software update component

131
00:06:33,830 --> 00:06:40,068
of the operating system<font color="#E5E5E5"> we will set this</font>

132
00:06:36,500 --> 00:06:42,620
to<font color="#CCCCCC"> lack if it's also something that the</font>

133
00:06:40,069 --> 00:06:44,539
user has indicated should be allowed<font color="#E5E5E5"> for</font>

134
00:06:42,620 --> 00:06:46,280
example their browser or<font color="#CCCCCC"> a chat</font>

135
00:06:44,539 --> 00:06:48,500
<font color="#CCCCCC">application which is authorized to</font>

136
00:06:46,280 --> 00:06:50,299
access the network similar to reset the

137
00:06:48,500 --> 00:06:53,090
action in this<font color="#CCCCCC"> cookie Brown her to be</font>

138
00:06:50,300 --> 00:06:56,740
allowed as well now that<font color="#E5E5E5"> something the</font>

139
00:06:53,090 --> 00:06:58,940
user has said to block<font color="#E5E5E5"> perhaps it's some</font>

140
00:06:56,740 --> 00:07:01,669
<font color="#CCCCCC">Adobe process that they don't want</font>

141
00:06:58,940 --> 00:07:04,099
<font color="#E5E5E5">talking to the internet or some other</font>

142
00:07:01,669 --> 00:07:07,159
<font color="#CCCCCC">third-party active you don't</font><font color="#E5E5E5"> talking to</font>

143
00:07:04,099 --> 00:07:10,430
the developers<font color="#CCCCCC"> cloud</font><font color="#E5E5E5"> we will set the</font>

144
00:07:07,159 --> 00:07:11,990
<font color="#E5E5E5">action to</font><font color="#CCCCCC"> to block and</font><font color="#E5E5E5"> finally it's a</font>

145
00:07:10,430 --> 00:07:14,599
new process<font color="#E5E5E5"> it's something you've never</font>

146
00:07:11,990 --> 00:07:19,879
seen<font color="#E5E5E5"> before</font><font color="#CCCCCC"> we will set</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> action flag</font>

147
00:07:14,599 --> 00:07:21,830
to<font color="#CCCCCC"> ask alright next we have the next up</font>

148
00:07:19,879 --> 00:07:24,110
<font color="#CCCCCC">pull back which is invoked</font><font color="#E5E5E5"> by the</font>

149
00:07:21,830 --> 00:07:26,960
operating system<font color="#CCCCCC"> when a socket</font><font color="#E5E5E5"> attempts</font>

150
00:07:24,110 --> 00:07:28,669
to connect<font color="#E5E5E5"> out and send data this</font>

151
00:07:26,960 --> 00:07:30,919
function<font color="#E5E5E5"> takes that same cookie</font>

152
00:07:28,669 --> 00:07:34,370
parameter which we have set an action

153
00:07:30,919 --> 00:07:37,039
<font color="#E5E5E5">with and in this section we can</font><font color="#CCCCCC"> see if</font>

154
00:07:34,370 --> 00:07:39,710
you've<font color="#E5E5E5"> decided to a lot block or to pass</font>

155
00:07:37,039 --> 00:07:41,960
<font color="#E5E5E5">music so if the</font><font color="#CCCCCC"> action is been sent to</font>

156
00:07:39,710 --> 00:07:43,758
<font color="#CCCCCC">allow this means this network connection</font>

157
00:07:41,960 --> 00:07:46,789
is authorized<font color="#E5E5E5"> there should be allowed</font>

158
00:07:43,759 --> 00:07:48,830
<font color="#CCCCCC">you just</font><font color="#E5E5E5"> returned and</font><font color="#CCCCCC"> okay status from</font>

159
00:07:46,789 --> 00:07:51,259
this<font color="#E5E5E5"> function which is not the operating</font>

160
00:07:48,830 --> 00:07:54,770
system<font color="#CCCCCC"> that yes you're okay allowing</font>

161
00:07:51,259 --> 00:07:57,409
this network connection to receive now

162
00:07:54,770 --> 00:08:00,560
this is<font color="#CCCCCC"> a socket connection we want to</font>

163
00:07:57,409 --> 00:08:02,599
block we return an error code from this

164
00:08:00,560 --> 00:08:04,610
function<font color="#E5E5E5"> and this tells the operating</font>

165
00:08:02,599 --> 00:08:07,340
system that<font color="#CCCCCC"> this</font><font color="#E5E5E5"> network connection</font>

166
00:08:04,610 --> 00:08:09,289
should not be allowed and since we are

167
00:08:07,340 --> 00:08:12,349
<font color="#E5E5E5">returning in error</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> operating system</font>

168
00:08:09,289 --> 00:08:14,180
will drop or block back dimension and

169
00:08:12,349 --> 00:08:15,560
again if it's a newer<font color="#E5E5E5"> aluminum or</font><font color="#CCCCCC"> also</font>

170
00:08:14,180 --> 00:08:18,740
<font color="#E5E5E5">us we're gonna have</font><font color="#CCCCCC"> to do something</font>

171
00:08:15,560 --> 00:08:22,669
<font color="#CCCCCC">extra logic</font><font color="#E5E5E5"> to basically ask the user in</font>

172
00:08:18,740 --> 00:08:24,860
user mode what<font color="#E5E5E5"> they'd like to do so if</font>

173
00:08:22,669 --> 00:08:27,109
we don't<font color="#E5E5E5"> recognize the pit it's a new</font>

174
00:08:24,860 --> 00:08:29,960
process as I mentioned you have to ask

175
00:08:27,110 --> 00:08:31,959
<font color="#E5E5E5">the user to figure out what actions so</font>

176
00:08:29,960 --> 00:08:35,718
in the kernel we put the

177
00:08:31,959 --> 00:08:39,349
and then we ask a user mode daemon to

178
00:08:35,719 --> 00:08:42,229
handle this<font color="#E5E5E5"> request and we</font><font color="#CCCCCC"> notice by</font>

179
00:08:39,349 --> 00:08:45,560
pushing information<font color="#CCCCCC"> about the connection</font>

180
00:08:42,229 --> 00:08:49,490
to<font color="#CCCCCC"> a sheriff you specifically we passed</font>

181
00:08:45,560 --> 00:08:52,849
the<font color="#CCCCCC"> hint the socket and the addresses</font>

182
00:08:49,490 --> 00:08:54,829
trying to connect<font color="#CCCCCC"> state</font><font color="#E5E5E5"> so the daemon is</font>

183
00:08:52,850 --> 00:08:57,170
listening on<font color="#E5E5E5"> this year</font><font color="#CCCCCC"> Q gets</font><font color="#E5E5E5"> this</font>

184
00:08:54,829 --> 00:08:59,029
<font color="#E5E5E5">request from the car let's mention from</font>

185
00:08:57,170 --> 00:09:00,410
Pearl<font color="#E5E5E5"> mother basically saying hey I have</font>

186
00:08:59,029 --> 00:09:00,769
a connection<font color="#E5E5E5"> I'm not sure what to do</font>

187
00:09:00,410 --> 00:09:03,949
<font color="#CCCCCC">about it</font>

188
00:09:00,769 --> 00:09:05,360
please<font color="#E5E5E5"> let me decide what to</font><font color="#CCCCCC"> do so the</font>

189
00:09:03,949 --> 00:09:08,569
<font color="#E5E5E5">first thing the daemon does that</font>

190
00:09:05,360 --> 00:09:11,899
max-heap into a process path and checks

191
00:09:08,569 --> 00:09:14,180
if<font color="#CCCCCC"> the process path exists in its rule</font>

192
00:09:11,899 --> 00:09:17,060
<font color="#E5E5E5">pages for example this might be an</font>

193
00:09:14,180 --> 00:09:19,939
application<font color="#E5E5E5"> that's been reauthorized</font><font color="#CCCCCC"> but</font>

194
00:09:17,060 --> 00:09:21,680
it's just the first<font color="#E5E5E5"> time it's</font><font color="#CCCCCC"> wrong</font><font color="#E5E5E5"> if</font>

195
00:09:19,940 --> 00:09:24,350
it's found it responds with<font color="#E5E5E5"> the action</font>

196
00:09:21,680 --> 00:09:26,660
back to the<font color="#CCCCCC"> corral</font><font color="#E5E5E5"> however if it's a</font>

197
00:09:24,350 --> 00:09:29,180
path of an<font color="#E5E5E5"> application</font><font color="#CCCCCC"> that Gaiman</font><font color="#E5E5E5"> is</font>

198
00:09:26,660 --> 00:09:32,060
never seen before<font color="#E5E5E5"> it's going to have to</font>

199
00:09:29,180 --> 00:09:34,819
ask<font color="#CCCCCC"> easy so what it</font><font color="#E5E5E5"> does is it sends an</font>

200
00:09:32,060 --> 00:09:37,399
<font color="#CCCCCC">X BC message to an instance of a</font>

201
00:09:34,819 --> 00:09:40,310
firewall<font color="#E5E5E5"> that's running in the</font><font color="#CCCCCC"> users UI</font>

202
00:09:37,399 --> 00:09:43,459
session which will<font color="#E5E5E5"> then display an alert</font>

203
00:09:40,310 --> 00:09:46,880
to the<font color="#CCCCCC"> user asking the user what they</font>

204
00:09:43,459 --> 00:09:49,670
would like to the users response which

205
00:09:46,880 --> 00:09:51,769
we allow or what is then passed back<font color="#E5E5E5"> to</font>

206
00:09:49,670 --> 00:09:54,110
<font color="#E5E5E5">the daemon the daemon will update its</font>

207
00:09:51,769 --> 00:09:56,300
rules of<font color="#E5E5E5"> database to save the users were</font>

208
00:09:54,110 --> 00:09:59,000
songs and then it will respond back to

209
00:09:56,300 --> 00:10:01,969
<font color="#CCCCCC">the kernel extension via</font><font color="#E5E5E5"> an i/o kit</font>

210
00:09:59,000 --> 00:10:04,670
interface the kernel will then get this

211
00:10:01,970 --> 00:10:05,870
<font color="#E5E5E5">message it will wake up the thread and</font>

212
00:10:04,670 --> 00:10:07,910
it put to sleep

213
00:10:05,870 --> 00:10:10,009
that was attempting to<font color="#E5E5E5"> perform the</font>

214
00:10:07,910 --> 00:10:13,279
network connection<font color="#CCCCCC"> and we'll apply the</font>

215
00:10:10,009 --> 00:10:15,019
<font color="#E5E5E5">users response if the</font><font color="#CCCCCC"> user said</font><font color="#E5E5E5"> aloud</font><font color="#CCCCCC"> we</font>

216
00:10:13,279 --> 00:10:17,000
<font color="#E5E5E5">just returned</font><font color="#CCCCCC"> okay which tells the</font>

217
00:10:15,019 --> 00:10:18,800
operating system to allow the<font color="#E5E5E5"> network</font>

218
00:10:17,000 --> 00:10:20,509
connection otherwise and the<font color="#CCCCCC"> users</font>

219
00:10:18,800 --> 00:10:22,519
<font color="#CCCCCC">ascetic block it returns an error</font>

220
00:10:20,509 --> 00:10:24,560
message from the callback which tells

221
00:10:22,519 --> 00:10:28,220
the<font color="#E5E5E5"> operating system</font><font color="#CCCCCC"> to block</font><font color="#E5E5E5"> and drop</font>

222
00:10:24,560 --> 00:10:30,138
the connection so let's briefly take a

223
00:10:28,220 --> 00:10:33,319
closer<font color="#CCCCCC"> look at identifying or</font>

224
00:10:30,139 --> 00:10:35,509
classifying<font color="#E5E5E5"> processes so recall that the</font>

225
00:10:33,319 --> 00:10:36,569
kernel<font color="#E5E5E5"> extension has intercepted a</font>

226
00:10:35,509 --> 00:10:38,700
socket operation

227
00:10:36,570 --> 00:10:41,100
for example a new socket is trying to

228
00:10:38,700 --> 00:10:43,200
connect out to some server<font color="#E5E5E5"> and</font>

229
00:10:41,100 --> 00:10:45,630
specifically<font color="#E5E5E5"> when this operating system</font>

230
00:10:43,200 --> 00:10:49,560
<font color="#E5E5E5">when the operating system invokes this</font>

231
00:10:45,630 --> 00:10:52,950
callback<font color="#E5E5E5"> it will call the this callback</font>

232
00:10:49,560 --> 00:10:55,229
will occur in<font color="#CCCCCC"> the process context of the</font>

233
00:10:52,950 --> 00:10:57,570
process<font color="#E5E5E5"> that's trying to create this</font>

234
00:10:55,230 --> 00:10:59,760
augmentation<font color="#CCCCCC"> so the</font><font color="#E5E5E5"> browser and the</font>

235
00:10:57,570 --> 00:11:02,040
callback will occur in kernel mode<font color="#E5E5E5"> but</font>

236
00:10:59,760 --> 00:11:03,150
in the process cloth context of the

237
00:11:02,040 --> 00:11:05,250
browser process

238
00:11:03,150 --> 00:11:08,280
this means we can<font color="#E5E5E5"> call the rock</font>

239
00:11:05,250 --> 00:11:12,210
underscore self in function which will

240
00:11:08,280 --> 00:11:13,620
give us<font color="#E5E5E5"> the</font><font color="#CCCCCC"> actual hitter process</font><font color="#E5E5E5"> so as</font>

241
00:11:12,210 --> 00:11:16,170
I know that<font color="#CCCCCC"> we pass</font><font color="#E5E5E5"> this the user mode</font>

242
00:11:13,620 --> 00:11:19,980
the incredible<font color="#E5E5E5"> meta</font><font color="#CCCCCC"> that the launch</font>

243
00:11:16,170 --> 00:11:22,439
gaming will map this to path<font color="#CCCCCC"> and then</font><font color="#E5E5E5"> it</font>

244
00:11:19,980 --> 00:11:25,320
will<font color="#E5E5E5"> also</font><font color="#CCCCCC"> generate the</font><font color="#E5E5E5"> code signing</font>

245
00:11:22,440 --> 00:11:27,720
<font color="#CCCCCC">information for this process because in</font>

246
00:11:25,320 --> 00:11:31,290
the rules database<font color="#E5E5E5"> what it stores is a</font>

247
00:11:27,720 --> 00:11:33,750
path to<font color="#CCCCCC"> the</font><font color="#E5E5E5"> process an action that is if</font>

248
00:11:31,290 --> 00:11:35,189
it's allowed or should<font color="#CCCCCC"> be denied and</font>

249
00:11:33,750 --> 00:11:37,860
then<font color="#E5E5E5"> I'm also</font><font color="#CCCCCC"> the code signing</font>

250
00:11:35,190 --> 00:11:40,770
<font color="#CCCCCC">information about this process</font><font color="#E5E5E5"> this is</font>

251
00:11:37,860 --> 00:11:43,110
to prevent malicious<font color="#E5E5E5"> subversion of trust</font>

252
00:11:40,770 --> 00:11:45,720
<font color="#E5E5E5">and applications so for example say the</font>

253
00:11:43,110 --> 00:11:48,690
user has trusted<font color="#E5E5E5"> their chat application</font>

254
00:11:45,720 --> 00:11:51,990
if a<font color="#E5E5E5"> malicious the piece of code tries</font>

255
00:11:48,690 --> 00:11:54,120
to modify<font color="#E5E5E5"> the chat application when the</font>

256
00:11:51,990 --> 00:11:55,920
<font color="#CCCCCC">daemon recomputes the</font><font color="#E5E5E5"> co-signing</font>

257
00:11:54,120 --> 00:11:58,380
information it will detect<font color="#CCCCCC"> its being a</font>

258
00:11:55,920 --> 00:12:02,849
malicious modification and thus not

259
00:11:58,380 --> 00:12:06,030
<font color="#CCCCCC">likely allow the application the other</font>

260
00:12:02,850 --> 00:12:09,450
feature that<font color="#CCCCCC"> a firewall has is that for</font>

261
00:12:06,030 --> 00:12:12,329
any<font color="#CCCCCC"> Network event that occurs in kernel</font>

262
00:12:09,450 --> 00:12:15,330
mode it will broadcast<font color="#E5E5E5"> this to user mode</font>

263
00:12:12,330 --> 00:12:18,300
via made system socket<font color="#E5E5E5"> and it does this</font>

264
00:12:15,330 --> 00:12:21,020
to allow<font color="#E5E5E5"> a third party code or any user</font>

265
00:12:18,300 --> 00:12:24,569
mode code to subscribe to these<font color="#E5E5E5"> effects</font>

266
00:12:21,020 --> 00:12:26,579
so it doesn't broadcast<font color="#E5E5E5"> the</font><font color="#CCCCCC"> pic</font>

267
00:12:24,570 --> 00:12:29,220
the socket and the address<font color="#CCCCCC"> that</font><font color="#E5E5E5"> the</font>

268
00:12:26,580 --> 00:12:31,560
socket is trying to connect so say you

269
00:12:29,220 --> 00:12:33,870
want<font color="#E5E5E5"> to write a in a</font><font color="#CCCCCC"> quarter what</font><font color="#E5E5E5"> you</font>

270
00:12:31,560 --> 00:12:35,729
can do now is<font color="#CCCCCC"> very</font><font color="#E5E5E5"> very easily just</font>

271
00:12:33,870 --> 00:12:39,329
<font color="#E5E5E5">connect</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> this</font>

272
00:12:35,730 --> 00:12:41,850
the socket and read a lot and<font color="#E5E5E5"> as Network</font>

273
00:12:39,329 --> 00:12:44,430
events happen in the<font color="#E5E5E5"> kernel</font><font color="#CCCCCC"> these will</font>

274
00:12:41,850 --> 00:12:46,529
be<font color="#E5E5E5"> detected and broadcasted to so we can</font>

275
00:12:44,430 --> 00:12:49,529
see in a few<font color="#CCCCCC"> lines of code</font><font color="#E5E5E5"> on the slide</font>

276
00:12:46,529 --> 00:12:53,490
<font color="#E5E5E5">you basically connect to that instance</font>

277
00:12:49,529 --> 00:12:56,160
of the system socket<font color="#E5E5E5"> and then read off</font>

278
00:12:53,490 --> 00:12:58,649
so again very easy<font color="#CCCCCC"> for example to build</font>

279
00:12:56,160 --> 00:13:01,589
<font color="#E5E5E5">a network monitor or perhaps if you have</font>

280
00:12:58,649 --> 00:13:04,250
your own or<font color="#E5E5E5"> third-party monitoring</font>

281
00:13:01,589 --> 00:13:07,170
system that's running in your motor

282
00:13:04,250 --> 00:13:11,790
activity very easily you can<font color="#CCCCCC"> do that by</font>

283
00:13:07,170 --> 00:13:15,209
means<font color="#CCCCCC"> of</font><font color="#E5E5E5"> our</font><font color="#CCCCCC"> interface alright so</font><font color="#E5E5E5"> we put</font>

284
00:13:11,790 --> 00:13:21,480
<font color="#CCCCCC">all of this together</font><font color="#E5E5E5"> we have Luke</font>

285
00:13:15,209 --> 00:13:23,250
so Lulu is believer that<font color="#E5E5E5"> for any</font><font color="#CCCCCC"> users</font>

286
00:13:21,480 --> 00:13:26,430
security<font color="#E5E5E5"> products we should not be</font>

287
00:13:23,250 --> 00:13:28,829
making<font color="#CCCCCC"> our users employees and also this</font>

288
00:13:26,430 --> 00:13:31,620
full source code for this entire final

289
00:13:28,829 --> 00:13:34,560
<font color="#E5E5E5">product is</font><font color="#CCCCCC"> online again I'm a huge fan</font>

290
00:13:31,620 --> 00:13:37,769
<font color="#E5E5E5">especially first security tools that the</font>

291
00:13:34,560 --> 00:13:40,680
full source<font color="#CCCCCC"> code it's</font><font color="#E5E5E5"> very both for any</font>

292
00:13:37,769 --> 00:13:42,630
reasons or just<font color="#CCCCCC"> to see what's not right</font>

293
00:13:40,680 --> 00:13:44,849
you're installing someone's kernel

294
00:13:42,630 --> 00:13:45,860
extension I would hope that they're

295
00:13:44,850 --> 00:13:53,519
making<font color="#E5E5E5"> the source code available</font>

296
00:13:45,860 --> 00:13:57,029
otherwise<font color="#CCCCCC"> ok so this conference is</font>

297
00:13:53,519 --> 00:14:00,420
primarily a beautiful so let's kind of

298
00:13:57,029 --> 00:14:03,000
turn our attention to<font color="#E5E5E5"> the other point of</font>

299
00:14:00,420 --> 00:14:11,670
<font color="#CCCCCC">view</font><font color="#E5E5E5"> and talk</font><font color="#CCCCCC"> about how we can break</font>

300
00:14:03,000 --> 00:14:14,639
such<font color="#CCCCCC"> files so our goal is</font><font color="#E5E5E5"> maybe your</font>

301
00:14:11,670 --> 00:14:16,380
government employee doing offensive

302
00:14:14,639 --> 00:14:18,959
cyber operations<font color="#E5E5E5"> or perhaps</font><font color="#CCCCCC"> your even</font><font color="#E5E5E5"> a</font>

303
00:14:16,380 --> 00:14:22,139
cyber<font color="#E5E5E5"> criminal hopefully not but assume</font>

304
00:14:18,959 --> 00:14:24,209
you gain access to a Mac system that<font color="#CCCCCC"> has</font>

305
00:14:22,139 --> 00:14:27,180
<font color="#CCCCCC">the firewall</font><font color="#E5E5E5"> installed</font>

306
00:14:24,209 --> 00:14:30,300
obviously what<font color="#CCCCCC"> you want to be able</font><font color="#E5E5E5"> to do</font>

307
00:14:27,180 --> 00:14:32,310
is install some<font color="#CCCCCC"> backdoor or execute some</font>

308
00:14:30,300 --> 00:14:34,649
commands that will likely generate<font color="#CCCCCC"> an</font>

309
00:14:32,310 --> 00:14:35,239
<font color="#CCCCCC">Amber child maybe</font><font color="#E5E5E5"> exfiltrating some user</font>

310
00:14:34,649 --> 00:14:37,889
data

311
00:14:35,240 --> 00:14:40,800
perhaps connecting<font color="#E5E5E5"> to command and</font>

312
00:14:37,889 --> 00:14:44,030
<font color="#E5E5E5">control server first</font><font color="#CCCCCC"> game</font><font color="#E5E5E5"> unfortunately</font>

313
00:14:40,800 --> 00:14:48,050
<font color="#CCCCCC">if there is a</font><font color="#E5E5E5"> firewall installed will</font>

314
00:14:44,030 --> 00:14:50,900
this activity<font color="#CCCCCC"> and so again we</font><font color="#E5E5E5"> want you</font>

315
00:14:48,050 --> 00:14:52,819
to<font color="#E5E5E5"> figure out ways we can access the</font>

316
00:14:50,900 --> 00:14:55,610
network in ways that will not be

317
00:14:52,820 --> 00:14:59,840
detected<font color="#CCCCCC"> by</font><font color="#E5E5E5"> the firewall or at least</font>

318
00:14:55,610 --> 00:15:01,580
won't generate an alert to<font color="#E5E5E5"> use so in</font>

319
00:14:59,840 --> 00:15:04,670
this section<font color="#E5E5E5"> we'll first looking at some</font>

320
00:15:01,580 --> 00:15:06,680
existing<font color="#E5E5E5"> fire where a require well aware</font>

321
00:15:04,670 --> 00:15:11,000
<font color="#CCCCCC">in our</font><font color="#E5E5E5"> well then talk about some</font>

322
00:15:06,680 --> 00:15:13,400
exploitable issues in security proxy<font color="#E5E5E5"> and</font>

323
00:15:11,000 --> 00:15:16,630
firewalls<font color="#CCCCCC"> and then we'll talk about</font><font color="#E5E5E5"> how</font>

324
00:15:13,400 --> 00:15:19,220
<font color="#E5E5E5">to bypass these boxes</font>

325
00:15:16,630 --> 00:15:21,830
so as I<font color="#E5E5E5"> mentioned it's very important</font>

326
00:15:19,220 --> 00:15:24,380
<font color="#E5E5E5">for an attacker or piece</font><font color="#CCCCCC"> of malware to</font>

327
00:15:21,830 --> 00:15:26,420
detect that a firewall is installed

328
00:15:24,380 --> 00:15:29,510
<font color="#E5E5E5">otherwise it really might be their</font>

329
00:15:26,420 --> 00:15:32,420
undoing<font color="#E5E5E5"> as the firewall might be a piece</font>

330
00:15:29,510 --> 00:15:34,760
of<font color="#E5E5E5"> software that ultimately catches that</font>

331
00:15:32,420 --> 00:15:36,439
<font color="#CCCCCC">as you can see on</font><font color="#E5E5E5"> the slide this really</font>

332
00:15:34,760 --> 00:15:38,810
<font color="#E5E5E5">does</font><font color="#CCCCCC"> happen it was a written scenario</font>

333
00:15:36,440 --> 00:15:41,810
next volunteer<font color="#E5E5E5"> the red team was wildly</font>

334
00:15:38,810 --> 00:15:44,660
successful<font color="#CCCCCC"> right up until</font><font color="#E5E5E5"> firewall</font>

335
00:15:41,810 --> 00:15:46,369
<font color="#CCCCCC">particular tactic</font><font color="#E5E5E5"> and as we see in the</font>

336
00:15:44,660 --> 00:15:47,990
rest<font color="#E5E5E5"> of this talk</font><font color="#CCCCCC"> this really there's</font>

337
00:15:46,370 --> 00:15:50,630
really<font color="#E5E5E5"> no excuse for this these products</font>

338
00:15:47,990 --> 00:15:54,740
are fairly<font color="#E5E5E5"> easy to to bypass but you</font>

339
00:15:50,630 --> 00:15:56,840
have to be aware<font color="#E5E5E5"> so it turns out there</font>

340
00:15:54,740 --> 00:15:59,870
<font color="#CCCCCC">is some existing mat malware that</font><font color="#E5E5E5"> is</font>

341
00:15:56,840 --> 00:16:02,270
firewall aware and what I mean<font color="#E5E5E5"> by</font><font color="#CCCCCC"> that</font>

342
00:15:59,870 --> 00:16:04,880
is that<font color="#CCCCCC"> they will actually look for the</font>

343
00:16:02,270 --> 00:16:07,880
presence<font color="#CCCCCC"> of a firewall to</font><font color="#E5E5E5"> see if it is</font>

344
00:16:04,880 --> 00:16:10,100
<font color="#E5E5E5">installed now I've yet to see any public</font>

345
00:16:07,880 --> 00:16:13,160
Mac malware that would then try to

346
00:16:10,100 --> 00:16:14,690
actively bypass these firewalls

347
00:16:13,160 --> 00:16:17,120
but that's<font color="#E5E5E5"> something we'll likely see</font>

348
00:16:14,690 --> 00:16:20,510
the<font color="#E5E5E5"> near future after what this malware</font>

349
00:16:17,120 --> 00:16:23,750
<font color="#E5E5E5">does is look for</font><font color="#CCCCCC"> these viral products</font>

350
00:16:20,510 --> 00:16:25,880
and it detects them<font color="#E5E5E5"> basically says</font><font color="#CCCCCC"> ok I</font>

351
00:16:23,750 --> 00:16:28,220
know this<font color="#E5E5E5"> firewall product would alert</font>

352
00:16:25,880 --> 00:16:30,710
the<font color="#CCCCCC"> user</font><font color="#E5E5E5"> if I continue with</font><font color="#CCCCCC"> my</font>

353
00:16:28,220 --> 00:16:33,170
persistent installation<font color="#CCCCCC"> in connecting</font>

354
00:16:30,710 --> 00:16:35,000
for example to my command control<font color="#CCCCCC"> server</font>

355
00:16:33,170 --> 00:16:37,910
<font color="#E5E5E5">casting so I'm actually</font><font color="#CCCCCC"> going to</font><font color="#E5E5E5"> order</font>

356
00:16:35,000 --> 00:16:41,390
<font color="#CCCCCC">and not infect this system if there is a</font>

357
00:16:37,910 --> 00:16:43,819
<font color="#CCCCCC">firewall so the first example</font><font color="#E5E5E5"> this is</font>

358
00:16:41,390 --> 00:16:47,090
devil Walker and what devil<font color="#E5E5E5"> robber did</font>

359
00:16:43,820 --> 00:16:48,029
was it infected users via<font color="#E5E5E5"> a trojan eyes</font>

360
00:16:47,090 --> 00:16:50,189
instance

361
00:16:48,029 --> 00:16:53,519
the truth Twitter perfect<font color="#E5E5E5"> application</font>

362
00:16:50,189 --> 00:16:56,459
and I can<font color="#CCCCCC"> look at the install script</font><font color="#E5E5E5"> for</font>

363
00:16:53,519 --> 00:16:58,050
this<font color="#CCCCCC"> Trojan</font><font color="#E5E5E5"> from this back or we can see</font>

364
00:16:56,459 --> 00:17:00,029
that it's looking for<font color="#E5E5E5"> the presence of</font>

365
00:16:58,050 --> 00:17:04,049
Little Snitch<font color="#E5E5E5"> which is the most common</font>

366
00:17:00,029 --> 00:17:06,809
<font color="#E5E5E5">third party Mac firewall and if the</font>

367
00:17:04,049 --> 00:17:09,959
<font color="#E5E5E5">insult me malicious install script finds</font>

368
00:17:06,809 --> 00:17:10,770
<font color="#E5E5E5">the Little Snitch kernel extension</font>

369
00:17:09,959 --> 00:17:13,230
meaning that there's a firewall

370
00:17:10,770 --> 00:17:15,209
<font color="#E5E5E5">installed on the system we</font><font color="#CCCCCC"> can see the</font>

371
00:17:13,230 --> 00:17:18,030
malware<font color="#E5E5E5"> will do two</font><font color="#CCCCCC"> things first it</font>

372
00:17:15,209 --> 00:17:19,679
executes<font color="#CCCCCC"> the benign uninfected</font><font color="#E5E5E5"> instance</font>

373
00:17:18,030 --> 00:17:22,139
of the application<font color="#E5E5E5"> so</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> the user</font>

374
00:17:19,679 --> 00:17:24,959
doesn't<font color="#CCCCCC"> see anything amiss</font><font color="#E5E5E5"> but then it</font>

375
00:17:22,140 --> 00:17:27,750
will exist<font color="#E5E5E5"> so again the attacker the</font>

376
00:17:24,959 --> 00:17:31,130
matter<font color="#E5E5E5"> has decided to basically give up</font>

377
00:17:27,750 --> 00:17:34,559
on any<font color="#CCCCCC"> bosses that have a final</font><font color="#E5E5E5"> result</font>

378
00:17:31,130 --> 00:17:37,980
another more recent piece of Mac malware

379
00:17:34,559 --> 00:17:41,879
that<font color="#E5E5E5"> utilizes a similar technique is OS</font>

380
00:17:37,980 --> 00:17:43,320
X first we<font color="#CCCCCC"> reverse engineer the</font><font color="#E5E5E5"> battle</font>

381
00:17:41,880 --> 00:17:46,140
<font color="#CCCCCC">where we</font><font color="#E5E5E5"> can find an encrypted</font>

382
00:17:43,320 --> 00:17:49,439
configurations model if we decrypt this

383
00:17:46,140 --> 00:17:52,020
<font color="#E5E5E5">to</font><font color="#CCCCCC"> Big Bob in memory</font><font color="#E5E5E5"> we see strengths or</font>

384
00:17:49,440 --> 00:17:55,080
specifically<font color="#CCCCCC"> paths to the three most</font>

385
00:17:52,020 --> 00:17:58,289
popular<font color="#E5E5E5"> third-party Mac firewall price</font>

386
00:17:55,080 --> 00:18:00,480
Little Snitch<font color="#CCCCCC"> hands-off and reviewing</font>

387
00:17:58,289 --> 00:18:02,908
plans<font color="#E5E5E5"> if you</font><font color="#CCCCCC"> look then at the</font>

388
00:18:00,480 --> 00:18:05,700
disassembly<font color="#E5E5E5"> for the</font><font color="#CCCCCC"> malware we can see</font>

389
00:18:02,909 --> 00:18:08,220
<font color="#E5E5E5">that footage of these kernel extensions</font>

390
00:18:05,700 --> 00:18:11,549
it's checking it makes this long<font color="#CCCCCC"> fast</font>

391
00:18:08,220 --> 00:18:14,010
and again<font color="#E5E5E5"> if proton finds that any of</font>

392
00:18:11,549 --> 00:18:16,230
these firewall products are<font color="#CCCCCC"> installed</font><font color="#E5E5E5"> it</font>

393
00:18:14,010 --> 00:18:18,809
actually<font color="#E5E5E5"> just works and</font><font color="#CCCCCC"> doesn't</font>

394
00:18:16,230 --> 00:18:21,059
<font color="#CCCCCC">persistently in fact the system so again</font>

395
00:18:18,809 --> 00:18:24,149
<font color="#E5E5E5">the malware author was willing to give</font>

396
00:18:21,059 --> 00:18:28,379
up<font color="#CCCCCC"> infecting certain systems versus</font>

397
00:18:24,150 --> 00:18:31,740
risking detection all right<font color="#E5E5E5"> Matt on to</font>

398
00:18:28,380 --> 00:18:34,169
you some religious so files as<font color="#CCCCCC"> we</font>

399
00:18:31,740 --> 00:18:37,890
discussed<font color="#E5E5E5"> sir rather complex pieces of</font>

400
00:18:34,169 --> 00:18:41,309
software and in order<font color="#CCCCCC"> for them to gain</font>

401
00:18:37,890 --> 00:18:42,990
insights<font color="#E5E5E5"> and control traffic because you</font>

402
00:18:41,309 --> 00:18:45,480
have<font color="#CCCCCC"> components</font>

403
00:18:42,990 --> 00:18:48,510
now unfortunately<font color="#CCCCCC"> especially these</font>

404
00:18:45,480 --> 00:18:51,720
<font color="#CCCCCC">third-party</font><font color="#E5E5E5"> firewall locks they're often</font>

405
00:18:48,510 --> 00:18:54,670
not as written<font color="#E5E5E5"> securely as an operating</font>

406
00:18:51,720 --> 00:18:57,460
system<font color="#E5E5E5"> nor have they</font><font color="#CCCCCC"> been as well</font>

407
00:18:54,670 --> 00:19:00,610
so if you're a local attacker<font color="#CCCCCC"> and you're</font>

408
00:18:57,460 --> 00:19:03,490
looking for local<font color="#CCCCCC"> British exploits or</font>

409
00:19:00,610 --> 00:19:06,520
<font color="#CCCCCC">elevation privileges such harmonics</font><font color="#E5E5E5"> are</font>

410
00:19:03,490 --> 00:19:08,290
<font color="#E5E5E5">a great place</font><font color="#CCCCCC"> to start</font><font color="#E5E5E5"> so if</font><font color="#CCCCCC"> your years</font>

411
00:19:06,520 --> 00:19:10,150
<font color="#E5E5E5">ago and when</font><font color="#CCCCCC"> this take a</font><font color="#E5E5E5"> quick look at</font>

412
00:19:08,290 --> 00:19:12,540
you Little Snitch kernel extension and I

413
00:19:10,150 --> 00:19:14,950
thought which turned out<font color="#E5E5E5"> to</font><font color="#CCCCCC"> be a rather</font>

414
00:19:12,540 --> 00:19:17,409
so the<font color="#CCCCCC"> Little Snitch</font>

415
00:19:14,950 --> 00:19:20,410
<font color="#CCCCCC">always mention it was teaming some data</font>

416
00:19:17,410 --> 00:19:23,890
from user mode<font color="#E5E5E5"> and specifically it took</font>

417
00:19:20,410 --> 00:19:27,370
<font color="#CCCCCC">a 64-bit value and use that in both a</font>

418
00:19:23,890 --> 00:19:29,680
publication<font color="#E5E5E5"> and a common routine so if</font>

419
00:19:27,370 --> 00:19:31,300
you look at<font color="#E5E5E5"> the code you see</font><font color="#CCCCCC"> ok</font><font color="#E5E5E5"> they</font>

420
00:19:29,680 --> 00:19:34,420
<font color="#E5E5E5">take this value in the allocated and</font>

421
00:19:31,300 --> 00:19:36,669
then copy that<font color="#CCCCCC"> what's ok</font><font color="#E5E5E5"> right you're</font>

422
00:19:34,420 --> 00:19:38,920
using the same manner<font color="#E5E5E5"> the problem was</font>

423
00:19:36,670 --> 00:19:41,920
the publication routine in the<font color="#CCCCCC"> news</font>

424
00:19:38,920 --> 00:19:44,800
which is<font color="#E5E5E5"> a Mac OS allocation regime</font>

425
00:19:41,920 --> 00:19:50,050
expects the<font color="#E5E5E5"> 32-bit</font><font color="#CCCCCC"> Bob</font><font color="#E5E5E5"> so if you pass it</font>

426
00:19:44,800 --> 00:19:53,200
<font color="#CCCCCC">a 64-bit value it will actually sorry</font><font color="#E5E5E5"> 6</font>

427
00:19:50,050 --> 00:19:55,629
to 32 minutes<font color="#E5E5E5"> as soon</font><font color="#CCCCCC"> as</font><font color="#E5E5E5"> that allocation</font>

428
00:19:53,200 --> 00:19:58,450
<font color="#E5E5E5">of first the very next</font><font color="#CCCCCC"> line of code</font><font color="#E5E5E5"> they</font>

429
00:19:55,630 --> 00:20:01,300
<font color="#CCCCCC">use</font><font color="#E5E5E5"> that same value to copy the values</font>

430
00:19:58,450 --> 00:20:04,600
from user mode<font color="#E5E5E5"> into</font><font color="#CCCCCC"> Chrome would cover</font>

431
00:20:01,300 --> 00:20:07,330
the<font color="#E5E5E5"> swapping function uses the whole 64</font>

432
00:20:04,600 --> 00:20:10,179
bit box<font color="#E5E5E5"> so obviously what we can do is</font>

433
00:20:07,330 --> 00:20:14,139
we can pass<font color="#CCCCCC"> in a 64-bit value this will</font>

434
00:20:10,180 --> 00:20:17,680
get truncated and it will cause a

435
00:20:14,140 --> 00:20:20,430
control over<font color="#CCCCCC"> not</font><font color="#E5E5E5"> just her name because</font>

436
00:20:17,680 --> 00:20:24,160
<font color="#E5E5E5">what they allowed it was an unprivileged</font>

437
00:20:20,430 --> 00:20:27,280
<font color="#E5E5E5">local attacker to gain full code</font>

438
00:20:24,160 --> 00:20:28,780
execution in<font color="#E5E5E5"> the</font><font color="#CCCCCC"> complex</font><font color="#E5E5E5"> which is kind</font>

439
00:20:27,280 --> 00:20:32,260
<font color="#CCCCCC">of</font><font color="#E5E5E5"> like a game over</font><font color="#CCCCCC"> they get a little</font>

440
00:20:28,780 --> 00:20:35,379
<font color="#E5E5E5">ironic that a security</font><font color="#CCCCCC"> product has these</font>

441
00:20:32,260 --> 00:20:37,480
security run abilities another issue

442
00:20:35,380 --> 00:20:39,730
might found while working on<font color="#E5E5E5"> these</font>

443
00:20:37,480 --> 00:20:41,770
slides also<font color="#E5E5E5"> affected littles</font><font color="#CCCCCC"> and Chavez</font>

444
00:20:39,730 --> 00:20:43,900
really<font color="#CCCCCC"> pp My Little Snitch</font><font color="#E5E5E5"> versus just</font>

445
00:20:41,770 --> 00:20:47,050
<font color="#E5E5E5">the</font><font color="#CCCCCC"> most popular</font><font color="#E5E5E5"> products</font><font color="#CCCCCC"> I was</font><font color="#E5E5E5"> focusing</font>

446
00:20:43,900 --> 00:20:51,640
most of<font color="#E5E5E5"> my</font><font color="#CCCCCC"> attention here</font><font color="#E5E5E5"> turns out that</font>

447
00:20:47,050 --> 00:20:53,649
the affair or installer or<font color="#E5E5E5"> the firewall</font>

448
00:20:51,640 --> 00:20:55,960
product does<font color="#CCCCCC"> not</font><font color="#E5E5E5"> validate or doesn't</font>

449
00:20:53,650 --> 00:20:58,420
fully<font color="#CCCCCC"> dominate the components it's</font>

450
00:20:55,960 --> 00:21:00,960
installing<font color="#CCCCCC"> or updating so whether the</font>

451
00:20:58,420 --> 00:21:03,010
local<font color="#E5E5E5"> and</font><font color="#CCCCCC"> revolutionist hacker can do is</font>

452
00:21:00,960 --> 00:21:06,370
modify

453
00:21:03,010 --> 00:21:08,320
and then the firewall installer will be

454
00:21:06,370 --> 00:21:11,168
neatly<font color="#E5E5E5"> and</font><font color="#CCCCCC"> blended</font><font color="#E5E5E5"> stole them</font><font color="#CCCCCC"> and</font>

455
00:21:08,320 --> 00:21:13,059
execute<font color="#E5E5E5"> them as</font><font color="#CCCCCC"> route</font><font color="#E5E5E5"> without</font><font color="#CCCCCC"> cloudy</font><font color="#E5E5E5"> so</font>

456
00:21:11,169 --> 00:21:15,760
basically what a<font color="#E5E5E5"> local attacker can do</font>

457
00:21:13,059 --> 00:21:17,530
is wait<font color="#CCCCCC"> until the user</font><font color="#E5E5E5"> either install</font>

458
00:21:15,760 --> 00:21:20,200
<font color="#CCCCCC">the firewall</font><font color="#E5E5E5"> or more like</font><font color="#CCCCCC"> anyway to</font>

459
00:21:17,530 --> 00:21:22,809
update them and<font color="#E5E5E5"> kind of do with a local</font>

460
00:21:20,200 --> 00:21:25,270
<font color="#E5E5E5">man in the middle to modify and download</font>

461
00:21:22,809 --> 00:21:26,889
its files before<font color="#E5E5E5"> the firewall went you</font>

462
00:21:25,270 --> 00:21:28,960
can use them and there's a huge window

463
00:21:26,890 --> 00:21:31,299
<font color="#CCCCCC">times this</font><font color="#E5E5E5"> is a very easy exploit to</font>

464
00:21:28,960 --> 00:21:32,169
<font color="#E5E5E5">make so can be modified these components</font>

465
00:21:31,299 --> 00:21:34,660
we<font color="#CCCCCC"> can</font><font color="#E5E5E5"> adjust that</font>

466
00:21:32,169 --> 00:21:36,190
<font color="#CCCCCC">dorsen stripped and then again the</font>

467
00:21:34,660 --> 00:21:38,740
<font color="#E5E5E5">installer which is running with root</font>

468
00:21:36,190 --> 00:21:40,780
privileges will<font color="#E5E5E5"> blindly execute them</font><font color="#CCCCCC"> so</font>

469
00:21:38,740 --> 00:21:42,760
again<font color="#CCCCCC"> in</font><font color="#E5E5E5"> great effective ways for a</font>

470
00:21:40,780 --> 00:21:47,649
local<font color="#CCCCCC"> information center to get</font>

471
00:21:42,760 --> 00:21:51,640
privileges<font color="#CCCCCC"> ok let's now talk about</font><font color="#E5E5E5"> how</font>

472
00:21:47,650 --> 00:21:54,130
<font color="#E5E5E5">to bypass</font><font color="#CCCCCC"> first we'll</font><font color="#E5E5E5"> look at ways</font><font color="#CCCCCC"> to</font>

473
00:21:51,640 --> 00:21:56,710
bypass<font color="#E5E5E5"> each of the most popular</font>

474
00:21:54,130 --> 00:21:59,290
third-party<font color="#CCCCCC"> mask</font><font color="#E5E5E5"> firewalls</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> then</font>

475
00:21:56,710 --> 00:22:02,880
we'll talk<font color="#E5E5E5"> about generic bypasses that</font>

476
00:21:59,290 --> 00:22:05,470
<font color="#E5E5E5">can fully bypass all</font><font color="#CCCCCC"> the locks</font>

477
00:22:02,880 --> 00:22:08,740
now I do<font color="#CCCCCC"> like to clarify or make the</font>

478
00:22:05,470 --> 00:22:11,820
point that<font color="#CCCCCC"> for any security</font><font color="#E5E5E5"> products if</font>

479
00:22:08,740 --> 00:22:15,070
an attacker or piece<font color="#CCCCCC"> of malware is</font>

480
00:22:11,820 --> 00:22:17,470
proactively targeting<font color="#E5E5E5"> that they will be</font>

481
00:22:15,070 --> 00:22:22,240
able<font color="#E5E5E5"> to find</font><font color="#CCCCCC"> the range</font><font color="#E5E5E5"> appliance so</font>

482
00:22:17,470 --> 00:22:24,370
might<font color="#CCCCCC"> and these are not</font><font color="#E5E5E5"> CDE so again</font>

483
00:22:22,240 --> 00:22:26,260
it's an inevitability<font color="#E5E5E5"> right you write a</font>

484
00:22:24,370 --> 00:22:28,299
firewall product and there's a piece<font color="#E5E5E5"> of</font>

485
00:22:26,260 --> 00:22:30,910
malware that<font color="#CCCCCC"> is trying to</font><font color="#E5E5E5"> bypass your</font>

486
00:22:28,299 --> 00:22:33,340
specific firewall part they will succeed

487
00:22:30,910 --> 00:22:37,450
<font color="#CCCCCC">same with an antivirus</font><font color="#E5E5E5"> products in with</font>

488
00:22:33,340 --> 00:22:38,889
any<font color="#E5E5E5"> behavioral base</font><font color="#CCCCCC"> University right ok</font>

489
00:22:37,450 --> 00:22:40,630
so the<font color="#E5E5E5"> first one we're going</font><font color="#CCCCCC"> to talk</font>

490
00:22:38,890 --> 00:22:44,230
about<font color="#E5E5E5"> is radio silence and</font><font color="#CCCCCC"> again their</font>

491
00:22:40,630 --> 00:22:46,390
<font color="#E5E5E5">goal is to somehow</font><font color="#CCCCCC"> be allowed to</font><font color="#E5E5E5"> access</font>

492
00:22:44,230 --> 00:22:48,640
the network<font color="#E5E5E5"> without these firewall</font>

493
00:22:46,390 --> 00:22:51,880
products detecting or alerting the user

494
00:22:48,640 --> 00:22:54,400
<font color="#CCCCCC">that</font><font color="#E5E5E5"> this is what we're trying to do so</font>

495
00:22:51,880 --> 00:22:59,620
radio silence is interesting because it

496
00:22:54,400 --> 00:23:01,809
actually<font color="#E5E5E5"> takes a blacklist approach that</font>

497
00:22:59,620 --> 00:23:04,989
is to<font color="#CCCCCC"> say by default it</font><font color="#E5E5E5"> will allow any</font>

498
00:23:01,809 --> 00:23:05,720
new track<font color="#CCCCCC"> the user</font><font color="#E5E5E5"> has to manually go in</font>

499
00:23:04,990 --> 00:23:08,510
<font color="#E5E5E5">and</font>

500
00:23:05,720 --> 00:23:11,620
with certain<font color="#E5E5E5"> applications that they want</font>

501
00:23:08,510 --> 00:23:14,720
<font color="#CCCCCC">to walk</font><font color="#E5E5E5"> so if you look at the</font>

502
00:23:11,620 --> 00:23:16,189
disassembly<font color="#CCCCCC"> reverse engineer currently</font>

503
00:23:14,720 --> 00:23:18,380
extensions<font color="#CCCCCC"> we can</font><font color="#E5E5E5"> look at their</font>

504
00:23:16,190 --> 00:23:20,900
blacklist<font color="#CCCCCC"> watch and we can</font><font color="#E5E5E5"> see that</font>

505
00:23:18,380 --> 00:23:23,330
<font color="#CCCCCC">there is a</font><font color="#E5E5E5"> stir compare where they're</font>

506
00:23:20,900 --> 00:23:25,130
checking the name of the<font color="#E5E5E5"> process and</font>

507
00:23:23,330 --> 00:23:28,850
<font color="#E5E5E5">then appears that make the name of the</font>

508
00:23:25,130 --> 00:23:30,340
process<font color="#CCCCCC"> is</font><font color="#E5E5E5"> launched deep that cannot be</font>

509
00:23:28,850 --> 00:23:33,679
<font color="#CCCCCC">waxed</font>

510
00:23:30,340 --> 00:23:35,689
so<font color="#E5E5E5"> let's</font><font color="#CCCCCC"> cuz let's treat these malware</font>

511
00:23:33,680 --> 00:23:37,250
and name it launching<font color="#E5E5E5"> getting the path</font>

512
00:23:35,690 --> 00:23:38,630
<font color="#E5E5E5">doesn't matter can be</font><font color="#CCCCCC"> in the temp</font>

513
00:23:37,250 --> 00:23:42,290
directory users<font color="#CCCCCC"> directory</font>

514
00:23:38,630 --> 00:23:44,540
<font color="#E5E5E5">whatever if we</font><font color="#CCCCCC"> may we create a rule to</font>

515
00:23:42,290 --> 00:23:46,399
blacklist this process because<font color="#CCCCCC"> again</font>

516
00:23:44,540 --> 00:23:48,500
<font color="#E5E5E5">this is a</font><font color="#CCCCCC"> blackness new based firewall</font>

517
00:23:46,400 --> 00:23:50,810
<font color="#E5E5E5">we go ahead and</font><font color="#CCCCCC"> create better but</font><font color="#E5E5E5"> once</font>

518
00:23:48,500 --> 00:23:54,200
they do not allow this process to access

519
00:23:50,810 --> 00:23:56,960
network<font color="#E5E5E5"> if we then</font><font color="#CCCCCC"> execute this matter</font>

520
00:23:54,200 --> 00:23:58,430
because<font color="#CCCCCC"> it</font><font color="#E5E5E5"> is named watch</font><font color="#CCCCCC"> D and because</font>

521
00:23:56,960 --> 00:24:01,030
<font color="#CCCCCC">the firewall is not shaking the whole</font>

522
00:23:58,430 --> 00:24:02,990
patent<font color="#E5E5E5"> but validating any code sign</font>

523
00:24:01,030 --> 00:24:06,139
information is<font color="#E5E5E5"> just checking the name</font>

524
00:24:02,990 --> 00:24:07,940
<font color="#E5E5E5">since we</font><font color="#CCCCCC"> are called launch D it will say</font>

525
00:24:06,140 --> 00:24:11,060
<font color="#CCCCCC">okay this</font><font color="#E5E5E5"> is something that could not be</font>

526
00:24:07,940 --> 00:24:13,490
lattice so I will<font color="#E5E5E5"> allow that</font><font color="#CCCCCC"> so got very</font>

527
00:24:11,060 --> 00:24:17,510
<font color="#CCCCCC">trivial ways use fully</font><font color="#E5E5E5"> bypass</font><font color="#CCCCCC"> screaming</font>

528
00:24:13,490 --> 00:24:21,260
<font color="#CCCCCC">silence another popular Mac firewall</font>

529
00:24:17,510 --> 00:24:23,720
product is handled<font color="#E5E5E5"> turns out we can</font>

530
00:24:21,260 --> 00:24:27,500
bypass this product by sending<font color="#E5E5E5"> a</font>

531
00:24:23,720 --> 00:24:30,650
synthetic event to the alert winner<font color="#E5E5E5"> so</font>

532
00:24:27,500 --> 00:24:34,100
say we want to<font color="#E5E5E5"> execute control</font><font color="#CCCCCC"> pro is a</font>

533
00:24:30,650 --> 00:24:37,760
<font color="#CCCCCC">built-in utility on</font><font color="#E5E5E5"> Mac OS that a lot of</font>

534
00:24:34,100 --> 00:24:41,500
<font color="#CCCCCC">our</font><font color="#E5E5E5"> chapters</font><font color="#CCCCCC"> use to download either</font>

535
00:24:37,760 --> 00:24:43,850
<font color="#E5E5E5">second stage</font><font color="#CCCCCC"> implants or data from what</font>

536
00:24:41,500 --> 00:24:46,250
we can<font color="#CCCCCC"> see that NASA started</font><font color="#E5E5E5"> the</font>

537
00:24:43,850 --> 00:24:49,939
firewall sees<font color="#E5E5E5"> this</font><font color="#CCCCCC"> out goatee connection</font>

538
00:24:46,250 --> 00:24:52,220
and generates an alert what a local

539
00:24:49,940 --> 00:24:55,850
<font color="#CCCCCC">attacker can do though is send a</font>

540
00:24:52,220 --> 00:24:58,580
programmatic<font color="#E5E5E5"> or synthetic click to the</font>

541
00:24:55,850 --> 00:25:01,189
<font color="#CCCCCC">okay me button which basically</font><font color="#E5E5E5"> will tell</font>

542
00:24:58,580 --> 00:25:03,050
the firewall to<font color="#CCCCCC"> allow</font><font color="#E5E5E5"> the event</font><font color="#CCCCCC"> the</font>

543
00:25:01,190 --> 00:25:05,510
firewall isn't doing any<font color="#E5E5E5"> detection of</font>

544
00:25:03,050 --> 00:25:07,139
such event<font color="#E5E5E5"> so it basically just assumes</font>

545
00:25:05,510 --> 00:25:10,020
that the user is the<font color="#CCCCCC"> one</font>

546
00:25:07,140 --> 00:25:12,450
a lot of course it's our<font color="#E5E5E5"> militia story</font>

547
00:25:10,020 --> 00:25:14,190
and of course<font color="#E5E5E5"> it's also ways</font><font color="#CCCCCC"> to do this</font>

548
00:25:12,450 --> 00:25:16,500
invisibly<font color="#E5E5E5"> we could wait till the</font><font color="#CCCCCC"> users</font>

549
00:25:14,190 --> 00:25:19,530
not active<font color="#E5E5E5"> we</font><font color="#CCCCCC"> can't in the</font><font color="#E5E5E5"> screening or</font>

550
00:25:16,500 --> 00:25:21,480
way to display its<font color="#E5E5E5"> sleep so even though</font>

551
00:25:19,530 --> 00:25:25,440
we are<font color="#CCCCCC"> interacting with it ey component</font>

552
00:25:21,480 --> 00:25:28,710
<font color="#CCCCCC">we</font><font color="#E5E5E5"> can do this is wholly innocent next</font>

553
00:25:25,440 --> 00:25:33,180
up we have Lulu Lulu is the open source

554
00:25:28,710 --> 00:25:35,160
<font color="#CCCCCC">approach source code</font><font color="#E5E5E5"> ins source it's</font>

555
00:25:33,180 --> 00:25:38,250
pretty easy to understand how it's going

556
00:25:35,160 --> 00:25:41,880
how it works<font color="#CCCCCC"> o means it's also easy in</font>

557
00:25:38,250 --> 00:25:42,270
some scenarios<font color="#E5E5E5"> to find</font><font color="#CCCCCC"> amicus</font><font color="#E5E5E5"> so like</font>

558
00:25:41,880 --> 00:25:46,050
people

559
00:25:42,270 --> 00:25:48,090
<font color="#E5E5E5">Lulu trusts the</font><font color="#CCCCCC"> winery's</font><font color="#E5E5E5"> system is</font><font color="#CCCCCC"> its</font>

560
00:25:46,050 --> 00:25:51,360
interest<font color="#E5E5E5"> this is the program</font><font color="#CCCCCC"> that's on</font>

561
00:25:48,090 --> 00:25:53,820
baby<font color="#E5E5E5"> power has a concept of the graters</font>

562
00:25:51,360 --> 00:25:56,429
and<font color="#CCCCCC"> a great list is a list the</font><font color="#E5E5E5"> binder</font><font color="#CCCCCC"> is</font>

563
00:25:53,820 --> 00:25:58,590
back<font color="#E5E5E5"> the attacker could potentially use</font>

564
00:25:56,430 --> 00:26:01,950
to perform unauthorized<font color="#CCCCCC"> network cities</font>

565
00:25:58,590 --> 00:26:04,470
for example<font color="#CCCCCC"> pearl neck tag</font><font color="#E5E5E5"> Center these</font>

566
00:26:01,950 --> 00:26:06,060
are yes<font color="#E5E5E5"> signed by an admirable but you</font>

567
00:26:04,470 --> 00:26:08,520
know if someone's executing<font color="#E5E5E5"> men</font><font color="#CCCCCC"> fat</font>

568
00:26:06,060 --> 00:26:12,120
<font color="#CCCCCC">fireball should still alert the user</font><font color="#E5E5E5"> and</font>

569
00:26:08,520 --> 00:26:14,100
tell them what so I got so the question

570
00:26:12,120 --> 00:26:17,280
is as an attacker can we find another

571
00:26:14,100 --> 00:26:20,669
<font color="#CCCCCC">system utility that sign my</font><font color="#E5E5E5"> Apple that</font>

572
00:26:17,280 --> 00:26:23,760
<font color="#E5E5E5">is not on this</font><font color="#CCCCCC"> Prince and the answer was</font>

573
00:26:20,670 --> 00:26:27,960
yes<font color="#E5E5E5"> turns out we can use the who is</font>

574
00:26:23,760 --> 00:26:30,629
utility to exfiltrate data if we look at

575
00:26:27,960 --> 00:26:32,610
the debug log from<font color="#CCCCCC"> the firewall</font>

576
00:26:30,630 --> 00:26:34,380
we can see that when who is<font color="#CCCCCC"> this</font>

577
00:26:32,610 --> 00:26:36,149
executed the firewall

578
00:26:34,380 --> 00:26:37,620
sees the network<font color="#E5E5E5"> traffic because again</font>

579
00:26:36,150 --> 00:26:39,120
it's running<font color="#CCCCCC"> in the girl so it's gonna</font>

580
00:26:37,620 --> 00:26:41,159
see all<font color="#E5E5E5"> traffic</font>

581
00:26:39,120 --> 00:26:43,770
however since who is is<font color="#E5E5E5"> designed by</font>

582
00:26:41,160 --> 00:26:46,320
Apple<font color="#E5E5E5"> proper and it's not on the</font>

583
00:26:43,770 --> 00:26:53,940
greatest<font color="#E5E5E5"> firewall says okay this is</font><font color="#CCCCCC"> the</font>

584
00:26:46,320 --> 00:26:55,889
trusted so it<font color="#E5E5E5"> does and then finally we</font>

585
00:26:53,940 --> 00:26:58,850
have Little Snitch little such<font color="#CCCCCC"> as the de</font>

586
00:26:55,890 --> 00:27:01,860
facto the<font color="#E5E5E5"> most popular firewalls</font>

587
00:26:58,850 --> 00:27:05,550
<font color="#CCCCCC">if we look at</font><font color="#E5E5E5"> its rules we can see it</font>

588
00:27:01,860 --> 00:27:08,610
has a<font color="#CCCCCC"> unbelievable</font><font color="#E5E5E5"> system rule that says</font>

589
00:27:05,550 --> 00:27:12,710
anybody<font color="#E5E5E5"> any process any application can</font>

590
00:27:08,610 --> 00:27:16,709
<font color="#CCCCCC">talk to managers specifically icloud.com</font>

591
00:27:12,710 --> 00:27:19,799
<font color="#CCCCCC">so to test this we can manually</font><font color="#E5E5E5"> create a</font>

592
00:27:16,710 --> 00:27:22,679
rule to block<font color="#CCCCCC"> curl</font>

593
00:27:19,799 --> 00:27:25,168
and<font color="#CCCCCC"> they connect Apple servers</font><font color="#E5E5E5"> for</font>

594
00:27:22,679 --> 00:27:26,789
example if we connect to iCloud we can

595
00:27:25,169 --> 00:27:28,890
see that this connection<font color="#E5E5E5"> is still</font>

596
00:27:26,789 --> 00:27:33,870
allowed<font color="#E5E5E5"> even though we explicitly people</font>

597
00:27:28,890 --> 00:27:36,240
firewall to block her so while that I am

598
00:27:33,870 --> 00:27:38,760
reverse<font color="#CCCCCC"> engineers the iPhone protocol</font>

599
00:27:36,240 --> 00:27:41,730
and I set a<font color="#E5E5E5"> commanding control server</font>

600
00:27:38,760 --> 00:27:43,740
long<font color="#CCCCCC"> time now unless we</font><font color="#E5E5E5"> have the</font>

601
00:27:41,730 --> 00:27:46,679
<font color="#CCCCCC">semantics tor server lon I Drive which</font>

602
00:27:43,740 --> 00:27:49,500
is<font color="#E5E5E5"> hosted in high club</font><font color="#CCCCCC"> we can then write</font>

603
00:27:46,679 --> 00:27:51,450
a malware that once it<font color="#CCCCCC"> gets on</font><font color="#E5E5E5"> a system</font>

604
00:27:49,500 --> 00:27:53,760
even if that's<font color="#E5E5E5"> just a little smidgen</font>

605
00:27:51,450 --> 00:27:56,220
<font color="#CCCCCC">installed</font><font color="#E5E5E5"> it can</font><font color="#CCCCCC"> exaggerate</font><font color="#E5E5E5"> any dated</font>

606
00:27:53,760 --> 00:27:58,620
lots to this command control sir<font color="#CCCCCC"> again</font>

607
00:27:56,220 --> 00:28:00,659
the firewall will<font color="#E5E5E5"> see this</font><font color="#CCCCCC"> connection</font>

608
00:27:58,620 --> 00:28:03,149
because<font color="#CCCCCC"> it sees</font><font color="#E5E5E5"> all network connections</font>

609
00:28:00,659 --> 00:28:05,360
<font color="#E5E5E5">but because it has unbelievable system</font>

610
00:28:03,149 --> 00:28:07,918
rule is<font color="#E5E5E5"> said anybody who</font><font color="#CCCCCC"> can talk</font><font color="#E5E5E5"> to</font>

611
00:28:05,360 --> 00:28:09,840
<font color="#E5E5E5">iCloud it will allow the connection</font>

612
00:28:07,919 --> 00:28:13,679
<font color="#CCCCCC">ginger</font><font color="#E5E5E5"> so you have surely a way to</font>

613
00:28:09,840 --> 00:28:16,980
bypass this<font color="#E5E5E5"> mission okay so those were</font>

614
00:28:13,679 --> 00:28:18,330
<font color="#CCCCCC">right specific</font><font color="#E5E5E5"> classes and in some ways</font>

615
00:28:16,980 --> 00:28:21,419
they're kind of cool<font color="#CCCCCC"> they're</font><font color="#E5E5E5"> kind of</font>

616
00:28:18,330 --> 00:28:24,470
<font color="#CCCCCC">neat but another way they're also</font><font color="#E5E5E5"> and</font>

617
00:28:21,419 --> 00:28:27,149
the reason<font color="#CCCCCC"> Erik kind of wing is</font>

618
00:28:24,470 --> 00:28:29,580
impractical if you're you know a real

619
00:28:27,149 --> 00:28:32,010
attacker or<font color="#E5E5E5"> a piece of malware</font><font color="#CCCCCC"> there's a</font>

620
00:28:29,580 --> 00:28:33,809
lot of<font color="#CCCCCC"> sexy tactic before</font><font color="#E5E5E5"> right first</font>

621
00:28:32,010 --> 00:28:36,210
you have to detect<font color="#CCCCCC"> that a firehose</font>

622
00:28:33,809 --> 00:28:38,428
<font color="#CCCCCC">installed then you have</font><font color="#E5E5E5"> to check what</font>

623
00:28:36,210 --> 00:28:41,010
specific firewall is it Little Snitch

624
00:28:38,429 --> 00:28:43,620
<font color="#E5E5E5">loulou's three of size fits bands off</font>

625
00:28:41,010 --> 00:28:46,049
and then you have to utilize<font color="#CCCCCC"> that</font>

626
00:28:43,620 --> 00:28:48,389
<font color="#E5E5E5">product specific</font><font color="#CCCCCC"> by</font><font color="#E5E5E5"> house which means</font>

627
00:28:46,049 --> 00:28:51,658
you have to<font color="#E5E5E5"> implement code for each of</font>

628
00:28:48,390 --> 00:28:54,720
those so<font color="#CCCCCC"> that gets unwieldy that gets</font>

629
00:28:51,659 --> 00:28:57,390
you know kind of complex so let's now

630
00:28:54,720 --> 00:28:59,899
talk about generic<font color="#CCCCCC"> line which it</font><font color="#E5E5E5"> might</font>

631
00:28:57,390 --> 00:29:03,330
<font color="#E5E5E5">be mean of</font><font color="#CCCCCC"> are much much waiting work</font>

632
00:28:59,899 --> 00:29:06,270
and what I mean<font color="#E5E5E5"> by</font><font color="#CCCCCC"> a generic bypass is a</font>

633
00:29:03,330 --> 00:29:09,029
bypass a way for the attacker to access

634
00:29:06,270 --> 00:29:12,418
the network regardless<font color="#E5E5E5"> of what firewall</font>

635
00:29:09,029 --> 00:29:16,789
<font color="#CCCCCC">moneth is now these are all possible</font>

636
00:29:12,419 --> 00:29:19,960
because firewalls<font color="#E5E5E5"> must allow certain</font>

637
00:29:16,789 --> 00:29:23,020
remember<font color="#CCCCCC"> later coalesce you know</font>

638
00:29:19,960 --> 00:29:25,600
<font color="#E5E5E5">system protocols talk to the network</font>

639
00:29:23,020 --> 00:29:28,450
perhaps libraries and the system

640
00:29:25,600 --> 00:29:31,300
<font color="#E5E5E5">operators also the user is</font><font color="#CCCCCC"> going to</font>

641
00:29:28,450 --> 00:29:33,190
<font color="#E5E5E5">invariably allow certain applications</font>

642
00:29:31,300 --> 00:29:35,260
<font color="#E5E5E5">access network I mean think about your</font>

643
00:29:33,190 --> 00:29:36,850
bank<font color="#E5E5E5"> right there's a lot of applications</font>

644
00:29:35,260 --> 00:29:42,220
that<font color="#E5E5E5"> you</font><font color="#CCCCCC"> use that would be</font><font color="#E5E5E5"> completely</font>

645
00:29:36,850 --> 00:29:46,090
<font color="#E5E5E5">useless for example the process so what</font>

646
00:29:42,220 --> 00:29:49,900
we do to<font color="#CCCCCC"> find or exploit these generic</font>

647
00:29:46,090 --> 00:29:54,280
bypasses<font color="#CCCCCC"> are</font><font color="#E5E5E5"> two steps</font><font color="#CCCCCC"> so first we're</font>

648
00:29:49,900 --> 00:29:57,340
going<font color="#E5E5E5"> to simply snip or observe what</font>

649
00:29:54,280 --> 00:29:59,290
network traffic is allowed so imagine<font color="#E5E5E5"> a</font>

650
00:29:57,340 --> 00:30:02,260
man you're an<font color="#E5E5E5"> attacker or piece of</font>

651
00:29:59,290 --> 00:30:04,389
<font color="#E5E5E5">malware you give you an execution on Mac</font>

652
00:30:02,260 --> 00:30:07,060
system<font color="#E5E5E5"> the first</font><font color="#CCCCCC"> step again is just</font>

653
00:30:04,390 --> 00:30:10,090
quietly passively watch for a few<font color="#CCCCCC"> hours</font>

654
00:30:07,060 --> 00:30:13,389
<font color="#CCCCCC">to news and</font><font color="#E5E5E5"> kind of the</font><font color="#CCCCCC"> Matt out or</font>

655
00:30:10,090 --> 00:30:16,720
understand and we passively what network

656
00:30:13,390 --> 00:30:18,760
traffic<font color="#E5E5E5"> is allowed back and then what we</font>

657
00:30:16,720 --> 00:30:21,430
can do is talk<font color="#E5E5E5"> about abusing those</font>

658
00:30:18,760 --> 00:30:25,510
protocols<font color="#E5E5E5"> or processes to generically</font>

659
00:30:21,430 --> 00:30:27,700
bypass any<font color="#E5E5E5"> matters so that's the first</font>

660
00:30:25,510 --> 00:30:30,550
<font color="#E5E5E5">thing we want to do is figure out on any</font>

661
00:30:27,700 --> 00:30:32,680
system what network traffic is<font color="#E5E5E5"> loud if</font>

662
00:30:30,550 --> 00:30:35,409
there's no firewall installed firewall

663
00:30:32,680 --> 00:30:37,840
<font color="#E5E5E5">what</font><font color="#CCCCCC"> rules through what applications for</font>

664
00:30:35,410 --> 00:30:39,070
processes what protocols and<font color="#E5E5E5"> we need</font>

665
00:30:37,840 --> 00:30:42,669
this is<font color="#E5E5E5"> without</font><font color="#CCCCCC"> any special privileges</font>

666
00:30:39,070 --> 00:30:46,419
<font color="#CCCCCC">using the LS OS utility that's</font><font color="#E5E5E5"> baking or</font>

667
00:30:42,670 --> 00:30:48,490
built into<font color="#E5E5E5"> Mac OS so we execute this on</font>

668
00:30:46,420 --> 00:30:50,320
my<font color="#E5E5E5"> box</font><font color="#CCCCCC"> all hard to read but</font><font color="#E5E5E5"> we can see</font>

669
00:30:48,490 --> 00:30:52,510
there's a variety<font color="#E5E5E5"> of</font><font color="#CCCCCC"> applications</font><font color="#E5E5E5"> not</font>

670
00:30:50,320 --> 00:30:54,820
<font color="#E5E5E5">too surprisingly that are allowed to</font>

671
00:30:52,510 --> 00:30:57,190
access the network we have<font color="#E5E5E5"> things like</font>

672
00:30:54,820 --> 00:31:00,909
my browser from<font color="#CCCCCC"> smart</font>

673
00:30:57,190 --> 00:31:03,400
we have<font color="#E5E5E5"> things</font><font color="#CCCCCC"> live chat applications</font><font color="#E5E5E5"> we</font>

674
00:31:00,910 --> 00:31:05,680
<font color="#CCCCCC">have other apps like Adobe</font><font color="#E5E5E5"> yeah</font><font color="#CCCCCC"> we're</font>

675
00:31:03,400 --> 00:31:07,840
really<font color="#CCCCCC"> just about all the apps and</font>

676
00:31:05,680 --> 00:31:10,120
processes you use on your<font color="#E5E5E5"> system</font><font color="#CCCCCC"> better</font>

677
00:31:07,840 --> 00:31:13,179
<font color="#E5E5E5">allowed access network even if you have</font>

678
00:31:10,120 --> 00:31:17,260
a firewall install<font color="#CCCCCC"> BML SOS we can</font>

679
00:31:13,180 --> 00:31:20,050
<font color="#CCCCCC">massively</font><font color="#E5E5E5"> determinist and yes some</font><font color="#CCCCCC"> of</font>

680
00:31:17,260 --> 00:31:22,960
these<font color="#CCCCCC"> applications may have any point</font>

681
00:31:20,050 --> 00:31:26,050
specific rules<font color="#E5E5E5"> for</font><font color="#CCCCCC"> example the firewall</font>

682
00:31:22,960 --> 00:31:28,900
might say<font color="#E5E5E5"> only allow</font><font color="#CCCCCC"> Adobe to talk to</font>

683
00:31:26,050 --> 00:31:32,980
<font color="#E5E5E5">these servers or only</font><font color="#CCCCCC"> allows</font><font color="#E5E5E5"> Clack to</font>

684
00:31:28,900 --> 00:31:35,010
talk<font color="#E5E5E5"> to you no slack</font><font color="#CCCCCC"> servers</font><font color="#E5E5E5"> but good</font>

685
00:31:32,980 --> 00:31:37,390
<font color="#E5E5E5">for the speaker is most of these</font>

686
00:31:35,010 --> 00:31:39,879
<font color="#E5E5E5">services are talking to cloud-based</font>

687
00:31:37,390 --> 00:31:42,430
<font color="#CCCCCC">anyway</font><font color="#E5E5E5"> so if we actually took the IP</font>

688
00:31:39,880 --> 00:31:45,670
<font color="#CCCCCC">addresses or</font><font color="#E5E5E5"> where they</font><font color="#CCCCCC"> resolved the</font>

689
00:31:42,430 --> 00:31:48,460
majority of them so it's<font color="#CCCCCC"> very easy for</font>

690
00:31:45,670 --> 00:31:49,510
us<font color="#CCCCCC"> as when attack</font><font color="#E5E5E5"> there</font><font color="#CCCCCC"> -</font><font color="#E5E5E5"> so for example</font>

691
00:31:48,460 --> 00:31:53,860
command control server

692
00:31:49,510 --> 00:31:55,750
similarly long<font color="#CCCCCC"> in English ok</font><font color="#E5E5E5"> so now we</font>

693
00:31:53,860 --> 00:31:57,760
have a good<font color="#E5E5E5"> understanding of what</font>

694
00:31:55,750 --> 00:32:00,220
traffic and what the processes are

695
00:31:57,760 --> 00:32:02,830
allowed through<font color="#CCCCCC"> the firewall</font><font color="#E5E5E5"> and to talk</font>

696
00:32:00,220 --> 00:32:05,740
to so let's now talk about exploiting

697
00:32:02,830 --> 00:32:10,120
<font color="#E5E5E5">these</font><font color="#CCCCCC"> two generically bypassed any third</font>

698
00:32:05,740 --> 00:32:13,180
<font color="#E5E5E5">party Mac so the first generic by mass</font>

699
00:32:10,120 --> 00:32:16,750
<font color="#E5E5E5">we're going to use indirectly</font><font color="#CCCCCC"> exploit</font>

700
00:32:13,180 --> 00:32:20,920
<font color="#CCCCCC">speech trust of a process</font><font color="#E5E5E5"> via a trusted</font>

701
00:32:16,750 --> 00:32:23,500
<font color="#E5E5E5">protocol so on Mac OS turns out that DNS</font>

702
00:32:20,920 --> 00:32:27,160
requests are handled by<font color="#E5E5E5"> Apple's</font>

703
00:32:23,500 --> 00:32:29,380
mdns responder<font color="#CCCCCC"> Pina so this means</font><font color="#E5E5E5"> in any</font>

704
00:32:27,160 --> 00:32:32,920
application<font color="#E5E5E5"> on the system whether that's</font>

705
00:32:29,380 --> 00:32:35,530
your browser or a smaller<font color="#CCCCCC"> it takes</font><font color="#E5E5E5"> to be</font>

706
00:32:32,920 --> 00:32:39,910
<font color="#E5E5E5">an</font><font color="#CCCCCC"> S reserve</font><font color="#E5E5E5"> request to resolve an IP</font>

707
00:32:35,530 --> 00:32:42,970
address or URL<font color="#E5E5E5"> this will actually be</font>

708
00:32:39,910 --> 00:32:45,730
<font color="#E5E5E5">handled by trusted system so basically</font>

709
00:32:42,970 --> 00:32:47,800
<font color="#E5E5E5">locally and</font><font color="#CCCCCC"> exbc message is</font><font color="#E5E5E5"> set to</font><font color="#CCCCCC"> to</font>

710
00:32:45,730 --> 00:32:49,990
trust the<font color="#CCCCCC"> system</font><font color="#E5E5E5"> Damon and then that</font>

711
00:32:47,800 --> 00:32:53,440
Damon is what makes the<font color="#E5E5E5"> actual DNS</font>

712
00:32:49,990 --> 00:32:56,500
<font color="#CCCCCC">request to resolve it</font><font color="#E5E5E5"> so the firewall</font>

713
00:32:53,440 --> 00:32:58,840
<font color="#CCCCCC">will see this request because again it's</font>

714
00:32:56,500 --> 00:33:00,520
monitoring<font color="#E5E5E5"> all network traffic but as</font>

715
00:32:58,840 --> 00:33:03,070
don't you have to allow<font color="#CCCCCC"> it through</font>

716
00:33:00,520 --> 00:33:05,710
because<font color="#E5E5E5"> it's coming</font><font color="#CCCCCC"> from</font><font color="#E5E5E5"> the trusted DNS</font>

717
00:33:03,070 --> 00:33:07,659
<font color="#CCCCCC">demon</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> is hanging all the NS</font>

718
00:33:05,710 --> 00:33:10,930
requests for the entire system

719
00:33:07,660 --> 00:33:13,750
so now and easily abuses it back to very

720
00:33:10,930 --> 00:33:17,110
<font color="#E5E5E5">cynically build a fully by correctional</font>

721
00:33:13,750 --> 00:33:19,840
<font color="#CCCCCC">commanded</font><font color="#E5E5E5"> troll chat</font><font color="#CCCCCC"> via DNS again is</font>

722
00:33:17,110 --> 00:33:22,750
the network requests<font color="#E5E5E5"> originated from the</font>

723
00:33:19,840 --> 00:33:26,500
trusted process<font color="#E5E5E5"> context of the system</font>

724
00:33:22,750 --> 00:33:30,130
<font color="#CCCCCC">DNS in the firewall</font><font color="#E5E5E5"> will</font><font color="#CCCCCC"> have no choice</font>

725
00:33:26,500 --> 00:33:31,840
<font color="#E5E5E5">let's use a lot DNS command control is</font>

726
00:33:30,130 --> 00:33:35,799
well understood so we will talk<font color="#E5E5E5"> about</font>

727
00:33:31,840 --> 00:33:37,600
how<font color="#E5E5E5"> to build such a protocol but suffice</font>

728
00:33:35,799 --> 00:33:40,059
it's<font color="#E5E5E5"> pretty easy to build one that</font><font color="#CCCCCC"> will</font>

729
00:33:37,600 --> 00:33:42,668
allow<font color="#CCCCCC"> you in DNS</font><font color="#E5E5E5"> requests to both pencil</font>

730
00:33:40,059 --> 00:33:45,120
trick data and also<font color="#E5E5E5"> gain</font><font color="#CCCCCC"> tasking from</font>

731
00:33:42,669 --> 00:33:47,679
<font color="#E5E5E5">our motion sir</font>

732
00:33:45,120 --> 00:33:50,668
next up let's talk about<font color="#CCCCCC"> abusing</font>

733
00:33:47,679 --> 00:33:53,440
<font color="#E5E5E5">browsers because</font><font color="#CCCCCC"> the simple fact is if</font>

734
00:33:50,669 --> 00:33:56,590
an infected system that has a browser

735
00:33:53,440 --> 00:33:59,649
<font color="#E5E5E5">and a user is using that router</font><font color="#CCCCCC"> it will</font>

736
00:33:56,590 --> 00:34:01,600
be given a discriminate<font color="#CCCCCC"> never access or</font>

737
00:33:59,649 --> 00:34:02,768
at least full<font color="#E5E5E5"> network access to any</font>

738
00:34:01,600 --> 00:34:05,590
remote web server

739
00:34:02,769 --> 00:34:08,949
you know HTTP urged yes and again

740
00:34:05,590 --> 00:34:11,918
<font color="#CCCCCC">impassively terms we can wash the user</font>

741
00:34:08,949 --> 00:34:13,388
first about<font color="#E5E5E5"> a few days to confirm ok yes</font>

742
00:34:11,918 --> 00:34:16,210
there<font color="#E5E5E5"> are for example using the Google</font>

743
00:34:13,389 --> 00:34:19,119
Chrome Google Chrome is able to talk<font color="#CCCCCC"> to</font>

744
00:34:16,210 --> 00:34:21,490
these hundreds<font color="#E5E5E5"> of thousands of sites so</font>

745
00:34:19,119 --> 00:34:24,820
again the firewall is going to trust<font color="#CCCCCC"> the</font>

746
00:34:21,489 --> 00:34:27,219
<font color="#CCCCCC">user's problem so let's abuse this back</font>

747
00:34:24,820 --> 00:34:30,070
to generate network traffic from the

748
00:34:27,219 --> 00:34:31,959
process context<font color="#E5E5E5"> a little browser that</font>

749
00:34:30,070 --> 00:34:35,399
the firewall<font color="#CCCCCC"> will have</font><font color="#E5E5E5"> no choice</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> to</font>

750
00:34:31,960 --> 00:34:37,960
lie<font color="#E5E5E5"> so the first way we do this is the</font>

751
00:34:35,399 --> 00:34:41,799
<font color="#E5E5E5">answers as you</font><font color="#CCCCCC"> can see on the slide</font>

752
00:34:37,960 --> 00:34:45,520
<font color="#E5E5E5">we're going</font><font color="#CCCCCC"> to incredibly ass Safari</font><font color="#E5E5E5"> to</font>

753
00:34:41,800 --> 00:34:48,129
browse invisibly to<font color="#E5E5E5"> an attacker control</font>

754
00:34:45,520 --> 00:34:52,359
command control sir<font color="#CCCCCC"> and we descend</font><font color="#E5E5E5"> and</font>

755
00:34:48,129 --> 00:34:55,149
<font color="#E5E5E5">you need a medic</font><font color="#CCCCCC"> so again very</font><font color="#E5E5E5"> simple</font>

756
00:34:52,359 --> 00:34:59,109
few lines<font color="#CCCCCC"> we're</font><font color="#E5E5E5"> basically telling this</font>

757
00:34:55,149 --> 00:35:01,960
bar a<font color="#CCCCCC"> browse to this URL</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> again</font><font color="#E5E5E5"> since</font>

758
00:34:59,109 --> 00:35:04,720
we<font color="#E5E5E5"> set the flag to his whole usual</font>

759
00:35:01,960 --> 00:35:06,880
<font color="#E5E5E5">service now get the firewall will see us</font>

760
00:35:04,720 --> 00:35:09,069
with us because<font color="#CCCCCC"> it sees everything but</font>

761
00:35:06,880 --> 00:35:12,069
it's coming<font color="#E5E5E5"> from the</font><font color="#CCCCCC"> user's browser</font>

762
00:35:09,069 --> 00:35:14,349
which via Ellis Waxman determinism

763
00:35:12,069 --> 00:35:16,810
access<font color="#CCCCCC"> network some firewalls can say</font>

764
00:35:14,349 --> 00:35:18,780
<font color="#CCCCCC">this is just</font><font color="#E5E5E5"> a network</font><font color="#CCCCCC"> request from the</font>

765
00:35:16,810 --> 00:35:23,740
browser<font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> gonna through</font><font color="#CCCCCC"> movie without</font>

766
00:35:18,780 --> 00:35:26,710
<font color="#E5E5E5">music</font><font color="#CCCCCC"> and even</font><font color="#E5E5E5"> a better way to generally</font>

767
00:35:23,740 --> 00:35:29,890
by mass firewalls is to abuse<font color="#E5E5E5"> browsers</font>

768
00:35:26,710 --> 00:35:32,349
internet line interfaces<font color="#E5E5E5"> really doesn't</font>

769
00:35:29,890 --> 00:35:34,060
<font color="#E5E5E5">get easier than</font><font color="#CCCCCC"> this again very easy</font><font color="#E5E5E5"> to</font>

770
00:35:32,349 --> 00:35:38,680
determine what the users default

771
00:35:34,060 --> 00:35:40,070
<font color="#CCCCCC">Azeris can be LFC was you know it is if</font>

772
00:35:38,680 --> 00:35:43,009
you confirm that<font color="#E5E5E5"> yes</font>

773
00:35:40,070 --> 00:35:45,410
talk to<font color="#CCCCCC"> Amira most network server</font>

774
00:35:43,010 --> 00:35:48,830
<font color="#CCCCCC">endpoints and then what we can do is all</font>

775
00:35:45,410 --> 00:35:50,210
water browsers now support and<font color="#CCCCCC"> - so then</font>

776
00:35:48,830 --> 00:35:53,180
<font color="#E5E5E5">you can just</font><font color="#CCCCCC"> execute that on the</font>

777
00:35:50,210 --> 00:35:56,180
terminal and specify a<font color="#E5E5E5"> URL and</font><font color="#CCCCCC"> one to</font>

778
00:35:53,180 --> 00:36:04,810
browse again<font color="#CCCCCC"> using grammar and coding</font>

779
00:35:56,180 --> 00:36:04,810
you can<font color="#E5E5E5"> specify any</font><font color="#CCCCCC"> game users</font><font color="#E5E5E5"> whether</font>

780
00:36:05,740 --> 00:36:10,339
the response will also<font color="#E5E5E5"> come back and you</font>

781
00:36:08,330 --> 00:36:12,259
<font color="#E5E5E5">will be able to</font><font color="#CCCCCC"> be muscles</font><font color="#E5E5E5"> so you</font><font color="#CCCCCC"> can</font>

782
00:36:10,340 --> 00:36:15,560
see what you invoke the command control

783
00:36:12,260 --> 00:36:18,680
server as<font color="#CCCCCC"> well which divides the</font><font color="#E5E5E5"> meeting</font>

784
00:36:15,560 --> 00:36:21,020
is to express<font color="#E5E5E5"> by I'm casting to not</font>

785
00:36:18,680 --> 00:36:22,970
again the<font color="#CCCCCC"> fireman will see this network</font>

786
00:36:21,020 --> 00:36:25,040
<font color="#CCCCCC">shot but because it's coming from the</font>

787
00:36:22,970 --> 00:36:26,509
trusted context of the browser<font color="#E5E5E5"> it will</font>

788
00:36:25,040 --> 00:36:32,350
<font color="#CCCCCC">limit the trip</font>

789
00:36:26,510 --> 00:36:35,570
no questions asked another way to<font color="#CCCCCC"> of</font><font color="#E5E5E5"> use</font>

790
00:36:32,350 --> 00:36:38,060
or another technique<font color="#E5E5E5"> to abuse any</font>

791
00:36:35,570 --> 00:36:41,630
program that's trusted to bypass

792
00:36:38,060 --> 00:36:44,840
firewalls<font color="#E5E5E5"> generically is to inject</font><font color="#CCCCCC"> rasta</font>

793
00:36:41,630 --> 00:36:46,640
inject code into that<font color="#CCCCCC"> masts again</font>

794
00:36:44,840 --> 00:36:49,940
firewalls are going to trust specific

795
00:36:46,640 --> 00:36:53,390
programs browser<font color="#E5E5E5"> chat location whatever</font>

796
00:36:49,940 --> 00:36:56,300
<font color="#E5E5E5">and so if you can inject code into those</font>

797
00:36:53,390 --> 00:36:58,879
processes<font color="#E5E5E5"> and then generate the network</font>

798
00:36:56,300 --> 00:37:01,310
<font color="#E5E5E5">request</font><font color="#CCCCCC"> from</font><font color="#E5E5E5"> the firewall</font><font color="#CCCCCC"> will see that</font>

799
00:36:58,880 --> 00:37:04,490
but<font color="#E5E5E5"> because it's coming</font><font color="#CCCCCC"> from</font><font color="#E5E5E5"> within the</font>

800
00:37:01,310 --> 00:37:07,190
<font color="#E5E5E5">trusted process context it will be</font>

801
00:37:04,490 --> 00:37:13,009
allowed so<font color="#CCCCCC"> there's a</font><font color="#E5E5E5"> variety of ways new</font>

802
00:37:07,190 --> 00:37:15,170
process objections on<font color="#E5E5E5"> Mac OS so first up</font>

803
00:37:13,010 --> 00:37:18,320
in is traditional injection

804
00:37:15,170 --> 00:37:22,460
now generally<font color="#CCCCCC"> Apple will block this if</font>

805
00:37:18,320 --> 00:37:25,100
you're trying to<font color="#E5E5E5"> inject into a process</font>

806
00:37:22,460 --> 00:37:27,590
but if you're<font color="#E5E5E5"> trying to inject them to a</font>

807
00:37:25,100 --> 00:37:30,440
<font color="#E5E5E5">third-party application this generally</font>

808
00:37:27,590 --> 00:37:32,300
still works<font color="#CCCCCC"> so again I think in German</font>

809
00:37:30,440 --> 00:37:34,640
what<font color="#E5E5E5"> third-party applications are</font>

810
00:37:32,300 --> 00:37:37,580
<font color="#E5E5E5">allowed Network for example</font>

811
00:37:34,640 --> 00:37:39,799
I have slack<font color="#E5E5E5"> install online system and I</font>

812
00:37:37,580 --> 00:37:43,700
told my firewall yes slack is allowed to

813
00:37:39,800 --> 00:37:45,590
<font color="#E5E5E5">talk</font><font color="#CCCCCC"> to you you know</font><font color="#E5E5E5"> so what I'm going</font>

814
00:37:43,700 --> 00:37:47,750
to do is they<font color="#E5E5E5"> can determine that and</font>

815
00:37:45,590 --> 00:37:50,750
then they<font color="#E5E5E5"> can inject code into slack and</font>

816
00:37:47,750 --> 00:37:53,540
gain<font color="#E5E5E5"> access to the network</font><font color="#CCCCCC"> so what we do</font>

817
00:37:50,750 --> 00:37:57,170
is we first remotely allocate memory in

818
00:37:53,540 --> 00:38:00,020
the slacks and space and then we just

819
00:37:57,170 --> 00:38:02,570
copy just<font color="#E5E5E5"> a</font><font color="#CCCCCC"> Michele code</font><font color="#E5E5E5"> loaded dynamic</font>

820
00:38:00,020 --> 00:38:03,980
<font color="#CCCCCC">library and execute I remember requests</font>

821
00:38:02,570 --> 00:38:05,900
from there again<font color="#CCCCCC"> the fire round where I</font>

822
00:38:03,980 --> 00:38:08,300
see is<font color="#CCCCCC"> request but it's</font><font color="#E5E5E5"> it's coming from</font>

823
00:38:05,900 --> 00:38:12,320
a<font color="#E5E5E5"> trusted allowed process it will be</font>

824
00:38:08,300 --> 00:38:15,310
allowed another investment<font color="#E5E5E5"> to inject the</font>

825
00:38:12,320 --> 00:38:18,650
dynamic library at<font color="#CCCCCC"> low tonight is to</font><font color="#E5E5E5"> use</font>

826
00:38:15,310 --> 00:38:21,320
<font color="#E5E5E5">environments so you can</font><font color="#CCCCCC"> use the dy LD</font>

827
00:38:18,650 --> 00:38:23,450
insert libraries environment<font color="#E5E5E5"> variables</font>

828
00:38:21,320 --> 00:38:26,780
<font color="#CCCCCC">and this tells</font><font color="#E5E5E5"> the operating system to</font>

829
00:38:23,450 --> 00:38:30,649
at<font color="#CCCCCC"> load time please execute whatever</font>

830
00:38:26,780 --> 00:38:32,990
<font color="#CCCCCC">diability specify in process context</font><font color="#E5E5E5"> of</font>

831
00:38:30,650 --> 00:38:35,750
the application<font color="#CCCCCC"> use festival</font><font color="#E5E5E5"> so again</font>

832
00:38:32,990 --> 00:38:38,060
here we<font color="#CCCCCC"> turned it back we basically give</font>

833
00:38:35,750 --> 00:38:40,430
<font color="#CCCCCC">it the path to</font><font color="#E5E5E5"> our malicious dialer</font>

834
00:38:38,060 --> 00:38:41,960
again in this dynamic<font color="#E5E5E5"> library is the one</font>

835
00:38:40,430 --> 00:38:43,339
<font color="#E5E5E5">that's going to do to</font><font color="#CCCCCC"> network command</font>

836
00:38:41,960 --> 00:38:46,790
and control that the<font color="#E5E5E5"> firewall would</font>

837
00:38:43,340 --> 00:38:49,310
<font color="#CCCCCC">attack but since it is loaded into the</font>

838
00:38:46,790 --> 00:38:52,220
process context<font color="#E5E5E5"> of slack which on my</font>

839
00:38:49,310 --> 00:38:54,920
<font color="#E5E5E5">systems is trusted once the dynamic</font>

840
00:38:52,220 --> 00:38:57,290
library gets loaded if we have<font color="#CCCCCC"> custom</font>

841
00:38:54,920 --> 00:38:59,660
instructor this<font color="#E5E5E5"> will be executed</font><font color="#CCCCCC"> the</font>

842
00:38:57,290 --> 00:39:02,300
guys would be executed<font color="#E5E5E5"> within slack so</font>

843
00:38:59,660 --> 00:39:05,950
the firewall<font color="#CCCCCC"> will allow it because the</font>

844
00:39:02,300 --> 00:39:05,950
network<font color="#CCCCCC"> request is coming</font><font color="#E5E5E5"> from within</font>

845
00:39:06,670 --> 00:39:10,810
<font color="#CCCCCC">next up another</font><font color="#E5E5E5"> kind of injection</font>

846
00:39:08,960 --> 00:39:14,060
<font color="#E5E5E5">technique is something I like to call</font>

847
00:39:10,810 --> 00:39:16,549
dilated proxy which<font color="#CCCCCC"> a conceptually this</font>

848
00:39:14,060 --> 00:39:18,740
<font color="#E5E5E5">is</font><font color="#CCCCCC"> fairly simple</font><font color="#E5E5E5"> what you do is you</font>

849
00:39:16,550 --> 00:39:21,410
target an application<font color="#E5E5E5"> that's allowed to</font>

850
00:39:18,740 --> 00:39:23,660
<font color="#CCCCCC">access the network and</font><font color="#E5E5E5"> you find a</font>

851
00:39:21,410 --> 00:39:25,970
dynamic library<font color="#E5E5E5"> or a framework that</font>

852
00:39:23,660 --> 00:39:28,549
<font color="#CCCCCC">makes</font><font color="#E5E5E5"> yes</font><font color="#CCCCCC"> and you just release back</font>

853
00:39:25,970 --> 00:39:31,220
<font color="#CCCCCC">within</font><font color="#E5E5E5"> a malicious one so for</font>

854
00:39:28,550 --> 00:39:33,680
third-party<font color="#E5E5E5"> applications the operating</font>

855
00:39:31,220 --> 00:39:35,839
system will not validate<font color="#CCCCCC"> that that's not</font>

856
00:39:33,680 --> 00:39:39,049
being tender it so<font color="#E5E5E5"> we'll naive mean it</font>

857
00:39:35,840 --> 00:39:40,940
blindly blow your malicious died

858
00:39:39,050 --> 00:39:42,980
<font color="#CCCCCC">is the</font><font color="#E5E5E5"> original one that you approached</font>

859
00:39:40,940 --> 00:39:45,800
<font color="#CCCCCC">again once you're then in the process</font>

860
00:39:42,980 --> 00:39:48,860
<font color="#CCCCCC">space you can connect</font><font color="#E5E5E5"> that without</font>

861
00:39:45,800 --> 00:39:51,590
worrying<font color="#CCCCCC"> about a firewall</font><font color="#E5E5E5"> so in</font>

862
00:39:48,860 --> 00:39:53,350
<font color="#E5E5E5">Florida's proxying what you do is you</font>

863
00:39:51,590 --> 00:39:56,540
first make a copy<font color="#CCCCCC"> of the</font><font color="#E5E5E5"> original</font>

864
00:39:53,350 --> 00:39:58,940
<font color="#E5E5E5">dynamic library and then what you do</font><font color="#CCCCCC"> is</font>

865
00:39:56,540 --> 00:40:02,210
you save your malicious<font color="#CCCCCC"> batiment with</font>

866
00:39:58,940 --> 00:40:04,610
<font color="#E5E5E5">the same name of original dynamic</font>

867
00:40:02,210 --> 00:40:07,670
library and what they<font color="#CCCCCC"> doing is you also</font>

868
00:40:04,610 --> 00:40:10,670
then forward or proxy all symbols and

869
00:40:07,670 --> 00:40:12,800
exported<font color="#CCCCCC"> methods functions to the</font>

870
00:40:10,670 --> 00:40:15,280
original buyer<font color="#CCCCCC"> because sort of break</font>

871
00:40:12,800 --> 00:40:25,770
<font color="#E5E5E5">legitimate</font>

872
00:40:15,280 --> 00:40:25,770
[Music]

873
00:40:33,360 --> 00:40:41,200
<font color="#CCCCCC">all right so every</font><font color="#E5E5E5"> okay yes so if you</font>

874
00:40:38,350 --> 00:40:43,779
blindly just replace a dynamic<font color="#CCCCCC"> library</font>

875
00:40:41,200 --> 00:40:46,689
<font color="#E5E5E5">than</font><font color="#CCCCCC"> applications link and</font><font color="#E5E5E5"> you don't</font>

876
00:40:43,780 --> 00:40:48,670
<font color="#E5E5E5">forward the symbols or the methods that</font>

877
00:40:46,690 --> 00:40:50,470
<font color="#E5E5E5">the application expects when the</font>

878
00:40:48,670 --> 00:40:51,940
attribution<font color="#CCCCCC"> one of the loader try some</font>

879
00:40:50,470 --> 00:40:54,370
of the applications<font color="#CCCCCC"> this is just</font><font color="#E5E5E5"> going</font>

880
00:40:51,940 --> 00:40:56,920
<font color="#E5E5E5">to crash so what we do is we basically</font>

881
00:40:54,370 --> 00:40:59,650
<font color="#E5E5E5">tell the loader and you can do this with</font>

882
00:40:56,920 --> 00:41:02,440
various linker<font color="#CCCCCC"> directives</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> any</font>

883
00:40:59,650 --> 00:41:06,130
requests in this malicious library for

884
00:41:02,440 --> 00:41:10,270
the symbols<font color="#E5E5E5"> and methods should be proxy</font>

885
00:41:06,130 --> 00:41:11,650
to the<font color="#E5E5E5"> original you</font><font color="#CCCCCC"> can specify that so</font>

886
00:41:10,270 --> 00:41:14,050
if you do this everything works

887
00:41:11,650 --> 00:41:16,630
seamlessly transparently<font color="#E5E5E5"> this is</font>

888
00:41:14,050 --> 00:41:19,000
actually a<font color="#E5E5E5"> very powerful technique that</font>

889
00:41:16,630 --> 00:41:21,370
I'm gonna<font color="#E5E5E5"> surprise more malware as</font><font color="#CCCCCC"> abuse</font>

890
00:41:19,000 --> 00:41:24,040
because not only is<font color="#CCCCCC"> it a great</font><font color="#E5E5E5"> way to</font>

891
00:41:21,370 --> 00:41:27,040
gain persistence<font color="#E5E5E5"> also a very stealthy</font>

892
00:41:24,040 --> 00:41:29,230
way to gain<font color="#E5E5E5"> to an execution in</font>

893
00:41:27,040 --> 00:41:30,670
<font color="#CCCCCC">third-party</font><font color="#E5E5E5"> applications which then</font>

894
00:41:29,230 --> 00:41:35,070
<font color="#CCCCCC">allows you new things like access</font>

895
00:41:30,670 --> 00:41:38,680
<font color="#E5E5E5">network now the final way to bypass</font>

896
00:41:35,070 --> 00:41:41,890
generically<font color="#E5E5E5"> any third party firewall</font>

897
00:41:38,680 --> 00:41:44,710
product is to get code execution<font color="#E5E5E5"> evening</font>

898
00:41:41,890 --> 00:41:46,660
<font color="#E5E5E5">to come in short an attacker can load a</font>

899
00:41:44,710 --> 00:41:49,630
<font color="#E5E5E5">Chrome</font><font color="#CCCCCC"> extension or find a way to</font>

900
00:41:46,660 --> 00:41:51,819
execute<font color="#E5E5E5"> code in the context of the</font>

901
00:41:49,630 --> 00:41:55,570
kernel<font color="#CCCCCC"> they all have no problem by</font>

902
00:41:51,820 --> 00:41:58,270
<font color="#CCCCCC">maksim first those firewalls</font><font color="#E5E5E5"> generically</font>

903
00:41:55,570 --> 00:42:00,580
<font color="#E5E5E5">allow any code or</font><font color="#CCCCCC"> any</font><font color="#E5E5E5"> network</font>

904
00:41:58,270 --> 00:42:03,280
connections that<font color="#CCCCCC"> originated from a comma</font>

905
00:42:00,580 --> 00:42:06,759
<font color="#CCCCCC">so for example</font><font color="#E5E5E5"> is source code for</font><font color="#CCCCCC"> Lulu</font>

906
00:42:03,280 --> 00:42:09,580
we can see<font color="#E5E5E5"> that fully trusts</font><font color="#CCCCCC"> websites</font>

907
00:42:06,760 --> 00:42:11,800
and<font color="#E5E5E5"> this is because it assumes as do all</font>

908
00:42:09,580 --> 00:42:14,170
of their firewall products<font color="#E5E5E5"> then if</font>

909
00:42:11,800 --> 00:42:16,510
<font color="#E5E5E5">something is executing from the kernel</font>

910
00:42:14,170 --> 00:42:19,750
that's<font color="#E5E5E5"> probably something from the</font>

911
00:42:16,510 --> 00:42:21,940
system so<font color="#CCCCCC"> as she's</font><font color="#E5E5E5"> not you're blocking</font>

912
00:42:19,750 --> 00:42:23,200
<font color="#CCCCCC">all sockets you know potentially you can</font>

913
00:42:21,940 --> 00:42:25,910
break all sorts of legitimate

914
00:42:23,200 --> 00:42:28,830
functionality<font color="#E5E5E5"> of the</font>

915
00:42:25,910 --> 00:42:31,770
also<font color="#CCCCCC"> if you're the colonel</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> can do</font>

916
00:42:28,830 --> 00:42:34,819
more subversive<font color="#E5E5E5"> things like actually</font>

917
00:42:31,770 --> 00:42:36,060
<font color="#E5E5E5">unhook or unregister</font><font color="#CCCCCC"> any installed</font>

918
00:42:34,820 --> 00:42:37,530
<font color="#CCCCCC">library</font>

919
00:42:36,060 --> 00:42:39,270
so the<font color="#CCCCCC"> beginning we talked about</font><font color="#E5E5E5"> these</font>

920
00:42:37,530 --> 00:42:41,460
<font color="#CCCCCC">sonic filters and</font><font color="#E5E5E5"> we</font><font color="#CCCCCC"> talked about how</font>

921
00:42:39,270 --> 00:42:43,920
<font color="#CCCCCC">you register them</font><font color="#E5E5E5"> when you register them</font>

922
00:42:41,460 --> 00:42:45,960
that<font color="#CCCCCC"> basically adds your</font><font color="#E5E5E5"> socket filter</font>

923
00:42:43,920 --> 00:42:47,460
to a linked list or some other kernel

924
00:42:45,960 --> 00:42:50,040
structure<font color="#CCCCCC"> there's nothing to say that</font>

925
00:42:47,460 --> 00:42:51,570
<font color="#E5E5E5">and it factors for a level</font><font color="#CCCCCC"> code doesn't</font>

926
00:42:50,040 --> 00:42:54,750
go<font color="#E5E5E5"> through those structures and</font>

927
00:42:51,570 --> 00:42:57,240
basically registers<font color="#E5E5E5"> so again this will</font>

928
00:42:54,750 --> 00:43:00,210
transparently disable the firewall and

929
00:42:57,240 --> 00:43:03,750
then<font color="#E5E5E5"> a lot any attacker code to network</font>

930
00:43:00,210 --> 00:43:05,640
<font color="#E5E5E5">without alerting easily now the last</font>

931
00:43:03,750 --> 00:43:09,540
question<font color="#E5E5E5"> is how do we get</font><font color="#CCCCCC"> a code buddy</font>

932
00:43:05,640 --> 00:43:12,830
in crime<font color="#CCCCCC"> on recent versions of Mac OS /</font>

933
00:43:09,540 --> 00:43:15,950
<font color="#CCCCCC">extensions have to be designed</font><font color="#E5E5E5"> so some a</font>

934
00:43:12,830 --> 00:43:19,380
really good way to<font color="#E5E5E5"> bypass this code</font>

935
00:43:15,950 --> 00:43:22,919
requirement is simply<font color="#CCCCCC"> break a buggy</font>

936
00:43:19,380 --> 00:43:25,830
<font color="#E5E5E5">albeit sign third party driver</font><font color="#CCCCCC"> to your</font>

937
00:43:22,920 --> 00:43:27,570
<font color="#E5E5E5">permit load that kernel extension the</font>

938
00:43:25,830 --> 00:43:29,580
operating<font color="#E5E5E5"> system will allow because it's</font>

939
00:43:27,570 --> 00:43:32,370
<font color="#CCCCCC">signed and</font><font color="#E5E5E5"> then</font><font color="#CCCCCC"> you locally exploit that</font>

940
00:43:29,580 --> 00:43:36,480
to<font color="#E5E5E5"> gain code execution in the context of</font>

941
00:43:32,370 --> 00:43:39,890
the time<font color="#E5E5E5"> interestingly the slingshot apt</font>

942
00:43:36,480 --> 00:43:42,030
did exactly this on<font color="#E5E5E5"> Windows to bypass</font>

943
00:43:39,890 --> 00:43:45,000
<font color="#E5E5E5">Microsoft's home code signing</font>

944
00:43:42,030 --> 00:43:47,940
endorsement<font color="#E5E5E5"> so I talked about this</font>

945
00:43:45,000 --> 00:43:49,890
attack in attack on a few years<font color="#CCCCCC"> ago</font>

946
00:43:47,940 --> 00:43:53,160
<font color="#E5E5E5">specifically showing how we could use</font>

947
00:43:49,890 --> 00:43:54,720
<font color="#CCCCCC">the buggy Little Snitch</font><font color="#E5E5E5"> extension which</font>

948
00:43:53,160 --> 00:43:57,089
you talk<font color="#CCCCCC"> about the exploitable people</font>

949
00:43:54,720 --> 00:43:59,970
<font color="#CCCCCC">Rizzo again you just bring that</font><font color="#E5E5E5"> kernel</font>

950
00:43:57,090 --> 00:44:01,800
extension with you to a target load<font color="#E5E5E5"> that</font>

951
00:43:59,970 --> 00:44:03,750
the operating system<font color="#E5E5E5"> would</font><font color="#CCCCCC"> allow it</font>

952
00:44:01,800 --> 00:44:06,000
<font color="#CCCCCC">because it's that sign and then</font><font color="#E5E5E5"> you</font>

953
00:44:03,750 --> 00:44:08,730
exploit<font color="#E5E5E5"> the vulnerability to</font><font color="#CCCCCC"> gain code</font>

954
00:44:06,000 --> 00:44:10,890
execution problems<font color="#CCCCCC"> since then</font><font color="#E5E5E5"> Apple has</font>

955
00:44:08,730 --> 00:44:14,550
added something called<font color="#CCCCCC"> user</font><font color="#E5E5E5"> approved</font>

956
00:44:10,890 --> 00:44:17,879
<font color="#E5E5E5">kernel kernel extensions</font><font color="#CCCCCC"> look basically</font>

957
00:44:14,550 --> 00:44:21,210
<font color="#CCCCCC">they say ok</font><font color="#E5E5E5"> this kernel extension is</font>

958
00:44:17,880 --> 00:44:22,400
fine but we want the user to manually

959
00:44:21,210 --> 00:44:25,640
approve

960
00:44:22,400 --> 00:44:28,250
so that it<font color="#CCCCCC"> unlocks exactly this opponent</font>

961
00:44:25,640 --> 00:44:30,799
turns out the<font color="#CCCCCC"> waited and would</font><font color="#E5E5E5"> that had</font>

962
00:44:28,250 --> 00:44:34,040
a<font color="#CCCCCC"> flaw</font><font color="#E5E5E5"> you can send this synthetic</font><font color="#CCCCCC"> click</font>

963
00:44:30,800 --> 00:44:35,990
to<font color="#E5E5E5"> it</font><font color="#CCCCCC"> reported this battle and</font><font color="#E5E5E5"> envisions</font>

964
00:44:34,040 --> 00:44:38,750
<font color="#CCCCCC">that at the time they believe that</font>

965
00:44:35,990 --> 00:44:40,790
<font color="#E5E5E5">everything connects but I've turned out</font>

966
00:44:38,750 --> 00:44:42,770
they had<font color="#CCCCCC"> another flaw in their</font>

967
00:44:40,790 --> 00:44:45,710
implementation<font color="#CCCCCC"> so they try to</font><font color="#E5E5E5"> protect</font>

968
00:44:42,770 --> 00:44:47,780
the button that asks the users who allow

969
00:44:45,710 --> 00:44:49,400
<font color="#CCCCCC">prevalence tension</font><font color="#E5E5E5"> because if there was</font>

970
00:44:47,780 --> 00:44:51,710
a way for<font color="#E5E5E5"> us</font><font color="#CCCCCC"> to improve I matically</font>

971
00:44:49,400 --> 00:44:53,540
interface with<font color="#E5E5E5"> that button</font><font color="#CCCCCC"> as a local</font>

972
00:44:51,710 --> 00:44:55,220
piece of power<font color="#CCCCCC"> we could just</font><font color="#E5E5E5"> send the</font>

973
00:44:53,540 --> 00:44:57,950
synthetic<font color="#E5E5E5"> emmaus clicking click Wow</font>

974
00:44:55,220 --> 00:44:59,750
<font color="#E5E5E5">basically masquerading as users which</font>

975
00:44:57,950 --> 00:45:02,419
would completely make that alert

976
00:44:59,750 --> 00:45:04,670
<font color="#CCCCCC">worthless</font><font color="#E5E5E5"> so turned out even</font><font color="#CCCCCC"> though</font>

977
00:45:02,420 --> 00:45:07,100
<font color="#CCCCCC">never match the original attack vector</font>

978
00:45:04,670 --> 00:45:10,250
there was another flaw and way<font color="#E5E5E5"> to</font><font color="#CCCCCC"> handle</font>

979
00:45:07,100 --> 00:45:12,860
<font color="#E5E5E5">synthetic X so we're</font><font color="#CCCCCC"> gonna do is you can</font>

980
00:45:10,250 --> 00:45:16,490
<font color="#E5E5E5">actually send a mouse down event and</font>

981
00:45:12,860 --> 00:45:18,980
then send another<font color="#E5E5E5"> mass element to this</font>

982
00:45:16,490 --> 00:45:21,529
<font color="#E5E5E5">button and for some</font><font color="#CCCCCC"> other reason when</font>

983
00:45:18,980 --> 00:45:23,840
the operating saw operating system saw

984
00:45:21,530 --> 00:45:26,720
that<font color="#CCCCCC"> site maps downwards</font><font color="#E5E5E5"> it</font><font color="#CCCCCC"> would</font>

985
00:45:23,840 --> 00:45:29,270
<font color="#CCCCCC">translate it to amounts object this</font>

986
00:45:26,720 --> 00:45:33,680
button which<font color="#E5E5E5"> is filtering for synthetic</font>

987
00:45:29,270 --> 00:45:36,020
<font color="#CCCCCC">events would see that the mouse up event</font>

988
00:45:33,680 --> 00:45:39,430
was coming from the<font color="#E5E5E5"> kernel and thus</font>

989
00:45:36,020 --> 00:45:42,830
would laugh<font color="#E5E5E5"> so</font><font color="#CCCCCC"> always do bypass this</font>

990
00:45:39,430 --> 00:45:46,460
<font color="#E5E5E5">touted foundational security mechanism</font>

991
00:45:42,830 --> 00:45:49,009
will send<font color="#CCCCCC"> two mountains</font><font color="#E5E5E5"> that's a lot of</font>

992
00:45:46,460 --> 00:45:51,620
grief for their security<font color="#E5E5E5"> sure it should</font>

993
00:45:49,010 --> 00:45:53,630
I think<font color="#CCCCCC"> this is a great example of you</font>

994
00:45:51,620 --> 00:45:55,670
know<font color="#E5E5E5"> it's really not that hard</font><font color="#CCCCCC"> to fly</font>

995
00:45:53,630 --> 00:45:57,350
past<font color="#E5E5E5"> a lot of</font><font color="#CCCCCC"> their security</font><font color="#E5E5E5"> mechanisms</font>

996
00:45:55,670 --> 00:45:58,720
regardless of what you are<font color="#CCCCCC"> their</font>

997
00:45:57,350 --> 00:46:01,160
marketing team<font color="#CCCCCC"> testers</font>

998
00:45:58,720 --> 00:46:04,250
<font color="#CCCCCC">alright so let's wrap this all up so</font>

999
00:46:01,160 --> 00:46:07,819
<font color="#CCCCCC">today we talked first about building a</font>

1000
00:46:04,250 --> 00:46:10,970
firewall<font color="#E5E5E5"> for us we showed that</font><font color="#CCCCCC"> using</font>

1001
00:46:07,820 --> 00:46:13,580
socket<font color="#E5E5E5"> filters you</font><font color="#CCCCCC"> can very easily build</font>

1002
00:46:10,970 --> 00:46:15,950
a very powerful<font color="#CCCCCC"> currents mission in the</font>

1003
00:46:13,580 --> 00:46:17,990
firewall<font color="#CCCCCC"> for back to us</font><font color="#E5E5E5"> when we brought</font>

1004
00:46:15,950 --> 00:46:19,419
this all together with<font color="#CCCCCC"> Lou Lou Lou</font><font color="#E5E5E5"> is a</font>

1005
00:46:17,990 --> 00:46:23,020
full conference

1006
00:46:19,420 --> 00:46:24,520
if<font color="#E5E5E5"> free</font><font color="#CCCCCC"> open-source firewall for</font><font color="#E5E5E5"> us so</font>

1007
00:46:23,020 --> 00:46:26,950
if you're interested<font color="#CCCCCC"> in kind</font><font color="#E5E5E5"> of more of</font>

1008
00:46:24,520 --> 00:46:28,960
the details or running<font color="#CCCCCC"> Chrome or brass</font>

1009
00:46:26,950 --> 00:46:32,890
extending the product<font color="#E5E5E5"> check out the</font>

1010
00:46:28,960 --> 00:46:34,960
source code on github is also there we

1011
00:46:32,890 --> 00:46:38,230
then kind<font color="#E5E5E5"> of changed ears and talked</font>

1012
00:46:34,960 --> 00:46:41,349
about<font color="#E5E5E5"> how to bypass these products turns</font>

1013
00:46:38,230 --> 00:46:43,420
out that<font color="#E5E5E5"> firewalls or complex</font><font color="#CCCCCC"> pieces of</font>

1014
00:46:41,349 --> 00:46:46,630
software so a lot of times have

1015
00:46:43,420 --> 00:46:49,690
exploitable<font color="#E5E5E5"> security bugs so out of the</font>

1016
00:46:46,630 --> 00:46:53,740
<font color="#E5E5E5">way and we also showed that the sad</font>

1017
00:46:49,690 --> 00:46:55,750
reality is<font color="#CCCCCC"> that even though no bird it</font>

1018
00:46:53,740 --> 00:46:58,930
is<font color="#E5E5E5"> utilizing these text me techniques</font>

1019
00:46:55,750 --> 00:47:01,960
<font color="#E5E5E5">today it's actually</font><font color="#CCCCCC"> very very</font><font color="#E5E5E5"> easy to</font>

1020
00:46:58,930 --> 00:47:05,230
generically<font color="#E5E5E5"> bypass any third party Mac</font>

1021
00:47:01,960 --> 00:47:07,420
security<font color="#E5E5E5"> right now I just want to end by</font>

1022
00:47:05,230 --> 00:47:09,430
noting that<font color="#E5E5E5"> this means that this doesn't</font>

1023
00:47:07,420 --> 00:47:11,410
<font color="#E5E5E5">mean that firewalls are useless</font>

1024
00:47:09,430 --> 00:47:15,359
but it really makes the case for<font color="#CCCCCC"> a</font>

1025
00:47:11,410 --> 00:47:18,098
<font color="#E5E5E5">defense and death strategy and I fell</font>

1026
00:47:15,359 --> 00:47:20,290
into this mentality myself where I said

1027
00:47:18,099 --> 00:47:22,630
<font color="#E5E5E5">okay you know 80 products</font><font color="#CCCCCC"> returning crap</font>

1028
00:47:20,290 --> 00:47:24,549
all I need<font color="#E5E5E5"> is a firewall locked</font>

1029
00:47:22,630 --> 00:47:26,829
well this research<font color="#CCCCCC"> really showed that</font>

1030
00:47:24,549 --> 00:47:29,410
that was not the<font color="#E5E5E5"> case</font><font color="#CCCCCC"> it's really a good</font>

1031
00:47:26,829 --> 00:47:31,510
idea<font color="#E5E5E5"> to</font><font color="#CCCCCC"> have other security products for</font>

1032
00:47:29,410 --> 00:47:33,578
example<font color="#CCCCCC"> perhaps</font><font color="#E5E5E5"> with something that's</font>

1033
00:47:31,510 --> 00:47:35,619
right an awful block with off the<font color="#CCCCCC"> box</font>

1034
00:47:33,579 --> 00:47:38,799
that's monitoring<font color="#E5E5E5"> the network that is</font>

1035
00:47:35,619 --> 00:47:41,650
able<font color="#E5E5E5"> to understand for example you DNS</font>

1036
00:47:38,799 --> 00:47:45,460
protocol<font color="#E5E5E5"> and detect that</font><font color="#CCCCCC"> a user's locks</font>

1037
00:47:41,650 --> 00:47:46,990
<font color="#CCCCCC">to am sending the invest requests right</font>

1038
00:47:45,460 --> 00:47:49,119
this<font color="#E5E5E5"> isn't something a firewall is ever</font>

1039
00:47:46,990 --> 00:47:51,250
going to<font color="#E5E5E5"> or should</font><font color="#CCCCCC"> it ever understand</font>

1040
00:47:49,119 --> 00:47:53,980
<font color="#E5E5E5">but you know we should</font><font color="#CCCCCC"> have other</font>

1041
00:47:51,250 --> 00:47:57,970
security software in place that can

1042
00:47:53,980 --> 00:47:59,770
detect this community and by<font color="#CCCCCC"> races</font><font color="#E5E5E5"> your</font>

1043
00:47:57,970 --> 00:48:03,040
ear<font color="#CCCCCC"> listen to my Mac security talk I</font>

1044
00:47:59,770 --> 00:48:04,690
mean you're interested in security just

1045
00:48:03,040 --> 00:48:07,450
briefly want<font color="#CCCCCC"> to mention that this</font>

1046
00:48:04,690 --> 00:48:11,290
November will be<font color="#E5E5E5"> a brand-new</font><font color="#CCCCCC"> master</font>

1047
00:48:07,450 --> 00:48:13,930
<font color="#E5E5E5">conference yeah we have alignment of</font>

1048
00:48:11,290 --> 00:48:16,960
<font color="#E5E5E5">awesome speakers so get interested in</font>

1049
00:48:13,930 --> 00:48:20,230
backstreet by<font color="#E5E5E5"> us check it out</font><font color="#CCCCCC"> it's</font>

1050
00:48:16,960 --> 00:48:22,569
called objective magazine all right so

1051
00:48:20,230 --> 00:48:24,400
that's<font color="#E5E5E5"> around</font><font color="#CCCCCC"> really want</font><font color="#E5E5E5"> to thank you</font>

1052
00:48:22,569 --> 00:48:26,570
<font color="#E5E5E5">for attending</font><font color="#CCCCCC"> and Bruce II also</font><font color="#E5E5E5"> want to</font>

1053
00:48:24,400 --> 00:48:31,360
thank the Friends of objectives

1054
00:48:26,570 --> 00:48:33,530
the history<font color="#CCCCCC"> Malwarebytes</font><font color="#E5E5E5"> and apparently</font>

1055
00:48:31,360 --> 00:48:37,130
<font color="#CCCCCC">Kenny's</font><font color="#E5E5E5"> in this conference or shy</font><font color="#CCCCCC"> asks</font>

1056
00:48:33,530 --> 00:48:38,930
<font color="#CCCCCC">any questions I'll be around</font><font color="#E5E5E5"> for the</font>

1057
00:48:37,130 --> 00:48:41,480
rest<font color="#E5E5E5"> of the conference</font><font color="#CCCCCC"> so if you</font><font color="#E5E5E5"> were</font>

1058
00:48:38,930 --> 00:48:47,450
interested<font color="#E5E5E5"> in chatting more about our</font>

1059
00:48:41,480 --> 00:48:49,280
Mac security<font color="#CCCCCC"> surveys bypass firewalls</font><font color="#E5E5E5"> so</font>

1060
00:48:47,450 --> 00:48:54,080
again thank<font color="#CCCCCC"> you so much</font><font color="#E5E5E5"> also thanks</font><font color="#CCCCCC"> to</font>

1061
00:48:49,280 --> 00:48:59,230
Jay everyone else<font color="#E5E5E5"> at a conference and</font>

1062
00:48:54,080 --> 00:48:59,230
<font color="#E5E5E5">research so they give me</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> time</font>

