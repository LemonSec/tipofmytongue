1
00:00:00,640 --> 00:00:02,879
we'll welcome gavin

2
00:00:02,879 --> 00:00:05,200
along um sorry we're overrunning a

3
00:00:05,200 --> 00:00:06,799
little bit but you've got exactly the

4
00:00:06,799 --> 00:00:08,639
amount of time that you've requested in

5
00:00:08,639 --> 00:00:10,719
your talk we promise you

6
00:00:10,719 --> 00:00:14,160
um you're ready to go so

7
00:00:14,160 --> 00:00:15,599
with godspeed

8
00:00:15,599 --> 00:00:17,279
okay carry answer i hope and we're going

9
00:00:17,279 --> 00:00:18,560
to show up

10
00:00:18,560 --> 00:00:20,640
it's a zoom team whatever you want to

11
00:00:20,640 --> 00:00:22,000
call it call so the first thing has to

12
00:00:22,000 --> 00:00:23,840
be can you hear me i'm assuming you can

13
00:00:23,840 --> 00:00:25,760
unless i hold it otherwise

14
00:00:25,760 --> 00:00:28,320
my name is gavin chester um i'm hoping

15
00:00:28,320 --> 00:00:29,679
that you can all see the screen and the

16
00:00:29,679 --> 00:00:31,920
magic is working um and this talks about

17
00:00:31,920 --> 00:00:34,079
micro red team testing

18
00:00:34,079 --> 00:00:35,360
kind of how many pen tests we're going

19
00:00:35,360 --> 00:00:37,120
to do a week

20
00:00:37,120 --> 00:00:40,399
so let's click the right screen

21
00:00:40,399 --> 00:00:42,960
so who am i my name's gavin chester i

22
00:00:42,960 --> 00:00:45,680
spent about 30 years to 32 in big pharma

23
00:00:45,680 --> 00:00:47,760
uh eight years making drugs sorry

24
00:00:47,760 --> 00:00:50,239
penicillins nothing interesting uh 10

25
00:00:50,239 --> 00:00:52,399
years lab support so that was basically

26
00:00:52,399 --> 00:00:53,840
the machine had broke somebody has to

27
00:00:53,840 --> 00:00:55,760
fix it new machines turned up got to

28
00:00:55,760 --> 00:00:57,760
make it got to make it work

29
00:00:57,760 --> 00:00:59,600
eight years as a data loss prevention

30
00:00:59,600 --> 00:01:02,480
analyst so dealing with the people that

31
00:01:02,480 --> 00:01:04,000
just don't think what they're doing and

32
00:01:04,000 --> 00:01:06,000
accidentally let their company secrets

33
00:01:06,000 --> 00:01:07,119
out

34
00:01:07,119 --> 00:01:08,880
two and a half years as a red team

35
00:01:08,880 --> 00:01:10,640
analyst which sounds really cool but

36
00:01:10,640 --> 00:01:12,400
kind of the first year of that was we

37
00:01:12,400 --> 00:01:14,080
were starting out and setting up so it

38
00:01:14,080 --> 00:01:16,080
was just things like a very boring

39
00:01:16,080 --> 00:01:17,840
authority to operate and it got to be a

40
00:01:17,840 --> 00:01:19,119
bit interesting

41
00:01:19,119 --> 00:01:20,640
and last couple years i've been an

42
00:01:20,640 --> 00:01:23,040
information security officer

43
00:01:23,040 --> 00:01:24,799
so i'm dealing with interfacing between

44
00:01:24,799 --> 00:01:26,080
the technical side of the stuff and the

45
00:01:26,080 --> 00:01:27,759
business side of stuff and hopefully

46
00:01:27,759 --> 00:01:29,920
getting to see eye to eye

47
00:01:29,920 --> 00:01:33,119
so microwave teaming um

48
00:01:33,119 --> 00:01:35,600
this is not a lot of original work um

49
00:01:35,600 --> 00:01:37,600
it's a lot of what i found out about

50
00:01:37,600 --> 00:01:39,360
where we're going to go in the future

51
00:01:39,360 --> 00:01:41,360
kind of a few bits of tricks and ideas

52
00:01:41,360 --> 00:01:42,720
something that maybe you'll get an idea

53
00:01:42,720 --> 00:01:45,200
that you want to go forward with

54
00:01:45,200 --> 00:01:46,560
almost all of the code on here and

55
00:01:46,560 --> 00:01:49,200
examples is from either red canary's

56
00:01:49,200 --> 00:01:51,280
atomic red team and the github

57
00:01:51,280 --> 00:01:52,960
repositories there

58
00:01:52,960 --> 00:01:55,520
alternatively it'll be using soa's

59
00:01:55,520 --> 00:01:57,680
vector tool um which again available on

60
00:01:57,680 --> 00:02:00,799
github freely usable installing

61
00:02:00,799 --> 00:02:02,880
i'm aware that in places this is going

62
00:02:02,880 --> 00:02:05,200
to look like an eye test please try not

63
00:02:05,200 --> 00:02:06,640
to read the screen try not to read too

64
00:02:06,640 --> 00:02:08,800
much into it

65
00:02:08,800 --> 00:02:09,520
so

66
00:02:09,520 --> 00:02:12,560
what's micro red teaming um well this

67
00:02:12,560 --> 00:02:15,120
isn't about doing a full-on red team

68
00:02:15,120 --> 00:02:18,319
test there's just no point in doing that

69
00:02:18,319 --> 00:02:20,080
it's not about pissing off the blue team

70
00:02:20,080 --> 00:02:23,040
with false positives well it's fought

71
00:02:23,040 --> 00:02:25,040
really no no it isn't

72
00:02:25,040 --> 00:02:26,000
um

73
00:02:26,000 --> 00:02:27,920
it's not about repeatedly pointing out

74
00:02:27,920 --> 00:02:30,480
the same issues to the blue team uh just

75
00:02:30,480 --> 00:02:32,800
talking a few moments ago in in the

76
00:02:32,800 --> 00:02:34,400
pre room saying you know we've all got

77
00:02:34,400 --> 00:02:35,760
these issues that we know are never

78
00:02:35,760 --> 00:02:38,400
going to get fixed it's there's no money

79
00:02:38,400 --> 00:02:40,720
to do it it's it's an old system that we

80
00:02:40,720 --> 00:02:42,560
can't change it's a system that we can't

81
00:02:42,560 --> 00:02:44,160
upgrade anything like that so the whole

82
00:02:44,160 --> 00:02:45,760
point of this is to

83
00:02:45,760 --> 00:02:47,519
find these issues but if we found them

84
00:02:47,519 --> 00:02:49,519
again and again and again there's no

85
00:02:49,519 --> 00:02:51,440
point beating that dead horse

86
00:02:51,440 --> 00:02:52,239
um

87
00:02:52,239 --> 00:02:54,080
but what it is about is just trying to

88
00:02:54,080 --> 00:02:56,480
speed up our analysis of risk exposure

89
00:02:56,480 --> 00:02:57,760
so we can

90
00:02:57,760 --> 00:02:59,360
look at what we've got out there when we

91
00:02:59,360 --> 00:03:02,000
get a new actor a new threat um we see

92
00:03:02,000 --> 00:03:02,720
well

93
00:03:02,720 --> 00:03:04,239
could they get in you know we've got all

94
00:03:04,239 --> 00:03:05,920
this protection in place but does it

95
00:03:05,920 --> 00:03:07,680
protect the way that they're using and

96
00:03:07,680 --> 00:03:09,840
the way that their vector comes in

97
00:03:09,840 --> 00:03:11,040
try and give you an idea of where you're

98
00:03:11,040 --> 00:03:12,800
going

99
00:03:12,800 --> 00:03:13,840
so

100
00:03:13,840 --> 00:03:16,560
if i just explain a bit more um a

101
00:03:16,560 --> 00:03:18,959
typical red team engagement a pen test

102
00:03:18,959 --> 00:03:22,159
it kind of looks uh a system and network

103
00:03:22,159 --> 00:03:23,680
and invariably

104
00:03:23,680 --> 00:03:26,400
you've got to get something so

105
00:03:26,400 --> 00:03:27,840
maybe they want you to get credit card

106
00:03:27,840 --> 00:03:30,080
data to say well we've put this flag

107
00:03:30,080 --> 00:03:32,080
file on your credit card server can you

108
00:03:32,080 --> 00:03:34,640
get to it uh alternatively a pen test

109
00:03:34,640 --> 00:03:36,799
might be can you break this app

110
00:03:36,799 --> 00:03:38,640
they're all really good they can take

111
00:03:38,640 --> 00:03:40,799
days and weeks and they do find up good

112
00:03:40,799 --> 00:03:43,040
findings but invariably you're going to

113
00:03:43,040 --> 00:03:45,280
find that one big issue you've found the

114
00:03:45,280 --> 00:03:47,760
root of how you get to that file that

115
00:03:47,760 --> 00:03:49,040
doesn't mean you've actually found all

116
00:03:49,040 --> 00:03:50,400
the vulnerabilities

117
00:03:50,400 --> 00:03:52,159
if you're lucky you patch those

118
00:03:52,159 --> 00:03:55,040
vulnerabilities and you've kind of

119
00:03:55,040 --> 00:03:56,879
sort of stopped a bottleneck so you've

120
00:03:56,879 --> 00:03:58,799
stopped everything but that doesn't mean

121
00:03:58,799 --> 00:04:00,319
you really are sure that you've got all

122
00:04:00,319 --> 00:04:01,439
those

123
00:04:01,439 --> 00:04:03,360
so

124
00:04:03,360 --> 00:04:04,799
what

125
00:04:04,799 --> 00:04:07,120
if we've got the ability to test

126
00:04:07,120 --> 00:04:09,439
everything all the time

127
00:04:09,439 --> 00:04:11,519
and this is kind of it's an impossible

128
00:04:11,519 --> 00:04:14,319
dream but it's kind of where we went to

129
00:04:14,319 --> 00:04:16,798
so this idea came from uh my manager at

130
00:04:16,798 --> 00:04:19,918
the time and he saw it from somebody i

131
00:04:19,918 --> 00:04:21,839
gave a talk at arcticcon

132
00:04:21,839 --> 00:04:23,120
minnesota

133
00:04:23,120 --> 00:04:24,479
i believe

134
00:04:24,479 --> 00:04:26,400
it was somebody from target but

135
00:04:26,400 --> 00:04:28,240
arcticcon don't release their videos so

136
00:04:28,240 --> 00:04:30,160
i couldn't go back and check it and and

137
00:04:30,160 --> 00:04:31,680
if you happen to be listening to this

138
00:04:31,680 --> 00:04:33,360
i'm sorry i'm not name checking you but

139
00:04:33,360 --> 00:04:35,280
i couldn't find who it was

140
00:04:35,280 --> 00:04:38,080
but basically can we red team the entire

141
00:04:38,080 --> 00:04:40,400
infrastructure on this semi-continuous

142
00:04:40,400 --> 00:04:42,639
and kind of regular basis and

143
00:04:42,639 --> 00:04:45,840
that just seems like an impossible task

144
00:04:45,840 --> 00:04:47,440
so where do we start

145
00:04:47,440 --> 00:04:49,040
we start with a pretty simple core

146
00:04:49,040 --> 00:04:51,440
concept we just take the red team down

147
00:04:51,440 --> 00:04:53,120
put it into really small chunks and we

148
00:04:53,120 --> 00:04:54,960
test them so

149
00:04:54,960 --> 00:04:56,080
if you look at any of the minor

150
00:04:56,080 --> 00:04:58,320
techniques you can see can you get it to

151
00:04:58,320 --> 00:05:00,479
work can you actually detect it in the

152
00:05:00,479 --> 00:05:02,560
sock does the sock notice do the sock

153
00:05:02,560 --> 00:05:03,600
care

154
00:05:03,600 --> 00:05:05,360
two different questions

155
00:05:05,360 --> 00:05:06,639
we're going to do this at least once a

156
00:05:06,639 --> 00:05:09,280
week random times random days sometimes

157
00:05:09,280 --> 00:05:11,440
i'll do it in my id sometimes it'll be a

158
00:05:11,440 --> 00:05:12,639
friend i've got somewhere else in the

159
00:05:12,639 --> 00:05:14,400
business sometimes it's going to be my

160
00:05:14,400 --> 00:05:15,600
machine if it's something that

161
00:05:15,600 --> 00:05:17,520
potentially is going to trigger an alert

162
00:05:17,520 --> 00:05:18,720
higher up and somebody's going to get

163
00:05:18,720 --> 00:05:20,320
worried it would be a computer that's

164
00:05:20,320 --> 00:05:22,320
obviously mine or i'd i'd give you the

165
00:05:22,320 --> 00:05:24,720
name of micro red team test if it was

166
00:05:24,720 --> 00:05:26,639
something we really wanted to be sort of

167
00:05:26,639 --> 00:05:28,639
different and out there i'd get a friend

168
00:05:28,639 --> 00:05:31,199
to run it on on a lab computer something

169
00:05:31,199 --> 00:05:33,600
that maybe a bad guy has got in usb

170
00:05:33,600 --> 00:05:36,639
dropped in a car park that sort of thing

171
00:05:36,639 --> 00:05:38,080
if we tracked every time that we do

172
00:05:38,080 --> 00:05:40,960
these tests um we know when we started

173
00:05:40,960 --> 00:05:42,320
the test we know when we finished the

174
00:05:42,320 --> 00:05:43,199
test

175
00:05:43,199 --> 00:05:45,360
and we can find out when blue actually

176
00:05:45,360 --> 00:05:48,000
got back to to to tell us hey was this

177
00:05:48,000 --> 00:05:50,160
you guys testing or was it not so we're

178
00:05:50,160 --> 00:05:52,080
gonna then sort purple team red and blue

179
00:05:52,080 --> 00:05:53,680
together not really a proper purple team

180
00:05:53,680 --> 00:05:54,960
we just had a meeting together at the

181
00:05:54,960 --> 00:05:56,880
end try and see if there's anything that

182
00:05:56,880 --> 00:06:01,440
we can look see fixed and improve

183
00:06:01,440 --> 00:06:02,240
so

184
00:06:02,240 --> 00:06:04,160
that sounds really obvious he says

185
00:06:04,160 --> 00:06:05,520
changing his slides over but you are

186
00:06:05,520 --> 00:06:06,400
going to be attacking your own

187
00:06:06,400 --> 00:06:08,080
enterprise so you've got to have all the

188
00:06:08,080 --> 00:06:11,039
relevant approvals from your c-suite

189
00:06:11,039 --> 00:06:12,560
you can start without that that's

190
00:06:12,560 --> 00:06:14,160
probably going to be a little bit career

191
00:06:14,160 --> 00:06:15,600
suicide

192
00:06:15,600 --> 00:06:17,600
next thing is despite what i said way at

193
00:06:17,600 --> 00:06:19,680
the top of the slides

194
00:06:19,680 --> 00:06:22,080
this isn't about red and blue attacking

195
00:06:22,080 --> 00:06:24,479
each other in a lot of senses you've got

196
00:06:24,479 --> 00:06:25,840
to work in partnership you've got to

197
00:06:25,840 --> 00:06:27,919
trust what you're doing i mean the one

198
00:06:27,919 --> 00:06:30,000
thing that you don't want to do is

199
00:06:30,000 --> 00:06:31,520
start doing something right in the

200
00:06:31,520 --> 00:06:33,680
middle of an attack happening so you've

201
00:06:33,680 --> 00:06:35,360
got to find a way that you can talk to

202
00:06:35,360 --> 00:06:36,560
each other

203
00:06:36,560 --> 00:06:38,720
but you can still do the tests in secret

204
00:06:38,720 --> 00:06:40,000
so as i say you don't want to be

205
00:06:40,000 --> 00:06:42,000
launching a test when the sock is

206
00:06:42,000 --> 00:06:44,000
already overloaded you know if they've

207
00:06:44,000 --> 00:06:45,759
got a real incident you coming along

208
00:06:45,759 --> 00:06:46,800
with a little

209
00:06:46,800 --> 00:06:49,120
red test is not going to make them your

210
00:06:49,120 --> 00:06:50,000
friends

211
00:06:50,000 --> 00:06:51,840
there is an argument that says that

212
00:06:51,840 --> 00:06:53,280
could be what the bad people are doing

213
00:06:53,280 --> 00:06:55,599
they launched attack over here

214
00:06:55,599 --> 00:06:57,599
and diversionary tactics go and play

215
00:06:57,599 --> 00:06:58,880
something else somewhere and that's

216
00:06:58,880 --> 00:07:00,160
where they're going

217
00:07:00,160 --> 00:07:02,479
but we're not trying to be a complete

218
00:07:02,479 --> 00:07:03,840
red team we're trying not to be a

219
00:07:03,840 --> 00:07:06,000
complete simulation so let's try and do

220
00:07:06,000 --> 00:07:08,240
it when they're not absolutely screaming

221
00:07:08,240 --> 00:07:10,240
and pulling their hair out

222
00:07:10,240 --> 00:07:12,000
we don't want the stock to filter out

223
00:07:12,000 --> 00:07:14,479
anything because it is a known user id

224
00:07:14,479 --> 00:07:16,479
or a known device id from people on the

225
00:07:16,479 --> 00:07:18,479
red team so if it's my laptop that i'm

226
00:07:18,479 --> 00:07:20,639
using and i had my laptop and a test

227
00:07:20,639 --> 00:07:21,680
laptop

228
00:07:21,680 --> 00:07:23,199
if they recognize it as mine we just

229
00:07:23,199 --> 00:07:24,720
don't want them to go but gavin will not

230
00:07:24,720 --> 00:07:26,319
play with it because sometimes it might

231
00:07:26,319 --> 00:07:27,280
not be

232
00:07:27,280 --> 00:07:29,599
and similarly we don't want the red t

233
00:07:29,599 --> 00:07:32,000
the the stock to look at it and go

234
00:07:32,000 --> 00:07:33,599
that's a really pointless little test

235
00:07:33,599 --> 00:07:35,759
that's just a micro red team again

236
00:07:35,759 --> 00:07:37,520
you've got no guarantee it really is

237
00:07:37,520 --> 00:07:40,720
chances are it is might not be

238
00:07:40,720 --> 00:07:41,759
so

239
00:07:41,759 --> 00:07:44,080
where do we start with this um the good

240
00:07:44,080 --> 00:07:46,319
thing is is you're not at zero

241
00:07:46,319 --> 00:07:48,160
there's lots of attack tools out there

242
00:07:48,160 --> 00:07:49,360
they're kind of

243
00:07:49,360 --> 00:07:51,199
they've got this new category breach

244
00:07:51,199 --> 00:07:53,599
attack simulation tools um

245
00:07:53,599 --> 00:07:54,720
there's an awful lot of them out there

246
00:07:54,720 --> 00:07:58,080
we went with red canaries atomic red

247
00:07:58,080 --> 00:08:00,960
there is end games automation khalida

248
00:08:00,960 --> 00:08:03,840
from mitre and uber

249
00:08:03,840 --> 00:08:05,440
have a tool called meta

250
00:08:05,440 --> 00:08:06,879
they're all really good but the reason

251
00:08:06,879 --> 00:08:10,240
why we started using the atomic red bit

252
00:08:10,240 --> 00:08:12,560
is it's really basic it's nothing more

253
00:08:12,560 --> 00:08:14,960
than a set of scripts on github

254
00:08:14,960 --> 00:08:17,440
so the beauty of that is

255
00:08:17,440 --> 00:08:18,879
you have to spend a bit of time working

256
00:08:18,879 --> 00:08:20,560
on it but then you can just pick up that

257
00:08:20,560 --> 00:08:22,879
script take it to a machine go and run

258
00:08:22,879 --> 00:08:24,800
it go and run it anywhere if you've got

259
00:08:24,800 --> 00:08:26,879
the ability to copy things to usb write

260
00:08:26,879 --> 00:08:29,280
them in there you can copy on usb go to

261
00:08:29,280 --> 00:08:31,199
where you're going install that script

262
00:08:31,199 --> 00:08:33,120
run it in command run it in powershell

263
00:08:33,120 --> 00:08:36,159
whatever you happen to be needing for it

264
00:08:36,159 --> 00:08:38,320
the only downside to that is that there

265
00:08:38,320 --> 00:08:41,279
isn't any embedded reporting in um

266
00:08:41,279 --> 00:08:43,039
atomic red and that's why we started

267
00:08:43,039 --> 00:08:46,000
using vector so we have to do a test

268
00:08:46,000 --> 00:08:47,839
log where we're doing kind of report it

269
00:08:47,839 --> 00:08:49,839
ourselves

270
00:08:49,839 --> 00:08:51,360
i'm sure that

271
00:08:51,360 --> 00:08:53,360
everyone is familiar with

272
00:08:53,360 --> 00:08:55,519
the mitral attack framework this is

273
00:08:55,519 --> 00:08:57,040
where it gets to be an eye test and no

274
00:08:57,040 --> 00:08:59,360
i'm not expecting you to read any of

275
00:08:59,360 --> 00:09:01,200
that but we all know that there's this

276
00:09:01,200 --> 00:09:03,120
long framework but we can start off with

277
00:09:03,120 --> 00:09:05,120
a few bits and pieces that we know

278
00:09:05,120 --> 00:09:07,120
there's no point working on

279
00:09:07,120 --> 00:09:08,720
first couple of steps on the left-hand

280
00:09:08,720 --> 00:09:10,320
side the reconnaissance and the initial

281
00:09:10,320 --> 00:09:12,320
access there's a lot of benefit if you

282
00:09:12,320 --> 00:09:14,399
can stop somebody in that phase

283
00:09:14,399 --> 00:09:16,640
if you've got somebody who's searching

284
00:09:16,640 --> 00:09:18,560
for your whales your users on social

285
00:09:18,560 --> 00:09:21,360
media if you can stop them brilliant but

286
00:09:21,360 --> 00:09:24,160
you know what we probably can't

287
00:09:24,160 --> 00:09:25,760
if there's an awful lot of active

288
00:09:25,760 --> 00:09:27,760
scanning on your perimeter well chances

289
00:09:27,760 --> 00:09:29,600
are you've been scanned welcome to the

290
00:09:29,600 --> 00:09:31,760
internet that's business as usual

291
00:09:31,760 --> 00:09:33,920
we already do fishing simulations on our

292
00:09:33,920 --> 00:09:34,959
users

293
00:09:34,959 --> 00:09:36,399
if we're going to do fishing simulations

294
00:09:36,399 --> 00:09:38,240
as part of this red team we're going to

295
00:09:38,240 --> 00:09:39,680
probably cause problems we're either

296
00:09:39,680 --> 00:09:41,920
going to pollute the work that they're

297
00:09:41,920 --> 00:09:43,760
doing so they're going to think well

298
00:09:43,760 --> 00:09:45,440
that was better or worse than what we've

299
00:09:45,440 --> 00:09:46,560
been doing

300
00:09:46,560 --> 00:09:47,680
what we're going to do with it are we

301
00:09:47,680 --> 00:09:48,800
going to

302
00:09:48,800 --> 00:09:50,080
break some of these things are we going

303
00:09:50,080 --> 00:09:52,000
to send it to the wrong place and we

304
00:09:52,000 --> 00:09:54,160
could potentially do stuff that is all

305
00:09:54,160 --> 00:09:56,640
publicly facing so it's a drive-by

306
00:09:56,640 --> 00:09:59,680
it's just about practical um

307
00:09:59,680 --> 00:10:01,680
but in real terms it's not practical for

308
00:10:01,680 --> 00:10:03,920
this to attest and it's even dangerous

309
00:10:03,920 --> 00:10:05,760
you know we want to do this in a very

310
00:10:05,760 --> 00:10:07,600
tight controlled manner so we know when

311
00:10:07,600 --> 00:10:09,440
we've done it what we've done it with

312
00:10:09,440 --> 00:10:10,959
who we've done it with when the

313
00:10:10,959 --> 00:10:12,720
detection is if you've done something

314
00:10:12,720 --> 00:10:14,880
that's a public drive-by

315
00:10:14,880 --> 00:10:16,560
you know even if it's a private drive by

316
00:10:16,560 --> 00:10:18,640
sort of in your internal sites you don't

317
00:10:18,640 --> 00:10:20,800
know when that test is going to happen

318
00:10:20,800 --> 00:10:22,320
you've got no idea what's going to do it

319
00:10:22,320 --> 00:10:24,800
could be one person picks up five people

320
00:10:24,800 --> 00:10:26,640
i haven't got a clue so we tended to

321
00:10:26,640 --> 00:10:29,040
stay away from the reconnaissance and

322
00:10:29,040 --> 00:10:30,800
the initial access thing

323
00:10:30,800 --> 00:10:32,640
so basically we're going to assume that

324
00:10:32,640 --> 00:10:34,399
us as the bad guy has got in i'm going

325
00:10:34,399 --> 00:10:36,399
to kind of concentrate on the next whole

326
00:10:36,399 --> 00:10:38,399
bundle of the miter chain

327
00:10:38,399 --> 00:10:39,440
so i'm going to move on to a couple of

328
00:10:39,440 --> 00:10:41,040
examples

329
00:10:41,040 --> 00:10:42,880
so the first one is

330
00:10:42,880 --> 00:10:45,440
going to be privilege escalation um

331
00:10:45,440 --> 00:10:47,760
the way that it works is pretty simple

332
00:10:47,760 --> 00:10:48,800
go to my

333
00:10:48,800 --> 00:10:51,680
um sorry the red the red canary atomic

334
00:10:51,680 --> 00:10:54,000
red database they've got a wiki page

335
00:10:54,000 --> 00:10:56,160
about it and you'll get this chooser

336
00:10:56,160 --> 00:10:58,320
test and they're all sorted by their t

337
00:10:58,320 --> 00:11:00,480
number but you can also have them you

338
00:11:00,480 --> 00:11:02,079
see just down at the bottom we've got

339
00:11:02,079 --> 00:11:04,399
all tests we've got windows mac

340
00:11:04,399 --> 00:11:06,640
um and unix

341
00:11:06,640 --> 00:11:09,279
we tend to use microsoft stuff because

342
00:11:09,279 --> 00:11:11,200
that's what we've got most of the time i

343
00:11:11,200 --> 00:11:13,839
had a laptop that i dual booted to

344
00:11:13,839 --> 00:11:15,680
either linux or windows depending what i

345
00:11:15,680 --> 00:11:17,120
wanted

346
00:11:17,120 --> 00:11:18,720
we didn't have many macs in our

347
00:11:18,720 --> 00:11:20,480
environment at the time so

348
00:11:20,480 --> 00:11:23,040
we didn't purposely choose not to use

349
00:11:23,040 --> 00:11:24,000
max

350
00:11:24,000 --> 00:11:25,839
but we knew that it was a much lower sac

351
00:11:25,839 --> 00:11:28,240
surface and while we can use it now and

352
00:11:28,240 --> 00:11:30,720
again let's concentrate on the

353
00:11:30,720 --> 00:11:32,079
the low hanging fruit the stuff we

354
00:11:32,079 --> 00:11:33,360
really can get

355
00:11:33,360 --> 00:11:35,040
but just remember you are almost

356
00:11:35,040 --> 00:11:36,800
certainly going to have these oddballs

357
00:11:36,800 --> 00:11:38,240
in your environment so you're going to

358
00:11:38,240 --> 00:11:39,760
have to all right

359
00:11:39,760 --> 00:11:41,279
hello hello

360
00:11:41,279 --> 00:11:43,760
okay uh

361
00:11:43,760 --> 00:11:46,800
the zoom just comes

362
00:11:46,800 --> 00:11:49,200
just shut

363
00:11:49,200 --> 00:11:50,720
my end or yours

364
00:11:50,720 --> 00:11:51,600
okay

365
00:11:51,600 --> 00:11:54,399
we're just looking at it coming back uh

366
00:11:54,399 --> 00:11:56,399
it's cartwheeling

367
00:11:56,399 --> 00:11:58,480
yep we'll all zoom there folks so we're

368
00:11:58,480 --> 00:12:00,880
just getting zoomed back and hopefully

369
00:12:00,880 --> 00:12:03,360
gavin back yeah

370
00:12:03,360 --> 00:12:04,720
and hopefully he's not just speaking

371
00:12:04,720 --> 00:12:06,800
into the void i don't think so it looks

372
00:12:06,800 --> 00:12:08,399
like he stopped now

373
00:12:08,399 --> 00:12:11,839
oh no now

374
00:12:22,320 --> 00:12:24,720
so carry on thank you

375
00:12:24,720 --> 00:12:26,720
you've just put me off my throw

376
00:12:26,720 --> 00:12:28,800
my flow thank you anyway

377
00:12:28,800 --> 00:12:30,880
um so you're always going to have those

378
00:12:30,880 --> 00:12:32,639
oddballs there's always going to be

379
00:12:32,639 --> 00:12:34,320
somebody that's got something or other

380
00:12:34,320 --> 00:12:36,320
um i just i worked in a lab environment

381
00:12:36,320 --> 00:12:38,160
we always had a few weird and wonderful

382
00:12:38,160 --> 00:12:40,480
bits that would only run on unix

383
00:12:40,480 --> 00:12:41,600
you've probably got a graphics

384
00:12:41,600 --> 00:12:43,920
department that you know for all sorts

385
00:12:43,920 --> 00:12:45,839
of weird reasons they won't use pcs and

386
00:12:45,839 --> 00:12:47,279
insist that macs are the only thing

387
00:12:47,279 --> 00:12:48,959
you've got so you're going to have those

388
00:12:48,959 --> 00:12:50,399
in your environment don't forget to test

389
00:12:50,399 --> 00:12:52,959
for them they might be there so looking

390
00:12:52,959 --> 00:12:54,560
at a couple of examples as i said start

391
00:12:54,560 --> 00:12:56,560
with privileged escalation

392
00:12:56,560 --> 00:12:58,720
so the tests are actually pretty simple

393
00:12:58,720 --> 00:13:01,279
uh you can see we've got 107.8 here just

394
00:13:01,279 --> 00:13:03,279
setting up some local accounts

395
00:13:03,279 --> 00:13:04,800
all the different t-tests have got

396
00:13:04,800 --> 00:13:06,399
different number of subtests this

397
00:13:06,399 --> 00:13:09,360
particular one has got one um the red

398
00:13:09,360 --> 00:13:11,200
red canary atomic red gives you the

399
00:13:11,200 --> 00:13:13,040
instructions and you'll note that it

400
00:13:13,040 --> 00:13:14,320
needs to be admin so i've just got a

401
00:13:14,320 --> 00:13:16,320
screenshot there i'm pretty sure you can

402
00:13:16,320 --> 00:13:17,680
all read what we're doing we're going to

403
00:13:17,680 --> 00:13:19,120
add a user we're going to set the user's

404
00:13:19,120 --> 00:13:20,399
password we're then going to push that

405
00:13:20,399 --> 00:13:23,519
user into the local administrators group

406
00:13:23,519 --> 00:13:25,600
and nicely even gives you the cleanup

407
00:13:25,600 --> 00:13:27,200
commands

408
00:13:27,200 --> 00:13:28,160
so

409
00:13:28,160 --> 00:13:30,000
i think most of us would probably be

410
00:13:30,000 --> 00:13:32,160
really surprised if we could actually

411
00:13:32,160 --> 00:13:34,800
detect that i don't think there's many

412
00:13:34,800 --> 00:13:36,639
companies that would probably detect a

413
00:13:36,639 --> 00:13:38,399
local account being set up on a local

414
00:13:38,399 --> 00:13:41,199
machine adding somebody into a domain

415
00:13:41,199 --> 00:13:43,040
putting a domain user into a domain

416
00:13:43,040 --> 00:13:44,800
group yeah we've probably got some

417
00:13:44,800 --> 00:13:46,880
detections for that it may work they may

418
00:13:46,880 --> 00:13:49,040
not but would we ever do it on the local

419
00:13:49,040 --> 00:13:50,560
machine

420
00:13:50,560 --> 00:13:52,079
not sure

421
00:13:52,079 --> 00:13:53,519
if you do have that logging that goes

422
00:13:53,519 --> 00:13:55,920
into a sim um

423
00:13:55,920 --> 00:13:57,920
what what are your rules how would you

424
00:13:57,920 --> 00:13:59,920
surface up that one single event when

425
00:13:59,920 --> 00:14:01,760
you've got thousands tens of thousands

426
00:14:01,760 --> 00:14:03,920
hundreds of thousands of endpoints

427
00:14:03,920 --> 00:14:05,440
and would that actually even be a

428
00:14:05,440 --> 00:14:06,560
priority

429
00:14:06,560 --> 00:14:08,720
you know a local user suddenly being

430
00:14:08,720 --> 00:14:10,240
created on a machine

431
00:14:10,240 --> 00:14:12,880
no not sure

432
00:14:12,880 --> 00:14:16,160
another example persistence um so this

433
00:14:16,160 --> 00:14:18,639
is one five four seven uh this has got

434
00:14:18,639 --> 00:14:20,160
seven different tests so you can see

435
00:14:20,160 --> 00:14:21,839
we're adding a couple of things to

436
00:14:21,839 --> 00:14:24,079
registry keys trying to get stuff into

437
00:14:24,079 --> 00:14:26,320
the startup folder the user startup

438
00:14:26,320 --> 00:14:28,720
folder so we've got a suspicious uh in

439
00:14:28,720 --> 00:14:31,040
this case it says uh visual basic

440
00:14:31,040 --> 00:14:33,120
javascript or a batch file but it could

441
00:14:33,120 --> 00:14:35,600
be anything just any file you want

442
00:14:35,600 --> 00:14:37,760
we're adding it to the startup or we're

443
00:14:37,760 --> 00:14:39,519
adding it to the room once when the user

444
00:14:39,519 --> 00:14:41,199
logs in or when the machine starts up it

445
00:14:41,199 --> 00:14:43,120
goes off and does something if we were

446
00:14:43,120 --> 00:14:44,959
bad guys with an implant maybe we're

447
00:14:44,959 --> 00:14:47,360
getting that implant start up every time

448
00:14:47,360 --> 00:14:49,519
i know that this is not really really

449
00:14:49,519 --> 00:14:51,519
complex in terms of

450
00:14:51,519 --> 00:14:53,199
operational stealth and things like that

451
00:14:53,199 --> 00:14:54,560
it's not meant to be it's meant to be a

452
00:14:54,560 --> 00:14:55,839
test

453
00:14:55,839 --> 00:14:58,959
um one thing to remember is that the the

454
00:14:58,959 --> 00:15:01,360
known malware as i'm calling it the the

455
00:15:01,360 --> 00:15:02,959
in this case it's the hash command to

456
00:15:02,959 --> 00:15:04,720
execute the part

457
00:15:04,720 --> 00:15:06,720
isn't necessarily going to be malware it

458
00:15:06,720 --> 00:15:08,160
could be a batch file that's going to

459
00:15:08,160 --> 00:15:10,720
keep re-adding your users it could be an

460
00:15:10,720 --> 00:15:12,639
implant you know if you've

461
00:15:12,639 --> 00:15:14,320
really got done it well and you've got

462
00:15:14,320 --> 00:15:16,880
your cobalt strike and you've encrypted

463
00:15:16,880 --> 00:15:18,800
it and you've got your private keys and

464
00:15:18,800 --> 00:15:20,480
nobody's leaked bugs keys and things

465
00:15:20,480 --> 00:15:21,360
like that

466
00:15:21,360 --> 00:15:22,639
maybe you're going to get a file that

467
00:15:22,639 --> 00:15:24,320
will not be picked up by a signal based

468
00:15:24,320 --> 00:15:26,800
iv maybe it will maybe not different avs

469
00:15:26,800 --> 00:15:28,639
work different ways but ultimately

470
00:15:28,639 --> 00:15:30,480
you've got to remember that that file

471
00:15:30,480 --> 00:15:32,000
isn't malicious in itself the

472
00:15:32,000 --> 00:15:33,680
maliciousness is the adding the

473
00:15:33,680 --> 00:15:35,920
persistence

474
00:15:35,920 --> 00:15:38,320
he says turning these files over

475
00:15:38,320 --> 00:15:39,120
so

476
00:15:39,120 --> 00:15:41,040
kind of like the first one are we ever

477
00:15:41,040 --> 00:15:42,079
going to see

478
00:15:42,079 --> 00:15:44,160
that that's been done i mean if you

479
00:15:44,160 --> 00:15:45,519
think about it this is what software

480
00:15:45,519 --> 00:15:46,720
does all the time

481
00:15:46,720 --> 00:15:48,240
it's the software comes along sets

482
00:15:48,240 --> 00:15:50,639
itself up puts its drivers in

483
00:15:50,639 --> 00:15:53,040
puts its little tray icon in does it set

484
00:15:53,040 --> 00:15:54,639
up to start automatically when the user

485
00:15:54,639 --> 00:15:56,800
logs in all of this is standard this is

486
00:15:56,800 --> 00:15:58,399
normal industry practice we're not doing

487
00:15:58,399 --> 00:15:59,839
anything strange

488
00:15:59,839 --> 00:16:01,839
so would we ever see it

489
00:16:01,839 --> 00:16:03,680
software you know we rely on the

490
00:16:03,680 --> 00:16:05,440
antivirus to check that the file's not

491
00:16:05,440 --> 00:16:06,639
malicious

492
00:16:06,639 --> 00:16:08,880
but we kind of not missing the

493
00:16:08,880 --> 00:16:11,519
non-malicious files that could be

494
00:16:11,519 --> 00:16:12,560
delicious

495
00:16:12,560 --> 00:16:13,519
and again

496
00:16:13,519 --> 00:16:14,880
i don't think socks are ever going to

497
00:16:14,880 --> 00:16:16,639
detect this in the noise

498
00:16:16,639 --> 00:16:18,160
and yeah i know what you're probably

499
00:16:18,160 --> 00:16:19,680
thinking i'm being really bad on the

500
00:16:19,680 --> 00:16:22,880
sock so we're looking for a local alert

501
00:16:22,880 --> 00:16:24,800
on a machine that's potentially in

502
00:16:24,800 --> 00:16:27,199
amongst thousands so let's try something

503
00:16:27,199 --> 00:16:28,880
a bit noisier

504
00:16:28,880 --> 00:16:30,800
so my third example

505
00:16:30,800 --> 00:16:35,759
um is uh c2x filtration using dns

506
00:16:35,759 --> 00:16:38,000
um there's four parts to this test

507
00:16:38,000 --> 00:16:39,920
sending a large volume of dns queries

508
00:16:39,920 --> 00:16:42,000
beaconing out on a regular interval

509
00:16:42,000 --> 00:16:44,160
pushing out a very long domain query and

510
00:16:44,160 --> 00:16:46,639
a simulated c2 i'm not going to give you

511
00:16:46,639 --> 00:16:47,839
all the commands i think we've got the

512
00:16:47,839 --> 00:16:49,120
idea by now

513
00:16:49,120 --> 00:16:51,279
but we've all got this wonderful

514
00:16:51,279 --> 00:16:54,079
next-gen hardware that can see all and

515
00:16:54,079 --> 00:16:56,079
do all and it's going to surface these

516
00:16:56,079 --> 00:16:57,440
it's going to tell us and within minutes

517
00:16:57,440 --> 00:17:00,320
it's going to maybe even block it

518
00:17:00,320 --> 00:17:02,639
well we'll see

519
00:17:02,639 --> 00:17:04,799
something to note on this one is because

520
00:17:04,799 --> 00:17:07,359
it's dns it needs a digital well i use

521
00:17:07,359 --> 00:17:10,160
the digital ocean up the digital ocean

522
00:17:10,160 --> 00:17:12,079
droplet but we're needing an external

523
00:17:12,079 --> 00:17:14,400
destination of some description um the

524
00:17:14,400 --> 00:17:16,720
reason why i went with digitalocean is

525
00:17:16,720 --> 00:17:18,400
the kind of cheap five dollars for a

526
00:17:18,400 --> 00:17:20,880
small droplet i could spin it up have it

527
00:17:20,880 --> 00:17:21,919
running

528
00:17:21,919 --> 00:17:24,400
delete it and wipe it you know

529
00:17:24,400 --> 00:17:26,880
probably cost less than a dollar a week

530
00:17:26,880 --> 00:17:28,880
if if that to use it's five dollars a

531
00:17:28,880 --> 00:17:30,559
month i could put them anywhere that

532
00:17:30,559 --> 00:17:32,720
digitalocean had got a data center i

533
00:17:32,720 --> 00:17:35,120
tended to use singapore and bangalore

534
00:17:35,120 --> 00:17:37,039
because we don't have a lot of comfort

535
00:17:37,039 --> 00:17:39,520
company infrastructure there it's not

536
00:17:39,520 --> 00:17:41,440
trying to hide it completely this should

537
00:17:41,440 --> 00:17:43,440
kind of trigger some alerts why is our

538
00:17:43,440 --> 00:17:45,120
dns going to singapore

539
00:17:45,120 --> 00:17:46,240
just trying to make it stand out a

540
00:17:46,240 --> 00:17:47,600
little bit more

541
00:17:47,600 --> 00:17:49,919
as i said droppers would cheat

542
00:17:49,919 --> 00:17:51,600
so it's going to be probably apparent

543
00:17:51,600 --> 00:17:53,840
from these names but they all use dns so

544
00:17:53,840 --> 00:17:55,840
the first one sends out a lot of dns

545
00:17:55,840 --> 00:17:58,000
queries to a specific ip in a short time

546
00:17:58,000 --> 00:17:59,039
frame

547
00:17:59,039 --> 00:18:02,799
not normal dns behavior um second one is

548
00:18:02,799 --> 00:18:04,320
does the same thing but instead of it

549
00:18:04,320 --> 00:18:06,240
being a lot in a short time frame it's

550
00:18:06,240 --> 00:18:09,360
just sending them out on a regular pulse

551
00:18:09,360 --> 00:18:11,679
test three shoves the dns up to as long

552
00:18:11,679 --> 00:18:14,720
as it can be which i think is 254

553
00:18:14,720 --> 00:18:15,919
characters

554
00:18:15,919 --> 00:18:19,280
um and again unusual it would be really

555
00:18:19,280 --> 00:18:21,360
unfair for me to use a test that sent

556
00:18:21,360 --> 00:18:23,520
that one query out i don't think there's

557
00:18:23,520 --> 00:18:26,320
anything that's next next next next gen

558
00:18:26,320 --> 00:18:28,240
that's ever going to catch anything that

559
00:18:28,240 --> 00:18:30,320
simple because if it's never seen it

560
00:18:30,320 --> 00:18:32,080
before it can't make a judgment and if

561
00:18:32,080 --> 00:18:34,000
it never happens again well it doesn't

562
00:18:34,000 --> 00:18:36,640
know about it so to be fair to the blue

563
00:18:36,640 --> 00:18:38,160
team i put this in the loop so there was

564
00:18:38,160 --> 00:18:40,320
quite a few of these calls being doing

565
00:18:40,320 --> 00:18:43,440
and the fourth test uses um dns cat to

566
00:18:43,440 --> 00:18:46,559
try and simulate um c2 activity between

567
00:18:46,559 --> 00:18:48,320
them

568
00:18:48,320 --> 00:18:50,720
so as i said surely all this wonderful

569
00:18:50,720 --> 00:18:52,480
next-gen kit caught it

570
00:18:52,480 --> 00:18:53,919
yeah no

571
00:18:53,919 --> 00:18:56,320
and if you think about it we kind of got

572
00:18:56,320 --> 00:18:58,000
a lot of the systems that we use you

573
00:18:58,000 --> 00:19:00,080
know i've got examples there av and

574
00:19:00,080 --> 00:19:02,400
cloud work on virtual cloud instances

575
00:19:02,400 --> 00:19:03,919
and they've got these long names the

576
00:19:03,919 --> 00:19:06,000
very things that we almost looking to

577
00:19:06,000 --> 00:19:08,000
try and pick up so i've got an example

578
00:19:08,000 --> 00:19:09,520
there that's

579
00:19:09,520 --> 00:19:12,480
an amazon reference so each c2 is your

580
00:19:12,480 --> 00:19:13,760
size and then

581
00:19:13,760 --> 00:19:15,760
uh yes okay i picked random numbers

582
00:19:15,760 --> 00:19:17,440
that's not really an ip address which is

583
00:19:17,440 --> 00:19:19,440
what the next digit should be

584
00:19:19,440 --> 00:19:22,160
location and details about it

585
00:19:22,160 --> 00:19:23,280
and at this point you're probably

586
00:19:23,280 --> 00:19:25,360
thinking what am i talking about so just

587
00:19:25,360 --> 00:19:27,200
to bring this home this is actually very

588
00:19:27,200 --> 00:19:28,559
real world

589
00:19:28,559 --> 00:19:31,520
so you've got a query there with the 70

590
00:19:31,520 --> 00:19:32,559
fov

591
00:19:32,559 --> 00:19:36,160
all the rest of it um was actually the

592
00:19:36,160 --> 00:19:39,120
the query issued by the sunburst malware

593
00:19:39,120 --> 00:19:42,000
to tell the c2 server that it implanted

594
00:19:42,000 --> 00:19:45,360
itself on the cisco machine so the 70fov

595
00:19:45,360 --> 00:19:48,320
was saying this is cisco.com um

596
00:19:48,320 --> 00:19:49,840
in whatever way they've encoded it and

597
00:19:49,840 --> 00:19:51,600
you've got the rest of the strings

598
00:19:51,600 --> 00:19:54,000
but that query looks awfully lot like an

599
00:19:54,000 --> 00:19:56,880
amazon address and and i i do not doubt

600
00:19:56,880 --> 00:19:58,640
that that is extremely deliberate on the

601
00:19:58,640 --> 00:20:01,280
part of the bad guys so

602
00:20:01,280 --> 00:20:03,360
so we've got all our tests we take each

603
00:20:03,360 --> 00:20:05,919
test we've got yesters nose detections

604
00:20:05,919 --> 00:20:07,840
things like that log them into vector

605
00:20:07,840 --> 00:20:10,240
and we can try and visualize this

606
00:20:10,240 --> 00:20:11,840
so we can try and understand what the

607
00:20:11,840 --> 00:20:13,919
technique the actor uses

608
00:20:13,919 --> 00:20:15,039
how they're going to look at on our

609
00:20:15,039 --> 00:20:17,039
defenses and kind of repeat it see if

610
00:20:17,039 --> 00:20:18,000
you're going so i've got a few

611
00:20:18,000 --> 00:20:20,720
screenshots just showing you that um so

612
00:20:20,720 --> 00:20:21,919
apt

613
00:20:21,919 --> 00:20:23,520
uh so with the apt groups you can see

614
00:20:23,520 --> 00:20:25,440
we're bringing them all in here

615
00:20:25,440 --> 00:20:27,280
uh these are all

616
00:20:27,280 --> 00:20:29,520
the reference screens that come from

617
00:20:29,520 --> 00:20:31,440
sra i'm not giving you any company data

618
00:20:31,440 --> 00:20:32,320
away

619
00:20:32,320 --> 00:20:33,919
you see we can drill down and look in

620
00:20:33,919 --> 00:20:36,400
any particular one we've got apt-33s so

621
00:20:36,400 --> 00:20:38,080
there's the things that they were known

622
00:20:38,080 --> 00:20:39,280
to use

623
00:20:39,280 --> 00:20:41,280
we can also build a custom campaign so

624
00:20:41,280 --> 00:20:44,799
if we had intelligence that apt-33 were

625
00:20:44,799 --> 00:20:47,200
thinking of attacking us we could bring

626
00:20:47,200 --> 00:20:49,280
one of these custom campaigns in look at

627
00:20:49,280 --> 00:20:50,799
it and then we can maybe look at it

628
00:20:50,799 --> 00:20:52,720
either run the campaign ourselves so we

629
00:20:52,720 --> 00:20:55,360
can go let's not micro red team this but

630
00:20:55,360 --> 00:20:56,559
we'll just run through all of these and

631
00:20:56,559 --> 00:20:57,760
see where we go

632
00:20:57,760 --> 00:20:59,360
alternatively we can kind of look at

633
00:20:59,360 --> 00:21:01,760
that look back at our heat map and try

634
00:21:01,760 --> 00:21:03,919
and work out if we're going to be

635
00:21:03,919 --> 00:21:05,600
attackable or not

636
00:21:05,600 --> 00:21:08,400
so as i said we get a heat map so

637
00:21:08,400 --> 00:21:10,320
should be kind of obvious red is bad

638
00:21:10,320 --> 00:21:12,320
green is um is good

639
00:21:12,320 --> 00:21:14,159
you can see just looking there

640
00:21:14,159 --> 00:21:16,159
uh in in the example data that we've got

641
00:21:16,159 --> 00:21:18,159
we've got a boot or logon autostart

642
00:21:18,159 --> 00:21:19,760
execution which is kind of green which

643
00:21:19,760 --> 00:21:21,200
probably means you've got good detection

644
00:21:21,200 --> 00:21:22,960
about it so my tests earlier should have

645
00:21:22,960 --> 00:21:24,640
been picked up then you've got some

646
00:21:24,640 --> 00:21:26,080
things that are yellow and orange where

647
00:21:26,080 --> 00:21:28,159
there's minimal coverage

648
00:21:28,159 --> 00:21:29,039
um

649
00:21:29,039 --> 00:21:31,360
you can also see that um when you drill

650
00:21:31,360 --> 00:21:32,960
down into the tests if you do them often

651
00:21:32,960 --> 00:21:33,760
enough

652
00:21:33,760 --> 00:21:35,440
you've got an idea of where you've got

653
00:21:35,440 --> 00:21:37,760
better um there's two examples there

654
00:21:37,760 --> 00:21:40,480
one's the green outlines one's the red

655
00:21:40,480 --> 00:21:44,880
you see how um the first time the lmn

656
00:21:44,880 --> 00:21:46,960
nr test was done

657
00:21:46,960 --> 00:21:48,240
went through went through the second

658
00:21:48,240 --> 00:21:49,280
time

659
00:21:49,280 --> 00:21:50,880
third time it was blocked

660
00:21:50,880 --> 00:21:52,400
interesting there's no alert triggered

661
00:21:52,400 --> 00:21:54,159
so probably that's something being done

662
00:21:54,159 --> 00:21:56,000
by the scenes rather than sock being

663
00:21:56,000 --> 00:21:57,919
said hey we need to go and look at it

664
00:21:57,919 --> 00:21:59,200
and you can see the other one for

665
00:21:59,200 --> 00:22:01,520
yourself

666
00:22:01,520 --> 00:22:03,360
i'm gonna move on okay

667
00:22:03,360 --> 00:22:05,919
so in theory every one of these tests

668
00:22:05,919 --> 00:22:07,919
could have been caught you know if you'd

669
00:22:07,919 --> 00:22:09,840
loved enough if you'd have if you'd then

670
00:22:09,840 --> 00:22:11,760
look through those logs hard enough

671
00:22:11,760 --> 00:22:13,440
you would have found them absolutely

672
00:22:13,440 --> 00:22:15,440
without a doubt but you know

673
00:22:15,440 --> 00:22:17,120
the sock analysts rely on automated

674
00:22:17,120 --> 00:22:18,320
tools

675
00:22:18,320 --> 00:22:19,679
we're not trying to burn the sock

676
00:22:19,679 --> 00:22:21,360
analysts out well you know you can't do

677
00:22:21,360 --> 00:22:23,200
that but the question is is

678
00:22:23,200 --> 00:22:24,880
do we actually know where these things

679
00:22:24,880 --> 00:22:27,120
are working so

680
00:22:27,120 --> 00:22:29,200
in my examples they're all a look well

681
00:22:29,200 --> 00:22:30,880
most of them are a local alert that the

682
00:22:30,880 --> 00:22:32,880
dns one would have been on your maybe

683
00:22:32,880 --> 00:22:35,200
your firewalls or your proxy logs

684
00:22:35,200 --> 00:22:36,799
they would have been alerted would have

685
00:22:36,799 --> 00:22:38,320
alerted locally they would written into

686
00:22:38,320 --> 00:22:40,960
the log did that log get to the sock did

687
00:22:40,960 --> 00:22:43,440
it even get into the sim and that's

688
00:22:43,440 --> 00:22:45,440
where we started looking at this

689
00:22:45,440 --> 00:22:47,919
so we'd look at our purple team debrief

690
00:22:47,919 --> 00:22:49,760
the sock would look at what we've done

691
00:22:49,760 --> 00:22:51,360
we'd talk about it sometimes they caught

692
00:22:51,360 --> 00:22:52,799
us sometimes they didn't it was usually

693
00:22:52,799 --> 00:22:55,360
about 50 50. um and if there was

694
00:22:55,360 --> 00:22:57,440
anything where they went that what where

695
00:22:57,440 --> 00:22:58,720
we should have picked that up why did we

696
00:22:58,720 --> 00:23:00,720
not pick that up the beauty of this is

697
00:23:00,720 --> 00:23:03,039
we knew exactly where and when we'd done

698
00:23:03,039 --> 00:23:04,880
it we knew the machine name the time all

699
00:23:04,880 --> 00:23:06,559
that sort of thing go back into the

700
00:23:06,559 --> 00:23:08,559
audit trails go back into the sim go

701
00:23:08,559 --> 00:23:11,120
into the sock alerts and you can try and

702
00:23:11,120 --> 00:23:13,360
work out where that alerts somewhere got

703
00:23:13,360 --> 00:23:15,840
triaged out

704
00:23:15,840 --> 00:23:16,559
so

705
00:23:16,559 --> 00:23:17,840
how did this all work out for us in

706
00:23:17,840 --> 00:23:19,760
practice ah yeah this is where it goes

707
00:23:19,760 --> 00:23:20,559
wrong

708
00:23:20,559 --> 00:23:22,240
so we ran these tests for about nine

709
00:23:22,240 --> 00:23:25,039
months um as i said one or two a week

710
00:23:25,039 --> 00:23:27,120
random times random dates um so it

711
00:23:27,120 --> 00:23:28,480
wasn't always monday morning and they

712
00:23:28,480 --> 00:23:30,000
could be spread through the week it

713
00:23:30,000 --> 00:23:31,600
usually when i've got an extra half an

714
00:23:31,600 --> 00:23:33,520
hour i could just slot one in

715
00:23:33,520 --> 00:23:35,120
so we were just trying to build up this

716
00:23:35,120 --> 00:23:36,720
nice heat map what we've got where we've

717
00:23:36,720 --> 00:23:38,320
got where there were holes

718
00:23:38,320 --> 00:23:40,159
and at that point my employee decided

719
00:23:40,159 --> 00:23:41,679
that we didn't need an internal red team

720
00:23:41,679 --> 00:23:43,440
anymore so we were all made redundant

721
00:23:43,440 --> 00:23:45,039
and i moved sideways into my current

722
00:23:45,039 --> 00:23:46,480
role

723
00:23:46,480 --> 00:23:48,960
so yes this nine month project never

724
00:23:48,960 --> 00:23:51,200
really made any impact in in the grand

725
00:23:51,200 --> 00:23:52,720
scheme of things

726
00:23:52,720 --> 00:23:55,440
but the key takeaways so

727
00:23:55,440 --> 00:23:57,600
micro red teaming is a mouthful so it

728
00:23:57,600 --> 00:23:59,440
needs a better name uh defense

729
00:23:59,440 --> 00:24:00,799
engineering i know it's been mentioned

730
00:24:00,799 --> 00:24:02,880
in other places it does

731
00:24:02,880 --> 00:24:05,200
sum up what we're trying to do we spent

732
00:24:05,200 --> 00:24:07,120
all this money on

733
00:24:07,120 --> 00:24:09,679
next-gen hardware next-gen

734
00:24:09,679 --> 00:24:11,679
xyz it doesn't matter what it is but i'm

735
00:24:11,679 --> 00:24:13,919
sure it's next-gen we spend all the time

736
00:24:13,919 --> 00:24:16,000
getting those systems up running and

737
00:24:16,000 --> 00:24:17,279
installed

738
00:24:17,279 --> 00:24:18,799
and then do we actually go back and

739
00:24:18,799 --> 00:24:20,400
check that we're getting the alerts that

740
00:24:20,400 --> 00:24:21,760
we think we're getting

741
00:24:21,760 --> 00:24:22,480
so

742
00:24:22,480 --> 00:24:24,159
i said we'd try not to burn the analysts

743
00:24:24,159 --> 00:24:26,080
out so we tuned things out but do we

744
00:24:26,080 --> 00:24:28,320
tune too far and too much

745
00:24:28,320 --> 00:24:30,559
do we ever re-baseline our tools as

746
00:24:30,559 --> 00:24:32,640
often as we could so

747
00:24:32,640 --> 00:24:34,799
if you think back to my um

748
00:24:34,799 --> 00:24:37,360
the solarwinds thing they wrote that so

749
00:24:37,360 --> 00:24:39,360
that the dns string looked very much

750
00:24:39,360 --> 00:24:41,120
like an amazon string

751
00:24:41,120 --> 00:24:42,799
you know if you've said well if it looks

752
00:24:42,799 --> 00:24:44,240
this long and it's got so many bits

753
00:24:44,240 --> 00:24:45,840
you've got some clever regex that makes

754
00:24:45,840 --> 00:24:47,200
it look for

755
00:24:47,200 --> 00:24:50,720
usc let's go sorry usc us west it's

756
00:24:50,720 --> 00:24:52,400
entirely possible you've actually just

757
00:24:52,400 --> 00:24:54,720
managed to triage out the alert that you

758
00:24:54,720 --> 00:24:56,400
were looking to detect

759
00:24:56,400 --> 00:24:58,240
and finally do we have that right

760
00:24:58,240 --> 00:25:01,200
coverage um some systems are forever

761
00:25:01,200 --> 00:25:03,039
stuck in learning mode we we do use

762
00:25:03,039 --> 00:25:05,200
carbon black um i'm aware of a couple of

763
00:25:05,200 --> 00:25:06,880
systems that every time they move them

764
00:25:06,880 --> 00:25:08,799
off at learning mode something breaks

765
00:25:08,799 --> 00:25:10,640
they put them back in learning mode so

766
00:25:10,640 --> 00:25:12,559
the cost of that agent and they're not

767
00:25:12,559 --> 00:25:13,440
cheap

768
00:25:13,440 --> 00:25:15,039
is actually wasted it's not doing

769
00:25:15,039 --> 00:25:16,720
anything we're not getting any alerts

770
00:25:16,720 --> 00:25:18,640
sent back for it i'm sure we can do

771
00:25:18,640 --> 00:25:20,640
things better

772
00:25:20,640 --> 00:25:22,799
so what started off as a way to test our

773
00:25:22,799 --> 00:25:24,480
defenses kind of just changed as we went

774
00:25:24,480 --> 00:25:26,640
along um it didn't work out for us my

775
00:25:26,640 --> 00:25:28,559
current company but it could work out in

776
00:25:28,559 --> 00:25:31,440
yours um my ex red team manager

777
00:25:31,440 --> 00:25:33,200
is doing this same thing in his new role

778
00:25:33,200 --> 00:25:35,200
and he's always found bits where

779
00:25:35,200 --> 00:25:36,960
they've got to it and gone hey we should

780
00:25:36,960 --> 00:25:38,559
have gotten alert from that why didn't

781
00:25:38,559 --> 00:25:40,000
we and it's warranted further

782
00:25:40,000 --> 00:25:42,000
investigation into working out why or

783
00:25:42,000 --> 00:25:45,200
when or why something didn't happen

784
00:25:45,200 --> 00:25:46,480
um so

785
00:25:46,480 --> 00:25:48,559
as i said the real key takeaway the one

786
00:25:48,559 --> 00:25:50,000
thing if you do it

787
00:25:50,000 --> 00:25:51,840
other than somebody's time and effort

788
00:25:51,840 --> 00:25:53,520
there isn't any major cost to trying

789
00:25:53,520 --> 00:25:56,240
this process out all the software's free

790
00:25:56,240 --> 00:25:58,000
yes you've got somebody's time you need

791
00:25:58,000 --> 00:26:00,400
to spin up a couple of dns's if you get

792
00:26:00,400 --> 00:26:02,000
a little more complicated going down the

793
00:26:02,000 --> 00:26:03,440
line you'll probably need some domain

794
00:26:03,440 --> 00:26:04,720
names

795
00:26:04,720 --> 00:26:07,600
it's peanuts it really is you know

796
00:26:07,600 --> 00:26:09,120
with all the time that we did all these

797
00:26:09,120 --> 00:26:10,720
tests we probably never spent more than

798
00:26:10,720 --> 00:26:13,120
100 pounds on them so what have you got

799
00:26:13,120 --> 00:26:15,520
to lose if you want to try this out and

800
00:26:15,520 --> 00:26:17,440
what visibility might you actually gain

801
00:26:17,440 --> 00:26:20,960
into how your systems might be at risk

802
00:26:20,960 --> 00:26:22,400
and that's it i just have a couple of

803
00:26:22,400 --> 00:26:26,320
thank yous um firstly to all the people

804
00:26:26,320 --> 00:26:29,200
in red canary and sra who made the

805
00:26:29,200 --> 00:26:30,320
they've got the tools out there that

806
00:26:30,320 --> 00:26:33,200
gave them away made life a lot easier

807
00:26:33,200 --> 00:26:34,960
the people that actually contributed to

808
00:26:34,960 --> 00:26:37,120
all those red team tests i don't think i

809
00:26:37,120 --> 00:26:38,240
could have sit and written the scripts

810
00:26:38,240 --> 00:26:40,159
myself in fact i know i couldn't but

811
00:26:40,159 --> 00:26:41,600
because somebody's done it it's easy to

812
00:26:41,600 --> 00:26:43,200
pick them up go and use them pick them

813
00:26:43,200 --> 00:26:44,320
off the shelf

814
00:26:44,320 --> 00:26:46,000
and thankfully to whoever gave that

815
00:26:46,000 --> 00:26:46,960
talker

816
00:26:46,960 --> 00:26:49,600
all that years ago um that put the idea

817
00:26:49,600 --> 00:26:51,279
in my manager's head and

818
00:26:51,279 --> 00:26:53,440
got me to go and run with it

819
00:26:53,440 --> 00:26:54,960
last couple of things

820
00:26:54,960 --> 00:26:57,279
uh chris b chris m my two red team

821
00:26:57,279 --> 00:26:59,760
colleagues we had a lot of fun in two

822
00:26:59,760 --> 00:27:01,840
and a half years i think one of them may

823
00:27:01,840 --> 00:27:03,760
be listening in i'm not sure if he is

824
00:27:03,760 --> 00:27:04,720
hello

825
00:27:04,720 --> 00:27:05,520
um

826
00:27:05,520 --> 00:27:07,520
it did took me a huge amount in that

827
00:27:07,520 --> 00:27:09,120
short time we were active it was really

828
00:27:09,120 --> 00:27:11,760
interesting and also to our blue team

829
00:27:11,760 --> 00:27:13,440
and again i think there's might be one

830
00:27:13,440 --> 00:27:15,840
of our ex blue team listening in hello

831
00:27:15,840 --> 00:27:18,080
um they took it entirely in the right

832
00:27:18,080 --> 00:27:20,000
way they didn't see it as red team just

833
00:27:20,000 --> 00:27:22,960
being trouble red team looking to

834
00:27:22,960 --> 00:27:24,720
just create a problem find a problem and

835
00:27:24,720 --> 00:27:26,159
keep saying you've not fixed it you've

836
00:27:26,159 --> 00:27:27,760
not fixed it it was definitely a

837
00:27:27,760 --> 00:27:29,440
learning experience for us both to go

838
00:27:29,440 --> 00:27:31,279
back understand what could work

839
00:27:31,279 --> 00:27:32,960
understand what couldn't work and

840
00:27:32,960 --> 00:27:34,320
ultimately how we could defend the

841
00:27:34,320 --> 00:27:36,720
company better

842
00:27:36,720 --> 00:27:38,240
and that's it if i haven't talked too

843
00:27:38,240 --> 00:27:40,240
much and hit the time limit i'm kind of

844
00:27:40,240 --> 00:27:42,720
happy to take questions uh there is my

845
00:27:42,720 --> 00:27:44,720
twitter handle there it's gjc but there

846
00:27:44,720 --> 00:27:46,000
are two underscores because somebody

847
00:27:46,000 --> 00:27:48,240
else had stole it but i don't know

848
00:27:48,240 --> 00:27:51,200
whether i'm at time

849
00:27:51,679 --> 00:27:52,799
you you

850
00:27:52,799 --> 00:27:55,520
run perfectly to time but we are running

851
00:27:55,520 --> 00:27:57,760
over time no problem

852
00:27:57,760 --> 00:27:59,440
but that's absolutely fine

853
00:27:59,440 --> 00:28:01,600
so gavin thank you very much indeed

854
00:28:01,600 --> 00:28:04,720
another great thought great feedback um

855
00:28:04,720 --> 00:28:08,799
thanks for joining us cheers hey bye

856
00:28:08,799 --> 00:28:12,559
brilliant thanks kevin

