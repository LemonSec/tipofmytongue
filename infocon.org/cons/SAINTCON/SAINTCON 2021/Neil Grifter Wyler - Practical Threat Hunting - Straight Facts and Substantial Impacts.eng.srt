1
00:00:00,080 --> 00:00:02,320
who am i uh my name is neil weiler in

2
00:00:02,320 --> 00:00:03,760
the information security community i'm

3
00:00:03,760 --> 00:00:06,640
better known as grifter um

4
00:00:06,640 --> 00:00:09,440
by day i am the global lead of active

5
00:00:09,440 --> 00:00:11,920
threat assessments for ibm x-force

6
00:00:11,920 --> 00:00:14,160
or i have been for a couple of days

7
00:00:14,160 --> 00:00:16,800
i just started with ibm x force in that

8
00:00:16,800 --> 00:00:18,480
role for the last six years i've been a

9
00:00:18,480 --> 00:00:21,439
principal threat hunter at rsa

10
00:00:21,439 --> 00:00:23,279
by night i run all the technical

11
00:00:23,279 --> 00:00:24,640
operations for the black hat security

12
00:00:24,640 --> 00:00:26,720
briefings i'm one of the main organizers

13
00:00:26,720 --> 00:00:29,519
of defcon i'm on the review boards for

14
00:00:29,519 --> 00:00:31,119
black hat and defcon i've written some

15
00:00:31,119 --> 00:00:33,680
books i speak all over the world yay

16
00:00:33,680 --> 00:00:36,559
mommy's proud um so

17
00:00:36,559 --> 00:00:38,320
uh like i said 90 minutes worth of

18
00:00:38,320 --> 00:00:41,280
content so let's roll

19
00:00:41,280 --> 00:00:42,480
so we're going to talk about hunting

20
00:00:42,480 --> 00:00:43,680
right so let's start out with what

21
00:00:43,680 --> 00:00:45,760
hunting is um and i've got a nice shiny

22
00:00:45,760 --> 00:00:47,680
definition here that just says hunting

23
00:00:47,680 --> 00:00:49,520
is proactively searching through data in

24
00:00:49,520 --> 00:00:50,800
order to detect threats which have

25
00:00:50,800 --> 00:00:52,879
evaded traditional security measures and

26
00:00:52,879 --> 00:00:54,399
that's a great definition if you're

27
00:00:54,399 --> 00:00:55,840
explaining what hunting is to somebody

28
00:00:55,840 --> 00:00:56,960
who

29
00:00:56,960 --> 00:00:58,879
doesn't you know understand what

30
00:00:58,879 --> 00:01:01,440
information security is or um you're

31
00:01:01,440 --> 00:01:03,680
just trying to kind of give them the the

32
00:01:03,680 --> 00:01:05,600
blandest possible way of describing what

33
00:01:05,600 --> 00:01:07,119
you do

34
00:01:07,119 --> 00:01:09,040
some what what hunting really is though

35
00:01:09,040 --> 00:01:11,360
is just doing ir without knowing that

36
00:01:11,360 --> 00:01:13,200
you're owned right we do a lot of the

37
00:01:13,200 --> 00:01:15,200
same things it's investigatory like we

38
00:01:15,200 --> 00:01:17,280
go in and check things out we do a lot

39
00:01:17,280 --> 00:01:20,159
of the same processes it's ir

40
00:01:20,159 --> 00:01:21,680
when you're not sure if an attacker is

41
00:01:21,680 --> 00:01:23,439
there sometimes it leads to finding an

42
00:01:23,439 --> 00:01:24,479
attacker

43
00:01:24,479 --> 00:01:26,240
sometimes it leads to hours of you just

44
00:01:26,240 --> 00:01:28,000
clicking around on stuff

45
00:01:28,000 --> 00:01:30,240
and we'll get into that a little bit

46
00:01:30,240 --> 00:01:32,400
hunting itself is it's important to

47
00:01:32,400 --> 00:01:34,079
point out is human driven this is not a

48
00:01:34,079 --> 00:01:36,880
piece of software this is someone with a

49
00:01:36,880 --> 00:01:38,479
set of skills

50
00:01:38,479 --> 00:01:40,320
that is going in and using those skills

51
00:01:40,320 --> 00:01:42,240
to try to detect an attacker persisting

52
00:01:42,240 --> 00:01:44,560
within the environment

53
00:01:44,560 --> 00:01:45,680
despite

54
00:01:45,680 --> 00:01:46,960
what

55
00:01:46,960 --> 00:01:48,880
you see on expo floors of places like

56
00:01:48,880 --> 00:01:52,079
rsa conference or black hat this is not

57
00:01:52,079 --> 00:01:53,439
something that

58
00:01:53,439 --> 00:01:55,040
you can just fire off a piece of

59
00:01:55,040 --> 00:01:57,119
software or put another box in your

60
00:01:57,119 --> 00:01:59,040
environment and just expect it to do it

61
00:01:59,040 --> 00:02:00,079
for you

62
00:02:00,079 --> 00:02:02,880
hunting requires people

63
00:02:02,880 --> 00:02:05,119
it's proactive not reactive right so

64
00:02:05,119 --> 00:02:07,680
we're deciding i'm gonna go look before

65
00:02:07,680 --> 00:02:09,840
we get some alert or incident that comes

66
00:02:09,840 --> 00:02:11,520
into our queue so we're gonna go look

67
00:02:11,520 --> 00:02:13,120
first and and

68
00:02:13,120 --> 00:02:14,879
find out if somebody is there it's

69
00:02:14,879 --> 00:02:16,480
better not to wait when you're playing

70
00:02:16,480 --> 00:02:19,200
hide and seek go seek

71
00:02:19,200 --> 00:02:21,120
and it's iterative right it's not random

72
00:02:21,120 --> 00:02:22,879
it should be a repeatable process

73
00:02:22,879 --> 00:02:25,040
something that we're able to do over and

74
00:02:25,040 --> 00:02:26,959
over again so if we find something

75
00:02:26,959 --> 00:02:28,560
that's interesting or a certain type of

76
00:02:28,560 --> 00:02:30,480
data that's interesting what we want to

77
00:02:30,480 --> 00:02:32,480
be able to do is find that type of

78
00:02:32,480 --> 00:02:34,400
information again

79
00:02:34,400 --> 00:02:36,239
that allows us to make our hunts

80
00:02:36,239 --> 00:02:38,560
repeatable to document things to hand

81
00:02:38,560 --> 00:02:40,640
those off to maybe junior hunters or

82
00:02:40,640 --> 00:02:42,319
other hunters that you can say like hey

83
00:02:42,319 --> 00:02:44,720
i found interesting stuff it also means

84
00:02:44,720 --> 00:02:47,360
that maybe we create an automation

85
00:02:47,360 --> 00:02:49,599
playbook or another alert or something

86
00:02:49,599 --> 00:02:51,440
like that

87
00:02:51,440 --> 00:02:52,640
you know those are things that we can

88
00:02:52,640 --> 00:02:55,040
gain throughout our hunt

89
00:02:55,040 --> 00:02:56,640
but let's talk about what threat hunting

90
00:02:56,640 --> 00:02:58,560
isn't right it's not hitting ctrl f and

91
00:02:58,560 --> 00:03:00,319
just putting in an ioc right we're not

92
00:03:00,319 --> 00:03:03,040
just going and looking for the next

93
00:03:03,040 --> 00:03:04,400
file hash or

94
00:03:04,400 --> 00:03:07,040
uh you know ip address host name that

95
00:03:07,040 --> 00:03:08,640
kind of thing that's not hunting that's

96
00:03:08,640 --> 00:03:09,920
just um

97
00:03:09,920 --> 00:03:12,239
you know googling or i think we're

98
00:03:12,239 --> 00:03:13,840
supposed to say duck now right right

99
00:03:13,840 --> 00:03:16,000
okay yeah ducking

100
00:03:16,000 --> 00:03:17,280
so

101
00:03:17,280 --> 00:03:18,640
um

102
00:03:18,640 --> 00:03:21,120
it's not automated so again despite what

103
00:03:21,120 --> 00:03:22,720
you see on the banners and the shiny

104
00:03:22,720 --> 00:03:24,959
displays on expo floors that security

105
00:03:24,959 --> 00:03:26,879
conferences everywhere hunting is not

106
00:03:26,879 --> 00:03:28,480
automated

107
00:03:28,480 --> 00:03:30,560
it is someone going through and doing a

108
00:03:30,560 --> 00:03:32,799
process or following a framework or just

109
00:03:32,799 --> 00:03:35,280
following a hunch it's not something

110
00:03:35,280 --> 00:03:36,720
that you just go

111
00:03:36,720 --> 00:03:38,959
do it and it goes off and does that for

112
00:03:38,959 --> 00:03:41,120
you there are aspects of hunting that

113
00:03:41,120 --> 00:03:43,360
can be automated you can create reports

114
00:03:43,360 --> 00:03:45,040
things like that but hunting itself

115
00:03:45,040 --> 00:03:48,239
isn't automated it's also not new

116
00:03:48,239 --> 00:03:50,000
hunting itself or threat hunting as a

117
00:03:50,000 --> 00:03:53,120
term you know is less than 10 years old

118
00:03:53,120 --> 00:03:54,720
it sounds really cool and it's fun to

119
00:03:54,720 --> 00:03:57,040
put on a business card but in reality

120
00:03:57,040 --> 00:03:58,319
we've been doing these things in

121
00:03:58,319 --> 00:04:00,480
incident response forever right if

122
00:04:00,480 --> 00:04:02,959
you've ever taken a bunch of domains and

123
00:04:02,959 --> 00:04:04,879
dumped them into excel or something and

124
00:04:04,879 --> 00:04:06,879
then stack counted them and been like oh

125
00:04:06,879 --> 00:04:08,799
this only shows up a couple of times

126
00:04:08,799 --> 00:04:10,640
across the whole organization i'm going

127
00:04:10,640 --> 00:04:12,640
to take a look at what that is that's

128
00:04:12,640 --> 00:04:14,640
threat hunting so you have been doing

129
00:04:14,640 --> 00:04:15,840
this

130
00:04:15,840 --> 00:04:18,079
it's also not wizardry

131
00:04:18,079 --> 00:04:19,600
right

132
00:04:19,600 --> 00:04:21,358
having somebody who is a generalist who

133
00:04:21,358 --> 00:04:23,199
understands a lot of operating systems a

134
00:04:23,199 --> 00:04:24,880
lot of protocols different things that

135
00:04:24,880 --> 00:04:27,840
they can go and investigate about is

136
00:04:27,840 --> 00:04:30,080
fantastic but even if you have a junior

137
00:04:30,080 --> 00:04:32,400
analyst or somebody who's new

138
00:04:32,400 --> 00:04:35,440
all of us have a specific bias right

139
00:04:35,440 --> 00:04:37,759
there's some part of technology or part

140
00:04:37,759 --> 00:04:40,000
of security that we are better at than

141
00:04:40,000 --> 00:04:42,400
other parts so take your hunt your

142
00:04:42,400 --> 00:04:43,919
junior analyst or your junior hunters

143
00:04:43,919 --> 00:04:45,840
and point them at that thing right if

144
00:04:45,840 --> 00:04:47,680
you have that like sadist within your

145
00:04:47,680 --> 00:04:50,880
organization just loves dns like

146
00:04:50,880 --> 00:04:53,199
point them at dns it's usually dns right

147
00:04:53,199 --> 00:04:56,880
so now it's always dns

148
00:04:57,040 --> 00:04:59,120
why do we want to hunt well

149
00:04:59,120 --> 00:05:01,039
we're hunting because we're looking for

150
00:05:01,039 --> 00:05:02,560
undetected threats we're looking for the

151
00:05:02,560 --> 00:05:04,160
things that the blinky boxes and the

152
00:05:04,160 --> 00:05:06,560
shiny things we buy from vendors aren't

153
00:05:06,560 --> 00:05:08,960
finding we want to find those undetected

154
00:05:08,960 --> 00:05:10,800
threats because it reduces the dwell

155
00:05:10,800 --> 00:05:12,320
time that attackers get to hang out

156
00:05:12,320 --> 00:05:14,880
within our environment and that

157
00:05:14,880 --> 00:05:16,880
is the goal right we don't want to be

158
00:05:16,880 --> 00:05:18,560
that company who's on the news after a

159
00:05:18,560 --> 00:05:20,000
breach and they're like and evidence

160
00:05:20,000 --> 00:05:22,000
shows they were in there for seven years

161
00:05:22,000 --> 00:05:23,680
right you know that's

162
00:05:23,680 --> 00:05:25,120
no thank you

163
00:05:25,120 --> 00:05:26,560
um you're also going to learn your

164
00:05:26,560 --> 00:05:28,000
environment better than you ever have

165
00:05:28,000 --> 00:05:29,440
before and for me i think this is the

166
00:05:29,440 --> 00:05:31,440
biggest hidden return on investment of

167
00:05:31,440 --> 00:05:32,800
hunting is that you'll start to

168
00:05:32,800 --> 00:05:34,800
understand things like why did we create

169
00:05:34,800 --> 00:05:37,759
our golden images this way why

170
00:05:37,759 --> 00:05:40,000
do we use these protocols why do we not

171
00:05:40,000 --> 00:05:41,840
use these protocols why did the network

172
00:05:41,840 --> 00:05:43,440
team configure things like this or

173
00:05:43,440 --> 00:05:45,360
segment this like this

174
00:05:45,360 --> 00:05:47,440
it helps you understand the way that

175
00:05:47,440 --> 00:05:50,160
your organization is structured and when

176
00:05:50,160 --> 00:05:52,400
you have that understanding it gives you

177
00:05:52,400 --> 00:05:55,039
a huge advantage over an attacker and i

178
00:05:55,039 --> 00:05:56,479
can tell you as somebody who lived on

179
00:05:56,479 --> 00:05:58,160
the red team side of the house for for

180
00:05:58,160 --> 00:06:00,800
many years that if an attacker gains

181
00:06:00,800 --> 00:06:03,199
access to your environment the first

182
00:06:03,199 --> 00:06:05,280
thing that they're going to do is learn

183
00:06:05,280 --> 00:06:07,440
everything that they can about your

184
00:06:07,440 --> 00:06:11,840
environment so you should do that first

185
00:06:12,479 --> 00:06:14,160
it's also just going to help you improve

186
00:06:14,160 --> 00:06:17,039
your organizational posture overall

187
00:06:17,039 --> 00:06:18,560
you're

188
00:06:18,560 --> 00:06:20,479
not always going to find exfiltration to

189
00:06:20,479 --> 00:06:22,080
china or some

190
00:06:22,080 --> 00:06:24,800
russian organized crime group right

191
00:06:24,800 --> 00:06:26,479
and that's good

192
00:06:26,479 --> 00:06:27,759
we don't want to find that i'm going to

193
00:06:27,759 --> 00:06:29,120
go do a hunt today

194
00:06:29,120 --> 00:06:31,759
dear god no like you know no you want to

195
00:06:31,759 --> 00:06:33,280
go and do your hunts and do them

196
00:06:33,280 --> 00:06:35,280
repeatedly every day go out and try to

197
00:06:35,280 --> 00:06:36,880
find something interesting you're not

198
00:06:36,880 --> 00:06:38,479
always going to find exfiltration to

199
00:06:38,479 --> 00:06:41,520
china but what you will find are gaps in

200
00:06:41,520 --> 00:06:43,639
the way that your security is set up

201
00:06:43,639 --> 00:06:45,360
misconfigurations

202
00:06:45,360 --> 00:06:47,680
that exist within the environment

203
00:06:47,680 --> 00:06:49,520
and you'll find them before an attacker

204
00:06:49,520 --> 00:06:50,800
does right and what that means is you

205
00:06:50,800 --> 00:06:53,360
can go and fix those things before they

206
00:06:53,360 --> 00:06:55,280
become a problem before they become a

207
00:06:55,280 --> 00:06:58,160
foothold or an enabler of compromise for

208
00:06:58,160 --> 00:07:00,240
your organization so you're reducing

209
00:07:00,240 --> 00:07:03,039
your overall attack surface

210
00:07:03,039 --> 00:07:04,479
and finally

211
00:07:04,479 --> 00:07:06,240
why hunt well just makes your analyst

212
00:07:06,240 --> 00:07:08,479
better it allows you to instead of

213
00:07:08,479 --> 00:07:09,840
sitting there

214
00:07:09,840 --> 00:07:10,800
taking

215
00:07:10,800 --> 00:07:12,720
incident after incident out of a queue

216
00:07:12,720 --> 00:07:15,120
i've been in that role before it is soul

217
00:07:15,120 --> 00:07:16,560
crushing right you're just like oh let

218
00:07:16,560 --> 00:07:18,080
me make sure the mitigation worked it

219
00:07:18,080 --> 00:07:20,880
did and here are my notes and good right

220
00:07:20,880 --> 00:07:22,000
like

221
00:07:22,000 --> 00:07:23,759
it allows you to take the knowledge that

222
00:07:23,759 --> 00:07:25,440
you gain from doing things like this

223
00:07:25,440 --> 00:07:27,440
coming to a conference reading all the

224
00:07:27,440 --> 00:07:28,800
books the training classes that you've

225
00:07:28,800 --> 00:07:31,680
gone to and decide what you're going to

226
00:07:31,680 --> 00:07:34,800
go look for decide what you think is the

227
00:07:34,800 --> 00:07:37,120
thing that is actually going to matter

228
00:07:37,120 --> 00:07:39,440
to the organization and spend your time

229
00:07:39,440 --> 00:07:41,440
there and when you do that you do two

230
00:07:41,440 --> 00:07:43,039
things one you're focused on something

231
00:07:43,039 --> 00:07:45,120
that you care about and two it's just

232
00:07:45,120 --> 00:07:48,000
plain good for morale right so

233
00:07:48,000 --> 00:07:50,879
allow yourself to be the investigator

234
00:07:50,879 --> 00:07:52,639
you were told you were going to be when

235
00:07:52,639 --> 00:07:54,720
you got onto the blue team side of the

236
00:07:54,720 --> 00:07:56,800
house

237
00:07:56,800 --> 00:07:59,280
documentation yay let's talk about

238
00:07:59,280 --> 00:08:01,759
documentation um everybody's favorite

239
00:08:01,759 --> 00:08:02,960
topic

240
00:08:02,960 --> 00:08:05,599
honestly uh you gotta write stuff down

241
00:08:05,599 --> 00:08:06,960
um if you're not writing it down it

242
00:08:06,960 --> 00:08:08,720
might as well not have happened you

243
00:08:08,720 --> 00:08:11,440
wanna do this for two reasons one

244
00:08:11,440 --> 00:08:14,080
it allows you to show management the

245
00:08:14,080 --> 00:08:15,680
value and the time that you're spending

246
00:08:15,680 --> 00:08:18,000
hunting you can say this is the reason

247
00:08:18,000 --> 00:08:19,759
that we spend this time doing this is

248
00:08:19,759 --> 00:08:22,000
because i was able to find these gaps in

249
00:08:22,000 --> 00:08:23,440
our infrastructure i was able to find

250
00:08:23,440 --> 00:08:25,039
these vulnerabilities

251
00:08:25,039 --> 00:08:27,599
and that allows you more time or to

252
00:08:27,599 --> 00:08:29,919
become a full-time hunter or hire a

253
00:08:29,919 --> 00:08:32,240
full-time hunter expand that hunting

254
00:08:32,240 --> 00:08:33,519
program

255
00:08:33,519 --> 00:08:34,719
so what you're going to want to write

256
00:08:34,719 --> 00:08:37,039
down are things like gaps identify so

257
00:08:37,039 --> 00:08:40,000
gaps in logging any vulnerabilities

258
00:08:40,000 --> 00:08:42,320
issues that you came across and how they

259
00:08:42,320 --> 00:08:44,800
were resolved so as you find things and

260
00:08:44,800 --> 00:08:46,240
you escalate them up to different parts

261
00:08:46,240 --> 00:08:48,800
of i.t or the organization

262
00:08:48,800 --> 00:08:50,320
follow up with them make sure that those

263
00:08:50,320 --> 00:08:52,560
gaps were closed otherwise what was the

264
00:08:52,560 --> 00:08:53,920
point

265
00:08:53,920 --> 00:08:57,360
so follow those things to resolution

266
00:08:57,360 --> 00:08:58,959
the hypothesis that you came up with

267
00:08:58,959 --> 00:09:01,200
when you started to hunt so if you said

268
00:09:01,200 --> 00:09:02,800
what am i going to go hunt for today and

269
00:09:02,800 --> 00:09:04,080
you're like well let me put myself in

270
00:09:04,080 --> 00:09:06,320
the attacker mindset if it was me and i

271
00:09:06,320 --> 00:09:08,720
was going to attack our organization

272
00:09:08,720 --> 00:09:10,959
how would i try to exfiltrate data from

273
00:09:10,959 --> 00:09:12,880
our environment

274
00:09:12,880 --> 00:09:14,640
i'm going to go look there right write

275
00:09:14,640 --> 00:09:18,080
down what you were hunting for what gave

276
00:09:18,080 --> 00:09:19,760
you the idea to go look there and what

277
00:09:19,760 --> 00:09:21,440
did you do

278
00:09:21,440 --> 00:09:22,959
right you want to make sure that you are

279
00:09:22,959 --> 00:09:26,959
laying out how you spent that time

280
00:09:26,959 --> 00:09:29,120
and of course any new alerts that you

281
00:09:29,120 --> 00:09:30,880
come up with so if you do find something

282
00:09:30,880 --> 00:09:32,800
find a new indicator of compromise find

283
00:09:32,800 --> 00:09:34,880
something that you can create a rule on

284
00:09:34,880 --> 00:09:35,680
or

285
00:09:35,680 --> 00:09:39,360
an additional analytical path for your

286
00:09:39,360 --> 00:09:40,720
you know automation solution or

287
00:09:40,720 --> 00:09:43,519
something write those things down and

288
00:09:43,519 --> 00:09:45,920
and of course anything you discover find

289
00:09:45,920 --> 00:09:47,839
a compromised host find an attacker

290
00:09:47,839 --> 00:09:49,600
persisting in the environment write it

291
00:09:49,600 --> 00:09:51,519
down again

292
00:09:51,519 --> 00:09:53,839
two reasons for this one get more time

293
00:09:53,839 --> 00:09:55,200
to hunt

294
00:09:55,200 --> 00:09:58,399
hire another full-time employee to hunt

295
00:09:58,399 --> 00:10:00,480
whatever it is

296
00:10:00,480 --> 00:10:02,480
but also because the end of year

297
00:10:02,480 --> 00:10:03,920
performance review is going to show up

298
00:10:03,920 --> 00:10:05,760
and selfishly you'll have a bunch of

299
00:10:05,760 --> 00:10:07,120
really cool stuff that you can put on

300
00:10:07,120 --> 00:10:08,720
there where you're like i found this i

301
00:10:08,720 --> 00:10:10,560
found this i closed these gaps i was

302
00:10:10,560 --> 00:10:12,720
able to detect these compromised hosts

303
00:10:12,720 --> 00:10:14,720
those are really good things for that

304
00:10:14,720 --> 00:10:16,839
end of year review so good for the

305
00:10:16,839 --> 00:10:19,600
organization uh good for you because

306
00:10:19,600 --> 00:10:21,680
you'll get additional help within your

307
00:10:21,680 --> 00:10:23,839
stock and hopefully some more time to

308
00:10:23,839 --> 00:10:26,640
hunt or additional hunters but also good

309
00:10:26,640 --> 00:10:27,839
to get that

310
00:10:27,839 --> 00:10:32,560
that stellar raise every year right

311
00:10:32,560 --> 00:10:34,560
all right so let's talk about the data

312
00:10:34,560 --> 00:10:37,279
um from a data set standpoint we start

313
00:10:37,279 --> 00:10:39,839
out with logs right the gold standard

314
00:10:39,839 --> 00:10:41,600
for decades and the gold standard for

315
00:10:41,600 --> 00:10:43,360
decades to come i'm sure

316
00:10:43,360 --> 00:10:45,600
logs

317
00:10:45,600 --> 00:10:48,399
storage is cheap log everything so i put

318
00:10:48,399 --> 00:10:50,480
on here collect logs from key areas

319
00:10:50,480 --> 00:10:53,279
those key areas are everything

320
00:10:53,279 --> 00:10:55,519
if it creates a log log it write it to

321
00:10:55,519 --> 00:10:57,839
disk i don't necessarily mean put it in

322
00:10:57,839 --> 00:11:00,880
your sim right because that's expensive

323
00:11:00,880 --> 00:11:02,320
depending on which solution you bought

324
00:11:02,320 --> 00:11:03,680
right so

325
00:11:03,680 --> 00:11:06,480
but i do mean keep the logs

326
00:11:06,480 --> 00:11:08,880
even if you don't look at your logs and

327
00:11:08,880 --> 00:11:10,160
please

328
00:11:10,160 --> 00:11:12,240
please look at your logs

329
00:11:12,240 --> 00:11:14,560
but even if you don't look at your logs

330
00:11:14,560 --> 00:11:16,399
if you experience a breach and you're

331
00:11:16,399 --> 00:11:18,640
able to have an ir team come in and you

332
00:11:18,640 --> 00:11:20,720
should have an ir team come in even if

333
00:11:20,720 --> 00:11:23,200
you have your own if this is the whole

334
00:11:23,200 --> 00:11:25,279
like don't do your own defense even if

335
00:11:25,279 --> 00:11:28,240
you're a lawyer type of thing like uh

336
00:11:28,240 --> 00:11:30,240
bring in a second set of eyes so when

337
00:11:30,240 --> 00:11:32,240
another team comes in an ir team comes

338
00:11:32,240 --> 00:11:34,399
in they're able to look at all of that

339
00:11:34,399 --> 00:11:35,920
log data they're going to love you

340
00:11:35,920 --> 00:11:36,959
you're going to be in a much better

341
00:11:36,959 --> 00:11:39,920
situation so if it creates a log

342
00:11:39,920 --> 00:11:42,079
log it

343
00:11:42,079 --> 00:11:44,240
network side of the house

344
00:11:44,240 --> 00:11:46,320
i love the network side of the house i

345
00:11:46,320 --> 00:11:48,880
i would just let p caps wash over me all

346
00:11:48,880 --> 00:11:51,360
day if i could i know that

347
00:11:51,360 --> 00:11:53,440
that makes me super weird but i said

348
00:11:53,440 --> 00:11:55,839
everybody has their thing for you it's

349
00:11:55,839 --> 00:11:58,480
dns for you you just like the you know

350
00:11:58,480 --> 00:12:00,079
minutiae of different operating systems

351
00:12:00,079 --> 00:12:01,440
for me

352
00:12:01,440 --> 00:12:02,880
pcaps

353
00:12:02,880 --> 00:12:04,000
so

354
00:12:04,000 --> 00:12:05,600
on the network side of the house all

355
00:12:05,600 --> 00:12:07,279
your network data understand what your

356
00:12:07,279 --> 00:12:09,279
ingress and egress points are right so

357
00:12:09,279 --> 00:12:11,360
how does data flow into and flow out of

358
00:12:11,360 --> 00:12:13,360
your environment

359
00:12:13,360 --> 00:12:15,600
where is data leaving as important when

360
00:12:15,600 --> 00:12:17,440
you're trying to understand how an

361
00:12:17,440 --> 00:12:19,360
attacker is going to move the crown

362
00:12:19,360 --> 00:12:21,120
jewels out if they

363
00:12:21,120 --> 00:12:23,360
ever do get in

364
00:12:23,360 --> 00:12:24,959
understand your subnet roles how your

365
00:12:24,959 --> 00:12:26,720
network is segmented how do you carve

366
00:12:26,720 --> 00:12:28,800
things up right what can talk to what

367
00:12:28,800 --> 00:12:31,519
those are important things to understand

368
00:12:31,519 --> 00:12:33,200
and a huge one is establishing

369
00:12:33,200 --> 00:12:34,720
directionality

370
00:12:34,720 --> 00:12:37,519
not everybody follows rfc 1918 there's a

371
00:12:37,519 --> 00:12:39,200
bunch of random ip addresses that are

372
00:12:39,200 --> 00:12:40,959
within organizations what's important to

373
00:12:40,959 --> 00:12:43,600
you is is that data flowing in is that

374
00:12:43,600 --> 00:12:45,920
data flowing out or is that lateral

375
00:12:45,920 --> 00:12:47,360
movement right is that just something

376
00:12:47,360 --> 00:12:49,600
that's going on inside the network if i

377
00:12:49,600 --> 00:12:51,680
go out on an engagement

378
00:12:51,680 --> 00:12:54,079
usually the first half of the first day

379
00:12:54,079 --> 00:12:56,240
is spent just understanding that how

380
00:12:56,240 --> 00:12:58,800
does data move around this organization

381
00:12:58,800 --> 00:13:00,639
and then i spend the next several days

382
00:13:00,639 --> 00:13:02,800
just hunting but i need to know how that

383
00:13:02,800 --> 00:13:04,639
date is flowing because some things you

384
00:13:04,639 --> 00:13:06,800
might really care about if they're

385
00:13:06,800 --> 00:13:08,079
coming in

386
00:13:08,079 --> 00:13:10,160
and some things you won't care at all

387
00:13:10,160 --> 00:13:13,839
and you know vice versa so

388
00:13:13,920 --> 00:13:16,000
and for me full packet capture i told

389
00:13:16,000 --> 00:13:17,920
you i love me some keycaps

390
00:13:17,920 --> 00:13:19,839
full packet capture is huge if you don't

391
00:13:19,839 --> 00:13:21,519
have full packet capture within your

392
00:13:21,519 --> 00:13:23,920
organization go get it

393
00:13:23,920 --> 00:13:26,079
full packet capture is the

394
00:13:26,079 --> 00:13:27,360
i don't know if i should be insulted by

395
00:13:27,360 --> 00:13:30,320
that ringtone that sounds like cricket

396
00:13:30,320 --> 00:13:31,760
but i am

397
00:13:31,760 --> 00:13:33,680
no uh so

398
00:13:33,680 --> 00:13:35,680
full packet capture is essentially at

399
00:13:35,680 --> 00:13:37,519
least to me i liken full packet capture

400
00:13:37,519 --> 00:13:39,760
to video surveillance for your network

401
00:13:39,760 --> 00:13:41,440
right and we wouldn't build a building

402
00:13:41,440 --> 00:13:44,160
today and not put

403
00:13:44,160 --> 00:13:46,320
video surveillance on the building right

404
00:13:46,320 --> 00:13:48,880
well logs are great logs are you walking

405
00:13:48,880 --> 00:13:50,560
up and badging in in the morning and you

406
00:13:50,560 --> 00:13:52,560
get a log that says you know grifter

407
00:13:52,560 --> 00:13:55,040
showed up today at 9 00 am

408
00:13:55,040 --> 00:13:57,040
and it's like great there he is and

409
00:13:57,040 --> 00:13:58,639
that's the information you have oh he

410
00:13:58,639 --> 00:14:00,320
badged into this other room he came into

411
00:14:00,320 --> 00:14:01,680
the sock

412
00:14:01,680 --> 00:14:03,440
and that kind of stuff it's very limited

413
00:14:03,440 --> 00:14:05,360
it tells you some things about what i

414
00:14:05,360 --> 00:14:08,560
did but with full packet capture um it's

415
00:14:08,560 --> 00:14:09,760
the same as video surveillance where

416
00:14:09,760 --> 00:14:11,440
it's like is that actually grifter yes

417
00:14:11,440 --> 00:14:13,600
it is oh he was carrying a box that had

418
00:14:13,600 --> 00:14:15,040
these things in it

419
00:14:15,040 --> 00:14:16,959
when he came in he left something from

420
00:14:16,959 --> 00:14:19,040
that box and this pl in this room and

421
00:14:19,040 --> 00:14:20,800
this room then he took things from those

422
00:14:20,800 --> 00:14:22,399
rooms put them back in the box and left

423
00:14:22,399 --> 00:14:24,399
the environment with full packet capture

424
00:14:24,399 --> 00:14:27,040
that means that i understand oh this

425
00:14:27,040 --> 00:14:28,399
person came into my environment with a

426
00:14:28,399 --> 00:14:30,160
box of tools they put those tools here

427
00:14:30,160 --> 00:14:31,920
they deployed that there when they left

428
00:14:31,920 --> 00:14:33,279
they took these files and they put that

429
00:14:33,279 --> 00:14:35,440
in the box and off they went right

430
00:14:35,440 --> 00:14:37,760
what i can do is actually pull the

431
00:14:37,760 --> 00:14:39,600
things out of the box take a look at

432
00:14:39,600 --> 00:14:41,680
them see what they got so when you have

433
00:14:41,680 --> 00:14:43,040
full packet capturing you're seeing

434
00:14:43,040 --> 00:14:44,240
tools being deployed in your

435
00:14:44,240 --> 00:14:45,839
organization or malware being deployed

436
00:14:45,839 --> 00:14:47,519
in your organization and you can pull

437
00:14:47,519 --> 00:14:49,600
that tool or piece of malware out of the

438
00:14:49,600 --> 00:14:52,560
stream and throw it in a sandbox

439
00:14:52,560 --> 00:14:54,959
and see what makes it tick

440
00:14:54,959 --> 00:14:57,519
that's huge right or

441
00:14:57,519 --> 00:14:58,959
if you are

442
00:14:58,959 --> 00:15:01,120
unfortunately breached and somebody is

443
00:15:01,120 --> 00:15:03,120
exfiltrating data from your environment

444
00:15:03,120 --> 00:15:05,199
and you have full packet capture

445
00:15:05,199 --> 00:15:07,040
you can pull the files out that they

446
00:15:07,040 --> 00:15:09,279
took so you can say oh there's this you

447
00:15:09,279 --> 00:15:11,360
know rar file over here full of weird

448
00:15:11,360 --> 00:15:12,639
stuff

449
00:15:12,639 --> 00:15:14,320
well now i'm gonna pull it out throw it

450
00:15:14,320 --> 00:15:16,160
in a sandbox open it up and see what

451
00:15:16,160 --> 00:15:18,160
they actually took and knowing what an

452
00:15:18,160 --> 00:15:20,079
attacker took during a breach is the

453
00:15:20,079 --> 00:15:22,480
difference between having to call a few

454
00:15:22,480 --> 00:15:23,440
people

455
00:15:23,440 --> 00:15:24,240
and

456
00:15:24,240 --> 00:15:26,480
ending up on the news right legally

457
00:15:26,480 --> 00:15:28,160
there are way different things that

458
00:15:28,160 --> 00:15:29,759
happen depending on what somebody takes

459
00:15:29,759 --> 00:15:31,519
from the environment so if you have the

460
00:15:31,519 --> 00:15:33,680
ability to rebuild what was taken from

461
00:15:33,680 --> 00:15:36,880
you in a breach that is invaluable

462
00:15:36,880 --> 00:15:37,680
um

463
00:15:37,680 --> 00:15:40,320
the organizations who don't do this and

464
00:15:40,320 --> 00:15:42,079
then experience a breach understand how

465
00:15:42,079 --> 00:15:43,839
valuable it is after the breach that's

466
00:15:43,839 --> 00:15:46,000
normally when you will get the blank

467
00:15:46,000 --> 00:15:47,920
check right you're trying to get spend

468
00:15:47,920 --> 00:15:48,959
you're trying to get spend you're trying

469
00:15:48,959 --> 00:15:50,399
to get additional head count can't get

470
00:15:50,399 --> 00:15:52,399
it can't get it can't get it breached

471
00:15:52,399 --> 00:15:55,040
let's go look at how many people we're

472
00:15:55,040 --> 00:15:56,800
hiring oh we got this shiny thing i

473
00:15:56,800 --> 00:15:58,320
don't even know what that box does but

474
00:15:58,320 --> 00:16:00,160
it sure is pretty like

475
00:16:00,160 --> 00:16:01,519
hopefully you don't have to get to that

476
00:16:01,519 --> 00:16:02,399
point

477
00:16:02,399 --> 00:16:04,639
get your full packet capture going and

478
00:16:04,639 --> 00:16:06,320
understand what's actually happening on

479
00:16:06,320 --> 00:16:10,000
your network and then of course endpoint

480
00:16:10,000 --> 00:16:12,000
endpoint is where the rubber meets the

481
00:16:12,000 --> 00:16:14,160
road right what did they actually do on

482
00:16:14,160 --> 00:16:16,000
the host and so

483
00:16:16,000 --> 00:16:17,519
make sure you're pulling all your pro

484
00:16:17,519 --> 00:16:18,720
inventorying all your processes

485
00:16:18,720 --> 00:16:20,880
scheduled tasks unexpected services i

486
00:16:20,880 --> 00:16:22,240
know a lot of these things sound

487
00:16:22,240 --> 00:16:24,639
foundational and they are

488
00:16:24,639 --> 00:16:26,399
but the reality is the foundational

489
00:16:26,399 --> 00:16:28,800
stuff is where we find bad

490
00:16:28,800 --> 00:16:31,040
constantly and this is

491
00:16:31,040 --> 00:16:32,959
across every organization we're not

492
00:16:32,959 --> 00:16:35,199
talking about just mom and pop pizza

493
00:16:35,199 --> 00:16:38,880
place over here we're talking fortune 10

494
00:16:38,880 --> 00:16:41,360
the foundational stuff is what finds the

495
00:16:41,360 --> 00:16:43,120
attackers okay

496
00:16:43,120 --> 00:16:45,360
they will not burn a zero day if they

497
00:16:45,360 --> 00:16:47,600
don't have to they will come at you and

498
00:16:47,600 --> 00:16:49,759
find the path of least resistance and if

499
00:16:49,759 --> 00:16:52,160
that makes them successful

500
00:16:52,160 --> 00:16:54,079
then great they stop there they will

501
00:16:54,079 --> 00:16:56,240
escalate to whatever level they need to

502
00:16:56,240 --> 00:16:58,800
get to if you're specifically targeted

503
00:16:58,800 --> 00:17:01,440
but by and large attackers will come at

504
00:17:01,440 --> 00:17:04,959
you with whatever will work and is the

505
00:17:04,959 --> 00:17:07,679
least amount of effort so we find these

506
00:17:07,679 --> 00:17:10,559
things with foundational stuff and it

507
00:17:10,559 --> 00:17:12,880
works

508
00:17:12,880 --> 00:17:15,679
all right so mindset wise

509
00:17:15,679 --> 00:17:16,559
um

510
00:17:16,559 --> 00:17:18,079
threat hunting is really about

511
00:17:18,079 --> 00:17:19,439
situational awareness it's about

512
00:17:19,439 --> 00:17:21,679
understanding what normal is like on

513
00:17:21,679 --> 00:17:23,439
your host or your network it's about

514
00:17:23,439 --> 00:17:25,599
setting a baseline understanding what

515
00:17:25,599 --> 00:17:27,520
the norms are and diffing against it

516
00:17:27,520 --> 00:17:29,919
over and over and over again so you can

517
00:17:29,919 --> 00:17:32,880
say okay this is what this should look

518
00:17:32,880 --> 00:17:35,280
like so when something happens that is

519
00:17:35,280 --> 00:17:37,600
an outlier or some type of anomaly it

520
00:17:37,600 --> 00:17:40,000
will jump out it will stand out like a

521
00:17:40,000 --> 00:17:41,840
sore thumb you'll be like that ain't

522
00:17:41,840 --> 00:17:43,440
right i don't understand why that's

523
00:17:43,440 --> 00:17:45,679
doing that that's a bump in traffic over

524
00:17:45,679 --> 00:17:47,840
here that's a weird behavior that user

525
00:17:47,840 --> 00:17:50,080
never connects to that thing over there

526
00:17:50,080 --> 00:17:51,440
so

527
00:17:51,440 --> 00:17:53,760
understand and set that baseline it's

528
00:17:53,760 --> 00:17:56,400
important to note though that while

529
00:17:56,400 --> 00:17:59,280
outliers are always interesting

530
00:17:59,280 --> 00:18:01,200
they're not always evil

531
00:18:01,200 --> 00:18:02,880
you're not always going to find that

532
00:18:02,880 --> 00:18:05,600
russian organized crime group right but

533
00:18:05,600 --> 00:18:07,840
sometimes you'll spend four to six hours

534
00:18:07,840 --> 00:18:09,120
just digging in on something that you're

535
00:18:09,120 --> 00:18:10,720
like oh what is this what is this what

536
00:18:10,720 --> 00:18:12,880
is this and in the end it's just how a

537
00:18:12,880 --> 00:18:14,559
certain protocol or operating system

538
00:18:14,559 --> 00:18:16,160
works within your environment which is

539
00:18:16,160 --> 00:18:17,679
just the way the communication takes

540
00:18:17,679 --> 00:18:19,120
place between different parts of your

541
00:18:19,120 --> 00:18:21,200
organization but you still learn

542
00:18:21,200 --> 00:18:23,120
something and if you can put yourself in

543
00:18:23,120 --> 00:18:25,120
that mindset that i don't care how this

544
00:18:25,120 --> 00:18:28,000
ends but i'll learn something that you

545
00:18:28,000 --> 00:18:30,720
will always enjoy the hunt

546
00:18:30,720 --> 00:18:34,559
and i genuinely enjoy the hunt

547
00:18:36,080 --> 00:18:38,160
um it's also important

548
00:18:38,160 --> 00:18:39,600
to just leave your preconceived notions

549
00:18:39,600 --> 00:18:41,520
at the door you don't want to start with

550
00:18:41,520 --> 00:18:43,760
an ioc again what you want to start with

551
00:18:43,760 --> 00:18:47,039
is a hypothesis a question how

552
00:18:47,039 --> 00:18:48,799
is somebody going to come at me this is

553
00:18:48,799 --> 00:18:50,559
where if you have

554
00:18:50,559 --> 00:18:53,039
any offensive background red teaming pen

555
00:18:53,039 --> 00:18:55,200
testing whatever it is

556
00:18:55,200 --> 00:18:56,640
putting yourself in that attacker

557
00:18:56,640 --> 00:18:59,120
mindset and saying what would i do to us

558
00:18:59,120 --> 00:19:01,919
is going to be valuable so start out

559
00:19:01,919 --> 00:19:03,760
with a question

560
00:19:03,760 --> 00:19:05,520
you want to know what you

561
00:19:05,520 --> 00:19:07,600
hope to find and then go out and look

562
00:19:07,600 --> 00:19:10,240
for it but don't be discouraged if you

563
00:19:10,240 --> 00:19:12,480
don't find it you want to stay flexible

564
00:19:12,480 --> 00:19:14,880
um if you're in the middle of a hunt you

565
00:19:14,880 --> 00:19:16,160
started with a hypothesis and you're

566
00:19:16,160 --> 00:19:18,480
driving down the path to find out or

567
00:19:18,480 --> 00:19:21,120
prove out that hypothesis and you

568
00:19:21,120 --> 00:19:25,039
what i call see something shiny

569
00:19:25,039 --> 00:19:26,559
and it gets your attention this is where

570
00:19:26,559 --> 00:19:28,960
you want to embrace the adhd that is so

571
00:19:28,960 --> 00:19:31,039
prevalent within our industry

572
00:19:31,039 --> 00:19:34,080
if you see something shiny

573
00:19:34,080 --> 00:19:35,520
full stop

574
00:19:35,520 --> 00:19:37,440
what's that why did that get my

575
00:19:37,440 --> 00:19:39,919
attention why did that stand out to me

576
00:19:39,919 --> 00:19:41,360
these are the things that we want to

577
00:19:41,360 --> 00:19:42,960
look at right

578
00:19:42,960 --> 00:19:43,760
so

579
00:19:43,760 --> 00:19:45,440
if you're in the middle of that path and

580
00:19:45,440 --> 00:19:47,760
you're like i just i can't get derailed

581
00:19:47,760 --> 00:19:49,760
open another tab and then see something

582
00:19:49,760 --> 00:19:51,600
shiny open another tab open another tab

583
00:19:51,600 --> 00:19:53,120
and your hunt's just not done until all

584
00:19:53,120 --> 00:19:54,640
those tabs are closed

585
00:19:54,640 --> 00:19:56,240
that's it

586
00:19:56,240 --> 00:19:57,600
so prepare to pivot there's going to be

587
00:19:57,600 --> 00:19:58,799
a lot of them

588
00:19:58,799 --> 00:20:02,880
and this one for me is huge fine tools

589
00:20:02,880 --> 00:20:04,880
that help you make sense of the data i

590
00:20:04,880 --> 00:20:06,559
don't care whether those are bought from

591
00:20:06,559 --> 00:20:08,320
a vendor i don't care whether those are

592
00:20:08,320 --> 00:20:10,080
open source if you're a university and

593
00:20:10,080 --> 00:20:11,360
you have a bunch of students you can

594
00:20:11,360 --> 00:20:12,960
throw at managing some open source

595
00:20:12,960 --> 00:20:14,159
projects so that your analyst can

596
00:20:14,159 --> 00:20:16,480
actually use it instead of managing it

597
00:20:16,480 --> 00:20:18,880
and using it because who's got the time

598
00:20:18,880 --> 00:20:20,480
um

599
00:20:20,480 --> 00:20:22,400
find the thing that works for you it

600
00:20:22,400 --> 00:20:23,679
doesn't matter if you have the most

601
00:20:23,679 --> 00:20:26,080
expensive shiniest dashboard crazy

602
00:20:26,080 --> 00:20:28,880
whatever look at the pew pew pew

603
00:20:28,880 --> 00:20:29,840
great

604
00:20:29,840 --> 00:20:32,240
if your analysts hate it

605
00:20:32,240 --> 00:20:34,720
if your hunters hate it

606
00:20:34,720 --> 00:20:37,200
who cares how much it cost

607
00:20:37,200 --> 00:20:40,000
what you need to do is consult your team

608
00:20:40,000 --> 00:20:41,600
decide what the tools are that you want

609
00:20:41,600 --> 00:20:42,720
to use what are the things that are

610
00:20:42,720 --> 00:20:44,640
going to make you successful and use

611
00:20:44,640 --> 00:20:46,159
those things

612
00:20:46,159 --> 00:20:47,840
doesn't matter if it's vendor driven

613
00:20:47,840 --> 00:20:50,320
doesn't matter if it's open source use

614
00:20:50,320 --> 00:20:52,159
the thing that your analysts want to use

615
00:20:52,159 --> 00:20:55,600
and size it appropriately if it's slow

616
00:20:55,600 --> 00:20:58,000
ain't nobody hunting in there

617
00:20:58,000 --> 00:21:00,320
and then again document everything and

618
00:21:00,320 --> 00:21:03,200
write it down and please share it um

619
00:21:03,200 --> 00:21:04,880
another thing in our industry that's

620
00:21:04,880 --> 00:21:07,280
pretty prevalent is uh our imposter

621
00:21:07,280 --> 00:21:09,440
syndrome if you need to write a white

622
00:21:09,440 --> 00:21:11,600
paper if you want to give a talk at a

623
00:21:11,600 --> 00:21:12,960
conference if you just want to send out

624
00:21:12,960 --> 00:21:16,559
a tweet that says this thing helped me

625
00:21:16,559 --> 00:21:18,080
share it

626
00:21:18,080 --> 00:21:20,159
if it helps one person

627
00:21:20,159 --> 00:21:22,080
fantastic but put the stuff that you're

628
00:21:22,080 --> 00:21:24,320
learning out there

629
00:21:24,320 --> 00:21:26,400
i talked about a hypothesis a way to

630
00:21:26,400 --> 00:21:28,559
begin a hunt or decide

631
00:21:28,559 --> 00:21:31,520
what that how that hunt should start

632
00:21:31,520 --> 00:21:33,280
and here's a good way

633
00:21:33,280 --> 00:21:36,400
to see that hypothesis right so

634
00:21:36,400 --> 00:21:38,080
what you want to do is take a look at

635
00:21:38,080 --> 00:21:40,240
your business your organization and

636
00:21:40,240 --> 00:21:41,919
understand what it is that you actually

637
00:21:41,919 --> 00:21:43,360
do what do we provide am i an

638
00:21:43,360 --> 00:21:46,240
entertainment am i an energy sector uh

639
00:21:46,240 --> 00:21:49,919
you know is am i financial health care

640
00:21:49,919 --> 00:21:52,559
okay for me what are those applications

641
00:21:52,559 --> 00:21:54,080
and assets that are related to my

642
00:21:54,080 --> 00:21:56,559
industry that are the most risk for me

643
00:21:56,559 --> 00:21:57,679
what are the things that are the

644
00:21:57,679 --> 00:22:00,240
scariest what will put us on the news

645
00:22:00,240 --> 00:22:02,320
all right understand that down to the

646
00:22:02,320 --> 00:22:04,640
application and asset level

647
00:22:04,640 --> 00:22:06,799
and once you've done that determine what

648
00:22:06,799 --> 00:22:08,880
the probable attack vectors are going to

649
00:22:08,880 --> 00:22:11,840
be to come at those

650
00:22:11,840 --> 00:22:13,840
and then for each one of those what are

651
00:22:13,840 --> 00:22:16,000
the potential techniques right what are

652
00:22:16,000 --> 00:22:17,280
the artifacts that are going to be left

653
00:22:17,280 --> 00:22:19,760
behind by those techniques and for those

654
00:22:19,760 --> 00:22:22,159
artifacts what are the tools that apply

655
00:22:22,159 --> 00:22:24,480
and when i say what tools apply again

656
00:22:24,480 --> 00:22:26,320
two things one what are the tools that

657
00:22:26,320 --> 00:22:27,919
create those artifacts what are the

658
00:22:27,919 --> 00:22:30,159
attackers using and two what are the

659
00:22:30,159 --> 00:22:32,000
tools that detect the artifacts that i'm

660
00:22:32,000 --> 00:22:33,840
looking for

661
00:22:33,840 --> 00:22:35,840
and then document it you can see a theme

662
00:22:35,840 --> 00:22:37,520
here right document document write it

663
00:22:37,520 --> 00:22:38,720
down

664
00:22:38,720 --> 00:22:39,760
i know there's a lot of people out there

665
00:22:39,760 --> 00:22:42,000
who think like oh you know like like

666
00:22:42,000 --> 00:22:43,520
tribal knowledge sucks like if you are

667
00:22:43,520 --> 00:22:45,039
in an organization you're like when i

668
00:22:45,039 --> 00:22:46,480
leave everybody's going to be so sad

669
00:22:46,480 --> 00:22:47,919
because there's going to be a vacuum and

670
00:22:47,919 --> 00:22:50,320
i'm amazing whatever you suck as an

671
00:22:50,320 --> 00:22:52,559
employee and your team should hate you

672
00:22:52,559 --> 00:22:54,080
there's no pizza party for you when you

673
00:22:54,080 --> 00:22:55,360
leave

674
00:22:55,360 --> 00:22:56,960
write it down

675
00:22:56,960 --> 00:22:58,400
yeah

676
00:22:58,400 --> 00:22:59,760
okay

677
00:22:59,760 --> 00:23:01,840
no pizza for that guy like the guy who

678
00:23:01,840 --> 00:23:03,679
started clapping first is like yeah go

679
00:23:03,679 --> 00:23:06,320
to hell rob like you know

680
00:23:06,320 --> 00:23:08,240
so

681
00:23:08,240 --> 00:23:10,080
um and then when you've determined what

682
00:23:10,080 --> 00:23:11,600
those things are and what those probable

683
00:23:11,600 --> 00:23:13,600
attacks are red team and blue team them

684
00:23:13,600 --> 00:23:15,679
if you can right and so

685
00:23:15,679 --> 00:23:18,720
what i mean here is emulate the most

686
00:23:18,720 --> 00:23:20,799
likely attackers that target your

687
00:23:20,799 --> 00:23:23,919
business right so if it's apt whatever

688
00:23:23,919 --> 00:23:26,080
that it comes at your energy sector

689
00:23:26,080 --> 00:23:28,799
business if you can't defend against the

690
00:23:28,799 --> 00:23:32,640
most likely groups to target you

691
00:23:32,640 --> 00:23:33,760
good luck

692
00:23:33,760 --> 00:23:36,480
right but if you can you reduce your

693
00:23:36,480 --> 00:23:39,360
risk dramatically

694
00:23:39,360 --> 00:23:41,600
and then just do it over and over again

695
00:23:41,600 --> 00:23:43,520
over and over again again another theme

696
00:23:43,520 --> 00:23:45,840
do it again and again and again a good

697
00:23:45,840 --> 00:23:47,279
place to go look for things like this

698
00:23:47,279 --> 00:23:49,520
that that those ttps the tactics

699
00:23:49,520 --> 00:23:50,799
techniques and procedures threat

700
00:23:50,799 --> 00:23:52,559
intelligence that actually

701
00:23:52,559 --> 00:23:56,240
matters right the way that attackers

702
00:23:56,240 --> 00:23:59,039
conduct business and in some cases it is

703
00:23:59,039 --> 00:24:01,600
literally business

704
00:24:01,600 --> 00:24:04,400
understanding those ttps will help you

705
00:24:04,400 --> 00:24:06,720
defend yourself for much longer than

706
00:24:06,720 --> 00:24:09,440
blocking an ip address a hostname or you

707
00:24:09,440 --> 00:24:11,679
know triggering on a file hash somewhere

708
00:24:11,679 --> 00:24:12,880
so

709
00:24:12,880 --> 00:24:14,640
the mitre attack framework is a great

710
00:24:14,640 --> 00:24:16,400
place to go find that type of

711
00:24:16,400 --> 00:24:17,600
intelligence

712
00:24:17,600 --> 00:24:19,520
literally you can click on things like

713
00:24:19,520 --> 00:24:21,200
i'm an entertainment and it's like these

714
00:24:21,200 --> 00:24:23,120
apt groups hate you

715
00:24:23,120 --> 00:24:25,039
or love you depending on how good your

716
00:24:25,039 --> 00:24:26,880
defenses are

717
00:24:26,880 --> 00:24:28,960
but the mitre attack framework is great

718
00:24:28,960 --> 00:24:30,400
for that if you don't spend time in

719
00:24:30,400 --> 00:24:32,240
mitre attack please spend more time

720
00:24:32,240 --> 00:24:33,200
there

721
00:24:33,200 --> 00:24:35,679
it is fantastic i am super nerdy so

722
00:24:35,679 --> 00:24:37,120
sometimes i'll just go into mitre attack

723
00:24:37,120 --> 00:24:38,720
and go down the wicky rabbit hole and

724
00:24:38,720 --> 00:24:39,760
it's fun

725
00:24:39,760 --> 00:24:42,240
because i'm a giant nerd

726
00:24:42,240 --> 00:24:44,799
another thing

727
00:24:44,960 --> 00:24:46,320
is that using miter attacking build

728
00:24:46,320 --> 00:24:47,919
things like this which is a nice stop

729
00:24:47,919 --> 00:24:50,240
light type matrix where you can say

730
00:24:50,240 --> 00:24:52,480
i have these data sources for these

731
00:24:52,480 --> 00:24:54,559
attack vectors and these techniques this

732
00:24:54,559 --> 00:24:56,240
is the visibility i gain with the data

733
00:24:56,240 --> 00:24:57,760
sources that i have so if we're looking

734
00:24:57,760 --> 00:25:00,320
at web shells logs are okay but full

735
00:25:00,320 --> 00:25:02,480
packet capture and endpoints are are

736
00:25:02,480 --> 00:25:04,720
fantastic and netflow's useless to me

737
00:25:04,720 --> 00:25:06,559
for web shells right and then go through

738
00:25:06,559 --> 00:25:08,880
your organization and decide

739
00:25:08,880 --> 00:25:10,720
where am i covered then you can take

740
00:25:10,720 --> 00:25:12,559
this and deliver it up to management and

741
00:25:12,559 --> 00:25:14,480
say here's where our gaps are

742
00:25:14,480 --> 00:25:16,240
here are the groups that target us are

743
00:25:16,240 --> 00:25:18,400
most likely to target us here's their

744
00:25:18,400 --> 00:25:20,159
normal attack techniques

745
00:25:20,159 --> 00:25:23,120
this is what they use to

746
00:25:23,120 --> 00:25:25,120
you know come at us and we lack

747
00:25:25,120 --> 00:25:27,360
visibility in these areas and so

748
00:25:27,360 --> 00:25:29,200
hopefully that allows you to go back to

749
00:25:29,200 --> 00:25:30,640
management and say give me additional

750
00:25:30,640 --> 00:25:32,320
head count give me additional time to

751
00:25:32,320 --> 00:25:34,720
hunt i need to buy the shiny thing i saw

752
00:25:34,720 --> 00:25:36,640
at black hat

753
00:25:36,640 --> 00:25:38,480
whatever it is we need more training we

754
00:25:38,480 --> 00:25:39,440
need this

755
00:25:39,440 --> 00:25:41,520
it gives you the ammunition to hopefully

756
00:25:41,520 --> 00:25:43,360
get the things or the resources that you

757
00:25:43,360 --> 00:25:46,320
need to be successful as a defender

758
00:25:46,320 --> 00:25:48,240
another thing it does

759
00:25:48,240 --> 00:25:49,360
is

760
00:25:49,360 --> 00:25:52,000
that let's say you are breached

761
00:25:52,000 --> 00:25:53,600
and they're like hey they call in the

762
00:25:53,600 --> 00:25:55,679
cso and it's like it's time and time for

763
00:25:55,679 --> 00:25:57,440
what time to be the chief information

764
00:25:57,440 --> 00:26:00,720
scapegoat officer you're fired right and

765
00:26:00,720 --> 00:26:02,799
you can be like well

766
00:26:02,799 --> 00:26:04,480
that breach happened this way the attack

767
00:26:04,480 --> 00:26:05,679
was done this way they used this

768
00:26:05,679 --> 00:26:06,880
technique and if you remember back in

769
00:26:06,880 --> 00:26:09,039
june i gave you this shiny stop light

770
00:26:09,039 --> 00:26:10,799
type matrix they told you we had gaps in

771
00:26:10,799 --> 00:26:12,159
these areas and all i needed was

772
00:26:12,159 --> 00:26:13,600
additional headcount or maybe this other

773
00:26:13,600 --> 00:26:16,320
product but you didn't give it to me

774
00:26:16,320 --> 00:26:18,240
i'm going to go back to my desk

775
00:26:18,240 --> 00:26:19,919
good luck with that

776
00:26:19,919 --> 00:26:21,120
and then you go back to your desk and

777
00:26:21,120 --> 00:26:23,279
you keep your job so

778
00:26:23,279 --> 00:26:25,120
good to have stuff like this

779
00:26:25,120 --> 00:26:27,200
now i mentioned red teaming and i want

780
00:26:27,200 --> 00:26:28,720
to talk about it just real quick because

781
00:26:28,720 --> 00:26:31,039
there is a difference between offensive

782
00:26:31,039 --> 00:26:34,480
types of uh you know approaches

783
00:26:34,480 --> 00:26:36,159
not everything is just red teaming or

784
00:26:36,159 --> 00:26:38,240
not everything is pen testing right so

785
00:26:38,240 --> 00:26:39,760
what are the differences well a

786
00:26:39,760 --> 00:26:41,760
vulnerability scan is just a scan it's a

787
00:26:41,760 --> 00:26:43,679
piece of software we set it and we let

788
00:26:43,679 --> 00:26:45,760
it run and it pumps out a report you put

789
00:26:45,760 --> 00:26:47,520
a logo on it you charge the company ten

790
00:26:47,520 --> 00:26:50,159
thousand dollars no don't do that please

791
00:26:50,159 --> 00:26:51,679
don't do that but there are plenty of

792
00:26:51,679 --> 00:26:53,919
people out there doing that this is not

793
00:26:53,919 --> 00:26:55,919
red teaming this is hitting go on a

794
00:26:55,919 --> 00:26:57,919
piece of software

795
00:26:57,919 --> 00:27:02,000
pen testing is a skilled individual who

796
00:27:02,000 --> 00:27:03,120
goes in

797
00:27:03,120 --> 00:27:05,520
and says okay i'm going to go try to

798
00:27:05,520 --> 00:27:07,279
find vulnerabilities and when i find

799
00:27:07,279 --> 00:27:09,360
them i'm going to exploit those things

800
00:27:09,360 --> 00:27:10,960
and once i've exploited that i'm going

801
00:27:10,960 --> 00:27:12,799
to try to see how much further i can get

802
00:27:12,799 --> 00:27:14,400
and i'm going to do this over and over

803
00:27:14,400 --> 00:27:17,200
and over again and see how many ways i

804
00:27:17,200 --> 00:27:19,279
can find to get into the organization

805
00:27:19,279 --> 00:27:20,960
how many different things i can exploit

806
00:27:20,960 --> 00:27:22,000
and hopefully when they're done they

807
00:27:22,000 --> 00:27:23,360
give you a report that tells you here's

808
00:27:23,360 --> 00:27:25,039
your gaps close these up and they come

809
00:27:25,039 --> 00:27:27,840
back in three months or six months and

810
00:27:27,840 --> 00:27:29,600
hopefully you fix those things and they

811
00:27:29,600 --> 00:27:32,080
just find new ways to crush your spirit

812
00:27:32,080 --> 00:27:32,840
um

813
00:27:32,840 --> 00:27:37,439
but it's a numbers game right

814
00:27:37,520 --> 00:27:41,039
red teaming is a test of not just your

815
00:27:41,039 --> 00:27:43,760
technology but also of your capability

816
00:27:43,760 --> 00:27:46,960
to do detection with your people right

817
00:27:46,960 --> 00:27:48,799
so red team should come in with a

818
00:27:48,799 --> 00:27:51,279
specific goal they want to get to a

819
00:27:51,279 --> 00:27:52,880
certain thing they're going to come in

820
00:27:52,880 --> 00:27:56,080
still with stealth and look to meet that

821
00:27:56,080 --> 00:27:58,640
goal by whatever means necessary as long

822
00:27:58,640 --> 00:28:00,799
as the scope is correctly done

823
00:28:00,799 --> 00:28:03,520
um and they should be using threat

824
00:28:03,520 --> 00:28:05,200
intelligence to do that they should come

825
00:28:05,200 --> 00:28:06,559
at you and say

826
00:28:06,559 --> 00:28:07,919
here's the most likely way that you'll

827
00:28:07,919 --> 00:28:10,399
be attacked we're going to emulate those

828
00:28:10,399 --> 00:28:11,360
things

829
00:28:11,360 --> 00:28:13,440
we'll see if you can do those and if you

830
00:28:13,440 --> 00:28:15,600
can then we will adjust the next time we

831
00:28:15,600 --> 00:28:17,039
come in and do it and we'll come at you

832
00:28:17,039 --> 00:28:19,520
in a different way

833
00:28:19,520 --> 00:28:21,600
that is how a red team exercise should

834
00:28:21,600 --> 00:28:24,080
go it should be a group of skilled

835
00:28:24,080 --> 00:28:26,080
individuals who are

836
00:28:26,080 --> 00:28:28,840
pulling no punches and coming at you

837
00:28:28,840 --> 00:28:31,360
emulating how you will most likely be

838
00:28:31,360 --> 00:28:35,200
attacked um and and that should gain you

839
00:28:35,200 --> 00:28:36,720
something it shouldn't just be you

840
00:28:36,720 --> 00:28:38,559
getting punched in the face over and

841
00:28:38,559 --> 00:28:40,480
over again

842
00:28:40,480 --> 00:28:42,720
the f i will say here and this is just

843
00:28:42,720 --> 00:28:44,480
uh you know the gospel according to

844
00:28:44,480 --> 00:28:45,520
grifter

845
00:28:45,520 --> 00:28:47,039
findings should be shared from the red

846
00:28:47,039 --> 00:28:50,080
team to the blue team without any kind

847
00:28:50,080 --> 00:28:52,799
of discipline and also without any kind

848
00:28:52,799 --> 00:28:54,799
of the nonsense

849
00:28:54,799 --> 00:28:57,600
frankly ego that seems to come

850
00:28:57,600 --> 00:28:59,520
along with being on the offensive side

851
00:28:59,520 --> 00:29:01,679
of house and again i

852
00:29:01,679 --> 00:29:03,760
have been and am still contracted

853
00:29:03,760 --> 00:29:06,960
sometimes to be that red team person so

854
00:29:06,960 --> 00:29:09,279
um i get it like you know it's like i'm

855
00:29:09,279 --> 00:29:11,760
an elite hacker pew pew pew and you're

856
00:29:11,760 --> 00:29:14,240
like shut up tom like so

857
00:29:14,240 --> 00:29:15,760
um

858
00:29:15,760 --> 00:29:18,240
so you what you need is not it shouldn't

859
00:29:18,240 --> 00:29:20,720
come across as ha ha we got you it

860
00:29:20,720 --> 00:29:22,640
should be we're working together to make

861
00:29:22,640 --> 00:29:24,559
sure that these things are are closed

862
00:29:24,559 --> 00:29:25,600
right

863
00:29:25,600 --> 00:29:26,559
and so

864
00:29:26,559 --> 00:29:27,919
red teaming's a little bit different i

865
00:29:27,919 --> 00:29:29,760
threw bug bounty programs in here and i

866
00:29:29,760 --> 00:29:31,840
did that because i think that they're a

867
00:29:31,840 --> 00:29:34,000
good um

868
00:29:34,000 --> 00:29:36,080
it's a good way of getting some low cost

869
00:29:36,080 --> 00:29:38,080
testing on different things but it can

870
00:29:38,080 --> 00:29:41,120
be noisy right so

871
00:29:41,120 --> 00:29:43,440
you want to be able to know whether or

872
00:29:43,440 --> 00:29:46,000
not not what you're seeing is just a

873
00:29:46,000 --> 00:29:47,760
bounty hunter looking for a bounty or

874
00:29:47,760 --> 00:29:49,919
whether or not you have a legitimate

875
00:29:49,919 --> 00:29:51,919
threat and sometimes

876
00:29:51,919 --> 00:29:54,480
this can muddy the waters but i mean

877
00:29:54,480 --> 00:29:55,919
someone might get a t-shirt so that's

878
00:29:55,919 --> 00:29:58,159
dope

879
00:29:58,559 --> 00:30:00,000
all right

880
00:30:00,000 --> 00:30:01,279
we're going to talk about some some

881
00:30:01,279 --> 00:30:03,039
practical hunting or things to go look

882
00:30:03,039 --> 00:30:07,360
for i will say before i start that hunts

883
00:30:07,360 --> 00:30:08,480
are

884
00:30:08,480 --> 00:30:11,600
you want to start out and build

885
00:30:11,600 --> 00:30:13,360
layers right there should be layers that

886
00:30:13,360 --> 00:30:15,679
make you go oh this is a problem a lot

887
00:30:15,679 --> 00:30:17,039
of the things that i'm about to talk

888
00:30:17,039 --> 00:30:18,799
about are alertable they're things that

889
00:30:18,799 --> 00:30:20,559
you can create alerts on

890
00:30:20,559 --> 00:30:22,799
but um there some of them can be very

891
00:30:22,799 --> 00:30:25,760
very noisy or loud alerts

892
00:30:25,760 --> 00:30:28,320
if we were to um

893
00:30:28,320 --> 00:30:30,799
to just like alert on every time a

894
00:30:30,799 --> 00:30:32,559
process was created like forget it shut

895
00:30:32,559 --> 00:30:34,640
us down like we're done right so um but

896
00:30:34,640 --> 00:30:36,240
what you want to do is pair these things

897
00:30:36,240 --> 00:30:38,000
together so if i'm looking at web

898
00:30:38,000 --> 00:30:39,440
traffic and i see that i'm getting

899
00:30:39,440 --> 00:30:40,960
traffic from a region i don't normally

900
00:30:40,960 --> 00:30:43,440
do business with that it's a short user

901
00:30:43,440 --> 00:30:45,039
agent string and they're posting to the

902
00:30:45,039 --> 00:30:46,559
web server without ever doing a get

903
00:30:46,559 --> 00:30:49,120
request those things are now interesting

904
00:30:49,120 --> 00:30:50,559
because they're layered on top of each

905
00:30:50,559 --> 00:30:52,640
other maybe somebody with a short user

906
00:30:52,640 --> 00:30:54,480
agent string isn't something i care

907
00:30:54,480 --> 00:30:56,559
about but when i have those other

908
00:30:56,559 --> 00:31:00,000
factors i really start to care so um

909
00:31:00,000 --> 00:31:01,600
like i said we'll talk about a few

910
00:31:01,600 --> 00:31:03,039
things and some of you will go we

911
00:31:03,039 --> 00:31:06,240
already do that good

912
00:31:07,840 --> 00:31:09,919
all right

913
00:31:09,919 --> 00:31:10,880
so yeah

914
00:31:10,880 --> 00:31:12,559
check your logs for process creation

915
00:31:12,559 --> 00:31:14,320
check your logs don't alert on process

916
00:31:14,320 --> 00:31:15,919
creation that's insane

917
00:31:15,919 --> 00:31:17,600
but check your logs for process creation

918
00:31:17,600 --> 00:31:20,399
do those processes match the names of

919
00:31:20,399 --> 00:31:22,799
your allowed software right um

920
00:31:22,799 --> 00:31:24,159
are those things being kicked off by

921
00:31:24,159 --> 00:31:26,320
executables that you actually know about

922
00:31:26,320 --> 00:31:28,320
and want to be there

923
00:31:28,320 --> 00:31:30,960
if you have the ability verify the file

924
00:31:30,960 --> 00:31:33,360
hashes to known good executables has

925
00:31:33,360 --> 00:31:34,880
something been changed what am i looking

926
00:31:34,880 --> 00:31:36,640
at

927
00:31:36,640 --> 00:31:38,720
and then for for this

928
00:31:38,720 --> 00:31:41,120
this is true of network as well as on

929
00:31:41,120 --> 00:31:43,519
the endpoint side of the house but

930
00:31:43,519 --> 00:31:46,000
i look at a 24-hour window when i'm

931
00:31:46,000 --> 00:31:48,320
doing a hunt and i do that because

932
00:31:48,320 --> 00:31:50,399
i need something digestible right so

933
00:31:50,399 --> 00:31:52,720
i'll look at the last 24 hours if i see

934
00:31:52,720 --> 00:31:54,320
something interesting something odd

935
00:31:54,320 --> 00:31:55,679
something shiny

936
00:31:55,679 --> 00:31:58,080
i will then drill down my investigation

937
00:31:58,080 --> 00:32:00,799
on that thing and then expand my window

938
00:32:00,799 --> 00:32:03,039
so i'm like oh that was odd well let's

939
00:32:03,039 --> 00:32:04,880
go look at that well let's see how many

940
00:32:04,880 --> 00:32:06,240
times that's happened in the last three

941
00:32:06,240 --> 00:32:09,120
days seven days 14 days or now i'm like

942
00:32:09,120 --> 00:32:11,360
oh that's on this specific host or that

943
00:32:11,360 --> 00:32:13,279
was done by this specific user well

944
00:32:13,279 --> 00:32:15,679
let's go see what that user has done for

945
00:32:15,679 --> 00:32:17,600
three days seven days 14 days a month

946
00:32:17,600 --> 00:32:19,200
however much you know retention you've

947
00:32:19,200 --> 00:32:20,320
got

948
00:32:20,320 --> 00:32:21,279
so

949
00:32:21,279 --> 00:32:23,440
hunt within a 24 hour window look for

950
00:32:23,440 --> 00:32:26,000
something spooky

951
00:32:26,000 --> 00:32:28,480
and then when you find that spooky

952
00:32:28,480 --> 00:32:31,120
expand right it makes it just digestible

953
00:32:31,120 --> 00:32:33,279
but you can look at a 24-hour window and

954
00:32:33,279 --> 00:32:36,000
look at processes that are um

955
00:32:36,000 --> 00:32:38,000
you know executed once or twice across

956
00:32:38,000 --> 00:32:39,519
your entire organization like you're

957
00:32:39,519 --> 00:32:41,360
like what is that why do these specific

958
00:32:41,360 --> 00:32:43,360
endpoints have this thing going on we've

959
00:32:43,360 --> 00:32:45,360
all done this in some way when we look

960
00:32:45,360 --> 00:32:46,880
at the processes that are running on our

961
00:32:46,880 --> 00:32:50,080
machines at home and we kind of go

962
00:32:50,080 --> 00:32:52,480
crap what the hell is that

963
00:32:52,480 --> 00:32:55,200
oh no then you go and

964
00:32:55,200 --> 00:32:56,480
duck it

965
00:32:56,480 --> 00:32:58,159
yes

966
00:32:58,159 --> 00:32:59,039
so

967
00:32:59,039 --> 00:33:00,960
so you go search for uh what is that

968
00:33:00,960 --> 00:33:02,720
process is this related to malware and

969
00:33:02,720 --> 00:33:04,000
i'm getting nervous

970
00:33:04,000 --> 00:33:05,440
and then

971
00:33:05,440 --> 00:33:06,720
when you've done that and you've done a

972
00:33:06,720 --> 00:33:08,399
search maybe you're still not satisfied

973
00:33:08,399 --> 00:33:10,399
so you grab a hash thrown in virustotal

974
00:33:10,399 --> 00:33:13,120
you're like we're still good um or

975
00:33:13,120 --> 00:33:14,399
you're still nervous you throw in a

976
00:33:14,399 --> 00:33:16,640
sandbox and see what it does right so

977
00:33:16,640 --> 00:33:17,760
that's what you want to do across your

978
00:33:17,760 --> 00:33:19,919
organization look for the outliers if i

979
00:33:19,919 --> 00:33:21,919
have ten thousand or a hundred thousand

980
00:33:21,919 --> 00:33:23,519
endpoints but only

981
00:33:23,519 --> 00:33:25,120
five of them have this particular

982
00:33:25,120 --> 00:33:27,840
process running on them what is that why

983
00:33:27,840 --> 00:33:30,559
do only five machines out of 10 000

984
00:33:30,559 --> 00:33:32,480
running this thing and just understand

985
00:33:32,480 --> 00:33:33,919
what's going on

986
00:33:33,919 --> 00:33:36,000
and then you can always do like a report

987
00:33:36,000 --> 00:33:37,360
to deliver something like this so you

988
00:33:37,360 --> 00:33:38,960
can say like hey i want a report every

989
00:33:38,960 --> 00:33:40,880
day that tells me the outlier processes

990
00:33:40,880 --> 00:33:42,640
that happen across the organization and

991
00:33:42,640 --> 00:33:44,559
then you just like look at those things

992
00:33:44,559 --> 00:33:46,320
check those out hunt on those what's

993
00:33:46,320 --> 00:33:47,760
happening there let me go expand the

994
00:33:47,760 --> 00:33:51,039
hunt find out what's going on

995
00:33:51,200 --> 00:33:52,399
um

996
00:33:52,399 --> 00:33:53,840
look at you know parent process

997
00:33:53,840 --> 00:33:56,880
relationships right so uh if command

998
00:33:56,880 --> 00:33:58,399
odyssey is running from windward what's

999
00:33:58,399 --> 00:33:59,679
uh

1000
00:33:59,679 --> 00:34:01,760
what's going on there man uh look for

1001
00:34:01,760 --> 00:34:03,679
stuff like that right svc host being

1002
00:34:03,679 --> 00:34:04,799
launched by anything other than

1003
00:34:04,799 --> 00:34:06,799
services.exe

1004
00:34:06,799 --> 00:34:08,639
processes that are missing company name

1005
00:34:08,639 --> 00:34:11,119
and product version so lazy

1006
00:34:11,119 --> 00:34:12,800
you know attackers who just aren't

1007
00:34:12,800 --> 00:34:15,280
aren't changing things again this stuff

1008
00:34:15,280 --> 00:34:17,760
sounds foundational because it is every

1009
00:34:17,760 --> 00:34:19,199
bullet point in here is something we

1010
00:34:19,199 --> 00:34:20,960
have found something on

1011
00:34:20,960 --> 00:34:22,639
and i'll share a story if i have even

1012
00:34:22,639 --> 00:34:24,560
remotely a moment at the end of this but

1013
00:34:24,560 --> 00:34:26,079
i'm still trying to

1014
00:34:26,079 --> 00:34:28,639
power through

1015
00:34:29,359 --> 00:34:31,040
look for processes with similar names to

1016
00:34:31,040 --> 00:34:32,560
legitimate processes and this is where

1017
00:34:32,560 --> 00:34:34,639
things like string similarity algorithms

1018
00:34:34,639 --> 00:34:36,399
are great where you can go in and say

1019
00:34:36,399 --> 00:34:38,560
show me processes that look like actual

1020
00:34:38,560 --> 00:34:40,639
known and good processes are they trying

1021
00:34:40,639 --> 00:34:42,159
to change something like having a

1022
00:34:42,159 --> 00:34:44,000
capital i instead of an l or a zero

1023
00:34:44,000 --> 00:34:46,159
instead of an o that kind of stuff right

1024
00:34:46,159 --> 00:34:49,359
um or just you know srvc host or

1025
00:34:49,359 --> 00:34:50,639
something like that right we want to

1026
00:34:50,639 --> 00:34:52,560
find outliers like that and then

1027
00:34:52,560 --> 00:34:54,320
processes that are just starting from

1028
00:34:54,320 --> 00:34:57,200
odd locations um scripting right this

1029
00:34:57,200 --> 00:34:58,480
should be something that when we start

1030
00:34:58,480 --> 00:35:00,320
adding things to an allow list we

1031
00:35:00,320 --> 00:35:02,240
understand who are users and what

1032
00:35:02,240 --> 00:35:04,400
departments are most often using

1033
00:35:04,400 --> 00:35:06,960
scripting if kevin in accounting is

1034
00:35:06,960 --> 00:35:08,240
suddenly doing a bunch of stuff in

1035
00:35:08,240 --> 00:35:09,839
powershell you're like what's going on

1036
00:35:09,839 --> 00:35:11,040
there brother

1037
00:35:11,040 --> 00:35:13,119
what you doing right you want to

1038
00:35:13,119 --> 00:35:15,200
understand who are the folks within the

1039
00:35:15,200 --> 00:35:17,760
organization who normally are

1040
00:35:17,760 --> 00:35:19,520
doing some type of scripting and if

1041
00:35:19,520 --> 00:35:22,000
something pops up that's odd we want to

1042
00:35:22,000 --> 00:35:23,839
look at that outlier or anomalous

1043
00:35:23,839 --> 00:35:25,119
behavior

1044
00:35:25,119 --> 00:35:26,320
if they're invoking

1045
00:35:26,320 --> 00:35:28,320
encoded commands what is it that they're

1046
00:35:28,320 --> 00:35:30,480
trying to hide and maybe nothing maybe

1047
00:35:30,480 --> 00:35:32,480
they just really like doing it i don't

1048
00:35:32,480 --> 00:35:34,400
know but but we want to look for things

1049
00:35:34,400 --> 00:35:36,160
where people are not you know encrypting

1050
00:35:36,160 --> 00:35:37,680
something but just encoding something

1051
00:35:37,680 --> 00:35:39,680
obfuscating or making it harder to see

1052
00:35:39,680 --> 00:35:41,920
what's actually going on and then again

1053
00:35:41,920 --> 00:35:43,839
just some advice use a naming convention

1054
00:35:43,839 --> 00:35:46,000
for your scripts right and then alert on

1055
00:35:46,000 --> 00:35:47,520
things that go outside of that naming

1056
00:35:47,520 --> 00:35:49,520
convention or or don't and just know

1057
00:35:49,520 --> 00:35:50,720
that your hunters and analysts when

1058
00:35:50,720 --> 00:35:52,160
they're looking and they see a script

1059
00:35:52,160 --> 00:35:53,680
that's been fired off somewhere and they

1060
00:35:53,680 --> 00:35:56,720
go that's not normal

1061
00:35:56,720 --> 00:35:58,640
putting small things into place like

1062
00:35:58,640 --> 00:36:00,160
just adding a naming convention to your

1063
00:36:00,160 --> 00:36:02,000
scripts can make a huge difference to

1064
00:36:02,000 --> 00:36:04,079
what's normal and not normal within the

1065
00:36:04,079 --> 00:36:06,160
org

1066
00:36:06,160 --> 00:36:08,000
users being added to privileged groups

1067
00:36:08,000 --> 00:36:09,839
know when it does this right and if they

1068
00:36:09,839 --> 00:36:11,680
don't have a schedule for doing it

1069
00:36:11,680 --> 00:36:13,280
please ask them to have one right if

1070
00:36:13,280 --> 00:36:14,640
they're like we only do that between

1071
00:36:14,640 --> 00:36:16,160
these hours and these hours on these

1072
00:36:16,160 --> 00:36:18,160
days and then if something happens

1073
00:36:18,160 --> 00:36:20,079
outside of those that's an outlier

1074
00:36:20,079 --> 00:36:22,079
that's an anomaly go look why is that

1075
00:36:22,079 --> 00:36:25,040
happening why is that taking place

1076
00:36:25,040 --> 00:36:26,480
and this one might seem odd but

1077
00:36:26,480 --> 00:36:28,400
collecting your bash history

1078
00:36:28,400 --> 00:36:31,440
across the org to a central location

1079
00:36:31,440 --> 00:36:34,400
this one is just if an attacker does get

1080
00:36:34,400 --> 00:36:37,359
into the environment um

1081
00:36:37,359 --> 00:36:39,280
watching them at a command line can give

1082
00:36:39,280 --> 00:36:41,359
you an indication of how skilled that

1083
00:36:41,359 --> 00:36:43,119
attacker is i think we've all

1084
00:36:43,119 --> 00:36:45,280
experienced this as well when you're in

1085
00:36:45,280 --> 00:36:46,880
a command line situation and someone

1086
00:36:46,880 --> 00:36:48,079
walks up and is looking over your

1087
00:36:48,079 --> 00:36:49,680
shoulder and you're like now i'm going

1088
00:36:49,680 --> 00:36:52,160
to put 3000 typos and forget all of the

1089
00:36:52,160 --> 00:36:54,160
commands and you're like why are you

1090
00:36:54,160 --> 00:36:55,839
judging me because i keep hitting

1091
00:36:55,839 --> 00:36:58,240
question mark right like stop like i

1092
00:36:58,240 --> 00:36:59,680
just want to be right

1093
00:36:59,680 --> 00:37:01,040
right so

1094
00:37:01,040 --> 00:37:02,560
understanding what the skill of the

1095
00:37:02,560 --> 00:37:04,640
attacker is but also i can tell you from

1096
00:37:04,640 --> 00:37:06,079
the um

1097
00:37:06,079 --> 00:37:08,320
offensive or red team side of the house

1098
00:37:08,320 --> 00:37:10,079
or pen testing side of the house

1099
00:37:10,079 --> 00:37:11,920
going and looking at the bash history to

1100
00:37:11,920 --> 00:37:14,480
see what a machine is used for is a good

1101
00:37:14,480 --> 00:37:15,760
way to understand what you've gotten

1102
00:37:15,760 --> 00:37:18,400
into it goes beyond just who am i right

1103
00:37:18,400 --> 00:37:19,839
like going in and looking at what the

1104
00:37:19,839 --> 00:37:21,680
last 50 commands that were executed on

1105
00:37:21,680 --> 00:37:23,359
that box in the first time you get into

1106
00:37:23,359 --> 00:37:24,960
it can give you a good indication about

1107
00:37:24,960 --> 00:37:27,119
what takes place on that machine so

1108
00:37:27,119 --> 00:37:28,400
attackers are looking at the bash

1109
00:37:28,400 --> 00:37:32,160
history you should too

1110
00:37:32,320 --> 00:37:33,920
and then look for things that are signs

1111
00:37:33,920 --> 00:37:35,760
of internal reconnaissance right so who

1112
00:37:35,760 --> 00:37:36,880
am i

1113
00:37:36,880 --> 00:37:38,560
you know just ipconfig normal stuff

1114
00:37:38,560 --> 00:37:40,320
again this is stuff we do all the time

1115
00:37:40,320 --> 00:37:41,680
because we're nerds and it's part of our

1116
00:37:41,680 --> 00:37:44,640
jobs but there's no scenario where

1117
00:37:44,640 --> 00:37:47,839
somebody in you know finance is like

1118
00:37:47,839 --> 00:37:49,680
should be messing around trying to

1119
00:37:49,680 --> 00:37:51,599
figure out uh you know what's going on

1120
00:37:51,599 --> 00:37:53,760
on their on the network or within their

1121
00:37:53,760 --> 00:37:56,160
environment and this holds true for you

1122
00:37:56,160 --> 00:37:58,079
know tools like nmap anything you'd find

1123
00:37:58,079 --> 00:38:01,280
in a kali distro right so look for

1124
00:38:01,280 --> 00:38:03,680
things that are normally run by it or

1125
00:38:03,680 --> 00:38:06,480
buy admins not run by

1126
00:38:06,480 --> 00:38:10,240
your average everyday employee

1127
00:38:10,240 --> 00:38:12,000
when you're looking for lateral movement

1128
00:38:12,000 --> 00:38:13,839
so new user and endpoint paris is

1129
00:38:13,839 --> 00:38:15,359
somebody logging into a machine they've

1130
00:38:15,359 --> 00:38:18,640
never logged into before why is kevin in

1131
00:38:18,640 --> 00:38:20,400
accounting logging into a machine in

1132
00:38:20,400 --> 00:38:22,079
research and development right that's

1133
00:38:22,079 --> 00:38:24,000
odd we want to pay attention to stuff

1134
00:38:24,000 --> 00:38:27,839
like that new endpoint endpoint pairs so

1135
00:38:27,839 --> 00:38:29,599
why is that machine

1136
00:38:29,599 --> 00:38:30,960
talking to this machine it's never

1137
00:38:30,960 --> 00:38:32,880
talked to before again outliers

1138
00:38:32,880 --> 00:38:34,560
anomalies take a look at things like

1139
00:38:34,560 --> 00:38:36,720
those

1140
00:38:36,720 --> 00:38:37,680
and then

1141
00:38:37,680 --> 00:38:40,720
somebody logging into a system and then

1142
00:38:40,720 --> 00:38:43,280
immediately using alternate credentials

1143
00:38:43,280 --> 00:38:45,119
another thing that might be normal for

1144
00:38:45,119 --> 00:38:46,480
us as administrators

1145
00:38:46,480 --> 00:38:49,280
or within the it organization but not

1146
00:38:49,280 --> 00:38:51,040
for normal users

1147
00:38:51,040 --> 00:38:52,880
and then of course to keep it gangster

1148
00:38:52,880 --> 00:38:55,119
any kind of log tampering somebody going

1149
00:38:55,119 --> 00:38:58,720
in and trying to corrupt or clear logs

1150
00:38:58,800 --> 00:39:00,640
when it comes to persistence you know

1151
00:39:00,640 --> 00:39:02,480
any changes to the registry this is true

1152
00:39:02,480 --> 00:39:05,200
for other things too where um

1153
00:39:05,200 --> 00:39:07,040
like local admin privileges or whatever

1154
00:39:07,040 --> 00:39:08,480
somebody's able to make changes to the

1155
00:39:08,480 --> 00:39:11,200
registry and they shouldn't we have done

1156
00:39:11,200 --> 00:39:13,280
uh audits of changes to registry and

1157
00:39:13,280 --> 00:39:15,839
found people who were put into the wrong

1158
00:39:15,839 --> 00:39:17,440
groups or given the wrong privileges on

1159
00:39:17,440 --> 00:39:20,480
devices or resources that they shouldn't

1160
00:39:20,480 --> 00:39:22,320
have been and again it's not

1161
00:39:22,320 --> 00:39:25,040
exfiltration to china but it is reducing

1162
00:39:25,040 --> 00:39:26,640
your attack surface because now you have

1163
00:39:26,640 --> 00:39:30,000
one less administrator out there right

1164
00:39:30,000 --> 00:39:32,160
look for scheduled task creation

1165
00:39:32,160 --> 00:39:34,320
people changing you know enabling or

1166
00:39:34,320 --> 00:39:37,760
disabling tasks what are those

1167
00:39:37,760 --> 00:39:41,680
any unknown or unapproved services

1168
00:39:41,680 --> 00:39:44,640
and then the indicator so nice we put it

1169
00:39:44,640 --> 00:39:46,480
in here twice users being added to

1170
00:39:46,480 --> 00:39:48,640
privileged groups again for persistence

1171
00:39:48,640 --> 00:39:50,880
so pay attention to things like that now

1172
00:39:50,880 --> 00:39:53,839
this one may seem odd but it is kind of

1173
00:39:53,839 --> 00:39:55,920
interesting and that is hints from your

1174
00:39:55,920 --> 00:39:58,079
antivirus most people deploy antivirus

1175
00:39:58,079 --> 00:40:00,480
and they just leave it right

1176
00:40:00,480 --> 00:40:01,680
but what's interesting about your

1177
00:40:01,680 --> 00:40:04,880
antivirus logs is understanding where

1178
00:40:04,880 --> 00:40:07,680
malware is being cleaned from

1179
00:40:07,680 --> 00:40:09,359
so if malware lands in an average

1180
00:40:09,359 --> 00:40:10,880
everyday user's download folder is

1181
00:40:10,880 --> 00:40:12,720
immediately found and cleaned

1182
00:40:12,720 --> 00:40:14,480
cool

1183
00:40:14,480 --> 00:40:16,160
if malware was cleaned off of a user's

1184
00:40:16,160 --> 00:40:17,520
machine but it was cleaned out of system

1185
00:40:17,520 --> 00:40:19,520
32

1186
00:40:19,520 --> 00:40:21,200
how'd that get there

1187
00:40:21,200 --> 00:40:22,160
right

1188
00:40:22,160 --> 00:40:24,400
even if it was cleaned

1189
00:40:24,400 --> 00:40:26,880
how did that get there

1190
00:40:26,880 --> 00:40:28,560
right so

1191
00:40:28,560 --> 00:40:30,400
pay attention to your antivirus logs

1192
00:40:30,400 --> 00:40:32,319
there's interesting stuff in there that

1193
00:40:32,319 --> 00:40:34,319
can clue you in that there is a problem

1194
00:40:34,319 --> 00:40:36,480
on that endpoint or with that user that

1195
00:40:36,480 --> 00:40:38,160
you need to be aware of that is odd

1196
00:40:38,160 --> 00:40:39,359
behavior

1197
00:40:39,359 --> 00:40:41,119
so if you see something like that what

1198
00:40:41,119 --> 00:40:43,040
has happened over the last three days

1199
00:40:43,040 --> 00:40:44,960
seven days what is this user what is

1200
00:40:44,960 --> 00:40:47,920
this machine doing

1201
00:40:48,319 --> 00:40:50,240
and then signs of known attacker tools

1202
00:40:50,240 --> 00:40:51,440
being uh

1203
00:40:51,440 --> 00:40:53,680
you know cleaned out of anywhere doesn't

1204
00:40:53,680 --> 00:40:54,960
matter i don't care if it's the download

1205
00:40:54,960 --> 00:40:56,560
folder or somewhere else if you're

1206
00:40:56,560 --> 00:40:58,560
seeing stuff like mimikatz being cleaned

1207
00:40:58,560 --> 00:41:00,560
off of something why the hell was that

1208
00:41:00,560 --> 00:41:01,839
there

1209
00:41:01,839 --> 00:41:04,079
right and if it did get cleaned off

1210
00:41:04,079 --> 00:41:06,400
great but what does that mean

1211
00:41:06,400 --> 00:41:07,359
after

1212
00:41:07,359 --> 00:41:09,839
you know uh after it's gone well it

1213
00:41:09,839 --> 00:41:11,520
means the attacker knows it got cleaned

1214
00:41:11,520 --> 00:41:12,960
off and so they're gonna try to come at

1215
00:41:12,960 --> 00:41:14,319
you a different way or they'll just

1216
00:41:14,319 --> 00:41:16,400
recompile something or whatever

1217
00:41:16,400 --> 00:41:18,400
so look for

1218
00:41:18,400 --> 00:41:20,560
signs of any known attacker tools and of

1219
00:41:20,560 --> 00:41:22,319
course any droppers as well type of

1220
00:41:22,319 --> 00:41:24,000
staging that might be going on so look

1221
00:41:24,000 --> 00:41:25,200
at your antivirus logs there's

1222
00:41:25,200 --> 00:41:28,000
interesting stuff in there

1223
00:41:28,000 --> 00:41:28,800
um

1224
00:41:28,800 --> 00:41:31,040
artifacts in shim cache and amcach i'm

1225
00:41:31,040 --> 00:41:32,720
huge on this if you are not hunting in

1226
00:41:32,720 --> 00:41:34,560
your shim cache and am cache you are

1227
00:41:34,560 --> 00:41:37,119
missing interesting stuff this is how

1228
00:41:37,119 --> 00:41:38,160
you understand what all your

1229
00:41:38,160 --> 00:41:39,839
applications are doing where they're

1230
00:41:39,839 --> 00:41:42,079
launching from all of that information

1231
00:41:42,079 --> 00:41:44,160
is in here please if you're not hunting

1232
00:41:44,160 --> 00:41:46,160
in your shim cache and am cache change

1233
00:41:46,160 --> 00:41:49,119
that make that a thing look for rename

1234
00:41:49,119 --> 00:41:50,640
tools somebody just changing the tools

1235
00:41:50,640 --> 00:41:52,319
that they're using or potentially

1236
00:41:52,319 --> 00:41:54,160
command line arguments that are being

1237
00:41:54,160 --> 00:41:56,000
executed by something that you would

1238
00:41:56,000 --> 00:41:58,000
know is normal on a different tool so

1239
00:41:58,000 --> 00:41:59,920
you're like that looks like port

1240
00:41:59,920 --> 00:42:01,520
forwarding and putty but that's not

1241
00:42:01,520 --> 00:42:04,720
putty doing it what is that right so

1242
00:42:04,720 --> 00:42:07,839
look for things like that

1243
00:42:08,640 --> 00:42:11,040
um on the you know http side of the

1244
00:42:11,040 --> 00:42:12,880
house the website house i mentioned this

1245
00:42:12,880 --> 00:42:14,640
earlier posts with no gets people don't

1246
00:42:14,640 --> 00:42:16,319
often post things to your web server

1247
00:42:16,319 --> 00:42:18,560
without asking for something first so

1248
00:42:18,560 --> 00:42:21,359
look for methods that are strange

1249
00:42:21,359 --> 00:42:22,960
short file name scripts are things that

1250
00:42:22,960 --> 00:42:24,800
are outside of your naming convention

1251
00:42:24,800 --> 00:42:27,760
attackers can sometimes be lazy

1252
00:42:27,760 --> 00:42:30,400
and they'll just you know put in a very

1253
00:42:30,400 --> 00:42:33,280
short or or a single letter as the

1254
00:42:33,280 --> 00:42:34,240
script or whatever that they're

1255
00:42:34,240 --> 00:42:36,400
deploying we find interesting stuff

1256
00:42:36,400 --> 00:42:39,359
there encoded query strings gone are

1257
00:42:39,359 --> 00:42:42,079
mostly the days of just finding cat etsy

1258
00:42:42,079 --> 00:42:44,400
password in in your address bar

1259
00:42:44,400 --> 00:42:47,200
but um now it's just a blob of base64.

1260
00:42:47,200 --> 00:42:49,119
why is there a blob of base64 in there

1261
00:42:49,119 --> 00:42:51,440
let me go take a look at what it is

1262
00:42:51,440 --> 00:42:53,280
and then low numbers of http headers

1263
00:42:53,280 --> 00:42:55,680
right so

1264
00:42:55,680 --> 00:42:57,520
when you send a request it sends a lot

1265
00:42:57,520 --> 00:42:59,200
of stuff it wants no content length the

1266
00:42:59,200 --> 00:43:00,720
type of the user agent string is what

1267
00:43:00,720 --> 00:43:02,880
browser you're using and like operating

1268
00:43:02,880 --> 00:43:04,560
system how am i supposed to format this

1269
00:43:04,560 --> 00:43:07,599
thing um you know what the person is

1270
00:43:07,599 --> 00:43:08,960
asking for what region they're coming

1271
00:43:08,960 --> 00:43:10,160
from what's the language i'm going to

1272
00:43:10,160 --> 00:43:11,760
deliver this all these different things

1273
00:43:11,760 --> 00:43:13,599
are put into

1274
00:43:13,599 --> 00:43:15,839
that request and response

1275
00:43:15,839 --> 00:43:18,880
if you're seeing six or less headers in

1276
00:43:18,880 --> 00:43:21,680
there that's weird we normally see eight

1277
00:43:21,680 --> 00:43:23,920
plus and sometimes an absurd number

1278
00:43:23,920 --> 00:43:25,520
right depending on what your what you're

1279
00:43:25,520 --> 00:43:26,960
looking at every once in a while you'll

1280
00:43:26,960 --> 00:43:28,480
see something where it's like two and

1281
00:43:28,480 --> 00:43:29,520
you're like what is that and it's like a

1282
00:43:29,520 --> 00:43:31,359
python script but you know because you

1283
00:43:31,359 --> 00:43:33,440
go look and you're like oh we're good

1284
00:43:33,440 --> 00:43:35,119
um so just pay attention to stuff like

1285
00:43:35,119 --> 00:43:37,520
that on the host side of thing anomalies

1286
00:43:37,520 --> 00:43:39,599
direct to ip is that any more

1287
00:43:39,599 --> 00:43:41,119
foundational could it get any more

1288
00:43:41,119 --> 00:43:42,880
foundational than that

1289
00:43:42,880 --> 00:43:45,680
direct ip is not how we communicate to

1290
00:43:45,680 --> 00:43:48,000
one another we don't say i found a super

1291
00:43:48,000 --> 00:43:49,800
dope website at

1292
00:43:49,800 --> 00:43:51,680
64.228.14. whatever we don't do that

1293
00:43:51,680 --> 00:43:53,599
right we give you a host name and so

1294
00:43:53,599 --> 00:43:55,440
direct ip communication happens between

1295
00:43:55,440 --> 00:43:57,200
machines or somebody who knows what's on

1296
00:43:57,200 --> 00:43:59,200
the other side

1297
00:43:59,200 --> 00:44:01,280
what is that communication why is it

1298
00:44:01,280 --> 00:44:04,400
happening create a feed of what those

1299
00:44:04,400 --> 00:44:06,880
ip addresses are actually tied to and

1300
00:44:06,880 --> 00:44:09,359
load that into your sim or whatever you

1301
00:44:09,359 --> 00:44:11,520
know tools that you're using to allow

1302
00:44:11,520 --> 00:44:13,440
you to understand oh this is what this

1303
00:44:13,440 --> 00:44:14,400
is

1304
00:44:14,400 --> 00:44:16,160
whenever you see it

1305
00:44:16,160 --> 00:44:18,960
and specifying a port number again we

1306
00:44:18,960 --> 00:44:21,440
are all huge nerds here so we do this

1307
00:44:21,440 --> 00:44:22,960
all the time and if you're running like

1308
00:44:22,960 --> 00:44:24,800
a nas at your house or a media server or

1309
00:44:24,800 --> 00:44:26,880
something you do this every day right

1310
00:44:26,880 --> 00:44:29,280
you're specifying the port number

1311
00:44:29,280 --> 00:44:31,200
but you know who's never done this my

1312
00:44:31,200 --> 00:44:32,480
dad

1313
00:44:32,480 --> 00:44:33,839
right

1314
00:44:33,839 --> 00:44:38,079
kevin in finance right so if we if we

1315
00:44:38,079 --> 00:44:40,640
see somebody doing oh this specific port

1316
00:44:40,640 --> 00:44:42,240
on this server what's on the other end

1317
00:44:42,240 --> 00:44:45,440
of that port we want to understand that

1318
00:44:45,440 --> 00:44:47,920
um strange or missing refers are you

1319
00:44:47,920 --> 00:44:49,440
seeing stuff coming from

1320
00:44:49,440 --> 00:44:51,359
places where you don't normally work or

1321
00:44:51,359 --> 00:44:54,880
sites that you have no connection to

1322
00:44:54,880 --> 00:44:57,760
if the content length is missing or

1323
00:44:57,760 --> 00:44:59,599
mismatched and we've seen this before

1324
00:44:59,599 --> 00:45:01,119
where an attacker wrote a tool and they

1325
00:45:01,119 --> 00:45:02,400
just put the content length was going to

1326
00:45:02,400 --> 00:45:05,040
be 40 96 60 every single time and it

1327
00:45:05,040 --> 00:45:07,200
wasn't so that mismatch in the content

1328
00:45:07,200 --> 00:45:09,200
length we were like

1329
00:45:09,200 --> 00:45:10,880
that well that breaks the rfc let's go

1330
00:45:10,880 --> 00:45:12,720
take a look at what it was and it was

1331
00:45:12,720 --> 00:45:15,040
just a you know an attacker's tool

1332
00:45:15,040 --> 00:45:17,280
they'd custom written themselves

1333
00:45:17,280 --> 00:45:19,200
old strange or short user agent strings

1334
00:45:19,200 --> 00:45:20,240
this is where you're looking for stuff

1335
00:45:20,240 --> 00:45:22,800
like mozilla with a zero all right if it

1336
00:45:22,800 --> 00:45:24,560
says mozilla five but it just says

1337
00:45:24,560 --> 00:45:26,720
mozilla five that ain't right it should

1338
00:45:26,720 --> 00:45:28,560
be really really long it tells you all

1339
00:45:28,560 --> 00:45:29,920
the things they need like the browser

1340
00:45:29,920 --> 00:45:31,119
needs to do to display the page

1341
00:45:31,119 --> 00:45:33,599
correctly so look for

1342
00:45:33,599 --> 00:45:35,200
you know user agent strings that are

1343
00:45:35,200 --> 00:45:37,280
weird sometimes attackers again are

1344
00:45:37,280 --> 00:45:39,200
super lazy or it's just some kid in

1345
00:45:39,200 --> 00:45:41,200
their parents basement in wyoming and so

1346
00:45:41,200 --> 00:45:42,800
they don't

1347
00:45:42,800 --> 00:45:44,160
they don't take the time to change the

1348
00:45:44,160 --> 00:45:45,760
username string of the tool that was

1349
00:45:45,760 --> 00:45:47,760
made to test environments right and

1350
00:45:47,760 --> 00:45:49,680
they're using it to attack with so if

1351
00:45:49,680 --> 00:45:51,520
you see those things you know they're

1352
00:45:51,520 --> 00:45:54,160
bad every time and if it's old then

1353
00:45:54,160 --> 00:45:55,760
maybe you just have old browsers kicking

1354
00:45:55,760 --> 00:45:57,200
around your organization that need to be

1355
00:45:57,200 --> 00:45:58,720
updated

1356
00:45:58,720 --> 00:46:01,200
you see like netscape navigator gold

1357
00:46:01,200 --> 00:46:03,680
um or something i heard my old people

1358
00:46:03,680 --> 00:46:05,200
chuckle

1359
00:46:05,200 --> 00:46:08,000
thanks old people you're not alone

1360
00:46:08,000 --> 00:46:09,280
um

1361
00:46:09,280 --> 00:46:11,040
all right on dns

1362
00:46:11,040 --> 00:46:13,920
uh dynamic dns so still used by command

1363
00:46:13,920 --> 00:46:16,319
control a lot right we see malware

1364
00:46:16,319 --> 00:46:18,400
that's communicating to dynamic dns

1365
00:46:18,400 --> 00:46:20,000
services and the services have made this

1366
00:46:20,000 --> 00:46:21,599
really easy for attackers because

1367
00:46:21,599 --> 00:46:23,680
they've created apis that allow them to

1368
00:46:23,680 --> 00:46:26,000
basically do domain generation

1369
00:46:26,000 --> 00:46:28,319
algorithms using these dynamic dns

1370
00:46:28,319 --> 00:46:31,119
services now dynamic dns is often used

1371
00:46:31,119 --> 00:46:33,440
sometimes just for connecting to a file

1372
00:46:33,440 --> 00:46:35,119
server or a media server or whatever and

1373
00:46:35,119 --> 00:46:37,119
so we find policy violation stuff in

1374
00:46:37,119 --> 00:46:38,720
organizations all the time where we just

1375
00:46:38,720 --> 00:46:40,240
have users connecting to some file

1376
00:46:40,240 --> 00:46:42,560
server or media server at home it's not

1377
00:46:42,560 --> 00:46:43,359
a

1378
00:46:43,359 --> 00:46:45,359
breach per se but it's not

1379
00:46:45,359 --> 00:46:46,480
allowed

1380
00:46:46,480 --> 00:46:50,240
so we want to look for stuff like that

1381
00:46:50,560 --> 00:46:52,720
but i mentioned dga

1382
00:46:52,720 --> 00:46:55,119
so what this is is essentially

1383
00:46:55,119 --> 00:46:57,520
it's kind of like having a two-factor

1384
00:46:57,520 --> 00:46:59,440
authentication like having a token

1385
00:46:59,440 --> 00:47:01,680
where i have some seed data and you know

1386
00:47:01,680 --> 00:47:04,240
that data too and so we know that every

1387
00:47:04,240 --> 00:47:05,920
60 seconds this number is going to

1388
00:47:05,920 --> 00:47:08,720
change well it's in this case it's just

1389
00:47:08,720 --> 00:47:11,520
every x amount of time this domain is

1390
00:47:11,520 --> 00:47:13,359
going to change and when it changes it's

1391
00:47:13,359 --> 00:47:14,960
going to change to this

1392
00:47:14,960 --> 00:47:16,160
so that

1393
00:47:16,160 --> 00:47:17,760
that domain can change and change and

1394
00:47:17,760 --> 00:47:19,520
change and that host changes every time

1395
00:47:19,520 --> 00:47:21,040
and it doesn't matter because the

1396
00:47:21,040 --> 00:47:23,200
command and control can still take place

1397
00:47:23,200 --> 00:47:24,800
they never lose communication from the

1398
00:47:24,800 --> 00:47:26,880
malware to the c2 server because it's

1399
00:47:26,880 --> 00:47:28,720
just rolling and rolling and rolling

1400
00:47:28,720 --> 00:47:31,200
which is why host names are terrible

1401
00:47:31,200 --> 00:47:34,000
threat intelligence

1402
00:47:34,640 --> 00:47:36,480
dns lookups to onion addresses or

1403
00:47:36,480 --> 00:47:38,240
browser processes that aren't tor trying

1404
00:47:38,240 --> 00:47:39,680
to connect to

1405
00:47:39,680 --> 00:47:41,839
onion addresses i know this sounds odd

1406
00:47:41,839 --> 00:47:42,960
but

1407
00:47:42,960 --> 00:47:44,800
this very well may be the first

1408
00:47:44,800 --> 00:47:46,160
indicator that you get that somebody was

1409
00:47:46,160 --> 00:47:48,000
hit with ransomware because they don't

1410
00:47:48,000 --> 00:47:50,839
know anything about it and freaking

1411
00:47:50,839 --> 00:47:53,680
kevin and finance is trying to go to a

1412
00:47:53,680 --> 00:47:56,480
dot onion address and because he doesn't

1413
00:47:56,480 --> 00:47:57,599
understand that he's got to do it a

1414
00:47:57,599 --> 00:47:59,599
certain way to to pay whatever the

1415
00:47:59,599 --> 00:48:02,319
ransom is so um sometimes like if you if

1416
00:48:02,319 --> 00:48:04,400
you see this this you should alert on um

1417
00:48:04,400 --> 00:48:06,480
immediately and then as far as dns

1418
00:48:06,480 --> 00:48:08,160
tunneling we look for a large number of

1419
00:48:08,160 --> 00:48:10,880
subdomains this is where

1420
00:48:10,880 --> 00:48:12,880
um an attacker is using really slow

1421
00:48:12,880 --> 00:48:14,800
basically exfiltration they're using a

1422
00:48:14,800 --> 00:48:16,480
couple of bytes and they send it out and

1423
00:48:16,480 --> 00:48:18,160
they change that sub domain and they're

1424
00:48:18,160 --> 00:48:19,440
basically encoding whatever it is

1425
00:48:19,440 --> 00:48:20,480
they're trying to get out and that

1426
00:48:20,480 --> 00:48:22,720
couple of bytes over and over and over

1427
00:48:22,720 --> 00:48:24,240
again they make the request they rebuild

1428
00:48:24,240 --> 00:48:25,440
on the other side and now they get

1429
00:48:25,440 --> 00:48:28,800
whatever it is they want it's absurd

1430
00:48:28,800 --> 00:48:32,079
as far as bandwidth wise but it works

1431
00:48:32,079 --> 00:48:35,839
especially if you don't detect it

1432
00:48:36,079 --> 00:48:38,960
a large number of a single sub domain

1433
00:48:38,960 --> 00:48:40,400
again command and control if we see

1434
00:48:40,400 --> 00:48:42,240
somebody who just repeatedly is hitting

1435
00:48:42,240 --> 00:48:43,839
a certain sub domain and it's only a

1436
00:48:43,839 --> 00:48:45,119
couple of

1437
00:48:45,119 --> 00:48:46,559
endpoints out of your entire

1438
00:48:46,559 --> 00:48:48,240
organization something you want to look

1439
00:48:48,240 --> 00:48:48,960
at

1440
00:48:48,960 --> 00:48:52,480
a high volume of no null or text records

1441
00:48:52,480 --> 00:48:54,720
more bandwidth for exfiltration but we

1442
00:48:54,720 --> 00:48:56,640
want to look for stuff like that or file

1443
00:48:56,640 --> 00:48:58,240
transfer just straight up file transfer

1444
00:48:58,240 --> 00:48:59,839
over dns

1445
00:48:59,839 --> 00:49:00,960
and now

1446
00:49:00,960 --> 00:49:03,599
you want to parse for file headers but

1447
00:49:03,599 --> 00:49:05,119
you also just want to be aware that this

1448
00:49:05,119 --> 00:49:08,160
will sometimes trip on zone transfers or

1449
00:49:08,160 --> 00:49:10,079
security vendors or antivirus vendors so

1450
00:49:10,079 --> 00:49:12,400
you'll see something that you'll say

1451
00:49:12,400 --> 00:49:13,359
okay

1452
00:49:13,359 --> 00:49:14,960
oh crap look there's a dns tunnel

1453
00:49:14,960 --> 00:49:16,640
somebody's trying to get files out over

1454
00:49:16,640 --> 00:49:18,240
dns and then you go look and you're like

1455
00:49:18,240 --> 00:49:19,040
oh

1456
00:49:19,040 --> 00:49:21,520
it's sofos right the thing about

1457
00:49:21,520 --> 00:49:24,240
antivirus and security vendors is that

1458
00:49:24,240 --> 00:49:26,000
they know about things like file

1459
00:49:26,000 --> 00:49:27,839
transfer over dns so if they want to get

1460
00:49:27,839 --> 00:49:29,520
something out of your organization guess

1461
00:49:29,520 --> 00:49:31,200
what they do

1462
00:49:31,200 --> 00:49:33,839
they use it right so but look for stuff

1463
00:49:33,839 --> 00:49:36,480
like that because it's not normal

1464
00:49:36,480 --> 00:49:39,440
when it comes to encrypted traffic um

1465
00:49:39,440 --> 00:49:40,720
you know it's encrypted right so it's

1466
00:49:40,720 --> 00:49:42,319
game over we just get rid of it right

1467
00:49:42,319 --> 00:49:43,680
throw it away

1468
00:49:43,680 --> 00:49:44,720
no

1469
00:49:44,720 --> 00:49:46,559
even if we're not saving the payload the

1470
00:49:46,559 --> 00:49:49,280
metadata involved in that is invaluable

1471
00:49:49,280 --> 00:49:51,520
so source and destination ips session

1472
00:49:51,520 --> 00:49:52,880
size and length there's things that we

1473
00:49:52,880 --> 00:49:55,680
can infer from that encrypted traffic

1474
00:49:55,680 --> 00:49:57,680
that having the metadata for it is

1475
00:49:57,680 --> 00:49:59,040
really useful

1476
00:49:59,040 --> 00:50:02,079
um we can use things like job3

1477
00:50:02,079 --> 00:50:04,000
where we can get a higher confidence

1478
00:50:04,000 --> 00:50:05,680
understanding of what the client server

1479
00:50:05,680 --> 00:50:07,119
communication is that's happening with

1480
00:50:07,119 --> 00:50:09,440
that encrypted traffic but honestly we

1481
00:50:09,440 --> 00:50:10,839
are at a point

1482
00:50:10,839 --> 00:50:14,079
where you know we're seeing

1483
00:50:14,079 --> 00:50:16,720
you know 50 plus 60 plus 70 plus 80

1484
00:50:16,720 --> 00:50:20,319
percent encrypted traffic not just um

1485
00:50:20,319 --> 00:50:22,400
like internal but external as well

1486
00:50:22,400 --> 00:50:24,480
at the black like a black hat we track

1487
00:50:24,480 --> 00:50:26,000
that as a stat how much traffic is

1488
00:50:26,000 --> 00:50:27,920
encrypted on the network and for a long

1489
00:50:27,920 --> 00:50:30,079
time it went up about five percent year

1490
00:50:30,079 --> 00:50:31,760
over year and it seems to have plateaued

1491
00:50:31,760 --> 00:50:34,319
between like 75 and 80 and it just stays

1492
00:50:34,319 --> 00:50:37,359
there um encrypted is great right as far

1493
00:50:37,359 --> 00:50:38,880
as we're all concerned encrypt

1494
00:50:38,880 --> 00:50:40,720
everything right but

1495
00:50:40,720 --> 00:50:42,319
as a defender it's really hard to defend

1496
00:50:42,319 --> 00:50:43,599
when you don't know what's flying around

1497
00:50:43,599 --> 00:50:46,319
your network so it's good to maybe start

1498
00:50:46,319 --> 00:50:48,240
looking at a decryption solution and

1499
00:50:48,240 --> 00:50:52,000
just a like piece of advice from me

1500
00:50:52,000 --> 00:50:53,599
some security vendors will come at you

1501
00:50:53,599 --> 00:50:55,920
and say hey we can do native decryption

1502
00:50:55,920 --> 00:50:57,680
maybe they can maybe you check a box and

1503
00:50:57,680 --> 00:50:59,599
now it starts doing that decryption

1504
00:50:59,599 --> 00:51:01,920
however the impact to whatever that

1505
00:51:01,920 --> 00:51:05,119
device is can be severe right so it's a

1506
00:51:05,119 --> 00:51:08,000
good idea to just check and see all

1507
00:51:08,000 --> 00:51:10,079
right is it worth it for me to go buy a

1508
00:51:10,079 --> 00:51:11,760
standalone decryption solution like go

1509
00:51:11,760 --> 00:51:13,920
get some gigamon solution that i can

1510
00:51:13,920 --> 00:51:16,559
have rather than tell this vendor's

1511
00:51:16,559 --> 00:51:18,160
device to start doing that decryption

1512
00:51:18,160 --> 00:51:20,400
for me and it ends up killing the

1513
00:51:20,400 --> 00:51:21,839
performance and i have to buy three

1514
00:51:21,839 --> 00:51:23,520
times as much now the vendor is going to

1515
00:51:23,520 --> 00:51:25,680
love that but you're not

1516
00:51:25,680 --> 00:51:27,520
so just make sure that you understand

1517
00:51:27,520 --> 00:51:29,040
what the impact is of doing that

1518
00:51:29,040 --> 00:51:31,520
decryption and look at a standalone

1519
00:51:31,520 --> 00:51:35,599
solution if you do and with that

1520
00:51:35,599 --> 00:51:38,480
i made it

1521
00:51:48,720 --> 00:51:50,880
all right so i i have a minute i told

1522
00:51:50,880 --> 00:51:53,599
you i would tell you a quick story about

1523
00:51:53,599 --> 00:51:56,240
something that it seems really benign or

1524
00:51:56,240 --> 00:51:59,040
not important at the beginning um but in

1525
00:51:59,040 --> 00:52:00,400
the end led to something very

1526
00:52:00,400 --> 00:52:03,119
interesting and that was um if you came

1527
00:52:03,119 --> 00:52:05,040
to the keynote yesterday you you met

1528
00:52:05,040 --> 00:52:07,920
james pope so pope and i worked together

1529
00:52:07,920 --> 00:52:10,160
at rsa as threat hunters

1530
00:52:10,160 --> 00:52:12,720
we went out into a

1531
00:52:12,720 --> 00:52:14,720
an incredibly large financial

1532
00:52:14,720 --> 00:52:16,559
organization all of you know this

1533
00:52:16,559 --> 00:52:17,839
organization

1534
00:52:17,839 --> 00:52:20,800
we went and sat in one of their sites

1535
00:52:20,800 --> 00:52:23,680
and there were 30 security people on the

1536
00:52:23,680 --> 00:52:25,760
floor that we were on on that site right

1537
00:52:25,760 --> 00:52:28,000
so not like a small

1538
00:52:28,000 --> 00:52:29,599
security team sometimes we would go in

1539
00:52:29,599 --> 00:52:31,040
and meet with security teams and we'd be

1540
00:52:31,040 --> 00:52:32,480
like well how many people are on your

1541
00:52:32,480 --> 00:52:33,760
team and we're in a conference room with

1542
00:52:33,760 --> 00:52:35,119
like four people and they're like this

1543
00:52:35,119 --> 00:52:38,000
is it and we're like what um but in this

1544
00:52:38,000 --> 00:52:40,319
case that wasn't that wasn't true we had

1545
00:52:40,319 --> 00:52:43,280
30 plus folks on that floor

1546
00:52:43,280 --> 00:52:45,680
we sat down with a couple

1547
00:52:45,680 --> 00:52:46,880
of people and said here's what we're

1548
00:52:46,880 --> 00:52:48,000
going to be doing this this and this

1549
00:52:48,000 --> 00:52:49,119
they said all right this guy's going to

1550
00:52:49,119 --> 00:52:51,359
sit next to you you know to to see what

1551
00:52:51,359 --> 00:52:52,720
you guys are doing

1552
00:52:52,720 --> 00:52:55,200
and we started describing hunting to him

1553
00:52:55,200 --> 00:52:56,640
and the kind of the process we go

1554
00:52:56,640 --> 00:52:58,800
through and the way that we do our hunts

1555
00:52:58,800 --> 00:53:00,240
and we were looking at all of their

1556
00:53:00,240 --> 00:53:02,079
network traffic and we said well what

1557
00:53:02,079 --> 00:53:04,000
we'll do is go in and look at a low

1558
00:53:04,000 --> 00:53:05,680
number of sessions because those are

1559
00:53:05,680 --> 00:53:07,839
outlier sessions and we want to see what

1560
00:53:07,839 --> 00:53:09,599
it is that's behind that

1561
00:53:09,599 --> 00:53:11,920
so we're like so for instance

1562
00:53:11,920 --> 00:53:13,200
i'm like

1563
00:53:13,200 --> 00:53:15,520
why don't we take a look at ftp

1564
00:53:15,520 --> 00:53:18,319
and he goes we don't use ftp

1565
00:53:18,319 --> 00:53:20,720
and i was like well i i assure you that

1566
00:53:20,720 --> 00:53:21,599
you do

1567
00:53:21,599 --> 00:53:24,319
because i can see it on the wire like

1568
00:53:24,319 --> 00:53:26,559
it's here in the full packet

1569
00:53:26,559 --> 00:53:27,599
and he's like

1570
00:53:27,599 --> 00:53:30,960
no we don't allow ftp and i'm like

1571
00:53:30,960 --> 00:53:32,720
well then this is a perfect place to

1572
00:53:32,720 --> 00:53:34,079
look because if you're saying that you

1573
00:53:34,079 --> 00:53:36,720
don't allow it this is good this is five

1574
00:53:36,720 --> 00:53:38,559
minutes into us sitting down with this

1575
00:53:38,559 --> 00:53:41,760
guy just talking about the hunt

1576
00:53:41,760 --> 00:53:43,280
so we're like well let's take a look we

1577
00:53:43,280 --> 00:53:45,040
open it up we look and we're like okay

1578
00:53:45,040 --> 00:53:47,359
every day at 1am

1579
00:53:47,359 --> 00:53:49,839
there is a file transfer to an ftp

1580
00:53:49,839 --> 00:53:51,440
server in russia and they're not even

1581
00:53:51,440 --> 00:53:55,319
trying to hide a straightup.ru

1582
00:53:55,599 --> 00:53:56,960
and we're like

1583
00:53:56,960 --> 00:53:59,280
is this normal and he's like

1584
00:53:59,280 --> 00:54:00,240
nope

1585
00:54:00,240 --> 00:54:02,000
or and we're like well what do you think

1586
00:54:02,000 --> 00:54:03,040
that is

1587
00:54:03,040 --> 00:54:04,720
and i'm like i'm not opening it because

1588
00:54:04,720 --> 00:54:06,880
i'm contracted to be here so i'm not

1589
00:54:06,880 --> 00:54:08,720
opening that and he's like

1590
00:54:08,720 --> 00:54:10,240
all right well i'll do it you know so we

1591
00:54:10,240 --> 00:54:11,599
pull the file out of the stream it's a

1592
00:54:11,599 --> 00:54:14,319
zip file we open it up and he starts to

1593
00:54:14,319 --> 00:54:16,720
open up the file and he

1594
00:54:16,720 --> 00:54:19,520
freaks out and he closes it he goes

1595
00:54:19,520 --> 00:54:21,040
oh

1596
00:54:21,040 --> 00:54:22,640
and we're like what and he's like you

1597
00:54:22,640 --> 00:54:25,920
didn't see that and i was like all right

1598
00:54:25,920 --> 00:54:28,720
just out of curiosity what did i

1599
00:54:28,720 --> 00:54:30,800
not see

1600
00:54:30,800 --> 00:54:32,720
and he's like that is every financial

1601
00:54:32,720 --> 00:54:34,160
transaction and trade that we've made in

1602
00:54:34,160 --> 00:54:37,200
the last 24 hours

1603
00:54:37,520 --> 00:54:40,160
and i was like

1604
00:54:41,119 --> 00:54:42,480
um

1605
00:54:42,480 --> 00:54:44,000
let me just see how long that's been

1606
00:54:44,000 --> 00:54:45,760
going on

1607
00:54:45,760 --> 00:54:48,720
six months of logs

1608
00:54:48,960 --> 00:54:50,240
six months

1609
00:54:50,240 --> 00:54:52,960
every 24 hours

1610
00:54:52,960 --> 00:54:56,079
ftp to russia not even trying to hide 30

1611
00:54:56,079 --> 00:54:58,240
security people on that floor but it's

1612
00:54:58,240 --> 00:55:01,040
ftp we don't use it

1613
00:55:01,040 --> 00:55:03,440
so we don't look

1614
00:55:03,440 --> 00:55:04,799
go look

1615
00:55:04,799 --> 00:55:06,240
because it's the things you think you're

1616
00:55:06,240 --> 00:55:09,119
not using that are going to bite you

1617
00:55:09,119 --> 00:55:10,640
thanks

1618
00:55:10,640 --> 00:55:14,029
[Applause]

