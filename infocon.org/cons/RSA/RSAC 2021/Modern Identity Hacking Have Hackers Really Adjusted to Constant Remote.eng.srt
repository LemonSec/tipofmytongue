1
00:00:01,160 --> 00:00:02,540
- I'm Dr. Mike Jankowski-Lorek.

2
00:00:02,540 --> 00:00:05,200
I'm Director of Consulting
and Cybersecurity Expert,

3
00:00:05,200 --> 00:00:06,790
working for CQURE.

4
00:00:06,790 --> 00:00:08,920
Company established by Paula Januszkiewicz

5
00:00:08,920 --> 00:00:12,320
more than 12 years ago and we
are working all over the world

6
00:00:12,320 --> 00:00:16,140
to providing services
related to the cybersecurity,

7
00:00:16,140 --> 00:00:18,030
configuration review, penetration testing,

8
00:00:18,030 --> 00:00:19,580
consulting, emergency responses,

9
00:00:19,580 --> 00:00:22,580
a lot of things related
to the cybersecurity.

10
00:00:22,580 --> 00:00:25,409
We also love to show that
knowledge to the trainings

11
00:00:25,410 --> 00:00:28,140
and to the conferences like RSA.

12
00:00:28,140 --> 00:00:30,630
Personally I'm socializing
identity solutions

13
00:00:30,630 --> 00:00:33,699
and that's why I'm here today
with you to share thoughts

14
00:00:33,700 --> 00:00:37,010
about modern identity and remote working.

15
00:00:37,010 --> 00:00:37,843
Let's start.

16
00:00:39,640 --> 00:00:44,020
Digital transformation has
a rapidly increased its pace

17
00:00:44,020 --> 00:00:46,530
since the beginning of COVID-19.

18
00:00:46,530 --> 00:00:51,020
Organizations previously
were just working at office,

19
00:00:51,020 --> 00:00:54,930
maybe a little bit working
remotely through the VPN,

20
00:00:54,930 --> 00:00:56,690
but that has changed.

21
00:00:56,690 --> 00:00:59,260
We were forced to switch to remote work

22
00:00:59,260 --> 00:01:02,839
or at least some kind
of mixed type of work.

23
00:01:02,840 --> 00:01:05,220
This is introducing completely new type

24
00:01:05,220 --> 00:01:07,370
of security related challenges.

25
00:01:07,370 --> 00:01:10,500
One of them is accessing
corporate resources.

26
00:01:10,500 --> 00:01:12,940
According to the
International Workspace Group,

27
00:01:12,940 --> 00:01:16,580
report already created in 2019,

28
00:01:16,580 --> 00:01:19,660
it was more than 50% of employees globally

29
00:01:19,660 --> 00:01:23,512
working at least two and a half
day per week not from work.

30
00:01:24,360 --> 00:01:26,760
Now during the COVID-19 pandemic,

31
00:01:26,760 --> 00:01:29,320
these numbers are completely different

32
00:01:29,320 --> 00:01:30,963
and they are much much higher.

33
00:01:32,700 --> 00:01:37,700
At the same time Cybersecurity
Infrastructure Agency, CISA,

34
00:01:38,220 --> 00:01:41,380
encourages organization to
adopt their high end state

35
00:01:41,380 --> 00:01:42,353
of cybersecurity.

36
00:01:43,360 --> 00:01:44,929
With the beginning of the global pandemic

37
00:01:44,930 --> 00:01:46,960
organization has changed their work style.

38
00:01:46,960 --> 00:01:49,229
And what was the easiest solution?

39
00:01:49,230 --> 00:01:51,200
Give everyone access to the VPN.

40
00:01:51,200 --> 00:01:52,033
Why?

41
00:01:52,033 --> 00:01:54,290
In most cases it was already in place,

42
00:01:54,290 --> 00:01:57,210
just a new group of employees
were granted with access.

43
00:01:57,210 --> 00:02:00,110
It's straightforward concept for employees

44
00:02:00,110 --> 00:02:03,570
no additional training
needed, or just no boarding.

45
00:02:03,570 --> 00:02:05,229
It gives similar experience

46
00:02:05,230 --> 00:02:08,240
like connecting to the system
inside of the organization

47
00:02:08,240 --> 00:02:10,009
and it's easy to adopt.

48
00:02:10,009 --> 00:02:15,010
In the warning that CISA was
generating in March 13, 2020

49
00:02:17,300 --> 00:02:21,730
regarding enterprise VPN
security, especially emphasizing

50
00:02:21,730 --> 00:02:25,530
the targeting with the
phishing and identity theft

51
00:02:25,530 --> 00:02:27,630
for all organization without MFA.

52
00:02:27,630 --> 00:02:31,299
So, everyone that has not yet adopted MFA

53
00:02:31,300 --> 00:02:35,970
will be definitely
targeted by the attackers.

54
00:02:35,970 --> 00:02:38,359
Limited capabilities of
IT security personality

55
00:02:38,360 --> 00:02:41,960
to perform cybersecurity
tasks on VPN access,

56
00:02:41,960 --> 00:02:44,770
login, detection of the
attacks, anomaly detection,

57
00:02:44,770 --> 00:02:47,060
that's something that is missing

58
00:02:47,060 --> 00:02:49,210
when you are getting through the VPN.

59
00:02:49,210 --> 00:02:52,600
Watch out for that one and
also increase this visibility.

60
00:02:52,600 --> 00:02:55,430
This shows that the first
simplest and let's say

61
00:02:55,430 --> 00:02:57,943
the little legacy type
of identity credentials

62
00:02:57,943 --> 00:03:00,270
just like a username or password

63
00:03:00,270 --> 00:03:05,270
is going to be more
targeted than ever before.

64
00:03:06,430 --> 00:03:10,750
This is also that we are observing
during multiple incidents

65
00:03:10,750 --> 00:03:13,810
and emergency services
that we've been providing

66
00:03:13,810 --> 00:03:16,103
throughout a couple of last months.

67
00:03:16,103 --> 00:03:19,250
The first place of attack
always looks the same.

68
00:03:19,250 --> 00:03:23,900
That is the attacker is sending
a good phishing campaign

69
00:03:23,900 --> 00:03:26,460
and is harvesting some
credentials for the users.

70
00:03:26,460 --> 00:03:29,210
Then they are connecting through the VPN

71
00:03:29,210 --> 00:03:31,300
because there is no MFA enabled.

72
00:03:31,300 --> 00:03:34,730
So the traditional credentials let's say

73
00:03:34,730 --> 00:03:37,179
and the easiest way to
verify their identity

74
00:03:37,180 --> 00:03:41,300
with the username password
is really failing us here,

75
00:03:41,300 --> 00:03:43,750
because it's so easy to
have someone credentials.

76
00:03:45,170 --> 00:03:46,730
The next phase, of course,

77
00:03:46,730 --> 00:03:50,893
it's remote elevation of privileges

78
00:03:50,893 --> 00:03:53,180
through some vulnerabilities
in your network

79
00:03:53,180 --> 00:03:55,560
because maybe you've
been not thinking about

80
00:03:55,560 --> 00:03:56,730
protecting it so well,

81
00:03:56,730 --> 00:03:59,200
because, oh there's
inside of your network.

82
00:03:59,200 --> 00:04:01,089
They are not exposed externally,

83
00:04:01,090 --> 00:04:03,820
now through the VPN and they are visible.

84
00:04:03,820 --> 00:04:05,109
Then actually collecting the data

85
00:04:05,110 --> 00:04:07,130
and deploying the ransomware

86
00:04:07,130 --> 00:04:09,183
this is usual path of the attacker.

87
00:04:10,270 --> 00:04:12,920
But let's not focus
yet so much on the VPN.

88
00:04:12,920 --> 00:04:17,919
What are other requirements or
options for the remote work?

89
00:04:18,089 --> 00:04:20,929
First of all, sharing the
data with other users.

90
00:04:20,930 --> 00:04:22,862
You should have already in place

91
00:04:22,862 --> 00:04:26,200
a good collaboration solution,

92
00:04:26,200 --> 00:04:28,200
let's say SharePoint or whatever,

93
00:04:28,200 --> 00:04:31,750
but also if you don't have it,

94
00:04:31,750 --> 00:04:35,360
you will see that users will
share it through the mail.

95
00:04:35,360 --> 00:04:38,130
Different versions of the
same file, that's really bad.

96
00:04:38,130 --> 00:04:40,940
Because in case of
business email compromise,

97
00:04:40,940 --> 00:04:43,193
those all files will be visible.

98
00:04:44,040 --> 00:04:47,150
The second thing is access
on premise databases.

99
00:04:47,150 --> 00:04:51,409
Usually is done through the
VPN, nothing we can do here,

100
00:04:51,410 --> 00:04:53,630
unless there is an application in front.

101
00:04:53,630 --> 00:04:55,219
If there is some web application,

102
00:04:55,220 --> 00:04:58,440
you can go with application
proxy, incorporate MFA,

103
00:04:58,440 --> 00:05:03,440
and for example, modern
authentication for those systems.

104
00:05:03,710 --> 00:05:06,549
Accessing business
applications from anywhere,

105
00:05:06,550 --> 00:05:11,240
everywhere and all the time,
it is a good thing to have.

106
00:05:12,230 --> 00:05:15,880
But not every application
is already prepared

107
00:05:15,880 --> 00:05:18,340
for being available publicly.

108
00:05:18,340 --> 00:05:20,030
Remember that the security boundary

109
00:05:20,030 --> 00:05:21,500
is changing in such case.

110
00:05:21,500 --> 00:05:24,600
So, different identification of the user,

111
00:05:24,600 --> 00:05:27,030
authentication and
authorization for this case.

112
00:05:27,030 --> 00:05:29,969
And the last part, which is very important

113
00:05:29,970 --> 00:05:32,960
that you need to think
about trusted devices

114
00:05:32,960 --> 00:05:34,530
to process the data security.

115
00:05:34,530 --> 00:05:36,469
Because the strongest authentication,

116
00:05:36,470 --> 00:05:41,450
the strongest authorization
can be bypassed

117
00:05:41,450 --> 00:05:44,676
if your environment in which
you are processing the data

118
00:05:44,677 --> 00:05:48,533
is not secure, and it's already
compromised by the attacker.

119
00:05:49,450 --> 00:05:54,450
So, what are the main
risk of the remote work?

120
00:05:56,080 --> 00:05:59,400
Connecting private computers
are not well managed computers

121
00:05:59,400 --> 00:06:01,330
to the corporate network systems,

122
00:06:01,330 --> 00:06:04,630
that's something that is
really, really danger.

123
00:06:04,630 --> 00:06:08,290
Also, problems with patching
for services like VPN.

124
00:06:08,290 --> 00:06:10,170
They are accessed 24 seven.

125
00:06:10,170 --> 00:06:12,890
So there is no time for rebooting,

126
00:06:12,890 --> 00:06:14,800
there's no time for patching it,

127
00:06:14,800 --> 00:06:16,640
you need to develop the plan for that one,

128
00:06:16,640 --> 00:06:20,210
because if there is an issue with it,

129
00:06:20,210 --> 00:06:22,280
recently, we had a couple of CVEs

130
00:06:22,280 --> 00:06:25,659
that are related to
those kinds of accesses,

131
00:06:25,660 --> 00:06:29,570
then you will expose attacks and expose,

132
00:06:29,570 --> 00:06:34,570
for example, identities as well
for the accessing internally

133
00:06:35,120 --> 00:06:36,370
the systems.

134
00:06:36,370 --> 00:06:39,350
Increased phishing campaigns,
targeting your credentials,

135
00:06:39,350 --> 00:06:42,170
nothing to do about that one,
you can increase the filters,

136
00:06:42,170 --> 00:06:44,010
you can just educate the users

137
00:06:44,010 --> 00:06:46,690
but really not much can be done here

138
00:06:46,690 --> 00:06:51,690
unless you change to the
different kind of credentials.

139
00:06:52,450 --> 00:06:54,099
Business email compromised scenarios,

140
00:06:54,100 --> 00:06:55,740
especially painful for organization

141
00:06:55,740 --> 00:06:58,190
with lack of good solutions
which I already mentioned,

142
00:06:58,190 --> 00:07:00,080
for that data sharing.

143
00:07:00,080 --> 00:07:02,900
So to get the files to the users

144
00:07:02,900 --> 00:07:05,940
and to work at the same file together.

145
00:07:05,940 --> 00:07:10,930
Problems with the VPN access
performance, stability of it.

146
00:07:10,930 --> 00:07:14,550
And this is something that's
increasing all the time.

147
00:07:14,550 --> 00:07:18,010
Of course, we have couple
of options of bypassing this

148
00:07:18,010 --> 00:07:22,393
or rather mitigating it, but
remember, it's always changing.

149
00:07:23,790 --> 00:07:26,480
So before we jump to the
demo and the attacks,

150
00:07:26,480 --> 00:07:30,170
couple more of statistics.

151
00:07:30,170 --> 00:07:33,120
How many percent of employees in question

152
00:07:33,120 --> 00:07:35,970
were using each of the devices for work?

153
00:07:35,970 --> 00:07:39,023
Majority is using desktop or notebooks.

154
00:07:40,520 --> 00:07:43,060
Smartphone tablets, not so much.

155
00:07:43,060 --> 00:07:48,060
Only 19% percent of employees has not used

156
00:07:50,320 --> 00:07:53,060
any kind of devices, personal devices,

157
00:07:53,060 --> 00:07:56,940
to access the corporate data.

158
00:07:56,940 --> 00:08:00,230
So even if you distribute the
notebooks from components,

159
00:08:00,230 --> 00:08:05,230
they are still using also the
data on their own devices.

160
00:08:06,340 --> 00:08:11,340
Second statistics are about the
devices that store the data,

161
00:08:11,890 --> 00:08:15,960
corporate data, on the
personal type of the devices.

162
00:08:15,960 --> 00:08:18,849
Desktop, laptops, smartphones and tablets.

163
00:08:18,850 --> 00:08:21,670
As you can see most of those
are the desktop and laptops.

164
00:08:21,670 --> 00:08:26,653
So, they're ones that
employees use the most.

165
00:08:27,750 --> 00:08:30,253
And how about controlling those devices?

166
00:08:31,090 --> 00:08:36,089
65% of IT professionals responded
that does not have tools

167
00:08:37,240 --> 00:08:40,500
to manage not company devices.

168
00:08:40,500 --> 00:08:43,852
44% seen increase in help desk work

169
00:08:43,852 --> 00:08:46,540
after switching to the remote work.

170
00:08:46,540 --> 00:08:51,120
This is two factors that are
recontributing to the problems

171
00:08:51,120 --> 00:08:53,790
of the IT infrastructure.

172
00:08:53,790 --> 00:08:57,680
So, what can go wrong really with this.

173
00:08:57,680 --> 00:09:02,680
First demo, it's about the
attacks on the remote work.

174
00:09:03,910 --> 00:09:06,310
I will start with the VPN pivoting.

175
00:09:06,310 --> 00:09:08,310
And you may be wondering why this attack

176
00:09:08,310 --> 00:09:10,349
has been chosen by me to show an attack

177
00:09:10,350 --> 00:09:12,070
for more than identity.

178
00:09:12,070 --> 00:09:14,150
Imagine that VPN connection

179
00:09:14,150 --> 00:09:16,730
is not based on the username and password.

180
00:09:16,730 --> 00:09:19,000
Imagine it's not even MFA protected,

181
00:09:19,000 --> 00:09:21,440
but it's based on the certificate.

182
00:09:21,440 --> 00:09:23,190
So for the computer or for the user,

183
00:09:23,190 --> 00:09:25,440
so it's a stronger authentication.

184
00:09:25,440 --> 00:09:28,330
And this is a good way of
protecting the identity.

185
00:09:28,330 --> 00:09:30,470
At the same time, we still can attack

186
00:09:30,470 --> 00:09:33,203
the corporate resources
by pivoting to the device

187
00:09:33,203 --> 00:09:37,750
that it already established a
connection to the environment.

188
00:09:37,750 --> 00:09:40,203
Let's see how this one works.

189
00:09:42,790 --> 00:09:46,113
So first of all, let's set up the stage.

190
00:09:47,060 --> 00:09:51,770
I'm setting up right now that
the user is going to connect

191
00:09:52,800 --> 00:09:56,733
from the environment to the VPN.

192
00:09:57,610 --> 00:10:02,560
So, let's see what are the connections,

193
00:10:02,560 --> 00:10:07,560
can I ping the server, this
is the srv01.raccoons.pl,

194
00:10:07,640 --> 00:10:10,750
that's it, it's not working,

195
00:10:10,750 --> 00:10:13,750
until I will be able to
connect with the VPN.

196
00:10:13,750 --> 00:10:18,730
It's just showing that I'm
outside of the network.

197
00:10:18,730 --> 00:10:23,433
Their server not reachable
so let's connect inside.

198
00:10:24,400 --> 00:10:26,819
This is already pre-configured with VPN,

199
00:10:26,820 --> 00:10:29,203
that's very simple to connect.

200
00:10:30,810 --> 00:10:34,880
And the moment that I'm connecting,

201
00:10:34,880 --> 00:10:38,480
I will be able to reach this server again.

202
00:10:38,480 --> 00:10:39,937
It will take some time for the ping,

203
00:10:39,937 --> 00:10:42,970
but the refreshing of the
page is very, very fast.

204
00:10:42,970 --> 00:10:45,400
So it's some legacy JBOSS server,

205
00:10:45,400 --> 00:10:48,010
for those of you who have seen this one,

206
00:10:48,010 --> 00:10:51,350
it's probably vulnerable
for many different types

207
00:10:51,350 --> 00:10:52,920
of the attack.

208
00:10:52,920 --> 00:10:55,860
So what's the attacker can do right now

209
00:10:55,860 --> 00:10:59,380
to get go my systems?

210
00:10:59,380 --> 00:11:03,470
First of all, imagine that I
have already here a Kali Linux,

211
00:11:03,470 --> 00:11:08,230
a Kali Linux that was
prepared for the attack.

212
00:11:08,230 --> 00:11:11,820
Let's see if I'm able to
get to the same server,

213
00:11:11,820 --> 00:11:15,530
this time is ping for the IP address.

214
00:11:15,530 --> 00:11:17,180
Okay, I'm a little bit cheating here

215
00:11:17,180 --> 00:11:19,280
because from the perspective of attacker

216
00:11:19,280 --> 00:11:22,807
he should not know the
IP address of the server

217
00:11:22,807 --> 00:11:26,950
that it's going to
attack, but in such case,

218
00:11:26,950 --> 00:11:28,770
let's say that we already know this

219
00:11:28,770 --> 00:11:31,242
to speed up the process of the demo.

220
00:11:32,130 --> 00:11:37,130
It's connected into the network
which is 192.168.201.100,

221
00:11:37,380 --> 00:11:39,500
it can be anywhere around the world

222
00:11:39,500 --> 00:11:44,500
just about knowing the IP
address, it's ending of the 100,

223
00:11:44,500 --> 00:11:47,740
because what this server will be used for.

224
00:11:47,740 --> 00:11:50,300
This will be used for
the command and control.

225
00:11:50,300 --> 00:11:52,540
So, I'm switching to the Metasploit,

226
00:11:52,540 --> 00:11:55,480
its very common framework
for penetration testing,

227
00:11:55,480 --> 00:11:59,290
or for example, for playing
around with the environment.

228
00:11:59,290 --> 00:12:02,849
And I'm setting up a couple of settings.

229
00:12:02,850 --> 00:12:04,910
First of all, I'm going
to use the multi handler

230
00:12:04,910 --> 00:12:06,829
for handling different connections,

231
00:12:06,830 --> 00:12:08,930
incoming connections is important.

232
00:12:08,930 --> 00:12:13,150
The connection is started
from the workstation

233
00:12:13,150 --> 00:12:17,720
to my server to my Kali Linux.

234
00:12:17,720 --> 00:12:20,165
And there is of course the IP address

235
00:12:20,165 --> 00:12:23,839
of my local Kali Linux,
so this is the server

236
00:12:23,840 --> 00:12:25,640
that will be accepting the connections,

237
00:12:25,640 --> 00:12:30,510
and the port is 4444
getting the connections.

238
00:12:30,510 --> 00:12:34,280
Now it's setting up the
payload for the meterpreter,

239
00:12:34,280 --> 00:12:37,410
is reverse tcp and starting the exploit,

240
00:12:37,410 --> 00:12:41,160
so it's starting to
listen on the port 444,

241
00:12:41,160 --> 00:12:44,520
waiting for incoming connections.

242
00:12:44,520 --> 00:12:46,350
What is important here?

243
00:12:46,350 --> 00:12:48,660
It's that the connection

244
00:12:48,660 --> 00:12:51,260
is coming from the windows 10 machine.

245
00:12:51,260 --> 00:12:54,360
I'm not connecting from the Kali Linux

246
00:12:54,360 --> 00:12:57,180
to the windows 10 machine

247
00:12:57,180 --> 00:13:01,719
but I'm connecting from
the windows 10 machine

248
00:13:01,720 --> 00:13:04,840
inside to the Kali Linux.

249
00:13:04,840 --> 00:13:06,890
This part was not visible,

250
00:13:06,890 --> 00:13:10,160
because there is already a malware

251
00:13:10,160 --> 00:13:13,783
that is constantly running
on the windows 10 machine.

252
00:13:14,660 --> 00:13:18,370
Right now, I'm only focusing on the part

253
00:13:18,370 --> 00:13:22,660
in which the machine already
has a malware running,

254
00:13:22,660 --> 00:13:26,140
and it's connecting back to my Kali Linux.

255
00:13:26,140 --> 00:13:28,730
This will allow me to get this connection

256
00:13:28,730 --> 00:13:30,460
no matter from where.

257
00:13:30,460 --> 00:13:34,850
The connection that we
have here can be exploited.

258
00:13:34,850 --> 00:13:38,560
I can just simply start
controlling this computer

259
00:13:38,560 --> 00:13:42,099
and it's no matter if there
is a firewall in between

260
00:13:42,100 --> 00:13:47,100
or that I can see this same
system on the same session.

261
00:13:49,660 --> 00:13:54,660
It is only possible, of course,
if the outgoing connections

262
00:13:54,900 --> 00:13:59,900
from the windows 10 machine are
allowed to get to my system.

263
00:14:00,620 --> 00:14:02,040
So let's see what are the sessions.

264
00:14:02,040 --> 00:14:04,980
The session is right now still active,

265
00:14:04,980 --> 00:14:06,750
the session ID is number one.

266
00:14:06,750 --> 00:14:10,590
So I'm interactively connecting
to the session number one.

267
00:14:10,590 --> 00:14:13,620
And this is starting with the meterpreter.

268
00:14:13,620 --> 00:14:14,950
The first thing which I can do

269
00:14:14,950 --> 00:14:17,710
is get just simply to the shell,

270
00:14:17,710 --> 00:14:22,507
showing that Who am I this is
like a CMD in the remote host.

271
00:14:23,513 --> 00:14:27,180
The second thing is that I
have the IP configuration.

272
00:14:27,180 --> 00:14:31,120
So, this is one of the networks is 92

273
00:14:31,120 --> 00:14:34,040
but the second one is 10.10.10.151

274
00:14:34,040 --> 00:14:36,949
because this is the
VPN connected computer.

275
00:14:36,950 --> 00:14:39,880
So this computer is in
two different places

276
00:14:39,880 --> 00:14:41,010
at the same time.

277
00:14:41,010 --> 00:14:44,060
It is connected to the VPN

278
00:14:44,060 --> 00:14:47,239
and it's connected also to
some access to the Internet,

279
00:14:47,240 --> 00:14:49,120
of course because it needs to have access

280
00:14:49,120 --> 00:14:51,203
to their remote resources.

281
00:14:52,900 --> 00:14:54,290
What else can be done?

282
00:14:54,290 --> 00:14:57,760
Let's start if it's
possible for me to extract

283
00:14:57,760 --> 00:15:01,510
the credentials for
example which can be stored

284
00:15:01,510 --> 00:15:06,340
inside of the VPN connections.

285
00:15:06,340 --> 00:15:09,950
I have a tool, which is an
open VPN extraction tool

286
00:15:09,950 --> 00:15:12,880
that I written this is very
simple PowerShell script,

287
00:15:12,880 --> 00:15:15,689
that is extracting saved information

288
00:15:15,690 --> 00:15:18,720
that are inside of the
registry of the windows.

289
00:15:18,720 --> 00:15:21,560
So if you think about saving
some more credentials,

290
00:15:21,560 --> 00:15:25,739
think about this, who can access
those credentials as well.

291
00:15:25,740 --> 00:15:27,860
Storing this kind of username passwords,

292
00:15:27,860 --> 00:15:29,850
very easy to extract.

293
00:15:29,850 --> 00:15:31,970
And whenever you are saving the passwords,

294
00:15:31,970 --> 00:15:33,513
remember someone can steal it.

295
00:15:36,017 --> 00:15:37,840
I'm getting back to the meterpreter

296
00:15:37,840 --> 00:15:42,350
and I'm going to send this
session into the background,

297
00:15:42,350 --> 00:15:44,960
because I want to switch
from the meterpreter,

298
00:15:44,960 --> 00:15:49,170
this time to the different module.

299
00:15:49,170 --> 00:15:50,910
So Still, this session exists,

300
00:15:50,910 --> 00:15:52,839
there's established connection,

301
00:15:52,840 --> 00:15:55,380
I can communicate with
the windows 10 machine

302
00:15:55,380 --> 00:15:57,740
and I want to use this auxiliary module

303
00:15:57,740 --> 00:16:00,240
which is the server and this is socks4a,

304
00:16:01,263 --> 00:16:04,130
this is the service that allows me

305
00:16:04,130 --> 00:16:08,770
to just simply use it as a proxy.

306
00:16:08,770 --> 00:16:11,293
It's listening on the port 1080,

307
00:16:12,150 --> 00:16:14,770
before running that I need
to add one more thing.

308
00:16:14,770 --> 00:16:17,130
I want to access the route

309
00:16:17,130 --> 00:16:19,400
and you've seen the network
to which it was connected.

310
00:16:19,400 --> 00:16:24,150
So it was 10.10.10.0 with the 24 bit,

311
00:16:24,150 --> 00:16:28,760
so it's 255.255.255.0

312
00:16:30,470 --> 00:16:32,660
because this is a
representation of 24 bits,

313
00:16:32,660 --> 00:16:36,069
and of course there is the interface.

314
00:16:36,070 --> 00:16:38,140
But the interface this
time it's a session ID.

315
00:16:38,140 --> 00:16:40,766
So this is the same as
previously I was displaying

316
00:16:40,766 --> 00:16:42,040
and connecting to it.

317
00:16:42,040 --> 00:16:44,010
Session ID one.

318
00:16:44,010 --> 00:16:48,540
In such case, I'm just simply
connecting route, route added,

319
00:16:48,540 --> 00:16:52,010
and now I can run the proxy server.

320
00:16:52,010 --> 00:16:54,689
So on my Kali Linux,
I have a proxy server.

321
00:16:54,690 --> 00:16:57,890
And anytime I'm connecting
to that proxy server,

322
00:16:57,890 --> 00:17:00,439
see there is nothing
really as an IP address,

323
00:17:00,440 --> 00:17:04,420
whenever I'm trying to
get to that one directly,

324
00:17:04,420 --> 00:17:06,150
no there is no connection.

325
00:17:06,150 --> 00:17:10,530
But if I use a proxy, in such
case I will use proxychains,

326
00:17:10,530 --> 00:17:13,300
I will be able to get to my system

327
00:17:13,300 --> 00:17:16,272
and get to the inside of the network

328
00:17:19,790 --> 00:17:21,453
of the corporate network there.

329
00:17:22,690 --> 00:17:25,440
So as you can see, I'm scanning right now

330
00:17:25,440 --> 00:17:30,440
and there is a port 8080, our
label and its connection okay,

331
00:17:30,520 --> 00:17:32,550
because I'm connecting to the local host,

332
00:17:32,550 --> 00:17:36,867
then going through the tunnel
to get to the remote host.

333
00:17:36,867 --> 00:17:39,149
And then really work who is scanning?

334
00:17:39,150 --> 00:17:42,150
The windows 10 machine is
scanning, not my Kali Linux,

335
00:17:42,150 --> 00:17:43,780
but I'm executing the comments

336
00:17:43,780 --> 00:17:46,320
and bouncing all the network traffic

337
00:17:46,320 --> 00:17:48,350
through that VPN connection

338
00:17:48,350 --> 00:17:51,439
that was established on
a compromised server,

339
00:17:51,440 --> 00:17:53,980
so even without knowing the credentials.

340
00:17:53,980 --> 00:17:55,170
How about Firefox?

341
00:17:55,170 --> 00:17:58,340
I started the Firefox as a proxy chain

342
00:17:58,340 --> 00:18:02,003
and as you can see, it's also
available for me right now.

343
00:18:02,850 --> 00:18:07,230
So that's something
that's quite commonly used

344
00:18:07,230 --> 00:18:12,230
for accessing an externally
available networks.

345
00:18:12,320 --> 00:18:13,790
How this looks like?

346
00:18:13,790 --> 00:18:16,423
So just to have a small recap here.

347
00:18:17,300 --> 00:18:18,629
The computer was compromised,

348
00:18:18,630 --> 00:18:20,720
it might be like corporate computer

349
00:18:20,720 --> 00:18:21,863
or it might be personal computer

350
00:18:21,863 --> 00:18:24,420
that has an established
connection through the VPN.

351
00:18:24,420 --> 00:18:27,873
So this computer has access to the VPN,

352
00:18:28,830 --> 00:18:32,470
and has access to the component
servers component resources.

353
00:18:32,470 --> 00:18:36,170
Next, this computer was
compromised with a malware.

354
00:18:36,170 --> 00:18:37,330
This phase I was not showing,

355
00:18:37,330 --> 00:18:38,889
because there's so many different ways

356
00:18:38,890 --> 00:18:40,250
of how it can be done.

357
00:18:40,250 --> 00:18:45,080
It can be, for example, through
the special kind of malware

358
00:18:45,080 --> 00:18:49,070
that was installed there
or anything similar.

359
00:18:49,070 --> 00:18:53,090
And it's connecting to my
command and control computer,

360
00:18:53,090 --> 00:18:54,629
so this was my Kali Linux,

361
00:18:54,630 --> 00:18:57,920
this is the computer that is
controlled by the attacker.

362
00:18:57,920 --> 00:19:02,583
And he was just issuing the
commands through this server

363
00:19:03,460 --> 00:19:06,570
through this computer to
get to the servers inside.

364
00:19:06,570 --> 00:19:10,050
So it's like tunnel that is initiated

365
00:19:10,050 --> 00:19:14,430
from this windows 10
machine, not only to the VPN,

366
00:19:14,430 --> 00:19:17,450
but the same windows 10
machine with the malware

367
00:19:17,450 --> 00:19:20,630
is initiating connection to
the Command and Control Center,

368
00:19:20,630 --> 00:19:22,680
which allows bouncing over

369
00:19:22,680 --> 00:19:24,743
to get to the component resources.

370
00:19:26,180 --> 00:19:29,870
So as you have seen
this attack can be used

371
00:19:29,870 --> 00:19:33,429
no matter what kind of credentials
or identity verification

372
00:19:33,430 --> 00:19:34,620
is done on the VPN.

373
00:19:34,620 --> 00:19:37,989
Also works with the most modern identity.

374
00:19:37,990 --> 00:19:41,700
No matter if it's a certificate,
it's MFA on the VPN,

375
00:19:41,700 --> 00:19:45,973
you can just simply use
it and to attack it.

376
00:19:47,070 --> 00:19:50,250
Alright, so now it's time
for something more modern

377
00:19:50,250 --> 00:19:51,250
than VPN.

378
00:19:51,250 --> 00:19:54,646
Again, systems which
were created recently,

379
00:19:54,646 --> 00:19:56,610
can be fully cloud based,

380
00:19:56,610 --> 00:20:01,610
or they can be very fast
adopting some new principles.

381
00:20:01,870 --> 00:20:04,290
One of those is zero trust principle.

382
00:20:04,290 --> 00:20:07,610
It's easy to adopt it
for cloud based only.

383
00:20:07,610 --> 00:20:12,610
For hybrid environments, or
those which are on site only

384
00:20:13,200 --> 00:20:16,600
on premise environments, it's
a little bit more difficult.

385
00:20:16,600 --> 00:20:21,379
But it's very good idea to
even start adopting partially

386
00:20:21,380 --> 00:20:23,043
the Zero Trust Model.

387
00:20:24,210 --> 00:20:26,840
What are the three
principles of the Zero Trust?

388
00:20:26,840 --> 00:20:29,949
What that everyone is talking
about really right now?

389
00:20:29,950 --> 00:20:32,380
Is never trust, always verify.

390
00:20:32,380 --> 00:20:37,380
So, always authenticate and
authorize all incoming requests,

391
00:20:38,120 --> 00:20:42,110
including user identity,
location, device health,

392
00:20:42,110 --> 00:20:46,290
data classification and
try to detect anomalies.

393
00:20:46,290 --> 00:20:49,730
So all of those elements are building

394
00:20:49,730 --> 00:20:53,253
this always verify element.

395
00:20:54,120 --> 00:20:56,149
The second thing is least privilege.

396
00:20:56,150 --> 00:20:58,090
Assigned no matter what.

397
00:20:58,090 --> 00:21:03,000
So this is the minimum sub set
of privileges and permissions

398
00:21:03,000 --> 00:21:07,450
that are assigned to the
users or in general identities

399
00:21:07,450 --> 00:21:11,110
to perform the task that they need to do.

400
00:21:11,110 --> 00:21:14,939
It's also risk based adaptive policies,

401
00:21:14,940 --> 00:21:19,610
which are protecting the data breaches.

402
00:21:19,610 --> 00:21:24,370
For example, you are outside
of your normal working hours,

403
00:21:24,370 --> 00:21:27,969
or you're outside of
your normal, let's say,

404
00:21:27,970 --> 00:21:30,740
standard locations in
which you are working,

405
00:21:30,740 --> 00:21:32,550
you are getting less privileges,

406
00:21:32,550 --> 00:21:36,149
you don't have access to
the most sensitive data.

407
00:21:36,150 --> 00:21:39,200
Then the last part is
always assume the breach.

408
00:21:39,200 --> 00:21:42,540
So, you don't trust any device.

409
00:21:42,540 --> 00:21:44,720
No matter if this is the
computer of your colleague

410
00:21:44,720 --> 00:21:45,830
which is next to you,

411
00:21:45,830 --> 00:21:49,090
if this is the server that is
controlled by your colleague

412
00:21:49,090 --> 00:21:53,669
from IT department, you always
assume that that device,

413
00:21:53,670 --> 00:21:58,163
that process, that request
is a hostile request.

414
00:21:59,150 --> 00:22:01,740
You should always encrypt all traffic

415
00:22:01,740 --> 00:22:04,290
and do an encryption no matter what.

416
00:22:04,290 --> 00:22:08,700
Use analytics to get the
visibility and detection

417
00:22:08,700 --> 00:22:13,583
of the threats and detect
the anomalies on it.

418
00:22:15,340 --> 00:22:19,659
So, why we are focusing
so much on the identity

419
00:22:19,660 --> 00:22:21,430
and the protection of it.

420
00:22:21,430 --> 00:22:25,063
It's all about the evolution
of security perimeter.

421
00:22:26,990 --> 00:22:28,890
For the organization at the beginning,

422
00:22:30,350 --> 00:22:35,189
there was a physical security,
big fans, guard, dog,

423
00:22:35,190 --> 00:22:38,460
maybe a moat with alligators inside.

424
00:22:38,460 --> 00:22:43,460
Next, we connected the computers,
connected to the internet

425
00:22:43,470 --> 00:22:47,400
and there is a new perimeter, the network,

426
00:22:47,400 --> 00:22:50,610
especially the perimeter
network, DMZ, external access,

427
00:22:50,610 --> 00:22:53,429
this is what was protected.

428
00:22:53,430 --> 00:22:54,720
But this has changed.

429
00:22:54,720 --> 00:22:58,260
Right now, we're really living and working

430
00:22:58,260 --> 00:23:00,030
in the hyper connected world,

431
00:23:00,030 --> 00:23:03,950
where your smartwatch is
connecting to the mail server,

432
00:23:03,950 --> 00:23:08,340
where car is getting
information from your phone

433
00:23:08,340 --> 00:23:11,370
and all connected to the internet,

434
00:23:11,370 --> 00:23:13,429
with a major review of
the applications available

435
00:23:13,430 --> 00:23:16,100
all over the world no matter where.

436
00:23:16,100 --> 00:23:21,100
So, what is one thing
that is giving you access

437
00:23:21,710 --> 00:23:24,770
to all of this is devices and data?

438
00:23:24,770 --> 00:23:26,110
It's your identity.

439
00:23:26,110 --> 00:23:28,030
So you need to protect it.

440
00:23:28,030 --> 00:23:31,710
And you can protect it in
let's say in the classic way,

441
00:23:31,710 --> 00:23:33,140
like username password,

442
00:23:33,140 --> 00:23:35,460
or you can go a little
bit more modern way,

443
00:23:35,460 --> 00:23:37,723
which is more secure as well on that.

444
00:23:38,600 --> 00:23:41,520
So what's the simplest
way to protect identity?

445
00:23:41,520 --> 00:23:45,180
Which is good set of credentials?

446
00:23:45,180 --> 00:23:46,880
And what's the easiest way

447
00:23:46,880 --> 00:23:49,000
to mitigate the classic passwords attack?

448
00:23:49,000 --> 00:23:51,853
It's MFA, Multi-factor Authentication.

449
00:23:52,733 --> 00:23:55,290
So what's about that?

450
00:23:55,290 --> 00:23:56,659
At least two factors.

451
00:23:56,660 --> 00:23:57,850
What are the factors?

452
00:23:57,850 --> 00:24:01,090
Something you know, something
you have, something you are.

453
00:24:01,090 --> 00:24:05,100
Where you are, so for example,
a biometric verification.

454
00:24:05,100 --> 00:24:09,929
Please never send a
biometric identification

455
00:24:09,930 --> 00:24:10,900
over the network.

456
00:24:10,900 --> 00:24:12,770
Biometric is very good,

457
00:24:12,770 --> 00:24:16,530
but to unlock something
like a strong credentials,

458
00:24:16,530 --> 00:24:18,399
like asymmetric keys.

459
00:24:18,400 --> 00:24:22,470
And don't transfer it
because it is not changeable.

460
00:24:22,470 --> 00:24:25,470
Something you have you can
change a smartcard password,

461
00:24:25,470 --> 00:24:27,390
so something you know you can change it,

462
00:24:27,390 --> 00:24:29,620
but biometric, I have 10 fingers

463
00:24:29,620 --> 00:24:32,790
and only this is the
number of different data

464
00:24:32,790 --> 00:24:36,218
that I have about me if it's
going to be a fingerprint.

465
00:24:36,218 --> 00:24:38,940
With the iris scan, only two eyes,

466
00:24:38,940 --> 00:24:41,560
so not a good idea to lose it.

467
00:24:41,560 --> 00:24:44,820
Okay, somewhere you
are, somewhere you are.

468
00:24:44,820 --> 00:24:47,610
So where are you,
depending on the location,

469
00:24:47,610 --> 00:24:49,350
if it's your standard IP addresses,

470
00:24:49,350 --> 00:24:53,020
something or give a location,
it might disable MFA for you,

471
00:24:53,020 --> 00:24:56,470
this is a conditional access
for this and that's good.

472
00:24:56,470 --> 00:25:01,470
So, is it really possible
to break the MFA?

473
00:25:05,770 --> 00:25:09,510
Let's see how secure is MFA.

474
00:25:09,510 --> 00:25:11,790
Let's switch to the next demo.

475
00:25:11,790 --> 00:25:15,807
So I'm connecting right now
to the, again, Linux machine,

476
00:25:18,100 --> 00:25:20,860
this line is machines publicly available,

477
00:25:20,860 --> 00:25:23,719
I was connecting to it from external

478
00:25:23,720 --> 00:25:26,730
so to the external IP address,

479
00:25:26,730 --> 00:25:29,271
and I'm starting the Evilginx

480
00:25:29,271 --> 00:25:31,820
Evilginx is a set of the tool

481
00:25:31,820 --> 00:25:34,899
that is configured right
now for me for the spoofing

482
00:25:34,900 --> 00:25:37,660
of the identity of Microsoft,

483
00:25:37,660 --> 00:25:42,608
because I'm sending a message as a domain,

484
00:25:42,608 --> 00:25:45,090
Microsoftonlinecom.co.

485
00:25:45,090 --> 00:25:48,590
And this is the template
for the message in which

486
00:25:48,590 --> 00:25:53,590
you have like a teams message
that you have some messages

487
00:25:53,970 --> 00:25:56,520
not received yet or not reply to.

488
00:25:56,520 --> 00:26:01,389
I'm sending it from the
domain that is similar

489
00:26:01,390 --> 00:26:02,993
to the Microsoft domain.

490
00:26:02,993 --> 00:26:05,510
Okay, what's happening next?

491
00:26:05,510 --> 00:26:09,379
I'm just going to show
how this may look like

492
00:26:09,380 --> 00:26:11,770
when the user receives it.

493
00:26:11,770 --> 00:26:14,150
User get the mail,
there's a brand new mail

494
00:26:14,150 --> 00:26:18,533
and it's opening it
inside of the web browser,

495
00:26:19,995 --> 00:26:22,600
on the outlook, doesn't match.

496
00:26:22,600 --> 00:26:26,070
He's clicking on the
link, and is redirected

497
00:26:26,070 --> 00:26:29,750
to the microsoftonlinecom.co.

498
00:26:29,750 --> 00:26:33,300
They're logging and everything
is looking perfectly fine,

499
00:26:33,300 --> 00:26:36,649
just watch out that there's
a different domain name

500
00:26:36,650 --> 00:26:38,140
in the URL.

501
00:26:38,140 --> 00:26:41,030
It's authenticating with
his username and password,

502
00:26:41,030 --> 00:26:44,060
okay, but he's safe, he has MFA.

503
00:26:44,060 --> 00:26:47,070
Now, you see that it's
challenging him for the MFA.

504
00:26:47,070 --> 00:26:50,120
At the same time, the same
operation is happening

505
00:26:50,120 --> 00:26:53,679
in the background, to the
real Microsoft webpage.

506
00:26:53,680 --> 00:26:57,510
And after user authenticates
and provides the credentials,

507
00:26:57,510 --> 00:27:00,010
he is redirected to the
official Microsoft page.

508
00:27:00,010 --> 00:27:02,570
So he's not suspecting anything here

509
00:27:02,570 --> 00:27:04,820
and it's all looks good.

510
00:27:04,820 --> 00:27:08,360
So as you can see, he's getting messages,

511
00:27:08,360 --> 00:27:10,209
he's getting something like,

512
00:27:10,210 --> 00:27:13,040
I think also information from the side,

513
00:27:15,480 --> 00:27:18,050
and the Kali Linux is displaying right now

514
00:27:18,050 --> 00:27:22,690
on the Evilginx here, the
information about this user,

515
00:27:22,690 --> 00:27:26,720
and there is authentication
for this with the password

516
00:27:26,720 --> 00:27:30,020
and also that all authorization
tokens intercepted.

517
00:27:30,020 --> 00:27:33,560
So as you can see, also I have a session

518
00:27:33,560 --> 00:27:35,300
which is working here

519
00:27:35,300 --> 00:27:40,300
and it's allowing me to
get to those credentials,

520
00:27:40,770 --> 00:27:43,889
also to all the tokens that were issued.

521
00:27:43,890 --> 00:27:47,740
So now it's just a case
of getting the token

522
00:27:47,740 --> 00:27:49,130
into the browser

523
00:27:49,130 --> 00:27:53,250
and not passing through
the password anymore,

524
00:27:53,250 --> 00:27:58,250
not being bothered by any kind
of MFA or anything like that.

525
00:27:59,130 --> 00:28:00,313
Okay, let's go back.

526
00:28:02,030 --> 00:28:07,030
So, how about even more
modern authentication

527
00:28:08,519 --> 00:28:10,230
than using MFA?

528
00:28:10,230 --> 00:28:13,570
How about using the strong authentication,

529
00:28:13,570 --> 00:28:15,010
which is Windows Hello for Business,

530
00:28:15,010 --> 00:28:16,150
it replaces the password

531
00:28:16,150 --> 00:28:18,840
with strong two factor
authentication on PC

532
00:28:18,840 --> 00:28:20,470
and mobile device.

533
00:28:20,470 --> 00:28:24,580
This is a consist of a new
type of their credentials,

534
00:28:24,580 --> 00:28:27,659
which are the NGC that
are tied to the device

535
00:28:27,660 --> 00:28:31,490
and use the biometric
verification like more maybe PIN

536
00:28:31,490 --> 00:28:33,050
to unlock the credentials

537
00:28:33,050 --> 00:28:36,919
but the biometric or the PIN
is never sent on the network.

538
00:28:36,920 --> 00:28:41,030
The only the NGC is used
to confirm the identity.

539
00:28:41,030 --> 00:28:43,610
So this is the most modern
type of the credential

540
00:28:43,610 --> 00:28:45,010
that we have.

541
00:28:45,010 --> 00:28:48,030
And its address the problems
of the strong passwords

542
00:28:48,030 --> 00:28:50,310
also the breaches on the server,

543
00:28:50,310 --> 00:28:53,169
expose the network
credentials, all of those.

544
00:28:53,170 --> 00:28:56,760
They can be used for authenticate
to the Microsoft account,

545
00:28:56,760 --> 00:29:00,410
Active Directory account,
Microsoft Azure Active Directory,

546
00:29:00,410 --> 00:29:04,823
or to any other relying party
through the ADFS for example.

547
00:29:05,940 --> 00:29:09,630
But also the Windows Hello
for Business might be used

548
00:29:09,630 --> 00:29:13,980
as an vector of an attack
or as a persistency

549
00:29:13,980 --> 00:29:16,190
inside of the network.

550
00:29:16,190 --> 00:29:19,563
So let's try and see
how this one looks like.

551
00:29:20,541 --> 00:29:23,230
This is this already the configuration

552
00:29:23,230 --> 00:29:28,230
in which I have the privileged access.

553
00:29:28,740 --> 00:29:32,960
And right now I'm trying
to leave the persistency

554
00:29:32,960 --> 00:29:35,970
for the future, that's important.

555
00:29:35,970 --> 00:29:39,050
I'm creating the new credentials,

556
00:29:39,050 --> 00:29:41,053
the self-signed
certificate, as you can see,

557
00:29:41,053 --> 00:29:44,030
there's a self-signed certificate
that's very important,

558
00:29:44,030 --> 00:29:46,389
which is presenting the NGC

559
00:29:46,390 --> 00:29:49,890
and I'm exporting good to the pfx file.

560
00:29:49,890 --> 00:29:51,530
For the old of those operations,

561
00:29:51,530 --> 00:29:54,040
I'm going to use the DSC internals module,

562
00:29:54,040 --> 00:29:57,330
the module created by my
colleague Michael Grafnetter

563
00:29:57,330 --> 00:30:02,330
and this is the certificate
guide for some user SID.

564
00:30:05,080 --> 00:30:10,080
This user SID is used as
of course from the domain

565
00:30:10,270 --> 00:30:12,800
because it's on the domain access

566
00:30:12,800 --> 00:30:15,220
but similar attempts can be performed

567
00:30:15,220 --> 00:30:18,013
when we are accessing
something on the net.

568
00:30:19,890 --> 00:30:23,550
The thing about the credentials is that

569
00:30:23,550 --> 00:30:25,520
they need to be imported

570
00:30:25,520 --> 00:30:28,450
inside of the Active Directory Object.

571
00:30:28,450 --> 00:30:31,220
So I need to find the object of this user,

572
00:30:31,220 --> 00:30:35,070
this is the Yoda Master User
for me in the raccoons domain

573
00:30:35,070 --> 00:30:38,587
and I'm setting the msDS-KeyCredentialLink

574
00:30:41,900 --> 00:30:45,340
to exactly this NGC keys.

575
00:30:45,340 --> 00:30:48,800
So it's in the binary format,

576
00:30:48,800 --> 00:30:52,322
I'm writing into the Active
Directory those credentials.

577
00:30:55,200 --> 00:30:57,420
Okay, so I'm signing out,

578
00:30:57,420 --> 00:30:59,710
because I don't want
to be an admin anymore.

579
00:30:59,710 --> 00:31:04,710
And I want to show that there is a user,

580
00:31:05,540 --> 00:31:07,629
it's a local user, that's very important,

581
00:31:07,630 --> 00:31:08,700
it will be a local user

582
00:31:08,700 --> 00:31:11,830
so it's nothing that I have
a permissions on the domain,

583
00:31:11,830 --> 00:31:15,439
just, I need to have an
access to this pfx file

584
00:31:15,440 --> 00:31:17,500
to have access to the NGCs

585
00:31:17,500 --> 00:31:19,100
because it's based on the certificate,

586
00:31:19,100 --> 00:31:21,649
but it really inside of
the Active Directory,

587
00:31:21,650 --> 00:31:24,370
and it's not visible as the certificate.

588
00:31:24,370 --> 00:31:26,350
Okay, so let's start the CMD

589
00:31:26,350 --> 00:31:31,050
and let's try to get to
the domain controller,

590
00:31:31,050 --> 00:31:33,879
okay, first let's who am
I that will be easier.

591
00:31:33,880 --> 00:31:37,480
I'm not a domain user,
it's only built in users,

592
00:31:37,480 --> 00:31:40,420
nothing from the domain.

593
00:31:40,420 --> 00:31:44,310
And let's try to get to
the domain controller.

594
00:31:44,310 --> 00:31:47,919
In this case, it's raccoons pl,

595
00:31:47,920 --> 00:31:50,326
and oh, network path was not found

596
00:31:50,326 --> 00:31:53,902
so that's the wrong server but okay.

597
00:31:53,902 --> 00:31:56,988
It should be SDC I think.

598
00:31:56,988 --> 00:32:01,988
Let's correct this one, SDC1
yeah, that's correct, SDC1.

599
00:32:02,230 --> 00:32:06,560
So the next thing is that I'm going to use

600
00:32:06,560 --> 00:32:09,149
exactly the same credentials

601
00:32:09,150 --> 00:32:12,710
or rather use the same PowerShell tools.

602
00:32:12,710 --> 00:32:17,710
So this time, it's
Kekeo, and in the Kekeo,

603
00:32:17,990 --> 00:32:20,770
this is created by Benjamin Delpy.

604
00:32:20,770 --> 00:32:25,710
I will be requesting the
TGT, Ticket Granting Ticket

605
00:32:25,710 --> 00:32:26,870
because I'm on premise,

606
00:32:26,870 --> 00:32:31,000
so that's one of the
things that it's possible,

607
00:32:31,000 --> 00:32:35,350
but it no matter where are
you, you can request this token

608
00:32:35,350 --> 00:32:39,310
if it's available for
your NGC credentials.

609
00:32:39,310 --> 00:32:42,300
NGC credentials are also for the cloud.

610
00:32:42,300 --> 00:32:44,899
But slightly different path would be used

611
00:32:44,900 --> 00:32:48,323
if accessing the Azure AD.

612
00:32:49,530 --> 00:32:52,660
Right now, I'm importing the pfx,

613
00:32:52,660 --> 00:32:55,050
because previous attempt was not correct.

614
00:32:55,050 --> 00:32:58,780
I'm importing the pfx, this
is the self-signed certificate

615
00:32:58,780 --> 00:33:01,473
that was generated with the NGCs.

616
00:33:02,610 --> 00:33:05,763
And after they're successfully
inputting the NGCs,

617
00:33:07,000 --> 00:33:10,703
I'm able to get to my system,

618
00:33:11,610 --> 00:33:15,290
because I'm requesting right now the PC,

619
00:33:15,290 --> 00:33:19,360
and this is the TGT and
the second thing is that,

620
00:33:19,360 --> 00:33:23,800
I already see here a
password hash for the NTLM.

621
00:33:23,800 --> 00:33:25,580
So based on the NGCs,

622
00:33:25,580 --> 00:33:27,970
which are the newest
type of the credentials,

623
00:33:27,970 --> 00:33:30,490
I can get the old one.

624
00:33:30,490 --> 00:33:33,900
And this is still giving
me a possibility of getting

625
00:33:34,800 --> 00:33:39,260
to the environment for the resources

626
00:33:39,260 --> 00:33:42,150
that are not using the NGCs
are not using the Kerberos.

627
00:33:42,150 --> 00:33:44,530
So that's quite simple.

628
00:33:44,530 --> 00:33:47,160
I can also use it with the slash PTT

629
00:33:47,160 --> 00:33:50,670
to get the Kerberos ticket
right away and in such case,

630
00:33:50,670 --> 00:33:55,320
I can list it, so it not that
I need to use it separately,

631
00:33:55,320 --> 00:33:59,669
or just simply get the console
or use the same console

632
00:33:59,670 --> 00:34:03,100
to authenticate to other resources,

633
00:34:03,100 --> 00:34:05,629
for example, to the domain controller

634
00:34:05,630 --> 00:34:07,940
and you can imagine what
I can do with that one

635
00:34:07,940 --> 00:34:10,969
when it's starting exactly like this

636
00:34:10,969 --> 00:34:14,819
and that I can get to
the for example ntts.dt

637
00:34:14,820 --> 00:34:17,590
or any other location.

638
00:34:17,590 --> 00:34:21,070
Okay, remember, this is the persistency

639
00:34:21,070 --> 00:34:23,870
in the Active Directory,

640
00:34:23,870 --> 00:34:28,630
which is using the newest
Windows Hello for Business.

641
00:34:28,630 --> 00:34:33,460
This is something that
is sometimes neglected

642
00:34:33,460 --> 00:34:35,389
in the environment.

643
00:34:35,389 --> 00:34:37,989
To be able to perform this kind of attack,

644
00:34:37,989 --> 00:34:40,310
remember that the only one necessary thing

645
00:34:40,310 --> 00:34:43,922
is that there is some
certificate inside of the NT out

646
00:34:46,469 --> 00:34:49,189
in the environment.

647
00:34:49,190 --> 00:34:52,400
Okay, those were a couple of attacks

648
00:34:52,400 --> 00:34:56,803
that were using different
kinds of identities,

649
00:34:56,803 --> 00:35:00,100
for example, the first
one was the VPN pivoting

650
00:35:00,100 --> 00:35:01,180
which showed you that

651
00:35:01,180 --> 00:35:04,049
even with the most modern
authentication to the VPN,

652
00:35:04,050 --> 00:35:05,090
it is still danger.

653
00:35:05,090 --> 00:35:10,090
So have the attackers
adjusted to the new reality

654
00:35:11,320 --> 00:35:13,140
that everyone is working remotely?

655
00:35:13,140 --> 00:35:13,973
Yeah, sure.

656
00:35:13,973 --> 00:35:17,540
For that, definitely, the
VPN pivoting, constantly.

657
00:35:17,540 --> 00:35:20,130
Remember MFA definitely on that one.

658
00:35:20,130 --> 00:35:22,350
Then the second attack was about

659
00:35:23,420 --> 00:35:26,540
getting and bypassing the MFA.

660
00:35:26,540 --> 00:35:28,920
The last part is really about

661
00:35:28,920 --> 00:35:30,610
the Windows Hello for Business,

662
00:35:30,610 --> 00:35:34,733
so also using the newest
type of the credentials.

663
00:35:35,610 --> 00:35:39,690
So how to mitigate the remote
access and the problems

664
00:35:39,690 --> 00:35:41,490
with remote network.

665
00:35:41,490 --> 00:35:44,229
Even that I was showing how to bypass MFA,

666
00:35:44,230 --> 00:35:47,620
it is still much better to
have it than not to have it.

667
00:35:47,620 --> 00:35:49,720
Increase the visibility on your VPN.

668
00:35:49,720 --> 00:35:52,750
And what your remote workers are doing

669
00:35:52,750 --> 00:35:56,600
and show that there is
an appropriate training

670
00:35:56,600 --> 00:36:00,083
for the IT personnel to
handle the cases with the VPN.

671
00:36:01,760 --> 00:36:04,260
What are the long term mitigations?

672
00:36:04,260 --> 00:36:08,410
So those which are not including
the just simply VPN itself.

673
00:36:08,410 --> 00:36:12,960
Well-written and tested
incident response plan evolving

674
00:36:12,960 --> 00:36:16,420
and including the complete
remote access scenarios,

675
00:36:16,420 --> 00:36:19,570
no matter what is your
remote access scenario.

676
00:36:19,570 --> 00:36:22,610
Is it their proxy servers,
reverse proxy, if is the VPN,

677
00:36:22,610 --> 00:36:23,700
doesn't matter.

678
00:36:23,700 --> 00:36:26,759
Include this because your
security plan has changed

679
00:36:26,760 --> 00:36:29,670
and the surface of attack has changed.

680
00:36:29,670 --> 00:36:30,593
Assume the breach.

681
00:36:32,470 --> 00:36:35,180
Embed the VPN as a critical attack vector

682
00:36:35,180 --> 00:36:37,770
if you're using VPN, on the threat map

683
00:36:37,770 --> 00:36:40,140
and your ongoing security monitoring.

684
00:36:40,140 --> 00:36:43,060
Security monitoring for the VPN must have.

685
00:36:43,060 --> 00:36:46,710
Design and introduce access
authentication authorization

686
00:36:46,710 --> 00:36:49,230
to the resources regardless
of the use of location

687
00:36:49,230 --> 00:36:53,540
and their way of authenticating
accessing the resources.

688
00:36:53,540 --> 00:36:57,440
Try not to use the legacy
identity credentials

689
00:36:57,440 --> 00:36:59,410
with the username password.

690
00:36:59,410 --> 00:37:01,710
Go with something more
modern certificates,

691
00:37:01,710 --> 00:37:05,023
Windows Hello for Business,
anything is better than this.

692
00:37:05,880 --> 00:37:08,740
Start your journey through the zero trust,

693
00:37:08,740 --> 00:37:12,109
adopt your solution to
verify identity and access

694
00:37:12,110 --> 00:37:15,130
regardless of user
location, remember that.

695
00:37:15,130 --> 00:37:17,190
Implement password less authentication.

696
00:37:17,190 --> 00:37:20,200
That's also a good idea,

697
00:37:20,200 --> 00:37:23,613
because passwords are constantly breached.

698
00:37:24,990 --> 00:37:26,810
I hope you enjoyed the session

699
00:37:26,810 --> 00:37:30,560
and that you will adjust
to the remote work

700
00:37:30,560 --> 00:37:33,870
as well the protecting of the remote work

701
00:37:33,870 --> 00:37:36,440
as the attackers are adjusting to it

702
00:37:36,440 --> 00:37:38,683
to try to breach your security.

