1
00:00:11,060 --> 00:00:15,750
everybody

2
00:00:15,750 --> 00:00:34,080
everybody slides prepared I promise I'm
Richard what's how or where cartel and

3
00:00:34,080 --> 00:00:38,610
I'm gonna give a talk mostly on abt
malware kind of some of the things that

4
00:00:38,610 --> 00:00:42,989
we see out there and just wanted to give
you an idea of what's really out there

5
00:00:42,989 --> 00:00:48,209
versus what like the media makes a BTM
our look like so well I'll give you a

6
00:00:48,210 --> 00:00:54,670
little bio about myself then we'll see
how you ever been so far as to have

7
00:00:54,670 --> 00:01:01,010
known what and how the being of ATT's
are will have a little story time and

8
00:01:01,010 --> 00:01:05,929
then we'll talk about little bit about
like the ways that our authors can do

9
00:01:05,930 --> 00:01:09,759
better and some of the ones that do and
then some ways that they can really do

10
00:01:09,759 --> 00:01:14,500
better and then will end without life
because we're not so you may be

11
00:01:14,500 --> 00:01:18,030
wondering what's the word for sale
that's a large part I'll apparently I

12
00:01:18,030 --> 00:01:21,320
had a friend of mine drop my spirit
animal and that's what I got so

13
00:01:21,320 --> 00:01:29,220
apparently I ride rapid action shooter a
must but anyways I work for Palo Alto

14
00:01:29,220 --> 00:01:33,689
Networks a reverse engineer for a new
research team they're doing some really

15
00:01:33,689 --> 00:01:39,649
cool stuff so I also write CTF
challenges if you haven't had enough of

16
00:01:39,650 --> 00:01:43,670
a push go to the CTF I read some of the
reversing challenges for that it's a

17
00:01:43,670 --> 00:01:49,299
great CTF and go do it so let's talk
about apt

18
00:01:49,299 --> 00:01:54,470
abt is this big buzzword that everybody
in this room probably hates me for

19
00:01:54,470 --> 00:01:57,490
saying over and over again in the stock
but im gonna say it a lot and I

20
00:01:57,490 --> 00:02:03,669
apologize so anyways abt has this just
huge thing behind it right now in the

21
00:02:03,670 --> 00:02:08,539
media so if you google apt that's what
you get like Google Image Search you

22
00:02:08,539 --> 00:02:14,690
will actually get this imagery btw so
ABC is apparently ninjas in the in the

23
00:02:14,690 --> 00:02:20,370
kids dealing the credit cards according
to images on Google but what really

24
00:02:20,370 --> 00:02:25,140
happened was some guy out there at some
point rhoda regex that looks something

25
00:02:25,140 --> 00:02:28,500
like this and basically this is just a
Reg acts for

26
00:02:28,500 --> 00:02:31,630
going in finding credit card numbers and
I'm sure you've all heard about like

27
00:02:31,630 --> 00:02:35,790
Target and Home Depot this is like the
kind of regex that sitting in a piece of

28
00:02:35,790 --> 00:02:41,019
malware and somebody wrote this and then
target and Home Depot went crazy in

29
00:02:41,020 --> 00:02:45,660
terms of the media and then all of a
sudden the media when leg guide the

30
00:02:45,660 --> 00:02:50,510
hackers out there basically like ninjas
writing to your ex's flying through the

31
00:02:50,510 --> 00:02:54,850
gaps in reading all the Matrix code so
that they can make terminator isn't take

32
00:02:54,850 --> 00:03:00,250
over the world that was just like the
explosion of things that happened

33
00:03:00,250 --> 00:03:04,260
because of like Target and Home Depot
and that's really what's going on out

34
00:03:04,260 --> 00:03:08,690
there like this is hugely exaggerated by
a lot of people that probably don't

35
00:03:08,690 --> 00:03:13,890
really know what's happening so this is
more what's actually happening out there

36
00:03:13,890 --> 00:03:17,899
this is probably more within abt group
looks like apparently they could

37
00:03:17,900 --> 00:03:25,290
shirtless sometimes as well anyways abt
has a lot of different skill sets so

38
00:03:25,290 --> 00:03:30,150
there's no just script kiddies out there
that are copying and pasting code and

39
00:03:30,150 --> 00:03:33,580
just using this code that they find
their small groups that are working

40
00:03:33,580 --> 00:03:37,340
together to achieve some goal and then
there's like government-backed units I'm

41
00:03:37,340 --> 00:03:40,739
sure everybody will read like mandiant
Capt one report and all of that kind of

42
00:03:40,739 --> 00:03:44,290
stuff so they're our nation states that
are technically ABT's there's a lot of

43
00:03:44,290 --> 00:03:49,000
different definitions for this so the
motivations vary some people are out

44
00:03:49,000 --> 00:03:51,600
there trying to get intellectual
property they're trying to steal it from

45
00:03:51,600 --> 00:03:56,510
companies there's some apt groups are
just doing recon they just need to find

46
00:03:56,510 --> 00:04:01,100
out like they're mole is or something
along those lines and sometimes it's

47
00:04:01,100 --> 00:04:05,530
tough like PCI fraud like Target and
Home Depot and their programmers very

48
00:04:05,530 --> 00:04:08,790
like I said summer just copying and
pasting code and probably don't actually

49
00:04:08,790 --> 00:04:13,250
know how to code some of them are
writing packed kernel drivers that there

50
00:04:13,250 --> 00:04:16,560
are people that all the way on both ends
of the spectrum in terms of good

51
00:04:16,560 --> 00:04:22,790
programmer so I just want to emphasize
that sometimes apt looks like this and

52
00:04:22,790 --> 00:04:28,030
sometimes abt looks like this and
according to movies sometimes abt looks

53
00:04:28,030 --> 00:04:33,390
like this now too so so maybe what we
need to do is rather than calling it an

54
00:04:33,390 --> 00:04:36,849
advanced persistent threat maybe we
switch it off and say let's call it

55
00:04:36,849 --> 00:04:40,820
persistent threat actors the advanced
part that's negotiable sometimes but

56
00:04:40,820 --> 00:04:42,020
this is just my luck

57
00:04:42,020 --> 00:04:46,990
around and we'll move on to story time
so let's have a little story every story

58
00:04:46,990 --> 00:04:53,389
the characters right so this is Fran
Fran works for the AP tease tease me

59
00:04:53,389 --> 00:04:57,940
know normal person doing her job she's
just like any doubt about their that's

60
00:04:57,940 --> 00:05:02,370
got a job in a boss and she's got
deadlines and her own list of things

61
00:05:02,370 --> 00:05:06,370
she's worried about so just a normal def
out there but you know she works for the

62
00:05:06,370 --> 00:05:13,539
apt is basically so this is barb wire
the reverse engineer who works for like

63
00:05:13,539 --> 00:05:16,520
an IR company and she does reverse
engineering for them you know when power

64
00:05:16,520 --> 00:05:20,500
comes in she's the one that actually
reverses it and then this is Taylor

65
00:05:20,500 --> 00:05:27,110
Taylor is Franz boss and Taylor in you
know kind of a dick sometimes it comes

66
00:05:27,110 --> 00:05:31,729
down on friends like we need to do stuff
now getting things done so just you know

67
00:05:31,729 --> 00:05:37,780
your everyday people so frank it's a
call one morning and it's Taylor and

68
00:05:37,780 --> 00:05:44,539
Taylor is pissed like we need to be in
this construction company so fast please

69
00:05:44,539 --> 00:05:48,229
like we need to have all the things in
there and we need to drop on the back

70
00:05:48,229 --> 00:05:53,740
doors and we need to steal all of their
IP like yesterday and friends like ok

71
00:05:53,740 --> 00:05:58,370
all right let me think about this she
sits down and starts working in like

72
00:05:58,370 --> 00:06:02,039
going through ok how can how can we
accomplish this and you know she's got

73
00:06:02,039 --> 00:06:06,090
her own things that she's worried about
like her kid that she's trying to feed

74
00:06:06,090 --> 00:06:10,960
her family that has lots of pillow fight
aids like that both that she wants to

75
00:06:10,960 --> 00:06:14,318
own eventually so you know she's just a
normal day of working two jobs so that

76
00:06:14,319 --> 00:06:18,509
they can she can make him make some
money so she works through all of this

77
00:06:18,509 --> 00:06:24,900
stuff and finally she's like ok what I'm
gonna do is there's a public pool and

78
00:06:24,900 --> 00:06:29,239
use it it's a back door it's a rat I can
just drop us in there and I can reuse

79
00:06:29,240 --> 00:06:32,330
what they've already created for me so I
don't have to reinvent the wheel and she

80
00:06:32,330 --> 00:06:35,599
does this picture like a day because
somebody's already done all the work for

81
00:06:35,599 --> 00:06:41,219
and she liked yes got it she takes it
she sticks it into a PDF to look

82
00:06:41,219 --> 00:06:48,130
something like this not an exaggeration
that scene PDF said look like this and

83
00:06:48,130 --> 00:06:53,770
she's like gas near there I'm really
good at my job they deploy a few it out

84
00:06:53,770 --> 00:06:55,430
of the you know service

85
00:06:55,430 --> 00:07:01,740
this construction company and yes so
that job done however construction

86
00:07:01,740 --> 00:07:05,140
company get the notification from the
FBI or something like that like a

87
00:07:05,140 --> 00:07:10,090
something fishy is happening here you
need to check this out and they have a

88
00:07:10,090 --> 00:07:13,530
crappy internal team or they don't know
how to handle it so they hired Bartz

89
00:07:13,530 --> 00:07:18,770
company this is pretty common so far
this year she gets handed this piece an

90
00:07:18,770 --> 00:07:22,340
hour after they do a little
investigating and they find it and so

91
00:07:22,340 --> 00:07:28,390
she has your morning coffee and she gets
to work actually starts reversing this

92
00:07:28,390 --> 00:07:32,580
piece in our SEC things that were
immediately jump out or the stuff that

93
00:07:32,580 --> 00:07:37,250
leg is really obvious and she's seen
before like there is some very very

94
00:07:37,250 --> 00:07:42,500
obvious artifacts that are left behind
by this toolset called poison ivy is

95
00:07:42,500 --> 00:07:47,650
that fran has decided to use she's like
oh I know this and she writes something

96
00:07:47,650 --> 00:07:53,859
in software that looks terrible like
this and put together an IOC and deploys

97
00:07:53,860 --> 00:07:55,120
it and like all right

98
00:07:55,120 --> 00:07:59,610
done now that it gets deployed they
sleep they get friends they get for an

99
00:07:59,610 --> 00:08:05,570
and Taylor knocked out there like a wish
list obviously you know this is what

100
00:08:05,570 --> 00:08:09,690
they need they need the IP from this
place she comes down on friend like come

101
00:08:09,690 --> 00:08:13,050
on we need to get in there you keep
messin up do this

102
00:08:13,050 --> 00:08:17,260
friends like I am sorry but I think
really hard and I'll come up with

103
00:08:17,260 --> 00:08:20,500
something better so she starts writing
something better she's like maybe I

104
00:08:20,500 --> 00:08:24,500
should have used poison ivy maybe I
should put something together myself so

105
00:08:24,500 --> 00:08:29,150
she actually start spreading malware and
he gets back to Barb and bar starts

106
00:08:29,150 --> 00:08:35,970
reversing it and this is what she sees
she runs an interview and it prints out

107
00:08:35,970 --> 00:08:42,030
its own usage for her part says law
thanks for telling me exactly what your

108
00:08:42,030 --> 00:08:46,810
power does that was really nice of you
and they do the exact same thing written

109
00:08:46,810 --> 00:08:52,839
ISC do whatever they need to push it out
and get friend and Taylor knocked out

110
00:08:52,840 --> 00:08:55,230
again the Taylors best again

111
00:08:55,230 --> 00:09:00,820
keeps happening with Fran can't rely and
France scared you know she has a kid in

112
00:09:00,820 --> 00:09:03,740
a boat and all of these things that
she's worried about what she's like

113
00:09:03,740 --> 00:09:06,310
alright I can do better housing better

114
00:09:06,310 --> 00:09:10,880
and she starts working again and it gets
back to our began then this is what

115
00:09:10,880 --> 00:09:17,150
biopsies from our drops this text file
so what their hours doing friend is left

116
00:09:17,150 --> 00:09:22,470
all of her debugging inside of her mouth
where so every time it runs it says OK

117
00:09:22,470 --> 00:09:26,839
at this point I need this text file so
like when it was crashing when I was

118
00:09:26,839 --> 00:09:32,010
writing it I need to know exactly what
happened so she's left all of that in

119
00:09:32,010 --> 00:09:35,710
there and it basically says tell gives
like it kind of like a small little

120
00:09:35,710 --> 00:09:39,170
thing for you to read of exactly what
this mauer is doing isn't working

121
00:09:39,170 --> 00:09:44,410
through so she's basically just
commented everything 44 barb again so

122
00:09:44,410 --> 00:09:46,209
barnes' laws like this is great

123
00:09:46,210 --> 00:09:49,940
her job is really easy right now because
France kind of doing all the work for a

124
00:09:49,940 --> 00:09:55,320
year and they do the same thing she also
see something pretty awesome in here so

125
00:09:55,320 --> 00:10:02,760
she see see two communication link to
the Franz server however they would

126
00:10:02,760 --> 00:10:06,450
friend is doing issues encrypting the CT
communication and then she's compressing

127
00:10:06,450 --> 00:10:09,340
it anybody see a problem with that

128
00:10:09,340 --> 00:10:14,830
so if you take your seat in
communication and you encrypt it it

129
00:10:14,830 --> 00:10:19,180
becomes really high entropy so it's just
a very randomized looking compression

130
00:10:19,180 --> 00:10:22,829
algorithms look for patterns and that's
what they rely on so when you have

131
00:10:22,830 --> 00:10:26,680
really high entropy data compression
will do nothing so far and obviously

132
00:10:26,680 --> 00:10:30,729
doesn't know what she's doing with us so
far goes out for a drink as she's done

133
00:10:30,730 --> 00:10:32,210
her job for the day

134
00:10:32,210 --> 00:10:35,710
yes nailed it goes out with the
coworkers that apparently work on mars

135
00:10:35,710 --> 00:10:40,330
and yes so far as having a great day

136
00:10:40,330 --> 00:10:46,570
taylor's past again just yelling at bar
nonstop are scared doesn't want to do

137
00:10:46,570 --> 00:10:51,710
which is like ok friend scared doesn't
know what to do

138
00:10:51,710 --> 00:10:56,600
alright I can do this I'm actually write
some really good now and she really like

139
00:10:56,600 --> 00:10:59,990
crack sounds like alright I'm gonna do
something good now gets back to Barb and

140
00:10:59,990 --> 00:11:04,330
this is what drives these friends gone
through and deleted all of her debugging

141
00:11:04,330 --> 00:11:08,170
strings well she hasn't really deleted
and she's taken the printer function

142
00:11:08,170 --> 00:11:12,640
that she had been there before and she's
just know that out so it's not actually

143
00:11:12,640 --> 00:11:17,160
printing now but what it is doing is it
still commenting and keeping all of

144
00:11:17,160 --> 00:11:21,000
those strings inside the binary so when
bart goes through and reverses it she

145
00:11:21,000 --> 00:11:24,950
just seems like a fully commented binary
it's kind of just been marked up for

146
00:11:24,950 --> 00:11:29,120
ready and nice and pretty so she once
again doesn't have to do any work says

147
00:11:29,120 --> 00:11:34,190
low again this is great for her and her
boss high fives or because her bosses to

148
00:11:34,190 --> 00:11:37,730
an awesome likely to go on all these you
taken like minutes to handle all this

149
00:11:37,730 --> 00:11:43,210
stuff and she goes out for a beer
however on the other side of things

150
00:11:43,210 --> 00:11:49,840
Taylor is really upset now this is this
is really getting bad yeah I know I know

151
00:11:49,840 --> 00:11:55,660
Taylor subset brands like terrified she
thinks she's gonna lose her job but she

152
00:11:55,660 --> 00:12:01,160
she starts thinking she's like ok I got
this I know I have some clever ideas I'm

153
00:12:01,160 --> 00:12:04,520
gonna implement them it will take some
time but I actually do it so she put

154
00:12:04,520 --> 00:12:08,819
together something she feels really good
about it and they deployed again so far

155
00:12:08,820 --> 00:12:15,080
get that what she sees this he sees a
connection string that looks something

156
00:12:15,080 --> 00:12:21,370
like this and there's a tiny little fly
and what brand is done here she's missed

157
00:12:21,370 --> 00:12:22,160
a space

158
00:12:22,160 --> 00:12:26,560
rather than just copy and pasting and
user agent string to make it look like

159
00:12:26,560 --> 00:12:30,670
its Firefox she left out of space and
because of that you can rate the

160
00:12:30,670 --> 00:12:34,229
network's signature for it because
Firefox isn't always gonna have that

161
00:12:34,230 --> 00:12:40,800
space and this is not so immediately
there's a giant flawed it tailors Madden

162
00:12:40,800 --> 00:12:46,979
like not going well ran scared once
against keeps going and she sits down

163
00:12:46,980 --> 00:12:50,379
she thinks about it she put something
better together this is where friend

164
00:12:50,379 --> 00:12:53,939
actually gets kind of clever so what she
does is she starts looking through she

165
00:12:53,939 --> 00:12:58,040
make sure our look through the rest the
Windows registry and it walks through

166
00:12:58,040 --> 00:13:02,819
and it's ok look through here and find
out what browsers installed and then

167
00:13:02,819 --> 00:13:07,360
have all of the browser user agent
strings inside of the malware and drop

168
00:13:07,360 --> 00:13:10,860
the correction one every time so now
she's actually using the exact correct

169
00:13:10,860 --> 00:13:16,089
user agent string no matter what version
of Firefox Chrome and she's injecting

170
00:13:16,089 --> 00:13:20,560
into that so great like pretty solid now
we're doing some clever things to hide

171
00:13:20,560 --> 00:13:21,619
itself

172
00:13:21,620 --> 00:13:27,920
however friends made some mistakes so
friend is actually broken her ability to

173
00:13:27,920 --> 00:13:32,860
change the CPU configuration so anytime
she tries to change the c2 configuration

174
00:13:32,860 --> 00:13:37,839
this now is just gonna break so that was
great art says low this is awesome for

175
00:13:37,839 --> 00:13:42,500
her just silliness that you can put on
her leg malware wall of shame and then

176
00:13:42,500 --> 00:13:46,040
she looks a little closer if you see
something really ridiculous does anybody

177
00:13:46,040 --> 00:13:49,219
know the first rule of crypto

178
00:13:49,220 --> 00:14:01,000
they don't do it I disagree

179
00:14:01,000 --> 00:14:10,779
roll your own thing for them and that's
exactly what prints done friends

180
00:14:10,779 --> 00:14:15,730
actually confirmation her own crypto and
it's broken and under certain

181
00:14:15,730 --> 00:14:20,509
circumstances it's just gonna break and
not work so this is just making a

182
00:14:20,509 --> 00:14:25,209
bargain all of her co-workers have all
kinds of laughs then even better this is

183
00:14:25,209 --> 00:14:29,989
where it gets really bad friend is
actually taking her payload and she puts

184
00:14:29,990 --> 00:14:33,670
she takes like a nice but now I'm
looking binary she's just getting her

185
00:14:33,670 --> 00:14:37,699
payload on at the end of it and then
that benign looking binary is going to

186
00:14:37,699 --> 00:14:42,750
say okay look through all the open file
handles find me the one that is the size

187
00:14:42,750 --> 00:14:47,410
of this file because she knows the size
she created it looks for that open file

188
00:14:47,410 --> 00:14:49,870
handle and then she goes beyond the PE

189
00:14:49,870 --> 00:14:54,889
the actual PE file to what counted on to
the end and then she says okay that's

190
00:14:54,889 --> 00:14:59,279
where my stuff is decode that and that's
where we actually want to execute that's

191
00:14:59,279 --> 00:15:03,519
evil stuff that's the good stuff so I
put that all together and works

192
00:15:03,519 --> 00:15:08,990
perfectly but she does it against her
first domain which is evil that calm

193
00:15:08,990 --> 00:15:15,259
then when she deploys she changes that
two super evil dot com and forgets to

194
00:15:15,259 --> 00:15:19,579
change the size of the file that she's
looking for that's now changed by five

195
00:15:19,579 --> 00:15:31,410
bites because it's super evil that guy
doing so

196
00:15:31,410 --> 00:15:36,379
what's happened because of this is how
every time that file runs its gonna be

197
00:15:36,379 --> 00:15:41,459
looking for the exact file size of the
old file rather than the new file size

198
00:15:41,459 --> 00:15:45,399
and it's literally never going to find
it it's actually just gonna run and do

199
00:15:45,399 --> 00:15:49,709
nothing after they deploy it so not only
do they not have to knock them out again

200
00:15:49,709 --> 00:15:54,969
this stuff is just not working now so
this is great part is laughing this is

201
00:15:54,970 --> 00:16:00,040
austin taylor is really upset leg just
over and over and over again friends let

202
00:16:00,040 --> 00:16:06,149
her down and friends like I don't know
what to do and she ends up having to

203
00:16:06,149 --> 00:16:12,300
move and that's the end for her lose her
job and goes like ass nailed it did my

204
00:16:12,300 --> 00:16:16,310
job really well so she goes and has a
party with all of her friends I don't

205
00:16:16,310 --> 00:16:32,300
have an elegant enter this story so I'll
take a small bow and a drink if it's

206
00:16:32,300 --> 00:16:41,359
worse I don't have a daughter so great
little side story of my girlfriend

207
00:16:41,360 --> 00:16:45,930
here's me laughing really loud all the
way across my apartment comes running in

208
00:16:45,930 --> 00:16:51,439
the hell is so funny and she finds me on
the ground of my office jiggling and

209
00:16:51,439 --> 00:16:57,500
playing with Barbies and she literally
got concerned thought I was insane but

210
00:16:57,500 --> 00:17:05,859
also first time ever gone to expense
barbies that was gonna

211
00:17:05,859 --> 00:17:14,260
the next time we'll have another story
anyways next i wanna talk about some of

212
00:17:14,260 --> 00:17:17,250
the better you know pieces of APT Mauer
that are out there you know there are

213
00:17:17,250 --> 00:17:21,449
groups that are doing really cool things
and writing clever Mauer so let's talk a

214
00:17:21,449 --> 00:17:22,700
little bit about those

215
00:17:22,700 --> 00:17:28,680
a sample that actually implemented an
entire shell inside of the sample so

216
00:17:28,680 --> 00:17:32,370
most of the time when you're writing a
piece of malware Johanns who knows what

217
00:17:32,370 --> 00:17:39,590
a reverse shell is good so most of the
time all you do is say alright take this

218
00:17:39,590 --> 00:17:44,240
command if you get this command start up
a reverse shell and then you can take

219
00:17:44,240 --> 00:17:48,190
any commander you could run into them
during normal command prompt so you can

220
00:17:48,190 --> 00:17:52,330
do you know look at network information
that way you can run now you can do all

221
00:17:52,330 --> 00:17:56,129
these different things that way rather
than having to implement them yourself

222
00:17:56,130 --> 00:18:00,060
this one they it was an interesting
engineering task I mean they had

223
00:18:00,060 --> 00:18:06,080
implemented every single Lake CD like
cat was implemented inside of this all

224
00:18:06,080 --> 00:18:08,679
of these different things were
implemented as commands that the CT

225
00:18:08,680 --> 00:18:12,690
would give it to is really impressive as
an engineering feat I remember writing a

226
00:18:12,690 --> 00:18:17,050
shell in operating systems class and it
was a pain so like putting that all

227
00:18:17,050 --> 00:18:21,419
together into an obvious created and
malware yeah sounds even worse but they

228
00:18:21,420 --> 00:18:25,220
had done it was pretty awesome so that
was nice I don't know what the point of

229
00:18:25,220 --> 00:18:29,110
it is I would probably right that twenty
lines it takes to greater of her shell

230
00:18:29,110 --> 00:18:33,850
rather than doing that but it was kinda
cool I saw piece of hybrid actually a

231
00:18:33,850 --> 00:18:36,929
coworker saw this it was a piece of
hybrid now where we're what he was doing

232
00:18:36,930 --> 00:18:40,640
was it was checking segment registers
and that it looked like it had jumbled

233
00:18:40,640 --> 00:18:44,250
code like that it was jumping too
jumbled code that would not actually

234
00:18:44,250 --> 00:18:48,860
executed we crash but what it was doing
was it was checking which architecture

235
00:18:48,860 --> 00:18:54,709
the power was running in and then it had
to show code payloads one was 32 bit or

236
00:18:54,710 --> 00:18:59,060
64 bit it was jumping to the one that
actually fit the architecture that was

237
00:18:59,060 --> 00:19:02,280
kinda cool because it's a lot of work to
rate shellcode on its own writing it in

238
00:19:02,280 --> 00:19:03,690
two different architectures

239
00:19:03,690 --> 00:19:06,330
pretty often

240
00:19:06,330 --> 00:19:11,100
this is one that I really likes this is
a piece of financial power basically

241
00:19:11,100 --> 00:19:16,019
just look like tons and tons of benign
code look completely legitimate really

242
00:19:16,019 --> 00:19:19,470
hard to see anything bad there but we
had a lead telling us you know this is

243
00:19:19,470 --> 00:19:24,490
now where we're pretty damn sure and
what it actually was was it was building

244
00:19:24,490 --> 00:19:28,419
a bytecode buffer as it was executing
all of this random but nine stuff didn't

245
00:19:28,419 --> 00:19:34,340
really do anything and all that vital
buffer did was D obfuscated itself at a

246
00:19:34,340 --> 00:19:37,908
bunch of levels of encoding and then it
would execute just a download and

247
00:19:37,909 --> 00:19:41,769
execute scripts it was just downloading
something else however without actually

248
00:19:41,769 --> 00:19:45,210
pulling down what was downloading I
couldn't get I didn't know the actual

249
00:19:45,210 --> 00:19:48,649
functionality of our so that was pretty
nice in there

250
00:19:48,649 --> 00:19:53,408
situ is down by the time we got we got
this so I still have no idea what them

251
00:19:53,409 --> 00:19:59,480
our actually did so that was a nice
piece by only one of my favorite things

252
00:19:59,480 --> 00:20:04,210
is malware that our offer is that will
write code to right now we're for them

253
00:20:04,210 --> 00:20:08,769
if you write something if you have like
a clever idea that you want to implement

254
00:20:08,769 --> 00:20:12,279
you should write something that writes
it for you if it's really difficult to

255
00:20:12,279 --> 00:20:14,980
write on your own so if you want
something that's randomized and

256
00:20:14,980 --> 00:20:19,340
difficult to work through you can do
that and I ran into this recently so

257
00:20:19,340 --> 00:20:22,699
what I saw as I said I started reversing
sample there are no strings in the

258
00:20:22,700 --> 00:20:27,710
sample and as I like debug it a little
bit I found that there were strings but

259
00:20:27,710 --> 00:20:32,190
they were all encoded with this big
encoder and this is the this is the

260
00:20:32,190 --> 00:20:36,850
function Grapher this encoder and it was
disgusting and you don't actually see

261
00:20:36,850 --> 00:20:41,559
that there's calls in there as well so
it's not it's more than just that so if

262
00:20:41,559 --> 00:20:47,049
anybody is done any reversing the this
is the output from x-rays for this it's

263
00:20:47,049 --> 00:20:53,940
all just math random ass that made no
sense like adds subtracts explores I'm

264
00:20:53,940 --> 00:20:57,120
doing Bittman if you single
manipulations all kinds of random stuff

265
00:20:57,120 --> 00:21:00,268
in there if you were to actually
physically write this and write

266
00:21:00,269 --> 00:21:05,350
something that could encoded and decoded
that would take a lot of time manually

267
00:21:05,350 --> 00:21:08,779
so I'm what I'm pretty sure happens here
and I i dont have supporting evidence

268
00:21:08,779 --> 00:21:13,130
yet but I think they basically wrote
something to write an hour for them so

269
00:21:13,130 --> 00:21:16,929
they wrote something and said okay right
a mass function that's really hard and

270
00:21:16,929 --> 00:21:18,780
complex and as a bunch

271
00:21:18,780 --> 00:21:22,960
relations and then write me one that
decodes that is well and now I can just

272
00:21:22,960 --> 00:21:25,930
use that for my communications and
almost rings and everything like that

273
00:21:25,930 --> 00:21:30,950
and does all the work for you so that we
saw this in there and then in addition I

274
00:21:30,950 --> 00:21:34,810
could get it to beacon I can get this
power to actually reach out and so what

275
00:21:34,810 --> 00:21:40,669
I did was I found the command loop and I
work backwards from it and saw ok this

276
00:21:40,670 --> 00:21:43,890
is where it's going and this is how it
gets to the command loop and then I ran

277
00:21:43,890 --> 00:21:48,970
into this so there is a function that
basically said alright generate a random

278
00:21:48,970 --> 00:21:55,810
number and whatever that number is OK
jet if it's you know one sleep for a

279
00:21:55,810 --> 00:22:00,370
little bit to create some threads wait
for them to complete in those threads

280
00:22:00,370 --> 00:22:04,250
are gonna go do some random other crap
do some math functions that take a while

281
00:22:04,250 --> 00:22:09,130
or other stuff and so it it would
generate a random number and it would do

282
00:22:09,130 --> 00:22:13,380
is basically a state machine it was
moving through and based on that random

283
00:22:13,380 --> 00:22:17,430
number would move to the next level if
it hitler in this case it hit three its

284
00:22:17,430 --> 00:22:22,060
gonna go to the next level which then
had another level and another level and

285
00:22:22,060 --> 00:22:26,649
another by the power of math they
eventually would execute their command

286
00:22:26,650 --> 00:22:31,720
lou but the odds of executing in a
timely fashion if you run it

287
00:22:31,720 --> 00:22:37,760
ones are basically impossible it will it
will take forever just because it's

288
00:22:37,760 --> 00:22:41,950
doing all kinds of clever sleep things
in order to avoid you going through this

289
00:22:41,950 --> 00:22:46,300
and you act in order to get this I had
to actually force it down all the right

290
00:22:46,300 --> 00:22:51,399
code paths and like this is a gross
underestimation of the number of code

291
00:22:51,400 --> 00:22:55,660
passive they're created it was a
disgusting huge state machine and once

292
00:22:55,660 --> 00:22:58,320
again I'm pretty sure that they
programmatically generated this they

293
00:22:58,320 --> 00:23:02,250
wrote something that road this seat code
for them that we just make this

294
00:23:02,250 --> 00:23:05,860
disgusting state machine that it would
hopefully it would eventually get

295
00:23:05,860 --> 00:23:09,699
through no telling when but it will
eventually take a command from the c2 so

296
00:23:09,700 --> 00:23:13,510
really interesting and require real pain
if you actually want to run it and get

297
00:23:13,510 --> 00:23:19,170
some traffickers that so that was pretty
impressive we're actually read working

298
00:23:19,170 --> 00:23:22,710
on a blog post this is my shame
shameless plug this is an apt 3 back

299
00:23:22,710 --> 00:23:26,500
door I was just describing and I'm
working on this with rubber falcone and

300
00:23:26,500 --> 00:23:28,960
it'll be out a week or so

301
00:23:28,960 --> 00:23:33,029
and finally the last time but i wanna
talk about was this the service that was

302
00:23:33,029 --> 00:23:38,480
installed on on point of sale systems so
it was a sieve it was even looking

303
00:23:38,480 --> 00:23:42,529
service it had a random file name and
what it did was it was a packed kernel

304
00:23:42,529 --> 00:23:48,809
driver so when it ran it would run
unpack itself and then inject into

305
00:23:48,809 --> 00:23:52,840
userland processes so it would inject
shellcode into these usual and processes

306
00:23:52,840 --> 00:23:57,629
and that on purpose it would actually
crash so when you go and you look at

307
00:23:57,630 --> 00:24:01,610
this computer you don't see that service
running anymore it's not actually still

308
00:24:01,610 --> 00:24:06,120
running all you have is these infected
usual and processes that are doing the

309
00:24:06,120 --> 00:24:10,330
militias work for that it was really
impressive because anybody's reversed

310
00:24:10,330 --> 00:24:15,240
kernel level stuff is a pain and packing
in kernel level stuff is even worse so

311
00:24:15,240 --> 00:24:21,029
it's a real pain to reverse this show is
a nice really nice piece of our however

312
00:24:21,029 --> 00:24:26,679
it was hidden on the system as a seven
character string of random 7 character

313
00:24:26,679 --> 00:24:33,100
string . sis file that was unsigned
she's great most drivers most people are

314
00:24:33,100 --> 00:24:36,090
a kernel drivers sign their stuff
because it takes a lot of work and they

315
00:24:36,090 --> 00:24:41,490
sign them like I said the file name was
a random character string the service

316
00:24:41,490 --> 00:24:46,179
name was not random character string and
then the service description was

317
00:24:46,179 --> 00:24:51,820
Microsoft the character string and
support I don't know about all companies

318
00:24:51,820 --> 00:24:58,080
but Microsoft signs most of their crap
almost everything so all of that stuck

319
00:24:58,080 --> 00:25:02,350
out really bad so we weren't really sure
if they were trolling with this or just

320
00:25:02,350 --> 00:25:06,029
kinda and then finally what they were
really doing at the end of this was

321
00:25:06,029 --> 00:25:11,070
rapping a.net string copy function and
then read Jackson that credit card

322
00:25:11,070 --> 00:25:15,668
numbers so all of this work all this
packs kernel driver that seriously would

323
00:25:15,669 --> 00:25:20,590
have been hundreds of man hours worth of
work this is their end goal is just reg

324
00:25:20,590 --> 00:25:27,970
Xing a.net binary for your credit card
numbers however dotnet is really easy to

325
00:25:27,970 --> 00:25:31,990
decompile you can decompile it and
recompile it with almost no effort most

326
00:25:31,990 --> 00:25:36,320
of the time so you can either have an
unsigned kernel driver that looks from

327
00:25:36,320 --> 00:25:40,740
really suspicious or you can just read
compile this mine area at this point it

328
00:25:40,740 --> 00:25:41,860
was kind of the disease

329
00:25:41,860 --> 00:25:45,469
one of them our team I was working with
it these are basically dog scientists

330
00:25:45,470 --> 00:25:51,230
have no idea what they're doing so
anyways let's talk a little bit about

331
00:25:51,230 --> 00:25:55,740
you know some of the ways that you can
write better malware because these are

332
00:25:55,740 --> 00:26:00,000
there some simple things that you can do
to make my life a little more miserable

333
00:26:00,000 --> 00:26:04,179
and then on top of that these are good
tips just for like if you have something

334
00:26:04,179 --> 00:26:07,120
that you're writing and you want to
protect it so that somebody can't

335
00:26:07,120 --> 00:26:11,520
reverse engineer it crack it did get
something out of it that you don't want

336
00:26:11,520 --> 00:26:16,280
them to get follow some of these things
because they will help you in blocking

337
00:26:16,280 --> 00:26:21,309
somebody from doing that so far east if
you're writing see just use if thats

338
00:26:21,309 --> 00:26:26,750
they're really easy to use and they do a
good job of stopping me from getting

339
00:26:26,750 --> 00:26:30,860
what I want like if the whole usage
thing that i described at the beginning

340
00:26:30,860 --> 00:26:35,439
of the story and all of the debugging
strings if you wrap them in if steps

341
00:26:35,440 --> 00:26:39,669
really easy to stop me from being able
to see them because I compile time when

342
00:26:39,669 --> 00:26:43,200
you actually compiled when you want to
release just switch the FDA and I won't

343
00:26:43,200 --> 00:26:49,400
see any of it so really simple next why
not just like putting a peak usage like

344
00:26:49,400 --> 00:26:53,500
put in something that says okay the
usages the same copy and pasted from

345
00:26:53,500 --> 00:26:57,900
like that that's a decent thing that
would probably trip me up a little bit

346
00:26:57,900 --> 00:27:02,559
for a second I mean it's just a little
thing that you can do that would change

347
00:27:02,559 --> 00:27:08,020
you know what somebody thought that
binary was next you can do stuff where

348
00:27:08,020 --> 00:27:09,879
you really messing with me less

349
00:27:09,880 --> 00:27:12,960
redeployment you can have all your
debugging strings in there but you can

350
00:27:12,960 --> 00:27:16,360
also put devalue strings it later that
are all for like when you're actually

351
00:27:16,360 --> 00:27:20,110
releasing it so they all look ridiculous
why not go for it

352
00:27:20,110 --> 00:27:25,530
next don't do stuff like this don't use
user agent strings that are like well

353
00:27:25,530 --> 00:27:30,970
and right now we're so my user agent
string is our 666 like that's a bad idea

354
00:27:30,970 --> 00:27:34,000
we're probably going to see it and
you're never gonna get through with it

355
00:27:34,000 --> 00:27:38,770
again so don't do that and look for this
kind of stuff so when you compile with

356
00:27:38,770 --> 00:27:43,139
Visual Studio you're going to have
projects strings in there if your

357
00:27:43,140 --> 00:27:48,799
project string is super awesome backdoor
oh my god yeah we're gonna probably see

358
00:27:48,799 --> 00:27:53,590
Harry well if you see that again
probably the same guy pretty easy

359
00:27:53,590 --> 00:27:56,760
next how many people know how excellent
works

360
00:27:56,760 --> 00:28:03,280
so just like an invertible math function
if you X or a with B let's see if you

361
00:28:03,280 --> 00:28:09,149
actually see with you then get a back
just reverses however it's a terrible

362
00:28:09,150 --> 00:28:14,650
way to hide information of basic text or
like this is really really terrible for

363
00:28:14,650 --> 00:28:19,200
hiding information and I have a proof of
concept of this I mean people know what

364
00:28:19,200 --> 00:28:26,890
a threat but is this is a threat but if
you take a threat but and you explore it

365
00:28:26,890 --> 00:28:32,830
with yellow red you still get a threat
but it's still there so stop exporting

366
00:28:32,830 --> 00:28:36,520
yourself there's better ways to hide
your information

367
00:28:36,520 --> 00:28:40,860
next like you can there's easy things
that you can use out there you can use

368
00:28:40,860 --> 00:28:44,959
mainstream crypto it works really well
it does the job it's a little bit more

369
00:28:44,960 --> 00:28:49,700
detectable because mainstream crypto
uses vary detectable patterns in terms

370
00:28:49,700 --> 00:28:54,180
of like ass boxes and all of the the
structure is that it uses but it's still

371
00:28:54,180 --> 00:28:55,810
better than you know

372
00:28:55,810 --> 00:28:59,600
single bite actually wearing all of your
stuff and thinking you're secure or

373
00:28:59,600 --> 00:29:03,459
write custom encoding so write something
like I was describing that program that

374
00:29:03,460 --> 00:29:07,710
generated a custom encoding and decoding
that's great that's really tough to

375
00:29:07,710 --> 00:29:14,020
reversing write something that will take
care of that encoding so doing something

376
00:29:14,020 --> 00:29:19,180
not too hard and really worth your while
if you're trying to protect your data

377
00:29:19,180 --> 00:29:23,050
next use Packers that are out there if
you've ever used them I don't wear them

378
00:29:23,050 --> 00:29:28,180
protect they are both terrible to
reverse these both actually create a

379
00:29:28,180 --> 00:29:33,550
single process virtual machine that in
turn like that changes the bike codes

380
00:29:33,550 --> 00:29:37,540
that are in the binary and then at
runtime interprets those new byte codes

381
00:29:37,540 --> 00:29:42,220
that are an x86 anymore and turns them
back in the x86 it's a huge pain to

382
00:29:42,220 --> 00:29:45,260
reverse this because it's going back and
forth from the interpreter the whole

383
00:29:45,260 --> 00:29:49,990
time really painful to work with so that
in like I said he's mainstream crypto

384
00:29:49,990 --> 00:29:53,410
don't write your own crypto bad ideas

385
00:29:53,410 --> 00:30:01,050
next don't you see in C sharp C if you
go into reverse it it's a compiled

386
00:30:01,050 --> 00:30:06,010
really cleanly and it will decompile
really easily with x-rays most of the

387
00:30:06,010 --> 00:30:10,080
time it's really easy to reverse
especially if you know she doesn't have

388
00:30:10,080 --> 00:30:13,549
have you know all of the object oriented
stuff that make it difficult to reverse

389
00:30:13,549 --> 00:30:19,918
like C++ so so stop using C C sharp is
even worse it actually pretty much

390
00:30:19,919 --> 00:30:24,039
inherently decompile so you can throw it
into reflector I'll spying you just get

391
00:30:24,039 --> 00:30:28,980
source code back so it's really easy to
reverse I mean we we all can read source

392
00:30:28,980 --> 00:30:32,809
code if we can reverse engineer so stop
doing that you stuff like this

393
00:30:32,809 --> 00:30:37,960
use Delfi Delphia sold in terrible and
really painful the reverse if you want

394
00:30:37,960 --> 00:30:41,860
to write something that you want to
protect put it in Delft because nobody

395
00:30:41,860 --> 00:30:47,799
will want to touch it it's like the
plague versus we all hated C++ with like

396
00:30:47,799 --> 00:30:51,769
object oriented stuff start passing
around function pointers and doing all

397
00:30:51,769 --> 00:30:55,299
that everything goes to jump tables and
we have to write a bunch of structures

398
00:30:55,299 --> 00:30:59,690
and it's a big and that's it's a great
way to protect your stuff

399
00:30:59,690 --> 00:31:04,450
and then go lang has anybody written any
stuffing going ice cream filling is

400
00:31:04,450 --> 00:31:08,299
great it puts all kinds of interesting
stuff in there that make it really

401
00:31:08,299 --> 00:31:13,039
complicated to reverse it compiles to
native but it doesn't look anything like

402
00:31:13,039 --> 00:31:18,240
Watseka miles to does all kinds of other
stuff so it's a really great one does

403
00:31:18,240 --> 00:31:24,289
it'll throw us a curve ball next like
obviously encoder encryptor day like

404
00:31:24,289 --> 00:31:29,820
hide your communications so if I C word
tells pewter Windows 7 I'm like oh well

405
00:31:29,820 --> 00:31:35,460
it's telling you know its commanding
internal server specs are you know if

406
00:31:35,460 --> 00:31:38,710
you if I see a string that doesn't have
that in and it's going to be a little

407
00:31:38,710 --> 00:31:43,269
less obvious until I actually get that
decoded and then use some interesting

408
00:31:43,269 --> 00:31:47,899
ones like used Twitter or WordPress for
your cops don't have a c2 server make

409
00:31:47,899 --> 00:31:51,889
all of these public companies do the
work for you that's totally a

410
00:31:51,889 --> 00:31:54,580
possibility and some of the other
malware that i've seen

411
00:31:54,580 --> 00:31:58,860
do some stuff like this where you go
through Google calendars or Yahoo stuff

412
00:31:58,860 --> 00:31:59,870
like that

413
00:31:59,870 --> 00:32:05,040
so I'm finally just be a little more
credit more clever use multiple network

414
00:32:05,040 --> 00:32:09,230
protocols there's nothing that says that
you can't every time just switch and

415
00:32:09,230 --> 00:32:13,650
have your seat to checking on multiple
protocols while you're doing the same

416
00:32:13,650 --> 00:32:18,650
thing at the client side nothing says
you can't do that and use dynamic dns

417
00:32:18,650 --> 00:32:21,930
it's painful in most of the people that
are like most of the people that are

418
00:32:21,930 --> 00:32:26,780
using VGA is right now aren't doing that
good of a job of it so do that kind of

419
00:32:26,780 --> 00:32:31,470
stuff also troll a little hide in like
some similar code like put some stuff in

420
00:32:31,470 --> 00:32:34,880
there that doesn't make any sense with
compared to what you actually want to do

421
00:32:34,880 --> 00:32:39,340
because that's a really good way of
protecting your stuff and stopping so

422
00:32:39,340 --> 00:32:42,790
many music player from reversing

423
00:32:42,790 --> 00:32:48,450
yeah and then finally right modular
power like I was saying about that

424
00:32:48,450 --> 00:32:54,040
downloader if your browser and download
something from a seat you and that c2 is

425
00:32:54,040 --> 00:32:57,710
down by the time I actually get it I
don't know what really does it just

426
00:32:57,710 --> 00:33:01,130
download something and then executed I
really have no idea what it's actually

427
00:33:01,130 --> 00:33:06,800
do that kind of stuff or write a route
back to our roots are harder to reverse

428
00:33:06,800 --> 00:33:11,700
it harder to write I'll admit but they
are a lot harder to reverse or write up

429
00:33:11,700 --> 00:33:15,380
BIOS back door that communicates via
sound waves because apparently that's

430
00:33:15,380 --> 00:33:18,919
possible that so do that stuff

431
00:33:18,919 --> 00:33:23,129
and like I said earlier write code that
writes code it's a great way to do this

432
00:33:23,129 --> 00:33:27,238
I have a lot of the CTF challenges that
I write I really like writing Python

433
00:33:27,239 --> 00:33:30,539
that right seat for me because I like
writing pipeline that I don't like

434
00:33:30,539 --> 00:33:35,649
writing see that so I write a lot of
Python the does all the work for me it's

435
00:33:35,649 --> 00:33:41,879
great ways to do that and then finally
just being lazy coders is the thing like

436
00:33:41,879 --> 00:33:46,439
you can get a job done faster but if you
need to protect something you have to do

437
00:33:46,440 --> 00:33:49,269
a little bit of this this kind of work
in order to protect it because there are

438
00:33:49,269 --> 00:33:54,470
so many reversing tools out there and
there's so much stuff like this guy and

439
00:33:54,470 --> 00:33:58,690
is gonna write some lazy code and I'm
gonna be able to reverse it really

440
00:33:58,690 --> 00:34:02,169
easily so this is for malware or for
whatever you're writing that you need to

441
00:34:02,169 --> 00:34:07,129
protect so it's just important to take
some of this in mind and you may be

442
00:34:07,129 --> 00:34:09,129
wondering why am i right

443
00:34:09,129 --> 00:34:12,299
talking about this and saying like hey
here's how to write better malware and

444
00:34:12,299 --> 00:34:16,149
how to better protect yourself where in
the end it's not going to matter that

445
00:34:16,149 --> 00:34:20,440
much because at the on the other side of
things there's always a human in front

446
00:34:20,440 --> 00:34:24,200
of a computer that I double click the
PDF and this crap is just gonna keep

447
00:34:24,199 --> 00:34:28,408
happening at least for the foreseeable
future so this is just good advice for

448
00:34:28,409 --> 00:34:33,589
if you want to protect your things and
you may wonder if friends life was so

449
00:34:33,589 --> 00:34:37,770
hard and she went through so much you
know why would she want to be in the

450
00:34:37,770 --> 00:34:44,870
eighties and this is about the only
reason I can come up

451
00:34:44,870 --> 00:34:58,660
so that questions and I'm not above
bribery and we have too much beer so if

452
00:34:58,660 --> 00:35:03,960
you ask a question I have T-shirts
generously donated from Salesforce and

453
00:35:03,960 --> 00:35:08,350
beers generously donated from me but you
can have one of either of them if you

454
00:35:08,350 --> 00:35:10,819
ask a question

455
00:35:10,820 --> 00:35:20,660
they're called I promise it's hot here I
have not but I do keep hearing sounds

456
00:35:20,660 --> 00:35:34,790
that scare me happily I just don't own
one oh yeah if you have one on you all

457
00:35:34,790 --> 00:35:47,610
take it for my next ok that deserves the
beers you comin rabbit

458
00:35:47,610 --> 00:35:53,829
work a little harder forming

459
00:35:53,829 --> 00:36:20,349
I i'm looking for creativity if your
gonna pull out one guy gets a beer

460
00:36:20,349 --> 00:36:24,700
so when you say is an art or science can
you say what you mean by that exactly

461
00:36:24,700 --> 00:36:30,200
like is it are they really clever or is
it just that they're willing to do the

462
00:36:30,200 --> 00:36:37,249
hard work is that what you mean it's
it's kind of both I would say a big

463
00:36:37,249 --> 00:36:41,229
piece of it is willingness to do the
hard work like Britain's colonel

464
00:36:41,229 --> 00:36:45,109
software and it's a pain like it's a lot
harder but that's a hell of alot harder

465
00:36:45,109 --> 00:36:50,269
to detect Ancelotti like it it works
really well if you can do it and also if

466
00:36:50,269 --> 00:36:56,189
anybody seen it there's guys giving
talks on BIOS power now that not not the

467
00:36:56,190 --> 00:36:59,979
one that goes over the sound waves but
like actual by host now where that's

468
00:36:59,979 --> 00:37:04,328
really awesome and does some really
clever things like that's an even

469
00:37:04,329 --> 00:37:09,239
farther level down that's really painful
so those parts of it are like the hard

470
00:37:09,239 --> 00:37:13,950
engineering test but parts the other
part is what you were saying it's a

471
00:37:13,950 --> 00:37:18,058
little bit of art work and creativity
you have to have something behind you

472
00:37:18,059 --> 00:37:22,279
that's ok well if I want to mess with
somebody and I don't want them to be

473
00:37:22,279 --> 00:37:26,869
able to understand this how do I do it
and that parts less about like the

474
00:37:26,869 --> 00:37:31,599
capabilities and how you implement it
it's more about like how you're willing

475
00:37:31,599 --> 00:37:35,039
to how clever you can get with
manipulating bites and hiding stuff in

476
00:37:35,039 --> 00:37:39,010
places that it shouldn't be would say
that that's the art piece

477
00:37:39,010 --> 00:37:51,660
and you get a beer if you would like
your shirt

478
00:37:51,660 --> 00:37:58,950
well it depends on who you are obviously
if I am in the apt is I would reverse it

479
00:37:58,950 --> 00:38:03,529
and then I would reuse it for my own
nefarious purposes probably but if you

480
00:38:03,530 --> 00:38:06,430
know if you're talking about something
that works for an IR company they're

481
00:38:06,430 --> 00:38:10,308
going to reverse it find all of the
artifacts that it's going to drop of the

482
00:38:10,309 --> 00:38:13,740
network communications are going to look
for all of these things he was saying

483
00:38:13,740 --> 00:38:18,308
IOC's are indicators of compromises when
kind of threat until format that a lot

484
00:38:18,309 --> 00:38:21,809
of people use and they're just gonna
pull out that information and then

485
00:38:21,809 --> 00:38:24,720
they're going to use it to protect
themselves from that sample in the

486
00:38:24,720 --> 00:38:25,439
future

487
00:38:25,440 --> 00:38:28,880
obviously there's a little bit of
fuzziness because I clever malware

488
00:38:28,880 --> 00:38:32,849
authors going to rate things where he'll
be like ok well once in awhile just

489
00:38:32,849 --> 00:38:36,799
randomly communicate with Google and
then if you automatically generated IOC

490
00:38:36,799 --> 00:38:40,920
you just block Google for your whole
company like the stuff like that is a

491
00:38:40,920 --> 00:38:59,950
little more clever but that's what's
gonna be used

492
00:38:59,950 --> 00:39:06,259
by countries really difficult because
attribution is a really scary game and

493
00:39:06,260 --> 00:39:10,730
actually pulling it off is really
difficult but I can say that like the

494
00:39:10,730 --> 00:39:13,590
groups that are tracked that i've seen
that i've seen

495
00:39:13,590 --> 00:39:18,170
definitely I mean certain ones are much
more advanced and certain they all have

496
00:39:18,170 --> 00:39:23,430
their kind of think it's teepees
techniques tools and practices some of

497
00:39:23,430 --> 00:39:28,109
them will use for example there's one
abt group that loves Delfi I ate them

498
00:39:28,110 --> 00:39:33,070
they're terrible there's one apt group
that really loves web shells and they

499
00:39:33,070 --> 00:39:37,390
will pretty much do an entire attack
with almost entirely web shows they

500
00:39:37,390 --> 00:39:42,920
don't drop any actual power so they have
like different approaches and they have

501
00:39:42,920 --> 00:39:44,880
like I said different skill sets

502
00:39:44,880 --> 00:39:52,030
more recently we saw a sample bed with
actually when you do QA on a piece of

503
00:39:52,030 --> 00:39:56,120
software like in an actual software
engineering environment you actually

504
00:39:56,120 --> 00:40:00,880
kind of leave remnants that show that
you know there were other code paths and

505
00:40:00,880 --> 00:40:07,110
we've done some QA we fix things up here
and we actually saw back door that had

506
00:40:07,110 --> 00:40:11,410
all of the remnants of like this is it
there actually like doing the full QA

507
00:40:11,410 --> 00:40:15,759
process on this back door and on this
piece of software so they treating it

508
00:40:15,760 --> 00:40:20,420
like weird weird ever shop and we need
to follow the right practices of doing

509
00:40:20,420 --> 00:40:25,080
this correctly so it all depends on when
some of them are just like absolute crap

510
00:40:25,080 --> 00:40:30,540
in the ensuing really silly things like
I know that my story is very exaggerated

511
00:40:30,540 --> 00:40:35,120
slightly ridiculous and full of RVs but
every single one of those examples and

512
00:40:35,120 --> 00:40:39,839
stuff that I have seen in apt now it's
all stuff that happens regularly

513
00:40:39,840 --> 00:40:45,890
not not uncommonly the the debugging
strange kind of stuff all of that so

514
00:40:45,890 --> 00:40:49,180
comment and it just makes our lives
really easy

515
00:40:49,180 --> 00:40:55,330
the apt groups that are willing to clean
up after themselves are the ones that

516
00:40:55,330 --> 00:40:59,180
are a little scary like apt 3 that I
mention they do a good job of cleaning

517
00:40:59,180 --> 00:41:25,540
up so

518
00:41:25,540 --> 00:41:38,070
yeah yeah I've never dealt with us
moving cost had some coworkers get some

519
00:41:38,070 --> 00:41:41,420
of them come in because you know I work
for security companies so we get a

520
00:41:41,420 --> 00:41:47,010
dactyl most of the time it's like this
is lousy thing just try this again and

521
00:41:47,010 --> 00:41:51,340
didn't work but they gave us another
piece of malware so that was nice of

522
00:41:51,340 --> 00:41:55,920
them like nobody executed it but we have
it now so get in again that's for sure

523
00:41:55,920 --> 00:42:04,370
all of you guys and ask questions come
grab beers rapturous whatever you want

524
00:42:04,370 --> 00:42:13,980
sources so previously I was at mandiant
and doing my arm and then some of these

525
00:42:13,980 --> 00:42:18,830
examples where from investigations there
i think is like small pieces of code

526
00:42:18,830 --> 00:42:22,299
that the don't know anything about his
client was there anything like that

527
00:42:22,300 --> 00:42:26,430
without talking about that but most of
the time it's from investigations i I

528
00:42:26,430 --> 00:42:31,279
work at Palo Alto Networks to increasing
now and we have so many clients and so

529
00:42:31,280 --> 00:42:35,380
much data that we have we have I think
when I go through our like Big Data

530
00:42:35,380 --> 00:42:39,320
solutions and I'm searching through our
samples I'm looking at 400 million

531
00:42:39,320 --> 00:42:43,460
samples that I can like go and run
searches against sorry not in our

532
00:42:43,460 --> 00:42:49,150
samples that are going through of those
not all like 10 percent or hour and then

533
00:42:49,150 --> 00:42:53,010
I get into that's a lot of data that I
can go and sit through and play around

534
00:42:53,010 --> 00:42:58,510
with so the the last ones that I was
referred referring to the apt 3 so

535
00:42:58,510 --> 00:43:03,820
that's all from just a client happens to
have these and a CBE happened and we saw

536
00:43:03,820 --> 00:43:11,869
the attacks happened and now we're just
pulling out stuff so

537
00:43:11,869 --> 00:43:19,119
it depends I mean some of them I would
say you know sometimes there's like a

538
00:43:19,119 --> 00:43:22,809
managed defense group or like a certain
place that has blocked them but then we

539
00:43:22,809 --> 00:43:26,549
still get access to him so like they get
caught in quarantine but you know they

540
00:43:26,549 --> 00:43:29,450
can still go in for analysis and we can
still play around with them and have

541
00:43:29,450 --> 00:43:34,180
them so not all of them get through but
like a lot of the ones that come from an

542
00:43:34,180 --> 00:43:38,609
investigation are always going to be you
know post-mortem because like sometimes

543
00:43:38,609 --> 00:43:41,940
you you're doing an investigation and
there's been a group in there for seven

544
00:43:41,940 --> 00:43:44,690
years because nobody knows what they're
doing in the security for that team

545
00:43:44,690 --> 00:43:50,460
therefore that companies like you know
you get in there sometimes been there

546
00:43:50,460 --> 00:43:53,869
for a long time it's just regularly
beginning once in awhile until they get

547
00:43:53,869 --> 00:44:03,470
what they want

548
00:44:03,470 --> 00:44:11,209
it all depends on what you want out of
it so it depends on what you're doing if

549
00:44:11,210 --> 00:44:14,970
you doing like long-term research and
analysis that takes longer if you if you

550
00:44:14,970 --> 00:44:18,910
want to rate down all the capabilities
of this power and everything so like the

551
00:44:18,910 --> 00:44:22,779
blog post that i'm gonna be pushing out
I break down the whole command loop in

552
00:44:22,780 --> 00:44:26,760
every single command and what it does
and then I compare it to other samples

553
00:44:26,760 --> 00:44:30,400
that are obviously the same code base
but they've kind of evolved a little bit

554
00:44:30,400 --> 00:44:35,099
that kind of stuff takes time I mean I
think I probably spent maybe twenty

555
00:44:35,099 --> 00:44:39,630
hours reversing samples for that stuff
however a lot of times you're under a

556
00:44:39,630 --> 00:44:44,390
gun you have great we need to know it's
like kind of like good vs bad and you

557
00:44:44,390 --> 00:44:49,040
just have to be like is this evil yes or
no and you figure out is that evil and

558
00:44:49,040 --> 00:44:52,790
hopefully you know some capabilities of
it so sometimes you want to be less than

559
00:44:52,790 --> 00:44:56,740
an hour that you spend on it so it
really all depends on who's asking

560
00:44:56,740 --> 00:45:02,399
really so I our teams are going to spend
a short amount of time they are under a

561
00:45:02,400 --> 00:45:07,349
gun you know they have a client with X
amount of money every single time they

562
00:45:07,349 --> 00:45:10,280
don't they don't want to burn through
their money and not be able to get the

563
00:45:10,280 --> 00:45:15,180
answers so they're going to want it as
fast as possible to do get research

564
00:45:15,180 --> 00:45:36,759
takes long so

565
00:45:36,760 --> 00:45:43,420
like he was asking it depends on the
group's some groups will never use it

566
00:45:43,420 --> 00:45:46,830
cuz I've just never learned it
apparently some groups use it constantly

567
00:45:46,830 --> 00:45:53,700
I don't mention it in what I talked
about but the one with the apt 3 back to

568
00:45:53,700 --> 00:45:58,470
where I was referencing they'd like to
do and I disassembly tricks but they

569
00:45:58,470 --> 00:46:03,529
have one they apparently have figured
out one and only one so part of the blog

570
00:46:03,530 --> 00:46:07,980
post will be a night approached script
yet just like ok if you see these

571
00:46:07,980 --> 00:46:12,420
instructions picks it up and like even
go and recreate the functions were you

572
00:46:12,420 --> 00:46:17,080
and it does all the work for you so
sometimes they're much more clever and

573
00:46:17,080 --> 00:46:17,950
they will do

574
00:46:17,950 --> 00:46:22,600
ridiculous heavy stuff I can't give you
numbers whatsoever cuz I can't speak to

575
00:46:22,600 --> 00:46:26,440
that but you definitely see all of it
the one thing I will say is an TVM stuff

576
00:46:26,440 --> 00:46:32,570
is really going away and targeted an
hour because most of the time they they

577
00:46:32,570 --> 00:46:36,590
will still want to you you know some
people are keeping their they're very

578
00:46:36,590 --> 00:46:42,690
crucial resources their IP and stuff in
virtualized environments now so if you

579
00:46:42,690 --> 00:46:47,220
say right now where the doesn't execute
inside of a p.m. it's not going to

580
00:46:47,220 --> 00:46:51,299
execute in where you want possibly and
that's good so anti p.m. is kind of

581
00:46:51,300 --> 00:46:55,120
going away and I debugging we're here
like checking to see if somebody's

582
00:46:55,120 --> 00:46:59,759
debugging that stuff all the time like
most of the time really basic they don't

583
00:46:59,760 --> 00:47:02,930
do stuff like timing checks very
regularly they'll be like alright is

584
00:47:02,930 --> 00:47:08,640
debugger president ok don't do stuff and
then they don't do stuff and I laugh and

585
00:47:08,640 --> 00:47:12,710
I keep doing so has seen what it's doing
but sometimes they're putting in a lot

586
00:47:12,710 --> 00:47:16,500
of good checks in there but anti
disassembly is the one that's most you

587
00:47:16,500 --> 00:47:18,609
know the biggest fan now it's a

588
00:47:18,609 --> 00:47:22,999
I would say also most of the time
they're just doing encoding kind of

589
00:47:22,999 --> 00:47:28,890
their anti reversing anti everything is
just a if its encoded a couple times

590
00:47:28,890 --> 00:47:34,379
it'll be fine and you'll get through
that and obviously yeah exactly just

591
00:47:34,380 --> 00:47:41,239
like a couple of times heading out for a
debugger got it and drinks shirts

592
00:47:41,239 --> 00:47:54,769
whatever he likes there anymore
questions thank you very much sorry yes

593
00:47:54,769 --> 00:47:56,879
definitely

594
00:47:56,880 --> 00:48:02,660
ATT's don't like when you talk about
them apparently so I was an alien when

595
00:48:02,660 --> 00:48:08,739
the apt one report came out the best
thing was when they Trojan I is the apt

596
00:48:08,739 --> 00:48:13,839
one report and then tried to re-release
it and then they also actively targeted

597
00:48:13,839 --> 00:48:19,049
so that was that was one fun thing they
actively targeted media employees right

598
00:48:19,049 --> 00:48:23,859
after that with terribly written PDF
similar to the one that I should and

599
00:48:23,859 --> 00:48:27,920
none of that got through pretty
hilarious thanks for the malware and we

600
00:48:27,920 --> 00:48:32,519
now have all the IOC's from all of this
but you didn't get anything from us and

601
00:48:32,519 --> 00:48:37,470
then the other one I will say is a piece
of ransomware and I forget the name of

602
00:48:37,470 --> 00:48:43,459
it is but its ransomware that you know
like crypto like her killer but some of

603
00:48:43,460 --> 00:48:48,009
the other in somewhere as we lock your
computer where the FBI the CIA or the

604
00:48:48,009 --> 00:48:49,010
NSA

605
00:48:49,010 --> 00:48:52,880
you've been looking at child porn and
you're going to prison for 10 years

606
00:48:52,880 --> 00:49:03,200
unless you $300 yeah and get your money
backing out that the best part about the

607
00:49:03,200 --> 00:49:11,080
1 I'm talking about is that it had this
banner that was like it had NSA CIA the

608
00:49:11,080 --> 00:49:19,230
mandiant logo and then it had like Obama
pointing at you it's pretty great and so

609
00:49:19,230 --> 00:49:24,540
we definitely see that it's just you
know the media explode sometimes

610
00:49:24,540 --> 00:49:29,830
sometimes like many as trying to attack
you obviously not true but yes something

611
00:49:29,830 --> 00:49:32,069
bad happens

612
00:49:32,069 --> 00:49:36,670
questions I thank you very much so
severe

