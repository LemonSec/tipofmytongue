1
00:00:02,040 --> 00:00:08,090
[Applause]

2
00:00:03,970 --> 00:00:10,160
okay so<font color="#E5E5E5"> Active Directory that's a bit</font>

3
00:00:08,090 --> 00:00:13,160
<font color="#CCCCCC">awkward because</font><font color="#E5E5E5"> I actually put together</font>

4
00:00:10,160 --> 00:00:14,540
some stuff<font color="#E5E5E5"> on x86</font><font color="#CCCCCC"> instruction set since</font>

5
00:00:13,160 --> 00:00:17,300
<font color="#E5E5E5">that was</font><font color="#CCCCCC"> the talk that was going to be</font>

6
00:00:14,540 --> 00:00:19,759
up<font color="#E5E5E5"> here</font><font color="#CCCCCC"> before but I'm guessing</font><font color="#E5E5E5"> that's</font>

7
00:00:17,300 --> 00:00:23,300
<font color="#E5E5E5">not what I'm actually going to do so let</font>

8
00:00:19,760 --> 00:00:23,990
me just go<font color="#CCCCCC"> through these and this and</font>

9
00:00:23,300 --> 00:00:27,140
that

10
00:00:23,990 --> 00:00:28,310
oh sorry<font color="#CCCCCC"> that was</font><font color="#E5E5E5"> actually really</font><font color="#CCCCCC"> cool</font>

11
00:00:27,140 --> 00:00:31,039
<font color="#E5E5E5">that's something you</font><font color="#CCCCCC"> should</font><font color="#E5E5E5"> look at</font>

12
00:00:28,310 --> 00:00:34,390
later<font color="#CCCCCC"> pack bits are awesome definitely</font>

13
00:00:31,039 --> 00:00:38,870
<font color="#CCCCCC">check those out yeah we got that</font>

14
00:00:34,390 --> 00:00:42,860
sure<font color="#E5E5E5"> bitwise logical Xers anyway anyway</font>

15
00:00:38,870 --> 00:00:45,559
<font color="#E5E5E5">yeah okay there we go all</font><font color="#CCCCCC"> right so let's</font>

16
00:00:42,860 --> 00:00:47,629
talk<font color="#CCCCCC"> act by Curie security I'm Sean</font>

17
00:00:45,559 --> 00:00:49,730
Metcalfe<font color="#E5E5E5"> I'm the founder Trimark</font>

18
00:00:47,629 --> 00:00:51,589
security company I work with a<font color="#E5E5E5"> number</font><font color="#CCCCCC"> of</font>

19
00:00:49,730 --> 00:00:52,968
company a number of organizations around

20
00:00:51,590 --> 00:00:55,039
the world<font color="#E5E5E5"> to help</font><font color="#CCCCCC"> them</font><font color="#E5E5E5"> better secure</font>

21
00:00:52,969 --> 00:00:56,750
their environment<font color="#E5E5E5"> Microsoft Certified</font>

22
00:00:55,039 --> 00:00:58,520
Master in Active Directory<font color="#CCCCCC"> there's</font><font color="#E5E5E5"> about</font>

23
00:00:56,750 --> 00:01:00,079
a hundred<font color="#E5E5E5"> in the world</font><font color="#CCCCCC"> I've</font><font color="#E5E5E5"> spoken in a</font>

24
00:00:58,520 --> 00:01:01,940
number of<font color="#E5E5E5"> conferences</font><font color="#CCCCCC"> including Chaka</font>

25
00:01:00,079 --> 00:01:04,369
Khan<font color="#CCCCCC"> here three years</font><font color="#E5E5E5"> ago so I'm very</font>

26
00:01:01,940 --> 00:01:06,829
<font color="#CCCCCC">excited back</font><font color="#E5E5E5"> and I'm an eightieth</font>

27
00:01:04,369 --> 00:01:09,170
enthusiast<font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> very much excited about</font>

28
00:01:06,829 --> 00:01:11,149
Active Directory<font color="#E5E5E5"> I'm excited to talk to</font>

29
00:01:09,170 --> 00:01:14,359
<font color="#CCCCCC">companies and customers</font><font color="#E5E5E5"> about</font><font color="#CCCCCC"> what</font>

30
00:01:11,149 --> 00:01:15,229
they're doing<font color="#CCCCCC"> and their challenges so</font>

31
00:01:14,359 --> 00:01:17,359
we're going to<font color="#E5E5E5"> go</font><font color="#CCCCCC"> over the current</font>

32
00:01:15,229 --> 00:01:18,529
<font color="#E5E5E5">threat landscape cloud Active Directory</font>

33
00:01:17,359 --> 00:01:20,630
what does that<font color="#E5E5E5"> actually mean</font>

34
00:01:18,529 --> 00:01:22,700
the typical security<font color="#E5E5E5"> issues that</font><font color="#CCCCCC"> I've</font>

35
00:01:20,630 --> 00:01:25,339
seen at customer<font color="#E5E5E5"> sites and organizations</font>

36
00:01:22,700 --> 00:01:28,579
and how to fix those clean them up the

37
00:01:25,340 --> 00:01:30,950
ever<font color="#E5E5E5"> evolving and expanding set of</font>

38
00:01:28,579 --> 00:01:33,380
<font color="#E5E5E5">permissions that tend to just take over</font>

39
00:01:30,950 --> 00:01:34,939
Active Directory over time<font color="#E5E5E5"> some cool</font>

40
00:01:33,380 --> 00:01:37,818
attack detection and then<font color="#E5E5E5"> wrap</font><font color="#CCCCCC"> it up</font>

41
00:01:34,939 --> 00:01:39,859
with<font color="#CCCCCC"> some recommendations</font><font color="#E5E5E5"> so breach I</font>

42
00:01:37,819 --> 00:01:41,270
love doing searches<font color="#CCCCCC"> on Google that are</font>

43
00:01:39,859 --> 00:01:43,520
<font color="#E5E5E5">just</font><font color="#CCCCCC"> very</font><font color="#E5E5E5"> simple like this and</font>

44
00:01:41,270 --> 00:01:46,069
<font color="#E5E5E5">apparently there's like</font><font color="#CCCCCC"> four million</font>

45
00:01:43,520 --> 00:01:48,408
<font color="#E5E5E5">breaches out there according</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> the</font>

46
00:01:46,069 --> 00:01:50,479
<font color="#CCCCCC">googles</font><font color="#E5E5E5"> but the state of security</font><font color="#CCCCCC"> is</font>

47
00:01:48,409 --> 00:01:52,399
good right<font color="#CCCCCC"> though</font><font color="#E5E5E5"> we got some good</font>

48
00:01:50,479 --> 00:01:53,749
<font color="#E5E5E5">better security awareness we're able to</font>

49
00:01:52,399 --> 00:01:55,669
see what's<font color="#E5E5E5"> going on</font><font color="#CCCCCC"> better than</font><font color="#E5E5E5"> we have</font>

50
00:01:53,749 --> 00:01:57,889
before<font color="#E5E5E5"> we're getting some logging we're</font>

51
00:01:55,669 --> 00:02:00,229
<font color="#E5E5E5">flowing it in sometimes</font><font color="#CCCCCC"> we miss the</font>

52
00:01:57,889 --> 00:02:02,689
benefit in the room but<font color="#CCCCCC"> that happens we</font>

53
00:02:00,229 --> 00:02:04,609
have better<font color="#E5E5E5"> security testing pen testers</font>

54
00:02:02,689 --> 00:02:06,109
red teamers have really evolved and are

55
00:02:04,609 --> 00:02:07,908
looking at what<font color="#CCCCCC"> some of the more</font>

56
00:02:06,109 --> 00:02:10,519
advanced persistent threats are actually

57
00:02:07,909 --> 00:02:11,870
doing<font color="#E5E5E5"> out there and better PowerShell</font>

58
00:02:10,519 --> 00:02:13,790
security so if you<font color="#E5E5E5"> haven't already</font>

59
00:02:11,870 --> 00:02:14,430
rolled out version<font color="#CCCCCC"> 5 please rolled out</font>

60
00:02:13,790 --> 00:02:17,700
version<font color="#E5E5E5"> 5</font>

61
00:02:14,430 --> 00:02:20,900
it's<font color="#E5E5E5"> awesome and apparently the same</font>

62
00:02:17,700 --> 00:02:23,609
thing in Python<font color="#CCCCCC"> is coming</font><font color="#E5E5E5"> to Python v3</font>

63
00:02:20,900 --> 00:02:25,140
we're looking at<font color="#E5E5E5"> similar types of</font>

64
00:02:23,610 --> 00:02:26,220
logging<font color="#E5E5E5"> and security capability there</font>

65
00:02:25,140 --> 00:02:29,458
that we<font color="#CCCCCC"> already have in PowerShell</font>

66
00:02:26,220 --> 00:02:32,730
<font color="#E5E5E5">that's pretty great</font><font color="#CCCCCC"> we also have some</font>

67
00:02:29,459 --> 00:02:34,409
<font color="#E5E5E5">grumpy cat news</font><font color="#CCCCCC"> unfortunately going</font><font color="#E5E5E5"> from</font>

68
00:02:32,730 --> 00:02:36,840
a user to an admin is still way<font color="#E5E5E5"> too easy</font>

69
00:02:34,409 --> 00:02:38,429
in most environments<font color="#CCCCCC"> all someone has</font><font color="#E5E5E5"> to</font>

70
00:02:36,840 --> 00:02:41,310
do is<font color="#E5E5E5"> basically put</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> the outfit and</font>

71
00:02:38,430 --> 00:02:43,049
then<font color="#CCCCCC"> there the admin legacy really</font>

72
00:02:41,310 --> 00:02:44,540
<font color="#E5E5E5">reduces security legacy is probably one</font>

73
00:02:43,049 --> 00:02:47,220
of<font color="#E5E5E5"> the biggest issues</font><font color="#CCCCCC"> that we have today</font>

74
00:02:44,540 --> 00:02:49,138
<font color="#CCCCCC">the</font><font color="#E5E5E5"> flood that's associated</font><font color="#CCCCCC"> with it</font><font color="#E5E5E5"> you</font>

75
00:02:47,220 --> 00:02:51,030
<font color="#CCCCCC">have the service</font><font color="#E5E5E5"> count it has the main</font>

76
00:02:49,139 --> 00:02:53,099
admin it doesn't need<font color="#E5E5E5"> that well this</font><font color="#CCCCCC"> is</font>

77
00:02:51,030 --> 00:02:55,459
<font color="#CCCCCC">how it's always been and Joe set that up</font>

78
00:02:53,099 --> 00:02:57,078
well where's Joe he<font color="#E5E5E5"> left five years ago</font>

79
00:02:55,459 --> 00:02:59,760
<font color="#CCCCCC">ok</font>

80
00:02:57,079 --> 00:03:00,989
PowerShell logging not enabled<font color="#CCCCCC"> so we've</font>

81
00:02:59,760 --> 00:03:04,409
got all these<font color="#CCCCCC"> great new features in</font>

82
00:03:00,989 --> 00:03:06,480
<font color="#E5E5E5">PowerShell</font><font color="#CCCCCC"> 4 + v5 but the logging is</font>

83
00:03:04,409 --> 00:03:08,929
just not enabled it's a pretty basic

84
00:03:06,480 --> 00:03:11,849
simple group policy configuration<font color="#CCCCCC"> and</font>

85
00:03:08,930 --> 00:03:13,049
there's<font color="#E5E5E5"> still too many blind</font><font color="#CCCCCC"> spots</font><font color="#E5E5E5"> one</font>

86
00:03:11,849 --> 00:03:14,608
<font color="#E5E5E5">of the great things about having a pen</font>

87
00:03:13,049 --> 00:03:16,530
tester or a red team come<font color="#CCCCCC"> in is to</font>

88
00:03:14,609 --> 00:03:19,109
<font color="#CCCCCC">identify those blind</font><font color="#E5E5E5"> spots those areas</font>

89
00:03:16,530 --> 00:03:20,819
you can't see if you can't already see

90
00:03:19,109 --> 00:03:24,180
those<font color="#E5E5E5"> they're just going to come in</font><font color="#CCCCCC"> to</font>

91
00:03:20,819 --> 00:03:28,048
confirm your suspicions and of course we

92
00:03:24,180 --> 00:03:29,940
got to<font color="#E5E5E5"> talk about the ugly email gets</font>

93
00:03:28,049 --> 00:03:32,669
users to click<font color="#E5E5E5"> why is this we have</font>

94
00:03:29,940 --> 00:03:34,470
<font color="#E5E5E5">trained users to click for years by</font>

95
00:03:32,669 --> 00:03:36,209
<font color="#E5E5E5">sending them internal email click here</font>

96
00:03:34,470 --> 00:03:39,900
to update<font color="#E5E5E5"> this click here</font><font color="#CCCCCC"> to update that</font>

97
00:03:36,209 --> 00:03:41,819
we have performance reviews that we<font color="#E5E5E5"> have</font>

98
00:03:39,900 --> 00:03:43,709
to do click here to<font color="#E5E5E5"> get to that click</font>

99
00:03:41,819 --> 00:03:47,159
here<font color="#E5E5E5"> to get to this click here to see</font>

100
00:03:43,709 --> 00:03:49,470
<font color="#E5E5E5">the dancing chickens and from email the</font>

101
00:03:47,159 --> 00:03:51,090
breach<font color="#CCCCCC"> it's way too</font><font color="#E5E5E5"> easy we end up with</font>

102
00:03:49,470 --> 00:03:52,739
a<font color="#CCCCCC"> situation where we have predator</font>

103
00:03:51,090 --> 00:03:55,739
hiding<font color="#E5E5E5"> on our network and we can't see</font>

104
00:03:52,739 --> 00:03:57,329
<font color="#E5E5E5">it and a year ago</font><font color="#CCCCCC"> there was an article</font>

105
00:03:55,739 --> 00:04:01,169
so the nearly<font color="#CCCCCC"> half of</font><font color="#E5E5E5"> firms had a cyber</font>

106
00:03:57,329 --> 00:04:03,599
<font color="#E5E5E5">attack or breach which is pretty bad and</font>

107
00:04:01,169 --> 00:04:07,079
this<font color="#E5E5E5"> was in a year that about 80 billion</font>

108
00:04:03,599 --> 00:04:09,418
<font color="#CCCCCC">dollars is spent on</font><font color="#E5E5E5"> cyber</font><font color="#CCCCCC"> security</font><font color="#E5E5E5"> so</font>

109
00:04:07,079 --> 00:04:12,510
how does<font color="#E5E5E5"> that make me feel as a person</font>

110
00:04:09,419 --> 00:04:16,168
who works at a<font color="#CCCCCC"> company that works</font><font color="#E5E5E5"> with</font>

111
00:04:12,510 --> 00:04:17,279
<font color="#E5E5E5">other companies</font><font color="#CCCCCC"> I kind of feel like when</font>

112
00:04:16,168 --> 00:04:18,599
you're<font color="#E5E5E5"> talking about 80 billion dollars</font>

113
00:04:17,279 --> 00:04:21,298
you're talking<font color="#E5E5E5"> about taking a dollar</font>

114
00:04:18,599 --> 00:04:22,620
stacked<font color="#CCCCCC"> and</font><font color="#E5E5E5"> to end and</font><font color="#CCCCCC"> then going</font><font color="#E5E5E5"> 16</font>

115
00:04:21,298 --> 00:04:25,770
times back and forth<font color="#E5E5E5"> that's a lot of</font>

116
00:04:22,620 --> 00:04:27,539
<font color="#E5E5E5">money</font><font color="#CCCCCC"> and then in 2018 how much money</font>

117
00:04:25,770 --> 00:04:28,640
are we burning through this year for the

118
00:04:27,539 --> 00:04:31,409
<font color="#CCCCCC">blankey box</font>

119
00:04:28,640 --> 00:04:33,870
it's a challenge<font color="#E5E5E5"> and so now we have this</font>

120
00:04:31,410 --> 00:04:35,670
<font color="#E5E5E5">whole cloud thing where it's rainbows</font>

121
00:04:33,870 --> 00:04:37,770
and unicorns and everything's happy and

122
00:04:35,670 --> 00:04:40,260
wonderful<font color="#CCCCCC"> right there's a lot of</font>

123
00:04:37,770 --> 00:04:41,549
<font color="#CCCCCC">challenges though because we have our</font>

124
00:04:40,260 --> 00:04:44,280
<font color="#CCCCCC">on-prem environment which we're very</font>

125
00:04:41,550 --> 00:04:45,420
<font color="#CCCCCC">familiar with</font><font color="#E5E5E5"> probably and certainly</font>

126
00:04:44,280 --> 00:04:47,429
more familiar than a cloud environment

127
00:04:45,420 --> 00:04:49,050
we know how to how to control how to

128
00:04:47,430 --> 00:04:50,610
control egress ingress in our own

129
00:04:49,050 --> 00:04:53,100
environment<font color="#CCCCCC"> we know what things look</font>

130
00:04:50,610 --> 00:04:55,110
like<font color="#E5E5E5"> we</font><font color="#CCCCCC"> know</font><font color="#E5E5E5"> what the problems are we</font>

131
00:04:53,100 --> 00:04:57,360
know we can see<font color="#E5E5E5"> hopefully we we know we</font>

132
00:04:55,110 --> 00:04:59,700
can't see but<font color="#E5E5E5"> it's always changing in</font>

133
00:04:57,360 --> 00:05:01,110
the cloud world<font color="#CCCCCC"> I go and</font><font color="#E5E5E5"> read documents</font>

134
00:04:59,700 --> 00:05:02,789
<font color="#E5E5E5">there's six months old and then I've got</font>

135
00:05:01,110 --> 00:05:04,260
to go and<font color="#E5E5E5"> read new documents because a</font>

136
00:05:02,790 --> 00:05:06,150
lot<font color="#E5E5E5"> of things have updated and change</font>

137
00:05:04,260 --> 00:05:08,039
this means that<font color="#E5E5E5"> learning curve is a lot</font>

138
00:05:06,150 --> 00:05:09,539
steeper<font color="#E5E5E5"> than it used to be</font><font color="#CCCCCC"> and certainly</font>

139
00:05:08,040 --> 00:05:11,760
<font color="#E5E5E5">steeper than</font><font color="#CCCCCC"> it was for other</font>

140
00:05:09,540 --> 00:05:14,190
technologies<font color="#E5E5E5"> and the security</font>

141
00:05:11,760 --> 00:05:16,140
capabilities and the ability<font color="#CCCCCC"> of that</font>

142
00:05:14,190 --> 00:05:18,630
<font color="#E5E5E5">cloud environment is very much dependent</font>

143
00:05:16,140 --> 00:05:21,000
on<font color="#CCCCCC"> the provider so if you're with Amazon</font>

144
00:05:18,630 --> 00:05:23,100
or Microsoft or Google<font color="#E5E5E5"> there's gonna be</font>

145
00:05:21,000 --> 00:05:24,480
differences<font color="#E5E5E5"> in how you can how you can</font>

146
00:05:23,100 --> 00:05:27,510
secure different things how you can

147
00:05:24,480 --> 00:05:28,710
<font color="#E5E5E5">control</font><font color="#CCCCCC"> access and there's even</font>

148
00:05:27,510 --> 00:05:29,880
different<font color="#E5E5E5"> names</font><font color="#CCCCCC"> for different</font><font color="#E5E5E5"> things</font>

149
00:05:28,710 --> 00:05:31,109
<font color="#E5E5E5">across those different cloud</font>

150
00:05:29,880 --> 00:05:32,940
environments which makes it even<font color="#CCCCCC"> more</font>

151
00:05:31,110 --> 00:05:34,530
difficult<font color="#CCCCCC"> and</font><font color="#E5E5E5"> then of course it's not</font>

152
00:05:32,940 --> 00:05:36,870
always<font color="#E5E5E5"> obvious what you're sharing</font>

153
00:05:34,530 --> 00:05:38,609
versus what you're<font color="#E5E5E5"> not or if you're</font>

154
00:05:36,870 --> 00:05:40,320
<font color="#CCCCCC">sharing it internally versus public I</font>

155
00:05:38,610 --> 00:05:43,920
think<font color="#CCCCCC"> most</font><font color="#E5E5E5"> people here</font><font color="#CCCCCC"> know what</font><font color="#E5E5E5"> the</font>

156
00:05:40,320 --> 00:05:46,460
<font color="#E5E5E5">word are the</font><font color="#CCCCCC"> term s3 means right</font><font color="#E5E5E5"> because</font>

157
00:05:43,920 --> 00:05:48,480
we've seen<font color="#E5E5E5"> it</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> the news all the time</font>

158
00:05:46,460 --> 00:05:50,099
<font color="#E5E5E5">the one thing that I've heard a lot</font>

159
00:05:48,480 --> 00:05:53,250
though is I'm going to<font color="#E5E5E5"> migrate my</font>

160
00:05:50,100 --> 00:05:55,710
<font color="#CCCCCC">on-prem ad to azure ad</font><font color="#E5E5E5"> and it doesn't</font>

161
00:05:53,250 --> 00:05:57,030
quite<font color="#CCCCCC"> work like that Azure ad</font><font color="#E5E5E5"> despite</font>

162
00:05:55,710 --> 00:05:59,340
the fact that it's a<font color="#CCCCCC"> j''r Active</font>

163
00:05:57,030 --> 00:06:00,659
Directory<font color="#E5E5E5"> is not Active Directory at</font>

164
00:05:59,340 --> 00:06:02,130
least not the<font color="#E5E5E5"> way</font><font color="#CCCCCC"> that we're used to</font><font color="#E5E5E5"> or</font>

165
00:06:00,660 --> 00:06:04,740
the<font color="#E5E5E5"> way that we're used to thinking of</font>

166
00:06:02,130 --> 00:06:07,020
it as we're<font color="#E5E5E5"> not going</font><font color="#CCCCCC"> to just shift and</font>

167
00:06:04,740 --> 00:06:09,990
forklift what we have on<font color="#E5E5E5"> Prem up into</font>

168
00:06:07,020 --> 00:06:12,780
the cloud<font color="#CCCCCC"> it's not as your ad at least</font>

169
00:06:09,990 --> 00:06:14,100
not today<font color="#E5E5E5"> we have our</font><font color="#CCCCCC"> on</font><font color="#E5E5E5"> Prem ad which</font>

170
00:06:12,780 --> 00:06:15,750
we're very<font color="#CCCCCC"> familiar with</font><font color="#E5E5E5"> we have</font>

171
00:06:14,100 --> 00:06:18,810
authentication<font color="#E5E5E5"> directory management</font>

172
00:06:15,750 --> 00:06:20,220
services we have authentication Kerberos

173
00:06:18,810 --> 00:06:21,930
and ntlm we know that pretty well

174
00:06:20,220 --> 00:06:24,510
certainly the attackers<font color="#CCCCCC"> these pretty</font>

175
00:06:21,930 --> 00:06:25,830
well we can use LDAP<font color="#CCCCCC"> to period</font><font color="#E5E5E5"> we can</font>

176
00:06:24,510 --> 00:06:28,500
<font color="#E5E5E5">use group</font><font color="#CCCCCC"> policy to</font><font color="#E5E5E5"> help manage our</font>

177
00:06:25,830 --> 00:06:30,960
systems<font color="#CCCCCC"> Azure</font><font color="#E5E5E5"> ad is quite a bit</font>

178
00:06:28,500 --> 00:06:33,600
different<font color="#CCCCCC"> it's an</font><font color="#E5E5E5"> identity multi-tenant</font>

179
00:06:30,960 --> 00:06:34,919
cloud directory and<font color="#CCCCCC"> it's cloud web</font>

180
00:06:33,600 --> 00:06:36,390
focused which means that the

181
00:06:34,920 --> 00:06:38,940
authentication<font color="#CCCCCC"> is very different as well</font>

182
00:06:36,390 --> 00:06:41,150
<font color="#E5E5E5">we're looking</font><font color="#CCCCCC"> at Oh our Open ID Connect</font>

183
00:06:38,940 --> 00:06:43,820
based authentication and protocols

184
00:06:41,150 --> 00:06:44,989
we're not looking at ntlm we're not

185
00:06:43,820 --> 00:06:47,360
looking at Kerberos<font color="#CCCCCC"> oh those</font><font color="#E5E5E5"> things</font>

186
00:06:44,990 --> 00:06:49,520
don't<font color="#E5E5E5"> exist in Azure ad and if you want</font>

187
00:06:47,360 --> 00:06:51,350
to use LDAP to look at<font color="#E5E5E5"> Azure ad you can</font>

188
00:06:49,520 --> 00:06:54,919
you have to<font color="#E5E5E5"> use the app directory graft</font>

189
00:06:51,350 --> 00:06:57,380
<font color="#E5E5E5">API and if you're looking at doing some</font>

190
00:06:54,919 --> 00:07:00,349
<font color="#E5E5E5">sort of management of devices sure I can</font>

191
00:06:57,380 --> 00:07:01,159
<font color="#E5E5E5">join my computer to Azure ad where's</font><font color="#CCCCCC"> a</font>

192
00:07:00,350 --> 00:07:03,620
group policy

193
00:07:01,160 --> 00:07:05,750
there's no group policy<font color="#E5E5E5"> I've got</font><font color="#CCCCCC"> to then</font>

194
00:07:03,620 --> 00:07:08,840
get it configured<font color="#E5E5E5"> with an MDM something</font>

195
00:07:05,750 --> 00:07:11,210
like<font color="#CCCCCC"> into which isn't quite</font><font color="#E5E5E5"> group policy</font>

196
00:07:08,840 --> 00:07:13,489
<font color="#E5E5E5">doesn't have the same exact feature set</font>

197
00:07:11,210 --> 00:07:14,900
today<font color="#CCCCCC"> I can't go into Intune and</font>

198
00:07:13,490 --> 00:07:19,010
configure the security<font color="#E5E5E5"> settings for</font>

199
00:07:14,900 --> 00:07:20,179
Windows 10<font color="#E5E5E5"> like I can in group policy so</font>

200
00:07:19,010 --> 00:07:21,740
this is what Active Directory using

201
00:07:20,180 --> 00:07:23,570
computers looks like we're very<font color="#CCCCCC"> familiar</font>

202
00:07:21,740 --> 00:07:27,169
<font color="#CCCCCC">with this we have used this we've seen</font>

203
00:07:23,570 --> 00:07:30,770
<font color="#CCCCCC">this with Azure ad it's so webpage or</font>

204
00:07:27,169 --> 00:07:32,479
<font color="#E5E5E5">PowerShell very very different</font><font color="#CCCCCC"> we have</font>

205
00:07:30,770 --> 00:07:33,859
to think<font color="#E5E5E5"> about this differently</font><font color="#CCCCCC"> it's not</font>

206
00:07:32,479 --> 00:07:36,919
a situation<font color="#E5E5E5"> where</font><font color="#CCCCCC"> we're just</font><font color="#E5E5E5"> going to</font>

207
00:07:33,860 --> 00:07:41,630
push all<font color="#CCCCCC"> of our systems into</font><font color="#E5E5E5"> the cloud</font>

208
00:07:36,919 --> 00:07:43,909
<font color="#E5E5E5">now moving email and data and in order</font>

209
00:07:41,630 --> 00:07:45,409
<font color="#E5E5E5">to share and in order to collaborate</font>

210
00:07:43,910 --> 00:07:47,930
better that makes<font color="#CCCCCC"> a lot of sense in the</font>

211
00:07:45,410 --> 00:07:50,090
cloud but these workloads<font color="#E5E5E5"> that we have</font>

212
00:07:47,930 --> 00:07:52,099
<font color="#E5E5E5">that use ntlm kerberos for off</font>

213
00:07:50,090 --> 00:07:56,138
we can't just ship those over to Azure

214
00:07:52,099 --> 00:07:59,719
<font color="#E5E5E5">ad so there's some key</font><font color="#CCCCCC"> points here that</font>

215
00:07:56,139 --> 00:08:02,150
<font color="#E5E5E5">Azure ad is cloud authentication that's</font>

216
00:07:59,720 --> 00:08:03,380
what it's primarily<font color="#CCCCCC"> for and as I</font>

217
00:08:02,150 --> 00:08:05,179
mentioned there's a number<font color="#E5E5E5"> of things</font>

218
00:08:03,380 --> 00:08:07,520
that are differences between Active

219
00:08:05,180 --> 00:08:09,740
Directory and<font color="#E5E5E5"> Azure ad and there's a</font>

220
00:08:07,520 --> 00:08:10,909
reason<font color="#E5E5E5"> why I say asher ad and not Azure</font>

221
00:08:09,740 --> 00:08:13,490
Active Directory because it's not

222
00:08:10,910 --> 00:08:14,840
<font color="#E5E5E5">exactly Active Directory if you want an</font>

223
00:08:13,490 --> 00:08:16,010
Active Directory in the cloud that's

224
00:08:14,840 --> 00:08:17,539
quite a bit<font color="#CCCCCC"> different you have</font><font color="#E5E5E5"> to go</font>

225
00:08:16,010 --> 00:08:19,310
with something<font color="#CCCCCC"> like Azure Active</font>

226
00:08:17,539 --> 00:08:22,310
Directory domain services from Microsoft

227
00:08:19,310 --> 00:08:24,139
or<font color="#E5E5E5"> Amazon's managed Microsoft Active</font>

228
00:08:22,310 --> 00:08:25,310
Directory in the AWS cloud<font color="#E5E5E5"> I had to make</font>

229
00:08:24,139 --> 00:08:28,760
sure I read that correctly because

230
00:08:25,310 --> 00:08:31,250
that's a<font color="#E5E5E5"> mouthful but Microsoft's Azure</font>

231
00:08:28,760 --> 00:08:35,120
Active Directory domain services<font color="#CCCCCC"> is</font><font color="#E5E5E5"> your</font>

232
00:08:31,250 --> 00:08:38,240
cloud hosted Active Directory<font color="#E5E5E5"> it has</font>

233
00:08:35,120 --> 00:08:43,490
some<font color="#E5E5E5"> interesting OU's here like a a DD</font><font color="#CCCCCC"> C</font>

234
00:08:38,240 --> 00:08:46,880
<font color="#E5E5E5">computers a DD C users a DD C domain</font>

235
00:08:43,490 --> 00:08:48,230
admins these are delegated OU's<font color="#E5E5E5"> you're</font>

236
00:08:46,880 --> 00:08:50,270
not going to be a<font color="#E5E5E5"> domain admin in this</font>

237
00:08:48,230 --> 00:08:51,829
hosted environment and there's some

238
00:08:50,270 --> 00:08:53,390
differences with it but this is<font color="#E5E5E5"> the</font><font color="#CCCCCC"> 80</font>

239
00:08:51,829 --> 00:08:54,079
as a service if<font color="#E5E5E5"> you're looking for that</font>

240
00:08:53,390 --> 00:08:55,730
<font color="#E5E5E5">sort of thing</font>

241
00:08:54,080 --> 00:08:58,010
but again this is a little<font color="#E5E5E5"> bit different</font>

242
00:08:55,730 --> 00:09:00,410
than what<font color="#CCCCCC"> most people think it is</font><font color="#E5E5E5"> Azure</font>

243
00:08:58,010 --> 00:09:03,650
ad domain<font color="#E5E5E5"> services is not meant for you</font>

244
00:09:00,410 --> 00:09:05,420
<font color="#CCCCCC">to set this up and then use it to in</font>

245
00:09:03,650 --> 00:09:07,100
order<font color="#CCCCCC"> to</font><font color="#E5E5E5"> configure a forest trust from</font>

246
00:09:05,420 --> 00:09:09,439
<font color="#E5E5E5">your on-prem ad it doesn't support</font><font color="#CCCCCC"> truss</font>

247
00:09:07,100 --> 00:09:11,870
<font color="#E5E5E5">this is primarily for managing</font><font color="#CCCCCC"> your as</font>

248
00:09:09,440 --> 00:09:13,190
your workload<font color="#E5E5E5"> your cloud workload you</font>

249
00:09:11,870 --> 00:09:14,870
group policy<font color="#E5E5E5"> and all the other things</font>

250
00:09:13,190 --> 00:09:16,670
<font color="#E5E5E5">but you're not a domain</font><font color="#CCCCCC"> or</font><font color="#E5E5E5"> enterprise</font>

251
00:09:14,870 --> 00:09:17,810
admin and you're not going to have

252
00:09:16,670 --> 00:09:22,010
direct<font color="#E5E5E5"> access to those demand</font>

253
00:09:17,810 --> 00:09:23,689
controllers so again<font color="#E5E5E5"> even with</font><font color="#CCCCCC"> AD in the</font>

254
00:09:22,010 --> 00:09:26,569
cloud it's a little bit different than

255
00:09:23,690 --> 00:09:28,430
what we're used to now when we're

256
00:09:26,570 --> 00:09:30,950
talking about<font color="#E5E5E5"> Active Directory and the</font>

257
00:09:28,430 --> 00:09:32,750
<font color="#E5E5E5">connectivity with</font><font color="#CCCCCC"> the cloud 80 provides</font>

258
00:09:30,950 --> 00:09:35,840
a single<font color="#CCCCCC"> sign-on services and there's</font>

259
00:09:32,750 --> 00:09:37,760
sync tools that enable you to take users

260
00:09:35,840 --> 00:09:40,220
and user<font color="#E5E5E5"> data and then sync it up to</font>

261
00:09:37,760 --> 00:09:42,140
whatever<font color="#E5E5E5"> that cloud service is a lot of</font>

262
00:09:40,220 --> 00:09:44,210
people have probably<font color="#E5E5E5"> gone to</font><font color="#CCCCCC"> a company</font>

263
00:09:42,140 --> 00:09:45,530
and have the<font color="#CCCCCC"> ly</font><font color="#E5E5E5"> pad you touch the</font>

264
00:09:44,210 --> 00:09:46,850
information<font color="#E5E5E5"> it has the information about</font>

265
00:09:45,530 --> 00:09:48,439
<font color="#E5E5E5">who you check in with well guess what</font>

266
00:09:46,850 --> 00:09:51,040
<font color="#E5E5E5">that information gets synced from that</font>

267
00:09:48,440 --> 00:09:53,330
<font color="#CCCCCC">on-prem</font><font color="#E5E5E5"> ad to that cloud provider</font>

268
00:09:51,040 --> 00:09:56,689
<font color="#E5E5E5">there's a lot of others</font><font color="#CCCCCC"> that do the same</font>

269
00:09:53,330 --> 00:09:58,160
<font color="#CCCCCC">thing and these rights</font><font color="#E5E5E5"> that are required</font>

270
00:09:56,690 --> 00:10:01,520
<font color="#E5E5E5">in order to do this or just user rights</font>

271
00:09:58,160 --> 00:10:03,079
an ad so the<font color="#CCCCCC"> real question is</font><font color="#E5E5E5"> how</font><font color="#CCCCCC"> many</font>

272
00:10:01,520 --> 00:10:06,640
<font color="#CCCCCC">of these sync tools</font><font color="#E5E5E5"> that you</font><font color="#CCCCCC"> have</font><font color="#E5E5E5"> in</font>

273
00:10:03,080 --> 00:10:09,290
your organization<font color="#CCCCCC"> then you're aware of</font>

274
00:10:06,640 --> 00:10:11,270
well there's a 3d<font color="#CCCCCC"> Kinect which if you</font>

275
00:10:09,290 --> 00:10:12,650
have<font color="#E5E5E5"> office</font><font color="#CCCCCC"> 365 you probably have azure</font>

276
00:10:11,270 --> 00:10:15,290
ad<font color="#CCCCCC"> Kinect</font><font color="#E5E5E5"> because that's how you</font>

277
00:10:12,650 --> 00:10:18,050
synchronize<font color="#CCCCCC"> your user in groups</font><font color="#E5E5E5"> up into</font>

278
00:10:15,290 --> 00:10:20,390
office 365<font color="#CCCCCC"> in the azure</font><font color="#E5E5E5"> ad tenant that's</font>

279
00:10:18,050 --> 00:10:22,579
spun up automatically for<font color="#E5E5E5"> office 365</font><font color="#CCCCCC"> and</font>

280
00:10:20,390 --> 00:10:24,230
<font color="#E5E5E5">primarily what this is used for is order</font>

281
00:10:22,580 --> 00:10:26,510
to make<font color="#CCCCCC"> sure that the user accounts that</font>

282
00:10:24,230 --> 00:10:28,820
exists on<font color="#CCCCCC"> your on-prem ad are also</font><font color="#E5E5E5"> an</font>

283
00:10:26,510 --> 00:10:30,740
azure ad and you<font color="#CCCCCC"> have group membership</font>

284
00:10:28,820 --> 00:10:32,510
<font color="#E5E5E5">that gets updated</font><font color="#CCCCCC"> as</font><font color="#E5E5E5"> well and you have</font>

285
00:10:30,740 --> 00:10:33,800
the ability<font color="#CCCCCC"> to do what</font><font color="#E5E5E5"> Microsoft is</font>

286
00:10:32,510 --> 00:10:37,189
calling here password synchronization

287
00:10:33,800 --> 00:10:38,540
which is not entirely<font color="#E5E5E5"> accurate it was</font>

288
00:10:37,190 --> 00:10:39,440
<font color="#E5E5E5">called password synchronization it's</font>

289
00:10:38,540 --> 00:10:40,939
been<font color="#E5E5E5"> called password hash</font>

290
00:10:39,440 --> 00:10:43,850
synchronization which<font color="#CCCCCC"> isn't entirely</font>

291
00:10:40,940 --> 00:10:45,830
accurate<font color="#E5E5E5"> either</font><font color="#CCCCCC"> basically it's an Active</font>

292
00:10:43,850 --> 00:10:47,450
Directory password hash hash so they

293
00:10:45,830 --> 00:10:49,070
take the password hash of the user

294
00:10:47,450 --> 00:10:50,780
<font color="#E5E5E5">account the hash it again do some</font>

295
00:10:49,070 --> 00:10:52,610
<font color="#E5E5E5">additional crypto on it and that's</font>

296
00:10:50,780 --> 00:10:54,770
what's actually<font color="#E5E5E5"> sent up to</font><font color="#CCCCCC"> Azure ad and</font>

297
00:10:52,610 --> 00:10:56,840
there's also the<font color="#CCCCCC"> capability to</font><font color="#E5E5E5"> do</font><font color="#CCCCCC"> write</font>

298
00:10:54,770 --> 00:10:58,640
back so that way when a user<font color="#E5E5E5"> off to</font>

299
00:10:56,840 --> 00:11:00,890
Azure ad and their<font color="#E5E5E5"> password is expired</font>

300
00:10:58,640 --> 00:11:02,720
<font color="#E5E5E5">they can update their password</font><font color="#CCCCCC"> nazzer</font><font color="#E5E5E5"> ad</font>

301
00:11:00,890 --> 00:11:05,250
<font color="#E5E5E5">and then have it sink back</font><font color="#CCCCCC"> down to</font><font color="#E5E5E5"> their</font>

302
00:11:02,720 --> 00:11:08,040
<font color="#E5E5E5">on</font><font color="#CCCCCC"> prem ad environment</font>

303
00:11:05,250 --> 00:11:10,140
and if you have as<font color="#CCCCCC"> rady predict</font><font color="#E5E5E5"> connect</font>

304
00:11:08,040 --> 00:11:12,300
and you've gone through and hit the<font color="#E5E5E5"> easy</font>

305
00:11:10,140 --> 00:11:13,740
button<font color="#E5E5E5"> and panicked do the Express</font>

306
00:11:12,300 --> 00:11:14,729
<font color="#CCCCCC">settings it would set up all of these</font>

307
00:11:13,740 --> 00:11:17,430
different permissions for you

308
00:11:14,730 --> 00:11:19,410
automatically<font color="#E5E5E5"> but</font><font color="#CCCCCC"> there's something</font>

309
00:11:17,430 --> 00:11:21,060
<font color="#E5E5E5">interesting</font><font color="#CCCCCC"> about this here and I talked</font>

310
00:11:19,410 --> 00:11:24,089
<font color="#CCCCCC">about this</font><font color="#E5E5E5"> at Def Con</font><font color="#CCCCCC"> last year with</font>

311
00:11:21,060 --> 00:11:26,520
<font color="#E5E5E5">Gerald</font><font color="#CCCCCC"> that there's two rights here that</font>

312
00:11:24,090 --> 00:11:28,500
are provided to the service account for

313
00:11:26,520 --> 00:11:29,960
a JD<font color="#E5E5E5"> connect replicate directory changes</font>

314
00:11:28,500 --> 00:11:33,270
and replicate directory changes all

315
00:11:29,960 --> 00:11:35,400
these two rights<font color="#E5E5E5"> provide the ability</font><font color="#CCCCCC"> to</font>

316
00:11:33,270 --> 00:11:37,170
pull password hashes<font color="#E5E5E5"> what makes a lot</font><font color="#CCCCCC"> of</font>

317
00:11:35,400 --> 00:11:39,170
sets under<font color="#CCCCCC"> the context of as Rainey</font>

318
00:11:37,170 --> 00:11:41,660
<font color="#CCCCCC">connect when you're actually</font>

319
00:11:39,170 --> 00:11:45,120
synchronizing that password<font color="#E5E5E5"> hash</font>

320
00:11:41,660 --> 00:11:47,339
<font color="#E5E5E5">component up to Azure ad but what if</font>

321
00:11:45,120 --> 00:11:49,590
you're not<font color="#E5E5E5"> well that's not necessary</font>

322
00:11:47,340 --> 00:11:51,390
<font color="#E5E5E5">right and there's this little</font><font color="#CCCCCC"> thing</font>

323
00:11:49,590 --> 00:11:54,030
called DC sync that's part of<font color="#CCCCCC"> many cats</font>

324
00:11:51,390 --> 00:11:56,130
now that provides<font color="#E5E5E5"> an attacker with the</font>

325
00:11:54,030 --> 00:11:58,140
ability to<font color="#E5E5E5"> take over this account or</font><font color="#CCCCCC"> to</font>

326
00:11:56,130 --> 00:11:59,730
have these two rights without domain

327
00:11:58,140 --> 00:12:02,390
admin rights or enterprise admin rights

328
00:11:59,730 --> 00:12:06,510
<font color="#E5E5E5">to actually synchronize and pull</font>

329
00:12:02,390 --> 00:12:08,130
password hashes<font color="#E5E5E5"> from the environment so</font>

330
00:12:06,510 --> 00:12:10,230
we want<font color="#E5E5E5"> to make</font><font color="#CCCCCC"> sure that if we have as</font>

331
00:12:08,130 --> 00:12:11,670
<font color="#CCCCCC">rady connect</font><font color="#E5E5E5"> and we have</font><font color="#CCCCCC"> sirs count for</font>

332
00:12:10,230 --> 00:12:13,590
that<font color="#E5E5E5"> we're really well protecting it</font>

333
00:12:11,670 --> 00:12:15,930
because effectively<font color="#E5E5E5"> it's like being in</font>

334
00:12:13,590 --> 00:12:19,230
being an administrator<font color="#E5E5E5"> an ad admin with</font>

335
00:12:15,930 --> 00:12:20,400
access<font color="#CCCCCC"> to</font><font color="#E5E5E5"> the crown jewels so custom</font>

336
00:12:19,230 --> 00:12:21,420
permissions would be<font color="#E5E5E5"> definitely the way</font>

337
00:12:20,400 --> 00:12:25,050
to go if you're<font color="#E5E5E5"> not</font><font color="#CCCCCC"> planning on</font>

338
00:12:21,420 --> 00:12:27,030
synchronizing the password data and

339
00:12:25,050 --> 00:12:28,829
<font color="#E5E5E5">certainly a few months after</font><font color="#CCCCCC"> that</font>

340
00:12:27,030 --> 00:12:30,780
December<font color="#E5E5E5"> last year Microsoft put out a</font>

341
00:12:28,830 --> 00:12:32,970
<font color="#E5E5E5">security</font><font color="#CCCCCC"> bulletins highlighting</font><font color="#E5E5E5"> the fact</font>

342
00:12:30,780 --> 00:12:35,430
that account<font color="#E5E5E5"> operators</font><font color="#CCCCCC"> has the ability</font>

343
00:12:32,970 --> 00:12:37,350
to take over<font color="#E5E5E5"> that account based on the</font>

344
00:12:35,430 --> 00:12:40,199
base the default install of azure<font color="#CCCCCC"> ad</font>

345
00:12:37,350 --> 00:12:42,000
<font color="#CCCCCC">Connect hopefully no one in</font><font color="#E5E5E5"> here is</font>

346
00:12:40,200 --> 00:12:43,740
using account operators and<font color="#E5E5E5"> we'll talk a</font>

347
00:12:42,000 --> 00:12:47,970
little<font color="#E5E5E5"> bit about why that's not a good</font>

348
00:12:43,740 --> 00:12:50,700
<font color="#E5E5E5">idea</font><font color="#CCCCCC"> actually to</font><font color="#E5E5E5"> have that configured so</font>

349
00:12:47,970 --> 00:12:52,410
the azure ad<font color="#CCCCCC"> connects server is at</font><font color="#E5E5E5"> about</font>

350
00:12:50,700 --> 00:12:54,120
every<font color="#E5E5E5"> two minutes</font><font color="#CCCCCC"> it's requesting the</font>

351
00:12:52,410 --> 00:12:56,490
stored<font color="#E5E5E5"> password hashes from Active</font>

352
00:12:54,120 --> 00:12:58,760
Directory<font color="#E5E5E5"> and taking that</font><font color="#CCCCCC"> onto the</font>

353
00:12:56,490 --> 00:13:02,700
server and then doing<font color="#E5E5E5"> some crypto on it</font>

354
00:12:58,760 --> 00:13:04,710
<font color="#CCCCCC">so it's</font><font color="#E5E5E5"> taking that md4 it's then doing</font>

355
00:13:02,700 --> 00:13:07,410
<font color="#E5E5E5">an</font><font color="#CCCCCC"> 8-bit binary hash which is converted</font>

356
00:13:04,710 --> 00:13:11,400
to<font color="#CCCCCC"> a 64-bit binary to a 10 bytes salt</font>

357
00:13:07,410 --> 00:13:14,880
<font color="#E5E5E5">and then creating a 64-bit hash which is</font>

358
00:13:11,400 --> 00:13:18,000
then<font color="#CCCCCC"> input into sha 256 which</font><font color="#E5E5E5"> is pretty</font>

359
00:13:14,880 --> 00:13:19,180
strong so<font color="#CCCCCC"> that's sent</font><font color="#E5E5E5"> up to Azure ad and</font>

360
00:13:18,000 --> 00:13:21,460
that's<font color="#E5E5E5"> what is</font>

361
00:13:19,180 --> 00:13:24,219
<font color="#E5E5E5">used to compare to when a user actually</font>

362
00:13:21,460 --> 00:13:26,650
authenticate saturating so that way they

363
00:13:24,220 --> 00:13:29,170
<font color="#E5E5E5">don't have</font><font color="#CCCCCC"> to come back into</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> on-prem</font>

364
00:13:26,650 --> 00:13:30,910
<font color="#E5E5E5">ad in order to off and then</font><font color="#CCCCCC"> get to</font>

365
00:13:29,170 --> 00:13:33,729
<font color="#CCCCCC">federation other things that they</font><font color="#E5E5E5"> have</font>

366
00:13:30,910 --> 00:13:35,290
through as your ad<font color="#E5E5E5"> so there's certainly</font>

367
00:13:33,730 --> 00:13:37,540
some very strong recommendations that<font color="#CCCCCC"> i</font>

368
00:13:35,290 --> 00:13:39,699
<font color="#E5E5E5">have here</font><font color="#CCCCCC"> basically if</font><font color="#E5E5E5"> you have</font><font color="#CCCCCC"> ad your</font>

369
00:13:37,540 --> 00:13:40,959
ad<font color="#E5E5E5"> connect in your environment</font><font color="#CCCCCC"> and you</font>

370
00:13:39,700 --> 00:13:42,730
<font color="#CCCCCC">have that server</font><font color="#E5E5E5"> and you are</font>

371
00:13:40,960 --> 00:13:44,050
synchronizing that<font color="#CCCCCC"> the</font><font color="#E5E5E5"> password data you</font>

372
00:13:42,730 --> 00:13:45,670
want<font color="#E5E5E5"> to protect it like</font><font color="#CCCCCC"> it a domain</font>

373
00:13:44,050 --> 00:13:46,569
controller<font color="#CCCCCC"> the other thing</font><font color="#E5E5E5"> that's</font>

374
00:13:45,670 --> 00:13:48,849
<font color="#E5E5E5">interesting in a lot of environments</font>

375
00:13:46,570 --> 00:13:51,130
<font color="#CCCCCC">that</font><font color="#E5E5E5"> have multiple forests will actually</font>

376
00:13:48,850 --> 00:13:53,440
have one azure ad connect server for it

377
00:13:51,130 --> 00:13:54,939
so this server is not just<font color="#E5E5E5"> like a junior</font>

378
00:13:53,440 --> 00:13:56,830
domain controller it's a<font color="#E5E5E5"> junior to main</font>

379
00:13:54,940 --> 00:13:58,750
controller for like all of the Active

380
00:13:56,830 --> 00:14:00,280
<font color="#E5E5E5">Directory environment so we want to</font>

381
00:13:58,750 --> 00:14:01,750
firewall this<font color="#E5E5E5"> off we're going to protect</font>

382
00:14:00,280 --> 00:14:04,480
<font color="#E5E5E5">it and keep the account operators group</font>

383
00:14:01,750 --> 00:14:05,860
<font color="#E5E5E5">empty there's also another thing that's</font>

384
00:14:04,480 --> 00:14:08,380
<font color="#CCCCCC">pretty interesting</font><font color="#E5E5E5"> that I talked about</font>

385
00:14:05,860 --> 00:14:09,850
<font color="#CCCCCC">at</font><font color="#E5E5E5"> Def Con</font><font color="#CCCCCC"> last</font><font color="#E5E5E5"> year and that was that</font>

386
00:14:08,380 --> 00:14:12,610
Federation is kind<font color="#E5E5E5"> of like a cloud</font>

387
00:14:09,850 --> 00:14:14,470
Kerberos<font color="#E5E5E5"> and so just like how you have</font>

388
00:14:12,610 --> 00:14:16,330
to protect<font color="#E5E5E5"> your curb</font><font color="#CCCCCC"> TDT password hash</font>

389
00:14:14,470 --> 00:14:18,010
in Active Directory<font color="#CCCCCC"> you also have to</font>

390
00:14:16,330 --> 00:14:19,810
<font color="#CCCCCC">protect your certificates that</font><font color="#E5E5E5"> are</font>

391
00:14:18,010 --> 00:14:22,540
<font color="#E5E5E5">installed on your Federation server like</font>

392
00:14:19,810 --> 00:14:24,550
<font color="#E5E5E5">a DFS so you'll</font><font color="#CCCCCC"> definitely want to</font><font color="#E5E5E5"> look</font>

393
00:14:22,540 --> 00:14:26,199
at<font color="#E5E5E5"> your ad FS server if you have a TF as</font>

394
00:14:24,550 --> 00:14:28,209
servers or other Federation servers on

395
00:14:26,200 --> 00:14:30,190
Prem<font color="#E5E5E5"> you want to check to</font><font color="#CCCCCC"> see who has</font>

396
00:14:28,210 --> 00:14:31,480
admin rights to<font color="#CCCCCC"> those check the</font><font color="#E5E5E5"> local</font>

397
00:14:30,190 --> 00:14:33,070
administrators group<font color="#E5E5E5"> you want to look</font><font color="#CCCCCC"> to</font>

398
00:14:31,480 --> 00:14:34,960
<font color="#E5E5E5">see who has access</font><font color="#CCCCCC"> to those on the</font>

399
00:14:33,070 --> 00:14:36,070
network<font color="#E5E5E5"> certainly not everyone on your</font>

400
00:14:34,960 --> 00:14:38,050
<font color="#E5E5E5">network should</font><font color="#CCCCCC"> be able</font><font color="#E5E5E5"> to connect to</font>

401
00:14:36,070 --> 00:14:39,580
that<font color="#E5E5E5"> server because the token and</font>

402
00:14:38,050 --> 00:14:42,219
signing certificates are effectively

403
00:14:39,580 --> 00:14:43,870
what are used to create<font color="#E5E5E5"> those tokens or</font>

404
00:14:42,220 --> 00:14:46,030
<font color="#E5E5E5">those tickets when you're dealing with</font>

405
00:14:43,870 --> 00:14:48,100
Federation and then a few months<font color="#E5E5E5"> after</font>

406
00:14:46,030 --> 00:14:50,380
<font color="#E5E5E5">this talk certainly someone figured out</font>

407
00:14:48,100 --> 00:14:52,030
how<font color="#E5E5E5"> to actually weaponize this and made</font>

408
00:14:50,380 --> 00:14:54,340
what they<font color="#E5E5E5"> call the golden sam'l attack</font>

409
00:14:52,030 --> 00:14:56,380
where if they<font color="#E5E5E5"> had these</font><font color="#CCCCCC"> certificates</font>

410
00:14:54,340 --> 00:14:58,750
<font color="#CCCCCC">they could go ahead and create their own</font>

411
00:14:56,380 --> 00:15:00,310
tickets<font color="#E5E5E5"> and say I am whoever I want to</font>

412
00:14:58,750 --> 00:15:04,150
<font color="#E5E5E5">be in this environment through</font>

413
00:15:00,310 --> 00:15:05,439
Federation etc so we find some really

414
00:15:04,150 --> 00:15:06,520
<font color="#E5E5E5">interesting things</font><font color="#CCCCCC"> when we do Active</font>

415
00:15:05,440 --> 00:15:09,340
Directory security assessments for

416
00:15:06,520 --> 00:15:11,470
customers what are<font color="#E5E5E5"> the things that</font>

417
00:15:09,340 --> 00:15:14,140
attackers really require<font color="#E5E5E5"> well they need</font>

418
00:15:11,470 --> 00:15:15,760
accounts the credentials<font color="#E5E5E5"> they need the</font>

419
00:15:14,140 --> 00:15:17,530
<font color="#E5E5E5">rights the</font><font color="#CCCCCC"> privileges associated with</font>

420
00:15:15,760 --> 00:15:19,930
those credentials<font color="#E5E5E5"> and they need access</font>

421
00:15:17,530 --> 00:15:21,579
<font color="#E5E5E5">the connectivity</font><font color="#CCCCCC"> to the resources</font><font color="#E5E5E5"> if</font>

422
00:15:19,930 --> 00:15:23,500
<font color="#E5E5E5">you're able to disrupt any one of these</font>

423
00:15:21,580 --> 00:15:25,110
<font color="#E5E5E5">things the attacker is unable</font><font color="#CCCCCC"> to do what</font>

424
00:15:23,500 --> 00:15:27,670
<font color="#CCCCCC">they want to do in your environment</font><font color="#E5E5E5"> and</font>

425
00:15:25,110 --> 00:15:30,400
<font color="#E5E5E5">one of the things that is</font><font color="#CCCCCC"> very important</font>

426
00:15:27,670 --> 00:15:31,740
<font color="#E5E5E5">to understand is</font><font color="#CCCCCC"> even if you feel</font><font color="#E5E5E5"> like I</font>

427
00:15:30,400 --> 00:15:32,939
always<font color="#E5E5E5"> have</font><font color="#CCCCCC"> to be</font><font color="#E5E5E5"> right</font>

428
00:15:31,740 --> 00:15:34,260
have to be<font color="#CCCCCC"> read a hundred percent</font><font color="#E5E5E5"> of</font>

429
00:15:32,940 --> 00:15:34,830
time the attacker only has to<font color="#E5E5E5"> be right</font>

430
00:15:34,260 --> 00:15:36,810
once

431
00:15:34,830 --> 00:15:38,340
well that's<font color="#E5E5E5"> true for the initial</font>

432
00:15:36,810 --> 00:15:40,589
foothold<font color="#E5E5E5"> once they get onto the network</font>

433
00:15:38,340 --> 00:15:43,290
<font color="#E5E5E5">but at that point that entire paradigm</font>

434
00:15:40,590 --> 00:15:44,940
shifts<font color="#E5E5E5"> and turns around because now is</font>

435
00:15:43,290 --> 00:15:47,610
the defender you have the ability to

436
00:15:44,940 --> 00:15:49,410
configure<font color="#CCCCCC"> and control your environment</font>

437
00:15:47,610 --> 00:15:51,390
<font color="#CCCCCC">jessyca</font><font color="#E5E5E5"> pain calls this building the</font>

438
00:15:49,410 --> 00:15:53,520
attackers playground<font color="#CCCCCC"> you can set</font><font color="#E5E5E5"> it up</font>

439
00:15:51,390 --> 00:15:55,080
<font color="#E5E5E5">and force these traps and tripwires</font>

440
00:15:53,520 --> 00:15:56,430
for when the attacker gets<font color="#E5E5E5"> into your</font>

441
00:15:55,080 --> 00:15:58,050
<font color="#CCCCCC">environment</font><font color="#E5E5E5"> they have</font><font color="#CCCCCC"> to go through</font>

442
00:15:56,430 --> 00:16:00,569
<font color="#CCCCCC">these things</font><font color="#E5E5E5"> and you can get alerted on</font>

443
00:15:58,050 --> 00:16:01,650
that<font color="#E5E5E5"> and at that point the attacker has</font>

444
00:16:00,570 --> 00:16:03,480
to<font color="#E5E5E5"> be right a hundred percent of the</font>

445
00:16:01,650 --> 00:16:07,590
time<font color="#E5E5E5"> you</font><font color="#CCCCCC"> just have to catch them</font><font color="#E5E5E5"> doing</font>

446
00:16:03,480 --> 00:16:11,010
<font color="#E5E5E5">something once so one big thing</font><font color="#CCCCCC"> is an</font>

447
00:16:07,590 --> 00:16:12,960
attacker do<font color="#E5E5E5"> I need two main admin</font><font color="#CCCCCC"> no</font><font color="#E5E5E5"> hey</font>

448
00:16:11,010 --> 00:16:14,730
not there's rights<font color="#E5E5E5"> all over</font><font color="#CCCCCC"> the place</font>

449
00:16:12,960 --> 00:16:16,230
there's lots of<font color="#E5E5E5"> things in</font><font color="#CCCCCC"> your common</font>

450
00:16:14,730 --> 00:16:19,050
<font color="#CCCCCC">everyday Active Directory environment</font>

451
00:16:16,230 --> 00:16:21,570
that<font color="#CCCCCC"> provides escalation paths for</font>

452
00:16:19,050 --> 00:16:24,300
attackers<font color="#E5E5E5"> there's a number of them</font>

453
00:16:21,570 --> 00:16:26,790
<font color="#E5E5E5">here's a few of what we find regularly</font>

454
00:16:24,300 --> 00:16:28,560
and we go through<font color="#CCCCCC"> and</font><font color="#E5E5E5"> analyze these and</font>

455
00:16:26,790 --> 00:16:31,110
talk to customers<font color="#E5E5E5"> about how</font><font color="#CCCCCC"> to tighten</font>

456
00:16:28,560 --> 00:16:35,000
these up<font color="#E5E5E5"> and I'm going</font><font color="#CCCCCC"> to dig into a few</font>

457
00:16:31,110 --> 00:16:37,350
<font color="#E5E5E5">of these in more detail in just a second</font>

458
00:16:35,000 --> 00:16:39,840
local administrator password not managed

459
00:16:37,350 --> 00:16:41,220
on workstations<font color="#E5E5E5"> or servers</font><font color="#CCCCCC"> a lot of</font>

460
00:16:39,840 --> 00:16:43,260
times the workstation<font color="#CCCCCC"> builds sets a</font>

461
00:16:41,220 --> 00:16:45,810
<font color="#CCCCCC">standard and it stays that way</font>

462
00:16:43,260 --> 00:16:47,460
so we compromised one workstation<font color="#CCCCCC"> to</font>

463
00:16:45,810 --> 00:16:49,199
<font color="#CCCCCC">compromised them all well</font><font color="#E5E5E5"> you can use</font>

464
00:16:47,460 --> 00:16:51,420
mini cats or something<font color="#CCCCCC"> similar</font><font color="#E5E5E5"> to dump</font>

465
00:16:49,200 --> 00:16:53,910
the credentials off that local account

466
00:16:51,420 --> 00:16:56,130
<font color="#CCCCCC">database</font><font color="#E5E5E5"> and once we have</font><font color="#CCCCCC"> that admin</font>

467
00:16:53,910 --> 00:16:58,170
account password hash<font color="#CCCCCC"> we can then try it</font>

468
00:16:56,130 --> 00:17:00,240
against all the other workstations<font color="#E5E5E5"> and a</font>

469
00:16:58,170 --> 00:17:01,170
lot of<font color="#E5E5E5"> organizations that</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> works so</font>

470
00:17:00,240 --> 00:17:03,000
you definitely<font color="#E5E5E5"> want to use something</font>

471
00:17:01,170 --> 00:17:04,379
<font color="#E5E5E5">like Microsoft</font><font color="#CCCCCC"> lapse are similar to make</font>

472
00:17:03,000 --> 00:17:06,540
sure that those passwords<font color="#E5E5E5"> actually get</font>

473
00:17:04,380 --> 00:17:09,480
<font color="#CCCCCC">rotated changed on</font><font color="#E5E5E5"> are unique in the</font>

474
00:17:06,540 --> 00:17:11,180
environment<font color="#E5E5E5"> but we also find the flip</font>

475
00:17:09,480 --> 00:17:13,740
side with organizations that<font color="#E5E5E5"> have</font><font color="#CCCCCC"> lapse</font>

476
00:17:11,180 --> 00:17:15,510
<font color="#E5E5E5">often times they will over delegate who</font>

477
00:17:13,740 --> 00:17:17,760
has access to<font color="#E5E5E5"> view these</font><font color="#CCCCCC"> lapse password</font>

478
00:17:15,510 --> 00:17:19,349
<font color="#E5E5E5">so certainly once you're changing them</font>

479
00:17:17,760 --> 00:17:22,430
you want<font color="#E5E5E5"> to make sure that you restrict</font>

480
00:17:19,349 --> 00:17:25,709
who has access to<font color="#E5E5E5"> these passwords</font>

481
00:17:22,430 --> 00:17:28,080
because<font color="#E5E5E5"> the delegation</font><font color="#CCCCCC"> of this axis is</font>

482
00:17:25,710 --> 00:17:29,940
critical and<font color="#CCCCCC"> we don't want</font><font color="#E5E5E5"> to find a</font>

483
00:17:28,079 --> 00:17:31,830
<font color="#CCCCCC">situation where there's ends up being a</font>

484
00:17:29,940 --> 00:17:33,150
<font color="#E5E5E5">hundred people that have access to</font><font color="#CCCCCC"> the</font>

485
00:17:31,830 --> 00:17:36,870
local<font color="#CCCCCC"> admin passwords across all</font>

486
00:17:33,150 --> 00:17:38,520
workstations<font color="#E5E5E5"> or even across servers</font><font color="#CCCCCC"> the</font>

487
00:17:36,870 --> 00:17:41,550
<font color="#E5E5E5">main password policy by default looks</font>

488
00:17:38,520 --> 00:17:42,750
like this<font color="#E5E5E5"> it's seven characters</font><font color="#CCCCCC"> I'm sure</font>

489
00:17:41,550 --> 00:17:44,350
everyone agrees that<font color="#E5E5E5"> that's a great</font>

490
00:17:42,750 --> 00:17:46,269
<font color="#E5E5E5">really strong</font>

491
00:17:44,350 --> 00:17:48,719
yeah<font color="#CCCCCC"> so we're gonna change</font><font color="#E5E5E5"> that we're</font>

492
00:17:46,269 --> 00:17:54,100
gonna make it<font color="#E5E5E5"> better and make</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> eight</font>

493
00:17:48,720 --> 00:17:55,990
<font color="#E5E5E5">one better obviously</font><font color="#CCCCCC"> that's not</font><font color="#E5E5E5"> a great</font>

494
00:17:54,100 --> 00:17:58,480
great setting<font color="#E5E5E5"> we've got a great way to</font>

495
00:17:55,990 --> 00:18:00,549
do<font color="#E5E5E5"> it ten is much better</font><font color="#CCCCCC"> I've set it to</font>

496
00:17:58,480 --> 00:18:02,799
<font color="#E5E5E5">twelve perfectly something more like</font>

497
00:18:00,549 --> 00:18:05,620
<font color="#CCCCCC">fifteen Microsoft</font><font color="#E5E5E5"> did an update in April</font>

498
00:18:02,799 --> 00:18:08,080
<font color="#E5E5E5">so now using Windows 10 or 2016 you can</font>

499
00:18:05,620 --> 00:18:10,389
actually set<font color="#E5E5E5"> this within the GUI to 20</font>

500
00:18:08,080 --> 00:18:13,149
so that's<font color="#E5E5E5"> a huge improvement from 14 to</font>

501
00:18:10,389 --> 00:18:16,029
<font color="#E5E5E5">20 so</font><font color="#CCCCCC"> now we can actually start cracking</font>

502
00:18:13,149 --> 00:18:17,820
that up<font color="#E5E5E5"> to to</font><font color="#CCCCCC"> force longer passwords</font><font color="#E5E5E5"> if</font>

503
00:18:16,029 --> 00:18:19,960
you have a situation where<font color="#CCCCCC"> you have a</font>

504
00:18:17,820 --> 00:18:22,658
subset of<font color="#CCCCCC"> users in your environment that</font>

505
00:18:19,960 --> 00:18:25,450
<font color="#E5E5E5">just can't have 15 or 16 character</font>

506
00:18:22,659 --> 00:18:27,340
passwords<font color="#CCCCCC"> because of legacy requirements</font>

507
00:18:25,450 --> 00:18:29,320
you<font color="#E5E5E5"> can also use fine-grained password</font>

508
00:18:27,340 --> 00:18:31,330
policies to apply to a group that<font color="#CCCCCC"> you</font>

509
00:18:29,320 --> 00:18:32,889
put<font color="#E5E5E5"> those users in and they will still</font>

510
00:18:31,330 --> 00:18:34,090
<font color="#CCCCCC">have a character</font><font color="#E5E5E5"> password for 10</font>

511
00:18:32,889 --> 00:18:39,428
character passwords or whatever's

512
00:18:34,090 --> 00:18:41,769
required<font color="#E5E5E5"> so certainly a user in a domain</font>

513
00:18:39,429 --> 00:18:44,169
admin group would<font color="#CCCCCC"> be bad but that</font><font color="#E5E5E5"> still</font>

514
00:18:41,769 --> 00:18:45,549
happens<font color="#CCCCCC"> oftentimes</font><font color="#E5E5E5"> organizations have</font>

515
00:18:44,169 --> 00:18:48,190
gone through the<font color="#CCCCCC"> process of cleaning up</font>

516
00:18:45,549 --> 00:18:51,279
and<font color="#E5E5E5"> of shifting their old single account</font>

517
00:18:48,190 --> 00:18:53,169
to a user<font color="#E5E5E5"> account and a day an admin</font>

518
00:18:51,279 --> 00:18:54,940
account<font color="#CCCCCC"> but a lot of</font><font color="#E5E5E5"> times forgets the</font>

519
00:18:53,169 --> 00:18:58,389
process of<font color="#CCCCCC"> cleaning up</font><font color="#E5E5E5"> those old user</font>

520
00:18:54,940 --> 00:19:00,159
accounts<font color="#E5E5E5"> no name account standard I</font>

521
00:18:58,389 --> 00:19:02,049
don't really<font color="#E5E5E5"> know what the admin account</font>

522
00:19:00,159 --> 00:19:03,519
standard is but I know absolutely<font color="#E5E5E5"> know</font>

523
00:19:02,049 --> 00:19:06,279
who the admins are because I<font color="#E5E5E5"> know how to</font>

524
00:19:03,519 --> 00:19:08,919
enumerate admin groups<font color="#E5E5E5"> it is not full</font>

525
00:19:06,279 --> 00:19:11,679
attackers<font color="#E5E5E5"> it's best to have</font><font color="#CCCCCC"> a very</font>

526
00:19:08,919 --> 00:19:13,149
standardized admin standard or naming

527
00:19:11,679 --> 00:19:14,919
standard because that way you can

528
00:19:13,149 --> 00:19:17,189
programmatically identify who supposed

529
00:19:14,919 --> 00:19:19,899
<font color="#E5E5E5">to be in admin groups and who isn't</font>

530
00:19:17,190 --> 00:19:22,149
so designators that clearly identify

531
00:19:19,899 --> 00:19:26,049
admin rights like something<font color="#E5E5E5"> - a</font><font color="#CCCCCC"> TA for</font>

532
00:19:22,149 --> 00:19:28,090
<font color="#CCCCCC">Active Directory</font><font color="#E5E5E5"> admin default domain</font>

533
00:19:26,049 --> 00:19:30,340
<font color="#E5E5E5">administrator account so the default</font>

534
00:19:28,090 --> 00:19:31,899
<font color="#E5E5E5">domain administrator account is it</font>

535
00:19:30,340 --> 00:19:33,879
should really be a<font color="#E5E5E5"> break class account</font>

536
00:19:31,899 --> 00:19:36,879
<font color="#E5E5E5">like only used if you really need it in</font>

537
00:19:33,879 --> 00:19:39,639
<font color="#E5E5E5">an</font><font color="#CCCCCC"> emergency but I regularly find</font><font color="#E5E5E5"> that</font>

538
00:19:36,879 --> 00:19:42,250
organizations<font color="#CCCCCC"> have set this as their</font>

539
00:19:39,639 --> 00:19:44,350
sequel service account<font color="#E5E5E5"> which</font><font color="#CCCCCC"> doesn't</font>

540
00:19:42,250 --> 00:19:46,029
<font color="#E5E5E5">seem to make a whole</font><font color="#CCCCCC"> lot of sense but</font>

541
00:19:44,350 --> 00:19:48,100
it's the admin account for the domain

542
00:19:46,029 --> 00:19:50,590
<font color="#E5E5E5">and so it has a service principle name</font>

543
00:19:48,100 --> 00:19:52,539
and if<font color="#E5E5E5"> the password hasn't been changing</font>

544
00:19:50,590 --> 00:19:54,100
in years it's<font color="#CCCCCC"> probably very</font><font color="#E5E5E5"> weak and</font>

545
00:19:52,539 --> 00:19:56,260
there's an attack method called Kerberos

546
00:19:54,100 --> 00:19:57,820
<font color="#CCCCCC">thing which enables attackers to request</font>

547
00:19:56,260 --> 00:19:59,740
a service<font color="#E5E5E5"> ticket</font>

548
00:19:57,820 --> 00:20:01,899
for this account<font color="#E5E5E5"> because</font><font color="#CCCCCC"> it has</font><font color="#E5E5E5"> a</font>

549
00:19:59,740 --> 00:20:04,450
service<font color="#CCCCCC"> principle name and then attempt</font>

550
00:20:01,899 --> 00:20:07,658
to<font color="#E5E5E5"> crack it offline</font><font color="#CCCCCC"> and there's all the</font>

551
00:20:04,450 --> 00:20:09,039
password crackers now support this and

552
00:20:07,659 --> 00:20:11,049
then of course<font color="#E5E5E5"> service</font><font color="#CCCCCC"> counts</font><font color="#E5E5E5"> of domain</font>

553
00:20:09,039 --> 00:20:13,658
admins<font color="#E5E5E5"> so service counts rarely</font><font color="#CCCCCC"> need</font>

554
00:20:11,049 --> 00:20:16,929
domain admin rights<font color="#E5E5E5"> despite what vendors</font>

555
00:20:13,659 --> 00:20:18,460
say much better to delegate exactly

556
00:20:16,929 --> 00:20:19,570
what's required<font color="#E5E5E5"> and if your vendors say</font>

557
00:20:18,460 --> 00:20:22,389
that<font color="#CCCCCC"> their their service account</font>

558
00:20:19,570 --> 00:20:24,668
requires domain admins<font color="#E5E5E5"> to</font><font color="#CCCCCC"> ask them what</font>

559
00:20:22,389 --> 00:20:26,918
<font color="#E5E5E5">the specific rights are that leads them</font>

560
00:20:24,669 --> 00:20:28,840
to that statement<font color="#E5E5E5"> push back on your</font>

561
00:20:26,919 --> 00:20:30,429
vendors<font color="#E5E5E5"> as the customer before you sign</font>

562
00:20:28,840 --> 00:20:32,769
the<font color="#CCCCCC"> contract you</font><font color="#E5E5E5"> have that ability</font><font color="#CCCCCC"> you</font>

563
00:20:30,429 --> 00:20:35,230
<font color="#CCCCCC">have that power a little more difficult</font>

564
00:20:32,769 --> 00:20:36,190
once the contracts been signed but<font color="#E5E5E5"> we</font>

565
00:20:35,230 --> 00:20:38,110
see this<font color="#E5E5E5"> all the time where the</font>

566
00:20:36,190 --> 00:20:39,639
vulnerability scanner<font color="#E5E5E5"> is the account</font>

567
00:20:38,110 --> 00:20:41,350
<font color="#E5E5E5">that's a member of domain admins because</font>

568
00:20:39,639 --> 00:20:43,330
it's got a scan workstation the server's

569
00:20:41,350 --> 00:20:45,399
domain admin<font color="#CCCCCC"> a domain controllers etc</font>

570
00:20:43,330 --> 00:20:47,199
<font color="#E5E5E5">it's much better to split this out into</font>

571
00:20:45,399 --> 00:20:49,689
<font color="#E5E5E5">separate accounts because what if this</font>

572
00:20:47,200 --> 00:20:51,519
vulnerability<font color="#E5E5E5"> scanners pickups what if</font>

573
00:20:49,690 --> 00:20:53,019
someone does a code update to it and the

574
00:20:51,519 --> 00:20:55,779
hiccups<font color="#E5E5E5"> and at least credentials</font><font color="#CCCCCC"> behind</font>

575
00:20:53,019 --> 00:20:58,029
on<font color="#E5E5E5"> one percent of systems these are</font>

576
00:20:55,779 --> 00:21:00,070
domain admin credentials that end up

577
00:20:58,029 --> 00:21:01,630
getting<font color="#CCCCCC"> left on a workstation so we want</font>

578
00:21:00,070 --> 00:21:04,210
to segment<font color="#E5E5E5"> these off we want to isolate</font>

579
00:21:01,630 --> 00:21:06,070
and have an account for scanning

580
00:21:04,210 --> 00:21:08,080
workstations one for scanning servers

581
00:21:06,070 --> 00:21:10,240
and then a totally different<font color="#E5E5E5"> one for</font>

582
00:21:08,080 --> 00:21:12,279
domain controllers if we even<font color="#E5E5E5"> want to</font>

583
00:21:10,240 --> 00:21:15,370
have that same system scanning to make

584
00:21:12,279 --> 00:21:17,110
charge server<font color="#E5E5E5"> GPOs</font><font color="#CCCCCC"> link to the</font><font color="#E5E5E5"> bank's</font>

585
00:21:15,370 --> 00:21:19,299
<font color="#E5E5E5">rollers happens all the time we have a</font>

586
00:21:17,110 --> 00:21:21,549
GPO that has a<font color="#CCCCCC"> servers policy we link it</font>

587
00:21:19,299 --> 00:21:23,470
<font color="#E5E5E5">to the domain controllers are you it</font>

588
00:21:21,549 --> 00:21:24,700
does many things<font color="#CCCCCC"> that's the security</font>

589
00:21:23,470 --> 00:21:26,980
baseline but one<font color="#CCCCCC"> of the things that</font>

590
00:21:24,700 --> 00:21:28,149
<font color="#CCCCCC">actually also</font><font color="#E5E5E5"> does is adds the server</font>

591
00:21:26,980 --> 00:21:30,399
admins group<font color="#E5E5E5"> to the local administrators</font>

592
00:21:28,149 --> 00:21:32,860
<font color="#CCCCCC">group well guess</font><font color="#E5E5E5"> what happens when we</font>

593
00:21:30,399 --> 00:21:34,840
<font color="#E5E5E5">applies to the main controller it takes</font>

594
00:21:32,860 --> 00:21:36,100
that server admins group<font color="#E5E5E5"> and adds it to</font>

595
00:21:34,840 --> 00:21:37,629
the<font color="#E5E5E5"> domain controllers local</font>

596
00:21:36,100 --> 00:21:39,340
administrators group<font color="#E5E5E5"> which happens to</font><font color="#CCCCCC"> be</font>

597
00:21:37,630 --> 00:21:41,860
the built-in administrators group<font color="#E5E5E5"> for</font>

598
00:21:39,340 --> 00:21:45,010
the domain<font color="#E5E5E5"> so now</font><font color="#CCCCCC"> our server admins are</font>

599
00:21:41,860 --> 00:21:47,110
our<font color="#E5E5E5"> Active Directory admins so even if</font>

600
00:21:45,010 --> 00:21:49,389
this configuring fee configuration is

601
00:21:47,110 --> 00:21:52,360
not in place we can<font color="#E5E5E5"> also have a</font>

602
00:21:49,389 --> 00:21:54,158
situation<font color="#E5E5E5"> where there's a baseline</font>

603
00:21:52,360 --> 00:21:56,889
security policy<font color="#CCCCCC"> that someone's created</font>

604
00:21:54,159 --> 00:21:59,110
<font color="#CCCCCC">NIC</font><font color="#E5E5E5"> is a great guy</font><font color="#CCCCCC"> he's this up for</font>

605
00:21:56,889 --> 00:22:01,178
servers domain admins are like<font color="#CCCCCC"> alright</font>

606
00:21:59,110 --> 00:22:03,250
<font color="#E5E5E5">we got to set up some sort of baseline</font>

607
00:22:01,179 --> 00:22:04,630
security policy for our<font color="#E5E5E5"> domain</font>

608
00:22:03,250 --> 00:22:06,309
controllers so what are we going<font color="#E5E5E5"> to</font><font color="#CCCCCC"> do</font>

609
00:22:04,630 --> 00:22:07,450
we're<font color="#CCCCCC"> going</font><font color="#E5E5E5"> to take what Nick did we're</font>

610
00:22:06,309 --> 00:22:09,668
gonna link<font color="#E5E5E5"> it to the main controllers</font>

611
00:22:07,450 --> 00:22:11,140
<font color="#E5E5E5">problem is that Nick still has modify</font>

612
00:22:09,669 --> 00:22:12,760
<font color="#E5E5E5">rights of that GPO</font>

613
00:22:11,140 --> 00:22:15,490
since he still has<font color="#E5E5E5"> modified right to</font>

614
00:22:12,760 --> 00:22:16,990
that GPO<font color="#E5E5E5"> he can change a group policy</font>

615
00:22:15,490 --> 00:22:19,809
that links and applies<font color="#CCCCCC"> to domain</font>

616
00:22:16,990 --> 00:22:22,450
controllers<font color="#E5E5E5"> which means that he can link</font>

617
00:22:19,809 --> 00:22:25,990
a script that<font color="#E5E5E5"> can install</font><font color="#CCCCCC"> or run code or</font>

618
00:22:22,450 --> 00:22:27,880
rollback security settings or had admins

619
00:22:25,990 --> 00:22:29,440
to<font color="#E5E5E5"> the administrators</font><font color="#CCCCCC"> group or maybe</font>

620
00:22:27,880 --> 00:22:31,929
someone taking control of<font color="#E5E5E5"> his count can</font>

621
00:22:29,440 --> 00:22:33,160
do the same so<font color="#E5E5E5"> we want to make</font><font color="#CCCCCC"> sure that</font>

622
00:22:31,929 --> 00:22:35,980
only your<font color="#E5E5E5"> act directory admins have</font>

623
00:22:33,160 --> 00:22:37,420
<font color="#E5E5E5">modify rights on these GPOs and then</font>

624
00:22:35,980 --> 00:22:38,830
cross<font color="#E5E5E5"> force administration gets really</font>

625
00:22:37,420 --> 00:22:41,080
tricky<font color="#CCCCCC"> we regularly</font><font color="#E5E5E5"> see that there's</font>

626
00:22:38,830 --> 00:22:42,580
production and there's external<font color="#CCCCCC"> to</font>

627
00:22:41,080 --> 00:22:44,379
different force it could<font color="#E5E5E5"> be production</font>

628
00:22:42,580 --> 00:22:45,909
lab it could be production and then

629
00:22:44,380 --> 00:22:47,590
something in<font color="#E5E5E5"> the DMZ it doesn't matter</font>

630
00:22:45,910 --> 00:22:49,090
there's a<font color="#CCCCCC"> one-way trust where our</font>

631
00:22:47,590 --> 00:22:51,760
external environment<font color="#CCCCCC"> trusts our</font>

632
00:22:49,090 --> 00:22:53,500
production which is the standard

633
00:22:51,760 --> 00:22:56,110
<font color="#CCCCCC">Microsoft recommendation because</font><font color="#E5E5E5"> then</font>

634
00:22:53,500 --> 00:22:58,690
our accounts<font color="#E5E5E5"> in production can</font>

635
00:22:56,110 --> 00:23:00,760
authenticate to<font color="#CCCCCC"> the</font><font color="#E5E5E5"> systems and external</font>

636
00:22:58,690 --> 00:23:02,950
the problem is that a lot<font color="#CCCCCC"> of times when</font>

637
00:23:00,760 --> 00:23:05,260
<font color="#E5E5E5">this configuration is in place the</font>

638
00:23:02,950 --> 00:23:06,940
<font color="#E5E5E5">production forced 80 admins manage the</font>

639
00:23:05,260 --> 00:23:08,919
external<font color="#CCCCCC"> force well that</font><font color="#E5E5E5"> just makes</font>

640
00:23:06,940 --> 00:23:12,520
<font color="#E5E5E5">sense but it gets how they typically do</font>

641
00:23:08,919 --> 00:23:14,679
<font color="#CCCCCC">that via</font><font color="#E5E5E5"> RDP so when you already</font><font color="#CCCCCC"> pea</font>

642
00:23:12,520 --> 00:23:16,929
into a system<font color="#E5E5E5"> you put the credentials on</font>

643
00:23:14,679 --> 00:23:19,120
that system<font color="#E5E5E5"> and when we RDP from a</font>

644
00:23:16,929 --> 00:23:22,270
production<font color="#CCCCCC"> 80</font><font color="#E5E5E5"> environment using our</font>

645
00:23:19,120 --> 00:23:24,520
production<font color="#E5E5E5"> 80 admin account and we RDP</font>

646
00:23:22,270 --> 00:23:26,440
<font color="#CCCCCC">into a domain</font><font color="#E5E5E5"> controller or something</font>

647
00:23:24,520 --> 00:23:29,168
else in this external forest environment

648
00:23:26,440 --> 00:23:31,360
we are<font color="#CCCCCC"> leaving those production ad admin</font>

649
00:23:29,169 --> 00:23:34,210
credentials into<font color="#CCCCCC"> that external untrusted</font>

650
00:23:31,360 --> 00:23:36,490
environment we don't want to do that

651
00:23:34,210 --> 00:23:39,490
because all an attacker<font color="#E5E5E5"> needs to do is</font>

652
00:23:36,490 --> 00:23:42,000
compromise that lower trusted forest in

653
00:23:39,490 --> 00:23:44,290
order<font color="#E5E5E5"> to compromise the production force</font>

654
00:23:42,000 --> 00:23:47,020
<font color="#E5E5E5">so definitely we want</font><font color="#CCCCCC"> to either manage</font>

655
00:23:44,290 --> 00:23:49,750
<font color="#E5E5E5">our external environment with external</font>

656
00:23:47,020 --> 00:23:51,340
accounts or we want<font color="#E5E5E5"> to use non</font>

657
00:23:49,750 --> 00:23:53,020
<font color="#CCCCCC">privileged production</font><font color="#E5E5E5"> forest accounts</font>

658
00:23:51,340 --> 00:23:55,750
with<font color="#E5E5E5"> admin</font><font color="#CCCCCC"> rights</font><font color="#E5E5E5"> in our external</font>

659
00:23:53,020 --> 00:23:58,000
environment<font color="#E5E5E5"> as long</font><font color="#CCCCCC"> as we're not using</font>

660
00:23:55,750 --> 00:24:00,340
<font color="#E5E5E5">the exact same admin account from</font>

661
00:23:58,000 --> 00:24:02,350
production so account operators I

662
00:24:00,340 --> 00:24:04,360
mentioned this earlier<font color="#E5E5E5"> account operators</font>

663
00:24:02,350 --> 00:24:06,399
are a<font color="#CCCCCC"> carryover from the NT</font><font color="#E5E5E5"> for days</font>

664
00:24:04,360 --> 00:24:08,559
we do not want to use<font color="#E5E5E5"> account of theirs</font>

665
00:24:06,400 --> 00:24:09,970
they kind of have outdoor rights to user

666
00:24:08,559 --> 00:24:11,559
accounts<font color="#CCCCCC"> and groups and a bunch of</font><font color="#E5E5E5"> other</font>

667
00:24:09,970 --> 00:24:13,780
things<font color="#E5E5E5"> that we don't need to</font><font color="#CCCCCC"> do anymore</font>

668
00:24:11,559 --> 00:24:15,879
<font color="#CCCCCC">it's much better to</font><font color="#E5E5E5"> custom delegate a</font>

669
00:24:13,780 --> 00:24:18,160
custom group to give it the access it

670
00:24:15,880 --> 00:24:21,040
needs<font color="#E5E5E5"> Microsoft even says don't don't</font>

671
00:24:18,160 --> 00:24:22,630
use account operators they say that it's

672
00:24:21,040 --> 00:24:24,820
a service administrator group because it

673
00:24:22,630 --> 00:24:27,940
can modify server server operators

674
00:24:24,820 --> 00:24:29,980
<font color="#E5E5E5">leave this group empty do not use it so</font>

675
00:24:27,940 --> 00:24:32,860
I plead<font color="#CCCCCC"> with you do not use account</font>

676
00:24:29,980 --> 00:24:33,789
operators one action<font color="#E5E5E5"> you can</font><font color="#CCCCCC"> take when</font>

677
00:24:32,860 --> 00:24:35,258
you get back to<font color="#CCCCCC"> work</font>

678
00:24:33,789 --> 00:24:36,940
enumerate the membership of<font color="#E5E5E5"> count</font>

679
00:24:35,259 --> 00:24:40,059
operators<font color="#E5E5E5"> if there's</font><font color="#CCCCCC"> accounts in it</font>

680
00:24:36,940 --> 00:24:41,409
figure<font color="#E5E5E5"> out how to get them</font><font color="#CCCCCC"> out</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> then</font>

681
00:24:40,059 --> 00:24:43,210
one of the other big problems is<font color="#E5E5E5"> admin</font>

682
00:24:41,409 --> 00:24:44,860
group nesting where one group<font color="#E5E5E5"> is another</font>

683
00:24:43,210 --> 00:24:46,659
group is another group<font color="#CCCCCC"> another group it</font>

684
00:24:44,860 --> 00:24:48,158
is very<font color="#E5E5E5"> difficult to</font><font color="#CCCCCC"> determine who</font><font color="#E5E5E5"> is</font>

685
00:24:46,659 --> 00:24:51,009
really an act directory admin through

686
00:24:48,159 --> 00:24:53,500
<font color="#E5E5E5">this method and we have incidental</font><font color="#CCCCCC"> or</font>

687
00:24:51,009 --> 00:24:57,850
unintended admins that<font color="#E5E5E5"> end up in these</font>

688
00:24:53,500 --> 00:24:59,289
in these groups<font color="#E5E5E5"> because of this and then</font>

689
00:24:57,850 --> 00:25:01,230
one thing to see a lot of<font color="#E5E5E5"> the time is</font>

690
00:24:59,289 --> 00:25:05,139
the<font color="#E5E5E5"> default domain controllers policy is</font>

691
00:25:01,230 --> 00:25:07,870
default the same<font color="#E5E5E5"> security policy that</font>

692
00:25:05,139 --> 00:25:11,830
<font color="#CCCCCC">Microsoft is configured and identified</font>

693
00:25:07,870 --> 00:25:15,939
from<font color="#E5E5E5"> Windows 2000</font><font color="#CCCCCC"> is still configured</font>

694
00:25:11,830 --> 00:25:17,678
today and<font color="#E5E5E5"> no one has changed it or maybe</font>

695
00:25:15,940 --> 00:25:19,240
they change it<font color="#E5E5E5"> and for some reason they</font>

696
00:25:17,679 --> 00:25:20,379
had<font color="#E5E5E5"> two main users to have the ability</font>

697
00:25:19,240 --> 00:25:23,470
to log on locally<font color="#E5E5E5"> to</font><font color="#CCCCCC"> two main</font>

698
00:25:20,379 --> 00:25:25,870
controllers the user rights assignment

699
00:25:23,470 --> 00:25:29,200
component on<font color="#CCCCCC"> GPOs that are linked to</font>

700
00:25:25,870 --> 00:25:34,029
<font color="#E5E5E5">domain controllers is an untapped bounty</font>

701
00:25:29,200 --> 00:25:35,679
for attackers admins very rarely look at

702
00:25:34,029 --> 00:25:37,419
user rights assignments<font color="#E5E5E5"> that are</font>

703
00:25:35,679 --> 00:25:38,830
configured on domain controllers<font color="#E5E5E5"> I know</font>

704
00:25:37,419 --> 00:25:40,480
this because<font color="#E5E5E5"> I look at them it's one of</font>

705
00:25:38,830 --> 00:25:42,399
the first things I look at<font color="#E5E5E5"> and then I</font>

706
00:25:40,480 --> 00:25:43,960
can identify what other accounts and

707
00:25:42,399 --> 00:25:45,850
groups have admin<font color="#CCCCCC"> rights on domain</font>

708
00:25:43,960 --> 00:25:49,360
controllers<font color="#CCCCCC"> or the</font><font color="#E5E5E5"> ability to log on to</font>

709
00:25:45,850 --> 00:25:52,330
<font color="#E5E5E5">the main controllers because if I have</font>

710
00:25:49,360 --> 00:25:53,799
this configured on a GPO that's linked

711
00:25:52,330 --> 00:25:56,769
<font color="#CCCCCC">to the domain controller show you where</font>

712
00:25:53,799 --> 00:26:00,100
server admins can log on locally<font color="#E5E5E5"> or log</font>

713
00:25:56,769 --> 00:26:01,990
on through<font color="#CCCCCC"> our</font><font color="#E5E5E5"> RDP and there's</font><font color="#CCCCCC"> ODS is</font>

714
00:26:00,100 --> 00:26:03,459
also configured where domain users can

715
00:26:01,990 --> 00:26:05,799
log on locally<font color="#E5E5E5"> this means that server</font>

716
00:26:03,460 --> 00:26:06,820
admins<font color="#E5E5E5"> any server admin can already</font><font color="#CCCCCC"> pee</font>

717
00:26:05,799 --> 00:26:09,220
into<font color="#CCCCCC"> the domain controller and</font>

718
00:26:06,820 --> 00:26:12,129
<font color="#E5E5E5">administer it or at least manage it that</font>

719
00:26:09,220 --> 00:26:13,600
way so we want to make sure<font color="#E5E5E5"> that only</font>

720
00:26:12,129 --> 00:26:16,779
<font color="#E5E5E5">our 80 admins are the ones</font><font color="#CCCCCC"> that can</font>

721
00:26:13,600 --> 00:26:19,570
manage our domain controllers<font color="#E5E5E5"> here's a</font>

722
00:26:16,779 --> 00:26:22,269
fun one<font color="#CCCCCC"> exchange requires</font><font color="#E5E5E5"> manage</font>

723
00:26:19,570 --> 00:26:24,879
auditing<font color="#E5E5E5"> and security log rights on</font>

724
00:26:22,269 --> 00:26:26,409
domain controllers<font color="#CCCCCC"> and sometimes other</font>

725
00:26:24,879 --> 00:26:29,709
groups get put in there as well<font color="#CCCCCC"> just</font>

726
00:26:26,409 --> 00:26:31,210
because<font color="#E5E5E5"> like server admins well anyone</font>

727
00:26:29,710 --> 00:26:34,840
with the<font color="#CCCCCC"> manage auditing a security log</font>

728
00:26:31,210 --> 00:26:36,490
right can clear the security but this<font color="#E5E5E5"> is</font>

729
00:26:34,840 --> 00:26:37,459
not something we want<font color="#CCCCCC"> just anyone to</font><font color="#E5E5E5"> be</font>

730
00:26:36,490 --> 00:26:40,970
able<font color="#E5E5E5"> to have</font>

731
00:26:37,460 --> 00:26:42,620
and if you've moved to<font color="#E5E5E5"> office</font><font color="#CCCCCC"> 365 and</font>

732
00:26:40,970 --> 00:26:44,090
you've cleaned<font color="#E5E5E5"> up</font><font color="#CCCCCC"> your environment</font><font color="#E5E5E5"> you</font>

733
00:26:42,620 --> 00:26:45,560
definitely want to talk to Microsoft to

734
00:26:44,090 --> 00:26:48,620
see if<font color="#E5E5E5"> this rights still required for</font>

735
00:26:45,560 --> 00:26:50,270
your<font color="#E5E5E5"> exchange servers but in the real</font>

736
00:26:48,620 --> 00:26:51,979
<font color="#E5E5E5">world rights are everywhere workstation</font>

737
00:26:50,270 --> 00:26:53,180
admins<font color="#E5E5E5"> have full control on workstations</font>

738
00:26:51,980 --> 00:26:55,820
server admins<font color="#E5E5E5"> have full control on</font>

739
00:26:53,180 --> 00:26:57,380
servers server admins<font color="#CCCCCC"> our exchange admin</font>

740
00:26:55,820 --> 00:27:00,379
sometimes server admins are condemned

741
00:26:57,380 --> 00:27:01,580
and controller admins<font color="#CCCCCC"> help this admins</font>

742
00:27:00,380 --> 00:27:04,040
have local admin rights on<font color="#CCCCCC"> all the</font>

743
00:27:01,580 --> 00:27:05,360
workstations<font color="#CCCCCC"> there's local</font><font color="#E5E5E5"> admin</font>

744
00:27:04,040 --> 00:27:07,639
accounts and passwords that<font color="#CCCCCC"> are same</font>

745
00:27:05,360 --> 00:27:10,760
across multiple systems<font color="#CCCCCC"> and then</font><font color="#E5E5E5"> we have</font>

746
00:27:07,640 --> 00:27:12,110
temporary admin accounts<font color="#CCCCCC"> we need Mike to</font>

747
00:27:10,760 --> 00:27:14,570
be<font color="#E5E5E5"> able to do something so we add Mike</font>

748
00:27:12,110 --> 00:27:15,949
to this<font color="#E5E5E5"> account this group and he's</font>

749
00:27:14,570 --> 00:27:17,629
doing<font color="#E5E5E5"> stuff and</font><font color="#CCCCCC"> we move on</font><font color="#E5E5E5"> because we've</font>

750
00:27:15,950 --> 00:27:19,790
got<font color="#E5E5E5"> 10 priority once we move on to</font>

751
00:27:17,630 --> 00:27:23,090
something<font color="#CCCCCC"> else</font><font color="#E5E5E5"> and then we don't clean</font>

752
00:27:19,790 --> 00:27:24,530
that up<font color="#E5E5E5"> again and I went through and</font>

753
00:27:23,090 --> 00:27:26,540
looked<font color="#CCCCCC"> at a</font><font color="#E5E5E5"> lot of the</font><font color="#CCCCCC"> third-party part</font>

754
00:27:24,530 --> 00:27:28,250
product permission requirements<font color="#E5E5E5"> across</font><font color="#CCCCCC"> a</font>

755
00:27:26,540 --> 00:27:29,510
large<font color="#E5E5E5"> number</font><font color="#CCCCCC"> of products and</font><font color="#E5E5E5"> I came</font><font color="#CCCCCC"> up</font>

756
00:27:28,250 --> 00:27:31,730
with<font color="#E5E5E5"> these are</font><font color="#CCCCCC"> this seem</font><font color="#E5E5E5"> to be the</font>

757
00:27:29,510 --> 00:27:33,530
common<font color="#CCCCCC"> ones</font><font color="#E5E5E5"> across all of them and as I</font>

758
00:27:31,730 --> 00:27:35,750
kept<font color="#CCCCCC"> looking at these</font><font color="#E5E5E5"> and looking at</font>

759
00:27:33,530 --> 00:27:38,180
them my eyes just glazed<font color="#CCCCCC"> over</font><font color="#E5E5E5"> but a</font>

760
00:27:35,750 --> 00:27:40,220
pattern<font color="#E5E5E5"> emerged</font><font color="#CCCCCC"> and hopefully a pattern</font>

761
00:27:38,180 --> 00:27:42,020
emerges<font color="#E5E5E5"> for you as well because as I</font>

762
00:27:40,220 --> 00:27:44,870
<font color="#E5E5E5">started</font><font color="#CCCCCC"> looking at it I saw that over</font>

763
00:27:42,020 --> 00:27:48,470
<font color="#CCCCCC">and over</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> over again</font><font color="#E5E5E5"> these products</font>

764
00:27:44,870 --> 00:27:50,929
were requiring domain admins<font color="#E5E5E5"> why because</font>

765
00:27:48,470 --> 00:27:54,080
it makes it easier<font color="#E5E5E5"> it makes</font><font color="#CCCCCC"> it easier</font>

766
00:27:50,930 --> 00:27:55,640
from a development perspective when they

767
00:27:54,080 --> 00:27:57,439
develop the product domain admins this

768
00:27:55,640 --> 00:27:59,420
works for everything<font color="#E5E5E5"> from</font><font color="#CCCCCC"> a sales</font>

769
00:27:57,440 --> 00:28:02,210
perspective<font color="#E5E5E5"> here install it this way it</font>

770
00:27:59,420 --> 00:28:04,340
takes<font color="#E5E5E5"> five minutes from a post sales</font>

771
00:28:02,210 --> 00:28:05,870
perspective<font color="#E5E5E5"> you have all the rights</font>

772
00:28:04,340 --> 00:28:07,100
<font color="#E5E5E5">everything's configured for the product</font>

773
00:28:05,870 --> 00:28:09,739
to<font color="#CCCCCC"> work there's never</font><font color="#E5E5E5"> going to be a</font>

774
00:28:07,100 --> 00:28:12,169
problem<font color="#E5E5E5"> with permissions probably so</font>

775
00:28:09,740 --> 00:28:13,910
everything<font color="#CCCCCC"> just works</font><font color="#E5E5E5"> but this makes it</font>

776
00:28:12,170 --> 00:28:17,240
easy for<font color="#E5E5E5"> the vendor it is way too easy</font>

777
00:28:13,910 --> 00:28:19,670
<font color="#CCCCCC">for</font><font color="#E5E5E5"> the vendor I had a friend who was</font>

778
00:28:17,240 --> 00:28:21,530
<font color="#CCCCCC">working at a customer</font><font color="#E5E5E5"> site and the VPN</font>

779
00:28:19,670 --> 00:28:23,510
vendor said that they are<font color="#E5E5E5"> VPN service</font>

780
00:28:21,530 --> 00:28:27,410
<font color="#CCCCCC">account needed domain admin rights</font>

781
00:28:23,510 --> 00:28:29,000
I said why that doesn't<font color="#CCCCCC"> make</font><font color="#E5E5E5"> sense so we</font>

782
00:28:27,410 --> 00:28:31,010
asked the VPN<font color="#E5E5E5"> provider and the VPN</font>

783
00:28:29,000 --> 00:28:34,460
provider said well if a user's password

784
00:28:31,010 --> 00:28:35,960
expires<font color="#E5E5E5"> they can't VPN we provide them</font>

785
00:28:34,460 --> 00:28:36,920
the ability to<font color="#E5E5E5"> change their password so</font>

786
00:28:35,960 --> 00:28:39,860
we<font color="#E5E5E5"> need to be able</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> change the</font>

787
00:28:36,920 --> 00:28:42,050
password<font color="#E5E5E5"> said</font><font color="#CCCCCC"> okay well that's pretty</font>

788
00:28:39,860 --> 00:28:43,399
<font color="#E5E5E5">easy that's like one of</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> most basic</font>

789
00:28:42,050 --> 00:28:44,899
<font color="#CCCCCC">things you</font><font color="#E5E5E5"> do in Active Directory is</font>

790
00:28:43,400 --> 00:28:47,560
<font color="#E5E5E5">deling they delegating the ability to</font>

791
00:28:44,900 --> 00:28:47,560
change password

792
00:28:48,050 --> 00:28:51,770
but there's also over<font color="#E5E5E5"> permission</font>

793
00:28:49,820 --> 00:28:53,060
delegation where we use the built-in

794
00:28:51,770 --> 00:28:54,950
groups<font color="#E5E5E5"> for delegation or we click the</font>

795
00:28:53,060 --> 00:28:56,629
easy button<font color="#E5E5E5"> so we do full control at the</font>

796
00:28:54,950 --> 00:28:58,730
domain<font color="#CCCCCC"> root we just want to make</font><font color="#E5E5E5"> it work</font>

797
00:28:56,630 --> 00:28:59,900
and the delegation tools<font color="#CCCCCC"> and Active</font>

798
00:28:58,730 --> 00:29:01,010
<font color="#CCCCCC">Directory are very challenging I don't</font>

799
00:28:59,900 --> 00:29:02,870
know if anyone has<font color="#CCCCCC"> ever</font><font color="#E5E5E5"> tried</font><font color="#CCCCCC"> to use</font>

800
00:29:01,010 --> 00:29:04,670
<font color="#E5E5E5">this to figure out what permissions are</font>

801
00:29:02,870 --> 00:29:07,100
in their environment but<font color="#E5E5E5"> it's my</font>

802
00:29:04,670 --> 00:29:08,960
<font color="#E5E5E5">impossible because just looking at this</font>

803
00:29:07,100 --> 00:29:10,219
<font color="#E5E5E5">right now there's a major security issue</font>

804
00:29:08,960 --> 00:29:13,930
<font color="#E5E5E5">and no one's seen it yet</font>

805
00:29:10,220 --> 00:29:15,800
this is illustrating my point perfectly

806
00:29:13,930 --> 00:29:17,570
<font color="#E5E5E5">here</font><font color="#CCCCCC"> I'll highlight</font><font color="#E5E5E5"> for you</font>

807
00:29:15,800 --> 00:29:19,430
<font color="#E5E5E5">domain computers for some reason was</font>

808
00:29:17,570 --> 00:29:22,010
delegated<font color="#E5E5E5"> full control on this oh you</font>

809
00:29:19,430 --> 00:29:23,690
<font color="#E5E5E5">wherever the so us that means compromise</font>

810
00:29:22,010 --> 00:29:25,820
of one computer anywhere in the

811
00:29:23,690 --> 00:29:28,220
<font color="#E5E5E5">organization would have full control</font><font color="#CCCCCC"> on</font>

812
00:29:25,820 --> 00:29:30,950
<font color="#E5E5E5">the so you and all the objects in it so</font>

813
00:29:28,220 --> 00:29:33,980
this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> vou that contains all</font><font color="#E5E5E5"> the user</font>

814
00:29:30,950 --> 00:29:38,060
accounts<font color="#E5E5E5"> or computers or</font><font color="#CCCCCC"> workstations or</font>

815
00:29:33,980 --> 00:29:40,490
servers that<font color="#E5E5E5"> can</font><font color="#CCCCCC"> be quite</font><font color="#E5E5E5"> problematic so</font>

816
00:29:38,060 --> 00:29:41,780
there<font color="#E5E5E5"> are ways to get oh you permissions</font>

817
00:29:40,490 --> 00:29:43,820
report we can<font color="#E5E5E5"> use PowerShell</font>

818
00:29:41,780 --> 00:29:47,480
<font color="#E5E5E5">which is my favorite because I love</font>

819
00:29:43,820 --> 00:29:50,270
PowerShell<font color="#CCCCCC"> and so in the slides which</font>

820
00:29:47,480 --> 00:29:52,130
I'll put<font color="#CCCCCC"> up</font><font color="#E5E5E5"> on</font><font color="#CCCCCC"> 80 security later</font><font color="#E5E5E5"> I have</font>

821
00:29:50,270 --> 00:29:54,530
a<font color="#CCCCCC"> PowerShell</font><font color="#E5E5E5"> link on how to use</font>

822
00:29:52,130 --> 00:29:55,970
PowerShell<font color="#E5E5E5"> to develop and and put</font>

823
00:29:54,530 --> 00:29:58,190
together<font color="#CCCCCC"> the</font><font color="#E5E5E5"> so you permission report</font>

824
00:29:55,970 --> 00:30:01,220
and we<font color="#CCCCCC"> can filter off of this in</font><font color="#E5E5E5"> Excel</font>

825
00:29:58,190 --> 00:30:03,530
because<font color="#CCCCCC"> it just</font><font color="#E5E5E5"> outputs to a CSV what</font>

826
00:30:01,220 --> 00:30:04,850
those<font color="#E5E5E5"> rights are and what those identity</font>

827
00:30:03,530 --> 00:30:07,190
references are those groups<font color="#CCCCCC"> those</font>

828
00:30:04,850 --> 00:30:08,959
accounts that<font color="#CCCCCC"> have our custom the ones</font>

829
00:30:07,190 --> 00:30:10,400
that are<font color="#E5E5E5"> not the built-in ones just by</font>

830
00:30:08,960 --> 00:30:11,720
looking at<font color="#E5E5E5"> those</font><font color="#CCCCCC"> we can highlight and go</font>

831
00:30:10,400 --> 00:30:13,670
well that<font color="#E5E5E5"> looks weird that shouldn't be</font>

832
00:30:11,720 --> 00:30:16,130
that<font color="#CCCCCC"> way</font><font color="#E5E5E5"> why is that configured that</font><font color="#CCCCCC"> how</font>

833
00:30:13,670 --> 00:30:19,100
<font color="#CCCCCC">come has helped us here to one and tier</font>

834
00:30:16,130 --> 00:30:22,280
<font color="#CCCCCC">to have those full control</font><font color="#E5E5E5"> rights</font>

835
00:30:19,100 --> 00:30:23,870
generic all<font color="#CCCCCC"> those full control and then</font>

836
00:30:22,280 --> 00:30:26,000
there's a tool that was<font color="#E5E5E5"> released called</font>

837
00:30:23,870 --> 00:30:28,159
<font color="#CCCCCC">ac-lite</font><font color="#E5E5E5"> by cyber-ark</font>

838
00:30:26,000 --> 00:30:30,980
and it goes through and does<font color="#CCCCCC"> a</font><font color="#E5E5E5"> lot of us</font>

839
00:30:28,160 --> 00:30:33,740
work<font color="#CCCCCC"> for you which is great now ac-lite</font>

840
00:30:30,980 --> 00:30:35,750
<font color="#E5E5E5">leverages invoke</font><font color="#CCCCCC"> ACL scanner which is a</font>

841
00:30:33,740 --> 00:30:38,930
<font color="#E5E5E5">function written</font><font color="#CCCCCC"> by will Schrader</font><font color="#E5E5E5"> it is</font>

842
00:30:35,750 --> 00:30:40,430
part of Power View and so invoke ACL

843
00:30:38,930 --> 00:30:43,820
scanner will scan through<font color="#CCCCCC"> the y-o-u</font>

844
00:30:40,430 --> 00:30:45,410
or the domain<font color="#CCCCCC"> or OU's and look at the</font>

845
00:30:43,820 --> 00:30:46,730
permissions<font color="#E5E5E5"> and depending I you can</font>

846
00:30:45,410 --> 00:30:48,380
figure<font color="#E5E5E5"> it it'll give you information on</font>

847
00:30:46,730 --> 00:30:50,150
what<font color="#E5E5E5"> the o'you permissions are and how</font>

848
00:30:48,380 --> 00:30:51,740
things are delegated<font color="#CCCCCC"> ac-lite</font>

849
00:30:50,150 --> 00:30:54,650
speeds this up and<font color="#E5E5E5"> makes it much easier</font>

850
00:30:51,740 --> 00:30:56,840
<font color="#E5E5E5">because it leverages info KCl scanner</font>

851
00:30:54,650 --> 00:30:58,700
and then spits out a bunch<font color="#E5E5E5"> of reports</font>

852
00:30:56,840 --> 00:31:01,110
<font color="#E5E5E5">like accounts with extra permissions</font><font color="#CCCCCC"> or</font>

853
00:30:58,700 --> 00:31:03,809
all entities<font color="#E5E5E5"> with extra permissions so</font>

854
00:31:01,110 --> 00:31:06,238
<font color="#E5E5E5">oops accounts computers and then there's</font>

855
00:31:03,809 --> 00:31:07,408
CSV reports that show up so it's a batch

856
00:31:06,239 --> 00:31:09,059
file<font color="#CCCCCC"> you run that</font><font color="#E5E5E5"> it does some</font>

857
00:31:07,409 --> 00:31:12,090
<font color="#E5E5E5">PowerShell gets the</font><font color="#CCCCCC"> information</font><font color="#E5E5E5"> and</font>

858
00:31:09,059 --> 00:31:13,289
gives you report<font color="#E5E5E5"> makes it easy and then</font>

859
00:31:12,090 --> 00:31:15,449
there's also bloodhound<font color="#CCCCCC"> it's a little</font>

860
00:31:13,289 --> 00:31:16,889
more complex<font color="#CCCCCC"> but if you use bloodhound</font>

861
00:31:15,450 --> 00:31:19,470
before it gathers the same sort of

862
00:31:16,889 --> 00:31:20,758
<font color="#E5E5E5">information it used</font><font color="#CCCCCC"> invoke</font><font color="#E5E5E5"> a CL scanner</font>

863
00:31:19,470 --> 00:31:23,909
as part<font color="#E5E5E5"> of the</font><font color="#CCCCCC"> powershell and gesture</font>

864
00:31:20,759 --> 00:31:25,830
<font color="#E5E5E5">now it uses a c-sharp and gesture and i</font>

865
00:31:23,909 --> 00:31:29,429
have the links here and again those will

866
00:31:25,830 --> 00:31:30,960
<font color="#E5E5E5">be in the slides</font><font color="#CCCCCC"> and there's also the ad</font>

867
00:31:29,429 --> 00:31:32,730
<font color="#CCCCCC">ACL white paper that was</font><font color="#E5E5E5"> written by</font>

868
00:31:30,960 --> 00:31:34,529
<font color="#E5E5E5">Annie Robbins</font><font color="#CCCCCC"> well Schrader who spoke at</font>

869
00:31:32,730 --> 00:31:36,330
blackhat<font color="#E5E5E5"> last year more about if you're</font>

870
00:31:34,529 --> 00:31:40,889
<font color="#E5E5E5">interested in</font><font color="#CCCCCC"> eighty ackles</font><font color="#E5E5E5"> and how they</font>

871
00:31:36,330 --> 00:31:42,840
work<font color="#E5E5E5"> so if you want to effectively</font>

872
00:31:40,889 --> 00:31:44,189
<font color="#E5E5E5">detect attacks on your network there's a</font>

873
00:31:42,840 --> 00:31:45,359
few different things<font color="#E5E5E5"> you can do first of</font>

874
00:31:44,190 --> 00:31:47,789
<font color="#E5E5E5">all you want to</font><font color="#CCCCCC"> make sure</font><font color="#E5E5E5"> the logging is</font>

875
00:31:45,359 --> 00:31:49,350
appropriate<font color="#E5E5E5"> way too often I found domain</font>

876
00:31:47,789 --> 00:31:51,539
controllers don't<font color="#E5E5E5"> have the best logging</font>

877
00:31:49,350 --> 00:31:54,389
or are not<font color="#E5E5E5"> configured appropriately</font><font color="#CCCCCC"> with</font>

878
00:31:51,539 --> 00:31:56,158
logging for<font color="#E5E5E5"> Active Directory so there's</font>

879
00:31:54,389 --> 00:31:58,289
this attack method called Kerberos sting

880
00:31:56,159 --> 00:32:00,899
which I mentioned earlier<font color="#E5E5E5"> which is very</font>

881
00:31:58,289 --> 00:32:01,919
simply you look for all of<font color="#CCCCCC"> the accounts</font>

882
00:32:00,899 --> 00:32:03,479
<font color="#CCCCCC">and Active Directory all the user</font>

883
00:32:01,919 --> 00:32:06,239
<font color="#E5E5E5">accounts with service</font><font color="#CCCCCC"> principle names</font>

884
00:32:03,480 --> 00:32:08,460
<font color="#E5E5E5">which is required for Kerberos to work</font>

885
00:32:06,239 --> 00:32:10,139
for authentication<font color="#CCCCCC"> and once we identify</font>

886
00:32:08,460 --> 00:32:11,820
<font color="#E5E5E5">all those user accounts that have</font>

887
00:32:10,139 --> 00:32:13,469
<font color="#E5E5E5">associated service</font><font color="#CCCCCC"> principle names</font>

888
00:32:11,820 --> 00:32:15,539
we're going to<font color="#CCCCCC"> request service</font><font color="#E5E5E5"> tickets</font>

889
00:32:13,470 --> 00:32:17,609
for every one of<font color="#E5E5E5"> those once we get those</font>

890
00:32:15,539 --> 00:32:18,840
service tickets<font color="#E5E5E5"> well first of all we</font>

891
00:32:17,609 --> 00:32:21,059
need<font color="#CCCCCC"> to make sure</font><font color="#E5E5E5"> that they're encrypted</font>

892
00:32:18,840 --> 00:32:23,519
with<font color="#CCCCCC"> our chief or what's</font><font color="#E5E5E5"> special about</font>

893
00:32:21,059 --> 00:32:25,080
our<font color="#E5E5E5"> chief or well the ntlm password hash</font>

894
00:32:23,519 --> 00:32:27,269
is what's used to<font color="#E5E5E5"> actually encrypt that</font>

895
00:32:25,080 --> 00:32:28,918
service ticket so if you<font color="#E5E5E5"> take that</font>

896
00:32:27,269 --> 00:32:32,399
service ticket<font color="#E5E5E5"> that's encrypted with the</font>

897
00:32:28,919 --> 00:32:34,649
<font color="#E5E5E5">ntlm password hash we take that line and</font>

898
00:32:32,399 --> 00:32:36,479
<font color="#CCCCCC">we can attempt to crack it so Tim</font><font color="#E5E5E5"> Medina</font>

899
00:32:34,649 --> 00:32:38,340
this out a few<font color="#CCCCCC"> years</font><font color="#E5E5E5"> ago and spoke about</font>

900
00:32:36,480 --> 00:32:40,830
<font color="#E5E5E5">at Derby con released the Kerberos tool</font>

901
00:32:38,340 --> 00:32:42,869
<font color="#E5E5E5">and in this very simple basic powershell</font>

902
00:32:40,830 --> 00:32:44,070
script<font color="#CCCCCC"> i effectively did this i went</font>

903
00:32:42,869 --> 00:32:45,779
through<font color="#CCCCCC"> and</font><font color="#E5E5E5"> identified</font><font color="#CCCCCC"> what</font><font color="#E5E5E5"> those</font>

904
00:32:44,070 --> 00:32:47,939
accounts<font color="#E5E5E5"> are with service</font><font color="#CCCCCC"> principle</font>

905
00:32:45,779 --> 00:32:49,950
names and then requested service tickets

906
00:32:47,940 --> 00:32:51,960
for each of these and got a service

907
00:32:49,950 --> 00:32:53,789
<font color="#CCCCCC">ticket for every one of those</font><font color="#E5E5E5"> accounts</font>

908
00:32:51,960 --> 00:32:56,330
<font color="#E5E5E5">then i just take those offline</font>

909
00:32:53,789 --> 00:32:58,590
I run a dictionary word<font color="#E5E5E5"> list hybrid</font>

910
00:32:56,330 --> 00:33:00,869
<font color="#E5E5E5">password cracker against it it's going</font>

911
00:32:58,590 --> 00:33:03,029
<font color="#CCCCCC">to create an ntl</font><font color="#E5E5E5"> and password hash and</font>

912
00:33:00,869 --> 00:33:05,820
then attempt<font color="#CCCCCC"> to open</font><font color="#E5E5E5"> that service ticket</font>

913
00:33:03,029 --> 00:33:08,249
<font color="#E5E5E5">once it</font><font color="#CCCCCC"> opens it</font><font color="#E5E5E5"> I'm golden I know what</font>

914
00:33:05,820 --> 00:33:10,200
the password is and for service<font color="#CCCCCC"> counts</font>

915
00:33:08,249 --> 00:33:11,669
that<font color="#E5E5E5"> were created and have had passwords</font>

916
00:33:10,200 --> 00:33:13,200
<font color="#CCCCCC">that haven't changed and I don't know</font>

917
00:33:11,669 --> 00:33:13,950
<font color="#E5E5E5">three years</font><font color="#CCCCCC"> four years five years ten</font>

918
00:33:13,200 --> 00:33:15,750
<font color="#CCCCCC">years</font>

919
00:33:13,950 --> 00:33:17,510
<font color="#CCCCCC">I don't know about you but passwords I</font>

920
00:33:15,750 --> 00:33:19,679
created<font color="#CCCCCC"> ten years ago</font><font color="#E5E5E5"> we're awful</font>

921
00:33:17,510 --> 00:33:21,799
<font color="#CCCCCC">pastors I</font><font color="#E5E5E5"> created five years ago we're</font>

922
00:33:19,679 --> 00:33:24,570
slightly better<font color="#CCCCCC"> a</font><font color="#E5E5E5"> little better today</font>

923
00:33:21,799 --> 00:33:26,460
<font color="#CCCCCC">course staple of battery it's the horse</font>

924
00:33:24,570 --> 00:33:30,928
battery staple<font color="#CCCCCC"> yeah</font><font color="#E5E5E5"> something like that</font>

925
00:33:26,460 --> 00:33:33,240
don't use that<font color="#CCCCCC"> okay</font><font color="#E5E5E5"> so I figured out how</font>

926
00:33:30,929 --> 00:33:36,000
<font color="#CCCCCC">to detect</font><font color="#E5E5E5"> kerberos</font><font color="#CCCCCC"> ting</font><font color="#E5E5E5"> by looking at of</font>

927
00:33:33,240 --> 00:33:37,620
<font color="#E5E5E5">NIT 4769 which is when a user request</font><font color="#CCCCCC"> a</font>

928
00:33:36,000 --> 00:33:40,139
service<font color="#E5E5E5"> ticket with specific ticket</font>

929
00:33:37,620 --> 00:33:43,439
options<font color="#E5E5E5"> and specific ticket encryption</font><font color="#CCCCCC"> 0</font>

930
00:33:40,139 --> 00:33:45,809
<font color="#CCCCCC">by 17 is</font><font color="#E5E5E5"> our c4 so we filter out some</font>

931
00:33:43,440 --> 00:33:47,220
things<font color="#E5E5E5"> we identify that there's other</font>

932
00:33:45,809 --> 00:33:49,110
types of<font color="#CCCCCC"> tickets</font><font color="#E5E5E5"> that actually use our</font>

933
00:33:47,220 --> 00:33:50,909
c4<font color="#E5E5E5"> regularly so we can filter those out</font>

934
00:33:49,110 --> 00:33:52,918
in our environment<font color="#E5E5E5"> and then once we do</font>

935
00:33:50,909 --> 00:33:56,190
<font color="#CCCCCC">that we</font><font color="#E5E5E5"> can identify that someone like</font>

936
00:33:52,919 --> 00:33:57,840
Joe here at<font color="#CCCCCC"> nine o'clock is kerberos</font>

937
00:33:56,190 --> 00:33:59,309
ting the environment at<font color="#E5E5E5"> least he's</font>

938
00:33:57,840 --> 00:34:03,269
requesting service tickets for all<font color="#E5E5E5"> these</font>

939
00:33:59,309 --> 00:34:04,408
different<font color="#CCCCCC"> services okay Shawn but what</font>

940
00:34:03,269 --> 00:34:04,799
if the attacker doesn't<font color="#E5E5E5"> do it all at</font>

941
00:34:04,409 --> 00:34:06,539
once

942
00:34:04,799 --> 00:34:08,099
that looks<font color="#E5E5E5"> really suspicious I see that</font>

943
00:34:06,539 --> 00:34:10,440
that's obvious but<font color="#E5E5E5"> what if they do it</font>

944
00:34:08,099 --> 00:34:11,879
<font color="#E5E5E5">over days or</font><font color="#CCCCCC"> weeks or months because</font>

945
00:34:10,440 --> 00:34:13,139
they've got plenty of time and these

946
00:34:11,879 --> 00:34:15,270
<font color="#CCCCCC">service count</font><font color="#E5E5E5"> passers don't change</font>

947
00:34:13,139 --> 00:34:18,149
anyway so it doesn't<font color="#CCCCCC"> it doesn't matter</font>

948
00:34:15,270 --> 00:34:20,099
<font color="#E5E5E5">okay</font><font color="#CCCCCC"> so I figured out</font><font color="#E5E5E5"> that we</font><font color="#CCCCCC"> could</font>

949
00:34:18,149 --> 00:34:22,589
actually honeypot this we can<font color="#E5E5E5"> create an</font>

950
00:34:20,099 --> 00:34:23,700
account<font color="#CCCCCC"> I call it here Kerberos honeypot</font>

951
00:34:22,589 --> 00:34:24,089
I recommend that<font color="#E5E5E5"> you use something</font>

952
00:34:23,699 --> 00:34:27,328
different

953
00:34:24,089 --> 00:34:29,310
<font color="#CCCCCC">I said admin</font><font color="#E5E5E5"> council one which makes it</font>

954
00:34:27,329 --> 00:34:31,020
interesting<font color="#E5E5E5"> any account with admin</font>

955
00:34:29,310 --> 00:34:33,000
<font color="#CCCCCC">counselor</font><font color="#E5E5E5"> to one is a probable</font><font color="#CCCCCC"> active</font>

956
00:34:31,020 --> 00:34:34,199
<font color="#CCCCCC">directory admin account because of the</font>

957
00:34:33,000 --> 00:34:36,899
way that<font color="#E5E5E5"> act directory works in</font>

958
00:34:34,199 --> 00:34:39,859
protecting domain admins<font color="#E5E5E5"> administrators</font>

959
00:34:36,899 --> 00:34:42,179
enterprise admin schema admins etc<font color="#E5E5E5"> and</font>

960
00:34:39,859 --> 00:34:44,069
so<font color="#E5E5E5"> I create a service principle</font><font color="#CCCCCC"> named</font><font color="#E5E5E5"> I</font>

961
00:34:42,179 --> 00:34:45,869
created the service principle<font color="#E5E5E5"> name it</font>

962
00:34:44,069 --> 00:34:50,279
does<font color="#E5E5E5"> not exist it</font><font color="#CCCCCC"> is not valid on the</font>

963
00:34:45,869 --> 00:34:53,520
network<font color="#E5E5E5"> it does nothing</font><font color="#CCCCCC"> so there's no</font>

964
00:34:50,280 --> 00:34:55,950
<font color="#E5E5E5">reason for anyone to ever request it so</font>

965
00:34:53,520 --> 00:34:57,810
of<font color="#E5E5E5"> course someone does we look for a</font>

966
00:34:55,949 --> 00:35:00,390
user account with admin<font color="#CCCCCC"> counts that's</font><font color="#E5E5E5"> a</font>

967
00:34:57,810 --> 00:35:01,859
one service<font color="#E5E5E5"> principle</font><font color="#CCCCCC"> name</font><font color="#E5E5E5"> set and then</font>

968
00:35:00,390 --> 00:35:03,540
we go ahead<font color="#CCCCCC"> and go through</font><font color="#E5E5E5"> in Kerberos</font>

969
00:35:01,859 --> 00:35:05,578
step and hopefully<font color="#CCCCCC"> they didn't look</font>

970
00:35:03,540 --> 00:35:06,990
<font color="#E5E5E5">don't look too closely at what my</font>

971
00:35:05,579 --> 00:35:09,780
service<font color="#E5E5E5"> principle name is because then</font>

972
00:35:06,990 --> 00:35:11,160
they figure<font color="#CCCCCC"> out it's actually a trap</font><font color="#E5E5E5"> but</font>

973
00:35:09,780 --> 00:35:14,460
you can see at the bottom<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> the this</font>

974
00:35:11,160 --> 00:35:15,839
<font color="#E5E5E5">session key type is</font><font color="#CCCCCC"> Archie 4h max so</font>

975
00:35:14,460 --> 00:35:19,349
it's<font color="#CCCCCC"> Archie</font><font color="#E5E5E5"> for</font><font color="#CCCCCC"> its</font><font color="#E5E5E5"> encrypted</font><font color="#CCCCCC"> with that</font>

976
00:35:15,839 --> 00:35:21,450
ntlm password option<font color="#E5E5E5"> and so now I run</font>

977
00:35:19,349 --> 00:35:23,609
<font color="#E5E5E5">the same</font><font color="#CCCCCC"> detection and look there's the</font>

978
00:35:21,450 --> 00:35:25,529
<font color="#E5E5E5">honeypot account well that's obvious</font>

979
00:35:23,609 --> 00:35:26,970
that something<font color="#E5E5E5"> malicious is going on and</font>

980
00:35:25,530 --> 00:35:27,850
if we<font color="#E5E5E5"> take that one step</font><font color="#CCCCCC"> forward I don't</font>

981
00:35:26,970 --> 00:35:29,890
<font color="#CCCCCC">even have to look for</font>

982
00:35:27,850 --> 00:35:32,440
all the 4769<font color="#CCCCCC"> I just have to</font><font color="#E5E5E5"> look</font><font color="#CCCCCC"> for</font>

983
00:35:29,890 --> 00:35:33,549
<font color="#CCCCCC">that one once</font><font color="#E5E5E5"> I</font><font color="#CCCCCC"> get</font><font color="#E5E5E5"> that one I know that</font>

984
00:35:32,440 --> 00:35:37,060
<font color="#E5E5E5">someone's doing</font><font color="#CCCCCC"> something they shouldn't</font>

985
00:35:33,550 --> 00:35:39,040
<font color="#CCCCCC">be doing well and</font><font color="#E5E5E5"> then I went and took</font>

986
00:35:37,060 --> 00:35:40,600
this one step<font color="#CCCCCC"> further I was like what if</font>

987
00:35:39,040 --> 00:35:43,660
I could prevent this what if I set these

988
00:35:40,600 --> 00:35:48,040
two options<font color="#E5E5E5"> on the service</font><font color="#CCCCCC"> count</font><font color="#E5E5E5"> that</font>

989
00:35:43,660 --> 00:35:50,560
say supports aes-128 supports is<font color="#E5E5E5"> 256</font><font color="#CCCCCC"> so</font>

990
00:35:48,040 --> 00:35:54,490
I did that<font color="#CCCCCC"> and guess what happened</font><font color="#E5E5E5"> now I</font>

991
00:35:50,560 --> 00:35:56,680
get a an<font color="#E5E5E5"> Aes Kerberos ticket now this</font>

992
00:35:54,490 --> 00:35:58,629
<font color="#CCCCCC">isn't going</font><font color="#E5E5E5"> to break everything there</font>

993
00:35:56,680 --> 00:36:00,520
<font color="#E5E5E5">are still ways to</font><font color="#CCCCCC"> request an RFC for</font>

994
00:35:58,630 --> 00:36:02,920
ticket but<font color="#E5E5E5"> the standard method of</font>

995
00:36:00,520 --> 00:36:05,410
<font color="#E5E5E5">Kerberos</font><font color="#CCCCCC"> ting breaks and most of the</font>

996
00:36:02,920 --> 00:36:06,730
tools<font color="#CCCCCC"> that use Kerberos it breaks</font><font color="#E5E5E5"> so if</font>

997
00:36:05,410 --> 00:36:08,620
<font color="#CCCCCC">you're able</font><font color="#E5E5E5"> to set your service</font>

998
00:36:06,730 --> 00:36:10,450
<font color="#E5E5E5">principle your service counts that</font>

999
00:36:08,620 --> 00:36:13,000
obviously user accounts<font color="#E5E5E5"> that have spins</font>

1000
00:36:10,450 --> 00:36:14,500
if you're<font color="#CCCCCC"> able to set them for AES</font><font color="#E5E5E5"> I</font>

1001
00:36:13,000 --> 00:36:18,220
highly recommend you do because it does

1002
00:36:14,500 --> 00:36:19,570
break<font color="#E5E5E5"> the attackers normal playbook so</font>

1003
00:36:18,220 --> 00:36:21,850
password spraying is something that is

1004
00:36:19,570 --> 00:36:23,880
<font color="#E5E5E5">very popular and attackers absolutely</font>

1005
00:36:21,850 --> 00:36:26,290
love<font color="#CCCCCC"> doing this</font><font color="#E5E5E5"> red teamers</font><font color="#CCCCCC"> pen testers</font>

1006
00:36:23,880 --> 00:36:28,570
the whole concept<font color="#E5E5E5"> of</font><font color="#CCCCCC"> an account lockout</font>

1007
00:36:26,290 --> 00:36:30,610
for user<font color="#E5E5E5"> accounts was built around the</font>

1008
00:36:28,570 --> 00:36:32,620
concept<font color="#CCCCCC"> that you can only guess this</font>

1009
00:36:30,610 --> 00:36:34,230
many accounts<font color="#E5E5E5"> and then I'm gonna lock</font>

1010
00:36:32,620 --> 00:36:36,220
out that account

1011
00:36:34,230 --> 00:36:38,590
well what ends up happening with

1012
00:36:36,220 --> 00:36:40,660
<font color="#E5E5E5">lockouts</font><font color="#CCCCCC"> I lock out my account</font><font color="#E5E5E5"> because</font><font color="#CCCCCC"> I</font>

1013
00:36:38,590 --> 00:36:44,320
only realized on the<font color="#E5E5E5"> fourth attempt that</font>

1014
00:36:40,660 --> 00:36:45,850
my caps lock was enabled<font color="#E5E5E5"> and then the</font>

1015
00:36:44,320 --> 00:36:48,100
next one<font color="#CCCCCC"> I flubbed it</font><font color="#E5E5E5"> because someone</font>

1016
00:36:45,850 --> 00:36:50,290
said<font color="#CCCCCC"> my name now I have to wait 30</font>

1017
00:36:48,100 --> 00:36:52,330
<font color="#E5E5E5">minutes</font><font color="#CCCCCC"> okay long coffee break all right</font>

1018
00:36:50,290 --> 00:36:53,920
well attackers figured out that they

1019
00:36:52,330 --> 00:36:55,509
<font color="#CCCCCC">could use something it's</font><font color="#E5E5E5"> either called</font>

1020
00:36:53,920 --> 00:36:58,420
horizontal<font color="#CCCCCC"> password spraying or just</font>

1021
00:36:55,510 --> 00:37:01,420
password spraying where we take a list

1022
00:36:58,420 --> 00:37:04,660
<font color="#E5E5E5">of possible passwords like summer - 2018</font>

1023
00:37:01,420 --> 00:37:07,540
<font color="#CCCCCC">and we attempt that one password against</font>

1024
00:37:04,660 --> 00:37:08,980
every user account<font color="#CCCCCC"> and the odds are</font>

1025
00:37:07,540 --> 00:37:11,140
we're going<font color="#CCCCCC"> to find one user account</font>

1026
00:37:08,980 --> 00:37:16,570
that<font color="#E5E5E5"> has a bad password in an ad</font>

1027
00:37:11,140 --> 00:37:18,069
environment of 5,000 10,000<font color="#CCCCCC"> users and so</font>

1028
00:37:16,570 --> 00:37:19,570
it<font color="#E5E5E5"> goes through it and does this and</font>

1029
00:37:18,070 --> 00:37:21,400
it's<font color="#E5E5E5"> easy enough to look at the lockout</font>

1030
00:37:19,570 --> 00:37:24,790
threshold it's<font color="#CCCCCC"> five so guess what I'm</font>

1031
00:37:21,400 --> 00:37:26,470
going<font color="#CCCCCC"> to</font><font color="#E5E5E5"> do and</font><font color="#CCCCCC"> my n - 1 5 - 1</font><font color="#E5E5E5"> 4 so I'm</font>

1032
00:37:24,790 --> 00:37:28,270
only<font color="#E5E5E5"> gonna do 4 and then I'm gonna wait</font>

1033
00:37:26,470 --> 00:37:30,640
and<font color="#CCCCCC"> I can also enumerate the</font>

1034
00:37:28,270 --> 00:37:32,560
fine-grained<font color="#E5E5E5"> password policies because</font>

1035
00:37:30,640 --> 00:37:33,069
those might have<font color="#CCCCCC"> different</font><font color="#E5E5E5"> policies for</font>

1036
00:37:32,560 --> 00:37:35,230
<font color="#E5E5E5">lockouts</font>

1037
00:37:33,070 --> 00:37:36,730
so I can look at<font color="#E5E5E5"> those also and then</font>

1038
00:37:35,230 --> 00:37:38,380
pick lowest common denominator and<font color="#CCCCCC"> then</font>

1039
00:37:36,730 --> 00:37:38,890
I know how many passwords<font color="#CCCCCC"> I can tempt in</font>

1040
00:37:38,380 --> 00:37:42,650
the

1041
00:37:38,890 --> 00:37:44,538
this works this works<font color="#E5E5E5"> well in my lab my</font>

1042
00:37:42,650 --> 00:37:47,059
fake users are horrible at picking

1043
00:37:44,539 --> 00:37:51,349
passwords let me tell you<font color="#E5E5E5"> I'm a fire all</font>

1044
00:37:47,059 --> 00:37:54,190
<font color="#CCCCCC">of them</font><font color="#E5E5E5"> terrible</font><font color="#CCCCCC"> I told them</font><font color="#E5E5E5"> not to use</font>

1045
00:37:51,349 --> 00:37:58,759
password<font color="#E5E5E5"> so they're like password one</font>

1046
00:37:54,190 --> 00:38:01,220
<font color="#CCCCCC">needs an ampersand</font><font color="#E5E5E5"> but through</font><font color="#CCCCCC"> my lab</font>

1047
00:37:58,759 --> 00:38:04,880
environment of 1892 users<font color="#E5E5E5"> perfectly</font>

1048
00:38:01,220 --> 00:38:06,649
<font color="#CCCCCC">random number connect</font><font color="#E5E5E5"> to an SMB share or</font>

1049
00:38:04,880 --> 00:38:08,660
a<font color="#CCCCCC"> network service and then so I just</font>

1050
00:38:06,650 --> 00:38:10,579
decided<font color="#CCCCCC"> to target the PDC's</font><font color="#E5E5E5"> and that</font>

1051
00:38:08,660 --> 00:38:11,868
<font color="#CCCCCC">logon</font><font color="#E5E5E5"> chair to do this and it didn't</font>

1052
00:38:10,579 --> 00:38:13,819
take<font color="#E5E5E5"> me</font><font color="#CCCCCC"> long</font><font color="#E5E5E5"> to write this</font><font color="#CCCCCC"> PowerShell</font>

1053
00:38:11,869 --> 00:38:15,470
<font color="#CCCCCC">I'm not a great</font><font color="#E5E5E5"> person at writing power</font>

1054
00:38:13,819 --> 00:38:17,420
so I do okay but<font color="#CCCCCC"> I'm not a</font><font color="#E5E5E5"> developer it</font>

1055
00:38:15,470 --> 00:38:18,709
took me a couple<font color="#CCCCCC"> hours to</font><font color="#E5E5E5"> write</font><font color="#CCCCCC"> this so</font>

1056
00:38:17,420 --> 00:38:22,190
<font color="#E5E5E5">that means anyone</font><font color="#CCCCCC"> can go ahead and do</font>

1057
00:38:18,710 --> 00:38:23,630
this<font color="#E5E5E5"> it's not that difficult</font><font color="#CCCCCC"> but when I</font>

1058
00:38:22,190 --> 00:38:25,369
go ahead<font color="#E5E5E5"> and</font><font color="#CCCCCC"> run this</font><font color="#E5E5E5"> pasture spraying</font>

1059
00:38:23,630 --> 00:38:28,730
script that I wrote<font color="#CCCCCC"> there's a bunch of</font>

1060
00:38:25,369 --> 00:38:29,960
<font color="#CCCCCC">4625 bad password attempt account that</font>

1061
00:38:28,730 --> 00:38:32,660
password attempt against this account

1062
00:38:29,960 --> 00:38:34,940
<font color="#E5E5E5">and so this happens across all of them</font>

1063
00:38:32,660 --> 00:38:36,618
but<font color="#E5E5E5"> I also figured there's an attribute</font>

1064
00:38:34,940 --> 00:38:37,910
in active directory called<font color="#E5E5E5"> labs</font><font color="#CCCCCC"> last bad</font>

1065
00:38:36,619 --> 00:38:39,799
password attempt at least that's<font color="#E5E5E5"> what</font>

1066
00:38:37,910 --> 00:38:41,240
it's called<font color="#CCCCCC"> in</font><font color="#E5E5E5"> PowerShell when you use</font>

1067
00:38:39,799 --> 00:38:43,730
the<font color="#E5E5E5"> active</font><font color="#CCCCCC"> directory powershell</font>

1068
00:38:41,240 --> 00:38:45,169
commandlets<font color="#E5E5E5"> so I looked at that I'm like</font>

1069
00:38:43,730 --> 00:38:48,109
that's<font color="#E5E5E5"> pretty obvious that</font><font color="#CCCCCC"> someone is</font>

1070
00:38:45,170 --> 00:38:49,970
<font color="#CCCCCC">doing something odd</font><font color="#E5E5E5"> so we have a couple</font>

1071
00:38:48,109 --> 00:38:51,740
<font color="#CCCCCC">different ways to detect this 46:25</font>

1072
00:38:49,970 --> 00:38:53,480
which most organizations<font color="#E5E5E5"> are logging on</font>

1073
00:38:51,740 --> 00:38:55,069
their<font color="#CCCCCC"> domain controllers and we can look</font>

1074
00:38:53,480 --> 00:38:58,490
<font color="#E5E5E5">at the attributes</font><font color="#CCCCCC"> and ad which any user</font>

1075
00:38:55,069 --> 00:39:01,220
<font color="#CCCCCC">can do</font><font color="#E5E5E5"> okay that's great but then I</font>

1076
00:38:58,490 --> 00:39:02,660
switch to LDAP and when<font color="#E5E5E5"> I password spray</font>

1077
00:39:01,220 --> 00:39:04,490
against the LDAP service on the domain

1078
00:39:02,660 --> 00:39:09,379
controller guess what happened<font color="#E5E5E5"> all those</font>

1079
00:39:04,490 --> 00:39:12,109
<font color="#CCCCCC">46:25</font><font color="#E5E5E5"> is just disappeared</font><font color="#CCCCCC"> okay so this</font>

1080
00:39:09,380 --> 00:39:14,089
means<font color="#E5E5E5"> that organizations that are</font>

1081
00:39:12,109 --> 00:39:16,460
<font color="#CCCCCC">looking at</font><font color="#E5E5E5"> 46 25 s or a password</font>

1082
00:39:14,089 --> 00:39:19,160
spraying<font color="#E5E5E5"> are completely missing a huge</font>

1083
00:39:16,460 --> 00:39:21,440
<font color="#E5E5E5">attack vector okay but there's got to be</font>

1084
00:39:19,160 --> 00:39:24,649
a way to<font color="#E5E5E5"> figure out that this</font><font color="#CCCCCC"> is</font>

1085
00:39:21,440 --> 00:39:27,849
happening<font color="#CCCCCC"> right</font><font color="#E5E5E5"> well there is so I ran</font>

1086
00:39:24,650 --> 00:39:30,500
through again<font color="#E5E5E5"> environm environmentally</font>

1087
00:39:27,849 --> 00:39:33,049
<font color="#E5E5E5">fake users about their bad passwords and</font>

1088
00:39:30,500 --> 00:39:38,329
saw that the Kerberos authentication

1089
00:39:33,049 --> 00:39:40,779
service event got logged<font color="#E5E5E5"> 47 71 this</font>

1090
00:39:38,329 --> 00:39:43,190
one's pretty boring<font color="#E5E5E5"> so I went back to</font><font color="#CCCCCC"> my</font>

1091
00:39:40,779 --> 00:39:44,809
attributes<font color="#E5E5E5"> and I saw yeah last bad</font>

1092
00:39:43,190 --> 00:39:47,390
password attempt was definitely flagged

1093
00:39:44,809 --> 00:39:49,069
there<font color="#E5E5E5"> great bad password count by the</font>

1094
00:39:47,390 --> 00:39:50,569
<font color="#E5E5E5">way is per domain controller so if you</font>

1095
00:39:49,069 --> 00:39:52,220
have an environment<font color="#E5E5E5"> with a ton of domain</font>

1096
00:39:50,569 --> 00:39:53,720
controllers this isn't as

1097
00:39:52,220 --> 00:39:55,339
because<font color="#E5E5E5"> you'd have to parse all of them</font>

1098
00:39:53,720 --> 00:39:58,970
to figure<font color="#CCCCCC"> out</font><font color="#E5E5E5"> that password count but I</font>

1099
00:39:55,339 --> 00:40:00,920
show it<font color="#E5E5E5"> here as an example so I looked</font>

1100
00:39:58,970 --> 00:40:02,540
at<font color="#E5E5E5"> that 47 71 and Kerberos</font><font color="#CCCCCC"> pre</font>

1101
00:40:00,920 --> 00:40:03,770
authentication failed<font color="#CCCCCC"> well most people</font>

1102
00:40:02,540 --> 00:40:06,470
<font color="#E5E5E5">don't care about pre authentication</font>

1103
00:40:03,770 --> 00:40:08,869
failed<font color="#E5E5E5"> and then I looked closer and saw</font>

1104
00:40:06,470 --> 00:40:10,578
this<font color="#E5E5E5"> failure code which is</font><font color="#CCCCCC"> 0 by 18</font><font color="#E5E5E5"> and</font>

1105
00:40:08,869 --> 00:40:13,550
when I look this<font color="#E5E5E5"> up guess what it meant</font>

1106
00:40:10,579 --> 00:40:15,829
bad password attempt so now we have a

1107
00:40:13,550 --> 00:40:17,000
way to detect its<font color="#CCCCCC"> passer spraying</font><font color="#E5E5E5"> no</font>

1108
00:40:15,829 --> 00:40:19,849
matter what's being done<font color="#CCCCCC"> in our</font>

1109
00:40:17,000 --> 00:40:22,250
environment which is great<font color="#E5E5E5"> the other</font>

1110
00:40:19,849 --> 00:40:23,960
<font color="#CCCCCC">thing I identified is that</font><font color="#E5E5E5"> on endpoints</font>

1111
00:40:22,250 --> 00:40:25,940
<font color="#E5E5E5">on our workstations if someone's doing</font>

1112
00:40:23,960 --> 00:40:29,000
password<font color="#CCCCCC"> sprang from</font><font color="#E5E5E5"> that we can look</font>

1113
00:40:25,940 --> 00:40:30,890
for<font color="#CCCCCC"> 46 48</font><font color="#E5E5E5"> event IDs</font><font color="#CCCCCC"> and we can see</font><font color="#E5E5E5"> that</font>

1114
00:40:29,000 --> 00:40:33,500
there<font color="#E5E5E5"> was a you</font><font color="#CCCCCC"> a logon was attempted</font>

1115
00:40:30,890 --> 00:40:35,540
using explicit credentials so<font color="#CCCCCC"> Jo is</font>

1116
00:40:33,500 --> 00:40:37,190
<font color="#E5E5E5">doing some very shady stuff because he's</font>

1117
00:40:35,540 --> 00:40:40,490
attempting to authenticate as all these

1118
00:40:37,190 --> 00:40:42,109
<font color="#E5E5E5">other users</font><font color="#CCCCCC"> Jo is another fake user</font><font color="#E5E5E5"> that</font>

1119
00:40:40,490 --> 00:40:47,598
I need to talk<font color="#E5E5E5"> to</font><font color="#CCCCCC"> because he should not</font>

1120
00:40:42,109 --> 00:40:49,819
<font color="#E5E5E5">be</font><font color="#CCCCCC"> doing</font><font color="#E5E5E5"> that so what's the next step</font>

1121
00:40:47,599 --> 00:40:51,829
<font color="#CCCCCC">what do we need</font><font color="#E5E5E5"> to do and I have a bunch</font>

1122
00:40:49,819 --> 00:40:55,220
of recommendations here<font color="#CCCCCC"> and it's a very</font>

1123
00:40:51,829 --> 00:40:57,200
<font color="#CCCCCC">busy slide but this encapsulate</font><font color="#E5E5E5"> all</font><font color="#CCCCCC"> the</font>

1124
00:40:55,220 --> 00:40:59,419
some of the<font color="#E5E5E5"> primary recommendations that</font>

1125
00:40:57,200 --> 00:41:00,500
that I make to<font color="#E5E5E5"> customers when we're</font>

1126
00:40:59,420 --> 00:41:03,099
<font color="#CCCCCC">looking at their Active Directory</font>

1127
00:41:00,500 --> 00:41:05,390
environment<font color="#CCCCCC"> some of the keys to this are</font>

1128
00:41:03,099 --> 00:41:07,310
limiting who your<font color="#CCCCCC"> act directory admins</font>

1129
00:41:05,390 --> 00:41:10,040
are and making sure that they're<font color="#CCCCCC"> using</font>

1130
00:41:07,310 --> 00:41:11,869
some protected method to ensure that

1131
00:41:10,040 --> 00:41:14,750
their credential is well<font color="#E5E5E5"> protected and</font>

1132
00:41:11,869 --> 00:41:16,609
not leaked on<font color="#CCCCCC"> the in the</font><font color="#E5E5E5"> environment if</font>

1133
00:41:14,750 --> 00:41:18,140
they're using a regular<font color="#CCCCCC"> workstation and</font>

1134
00:41:16,609 --> 00:41:20,420
then already peeing to a domain

1135
00:41:18,140 --> 00:41:21,920
<font color="#CCCCCC">controller</font><font color="#E5E5E5"> that's not the best way to do</font>

1136
00:41:20,420 --> 00:41:24,200
it it's much<font color="#E5E5E5"> better to</font><font color="#CCCCCC"> use an admin</font>

1137
00:41:21,920 --> 00:41:26,329
<font color="#E5E5E5">system like an admin workstation to move</font>

1138
00:41:24,200 --> 00:41:31,160
it over<font color="#E5E5E5"> to isolate</font><font color="#CCCCCC"> that credential</font><font color="#E5E5E5"> from</font>

1139
00:41:26,329 --> 00:41:32,599
<font color="#E5E5E5">the standard workstation so there are</font>

1140
00:41:31,160 --> 00:41:35,060
<font color="#E5E5E5">things that matter making sure the local</font>

1141
00:41:32,599 --> 00:41:37,300
admin passwords change<font color="#CCCCCC"> host firewall on</font>

1142
00:41:35,060 --> 00:41:39,500
<font color="#E5E5E5">your</font><font color="#CCCCCC"> workstations is one of the most</font>

1143
00:41:37,300 --> 00:41:41,450
positive<font color="#E5E5E5"> things you can do in</font><font color="#CCCCCC"> your</font>

1144
00:41:39,500 --> 00:41:42,740
environment<font color="#CCCCCC"> if</font><font color="#E5E5E5"> you get a host-based</font>

1145
00:41:41,450 --> 00:41:45,379
firewall like<font color="#E5E5E5"> the Windows Firewall</font>

1146
00:41:42,740 --> 00:41:47,750
<font color="#E5E5E5">enabled with default inbound rule</font>

1147
00:41:45,380 --> 00:41:50,630
blocking on all your workstations

1148
00:41:47,750 --> 00:41:52,670
this will incredibly frustrated<font color="#CCCCCC"> ackers</font>

1149
00:41:50,630 --> 00:41:54,500
it will have much more<font color="#CCCCCC"> impact than</font>

1150
00:41:52,670 --> 00:41:56,810
<font color="#E5E5E5">buying the the security tool with the</font>

1151
00:41:54,500 --> 00:41:59,480
blinky box<font color="#E5E5E5"> sorry people out there</font>

1152
00:41:56,810 --> 00:42:01,250
it has tremendously<font color="#CCCCCC"> positive impact</font><font color="#E5E5E5"> and</font>

1153
00:41:59,480 --> 00:42:04,310
guess what the ransomware that<font color="#E5E5E5"> uses want</font>

1154
00:42:01,250 --> 00:42:06,270
to cry or any of the the new names of

1155
00:42:04,310 --> 00:42:08,370
the month<font color="#CCCCCC"> how SMB worms are</font>

1156
00:42:06,270 --> 00:42:10,110
or being alder<font color="#CCCCCC"> how they're working</font><font color="#E5E5E5"> it</font>

1157
00:42:08,370 --> 00:42:11,310
blocks that<font color="#CCCCCC"> too</font><font color="#E5E5E5"> because</font><font color="#CCCCCC"> they could</font><font color="#E5E5E5"> just</font>

1158
00:42:10,110 --> 00:42:12,420
can't jump from workstation to

1159
00:42:11,310 --> 00:42:15,240
workstation which is what they've<font color="#E5E5E5"> been</font>

1160
00:42:12,420 --> 00:42:17,010
doing it has a huge positive impact

1161
00:42:15,240 --> 00:42:19,979
<font color="#E5E5E5">there is no need for workstations to</font>

1162
00:42:17,010 --> 00:42:22,500
talk to each other<font color="#E5E5E5"> and workstations also</font>

1163
00:42:19,980 --> 00:42:25,470
don't need the ability<font color="#E5E5E5"> to have a demand</font>

1164
00:42:22,500 --> 00:42:26,970
controller<font color="#E5E5E5"> reach directly to them it has</font>

1165
00:42:25,470 --> 00:42:29,339
a stateful<font color="#E5E5E5"> firewall the Windows Firewall</font>

1166
00:42:26,970 --> 00:42:30,750
is stateful which means that when the

1167
00:42:29,340 --> 00:42:32,400
workstation reaches out to the domain

1168
00:42:30,750 --> 00:42:34,320
controller<font color="#E5E5E5"> then</font><font color="#CCCCCC"> makes troller responds</font>

1169
00:42:32,400 --> 00:42:35,550
to it so you<font color="#E5E5E5"> can have the</font><font color="#CCCCCC"> Windows</font>

1170
00:42:34,320 --> 00:42:37,020
<font color="#CCCCCC">Firewall</font><font color="#E5E5E5"> enabled you can't have a</font>

1171
00:42:35,550 --> 00:42:38,610
host-based firewall enable in Active

1172
00:42:37,020 --> 00:42:40,350
Directory<font color="#CCCCCC"> the things</font><font color="#E5E5E5"> that you'll have to</font>

1173
00:42:38,610 --> 00:42:41,370
<font color="#E5E5E5">look at as exceptions are your</font>

1174
00:42:40,350 --> 00:42:44,580
management<font color="#E5E5E5"> products your patch</font>

1175
00:42:41,370 --> 00:42:46,410
<font color="#E5E5E5">management products administration much</font>

1176
00:42:44,580 --> 00:42:48,210
better<font color="#E5E5E5"> to have an admin subnet that</font>

1177
00:42:46,410 --> 00:42:49,740
those are going<font color="#E5E5E5"> to come from so</font><font color="#CCCCCC"> that way</font>

1178
00:42:48,210 --> 00:42:52,710
when they reach down<font color="#CCCCCC"> they're allowed</font>

1179
00:42:49,740 --> 00:42:54,359
through that firewall<font color="#CCCCCC"> rule so we want to</font>

1180
00:42:52,710 --> 00:42:56,880
make<font color="#CCCCCC"> sure that we are firewalling and</font>

1181
00:42:54,360 --> 00:42:59,520
protecting<font color="#CCCCCC"> lemon lemon limiting the</font>

1182
00:42:56,880 --> 00:43:01,440
communication between systems<font color="#E5E5E5"> that need</font>

1183
00:42:59,520 --> 00:43:03,210
to<font color="#CCCCCC"> be have communication between them</font>

1184
00:43:01,440 --> 00:43:04,530
<font color="#E5E5E5">and restricting and preventing</font>

1185
00:43:03,210 --> 00:43:05,010
communication from<font color="#E5E5E5"> other systems</font><font color="#CCCCCC"> that</font>

1186
00:43:04,530 --> 00:43:08,130
don't<font color="#E5E5E5"> need it</font>

1187
00:43:05,010 --> 00:43:09,600
<font color="#E5E5E5">and then disabling old and uncommon</font>

1188
00:43:08,130 --> 00:43:12,510
features and protocols really matter

1189
00:43:09,600 --> 00:43:16,319
<font color="#CCCCCC">things like getting</font><font color="#E5E5E5"> rid</font><font color="#CCCCCC"> of LM ntlm</font>

1190
00:43:12,510 --> 00:43:19,920
shifting up to<font color="#E5E5E5"> ntlm</font><font color="#CCCCCC"> v2</font><font color="#E5E5E5"> turning office</font>

1191
00:43:16,320 --> 00:43:22,170
and<font color="#CCCCCC"> vv1 in the environment L element</font><font color="#E5E5E5"> R</font>

1192
00:43:19,920 --> 00:43:23,820
is usually not required<font color="#E5E5E5"> so disable that</font>

1193
00:43:22,170 --> 00:43:25,680
things like responder which I call the

1194
00:43:23,820 --> 00:43:28,140
<font color="#E5E5E5">easy button for</font><font color="#CCCCCC"> for pen testers</font><font color="#E5E5E5"> and</font>

1195
00:43:25,680 --> 00:43:30,089
attackers will just siphon<font color="#E5E5E5"> and suck</font><font color="#CCCCCC"> up</font>

1196
00:43:28,140 --> 00:43:31,080
the credentials in<font color="#CCCCCC"> the environment on</font>

1197
00:43:30,090 --> 00:43:34,860
the network when these things<font color="#E5E5E5"> are</font>

1198
00:43:31,080 --> 00:43:37,460
enabled so that's been my<font color="#E5E5E5"> time thank you</font>

1199
00:43:34,860 --> 00:43:37,460
<font color="#CCCCCC">so much for yours</font>

1200
00:43:40,640 --> 00:43:47,930
<font color="#E5E5E5">I do have a few minutes for</font><font color="#CCCCCC"> questions if</font>

1201
00:43:44,750 --> 00:43:50,559
anyone has<font color="#CCCCCC"> questions otherwise</font><font color="#E5E5E5"> I'll be</font>

1202
00:43:47,930 --> 00:43:53,710
over here<font color="#E5E5E5"> if</font><font color="#CCCCCC"> you want to follow up</font>

1203
00:43:50,559 --> 00:43:53,710
<font color="#E5E5E5">questions yes</font>

1204
00:43:58,359 --> 00:44:02,450
<font color="#E5E5E5">group managed service counts are</font>

1205
00:44:00,200 --> 00:44:03,919
fantastic because<font color="#CCCCCC"> 80 manages the</font>

1206
00:44:02,450 --> 00:44:07,279
password for<font color="#E5E5E5"> it and that changes about</font>

1207
00:44:03,920 --> 00:44:09,859
every<font color="#E5E5E5"> 30 days</font><font color="#CCCCCC"> great</font><font color="#E5E5E5"> one of</font><font color="#CCCCCC"> the</font>

1208
00:44:07,279 --> 00:44:12,319
challenges with<font color="#CCCCCC"> that is there's</font><font color="#E5E5E5"> certain</font>

1209
00:44:09,859 --> 00:44:15,019
applications that don't<font color="#E5E5E5"> work with GM SAS</font>

1210
00:44:12,319 --> 00:44:17,029
or<font color="#CCCCCC"> MSAs but yeah</font><font color="#E5E5E5"> I would</font><font color="#CCCCCC"> absolutely love</font>

1211
00:44:15,019 --> 00:44:18,799
to<font color="#E5E5E5"> see more service counts using using</font>

1212
00:44:17,029 --> 00:44:20,599
that because<font color="#E5E5E5"> the passwords automatically</font>

1213
00:44:18,799 --> 00:44:27,380
get managed and rotated and are long

1214
00:44:20,599 --> 00:44:28,760
complex<font color="#E5E5E5"> absolutely anyone else</font><font color="#CCCCCC"> okay</font>

1215
00:44:27,380 --> 00:44:30,100
<font color="#E5E5E5">great thank you very much</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> having me</font>

1216
00:44:28,760 --> 00:44:34,610
<font color="#CCCCCC">at Chuck kaan again</font>

1217
00:44:30,100 --> 00:44:34,610
[Applause]

