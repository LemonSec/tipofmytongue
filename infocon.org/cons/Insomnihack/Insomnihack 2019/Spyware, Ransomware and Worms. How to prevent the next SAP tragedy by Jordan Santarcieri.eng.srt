1
00:00:07,250 --> 00:00:10,619
[Music]

2
00:00:14,050 --> 00:00:18,800
thank you thank you everyone and thank

3
00:00:16,280 --> 00:00:20,990
you for being here to this presentation

4
00:00:18,800 --> 00:00:23,570
about how to prevent is the next si

5
00:00:20,990 --> 00:00:25,909
Petrus reading a couple of things that I

6
00:00:23,570 --> 00:00:28,099
want to clarify before I start with the

7
00:00:25,910 --> 00:00:30,860
presentation first of all this will not

8
00:00:28,099 --> 00:00:35,450
be the typical structure presentation

9
00:00:30,860 --> 00:00:37,340
that you often see on the InfoSec I like

10
00:00:35,450 --> 00:00:39,829
it to play a little bit and make it a

11
00:00:37,340 --> 00:00:41,719
little more experimental so at the

12
00:00:39,829 --> 00:00:43,670
beginning maybe the structure will not

13
00:00:41,719 --> 00:00:45,640
make total sense but in the end you will

14
00:00:43,670 --> 00:00:49,219
understand why I did it

15
00:00:45,640 --> 00:00:51,350
the second point is that when I was

16
00:00:49,219 --> 00:00:53,359
creating this presentation when I was

17
00:00:51,350 --> 00:00:55,670
putting together the pieces that I

18
00:00:53,359 --> 00:00:58,340
wanted to show you it came a moment of

19
00:00:55,670 --> 00:01:00,530
self realization of oh my goodness what

20
00:00:58,340 --> 00:01:02,739
am i doing whatever I have to show so

21
00:01:00,530 --> 00:01:06,320
you will see at some points that I

22
00:01:02,739 --> 00:01:08,360
downgraded the attack or the experience

23
00:01:06,320 --> 00:01:11,809
of the attack just because my intention

24
00:01:08,360 --> 00:01:14,840
here is to help raise awareness and not

25
00:01:11,810 --> 00:01:17,799
make the situation even worse so no

26
00:01:14,840 --> 00:01:21,110
worries if you are part of the blue team

27
00:01:17,799 --> 00:01:23,720
also and finally we have a lot of live

28
00:01:21,110 --> 00:01:26,180
presentations I have actually true live

29
00:01:23,720 --> 00:01:28,030
ACP systems running on this machine so

30
00:01:26,180 --> 00:01:30,710
I'm going to show you a couple tricks

31
00:01:28,030 --> 00:01:32,390
let's all cross our fingers for their

32
00:01:30,710 --> 00:01:34,759
demo gods okay

33
00:01:32,390 --> 00:01:36,790
so let's start first I always show you

34
00:01:34,759 --> 00:01:39,770
the same it's a brief disclaimer

35
00:01:36,790 --> 00:01:42,469
basically I'm saying that I don't intend

36
00:01:39,770 --> 00:01:44,030
to override any original claims so

37
00:01:42,469 --> 00:01:46,548
there's a beam I shot with the brands

38
00:01:44,030 --> 00:01:50,329
no.1 rescind anyway but it's important

39
00:01:46,549 --> 00:01:52,969
to put it there so Who am I my name is

40
00:01:50,329 --> 00:01:55,850
Jordan Center Siri and as many of you

41
00:01:52,969 --> 00:01:59,479
that you're here I started my career as

42
00:01:55,850 --> 00:02:01,929
a red teamer general pen tester and I

43
00:01:59,479 --> 00:02:04,880
started to be curious of all these

44
00:02:01,930 --> 00:02:07,399
gigantic systems that no one's poking

45
00:02:04,880 --> 00:02:09,410
around that moment called ERP systems

46
00:02:07,399 --> 00:02:13,420
from the most prominent brands for

47
00:02:09,410 --> 00:02:16,780
example sa PE or go etc

48
00:02:13,420 --> 00:02:19,690
when I have time I like to present my

49
00:02:16,780 --> 00:02:21,340
research and also teach trainings at

50
00:02:19,690 --> 00:02:24,940
different security conference I have

51
00:02:21,340 --> 00:02:29,860
done it on blood all was a KO party and

52
00:02:24,940 --> 00:02:31,060
I did it last year for insomniac and I

53
00:02:29,860 --> 00:02:33,190
don't know what happened but these guys

54
00:02:31,060 --> 00:02:35,050
were crazy enough to call me again and

55
00:02:33,190 --> 00:02:37,870
allow me to speak again so I'm more than

56
00:02:35,050 --> 00:02:40,750
grateful for that so I have a lot of

57
00:02:37,870 --> 00:02:44,580
experience with ACP systems I started in

58
00:02:40,750 --> 00:02:47,440
2008 researching reverse engineering

59
00:02:44,580 --> 00:02:49,870
doing exploit writing even for

60
00:02:47,440 --> 00:02:51,280
commercial solutions so there and I had

61
00:02:49,870 --> 00:02:54,040
the pleasure to work with more than a

62
00:02:51,280 --> 00:02:56,860
thousand ASAP systems attacking the

63
00:02:54,040 --> 00:03:00,280
Fenian fixing it is for everyone like

64
00:02:56,860 --> 00:03:04,269
big companies fortune 500 military

65
00:03:00,280 --> 00:03:07,180
institutions and OMGs this is the brief

66
00:03:04,269 --> 00:03:10,780
agenda that I have prepared for you just

67
00:03:07,180 --> 00:03:13,000
a fair warning the complexity we will

68
00:03:10,780 --> 00:03:17,080
start low and then we will increase a

69
00:03:13,000 --> 00:03:18,150
lot especially in the end so pay

70
00:03:17,080 --> 00:03:20,769
attention

71
00:03:18,150 --> 00:03:22,180
chapter 1 we're going to start as I

72
00:03:20,769 --> 00:03:24,519
always like to do with a brief

73
00:03:22,180 --> 00:03:26,860
introduction to sa P because I know that

74
00:03:24,519 --> 00:03:30,459
some of you here might not know a lot

75
00:03:26,860 --> 00:03:32,560
about the CP so I want us all of us to

76
00:03:30,459 --> 00:03:34,060
be at the same level so everyone is able

77
00:03:32,560 --> 00:03:37,900
to understand the attacks that I'm going

78
00:03:34,060 --> 00:03:40,030
to describe later on on chapter 2 I'm

79
00:03:37,900 --> 00:03:42,190
going to show you and I'm going to tell

80
00:03:40,030 --> 00:03:44,680
you what is the project our sub and how

81
00:03:42,190 --> 00:03:46,480
it was born it's an interesting research

82
00:03:44,680 --> 00:03:48,940
but the thing you will all be

83
00:03:46,480 --> 00:03:51,209
interesting who's going to tell you the

84
00:03:48,940 --> 00:03:53,950
story and the end result of that and

85
00:03:51,209 --> 00:03:56,650
then we're going to start to get even

86
00:03:53,950 --> 00:03:58,839
more technical on the chapter 3 we're

87
00:03:56,650 --> 00:04:00,610
going to see the traditional approach to

88
00:03:58,840 --> 00:04:02,019
malware distribution and si P and this

89
00:04:00,610 --> 00:04:05,320
is based on a true story

90
00:04:02,019 --> 00:04:07,660
of course I always going to say this I

91
00:04:05,320 --> 00:04:09,489
will not give you the name of the

92
00:04:07,660 --> 00:04:11,470
company that was affected but for you to

93
00:04:09,489 --> 00:04:13,959
understand that this was a true attack

94
00:04:11,470 --> 00:04:17,500
and finally this is what we're going to

95
00:04:13,959 --> 00:04:19,390
be very technical we're going to learn

96
00:04:17,500 --> 00:04:23,020
about ransomware and the weaponization

97
00:04:19,390 --> 00:04:25,020
of the weaknesses okay ready let's start

98
00:04:23,020 --> 00:04:27,219
with a really brief introduction to sa P

99
00:04:25,020 --> 00:04:29,530
so many of you

100
00:04:27,220 --> 00:04:32,230
maybe you decide to stay from the auto

101
00:04:29,530 --> 00:04:34,570
talk or maybe you just feel curious you

102
00:04:32,230 --> 00:04:37,380
might be wondering okay what is a scipy

103
00:04:34,570 --> 00:04:39,790
OSAP is is an acronym and it stands for

104
00:04:37,380 --> 00:04:42,010
systems applications and products in

105
00:04:39,790 --> 00:04:44,830
data processing it's a German company

106
00:04:42,010 --> 00:04:47,050
that was founded in 1972 and I don't

107
00:04:44,830 --> 00:04:49,750
know if you know the history but it was

108
00:04:47,050 --> 00:04:51,960
founded by x ib m employees those guys

109
00:04:49,750 --> 00:04:54,670
were working on an earpiece for IBM

110
00:04:51,960 --> 00:04:56,770
don't ask me why or what happened in

111
00:04:54,670 --> 00:04:58,960
there the project got canceled and those

112
00:04:56,770 --> 00:05:00,969
guys say okay wait a second we had

113
00:04:58,960 --> 00:05:03,580
something good between our hands why

114
00:05:00,970 --> 00:05:05,260
don't we just split up and create our

115
00:05:03,580 --> 00:05:07,210
own company and make our own product

116
00:05:05,260 --> 00:05:09,430
that was one of the most successful

117
00:05:07,210 --> 00:05:12,370
business decisions on the history of

118
00:05:09,430 --> 00:05:15,490
software look at these numbers they have

119
00:05:12,370 --> 00:05:17,350
more than 88,000 employees even though

120
00:05:15,490 --> 00:05:19,480
if you have been following the news for

121
00:05:17,350 --> 00:05:22,240
the last two three weeks there have been

122
00:05:19,480 --> 00:05:23,770
a lot of layers in s IP but is a piece a

123
00:05:22,240 --> 00:05:25,840
stat by the end of the year they will

124
00:05:23,770 --> 00:05:28,840
even increment the workforce that they

125
00:05:25,840 --> 00:05:31,479
have nowadays for 5000 people than

126
00:05:28,840 --> 00:05:32,859
incorporating 5,000 people they have

127
00:05:31,480 --> 00:05:35,110
more than three hundred seventy eight

128
00:05:32,860 --> 00:05:38,980
thousand customers they're almost on

129
00:05:35,110 --> 00:05:41,170
every single country that has in the

130
00:05:38,980 --> 00:05:42,580
world and I think the last one

131
00:05:41,170 --> 00:05:45,520
the last detail is the most powerful

132
00:05:42,580 --> 00:05:48,550
market you know that the force global

133
00:05:45,520 --> 00:05:50,020
2000 are the most powerful companies and

134
00:05:48,550 --> 00:05:51,910
institutions out there and when I say

135
00:05:50,020 --> 00:05:56,859
powerful I same from the point of the

136
00:05:51,910 --> 00:06:00,100
revenue the money 87% of those companies

137
00:05:56,860 --> 00:06:01,840
are running s ap to run the daily

138
00:06:00,100 --> 00:06:04,410
operations business critical

139
00:06:01,840 --> 00:06:10,390
applications processing credit cards

140
00:06:04,410 --> 00:06:12,610
materials etc again for this really

141
00:06:10,390 --> 00:06:14,380
brief introduction if you read the API

142
00:06:12,610 --> 00:06:15,910
documentation will be different but for

143
00:06:14,380 --> 00:06:17,530
this really brief introduction we're

144
00:06:15,910 --> 00:06:20,110
going to separate the solutions

145
00:06:17,530 --> 00:06:23,229
available into enterprise solutions and

146
00:06:20,110 --> 00:06:25,450
the supporting solutions the enterprise

147
00:06:23,230 --> 00:06:26,590
solutions are the ones that the human

148
00:06:25,450 --> 00:06:29,260
beings the people in your organization

149
00:06:26,590 --> 00:06:32,590
will be connecting to work all the time

150
00:06:29,260 --> 00:06:34,780
I know that the names are a little bit

151
00:06:32,590 --> 00:06:37,599
confusing and you might be even more

152
00:06:34,780 --> 00:06:40,568
confused with all the marketing rebounds

153
00:06:37,600 --> 00:06:42,369
that is a piece offers all the time but

154
00:06:40,569 --> 00:06:44,529
for you to understand if you only have

155
00:06:42,369 --> 00:06:47,949
one ASAP system in your company you have

156
00:06:44,529 --> 00:06:49,808
the ERP is the heart is where a lot of

157
00:06:47,949 --> 00:06:52,449
important these are going on credit

158
00:06:49,809 --> 00:06:54,369
cards HR information very very sensitive

159
00:06:52,449 --> 00:06:57,550
information all this is turn the ERP

160
00:06:54,369 --> 00:07:01,449
system bi system is a very powerful

161
00:06:57,550 --> 00:07:05,349
system this is how companies learn how

162
00:07:01,449 --> 00:07:08,080
to serve more and better an example that

163
00:07:05,349 --> 00:07:09,998
I always like to do I was working with a

164
00:07:08,080 --> 00:07:13,029
car manufacturer company we were doing a

165
00:07:09,999 --> 00:07:15,580
pen test or the BI systems and we were

166
00:07:13,029 --> 00:07:17,709
able to compromise the system and get

167
00:07:15,580 --> 00:07:21,039
the financial the quartet information

168
00:07:17,709 --> 00:07:22,990
before the quarter ended if an attacker

169
00:07:21,039 --> 00:07:26,619
does that that person could have made

170
00:07:22,990 --> 00:07:28,959
millions on the stock trade CRM for

171
00:07:26,619 --> 00:07:30,759
example will reflect all the customer

172
00:07:28,959 --> 00:07:33,309
interactions with the company and so on

173
00:07:30,759 --> 00:07:35,019
all these Enterprise Solutions and we're

174
00:07:33,309 --> 00:07:36,459
going to see what it means because it's

175
00:07:35,019 --> 00:07:38,860
very important to understand the attacks

176
00:07:36,459 --> 00:07:41,229
later all these enterprise solutions are

177
00:07:38,860 --> 00:07:43,059
netweaver base just remember that and

178
00:07:41,229 --> 00:07:44,709
from the other side we have the

179
00:07:43,059 --> 00:07:46,659
supporting solutions are technical

180
00:07:44,709 --> 00:07:50,619
solutions that will be providing support

181
00:07:46,659 --> 00:07:53,919
to the enterprise solutions most of them

182
00:07:50,619 --> 00:07:56,649
with the exception of the GRC are not

183
00:07:53,919 --> 00:08:01,479
netweaver base and most of them will

184
00:07:56,649 --> 00:08:03,159
only receive technical users ok so what

185
00:08:01,479 --> 00:08:05,709
is this netweaver that I keep mentioning

186
00:08:03,159 --> 00:08:08,919
well netweaver for you to visualize it

187
00:08:05,709 --> 00:08:12,610
easily is the framework where sa B is

188
00:08:08,919 --> 00:08:14,079
built in inside a weaver that by the way

189
00:08:12,610 --> 00:08:15,969
is service oriented we are going to see

190
00:08:14,079 --> 00:08:18,519
what that means on the next slide we

191
00:08:15,969 --> 00:08:21,219
have two main divisions as well we have

192
00:08:18,519 --> 00:08:23,469
the eve of stack and the Java stack the

193
00:08:21,219 --> 00:08:24,039
AVA stack to make it simple is where the

194
00:08:23,469 --> 00:08:25,930
money is

195
00:08:24,039 --> 00:08:28,839
there we go you will never forget that

196
00:08:25,930 --> 00:08:33,789
and the Java stack it was designed to be

197
00:08:28,839 --> 00:08:36,880
more internet facing for extranets for

198
00:08:33,789 --> 00:08:39,729
creating portals for your providers etc

199
00:08:36,880 --> 00:08:42,009
but this is slowly being sun setting by

200
00:08:39,729 --> 00:08:44,139
ASAP and when I'm going to show you some

201
00:08:42,009 --> 00:08:46,569
numbers in a couple slides you will see

202
00:08:44,139 --> 00:08:51,069
that that tendency is getting confirmed

203
00:08:46,569 --> 00:08:53,620
so what you see here now here is by the

204
00:08:51,069 --> 00:08:54,760
structure of the ACB system the ASAP

205
00:08:53,620 --> 00:08:57,790
application

206
00:08:54,760 --> 00:08:59,830
is where the netweaver sits in and at

207
00:08:57,790 --> 00:09:02,260
the same point the netweaver will

208
00:08:59,830 --> 00:09:04,090
regulate how ap will interact how it's

209
00:09:02,260 --> 00:09:07,030
going to be speaking with the operating

210
00:09:04,090 --> 00:09:10,150
system and at the same time the SLP

211
00:09:07,030 --> 00:09:12,040
netweaver will regulate how is going to

212
00:09:10,150 --> 00:09:14,890
connect and interact with the SIV

213
00:09:12,040 --> 00:09:16,599
database all the systems to learn at

214
00:09:14,890 --> 00:09:19,000
Weaver base share this same

215
00:09:16,600 --> 00:09:20,920
infrastructure so from the attacker

216
00:09:19,000 --> 00:09:23,710
point of view this is really good

217
00:09:20,920 --> 00:09:27,819
because it means that if you find a

218
00:09:23,710 --> 00:09:29,920
vulnerability for the SI p ERP you had

219
00:09:27,820 --> 00:09:31,870
three out of four chances that that same

220
00:09:29,920 --> 00:09:34,420
mobility will be applicable for your VI

221
00:09:31,870 --> 00:09:36,840
system for your CRM system and from all

222
00:09:34,420 --> 00:09:39,849
the systems to learn it with your base

223
00:09:36,840 --> 00:09:41,770
good for attackers not that good for the

224
00:09:39,850 --> 00:09:45,340
blue teamers that had to triplicate the

225
00:09:41,770 --> 00:09:48,850
effort this is more or less how the

226
00:09:45,340 --> 00:09:51,460
inside of an SP system of a dual stack

227
00:09:48,850 --> 00:09:53,860
system systems that contain the services

228
00:09:51,460 --> 00:09:56,500
of Ava and the services of Java

229
00:09:53,860 --> 00:09:59,410
looks like you can see that they even

230
00:09:56,500 --> 00:10:02,380
have two different schemas inside the SP

231
00:09:59,410 --> 00:10:04,240
database something that I'm going to

232
00:10:02,380 --> 00:10:07,480
show you on we're going to see a lot on

233
00:10:04,240 --> 00:10:09,550
this presentation is that ACP most of

234
00:10:07,480 --> 00:10:13,150
the protocols that are all there are

235
00:10:09,550 --> 00:10:15,069
proprietary they do have some standard

236
00:10:13,150 --> 00:10:17,709
protocols for most of them the most

237
00:10:15,070 --> 00:10:20,020
important ones are private re some of

238
00:10:17,710 --> 00:10:24,880
them are plaintext some of them are not

239
00:10:20,020 --> 00:10:26,740
some of them support authentication some

240
00:10:24,880 --> 00:10:31,480
event authentication is not even

241
00:10:26,740 --> 00:10:33,400
built-in in the protocol so how people

242
00:10:31,480 --> 00:10:35,650
connect and work with the ESP system

243
00:10:33,400 --> 00:10:38,980
what are many ways and depending on the

244
00:10:35,650 --> 00:10:40,840
services and what is your end goal the

245
00:10:38,980 --> 00:10:42,580
most common way if you're in the ashes

246
00:10:40,840 --> 00:10:47,170
and network is what you see at your

247
00:10:42,580 --> 00:10:49,420
right side is the ASAP GUI this ap GU is

248
00:10:47,170 --> 00:10:52,270
an extra thick client representing the

249
00:10:49,420 --> 00:10:56,410
old client-server architecture it is

250
00:10:52,270 --> 00:10:58,300
more than 1.4 gigabytes when you extract

251
00:10:56,410 --> 00:11:01,569
the client so it's not a lightweight

252
00:10:58,300 --> 00:11:03,640
application and from the other side and

253
00:11:01,570 --> 00:11:05,890
for what we're going to be working for

254
00:11:03,640 --> 00:11:08,230
most of this presentation are the ASAP

255
00:11:05,890 --> 00:11:09,819
web application servers

256
00:11:08,230 --> 00:11:12,060
these are the ones that you will

257
00:11:09,820 --> 00:11:14,290
normally find exposed to the internet

258
00:11:12,060 --> 00:11:16,270
for this presentation we're going to

259
00:11:14,290 --> 00:11:17,770
work with the ICM that is the web

260
00:11:16,270 --> 00:11:20,710
application server for a map remember

261
00:11:17,770 --> 00:11:24,970
where the money is from the Java side

262
00:11:20,710 --> 00:11:28,960
without very cool num name called ASAP

263
00:11:24,970 --> 00:11:31,480
Java HTTP I make the mention of an

264
00:11:28,960 --> 00:11:34,390
evolution of the ICM maybe you hear

265
00:11:31,480 --> 00:11:36,280
about something called XS this is the

266
00:11:34,390 --> 00:11:38,860
evolution of the ICN that is a big has

267
00:11:36,280 --> 00:11:41,380
implemented in Hana but in the end the

268
00:11:38,860 --> 00:11:44,140
main structure is exactly the same to

269
00:11:41,380 --> 00:11:45,939
the ICM so if you haven't figured that

270
00:11:44,140 --> 00:11:49,420
right now and you might be wondering why

271
00:11:45,940 --> 00:11:52,030
someone might like to attack your s AP

272
00:11:49,420 --> 00:11:54,699
implementation as I said before 2 x 3

273
00:11:52,030 --> 00:11:57,189
right now it's worth the money people

274
00:11:54,700 --> 00:11:58,930
know that if you have an SI p you most

275
00:11:57,190 --> 00:12:01,810
likely will be processing cars you most

276
00:11:58,930 --> 00:12:04,959
likely will be managing bank accounts

277
00:12:01,810 --> 00:12:06,849
Ibans everything will be there they know

278
00:12:04,960 --> 00:12:08,770
that also to organization highly depends

279
00:12:06,850 --> 00:12:10,570
on it if you have a production line it's

280
00:12:08,770 --> 00:12:13,540
very common to have that tied together

281
00:12:10,570 --> 00:12:15,780
to your recipe system and finally maybe

282
00:12:13,540 --> 00:12:18,969
they just don't like you

283
00:12:15,780 --> 00:12:23,439
so let's see what is this project R sub

284
00:12:18,970 --> 00:12:25,720
that I keep mentioning about and this is

285
00:12:23,440 --> 00:12:27,250
where the structure of the talk it's a

286
00:12:25,720 --> 00:12:30,820
little different why I am interesting

287
00:12:27,250 --> 00:12:33,130
myself again I work for mixer mixer is a

288
00:12:30,820 --> 00:12:35,800
company that I helped found it that

289
00:12:33,130 --> 00:12:38,920
specialized on pentesting s ap

290
00:12:35,800 --> 00:12:41,859
pentesting Oracle we do a lot of analogy

291
00:12:38,920 --> 00:12:45,160
assessments and unfortunately a lot of

292
00:12:41,860 --> 00:12:47,710
forensics as well we are a relatively

293
00:12:45,160 --> 00:12:49,719
young company and as a relatively young

294
00:12:47,710 --> 00:12:51,880
company we have the same challenges that

295
00:12:49,720 --> 00:12:54,490
most of people have ok how we make money

296
00:12:51,880 --> 00:12:56,890
we will exploit theirs we will explore

297
00:12:54,490 --> 00:12:59,920
writers we were reversers but none of us

298
00:12:56,890 --> 00:13:03,340
was a salesperson it's a total different

299
00:12:59,920 --> 00:13:06,490
beast so we started to us or friends the

300
00:13:03,340 --> 00:13:09,130
so called VD our business development

301
00:13:06,490 --> 00:13:10,720
representative back in Argentina in the

302
00:13:09,130 --> 00:13:12,280
neighborhood where I come from which is

303
00:13:10,720 --> 00:13:14,080
call it telemarketers but it's a fancy

304
00:13:12,280 --> 00:13:17,500
name that we call it did they are by now

305
00:13:14,080 --> 00:13:19,840
so we say ok so how you guys approach

306
00:13:17,500 --> 00:13:22,060
potential new customers they say well we

307
00:13:19,840 --> 00:13:24,550
just buy a sketchy nice

308
00:13:22,060 --> 00:13:26,949
from the internet that says who owns an

309
00:13:24,550 --> 00:13:28,689
NCP system and we choose do cold calling

310
00:13:26,950 --> 00:13:30,610
basically we pick up the phone we are

311
00:13:28,690 --> 00:13:34,510
knowing the people until we can make a

312
00:13:30,610 --> 00:13:36,250
sell interesting so what is the success

313
00:13:34,510 --> 00:13:39,400
rate that you guys have for that they

314
00:13:36,250 --> 00:13:41,980
say well just about the 1% 1% we

315
00:13:39,400 --> 00:13:43,740
immediately we did the connection with

316
00:13:41,980 --> 00:13:47,050
the spammers it's exactly the same

317
00:13:43,740 --> 00:13:48,940
success rate that the spammers get 1% I

318
00:13:47,050 --> 00:13:52,240
don't know if it is a coincidence I

319
00:13:48,940 --> 00:13:55,180
don't think so but we say to ourselves

320
00:13:52,240 --> 00:13:59,350
come on I mean we are hackers we have a

321
00:13:55,180 --> 00:14:02,410
lot of skills we love to code they must

322
00:13:59,350 --> 00:14:05,470
be a better way more intelligent way to

323
00:14:02,410 --> 00:14:08,530
do this and that is when this project

324
00:14:05,470 --> 00:14:11,380
our sub is born basically we leverage

325
00:14:08,530 --> 00:14:13,270
the content on all the different search

326
00:14:11,380 --> 00:14:15,520
engines we try to get as many data

327
00:14:13,270 --> 00:14:20,380
source as possible we used to show them

328
00:14:15,520 --> 00:14:22,360
we use the Google dorks being we use it

329
00:14:20,380 --> 00:14:24,910
the Chinese version of shot and zoom on

330
00:14:22,360 --> 00:14:26,830
that actually I love it if you have the

331
00:14:24,910 --> 00:14:29,800
possibility to to to give it a look it's

332
00:14:26,830 --> 00:14:32,920
very very good and we also use in more

333
00:14:29,800 --> 00:14:35,469
sketchy resources like on the Deep Web

334
00:14:32,920 --> 00:14:38,170
we start leveraging so on search engines

335
00:14:35,470 --> 00:14:40,360
there and some private forums that we

336
00:14:38,170 --> 00:14:43,750
have access to which are even more

337
00:14:40,360 --> 00:14:46,750
sketchy our objective was to live in ash

338
00:14:43,750 --> 00:14:48,610
and to discover as many SMP systems as

339
00:14:46,750 --> 00:14:49,660
possible that they were already exposed

340
00:14:48,610 --> 00:14:52,630
to the Internet

341
00:14:49,660 --> 00:14:55,600
any type of a safety system Ava Java

342
00:14:52,630 --> 00:14:59,610
Business Objects kana whatever we could

343
00:14:55,600 --> 00:15:02,620
get we ended up calling an extractor a

344
00:14:59,610 --> 00:15:04,480
plugin that was constantly connecting

345
00:15:02,620 --> 00:15:06,910
those sides and pulling the information

346
00:15:04,480 --> 00:15:11,170
and doing the deef with information that

347
00:15:06,910 --> 00:15:13,300
we already had why because we knew since

348
00:15:11,170 --> 00:15:14,949
the very beginning that the map that we

349
00:15:13,300 --> 00:15:17,229
would get from the sa piece assistants

350
00:15:14,950 --> 00:15:19,300
will be alive and it was even more

351
00:15:17,230 --> 00:15:22,320
common that we expecting surprisingly

352
00:15:19,300 --> 00:15:25,680
enough ASAP systems are going up and

353
00:15:22,320 --> 00:15:29,770
down from the internet very quickly and

354
00:15:25,680 --> 00:15:31,900
then we start analyse why and to all

355
00:15:29,770 --> 00:15:33,280
surprise and to realization even though

356
00:15:31,900 --> 00:15:35,449
we suspected that will be that way

357
00:15:33,280 --> 00:15:37,819
people are not

358
00:15:35,449 --> 00:15:39,979
spooling the production systems on the

359
00:15:37,819 --> 00:15:42,799
internet that is very very common as

360
00:15:39,980 --> 00:15:46,249
well to find development SAV systems and

361
00:15:42,799 --> 00:15:48,350
cue a.s.a.p systems that is terrible

362
00:15:46,249 --> 00:15:49,790
because remember that all the SCP

363
00:15:48,350 --> 00:15:52,879
systems are interconnected and in

364
00:15:49,790 --> 00:15:55,879
general the security policy implemented

365
00:15:52,879 --> 00:15:57,799
in depth is much more luxe but the

366
00:15:55,879 --> 00:15:59,629
security policy that is implemented in

367
00:15:57,799 --> 00:16:04,249
production it should not be that way but

368
00:15:59,629 --> 00:16:07,129
it is so ok we have this line map and we

369
00:16:04,249 --> 00:16:10,160
ended up with a lot of information just

370
00:16:07,129 --> 00:16:12,169
a bulk of information is worthless we

371
00:16:10,160 --> 00:16:13,219
needed a way to be smart to start

372
00:16:12,169 --> 00:16:16,339
classifying things

373
00:16:13,220 --> 00:16:19,339
lucky for us and these search engines

374
00:16:16,339 --> 00:16:21,829
already captured that ASAP especially in

375
00:16:19,339 --> 00:16:24,109
the heaters is quite verbose and I have

376
00:16:21,829 --> 00:16:27,138
included some real examples here look at

377
00:16:24,109 --> 00:16:29,540
this there is no possible confusion that

378
00:16:27,139 --> 00:16:32,269
you are dealing with an SP system is a

379
00:16:29,540 --> 00:16:37,399
peon and we will application server 7.21

380
00:16:32,269 --> 00:16:39,709
slash is a PE Java 7.51 you get what

381
00:16:37,399 --> 00:16:43,999
type of SP system is and you also get

382
00:16:39,709 --> 00:16:45,768
the version this came very handy so we

383
00:16:43,999 --> 00:16:48,049
immediately we started to put it

384
00:16:45,769 --> 00:16:50,329
together Sun intelligence around that we

385
00:16:48,049 --> 00:16:52,399
know what the CP systems were exposed we

386
00:16:50,329 --> 00:16:54,949
know what services what protocols were

387
00:16:52,399 --> 00:16:57,499
being exposed we knew the country and

388
00:16:54,949 --> 00:17:00,910
the continent that was hosting that ASAP

389
00:16:57,499 --> 00:17:06,409
system I want to put a caveat here

390
00:17:00,910 --> 00:17:10,398
sometimes we face it an interesting

391
00:17:06,409 --> 00:17:12,350
situation because the host the host

392
00:17:10,398 --> 00:17:14,329
country that is hosting that the CP

393
00:17:12,349 --> 00:17:16,849
system not necessarily is the same

394
00:17:14,329 --> 00:17:19,519
country as the owner for example there

395
00:17:16,849 --> 00:17:22,069
are a lot a lot of resistance being

396
00:17:19,519 --> 00:17:24,349
crossed in Amazon Singapore and not

397
00:17:22,069 --> 00:17:28,820
necessarily the owner is a Singaporean

398
00:17:24,349 --> 00:17:31,449
company so once we got the systems we

399
00:17:28,820 --> 00:17:34,370
also start to going a little bit ahead

400
00:17:31,450 --> 00:17:37,250
those those systems that are being

401
00:17:34,370 --> 00:17:39,408
exposed support encryption surprisingly

402
00:17:37,250 --> 00:17:41,179
enough a lot of CP systems that are

403
00:17:39,409 --> 00:17:43,639
exposed to the Internet the certificates

404
00:17:41,179 --> 00:17:46,590
are self sign or they are deprecated or

405
00:17:43,639 --> 00:17:49,590
using an insecure algorithm

406
00:17:46,590 --> 00:17:53,158
and finally we got the versions we went

407
00:17:49,590 --> 00:17:55,590
a little bit further data applying some

408
00:17:53,159 --> 00:17:57,899
techniques always without touching the

409
00:17:55,590 --> 00:18:00,149
SMP system but doing who is or just

410
00:17:57,899 --> 00:18:02,850
taking a look at the certificates we

411
00:18:00,149 --> 00:18:05,399
were able to identify who was the owner

412
00:18:02,850 --> 00:18:07,678
of those ACP systems as I always like to

413
00:18:05,399 --> 00:18:10,709
joke there is no such things of a

414
00:18:07,679 --> 00:18:12,509
rolls-royce being orphan here is exactly

415
00:18:10,710 --> 00:18:14,159
the same there is no orphan except

416
00:18:12,509 --> 00:18:17,360
assistants a position costs a lot of

417
00:18:14,159 --> 00:18:20,669
money so someone must be behind us and

418
00:18:17,360 --> 00:18:23,969
finally and finally as we had the

419
00:18:20,669 --> 00:18:26,909
version we compared the version against

420
00:18:23,970 --> 00:18:30,659
public disclosed when abilities are or

421
00:18:26,909 --> 00:18:33,269
own internal vulnerability database so

422
00:18:30,659 --> 00:18:38,700
we were able to prioritize what a SAP

423
00:18:33,269 --> 00:18:42,690
assistance were on more risk are

424
00:18:38,700 --> 00:18:46,799
intrigued by the results we found in

425
00:18:42,690 --> 00:18:49,230
total 14000 ASAP services directly

426
00:18:46,799 --> 00:18:51,509
exposed there this is with other woth

427
00:18:49,230 --> 00:18:54,629
and with all our dispatcher and without

428
00:18:51,509 --> 00:18:59,519
any type of filtering the vast majority

429
00:18:54,629 --> 00:19:01,918
of them were able systems like 8,000 a

430
00:18:59,519 --> 00:19:04,320
little bit more than 8,000 and then on

431
00:19:01,919 --> 00:19:06,840
the second place he came to Java this

432
00:19:04,320 --> 00:19:08,879
makes sense and corroborates what we are

433
00:19:06,840 --> 00:19:11,519
seeing in the market and by ASAP

434
00:19:08,879 --> 00:19:15,449
strategy of slowly sunset in the java

435
00:19:11,519 --> 00:19:19,019
part more scary numbers we were able to

436
00:19:15,450 --> 00:19:21,509
identify almost 40% of the owners of all

437
00:19:19,019 --> 00:19:27,840
those s AP systems that were there and

438
00:19:21,509 --> 00:19:32,399
the most scary one rough-and-tough 27%

439
00:19:27,840 --> 00:19:34,439
of those ASAP systems had critical burn

440
00:19:32,399 --> 00:19:36,149
abilities or high burn abilities I'm

441
00:19:34,440 --> 00:19:38,940
talking about like remote command

442
00:19:36,149 --> 00:19:40,678
executions file raid file uploads some

443
00:19:38,940 --> 00:19:43,919
of the assistance it was like a one

444
00:19:40,679 --> 00:19:45,799
exploit totally powned or some others

445
00:19:43,919 --> 00:19:47,549
you had to work a little bit further

446
00:19:45,799 --> 00:19:49,830
something that we're going to do very

447
00:19:47,549 --> 00:19:52,139
soon and we actually ended up being

448
00:19:49,830 --> 00:19:55,879
highly surprised by this number we were

449
00:19:52,139 --> 00:19:58,889
expecting the number to be around 10%

450
00:19:55,879 --> 00:20:00,299
immediately we are like a bad feeling

451
00:19:58,889 --> 00:20:03,399
here in our chest

452
00:20:00,299 --> 00:20:05,830
if someone is skilled enough we'll start

453
00:20:03,400 --> 00:20:08,820
playing with this definitely will be the

454
00:20:05,830 --> 00:20:11,879
next s AP tragedy and we wanted to help

455
00:20:08,820 --> 00:20:15,399
how you say well keep watching

456
00:20:11,880 --> 00:20:18,010
I'm getting advanced here because I know

457
00:20:15,400 --> 00:20:20,679
that is the question that you will ask I

458
00:20:18,010 --> 00:20:22,919
will ask the question the same yes we're

459
00:20:20,679 --> 00:20:25,809
going to release the information with an

460
00:20:22,919 --> 00:20:27,700
open license so everyone will be able to

461
00:20:25,809 --> 00:20:30,340
benefit from the number and/or research

462
00:20:27,700 --> 00:20:32,440
what we're not going to include are the

463
00:20:30,340 --> 00:20:34,480
URLs because we don't want people start

464
00:20:32,440 --> 00:20:36,340
attacking and also the name of the

465
00:20:34,480 --> 00:20:38,200
companies but information is going to be

466
00:20:36,340 --> 00:20:40,178
released and it's going to be public we

467
00:20:38,200 --> 00:20:41,980
haven't defined yet how we're going to

468
00:20:40,179 --> 00:20:44,950
structure that information if it's going

469
00:20:41,980 --> 00:20:46,809
to be like a PDF more like a scientific

470
00:20:44,950 --> 00:20:48,520
paper or if it's going to be something

471
00:20:46,809 --> 00:20:50,289
like with the blog when you can point

472
00:20:48,520 --> 00:20:51,908
and click and it's more interactive and

473
00:20:50,289 --> 00:20:54,549
nice but we don't know yet what we know

474
00:20:51,909 --> 00:21:00,159
is that it's going to come q3 q4 this

475
00:20:54,549 --> 00:21:02,950
year okay so we need to start thinking

476
00:21:00,159 --> 00:21:04,539
like an attacker the first is an area

477
00:21:02,950 --> 00:21:06,190
that I'm going to show you is the same

478
00:21:04,539 --> 00:21:08,440
that they want that I told you before

479
00:21:06,190 --> 00:21:10,750
that is based on a true story and this

480
00:21:08,440 --> 00:21:12,789
is one of these scenarios that I ended

481
00:21:10,750 --> 00:21:16,870
up downgrading the attack a little bit

482
00:21:12,789 --> 00:21:19,030
more and you're going to see why if you

483
00:21:16,870 --> 00:21:22,389
are an attacker if you're an attacker

484
00:21:19,030 --> 00:21:24,610
you already know what company is running

485
00:21:22,390 --> 00:21:26,200
the SMP system and you know the SMP

486
00:21:24,610 --> 00:21:28,449
system that is exposed to the Internet

487
00:21:26,200 --> 00:21:32,590
it will be trivial for you to start

488
00:21:28,450 --> 00:21:35,140
enumerating and identifying the people

489
00:21:32,590 --> 00:21:38,500
that is working on that company right

490
00:21:35,140 --> 00:21:40,659
you can go to Halloweentown you can go

491
00:21:38,500 --> 00:21:42,789
to LinkedIn you can even start

492
00:21:40,659 --> 00:21:46,150
researching that on Google you can ended

493
00:21:42,789 --> 00:21:47,799
up with a lot of emails after that you

494
00:21:46,150 --> 00:21:50,049
know that the organization if it is

495
00:21:47,799 --> 00:21:53,379
using as IP probably is using a CP

496
00:21:50,049 --> 00:21:55,539
across the board is the core definition

497
00:21:53,380 --> 00:21:57,760
of a ERP system is a software that is

498
00:21:55,539 --> 00:22:01,658
supposed to give solutions to each one

499
00:21:57,760 --> 00:22:05,190
of the divisions of your company and

500
00:22:01,659 --> 00:22:07,690
finally you know if that company is

501
00:22:05,190 --> 00:22:09,700
acquiring a CP system probably has a lot

502
00:22:07,690 --> 00:22:11,789
of resources and if he has a lot of

503
00:22:09,700 --> 00:22:13,700
resources to have a significant

504
00:22:11,789 --> 00:22:16,710
headcount

505
00:22:13,700 --> 00:22:19,350
if companies have a significant

506
00:22:16,710 --> 00:22:21,090
headcount is very common for them to

507
00:22:19,350 --> 00:22:23,550
implement something that is called

508
00:22:21,090 --> 00:22:24,929
single sign-on when people don't have to

509
00:22:23,550 --> 00:22:26,280
remember multiple password for

510
00:22:24,930 --> 00:22:28,650
everything they just remember one

511
00:22:26,280 --> 00:22:30,720
password and when they do double click

512
00:22:28,650 --> 00:22:32,310
on the SMP client the SMP clan would

513
00:22:30,720 --> 00:22:36,150
choose pop up and would be already

514
00:22:32,310 --> 00:22:38,250
logging we're going to combine that and

515
00:22:36,150 --> 00:22:40,260
this is what the original attacker did

516
00:22:38,250 --> 00:22:43,010
with something that is called sub GUI

517
00:22:40,260 --> 00:22:46,320
scripts basically these scripts are

518
00:22:43,010 --> 00:22:50,420
treating for doing automatic testing or

519
00:22:46,320 --> 00:22:52,560
automating procedures on the ASAP system

520
00:22:50,420 --> 00:22:56,040
know by default

521
00:22:52,560 --> 00:22:59,270
this sub GUI scripts come disabled but

522
00:22:56,040 --> 00:23:01,470
most companies 90% by your experience

523
00:22:59,270 --> 00:23:03,600
activate this functionality because it's

524
00:23:01,470 --> 00:23:06,150
extremely common even the most high end

525
00:23:03,600 --> 00:23:08,909
products use this functionality for

526
00:23:06,150 --> 00:23:09,840
stress testing and even functional

527
00:23:08,910 --> 00:23:12,810
testing as well

528
00:23:09,840 --> 00:23:15,169
I included a picture for you of more or

529
00:23:12,810 --> 00:23:18,750
less how a sub GUI script looks like

530
00:23:15,170 --> 00:23:21,210
similar to a visual basic script so what

531
00:23:18,750 --> 00:23:23,010
is going to happen here and how we're

532
00:23:21,210 --> 00:23:25,200
going to proceed this is exactly the

533
00:23:23,010 --> 00:23:27,830
same how this case went through we're

534
00:23:25,200 --> 00:23:30,510
going to send a malicious file by email

535
00:23:27,830 --> 00:23:32,730
with the sub-query script attached to it

536
00:23:30,510 --> 00:23:34,860
and the victim will only have to do a

537
00:23:32,730 --> 00:23:37,680
double click to perform malicious action

538
00:23:34,860 --> 00:23:39,929
on the ASAP system you could do whatever

539
00:23:37,680 --> 00:23:42,360
you want here as such as a silly example

540
00:23:39,930 --> 00:23:44,490
what I chose to do is to delete the

541
00:23:42,360 --> 00:23:47,429
content of a table that is supposed to a

542
00:23:44,490 --> 00:23:51,090
contained public depth the tag will go

543
00:23:47,430 --> 00:23:54,030
like this this is the part that I had to

544
00:23:51,090 --> 00:23:57,629
downgrade a lid with the experience I'm

545
00:23:54,030 --> 00:23:59,639
going to show you the sub quiz grid as a

546
00:23:57,630 --> 00:24:02,970
visual basic script and you can tell me

547
00:23:59,640 --> 00:24:06,960
what Jordan nowadays any anti-malware

548
00:24:02,970 --> 00:24:09,770
any email filtering capabilities will

549
00:24:06,960 --> 00:24:13,230
stop that yes and there is also a way

550
00:24:09,770 --> 00:24:15,540
using ACP technology to completely make

551
00:24:13,230 --> 00:24:17,340
that undetected but it will be too heavy

552
00:24:15,540 --> 00:24:18,960
to release that on the presentation

553
00:24:17,340 --> 00:24:20,760
after representation if you have

554
00:24:18,960 --> 00:24:23,220
questions come to me and I will give you

555
00:24:20,760 --> 00:24:24,750
a hint of how you can do it but for this

556
00:24:23,220 --> 00:24:27,000
presentation that also is going to be

557
00:24:24,750 --> 00:24:29,010
recorded we're going to keep it safe

558
00:24:27,000 --> 00:24:30,179
again the purpose here is to help people

559
00:24:29,010 --> 00:24:33,230
not to make it worse

560
00:24:30,179 --> 00:24:37,559
plus I the one I get so it is what it is

561
00:24:33,230 --> 00:24:39,179
going to show you first sub GUI this is

562
00:24:37,559 --> 00:24:42,740
the client that we were talking about

563
00:24:39,179 --> 00:24:46,020
yesterday yesterday a few moments ago

564
00:24:42,740 --> 00:24:47,370
this is transaction IC 11 I'm from here

565
00:24:46,020 --> 00:24:50,250
I'm going to show you that there is a

566
00:24:47,370 --> 00:24:55,649
table that is public debt where I'm

567
00:24:50,250 --> 00:24:56,000
going to show you the content there we

568
00:24:55,650 --> 00:24:58,500
go

569
00:24:56,000 --> 00:25:01,530
kudos if you can identify the name

570
00:24:58,500 --> 00:25:03,210
you're almost as old as me as you can

571
00:25:01,530 --> 00:25:04,620
see there are amounts there different

572
00:25:03,210 --> 00:25:06,870
values they're different people that

573
00:25:04,620 --> 00:25:09,110
they own money look at this look what

574
00:25:06,870 --> 00:25:11,610
happens is someone double clicks

575
00:25:09,110 --> 00:25:15,360
receives that malicious action and

576
00:25:11,610 --> 00:25:18,178
double clicks on it I need to make it

577
00:25:15,360 --> 00:25:26,250
very visible because it's going to be

578
00:25:18,179 --> 00:25:29,789
really fast okay go that's it

579
00:25:26,250 --> 00:25:32,730
automatically and this works even if the

580
00:25:29,789 --> 00:25:35,850
sub GUI is minimized so what's happening

581
00:25:32,730 --> 00:25:36,990
here let's go to transaction I see 11

582
00:25:35,850 --> 00:25:38,789
and let me show you what's happening

583
00:25:36,990 --> 00:25:44,190
with the content of the table again this

584
00:25:38,789 --> 00:25:47,250
is the most silly example it's

585
00:25:44,190 --> 00:25:49,880
completely empty why why this is

586
00:25:47,250 --> 00:25:52,890
happening well it's a valid use case

587
00:25:49,880 --> 00:25:54,720
it's a valid use case and you could

588
00:25:52,890 --> 00:25:56,730
disable the execution of the SAP GUI

589
00:25:54,720 --> 00:25:59,190
scripting if you want you you just need

590
00:25:56,730 --> 00:26:01,770
to modify a profile parameter called sub

591
00:25:59,190 --> 00:26:03,169
GUI slash user underscore scripting you

592
00:26:01,770 --> 00:26:05,429
need to set that in false and

593
00:26:03,169 --> 00:26:09,000
unfortunately as many things in a CP you

594
00:26:05,429 --> 00:26:10,860
need to restore the ASAP system can you

595
00:26:09,000 --> 00:26:14,429
take the luxury of doing so

596
00:26:10,860 --> 00:26:16,770
most likely not most companies highly

597
00:26:14,429 --> 00:26:19,230
depend on this functionality to happen

598
00:26:16,770 --> 00:26:21,330
so what you can do about it well if

599
00:26:19,230 --> 00:26:24,750
you're in a new version of a CP system

600
00:26:21,330 --> 00:26:26,789
720 on words there is a workaround if

601
00:26:24,750 --> 00:26:30,450
you are below that version unfortunately

602
00:26:26,789 --> 00:26:32,940
sorry you are stuck with this you keep

603
00:26:30,450 --> 00:26:34,740
the sub GUI scripting enable and you

604
00:26:32,940 --> 00:26:37,350
modified the profile parameters Crete

605
00:26:34,740 --> 00:26:39,000
slash user underscore script underscore

606
00:26:37,350 --> 00:26:40,980
pair and score per user you put it in

607
00:26:39,000 --> 00:26:43,320
true and for that moment

608
00:26:40,980 --> 00:26:46,679
only the users that had authorization s

609
00:26:43,320 --> 00:26:52,289
underscore s CR on 16 will be able to

610
00:26:46,679 --> 00:26:56,220
execute this and also and also something

611
00:26:52,289 --> 00:26:58,350
that people disabled a lot is the

612
00:26:56,220 --> 00:27:01,169
notification where the sub buoy is going

613
00:26:58,350 --> 00:27:03,539
to be activated and the problem is that

614
00:27:01,169 --> 00:27:07,370
when you disable this at your end

615
00:27:03,539 --> 00:27:10,379
customers at all of your workstations

616
00:27:07,370 --> 00:27:12,719
most organizations disabling clovelly

617
00:27:10,380 --> 00:27:15,029
through group policies so it's not just

618
00:27:12,720 --> 00:27:17,820
for one guy that is evenly across the

619
00:27:15,029 --> 00:27:19,440
war so when you do a double click on the

620
00:27:17,820 --> 00:27:22,799
subway you have no warning whatsoever

621
00:27:19,440 --> 00:27:24,960
what you need to do is see here will say

622
00:27:22,799 --> 00:27:27,360
notify when a script attaches to the

623
00:27:24,960 --> 00:27:29,880
subway that must be enabled at least

624
00:27:27,360 --> 00:27:31,918
when the user the victim will do a

625
00:27:29,880 --> 00:27:35,639
double click it will appear a pop-up

626
00:27:31,919 --> 00:27:38,429
that says a isaku is trying to use your

627
00:27:35,639 --> 00:27:42,209
SP client are you sure about that at

628
00:27:38,429 --> 00:27:44,309
least you get a pop-up okay this is

629
00:27:42,210 --> 00:27:46,049
where it gets a little bit more complex

630
00:27:44,309 --> 00:27:49,110
there were weaponization and the

631
00:27:46,049 --> 00:27:51,139
prevention how you can avoid being

632
00:27:49,110 --> 00:27:55,439
exploited directly from the internet

633
00:27:51,139 --> 00:27:57,449
when we started analyzing all this we

634
00:27:55,440 --> 00:27:59,789
again we repeated in your heads

635
00:27:57,450 --> 00:28:02,429
man if the ransomware is going to be

636
00:27:59,789 --> 00:28:03,779
created if a warm is going to be created

637
00:28:02,429 --> 00:28:06,649
this results could be really

638
00:28:03,779 --> 00:28:10,470
catastrophic we wanted to help but

639
00:28:06,649 --> 00:28:13,709
before we could help we need to start

640
00:28:10,470 --> 00:28:16,620
put it into our heads how an attacker

641
00:28:13,710 --> 00:28:19,320
will try to get in and break inside your

642
00:28:16,620 --> 00:28:21,928
ASAP system how that person will try to

643
00:28:19,320 --> 00:28:23,370
massively compromise all the systems

644
00:28:21,929 --> 00:28:26,340
that they were exposed to the Internet

645
00:28:23,370 --> 00:28:28,799
for that we started doing some history

646
00:28:26,340 --> 00:28:31,789
lessons and we started to analyze and

647
00:28:28,799 --> 00:28:34,350
learn how path ransom words used to work

648
00:28:31,789 --> 00:28:36,389
we discovered that some of them will

649
00:28:34,350 --> 00:28:38,668
share personality traits that I had put

650
00:28:36,389 --> 00:28:42,320
it there for you first of all they were

651
00:28:38,669 --> 00:28:45,510
designed to hit you and hit you hard

652
00:28:42,320 --> 00:28:47,399
lateral movement was called that was the

653
00:28:45,510 --> 00:28:49,139
in objected keep compromising and

654
00:28:47,399 --> 00:28:52,428
compromising and compromising the the

655
00:28:49,139 --> 00:28:54,750
more the better and because of that

656
00:28:52,429 --> 00:28:57,840
avoiding making noise was

657
00:28:54,750 --> 00:29:01,380
not a priority per se finally they were

658
00:28:57,840 --> 00:29:04,370
open to weaponize some previously

659
00:29:01,380 --> 00:29:07,320
reported burn abilities most of these

660
00:29:04,370 --> 00:29:08,939
you can call it stay outdoors you can

661
00:29:07,320 --> 00:29:11,310
call it criminal organizations they

662
00:29:08,940 --> 00:29:14,040
already have a framework for the whole

663
00:29:11,310 --> 00:29:15,419
Mark Warner for the whole workflow you

664
00:29:14,040 --> 00:29:18,540
can call it kind of like a gun and

665
00:29:15,420 --> 00:29:20,220
teaches me t exploit that bullet to put

666
00:29:18,540 --> 00:29:24,870
it there they're just waiting for that

667
00:29:20,220 --> 00:29:26,640
bullet this it's going to be or attack a

668
00:29:24,870 --> 00:29:30,149
scenario and it's actually a very very

669
00:29:26,640 --> 00:29:32,370
common one on how most implementations

670
00:29:30,150 --> 00:29:34,860
of sa piece that are exposed to the

671
00:29:32,370 --> 00:29:37,260
Internet looks like we are going to be

672
00:29:34,860 --> 00:29:39,659
working with a Java system that is going

673
00:29:37,260 --> 00:29:42,450
to be on the DMC we're going to be

674
00:29:39,660 --> 00:29:44,790
working with an evap system that is also

675
00:29:42,450 --> 00:29:47,310
on the DMZ and we are going to try to

676
00:29:44,790 --> 00:29:54,180
jump to all the systems that are on the

677
00:29:47,310 --> 00:29:55,379
internal network or DHS and network how

678
00:29:54,180 --> 00:29:57,060
we're gonna do it or what is the

679
00:29:55,380 --> 00:29:59,160
approach or the phases that we're going

680
00:29:57,060 --> 00:30:01,080
to do it well I felt about it in five

681
00:29:59,160 --> 00:30:03,330
different phases it's going to be the

682
00:30:01,080 --> 00:30:05,129
intro the intrusion this is the most

683
00:30:03,330 --> 00:30:07,560
important part for an attacker point of

684
00:30:05,130 --> 00:30:08,670
view like setting foot inside one of the

685
00:30:07,560 --> 00:30:11,010
systems on the DMZ

686
00:30:08,670 --> 00:30:13,260
we're going to do that utilizing an

687
00:30:11,010 --> 00:30:15,240
exploit we're going to do some

688
00:30:13,260 --> 00:30:17,520
credential gathering this is one of the

689
00:30:15,240 --> 00:30:19,230
most important parts once the exploit

690
00:30:17,520 --> 00:30:21,960
hits you we're going to see what level

691
00:30:19,230 --> 00:30:23,910
of privileges do we have and how we can

692
00:30:21,960 --> 00:30:25,500
utilize those privileges to get even

693
00:30:23,910 --> 00:30:27,750
more credentials on what type of

694
00:30:25,500 --> 00:30:29,580
credentials once we have that we're

695
00:30:27,750 --> 00:30:32,520
going to do lateral movement from the

696
00:30:29,580 --> 00:30:34,530
Java system that I show you here we're

697
00:30:32,520 --> 00:30:39,060
going to try to compromise the able

698
00:30:34,530 --> 00:30:43,080
system and finally finally we're going

699
00:30:39,060 --> 00:30:45,320
to try to jump from the DMC if you are

700
00:30:43,080 --> 00:30:48,750
an attacker or even if you are like a

701
00:30:45,320 --> 00:30:52,260
functional implement a tour or network

702
00:30:48,750 --> 00:30:54,630
designer you most likely always allow

703
00:30:52,260 --> 00:30:57,930
connections from the a verb sustained on

704
00:30:54,630 --> 00:31:00,060
the DMC to the HSN network why because

705
00:30:57,930 --> 00:31:03,300
you need to pull information that other

706
00:31:00,060 --> 00:31:07,440
systems are processing or are storing is

707
00:31:03,300 --> 00:31:08,580
always very very common so what means it

708
00:31:07,440 --> 00:31:10,380
means that you already have

709
00:31:08,580 --> 00:31:14,970
for our exception from that system on

710
00:31:10,380 --> 00:31:17,730
the DMC to the HSN Network and finally

711
00:31:14,970 --> 00:31:21,269
antenna like a bonus a part of attacking

712
00:31:17,730 --> 00:31:23,659
the system's own on the DMC sorry on the

713
00:31:21,269 --> 00:31:26,940
HSN Network we're going to attack the

714
00:31:23,659 --> 00:31:29,519
customers that are working with the s IP

715
00:31:26,940 --> 00:31:31,950
systems on the ashes and network again

716
00:31:29,519 --> 00:31:33,960
there will be there many techniques to

717
00:31:31,950 --> 00:31:35,730
achieve this I'm going to show you

718
00:31:33,960 --> 00:31:38,399
something that makes sense

719
00:31:35,730 --> 00:31:41,580
is powerful but something that will be

720
00:31:38,399 --> 00:31:44,219
trickier for someone bad to do something

721
00:31:41,580 --> 00:31:46,019
even more bad I'm going to show you the

722
00:31:44,220 --> 00:31:49,710
technical attacks and I'm going to show

723
00:31:46,019 --> 00:31:52,620
you the countermeasure of that of course

724
00:31:49,710 --> 00:31:55,049
the end worm will not be distributed by

725
00:31:52,620 --> 00:31:58,768
for obvious reasons but I will show you

726
00:31:55,049 --> 00:32:04,129
pieces of code to exemplify the attacks

727
00:31:58,769 --> 00:32:07,649
and and the credential harvesting okay

728
00:32:04,130 --> 00:32:10,710
so as well as I mentioned before mal

729
00:32:07,649 --> 00:32:12,510
works like the outer of man wanna cry

730
00:32:10,710 --> 00:32:15,149
and many others they already had the

731
00:32:12,510 --> 00:32:17,309
framework they just need the ability or

732
00:32:15,149 --> 00:32:20,399
the exploit to come up to the light and

733
00:32:17,309 --> 00:32:22,678
exploit that is relatively new and it

734
00:32:20,399 --> 00:32:24,809
just me the vulnerable victims this

735
00:32:22,679 --> 00:32:26,250
attacker already harvested all the SF

736
00:32:24,809 --> 00:32:28,740
assistance that they're on the internet

737
00:32:26,250 --> 00:32:30,240
and he or she already knows an exploit

738
00:32:28,740 --> 00:32:32,880
and we're going to see what exploit is

739
00:32:30,240 --> 00:32:34,559
better network diagram the first victim

740
00:32:32,880 --> 00:32:37,019
the first system where we're going to

741
00:32:34,559 --> 00:32:41,220
set food will be that Java run and

742
00:32:37,019 --> 00:32:43,679
system on the DMC of course the exploit

743
00:32:41,220 --> 00:32:45,659
that were going to utilize will allow us

744
00:32:43,679 --> 00:32:48,419
to execute operating system commands

745
00:32:45,659 --> 00:32:52,649
under the privileges of the operating

746
00:32:48,419 --> 00:32:54,809
system user that holds the entire s AP

747
00:32:52,649 --> 00:32:56,908
application if you get the level of

748
00:32:54,809 --> 00:32:59,158
access you can shut down the SCP system

749
00:32:56,909 --> 00:33:02,340
you can corrupt the kernel you can

750
00:32:59,159 --> 00:33:04,200
execute queries without knowing the

751
00:33:02,340 --> 00:33:06,299
database password by a vision of the

752
00:33:04,200 --> 00:33:08,549
trans relationship that those users will

753
00:33:06,299 --> 00:33:10,559
always have with the database so pretty

754
00:33:08,549 --> 00:33:15,539
much when we get to that point it will

755
00:33:10,559 --> 00:33:18,960
be game over this is a relatively not so

756
00:33:15,539 --> 00:33:21,690
new I exploit we can say but hey we knew

757
00:33:18,960 --> 00:33:22,000
already all the systems that we had and

758
00:33:21,690 --> 00:33:24,070
we

759
00:33:22,000 --> 00:33:26,800
new already all the version of those

760
00:33:24,070 --> 00:33:29,919
seasons that we have and almost three

761
00:33:26,800 --> 00:33:31,870
out of ten Java systems that we have in

762
00:33:29,920 --> 00:33:34,630
our list where Boone era will dis attack

763
00:33:31,870 --> 00:33:36,729
again this is in theory because we never

764
00:33:34,630 --> 00:33:39,160
actually attack any of those as the VC

765
00:33:36,730 --> 00:33:43,330
sense that the one on the Internet okay

766
00:33:39,160 --> 00:33:46,720
so let me show you the first exploit huh

767
00:33:43,330 --> 00:33:52,720
and I forgot to open my ETA

768
00:33:46,720 --> 00:33:56,860
please hold this is where we need like

769
00:33:52,720 --> 00:33:59,650
they're waiting music kind of stuff

770
00:33:56,860 --> 00:34:04,870
there we go

771
00:33:59,650 --> 00:34:06,940
i divided this warm and this exploit on

772
00:34:04,870 --> 00:34:08,529
three different phases at the very end

773
00:34:06,940 --> 00:34:10,649
of the presentation I'm just going to

774
00:34:08,530 --> 00:34:12,490
run the one that does everything

775
00:34:10,649 --> 00:34:15,969
automatic and you will see the total

776
00:34:12,489 --> 00:34:18,759
flow execution to be honest it will be

777
00:34:15,969 --> 00:34:20,888
that fast that it would be a little bit

778
00:34:18,760 --> 00:34:22,870
tricky to catch once we finish with the

779
00:34:20,889 --> 00:34:24,639
execution but at least you will be seen

780
00:34:22,870 --> 00:34:30,040
that is totally possible to create like

781
00:34:24,639 --> 00:34:32,379
a complete warm okay okay so look at my

782
00:34:30,040 --> 00:34:36,040
screen poof this is like the third

783
00:34:32,379 --> 00:34:40,210
loading there we go

784
00:34:36,040 --> 00:34:42,009
this is for the end see the three

785
00:34:40,210 --> 00:34:44,020
different phases later on I'm going to

786
00:34:42,010 --> 00:34:46,270
show you the whole thing but for the

787
00:34:44,020 --> 00:34:50,139
main phase we're going to execute

788
00:34:46,270 --> 00:34:52,540
operating system commands upstairs here

789
00:34:50,139 --> 00:34:55,450
you can see the payload this one I'm

790
00:34:52,540 --> 00:34:57,970
going to show you because is well known

791
00:34:55,449 --> 00:34:59,890
in public that is the URL that we are

792
00:34:57,970 --> 00:35:05,439
going to be using to execute operating

793
00:34:59,890 --> 00:35:07,359
system commands and at the very end are

794
00:35:05,440 --> 00:35:11,020
the commands that we're going to be

795
00:35:07,360 --> 00:35:13,570
executing you will be able to see like a

796
00:35:11,020 --> 00:35:17,200
Who am I the current working part and

797
00:35:13,570 --> 00:35:19,480
the privileges of the user or running

798
00:35:17,200 --> 00:35:23,259
the ESP system let me quickly show you

799
00:35:19,480 --> 00:35:25,630
the sub service this is a service user

800
00:35:23,260 --> 00:35:28,750
that is the working part and if you

801
00:35:25,630 --> 00:35:31,780
scroll down with me on this particular

802
00:35:28,750 --> 00:35:35,020
recipe system sub service is not just

803
00:35:31,780 --> 00:35:35,820
part of the local ASAP administrator

804
00:35:35,020 --> 00:35:40,020
group

805
00:35:35,820 --> 00:35:42,240
local or Palace women if also is part of

806
00:35:40,020 --> 00:35:45,330
the ministry tour group on the local OS

807
00:35:42,240 --> 00:35:47,160
version totally powned if we got this

808
00:35:45,330 --> 00:35:51,299
level of privileges we can do whatever

809
00:35:47,160 --> 00:35:54,450
we want so but the man one needs to be

810
00:35:51,300 --> 00:35:56,370
smart right common execution as it is is

811
00:35:54,450 --> 00:35:58,890
not that import and remember that if

812
00:35:56,370 --> 00:36:00,509
someone is attacking an NCP system most

813
00:35:58,890 --> 00:36:02,430
likely is trying to disrupt your

814
00:36:00,510 --> 00:36:05,040
business or going for the money

815
00:36:02,430 --> 00:36:06,750
basically so before we continue how you

816
00:36:05,040 --> 00:36:08,400
can close the gap this well you need to

817
00:36:06,750 --> 00:36:10,740
apply three different patches three

818
00:36:08,400 --> 00:36:12,960
different what is called SMP notes and

819
00:36:10,740 --> 00:36:14,939
unfortunately you can only consume if

820
00:36:12,960 --> 00:36:17,730
you are an ACP customer those are the

821
00:36:14,940 --> 00:36:19,980
number on the top left corner a part of

822
00:36:17,730 --> 00:36:21,570
applying those notes and depending on

823
00:36:19,980 --> 00:36:23,970
the version of the SMP system that you

824
00:36:21,570 --> 00:36:26,820
have you need to switch this invoker

825
00:36:23,970 --> 00:36:29,189
server functionality to false for that

826
00:36:26,820 --> 00:36:32,010
you need to go to what is called a Java

827
00:36:29,190 --> 00:36:34,320
config tool inside the SMP system or an

828
00:36:32,010 --> 00:36:36,300
easier way you go to the netweaver

829
00:36:34,320 --> 00:36:38,880
demonstrator page from your browser

830
00:36:36,300 --> 00:36:41,610
server configurations servlet and you

831
00:36:38,880 --> 00:36:44,580
disabled invoker servlet be very careful

832
00:36:41,610 --> 00:36:46,710
if you have relatively old version and

833
00:36:44,580 --> 00:36:51,509
not some new version you have to apply

834
00:36:46,710 --> 00:36:54,390
the latest no 146 777 one before the

835
00:36:51,510 --> 00:36:56,490
sale in the blocking servlet why because

836
00:36:54,390 --> 00:36:59,129
this IP used to heavily use the

837
00:36:56,490 --> 00:37:01,229
functionality not just to install itself

838
00:36:59,130 --> 00:37:04,200
isn't if not to do I mean strata with

839
00:37:01,230 --> 00:37:06,390
tasks if you disable the invoker surly

840
00:37:04,200 --> 00:37:10,160
without applying time node no one else

841
00:37:06,390 --> 00:37:12,750
will be able to log into the ASAP portal

842
00:37:10,160 --> 00:37:14,180
finally you need to restore the SMP

843
00:37:12,750 --> 00:37:17,370
system for the changes to take effect

844
00:37:14,180 --> 00:37:19,049
this is how you fix it this is the most

845
00:37:17,370 --> 00:37:21,420
important part from the blue teamers

846
00:37:19,050 --> 00:37:23,070
because once we are there in the DMC is

847
00:37:21,420 --> 00:37:25,590
just a matter of time as we're going to

848
00:37:23,070 --> 00:37:27,420
see now with the we need to do lateral

849
00:37:25,590 --> 00:37:29,490
movement right I don't know if you

850
00:37:27,420 --> 00:37:31,590
remember when the DMC we compromised

851
00:37:29,490 --> 00:37:33,509
everything on the Java side we're going

852
00:37:31,590 --> 00:37:36,390
to just because we're greedy we're going

853
00:37:33,510 --> 00:37:39,480
to try to tackle the other a bob system

854
00:37:36,390 --> 00:37:42,480
on the DMC perfect so what we can do

855
00:37:39,480 --> 00:37:45,060
here first what you could do that is

856
00:37:42,480 --> 00:37:47,550
more suitable for a interactive attacker

857
00:37:45,060 --> 00:37:49,680
and not for a one is you go to the

858
00:37:47,550 --> 00:37:51,180
database you get the hashes you

859
00:37:49,680 --> 00:37:54,000
crack the hashes on you try to utilize

860
00:37:51,180 --> 00:37:57,270
those hashes that would take too much

861
00:37:54,000 --> 00:37:59,340
so what else we can do in Java the

862
00:37:57,270 --> 00:38:02,820
reason story mechanism that is called

863
00:37:59,340 --> 00:38:05,000
this ASAP secure storage this ap

864
00:38:02,820 --> 00:38:07,320
security storage is just like a

865
00:38:05,000 --> 00:38:09,660
encrypted file at the file system

866
00:38:07,320 --> 00:38:12,450
encrypted with Triple DES with a hard

867
00:38:09,660 --> 00:38:14,460
coded key that the her codec key was in

868
00:38:12,450 --> 00:38:17,310
the application itself than used to a

869
00:38:14,460 --> 00:38:20,970
minister the secure storage and a key

870
00:38:17,310 --> 00:38:25,170
phrase that the user specifies at the

871
00:38:20,970 --> 00:38:27,180
installation time what can we find on

872
00:38:25,170 --> 00:38:29,730
that secure storage well we can find the

873
00:38:27,180 --> 00:38:32,640
database password the full JDBC

874
00:38:29,730 --> 00:38:34,140
connection chain to the database meaning

875
00:38:32,640 --> 00:38:35,940
that we will have the schema the

876
00:38:34,140 --> 00:38:38,279
database user and the database password

877
00:38:35,940 --> 00:38:41,220
that is AP uses and depending on the

878
00:38:38,280 --> 00:38:44,160
version we are going to also find the s

879
00:38:41,220 --> 00:38:48,029
AP user the administrator user password

880
00:38:44,160 --> 00:38:50,819
as well most of the time and we're going

881
00:38:48,030 --> 00:38:53,040
to see later why this is happen the

882
00:38:50,820 --> 00:38:54,810
passwords are the same because there are

883
00:38:53,040 --> 00:38:58,590
master passwords we're going to see what

884
00:38:54,810 --> 00:39:00,690
that means very very shortly so if the

885
00:38:58,590 --> 00:39:03,750
container come in the cryptid which is

886
00:39:00,690 --> 00:39:10,380
extremely silly to do I have these

887
00:39:03,750 --> 00:39:15,060
utility since 2018 or 12 I think

888
00:39:10,380 --> 00:39:16,980
recently it has been made public so let

889
00:39:15,060 --> 00:39:18,420
me show you how you do it first I'm

890
00:39:16,980 --> 00:39:18,870
going to show you the container in

891
00:39:18,420 --> 00:39:21,180
itself

892
00:39:18,870 --> 00:39:22,589
the N malware as I have it coded what

893
00:39:21,180 --> 00:39:24,509
it's going to do is it's going to bring

894
00:39:22,590 --> 00:39:26,400
these files and it's going to do the

895
00:39:24,510 --> 00:39:28,530
decryption but for you to see as it's

896
00:39:26,400 --> 00:39:30,120
going to be too fast I'm just going to

897
00:39:28,530 --> 00:39:31,590
show you how it looks like there are two

898
00:39:30,120 --> 00:39:34,170
files that we're going to be working

899
00:39:31,590 --> 00:39:36,810
with the first one is the SEC stored the

900
00:39:34,170 --> 00:39:39,990
properties this is the file that will

901
00:39:36,810 --> 00:39:42,960
contain the encrypted information this

902
00:39:39,990 --> 00:39:45,479
is a plain text file great the other

903
00:39:42,960 --> 00:39:47,460
file is the key file remember that I

904
00:39:45,480 --> 00:39:49,320
told you that when you install the CP

905
00:39:47,460 --> 00:39:52,260
system you had to specify a key phrase

906
00:39:49,320 --> 00:39:55,140
or this is where the key phrase ends are

907
00:39:52,260 --> 00:40:00,660
being persisted this is not the plain

908
00:39:55,140 --> 00:40:03,299
text file if you know how to decrypt

909
00:40:00,660 --> 00:40:03,629
this if you don't know let me know I can

910
00:40:03,300 --> 00:40:07,350
give you

911
00:40:03,630 --> 00:40:10,230
can going to show you here this is going

912
00:40:07,350 --> 00:40:14,210
to be or secure storage opener and for

913
00:40:10,230 --> 00:40:19,890
that you will need a very powerful key

914
00:40:14,210 --> 00:40:25,200
on a very powerful super new algorithm

915
00:40:19,890 --> 00:40:27,210
cold sore you will need this key to

916
00:40:25,200 --> 00:40:27,990
decrypt the secret storage how we got

917
00:40:27,210 --> 00:40:29,790
this again

918
00:40:27,990 --> 00:40:32,700
it was hard-coded in the obligation that

919
00:40:29,790 --> 00:40:36,240
ACP uses to manage the security store

920
00:40:32,700 --> 00:40:40,350
once you have everything you just run

921
00:40:36,240 --> 00:40:44,339
the secure storage and automatically you

922
00:40:40,350 --> 00:40:47,130
get the entire JDBC connection chain as

923
00:40:44,340 --> 00:40:49,920
you can see with the username and the

924
00:40:47,130 --> 00:40:52,530
password for the SP database and you get

925
00:40:49,920 --> 00:40:55,230
also the administrator password so you

926
00:40:52,530 --> 00:40:58,380
get two very very powerful passwords

927
00:40:55,230 --> 00:41:00,900
here let's see what we can do once we

928
00:40:58,380 --> 00:41:02,940
fully compromised that Java system and

929
00:41:00,900 --> 00:41:06,380
we want to do with this we want to

930
00:41:02,940 --> 00:41:09,000
continue with this lateral movement

931
00:41:06,380 --> 00:41:10,440
first you need to protect the access to

932
00:41:09,000 --> 00:41:12,240
the security storage if you want to

933
00:41:10,440 --> 00:41:14,790
apply some good control measures only

934
00:41:12,240 --> 00:41:17,069
the sa demonstrated users and of course

935
00:41:14,790 --> 00:41:19,320
the local owners of that box who we have

936
00:41:17,070 --> 00:41:22,020
access to that what is more important

937
00:41:19,320 --> 00:41:24,870
and we're going to see next the password

938
00:41:22,020 --> 00:41:27,840
the password for the database user and

939
00:41:24,870 --> 00:41:30,920
the password for the SAV I mean

940
00:41:27,840 --> 00:41:34,530
straighter users had to be different you

941
00:41:30,920 --> 00:41:36,180
see on mine even my level set up that

942
00:41:34,530 --> 00:41:38,160
I'm very paranoid the passwords are

943
00:41:36,180 --> 00:41:40,140
different but in the vast majority of

944
00:41:38,160 --> 00:41:44,970
the scenarios on the corporate world are

945
00:41:40,140 --> 00:41:47,490
completely the same so we're here with a

946
00:41:44,970 --> 00:41:49,859
full control over the Java box

947
00:41:47,490 --> 00:41:52,589
let's try to attack a move from the DM C

948
00:41:49,860 --> 00:41:55,380
to the a bob system what we can do we're

949
00:41:52,590 --> 00:41:58,650
going to reutilize the credentials if

950
00:41:55,380 --> 00:42:01,110
you are creating a warm you you will try

951
00:41:58,650 --> 00:42:03,660
to make things as simple as possible

952
00:42:01,110 --> 00:42:06,720
because you want avoid complexity at all

953
00:42:03,660 --> 00:42:09,089
time if you create something complex the

954
00:42:06,720 --> 00:42:12,419
probabilities of that thing failing are

955
00:42:09,090 --> 00:42:15,180
way too high so what we're going to do

956
00:42:12,420 --> 00:42:17,400
we're just going to realize those master

957
00:42:15,180 --> 00:42:20,490
passwords or that master

958
00:42:17,400 --> 00:42:22,620
or does credentials to brute force or

959
00:42:20,490 --> 00:42:25,200
way through all the rest of the ESA

960
00:42:22,620 --> 00:42:27,420
resistance to see if that matches we

961
00:42:25,200 --> 00:42:31,020
could have done something a smarter and

962
00:42:27,420 --> 00:42:32,970
to show you but I had to meet that I

963
00:42:31,020 --> 00:42:35,370
chickened myself I thought I was very

964
00:42:32,970 --> 00:42:39,000
heavy to just release it and make it

965
00:42:35,370 --> 00:42:40,350
public but another way a part of the

966
00:42:39,000 --> 00:42:43,140
beauty lies in the past were a more

967
00:42:40,350 --> 00:42:46,500
smart way was what is called the cretan

968
00:42:43,140 --> 00:42:49,200
the JCL destinations what is that

969
00:42:46,500 --> 00:42:51,630
well the Java system as you can see

970
00:42:49,200 --> 00:42:54,149
needs to speak with the a bad system and

971
00:42:51,630 --> 00:42:56,970
the communication protocol TCP uses is

972
00:42:54,150 --> 00:43:00,390
called RF EC is totally proprietary so

973
00:42:56,970 --> 00:43:02,970
in CP need to put away need to create a

974
00:43:00,390 --> 00:43:05,370
wrapper to meet the Java system to speak

975
00:43:02,970 --> 00:43:08,399
RF EC with the a verb system for that

976
00:43:05,370 --> 00:43:11,640
they created a JC o streusel wrapper and

977
00:43:08,400 --> 00:43:14,720
they also created J's your destination

978
00:43:11,640 --> 00:43:18,120
basically at some point you had a

979
00:43:14,720 --> 00:43:21,089
connection hard-coded with username and

980
00:43:18,120 --> 00:43:24,000
password that grants you access to the

981
00:43:21,090 --> 00:43:26,670
above system on a smart attacker and a

982
00:43:24,000 --> 00:43:29,100
smarter one will choose the clip those

983
00:43:26,670 --> 00:43:31,230
jco destinations that try to guess what

984
00:43:29,100 --> 00:43:33,630
they are they are in the Java database

985
00:43:31,230 --> 00:43:37,440
and try to guess what encryption

986
00:43:33,630 --> 00:43:39,480
algorithm is using exactly the same as

987
00:43:37,440 --> 00:43:41,640
the encryption algorithm that is being

988
00:43:39,480 --> 00:43:43,830
used for the secure storage if you are a

989
00:43:41,640 --> 00:43:46,350
little small enough and if you are

990
00:43:43,830 --> 00:43:48,120
curious and now that you saw the key you

991
00:43:46,350 --> 00:43:51,180
can easily implement the decryption

992
00:43:48,120 --> 00:43:54,060
yourself but I thought it was way too

993
00:43:51,180 --> 00:43:56,970
heavy to show you here and another easy

994
00:43:54,060 --> 00:44:01,200
way to try to choose 2 lateral movement

995
00:43:56,970 --> 00:44:04,830
it will be through SSH SMB etc let me

996
00:44:01,200 --> 00:44:07,560
show you this would be quite silly what

997
00:44:04,830 --> 00:44:11,130
we're going to do for this example I

998
00:44:07,560 --> 00:44:14,640
change it basically it would be ask

999
00:44:11,130 --> 00:44:17,940
connecting through SSH and executing

1000
00:44:14,640 --> 00:44:20,759
scripts remotely no big deal I can

1001
00:44:17,940 --> 00:44:22,890
quickly show you what the payload is

1002
00:44:20,760 --> 00:44:25,020
going to be it could be something silly

1003
00:44:22,890 --> 00:44:27,029
here what the tacit rule is going to do

1004
00:44:25,020 --> 00:44:29,490
if this is Lara ransomware this will be

1005
00:44:27,030 --> 00:44:31,290
your encryption routine you could be

1006
00:44:29,490 --> 00:44:33,029
like sending a binary

1007
00:44:31,290 --> 00:44:36,200
walk in that binary to encrypt

1008
00:44:33,030 --> 00:44:40,430
everything file system or you can do any

1009
00:44:36,200 --> 00:44:40,430
infection technique that you might want

1010
00:44:45,170 --> 00:44:51,030
quickly we are executed commands not a

1011
00:44:48,360 --> 00:44:54,380
big deal what is going to happen that is

1012
00:44:51,030 --> 00:44:57,810
going to be very interesting is this

1013
00:44:54,380 --> 00:45:00,180
that we're going to use to tackle even

1014
00:44:57,810 --> 00:45:02,640
the actual insistence at the other side

1015
00:45:00,180 --> 00:45:05,460
what is this master password that I keep

1016
00:45:02,640 --> 00:45:07,770
mentioning about well by default when

1017
00:45:05,460 --> 00:45:09,930
you install an ACP system at the

1018
00:45:07,770 --> 00:45:12,600
installation time is a piece going to

1019
00:45:09,930 --> 00:45:16,049
ask you a do you want to set a password

1020
00:45:12,600 --> 00:45:19,049
for each individual and critical account

1021
00:45:16,050 --> 00:45:22,260
at the different layers operating system

1022
00:45:19,050 --> 00:45:24,300
ASAP layer database layers all you want

1023
00:45:22,260 --> 00:45:27,000
to use the constant of a master password

1024
00:45:24,300 --> 00:45:29,370
this what option is by default by

1025
00:45:27,000 --> 00:45:32,280
default the suggestion is to use the

1026
00:45:29,370 --> 00:45:34,319
master password if you choose to use the

1027
00:45:32,280 --> 00:45:35,940
master password all the most powerful

1028
00:45:34,320 --> 00:45:38,580
users would share the same password at

1029
00:45:35,940 --> 00:45:42,390
all the different layers the sub star

1030
00:45:38,580 --> 00:45:44,340
they dig the SAV database user the sa

1031
00:45:42,390 --> 00:45:47,339
POS I mean straight toward interactive

1032
00:45:44,340 --> 00:45:50,370
user the sa POS service user that will

1033
00:45:47,340 --> 00:45:52,950
all have the same share password and

1034
00:45:50,370 --> 00:45:56,520
guess what happens if you compromise one

1035
00:45:52,950 --> 00:45:59,189
password the malware will be able to

1036
00:45:56,520 --> 00:46:01,680
successfully compromise pretty much

1037
00:45:59,190 --> 00:46:03,510
everything else you will be able to do

1038
00:46:01,680 --> 00:46:06,890
the ransomware and three are the runs

1039
00:46:03,510 --> 00:46:09,810
somewhere there but that's not the end

1040
00:46:06,890 --> 00:46:13,710
we told you that we want to compromise

1041
00:46:09,810 --> 00:46:18,270
the HSN network right well first how we

1042
00:46:13,710 --> 00:46:20,220
fix this they will be on each one of the

1043
00:46:18,270 --> 00:46:23,130
ESP systems there are many many ways to

1044
00:46:20,220 --> 00:46:26,129
go to the HSN network we're going just

1045
00:46:23,130 --> 00:46:29,340
to see one that is the most flashy and a

1046
00:46:26,130 --> 00:46:31,260
new but there are many ways to do it one

1047
00:46:29,340 --> 00:46:33,990
way will be abusing what is called the

1048
00:46:31,260 --> 00:46:36,210
RF EC destinations on the arab system

1049
00:46:33,990 --> 00:46:38,490
it's a technique that we have showcased

1050
00:46:36,210 --> 00:46:42,540
in the past it's very common and highly

1051
00:46:38,490 --> 00:46:44,189
effective why because the destinations

1052
00:46:42,540 --> 00:46:45,329
will contain hard-coded users and

1053
00:46:44,190 --> 00:46:48,539
Hockley password

1054
00:46:45,329 --> 00:46:50,490
for the remote system most likely not

1055
00:46:48,539 --> 00:46:51,900
always you can get rid of that what you

1056
00:46:50,490 --> 00:46:54,720
need to do is to follow the less

1057
00:46:51,900 --> 00:46:57,299
privileged approach in terms of the

1058
00:46:54,720 --> 00:46:58,980
privileges of the user master password

1059
00:46:57,299 --> 00:47:00,509
you should never use the master before

1060
00:46:58,980 --> 00:47:04,230
you should assign a different password

1061
00:47:00,510 --> 00:47:06,900
each one of the ESP systems at at every

1062
00:47:04,230 --> 00:47:10,200
single layer of SAT and finally you need

1063
00:47:06,900 --> 00:47:12,930
to review your s AP sorry your firewall

1064
00:47:10,200 --> 00:47:17,460
strategy only make sure the decisions on

1065
00:47:12,930 --> 00:47:23,308
the DMC have a valid business reason to

1066
00:47:17,460 --> 00:47:26,549
jump directly to the assassin network so

1067
00:47:23,309 --> 00:47:28,529
we are here to finish we want to start

1068
00:47:26,549 --> 00:47:31,799
pushing or code we're going to try the

1069
00:47:28,529 --> 00:47:32,430
master password directly on the HSN

1070
00:47:31,799 --> 00:47:35,069
Network

1071
00:47:32,430 --> 00:47:37,379
but we want to attack the de clients the

1072
00:47:35,069 --> 00:47:39,420
end customer what is going to happen and

1073
00:47:37,380 --> 00:47:42,029
again just to make it more flashy I'm

1074
00:47:39,420 --> 00:47:45,230
going to attack the ICM the web

1075
00:47:42,029 --> 00:47:47,640
application server invoking and a

1076
00:47:45,230 --> 00:47:51,180
program invoking a web application

1077
00:47:47,640 --> 00:47:52,920
called soap our FEC through Soper FEC

1078
00:47:51,180 --> 00:47:55,589
you will be able to invoke remote

1079
00:47:52,920 --> 00:47:57,119
function calls most likely if you're

1080
00:47:55,589 --> 00:48:00,930
never I mean straight or is doing the

1081
00:47:57,119 --> 00:48:06,230
things right I will expect the port on

1082
00:48:00,930 --> 00:48:09,808
the internal network ICN to be filtered

1083
00:48:06,230 --> 00:48:12,809
normally what a serious warm will do is

1084
00:48:09,809 --> 00:48:16,799
to attack directly the RF EC port the

1085
00:48:12,809 --> 00:48:19,109
3200 or X X being the instance number

1086
00:48:16,799 --> 00:48:20,400
that port I guarantee will not be

1087
00:48:19,109 --> 00:48:22,348
filtered but again

1088
00:48:20,400 --> 00:48:24,029
I'm done grabbing the attacks a little

1089
00:48:22,349 --> 00:48:26,819
bit because I don't want you guys to

1090
00:48:24,029 --> 00:48:29,069
break stuff using my name

1091
00:48:26,819 --> 00:48:31,799
at least what we're going to do we're

1092
00:48:29,069 --> 00:48:35,099
going to send a soap request to the

1093
00:48:31,799 --> 00:48:36,809
ashes and to the ashes and network to

1094
00:48:35,099 --> 00:48:40,650
the SP systems on the assassin Network

1095
00:48:36,809 --> 00:48:44,099
and we are going to force a pop up to

1096
00:48:40,650 --> 00:48:46,020
the end customer basically basically

1097
00:48:44,099 --> 00:48:48,660
what the clients are going to see is

1098
00:48:46,020 --> 00:48:51,930
another message from the sub GUI

1099
00:48:48,660 --> 00:48:55,410
saying eh something went wrong so if you

1100
00:48:51,930 --> 00:48:57,450
want to update and avoid this error you

1101
00:48:55,410 --> 00:48:58,319
have to update your add-on otherwise you

1102
00:48:57,450 --> 00:49:01,169
will be harmed

1103
00:48:58,319 --> 00:49:02,579
or financial information here is the URL

1104
00:49:01,170 --> 00:49:04,259
from where you need to download the

1105
00:49:02,579 --> 00:49:07,140
patch and of course you will be

1106
00:49:04,259 --> 00:49:12,329
controlling that URL and distributing

1107
00:49:07,140 --> 00:49:17,160
your malware look at how the message

1108
00:49:12,329 --> 00:49:19,799
looks like this is the payload for you

1109
00:49:17,160 --> 00:49:22,969
to see you will have to figure out the

1110
00:49:19,799 --> 00:49:22,969
URL it's not that hard

1111
00:49:23,809 --> 00:49:35,130
don't tell me that it changed that be

1112
00:49:26,660 --> 00:49:38,279
demo gods well it says that a preventing

1113
00:49:35,130 --> 00:49:41,160
man is worth twice so I made a video

1114
00:49:38,279 --> 00:49:43,369
quick video so you see the pop-up sorry

1115
00:49:41,160 --> 00:49:43,368
about that

1116
00:49:48,469 --> 00:49:53,880
thus the payload does the URL that we

1117
00:49:51,420 --> 00:49:55,259
are attacking of course here what we're

1118
00:49:53,880 --> 00:49:56,910
going to do is reutilizing to

1119
00:49:55,259 --> 00:49:59,789
credentials and we're bashing all those

1120
00:49:56,910 --> 00:50:02,368
credentials everywhere and that is the

1121
00:49:59,789 --> 00:50:04,319
error message that the end customers

1122
00:50:02,369 --> 00:50:06,390
aren't going to use basically they're

1123
00:50:04,319 --> 00:50:08,099
gonna say hey something is wrong with

1124
00:50:06,390 --> 00:50:18,900
your system please don't let the new

1125
00:50:08,099 --> 00:50:20,789
patch from Ahmed Khan slash evil okay

1126
00:50:18,900 --> 00:50:25,109
wrapping up because we are running out

1127
00:50:20,789 --> 00:50:26,789
of time what you can do uh part of all

1128
00:50:25,109 --> 00:50:30,239
these countermeasures that we have seen

1129
00:50:26,789 --> 00:50:33,119
to avoid this type of risk first of all

1130
00:50:30,239 --> 00:50:36,509
before we start that in the technical

1131
00:50:33,119 --> 00:50:38,459
part as yourself do you really need to

1132
00:50:36,509 --> 00:50:41,279
expose your sa position directly to the

1133
00:50:38,459 --> 00:50:44,098
internet doesn't really need to be

1134
00:50:41,279 --> 00:50:46,259
directly exposed can't people choose VPN

1135
00:50:44,099 --> 00:50:48,299
in or can utilize some sort of Citrix

1136
00:50:46,259 --> 00:50:51,690
solutions in front of it so can I have

1137
00:50:48,299 --> 00:50:56,549
to implement a two-step authentication

1138
00:50:51,690 --> 00:50:58,380
to get the SAV system if you had to by

1139
00:50:56,549 --> 00:51:00,150
any means the next reason you have to

1140
00:50:58,380 --> 00:51:01,680
expose this directly to the Internet try

1141
00:51:00,150 --> 00:51:03,539
to put something that is called the way

1142
00:51:01,680 --> 00:51:06,299
dispatcher that is a free utility that

1143
00:51:03,539 --> 00:51:08,400
the city gives you or at this case as we

1144
00:51:06,299 --> 00:51:10,890
are dealing with web protocol strike

1145
00:51:08,400 --> 00:51:11,910
your web application firewall for

1146
00:51:10,890 --> 00:51:13,710
example

1147
00:51:11,910 --> 00:51:16,259
if you're going to expose the ESP system

1148
00:51:13,710 --> 00:51:18,119
directly to the Internet patch patch

1149
00:51:16,260 --> 00:51:20,490
patch patch is critical follow the

1150
00:51:18,119 --> 00:51:23,069
second Tuesday of each month SMP is

1151
00:51:20,490 --> 00:51:24,509
doing a good job on patching and

1152
00:51:23,069 --> 00:51:26,759
releasing patches for all the security

1153
00:51:24,510 --> 00:51:28,680
abilities and they even actually give

1154
00:51:26,760 --> 00:51:31,710
you the creativity of those patches so

1155
00:51:28,680 --> 00:51:33,690
follow that patch all the trails in Java

1156
00:51:31,710 --> 00:51:36,210
they come enabled by default but they do

1157
00:51:33,690 --> 00:51:40,470
not come an able in name up you have to

1158
00:51:36,210 --> 00:51:42,089
go there and enable them by hand they

1159
00:51:40,470 --> 00:51:45,959
would pay off in the future you have to

1160
00:51:42,089 --> 00:51:48,150
do it make sure and this is a very

1161
00:51:45,960 --> 00:51:50,640
controversial point not because they

1162
00:51:48,150 --> 00:51:52,619
suck guys do not want to be easy be

1163
00:51:50,640 --> 00:51:55,259
aware but make sure that your sub team

1164
00:51:52,619 --> 00:51:58,230
is easy be aware and prevent prevent

1165
00:51:55,260 --> 00:52:00,869
prevent okay thank you for your time

1166
00:51:58,230 --> 00:52:02,400
thank you for being here and if you have

1167
00:52:00,869 --> 00:52:17,309
questions and will be more than happy to

1168
00:52:02,400 --> 00:52:20,460
take them thank you okay so I'm here so

1169
00:52:17,309 --> 00:52:28,380
if anyone has any questions I can give

1170
00:52:20,460 --> 00:52:31,589
you the mic thank you I want to ask a

1171
00:52:28,380 --> 00:52:34,589
question about the slide before this

1172
00:52:31,589 --> 00:52:37,349
making this awkward about your SMP

1173
00:52:34,589 --> 00:52:39,569
system do you have any recommendation

1174
00:52:37,349 --> 00:52:44,039
about the logging policy that you need

1175
00:52:39,569 --> 00:52:45,900
to make in ASAP and where we can find

1176
00:52:44,039 --> 00:52:49,589
the anti wresting look especially for

1177
00:52:45,900 --> 00:52:52,020
the script related to the GUI because

1178
00:52:49,589 --> 00:52:53,700
I'm thinking about some attacks related

1179
00:52:52,020 --> 00:52:56,940
to the integrity of the information's

1180
00:52:53,700 --> 00:52:58,169
thank you okay just one one question

1181
00:52:56,940 --> 00:53:00,599
before you leave the mic when you say

1182
00:52:58,170 --> 00:53:02,279
like a login policy to what in

1183
00:53:00,599 --> 00:53:04,710
particular referring like a password

1184
00:53:02,279 --> 00:53:08,619
policy or something else no like for

1185
00:53:04,710 --> 00:53:11,269
example if you have system in

1186
00:53:08,619 --> 00:53:13,700
windows you have some logging policy

1187
00:53:11,269 --> 00:53:17,899
activate audit for failure success

1188
00:53:13,700 --> 00:53:20,049
something like that the in network

1189
00:53:17,900 --> 00:53:23,390
equipment you put it in warning level

1190
00:53:20,049 --> 00:53:26,390
debug level etcetera and each time you

1191
00:53:23,390 --> 00:53:28,940
don't have the same level of verbosity

1192
00:53:26,390 --> 00:53:30,650
of the reclamation I think I get you

1193
00:53:28,940 --> 00:53:33,140
know most of these attacks that we

1194
00:53:30,650 --> 00:53:35,749
haven't seen so far the note that the

1195
00:53:33,140 --> 00:53:37,670
operating system layer they're more at

1196
00:53:35,749 --> 00:53:38,238
the application layer of the SOP

1197
00:53:37,670 --> 00:53:40,880
NetWeaver

1198
00:53:38,239 --> 00:53:44,930
so for for the OS point of view you will

1199
00:53:40,880 --> 00:53:49,160
not and you will not get a any impact or

1200
00:53:44,930 --> 00:53:51,410
like any connection doors it may be if

1201
00:53:49,160 --> 00:53:53,118
that person as the silly example that I

1202
00:53:51,410 --> 00:53:56,509
was showing before is little icing like

1203
00:53:53,119 --> 00:53:58,999
SSH or SME what yes they do s and the

1204
00:53:56,509 --> 00:54:01,369
regular OS security hygiene will take

1205
00:53:58,999 --> 00:54:03,019
place but in general someone is smart

1206
00:54:01,369 --> 00:54:05,839
and someone that wants to do the true

1207
00:54:03,019 --> 00:54:08,209
warm would not would try to avoid as

1208
00:54:05,839 --> 00:54:10,069
much as possible touching the operating

1209
00:54:08,209 --> 00:54:12,558
system it will always be collaboration s

1210
00:54:10,069 --> 00:54:16,249
IP and what you can do with the scripts

1211
00:54:12,559 --> 00:54:17,930
the there is a secure guide is not the

1212
00:54:16,249 --> 00:54:20,930
most complete guy in the universe but

1213
00:54:17,930 --> 00:54:23,868
there is like an SMP security guide for

1214
00:54:20,930 --> 00:54:25,819
netweaver Ava you you've googled that

1215
00:54:23,869 --> 00:54:27,589
little search string and you will get

1216
00:54:25,819 --> 00:54:30,319
like a PDF with some recommendations

1217
00:54:27,589 --> 00:54:32,509
again it's not the most complete at all

1218
00:54:30,319 --> 00:54:34,609
well at least it will give you like the

1219
00:54:32,509 --> 00:54:36,469
first step so you can get started and

1220
00:54:34,609 --> 00:54:38,359
get to know more about the s IP

1221
00:54:36,469 --> 00:54:41,959
configurations I think they do cover

1222
00:54:38,359 --> 00:54:45,308
this up GUI script part okay but at the

1223
00:54:41,959 --> 00:54:48,649
application level you don't have some

1224
00:54:45,309 --> 00:54:51,049
parameter to tune about the logging at

1225
00:54:48,650 --> 00:54:53,420
the SP level it is a believer oh yes yes

1226
00:54:51,049 --> 00:54:55,249
yes depending on the on the stuff that

1227
00:54:53,420 --> 00:54:57,049
you are for example if you're an Ava the

1228
00:54:55,249 --> 00:54:59,629
most important one will be what is

1229
00:54:57,049 --> 00:55:02,359
called the security audit log this is

1230
00:54:59,630 --> 00:55:04,609
the exact name that the CP gives you by

1231
00:55:02,359 --> 00:55:06,799
the fall you had to enable them and you

1232
00:55:04,609 --> 00:55:09,410
have to restore the ASAP system to

1233
00:55:06,799 --> 00:55:11,059
actually start to get it enable when you

1234
00:55:09,410 --> 00:55:14,058
do your research make sure that you go

1235
00:55:11,059 --> 00:55:16,160
for what is called the static parameter

1236
00:55:14,059 --> 00:55:19,279
because you have to dynamic and static

1237
00:55:16,160 --> 00:55:21,739
and after you do that and here is the

1238
00:55:19,279 --> 00:55:24,109
complexity of s AP that's security of

1239
00:55:21,739 --> 00:55:25,729
Israel but by no means is not perfect

1240
00:55:24,109 --> 00:55:27,799
you come by passed it there is like a

1241
00:55:25,729 --> 00:55:29,598
thousand things for that but a something

1242
00:55:27,799 --> 00:55:31,699
is better than nothing a part of the

1243
00:55:29,599 --> 00:55:33,829
security log the the thing with s AP is

1244
00:55:31,699 --> 00:55:35,630
that it implements a lot of different

1245
00:55:33,829 --> 00:55:38,569
services right in the different

1246
00:55:35,630 --> 00:55:41,269
protocols and different ports most of

1247
00:55:38,569 --> 00:55:43,279
those services they also have their own

1248
00:55:41,269 --> 00:55:45,410
audit trail that they do not come by

1249
00:55:43,279 --> 00:55:47,690
default if you want some that you want

1250
00:55:45,410 --> 00:55:49,368
to take note the Gateway log definitely

1251
00:55:47,690 --> 00:55:54,410
you want that the message server log

1252
00:55:49,369 --> 00:56:01,969
definitely you want that as well you're

1253
00:55:54,410 --> 00:56:11,690
welcome anyone else we still have five

1254
00:56:01,969 --> 00:56:13,640
minutes so okay okay Thank You Rhonda

1255
00:56:11,690 --> 00:56:17,820
and then we will guys

1256
00:56:13,640 --> 00:56:17,819
[Applause]

