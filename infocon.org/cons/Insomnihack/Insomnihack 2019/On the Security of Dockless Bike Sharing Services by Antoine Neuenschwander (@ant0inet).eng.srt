1
00:00:07,250 --> 00:00:10,619
[Music]

2
00:00:12,580 --> 00:00:19,820
so hi everyone and thanks very much I'm

3
00:00:17,450 --> 00:00:21,830
filling in for all of us who had to

4
00:00:19,820 --> 00:00:24,730
cancel his talk so I'm not going to be

5
00:00:21,830 --> 00:00:27,828
talking about open-source ransomware

6
00:00:24,730 --> 00:00:28,939
instead about a little side project of

7
00:00:27,829 --> 00:00:33,740
mine

8
00:00:28,939 --> 00:00:35,540
hacking bike sharing services so a

9
00:00:33,740 --> 00:00:43,840
little a couple of words about myself

10
00:00:35,540 --> 00:00:47,480
I'm working in info sex since like 2008

11
00:00:43,840 --> 00:00:51,199
I've worked as a penetration test in the

12
00:00:47,480 --> 00:00:53,629
past and from that time on I started

13
00:00:51,199 --> 00:00:56,690
looking differently at software it's

14
00:00:53,629 --> 00:01:00,079
very interesting too

15
00:00:56,690 --> 00:01:02,629
a new way to play with software and in

16
00:01:00,079 --> 00:01:10,130
my part time I also have a lot of pets

17
00:01:02,629 --> 00:01:14,090
like 40,000 bees and I'm also a lot of

18
00:01:10,130 --> 00:01:18,289
of my time on Twitter so the motivation

19
00:01:14,090 --> 00:01:24,799
to look at those bike-sharing services

20
00:01:18,290 --> 00:01:28,939
is on one hand I when I was working as a

21
00:01:24,799 --> 00:01:32,600
penetration tester I had a look at a lot

22
00:01:28,939 --> 00:01:35,689
of different technologies but often the

23
00:01:32,600 --> 00:01:38,869
the projects were focused on web

24
00:01:35,689 --> 00:01:43,460
applications or on maybe some native

25
00:01:38,869 --> 00:01:47,810
applications but I never had the chance

26
00:01:43,460 --> 00:01:49,789
to look at mobile applications closer so

27
00:01:47,810 --> 00:01:51,680
this is something I had on my bucket

28
00:01:49,790 --> 00:01:56,060
list I wanted to do so I need some

29
00:01:51,680 --> 00:02:03,340
example of something to have a look at

30
00:01:56,060 --> 00:02:06,920
and two years ago when you looked at the

31
00:02:03,340 --> 00:02:10,729
streets there were more and more yellow

32
00:02:06,920 --> 00:02:14,780
bikes or green bikes or black bags that

33
00:02:10,729 --> 00:02:19,310
would come up and it was the beginning

34
00:02:14,780 --> 00:02:20,599
of those companies who would like mostly

35
00:02:19,310 --> 00:02:23,599
startups

36
00:02:20,599 --> 00:02:26,689
who would start deploy their bike so I

37
00:02:23,599 --> 00:02:28,760
got queer curious and and downloaded an

38
00:02:26,689 --> 00:02:32,749
app and wanted to analyze it but in the

39
00:02:28,760 --> 00:02:34,730
end I did the mobile part in the

40
00:02:32,749 --> 00:02:36,888
analysis of the mobile application was

41
00:02:34,730 --> 00:02:39,230
only the smallest part actually of the

42
00:02:36,889 --> 00:02:41,750
whole thing because it involved not only

43
00:02:39,230 --> 00:02:46,219
so the mobile part which is not so

44
00:02:41,750 --> 00:02:48,889
extensive but also the server-side

45
00:02:46,219 --> 00:02:52,189
parts which are mostly rest applications

46
00:02:48,889 --> 00:02:58,340
then the hardware on the bikes like this

47
00:02:52,189 --> 00:03:01,418
one which is a bike lock and yeah and

48
00:02:58,340 --> 00:03:03,980
also psychology of when you disclose

49
00:03:01,419 --> 00:03:07,959
vulnerabilities to the parties in the

50
00:03:03,980 --> 00:03:13,129
whole process of communicating with them

51
00:03:07,959 --> 00:03:17,689
so how does it look like in in Zurich in

52
00:03:13,129 --> 00:03:21,649
my home time at hometown we have I think

53
00:03:17,689 --> 00:03:24,918
now there is also more services deployed

54
00:03:21,650 --> 00:03:28,639
than these for it all started with smile

55
00:03:24,919 --> 00:03:34,370
in fall of 2016 it's a Swiss company

56
00:03:28,639 --> 00:03:36,319
then in summer of 2017 o bike came along

57
00:03:34,370 --> 00:03:38,930
and then we had an American company

58
00:03:36,319 --> 00:03:40,970
called line bike which I haven't looked

59
00:03:38,930 --> 00:03:44,329
at so it's the only one I will not be

60
00:03:40,970 --> 00:03:48,019
talking about in this talk and then in

61
00:03:44,329 --> 00:03:50,329
May 2000 18 P bleep I could reason or

62
00:03:48,019 --> 00:03:55,009
another Swiss company started also

63
00:03:50,329 --> 00:03:57,590
deploying their bikes there's a little

64
00:03:55,009 --> 00:04:01,578
difference with PP bike because their

65
00:03:57,590 --> 00:04:04,099
model is you can't just pick a bike on

66
00:04:01,579 --> 00:04:05,870
the street and ride it and put it

67
00:04:04,099 --> 00:04:08,569
anywhere you want you need to bring it

68
00:04:05,870 --> 00:04:10,340
back to the station to end your ride but

69
00:04:08,569 --> 00:04:15,849
apart from that there are a lot of

70
00:04:10,340 --> 00:04:20,329
similarities to the other services so

71
00:04:15,849 --> 00:04:23,180
how do these services work from the user

72
00:04:20,329 --> 00:04:25,460
point of view you need a smartphone

73
00:04:23,180 --> 00:04:28,330
without a smartphone it won't work maybe

74
00:04:25,460 --> 00:04:31,460
if maybe for public bike there you can

75
00:04:28,330 --> 00:04:33,800
go with the Swiss pass which is actually

76
00:04:31,460 --> 00:04:37,130
the

77
00:04:33,800 --> 00:04:40,220
public transportation card so you can

78
00:04:37,130 --> 00:04:42,680
just badge in with your Swiss pass but

79
00:04:40,220 --> 00:04:44,780
apart from public I think every other

80
00:04:42,680 --> 00:04:47,750
service require you to use your

81
00:04:44,780 --> 00:04:49,460
smartphone to use them so you need to

82
00:04:47,750 --> 00:04:52,130
install the corresponding mobile app on

83
00:04:49,460 --> 00:04:54,580
your smart phone you sign up you need to

84
00:04:52,130 --> 00:04:57,980
load some credits with your credit cards

85
00:04:54,580 --> 00:05:02,690
for some services you also need to cash

86
00:04:57,980 --> 00:05:06,820
deposit like for a bike I needed to pay

87
00:05:02,690 --> 00:05:09,800
in 130 francs that was at the beginning

88
00:05:06,820 --> 00:05:13,040
which we can think is roughly the price

89
00:05:09,800 --> 00:05:17,540
a bike would cost if you wouldn't bring

90
00:05:13,040 --> 00:05:20,150
it back and just to let you know I never

91
00:05:17,540 --> 00:05:22,220
got those 130 Frank's Bank from all

92
00:05:20,150 --> 00:05:27,489
bikes so if you're listening I'm still

93
00:05:22,220 --> 00:05:33,010
waiting so once you you you loaded your

94
00:05:27,490 --> 00:05:39,100
account with money you can get go on and

95
00:05:33,010 --> 00:05:41,630
the main screen on those apps are mainly

96
00:05:39,100 --> 00:05:45,110
map and interactive map like a Google

97
00:05:41,630 --> 00:05:48,880
Maps view where you can locate the bikes

98
00:05:45,110 --> 00:05:53,480
where they are in your neighborhood and

99
00:05:48,880 --> 00:05:56,960
once you walked to the bike you can

100
00:05:53,480 --> 00:06:01,780
start the LEAs you can start riding it

101
00:05:56,960 --> 00:06:04,969
and during the ride your you will be

102
00:06:01,780 --> 00:06:09,289
that the costs will be running and when

103
00:06:04,970 --> 00:06:13,100
you're done with a ride you just log out

104
00:06:09,290 --> 00:06:17,180
and close the bike and then the costs

105
00:06:13,100 --> 00:06:21,680
stop so this is basicly how how to use

106
00:06:17,180 --> 00:06:25,550
such a bet bike sharing app so if we

107
00:06:21,680 --> 00:06:28,550
look at what could go wrong with with

108
00:06:25,550 --> 00:06:33,050
those bike amps first of all there are

109
00:06:28,550 --> 00:06:35,480
operational issues if you take the

110
00:06:33,050 --> 00:06:39,320
perspective from the operator of a bike

111
00:06:35,480 --> 00:06:43,480
sharing app you want to generate revenue

112
00:06:39,320 --> 00:06:46,270
so you want to in the first place

113
00:06:43,480 --> 00:06:49,420
avoid that people can bypass your

114
00:06:46,270 --> 00:06:53,380
payment otherwise well that they can get

115
00:06:49,420 --> 00:06:55,630
rights for free on the other hand you

116
00:06:53,380 --> 00:06:59,020
also are concerned with availability

117
00:06:55,630 --> 00:07:02,500
because if no one if even if the people

118
00:06:59,020 --> 00:07:06,460
are willing to pay if the people are not

119
00:07:02,500 --> 00:07:08,950
technically not able to use your service

120
00:07:06,460 --> 00:07:12,810
then you're also not going to fulfill

121
00:07:08,950 --> 00:07:16,870
your your financial requirements then

122
00:07:12,810 --> 00:07:22,000
something else is you have also data

123
00:07:16,870 --> 00:07:24,820
protection issues you don't wish that

124
00:07:22,000 --> 00:07:28,690
somebody is able to see all the personal

125
00:07:24,820 --> 00:07:32,500
data of your customers so you need to

126
00:07:28,690 --> 00:07:35,140
make sure to protect that as well then

127
00:07:32,500 --> 00:07:38,170
there's also safety and liability issues

128
00:07:35,140 --> 00:07:41,200
because people are going to use your

129
00:07:38,170 --> 00:07:46,870
bikes you need to make sure that they

130
00:07:41,200 --> 00:07:50,800
are in a good state so that people won't

131
00:07:46,870 --> 00:07:55,860
crash and maybe get injured or killed so

132
00:07:50,800 --> 00:07:57,910
it's I don't know I haven't read

133
00:07:55,860 --> 00:08:00,610
systematically read all the terms and

134
00:07:57,910 --> 00:08:03,460
conditions I guess the people would try

135
00:08:00,610 --> 00:08:05,350
to the operators would try to pull the

136
00:08:03,460 --> 00:08:07,390
responsibility on the user side and tell

137
00:08:05,350 --> 00:08:10,180
you need to make sure that the brakes

138
00:08:07,390 --> 00:08:15,280
are working in everything that we'll see

139
00:08:10,180 --> 00:08:18,120
in one case that the users can't be held

140
00:08:15,280 --> 00:08:22,179
for responsible for every single thing

141
00:08:18,120 --> 00:08:25,360
then in the end you also have a business

142
00:08:22,180 --> 00:08:27,940
impact due to the financial loss that we

143
00:08:25,360 --> 00:08:29,680
talked about just before but also you

144
00:08:27,940 --> 00:08:31,330
could have some repair a reputational

145
00:08:29,680 --> 00:08:33,909
damage like for instance if you don't

146
00:08:31,330 --> 00:08:39,728
pay back the deposit at the deposit of

147
00:08:33,909 --> 00:08:43,240
your customers okay so let's have a look

148
00:08:39,729 --> 00:08:46,300
at the first bike sharing service it's

149
00:08:43,240 --> 00:08:49,450
called smite based in Zurich so as I

150
00:08:46,300 --> 00:08:51,219
said they started in fall 2016 initially

151
00:08:49,450 --> 00:08:54,100
they were backed by an insurance company

152
00:08:51,220 --> 00:08:56,829
and I read an interesting article about

153
00:08:54,100 --> 00:09:00,189
why this insurance company

154
00:08:56,829 --> 00:09:05,670
wanted to start that service there were

155
00:09:00,189 --> 00:09:11,920
interested in the future of mobility and

156
00:09:05,670 --> 00:09:15,699
when like using cars car sharing schemes

157
00:09:11,920 --> 00:09:19,089
and how it would look like for the

158
00:09:15,699 --> 00:09:22,628
insurance because obviously if you want

159
00:09:19,089 --> 00:09:26,079
to rent a car like that doesn't belong

160
00:09:22,629 --> 00:09:28,329
to you then you need to think about how

161
00:09:26,079 --> 00:09:30,368
are you going to invent the new

162
00:09:28,329 --> 00:09:35,170
insurance schemes of the future so it

163
00:09:30,369 --> 00:09:37,589
was kind of like a testbed to see how to

164
00:09:35,170 --> 00:09:42,549
analyze the behavior of people when they

165
00:09:37,589 --> 00:09:47,619
when they have such digital mobility

166
00:09:42,549 --> 00:09:51,629
with with such services in the meantime

167
00:09:47,619 --> 00:09:54,339
the the company smart is independent and

168
00:09:51,629 --> 00:09:57,639
I think they are good doing quite well

169
00:09:54,339 --> 00:10:02,259
if you look at the hardware so that's

170
00:09:57,639 --> 00:10:05,290
this bike it's produced by another Swiss

171
00:10:02,259 --> 00:10:07,929
company called stroma and there are a

172
00:10:05,290 --> 00:10:10,719
high pretty high quality bikes with a

173
00:10:07,929 --> 00:10:13,179
high price so in the upper segment they

174
00:10:10,720 --> 00:10:19,149
are like six and a half thousand francs

175
00:10:13,179 --> 00:10:21,129
per unit and you it's comparable to a

176
00:10:19,149 --> 00:10:24,999
little motorcycle because there are very

177
00:10:21,129 --> 00:10:27,610
powerful motors in them they have about

178
00:10:24,999 --> 00:10:30,790
400 bikes I guess this number is pretty

179
00:10:27,610 --> 00:10:33,189
much higher now because this was I think

180
00:10:30,790 --> 00:10:37,389
two years ago that I looked at all the

181
00:10:33,189 --> 00:10:39,429
bikes via the API and how do they manage

182
00:10:37,389 --> 00:10:42,540
the fleet they have actually that the

183
00:10:39,429 --> 00:10:45,970
bikes are totally autonomous they have

184
00:10:42,540 --> 00:10:48,748
mobile connectivity and they have a GPS

185
00:10:45,970 --> 00:10:51,549
inside so the bike itself can

186
00:10:48,749 --> 00:10:55,179
communicate its location this will also

187
00:10:51,549 --> 00:10:58,480
help for theft protection there's one

188
00:10:55,179 --> 00:11:01,449
thing in the operating needs to think of

189
00:10:58,480 --> 00:11:04,749
or needs to implement is that these

190
00:11:01,449 --> 00:11:09,140
bikes have a battery it gets well when

191
00:11:04,749 --> 00:11:11,990
you use it gets low so you need

192
00:11:09,140 --> 00:11:14,390
team of people will do maintenance of

193
00:11:11,990 --> 00:11:17,570
those bikes so you need to go to the

194
00:11:14,390 --> 00:11:19,760
bikes you located via smartphone you go

195
00:11:17,570 --> 00:11:21,920
to the bikes exchange batteries you need

196
00:11:19,760 --> 00:11:24,319
to look for enough air pressure in the

197
00:11:21,920 --> 00:11:27,469
tires and everything else that could go

198
00:11:24,320 --> 00:11:32,450
mechanically wrong so this is kind of

199
00:11:27,470 --> 00:11:34,010
like the price you need to pay for - to

200
00:11:32,450 --> 00:11:38,750
maintain this fleet of high quality

201
00:11:34,010 --> 00:11:42,319
bikes so how's the overall architecture

202
00:11:38,750 --> 00:11:44,870
for the operation of such a fleet so as

203
00:11:42,320 --> 00:11:47,089
I already said the the bike are

204
00:11:44,870 --> 00:11:50,860
autonomous they have they can

205
00:11:47,089 --> 00:11:53,329
communicate by themselves they can have

206
00:11:50,860 --> 00:11:55,190
they can figure out where they are and

207
00:11:53,329 --> 00:11:59,269
they will communicate their location to

208
00:11:55,190 --> 00:12:03,019
the backend via mobile network on the

209
00:11:59,269 --> 00:12:05,209
other hand the users also have a

210
00:12:03,019 --> 00:12:08,089
connection to the mobile network and to

211
00:12:05,209 --> 00:12:11,149
the smile back-end and so they can meet

212
00:12:08,089 --> 00:12:14,510
and and do the bookings and so on so let

213
00:12:11,149 --> 00:12:16,640
me give you an example of how the

214
00:12:14,510 --> 00:12:19,329
back-end communication looks like so

215
00:12:16,640 --> 00:12:22,100
this was a this is a product of the

216
00:12:19,329 --> 00:12:25,250
analysis done on the mobile application

217
00:12:22,100 --> 00:12:28,339
as you see it's a totally standard REST

218
00:12:25,250 --> 00:12:31,279
API so we have a get request where we

219
00:12:28,339 --> 00:12:34,100
can in this case download the locations

220
00:12:31,279 --> 00:12:42,740
of the bikes and what we get as a result

221
00:12:34,100 --> 00:12:46,130
is an array of records each with a bike

222
00:12:42,740 --> 00:12:50,000
ID in this case 46 then you have in the

223
00:12:46,130 --> 00:12:52,250
name it's just the license plates so zet

224
00:12:50,000 --> 00:12:54,740
a chips for Zurich you have a battery

225
00:12:52,250 --> 00:12:56,690
level you have a battery range I guess

226
00:12:54,740 --> 00:12:58,459
in kilometers you have the size of the

227
00:12:56,690 --> 00:13:01,070
bikes because they have two sizes so I

228
00:12:58,459 --> 00:13:05,569
guess it's in inches and you have

229
00:13:01,070 --> 00:13:10,699
geo localized address as well as the

230
00:13:05,570 --> 00:13:13,550
latitude and longitude okay so what if

231
00:13:10,699 --> 00:13:16,969
somebody was like okay it's a nice bike

232
00:13:13,550 --> 00:13:21,560
I want to take it away and try to to to

233
00:13:16,970 --> 00:13:26,450
break it open the bike have like kind of

234
00:13:21,560 --> 00:13:30,410
a geofence that the first of all you're

235
00:13:26,450 --> 00:13:32,570
not allowed to leave the bike or take

236
00:13:30,410 --> 00:13:35,240
the back outside of the geofence and

237
00:13:32,570 --> 00:13:37,010
other on the other hand if the back is

238
00:13:35,240 --> 00:13:39,080
locked and you move it only from a

239
00:13:37,010 --> 00:13:41,960
couple of meters and the bike has a

240
00:13:39,080 --> 00:13:44,720
logic that will say okay now I'm being

241
00:13:41,960 --> 00:13:49,279
taken away and it will trigger an alert

242
00:13:44,720 --> 00:13:51,920
an alarm what it does you don't have any

243
00:13:49,279 --> 00:13:54,140
any luck you need to close yourself on

244
00:13:51,920 --> 00:13:58,490
those bikes it has an electro electronic

245
00:13:54,140 --> 00:14:01,640
lock on the rear wheel so actually if

246
00:13:58,490 --> 00:14:04,130
you want to write the bike that the and

247
00:14:01,640 --> 00:14:09,819
you didn't unlock it the the the rear

248
00:14:04,130 --> 00:14:13,279
wheel would just be blocked this will be

249
00:14:09,820 --> 00:14:18,170
important for later on so let us look at

250
00:14:13,279 --> 00:14:21,710
the booking process at first you need to

251
00:14:18,170 --> 00:14:25,939
locate a vacant bike which is of course

252
00:14:21,710 --> 00:14:27,740
locked then in the first step what

253
00:14:25,940 --> 00:14:31,670
you're going to do is you're going to

254
00:14:27,740 --> 00:14:34,280
unlock the you're going to start a

255
00:14:31,670 --> 00:14:37,550
booking but the the back is still locked

256
00:14:34,280 --> 00:14:39,800
and then you are going to unlock the

257
00:14:37,550 --> 00:14:42,319
bike you can only lock or unlock the

258
00:14:39,800 --> 00:14:45,680
bike if you have an active booking so

259
00:14:42,320 --> 00:14:48,350
let us look at first we need to talk

260
00:14:45,680 --> 00:14:54,500
about the the authentication scheme so

261
00:14:48,350 --> 00:14:56,930
the the first request and this is on the

262
00:14:54,500 --> 00:14:59,030
login end point you just provide your

263
00:14:56,930 --> 00:15:04,489
username which is an email address and

264
00:14:59,030 --> 00:15:07,250
your password and what you will get in

265
00:15:04,490 --> 00:15:11,360
return is your user ID a technical user

266
00:15:07,250 --> 00:15:15,770
ID with a JWT structure which is

267
00:15:11,360 --> 00:15:19,400
actually a JSON web token and since the

268
00:15:15,770 --> 00:15:22,160
JSON web token is a bit long I made a

269
00:15:19,400 --> 00:15:25,250
known slide for it and JSON web token is

270
00:15:22,160 --> 00:15:28,459
a structure which contains three parts

271
00:15:25,250 --> 00:15:30,860
the red green and the orange part which

272
00:15:28,459 --> 00:15:33,250
are all basic C 4 encoded so if you

273
00:15:30,860 --> 00:15:36,370
decode that you're gonna get ahead

274
00:15:33,250 --> 00:15:42,220
in red where you get the hashing

275
00:15:36,370 --> 00:15:47,439
algorithm and actually it's a it's a CH

276
00:15:42,220 --> 00:15:51,430
Mac algorithm and the green part is the

277
00:15:47,439 --> 00:15:55,719
body where you have all the user related

278
00:15:51,430 --> 00:15:58,000
data for the authentication so you have

279
00:15:55,720 --> 00:16:01,350
the UID which is a technical user ID you

280
00:15:58,000 --> 00:16:06,189
have some timestamps and how long the

281
00:16:01,350 --> 00:16:09,430
the ticket is valid and the orange part

282
00:16:06,189 --> 00:16:13,120
is a signature of a digital signature of

283
00:16:09,430 --> 00:16:16,329
this ticket and if you want it's it's

284
00:16:13,120 --> 00:16:18,129
like Oh out uses it or also similar to

285
00:16:16,329 --> 00:16:20,920
sam'l where you actually for the

286
00:16:18,129 --> 00:16:24,300
authentication you go to one party to an

287
00:16:20,920 --> 00:16:27,878
identity provider and it will guarantee

288
00:16:24,300 --> 00:16:29,829
that the bearer of this token is is

289
00:16:27,879 --> 00:16:32,829
really the one who should be accessing

290
00:16:29,829 --> 00:16:37,329
so it's just a session ticket if you

291
00:16:32,829 --> 00:16:42,219
want to make it really simple okay so

292
00:16:37,329 --> 00:16:46,359
let's see how we go from a free bike to

293
00:16:42,220 --> 00:16:49,930
a booked bike you need to first have an

294
00:16:46,360 --> 00:16:53,350
authenticated session and you post on

295
00:16:49,930 --> 00:16:56,609
the booking rest and end point so in the

296
00:16:53,350 --> 00:16:59,589
header you provide the JWT token and

297
00:16:56,610 --> 00:17:03,279
what you say is you want to start

298
00:16:59,589 --> 00:17:08,199
booking the bike with ID 133 and this is

299
00:17:03,279 --> 00:17:10,929
my user ID the server will respond with

300
00:17:08,199 --> 00:17:13,360
a new red structure and will tell you

301
00:17:10,929 --> 00:17:18,069
okay the booking ID is 1 2 3 4 5 and

302
00:17:13,359 --> 00:17:21,549
you're currently not using the bike so

303
00:17:18,069 --> 00:17:23,470
the usage key means are you using the

304
00:17:21,549 --> 00:17:25,270
bike or not if it's false the bike is

305
00:17:23,470 --> 00:17:27,459
locked and if it's true the bike is

306
00:17:25,270 --> 00:17:30,970
unlocked you also have a pin that will

307
00:17:27,459 --> 00:17:35,250
see afterwards and timestamp ok so now

308
00:17:30,970 --> 00:17:39,010
we're in the booked state but the bike

309
00:17:35,250 --> 00:17:40,820
yeah and the bike is unlocked and now we

310
00:17:39,010 --> 00:17:46,820
want to see what happens

311
00:17:40,820 --> 00:17:50,330
when we lock the the bike so we refer to

312
00:17:46,820 --> 00:17:53,780
the booking number or ID we use this one

313
00:17:50,330 --> 00:17:56,899
two three four five and we're going to

314
00:17:53,780 --> 00:17:59,510
post or make a put request on the

315
00:17:56,900 --> 00:18:04,430
booking endpoint and say that we are

316
00:17:59,510 --> 00:18:07,250
done using the back end and why do we

317
00:18:04,430 --> 00:18:09,950
have this this differentiation between a

318
00:18:07,250 --> 00:18:13,250
booking and the locked state is because

319
00:18:09,950 --> 00:18:15,350
I guess the use case is you picked up a

320
00:18:13,250 --> 00:18:17,960
bike somewhere you maybe you needed to

321
00:18:15,350 --> 00:18:19,610
walk a kilometer to get a bike you got

322
00:18:17,960 --> 00:18:22,010
the bike and now you're riding in

323
00:18:19,610 --> 00:18:23,899
somewhere maybe to do your groceries and

324
00:18:22,010 --> 00:18:26,030
you want to leave the bike outside of

325
00:18:23,900 --> 00:18:28,130
the grocery store but you want to keep

326
00:18:26,030 --> 00:18:32,930
the booking running because you don't

327
00:18:28,130 --> 00:18:36,110
want to have somebody else take the bike

328
00:18:32,930 --> 00:18:39,680
away so the the state is still booked

329
00:18:36,110 --> 00:18:42,189
but the bike is locked so this is what

330
00:18:39,680 --> 00:18:45,830
we're doing now we are locking the bike

331
00:18:42,190 --> 00:18:48,860
when you lock the bike the end point

332
00:18:45,830 --> 00:18:50,960
will return a pin this for my four nine

333
00:18:48,860 --> 00:18:54,260
and six three seven which you can use

334
00:18:50,960 --> 00:18:55,780
actually on the bike to unlock if if you

335
00:18:54,260 --> 00:19:00,940
want but you could also do it via

336
00:18:55,780 --> 00:19:00,940
smartphone okay now that the problem is

337
00:19:01,090 --> 00:19:06,370
there's a vulnerability in the scheme

338
00:19:03,590 --> 00:19:10,850
where actually the booking numbers are

339
00:19:06,370 --> 00:19:14,780
sequential so the next customer who

340
00:19:10,850 --> 00:19:17,840
would book a bike would get the number

341
00:19:14,780 --> 00:19:19,310
one two three four six and you could

342
00:19:17,840 --> 00:19:22,159
have a look at all the bookings in the

343
00:19:19,310 --> 00:19:24,909
past by just decreasing this number so

344
00:19:22,160 --> 00:19:28,190
the problem is there's a problem of

345
00:19:24,910 --> 00:19:30,800
authorization because if I do the same

346
00:19:28,190 --> 00:19:34,220
request but now you see in the

347
00:19:30,800 --> 00:19:39,260
authorization header I'm using job JWT

348
00:19:34,220 --> 00:19:44,300
of some other user which I don't know

349
00:19:39,260 --> 00:19:46,160
and I lock the bike as well I get a

350
00:19:44,300 --> 00:19:48,950
positive response this means I just

351
00:19:46,160 --> 00:19:52,360
locked somebody else's bike while he was

352
00:19:48,950 --> 00:19:54,060
riding and I don't know him it's just so

353
00:19:52,360 --> 00:20:00,240
that's kind of

354
00:19:54,060 --> 00:20:02,399
not need because anywhere in those 400

355
00:20:00,240 --> 00:20:05,310
bikes in the fleet some people are

356
00:20:02,400 --> 00:20:07,680
riding and I go over all booking IDs and

357
00:20:05,310 --> 00:20:12,960
I just lock all the bikes so what

358
00:20:07,680 --> 00:20:15,410
happens I tested it is the bike won't

359
00:20:12,960 --> 00:20:18,450
just break while you're driving it

360
00:20:15,410 --> 00:20:21,360
fortunately but what happens is as soon

361
00:20:18,450 --> 00:20:24,180
as you stand with the bike as you're not

362
00:20:21,360 --> 00:20:26,550
riding in anymore then the the rear

363
00:20:24,180 --> 00:20:27,330
wheel blocks and you can go any further

364
00:20:26,550 --> 00:20:29,970
anymore

365
00:20:27,330 --> 00:20:33,780
so imagine you're at a red light at the

366
00:20:29,970 --> 00:20:35,760
crossing you just stop the bike and then

367
00:20:33,780 --> 00:20:39,840
you want to go further but no you can't

368
00:20:35,760 --> 00:20:46,670
because the bike is is that the rear

369
00:20:39,840 --> 00:20:50,250
wheel is blocked okay so I I was I

370
00:20:46,670 --> 00:20:51,990
figured that out on a Friday night

371
00:20:50,250 --> 00:20:54,930
well actually it was already Saturday

372
00:20:51,990 --> 00:20:57,480
morning and 1:30 in the morning when I

373
00:20:54,930 --> 00:20:59,490
sent a report well I told you it's a

374
00:20:57,480 --> 00:21:02,280
side project so I wasn't doing that at

375
00:20:59,490 --> 00:21:05,010
business hours on Sunday

376
00:21:02,280 --> 00:21:07,080
now that was still now I think it was

377
00:21:05,010 --> 00:21:12,000
from Saturday to Sunday so on Sunday I

378
00:21:07,080 --> 00:21:16,080
got the first answer from the customer

379
00:21:12,000 --> 00:21:18,600
support who told me okay I'll I'll

380
00:21:16,080 --> 00:21:22,860
forward this to the to the people

381
00:21:18,600 --> 00:21:24,780
concerned and a couple of days later I

382
00:21:22,860 --> 00:21:26,850
got a reply from the product owner that

383
00:21:24,780 --> 00:21:32,460
told us that they had already fixed it

384
00:21:26,850 --> 00:21:36,929
on Monday and all was good so I I was

385
00:21:32,460 --> 00:21:39,900
really happy that they took it seriously

386
00:21:36,930 --> 00:21:43,530
and they I got 100 minutes for free to

387
00:21:39,900 --> 00:21:48,600
to ride on the bike okay now let's turn

388
00:21:43,530 --> 00:21:50,670
to a bike which are those yellow bikes I

389
00:21:48,600 --> 00:21:52,980
don't know in which other cities in

390
00:21:50,670 --> 00:21:55,200
Switzerland they were deployed but like

391
00:21:52,980 --> 00:21:57,210
for one year in Zurich you could go

392
00:21:55,200 --> 00:22:02,580
anywhere and you would see one of these

393
00:21:57,210 --> 00:22:07,080
bikes so in contrast to the smite bikes

394
00:22:02,580 --> 00:22:10,259
there are very cheap bikes they have no

395
00:22:07,080 --> 00:22:13,080
and there are no 'back so there it's

396
00:22:10,259 --> 00:22:14,789
like yeah you have to do sports but the

397
00:22:13,080 --> 00:22:17,340
problem is they are also single speed

398
00:22:14,789 --> 00:22:19,789
and Zurich is not only flat I could

399
00:22:17,340 --> 00:22:22,019
imagine in Lausanne it's pretty and

400
00:22:19,789 --> 00:22:26,789
feasible to use those bikes because it's

401
00:22:22,019 --> 00:22:28,409
like steep everywhere those bikes were

402
00:22:26,789 --> 00:22:29,820
designed to be maintenance-free they

403
00:22:28,409 --> 00:22:32,940
were like designed to be dropped

404
00:22:29,820 --> 00:22:36,629
everywhere on the street and then they

405
00:22:32,940 --> 00:22:40,009
don't care about them anymore this is

406
00:22:36,629 --> 00:22:43,259
why they have solid rubber tires and

407
00:22:40,009 --> 00:22:46,049
they have a really cheap fare as in

408
00:22:43,259 --> 00:22:49,350
comparison it's five times less than the

409
00:22:46,049 --> 00:22:52,470
smite and there are they were deployed

410
00:22:49,350 --> 00:22:54,719
in several countries worldwide in

411
00:22:52,470 --> 00:22:58,019
several cities and European cities like

412
00:22:54,720 --> 00:23:04,649
in Munich in Amsterdam I think also in

413
00:22:58,019 --> 00:23:08,070
Paris in Melbourne Australia yeah I

414
00:23:04,649 --> 00:23:13,168
can't remember it was really a big

415
00:23:08,070 --> 00:23:18,960
endeavor so how did it work there

416
00:23:13,169 --> 00:23:22,619
architecture is is far more simple than

417
00:23:18,960 --> 00:23:25,619
the smite bikes why is that because the

418
00:23:22,619 --> 00:23:27,959
bike is not totally autonomous the bike

419
00:23:25,619 --> 00:23:29,369
logic is actually in this look right

420
00:23:27,960 --> 00:23:32,369
here the rest of the bike is like a

421
00:23:29,369 --> 00:23:35,970
convenient normal bike conventional bike

422
00:23:32,369 --> 00:23:39,238
so what you have here is actually a lock

423
00:23:35,970 --> 00:23:41,820
which has a solar panel so you don't

424
00:23:39,239 --> 00:23:45,179
have to change batteries and I guess the

425
00:23:41,820 --> 00:23:47,639
battery is the most important or the

426
00:23:45,179 --> 00:23:51,659
most valuable valuable part in the in

427
00:23:47,639 --> 00:23:53,639
the whole look because it's it's yeah

428
00:23:51,659 --> 00:23:58,320
it's like a big battery and you can use

429
00:23:53,639 --> 00:24:01,469
it for other projects as well what it

430
00:23:58,320 --> 00:24:04,289
has it's it has a Bluetooth contact

431
00:24:01,470 --> 00:24:06,210
connectivity so you can communicate so

432
00:24:04,289 --> 00:24:09,480
the smartphone can communicate with the

433
00:24:06,210 --> 00:24:12,590
lock but the the whole communication to

434
00:24:09,480 --> 00:24:15,359
the obeid backends is run through the

435
00:24:12,590 --> 00:24:18,629
smartphone application so the lock

436
00:24:15,359 --> 00:24:20,100
itself will never be able to directly

437
00:24:18,629 --> 00:24:23,459
communicate with

438
00:24:20,100 --> 00:24:26,490
back end so if not nobody is using the

439
00:24:23,460 --> 00:24:30,120
bike you won't know where this bike is

440
00:24:26,490 --> 00:24:33,059
so let's also first have a little peek

441
00:24:30,120 --> 00:24:35,100
at how the rest API looks like if you

442
00:24:33,059 --> 00:24:38,039
want to have a list of all the bikes in

443
00:24:35,100 --> 00:24:39,870
your vicinity you just have this very

444
00:24:38,039 --> 00:24:41,910
simple rest call where you give us

445
00:24:39,870 --> 00:24:45,270
parameters your current location this is

446
00:24:41,910 --> 00:24:48,929
the location the the smartphone has so

447
00:24:45,270 --> 00:24:50,850
actually all location or positions your

448
00:24:48,929 --> 00:24:52,830
you are going to communicate to the

449
00:24:50,850 --> 00:24:54,449
backend are always the one of your smart

450
00:24:52,830 --> 00:24:55,980
phone never the one of the lock itself

451
00:24:54,450 --> 00:24:58,500
it just assumes that you're in the

452
00:24:55,980 --> 00:25:03,750
vicinity of the lock and hence you can

453
00:24:58,500 --> 00:25:05,610
use the position of the iPhone and how

454
00:25:03,750 --> 00:25:10,320
does it look like in the response you

455
00:25:05,610 --> 00:25:13,490
get also an array of JSON objects with a

456
00:25:10,320 --> 00:25:15,539
bike ID the bike IDs are always the

457
00:25:13,490 --> 00:25:17,880
international telephone code so like

458
00:25:15,539 --> 00:25:21,090
it's zero for one for Switzerland and

459
00:25:17,880 --> 00:25:24,330
then some sequential numbering then you

460
00:25:21,090 --> 00:25:27,389
have the stored position because you can

461
00:25:24,330 --> 00:25:31,678
actually that the phone can put a

462
00:25:27,390 --> 00:25:34,679
position into the the lock and it will

463
00:25:31,679 --> 00:25:37,169
store it it will be persistent but it

464
00:25:34,679 --> 00:25:39,059
was also communicated to the to the back

465
00:25:37,169 --> 00:25:41,210
end so this is why the back end will say

466
00:25:39,059 --> 00:25:43,500
ok this bike should be at that place

467
00:25:41,210 --> 00:25:46,890
what's interesting here is you have an

468
00:25:43,500 --> 00:25:49,409
email field that's in my understanding

469
00:25:46,890 --> 00:25:51,510
or the first thing I thought it's an

470
00:25:49,409 --> 00:25:54,900
intern International Mobile Equipment

471
00:25:51,510 --> 00:25:57,539
identifier but that's not the format of

472
00:25:54,900 --> 00:26:03,120
an email and you also have a country ID

473
00:25:57,539 --> 00:26:07,740
so 167 is for Switzerland so from that

474
00:26:03,120 --> 00:26:09,479
you can draw a map and have map all

475
00:26:07,740 --> 00:26:11,549
locations of the bike so I don't know

476
00:26:09,480 --> 00:26:13,640
when I did this probably sometime in

477
00:26:11,549 --> 00:26:16,950
September 2017

478
00:26:13,640 --> 00:26:20,450
the fun thing about it is actually since

479
00:26:16,950 --> 00:26:23,669
the bike itself can't send its location

480
00:26:20,450 --> 00:26:27,290
the smartphone is actually doing it so

481
00:26:23,669 --> 00:26:31,200
this is a rest call where you put the

482
00:26:27,290 --> 00:26:36,360
actual coordinates of the bike ID

483
00:26:31,200 --> 00:26:41,060
all-4-one baba bla well you can actually

484
00:26:36,360 --> 00:26:44,459
spoof the the location yourself so

485
00:26:41,060 --> 00:26:46,530
instead of having that you can actually

486
00:26:44,460 --> 00:26:49,650
take all the bikes and put them in the

487
00:26:46,530 --> 00:26:54,540
lake of zurich so but i didn't I never

488
00:26:49,650 --> 00:26:56,940
did it would have been funded and we

489
00:26:54,540 --> 00:26:59,520
also clearly see some if you want to do

490
00:26:56,940 --> 00:27:02,340
attribution the origin of these lofts

491
00:26:59,520 --> 00:27:07,350
these are Chinese locks which you could

492
00:27:02,340 --> 00:27:10,770
buy online and this is also one source

493
00:27:07,350 --> 00:27:14,399
I used to first identify because I

494
00:27:10,770 --> 00:27:18,629
bought these locks after all bike went

495
00:27:14,400 --> 00:27:20,340
bankrupt from a moving company that made

496
00:27:18,630 --> 00:27:22,320
a deal to collect all the bikes and I

497
00:27:20,340 --> 00:27:24,389
contacted them I told them I would like

498
00:27:22,320 --> 00:27:27,929
to bike some of the buy some of the

499
00:27:24,390 --> 00:27:29,280
locks and this was only like last summer

500
00:27:27,930 --> 00:27:33,420
that I did this

501
00:27:29,280 --> 00:27:37,399
and before I only had images from the

502
00:27:33,420 --> 00:27:42,350
FCC because they registered their

503
00:27:37,400 --> 00:27:44,700
Hardware in the US and all this

504
00:27:42,350 --> 00:27:49,399
information technical information for

505
00:27:44,700 --> 00:27:53,340
the FCC regulation was available online

506
00:27:49,400 --> 00:27:56,310
so you can see how look how the lock

507
00:27:53,340 --> 00:27:59,699
looks from inside you can see you can

508
00:27:56,310 --> 00:28:05,790
learn about the mechanism how it is used

509
00:27:59,700 --> 00:28:08,550
and and what kind of chip there is so

510
00:28:05,790 --> 00:28:13,230
there is a guy in Australia who took

511
00:28:08,550 --> 00:28:14,879
apart one of the locks and he made a

512
00:28:13,230 --> 00:28:17,670
video out of it so there was a link if

513
00:28:14,880 --> 00:28:21,900
you want to look at it and so from there

514
00:28:17,670 --> 00:28:26,130
on I knew what kind of chip is inside so

515
00:28:21,900 --> 00:28:28,740
it's Texas Instruments trip con 25:41 so

516
00:28:26,130 --> 00:28:33,810
you can get the spec and out of the spec

517
00:28:28,740 --> 00:28:37,050
you can see it's at the soccer system on

518
00:28:33,810 --> 00:28:40,350
a trip which is used for Bluetooth Low

519
00:28:37,050 --> 00:28:44,340
Energy communication and it has a

520
00:28:40,350 --> 00:28:48,750
coprocessor that you can use for

521
00:28:44,340 --> 00:28:51,330
cryptographic operations like AES but

522
00:28:48,750 --> 00:28:54,330
what stands out here is that there are

523
00:28:51,330 --> 00:28:56,820
only symmetric operations I highlighted

524
00:28:54,330 --> 00:29:00,928
the cbc-mac because I thought okay how

525
00:28:56,820 --> 00:29:03,450
do we how do they want to implement like

526
00:29:00,929 --> 00:29:05,070
a signature scheme because when you when

527
00:29:03,450 --> 00:29:07,740
you open the lock you probably want to

528
00:29:05,070 --> 00:29:12,918
say okay open and now sign this

529
00:29:07,740 --> 00:29:15,360
operation and so this was just an

530
00:29:12,919 --> 00:29:18,779
assumption that they would use cbc-mac

531
00:29:15,360 --> 00:29:21,979
which is kind of like symmetric digital

532
00:29:18,779 --> 00:29:26,669
signature scheme okay so I started

533
00:29:21,980 --> 00:29:31,020
without having a lock at hand I still

534
00:29:26,669 --> 00:29:33,299
used my smart phone and started sniffing

535
00:29:31,020 --> 00:29:36,450
the Bluetooth communication and came up

536
00:29:33,299 --> 00:29:38,460
with this that Bluetooth command

537
00:29:36,450 --> 00:29:40,440
structure look and looks actually like

538
00:29:38,460 --> 00:29:42,750
this you have a small preamble you have

539
00:29:40,440 --> 00:29:46,049
a length field command field and then a

540
00:29:42,750 --> 00:29:47,760
payload and some check you have one bit

541
00:29:46,049 --> 00:29:50,760
that tells you in which direction the

542
00:29:47,760 --> 00:29:53,520
information flows and the check byte is

543
00:29:50,760 --> 00:29:58,110
actually kind of like a CRC check sum a

544
00:29:53,520 --> 00:30:03,960
very simple one so usually what you do

545
00:29:58,110 --> 00:30:07,469
is you have a first hello message sent

546
00:30:03,960 --> 00:30:09,690
from the smart phone to the lock and you

547
00:30:07,470 --> 00:30:13,950
are first point to store the coordinates

548
00:30:09,690 --> 00:30:16,649
on the lock so these two fields are the

549
00:30:13,950 --> 00:30:18,809
actual latitude and longitude the

550
00:30:16,649 --> 00:30:22,350
smartphone has and will store them on

551
00:30:18,809 --> 00:30:24,360
the lock and the lock will respond with

552
00:30:22,350 --> 00:30:27,029
a 32 bit challenge that you will use

553
00:30:24,360 --> 00:30:29,729
afterwards to send via REST API to the

554
00:30:27,029 --> 00:30:33,840
backend the backend will answer with the

555
00:30:29,730 --> 00:30:37,649
key index this is the byte at this 8 be

556
00:30:33,840 --> 00:30:41,399
byte and then which looks like an Aes

557
00:30:37,649 --> 00:30:44,070
payload or like 1 block but which was

558
00:30:41,399 --> 00:30:45,719
truncated to 96 bits and the rest

559
00:30:44,070 --> 00:30:51,960
failure you can see they are there are

560
00:30:45,720 --> 00:30:55,820
190 128 bits but only 3/4 of it will be

561
00:30:51,960 --> 00:30:58,670
sent to the to the lock and wired on now

562
00:30:55,820 --> 00:31:01,040
because what you get in response is like

563
00:30:58,670 --> 00:31:02,810
an acknowledgment package which is also

564
00:31:01,040 --> 00:31:05,030
kind of like signed with this hundred

565
00:31:02,810 --> 00:31:08,720
and twenty eight bits a year something

566
00:31:05,030 --> 00:31:11,120
and there you have enough space for the

567
00:31:08,720 --> 00:31:15,800
128 bits so I have no idea why they

568
00:31:11,120 --> 00:31:19,820
truncated it but okay so the assumption

569
00:31:15,800 --> 00:31:23,870
is it's a symmetric cryptographic scheme

570
00:31:19,820 --> 00:31:27,470
and that implies that the keys are

571
00:31:23,870 --> 00:31:29,959
actually all stored on this on this chip

572
00:31:27,470 --> 00:31:31,550
so the goal now was well let's find out

573
00:31:29,960 --> 00:31:34,910
if I can extract it so I'm not a

574
00:31:31,550 --> 00:31:39,379
hardware guy it was all new for me but I

575
00:31:34,910 --> 00:31:41,690
saw on those FCC pictures which

576
00:31:39,380 --> 00:31:45,950
something that looked like debug pants

577
00:31:41,690 --> 00:31:48,500
and which made me bite something like

578
00:31:45,950 --> 00:31:52,280
that a CC debugger which was designed to

579
00:31:48,500 --> 00:31:54,920
debug the this line of chips but

580
00:31:52,280 --> 00:31:57,050
unfortunately to use this you need to

581
00:31:54,920 --> 00:31:59,780
wire it in the right way and then the

582
00:31:57,050 --> 00:32:02,810
green light lights up but when I did it

583
00:31:59,780 --> 00:32:06,379
it never went green so I was kind of

584
00:32:02,810 --> 00:32:09,830
like demotivated and and left it on the

585
00:32:06,380 --> 00:32:12,440
side for some time in the meantime a

586
00:32:09,830 --> 00:32:15,230
group of students from the National

587
00:32:12,440 --> 00:32:18,830
University of Singapore came up also

588
00:32:15,230 --> 00:32:23,030
analyzed the OU bike scheme protocol and

589
00:32:18,830 --> 00:32:26,510
came up with a super cool vulnerability

590
00:32:23,030 --> 00:32:29,750
that I didn't see because it was like

591
00:32:26,510 --> 00:32:31,700
too big so how does it look like from

592
00:32:29,750 --> 00:32:33,290
high level so you have the OU bike on

593
00:32:31,700 --> 00:32:35,030
the left side the mobile app in the

594
00:32:33,290 --> 00:32:37,700
middle which is the man in the middle

595
00:32:35,030 --> 00:32:40,639
and you have to Oh bite back and so what

596
00:32:37,700 --> 00:32:43,490
you do is the OU bike lock generates the

597
00:32:40,640 --> 00:32:44,380
32 bit challenge its get sent back to

598
00:32:43,490 --> 00:32:47,510
the back end

599
00:32:44,380 --> 00:32:49,970
the back end generates a response send

600
00:32:47,510 --> 00:32:52,490
its back to the you to the lock and at

601
00:32:49,970 --> 00:32:55,160
that moment you have the acknowledgment

602
00:32:52,490 --> 00:32:57,500
well at that moment the low lock goes up

603
00:32:55,160 --> 00:33:03,500
and it generates an acknowledgment which

604
00:32:57,500 --> 00:33:05,929
you should send to the back end and then

605
00:33:03,500 --> 00:33:07,220
the backend starts spilling so do you

606
00:33:05,929 --> 00:33:09,470
see the problem

607
00:33:07,220 --> 00:33:13,070
okay I see nodding yeah there's the

608
00:33:09,470 --> 00:33:15,590
problem you just omit the last message

609
00:33:13,070 --> 00:33:23,389
and you're good so I have a little demo

610
00:33:15,590 --> 00:33:25,668
for this and okay I just need to make

611
00:33:23,389 --> 00:33:36,019
sure that I have Internet

612
00:33:25,669 --> 00:33:37,240
that's good so I also need to so I'm

613
00:33:36,019 --> 00:33:40,759
gonna take this one

614
00:33:37,240 --> 00:33:42,919
everything that's read is information

615
00:33:40,759 --> 00:33:45,320
going to the lock and if anything

616
00:33:42,919 --> 00:33:49,429
greenness information coming from the

617
00:33:45,320 --> 00:33:54,259
lock so let's test it doesn't work okay

618
00:33:49,429 --> 00:34:01,100
of course I was so naive to think it

619
00:33:54,259 --> 00:34:03,440
would work okay now it should work so

620
00:34:01,100 --> 00:34:06,408
what's interesting is no it was the

621
00:34:03,440 --> 00:34:11,540
other lock that went off sorry to do it

622
00:34:06,409 --> 00:34:14,750
again so what's interesting here is that

623
00:34:11,540 --> 00:34:17,000
I'm actually yeah now that we have it

624
00:34:14,750 --> 00:34:21,168
I'm actually communicating with the oh

625
00:34:17,000 --> 00:34:23,480
bike back-end and they're still online

626
00:34:21,168 --> 00:34:29,480
although the service that although they

627
00:34:23,480 --> 00:34:32,089
went bankrupt so we should yeah this is

628
00:34:29,480 --> 00:34:35,270
this is a response actually and we can

629
00:34:32,089 --> 00:34:39,699
see on this line here that we're sending

630
00:34:35,270 --> 00:34:48,770
up to the last byte only 96 bit of those

631
00:34:39,699 --> 00:34:50,598
128 okay so let's go back to D but once

632
00:34:48,770 --> 00:34:56,899
you do that you get another problem

633
00:34:50,599 --> 00:34:59,119
because you get this response oh by

634
00:34:56,899 --> 00:35:01,730
x-pac and thinks oh I didn't get an

635
00:34:59,119 --> 00:35:05,150
acknowledgment this byte must be broken

636
00:35:01,730 --> 00:35:07,339
so you can do this once with one bike

637
00:35:05,150 --> 00:35:10,099
afterward you can't use the bike anymore

638
00:35:07,339 --> 00:35:12,849
for 24 hours so that's a denial of

639
00:35:10,099 --> 00:35:14,839
service they change this behavior

640
00:35:12,849 --> 00:35:18,520
afterwards which opened the new

641
00:35:14,839 --> 00:35:21,440
vulnerability that we will see in later

642
00:35:18,520 --> 00:35:24,740
I'm kind of running out of time so um

643
00:35:21,440 --> 00:35:28,730
I'm going to skip this part they change

644
00:35:24,740 --> 00:35:30,410
the API sometime in September 2017 all

645
00:35:28,730 --> 00:35:33,530
the requests looks like that

646
00:35:30,410 --> 00:35:36,649
they started encrypting those requests

647
00:35:33,530 --> 00:35:39,710
if you ask why I think it has to do with

648
00:35:36,650 --> 00:35:43,070
this news report that tell that somebody

649
00:35:39,710 --> 00:35:45,619
found a way to steal all the data of all

650
00:35:43,070 --> 00:35:47,750
users of all bike and then yeah

651
00:35:45,619 --> 00:35:50,180
technical measure encrypt all the things

652
00:35:47,750 --> 00:35:53,359
too bad that the encryption key was

653
00:35:50,180 --> 00:35:54,740
actually inside the mobile phone so if

654
00:35:53,359 --> 00:35:57,319
you're interested in the encryption

655
00:35:54,740 --> 00:35:59,419
scheme you can have a look at this

656
00:35:57,320 --> 00:36:01,490
wonderful initialization vector in

657
00:35:59,420 --> 00:36:06,710
orange and you could see that's not

658
00:36:01,490 --> 00:36:08,598
really good practice but okay so using

659
00:36:06,710 --> 00:36:12,820
those keys you could actually transform

660
00:36:08,599 --> 00:36:15,950
this encrypted request into this again

661
00:36:12,820 --> 00:36:21,050
then in the meantime another security

662
00:36:15,950 --> 00:36:24,830
researcher looked at the locks in

663
00:36:21,050 --> 00:36:27,619
parallel like me and he did a talk at

664
00:36:24,830 --> 00:36:30,830
last year's Def Con he actually managed

665
00:36:27,619 --> 00:36:32,780
to wire up the thing like you should be

666
00:36:30,830 --> 00:36:36,230
and get the green light running but

667
00:36:32,780 --> 00:36:37,760
unfortunately when you flash the

668
00:36:36,230 --> 00:36:40,880
firmware on it you have the option to

669
00:36:37,760 --> 00:36:43,010
tell that you don't want somebody to

670
00:36:40,880 --> 00:36:45,200
download it again so you seal off the

671
00:36:43,010 --> 00:36:47,390
chip and this is what happened the chip

672
00:36:45,200 --> 00:36:51,529
is locked you can't download it and

673
00:36:47,390 --> 00:36:55,940
again so I thought let's try something

674
00:36:51,530 --> 00:36:57,950
new how about fuzzing today so I'm not

675
00:36:55,940 --> 00:37:02,839
an electronics guy it looks awful I know

676
00:36:57,950 --> 00:37:07,368
but it was fun to do what I'm doing here

677
00:37:02,839 --> 00:37:09,200
is actually I'm I I needed a switch not

678
00:37:07,369 --> 00:37:11,300
automatic switch to turn the board on

679
00:37:09,200 --> 00:37:13,669
and off this is why I'm using this relay

680
00:37:11,300 --> 00:37:17,300
which might be a bit oversized for this

681
00:37:13,670 --> 00:37:21,680
voltage but it works and on the other

682
00:37:17,300 --> 00:37:23,869
hand as feedback

683
00:37:21,680 --> 00:37:25,819
I wanted to know whenever the board

684
00:37:23,869 --> 00:37:27,650
would activate a little motor that would

685
00:37:25,820 --> 00:37:30,950
open the latch

686
00:37:27,650 --> 00:37:35,480
and the idea was then to fuzz the

687
00:37:30,950 --> 00:37:38,600
payloads and see if some time the I get

688
00:37:35,480 --> 00:37:40,940
current on those motor lines I didn't

689
00:37:38,600 --> 00:37:43,610
manage to do it or I didn't do it long

690
00:37:40,940 --> 00:37:46,640
enough but I still had three surprising

691
00:37:43,610 --> 00:37:48,590
discoveries the one is the challenge

692
00:37:46,640 --> 00:37:50,720
you're sending is not random at all

693
00:37:48,590 --> 00:37:53,090
actually it's the number of milliseconds

694
00:37:50,720 --> 00:37:55,189
since the board was powered on so I

695
00:37:53,090 --> 00:37:57,890
discovered it because I was always like

696
00:37:55,190 --> 00:38:01,250
taking the power off and then on again

697
00:37:57,890 --> 00:38:03,940
and I saw well it's always like in the

698
00:38:01,250 --> 00:38:06,500
but you have a lot of zeros in this

699
00:38:03,940 --> 00:38:11,390
challenge

700
00:38:06,500 --> 00:38:14,710
second the response that you get when

701
00:38:11,390 --> 00:38:17,930
sending in challenge can be replayed so

702
00:38:14,710 --> 00:38:22,430
and that's pretty cool and the third

703
00:38:17,930 --> 00:38:24,410
thing the third element is I discovered

704
00:38:22,430 --> 00:38:26,120
a new command type that wasn't like in

705
00:38:24,410 --> 00:38:29,120
use in the smartphone application is

706
00:38:26,120 --> 00:38:32,120
when you send this command to the lock

707
00:38:29,120 --> 00:38:34,910
it will like reboot I don't know if it's

708
00:38:32,120 --> 00:38:37,790
a crash or it's or if it's intentional

709
00:38:34,910 --> 00:38:39,859
but what happens is it works so I can

710
00:38:37,790 --> 00:38:43,220
actually trigger a reboot from a remote

711
00:38:39,860 --> 00:38:44,990
so it looks afterward look it looks like

712
00:38:43,220 --> 00:38:48,980
this this is what we have in the scheme

713
00:38:44,990 --> 00:38:54,620
and now what happens is you want to get

714
00:38:48,980 --> 00:38:59,120
rid of the back end and I'm going to

715
00:38:54,620 --> 00:39:02,230
first reset the trip so that I I know

716
00:38:59,120 --> 00:39:04,640
that I'm at the beginning of the counter

717
00:39:02,230 --> 00:39:08,990
then I'm going to generate a challenge

718
00:39:04,640 --> 00:39:11,720
and in the meantime I downloaded all

719
00:39:08,990 --> 00:39:14,359
responses all possible responses for

720
00:39:11,720 --> 00:39:17,209
like 20,000 challenge ins so this gives

721
00:39:14,360 --> 00:39:19,550
me a window of about 20 seconds for

722
00:39:17,210 --> 00:39:21,920
which any challenge I can look it up and

723
00:39:19,550 --> 00:39:23,360
I just go and look up the response for

724
00:39:21,920 --> 00:39:25,940
the corresponding challenge in this

725
00:39:23,360 --> 00:39:29,810
lookup table and I give it back to it

726
00:39:25,940 --> 00:39:35,080
and this led to a vulnerability which I

727
00:39:29,810 --> 00:39:41,529
published so time for the second demo

728
00:39:35,080 --> 00:39:42,900
and here the only difference so I need

729
00:39:41,530 --> 00:39:45,670
to close it again

730
00:39:42,900 --> 00:39:48,520
the only difference is you're going to

731
00:39:45,670 --> 00:39:51,370
see red and green but you're not going

732
00:39:48,520 --> 00:39:57,550
to have any communication with the back

733
00:39:51,370 --> 00:40:04,710
end so it's a total off line hack if you

734
00:39:57,550 --> 00:40:15,370
want okay that's not what I wanted

735
00:40:04,710 --> 00:40:19,180
Thanks so can I have my slides back okay

736
00:40:15,370 --> 00:40:23,020
and the story's not over yet there's a

737
00:40:19,180 --> 00:40:25,509
guy who created an Twitter account

738
00:40:23,020 --> 00:40:29,770
called open mic who started tweeting

739
00:40:25,510 --> 00:40:33,430
during the c3 Congress last December and

740
00:40:29,770 --> 00:40:39,660
said that he developed an Android

741
00:40:33,430 --> 00:40:43,330
application that lets you open the the

742
00:40:39,660 --> 00:40:45,759
lock so he could extract the the keys

743
00:40:43,330 --> 00:40:47,830
but unfortunately he hasn't talked about

744
00:40:45,760 --> 00:40:50,230
it yet and I tried to get in contact and

745
00:40:47,830 --> 00:40:52,569
didn't hear anything about it okay so I

746
00:40:50,230 --> 00:40:56,350
have five minutes left I'm going to talk

747
00:40:52,570 --> 00:41:00,160
at last about public bike which is

748
00:40:56,350 --> 00:41:03,130
deployed all over Switzerland it has

749
00:41:00,160 --> 00:41:06,029
more than 8,000 bikes and they have

750
00:41:03,130 --> 00:41:10,210
conventional bikes as well as ebikes

751
00:41:06,030 --> 00:41:13,060
they their operation is like this you

752
00:41:10,210 --> 00:41:14,830
need to take the bikes from the station

753
00:41:13,060 --> 00:41:18,340
and bring them back to the station and

754
00:41:14,830 --> 00:41:20,140
the whole logic or communication goes

755
00:41:18,340 --> 00:41:22,960
through the station the station has

756
00:41:20,140 --> 00:41:25,120
mobile connectivity as well as Bluetooth

757
00:41:22,960 --> 00:41:26,890
to talk to the locks the locks are in

758
00:41:25,120 --> 00:41:29,650
the function pretty similar to the obey

759
00:41:26,890 --> 00:41:32,710
blocks and then everything else is

760
00:41:29,650 --> 00:41:36,370
handled over via smartphone app also via

761
00:41:32,710 --> 00:41:39,460
mobile connection they suffer the

762
00:41:36,370 --> 00:41:43,420
vulnerability of mechanical nature

763
00:41:39,460 --> 00:41:46,660
actually people find out that you could

764
00:41:43,420 --> 00:41:48,579
just hit on the lock and they would open

765
00:41:46,660 --> 00:41:50,109
up so this is pretty bad

766
00:41:48,579 --> 00:41:52,329
media coverage didn't get it really

767
00:41:50,109 --> 00:41:54,009
right because they said people were able

768
00:41:52,329 --> 00:41:55,689
to open it with a hand so I guess they

769
00:41:54,009 --> 00:41:59,789
took they had there are smartphones that

770
00:41:55,689 --> 00:42:04,839
just hammered on it but yeah I also

771
00:41:59,789 --> 00:42:09,609
found conceptional weakness in their

772
00:42:04,839 --> 00:42:11,729
service which I cannot disclose yet but

773
00:42:09,609 --> 00:42:14,619
there were aware of it

774
00:42:11,729 --> 00:42:19,868
fortunately and therein the meaning of

775
00:42:14,619 --> 00:42:22,900
in process of fixing it it was or it is

776
00:42:19,869 --> 00:42:24,910
a pretty obvious one as as soon as you

777
00:42:22,900 --> 00:42:27,699
have more details about the architecture

778
00:42:24,910 --> 00:42:31,149
it's a really really obvious one but

779
00:42:27,699 --> 00:42:33,459
it's in the process of being fixed maybe

780
00:42:31,150 --> 00:42:36,489
they also should do a public intrusion

781
00:42:33,459 --> 00:42:41,948
test because they also a subsidiary of

782
00:42:36,489 --> 00:42:45,630
the Swiss post okay so conclusions when

783
00:42:41,949 --> 00:42:48,749
you're starting with such a service

784
00:42:45,630 --> 00:42:52,900
don't forget to think about security and

785
00:42:48,749 --> 00:42:56,198
risk management think about what could

786
00:42:52,900 --> 00:42:59,049
go wrong if you have some more budget

787
00:42:56,199 --> 00:43:01,179
then do a security audit and get rid of

788
00:42:59,049 --> 00:43:03,579
the low-hanging fruits because otherwise

789
00:43:01,179 --> 00:43:07,259
other scriptcase will find them out and

790
00:43:03,579 --> 00:43:07,259
it's not good for your reputation and

791
00:43:07,499 --> 00:43:13,269
don't be naive flaws will be found with

792
00:43:10,900 --> 00:43:15,009
time and the keys cryptographic keys

793
00:43:13,269 --> 00:43:17,169
will be leaked I mean you have one of

794
00:43:15,009 --> 00:43:19,779
Kilis heel in the O bike it's the key

795
00:43:17,170 --> 00:43:21,459
that's inside this chip and it has not

796
00:43:19,779 --> 00:43:23,619
yet been leaked but already been

797
00:43:21,459 --> 00:43:27,038
discovered so makes the device is

798
00:43:23,619 --> 00:43:29,619
fixable make it design some interface to

799
00:43:27,039 --> 00:43:29,979
be able to update the keys if you lie on

800
00:43:29,619 --> 00:43:33,789
them

801
00:43:29,979 --> 00:43:35,620
okay this is all thanks a lot for your

802
00:43:33,789 --> 00:43:36,200
attention and

803
00:43:35,620 --> 00:43:40,080
[Applause]

804
00:43:36,200 --> 00:43:40,080
[Music]

805
00:43:41,180 --> 00:43:55,589
thank you is there any question thanks

806
00:43:54,510 --> 00:43:57,780
for the talk like yeah really really

807
00:43:55,590 --> 00:43:59,760
cool interesting topic I love it

808
00:43:57,780 --> 00:44:01,680
obviously I guess you know there are

809
00:43:59,760 --> 00:44:03,120
similar services with East scooters as

810
00:44:01,680 --> 00:44:04,830
well now like is that something you're

811
00:44:03,120 --> 00:44:06,330
looking to look at at some point would

812
00:44:04,830 --> 00:44:08,460
you say it's similar technology is being

813
00:44:06,330 --> 00:44:12,090
applied there it's certainly interesting

814
00:44:08,460 --> 00:44:16,650
I am too at the moment I really have no

815
00:44:12,090 --> 00:44:18,180
time left to to look into it but it's

816
00:44:16,650 --> 00:44:22,320
definitely worth looking at

817
00:44:18,180 --> 00:44:24,779
I hope they are more mature that the

818
00:44:22,320 --> 00:44:27,840
first generations we had like in the

819
00:44:24,780 --> 00:44:29,010
last second two years and I have no idea

820
00:44:27,840 --> 00:44:30,870
why

821
00:44:29,010 --> 00:44:34,020
oh bike went bankrupt but I could

822
00:44:30,870 --> 00:44:35,880
imagine if they didn't go bankrupt for

823
00:44:34,020 --> 00:44:52,230
financial reasons maybe for technical

824
00:44:35,880 --> 00:44:53,280
reasons any other question well then

825
00:44:52,230 --> 00:44:55,800
thank you for your time and your

826
00:44:53,280 --> 00:45:00,639
presentation was was nice thanks a lot

827
00:44:55,800 --> 00:45:00,639
[Applause]

