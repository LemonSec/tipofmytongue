1
00:00:02,820 --> 00:00:05,279
noon still so good afternoon everyone

2
00:00:05,279 --> 00:00:07,319
thank you for all being here and for

3
00:00:07,319 --> 00:00:09,059
attending this talk uh we're gonna go

4
00:00:09,059 --> 00:00:11,700
through a use case of a red team

5
00:00:11,700 --> 00:00:14,000
assessment that we did uh quite recently

6
00:00:14,000 --> 00:00:16,320
and it's not what you typically expect

7
00:00:16,320 --> 00:00:18,900
of you know building that complex and

8
00:00:18,900 --> 00:00:20,640
complicated way of trying to get in and

9
00:00:20,640 --> 00:00:22,680
bypass things of that extent so just to

10
00:00:22,680 --> 00:00:25,019
kind of highlight that it's not always

11
00:00:25,019 --> 00:00:27,599
what you expect and sometimes the easier

12
00:00:27,599 --> 00:00:29,160
parts are the ones that get you all the

13
00:00:29,160 --> 00:00:31,920
way in so just to introduce ourselves my

14
00:00:31,920 --> 00:00:35,520
name is Nuri I work for unit 42 I'm

15
00:00:35,520 --> 00:00:37,980
based in the Dubai office which is

16
00:00:37,980 --> 00:00:40,680
almost the same weather is here a little

17
00:00:40,680 --> 00:00:44,040
bit warmer but it's good to be here

18
00:00:44,040 --> 00:00:47,360
um I've been in the offensive security

19
00:00:47,360 --> 00:00:50,579
domain for for quite some time uh before

20
00:00:50,579 --> 00:00:53,039
unit 42 I was at mandians and before

21
00:00:53,039 --> 00:00:55,680
that I was in Belgium working at NATO

22
00:00:55,680 --> 00:00:59,100
and uh yeah I'll hand over to maratna to

23
00:00:59,100 --> 00:01:00,539
introduce himself as well yeah hi

24
00:01:00,539 --> 00:01:02,940
everyone my name is marath I'm based in

25
00:01:02,940 --> 00:01:05,040
Netherlands previously I've worked at

26
00:01:05,040 --> 00:01:07,020
qpmg in Deloitte and I recently joined

27
00:01:07,020 --> 00:01:09,840
the uni 42. uh so I'm in the security

28
00:01:09,840 --> 00:01:12,119
field for like almost seven years I

29
00:01:12,119 --> 00:01:14,640
think yeah almost seven uh so I also

30
00:01:14,640 --> 00:01:16,740
like if there are some red teamers I

31
00:01:16,740 --> 00:01:17,939
think you also know the tool called the

32
00:01:17,939 --> 00:01:20,159
explore snapshots so I'm also go through

33
00:01:20,159 --> 00:01:21,960
this tool together with my friend we

34
00:01:21,960 --> 00:01:23,759
just created it to help red teamers

35
00:01:23,759 --> 00:01:24,780
around the world

36
00:01:24,780 --> 00:01:28,860
uh so yeah I think we can continue cool

37
00:01:28,860 --> 00:01:31,080
so so basically the the premise of

38
00:01:31,080 --> 00:01:33,479
today's talk is about an assessment that

39
00:01:33,479 --> 00:01:34,979
we did recently

40
00:01:34,979 --> 00:01:37,200
um there was a company that

41
00:01:37,200 --> 00:01:39,180
um was compromised

42
00:01:39,180 --> 00:01:40,680
um we won't go into details of who the

43
00:01:40,680 --> 00:01:42,900
company was or what they do and the

44
00:01:42,900 --> 00:01:44,939
slides have gone and then the Matrix is

45
00:01:44,939 --> 00:01:48,119
back and we're back so uh they're

46
00:01:48,119 --> 00:01:50,939
listening to us so uh yeah so so a

47
00:01:50,939 --> 00:01:52,860
company got got compromised attackers

48
00:01:52,860 --> 00:01:54,960
got in attackers were persistent for a

49
00:01:54,960 --> 00:01:56,939
couple of months they were watching what

50
00:01:56,939 --> 00:01:58,740
you know what uh what the company was

51
00:01:58,740 --> 00:02:00,540
doing how transactions came in

52
00:02:00,540 --> 00:02:03,119
transactions went out but uh you know

53
00:02:03,119 --> 00:02:04,979
the daily operations the weekly

54
00:02:04,979 --> 00:02:07,320
operations they were in for a few months

55
00:02:07,320 --> 00:02:10,199
when they were happy with um

56
00:02:10,199 --> 00:02:12,300
the whole kind of process and operations

57
00:02:12,300 --> 00:02:15,239
then they took action and

58
00:02:15,239 --> 00:02:17,099
um did some damage by funneling money

59
00:02:17,099 --> 00:02:19,020
out of the company quite a substantial

60
00:02:19,020 --> 00:02:19,980
amount

61
00:02:19,980 --> 00:02:23,040
it hit the news

62
00:02:23,040 --> 00:02:25,500
um it made a lot of impact a reputation

63
00:02:25,500 --> 00:02:27,900
hit of course as you can imagine

64
00:02:27,900 --> 00:02:29,700
um a lot of the I.T security team were

65
00:02:29,700 --> 00:02:30,959
fired

66
00:02:30,959 --> 00:02:32,459
um which to me was a wrong move because

67
00:02:32,459 --> 00:02:34,620
you learn from mistakes but anyway so

68
00:02:34,620 --> 00:02:36,420
they brought in a new team they bought a

69
00:02:36,420 --> 00:02:38,400
new ciso

70
00:02:38,400 --> 00:02:39,959
um they put in

71
00:02:39,959 --> 00:02:42,720
um a new strategy of we need to be

72
00:02:42,720 --> 00:02:44,819
resilient we need to be able to be able

73
00:02:44,819 --> 00:02:47,160
to detect and respond the Dual kind of

74
00:02:47,160 --> 00:02:51,300
good stuff so MFA wherever they could

75
00:02:51,300 --> 00:02:54,360
um a a you know edrs and all the the

76
00:02:54,360 --> 00:02:57,060
kind of endpoints and protection tools

77
00:02:57,060 --> 00:02:59,459
we can do without the slides I think so

78
00:02:59,459 --> 00:03:01,560
uh so they went for certifications and

79
00:03:01,560 --> 00:03:04,680
so on and so forth so the idea was over

80
00:03:04,680 --> 00:03:06,959
a couple of years we've taken our time

81
00:03:06,959 --> 00:03:09,920
of hiring new people of getting new tech

82
00:03:09,920 --> 00:03:12,480
tuning it doing everything we can so

83
00:03:12,480 --> 00:03:14,819
that now we should be should be able to

84
00:03:14,819 --> 00:03:17,099
to block an attack or at least have the

85
00:03:17,099 --> 00:03:18,720
ability to detect and respond to it

86
00:03:18,720 --> 00:03:20,519
quicker than allowing someone to come in

87
00:03:20,519 --> 00:03:22,319
and be persistent in our environment for

88
00:03:22,319 --> 00:03:24,000
three months six months whatever it is

89
00:03:24,000 --> 00:03:25,680
to do any kind of attack

90
00:03:25,680 --> 00:03:28,319
so as a kind of exercise to assess that

91
00:03:28,319 --> 00:03:29,940
they asked us to do a red team

92
00:03:29,940 --> 00:03:31,500
assessment and for those that don't know

93
00:03:31,500 --> 00:03:33,239
I'm sure everyone knows but for those

94
00:03:33,239 --> 00:03:34,860
who don't know a red team assessment is

95
00:03:34,860 --> 00:03:37,440
a simulation of what an attacker does

96
00:03:37,440 --> 00:03:39,180
um so it's No Holds Barred we do

97
00:03:39,180 --> 00:03:41,099
whatever we want we go as far as we want

98
00:03:41,099 --> 00:03:43,860
based on the The Rules of Engagement or

99
00:03:43,860 --> 00:03:47,519
this or the scope so in this instance we

100
00:03:47,519 --> 00:03:49,680
knew the company name and in terms of

101
00:03:49,680 --> 00:03:51,840
the objectives that we had to achieve so

102
00:03:51,840 --> 00:03:53,760
can someone from the outside get in and

103
00:03:53,760 --> 00:03:56,099
achieve the following these were the

104
00:03:56,099 --> 00:03:58,620
objectives set to us so access to you

105
00:03:58,620 --> 00:04:00,720
know crown jewels uh personal

106
00:04:00,720 --> 00:04:02,519
identifiable information and so on and

107
00:04:02,519 --> 00:04:04,379
so forth but it's basically what the

108
00:04:04,379 --> 00:04:06,480
attackers before were able to do are we

109
00:04:06,480 --> 00:04:09,019
able to do it today you know as as as

110
00:04:09,019 --> 00:04:11,340
someone with permission

111
00:04:11,340 --> 00:04:12,980
so

112
00:04:12,980 --> 00:04:15,780
yeah so uh here I step in again so uh

113
00:04:15,780 --> 00:04:18,000
yeah we will describe also like what

114
00:04:18,000 --> 00:04:19,500
kind of stuff we do before we actually

115
00:04:19,500 --> 00:04:21,839
Implement like all activities Hands-On

116
00:04:21,839 --> 00:04:24,479
uh so here we describe like our in like

117
00:04:24,479 --> 00:04:26,580
retim infrastructure so we use

118
00:04:26,580 --> 00:04:28,919
um if you have VPN endpoints around the

119
00:04:28,919 --> 00:04:30,960
world uh especially like mainly in AWS

120
00:04:30,960 --> 00:04:33,360
and in that case it because we like

121
00:04:33,360 --> 00:04:34,620
geographically located in different

122
00:04:34,620 --> 00:04:35,940
regions

123
00:04:35,940 --> 00:04:38,040
um we also want to have like like as

124
00:04:38,040 --> 00:04:39,419
less latency as possible in the max

125
00:04:39,419 --> 00:04:41,100
performance of the network because for

126
00:04:41,100 --> 00:04:42,180
example sometimes you just need to

127
00:04:42,180 --> 00:04:44,400
upload some like really large files and

128
00:04:44,400 --> 00:04:45,960
I don't want basic annuity to wait for

129
00:04:45,960 --> 00:04:47,280
like an hour to download like a few

130
00:04:47,280 --> 00:04:48,840
megabytes of files from for example from

131
00:04:48,840 --> 00:04:51,720
Europe while he's in Dubai uh so for

132
00:04:51,720 --> 00:04:53,699
that we're using like VPC peering in AWS

133
00:04:53,699 --> 00:04:55,500
which allows you to leverage the

134
00:04:55,500 --> 00:04:57,780
technology of AWS to basically link

135
00:04:57,780 --> 00:04:59,580
directly to different data centers that

136
00:04:59,580 --> 00:05:00,720
are located in completely different

137
00:05:00,720 --> 00:05:02,940
geographical locations and basically

138
00:05:02,940 --> 00:05:04,080
have the same performance as you're

139
00:05:04,080 --> 00:05:06,660
located in the same basically lawn which

140
00:05:06,660 --> 00:05:08,040
is actually really great we tested a lot

141
00:05:08,040 --> 00:05:09,660
of times it's actually quite reliable

142
00:05:09,660 --> 00:05:11,820
and also the performance wise like

143
00:05:11,820 --> 00:05:13,620
basically the downloading I think of the

144
00:05:13,620 --> 00:05:15,479
file from the comment like from our C2

145
00:05:15,479 --> 00:05:16,979
service like the same for human for me

146
00:05:16,979 --> 00:05:19,500
so in that case I think our like first

147
00:05:19,500 --> 00:05:21,600
point was achieved for the C2 server

148
00:05:21,600 --> 00:05:23,460
we're using cobblestrike which is also

149
00:05:23,460 --> 00:05:27,000
very known like a tool uh to use also by

150
00:05:27,000 --> 00:05:28,620
threat actors they're also leveraging

151
00:05:28,620 --> 00:05:30,900
like old cracked versions of the tool to

152
00:05:30,900 --> 00:05:32,520
perform like malicious activities as

153
00:05:32,520 --> 00:05:34,199
well

154
00:05:34,199 --> 00:05:36,479
um and we also use like a Kali VM like

155
00:05:36,479 --> 00:05:39,900
as our publicly facing VM to do uh the

156
00:05:39,900 --> 00:05:41,639
awesome so in this case for example like

157
00:05:41,639 --> 00:05:42,900
if you know the target we just

158
00:05:42,900 --> 00:05:44,520
enumerated it already like using some

159
00:05:44,520 --> 00:05:45,720
threat Intel source that we have

160
00:05:45,720 --> 00:05:47,280
internally in the company and then we

161
00:05:47,280 --> 00:05:48,780
just do some like

162
00:05:48,780 --> 00:05:50,460
um like heavy scanning of the network

163
00:05:50,460 --> 00:05:52,979
outside to see what is exposed what we

164
00:05:52,979 --> 00:05:55,199
can find and maybe we can even like

165
00:05:55,199 --> 00:05:56,940
already achieve some objectives without

166
00:05:56,940 --> 00:05:59,160
even moving to the network itself which

167
00:05:59,160 --> 00:06:01,860
we will also demonstrate later and of

168
00:06:01,860 --> 00:06:03,419
course like optional components I think

169
00:06:03,419 --> 00:06:05,220
in this case it can be like using some

170
00:06:05,220 --> 00:06:06,720
legitimate services from cloud providers

171
00:06:06,720 --> 00:06:08,699
like content delivery networks like also

172
00:06:08,699 --> 00:06:10,979
known as cdns or we can also use some

173
00:06:10,979 --> 00:06:13,860
like series from Azure or from AWS to

174
00:06:13,860 --> 00:06:15,660
have domains with a better reputation

175
00:06:15,660 --> 00:06:18,060
for Content control in that case for

176
00:06:18,060 --> 00:06:19,680
example we also observed especially

177
00:06:19,680 --> 00:06:21,720
around like Azure components that they

178
00:06:21,720 --> 00:06:23,400
always whitelist on proxies or at least

179
00:06:23,400 --> 00:06:24,780
in most of the cases they're white

180
00:06:24,780 --> 00:06:27,419
listed at proxies including like cdns or

181
00:06:27,419 --> 00:06:29,220
Azure function apps or like any other

182
00:06:29,220 --> 00:06:31,440
service that they use in Azure and in

183
00:06:31,440 --> 00:06:33,000
this case like the traffic is usually

184
00:06:33,000 --> 00:06:34,979
not inspected and then your C2 traffic

185
00:06:34,979 --> 00:06:37,800
can actually easily bypass the network

186
00:06:37,800 --> 00:06:39,960
restrictions that they have yeah

187
00:06:39,960 --> 00:06:43,440
okay and now we are lost

188
00:06:43,440 --> 00:06:47,300
we are lost but we shall be found

189
00:06:49,560 --> 00:06:53,900
please stand by let's see

190
00:06:56,340 --> 00:06:59,400
um so like basically destroy like what

191
00:06:59,400 --> 00:07:01,560
we have but how we actually do this

192
00:07:01,560 --> 00:07:03,360
um so in our case we're using ansible

193
00:07:03,360 --> 00:07:05,759
awx which is

194
00:07:05,759 --> 00:07:07,560
um also known as an ansible Tower if

195
00:07:07,560 --> 00:07:08,819
there's some system administration in

196
00:07:08,819 --> 00:07:11,039
the room uh maybe some of you you

197
00:07:11,039 --> 00:07:12,000
actually use this to actually

198
00:07:12,000 --> 00:07:13,259
orchestrate and manage your

199
00:07:13,259 --> 00:07:15,360
infrastructure

200
00:07:15,360 --> 00:07:16,620
um the reason why we're using ansible

201
00:07:16,620 --> 00:07:19,080
awx is because it's like scalable

202
00:07:19,080 --> 00:07:21,419
it has also features like what ansible

203
00:07:21,419 --> 00:07:23,280
has like for example ansible Vol so you

204
00:07:23,280 --> 00:07:24,599
can have like your sensitive credential

205
00:07:24,599 --> 00:07:26,699
material inside of ansible vault which

206
00:07:26,699 --> 00:07:28,380
will be protected by like one of the

207
00:07:28,380 --> 00:07:29,940
best encryption

208
00:07:29,940 --> 00:07:32,940
um standards it also has supports ACLS

209
00:07:32,940 --> 00:07:34,020
for example let's say like if you're a

210
00:07:34,020 --> 00:07:35,940
team of 15 people and you don't want to

211
00:07:35,940 --> 00:07:37,380
be like a single point of contact hey

212
00:07:37,380 --> 00:07:38,759
can you deploy me the infrastructure

213
00:07:38,759 --> 00:07:40,560
like all the time then you can actually

214
00:07:40,560 --> 00:07:42,660
give the person access to specific

215
00:07:42,660 --> 00:07:45,360
projects within uh AWS and then for

216
00:07:45,360 --> 00:07:47,819
example that person like himself or

217
00:07:47,819 --> 00:07:49,919
herself can just click okay deploy the

218
00:07:49,919 --> 00:07:51,300
infrastructure then like the magic will

219
00:07:51,300 --> 00:07:53,460
happen of course it required a lot of

220
00:07:53,460 --> 00:07:55,199
development power but uh well we are

221
00:07:55,199 --> 00:07:57,120
there now so it saves us a lot of time

222
00:07:57,120 --> 00:07:59,520
and I think the last but not least the

223
00:07:59,520 --> 00:08:02,520
main advantage of AWS at least how we

224
00:08:02,520 --> 00:08:04,319
see it it's like about like Inventory

225
00:08:04,319 --> 00:08:05,580
management and also cost management

226
00:08:05,580 --> 00:08:07,319
because you can have like your

227
00:08:07,319 --> 00:08:10,199
infrastructure exposed like a lot and

228
00:08:10,199 --> 00:08:11,520
you can just forget about running a

229
00:08:11,520 --> 00:08:13,380
specific project that were done like a

230
00:08:13,380 --> 00:08:15,720
few months ago but you still have these

231
00:08:15,720 --> 00:08:18,180
costs up and up up and then a sampling

232
00:08:18,180 --> 00:08:19,740
you're like hey we spent like a few

233
00:08:19,740 --> 00:08:21,060
thousand bucks but we're already not

234
00:08:21,060 --> 00:08:22,560
running this project for like six months

235
00:08:22,560 --> 00:08:25,500
and then you kind of like need to figure

236
00:08:25,500 --> 00:08:26,940
figure out as well how you can actually

237
00:08:26,940 --> 00:08:28,440
optimize the cost but for that you need

238
00:08:28,440 --> 00:08:29,940
to have visibility of what you actually

239
00:08:29,940 --> 00:08:32,219
have an AWS in this case like it

240
00:08:32,219 --> 00:08:33,539
supports inventory so you can actually

241
00:08:33,539 --> 00:08:35,399
see okay you have like inventories you

242
00:08:35,399 --> 00:08:37,679
have specific types of resources for

243
00:08:37,679 --> 00:08:40,380
example like C2 server redirector VMS

244
00:08:40,380 --> 00:08:41,520
and then you can just for example like

245
00:08:41,520 --> 00:08:43,500
kill them all as well from the AWS as

246
00:08:43,500 --> 00:08:45,000
well

247
00:08:45,000 --> 00:08:46,800
um the way how it looks just a few a few

248
00:08:46,800 --> 00:08:49,500
examples so this is the typical

249
00:08:49,500 --> 00:08:52,740
um typical dashboard of aw

250
00:08:52,740 --> 00:08:55,019
and in this case this actually shows job

251
00:08:55,019 --> 00:08:57,000
templates so here like a few examples

252
00:08:57,000 --> 00:08:58,560
like how you can deploy the

253
00:08:58,560 --> 00:09:00,779
infrastructure like in the AWS and then

254
00:09:00,779 --> 00:09:02,339
you also need like to configure these

255
00:09:02,339 --> 00:09:03,660
components because deploying is one

256
00:09:03,660 --> 00:09:04,920
thing but then of course you also want

257
00:09:04,920 --> 00:09:06,899
to like configure them in a way that

258
00:09:06,899 --> 00:09:09,600
will be the most protected at least from

259
00:09:09,600 --> 00:09:12,240
just like regular perspective and then

260
00:09:12,240 --> 00:09:13,860
you have like just you can have like as

261
00:09:13,860 --> 00:09:15,180
many job templates as you want to

262
00:09:15,180 --> 00:09:17,279
configure like specific resources that

263
00:09:17,279 --> 00:09:20,100
you will be using in your operations

264
00:09:20,100 --> 00:09:22,260
uh yeah and in this case like you can

265
00:09:22,260 --> 00:09:23,519
also which is actually really nice

266
00:09:23,519 --> 00:09:25,620
feature you can enable service so for

267
00:09:25,620 --> 00:09:27,300
example you can ask the user for

268
00:09:27,300 --> 00:09:28,860
specific like information before it will

269
00:09:28,860 --> 00:09:30,839
be actually deployed and you hear like

270
00:09:30,839 --> 00:09:32,100
just a few examples where you want to

271
00:09:32,100 --> 00:09:33,300
deploy your infrastructure for example

272
00:09:33,300 --> 00:09:35,580
in which AWS region or and what's the

273
00:09:35,580 --> 00:09:36,660
project name because you don't want to

274
00:09:36,660 --> 00:09:38,040
have like everything to be like a test

275
00:09:38,040 --> 00:09:39,839
test test

276
00:09:39,839 --> 00:09:44,399
yeah and I think yeah cool so once once

277
00:09:44,399 --> 00:09:45,779
the infrastructure is deployed we

278
00:09:45,779 --> 00:09:48,000
typically do things in phases we we set

279
00:09:48,000 --> 00:09:50,100
up tasks for each other

280
00:09:50,100 --> 00:09:52,560
um because we're all remote so you're in

281
00:09:52,560 --> 00:09:54,779
the Netherlands I'm in Dubai

282
00:09:54,779 --> 00:09:56,339
um you know it's not the easiest thing

283
00:09:56,339 --> 00:09:57,839
as you know when you're sitting side by

284
00:09:57,839 --> 00:09:59,220
side and working together and

285
00:09:59,220 --> 00:10:01,080
high-fiving every time something hit a

286
00:10:01,080 --> 00:10:03,000
break so it goes wrong or goes go goes

287
00:10:03,000 --> 00:10:04,680
well so

288
00:10:04,680 --> 00:10:07,140
um we set each other tasks to do

289
00:10:07,140 --> 00:10:09,420
um we have open communication if we're

290
00:10:09,420 --> 00:10:11,580
using slack for example we have a you

291
00:10:11,580 --> 00:10:13,500
know a huddle open or whatever it may be

292
00:10:13,500 --> 00:10:15,540
so we're always in communication we're

293
00:10:15,540 --> 00:10:17,580
always figuring out out you know have we

294
00:10:17,580 --> 00:10:18,899
completed this what should we look for

295
00:10:18,899 --> 00:10:21,060
what should we do when it comes to the

296
00:10:21,060 --> 00:10:24,660
first week of of our red team

297
00:10:24,660 --> 00:10:26,399
um as rat mentioned we set up our

298
00:10:26,399 --> 00:10:28,620
infrastructure of course we set up our

299
00:10:28,620 --> 00:10:31,320
C2 servers redirectors we hide you know

300
00:10:31,320 --> 00:10:33,899
the source of it but we also look at the

301
00:10:33,899 --> 00:10:35,580
reconnaissance we do the OS Center as

302
00:10:35,580 --> 00:10:38,040
well we're lucky working in at unit 42

303
00:10:38,040 --> 00:10:39,480
that we have access to some of the tools

304
00:10:39,480 --> 00:10:42,540
that Palo Alto has cortex expanse which

305
00:10:42,540 --> 00:10:44,040
does the attack surface mapping

306
00:10:44,040 --> 00:10:46,860
completely passive so we're not alerting

307
00:10:46,860 --> 00:10:48,959
anyone but then we do go a bit deeper we

308
00:10:48,959 --> 00:10:51,600
look at Deep Web dark web as well we try

309
00:10:51,600 --> 00:10:54,060
and see if there's leak credentials if

310
00:10:54,060 --> 00:10:55,980
there's session cookies for sale because

311
00:10:55,980 --> 00:10:57,899
if we get a session cookie then we don't

312
00:10:57,899 --> 00:10:59,700
care about MFA or any of these types of

313
00:10:59,700 --> 00:11:02,519
things we're just in with a browser so

314
00:11:02,519 --> 00:11:07,140
we look at also DNS so do they have SPF

315
00:11:07,140 --> 00:11:09,600
records DCM dmarc is there any way to

316
00:11:09,600 --> 00:11:12,060
spoof what exceptions do they have do

317
00:11:12,060 --> 00:11:14,820
they allow any of these kind of Webmail

318
00:11:14,820 --> 00:11:16,740
um or these stand grid kind of services

319
00:11:16,740 --> 00:11:18,180
to go through because that gives us

320
00:11:18,180 --> 00:11:19,800
ideas of what we can do to Target that

321
00:11:19,800 --> 00:11:22,380
organization we're also looking at what

322
00:11:22,380 --> 00:11:24,000
sites do they have what services are

323
00:11:24,000 --> 00:11:26,279
exposed we might go a bit active by

324
00:11:26,279 --> 00:11:28,019
looking at something like an nmap if we

325
00:11:28,019 --> 00:11:29,640
have information about a specific

326
00:11:29,640 --> 00:11:31,680
service that's exposed or was exposed

327
00:11:31,680 --> 00:11:34,079
three months ago six months ago just to

328
00:11:34,079 --> 00:11:35,399
make sure that it's still there it's

329
00:11:35,399 --> 00:11:37,800
still open so we might go a bit active

330
00:11:37,800 --> 00:11:38,820
and then

331
00:11:38,820 --> 00:11:41,279
we drove full active in terms of you

332
00:11:41,279 --> 00:11:43,320
know something like nuclei if you have a

333
00:11:43,320 --> 00:11:45,300
list of domains we try and gather a list

334
00:11:45,300 --> 00:11:48,480
of sub-domains certificates IP net

335
00:11:48,480 --> 00:11:50,640
blocks and so on so we look at all of

336
00:11:50,640 --> 00:11:52,860
those one thing to keep in mind is that

337
00:11:52,860 --> 00:11:55,440
a red team is about Stealth all right so

338
00:11:55,440 --> 00:11:57,600
we're not doing a pen test here we're

339
00:11:57,600 --> 00:11:59,399
not launching all kind of acunetics and

340
00:11:59,399 --> 00:12:00,660
nessus and all these different kind of

341
00:12:00,660 --> 00:12:02,160
automated scanners you're going to get

342
00:12:02,160 --> 00:12:04,079
busted unless you change your IP all the

343
00:12:04,079 --> 00:12:06,120
time and you know but you're still

344
00:12:06,120 --> 00:12:08,579
giving away that that you're trying to

345
00:12:08,579 --> 00:12:10,380
do something so it's about Stealth so

346
00:12:10,380 --> 00:12:13,320
you're probing lightly you're going as a

347
00:12:13,320 --> 00:12:14,040
normal

348
00:12:14,040 --> 00:12:16,200
human as opposed to a bot and going to

349
00:12:16,200 --> 00:12:18,180
visit sites and clicking around and so

350
00:12:18,180 --> 00:12:21,660
on if we identify a vulnerability which

351
00:12:21,660 --> 00:12:24,899
in the world of pen testing is a low

352
00:12:24,899 --> 00:12:27,300
medium or maybe even a high

353
00:12:27,300 --> 00:12:29,640
we don't care about it we we do not

354
00:12:29,640 --> 00:12:31,380
bother with it because this is again not

355
00:12:31,380 --> 00:12:33,660
a pen test we don't care about finding a

356
00:12:33,660 --> 00:12:35,160
cross-site scripting

357
00:12:35,160 --> 00:12:37,019
sure you can use cross-site scripting

358
00:12:37,019 --> 00:12:38,820
leverage it with social engineering to

359
00:12:38,820 --> 00:12:40,320
try and get a session cookie out

360
00:12:40,320 --> 00:12:42,120
depending if it's stored or reflected

361
00:12:42,120 --> 00:12:44,339
but we don't care about that if it's SQL

362
00:12:44,339 --> 00:12:46,399
injection again

363
00:12:46,399 --> 00:12:48,600
potentially because we can get access

364
00:12:48,600 --> 00:12:50,639
maybe we can upload a web shell or maybe

365
00:12:50,639 --> 00:12:52,440
we could pull information out but it's

366
00:12:52,440 --> 00:12:55,139
going to be noisy so we're looking at

367
00:12:55,139 --> 00:12:56,760
all different aspects of how can we get

368
00:12:56,760 --> 00:12:58,980
in we look at the critical ways in which

369
00:12:58,980 --> 00:13:00,779
get us access without having all the

370
00:13:00,779 --> 00:13:02,220
headache of anything else we're not

371
00:13:02,220 --> 00:13:04,440
going to be chaining two mediums and one

372
00:13:04,440 --> 00:13:06,180
high and you know trying to social

373
00:13:06,180 --> 00:13:07,860
engineer someone to go through these

374
00:13:07,860 --> 00:13:11,100
steps so we don't do that so we also

375
00:13:11,100 --> 00:13:14,040
look at what we call sites of Interest

376
00:13:14,040 --> 00:13:16,079
So based on everything that you own from

377
00:13:16,079 --> 00:13:19,320
the kind of attack surface we see are

378
00:13:19,320 --> 00:13:23,399
you using 0365 are you using adfs is

379
00:13:23,399 --> 00:13:25,019
there a website that we can clone maybe

380
00:13:25,019 --> 00:13:27,480
we can do credential harvesting is there

381
00:13:27,480 --> 00:13:29,880
any information is there a new

382
00:13:29,880 --> 00:13:31,380
um event that you're doing something

383
00:13:31,380 --> 00:13:32,880
that we can take advantage of because

384
00:13:32,880 --> 00:13:34,560
we're always thinking about the phishing

385
00:13:34,560 --> 00:13:36,720
aspect so if we don't find something on

386
00:13:36,720 --> 00:13:38,579
the perimeter to get us in then we

387
00:13:38,579 --> 00:13:40,320
target the human of course so so we go

388
00:13:40,320 --> 00:13:42,180
through phishing what can we use for

389
00:13:42,180 --> 00:13:43,740
phishing campaigns if you're doing an

390
00:13:43,740 --> 00:13:46,380
event we can use that things like covet

391
00:13:46,380 --> 00:13:48,600
and stuff it's kind of overdone and

392
00:13:48,600 --> 00:13:51,480
overused and this is the point of the

393
00:13:51,480 --> 00:13:53,519
reconnaissance and the OS Center I think

394
00:13:53,519 --> 00:13:55,139
you're on next

395
00:13:55,139 --> 00:13:56,220
yeah

396
00:13:56,220 --> 00:13:58,500
so in this case this actually was quite

397
00:13:58,500 --> 00:14:00,240
interesting for us because we were just

398
00:14:00,240 --> 00:14:01,620
basically casually brought in browsing

399
00:14:01,620 --> 00:14:03,120
around the companies like external

400
00:14:03,120 --> 00:14:04,440
perimeters checking what they actually

401
00:14:04,440 --> 00:14:06,600
have what kind of Technologies they use

402
00:14:06,600 --> 00:14:08,399
and that we can also leverage

403
00:14:08,399 --> 00:14:09,540
potentially

404
00:14:09,540 --> 00:14:11,279
and for us I think surprisingly it was

405
00:14:11,279 --> 00:14:12,240
like we found that they're using

406
00:14:12,240 --> 00:14:13,260
SharePoint

407
00:14:13,260 --> 00:14:14,639
of course like everyone knows SharePoint

408
00:14:14,639 --> 00:14:16,980
is probably like that it's like the like

409
00:14:16,980 --> 00:14:18,240
that you're using like most really your

410
00:14:18,240 --> 00:14:19,440
intranet is actually on the SharePoint

411
00:14:19,440 --> 00:14:21,060
internally in the company

412
00:14:21,060 --> 00:14:22,980
but uh some companies are actually using

413
00:14:22,980 --> 00:14:24,839
SharePoint to host a site that is

414
00:14:24,839 --> 00:14:26,040
publicly accessible for example like

415
00:14:26,040 --> 00:14:27,959
WordPress

416
00:14:27,959 --> 00:14:30,540
um and in this specific case like

417
00:14:30,540 --> 00:14:32,279
um they had a specific like SharePoint

418
00:14:32,279 --> 00:14:33,779
developers which we found out later of

419
00:14:33,779 --> 00:14:35,639
course that they basically designed a

420
00:14:35,639 --> 00:14:37,260
website in a way that was trying to

421
00:14:37,260 --> 00:14:39,300
leverage all SharePoint functionality to

422
00:14:39,300 --> 00:14:41,459
do the content uh basically presenting

423
00:14:41,459 --> 00:14:42,720
the content back to the user and then

424
00:14:42,720 --> 00:14:44,639
they watching some JavaScript magic that

425
00:14:44,639 --> 00:14:46,079
was presenting this like content back to

426
00:14:46,079 --> 00:14:49,139
the user in in a nice browser session

427
00:14:49,139 --> 00:14:51,120
so while we're just basically exploring

428
00:14:51,120 --> 00:14:53,160
stuff we found like okay they have a

429
00:14:53,160 --> 00:14:56,160
rest API exposed and then like okay like

430
00:14:56,160 --> 00:14:57,660
well usually when you see like a rest

431
00:14:57,660 --> 00:14:59,579
API is already quite interesting because

432
00:14:59,579 --> 00:15:02,399
you can if it's unauthenticated one then

433
00:15:02,399 --> 00:15:03,959
you can extract quite a lot of

434
00:15:03,959 --> 00:15:05,699
information by default but of course if

435
00:15:05,699 --> 00:15:07,079
for that you really need to know what

436
00:15:07,079 --> 00:15:09,420
SharePoint actually has available as an

437
00:15:09,420 --> 00:15:11,160
endpoint within SharePoint

438
00:15:11,160 --> 00:15:13,500
so first we're of course just verified

439
00:15:13,500 --> 00:15:16,980
if we can just try to enumerate the API

440
00:15:16,980 --> 00:15:20,399
rest API itself in this case like we're

441
00:15:20,399 --> 00:15:22,019
all referring to rest API V1 because

442
00:15:22,019 --> 00:15:24,240
SharePoint also supports multiple like

443
00:15:24,240 --> 00:15:26,699
um API versions in this case it was just

444
00:15:26,699 --> 00:15:29,519
using like rest API P1 so by just

445
00:15:29,519 --> 00:15:31,860
basically like visiting the website and

446
00:15:31,860 --> 00:15:33,600
then like forward slash underscore API

447
00:15:33,600 --> 00:15:35,880
we were presenting this wonderful XML

448
00:15:35,880 --> 00:15:38,639
response which contains like a few

449
00:15:38,639 --> 00:15:42,600
entries like default files hubsides and

450
00:15:42,600 --> 00:15:43,560
lists

451
00:15:43,560 --> 00:15:45,000
of course like files are also

452
00:15:45,000 --> 00:15:46,500
interesting but they also can implement

453
00:15:46,500 --> 00:15:48,000
the different like access controls on

454
00:15:48,000 --> 00:15:49,800
the specific endpoints of the interest

455
00:15:49,800 --> 00:15:51,600
API that some of the information might

456
00:15:51,600 --> 00:15:53,519
not be even like browsable like you

457
00:15:53,519 --> 00:15:56,100
can't even request it for that in this

458
00:15:56,100 --> 00:15:58,019
case like we return back to like okay

459
00:15:58,019 --> 00:15:59,940
what actually SharePoint is and what

460
00:15:59,940 --> 00:16:01,620
actually stores for example like not in

461
00:16:01,620 --> 00:16:04,199
a nice UI like functionality but

462
00:16:04,199 --> 00:16:05,880
actually in the rest API

463
00:16:05,880 --> 00:16:07,800
and in this case we went to of course

464
00:16:07,800 --> 00:16:10,440
like Microsoft we learned some stuff

465
00:16:10,440 --> 00:16:12,300
from them on the right side this is what

466
00:16:12,300 --> 00:16:14,459
I was presented like okay

467
00:16:14,459 --> 00:16:18,000
I read about it okay it's it looks quite

468
00:16:18,000 --> 00:16:20,639
um quite massive as well when you look

469
00:16:20,639 --> 00:16:22,320
at it and then like on the left side I

470
00:16:22,320 --> 00:16:24,240
just decided to summarize it for myself

471
00:16:24,240 --> 00:16:26,699
so you have like a SharePoint site which

472
00:16:26,699 --> 00:16:28,560
is like they also refer to it like a top

473
00:16:28,560 --> 00:16:30,300
level site which like for example you

474
00:16:30,300 --> 00:16:32,339
can refer to simple as the domain name

475
00:16:32,339 --> 00:16:33,839
and then they can have like multiple

476
00:16:33,839 --> 00:16:35,399
subsides let's say if you're a company

477
00:16:35,399 --> 00:16:37,860
that has multiple events and you also

478
00:16:37,860 --> 00:16:39,720
would like to use like a SharePoint to

479
00:16:39,720 --> 00:16:41,639
actually like basically pause the data

480
00:16:41,639 --> 00:16:43,500
from different events and for that you

481
00:16:43,500 --> 00:16:44,820
can use the subset function out of

482
00:16:44,820 --> 00:16:46,680
sharepoints for example like for event

483
00:16:46,680 --> 00:16:48,540
one you will have like top level site

484
00:16:48,540 --> 00:16:50,639
forward slash event one and then forward

485
00:16:50,639 --> 00:16:52,139
slash then it will be like collection of

486
00:16:52,139 --> 00:16:54,360
items for that specific event and then

487
00:16:54,360 --> 00:16:56,820
you can have as many sub sites as you

488
00:16:56,820 --> 00:16:58,680
want for that and you can also have

489
00:16:58,680 --> 00:17:00,000
different

490
00:17:00,000 --> 00:17:02,040
rest API permissions enforce on

491
00:17:02,040 --> 00:17:04,199
different subsides as well but for that

492
00:17:04,199 --> 00:17:06,959
for for like for like after the subside

493
00:17:06,959 --> 00:17:09,119
we go to lists so basically list is some

494
00:17:09,119 --> 00:17:11,280
kind of like an abstraction like it's a

495
00:17:11,280 --> 00:17:12,900
collection of items that can be bundled

496
00:17:12,900 --> 00:17:14,459
together for example assuming that you

497
00:17:14,459 --> 00:17:15,839
have a functionality on the website

498
00:17:15,839 --> 00:17:18,059
called contact us and then like a user

499
00:17:18,059 --> 00:17:19,980
basically supplies like full name

500
00:17:19,980 --> 00:17:22,260
contact details and then message that

501
00:17:22,260 --> 00:17:24,359
like why he wants to contact you and

502
00:17:24,359 --> 00:17:26,160
then in this case like there will be for

503
00:17:26,160 --> 00:17:27,900
example like a list created like or

504
00:17:27,900 --> 00:17:29,640
there will be a list and then once the

505
00:17:29,640 --> 00:17:31,980
user prints submit then the item a new

506
00:17:31,980 --> 00:17:33,720
item in that specific list will be

507
00:17:33,720 --> 00:17:34,740
created

508
00:17:34,740 --> 00:17:37,020
so and that's basically summarizes like

509
00:17:37,020 --> 00:17:38,940
this diagram on the left side so for

510
00:17:38,940 --> 00:17:40,200
like after list of course there will be

511
00:17:40,200 --> 00:17:42,000
items and every item will have in some

512
00:17:42,000 --> 00:17:43,380
kind of like properties for example like

513
00:17:43,380 --> 00:17:45,840
multiple Fields like a full name or like

514
00:17:45,840 --> 00:17:47,100
a contact details and then they will

515
00:17:47,100 --> 00:17:49,679
have like their own values so this is

516
00:17:49,679 --> 00:17:51,000
where like actually things are getting

517
00:17:51,000 --> 00:17:53,039
like really interesting for us

518
00:17:53,039 --> 00:17:55,679
so what about like okay how we can even

519
00:17:55,679 --> 00:17:58,140
like get to lists how we can even know

520
00:17:58,140 --> 00:17:59,580
what are the lists because for that like

521
00:17:59,580 --> 00:18:01,740
before if we want to extract some items

522
00:18:01,740 --> 00:18:03,900
or like the information from the list we

523
00:18:03,900 --> 00:18:07,140
need to know what are the lists so we

524
00:18:07,140 --> 00:18:08,640
did this engagement for multiple months

525
00:18:08,640 --> 00:18:10,740
so we came to it first time we just

526
00:18:10,740 --> 00:18:12,419
created this like APS like basically

527
00:18:12,419 --> 00:18:14,100
this endpoint called like underscore API

528
00:18:14,100 --> 00:18:17,280
for slash web lists it gave us lists we

529
00:18:17,280 --> 00:18:19,200
are happy we saved it and then like the

530
00:18:19,200 --> 00:18:21,240
company decided to change their website

531
00:18:21,240 --> 00:18:22,980
and then we came back again and then we

532
00:18:22,980 --> 00:18:24,480
got this error message

533
00:18:24,480 --> 00:18:27,360
so we like okay we lost it uh but then

534
00:18:27,360 --> 00:18:29,100
we just like decided to continue further

535
00:18:29,100 --> 00:18:31,140
looking like if we can still bypass this

536
00:18:31,140 --> 00:18:33,240
kind of issue because it like

537
00:18:33,240 --> 00:18:34,740
specifically says there's some some kind

538
00:18:34,740 --> 00:18:36,120
of like template was not installed a

539
00:18:36,120 --> 00:18:37,320
specific list

540
00:18:37,320 --> 00:18:38,820
and then we're like okay we're just

541
00:18:38,820 --> 00:18:40,440
gonna see if we can only extract The

542
00:18:40,440 --> 00:18:41,580
List names we don't because we don't

543
00:18:41,580 --> 00:18:43,080
need the rest of the data we only need

544
00:18:43,080 --> 00:18:45,120
to know List names to actually proceed

545
00:18:45,120 --> 00:18:48,059
further and dive deep into items so for

546
00:18:48,059 --> 00:18:50,100
that we just specified like Select Title

547
00:18:50,100 --> 00:18:51,900
parameter within the URL and we actually

548
00:18:51,900 --> 00:18:53,940
got what we wanted

549
00:18:53,940 --> 00:18:57,120
so it was like uh quite an easy bypass

550
00:18:57,120 --> 00:18:58,799
was basically just specifying what we

551
00:18:58,799 --> 00:18:59,940
actually need

552
00:18:59,940 --> 00:19:01,440
um and then later on we found out that

553
00:19:01,440 --> 00:19:03,720
you can actually also within the at

554
00:19:03,720 --> 00:19:05,760
least rest API the SharePoint you can

555
00:19:05,760 --> 00:19:07,679
also limit your search results as well

556
00:19:07,679 --> 00:19:08,940
for example by specifying like some

557
00:19:08,940 --> 00:19:11,280
filtering parameters or like by doing

558
00:19:11,280 --> 00:19:12,960
some kind of like a skipping or like a

559
00:19:12,960 --> 00:19:14,940
paging because for example if the site

560
00:19:14,940 --> 00:19:16,860
contains like thousands of lists you

561
00:19:16,860 --> 00:19:18,240
only maybe want them because of course

562
00:19:18,240 --> 00:19:19,980
they contain some usernames or passwords

563
00:19:19,980 --> 00:19:23,280
or like something something valuable

564
00:19:23,280 --> 00:19:24,780
um in this specific example on the right

565
00:19:24,780 --> 00:19:26,880
side you actually see that one of the

566
00:19:26,880 --> 00:19:28,500
lists one of the lists was actually

567
00:19:28,500 --> 00:19:31,080
referring to maintenance logs and

568
00:19:31,080 --> 00:19:32,820
imagine if you like if you have like

569
00:19:32,820 --> 00:19:34,980
sharepoints exposed to the internet then

570
00:19:34,980 --> 00:19:37,260
you have maintenance logs that are also

571
00:19:37,260 --> 00:19:38,520
exposed to the internet but we're like

572
00:19:38,520 --> 00:19:40,020
okay what it actually contains and

573
00:19:40,020 --> 00:19:42,240
actually if we can even extract them out

574
00:19:42,240 --> 00:19:44,640
from this uh from this list

575
00:19:44,640 --> 00:19:46,740
and then we looked like okay well let's

576
00:19:46,740 --> 00:19:48,720
just query uh what are the items within

577
00:19:48,720 --> 00:19:50,580
the list and cheat check what are the

578
00:19:50,580 --> 00:19:52,020
properties of these items so at least

579
00:19:52,020 --> 00:19:53,400
maybe you for example we'll see some

580
00:19:53,400 --> 00:19:55,679
reference to like some file we will see

581
00:19:55,679 --> 00:19:57,179
the logs themselves directly in within

582
00:19:57,179 --> 00:19:59,100
the item property and in this case

583
00:19:59,100 --> 00:20:00,840
basically like the way how you can

584
00:20:00,840 --> 00:20:02,340
actually get all items you need to

585
00:20:02,340 --> 00:20:05,640
specify like uh the search in the in the

586
00:20:05,640 --> 00:20:07,500
URL get by title and then you specify

587
00:20:07,500 --> 00:20:08,820
like the title name in this case like

588
00:20:08,820 --> 00:20:10,380
maintenance log and then you need to

589
00:20:10,380 --> 00:20:11,820
specify the item ID for example like

590
00:20:11,820 --> 00:20:14,460
items and between brexit file like one

591
00:20:14,460 --> 00:20:16,620
two three four whatever they're like the

592
00:20:16,620 --> 00:20:18,480
number of items are and then like you

593
00:20:18,480 --> 00:20:20,820
will get some some entries uh within

594
00:20:20,820 --> 00:20:22,320
them so in this case

595
00:20:22,320 --> 00:20:24,360
in the follow reference property of

596
00:20:24,360 --> 00:20:25,860
items in the maintenance lock it

597
00:20:25,860 --> 00:20:27,840
actually contains the URL to the file

598
00:20:27,840 --> 00:20:30,299
with the logs with the maintenance lock

599
00:20:30,299 --> 00:20:32,880
with like yes it can be it and then we

600
00:20:32,880 --> 00:20:34,200
browsed it and then we saw like the

601
00:20:34,200 --> 00:20:36,840
entire maintenance log of the SharePoint

602
00:20:36,840 --> 00:20:39,660
that they did like last year and we also

603
00:20:39,660 --> 00:20:41,520
saw like basically all usernames active

604
00:20:41,520 --> 00:20:43,620
directory name also all servers that are

605
00:20:43,620 --> 00:20:45,299
also related inside of the farm as well

606
00:20:45,299 --> 00:20:46,799
because the SharePoint Farm can contain

607
00:20:46,799 --> 00:20:49,080
multiple systems and they all share the

608
00:20:49,080 --> 00:20:50,520
same maintenance log

609
00:20:50,520 --> 00:20:52,740
and we're also like the opposite of the

610
00:20:52,740 --> 00:20:54,179
maintenance of there is also an error

611
00:20:54,179 --> 00:20:55,799
lock so if something goes wrong then

612
00:20:55,799 --> 00:20:57,780
there will be an error lock and guess

613
00:20:57,780 --> 00:21:00,240
what error lock was also exposed so we

614
00:21:00,240 --> 00:21:01,620
could also extract what actually went

615
00:21:01,620 --> 00:21:03,419
wrong and why and so we actually figured

616
00:21:03,419 --> 00:21:04,559
out that they didn't install a certain

617
00:21:04,559 --> 00:21:06,539
component right that was was also

618
00:21:06,539 --> 00:21:09,299
breaking for lists as well

619
00:21:09,299 --> 00:21:11,880
um so yeah and in this case to summarize

620
00:21:11,880 --> 00:21:13,919
what can actually go wrong with that of

621
00:21:13,919 --> 00:21:15,960
course like getting items like uh

622
00:21:15,960 --> 00:21:17,940
maintenance log learning about systems

623
00:21:17,940 --> 00:21:20,160
is really good it's like before you will

624
00:21:20,160 --> 00:21:21,720
actually start targeting the companies

625
00:21:21,720 --> 00:21:23,760
really good to know but is this

626
00:21:23,760 --> 00:21:25,440
something that you can even do further

627
00:21:25,440 --> 00:21:27,780
or at least try to even like get more

628
00:21:27,780 --> 00:21:30,299
like do more damage to the company and

629
00:21:30,299 --> 00:21:32,220
in this case it's actually it is

630
00:21:32,220 --> 00:21:34,320
possible so that specific company was

631
00:21:34,320 --> 00:21:35,760
using the SharePoint as I mentioned like

632
00:21:35,760 --> 00:21:38,220
for multiple like kind of like events

633
00:21:38,220 --> 00:21:40,080
and like different kind of like

634
00:21:40,080 --> 00:21:41,880
um also like corporate events and like

635
00:21:41,880 --> 00:21:44,100
public events and in this case like they

636
00:21:44,100 --> 00:21:45,840
were also using like feedback forms or

637
00:21:45,840 --> 00:21:47,940
like a submit partnership requests and

638
00:21:47,940 --> 00:21:49,740
like some like a lot of different like

639
00:21:49,740 --> 00:21:51,179
requests that you can just basically try

640
00:21:51,179 --> 00:21:53,220
to contact the company which we also try

641
00:21:53,220 --> 00:21:54,780
to you know contact the company but they

642
00:21:54,780 --> 00:21:57,360
never responded to us unfortunately but

643
00:21:57,360 --> 00:21:58,740
in this case

644
00:21:58,740 --> 00:22:01,320
um all these contact forms what we

645
00:22:01,320 --> 00:22:02,640
figured out later they were actually

646
00:22:02,640 --> 00:22:05,640
also lists represented in the rest API

647
00:22:05,640 --> 00:22:07,799
and every time when the person wanted to

648
00:22:07,799 --> 00:22:09,659
contact the company submitted the

649
00:22:09,659 --> 00:22:11,400
request then we could actually extract

650
00:22:11,400 --> 00:22:13,980
it back by the rest API in this case we

651
00:22:13,980 --> 00:22:15,659
saw like thousands of like contact

652
00:22:15,659 --> 00:22:17,820
requests also people describing like why

653
00:22:17,820 --> 00:22:19,860
they want to contact they were like pii

654
00:22:19,860 --> 00:22:21,419
and also some like quite sensitive

655
00:22:21,419 --> 00:22:22,740
financial information because they also

656
00:22:22,740 --> 00:22:24,840
wanted to kind of engage in like uh

657
00:22:24,840 --> 00:22:27,360
investment partnership as well in this

658
00:22:27,360 --> 00:22:30,600
case for us it was like no way

659
00:22:30,600 --> 00:22:32,340
um of course like next to that like you

660
00:22:32,340 --> 00:22:34,020
can extract like pi and very sensible

661
00:22:34,020 --> 00:22:35,340
information as well

662
00:22:35,340 --> 00:22:37,320
but what is also important to take into

663
00:22:37,320 --> 00:22:38,700
account that items in the SharePoint

664
00:22:38,700 --> 00:22:41,280
they also contain metadata and metadata

665
00:22:41,280 --> 00:22:42,720
in this case represents like some kind

666
00:22:42,720 --> 00:22:45,419
of like the the data that is

667
00:22:45,419 --> 00:22:46,860
um related for example like file

668
00:22:46,860 --> 00:22:48,780
creation like item creation and the

669
00:22:48,780 --> 00:22:51,299
author of the item and in this case we

670
00:22:51,299 --> 00:22:52,799
also like found that like active

671
00:22:52,799 --> 00:22:54,780
directory names users and also host

672
00:22:54,780 --> 00:22:56,340
names we've got some items they contain

673
00:22:56,340 --> 00:22:58,740
metadata that were pointing to specific

674
00:22:58,740 --> 00:23:01,080
location in the file share internally in

675
00:23:01,080 --> 00:23:03,360
like in the network we're like why are

676
00:23:03,360 --> 00:23:05,820
you doing this but yeah for us like it

677
00:23:05,820 --> 00:23:09,000
was like uh like yeah it was a disaster

678
00:23:09,000 --> 00:23:10,799
for them but for us it was like really

679
00:23:10,799 --> 00:23:12,480
uh really interesting just you know dive

680
00:23:12,480 --> 00:23:13,740
in and figure out the entire structure

681
00:23:13,740 --> 00:23:16,220
of the SharePoint

682
00:23:16,440 --> 00:23:18,240
okay when I use your clickers as well

683
00:23:18,240 --> 00:23:19,559
just because I have a couple of slides

684
00:23:19,559 --> 00:23:22,140
okay thanks one so

685
00:23:22,140 --> 00:23:24,419
um a lot of information was pulled at a

686
00:23:24,419 --> 00:23:26,280
SharePoint but it didn't find us a way

687
00:23:26,280 --> 00:23:28,380
in specifically

688
00:23:28,380 --> 00:23:30,720
um there could have been an Avenue if we

689
00:23:30,720 --> 00:23:33,360
weren't let's say ethical because we did

690
00:23:33,360 --> 00:23:35,220
find the developers who created the site

691
00:23:35,220 --> 00:23:36,720
and we could have found a path through

692
00:23:36,720 --> 00:23:38,820
them to kind of

693
00:23:38,820 --> 00:23:41,280
let's say supply chain style but

694
00:23:41,280 --> 00:23:42,659
um it wasn't in scope we had to Target

695
00:23:42,659 --> 00:23:44,100
these guys

696
00:23:44,100 --> 00:23:45,780
um we got a lot of information out but

697
00:23:45,780 --> 00:23:48,179
not enough for us to get in okay but

698
00:23:48,179 --> 00:23:50,460
stuff that we can use to leverage at

699
00:23:50,460 --> 00:23:51,840
least we thought we could leverage the

700
00:23:51,840 --> 00:23:53,520
information it kind of backfired in our

701
00:23:53,520 --> 00:23:57,059
face but the next thing to do is

702
00:23:57,059 --> 00:23:59,520
prepare payloads all right so we had a

703
00:23:59,520 --> 00:24:00,960
look at SharePoint we spent quite a bit

704
00:24:00,960 --> 00:24:02,580
of time on SharePoint we pulled out some

705
00:24:02,580 --> 00:24:04,799
some juicy information some information

706
00:24:04,799 --> 00:24:06,480
which for sure would definitely shock

707
00:24:06,480 --> 00:24:08,340
them and if they had any kind of auditor

708
00:24:08,340 --> 00:24:10,740
compliance it would definitely have an

709
00:24:10,740 --> 00:24:13,200
impact but we need to keep going right

710
00:24:13,200 --> 00:24:14,760
so the momentum is still there let's

711
00:24:14,760 --> 00:24:16,200
start working on payloads let's start

712
00:24:16,200 --> 00:24:18,480
generating payloads let's think about

713
00:24:18,480 --> 00:24:21,179
attack venues phishing

714
00:24:21,179 --> 00:24:22,620
um what do we do with phishing how do we

715
00:24:22,620 --> 00:24:24,000
target them how do we make them click

716
00:24:24,000 --> 00:24:25,679
what's available out there what have we

717
00:24:25,679 --> 00:24:26,940
seen before in the past that we could

718
00:24:26,940 --> 00:24:30,900
reuse today so when it comes to creating

719
00:24:30,900 --> 00:24:32,580
payloads

720
00:24:32,580 --> 00:24:34,380
um we have different payloads that we

721
00:24:34,380 --> 00:24:36,419
use depending on the OS synth that we've

722
00:24:36,419 --> 00:24:38,640
seen so if we're going to use an HTA

723
00:24:38,640 --> 00:24:40,140
we'll probably smuggle it through an

724
00:24:40,140 --> 00:24:42,120
HTML so the JavaScript will download the

725
00:24:42,120 --> 00:24:45,960
HTA and run it we know now that OneNote

726
00:24:45,960 --> 00:24:49,400
is is being exploited everywhere

727
00:24:49,400 --> 00:24:54,120
Ms access you can go with macros they're

728
00:24:54,120 --> 00:24:56,039
a bit old school they're a bit done in

729
00:24:56,039 --> 00:24:57,720
my in my in my view

730
00:24:57,720 --> 00:25:00,179
um not many people accept macros but if

731
00:25:00,179 --> 00:25:01,320
you have something that was somewhere

732
00:25:01,320 --> 00:25:03,480
where you can upload a file then a macro

733
00:25:03,480 --> 00:25:05,820
why not if you're doing a CV for for

734
00:25:05,820 --> 00:25:07,799
recruitment or something like that one

735
00:25:07,799 --> 00:25:09,179
thing we need to consider is putting in

736
00:25:09,179 --> 00:25:10,679
guard rails because a lot of companies

737
00:25:10,679 --> 00:25:13,260
today have edrs xdrs all these kind of

738
00:25:13,260 --> 00:25:15,480
technologies that do sandboxing or do

739
00:25:15,480 --> 00:25:16,980
testing or execution of the actual

740
00:25:16,980 --> 00:25:19,559
payload so if we can put in guard rails

741
00:25:19,559 --> 00:25:21,900
then we can hopefully have a Fighting

742
00:25:21,900 --> 00:25:24,299
Chance of of still trying to get in so

743
00:25:24,299 --> 00:25:26,520
what we typically do is try and find a

744
00:25:26,520 --> 00:25:28,200
piece of information which relates to

745
00:25:28,200 --> 00:25:30,179
that company something like a domain

746
00:25:30,179 --> 00:25:31,559
name something like that and we use that

747
00:25:31,559 --> 00:25:34,559
as a guard rail so basically sandboxes

748
00:25:34,559 --> 00:25:37,380
are not typically domain joined so the

749
00:25:37,380 --> 00:25:38,640
first thing it does is it checks are you

750
00:25:38,640 --> 00:25:42,120
domain joined if yes continue if no die

751
00:25:42,120 --> 00:25:45,240
right so so that's that's one aspect

752
00:25:45,240 --> 00:25:47,520
then we also create one or two payloads

753
00:25:47,520 --> 00:25:48,960
which don't have the guard rails because

754
00:25:48,960 --> 00:25:50,880
we actually want to see if there's a

755
00:25:50,880 --> 00:25:52,260
technology stack and what it's doing and

756
00:25:52,260 --> 00:25:54,120
how does it connect back to us

757
00:25:54,120 --> 00:25:55,260
um there are quite a few ways of

758
00:25:55,260 --> 00:25:58,740
figuring out into internal fqdns and so

759
00:25:58,740 --> 00:26:02,159
on Research uh you know just OS synth

760
00:26:02,159 --> 00:26:03,779
will find it for you here's an example

761
00:26:03,779 --> 00:26:06,600
of an nmap and a c script which anyone

762
00:26:06,600 --> 00:26:09,179
can run so the idea is we've built a

763
00:26:09,179 --> 00:26:11,100
bunch of payloads now and now we want to

764
00:26:11,100 --> 00:26:12,720
go on to the fishing side

765
00:26:12,720 --> 00:26:16,020
so before we go into the fishing I want

766
00:26:16,020 --> 00:26:19,400
to try and make this a bit Interactive

767
00:26:19,740 --> 00:26:22,559
if you were to Target me for example or

768
00:26:22,559 --> 00:26:24,120
if I was to Target you

769
00:26:24,120 --> 00:26:25,860
let's say you come into the office on a

770
00:26:25,860 --> 00:26:27,659
Monday morning nine o'clock you have

771
00:26:27,659 --> 00:26:30,240
your coffees you have more coffees

772
00:26:30,240 --> 00:26:31,919
maybe cigarette if you smoke come back

773
00:26:31,919 --> 00:26:33,720
have more coffees 10 o'clock you decide

774
00:26:33,720 --> 00:26:35,220
okay I think it's time to do some work

775
00:26:35,220 --> 00:26:37,380
you open up your outlook so whatever you

776
00:26:37,380 --> 00:26:40,380
use you have a ton of emails

777
00:26:40,380 --> 00:26:42,179
what topic is going to make you click

778
00:26:42,179 --> 00:26:45,120
first so me as a Fisher I'm trying to

779
00:26:45,120 --> 00:26:48,299
fish you what topic works well to get

780
00:26:48,299 --> 00:26:50,900
you to click

781
00:26:51,600 --> 00:26:54,120
management okay so hierarchy is someone

782
00:26:54,120 --> 00:26:56,340
who's your manager contacting you that

783
00:26:56,340 --> 00:26:58,380
will work anything else any topics

784
00:26:58,380 --> 00:27:00,600
specifically that uh would get your

785
00:27:00,600 --> 00:27:02,220
attention

786
00:27:02,220 --> 00:27:05,820
Hobbies okay Hobbies

787
00:27:05,820 --> 00:27:07,159
security security

788
00:27:07,159 --> 00:27:09,659
alert we actually use that one so that's

789
00:27:09,659 --> 00:27:11,820
cool yeah

790
00:27:11,820 --> 00:27:15,059
money everyone loves money

791
00:27:15,059 --> 00:27:16,380
if you don't

792
00:27:16,380 --> 00:27:18,960
you're lying so

793
00:27:18,960 --> 00:27:21,059
um everyone loves money and targeting

794
00:27:21,059 --> 00:27:23,400
sales people about money is even better

795
00:27:23,400 --> 00:27:25,860
because sales people love money more

796
00:27:25,860 --> 00:27:28,260
than you so it's all about commissions

797
00:27:28,260 --> 00:27:30,120
and meeting their targets and so on so

798
00:27:30,120 --> 00:27:33,419
money and holidays right these are the

799
00:27:33,419 --> 00:27:36,059
two that we always go for I mean sure if

800
00:27:36,059 --> 00:27:38,100
there's a pandemic going on like covid

801
00:27:38,100 --> 00:27:39,659
you can use that if there's a new PCR

802
00:27:39,659 --> 00:27:41,700
update and so on you can use that but

803
00:27:41,700 --> 00:27:43,679
people click on money especially now

804
00:27:43,679 --> 00:27:45,059
where the world is going through a tough

805
00:27:45,059 --> 00:27:47,460
time and you know recessions and Credit

806
00:27:47,460 --> 00:27:51,480
Suisse and I don't know what and SVP svb

807
00:27:51,480 --> 00:27:52,980
um you know if you're offering someone a

808
00:27:52,980 --> 00:27:54,600
promotion if you're offering so if

809
00:27:54,600 --> 00:27:55,740
you're saying that people are gonna get

810
00:27:55,740 --> 00:27:58,260
fired if you're got you know your your

811
00:27:58,260 --> 00:28:00,480
new salary request your new performance

812
00:28:00,480 --> 00:28:02,340
review your anything to do with money

813
00:28:02,340 --> 00:28:05,400
anything to do with money it's a winner

814
00:28:05,400 --> 00:28:06,179
um

815
00:28:06,179 --> 00:28:07,980
so these are the ones that we look at

816
00:28:07,980 --> 00:28:10,679
I.T security we use that we use that as

817
00:28:10,679 --> 00:28:12,779
a last kind of campaign so what we do is

818
00:28:12,779 --> 00:28:15,240
try and make some noise expect the

819
00:28:15,240 --> 00:28:17,820
company to contact the employees and say

820
00:28:17,820 --> 00:28:20,340
guys be careful of we've been targeted

821
00:28:20,340 --> 00:28:22,380
as part of uh something or other and

822
00:28:22,380 --> 00:28:25,220
then we come in as we're I.T security

823
00:28:25,220 --> 00:28:27,779
well done so far by the way here's the

824
00:28:27,779 --> 00:28:29,400
new patch that you need to install and

825
00:28:29,400 --> 00:28:32,220
we have a you know an MSI or an ISO you

826
00:28:32,220 --> 00:28:33,539
know whatever

827
00:28:33,539 --> 00:28:36,720
so other ways I don't know if it's clear

828
00:28:36,720 --> 00:28:38,700
other ways that you can get around are

829
00:28:38,700 --> 00:28:41,580
using things or subscription services so

830
00:28:41,580 --> 00:28:43,200
instead of you going and purchasing a

831
00:28:43,200 --> 00:28:45,659
domain which looks like your your target

832
00:28:45,659 --> 00:28:47,880
domain or creating a subdomain which

833
00:28:47,880 --> 00:28:49,559
looks like your target domain and then

834
00:28:49,559 --> 00:28:51,419
categorizing it and waiting because they

835
00:28:51,419 --> 00:28:52,740
have a proof point which is going to say

836
00:28:52,740 --> 00:28:54,600
that this domain is still new it's going

837
00:28:54,600 --> 00:28:55,860
to go to spam it's not going to go

838
00:28:55,860 --> 00:28:57,600
through you can use all kinds of

839
00:28:57,600 --> 00:28:59,580
existing Services out there so for

840
00:28:59,580 --> 00:29:02,100
example uh DocuSign go create an account

841
00:29:02,100 --> 00:29:04,200
it's cheap and then send emails from

842
00:29:04,200 --> 00:29:06,179
DocuSign because it comes from DocuSign

843
00:29:06,179 --> 00:29:07,860
chances are everyone in your company

844
00:29:07,860 --> 00:29:10,580
uses DocuSign to sign contracts WebEx

845
00:29:10,580 --> 00:29:13,320
any of these kind of systems

846
00:29:13,320 --> 00:29:15,360
they seem to work right because people

847
00:29:15,360 --> 00:29:18,120
expect them people know about them if

848
00:29:18,120 --> 00:29:19,559
it's something about tax if it's

849
00:29:19,559 --> 00:29:21,000
something about your money is but

850
00:29:21,000 --> 00:29:22,559
something about bonuses if it's

851
00:29:22,559 --> 00:29:24,539
something about anything use all of

852
00:29:24,539 --> 00:29:26,100
those for the last one there you have to

853
00:29:26,100 --> 00:29:27,779
verify first that they're using G Suite

854
00:29:27,779 --> 00:29:30,360
or you know if they're using 0365 or

855
00:29:30,360 --> 00:29:32,880
whatever it is but the phishing aspect

856
00:29:32,880 --> 00:29:35,039
is important because that's what makes

857
00:29:35,039 --> 00:29:37,320
someone click for us it's frustrating

858
00:29:37,320 --> 00:29:39,480
when we send a phishing email

859
00:29:39,480 --> 00:29:43,020
let's say we target 10 people and we

860
00:29:43,020 --> 00:29:44,760
send 10 phishing emails and nothing

861
00:29:44,760 --> 00:29:45,899
comes back

862
00:29:45,899 --> 00:29:48,360
we we have no clue what's going on

863
00:29:48,360 --> 00:29:49,740
because we can't ask you know did you

864
00:29:49,740 --> 00:29:51,360
guys get the email we can't we're we're

865
00:29:51,360 --> 00:29:55,860
blind right so did their perimeter email

866
00:29:55,860 --> 00:29:59,220
gateways detect us block us maybe that

867
00:29:59,220 --> 00:30:01,380
is the awareness of the people in the

868
00:30:01,380 --> 00:30:03,000
companies that damn good that no one

869
00:30:03,000 --> 00:30:06,059
clicked maybe unlikely but maybe

870
00:30:06,059 --> 00:30:08,460
um what is it what's happening did the

871
00:30:08,460 --> 00:30:10,020
email arrive in their inbox but they're

872
00:30:10,020 --> 00:30:11,159
going for coffee and they don't really

873
00:30:11,159 --> 00:30:14,520
care you know so we have no clue of of

874
00:30:14,520 --> 00:30:15,960
knowing these these types of things and

875
00:30:15,960 --> 00:30:17,580
that's where we need to get a bit

876
00:30:17,580 --> 00:30:20,039
inventive and just know are our emails

877
00:30:20,039 --> 00:30:22,440
getting through so sending benign emails

878
00:30:22,440 --> 00:30:24,299
just a stupid request for for

879
00:30:24,299 --> 00:30:26,640
information just to try and get any kind

880
00:30:26,640 --> 00:30:27,960
of relationship or any kind of

881
00:30:27,960 --> 00:30:29,580
communication with them which is

882
00:30:29,580 --> 00:30:30,899
important as well because if they

883
00:30:30,899 --> 00:30:32,279
respond back to you

884
00:30:32,279 --> 00:30:33,899
chances are they're gonna have their

885
00:30:33,899 --> 00:30:37,620
signature their um the logo of their

886
00:30:37,620 --> 00:30:39,659
company the banner the disclaimer the

887
00:30:39,659 --> 00:30:41,340
font so now you know all the stuff so if

888
00:30:41,340 --> 00:30:42,539
you want to do any kind of attacks you

889
00:30:42,539 --> 00:30:44,520
can do that as well one that we used

890
00:30:44,520 --> 00:30:47,760
recently was Canary tokens so we create

891
00:30:47,760 --> 00:30:49,679
a Word document

892
00:30:49,679 --> 00:30:52,740
blank nothing on it we don't really care

893
00:30:52,740 --> 00:30:55,320
um and we send it to the info at or the

894
00:30:55,320 --> 00:30:57,659
distribution groups that you have and to

895
00:30:57,659 --> 00:30:59,279
specific people that we're trying to see

896
00:30:59,279 --> 00:31:01,140
you know where are you in the world

897
00:31:01,140 --> 00:31:02,760
because maybe we're sending a phishing

898
00:31:02,760 --> 00:31:04,980
email at you know 9am thinking that

899
00:31:04,980 --> 00:31:06,179
they're going to get it at 9am but

900
00:31:06,179 --> 00:31:07,919
they're actually in the US so it's like

901
00:31:07,919 --> 00:31:09,899
you know 4 a.m for them

902
00:31:09,899 --> 00:31:12,120
so when the canary tokens come back then

903
00:31:12,120 --> 00:31:14,100
you have an idea okay most of these guys

904
00:31:14,100 --> 00:31:15,899
are in the US but there's a large chunk

905
00:31:15,899 --> 00:31:17,880
who are in France for example so now we

906
00:31:17,880 --> 00:31:19,020
know that if we're doing a phishing

907
00:31:19,020 --> 00:31:20,940
campaign these are the hours that we

908
00:31:20,940 --> 00:31:22,380
should be you know launching these these

909
00:31:22,380 --> 00:31:23,760
types of campaigns

910
00:31:23,760 --> 00:31:25,919
in terms of luck

911
00:31:25,919 --> 00:31:28,260
um you need a bit of luck always some of

912
00:31:28,260 --> 00:31:29,760
the things that we found on the web are

913
00:31:29,760 --> 00:31:31,679
applications where you can actually use

914
00:31:31,679 --> 00:31:34,260
the company system to Target internal

915
00:31:34,260 --> 00:31:36,960
employees so for us we don't care about

916
00:31:36,960 --> 00:31:39,299
buying a domain name categorizing it

917
00:31:39,299 --> 00:31:41,940
making it look and feel legit

918
00:31:41,940 --> 00:31:43,980
um we can use their services so this is

919
00:31:43,980 --> 00:31:45,480
an example of one of course we've hidden

920
00:31:45,480 --> 00:31:47,700
the names where you could send a message

921
00:31:47,700 --> 00:31:50,820
like a referral internally and it comes

922
00:31:50,820 --> 00:31:52,559
from the company and it goes internal to

923
00:31:52,559 --> 00:31:54,240
to their users so it looks like an

924
00:31:54,240 --> 00:31:56,100
internal email none of these you know

925
00:31:56,100 --> 00:31:57,960
beware this message came from the

926
00:31:57,960 --> 00:32:00,480
outside or this is purely internal and

927
00:32:00,480 --> 00:32:02,100
for a blue team or an incident responder

928
00:32:02,100 --> 00:32:03,899
good luck tracking it down it's a

929
00:32:03,899 --> 00:32:06,360
headache so what we do is we host our

930
00:32:06,360 --> 00:32:08,580
payloads you can put it on a SharePoint

931
00:32:08,580 --> 00:32:11,520
you can put it your SharePoint we can

932
00:32:11,520 --> 00:32:12,779
put it on

933
00:32:12,779 --> 00:32:15,299
um Azure so Azure blob storage something

934
00:32:15,299 --> 00:32:16,320
like that something with a high

935
00:32:16,320 --> 00:32:18,179
reputation and then just send them a

936
00:32:18,179 --> 00:32:19,380
message tell them here's your

937
00:32:19,380 --> 00:32:20,940
performance review here's your salary

938
00:32:20,940 --> 00:32:22,980
here's your any of those buzzwords

939
00:32:22,980 --> 00:32:25,860
holiday new holidays whatever

940
00:32:25,860 --> 00:32:28,380
and it goes internally it goes like an

941
00:32:28,380 --> 00:32:30,240
email internally from the inside there's

942
00:32:30,240 --> 00:32:32,460
no outside check the Exchange Server who

943
00:32:32,460 --> 00:32:33,779
sent the

944
00:32:33,779 --> 00:32:36,720
it's it's it's a pain in the ass for

945
00:32:36,720 --> 00:32:38,520
them to find out how the hell to figure

946
00:32:38,520 --> 00:32:40,740
this out

947
00:32:40,740 --> 00:32:43,320
are the ones that we've seen are forms

948
00:32:43,320 --> 00:32:45,720
online where you can upload documents so

949
00:32:45,720 --> 00:32:47,580
what we typically do is we say let's

950
00:32:47,580 --> 00:32:49,140
just generate a whole bunch of payloads

951
00:32:49,140 --> 00:32:51,480
and then just attach all and send and

952
00:32:51,480 --> 00:32:53,760
see what comes back because we know when

953
00:32:53,760 --> 00:32:55,860
when a Sandbox connects to one of our

954
00:32:55,860 --> 00:32:58,440
payloads based on when it connects to us

955
00:32:58,440 --> 00:32:59,940
we know that this is this specific

956
00:32:59,940 --> 00:33:03,120
payload based on uh the actual process

957
00:33:03,120 --> 00:33:04,799
itself so we know this is this payload

958
00:33:04,799 --> 00:33:06,960
this is that payloads and so on we've

959
00:33:06,960 --> 00:33:08,279
seen ones where you can leave a message

960
00:33:08,279 --> 00:33:10,620
and then again upload a whole bunch of

961
00:33:10,620 --> 00:33:13,620
uh file formats we've seen this many

962
00:33:13,620 --> 00:33:15,120
times we've seen ones where you can

963
00:33:15,120 --> 00:33:16,620
actually put in

964
00:33:16,620 --> 00:33:19,440
an email address of the victim

965
00:33:19,440 --> 00:33:21,960
using their site right instead of

966
00:33:21,960 --> 00:33:23,279
putting your own information so that

967
00:33:23,279 --> 00:33:24,600
they contact you you put in the actual

968
00:33:24,600 --> 00:33:26,279
victim and it sends an email internally

969
00:33:26,279 --> 00:33:28,380
beautiful you don't have to worry about

970
00:33:28,380 --> 00:33:30,899
any of the stuff and they contract trace

971
00:33:30,899 --> 00:33:32,460
it back to you

972
00:33:32,460 --> 00:33:34,320
and then you get really lucky sometimes

973
00:33:34,320 --> 00:33:36,179
where you know you get things like this

974
00:33:36,179 --> 00:33:38,220
where it asks you for your name and for

975
00:33:38,220 --> 00:33:39,899
where it's gonna go so you put in of

976
00:33:39,899 --> 00:33:41,640
course someone from the company and then

977
00:33:41,640 --> 00:33:43,500
someone else from the same company and

978
00:33:43,500 --> 00:33:46,380
then they are none the wiser

979
00:33:46,380 --> 00:33:48,480
in the case for us

980
00:33:48,480 --> 00:33:50,399
um when we when we did those kind of

981
00:33:50,399 --> 00:33:52,919
file uploads we got a whole bunch of

982
00:33:52,919 --> 00:33:54,480
sandboxes coming back as marath

983
00:33:54,480 --> 00:33:56,700
mentioned we use cobal strike but we

984
00:33:56,700 --> 00:33:58,380
customize it of course we have malleable

985
00:33:58,380 --> 00:34:01,200
profiles and uh Beacon object files the

986
00:34:01,200 --> 00:34:03,059
things that we use for for for our

987
00:34:03,059 --> 00:34:05,519
campaigns but regardless we got

988
00:34:05,519 --> 00:34:07,320
sandboxes and typically we don't

989
00:34:07,320 --> 00:34:08,879
interact with sandboxes because there's

990
00:34:08,879 --> 00:34:10,918
no point they last for 60 seconds and

991
00:34:10,918 --> 00:34:12,780
they die but in this case here we just

992
00:34:12,780 --> 00:34:15,300
took one screenshot just because

993
00:34:15,300 --> 00:34:18,359
we said what the hell why not so

994
00:34:18,359 --> 00:34:19,440
um

995
00:34:19,440 --> 00:34:21,918
having

996
00:34:22,379 --> 00:34:24,179
stuck with the SharePoint getting

997
00:34:24,179 --> 00:34:25,800
information out but not being able to

998
00:34:25,800 --> 00:34:28,080
get deeper in then going for the fishing

999
00:34:28,080 --> 00:34:30,659
we got a whole bunch of sandboxes in we

1000
00:34:30,659 --> 00:34:32,760
said let's try something a bit strange

1001
00:34:32,760 --> 00:34:35,280
which is going to LinkedIn finding out

1002
00:34:35,280 --> 00:34:37,500
who are the I.T people involved in this

1003
00:34:37,500 --> 00:34:40,679
company and targeting them right so what

1004
00:34:40,679 --> 00:34:42,960
are we going to do is take a snippet of

1005
00:34:42,960 --> 00:34:44,460
information that marath has pulled out

1006
00:34:44,460 --> 00:34:46,800
from SharePoint fuzz it a little bit

1007
00:34:46,800 --> 00:34:49,679
make it look a bit dark and then send it

1008
00:34:49,679 --> 00:34:52,619
to those uh it people on LinkedIn and

1009
00:34:52,619 --> 00:34:54,300
basically saying hi I'm a security

1010
00:34:54,300 --> 00:34:55,739
researcher of course we have a fake

1011
00:34:55,739 --> 00:34:58,020
profile hi I'm a security researcher I

1012
00:34:58,020 --> 00:34:59,520
found information about your company on

1013
00:34:59,520 --> 00:35:01,680
the dark web it is for sale all right

1014
00:35:01,680 --> 00:35:04,020
you should look at this

1015
00:35:04,020 --> 00:35:06,180
the first guy ignored us completely

1016
00:35:06,180 --> 00:35:08,580
actually he blocked me so that was a

1017
00:35:08,580 --> 00:35:11,040
waste then I found another one and we

1018
00:35:11,040 --> 00:35:12,540
said the same thing and he responded

1019
00:35:12,540 --> 00:35:14,579
back saying who are you so I thought

1020
00:35:14,579 --> 00:35:15,960
okay we'll put a bit of pressure on him

1021
00:35:15,960 --> 00:35:18,720
we'll say we found some some information

1022
00:35:18,720 --> 00:35:20,940
about your company it's being sold on

1023
00:35:20,940 --> 00:35:23,339
the dark web here's an example of it if

1024
00:35:23,339 --> 00:35:25,260
you do not tell your management right

1025
00:35:25,260 --> 00:35:27,119
now then when this thing gets published

1026
00:35:27,119 --> 00:35:28,980
you're gonna be the one that's that the

1027
00:35:28,980 --> 00:35:30,720
Fall Guy because I'm telling you it's

1028
00:35:30,720 --> 00:35:33,440
there so it's on you and what did he do

1029
00:35:33,440 --> 00:35:37,560
ignored me so uh

1030
00:35:37,560 --> 00:35:39,720
it didn't work so I'll hand over to you

1031
00:35:39,720 --> 00:35:41,339
so basically trying to do the

1032
00:35:41,339 --> 00:35:43,800
exploitation part as complex as it was

1033
00:35:43,800 --> 00:35:46,380
we couldn't get that on that that you

1034
00:35:46,380 --> 00:35:48,359
know direct link in no one clicked on

1035
00:35:48,359 --> 00:35:50,280
that specific link and that payload was

1036
00:35:50,280 --> 00:35:52,200
getting sandboxed and so on the other

1037
00:35:52,200 --> 00:35:53,700
sandboxes didn't come because we had

1038
00:35:53,700 --> 00:35:55,200
guard rails so they didn't connect back

1039
00:35:55,200 --> 00:35:57,060
to us they just died so we thought okay

1040
00:35:57,060 --> 00:35:59,760
we need to step back a bit and I'll give

1041
00:35:59,760 --> 00:36:02,000
you this phenomenon I'll step back yeah

1042
00:36:02,000 --> 00:36:04,500
so yeah we decided to basically do one

1043
00:36:04,500 --> 00:36:06,960
step back and see what we've missed um

1044
00:36:06,960 --> 00:36:08,040
because Healthcare of course like

1045
00:36:08,040 --> 00:36:10,440
SharePoint was a really good point for

1046
00:36:10,440 --> 00:36:11,160
us

1047
00:36:11,160 --> 00:36:13,260
um to to get the information that um

1048
00:36:13,260 --> 00:36:15,540
that was actually out there and just

1049
00:36:15,540 --> 00:36:17,520
basically come and collect us but like

1050
00:36:17,520 --> 00:36:19,500
we really wanted to get in and from the

1051
00:36:19,500 --> 00:36:20,880
fishing aspect I think we tried like

1052
00:36:20,880 --> 00:36:23,280
multiple campaigns like just literally

1053
00:36:23,280 --> 00:36:25,980
nothing so we were a bit like yeah there

1054
00:36:25,980 --> 00:36:27,180
should be something like if SharePoint

1055
00:36:27,180 --> 00:36:28,680
is misconfigured maybe we just missed

1056
00:36:28,680 --> 00:36:30,599
something so we returned back and we

1057
00:36:30,599 --> 00:36:33,060
decided to go for like more

1058
00:36:33,060 --> 00:36:35,339
um like uh Advanced or like a deep deep

1059
00:36:35,339 --> 00:36:38,099
scan of their external like facing

1060
00:36:38,099 --> 00:36:40,320
perimeter so we just used like basically

1061
00:36:40,320 --> 00:36:42,300
launched nuclei scans like just to

1062
00:36:42,300 --> 00:36:44,220
Target like specific like web uh web

1063
00:36:44,220 --> 00:36:46,200
Technologies in this case like it

1064
00:36:46,200 --> 00:36:47,640
actually I've found like a lot of

1065
00:36:47,640 --> 00:36:49,500
Wordpress sites as well uh because well

1066
00:36:49,500 --> 00:36:51,359
WordPress is one of the most popular CMS

1067
00:36:51,359 --> 00:36:53,160
systems out there to close the website

1068
00:36:53,160 --> 00:36:56,520
and they were also using it as well uh

1069
00:36:56,520 --> 00:36:59,040
and yeah we found like uh we found like

1070
00:36:59,040 --> 00:37:00,180
multiple sites with multiple

1071
00:37:00,180 --> 00:37:01,560
vulnerabilities of course like I think

1072
00:37:01,560 --> 00:37:03,720
the the most common vulnerability within

1073
00:37:03,720 --> 00:37:05,760
the WordPress is actually some some one

1074
00:37:05,760 --> 00:37:08,040
of the plugins or like a few plugins uh

1075
00:37:08,040 --> 00:37:09,540
that will allow you either like to just

1076
00:37:09,540 --> 00:37:11,520
like get information from the server or

1077
00:37:11,520 --> 00:37:12,960
basically like maybe to do some kind of

1078
00:37:12,960 --> 00:37:15,720
like SQL injection or ssrf and something

1079
00:37:15,720 --> 00:37:17,400
but we were looking for like through

1080
00:37:17,400 --> 00:37:18,780
through the list of like identified

1081
00:37:18,780 --> 00:37:20,520
vulnerabilities and we actually wanted

1082
00:37:20,520 --> 00:37:22,500
to see if there's something that can

1083
00:37:22,500 --> 00:37:24,180
actually give us like RC on the server

1084
00:37:24,180 --> 00:37:26,400
because looking like if they have so

1085
00:37:26,400 --> 00:37:28,260
many WordPress systems exposed with a

1086
00:37:28,260 --> 00:37:29,700
lot of vulnerable plugins they should be

1087
00:37:29,700 --> 00:37:32,640
something that will actually let us in

1088
00:37:32,640 --> 00:37:35,640
um so nuclei actually helps it has a lot

1089
00:37:35,640 --> 00:37:38,160
of default uh checks within like out of

1090
00:37:38,160 --> 00:37:40,020
the box installation actually if you can

1091
00:37:40,020 --> 00:37:41,760
find a lot of CVS within WordPress as

1092
00:37:41,760 --> 00:37:43,740
well and the one that they found for us

1093
00:37:43,740 --> 00:37:46,500
it was actually related to um like a

1094
00:37:46,500 --> 00:37:48,660
fancy product designer plugin

1095
00:37:48,660 --> 00:37:51,480
like I've never heard about it before

1096
00:37:51,480 --> 00:37:53,700
of course like one once you see okay CVS

1097
00:37:53,700 --> 00:37:55,440
found the first thing within WordPress

1098
00:37:55,440 --> 00:37:57,480
what you do you just go to VP scan VP

1099
00:37:57,480 --> 00:37:59,520
scan is like a tool that like it's it's

1100
00:37:59,520 --> 00:38:00,900
also like a website that has like a

1101
00:38:00,900 --> 00:38:02,700
collection of vulnerabilities found

1102
00:38:02,700 --> 00:38:04,920
within the WordPress and of course

1103
00:38:04,920 --> 00:38:06,599
sometimes they have like a like a bit of

1104
00:38:06,599 --> 00:38:08,820
a disclosure like how to how to exploit

1105
00:38:08,820 --> 00:38:11,099
it or like how to abuse it but in in

1106
00:38:11,099 --> 00:38:13,320
this case there was a literally like the

1107
00:38:13,320 --> 00:38:15,000
message from the like the researcher

1108
00:38:15,000 --> 00:38:16,619
that found it like it just basically won

1109
00:38:16,619 --> 00:38:18,960
post request how to exploit it and

1110
00:38:18,960 --> 00:38:20,339
that's like a lot of texts okay you

1111
00:38:20,339 --> 00:38:21,720
should do these you should do that and

1112
00:38:21,720 --> 00:38:24,359
then you can just exploit it uh and then

1113
00:38:24,359 --> 00:38:26,040
we're like okay well if for us it was

1114
00:38:26,040 --> 00:38:27,540
already enough to see like okay if

1115
00:38:27,540 --> 00:38:29,339
someone already did it there is a POC

1116
00:38:29,339 --> 00:38:31,320
guy in the POC then we can just try it

1117
00:38:31,320 --> 00:38:35,339
ourselves so like first like what boc

1118
00:38:35,339 --> 00:38:36,599
mentioned like okay you need to verify

1119
00:38:36,599 --> 00:38:38,640
that this specific endpoint within the

1120
00:38:38,640 --> 00:38:40,140
plugin is accessible

1121
00:38:40,140 --> 00:38:42,300
which which we did so it returns like

1122
00:38:42,300 --> 00:38:43,560
okay you need to define the directory

1123
00:38:43,560 --> 00:38:45,359
when you where you want to upload what

1124
00:38:45,359 --> 00:38:47,820
where you want to upon an image

1125
00:38:47,820 --> 00:38:49,200
um in this case like this specific

1126
00:38:49,200 --> 00:38:51,240
vulnerability allows actually to upload

1127
00:38:51,240 --> 00:38:53,099
an arbitrary file without like speed

1128
00:38:53,099 --> 00:38:54,599
like any limitations about like

1129
00:38:54,599 --> 00:38:56,400
extension of the file which of course if

1130
00:38:56,400 --> 00:38:58,200
you upload the PHP file because well

1131
00:38:58,200 --> 00:39:00,420
WordPress in most of the cases for PHP

1132
00:39:00,420 --> 00:39:02,520
which they also support in this case

1133
00:39:02,520 --> 00:39:04,740
it also will can result in remote

1134
00:39:04,740 --> 00:39:06,540
command execution

1135
00:39:06,540 --> 00:39:09,060
so what we've done we actually like to

1136
00:39:09,060 --> 00:39:10,079
verify first that we have a

1137
00:39:10,079 --> 00:39:12,599
vulnerability like we first try to

1138
00:39:12,599 --> 00:39:14,099
upload like legitimate files like images

1139
00:39:14,099 --> 00:39:15,300
themselves

1140
00:39:15,300 --> 00:39:17,160
uh which which works so we prove that we

1141
00:39:17,160 --> 00:39:18,599
can just upload images they will end up

1142
00:39:18,599 --> 00:39:20,160
exactly in the same directory because

1143
00:39:20,160 --> 00:39:21,780
it's actually directory is based on the

1144
00:39:21,780 --> 00:39:24,420
date when you exploit the vulnerability

1145
00:39:24,420 --> 00:39:25,740
and then you just basically like keep

1146
00:39:25,740 --> 00:39:27,240
uploading it just basically just uploads

1147
00:39:27,240 --> 00:39:28,440
uploads it just adds some kind of like

1148
00:39:28,440 --> 00:39:30,060
it renames the file slightly but it

1149
00:39:30,060 --> 00:39:31,560
gives you the response where the file is

1150
00:39:31,560 --> 00:39:32,880
located which is actually really great

1151
00:39:32,880 --> 00:39:34,020
because then then you don't need to

1152
00:39:34,020 --> 00:39:35,520
search for it you should browser it's

1153
00:39:35,520 --> 00:39:37,380
there so perfect

1154
00:39:37,380 --> 00:39:38,700
um then the next step was like actually

1155
00:39:38,700 --> 00:39:40,440
how you can actually chain it and then

1156
00:39:40,440 --> 00:39:42,420
combine it with the remote like PHP

1157
00:39:42,420 --> 00:39:46,140
script being uploaded there so first we

1158
00:39:46,140 --> 00:39:48,540
what we did we actually uploaded PHP

1159
00:39:48,540 --> 00:39:50,220
info file just you know like to to get

1160
00:39:50,220 --> 00:39:51,839
like nothing malicious just PHP info

1161
00:39:51,839 --> 00:39:53,640
because well you can find PHP info a lot

1162
00:39:53,640 --> 00:39:55,079
on the internet so we decided like yeah

1163
00:39:55,079 --> 00:39:57,300
let's just enumerate the system first

1164
00:39:57,300 --> 00:39:58,859
so what we found out that this system

1165
00:39:58,859 --> 00:40:00,780
was Windows based operating system that

1166
00:40:00,780 --> 00:40:02,339
was active directory during this well

1167
00:40:02,339 --> 00:40:04,020
that was running on the specific user

1168
00:40:04,020 --> 00:40:08,400
and it was also like IIs based swap

1169
00:40:08,400 --> 00:40:11,339
server running WordPress and PHP for me

1170
00:40:11,339 --> 00:40:12,359
it was like

1171
00:40:12,359 --> 00:40:14,640
what

1172
00:40:14,640 --> 00:40:16,079
um it was like

1173
00:40:16,079 --> 00:40:18,300
very interesting like this is where I

1174
00:40:18,300 --> 00:40:20,180
think like a smile came to my face like

1175
00:40:20,180 --> 00:40:23,220
Hallelujah something is going on uh so

1176
00:40:23,220 --> 00:40:24,720
the next step was okay like now it's

1177
00:40:24,720 --> 00:40:25,920
time to exploit

1178
00:40:25,920 --> 00:40:27,599
um so we uploaded like

1179
00:40:27,599 --> 00:40:28,920
um of course like to actually exploit

1180
00:40:28,920 --> 00:40:30,240
this vulnerability

1181
00:40:30,240 --> 00:40:32,220
um you need to have still like the the

1182
00:40:32,220 --> 00:40:33,720
file that you're trying to upload still

1183
00:40:33,720 --> 00:40:35,460
needs to have the properties of an image

1184
00:40:35,460 --> 00:40:37,260
file as well because the plugin itself

1185
00:40:37,260 --> 00:40:39,960
does some kind of like basic checks and

1186
00:40:39,960 --> 00:40:41,820
then like you can just basically insert

1187
00:40:41,820 --> 00:40:43,560
into the like the properties on the

1188
00:40:43,560 --> 00:40:44,700
image that you're trying to upload the

1189
00:40:44,700 --> 00:40:46,740
web shell but first like a PHP version

1190
00:40:46,740 --> 00:40:48,599
in this case we use Weebly uh like

1191
00:40:48,599 --> 00:40:50,220
basically just generates you like like

1192
00:40:50,220 --> 00:40:51,780
some kind of like obfuscated encrypted

1193
00:40:51,780 --> 00:40:54,240
PHP Web Channel and then like in order

1194
00:40:54,240 --> 00:40:57,359
to like upload it as a PHP file it

1195
00:40:57,359 --> 00:40:58,800
basically like the bypasses just

1196
00:40:58,800 --> 00:40:59,940
basically you need to put a file

1197
00:40:59,940 --> 00:41:03,900
extenders b space h space b and what the

1198
00:41:03,900 --> 00:41:05,339
plugin does it just removes all spaces

1199
00:41:05,339 --> 00:41:08,820
and saves that PHP file perfect so this

1200
00:41:08,820 --> 00:41:12,540
is where we got our uh web shell

1201
00:41:12,540 --> 00:41:14,220
so

1202
00:41:14,220 --> 00:41:16,140
um of course like web shell is like not

1203
00:41:16,140 --> 00:41:17,880
super interactive you can just basically

1204
00:41:17,880 --> 00:41:19,320
execute a command and do it for the

1205
00:41:19,320 --> 00:41:21,060
response and then like

1206
00:41:21,060 --> 00:41:21,660
um

1207
00:41:21,660 --> 00:41:23,220
it might be still malicious looking like

1208
00:41:23,220 --> 00:41:25,320
if like the single IP address is just

1209
00:41:25,320 --> 00:41:27,359
does a lot of requests uh get requests

1210
00:41:27,359 --> 00:41:29,220
to the specific file you know and just

1211
00:41:29,220 --> 00:41:30,900
then there's some also response coming

1212
00:41:30,900 --> 00:41:31,740
back

1213
00:41:31,740 --> 00:41:33,359
so in this case we decided okay like

1214
00:41:33,359 --> 00:41:36,240
it's time for uh for some C2 so

1215
00:41:36,240 --> 00:41:38,040
um we uploaded like a couple track

1216
00:41:38,040 --> 00:41:40,440
Beacon as well like obfuscated with

1217
00:41:40,440 --> 00:41:42,240
guard rail specifically that we prepared

1218
00:41:42,240 --> 00:41:44,040
that we also tested on that system all

1219
00:41:44,040 --> 00:41:45,839
worked so that's good so we didn't do

1220
00:41:45,839 --> 00:41:46,740
something wrong

1221
00:41:46,740 --> 00:41:48,359
and then we just use like a couple

1222
00:41:48,359 --> 00:41:50,700
strike in a very like a passive mode you

1223
00:41:50,700 --> 00:41:52,079
know like a callbacks that are happening

1224
00:41:52,079 --> 00:41:53,579
every minute you know just casually

1225
00:41:53,579 --> 00:41:56,280
slowly downloading files since it was

1226
00:41:56,280 --> 00:41:58,380
like a web server publicly Exposed Of

1227
00:41:58,380 --> 00:41:59,579
course the most like the most common

1228
00:41:59,579 --> 00:42:00,660
thing that you're gonna do is just

1229
00:42:00,660 --> 00:42:02,520
download a bunch of web config files

1230
00:42:02,520 --> 00:42:04,920
because this actually server was used

1231
00:42:04,920 --> 00:42:06,839
also like I think because like multiple

1232
00:42:06,839 --> 00:42:09,000
sets like two three four maybe so we

1233
00:42:09,000 --> 00:42:10,440
basically basically looking around

1234
00:42:10,440 --> 00:42:12,720
downloading downloading downloading so

1235
00:42:12,720 --> 00:42:14,520
first it was just a looting phase we

1236
00:42:14,520 --> 00:42:16,440
didn't even like much in inspected what

1237
00:42:16,440 --> 00:42:18,780
we actually have inside yet because we

1238
00:42:18,780 --> 00:42:20,520
just wanted to see like okay we have

1239
00:42:20,520 --> 00:42:22,200
access now we just want to see if we can

1240
00:42:22,200 --> 00:42:24,000
find maybe more credentials that we can

1241
00:42:24,000 --> 00:42:25,740
use like to come back for example like

1242
00:42:25,740 --> 00:42:27,900
from some other Avenue

1243
00:42:27,900 --> 00:42:30,000
um in this case like first loading so

1244
00:42:30,000 --> 00:42:31,800
all web.config files from the web server

1245
00:42:31,800 --> 00:42:33,480
then we also went for like just

1246
00:42:33,480 --> 00:42:35,280
basically trying to access other other

1247
00:42:35,280 --> 00:42:37,500
systems on the network so we also

1248
00:42:37,500 --> 00:42:39,960
downloaded like uh some some files from

1249
00:42:39,960 --> 00:42:42,119
this useful folder because it's like it

1250
00:42:42,119 --> 00:42:43,800
was accessible so we identified the

1251
00:42:43,800 --> 00:42:45,599
domain controller and then we also found

1252
00:42:45,599 --> 00:42:47,579
like a lot of files with credentials in

1253
00:42:47,579 --> 00:42:49,140
this like scripts with credentials on

1254
00:42:49,140 --> 00:42:50,880
this useful share but basically like

1255
00:42:50,880 --> 00:42:52,740
every user on the network can access

1256
00:42:52,740 --> 00:42:54,599
uh and then we also check like okay if

1257
00:42:54,599 --> 00:42:55,980
they have some adcs because we also

1258
00:42:55,980 --> 00:42:57,480
wanted to kind of like do some kind of

1259
00:42:57,480 --> 00:42:59,760
Recon to see if we can use some like

1260
00:42:59,760 --> 00:43:02,160
known attack avenues like for example

1261
00:43:02,160 --> 00:43:04,260
exploiting like like abusing adcs if

1262
00:43:04,260 --> 00:43:05,400
they have any so in this case they

1263
00:43:05,400 --> 00:43:06,359
didn't have any

1264
00:43:06,359 --> 00:43:07,800
uh but for us it's actually was not

1265
00:43:07,800 --> 00:43:09,960
needed later on

1266
00:43:09,960 --> 00:43:13,020
um so like once we dump the file so we

1267
00:43:13,020 --> 00:43:14,579
decided okay let's time to uh to

1268
00:43:14,579 --> 00:43:16,319
evaluate what we have

1269
00:43:16,319 --> 00:43:18,480
so we just decided to inspect what we

1270
00:43:18,480 --> 00:43:21,359
actually have so uh in web.config files

1271
00:43:21,359 --> 00:43:22,560
we found a lot of database connection

1272
00:43:22,560 --> 00:43:24,960
strings like a lot of different

1273
00:43:24,960 --> 00:43:26,520
databases like maybe five or six

1274
00:43:26,520 --> 00:43:28,380
databases because like they were like

1275
00:43:28,380 --> 00:43:31,260
pushing data all like around the places

1276
00:43:31,260 --> 00:43:33,900
and we also found like some Salesforce

1277
00:43:33,900 --> 00:43:35,280
API Keys

1278
00:43:35,280 --> 00:43:37,740
um uh that basically they used like to

1279
00:43:37,740 --> 00:43:40,380
upload some some data to Salesforce

1280
00:43:40,380 --> 00:43:42,780
um inside of the web config files we

1281
00:43:42,780 --> 00:43:44,940
also found a password for a user which

1282
00:43:44,940 --> 00:43:46,920
was six characters password six

1283
00:43:46,920 --> 00:43:49,200
characters long it was like for some

1284
00:43:49,200 --> 00:43:50,880
kind of like third-party API and we're

1285
00:43:50,880 --> 00:43:54,119
like okay why not uh basically just we

1286
00:43:54,119 --> 00:43:55,740
have we have it and then when when we

1287
00:43:55,740 --> 00:43:57,119
actually did some enumeration on the

1288
00:43:57,119 --> 00:43:58,980
system itself we wanted to find for

1289
00:43:58,980 --> 00:44:00,420
example what are the local admin users

1290
00:44:00,420 --> 00:44:01,740
on that specific server that we

1291
00:44:01,740 --> 00:44:04,200
compromised and it was one of the users

1292
00:44:04,200 --> 00:44:05,819
that actually we basically extracted

1293
00:44:05,819 --> 00:44:07,200
from the web.config file and we were

1294
00:44:07,200 --> 00:44:09,180
like okay it must be also like maybe it

1295
00:44:09,180 --> 00:44:10,680
also has a domain admin privileges we

1296
00:44:10,680 --> 00:44:12,900
even had a joke in no way we verified it

1297
00:44:12,900 --> 00:44:15,900
had domain and privileges so for us like

1298
00:44:15,900 --> 00:44:18,720
it was it was a bit shocking because why

1299
00:44:18,720 --> 00:44:20,220
would you do that why you would store

1300
00:44:20,220 --> 00:44:22,380
credentials for like third-party API and

1301
00:44:22,380 --> 00:44:24,060
also have a ad user as well with domain

1302
00:44:24,060 --> 00:44:25,740
admin privileges and the password is six

1303
00:44:25,740 --> 00:44:28,859
characters as long what can go wrong

1304
00:44:28,859 --> 00:44:31,800
um yeah oh sorry I moved I moved back in

1305
00:44:31,800 --> 00:44:33,180
this case like of course to access

1306
00:44:33,180 --> 00:44:35,339
Salesforce API we basically went back to

1307
00:44:35,339 --> 00:44:37,619
our Kali Austin box and we just could

1308
00:44:37,619 --> 00:44:41,099
query Salesforce API without any network

1309
00:44:41,099 --> 00:44:42,480
restrictions because there was no like

1310
00:44:42,480 --> 00:44:44,339
firewalling or anything else on the

1311
00:44:44,339 --> 00:44:45,720
Salesforce side

1312
00:44:45,720 --> 00:44:49,380
so yeah and uh I guess in this case like

1313
00:44:49,380 --> 00:44:53,339
this slide it's on you yeah up to you so

1314
00:44:53,339 --> 00:44:55,140
the these slides can like represent an

1315
00:44:55,140 --> 00:44:57,240
example of like what we what we achieved

1316
00:44:57,240 --> 00:44:59,460
as well so we had like

1317
00:44:59,460 --> 00:45:02,339
a fishing component blocked

1318
00:45:02,339 --> 00:45:04,079
um then like perimeter testing WordPress

1319
00:45:04,079 --> 00:45:06,780
and SharePoint as well done we we get

1320
00:45:06,780 --> 00:45:07,980
some data so which is like a few

1321
00:45:07,980 --> 00:45:08,940
objectives

1322
00:45:08,940 --> 00:45:10,920
then like of course we try to move like

1323
00:45:10,920 --> 00:45:12,599
within the network got access to like

1324
00:45:12,599 --> 00:45:15,180
very sensitive data got it

1325
00:45:15,180 --> 00:45:17,700
and then because the instant response

1326
00:45:17,700 --> 00:45:19,859
um so but yeah for us it was already

1327
00:45:19,859 --> 00:45:21,540
like a game over because we already got

1328
00:45:21,540 --> 00:45:23,520
everything what we wanted we were in the

1329
00:45:23,520 --> 00:45:25,619
network for long enough so at least like

1330
00:45:25,619 --> 00:45:27,359
we we collected I think everything what

1331
00:45:27,359 --> 00:45:30,000
we even wanted right I think basically

1332
00:45:30,000 --> 00:45:32,760
for us was the idea and this is what we

1333
00:45:32,760 --> 00:45:34,260
wanted to share with you in today's talk

1334
00:45:34,260 --> 00:45:35,339
is

1335
00:45:35,339 --> 00:45:36,839
you know you're doing red teams you have

1336
00:45:36,839 --> 00:45:38,880
objectives to achieve you've got targets

1337
00:45:38,880 --> 00:45:40,319
you need to be Advanced you need to be

1338
00:45:40,319 --> 00:45:41,579
better than this company and that

1339
00:45:41,579 --> 00:45:43,680
company and this advanced persistent

1340
00:45:43,680 --> 00:45:46,020
director and show us a new way and show

1341
00:45:46,020 --> 00:45:47,760
us an exciting way and you know this is

1342
00:45:47,760 --> 00:45:49,400
what we're always being challenged to do

1343
00:45:49,400 --> 00:45:51,839
and you know we're up for the challenge

1344
00:45:51,839 --> 00:45:53,520
we're always trying to do things and try

1345
00:45:53,520 --> 00:45:55,980
and be inventive and be Advanced but

1346
00:45:55,980 --> 00:45:57,780
it took a website

1347
00:45:57,780 --> 00:46:00,480
to achieve all those objectives so your

1348
00:46:00,480 --> 00:46:03,000
most basic thing was the way that we got

1349
00:46:03,000 --> 00:46:04,319
in and achieved the objectives we didn't

1350
00:46:04,319 --> 00:46:06,900
have to worry about okay these four

1351
00:46:06,900 --> 00:46:09,839
fishing campaigns didn't get us in let's

1352
00:46:09,839 --> 00:46:11,819
work on more let's figure out more let's

1353
00:46:11,819 --> 00:46:13,619
buy more domains let's do this and that

1354
00:46:13,619 --> 00:46:16,079
was a website and it was a WordPress

1355
00:46:16,079 --> 00:46:17,640
website and I know we joke about this

1356
00:46:17,640 --> 00:46:19,440
when we say WordPress haha who uses

1357
00:46:19,440 --> 00:46:21,480
WordPress you'll be surprised how many

1358
00:46:21,480 --> 00:46:22,680
people use a WordPress and how

1359
00:46:22,680 --> 00:46:24,780
vulnerable they are even today for

1360
00:46:24,780 --> 00:46:26,099
example when we talk about doing pen

1361
00:46:26,099 --> 00:46:28,140
testing and you say SQL injection or

1362
00:46:28,140 --> 00:46:29,700
cross-site scripting and you say well

1363
00:46:29,700 --> 00:46:32,160
these are over 10 15 years old who the

1364
00:46:32,160 --> 00:46:33,839
hell still has them you'll be surprised

1365
00:46:33,839 --> 00:46:35,819
they're still available they're still

1366
00:46:35,819 --> 00:46:38,280
out there so don't worry about the most

1367
00:46:38,280 --> 00:46:40,740
advanced you know methods of of trying

1368
00:46:40,740 --> 00:46:43,200
to find you know that specific payload

1369
00:46:43,200 --> 00:46:44,880
and paying for that specific technology

1370
00:46:44,880 --> 00:46:46,619
to create or generate that payload

1371
00:46:46,619 --> 00:46:47,940
testing it and then

1372
00:46:47,940 --> 00:46:50,640
it just takes an email gateway to block

1373
00:46:50,640 --> 00:46:52,079
you on there then all that effort is

1374
00:46:52,079 --> 00:46:54,000
kind of gone and all it takes is to find

1375
00:46:54,000 --> 00:46:55,680
one thing through your OS sent in our

1376
00:46:55,680 --> 00:46:57,780
case we found we found two we found a

1377
00:46:57,780 --> 00:46:59,400
SharePoint and we found a WordPress the

1378
00:46:59,400 --> 00:47:00,540
SharePoint got us a lot of information

1379
00:47:00,540 --> 00:47:03,240
that we could use and you know if that

1380
00:47:03,240 --> 00:47:05,099
information got out would have been

1381
00:47:05,099 --> 00:47:07,560
damaging to their reputation uh but the

1382
00:47:07,560 --> 00:47:09,060
WordPress got us in and got us all the

1383
00:47:09,060 --> 00:47:10,680
way through just because a bit of luck a

1384
00:47:10,680 --> 00:47:13,020
bit of you know misconfigurations and

1385
00:47:13,020 --> 00:47:16,200
set up by them here we go next slide so

1386
00:47:16,200 --> 00:47:17,520
I know that we're

1387
00:47:17,520 --> 00:47:19,200
um short on time I know that we've kind

1388
00:47:19,200 --> 00:47:21,359
of I think overshot the limit by a bit

1389
00:47:21,359 --> 00:47:24,599
but basically the the areas of uh of

1390
00:47:24,599 --> 00:47:26,099
improvement or the or the observations

1391
00:47:26,099 --> 00:47:27,900
that we had are basically

1392
00:47:27,900 --> 00:47:32,040
so Network segregation non-existent

1393
00:47:32,040 --> 00:47:34,140
um the kind of response or response

1394
00:47:34,140 --> 00:47:35,940
Readiness and communication within the

1395
00:47:35,940 --> 00:47:37,619
organization like we were in there we

1396
00:47:37,619 --> 00:47:39,660
were taking a look we have a lot of

1397
00:47:39,660 --> 00:47:41,520
information from there and there was

1398
00:47:41,520 --> 00:47:44,099
never any kind of you know like suddenly

1399
00:47:44,099 --> 00:47:46,140
the site went down or suddenly someone's

1400
00:47:46,140 --> 00:47:48,540
tracking uh nothing we had we had clear

1401
00:47:48,540 --> 00:47:52,740
visibility in we had clear access so uh

1402
00:47:52,740 --> 00:47:54,420
lack of communication and internally

1403
00:47:54,420 --> 00:47:56,640
application whitelisting so we were

1404
00:47:56,640 --> 00:47:58,020
uploading our own payloads for

1405
00:47:58,020 --> 00:48:01,260
persistence in that screenshot earlier

1406
00:48:01,260 --> 00:48:02,700
um we had persistence on two different

1407
00:48:02,700 --> 00:48:04,500
systems

1408
00:48:04,500 --> 00:48:05,880
um application white listing didn't

1409
00:48:05,880 --> 00:48:08,520
didn't block us there lack of credential

1410
00:48:08,520 --> 00:48:10,500
management just because as as Mara said

1411
00:48:10,500 --> 00:48:12,359
in the web.configs we found a lot of

1412
00:48:12,359 --> 00:48:14,400
credentials which were reused the same

1413
00:48:14,400 --> 00:48:16,319
credentials used over you know many

1414
00:48:16,319 --> 00:48:19,020
different systems and the password kind

1415
00:48:19,020 --> 00:48:22,560
of length was a bit guessable uh

1416
00:48:22,560 --> 00:48:24,180
recommendations

1417
00:48:24,180 --> 00:48:25,800
um we recommended things like doing a

1418
00:48:25,800 --> 00:48:27,480
full attack surface finding all of your

1419
00:48:27,480 --> 00:48:29,280
systems because there are going to be

1420
00:48:29,280 --> 00:48:31,020
some of those Legacy systems that you've

1421
00:48:31,020 --> 00:48:33,000
set up five years ago you forgot known

1422
00:48:33,000 --> 00:48:35,040
about it's not part of your inventory I

1423
00:48:35,040 --> 00:48:36,720
saw part of your patch management cycle

1424
00:48:36,720 --> 00:48:38,040
and so on

1425
00:48:38,040 --> 00:48:39,960
um then that pen testing on those

1426
00:48:39,960 --> 00:48:41,220
specific systems at least web

1427
00:48:41,220 --> 00:48:42,900
application ones for whatever web apps

1428
00:48:42,900 --> 00:48:44,339
you publish

1429
00:48:44,339 --> 00:48:46,020
um whether you're gonna do a black box

1430
00:48:46,020 --> 00:48:47,760
or white box we don't care but just test

1431
00:48:47,760 --> 00:48:49,940
them and find you know things like these

1432
00:48:49,940 --> 00:48:52,440
critical vulnerabilities such as the

1433
00:48:52,440 --> 00:48:55,920
WordPress one and then just do regular

1434
00:48:55,920 --> 00:48:57,960
exercises to be able to detect these

1435
00:48:57,960 --> 00:49:01,740
types of things right so that was the

1436
00:49:01,740 --> 00:49:04,619
whole kind of A to Z of of the red team

1437
00:49:04,619 --> 00:49:07,140
this is how we did it together

1438
00:49:07,140 --> 00:49:08,880
um thinking about you know what kind of

1439
00:49:08,880 --> 00:49:10,500
payloads and how are we going to be

1440
00:49:10,500 --> 00:49:13,200
smart and be Advanced and in the end it

1441
00:49:13,200 --> 00:49:15,900
just took a WordPress website so with

1442
00:49:15,900 --> 00:49:17,640
that said I think that comes to the end

1443
00:49:17,640 --> 00:49:19,260
of our presentation I do have one

1444
00:49:19,260 --> 00:49:22,560
important slide which is right here

1445
00:49:22,560 --> 00:49:24,060
um but apart from that thank you very

1446
00:49:24,060 --> 00:49:28,260
much and we're open for questions

1447
00:49:28,260 --> 00:49:31,099
purpose

1448
00:49:33,880 --> 00:49:35,579
[Applause]

1449
00:49:35,579 --> 00:49:38,579
sure any questions

1450
00:49:38,579 --> 00:49:40,980
any donations

1451
00:49:40,980 --> 00:49:43,440
we accept Bitcoin

1452
00:49:43,440 --> 00:49:45,880
or any crypto no

1453
00:49:45,880 --> 00:49:46,980
[Music]

1454
00:49:46,980 --> 00:49:49,520
okay Seth there are no questions

1455
00:49:49,520 --> 00:49:52,560
okay I was gonna say have a great

1456
00:49:52,560 --> 00:49:55,640
afternoon but now because of one person

1457
00:49:55,640 --> 00:49:59,060
stay and suffer

1458
00:49:59,119 --> 00:50:02,700
hi hi thank you for representation I

1459
00:50:02,700 --> 00:50:04,440
have a question when you started talking

1460
00:50:04,440 --> 00:50:06,599
about all the internet saying you will

1461
00:50:06,599 --> 00:50:10,079
research on the dark web for uh

1462
00:50:10,079 --> 00:50:12,599
credential or cookies

1463
00:50:12,599 --> 00:50:15,599
like would it be legal if you buy some

1464
00:50:15,599 --> 00:50:17,520
stolen credential from the dark web for

1465
00:50:17,520 --> 00:50:20,280
excellent answer excellent question no

1466
00:50:20,280 --> 00:50:22,680
idea about the answer is it legal for us

1467
00:50:22,680 --> 00:50:25,020
what we do is we have subscriptions to

1468
00:50:25,020 --> 00:50:28,020
some of the known uh leak password sites

1469
00:50:28,020 --> 00:50:29,940
things like the hashed and so on we we

1470
00:50:29,940 --> 00:50:31,980
also have access to some of the other

1471
00:50:31,980 --> 00:50:33,599
ones which have been published which

1472
00:50:33,599 --> 00:50:35,460
we've got and extracted so we can query

1473
00:50:35,460 --> 00:50:37,380
those that's for leak credentials for

1474
00:50:37,380 --> 00:50:38,880
dark web

1475
00:50:38,880 --> 00:50:39,660
um

1476
00:50:39,660 --> 00:50:41,700
so I do have access to a couple of

1477
00:50:41,700 --> 00:50:44,040
different sites different forums where I

1478
00:50:44,040 --> 00:50:46,200
have access to some of these

1479
00:50:46,200 --> 00:50:48,000
um some of this information it doesn't

1480
00:50:48,000 --> 00:50:49,980
always have everything so for example if

1481
00:50:49,980 --> 00:50:52,200
a specific company comes and says do a

1482
00:50:52,200 --> 00:50:53,460
search for us there's no guarantee that

1483
00:50:53,460 --> 00:50:54,540
I'm going to find that specific thing

1484
00:50:54,540 --> 00:50:56,160
because it might be a different Forum

1485
00:50:56,160 --> 00:50:57,780
which requires a different invitation

1486
00:50:57,780 --> 00:50:59,819
which we don't have access to but we

1487
00:50:59,819 --> 00:51:02,040
have a couple of forums that we check to

1488
00:51:02,040 --> 00:51:03,300
make sure that is there any information

1489
00:51:03,300 --> 00:51:06,000
about certain keywords or queries

1490
00:51:06,000 --> 00:51:08,160
is it legal I don't know but eventually

1491
00:51:08,160 --> 00:51:10,140
you when like when you finish the

1492
00:51:10,140 --> 00:51:11,640
engagement you will provide that report

1493
00:51:11,640 --> 00:51:14,520
and would you write in the report oh I

1494
00:51:14,520 --> 00:51:17,119
bought your credential from I don't know

1495
00:51:17,119 --> 00:51:20,400
so yeah absolutely so the report is a

1496
00:51:20,400 --> 00:51:22,079
it's not like you're a pen test where

1497
00:51:22,079 --> 00:51:23,940
it's just finding finding finding it's a

1498
00:51:23,940 --> 00:51:25,920
story it's a log right so we tell you

1499
00:51:25,920 --> 00:51:29,220
exactly what we did for osens for setup

1500
00:51:29,220 --> 00:51:31,680
um for for uh you know Recon for

1501
00:51:31,680 --> 00:51:33,839
searching if we find information now

1502
00:51:33,839 --> 00:51:36,359
typically one thing that we we do which

1503
00:51:36,359 --> 00:51:39,180
let's say shouldn't be done technically

1504
00:51:39,180 --> 00:51:41,819
as a red team you know we should be just

1505
00:51:41,819 --> 00:51:43,680
green light and go into everything but

1506
00:51:43,680 --> 00:51:45,599
if we find something that we deem as

1507
00:51:45,599 --> 00:51:47,579
critical like if we find some like

1508
00:51:47,579 --> 00:51:49,380
session cookies for sale we typically

1509
00:51:49,380 --> 00:51:51,660
inform the customer and we say look we

1510
00:51:51,660 --> 00:51:53,819
can continue no problem

1511
00:51:53,819 --> 00:51:55,619
but you might want to jump into IR mode

1512
00:51:55,619 --> 00:51:57,180
and just check and see has someone

1513
00:51:57,180 --> 00:51:59,579
already used this has already purchased

1514
00:51:59,579 --> 00:52:01,740
this check logs go into just you know

1515
00:52:01,740 --> 00:52:03,900
kind of the blue team aspect it's up to

1516
00:52:03,900 --> 00:52:05,040
you what you want we're going to come in

1517
00:52:05,040 --> 00:52:07,260
we're going to dirty your logs but this

1518
00:52:07,260 --> 00:52:09,300
is how we do it what would you like us

1519
00:52:09,300 --> 00:52:11,220
to do like we've done assessments where

1520
00:52:11,220 --> 00:52:13,380
we've found web shells not ours somebody

1521
00:52:13,380 --> 00:52:17,280
else's so uh so you know ideally we

1522
00:52:17,280 --> 00:52:18,960
should use those web shells to get

1523
00:52:18,960 --> 00:52:21,059
ourselves in right but I don't know how

1524
00:52:21,059 --> 00:52:22,559
long those that web shell has been there

1525
00:52:22,559 --> 00:52:24,420
for and who's used it and when it was

1526
00:52:24,420 --> 00:52:28,020
uploaded so again being the nice guys we

1527
00:52:28,020 --> 00:52:30,240
we contact the company we say

1528
00:52:30,240 --> 00:52:32,520
you have a web show it's it's here this

1529
00:52:32,520 --> 00:52:35,160
is the location do you want to jump into

1530
00:52:35,160 --> 00:52:37,619
IR mode and pause the red team so that

1531
00:52:37,619 --> 00:52:39,420
you can figure out when it was first put

1532
00:52:39,420 --> 00:52:41,940
up and it was last accessed and just do

1533
00:52:41,940 --> 00:52:43,859
any kind of you know investigation on it

1534
00:52:43,859 --> 00:52:45,420
or do you want us to use it or do you

1535
00:52:45,420 --> 00:52:48,599
want us just to keep going so we do that

1536
00:52:48,599 --> 00:52:50,339
information we do try and inform as much

1537
00:52:50,339 --> 00:52:51,540
as possible because we're trying to add

1538
00:52:51,540 --> 00:52:53,339
value and we're trying to help them at

1539
00:52:53,339 --> 00:52:57,020
the end of the day yeah absolutely

1540
00:52:57,599 --> 00:53:00,180
so sorry another question like I would

1541
00:53:00,180 --> 00:53:01,980
imagine right eventually your access

1542
00:53:01,980 --> 00:53:04,440
point was with the vulnerability scanner

1543
00:53:04,440 --> 00:53:07,500
on a public website so my idea was okay

1544
00:53:07,500 --> 00:53:09,540
if I'm running a company before going to

1545
00:53:09,540 --> 00:53:11,280
Red Team engagement which in theory is

1546
00:53:11,280 --> 00:53:13,140
like the most expensive one I would

1547
00:53:13,140 --> 00:53:16,079
first run some automated scan then I

1548
00:53:16,079 --> 00:53:17,640
would go for a pen test external

1549
00:53:17,640 --> 00:53:19,859
internal and eventually after I fix

1550
00:53:19,859 --> 00:53:22,680
everything go to a red teaming but I'll

1551
00:53:22,680 --> 00:53:25,079
argue with you I I I'd love to have an

1552
00:53:25,079 --> 00:53:29,339
argument with you so red teaming right

1553
00:53:29,339 --> 00:53:31,200
um stealth

1554
00:53:31,200 --> 00:53:33,599
okay so achieve the objective get to

1555
00:53:33,599 --> 00:53:35,220
this database get to that pull this

1556
00:53:35,220 --> 00:53:36,839
information out do whatever it is you're

1557
00:53:36,839 --> 00:53:38,160
supposed to do demonstrate ransomware

1558
00:53:38,160 --> 00:53:41,160
whatever right stealth you have an EDR I

1559
00:53:41,160 --> 00:53:43,500
have to bypass it you have any kind of

1560
00:53:43,500 --> 00:53:45,359
Technology we have to evade it somehow

1561
00:53:45,359 --> 00:53:46,800
right

1562
00:53:46,800 --> 00:53:48,180
um a typical question we're asked is

1563
00:53:48,180 --> 00:53:49,740
what happens if the blue team detects

1564
00:53:49,740 --> 00:53:52,020
you business as usual this is the whole

1565
00:53:52,020 --> 00:53:53,460
point I

1566
00:53:53,460 --> 00:53:56,040
uh identify us analyze us do whatever

1567
00:53:56,040 --> 00:53:57,359
you do if it's putting the plug then

1568
00:53:57,359 --> 00:53:59,160
pull the plug if it's investigation do

1569
00:53:59,160 --> 00:54:01,079
that if it's separate VLAN whatever you

1570
00:54:01,079 --> 00:54:02,460
want no problem

1571
00:54:02,460 --> 00:54:04,200
what typically happens at the end of a

1572
00:54:04,200 --> 00:54:06,059
red team we give a report everything is

1573
00:54:06,059 --> 00:54:09,420
done we typically get asked cool is

1574
00:54:09,420 --> 00:54:10,380
there another way you could have

1575
00:54:10,380 --> 00:54:13,680
achieved that and we say maybe we have

1576
00:54:13,680 --> 00:54:15,839
no idea because we're given a window of

1577
00:54:15,839 --> 00:54:17,579
four weeks five weeks whatever it is to

1578
00:54:17,579 --> 00:54:19,200
achieve those objectives and we only

1579
00:54:19,200 --> 00:54:21,119
care about Stealth so we look for that

1580
00:54:21,119 --> 00:54:23,040
one path in right can we achieve those

1581
00:54:23,040 --> 00:54:26,400
objectives we got it cool job done for

1582
00:54:26,400 --> 00:54:28,380
me I think the value comes more from

1583
00:54:28,380 --> 00:54:31,859
purple teaming right so in a red team

1584
00:54:31,859 --> 00:54:33,900
today when we do a red team we don't use

1585
00:54:33,900 --> 00:54:36,059
powershop right Powershell is going to

1586
00:54:36,059 --> 00:54:37,500
get detected if you have an EDR we're

1587
00:54:37,500 --> 00:54:40,619
blown anything past V5 Powershell or the

1588
00:54:40,619 --> 00:54:41,940
thing in logging is enabled you're

1589
00:54:41,940 --> 00:54:44,280
screwed right so we don't use that and

1590
00:54:44,280 --> 00:54:45,660
then there are things that we typically

1591
00:54:45,660 --> 00:54:47,280
don't do like lateral Movement we would

1592
00:54:47,280 --> 00:54:49,380
never use PS exec right start the

1593
00:54:49,380 --> 00:54:51,660
service drops artifacts and so on and a

1594
00:54:51,660 --> 00:54:53,700
purple team we're saying screw all the

1595
00:54:53,700 --> 00:54:55,440
assumptions let's just try everything

1596
00:54:55,440 --> 00:54:57,540
due diligence let's try the old school

1597
00:54:57,540 --> 00:54:59,520
ways the new school ways the stealthy

1598
00:54:59,520 --> 00:55:01,680
ways and the loud ways scanner whatever

1599
00:55:01,680 --> 00:55:04,440
even your your pen test toolkit which we

1600
00:55:04,440 --> 00:55:06,420
typically don't use let's try all of

1601
00:55:06,420 --> 00:55:08,940
that stuff so we take the attack life

1602
00:55:08,940 --> 00:55:10,740
cycle right so you've got day one

1603
00:55:10,740 --> 00:55:13,020
established foothold we generate a whole

1604
00:55:13,020 --> 00:55:16,079
bunch of payloads macros uh using

1605
00:55:16,079 --> 00:55:17,700
Metasploit something that we never touch

1606
00:55:17,700 --> 00:55:20,220
to generating our own custom payloads

1607
00:55:20,220 --> 00:55:21,780
and seeing everything in between where

1608
00:55:21,780 --> 00:55:23,880
do you where do you detect us where you

1609
00:55:23,880 --> 00:55:25,260
where you're missing why are you missing

1610
00:55:25,260 --> 00:55:26,579
what kind of process injection are you

1611
00:55:26,579 --> 00:55:28,859
missing if we sideload a dll are you

1612
00:55:28,859 --> 00:55:30,059
gonna catch it or not it's going to

1613
00:55:30,059 --> 00:55:32,099
bypass your EDR then we move on to the

1614
00:55:32,099 --> 00:55:33,660
different things so for lateral Movement

1615
00:55:33,660 --> 00:55:35,760
we might do PS exec right just because

1616
00:55:35,760 --> 00:55:37,740
we expect it to get caught but let's

1617
00:55:37,740 --> 00:55:40,500
actually confirm it right so face exact

1618
00:55:40,500 --> 00:55:42,599
did you catch it yes great what do you

1619
00:55:42,599 --> 00:55:43,500
do now

1620
00:55:43,500 --> 00:55:45,359
it's happened what do you do do you pull

1621
00:55:45,359 --> 00:55:46,920
the plug how do you analyze what's your

1622
00:55:46,920 --> 00:55:49,319
playbook if you didn't catch it you got

1623
00:55:49,319 --> 00:55:51,000
bigger problems but I mean you know how

1624
00:55:51,000 --> 00:55:53,280
can we help you to to to identify it

1625
00:55:53,280 --> 00:55:55,859
then you move on to Powershell wmi you

1626
00:55:55,859 --> 00:55:57,540
know all the different other ways and

1627
00:55:57,540 --> 00:55:59,240
then the next day you'll do local

1628
00:55:59,240 --> 00:56:01,800
privacy domain prevask but you'll try

1629
00:56:01,800 --> 00:56:03,240
all the different techniques to figure

1630
00:56:03,240 --> 00:56:05,819
out all the different ways whereas in a

1631
00:56:05,819 --> 00:56:08,220
red team he's using a specific way for

1632
00:56:08,220 --> 00:56:10,319
persistence I'm using a specific way for

1633
00:56:10,319 --> 00:56:12,359
lateral movement and we're not trying

1634
00:56:12,359 --> 00:56:14,940
anything else and all you know as the

1635
00:56:14,940 --> 00:56:16,920
company is either it got either it

1636
00:56:16,920 --> 00:56:19,200
worked or it didn't and you know this

1637
00:56:19,200 --> 00:56:20,760
way works or doesn't but you don't know

1638
00:56:20,760 --> 00:56:23,099
about any of the other processes so I

1639
00:56:23,099 --> 00:56:26,160
would argue that your money is best

1640
00:56:26,160 --> 00:56:28,800
spent doing a purple team right because

1641
00:56:28,800 --> 00:56:30,059
you're doing everything and you're

1642
00:56:30,059 --> 00:56:31,680
working with the sock you're working

1643
00:56:31,680 --> 00:56:33,540
with the blue team so it's not it's not

1644
00:56:33,540 --> 00:56:35,460
like me doing a red team report a red

1645
00:56:35,460 --> 00:56:37,260
team assessment giving you a report and

1646
00:56:37,260 --> 00:56:38,520
then you have to go to your blue team

1647
00:56:38,520 --> 00:56:40,740
and say guys did you catch this one no

1648
00:56:40,740 --> 00:56:43,020
did you catch this one yes cool did you

1649
00:56:43,020 --> 00:56:44,880
cut we're doing it together we have an

1650
00:56:44,880 --> 00:56:47,520
open communication Bridge teams or Zoom

1651
00:56:47,520 --> 00:56:49,619
or whatever you want and we're doing the

1652
00:56:49,619 --> 00:56:50,880
attacks together most of the blue

1653
00:56:50,880 --> 00:56:52,619
teamers haven't seen what a red team or

1654
00:56:52,619 --> 00:56:54,359
attack or an apt threat actor attack

1655
00:56:54,359 --> 00:56:55,859
looks like we're showing you we're

1656
00:56:55,859 --> 00:56:57,599
demonstrating to you this is how we do

1657
00:56:57,599 --> 00:56:58,980
this specific type of attack and then

1658
00:56:58,980 --> 00:57:00,420
you get to quiz us as well which I think

1659
00:57:00,420 --> 00:57:02,339
is cool like you know someone will say

1660
00:57:02,339 --> 00:57:04,200
there's a new version of mimikatz uh

1661
00:57:04,200 --> 00:57:06,480
let's try that cool apparently if you

1662
00:57:06,480 --> 00:57:08,280
side load the dll with this it can

1663
00:57:08,280 --> 00:57:10,500
bypass this specific EDR I heard it on

1664
00:57:10,500 --> 00:57:12,780
Twitter let's try you know so it gets

1665
00:57:12,780 --> 00:57:15,119
very interactive for me it's fun

1666
00:57:15,119 --> 00:57:16,920
um but you're also doing due diligence

1667
00:57:16,920 --> 00:57:18,180
you're you're using the red team

1668
00:57:18,180 --> 00:57:19,920
methodology but everything else as well

1669
00:57:19,920 --> 00:57:21,839
that for me is

1670
00:57:21,839 --> 00:57:23,940
the winner really because you're doing

1671
00:57:23,940 --> 00:57:25,680
everything together

1672
00:57:25,680 --> 00:57:27,420
but then someone will say well no red

1673
00:57:27,420 --> 00:57:29,520
team is better because it's unannounced

1674
00:57:29,520 --> 00:57:32,940
will the guy detect you is that tool

1675
00:57:32,940 --> 00:57:34,800
already tuned well we're testing tuning

1676
00:57:34,800 --> 00:57:35,880
already because we're trying everything

1677
00:57:35,880 --> 00:57:37,200
the only thing we're not doing is

1678
00:57:37,200 --> 00:57:39,180
putting into play what the blue teamer

1679
00:57:39,180 --> 00:57:40,079
does

1680
00:57:40,079 --> 00:57:42,000
but that's for me is the technical test

1681
00:57:42,000 --> 00:57:44,760
is purple uh because our red teamers

1682
00:57:44,760 --> 00:57:46,380
your blue teamers let's all work

1683
00:57:46,380 --> 00:57:49,079
together and whatever technology you

1684
00:57:49,079 --> 00:57:50,400
have whether it's open source whether

1685
00:57:50,400 --> 00:57:52,920
it's someone outside

1686
00:57:52,920 --> 00:57:54,900
um and so and so that for me is the

1687
00:57:54,900 --> 00:57:55,800
winner

1688
00:57:55,800 --> 00:57:57,960
I hope that answered your question thank

1689
00:57:57,960 --> 00:58:00,440
you thanks

1690
00:58:02,220 --> 00:58:04,920
any other questions

1691
00:58:04,920 --> 00:58:06,119
yep

1692
00:58:06,119 --> 00:58:07,920
I can hear you I'm sure I can hear you

1693
00:58:07,920 --> 00:58:10,280
from there

1694
00:58:12,780 --> 00:58:14,220
okay

1695
00:58:14,220 --> 00:58:18,780
so uh sure thank you for this talk but I

1696
00:58:18,780 --> 00:58:21,240
I wonder if those of all those scenario

1697
00:58:21,240 --> 00:58:24,720
that you presented uh were not working

1698
00:58:24,720 --> 00:58:29,160
fine did you think about something else

1699
00:58:29,160 --> 00:58:31,859
like physical and fusion or something

1700
00:58:31,859 --> 00:58:34,020
like that so

1701
00:58:34,020 --> 00:58:36,180
um I'll answer that in two parts

1702
00:58:36,180 --> 00:58:38,339
um the first part is we keep trying

1703
00:58:38,339 --> 00:58:40,440
different different ways okay so the

1704
00:58:40,440 --> 00:58:42,000
fishing directly to these people didn't

1705
00:58:42,000 --> 00:58:44,520
work okay let's try distribution groups

1706
00:58:44,520 --> 00:58:45,960
okay that didn't work maybe there's a

1707
00:58:45,960 --> 00:58:48,180
file upload okay that didn't work uh

1708
00:58:48,180 --> 00:58:49,740
trying to Target someone via something

1709
00:58:49,740 --> 00:58:51,780
like LinkedIn and make them go and click

1710
00:58:51,780 --> 00:58:53,819
and that didn't work we go back to the

1711
00:58:53,819 --> 00:58:55,260
perimeter like we did in this example

1712
00:58:55,260 --> 00:58:58,200
here okay that didn't work at some point

1713
00:58:58,200 --> 00:59:00,299
again we're we're we're we're

1714
00:59:00,299 --> 00:59:02,760
um we're time bound right so at some

1715
00:59:02,760 --> 00:59:04,619
point generating payloads takes time

1716
00:59:04,619 --> 00:59:06,000
testing those payloads takes time

1717
00:59:06,000 --> 00:59:07,619
phishing takes time if you're buying

1718
00:59:07,619 --> 00:59:09,420
domains categorizing or using any of

1719
00:59:09,420 --> 00:59:11,280
these so at some point you have to say

1720
00:59:11,280 --> 00:59:13,619
Well done you did a good job

1721
00:59:13,619 --> 00:59:16,500
then we go we offer you two two choices

1722
00:59:16,500 --> 00:59:19,380
the first choice is we close it right

1723
00:59:19,380 --> 00:59:21,599
and you say cool we did well our

1724
00:59:21,599 --> 00:59:23,760
investments in this technology and our

1725
00:59:23,760 --> 00:59:26,400
stuff and then our tuning is really good

1726
00:59:26,400 --> 00:59:28,559
and then our process is really good or

1727
00:59:28,559 --> 00:59:30,119
we can offer you what's called assume

1728
00:59:30,119 --> 00:59:31,680
breach so

1729
00:59:31,680 --> 00:59:33,839
on the perimeter we didn't get in well

1730
00:59:33,839 --> 00:59:36,240
done good stuff we give you some some

1731
00:59:36,240 --> 00:59:38,520
payloads you execute them on an internal

1732
00:59:38,520 --> 00:59:41,099
domain join system and then we simulate

1733
00:59:41,099 --> 00:59:43,440
The Insider threat so if someone you

1734
00:59:43,440 --> 00:59:45,660
know has a USB found in the car park or

1735
00:59:45,660 --> 00:59:47,400
someone just has bad intentions or

1736
00:59:47,400 --> 00:59:48,900
someone did click we simulate that

1737
00:59:48,900 --> 00:59:50,819
someone did where can we go on the

1738
00:59:50,819 --> 00:59:52,559
inside so these are the options we have

1739
00:59:52,559 --> 00:59:53,940
for that

1740
00:59:53,940 --> 00:59:56,640
um the second part is about the physical

1741
00:59:56,640 --> 00:59:59,400
if it's in scope and why I say that is

1742
00:59:59,400 --> 01:00:01,020
because I live in the Middle East I live

1743
01:00:01,020 --> 01:00:03,420
in Dubai and a lot of the places where

1744
01:00:03,420 --> 01:00:06,180
we go to have guns and I am not happy to

1745
01:00:06,180 --> 01:00:08,099
go on site and to risk someone with a

1746
01:00:08,099 --> 01:00:10,559
gun or even a big German Shepherd or

1747
01:00:10,559 --> 01:00:12,599
something like that so I

1748
01:00:12,599 --> 01:00:15,540
I choose not to do to do those if

1749
01:00:15,540 --> 01:00:17,400
they're asked then fine and you know

1750
01:00:17,400 --> 01:00:19,200
I'll probably ask for that you know you

1751
01:00:19,200 --> 01:00:21,119
could run faster than me so he can go

1752
01:00:21,119 --> 01:00:24,960
but um it's typically defined at the

1753
01:00:24,960 --> 01:00:26,940
beginning by the scope some people say I

1754
01:00:26,940 --> 01:00:28,440
want to see if you can physically get in

1755
01:00:28,440 --> 01:00:30,599
and you know find an empty room find an

1756
01:00:30,599 --> 01:00:32,520
open computer maybe go into one of the

1757
01:00:32,520 --> 01:00:34,319
conference rooms and plug in or connect

1758
01:00:34,319 --> 01:00:35,640
to our Wi-Fi

1759
01:00:35,640 --> 01:00:37,799
those have to be defined in the scope uh

1760
01:00:37,799 --> 01:00:39,599
scope of work

1761
01:00:39,599 --> 01:00:42,000
thank you okay

1762
01:00:42,000 --> 01:00:44,040
any other questions

1763
01:00:44,040 --> 01:00:46,619
anyone happen to clear from yesterday

1764
01:00:46,619 --> 01:00:49,200
I missed that yesterday damn it

1765
01:00:49,200 --> 01:00:51,540
all right so if no no the questions and

1766
01:00:51,540 --> 01:00:53,339
enjoy your your afternoon and catch the

1767
01:00:53,339 --> 01:00:55,200
flag tonight and I wish you all the best

1768
01:00:55,200 --> 01:00:57,919
thank you so much

