1
00:00:02,820 --> 00:00:04,080
okay

2
00:00:04,080 --> 00:00:07,620
um hello uh I'm yanai and in this talk

3
00:00:07,620 --> 00:00:10,260
welcome to my talk modern adventures

4
00:00:10,260 --> 00:00:11,880
with Legacy protocols in this talk I'm

5
00:00:11,880 --> 00:00:13,980
gonna discuss the research I was doing

6
00:00:13,980 --> 00:00:16,920
since 2018 more or less and which I got

7
00:00:16,920 --> 00:00:19,380
the capability and I'll tell you how to

8
00:00:19,380 --> 00:00:22,140
do IP spoofing on by yourself which is

9
00:00:22,140 --> 00:00:24,180
quite cool and for This research I

10
00:00:24,180 --> 00:00:27,420
received the pony award in less blacket

11
00:00:27,420 --> 00:00:30,960
for the most underhyped research and if

12
00:00:30,960 --> 00:00:32,700
you want to know what the hype was not

13
00:00:32,700 --> 00:00:34,559
about you should just stick with stick

14
00:00:34,559 --> 00:00:36,480
with me so

15
00:00:36,480 --> 00:00:38,820
let's get this out of the way I'm me and

16
00:00:38,820 --> 00:00:40,980
I I'm security researcher I'm doing some

17
00:00:40,980 --> 00:00:43,200
low-level embedded stuff browsers

18
00:00:43,200 --> 00:00:45,480
whatever and this talk is not affiliated

19
00:00:45,480 --> 00:00:48,120
with my employer because my employer has

20
00:00:48,120 --> 00:00:50,340
nothing to do with it I did it in my

21
00:00:50,340 --> 00:00:52,379
spare time okay

22
00:00:52,379 --> 00:00:54,899
what are we gonna how this talk is gonna

23
00:00:54,899 --> 00:00:56,520
be uh we'll have some background

24
00:00:56,520 --> 00:00:58,680
motivation what is IP what is IP

25
00:00:58,680 --> 00:01:00,840
spoofing why you want to do IP spoofing

26
00:01:00,840 --> 00:01:03,180
and then I'll talk about my research how

27
00:01:03,180 --> 00:01:05,400
I done it the you know struggles what

28
00:01:05,400 --> 00:01:08,520
work what didn't work and then there

29
00:01:08,520 --> 00:01:10,439
will be a short demo that I hope will

30
00:01:10,439 --> 00:01:13,500
work and uh then I'll discuss the

31
00:01:13,500 --> 00:01:15,540
findings I'll talk to you a bit about

32
00:01:15,540 --> 00:01:17,340
the disclosure procedure so if you're

33
00:01:17,340 --> 00:01:20,520
interested in how disclosure works and

34
00:01:20,520 --> 00:01:22,439
what to expect that might interest you

35
00:01:22,439 --> 00:01:26,220
uh spoiler it wasn't fun and uh last

36
00:01:26,220 --> 00:01:28,860
I'll talk a bit about future research

37
00:01:28,860 --> 00:01:31,259
that can be done using this research so

38
00:01:31,259 --> 00:01:33,540
without further Ado

39
00:01:33,540 --> 00:01:37,320
um what is IP uh a quick reminder IP is

40
00:01:37,320 --> 00:01:40,079
how we send packets on the internet and

41
00:01:40,079 --> 00:01:41,820
every packet that goes on the internet

42
00:01:41,820 --> 00:01:43,799
has two bits of information in it a

43
00:01:43,799 --> 00:01:46,619
source and a destination and the

44
00:01:46,619 --> 00:01:49,140
destination is what we use to basically

45
00:01:49,140 --> 00:01:51,000
send the packet to wherever we want it

46
00:01:51,000 --> 00:01:53,159
to be so this is the destination service

47
00:01:53,159 --> 00:01:55,860
and the source address well uh should be

48
00:01:55,860 --> 00:01:57,420
the address from which the packet

49
00:01:57,420 --> 00:01:59,820
originates so when we're sending a

50
00:01:59,820 --> 00:02:01,079
packet we should write our own address

51
00:02:01,079 --> 00:02:04,680
but of course the flow is that basically

52
00:02:04,680 --> 00:02:07,439
nobody is verifying that the source IP

53
00:02:07,439 --> 00:02:10,440
is the right AP so if my address is one

54
00:02:10,440 --> 00:02:13,319
two three four I can put 5555 there and

55
00:02:13,319 --> 00:02:15,120
the problem that can arise from this is

56
00:02:15,120 --> 00:02:18,300
that if a service receives a packet and

57
00:02:18,300 --> 00:02:20,580
the source address is like from The Real

58
00:02:20,580 --> 00:02:22,200
Slim Shady and The Real Slim Shady is

59
00:02:22,200 --> 00:02:23,819
asking you to do something and you

60
00:02:23,819 --> 00:02:25,379
believe it's the real Slim Shady because

61
00:02:25,379 --> 00:02:26,760
it has the address of The Real Slim

62
00:02:26,760 --> 00:02:29,040
Shady then you will do whatever Slim

63
00:02:29,040 --> 00:02:31,739
Shady's Essence for me to do and this is

64
00:02:31,739 --> 00:02:34,500
kind of authentication bypass

65
00:02:34,500 --> 00:02:37,319
another problem that can occur is that

66
00:02:37,319 --> 00:02:39,480
maybe you're an unsuspecting server on

67
00:02:39,480 --> 00:02:41,099
the internet and all of the sudden

68
00:02:41,099 --> 00:02:42,599
someone is

69
00:02:42,599 --> 00:02:44,459
sending you a packet with a spoofed

70
00:02:44,459 --> 00:02:46,440
source address and you're receiving this

71
00:02:46,440 --> 00:02:48,239
packet and you say hey that's not for me

72
00:02:48,239 --> 00:02:49,620
I'm not doing whatever you're asking and

73
00:02:49,620 --> 00:02:52,080
you're sending a reply and you're

74
00:02:52,080 --> 00:02:54,480
replying to the source address now if

75
00:02:54,480 --> 00:02:56,160
the source address is proved to be

76
00:02:56,160 --> 00:02:58,080
somebody else you'll just send a packet

77
00:02:58,080 --> 00:03:01,019
to some other unsuspecting server and if

78
00:03:01,019 --> 00:03:02,879
too many servers are doing this at once

79
00:03:02,879 --> 00:03:06,599
basically you can execute a denial of

80
00:03:06,599 --> 00:03:08,640
service attack okay so these are the two

81
00:03:08,640 --> 00:03:11,459
things that IPS spoofing are can cause

82
00:03:11,459 --> 00:03:14,459
can lead to and let's see some examples

83
00:03:14,459 --> 00:03:16,620
for that so

84
00:03:16,620 --> 00:03:19,140
these are research I was doing last 10

85
00:03:19,140 --> 00:03:20,819
years or so so this one is the more

86
00:03:20,819 --> 00:03:24,300
recent one I researched this OBD tracker

87
00:03:24,300 --> 00:03:26,700
so this is a device that's used by Fleet

88
00:03:26,700 --> 00:03:29,400
Management affiliate managers to know

89
00:03:29,400 --> 00:03:32,280
where their cars are at any given moment

90
00:03:32,280 --> 00:03:33,900
of time because they have many cars they

91
00:03:33,900 --> 00:03:35,580
have any drivers they want to know where

92
00:03:35,580 --> 00:03:37,019
the cars are and some basic information

93
00:03:37,019 --> 00:03:39,360
about the car so they can buy this

94
00:03:39,360 --> 00:03:41,819
device put it in every car they have and

95
00:03:41,819 --> 00:03:44,340
now they can have the location the GPS

96
00:03:44,340 --> 00:03:47,280
location of every car they have the

97
00:03:47,280 --> 00:03:49,920
problem with this embedded device is

98
00:03:49,920 --> 00:03:52,980
that one of the problems actually is

99
00:03:52,980 --> 00:03:55,440
that it used to receive commands from a

100
00:03:55,440 --> 00:03:58,140
pre-configured management server and the

101
00:03:58,140 --> 00:04:00,420
only authentication they have for the

102
00:04:00,420 --> 00:04:04,379
the commands come from the server are it

103
00:04:04,379 --> 00:04:06,720
was the IP address of the pre-configured

104
00:04:06,720 --> 00:04:10,080
management server so and it was done the

105
00:04:10,080 --> 00:04:11,700
commands were sent over UDP of course

106
00:04:11,700 --> 00:04:13,140
because why not

107
00:04:13,140 --> 00:04:15,900
and there was no authentication and you

108
00:04:15,900 --> 00:04:18,600
can send any command the command I

109
00:04:18,600 --> 00:04:20,279
choose to send is from upgrade of course

110
00:04:20,279 --> 00:04:22,680
so I could do eyepiece proofing and send

111
00:04:22,680 --> 00:04:25,320
a firmware upgrade command and upgrade

112
00:04:25,320 --> 00:04:27,720
the firmware of this device and this let

113
00:04:27,720 --> 00:04:30,479
me send any message I want to the can

114
00:04:30,479 --> 00:04:33,479
Network in the car this network is the

115
00:04:33,479 --> 00:04:35,520
network with which you're sending

116
00:04:35,520 --> 00:04:37,979
commands to every computer of the car so

117
00:04:37,979 --> 00:04:40,440
the engine the lights the windshields

118
00:04:40,440 --> 00:04:42,180
whatever so basically you can just

119
00:04:42,180 --> 00:04:44,120
completely take over the car

120
00:04:44,120 --> 00:04:46,320
these vulnerabilities were disclosed a

121
00:04:46,320 --> 00:04:48,560
few years ago so they're fine

122
00:04:48,560 --> 00:04:51,000
the second motivation is a bit more

123
00:04:51,000 --> 00:04:53,460
complicated but I was part of a red team

124
00:04:53,460 --> 00:04:57,000
we're just you know trying to uh do some

125
00:04:57,000 --> 00:04:59,639
pen testing on this web server and my

126
00:04:59,639 --> 00:05:01,500
teammates got a local file read write

127
00:05:01,500 --> 00:05:05,520
something called lfi and voice

128
00:05:05,520 --> 00:05:07,139
the title is quite small I don't know

129
00:05:07,139 --> 00:05:09,960
why but okay and we could read the code

130
00:05:09,960 --> 00:05:12,060
from this server and the server was

131
00:05:12,060 --> 00:05:14,820
doing something a bit weird so I'm very

132
00:05:14,820 --> 00:05:16,860
sorry there is a PHP code in here this

133
00:05:16,860 --> 00:05:18,419
is the last time you'll see PHP code in

134
00:05:18,419 --> 00:05:19,580
this talk

135
00:05:19,580 --> 00:05:23,940
but uh for you who have the luck not to

136
00:05:23,940 --> 00:05:26,039
know PHP what the server was doing it

137
00:05:26,039 --> 00:05:28,919
was making an HTTP request to some

138
00:05:28,919 --> 00:05:31,500
third-party server let's say through XYZ

139
00:05:31,500 --> 00:05:35,120
and the server was replying with a Json

140
00:05:35,120 --> 00:05:37,800
and the way this web server thought

141
00:05:37,800 --> 00:05:42,060
would be smart to parse the reply was to

142
00:05:42,060 --> 00:05:44,220
write the reply to a file and then

143
00:05:44,220 --> 00:05:47,580
evaluate it as PHP and this is a very

144
00:05:47,580 --> 00:05:49,440
bad decision yeah I can see on your

145
00:05:49,440 --> 00:05:50,820
faces you know it's a bad decision

146
00:05:50,820 --> 00:05:55,620
because now yes now if an attacker like

147
00:05:55,620 --> 00:05:58,139
myself can control the Json basically I

148
00:05:58,139 --> 00:06:00,900
can execute any PHP code that I want

149
00:06:00,900 --> 00:06:04,800
right cool so basically we read the code

150
00:06:04,800 --> 00:06:06,960
we see that the target was fetching and

151
00:06:06,960 --> 00:06:09,780
evaluating the Json and then we can use

152
00:06:09,780 --> 00:06:12,060
the local file read again to read the

153
00:06:12,060 --> 00:06:15,120
proc file system which gave us the

154
00:06:15,120 --> 00:06:17,220
addresses of the connection between the

155
00:06:17,220 --> 00:06:19,680
two servers right if you don't know

156
00:06:19,680 --> 00:06:23,160
about TCP injection uh it's a bit hard

157
00:06:23,160 --> 00:06:25,500
to explain but I'll do it in a second uh

158
00:06:25,500 --> 00:06:28,080
I want to send data inside the TCP

159
00:06:28,080 --> 00:06:30,180
connection I have to know five things

160
00:06:30,180 --> 00:06:32,460
the source address the destination

161
00:06:32,460 --> 00:06:34,020
address the source port and the

162
00:06:34,020 --> 00:06:36,240
destination Port of the connection and

163
00:06:36,240 --> 00:06:37,919
something called a sequence number and

164
00:06:37,919 --> 00:06:39,960
if you know all these things I can send

165
00:06:39,960 --> 00:06:43,020
any data I want if I have IPS proofing

166
00:06:43,020 --> 00:06:45,240
capabilities and to get all these things

167
00:06:45,240 --> 00:06:47,580
I can read the proc file system so this

168
00:06:47,580 --> 00:06:49,919
gives me the addresses and the ports and

169
00:06:49,919 --> 00:06:52,440
to infer the sequence number we used a

170
00:06:52,440 --> 00:06:55,080
very old bug in the Linux kernel that

171
00:06:55,080 --> 00:06:58,319
didn't have a cve it was fixed in 2012

172
00:06:58,319 --> 00:07:01,380
but the fix was not very widely deployed

173
00:07:01,380 --> 00:07:03,060
at the time because it didn't have a cve

174
00:07:03,060 --> 00:07:05,340
it's by this really really cool

175
00:07:05,340 --> 00:07:06,840
researcher that I don't know how to

176
00:07:06,840 --> 00:07:08,160
pronounce his name but it's very cool

177
00:07:08,160 --> 00:07:10,340
and check out his other work I'm sorry

178
00:07:10,340 --> 00:07:13,259
and we use all that and we use our IP

179
00:07:13,259 --> 00:07:14,819
spoofing capability with the TCP

180
00:07:14,819 --> 00:07:17,400
injection we injected a PHP code instead

181
00:07:17,400 --> 00:07:19,620
of the Json and

182
00:07:19,620 --> 00:07:23,340
we basically got an rce on the target so

183
00:07:23,340 --> 00:07:24,780
these are two examples in which IPS

184
00:07:24,780 --> 00:07:26,759
spoofing can be very very helpful and

185
00:07:26,759 --> 00:07:28,800
were helpful to me

186
00:07:28,800 --> 00:07:31,199
um so I'm not that smart I did not

187
00:07:31,199 --> 00:07:33,120
invent IP spoofing or TCP injection

188
00:07:33,120 --> 00:07:36,180
that's as old as IP I think and for this

189
00:07:36,180 --> 00:07:38,520
reason about 20 years ago or so the

190
00:07:38,520 --> 00:07:40,440
internet engineer test Force came with

191
00:07:40,440 --> 00:07:43,380
this guideline that said that internet

192
00:07:43,380 --> 00:07:46,020
service providers should filter uh

193
00:07:46,020 --> 00:07:47,940
should put firewall rules that will

194
00:07:47,940 --> 00:07:50,880
prevent this attack so this is these are

195
00:07:50,880 --> 00:07:54,539
quads from the uh bcp38 from this

196
00:07:54,539 --> 00:07:56,039
guideline and they want to defeat

197
00:07:56,039 --> 00:07:58,199
ipsource at a spoofing and they're

198
00:07:58,199 --> 00:08:00,120
telling the internet service providers

199
00:08:00,120 --> 00:08:02,520
Please block AP packets entering the

200
00:08:02,520 --> 00:08:04,199
internet which have Source IP address

201
00:08:04,199 --> 00:08:07,139
which are forged IP addresses that were

202
00:08:07,139 --> 00:08:09,720
not assigned to the device which is

203
00:08:09,720 --> 00:08:11,940
sending them because you're the ISP

204
00:08:11,940 --> 00:08:13,860
you're the one assigning the IP

205
00:08:13,860 --> 00:08:16,139
addresses to everyone connected by you

206
00:08:16,139 --> 00:08:18,720
so you know what is the correct IP

207
00:08:18,720 --> 00:08:20,340
address and if you see a device that's

208
00:08:20,340 --> 00:08:21,840
sending a packet with an IP address

209
00:08:21,840 --> 00:08:23,639
which is not the one that you assigned

210
00:08:23,639 --> 00:08:26,699
please drop them and basically everyone

211
00:08:26,699 --> 00:08:28,879
implemented

212
00:08:28,879 --> 00:08:31,919
this guideline I'm from Israel and

213
00:08:31,919 --> 00:08:35,339
Israel all the ISP implemented it I

214
00:08:35,339 --> 00:08:37,260
couldn't find an ISP that does not do

215
00:08:37,260 --> 00:08:39,899
eyepiece Ingress filtering all the cloud

216
00:08:39,899 --> 00:08:43,440
providers implemented it Google AWS I

217
00:08:43,440 --> 00:08:45,540
didn't check Azure but you can I believe

218
00:08:45,540 --> 00:08:47,040
they do it

219
00:08:47,040 --> 00:08:48,240
um

220
00:08:48,240 --> 00:08:51,120
and this is a bit annoying and you're

221
00:08:51,120 --> 00:08:52,560
probably asking yourself well but you

222
00:08:52,560 --> 00:08:54,420
just said you need IP spoofing in the

223
00:08:54,420 --> 00:08:56,580
last 10 years and the answer is

224
00:08:56,580 --> 00:08:58,740
complicated so in the first one I was

225
00:08:58,740 --> 00:09:00,480
lying I didn't actually do like this

226
00:09:00,480 --> 00:09:02,820
proofing I reported a vulnerability that

227
00:09:02,820 --> 00:09:05,100
could arise if eyepiece proofing is

228
00:09:05,100 --> 00:09:07,860
possible and the second one well

229
00:09:07,860 --> 00:09:10,200
so oh yeah there is this I forgot this

230
00:09:10,200 --> 00:09:12,000
that you shouldn't

231
00:09:12,000 --> 00:09:14,519
think about mitigations too highly but

232
00:09:14,519 --> 00:09:18,200
uh let's go on so in the second one uh

233
00:09:18,200 --> 00:09:22,080
the servers that I injected the Json or

234
00:09:22,080 --> 00:09:24,660
the PHP code didn't talk in ipv4 they

235
00:09:24,660 --> 00:09:27,000
were talking in IPv6 which is the

236
00:09:27,000 --> 00:09:29,160
leather version of the Internet Protocol

237
00:09:29,160 --> 00:09:31,620
and the thing now is that I did not have

238
00:09:31,620 --> 00:09:33,959
an IPv6 connection I only had ipv4

239
00:09:33,959 --> 00:09:36,480
connection so what I do I went on Google

240
00:09:36,480 --> 00:09:38,880
and wrote how can I send IPv6 packets if

241
00:09:38,880 --> 00:09:40,800
I only have ipv4 connection

242
00:09:40,800 --> 00:09:45,300
and the internet was very helpful and it

243
00:09:45,300 --> 00:09:48,600
gave me this uh IPv6 over ipv4 tunnel

244
00:09:48,600 --> 00:09:50,279
link server that after a short

245
00:09:50,279 --> 00:09:52,740
registration would let me send any IPv6

246
00:09:52,740 --> 00:09:55,140
packet that I wanted including the one

247
00:09:55,140 --> 00:09:56,640
that I wanted to spoof right because I

248
00:09:56,640 --> 00:10:00,060
was spoofing IP packets and in

249
00:10:00,060 --> 00:10:02,279
retrospect I realized that there was no

250
00:10:02,279 --> 00:10:05,640
filtering so this IPv6 tunneling broker

251
00:10:05,640 --> 00:10:07,680
did not did not filter my packets

252
00:10:07,680 --> 00:10:10,140
and that um

253
00:10:10,140 --> 00:10:12,959
led me to the very nice conclusion by

254
00:10:12,959 --> 00:10:14,519
the way if you like these things I have

255
00:10:14,519 --> 00:10:16,440
another Twitter account in which we post

256
00:10:16,440 --> 00:10:18,000
oh used to post this kind of

257
00:10:18,000 --> 00:10:20,700
inspirational quotes for exploiters so

258
00:10:20,700 --> 00:10:24,000
I'll put the link in the end but uh this

259
00:10:24,000 --> 00:10:26,339
uh led me to realize that sometimes it's

260
00:10:26,339 --> 00:10:28,200
not about what you actually trying to do

261
00:10:28,200 --> 00:10:29,580
but sometimes it's about the way right

262
00:10:29,580 --> 00:10:31,260
sometimes it's the things they're

263
00:10:31,260 --> 00:10:34,140
collect along the way and maybe there is

264
00:10:34,140 --> 00:10:36,360
a similar protocol or maybe there are

265
00:10:36,360 --> 00:10:38,040
more Brokers on the internet like the

266
00:10:38,040 --> 00:10:39,959
one that was doing this IPv6 brokering

267
00:10:39,959 --> 00:10:42,839
that would actually let me do ipv4

268
00:10:42,839 --> 00:10:45,360
brokering without filtering so I was

269
00:10:45,360 --> 00:10:47,339
checking out if there is an ipv4 over

270
00:10:47,339 --> 00:10:49,500
ipv4 and lo and behold there is an

271
00:10:49,500 --> 00:10:52,440
iPhone 4 over ipv4 protocol it's

272
00:10:52,440 --> 00:10:54,180
actually one of the oldest protocols

273
00:10:54,180 --> 00:10:57,420
over AP that existed you can check out

274
00:10:57,420 --> 00:10:59,600
all the existing protocols in slash Etc

275
00:10:59,600 --> 00:11:02,040
protocols on your Linux machine if you

276
00:11:02,040 --> 00:11:04,380
have one maybe not all of them but most

277
00:11:04,380 --> 00:11:07,920
of them and this ip4 over ipv4 was the

278
00:11:07,920 --> 00:11:10,079
first ever tunneling protocol it was

279
00:11:10,079 --> 00:11:12,720
like a very very primitive VPN

280
00:11:12,720 --> 00:11:15,899
and it has no authentication it's really

281
00:11:15,899 --> 00:11:18,180
impossible to set up because well I

282
00:11:18,180 --> 00:11:19,560
failed to set it up when I want to do

283
00:11:19,560 --> 00:11:23,100
some testing and this should be extinct

284
00:11:23,100 --> 00:11:25,079
because today we have much better

285
00:11:25,079 --> 00:11:27,779
Alternatives uh we have I don't know

286
00:11:27,779 --> 00:11:29,940
wire guard for vpns right we don't need

287
00:11:29,940 --> 00:11:33,839
ipu for over ipo4 but I decided to

288
00:11:33,839 --> 00:11:37,440
research this so how do you start such a

289
00:11:37,440 --> 00:11:39,959
research well first thing you do is how

290
00:11:39,959 --> 00:11:41,820
do you send a simple IP packet right so

291
00:11:41,820 --> 00:11:43,500
this is a

292
00:11:43,500 --> 00:11:46,980
escapee package for python that lets you

293
00:11:46,980 --> 00:11:49,320
send some IP packets very easily so if

294
00:11:49,320 --> 00:11:51,300
you've seen this vertex first example I

295
00:11:51,300 --> 00:11:53,640
just defined an AP packet I say the

296
00:11:53,640 --> 00:11:55,140
destination is where I want to send my

297
00:11:55,140 --> 00:11:57,300
packet 999 is the address I want to send

298
00:11:57,300 --> 00:11:59,339
the packet to then I stack some data

299
00:11:59,339 --> 00:12:01,140
over it using the slash like the

300
00:12:01,140 --> 00:12:03,120
protocol stacking operator and then I

301
00:12:03,120 --> 00:12:05,459
send it and if I want to do IP spoofing

302
00:12:05,459 --> 00:12:07,860
right so let's say one two three four is

303
00:12:07,860 --> 00:12:10,140
a server is it's a like a broker that

304
00:12:10,140 --> 00:12:13,320
would do IP over IP for me then I can

305
00:12:13,320 --> 00:12:16,079
send a packet and you see the first

306
00:12:16,079 --> 00:12:18,300
packet is the same but this time I I'm

307
00:12:18,300 --> 00:12:20,820
writing that the source address is the

308
00:12:20,820 --> 00:12:23,519
broker broker's address and the second

309
00:12:23,519 --> 00:12:25,920
packet is the one carrying the former

310
00:12:25,920 --> 00:12:28,980
packet and this one would be sent to the

311
00:12:28,980 --> 00:12:31,320
broker and the destination address is

312
00:12:31,320 --> 00:12:34,920
the ipip service and just sending these

313
00:12:34,920 --> 00:12:37,200
two one on top of the other would do the

314
00:12:37,200 --> 00:12:39,300
trick I'll share this soon in the demo

315
00:12:39,300 --> 00:12:42,480
but this would fail right because now I

316
00:12:42,480 --> 00:12:45,720
am filtered by my SP by my Google by my

317
00:12:45,720 --> 00:12:48,959
cloud provider by someone but uh we can

318
00:12:48,959 --> 00:12:51,240
do this and we can just scan

319
00:12:51,240 --> 00:12:54,060
for look for Brokers that exist in the

320
00:12:54,060 --> 00:12:55,980
wild and

321
00:12:55,980 --> 00:12:58,500
two questions come to mind like which

322
00:12:58,500 --> 00:13:00,180
addresses should we scan where should we

323
00:13:00,180 --> 00:13:01,740
look for such brokers

324
00:13:01,740 --> 00:13:03,060
and

325
00:13:03,060 --> 00:13:05,760
how do we know that we actually found a

326
00:13:05,760 --> 00:13:07,620
broker right how do how can we tell that

327
00:13:07,620 --> 00:13:09,060
and the answers are quite

328
00:13:09,060 --> 00:13:11,100
straightforward so

329
00:13:11,100 --> 00:13:12,420
um we should scan the entire internet

330
00:13:12,420 --> 00:13:15,360
there are like four billion addresses

331
00:13:15,360 --> 00:13:18,000
that's not so much uh at least in ipv4

332
00:13:18,000 --> 00:13:19,860
it's not so much and the success

333
00:13:19,860 --> 00:13:21,839
indication is also quite easy I mean

334
00:13:21,839 --> 00:13:26,639
it's the server can just reply with the

335
00:13:26,639 --> 00:13:28,500
hey we can just ask the server the

336
00:13:28,500 --> 00:13:30,240
broker to send the packet back to us

337
00:13:30,240 --> 00:13:32,339
this is how we will know that actually

338
00:13:32,339 --> 00:13:34,860
the server is doing what we asked it to

339
00:13:34,860 --> 00:13:37,860
do okay cool

340
00:13:37,860 --> 00:13:38,820
um

341
00:13:38,820 --> 00:13:42,540
so I wrote this uh

342
00:13:42,540 --> 00:13:44,459
basically probe model in a project

343
00:13:44,459 --> 00:13:47,279
called zmap zmap is a very nice

344
00:13:47,279 --> 00:13:50,220
project for scanning the internet if you

345
00:13:50,220 --> 00:13:52,139
want to scan for some vulnerabilities or

346
00:13:52,139 --> 00:13:52,940
stuff

347
00:13:52,940 --> 00:13:56,220
and I wrote this prop module and if you

348
00:13:56,220 --> 00:13:57,779
have a nice direct access to the

349
00:13:57,779 --> 00:13:59,279
internet I mean you shouldn't do it from

350
00:13:59,279 --> 00:14:01,380
a private Network like here but maybe

351
00:14:01,380 --> 00:14:04,560
from uh I don't know uh Google Virtual

352
00:14:04,560 --> 00:14:06,600
Machine like a gcp Google Cloud virtual

353
00:14:06,600 --> 00:14:08,639
machine can work well and you have a

354
00:14:08,639 --> 00:14:10,320
reasonable bandwidth then you can just

355
00:14:10,320 --> 00:14:12,480
scan the internet in a few days

356
00:14:12,480 --> 00:14:13,980
and

357
00:14:13,980 --> 00:14:17,760
yeah so I first started with my first

358
00:14:17,760 --> 00:14:21,000
setup and I have a very old router at

359
00:14:21,000 --> 00:14:23,040
home or I used to have it two years ago

360
00:14:23,040 --> 00:14:26,459
that was from 2010 and it runs open WT

361
00:14:26,459 --> 00:14:29,160
so I just compiled zemup with my custom

362
00:14:29,160 --> 00:14:32,639
module to this openwt my ISP was not

363
00:14:32,639 --> 00:14:34,260
complaining it's very relaxed I don't

364
00:14:34,260 --> 00:14:37,440
think anyone is monitoring IP layers so

365
00:14:37,440 --> 00:14:39,300
I think the only monitoring there is on

366
00:14:39,300 --> 00:14:41,519
the Internet is in the fourth layer so

367
00:14:41,519 --> 00:14:45,060
TCP or UDP or I don't know satp but and

368
00:14:45,060 --> 00:14:47,519
when I was scanning the internet in this

369
00:14:47,519 --> 00:14:49,680
layer in in layer 4 I got many

370
00:14:49,680 --> 00:14:51,240
complaints but if you're scanning the

371
00:14:51,240 --> 00:14:53,279
internet for a layer 3 that's awesome

372
00:14:53,279 --> 00:14:55,800
nobody cares okay so go ahead and do it

373
00:14:55,800 --> 00:15:00,420
and yeah but there is just one minor

374
00:15:00,420 --> 00:15:02,160
problem that my girlfriend was pissed

375
00:15:02,160 --> 00:15:04,380
because I was choking the internet and I

376
00:15:04,380 --> 00:15:06,480
cannot deprive her from Netflix Netflix

377
00:15:06,480 --> 00:15:09,600
for five days so this didn't fly

378
00:15:09,600 --> 00:15:11,820
so I came up with a better setup and

379
00:15:11,820 --> 00:15:15,300
this was a Google Cloud right why is the

380
00:15:15,300 --> 00:15:19,560
title so small well anyway uh so Google

381
00:15:19,560 --> 00:15:23,060
Cloud basically you do get an IP address

382
00:15:23,060 --> 00:15:25,860
but you get an internal IP address and

383
00:15:25,860 --> 00:15:28,260
there is a small problem with that zbop

384
00:15:28,260 --> 00:15:29,760
doesn't really like to scan from

385
00:15:29,760 --> 00:15:31,500
internal addresses because they're

386
00:15:31,500 --> 00:15:33,060
trying to do uh when you're trying to

387
00:15:33,060 --> 00:15:35,040
reach Exton addresses so it's a small

388
00:15:35,040 --> 00:15:37,139
complication I won't go much into

389
00:15:37,139 --> 00:15:38,940
details but the thing is you can bypass

390
00:15:38,940 --> 00:15:41,519
this complication by spoofing your own

391
00:15:41,519 --> 00:15:44,399
external address so I think what happens

392
00:15:44,399 --> 00:15:46,740
I didn't verify it but you have two

393
00:15:46,740 --> 00:15:48,120
parts there do you have the network

394
00:15:48,120 --> 00:15:50,220
address translation that translates your

395
00:15:50,220 --> 00:15:52,440
internal IP address that you get in the

396
00:15:52,440 --> 00:15:54,420
Google Network or in your private

397
00:15:54,420 --> 00:15:56,699
virtual Network within Google cloud and

398
00:15:56,699 --> 00:15:58,019
then there is the external IP address

399
00:15:58,019 --> 00:16:00,660
your ephemeral address and there is the

400
00:16:00,660 --> 00:16:02,579
address translator that translates from

401
00:16:02,579 --> 00:16:04,260
the internal address to the external

402
00:16:04,260 --> 00:16:06,240
address and after that I think there is

403
00:16:06,240 --> 00:16:08,459
the firewall that actually drops packets

404
00:16:08,459 --> 00:16:11,160
if you're trying to spoof packets and if

405
00:16:11,160 --> 00:16:12,660
you're spoofing your own external

406
00:16:12,660 --> 00:16:14,399
address there is no problem because the

407
00:16:14,399 --> 00:16:16,680
first part the address translator will

408
00:16:16,680 --> 00:16:18,240
not translate anything because the

409
00:16:18,240 --> 00:16:20,639
source AP use an external IP and the

410
00:16:20,639 --> 00:16:21,839
second part of the firewall will not

411
00:16:21,839 --> 00:16:23,519
drop the packet because it originates

412
00:16:23,519 --> 00:16:26,040
from your own IP address which you're

413
00:16:26,040 --> 00:16:28,199
allowed to send packets from so that's

414
00:16:28,199 --> 00:16:31,800
cool and basically I started scanning

415
00:16:31,800 --> 00:16:32,699
the internet

416
00:16:32,699 --> 00:16:37,440
and I failed completely because

417
00:16:37,440 --> 00:16:38,759
um well

418
00:16:38,759 --> 00:16:41,040
I just didn't get any results

419
00:16:41,040 --> 00:16:45,060
and that that sucked but uh I asked a

420
00:16:45,060 --> 00:16:48,600
friend I I asked the pocg Defoe the

421
00:16:48,600 --> 00:16:50,339
geyser if they want me to write a paper

422
00:16:50,339 --> 00:16:53,160
about failed attempts and they said yeah

423
00:16:53,160 --> 00:16:54,839
sure just make sure everything works as

424
00:16:54,839 --> 00:16:57,720
you as you want and you know just do do

425
00:16:57,720 --> 00:17:00,420
the paper properly and I said yeah sure

426
00:17:00,420 --> 00:17:01,920
so ask the friend to go over it and he

427
00:17:01,920 --> 00:17:04,380
said have you ever tried to set up a

428
00:17:04,380 --> 00:17:06,780
real Target that is actually vulnerable

429
00:17:06,780 --> 00:17:08,760
and see if you find it and I said well

430
00:17:08,760 --> 00:17:11,520
no I'm I'm a hacker I'm not doing tests

431
00:17:11,520 --> 00:17:13,319
and he said well you should you should

432
00:17:13,319 --> 00:17:15,419
doing tests so he put up this kind of

433
00:17:15,419 --> 00:17:17,640
server and lo and behold he didn't find

434
00:17:17,640 --> 00:17:19,760
it because because I had a horrible bug

435
00:17:19,760 --> 00:17:23,280
so I sat there I fixed the bug with this

436
00:17:23,280 --> 00:17:25,559
the help of this friend and then I got

437
00:17:25,559 --> 00:17:29,460
tons of results okay so um maybe another

438
00:17:29,460 --> 00:17:31,380
lesson is just you know even if you're a

439
00:17:31,380 --> 00:17:33,179
hacker and you think highly of your code

440
00:17:33,179 --> 00:17:36,600
don't I'm a terrible code writer so you

441
00:17:36,600 --> 00:17:38,340
should always test your code

442
00:17:38,340 --> 00:17:39,660
and um

443
00:17:39,660 --> 00:17:41,400
well before we talk about the findings

444
00:17:41,400 --> 00:17:43,860
let's do a short demo and I I'll show

445
00:17:43,860 --> 00:17:45,960
you how this looks like

446
00:17:45,960 --> 00:17:50,280
so pray to the demo God and okay we have

447
00:17:50,280 --> 00:17:54,059
this we have this okay this is my uh

448
00:17:54,059 --> 00:17:57,059
this would be my Victim this is my uh

449
00:17:57,059 --> 00:17:59,700
Google my VM in Google cloud and you can

450
00:17:59,700 --> 00:18:02,100
see this is the its address and now

451
00:18:02,100 --> 00:18:04,080
let's do some TCP dump and we're

452
00:18:04,080 --> 00:18:07,080
listening on Port 5353 and here we're

453
00:18:07,080 --> 00:18:09,419
gonna send a normal packet no spoofing

454
00:18:09,419 --> 00:18:12,179
nothing complicated just a normal packet

455
00:18:12,179 --> 00:18:16,380
okay so don't look at my code created my

456
00:18:16,380 --> 00:18:18,299
password and we're sending this packet

457
00:18:18,299 --> 00:18:20,280
and you can see this packet has arrived

458
00:18:20,280 --> 00:18:23,880
safely that's great now let's do some IP

459
00:18:23,880 --> 00:18:27,120
spoofing okay so you don't see but I'm

460
00:18:27,120 --> 00:18:30,179
going to send a spoofed packet and you

461
00:18:30,179 --> 00:18:33,059
can see that I stacked at wait this is

462
00:18:33,059 --> 00:18:35,039
not spoofing

463
00:18:35,039 --> 00:18:37,380
uh where is spoofing

464
00:18:37,380 --> 00:18:39,860
sorry

465
00:18:41,820 --> 00:18:45,439
I'm sorry for that

466
00:18:46,320 --> 00:18:49,500
so let's say that I'm spoofing oh wait

467
00:18:49,500 --> 00:18:51,539
it is spoofing what am I doing sorry it

468
00:18:51,539 --> 00:18:52,799
is spoofing you see the source address

469
00:18:52,799 --> 00:18:55,020
is one two three four right

470
00:18:55,020 --> 00:18:57,419
so I'm just trying to spoof source

471
00:18:57,419 --> 00:18:59,220
editors1234 which is not my address

472
00:18:59,220 --> 00:19:01,380
let's send it and you see that nothing

473
00:19:01,380 --> 00:19:03,299
happened as expected because Google just

474
00:19:03,299 --> 00:19:06,419
dropped it okay now we're gonna do

475
00:19:06,419 --> 00:19:08,640
something nice we're going to scan the

476
00:19:08,640 --> 00:19:11,400
internet from this machine okay so I'm

477
00:19:11,400 --> 00:19:14,700
running my own custom zmap and all these

478
00:19:14,700 --> 00:19:17,280
parameters are tuning to make this can

479
00:19:17,280 --> 00:19:20,640
go fast on this specific machine

480
00:19:20,640 --> 00:19:23,760
but well you can see that it is running

481
00:19:23,760 --> 00:19:25,679
and if we're checking the results you

482
00:19:25,679 --> 00:19:27,720
can see it's actually finding some IPS

483
00:19:27,720 --> 00:19:30,179
great

484
00:19:30,179 --> 00:19:34,100
so now let's take all these IPS

485
00:19:35,100 --> 00:19:36,780
all right

486
00:19:36,780 --> 00:19:39,840
and let's put them in this script

487
00:19:39,840 --> 00:19:43,140
that is actually okay what this script

488
00:19:43,140 --> 00:19:45,780
does is that it's going to use every one

489
00:19:45,780 --> 00:19:47,960
of the IPS we just found in the search

490
00:19:47,960 --> 00:19:52,380
and ask them to do ipas and send them an

491
00:19:52,380 --> 00:19:55,679
ipip packet that is the spoof packet

492
00:19:55,679 --> 00:19:58,919
over ipip Okay so let's do it and

493
00:19:58,919 --> 00:20:01,860
well we're kind of lucky because as you

494
00:20:01,860 --> 00:20:03,480
can see the one two three four is the

495
00:20:03,480 --> 00:20:05,340
source address which is not our source

496
00:20:05,340 --> 00:20:08,460
address so that was the demo

497
00:20:08,460 --> 00:20:11,460
it works even in by the way this is

498
00:20:11,460 --> 00:20:13,980
yeah sorry

499
00:20:13,980 --> 00:20:17,940
yeah so this was in the oh great

500
00:20:17,940 --> 00:20:21,179
this was in the conference Network so

501
00:20:21,179 --> 00:20:22,440
yeah

502
00:20:22,440 --> 00:20:23,820
it works from here you can do it from

503
00:20:23,820 --> 00:20:28,020
here okay so findings so there are about

504
00:20:28,020 --> 00:20:31,679
one there were about 150 000 hosts that

505
00:20:31,679 --> 00:20:33,960
support this protocol that's nice that's

506
00:20:33,960 --> 00:20:36,179
a lot I don't think any of them will

507
00:20:36,179 --> 00:20:37,760
shut down soon

508
00:20:37,760 --> 00:20:40,140
and most of them can do eyepiece

509
00:20:40,140 --> 00:20:42,059
spoofing as I just showed it so not all

510
00:20:42,059 --> 00:20:43,559
of them are vulnerable to Epic school

511
00:20:43,559 --> 00:20:45,600
things some of them has filtering but

512
00:20:45,600 --> 00:20:48,059
some of them don't and I don't really

513
00:20:48,059 --> 00:20:50,580
know why and I can only guess but my

514
00:20:50,580 --> 00:20:52,380
guess is that most of them are kind of

515
00:20:52,380 --> 00:20:55,200
deep Internet devices that don't have

516
00:20:55,200 --> 00:20:56,700
firewall they're just passing packets

517
00:20:56,700 --> 00:20:58,380
around from here to there and they don't

518
00:20:58,380 --> 00:21:00,480
have or they're their own ISP or they

519
00:21:00,480 --> 00:21:02,220
don't have an ISP but probably people

520
00:21:02,220 --> 00:21:03,780
that understand internet better than I

521
00:21:03,780 --> 00:21:07,220
am can tell you a bit more about it

522
00:21:07,220 --> 00:21:10,260
uh another cool thing we can do except

523
00:21:10,260 --> 00:21:12,720
IP spoofing which is glue on its own is

524
00:21:12,720 --> 00:21:15,480
spoof private Network so

525
00:21:15,480 --> 00:21:19,679
um some of the ranges of addresses of Ip

526
00:21:19,679 --> 00:21:21,480
are reserved for private networks So

527
00:21:21,480 --> 00:21:24,539
within uh your Wi-Fi or cafe or

528
00:21:24,539 --> 00:21:26,480
something you'll get addresses that are

529
00:21:26,480 --> 00:21:31,020
192 or uh one 172 or something like this

530
00:21:31,020 --> 00:21:33,000
they are private networks and maybe you

531
00:21:33,000 --> 00:21:36,000
and I will have the same private address

532
00:21:36,000 --> 00:21:38,820
on our private networks and we cannot

533
00:21:38,820 --> 00:21:40,140
reach each other each other over the

534
00:21:40,140 --> 00:21:41,340
Internet Because the Internet should not

535
00:21:41,340 --> 00:21:42,200
forward

536
00:21:42,200 --> 00:21:45,960
packets that have their Source AP uh

537
00:21:45,960 --> 00:21:48,539
being a private address and not internet

538
00:21:48,539 --> 00:21:50,640
address okay these packets are called

539
00:21:50,640 --> 00:21:52,380
Martian packets because they should not

540
00:21:52,380 --> 00:21:53,640
travel the internet I don't know who

541
00:21:53,640 --> 00:21:56,159
came up with the name Martian but with

542
00:21:56,159 --> 00:21:58,760
these with some of these uh vulnerable

543
00:21:58,760 --> 00:22:01,799
machines they actually forward uh

544
00:22:01,799 --> 00:22:04,260
internal IP addresses or private IP

545
00:22:04,260 --> 00:22:06,720
addresses I even saw some of them for

546
00:22:06,720 --> 00:22:10,740
the uh the 127 so this is localhost so

547
00:22:10,740 --> 00:22:12,120
you can actually spoof vocal host yeah

548
00:22:12,120 --> 00:22:13,400
that's cool right

549
00:22:13,400 --> 00:22:15,659
I agree

550
00:22:15,659 --> 00:22:18,120
um I couldn't get the packet back to me

551
00:22:18,120 --> 00:22:20,460
because my ISP was actually filtering

552
00:22:20,460 --> 00:22:22,320
Martian packets but what I did I was

553
00:22:22,320 --> 00:22:24,720
forwarding a packet from a vulnerable IP

554
00:22:24,720 --> 00:22:27,000
over IP to a vulnerable machine back to

555
00:22:27,000 --> 00:22:29,700
me and I and the link in between had a

556
00:22:29,700 --> 00:22:31,440
spoofed martian package so this is how I

557
00:22:31,440 --> 00:22:32,940
knew they're actually forwarding this

558
00:22:32,940 --> 00:22:34,740
stuff this is the code you can see on

559
00:22:34,740 --> 00:22:36,539
your right

560
00:22:36,539 --> 00:22:38,159
um another thing is that sometimes

561
00:22:38,159 --> 00:22:40,020
people actually trust their internal

562
00:22:40,020 --> 00:22:41,940
like the private addresses they don't

563
00:22:41,940 --> 00:22:44,700
trust the internet but you know 127 is

564
00:22:44,700 --> 00:22:46,080
your Local Host so usually you don't

565
00:22:46,080 --> 00:22:48,179
authenticate localhost so there's some

566
00:22:48,179 --> 00:22:49,679
attacks that you can actually carry out

567
00:22:49,679 --> 00:22:52,200
if you can spoof internal IP addresses

568
00:22:52,200 --> 00:22:54,059
so that's cool

569
00:22:54,059 --> 00:22:56,520
um last thing that was quite cool is

570
00:22:56,520 --> 00:22:59,520
that I accidentally found a packet of

571
00:22:59,520 --> 00:23:01,860
death so what happened is that I

572
00:23:01,860 --> 00:23:03,960
reported a vulnerability Cisco they said

573
00:23:03,960 --> 00:23:05,940
they don't have they don't know if any

574
00:23:05,940 --> 00:23:09,419
openip over IP uh devices that they have

575
00:23:09,419 --> 00:23:11,400
and I said okay and then I was talking

576
00:23:11,400 --> 00:23:14,159
again to the guys at POC GTFO and told

577
00:23:14,159 --> 00:23:15,600
them hey I would like to submit a paper

578
00:23:15,600 --> 00:23:17,760
this time of paper that actually does

579
00:23:17,760 --> 00:23:20,400
something that works and as the name

580
00:23:20,400 --> 00:23:24,059
implies PLC GTFO requires a POC so I

581
00:23:24,059 --> 00:23:25,799
thought what would be the coolest POC

582
00:23:25,799 --> 00:23:27,419
that they can come up with and I thought

583
00:23:27,419 --> 00:23:29,880
well I can do IP over AP why not over IP

584
00:23:29,880 --> 00:23:33,240
over AP and do it recursively and

585
00:23:33,240 --> 00:23:35,220
in this way I can actually travel the

586
00:23:35,220 --> 00:23:38,159
internet more than 255 times which is

587
00:23:38,159 --> 00:23:40,740
for a normal packet yeah for a normal

588
00:23:40,740 --> 00:23:43,500
Factor this is the maximum time to live

589
00:23:43,500 --> 00:23:45,120
right if a packet travels in terms of

590
00:23:45,120 --> 00:23:47,580
more than 255 hops it should be dropped

591
00:23:47,580 --> 00:23:49,679
but if you're having an IP over a p

592
00:23:49,679 --> 00:23:52,799
every layer has its own time to live so

593
00:23:52,799 --> 00:23:56,400
I actually uh build this uh uh more than

594
00:23:56,400 --> 00:23:59,880
350 layers of past the parcels game of

595
00:23:59,880 --> 00:24:01,200
the internet and it's cool and you can

596
00:24:01,200 --> 00:24:02,760
do it too if you want I'll give you the

597
00:24:02,760 --> 00:24:04,919
code that does it it's a bit uh it's not

598
00:24:04,919 --> 00:24:07,200
polished so I didn't feel right to

599
00:24:07,200 --> 00:24:08,580
publish it but if you want I'll just

600
00:24:08,580 --> 00:24:12,000
send it to you just mainly and then I

601
00:24:12,000 --> 00:24:13,799
got this nice email from the guys at

602
00:24:13,799 --> 00:24:15,360
Cisco saying you know we do actually

603
00:24:15,360 --> 00:24:17,880
have vulnerability and it's not the ipip

604
00:24:17,880 --> 00:24:20,400
thing is that you're crashing our

605
00:24:20,400 --> 00:24:21,840
devices

606
00:24:21,840 --> 00:24:24,000
um so please stop doing your tests or

607
00:24:24,000 --> 00:24:26,159
something yeah I said I'm sorry and I I

608
00:24:26,159 --> 00:24:29,340
stopped but it was quite funny

609
00:24:29,340 --> 00:24:32,100
um so that for the findings and now

610
00:24:32,100 --> 00:24:33,600
we're gonna talk about the disclosure

611
00:24:33,600 --> 00:24:35,940
this is the part you all came here for

612
00:24:35,940 --> 00:24:39,900
right yeah great okay so disclosure

613
00:24:39,900 --> 00:24:42,419
um of this kind of vulnerability or it's

614
00:24:42,419 --> 00:24:43,980
a misconfiguration I don't know how you

615
00:24:43,980 --> 00:24:45,419
would call it but it's it's kind of a

616
00:24:45,419 --> 00:24:47,880
hell because all you have to go by is

617
00:24:47,880 --> 00:24:49,860
the IP address and as we know IP address

618
00:24:49,860 --> 00:24:51,900
does not mean you know who the owner is

619
00:24:51,900 --> 00:24:54,059
or what the device or operating system

620
00:24:54,059 --> 00:24:56,400
is right it can be in the DMZ it can be

621
00:24:56,400 --> 00:24:58,320
something that only forwards packets to

622
00:24:58,320 --> 00:24:59,880
somewhere and if you're trying to

623
00:24:59,880 --> 00:25:00,960
fingerprint it you're actually

624
00:25:00,960 --> 00:25:03,360
fingerprint the machine behind it to

625
00:25:03,360 --> 00:25:05,700
which it forwards packets but the IP of

626
00:25:05,700 --> 00:25:07,980
AP happens in layer 3 it happens in the

627
00:25:07,980 --> 00:25:09,900
kernel so you don't really know what

628
00:25:09,900 --> 00:25:12,960
your fingerprinting exactly there was

629
00:25:12,960 --> 00:25:15,659
one fax I I didn't put it up just for

630
00:25:15,659 --> 00:25:17,940
the joke there is some Samsung printer

631
00:25:17,940 --> 00:25:20,580
that was later bought but by HP and some

632
00:25:20,580 --> 00:25:22,020
University connected it to the internet

633
00:25:22,020 --> 00:25:24,120
and it was actually vulnerable to this

634
00:25:24,120 --> 00:25:25,679
so it exists

635
00:25:25,679 --> 00:25:28,440
and also scanning the entire internet

636
00:25:28,440 --> 00:25:30,299
takes time and it's expensive and

637
00:25:30,299 --> 00:25:32,400
whatever so this yeah two guys really

638
00:25:32,400 --> 00:25:34,799
helped me uh Larry cashler that was

639
00:25:34,799 --> 00:25:36,720
working in Akamai security I reached out

640
00:25:36,720 --> 00:25:38,880
and asked for help for someone that you

641
00:25:38,880 --> 00:25:40,260
know some of the internet stakeholders

642
00:25:40,260 --> 00:25:42,840
so Akamai is an internet stakeholder I

643
00:25:42,840 --> 00:25:45,059
think and they helped me to scan the

644
00:25:45,059 --> 00:25:47,940
entire internet so the list of 150 000

645
00:25:47,940 --> 00:25:51,960
IP addresses came from uh Akamai and

646
00:25:51,960 --> 00:25:54,120
they also got me in contact with sir CC

647
00:25:54,120 --> 00:25:56,400
so this guy Vijay from sourcese helped

648
00:25:56,400 --> 00:25:58,500
me to disclose the vulnerabilities to

649
00:25:58,500 --> 00:26:00,480
various companies

650
00:26:00,480 --> 00:26:04,260
and let's talk about how that went so I

651
00:26:04,260 --> 00:26:05,940
started with Diggy because they're the

652
00:26:05,940 --> 00:26:07,860
biggest if they have the biggest share

653
00:26:07,860 --> 00:26:10,020
of vulnerable machines that they found

654
00:26:10,020 --> 00:26:12,840
and could identify they think about had

655
00:26:12,840 --> 00:26:15,240
a 10 000 or so machines they're doing

656
00:26:15,240 --> 00:26:18,240
some kind of cell or ISP or something

657
00:26:18,240 --> 00:26:20,220
like that maybe it's not 10 000 maybe

658
00:26:20,220 --> 00:26:21,419
it's one thousand I don't know I'm

659
00:26:21,419 --> 00:26:23,159
messing up with numbers but they had the

660
00:26:23,159 --> 00:26:25,860
biggest share okay and they were very

661
00:26:25,860 --> 00:26:27,900
professional in you know letting me test

662
00:26:27,900 --> 00:26:29,340
the vulnerability on a default

663
00:26:29,340 --> 00:26:31,980
configuration and talk to me but

664
00:26:31,980 --> 00:26:34,080
um they didn't tell me how the

665
00:26:34,080 --> 00:26:35,760
vulnerability came to be I mean I guess

666
00:26:35,760 --> 00:26:38,400
they ripped up they ripped off some open

667
00:26:38,400 --> 00:26:40,020
source code from somewhere but they

668
00:26:40,020 --> 00:26:42,240
didn't tell me from where maybe some BSD

669
00:26:42,240 --> 00:26:44,340
or something and they promised the

670
00:26:44,340 --> 00:26:46,980
Bounty but they had run into some

671
00:26:46,980 --> 00:26:49,799
legalese issues and I never heard from

672
00:26:49,799 --> 00:26:52,140
them again so and they were the best by

673
00:26:52,140 --> 00:26:54,539
the way so next came up Cisco so I

674
00:26:54,539 --> 00:26:56,220
already told you what went down with

675
00:26:56,220 --> 00:26:57,720
them so first they deny they have

676
00:26:57,720 --> 00:26:59,159
vulnerability of course they don't have

677
00:26:59,159 --> 00:27:01,620
vulnerability okay great I mean I only

678
00:27:01,620 --> 00:27:03,480
have an IP so I can't be really sure

679
00:27:03,480 --> 00:27:05,940
it's a Cisco device right so I said okay

680
00:27:05,940 --> 00:27:08,460
whatever and then when their machine

681
00:27:08,460 --> 00:27:10,260
started crashing they they came back and

682
00:27:10,260 --> 00:27:12,000
said you know we do have a vulnerability

683
00:27:12,000 --> 00:27:14,279
that's cool but and then I found out

684
00:27:14,279 --> 00:27:15,840
that Cisco does not have about the

685
00:27:15,840 --> 00:27:18,059
program at all so yeah that was weird

686
00:27:18,059 --> 00:27:19,740
and I'm not going to make assumptions

687
00:27:19,740 --> 00:27:22,620
about Cisco's code quality even this uh

688
00:27:22,620 --> 00:27:26,039
lack of bounty program but that was it

689
00:27:26,039 --> 00:27:28,320
um HP were the worst they failed to

690
00:27:28,320 --> 00:27:30,840
communicate over pgp they asked me to um

691
00:27:30,840 --> 00:27:33,480
they told me that I should ask them for

692
00:27:33,480 --> 00:27:35,880
the private pgp key over mail which kind

693
00:27:35,880 --> 00:27:38,760
of defeats the purpose exactly exactly

694
00:27:38,760 --> 00:27:41,000
my response exactly thank you very much

695
00:27:41,000 --> 00:27:43,440
and also they don't have I think a

696
00:27:43,440 --> 00:27:46,440
bounty program so that was HP if there

697
00:27:46,440 --> 00:27:48,059
is anyone from HP here in the crowd I'm

698
00:27:48,059 --> 00:27:49,860
sorry but uh you should you should get

699
00:27:49,860 --> 00:27:51,900
this work I I want to say something I

700
00:27:51,900 --> 00:27:53,640
think

701
00:27:53,640 --> 00:27:56,279
if these companies are really

702
00:27:56,279 --> 00:27:58,440
some management problems so if there is

703
00:27:58,440 --> 00:27:59,880
someone from the management that can

704
00:27:59,880 --> 00:28:02,580
actually fix that I mean they should but

705
00:28:02,580 --> 00:28:06,059
I'm preaching the choir right okay

706
00:28:06,059 --> 00:28:09,000
so um last thing was a hacker one

707
00:28:09,000 --> 00:28:10,620
they're actually running Bounty programs

708
00:28:10,620 --> 00:28:12,240
I thought that would go much better

709
00:28:12,240 --> 00:28:14,039
right and they do have a bounty program

710
00:28:14,039 --> 00:28:15,840
called the internet volunteer program

711
00:28:15,840 --> 00:28:18,900
and this program was designed for this

712
00:28:18,900 --> 00:28:20,460
kind of bugs that affect the entire

713
00:28:20,460 --> 00:28:23,340
internet as a whole and I think this it

714
00:28:23,340 --> 00:28:25,799
kind of applies in my case so I send

715
00:28:25,799 --> 00:28:28,140
them a report after submitting and

716
00:28:28,140 --> 00:28:29,840
disclosing and everything

717
00:28:29,840 --> 00:28:33,480
and for a year nobody read my report so

718
00:28:33,480 --> 00:28:35,820
this didn't work at all and after a year

719
00:28:35,820 --> 00:28:37,500
they shut down the program they gave me

720
00:28:37,500 --> 00:28:39,120
a few hundreds of dollars which was the

721
00:28:39,120 --> 00:28:40,860
lowest amount they would pay for a valid

722
00:28:40,860 --> 00:28:43,679
submission and that that was about it so

723
00:28:43,679 --> 00:28:46,340
my set conclusion from the disclosure

724
00:28:46,340 --> 00:28:49,679
procedure process is that it's it's it

725
00:28:49,679 --> 00:28:51,659
sucks I mean

726
00:28:51,659 --> 00:28:53,640
want to disclose vulnerabilities because

727
00:28:53,640 --> 00:28:55,500
you're a good guy or because you want to

728
00:28:55,500 --> 00:28:57,539
talk about it afterwards like I do now

729
00:28:57,539 --> 00:28:59,340
or whatever that's cool but if you're

730
00:28:59,340 --> 00:29:01,860
expecting some Bounty or any recognition

731
00:29:01,860 --> 00:29:03,299
of any sort well

732
00:29:03,299 --> 00:29:05,340
good luck with that

733
00:29:05,340 --> 00:29:08,039
um don't don't base your your income on

734
00:29:08,039 --> 00:29:10,500
bounties that's a bad idea

735
00:29:10,500 --> 00:29:11,840
okay

736
00:29:11,840 --> 00:29:15,299
uh so the last part what kind of uh what

737
00:29:15,299 --> 00:29:18,779
the future holds so uh I S I said that I

738
00:29:18,779 --> 00:29:21,779
was doing it in my free time and uh you

739
00:29:21,779 --> 00:29:23,940
can do too I would be happy to share

740
00:29:23,940 --> 00:29:26,460
other stuff with you and the things I

741
00:29:26,460 --> 00:29:28,380
would like to do or see other people do

742
00:29:28,380 --> 00:29:30,360
with this research is actually set up a

743
00:29:30,360 --> 00:29:32,220
full TCP connection into an internal

744
00:29:32,220 --> 00:29:34,679
Network so the thing is that I don't

745
00:29:34,679 --> 00:29:36,960
know exactly what are these vulnerable

746
00:29:36,960 --> 00:29:38,340
machines are it's really hard to

747
00:29:38,340 --> 00:29:40,260
fingerprint them so if you do know and

748
00:29:40,260 --> 00:29:41,460
you know there is an internal Network

749
00:29:41,460 --> 00:29:43,380
behind them maybe you can try and do

750
00:29:43,380 --> 00:29:45,600
some full TCP handshake like kind of

751
00:29:45,600 --> 00:29:47,159
blind TCP handshake because they're not

752
00:29:47,159 --> 00:29:49,500
getting the responses right but if you

753
00:29:49,500 --> 00:29:50,880
can make that happen and actually

754
00:29:50,880 --> 00:29:53,700
connect to internal services that would

755
00:29:53,700 --> 00:29:57,240
be awesome like an awesome POC and as I

756
00:29:57,240 --> 00:29:59,100
mean this entire thing this IP spoofing

757
00:29:59,100 --> 00:30:00,659
is a stepping stone right it's not it's

758
00:30:00,659 --> 00:30:02,580
not the goal itself it's something that

759
00:30:02,580 --> 00:30:04,140
gives you capabilities that would

760
00:30:04,140 --> 00:30:06,539
eventually lead you to a successful

761
00:30:06,539 --> 00:30:08,100
attack so on its own it's not really

762
00:30:08,100 --> 00:30:10,320
helpful and actually setting up or

763
00:30:10,320 --> 00:30:12,360
succeeding in setting up a full TCP

764
00:30:12,360 --> 00:30:15,360
connection would be another step in the

765
00:30:15,360 --> 00:30:18,179
way the next thing that could be really

766
00:30:18,179 --> 00:30:20,640
nice is actually use the Martian packet

767
00:30:20,640 --> 00:30:23,279
spoofing to do some stuff like with the

768
00:30:23,279 --> 00:30:25,320
localhost uh spoofing that could be

769
00:30:25,320 --> 00:30:27,179
really nice I think the last one that

770
00:30:27,179 --> 00:30:29,539
was dude that was doing it was a guy

771
00:30:29,539 --> 00:30:32,520
Stefan would go that published a blog

772
00:30:32,520 --> 00:30:34,380
post in Project zero and he was poofing

773
00:30:34,380 --> 00:30:38,279
IPv6 local hosts back in 2015 and he got

774
00:30:38,279 --> 00:30:42,240
he owned ntpd so and ever since I didn't

775
00:30:42,240 --> 00:30:44,760
see anyone that was doing it so now it's

776
00:30:44,760 --> 00:30:46,620
it's possible again maybe not on your

777
00:30:46,620 --> 00:30:48,480
local network but maybe on the internet

778
00:30:48,480 --> 00:30:51,000
so if you can find some service that is

779
00:30:51,000 --> 00:30:52,740
vulnerable to this kind of thing that

780
00:30:52,740 --> 00:30:55,320
that would be cool uh scanning more

781
00:30:55,320 --> 00:30:57,779
protocols that can also work very well I

782
00:30:57,779 --> 00:30:59,279
started playing with Jerry they're

783
00:30:59,279 --> 00:31:00,960
they're very promising results over

784
00:31:00,960 --> 00:31:02,659
there and it's not too hard to write a

785
00:31:02,659 --> 00:31:06,000
zmap module for it so it remains as an

786
00:31:06,000 --> 00:31:08,399
exercise for the audience

787
00:31:08,399 --> 00:31:11,399
and yeah you can also try to do this six

788
00:31:11,399 --> 00:31:13,620
over four and four over six

789
00:31:13,620 --> 00:31:15,720
um six over four could be easy because

790
00:31:15,720 --> 00:31:18,000
you can actually scan the entire ipv4

791
00:31:18,000 --> 00:31:22,320
and arrange again six over four uh four

792
00:31:22,320 --> 00:31:23,940
over six can be tricky because scanning

793
00:31:23,940 --> 00:31:26,760
the entire IPv6 address range can be a

794
00:31:26,760 --> 00:31:28,740
bit too much but if you know how to do

795
00:31:28,740 --> 00:31:31,260
it that could be very cool and the last

796
00:31:31,260 --> 00:31:33,600
thing is that I never got a hold of uh

797
00:31:33,600 --> 00:31:35,640
Cisco device that was vulnerable to this

798
00:31:35,640 --> 00:31:37,440
packet of death but basically it's a

799
00:31:37,440 --> 00:31:39,179
packet that crashes the kernel from the

800
00:31:39,179 --> 00:31:41,100
internet without authentication so if

801
00:31:41,100 --> 00:31:42,840
you do have this kind of device and you

802
00:31:42,840 --> 00:31:45,779
want to play with it and maybe find an

803
00:31:45,779 --> 00:31:47,700
rce into the kernel and authenticated

804
00:31:47,700 --> 00:31:49,679
that would be really really awesome but

805
00:31:49,679 --> 00:31:51,360
I couldn't get my hands on any of these

806
00:31:51,360 --> 00:31:54,120
devices so that's left to everyone who

807
00:31:54,120 --> 00:31:55,860
wants to try

808
00:31:55,860 --> 00:31:56,580
um

809
00:31:56,580 --> 00:31:59,100
yeah so that's everything I have if you

810
00:31:59,100 --> 00:32:01,679
have any questions I'm here now and also

811
00:32:01,679 --> 00:32:04,200
in the conference and if you wanna

812
00:32:04,200 --> 00:32:06,419
follow me get the zmap module and all

813
00:32:06,419 --> 00:32:08,159
that so this is what I think and if you

814
00:32:08,159 --> 00:32:11,039
want to see more memes like this uh you

815
00:32:11,039 --> 00:32:12,600
should check out this exploitation

816
00:32:12,600 --> 00:32:15,190
Twitter so yeah thank you very much

817
00:32:15,190 --> 00:32:21,130
[Applause]

818
00:32:24,960 --> 00:32:27,559
yes

819
00:32:37,880 --> 00:32:39,500
documentation

820
00:32:39,500 --> 00:32:42,919
uh no

821
00:32:43,200 --> 00:32:45,360
I I mean I could have used I did try

822
00:32:45,360 --> 00:32:48,720
8888 and it works if you're not spoofing

823
00:32:48,720 --> 00:32:50,059
into Google

824
00:32:50,059 --> 00:32:52,200
Cloud because this is what I did

825
00:32:52,200 --> 00:32:53,760
yesterday when I recorded the demo to

826
00:32:53,760 --> 00:32:55,140
make sure it works and it didn't work

827
00:32:55,140 --> 00:32:56,880
for an hour and I didn't understand why

828
00:32:56,880 --> 00:32:59,159
and then I realized I'm trying to spoof

829
00:32:59,159 --> 00:33:01,740
8888 which is a Google address inside

830
00:33:01,740 --> 00:33:04,380
Google cloud and they dropped it but I

831
00:33:04,380 --> 00:33:06,419
didn't try the example eyepiece but I

832
00:33:06,419 --> 00:33:08,460
did try 100 100 for example the tail

833
00:33:08,460 --> 00:33:10,200
scale is using and if you read test

834
00:33:10,200 --> 00:33:11,640
scale documentation they will tell you

835
00:33:11,640 --> 00:33:13,500
that if you're listening to the Tesco

836
00:33:13,500 --> 00:33:16,019
interface you should just incoming

837
00:33:16,019 --> 00:33:18,299
packets uh Source IP because they're

838
00:33:18,299 --> 00:33:20,159
validating them but the fine print is

839
00:33:20,159 --> 00:33:21,659
that you should only trust it if it

840
00:33:21,659 --> 00:33:23,460
comes from the tailscale interface if

841
00:33:23,460 --> 00:33:25,380
you're binding to the entire machine

842
00:33:25,380 --> 00:33:27,779
then you may get packets start from the

843
00:33:27,779 --> 00:33:29,460
tailsk network so this stuff can

844
00:33:29,460 --> 00:33:33,260
actually do damage

845
00:33:43,760 --> 00:33:47,340
inside yeah

846
00:33:47,340 --> 00:33:49,200
yeah that's what happens with Google

847
00:33:49,200 --> 00:33:51,659
yeah exactly there's also egress

848
00:33:51,659 --> 00:33:53,159
filtering which is the opposite that

849
00:33:53,159 --> 00:33:55,679
that isps and Cloud providers should not

850
00:33:55,679 --> 00:33:57,419
accept packets that should have

851
00:33:57,419 --> 00:33:58,980
originated from the internal network if

852
00:33:58,980 --> 00:34:00,600
it comes from the external network as

853
00:34:00,600 --> 00:34:02,820
well they should also not accept Martian

854
00:34:02,820 --> 00:34:05,159
packets but not all providers implement

855
00:34:05,159 --> 00:34:09,899
this uh does it also include uh like the

856
00:34:09,899 --> 00:34:12,899
nearest bgp networks that is connected

857
00:34:12,899 --> 00:34:14,879
to or not do you know that I didn't

858
00:34:14,879 --> 00:34:18,500
check but go ahead and let me know okay

859
00:34:21,859 --> 00:34:25,759
anyone else yeah

860
00:34:27,659 --> 00:34:30,480
no I never managed to do it I I only

861
00:34:30,480 --> 00:34:32,339
found those on the internet and they

862
00:34:32,339 --> 00:34:34,440
worked the the way I did the testing I

863
00:34:34,440 --> 00:34:36,780
wrote it in basically escapee I wrote

864
00:34:36,780 --> 00:34:38,699
this KP server that would accept

865
00:34:38,699 --> 00:34:41,099
any packet decapsulated and send it back

866
00:34:41,099 --> 00:34:43,080
but they could not do it you know the

867
00:34:43,080 --> 00:34:44,339
way you should be doing it with some

868
00:34:44,339 --> 00:34:47,159
like IP routing stuff of the Linux

869
00:34:47,159 --> 00:34:48,359
machine it's just impossible I don't

870
00:34:48,359 --> 00:34:50,399
know how you guys do it I mean not you

871
00:34:50,399 --> 00:34:53,540
guys but hey guys

872
00:34:54,418 --> 00:34:56,219
yes again I can also

873
00:34:56,219 --> 00:34:59,760
give a hint if you're trying to report a

874
00:34:59,760 --> 00:35:01,800
vulnerabilities like that and you don't

875
00:35:01,800 --> 00:35:04,380
know you only have an IP address you can

876
00:35:04,380 --> 00:35:07,380
geoip it into a country and send it to a

877
00:35:07,380 --> 00:35:09,240
national search in the country and hope

878
00:35:09,240 --> 00:35:11,579
for the best it doesn't work usually no

879
00:35:11,579 --> 00:35:13,800
but it's it's better than nothing

880
00:35:13,800 --> 00:35:16,260
I tried it with some Chinese uh vendors

881
00:35:16,260 --> 00:35:20,180
and I didn't get a response so

882
00:35:23,280 --> 00:35:25,440
yeah okay yeah I think that's about it

883
00:35:25,440 --> 00:35:27,240
I'm still here for questions afterwards

884
00:35:27,240 --> 00:35:30,379
if you want me thank you

