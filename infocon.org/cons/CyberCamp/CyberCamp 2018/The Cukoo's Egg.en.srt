1
00:00:02,020 --> 00:00:08,280
[Music]

2
00:00:13,530 --> 00:00:21,430
good afternoon and welcome everyone my

3
00:00:17,849 --> 00:00:23,470
presentation could be a bit technical or

4
00:00:21,430 --> 00:00:28,600
too technical because of the contents of

5
00:00:23,470 --> 00:00:31,439
it but I will try to work to reach you

6
00:00:28,600 --> 00:00:34,600
all okay well my name is very easy to

7
00:00:31,439 --> 00:00:37,390
remember Pedro Sanchez like the Prime

8
00:00:34,600 --> 00:00:41,320
Minister in Spain all right

9
00:00:37,390 --> 00:00:48,970
so without further ado I move on to my

10
00:00:41,320 --> 00:00:52,290
presentation so this is my bio so I am

11
00:00:48,970 --> 00:00:57,519
kind of I have lots of experiencing

12
00:00:52,290 --> 00:01:01,119
event response in forensics this is what

13
00:00:57,519 --> 00:01:04,929
I do the most and all these leads you to

14
00:01:01,119 --> 00:01:09,119
the field of research then from there

15
00:01:04,930 --> 00:01:11,120
you can move on to other fields such as

16
00:01:09,119 --> 00:01:12,310
threats

17
00:01:11,120 --> 00:01:15,820
[Music]

18
00:01:12,310 --> 00:01:19,540
and then to catch it well guys and then

19
00:01:15,820 --> 00:01:25,780
threat intelligence that is to say what

20
00:01:19,540 --> 00:01:30,240
we do when we do research on attacking

21
00:01:25,780 --> 00:01:35,170
team who is trying to attack your system

22
00:01:30,240 --> 00:01:41,699
okay and on the screen do you see my bio

23
00:01:35,170 --> 00:01:41,700
I will start by introducing a real case

24
00:01:41,880 --> 00:01:52,470
this is a multinational where they do

25
00:01:45,100 --> 00:01:56,199
food processing so the work with

26
00:01:52,470 --> 00:02:01,270
shopping centers and then the turnover

27
00:01:56,200 --> 00:02:02,979
figures hi quite high and of course I'm

28
00:02:01,270 --> 00:02:05,590
not going to disclose the name of it

29
00:02:02,979 --> 00:02:08,410
while the incidence is the following as

30
00:02:05,590 --> 00:02:11,709
it says on the screen they just check

31
00:02:08,410 --> 00:02:15,239
their systems and detect that there is a

32
00:02:11,709 --> 00:02:19,890
webserver who has been compromised and

33
00:02:15,239 --> 00:02:21,160
that server hosts the email is this and

34
00:02:19,890 --> 00:02:25,328
OWA

35
00:02:21,160 --> 00:02:28,450
and it is sever which is being accessed

36
00:02:25,329 --> 00:02:30,700
by personnel of the company they don't

37
00:02:28,450 --> 00:02:32,500
know about the scope of the attack they

38
00:02:30,700 --> 00:02:34,450
go and say initially that they have a

39
00:02:32,500 --> 00:02:37,540
problem and they want to find out what

40
00:02:34,450 --> 00:02:40,078
they should do to resolve it to solve it

41
00:02:37,540 --> 00:02:43,239
and what is an incident response team

42
00:02:40,079 --> 00:02:44,780
incident response team would be kind of

43
00:02:43,239 --> 00:02:49,430
like f

44
00:02:44,780 --> 00:02:52,340
fire fighting team so there is a fire

45
00:02:49,430 --> 00:02:54,560
and you need to have your planning in

46
00:02:52,340 --> 00:02:56,960
place you need to have your hoses water

47
00:02:54,560 --> 00:03:02,270
everything that you need so and when you

48
00:02:56,960 --> 00:03:04,640
go to the company you implement a

49
00:03:02,270 --> 00:03:07,640
response plan that response plan does

50
00:03:04,640 --> 00:03:10,250
not avoid the or prevent the incidents

51
00:03:07,640 --> 00:03:13,010
but tries to mitigate it of course we

52
00:03:10,250 --> 00:03:16,630
cannot prevent the event but we can

53
00:03:13,010 --> 00:03:19,070
minimize or mitigate the attack window

54
00:03:16,630 --> 00:03:20,540
so that was the first incident but I

55
00:03:19,070 --> 00:03:22,670
didn't know that they had a second

56
00:03:20,540 --> 00:03:25,489
instance that is to say the hard SCADA

57
00:03:22,670 --> 00:03:27,440
system and the SCADA system was

58
00:03:25,489 --> 00:03:30,489
controlling a number of industrial

59
00:03:27,440 --> 00:03:35,150
devices that at the same time were

60
00:03:30,489 --> 00:03:39,950
producing food and daily basis one of

61
00:03:35,150 --> 00:03:43,640
the cakes so to speak when went through

62
00:03:39,950 --> 00:03:47,660
the quality checks they could detect

63
00:03:43,640 --> 00:03:51,200
like crack thing is and the thing is

64
00:03:47,660 --> 00:03:53,750
that that had been while the instructs

65
00:03:51,200 --> 00:03:57,350
the industrial system was losing out

66
00:03:53,750 --> 00:04:02,900
latency had been manipulated and they

67
00:03:57,350 --> 00:04:05,420
were losing like 10 milliseconds so 10

68
00:04:02,900 --> 00:04:09,530
milliseconds may not sound a lot but at

69
00:04:05,420 --> 00:04:12,679
that time was there was a long long time

70
00:04:09,530 --> 00:04:15,650
and anyway they were losing quite a lot

71
00:04:12,680 --> 00:04:18,310
of money ok so this was the timeline of

72
00:04:15,650 --> 00:04:18,310
the event

73
00:04:19,190 --> 00:04:27,730
first of all they detected that one of

74
00:04:23,780 --> 00:04:27,729
their server had been compromised

75
00:04:30,220 --> 00:04:37,039
later on we also could see that the

76
00:04:33,409 --> 00:04:38,750
SCADA server had been compromised that

77
00:04:37,039 --> 00:04:44,060
was running on the Windows environment

78
00:04:38,750 --> 00:04:54,050
and then a PLC with access to robotic

79
00:04:44,060 --> 00:04:58,490
arm or to a painting line now going into

80
00:04:54,050 --> 00:05:03,169
the mail server when we came access what

81
00:04:58,490 --> 00:05:07,090
we could see was the following so this

82
00:05:03,169 --> 00:05:07,090
is what they say had been compromised

83
00:05:10,719 --> 00:05:17,569
this is like a web shell or control

84
00:05:14,000 --> 00:05:21,650
panel but it is not from Windows it is

85
00:05:17,569 --> 00:05:25,539
not Microsoft this has been implanted by

86
00:05:21,650 --> 00:05:25,539
the bad guys

87
00:05:26,020 --> 00:05:32,650
so they were doing in logging they were

88
00:05:28,570 --> 00:05:35,349
running commands and they were uploading

89
00:05:32,650 --> 00:05:40,270
files to the server the loading files

90
00:05:35,350 --> 00:05:45,970
from the server and we're also executing

91
00:05:40,270 --> 00:05:49,750
as few else so this is quite a serious

92
00:05:45,970 --> 00:05:52,630
event so we went there we contained it

93
00:05:49,750 --> 00:05:54,730
well containment means do not do

94
00:05:52,630 --> 00:05:57,340
anything hands off and we are going to

95
00:05:54,730 --> 00:06:00,730
take a look at it I'm summarizing it

96
00:05:57,340 --> 00:06:04,090
padma siddhi we move on to forensic

97
00:06:00,730 --> 00:06:06,460
analysis we took the survey we isolated

98
00:06:04,090 --> 00:06:09,039
it and we are starting to check

99
00:06:06,460 --> 00:06:11,200
everything in it from memory and

100
00:06:09,040 --> 00:06:14,080
everything that was compromised and then

101
00:06:11,200 --> 00:06:17,950
after that we moved on to the hard

102
00:06:14,080 --> 00:06:21,070
drives so I will be summarizing it these

103
00:06:17,950 --> 00:06:26,020
are the tools that we reduced for the

104
00:06:21,070 --> 00:06:29,590
exchange server so we have tools such as

105
00:06:26,020 --> 00:06:35,740
parsers that allows us to loop the logs

106
00:06:29,590 --> 00:06:39,280
and to search search them so first of

107
00:06:35,740 --> 00:06:42,200
all you need to compile evidence to

108
00:06:39,280 --> 00:06:44,250
later analyze it

109
00:06:42,200 --> 00:06:47,380
[Music]

110
00:06:44,250 --> 00:06:55,600
and we also use a specific tools and

111
00:06:47,380 --> 00:07:00,390
technique for the web shell and we use

112
00:06:55,600 --> 00:07:04,500
the program to search for the web snail

113
00:07:00,390 --> 00:07:10,419
so I have left some links on the screen

114
00:07:04,500 --> 00:07:13,390
you may download this tool and you can

115
00:07:10,420 --> 00:07:18,940
use it soon as I say to search for web

116
00:07:13,390 --> 00:07:22,780
shells because attackers do not limit us

117
00:07:18,940 --> 00:07:27,430
web web shell or malware they just give

118
00:07:22,780 --> 00:07:30,700
different names rental names so this is

119
00:07:27,430 --> 00:07:37,660
a summary of the forensic analysis that

120
00:07:30,700 --> 00:07:44,469
we did so we could see that the traffic

121
00:07:37,660 --> 00:07:49,420
requests have been made to an to an IP

122
00:07:44,470 --> 00:07:51,790
address from Eden and then because well

123
00:07:49,420 --> 00:07:54,280
this could be a false flag perhaps that

124
00:07:51,790 --> 00:07:59,290
IP had been in Tampa have been

125
00:07:54,280 --> 00:08:04,000
manipulated but for us that was already

126
00:07:59,290 --> 00:08:06,070
a way to start well starting point we

127
00:08:04,000 --> 00:08:10,270
could see that it was from Eden

128
00:08:06,070 --> 00:08:12,430
initially then we could also see that it

129
00:08:10,270 --> 00:08:15,310
was also accessed from France and from

130
00:08:12,430 --> 00:08:17,440
the EU Europe sorry

131
00:08:15,310 --> 00:08:19,710
United States but they were not

132
00:08:17,440 --> 00:08:23,699
accessing the web shell

133
00:08:19,710 --> 00:08:30,000
London also six other requests coming

134
00:08:23,699 --> 00:08:36,959
from another server that and also from

135
00:08:30,000 --> 00:08:40,890
Eden so we moved on with Herman analysis

136
00:08:36,958 --> 00:08:47,040
and we found different other commands so

137
00:08:40,890 --> 00:08:49,649
the one on the top so that is me mica

138
00:08:47,040 --> 00:08:52,529
but they change the name of it the top

139
00:08:49,649 --> 00:08:55,410
line allows you to dump the passwords of

140
00:08:52,529 --> 00:08:59,189
the users who have logging into this

141
00:08:55,410 --> 00:09:06,149
Windows machine and they can be dumped

142
00:08:59,190 --> 00:09:10,380
into plaintext so the attacker dumped

143
00:09:06,149 --> 00:09:16,080
all the passwords into a file to txt

144
00:09:10,380 --> 00:09:22,050
file and what did we see we saw that all

145
00:09:16,080 --> 00:09:24,690
those lines were in CMD so we didn't

146
00:09:22,050 --> 00:09:31,160
find the text file but we found this

147
00:09:24,690 --> 00:09:31,160
program and then the midline

148
00:09:31,930 --> 00:09:39,969
allowed the attacker to become the super

149
00:09:35,110 --> 00:09:44,560
administrator of the mail server so that

150
00:09:39,970 --> 00:09:47,650
he go to any of the exchange servers so

151
00:09:44,560 --> 00:09:50,469
the attacker wanted to spread itself and

152
00:09:47,650 --> 00:09:57,160
reach out many countries and the bottom

153
00:09:50,470 --> 00:10:00,310
line was promoting the HTML program with

154
00:09:57,160 --> 00:10:01,990
its code to a route that was more

155
00:10:00,310 --> 00:10:05,560
difficult to detect

156
00:10:01,990 --> 00:10:08,320
difficult to identify or to make it the

157
00:10:05,560 --> 00:10:12,010
home page through which they would get

158
00:10:08,320 --> 00:10:15,730
or gaining access so what I can see here

159
00:10:12,010 --> 00:10:19,750
is that the user techniques that the OS

160
00:10:15,730 --> 00:10:21,670
use so this is lateral attacking so that

161
00:10:19,750 --> 00:10:23,620
is to say when one of my machines is

162
00:10:21,670 --> 00:10:25,959
compromised in my network and from that

163
00:10:23,620 --> 00:10:29,590
machine I jump over to another machine

164
00:10:25,960 --> 00:10:32,470
also in my very same network what did we

165
00:10:29,590 --> 00:10:35,530
do here well we did the cloning we

166
00:10:32,470 --> 00:10:40,090
analyzed data we gathered evidence and

167
00:10:35,530 --> 00:10:46,000
then we found these files so Trinket

168
00:10:40,090 --> 00:10:51,690
service open dot VBS one dot c md gen

169
00:10:46,000 --> 00:10:55,990
dot x attackers either use their

170
00:10:51,690 --> 00:10:59,140
tailor-made programs and here i will

171
00:10:55,990 --> 00:11:01,630
prefer to full players for scenarios in

172
00:10:59,140 --> 00:11:05,080
the world who are often when the

173
00:11:01,630 --> 00:11:08,020
attackers will prefer later on to them

174
00:11:05,080 --> 00:11:10,930
okay we have these four files the first

175
00:11:08,020 --> 00:11:15,040
one the trinket service well this is a

176
00:11:10,930 --> 00:11:17,290
very specific name this is a program

177
00:11:15,040 --> 00:11:22,540
that allows you to access the SCADA

178
00:11:17,290 --> 00:11:27,399
system and this was indeed exchange mail

179
00:11:22,540 --> 00:11:33,310
server and then later on we concluded

180
00:11:27,399 --> 00:11:36,250
that the bad guy had uploaded this file

181
00:11:33,310 --> 00:11:39,250
to later on moving to scatter system but

182
00:11:36,250 --> 00:11:40,199
for some reason it didn't end up in

183
00:11:39,250 --> 00:11:43,389
SCADA

184
00:11:40,199 --> 00:11:45,670
so this is run in a controlled

185
00:11:43,389 --> 00:11:48,009
environment because if you run it in

186
00:11:45,670 --> 00:11:50,800
machine that you are analyzing that is

187
00:11:48,009 --> 00:11:54,880
to say the victim machine you can run it

188
00:11:50,800 --> 00:11:57,939
on you can destroy you evidence so it

189
00:11:54,880 --> 00:12:02,470
was run in controlled environments and

190
00:11:57,940 --> 00:12:09,399
then we could see what it did and notice

191
00:12:02,470 --> 00:12:14,380
this is important bit one of the files

192
00:12:09,399 --> 00:12:16,540
one point VBS vision basically scripts

193
00:12:14,380 --> 00:12:18,939
which is a code that is running every

194
00:12:16,540 --> 00:12:20,709
single window machine well curiously

195
00:12:18,940 --> 00:12:23,850
enough this time you will see the code

196
00:12:20,709 --> 00:12:26,469
you can see what this software was doing

197
00:12:23,850 --> 00:12:30,250
so this gave us a very important clue

198
00:12:26,470 --> 00:12:33,519
this man well notice what it does first

199
00:12:30,250 --> 00:12:35,949
of all identifies the window version

200
00:12:33,519 --> 00:12:38,260
which is being run the attacker if we

201
00:12:35,949 --> 00:12:41,349
could run it if we would succeed in

202
00:12:38,260 --> 00:12:45,069
running it with Reiser to this level so

203
00:12:41,350 --> 00:12:47,470
that is to say here we have two things

204
00:12:45,069 --> 00:12:50,709
either the person has gained access

205
00:12:47,470 --> 00:12:52,209
remotely instead of trafficked Lee that

206
00:12:50,709 --> 00:12:54,489
is to say it doesn't know the

207
00:12:52,209 --> 00:12:58,150
environment he's in or perhaps the

208
00:12:54,490 --> 00:13:03,100
program was already automated

209
00:12:58,150 --> 00:13:05,860
second part here uses a technique which

210
00:13:03,100 --> 00:13:10,800
is very difficult to use which is W May

211
00:13:05,860 --> 00:13:15,670
this comes from windows 95 it is

212
00:13:10,800 --> 00:13:18,339
included by default in Windows so that

213
00:13:15,670 --> 00:13:21,069
allows you to interact with my machine

214
00:13:18,340 --> 00:13:24,370
like if you had a framework of commands

215
00:13:21,070 --> 00:13:27,280
so the bad guy here tried to find out

216
00:13:24,370 --> 00:13:30,000
about the existing antivirus and to

217
00:13:27,280 --> 00:13:33,430
delete it so we didn't know whether he

218
00:13:30,000 --> 00:13:36,330
succeeded in that or not because when

219
00:13:33,430 --> 00:13:39,189
you restart the machine then the

220
00:13:36,330 --> 00:13:41,350
antivirus is run but we understand that

221
00:13:39,190 --> 00:13:43,690
if it is there it's because it was run

222
00:13:41,350 --> 00:13:47,350
and if it was run it is because he

223
00:13:43,690 --> 00:13:51,360
intended to launch an attack and then

224
00:13:47,350 --> 00:13:56,650
the second type of file is the one dot

225
00:13:51,360 --> 00:14:00,030
CMD notice that he is not using any

226
00:13:56,650 --> 00:14:03,069
strange code or malware that has been

227
00:14:00,030 --> 00:14:05,199
produced in the cyber space

228
00:14:03,070 --> 00:14:07,270
he's just using like very simple

229
00:14:05,200 --> 00:14:12,880
programming techniques that the kind of

230
00:14:07,270 --> 00:14:18,120
stem out from time era of Windows so you

231
00:14:12,880 --> 00:14:22,540
can see here this file the third line

232
00:14:18,120 --> 00:14:27,250
specifically well a parameter is added

233
00:14:22,540 --> 00:14:30,160
to an assembler file so he uploaded a

234
00:14:27,250 --> 00:14:32,680
file to the assembler and that the file

235
00:14:30,160 --> 00:14:37,719
was compiled so this I'm summarizing

236
00:14:32,680 --> 00:14:40,870
this and what it's actually strange why

237
00:14:37,720 --> 00:14:49,480
he did the calculation right away and he

238
00:14:40,870 --> 00:14:52,890
did not uploaded the dot X file so we

239
00:14:49,480 --> 00:14:56,470
concluded that he chose this machine as

240
00:14:52,890 --> 00:14:59,500
environments for his for developments

241
00:14:56,470 --> 00:15:01,300
like a developmental developmental that

242
00:14:59,500 --> 00:15:04,060
he would use to distribute the tools

243
00:15:01,300 --> 00:15:07,209
across the organization he did the

244
00:15:04,060 --> 00:15:11,469
compilation and after compiling the file

245
00:15:07,210 --> 00:15:17,140
the object and the file were deleted and

246
00:15:11,470 --> 00:15:18,700
he just kept the exit file so when that

247
00:15:17,140 --> 00:15:22,360
file is run do you become an

248
00:15:18,700 --> 00:15:24,880
administrator that is to say it gives

249
00:15:22,360 --> 00:15:26,920
you privileges as a user and then you

250
00:15:24,880 --> 00:15:29,040
can become the well to become the

251
00:15:26,920 --> 00:15:29,040
administrator

252
00:15:30,930 --> 00:15:41,939
so the next important file is GE and dot

253
00:15:36,689 --> 00:15:45,889
exit so this time

254
00:15:41,939 --> 00:15:52,410
notice that a code has changed it is not

255
00:15:45,889 --> 00:15:56,850
CMD it is not the be s but - we compile

256
00:15:52,410 --> 00:15:59,550
the executable and then we see well we'd

257
00:15:56,850 --> 00:16:01,649
be assembly the reversing will be

258
00:15:59,550 --> 00:16:04,290
reversing to see what the program did

259
00:16:01,649 --> 00:16:07,249
and well this time we started to get a

260
00:16:04,290 --> 00:16:11,399
bit as cat but we see in the first cell

261
00:16:07,249 --> 00:16:15,350
circled we are seeing but I'm telling

262
00:16:11,399 --> 00:16:17,939
you now at the time we didn't know so

263
00:16:15,350 --> 00:16:19,920
they said this is the manufacturer that

264
00:16:17,939 --> 00:16:22,649
we have in the organization back off

265
00:16:19,920 --> 00:16:25,800
does the name of it and he is a

266
00:16:22,649 --> 00:16:29,009
manufacturer that produces the software

267
00:16:25,800 --> 00:16:33,170
for managing SCADA system and I said ooh

268
00:16:29,009 --> 00:16:36,959
perhaps the attacker just didn't want to

269
00:16:33,170 --> 00:16:38,939
compromise the company just to get the

270
00:16:36,959 --> 00:16:41,599
information from the company but

271
00:16:38,939 --> 00:16:43,920
information about the production of

272
00:16:41,600 --> 00:16:47,720
company production business of the

273
00:16:43,920 --> 00:16:52,110
company and then what he did here was

274
00:16:47,720 --> 00:16:55,399
scanning so he opened a socket and he

275
00:16:52,110 --> 00:17:00,480
did a start and an end for his scanning

276
00:16:55,399 --> 00:17:04,500
we understand what we see the ports here

277
00:17:00,480 --> 00:17:10,339
therefore we understand that he has used

278
00:17:04,500 --> 00:17:10,339
the program for scanning the ports

279
00:17:11,300 --> 00:17:17,909
while I'm summarizing all this but these

280
00:17:14,459 --> 00:17:23,760
took us long time we are talking about

281
00:17:17,910 --> 00:17:25,800
four to five months of work so coming to

282
00:17:23,760 --> 00:17:29,340
the point we say oh these birds are

283
00:17:25,800 --> 00:17:32,990
scallop or these are the machines that

284
00:17:29,340 --> 00:17:35,310
are managing is scattered to put it in

285
00:17:32,990 --> 00:17:39,600
different manner so the attacker goes

286
00:17:35,310 --> 00:17:42,120
into the mail server uploads the file

287
00:17:39,600 --> 00:17:44,550
creates a programming environment starts

288
00:17:42,120 --> 00:17:46,830
to compile programs and then within the

289
00:17:44,550 --> 00:17:50,129
organization he starts to check out to

290
00:17:46,830 --> 00:17:53,070
find to look for deep a production

291
00:17:50,130 --> 00:17:56,580
system so this is the first incident the

292
00:17:53,070 --> 00:18:00,030
first events that we analyzed so from

293
00:17:56,580 --> 00:18:03,540
there but it we did well with focused on

294
00:18:00,030 --> 00:18:06,540
SCADA we said okay we are not going to

295
00:18:03,540 --> 00:18:11,070
go into the IT parts we will go to the

296
00:18:06,540 --> 00:18:13,430
OT parts and here

297
00:18:11,070 --> 00:18:15,800
[Music]

298
00:18:13,430 --> 00:18:21,800
I'm going to make a brief introduction

299
00:18:15,800 --> 00:18:24,379
to what is happening in the cyber

300
00:18:21,800 --> 00:18:31,270
industrial world this is what we had

301
00:18:24,380 --> 00:18:31,270
before this is what is ahead of us so

302
00:18:32,740 --> 00:18:40,280
this is a new concept of attack okay I

303
00:18:37,730 --> 00:18:41,900
learned everyday I study every day you

304
00:18:40,280 --> 00:18:44,930
have to do that because attackers are

305
00:18:41,900 --> 00:18:46,700
very updated so we have shifted from the

306
00:18:44,930 --> 00:18:49,790
first Industrial Revolution was

307
00:18:46,700 --> 00:18:54,110
everything was mechanic whereas nowadays

308
00:18:49,790 --> 00:18:58,399
everything is connected our smartphone

309
00:18:54,110 --> 00:19:04,229
our refrigerator our slippers everything

310
00:18:58,400 --> 00:19:06,360
is connected to the Internet therefore

311
00:19:04,230 --> 00:19:10,770
what happens in the industrial

312
00:19:06,360 --> 00:19:11,790
environment so this evolution okay so in

313
00:19:10,770 --> 00:19:14,820
this evolution

314
00:19:11,790 --> 00:19:15,629
okay processes have been automated in

315
00:19:14,820 --> 00:19:18,980
the past

316
00:19:15,630 --> 00:19:18,980
ah hire a machine

317
00:19:21,669 --> 00:19:29,090
well to produce cream but now I want to

318
00:19:25,730 --> 00:19:31,160
see all that online and I want to see

319
00:19:29,090 --> 00:19:35,030
the data that are produced

320
00:19:31,160 --> 00:19:38,000
skaara and PLC because then I could take

321
00:19:35,030 --> 00:19:40,428
all that to Big Data and then Big Data I

322
00:19:38,000 --> 00:19:42,650
could our algorithms and generate

323
00:19:40,429 --> 00:19:44,900
artificial intelligence therefore in the

324
00:19:42,650 --> 00:19:51,049
future can predict in the future when I

325
00:19:44,900 --> 00:19:54,160
wanna PLC and get broken or but the

326
00:19:51,049 --> 00:19:59,150
problem is that all this is being done

327
00:19:54,160 --> 00:20:02,590
my viewpoints with no control these that

328
00:19:59,150 --> 00:20:05,510
you are seeing now is real life

329
00:20:02,590 --> 00:20:09,649
everything that is happening in the IT

330
00:20:05,510 --> 00:20:13,100
world will convert into ot that is to

331
00:20:09,650 --> 00:20:14,650
say the industrial world everyone talks

332
00:20:13,100 --> 00:20:18,620
about wanna try

333
00:20:14,650 --> 00:20:20,480
imagine that wanna try access an

334
00:20:18,620 --> 00:20:22,189
industrial device and when we are

335
00:20:20,480 --> 00:20:25,220
talking about industrial devices we

336
00:20:22,190 --> 00:20:27,890
always think about nuclear plants and we

337
00:20:25,220 --> 00:20:31,520
think of the Chinese will come down will

338
00:20:27,890 --> 00:20:33,919
shut the nuclear power down No

339
00:20:31,520 --> 00:20:37,730
well may happen but that's very very

340
00:20:33,919 --> 00:20:40,280
unlikely because it's a manual processes

341
00:20:37,730 --> 00:20:44,030
but imagine that an attacker accesses a

342
00:20:40,280 --> 00:20:46,790
shopping centre 7:00 p.m. there are

343
00:20:44,030 --> 00:20:50,899
cinema theaters there are car parts

344
00:20:46,790 --> 00:20:53,960
there are stores and then you decide to

345
00:20:50,900 --> 00:20:56,780
turn down the old enlightening and then

346
00:20:53,960 --> 00:20:59,799
all the alarms are triggered all the

347
00:20:56,780 --> 00:21:02,450
elevators everything is stopped since

348
00:20:59,799 --> 00:21:05,510
discontinued and then I create real

349
00:21:02,450 --> 00:21:08,710
chaos and this is much simpler to do

350
00:21:05,510 --> 00:21:10,809
that shutting down a nuclear power plant

351
00:21:08,710 --> 00:21:13,659
and then well sometimes when you go to

352
00:21:10,809 --> 00:21:15,700
this ot to this industrial places you

353
00:21:13,659 --> 00:21:20,019
don't see you see that there are no anti

354
00:21:15,700 --> 00:21:21,639
viruses so for instance I don't know for

355
00:21:20,019 --> 00:21:24,809
instance in sleepers connected to the

356
00:21:21,639 --> 00:21:29,860
Internet there are no anti viruses okay

357
00:21:24,809 --> 00:21:31,539
this is a reality and the main reality

358
00:21:29,860 --> 00:21:33,309
is it's not segmented what a

359
00:21:31,539 --> 00:21:35,460
segmentation mean it means there's

360
00:21:33,309 --> 00:21:38,610
nothing in the middle to separate them

361
00:21:35,460 --> 00:21:41,639
now we're starting to have things in

362
00:21:38,610 --> 00:21:44,379
industrial world with raising awareness

363
00:21:41,639 --> 00:21:48,570
you have to see that this in idea world

364
00:21:44,379 --> 00:21:50,980
you have to copy the security into the

365
00:21:48,570 --> 00:21:52,840
industrial world have to speak with the

366
00:21:50,980 --> 00:21:55,480
manufacturers because they are to blame

367
00:21:52,840 --> 00:21:59,678
for this they have default users you

368
00:21:55,480 --> 00:22:03,970
cannot change the industrial device all

369
00:21:59,679 --> 00:22:06,399
this summary to show that when I talk to

370
00:22:03,970 --> 00:22:08,619
the industrial managers they say no no

371
00:22:06,399 --> 00:22:11,949
this has been it's been like this for 12

372
00:22:08,619 --> 00:22:14,649
years the manufacturer disappeared but

373
00:22:11,950 --> 00:22:18,789
the industrial system is still working

374
00:22:14,649 --> 00:22:20,649
in this a technician who will retire in

375
00:22:18,789 --> 00:22:21,429
two months time and his in charge of

376
00:22:20,649 --> 00:22:25,559
maintenance

377
00:22:21,429 --> 00:22:27,820
that's the expert authority respect his

378
00:22:25,559 --> 00:22:30,129
transferring the knowledge as it was

379
00:22:27,820 --> 00:22:31,869
transferred in the Middle Ages he

380
00:22:30,129 --> 00:22:33,639
transfers the knowledge of this

381
00:22:31,869 --> 00:22:35,019
profession to another person and we have

382
00:22:33,639 --> 00:22:37,189
no control over that

383
00:22:35,019 --> 00:22:41,299
so what happens

384
00:22:37,190 --> 00:22:45,019
we can we are easy victims so we need to

385
00:22:41,299 --> 00:22:48,679
have this type of controls in place so

386
00:22:45,019 --> 00:22:53,379
scatter system this is the thing you're

387
00:22:48,679 --> 00:22:57,609
seeing is a system that manages PLC's

388
00:22:53,379 --> 00:22:58,908
Peale Caesars more devices connected to

389
00:22:57,609 --> 00:23:01,699
hardware

390
00:22:58,909 --> 00:23:05,629
do you paint or they give the

391
00:23:01,700 --> 00:23:08,659
instruction to Stella Bob whatever what

392
00:23:05,629 --> 00:23:10,899
do you see here I see a computer it's a

393
00:23:08,659 --> 00:23:15,019
PC

394
00:23:10,899 --> 00:23:20,418
well this sold do you know what's inside

395
00:23:15,019 --> 00:23:27,109
windows - eh yeah Windows Linux is

396
00:23:20,419 --> 00:23:31,070
better no there's no difference it's

397
00:23:27,109 --> 00:23:33,799
more known and there's Windows busy if

398
00:23:31,070 --> 00:23:36,189
Linux it's not well protected I have the

399
00:23:33,799 --> 00:23:36,190
same problem

400
00:23:36,549 --> 00:23:40,359
what's twinkled

401
00:23:40,630 --> 00:23:46,930
it's a manufacturer it has security

402
00:23:44,740 --> 00:23:54,060
measures but we don't listen to them we

403
00:23:46,930 --> 00:24:01,210
have problems it's software on Windows

404
00:23:54,060 --> 00:24:05,230
10 operating system kernel in at the

405
00:24:01,210 --> 00:24:09,320
kernel name install aware and it becomes

406
00:24:05,230 --> 00:24:12,780
real-time so great it works very well

407
00:24:09,320 --> 00:24:16,500
but we have to analyze the machine it's

408
00:24:12,780 --> 00:24:22,470
a Windows for me with a soft rock ovary

409
00:24:16,500 --> 00:24:26,070
that controls windows and we're going to

410
00:24:22,470 --> 00:24:32,930
use the same procedures I need evidence

411
00:24:26,070 --> 00:24:36,689
I find this this is more complicated

412
00:24:32,930 --> 00:24:43,920
there are techniques we discover file

413
00:24:36,690 --> 00:24:48,080
code DNS API a file which we cannot

414
00:24:43,920 --> 00:24:51,810
decipher in a DLL we have a dynamic live

415
00:24:48,080 --> 00:24:54,990
exit dynamic library and XE why don't

416
00:24:51,810 --> 00:24:58,940
why they call like this what do they do

417
00:24:54,990 --> 00:25:00,440
this thing you're seeing on your left

418
00:24:58,940 --> 00:25:03,330
[Music]

419
00:25:00,440 --> 00:25:05,780
it's the content of the folder in which

420
00:25:03,330 --> 00:25:05,780
were in

421
00:25:10,850 --> 00:25:18,770
but do hash to check this in the future

422
00:25:15,300 --> 00:25:22,889
whether they're malicious or not and

423
00:25:18,770 --> 00:25:26,790
here on the right-hand side you see the

424
00:25:22,890 --> 00:25:28,860
hash for each one of them you open the

425
00:25:26,790 --> 00:25:30,000
folder you analyze and you see if this

426
00:25:28,860 --> 00:25:32,550
looks bad

427
00:25:30,000 --> 00:25:37,340
of course the antivirus is not detecting

428
00:25:32,550 --> 00:25:42,270
it but we're going to an eyes this files

429
00:25:37,340 --> 00:25:44,909
having said this we asked to do this

430
00:25:42,270 --> 00:25:47,389
files belong to scatter software and the

431
00:25:44,910 --> 00:25:50,340
person who works with that he's been

432
00:25:47,390 --> 00:25:54,020
working there for many years he says

433
00:25:50,340 --> 00:25:56,550
what some of them do or this don't so

434
00:25:54,020 --> 00:26:00,000
we'll take a look and we see that yes

435
00:25:56,550 --> 00:26:01,050
this was there it's in the graphic

436
00:26:00,000 --> 00:26:04,760
environment

437
00:26:01,050 --> 00:26:04,760
it's called mode scan

438
00:26:07,260 --> 00:26:14,379
name tells you a lot of things and we

439
00:26:12,160 --> 00:26:18,429
said are you using list I'm not using

440
00:26:14,380 --> 00:26:20,559
this but when it that the person that

441
00:26:18,429 --> 00:26:22,570
came for the manufacturer yes did in

442
00:26:20,559 --> 00:26:24,460
order to carry out and I said we don't

443
00:26:22,570 --> 00:26:27,550
know it is good at a bad but it's been

444
00:26:24,460 --> 00:26:35,080
used it can be monitored and it could be

445
00:26:27,550 --> 00:26:39,960
used for that things and we could see

446
00:26:35,080 --> 00:26:44,949
that this program was not malicious and

447
00:26:39,960 --> 00:26:49,950
here we found a surprise I'm summarizing

448
00:26:44,950 --> 00:26:52,750
this a lot the program called DNS a P I

449
00:26:49,950 --> 00:26:56,260
looks for a user process when it's

450
00:26:52,750 --> 00:26:58,300
executed they search whether the

451
00:26:56,260 --> 00:27:02,650
programs launched in the memory if it is

452
00:26:58,300 --> 00:27:04,990
it launches the second program and when

453
00:27:02,650 --> 00:27:07,540
it launches the second program is

454
00:27:04,990 --> 00:27:09,580
launched a third one if the first one

455
00:27:07,540 --> 00:27:14,620
looks for the program doesn't find it

456
00:27:09,580 --> 00:27:18,070
it's not executed so what did we do we

457
00:27:14,620 --> 00:27:23,070
took the first fire the executable DNS

458
00:27:18,070 --> 00:27:26,480
API and we applied reverse engineering

459
00:27:23,070 --> 00:27:31,450
first take a look

460
00:27:26,480 --> 00:27:35,270
javi are you seeing it it's image CMD

461
00:27:31,450 --> 00:27:39,050
what's this guy doing it's not in

462
00:27:35,270 --> 00:27:44,360
assembler it's not idle it's not C++

463
00:27:39,050 --> 00:27:49,639
it's CMD why but it's CMD that the bad

464
00:27:44,360 --> 00:27:54,949
guy the bad guy is turned it into an

465
00:27:49,640 --> 00:27:57,830
executable to mislead but what that

466
00:27:54,950 --> 00:28:00,890
executable did was launching commands of

467
00:27:57,830 --> 00:28:02,270
the operating system if we take a look

468
00:28:00,890 --> 00:28:04,820
at the summary that's what I've

469
00:28:02,270 --> 00:28:08,480
highlighted here what does the program

470
00:28:04,820 --> 00:28:11,810
do it checks whether the scatter program

471
00:28:08,480 --> 00:28:15,440
is in the memory it's called twin Katz's

472
00:28:11,810 --> 00:28:18,070
management manager if it finds it it

473
00:28:15,440 --> 00:28:20,830
looks for him

474
00:28:18,070 --> 00:28:25,200
with the process numbers executed in the

475
00:28:20,830 --> 00:28:32,080
memory if it finds it it launches a

476
00:28:25,200 --> 00:28:36,160
three dot X and it launches that program

477
00:28:32,080 --> 00:28:41,560
with p f-- for process and carries an

478
00:28:36,160 --> 00:28:44,020
inject run which in turn calls dll can

479
00:28:41,560 --> 00:28:46,389
you identify the phases I'm trying not

480
00:28:44,020 --> 00:28:52,930
to be too I'm trying not to get too

481
00:28:46,390 --> 00:28:56,350
technical so in a nutshell it uses the

482
00:28:52,930 --> 00:28:58,570
little problems CMD it's not complicated

483
00:28:56,350 --> 00:29:00,699
it's not C++ so that it cannot be

484
00:28:58,570 --> 00:29:05,050
identified by the antivirus it looks

485
00:29:00,700 --> 00:29:07,150
from process if the process is there it

486
00:29:05,050 --> 00:29:10,780
looks for the process number it launches

487
00:29:07,150 --> 00:29:15,480
an executable that executable injects a

488
00:29:10,780 --> 00:29:15,480
code which is DLL that's a summary

489
00:29:17,379 --> 00:29:24,379
and here we get to the complicated

490
00:29:20,090 --> 00:29:27,860
moment what do we do here we use a

491
00:29:24,379 --> 00:29:31,668
product by my critical Cystic which

492
00:29:27,860 --> 00:29:34,580
checks but that is executable which is

493
00:29:31,669 --> 00:29:37,970
actually CMD where in the folders it

494
00:29:34,580 --> 00:29:45,980
checks whether they're good and here we

495
00:29:37,970 --> 00:29:48,889
see it's Microsoft Cystic it says what

496
00:29:45,980 --> 00:29:53,289
type of file it is and if you pay

497
00:29:48,889 --> 00:29:58,580
attention to this what do we have here

498
00:29:53,289 --> 00:30:01,489
the Cystic with the executable file

499
00:29:58,580 --> 00:30:05,199
it's called C because the bad guy

500
00:30:01,489 --> 00:30:10,309
renamed it it's signed and we said wow

501
00:30:05,200 --> 00:30:14,659
there's a signature it's signed but if I

502
00:30:10,309 --> 00:30:18,168
get into detail I see that the hashes

503
00:30:14,659 --> 00:30:25,200
are the same ones I had before and I see

504
00:30:18,169 --> 00:30:27,070
that it antivirus doesn't have this

505
00:30:25,200 --> 00:30:29,750
[Music]

506
00:30:27,070 --> 00:30:33,379
and it says the publisher and the

507
00:30:29,750 --> 00:30:37,970
companies Microsoft what's the bad guy

508
00:30:33,380 --> 00:30:41,620
doing he's taken a program from

509
00:30:37,970 --> 00:30:44,240
Microsoft has injected a DLL is that

510
00:30:41,620 --> 00:30:47,260
Microsoft program I'd tell you that it

511
00:30:44,240 --> 00:30:52,390
is that program they changed the name

512
00:30:47,260 --> 00:30:52,390
therefore the name is one

513
00:30:58,520 --> 00:31:06,590
have you ever written dear asterisk dot

514
00:31:02,300 --> 00:31:08,120
X in system32 there a lot the bad guys

515
00:31:06,590 --> 00:31:10,730
study a lot they're ahead of ourselves

516
00:31:08,120 --> 00:31:15,350
and they see there's a problem code like

517
00:31:10,730 --> 00:31:21,650
this I'll inject the DLL don't take a

518
00:31:15,350 --> 00:31:27,699
malware so we saw there was an ad which

519
00:31:21,650 --> 00:31:27,700
is this one that allows to inject live

520
00:31:31,180 --> 00:31:39,440
based on that since I don't trust it i

521
00:31:35,900 --> 00:31:44,510
see it's a Microsoft program and I'm

522
00:31:39,440 --> 00:31:47,290
it's a weird to me I called them in

523
00:31:44,510 --> 00:31:47,290
first line

524
00:31:50,059 --> 00:31:59,379
I dumped the file hash into a txt file

525
00:31:55,399 --> 00:32:01,988
the second line it's cut I edit the file

526
00:31:59,379 --> 00:32:07,369
and this thing you seen here the first

527
00:32:01,989 --> 00:32:12,859
square that's the hash there's a service

528
00:32:07,369 --> 00:32:17,509
in the internet court and as our ill it

529
00:32:12,859 --> 00:32:22,869
belongs to the NSA it's not the NSA it's

530
00:32:17,509 --> 00:32:26,330
a service what they every manufacturer

531
00:32:22,869 --> 00:32:29,959
manufactures provide them with their

532
00:32:26,330 --> 00:32:31,039
operating system hashes and they store

533
00:32:29,960 --> 00:32:33,830
it in a database

534
00:32:31,039 --> 00:32:36,169
Kaspersky for example Kaspersky's

535
00:32:33,830 --> 00:32:37,908
programs they have hashes and they're

536
00:32:36,169 --> 00:32:40,330
uploaded into this platform so they can

537
00:32:37,909 --> 00:32:43,339
verify that they're good

538
00:32:40,330 --> 00:32:46,478
Microsoft has the hashes of all the

539
00:32:43,339 --> 00:32:48,889
operating systems and uploaded here so

540
00:32:46,479 --> 00:32:51,859
what I do here with this line with

541
00:32:48,889 --> 00:32:55,459
peyten I say this program in Python

542
00:32:51,859 --> 00:32:58,968
takes the hash the good hash the one

543
00:32:55,460 --> 00:33:05,869
I've identified and it asks the database

544
00:32:58,969 --> 00:33:10,339
of the NS RL and it returns that's the

545
00:33:05,869 --> 00:33:13,488
same flash so in other words it's the

546
00:33:10,339 --> 00:33:17,529
debt its Microsoft as a program by

547
00:33:13,489 --> 00:33:17,529
Microsoft it's in the database

548
00:33:20,730 --> 00:33:28,309
transcript is how is the attack

549
00:33:24,750 --> 00:33:30,540
developed I've made a little video I

550
00:33:28,309 --> 00:33:37,350
always like to understand how the

551
00:33:30,540 --> 00:33:40,200
attacker and I like to reproduce it for

552
00:33:37,350 --> 00:33:44,760
obvious reasons very often you cannot

553
00:33:40,200 --> 00:33:48,890
reproduce the hold attack but I like to

554
00:33:44,760 --> 00:33:52,980
reproduce it so I've made a little video

555
00:33:48,890 --> 00:33:57,900
I'm going to play it I'll stop it in

556
00:33:52,980 --> 00:34:02,750
order to explain it's a virtual machine

557
00:33:57,900 --> 00:34:08,909
but it's the same well you can't see it

558
00:34:02,750 --> 00:34:14,000
from the back what I'm doing here

559
00:34:08,909 --> 00:34:19,859
I try to explain here there's a DLL

560
00:34:14,000 --> 00:34:21,510
called Molly theater dot la dee la and

561
00:34:19,859 --> 00:34:29,279
then what I do

562
00:34:21,510 --> 00:34:34,379
it's executing a program I'll onto CMD

563
00:34:29,280 --> 00:34:37,710
the executable and Tia takes CMD that

564
00:34:34,379 --> 00:34:41,520
simulates CMD the same they used and I

565
00:34:37,710 --> 00:34:44,100
executed that stop and this little

566
00:34:41,520 --> 00:34:46,619
program when I executed it says no it

567
00:34:44,100 --> 00:34:49,379
means that they haven't found the

568
00:34:46,619 --> 00:34:52,530
process the notepad process in other

569
00:34:49,379 --> 00:34:52,889
words this program says it's not worth

570
00:34:52,530 --> 00:34:57,590
that

571
00:34:52,889 --> 00:34:57,590
no well if it's not I continue

572
00:35:02,579 --> 00:35:09,930
and here our launch notepad and I'll

573
00:35:07,749 --> 00:35:12,968
execute the program again and minimize

574
00:35:09,930 --> 00:35:18,549
direct secure to the program again they

575
00:35:12,969 --> 00:35:23,739
are bored here I repeat the CMD no it

576
00:35:18,549 --> 00:35:30,249
finds it it finds appear if I continue

577
00:35:23,739 --> 00:35:34,479
to execute it now I go to an app the

578
00:35:30,249 --> 00:35:38,169
notepad process you cannot see it very

579
00:35:34,479 --> 00:35:42,419
well but you'll see that here the

580
00:35:38,170 --> 00:35:47,559
malicious top dealer has been inserted

581
00:35:42,420 --> 00:35:51,630
or not there's a program by Microsoft

582
00:35:47,559 --> 00:35:53,619
that allows us to insert dll's in

583
00:35:51,630 --> 00:35:55,930
processes the advantage for the

584
00:35:53,619 --> 00:35:58,150
attackers that they knew this and didn't

585
00:35:55,930 --> 00:36:00,339
need to create any more where they used

586
00:35:58,150 --> 00:36:03,880
Windows a small world

587
00:36:00,340 --> 00:36:12,810
and small detail with natural attack

588
00:36:03,880 --> 00:36:12,810
that has taken place so we'll continue

589
00:36:17,790 --> 00:36:28,330
the next attack to skadam this was more

590
00:36:24,580 --> 00:36:31,560
convoluted it uses a program that exists

591
00:36:28,330 --> 00:36:35,110
in Windows which is cold like this via

592
00:36:31,560 --> 00:36:38,160
BS then it's going to use an info and a

593
00:36:35,110 --> 00:36:41,110
setup and you will think this is

594
00:36:38,160 --> 00:36:46,450
designed to be installed this is a

595
00:36:41,110 --> 00:36:49,900
summary this first program comes from

596
00:36:46,450 --> 00:36:55,720
Microsoft it's signed by Microsoft

597
00:36:49,900 --> 00:36:59,650
itself it cause info info download from

598
00:36:55,720 --> 00:37:04,390
the internet file code set up dot INF

599
00:36:59,650 --> 00:37:10,170
this file has into it a section which

600
00:37:04,390 --> 00:37:10,170
allows to execute any executable program

601
00:37:13,170 --> 00:37:20,830
take a look if we monitor it with a very

602
00:37:18,010 --> 00:37:21,660
useful tool called sesemann I'm a huge

603
00:37:20,830 --> 00:37:23,779
fan

604
00:37:21,660 --> 00:37:28,490
[Music]

605
00:37:23,780 --> 00:37:31,010
I see high integrity level and I see

606
00:37:28,490 --> 00:37:35,029
when I execute this program I see what

607
00:37:31,010 --> 00:37:38,209
it does you see this blue line

608
00:37:35,030 --> 00:37:38,209
[Music]

609
00:37:40,800 --> 00:37:45,260
it's executed in a hidden window

610
00:37:45,490 --> 00:37:56,379
then it says look for the directory I

611
00:37:50,070 --> 00:38:01,089
import a module and launch info I launch

612
00:37:56,380 --> 00:38:02,950
info and we'll see what what this info

613
00:38:01,089 --> 00:38:06,400
file does but the important thing is

614
00:38:02,950 --> 00:38:10,598
this one if I added a source code of

615
00:38:06,400 --> 00:38:13,390
this VBS it has parameters so that any

616
00:38:10,599 --> 00:38:18,960
command I include here is executed any

617
00:38:13,390 --> 00:38:21,520
command I put here and it's CMD great

618
00:38:18,960 --> 00:38:26,740
and it creates an object position which

619
00:38:21,520 --> 00:38:32,890
is a shell we're going to watch the

620
00:38:26,740 --> 00:38:36,569
video I'm going to execute it not bad

621
00:38:32,890 --> 00:38:40,540
but not directly VBS is going to do it I

622
00:38:36,570 --> 00:38:44,170
launch it and it's executed this means

623
00:38:40,540 --> 00:38:47,020
that the program can launch any program

624
00:38:44,170 --> 00:38:54,270
of just note but any program I stayed

625
00:38:47,020 --> 00:38:54,270
here and this launched and an info dot X

626
00:38:56,430 --> 00:39:04,000
it allows me to execute any file by

627
00:39:02,050 --> 00:39:10,570
passing the restriction policy the

628
00:39:04,000 --> 00:39:13,570
machine may have if I take a look at my

629
00:39:10,570 --> 00:39:16,530
info file and knowing the attacker uses

630
00:39:13,570 --> 00:39:19,270
CMD constantly I'm not applying

631
00:39:16,530 --> 00:39:24,900
reverse-engineer and I just took a text

632
00:39:19,270 --> 00:39:27,900
editor and I see this I see it launches

633
00:39:24,900 --> 00:39:34,170
within system 32

634
00:39:27,900 --> 00:39:37,950
launches a program called C MTP and it

635
00:39:34,170 --> 00:39:41,190
launches a setup dot INF which

636
00:39:37,950 --> 00:39:43,680
apparently was downloaded before so I

637
00:39:41,190 --> 00:39:46,859
look for information it's a Microsoft

638
00:39:43,680 --> 00:39:54,180
program that allows to be executed in

639
00:39:46,859 --> 00:39:56,940
Windows and allows X installations let's

640
00:39:54,180 --> 00:40:00,180
see what it does and stop it because

641
00:39:56,940 --> 00:40:02,010
this next week's behaved I've tried to

642
00:40:00,180 --> 00:40:05,089
simulate the attacker

643
00:40:02,010 --> 00:40:05,089
[Music]

644
00:40:05,530 --> 00:40:16,369
so using our windows Brown called RAM

645
00:40:09,650 --> 00:40:22,369
DLL and writing this of this courtesy

646
00:40:16,369 --> 00:40:25,940
here just by including and INF file and

647
00:40:22,369 --> 00:40:28,339
execute what's included in any NF file i

648
00:40:25,940 --> 00:40:30,980
in a fight and i in a file is a text

649
00:40:28,339 --> 00:40:42,828
file that allows you to launch another

650
00:40:30,980 --> 00:40:45,349
command let's see i'll execute it here

651
00:40:42,829 --> 00:40:52,810
I'm saying Spencer don't

652
00:40:45,349 --> 00:40:56,390
INF now I edit peridot INF and this file

653
00:40:52,810 --> 00:41:02,650
well these are parameters particular cat

654
00:40:56,390 --> 00:41:08,900
this pedra pop it launches a bedrock dot

655
00:41:02,650 --> 00:41:12,260
SCT it's a convoluted Atlantis's VBS VBS

656
00:41:08,900 --> 00:41:14,060
cause alleged legitimate file from

657
00:41:12,260 --> 00:41:17,780
windows

658
00:41:14,060 --> 00:41:22,490
five quotes an info dote INF and this

659
00:41:17,780 --> 00:41:26,090
INF launches an SCT to reach the

660
00:41:22,490 --> 00:41:32,740
following to get to the following this

661
00:41:26,090 --> 00:41:39,400
little file peter dot SCT if we edit it

662
00:41:32,740 --> 00:41:42,200
it allows you to inject within this file

663
00:41:39,400 --> 00:41:45,890
javascript a visual basic script code

664
00:41:42,200 --> 00:41:48,980
and execute what i stayed here do you

665
00:41:45,890 --> 00:41:52,040
understand it means that if notepad is

666
00:41:48,980 --> 00:41:54,320
recent rated with this type of trick i

667
00:41:52,040 --> 00:41:57,259
can execute it even though i've said

668
00:41:54,320 --> 00:41:59,680
that it can't be executed why because

669
00:41:57,260 --> 00:42:03,130
it's executed in him in the elevator

670
00:41:59,680 --> 00:42:07,910
context using the microsoft project is

671
00:42:03,130 --> 00:42:11,230
in a way that any valid windows program

672
00:42:07,910 --> 00:42:11,230
can execute it I

673
00:42:18,940 --> 00:42:27,940
now this is the resort but let's imagine

674
00:42:25,359 --> 00:42:31,509
that instead of note but is any malware

675
00:42:27,940 --> 00:42:33,819
which we are not supposed to it allows

676
00:42:31,510 --> 00:42:35,650
you to bypass the machines restriction

677
00:42:33,819 --> 00:42:38,380
in the attacker use these techniques in

678
00:42:35,650 --> 00:42:42,160
case it was being monitored or if the

679
00:42:38,380 --> 00:42:46,049
scattered system had a danger that was

680
00:42:42,160 --> 00:42:48,640
somehow closed and only the restricted

681
00:42:46,049 --> 00:42:50,829
the allowed programs could be installed

682
00:42:48,640 --> 00:42:52,480
without installing anything weird in the

683
00:42:50,829 --> 00:42:58,539
machine just by using the operating

684
00:42:52,480 --> 00:43:01,390
system this is another example it's

685
00:42:58,539 --> 00:43:04,660
another video but it downloads from the

686
00:43:01,390 --> 00:43:10,990
Internet it's an environment I tested

687
00:43:04,660 --> 00:43:13,180
here to see whether how an environment

688
00:43:10,990 --> 00:43:15,970
interest power cells cannot be executed

689
00:43:13,180 --> 00:43:22,000
there executed the same basis I'm going

690
00:43:15,970 --> 00:43:25,029
to use MSTP noted to launch an info if I

691
00:43:22,000 --> 00:43:27,190
edit this it goes to an internet URL

692
00:43:25,029 --> 00:43:30,819
this is mine with a malware which is a

693
00:43:27,190 --> 00:43:34,359
necessity file same thing instead of

694
00:43:30,819 --> 00:43:39,400
being local it's in the Internet what do

695
00:43:34,359 --> 00:43:46,109
I have here I have a lot of code and

696
00:43:39,400 --> 00:43:49,809
visual basic script and I request the

697
00:43:46,109 --> 00:43:51,910
shell which is this it's an executable

698
00:43:49,809 --> 00:43:54,000
which has been serialized I do not

699
00:43:51,910 --> 00:43:58,440
download an X

700
00:43:54,000 --> 00:44:01,260
when the machine is executed in the

701
00:43:58,440 --> 00:44:03,510
machining but execute JavaScript with an

702
00:44:01,260 --> 00:44:07,290
executable program which is this one

703
00:44:03,510 --> 00:44:15,680
with a lot of lines I'm going to launch

704
00:44:07,290 --> 00:44:19,259
it and this is the powershell and

705
00:44:15,680 --> 00:44:21,299
secession it's downloaded from the

706
00:44:19,260 --> 00:44:23,310
internet PS it does not stand for better

707
00:44:21,300 --> 00:44:26,609
Santas it's PowerShell and there I can

708
00:44:23,310 --> 00:44:29,070
see the content I don't know whether

709
00:44:26,609 --> 00:44:31,590
this is clear in an environment in which

710
00:44:29,070 --> 00:44:33,780
I can I cannot execute power shell

711
00:44:31,590 --> 00:44:36,990
because it's closed I can bypass it

712
00:44:33,780 --> 00:44:40,109
using lash or attack techniques using

713
00:44:36,990 --> 00:44:48,598
commands from the operating system and

714
00:44:40,109 --> 00:44:51,380
this would be another one thread

715
00:44:48,599 --> 00:44:51,380
parameters

716
00:44:58,280 --> 00:45:08,690
this is quite similar

717
00:45:01,270 --> 00:45:12,920
but it's basically the same thing so I

718
00:45:08,690 --> 00:45:16,550
already know how my attacker acts I have

719
00:45:12,920 --> 00:45:18,890
a forensic analysis it's taken me two

720
00:45:16,550 --> 00:45:21,440
months to understand how he acts how he

721
00:45:18,890 --> 00:45:25,578
programs you need to think about

722
00:45:21,440 --> 00:45:28,220
everything best from that I start with

723
00:45:25,579 --> 00:45:30,470
Intel threat intelligence what's that

724
00:45:28,220 --> 00:45:38,480
it's investigating whether this has

725
00:45:30,470 --> 00:45:40,220
happened before my communication system

726
00:45:38,480 --> 00:45:44,450
with other colleagues harvesting this

727
00:45:40,220 --> 00:45:47,720
and with my eyes I see that yes these

728
00:45:44,450 --> 00:45:50,569
techniques have been described in

729
00:45:47,720 --> 00:46:01,779
Twitter so they existed and take a look

730
00:45:50,570 --> 00:46:01,780
at the dates 2013 it's always been there

731
00:46:08,180 --> 00:46:13,890
someone has to identify the operating

732
00:46:10,530 --> 00:46:15,960
system here 1919 it was already in place

733
00:46:13,890 --> 00:46:19,710
in 1990s and the bad guys are very good

734
00:46:15,960 --> 00:46:22,200
bad guys in investigate and they they

735
00:46:19,710 --> 00:46:32,970
think oh I've seen this colleague of

736
00:46:22,200 --> 00:46:38,700
mine said so you're scared and we

737
00:46:32,970 --> 00:46:41,600
thought how far they reached so this is

738
00:46:38,700 --> 00:46:45,560
how we reach the Cuckoo's egg

739
00:46:41,600 --> 00:46:49,690
these are PLC's from a co manufacturer

740
00:46:45,560 --> 00:46:53,240
they have an embedded Windows Windows 10

741
00:46:49,690 --> 00:46:57,980
and in eight of its windows 10 it can be

742
00:46:53,240 --> 00:47:01,370
executed it controls the production area

743
00:46:57,980 --> 00:47:05,840
it controls the hard way this is the

744
00:47:01,370 --> 00:47:09,710
reality when it controls packages number

745
00:47:05,840 --> 00:47:12,260
of packages drawings everything say we

746
00:47:09,710 --> 00:47:14,390
analyzed the manufacturer information

747
00:47:12,260 --> 00:47:16,730
the one which is written on the website

748
00:47:14,390 --> 00:47:20,560
in the handbooks let's see how can how

749
00:47:16,730 --> 00:47:20,560
we can access the plc and this is how

750
00:47:24,810 --> 00:47:28,470
you seen it right

751
00:47:29,680 --> 00:47:37,299
it wasn't too complicated it was it was

752
00:47:34,630 --> 00:47:42,280
on a Monday or was done on a Friday by

753
00:47:37,300 --> 00:47:45,490
the engineer he was in a hurry Sulak for

754
00:47:42,280 --> 00:47:47,440
information and you don't be meant to be

755
00:47:45,490 --> 00:47:50,410
a malware specialist or study

756
00:47:47,440 --> 00:47:52,900
engineering for five years you enter

757
00:47:50,410 --> 00:47:56,290
like this and that's that's it all you

758
00:47:52,900 --> 00:47:57,980
can use the website to get in and it's

759
00:47:56,290 --> 00:48:01,009
simple

760
00:47:57,980 --> 00:48:04,609
they're my call the manufacturer hey

761
00:48:01,010 --> 00:48:09,740
girl has this how's this possible well

762
00:48:04,609 --> 00:48:12,529
yes we favor manufacturing over

763
00:48:09,740 --> 00:48:18,078
production over security so this is a

764
00:48:12,530 --> 00:48:23,599
handbook so that our users implement

765
00:48:18,079 --> 00:48:28,460
security is like having a car that after

766
00:48:23,599 --> 00:48:31,040
120 km/h you get killed so as the user

767
00:48:28,460 --> 00:48:35,650
responsibility not to drive over 120

768
00:48:31,040 --> 00:48:35,650
km/h and this is a problem

769
00:48:37,410 --> 00:48:43,170
well so see there's a directory when the

770
00:48:40,650 --> 00:48:47,370
PLC which is this one and we see source

771
00:48:43,170 --> 00:48:48,920
code of PLC they usually work in

772
00:48:47,370 --> 00:48:53,130
different formats

773
00:48:48,920 --> 00:48:55,350
it's a ladder's native code you can't

774
00:48:53,130 --> 00:48:58,290
see it very well but this is a code

775
00:48:55,350 --> 00:49:00,900
which we understand is the PLC it was

776
00:48:58,290 --> 00:49:05,220
pointing to an IP address which would be

777
00:49:00,900 --> 00:49:07,800
this one here which is the same the same

778
00:49:05,220 --> 00:49:10,500
one in Iran so I asked them do you have

779
00:49:07,800 --> 00:49:13,380
any programmer from Iran do you have any

780
00:49:10,500 --> 00:49:18,570
product in Iran who did this we don't

781
00:49:13,380 --> 00:49:22,800
know no one in the company so we assumed

782
00:49:18,570 --> 00:49:25,560
they had reached PLC the machine using

783
00:49:22,800 --> 00:49:28,260
these techniques of password one and

784
00:49:25,560 --> 00:49:33,080
they've launched they fused a program

785
00:49:28,260 --> 00:49:37,410
and when it was launched it communicated

786
00:49:33,080 --> 00:49:40,620
with this IB since there was the PLC

787
00:49:37,410 --> 00:49:46,170
could not exit access the internet it

788
00:49:40,620 --> 00:49:50,180
stopped for 10 milliseconds and people

789
00:49:46,170 --> 00:49:53,190
said ok 10 milliseconds

790
00:49:50,180 --> 00:49:55,919
there's something wrong in the

791
00:49:53,190 --> 00:49:59,820
industrial environment were scattered

792
00:49:55,920 --> 00:50:00,540
system and what was happening who is

793
00:49:59,820 --> 00:50:03,840
huge

794
00:50:00,540 --> 00:50:06,630
malware within the PLC that caused there

795
00:50:03,840 --> 00:50:09,560
was ten milliseconds and it didn't work

796
00:50:06,630 --> 00:50:09,560
for whatever reason

797
00:50:10,539 --> 00:50:18,499
this was other piece of evidence you

798
00:50:14,539 --> 00:50:22,309
have IP remote we have threat

799
00:50:18,499 --> 00:50:25,368
intelligence team and we ask them detect

800
00:50:22,309 --> 00:50:29,799
what was there in those IPs and that's

801
00:50:25,369 --> 00:50:29,799
what they get lot of malware

802
00:50:29,970 --> 00:50:36,790
they're from Iran

803
00:50:33,400 --> 00:50:39,340
and now we will move on to threat

804
00:50:36,790 --> 00:50:46,110
hunting how do I catch this person or

805
00:50:39,340 --> 00:50:46,110
the group of people and here

806
00:50:46,170 --> 00:50:53,630
I use this in programming environments

807
00:50:50,670 --> 00:50:56,839
when the bad guy compiled

808
00:50:53,630 --> 00:51:01,309
there was a file which is this one

809
00:50:56,839 --> 00:51:05,119
thought PDB that saved the compilation

810
00:51:01,309 --> 00:51:10,220
rock and I said ok what happened here

811
00:51:05,119 --> 00:51:13,369
the bad guy made a mistake they copied

812
00:51:10,220 --> 00:51:16,480
the whole file but into the server and

813
00:51:13,369 --> 00:51:22,670
they uploaded this little file

814
00:51:16,480 --> 00:51:25,880
identified x-man the in the intelligence

815
00:51:22,670 --> 00:51:28,519
process start to speak you start to talk

816
00:51:25,880 --> 00:51:31,430
to everyone law enforcement American

817
00:51:28,519 --> 00:51:33,828
agencies and they provided with

818
00:51:31,430 --> 00:51:36,129
information and they took me oh we know

819
00:51:33,829 --> 00:51:39,130
about this one they have identified it

820
00:51:36,130 --> 00:51:39,130
him

821
00:51:39,320 --> 00:51:44,510
his active in a forum his always

822
00:51:42,560 --> 00:51:48,500
complain about the US this information

823
00:51:44,510 --> 00:51:52,490
we gathered this is the hunting slide

824
00:51:48,500 --> 00:51:54,800
the work and paste this together with

825
00:51:52,490 --> 00:51:58,939
intelligence we try to discover who this

826
00:51:54,800 --> 00:52:01,100
person was last year I gave a similar

827
00:51:58,940 --> 00:52:02,930
lecture and it came from North Korea

828
00:52:01,100 --> 00:52:05,660
when there's a government behind it it's

829
00:52:02,930 --> 00:52:08,109
very complicated well you cannot tell

830
00:52:05,660 --> 00:52:10,290
King young hey someone there is

831
00:52:08,110 --> 00:52:12,990
attacking me

832
00:52:10,290 --> 00:52:15,420
so with this type of things we have this

833
00:52:12,990 --> 00:52:17,580
problem this type of groups belong to

834
00:52:15,420 --> 00:52:20,850
governments and it's really complicated

835
00:52:17,580 --> 00:52:22,830
to go further but it's a good thing that

836
00:52:20,850 --> 00:52:25,170
we can identify them and just matter of

837
00:52:22,830 --> 00:52:29,040
fact the FBI is looking for them some of

838
00:52:25,170 --> 00:52:31,860
them have been called what did we see we

839
00:52:29,040 --> 00:52:36,480
see code injection techniques that were

840
00:52:31,860 --> 00:52:38,220
used and covered cold the yeast native

841
00:52:36,480 --> 00:52:43,200
code of the operating system they were

842
00:52:38,220 --> 00:52:47,509
not using weird malware weird objects it

843
00:52:43,200 --> 00:52:51,180
belonged to a group called peat a bt 33

844
00:52:47,510 --> 00:52:54,510
code like this because many servers they

845
00:52:51,180 --> 00:52:57,569
have published things with that same

846
00:52:54,510 --> 00:53:02,010
code so we know about this group what

847
00:52:57,570 --> 00:53:03,600
else we see that they reuse it in the

848
00:53:02,010 --> 00:53:05,940
past they've used other types of

849
00:53:03,600 --> 00:53:09,390
programs and the same technique of using

850
00:53:05,940 --> 00:53:13,230
a an email server and attacking it and

851
00:53:09,390 --> 00:53:20,029
we had that information the places were

852
00:53:13,230 --> 00:53:20,030
they acted and based on this information

853
00:53:20,290 --> 00:53:26,980
we carried a scoring of this group we

854
00:53:24,070 --> 00:53:30,910
sent it to law enforcement in this case

855
00:53:26,980 --> 00:53:35,710
the US and they arrested an individual

856
00:53:30,910 --> 00:53:40,509
who was in that country it you can look

857
00:53:35,710 --> 00:53:43,030
look it up into the internet and I could

858
00:53:40,510 --> 00:53:45,610
help us I could help them to identify an

859
00:53:43,030 --> 00:53:47,900
attacker and this is the end of my

860
00:53:45,610 --> 00:53:54,170
presentation thank you

861
00:53:47,900 --> 00:54:00,280
[Applause]

862
00:53:54,170 --> 00:54:00,280
[Music]

