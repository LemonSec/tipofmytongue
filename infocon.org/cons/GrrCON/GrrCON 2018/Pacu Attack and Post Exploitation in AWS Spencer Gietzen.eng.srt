1
00:00:09,860 --> 00:00:18,539
can everyone<font color="#CCCCCC"> hear me all right</font><font color="#E5E5E5"> with the</font>

2
00:00:12,170 --> 00:00:20,520
mic sound good<font color="#CCCCCC"> good</font><font color="#E5E5E5"> hope all right my</font>

3
00:00:18,539 --> 00:00:22,500
<font color="#E5E5E5">name is Spencer</font><font color="#CCCCCC"> Dietzen</font><font color="#E5E5E5"> I work with</font>

4
00:00:20,520 --> 00:00:24,419
<font color="#CCCCCC">minor security labs as a pen tester</font>

5
00:00:22,500 --> 00:00:27,689
<font color="#E5E5E5">today I'm going</font><font color="#CCCCCC"> to talk</font><font color="#E5E5E5"> to you about</font>

6
00:00:24,420 --> 00:00:31,980
<font color="#CCCCCC">PACU the</font><font color="#E5E5E5"> open source AWS exploitation</font>

7
00:00:27,689 --> 00:00:35,070
framework so I'm a pen tester with focus

8
00:00:31,980 --> 00:00:37,559
on the cloud<font color="#E5E5E5"> AWS in particular I'm the</font>

9
00:00:35,070 --> 00:00:39,120
lead developer<font color="#CCCCCC"> of</font><font color="#E5E5E5"> PACU and so a lot of</font>

10
00:00:37,559 --> 00:00:42,059
this<font color="#E5E5E5"> put a lot of work into this</font>

11
00:00:39,120 --> 00:00:43,919
<font color="#E5E5E5">recently and</font><font color="#CCCCCC"> I'm here to talk</font><font color="#E5E5E5"> to you</font>

12
00:00:42,059 --> 00:00:46,800
about AWS security and penetration

13
00:00:43,920 --> 00:00:48,210
<font color="#E5E5E5">testing and then how</font><font color="#CCCCCC"> PACU can solve a</font>

14
00:00:46,800 --> 00:00:53,819
lot<font color="#CCCCCC"> of problems within that</font><font color="#E5E5E5"> field right</font>

15
00:00:48,210 --> 00:00:55,949
<font color="#E5E5E5">now so in general getting started with</font>

16
00:00:53,820 --> 00:00:57,750
AWS Security's pretty simple you know

17
00:00:55,949 --> 00:00:59,190
there's the CIS benchmarks a lot of

18
00:00:57,750 --> 00:01:01,980
things to get you started<font color="#E5E5E5"> a lot of good</font>

19
00:00:59,190 --> 00:01:04,018
resources<font color="#E5E5E5"> white papers research from</font>

20
00:01:01,980 --> 00:01:05,518
different researchers blog posts<font color="#CCCCCC"> you</font>

21
00:01:04,019 --> 00:01:07,590
<font color="#CCCCCC">know a lot of</font><font color="#E5E5E5"> different things</font><font color="#CCCCCC"> like that</font>

22
00:01:05,519 --> 00:01:09,689
<font color="#E5E5E5">but it's difficult to</font><font color="#CCCCCC"> know when you're</font>

23
00:01:07,590 --> 00:01:10,799
<font color="#E5E5E5">doing everything right</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> it's</font>

24
00:01:09,689 --> 00:01:13,110
<font color="#E5E5E5">difficult to know when you're doing</font>

25
00:01:10,799 --> 00:01:14,820
everything right<font color="#E5E5E5"> for every one of your</font>

26
00:01:13,110 --> 00:01:15,560
environments<font color="#E5E5E5"> all of your resources and</font>

27
00:01:14,820 --> 00:01:19,408
everything<font color="#E5E5E5"> like that</font>

28
00:01:15,560 --> 00:01:22,200
<font color="#CCCCCC">so you</font><font color="#E5E5E5"> know it's so hard that even some</font>

29
00:01:19,409 --> 00:01:23,909
<font color="#E5E5E5">of the best companies are messing it up</font>

30
00:01:22,200 --> 00:01:27,030
<font color="#E5E5E5">and that's been</font><font color="#CCCCCC"> shown time</font><font color="#E5E5E5"> and time</font>

31
00:01:23,909 --> 00:01:27,890
<font color="#CCCCCC">again with you know s3 bucket</font><font color="#E5E5E5"> leaks and</font>

32
00:01:27,030 --> 00:01:30,150
<font color="#E5E5E5">things like that</font>

33
00:01:27,890 --> 00:01:32,400
<font color="#CCCCCC">uber had to github repo missed</font>

34
00:01:30,150 --> 00:01:34,680
configuration where they leaked some

35
00:01:32,400 --> 00:01:36,090
<font color="#E5E5E5">keys out in a commit or something like</font>

36
00:01:34,680 --> 00:01:38,790
<font color="#CCCCCC">that and someone</font><font color="#E5E5E5"> got access to</font><font color="#CCCCCC"> their</font>

37
00:01:36,090 --> 00:01:41,899
environment<font color="#CCCCCC"> a Tesla they had an</font>

38
00:01:38,790 --> 00:01:44,250
unsecured<font color="#E5E5E5"> IT admin console</font><font color="#CCCCCC"> public-facing</font>

39
00:01:41,899 --> 00:01:46,290
<font color="#CCCCCC">someone was able to log in there and get</font>

40
00:01:44,250 --> 00:01:48,659
some<font color="#E5E5E5"> credentials</font><font color="#CCCCCC"> they started mining</font>

41
00:01:46,290 --> 00:01:51,090
cryptocurrency<font color="#CCCCCC"> in their account for I</font>

42
00:01:48,659 --> 00:01:53,430
think<font color="#E5E5E5"> it was three</font><font color="#CCCCCC"> or so days before</font>

43
00:01:51,090 --> 00:01:56,280
they had caught<font color="#CCCCCC"> that as well as you know</font>

44
00:01:53,430 --> 00:01:58,740
Dow Jones WWE thousands of other

45
00:01:56,280 --> 00:02:01,380
companies with<font color="#E5E5E5"> s3 bucket leaks</font>

46
00:01:58,740 --> 00:02:03,270
you know leaking sensitive data all

47
00:02:01,380 --> 00:02:05,850
kinds of stuff<font color="#CCCCCC"> not sure if you can read</font>

48
00:02:03,270 --> 00:02:08,489
the<font color="#CCCCCC"> text in that picture</font><font color="#E5E5E5"> there but if</font>

49
00:02:05,850 --> 00:02:10,769
you've ever looked<font color="#E5E5E5"> at a list of all s3</font>

50
00:02:08,489 --> 00:02:12,690
bucket that might look familiar<font color="#CCCCCC"> I can</font>

51
00:02:10,770 --> 00:02:13,740
see there's some credit card info<font color="#E5E5E5"> clear</font>

52
00:02:12,690 --> 00:02:17,750
text passwords in there

53
00:02:13,740 --> 00:02:22,470
you know the usual<font color="#E5E5E5"> stuff it seems like</font>

54
00:02:17,750 --> 00:02:26,760
so<font color="#E5E5E5"> as bad as s3 bucket leaks are</font><font color="#CCCCCC"> they're</font>

55
00:02:22,470 --> 00:02:29,580
really<font color="#CCCCCC"> only the surface of compromise</font>

56
00:02:26,760 --> 00:02:32,489
<font color="#CCCCCC">within AWS and so it's far</font><font color="#E5E5E5"> more</font>

57
00:02:29,580 --> 00:02:33,840
<font color="#CCCCCC">devastating to lose your keys and if an</font>

58
00:02:32,490 --> 00:02:36,570
attacker knows what they're doing<font color="#E5E5E5"> with</font>

59
00:02:33,840 --> 00:02:39,240
those keys<font color="#E5E5E5"> that can be really really</font><font color="#CCCCCC"> bad</font>

60
00:02:36,570 --> 00:02:41,549
for<font color="#CCCCCC"> your company in your environment so</font>

61
00:02:39,240 --> 00:02:45,420
a<font color="#E5E5E5"> lot</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> different ways that</font><font color="#CCCCCC"> keys can</font>

62
00:02:41,550 --> 00:02:47,970
get lost<font color="#E5E5E5"> this includes github commits</font>

63
00:02:45,420 --> 00:02:50,549
<font color="#E5E5E5">like uber just</font><font color="#CCCCCC"> talked about social</font>

64
00:02:47,970 --> 00:02:52,580
<font color="#E5E5E5">engineering</font><font color="#CCCCCC"> and phishing</font><font color="#E5E5E5"> you could get</font>

65
00:02:50,550 --> 00:02:55,140
someone's keys or most likely someone's

66
00:02:52,580 --> 00:02:58,980
<font color="#E5E5E5">username and password for the AWS</font>

67
00:02:55,140 --> 00:03:01,170
console this way<font color="#CCCCCC"> password reuse this is</font>

68
00:02:58,980 --> 00:03:02,970
something I find<font color="#E5E5E5"> a lot as a pen testers</font>

69
00:03:01,170 --> 00:03:05,010
<font color="#CCCCCC">you know I find someone's leaked</font>

70
00:03:02,970 --> 00:03:06,420
password online<font color="#E5E5E5"> from some database hack</font>

71
00:03:05,010 --> 00:03:08,220
and they're<font color="#E5E5E5"> using the same exact</font>

72
00:03:06,420 --> 00:03:11,760
password and<font color="#E5E5E5"> username across multiple</font>

73
00:03:08,220 --> 00:03:14,910
websites as well<font color="#CCCCCC"> as web application</font>

74
00:03:11,760 --> 00:03:17,269
vulnerabilities through the ec2 metadata

75
00:03:14,910 --> 00:03:19,680
service you can retrieve credentials for

76
00:03:17,270 --> 00:03:21,690
you know a role<font color="#E5E5E5"> that's attached to an AC</font>

77
00:03:19,680 --> 00:03:23,850
<font color="#E5E5E5">to instance basically so if you can</font>

78
00:03:21,690 --> 00:03:25,560
somehow make requests outbound from<font color="#E5E5E5"> a</font>

79
00:03:23,850 --> 00:03:27,720
server<font color="#E5E5E5"> you could make a request to</font><font color="#CCCCCC"> that</font>

80
00:03:25,560 --> 00:03:30,180
<font color="#E5E5E5">and read the response which includes</font>

81
00:03:27,720 --> 00:03:31,859
keys for that that server

82
00:03:30,180 --> 00:03:34,020
<font color="#E5E5E5">it's that could include</font><font color="#CCCCCC"> server-side</font>

83
00:03:31,860 --> 00:03:36,590
request forgery local file read could

84
00:03:34,020 --> 00:03:39,150
get some keys or obviously<font color="#CCCCCC"> RCE</font>

85
00:03:36,590 --> 00:03:42,000
as well as internal threats and rogue

86
00:03:39,150 --> 00:03:44,250
employees<font color="#E5E5E5"> I</font><font color="#CCCCCC"> don't</font><font color="#E5E5E5"> think people think</font>

87
00:03:42,000 --> 00:03:46,140
about<font color="#E5E5E5"> this quite as much</font><font color="#CCCCCC"> because you</font>

88
00:03:44,250 --> 00:03:48,810
<font color="#CCCCCC">know they don't seem as much of a</font><font color="#E5E5E5"> threat</font>

89
00:03:46,140 --> 00:03:50,220
but<font color="#E5E5E5"> in general they there's a barrier</font>

90
00:03:48,810 --> 00:03:51,570
they don't need<font color="#E5E5E5"> to pass they don't need</font>

91
00:03:50,220 --> 00:03:53,400
to compromise credentials they've

92
00:03:51,570 --> 00:03:54,630
already got credentials<font color="#CCCCCC"> and they've</font>

93
00:03:53,400 --> 00:03:56,370
already got access<font color="#CCCCCC"> to</font><font color="#E5E5E5"> your</font><font color="#CCCCCC"> environment</font>

94
00:03:54,630 --> 00:03:59,750
and you know that<font color="#E5E5E5"> so a little bit a</font>

95
00:03:56,370 --> 00:04:03,200
<font color="#E5E5E5">little</font><font color="#CCCCCC"> bit scarier if that does happen</font>

96
00:03:59,750 --> 00:04:05,910
so penetration testing on AWS

97
00:04:03,200 --> 00:04:07,769
you know there's<font color="#CCCCCC"> lot of tools out</font><font color="#E5E5E5"> there</font>

98
00:04:05,910 --> 00:04:09,870
<font color="#CCCCCC">for configuration scanning best</font>

99
00:04:07,770 --> 00:04:11,880
practices checking your environment

100
00:04:09,870 --> 00:04:14,430
against CIS benchmarks<font color="#E5E5E5"> and things like</font>

101
00:04:11,880 --> 00:04:17,130
<font color="#E5E5E5">that</font><font color="#CCCCCC"> tools</font><font color="#E5E5E5"> that do this are</font><font color="#CCCCCC"> prowler</font><font color="#E5E5E5"> or</font>

102
00:04:14,430 --> 00:04:19,019
<font color="#CCCCCC">Scout</font><font color="#E5E5E5"> to clouds</font><font color="#CCCCCC"> Floyd and there are some</font>

103
00:04:17,130 --> 00:04:21,870
others<font color="#E5E5E5"> great tools and I've worked with</font>

104
00:04:19,019 --> 00:04:25,080
<font color="#E5E5E5">some of the developers for those but as</font>

105
00:04:21,870 --> 00:04:26,700
an attacker there's not very much<font color="#E5E5E5"> that's</font>

106
00:04:25,080 --> 00:04:28,500
available to<font color="#E5E5E5"> us</font>

107
00:04:26,700 --> 00:04:32,520
there are some tools out<font color="#E5E5E5"> there like AWS</font>

108
00:04:28,500 --> 00:04:36,990
pone nimbostratus<font color="#E5E5E5"> dumpster diver really</font>

109
00:04:32,520 --> 00:04:39,359
great tools and you<font color="#E5E5E5"> know they get used I</font>

110
00:04:36,990 --> 00:04:42,360
know that a<font color="#E5E5E5"> lot used a lot and the</font>

111
00:04:39,360 --> 00:04:45,270
problem is<font color="#E5E5E5"> that these</font><font color="#CCCCCC"> tools aren't</font><font color="#E5E5E5"> being</font>

112
00:04:42,360 --> 00:04:47,550
updated<font color="#E5E5E5"> or new a lot of the tools aren't</font>

113
00:04:45,270 --> 00:04:50,219
<font color="#E5E5E5">being updated very often some of them</font>

114
00:04:47,550 --> 00:04:52,740
are it's been<font color="#E5E5E5"> years months since the</font>

115
00:04:50,220 --> 00:04:55,950
last<font color="#E5E5E5"> update and</font><font color="#CCCCCC"> that doesn't quite match</font>

116
00:04:52,740 --> 00:04:58,280
<font color="#CCCCCC">the speed</font><font color="#E5E5E5"> that AWS is changing and so</font>

117
00:04:55,950 --> 00:05:00,900
with the API<font color="#E5E5E5"> and everything changing</font>

118
00:04:58,280 --> 00:05:02,820
<font color="#E5E5E5">something more is needed to handle that</font>

119
00:05:00,900 --> 00:05:06,539
and handle the new services and<font color="#CCCCCC"> new</font>

120
00:05:02,820 --> 00:05:09,020
exploits that<font color="#E5E5E5"> are coming out</font><font color="#CCCCCC"> so what</font>

121
00:05:06,540 --> 00:05:11,370
what we really need in this area<font color="#E5E5E5"> is</font>

122
00:05:09,020 --> 00:05:14,130
something<font color="#CCCCCC"> that can turn you know complex</font>

123
00:05:11,370 --> 00:05:17,610
<font color="#E5E5E5">multi-step attacks into just a single</font>

124
00:05:14,130 --> 00:05:19,620
<font color="#CCCCCC">command</font><font color="#E5E5E5"> make it easy and then we take</font>

125
00:05:17,610 --> 00:05:22,380
out the unnecessary<font color="#E5E5E5"> and repetitive tasks</font>

126
00:05:19,620 --> 00:05:23,990
<font color="#E5E5E5">from the attacker side and developer</font>

127
00:05:22,380 --> 00:05:26,700
side who<font color="#CCCCCC"> are developing</font><font color="#E5E5E5"> these exploits</font>

128
00:05:23,990 --> 00:05:27,810
<font color="#CCCCCC">make it easier to</font><font color="#E5E5E5"> expand these and you</font>

129
00:05:26,700 --> 00:05:31,620
<font color="#E5E5E5">know get your work out into the public</font>

130
00:05:27,810 --> 00:05:34,500
<font color="#E5E5E5">and</font><font color="#CCCCCC"> we need to be</font><font color="#E5E5E5"> future proof so we</font>

131
00:05:31,620 --> 00:05:37,950
need it<font color="#E5E5E5"> to be modular</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> know an</font>

132
00:05:34,500 --> 00:05:41,130
enumeration module numeration module can

133
00:05:37,950 --> 00:05:42,690
<font color="#CCCCCC">be</font><font color="#E5E5E5"> worked well with you</font><font color="#CCCCCC"> know something</font>

134
00:05:41,130 --> 00:05:44,850
that's doing some sort of exploitation

135
00:05:42,690 --> 00:05:46,920
<font color="#E5E5E5">someone who's writing an ec2</font>

136
00:05:44,850 --> 00:05:48,870
exploitation module doesn't<font color="#CCCCCC"> need to</font>

137
00:05:46,920 --> 00:05:50,420
worry about<font color="#E5E5E5"> enumerate anything something</font>

138
00:05:48,870 --> 00:05:53,520
<font color="#E5E5E5">else</font><font color="#CCCCCC"> should</font><font color="#E5E5E5"> be able to handle</font><font color="#CCCCCC"> that and</font>

139
00:05:50,420 --> 00:05:56,700
it needs to be<font color="#E5E5E5"> extensible so with how</font>

140
00:05:53,520 --> 00:05:58,680
fast AWS grows and changes the tools and

141
00:05:56,700 --> 00:06:00,300
modules need to have you know it needs

142
00:05:58,680 --> 00:06:03,210
<font color="#CCCCCC">to be</font><font color="#E5E5E5"> easy to do that</font><font color="#CCCCCC"> as well</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> it can</font>

143
00:06:00,300 --> 00:06:05,340
<font color="#E5E5E5">keep up and</font><font color="#CCCCCC"> it needs</font><font color="#E5E5E5"> to be offensive</font>

144
00:06:03,210 --> 00:06:09,150
focus so there already are a lot of

145
00:06:05,340 --> 00:06:12,210
<font color="#CCCCCC">necess of the cloud tools</font><font color="#E5E5E5"> but we</font><font color="#CCCCCC"> needed</font>

146
00:06:09,150 --> 00:06:15,890
a<font color="#CCCCCC"> Metasploit and so that's kind of</font><font color="#E5E5E5"> why</font>

147
00:06:12,210 --> 00:06:20,159
how<font color="#CCCCCC"> I'll</font><font color="#E5E5E5"> present</font><font color="#CCCCCC"> PACU here which is</font>

148
00:06:15,890 --> 00:06:21,630
offensive AWS<font color="#E5E5E5"> exploitation tool or a</font>

149
00:06:20,160 --> 00:06:24,690
framework<font color="#E5E5E5"> that I built</font>

150
00:06:21,630 --> 00:06:27,719
<font color="#CCCCCC">I built in Python three point five plus</font>

151
00:06:24,690 --> 00:06:29,670
right now that's what it supports covers

152
00:06:27,720 --> 00:06:32,670
<font color="#E5E5E5">the whole kill chain so reconnaissance</font>

153
00:06:29,670 --> 00:06:35,160
<font color="#E5E5E5">logging and monitoring persistence data</font>

154
00:06:32,670 --> 00:06:39,480
<font color="#E5E5E5">exfiltration</font><font color="#CCCCCC"> privilege escalation and</font>

155
00:06:35,160 --> 00:06:40,620
general exploitation<font color="#CCCCCC"> it's simple to</font>

156
00:06:39,480 --> 00:06:43,229
develop modules for

157
00:06:40,620 --> 00:06:45,630
it we<font color="#E5E5E5"> have a built-in template easy to</font>

158
00:06:43,229 --> 00:06:48,060
open<font color="#CCCCCC"> that up</font><font color="#E5E5E5"> see what kind of you</font><font color="#CCCCCC"> know</font>

159
00:06:45,630 --> 00:06:50,400
<font color="#E5E5E5">API we expose different things how</font><font color="#CCCCCC"> you</font>

160
00:06:48,060 --> 00:06:52,460
<font color="#E5E5E5">can easily get your exploits created and</font>

161
00:06:50,400 --> 00:06:55,888
written<font color="#E5E5E5"> and added to the PACU framework</font>

162
00:06:52,460 --> 00:06:57,239
it's extensible<font color="#E5E5E5"> so the</font><font color="#CCCCCC"> built in API</font>

163
00:06:55,889 --> 00:06:59,669
there's a lot of different functions<font color="#CCCCCC"> we</font>

164
00:06:57,240 --> 00:07:01,740
offer that take a lot of repetitive<font color="#E5E5E5"> code</font>

165
00:06:59,669 --> 00:07:03,630
and work out<font color="#E5E5E5"> of your hands</font>

166
00:07:01,740 --> 00:07:06,150
there's session and data management<font color="#CCCCCC"> so a</font>

167
00:07:03,630 --> 00:07:09,060
session is<font color="#CCCCCC"> basically a project or a</font>

168
00:07:06,150 --> 00:07:10,260
company that<font color="#CCCCCC"> you'd be working on</font><font color="#E5E5E5"> I you</font>

169
00:07:09,060 --> 00:07:12,660
know if you you're<font color="#E5E5E5"> working on two</font>

170
00:07:10,260 --> 00:07:14,340
companies<font color="#CCCCCC"> PACU oil</font><font color="#E5E5E5"> separate those two</font>

171
00:07:12,660 --> 00:07:15,930
<font color="#E5E5E5">and you</font><font color="#CCCCCC"> don't ever</font><font color="#E5E5E5"> have to worry</font><font color="#CCCCCC"> about</font>

172
00:07:14,340 --> 00:07:18,060
data that's being<font color="#E5E5E5"> stored getting mixed</font>

173
00:07:15,930 --> 00:07:19,380
up or anything<font color="#E5E5E5"> like that</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> then</font>

174
00:07:18,060 --> 00:07:22,650
there's data management through a local

175
00:07:19,380 --> 00:07:24,930
sequel light database that holds<font color="#CCCCCC"> all the</font>

176
00:07:22,650 --> 00:07:27,270
information<font color="#CCCCCC"> that's logged over the whole</font>

177
00:07:24,930 --> 00:07:29,850
you know engagement with this a certain

178
00:07:27,270 --> 00:07:31,530
company<font color="#E5E5E5"> or certain session as well as</font>

179
00:07:29,850 --> 00:07:32,940
all the keys<font color="#CCCCCC"> that you compromise</font><font color="#E5E5E5"> over</font>

180
00:07:31,530 --> 00:07:35,638
time and you can<font color="#CCCCCC"> swap between those</font>

181
00:07:32,940 --> 00:07:37,650
<font color="#E5E5E5">anytime you'd like and then in general</font>

182
00:07:35,639 --> 00:07:38,789
<font color="#E5E5E5">there's error handling so the</font><font color="#CCCCCC"> program's</font>

183
00:07:37,650 --> 00:07:41,340
never going to crash<font color="#CCCCCC"> and it's never</font>

184
00:07:38,789 --> 00:07:44,130
gonna you know corrupt your database or

185
00:07:41,340 --> 00:07:46,409
anything like<font color="#E5E5E5"> that it's currently open</font>

186
00:07:44,130 --> 00:07:50,099
source on github with the<font color="#CCCCCC"> BSD 3 license</font>

187
00:07:46,410 --> 00:07:52,970
<font color="#E5E5E5">as well so I'm going</font><font color="#CCCCCC"> to go through a</font>

188
00:07:50,099 --> 00:07:56,430
demo here of<font color="#CCCCCC"> PACU</font><font color="#E5E5E5"> start with some</font>

189
00:07:52,970 --> 00:07:58,740
compromised AWS keys<font color="#E5E5E5"> I'll go over using</font>

190
00:07:56,430 --> 00:08:01,460
<font color="#E5E5E5">the PACU console a</font><font color="#CCCCCC"> numerating different</font>

191
00:07:58,740 --> 00:08:03,720
you know settings data<font color="#E5E5E5"> permissions</font>

192
00:08:01,460 --> 00:08:06,510
escalating privileges to gain some<font color="#E5E5E5"> more</font>

193
00:08:03,720 --> 00:08:09,300
access establishing persistence in<font color="#E5E5E5"> the</font>

194
00:08:06,510 --> 00:08:11,760
account<font color="#E5E5E5"> for you know obviously so</font><font color="#CCCCCC"> you</font>

195
00:08:09,300 --> 00:08:13,560
have persistent access and then it will

196
00:08:11,760 --> 00:08:17,610
compromise<font color="#E5E5E5"> an ec2 instance using a</font>

197
00:08:13,560 --> 00:08:26,400
method that could get<font color="#CCCCCC"> RCE</font><font color="#E5E5E5"> as the root</font>

198
00:08:17,610 --> 00:08:29,870
<font color="#E5E5E5">user for</font><font color="#CCCCCC"> Linux or system for Windows so</font>

199
00:08:26,400 --> 00:08:34,110
you just<font color="#E5E5E5"> run</font><font color="#CCCCCC"> the PACU with python three</font>

200
00:08:29,870 --> 00:08:36,690
<font color="#CCCCCC">PACU</font><font color="#E5E5E5"> it'll start up the text is so huge</font>

201
00:08:34,110 --> 00:08:40,020
<font color="#CCCCCC">that it might look a little</font><font color="#E5E5E5"> a little bit</font>

202
00:08:36,690 --> 00:08:41,640
messed up but<font color="#E5E5E5"> we're so it found some</font>

203
00:08:40,020 --> 00:08:44,400
sessions<font color="#CCCCCC"> I already</font><font color="#E5E5E5"> created a session for</font>

204
00:08:41,640 --> 00:08:45,540
<font color="#CCCCCC">agar con</font><font color="#E5E5E5"> otherwise it'll ask you to</font>

205
00:08:44,400 --> 00:08:47,689
create a<font color="#CCCCCC"> new one because it's there's</font>

206
00:08:45,540 --> 00:08:50,550
none in<font color="#E5E5E5"> the database you can choose that</font>

207
00:08:47,690 --> 00:08:53,140
another<font color="#E5E5E5"> problem with the the text size</font>

208
00:08:50,550 --> 00:08:56,979
but<font color="#E5E5E5"> this is the help output that you</font>

209
00:08:53,140 --> 00:08:58,360
a little screwed up<font color="#E5E5E5"> obviously</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> we'll</font>

210
00:08:56,980 --> 00:09:01,600
<font color="#E5E5E5">go</font><font color="#CCCCCC"> over a</font><font color="#E5E5E5"> couple of the common commands</font>

211
00:08:58,360 --> 00:09:03,490
<font color="#E5E5E5">like LS that'll give you a list of all</font>

212
00:09:01,600 --> 00:09:05,529
the modules that<font color="#E5E5E5"> are supported in our in</font>

213
00:09:03,490 --> 00:09:07,060
<font color="#CCCCCC">PACU right now</font><font color="#E5E5E5"> you can go through and</font>

214
00:09:05,529 --> 00:09:09,490
<font color="#CCCCCC">look at</font><font color="#E5E5E5"> the categories and then the</font>

215
00:09:07,060 --> 00:09:12,250
names the different modules<font color="#CCCCCC"> you could</font>

216
00:09:09,490 --> 00:09:13,899
also go through and search for you know

217
00:09:12,250 --> 00:09:17,529
something I<font color="#E5E5E5"> wanted to look at modules</font>

218
00:09:13,899 --> 00:09:21,820
<font color="#E5E5E5">that work with ec2</font><font color="#CCCCCC"> or work on ec2 we get</font>

219
00:09:17,529 --> 00:09:24,040
a couple back here and there's<font color="#CCCCCC"> like a</font>

220
00:09:21,820 --> 00:09:26,260
one-liner sentence description<font color="#E5E5E5"> for</font><font color="#CCCCCC"> each</font>

221
00:09:24,040 --> 00:09:29,319
module here this is just to kind<font color="#CCCCCC"> of give</font>

222
00:09:26,260 --> 00:09:31,300
<font color="#E5E5E5">you an idea of what each module does but</font>

223
00:09:29,320 --> 00:09:32,350
there's also a<font color="#E5E5E5"> help command you can use</font>

224
00:09:31,300 --> 00:09:34,660
that gives you a more thorough

225
00:09:32,350 --> 00:09:35,980
description and you know all the

226
00:09:34,660 --> 00:09:37,779
different<font color="#CCCCCC"> arguments that</font><font color="#E5E5E5"> are supported</font>

227
00:09:35,980 --> 00:09:40,779
what it's trying to<font color="#E5E5E5"> do</font><font color="#CCCCCC"> maybe some</font>

228
00:09:37,779 --> 00:09:44,950
warnings about<font color="#E5E5E5"> it or something like</font><font color="#CCCCCC"> that</font>

229
00:09:40,779 --> 00:09:47,970
so there's also the set regions command

230
00:09:44,950 --> 00:09:51,730
<font color="#E5E5E5">us I'm gonna set it to us</font><font color="#CCCCCC"> West two and</font>

231
00:09:47,970 --> 00:09:54,310
what<font color="#E5E5E5"> this command does is sets the</font>

232
00:09:51,730 --> 00:09:56,980
session regions<font color="#E5E5E5"> to whatever list I just</font>

233
00:09:54,310 --> 00:09:58,839
<font color="#E5E5E5">supplied which is only</font><font color="#CCCCCC"> us West two and</font>

234
00:09:56,980 --> 00:10:01,269
this<font color="#CCCCCC"> ensures that any module you run</font>

235
00:09:58,839 --> 00:10:03,610
will only run against modules<font color="#E5E5E5"> that you</font>

236
00:10:01,269 --> 00:10:07,329
want<font color="#CCCCCC"> right only run against regions</font><font color="#E5E5E5"> that</font>

237
00:10:03,610 --> 00:10:10,690
you want to target<font color="#E5E5E5"> and</font><font color="#CCCCCC"> that it will only</font>

238
00:10:07,329 --> 00:10:13,569
target regions that are supported<font color="#CCCCCC"> by a</font>

239
00:10:10,690 --> 00:10:16,089
certain<font color="#CCCCCC"> service</font><font color="#E5E5E5"> so if a module</font><font color="#CCCCCC"> that</font>

240
00:10:13,570 --> 00:10:19,300
<font color="#E5E5E5">works on ec2 will pull all the supported</font>

241
00:10:16,089 --> 00:10:21,940
ec2 regions then check<font color="#E5E5E5"> your session list</font>

242
00:10:19,300 --> 00:10:24,579
<font color="#CCCCCC">and it'll only target the to the regions</font>

243
00:10:21,940 --> 00:10:29,470
that<font color="#E5E5E5"> are in both lists it's just to make</font>

244
00:10:24,579 --> 00:10:31,839
<font color="#CCCCCC">it easier for you so then there's the</font>

245
00:10:29,470 --> 00:10:34,089
<font color="#E5E5E5">Who am I command which pops up some</font>

246
00:10:31,839 --> 00:10:37,449
information<font color="#CCCCCC"> about the the current</font><font color="#E5E5E5"> set of</font>

247
00:10:34,089 --> 00:10:38,920
<font color="#E5E5E5">keys and so we can see here</font><font color="#CCCCCC"> Kirk</font><font color="#E5E5E5"> on</font>

248
00:10:37,449 --> 00:10:42,430
that's the session<font color="#E5E5E5"> name that we've been</font>

249
00:10:38,920 --> 00:10:45,790
looking<font color="#CCCCCC"> at ger</font><font color="#E5E5E5"> is the user that I've</font>

250
00:10:42,430 --> 00:10:47,469
<font color="#E5E5E5">already set up previously and so when</font>

251
00:10:45,790 --> 00:10:49,480
you run the Who am I command you get the

252
00:10:47,470 --> 00:10:52,089
information about<font color="#E5E5E5"> the</font><font color="#CCCCCC"> current</font><font color="#E5E5E5"> keys which</font>

253
00:10:49,480 --> 00:10:55,240
are<font color="#E5E5E5"> ger</font><font color="#CCCCCC"> I can see</font><font color="#E5E5E5"> that here</font><font color="#CCCCCC"> under key</font>

254
00:10:52,089 --> 00:10:57,880
alias is<font color="#E5E5E5"> Gert and then I've got</font><font color="#CCCCCC"> my keys</font>

255
00:10:55,240 --> 00:10:59,769
<font color="#E5E5E5">set I haven't done anything else so</font>

256
00:10:57,880 --> 00:11:02,589
<font color="#E5E5E5">that's all that's in there currently but</font>

257
00:10:59,769 --> 00:11:05,230
if we<font color="#E5E5E5"> wanted to fill that data up we</font>

258
00:11:02,589 --> 00:11:06,820
could run the confirm permissions module

259
00:11:05,230 --> 00:11:09,280
which will attempt to

260
00:11:06,820 --> 00:11:10,540
get a full set of<font color="#E5E5E5"> permissions for the</font>

261
00:11:09,280 --> 00:11:12,730
current user so<font color="#E5E5E5"> you know what kind of</font>

262
00:11:10,540 --> 00:11:15,579
access<font color="#CCCCCC"> you have to the</font><font color="#E5E5E5"> environment</font><font color="#CCCCCC"> you</font>

263
00:11:12,730 --> 00:11:18,580
can run that<font color="#E5E5E5"> it'll run comes back</font>

264
00:11:15,580 --> 00:11:19,960
confirmed for missions for<font color="#CCCCCC"> ger</font><font color="#E5E5E5"> and now I</font>

265
00:11:18,580 --> 00:11:21,820
can run Who am I<font color="#E5E5E5"> again</font>

266
00:11:19,960 --> 00:11:23,830
and it's filled<font color="#E5E5E5"> up a lot of different</font>

267
00:11:21,820 --> 00:11:25,840
information<font color="#E5E5E5"> this time so we got the</font>

268
00:11:23,830 --> 00:11:29,800
<font color="#E5E5E5">username we got the air in the account</font>

269
00:11:25,840 --> 00:11:32,140
ID user ID<font color="#E5E5E5"> groups there aren't any</font>

270
00:11:29,800 --> 00:11:32,680
policies<font color="#CCCCCC"> we</font><font color="#E5E5E5"> can see there's one policy</font>

271
00:11:32,140 --> 00:11:35,920
attached

272
00:11:32,680 --> 00:11:38,739
I am<font color="#E5E5E5"> managed self policy</font><font color="#CCCCCC"> then there's</font>

273
00:11:35,920 --> 00:11:40,360
the permissions confirmed<font color="#E5E5E5"> which means</font>

274
00:11:38,740 --> 00:11:42,310
that the confirmed permissions module

275
00:11:40,360 --> 00:11:45,070
successfully completed<font color="#E5E5E5"> without running</font>

276
00:11:42,310 --> 00:11:46,510
into any access denied issues<font color="#CCCCCC"> it's</font>

277
00:11:45,070 --> 00:11:48,130
possible<font color="#E5E5E5"> that it could</font><font color="#CCCCCC"> get some of your</font>

278
00:11:46,510 --> 00:11:50,500
permissions but you aren't<font color="#E5E5E5"> allowed to</font>

279
00:11:48,130 --> 00:11:52,750
<font color="#E5E5E5">find out for</font><font color="#CCCCCC"> sure if that's everything</font>

280
00:11:50,500 --> 00:11:54,340
<font color="#CCCCCC">so it'll still enumerate as much as it</font>

281
00:11:52,750 --> 00:11:58,180
can<font color="#CCCCCC"> but it'll let you know that it might</font>

282
00:11:54,340 --> 00:11:59,890
<font color="#CCCCCC">not</font><font color="#E5E5E5"> be a comprehensive list</font><font color="#CCCCCC"> so under</font>

283
00:11:58,180 --> 00:12:01,510
permissions<font color="#E5E5E5"> we have allow these</font><font color="#CCCCCC"> are</font>

284
00:11:59,890 --> 00:12:04,319
permissions<font color="#E5E5E5"> that</font><font color="#CCCCCC"> are explicitly allowed</font>

285
00:12:01,510 --> 00:12:08,319
by an<font color="#CCCCCC"> IM policy or</font><font color="#E5E5E5"> something like</font><font color="#CCCCCC"> that</font>

286
00:12:04,320 --> 00:12:10,750
so you<font color="#E5E5E5"> can see I have I am list on star</font>

287
00:12:08,320 --> 00:12:13,600
so all the list<font color="#E5E5E5"> commands on any resource</font>

288
00:12:10,750 --> 00:12:19,120
<font color="#E5E5E5">and then I have the same for I am</font><font color="#CCCCCC"> git</font>

289
00:12:13,600 --> 00:12:22,330
<font color="#CCCCCC">and then down below that I have</font><font color="#E5E5E5"> the I am</font>

290
00:12:19,120 --> 00:12:25,330
put user policy<font color="#E5E5E5"> permission on a single</font>

291
00:12:22,330 --> 00:12:29,050
<font color="#E5E5E5">resource which is my own user account</font>

292
00:12:25,330 --> 00:12:31,090
<font color="#CCCCCC">this</font><font color="#E5E5E5"> I am policy variable fills in my</font>

293
00:12:29,050 --> 00:12:32,829
user name when<font color="#E5E5E5"> I'm running this command</font>

294
00:12:31,090 --> 00:12:36,190
<font color="#E5E5E5">so I can't run this command against</font>

295
00:12:32,830 --> 00:12:38,830
other users<font color="#E5E5E5"> or anything like that if</font>

296
00:12:36,190 --> 00:12:40,690
there are<font color="#E5E5E5"> any conditions for any of</font>

297
00:12:38,830 --> 00:12:41,950
these<font color="#E5E5E5"> policies or any of these</font>

298
00:12:40,690 --> 00:12:44,710
permissions those will show<font color="#CCCCCC"> up as well</font>

299
00:12:41,950 --> 00:12:47,860
so<font color="#E5E5E5"> a lot of time on counter permissions</font>

300
00:12:44,710 --> 00:12:50,620
that require<font color="#E5E5E5"> to FAA or MFA it to be set</font>

301
00:12:47,860 --> 00:12:52,180
to<font color="#CCCCCC"> use them</font><font color="#E5E5E5"> and that'll let you know if</font>

302
00:12:50,620 --> 00:12:55,900
that's<font color="#CCCCCC"> the</font><font color="#E5E5E5"> case otherwise it doesn't</font>

303
00:12:52,180 --> 00:12:58,000
<font color="#E5E5E5">show up I if you haven't been able to</font>

304
00:12:55,900 --> 00:12:59,439
tell already<font color="#E5E5E5"> I can that this is</font>

305
00:12:58,000 --> 00:13:01,720
vulnerable<font color="#E5E5E5"> through some privilege</font>

306
00:12:59,440 --> 00:13:04,510
escalation<font color="#CCCCCC"> and so we'll</font><font color="#E5E5E5"> take a look at</font>

307
00:13:01,720 --> 00:13:08,740
that<font color="#E5E5E5"> you know obviously this I'm</font><font color="#CCCCCC"> gonna</font>

308
00:13:04,510 --> 00:13:12,010
run the<font color="#CCCCCC"> Edom ec2 module to try and</font>

309
00:13:08,740 --> 00:13:13,180
enumerate instances but<font color="#E5E5E5"> we</font><font color="#CCCCCC"> obviously I</font>

310
00:13:12,010 --> 00:13:16,810
don't<font color="#CCCCCC"> have</font><font color="#E5E5E5"> that permission so it's going</font>

311
00:13:13,180 --> 00:13:20,199
<font color="#E5E5E5">to run</font><font color="#CCCCCC"> it'll</font><font color="#E5E5E5"> run the dry run both recall</font>

312
00:13:16,810 --> 00:13:22,900
the Python library<font color="#CCCCCC"> and it failed so</font>

313
00:13:20,200 --> 00:13:25,690
<font color="#E5E5E5">it didn't enumerate anything so to fix</font>

314
00:13:22,900 --> 00:13:28,660
that<font color="#CCCCCC"> I'm gonna have</font><font color="#E5E5E5"> to use the privilege</font>

315
00:13:25,690 --> 00:13:31,570
<font color="#E5E5E5">escalation module which is</font><font color="#CCCCCC"> for best scan</font>

316
00:13:28,660 --> 00:13:33,969
and it'll automatically scan your list

317
00:13:31,570 --> 00:13:35,770
of permissions and resources and come up

318
00:13:33,970 --> 00:13:37,570
with<font color="#CCCCCC"> a list of various privilege</font>

319
00:13:35,770 --> 00:13:40,870
escalation methods that your accounts

320
00:13:37,570 --> 00:13:43,810
vulnerable to and by default<font color="#CCCCCC"> it'll also</font>

321
00:13:40,870 --> 00:13:45,100
try<font color="#E5E5E5"> to exploit on that and so ideally</font>

322
00:13:43,810 --> 00:13:47,589
<font color="#CCCCCC">you run this</font><font color="#E5E5E5"> and you've got to</font>

323
00:13:45,100 --> 00:13:51,160
administrate your<font color="#E5E5E5"> privileges we can run</font>

324
00:13:47,590 --> 00:13:54,250
<font color="#E5E5E5">it so some text flew by we can see</font>

325
00:13:51,160 --> 00:13:55,630
confirmed<font color="#E5E5E5"> put user policy</font><font color="#CCCCCC"> that's one</font><font color="#E5E5E5"> of</font>

326
00:13:54,250 --> 00:13:59,380
the privilege escalation methods that

327
00:13:55,630 --> 00:14:01,900
are checked for<font color="#E5E5E5"> I had written a blog on</font>

328
00:13:59,380 --> 00:14:03,910
21 different privilege escalation

329
00:14:01,900 --> 00:14:07,540
methods and that's what this checks for

330
00:14:03,910 --> 00:14:09,100
and tries to<font color="#E5E5E5"> exploit put user</font><font color="#CCCCCC"> policy is</font>

331
00:14:07,540 --> 00:14:13,810
one of them<font color="#E5E5E5"> it's got the put user policy</font>

332
00:14:09,100 --> 00:14:15,010
permission which we see here<font color="#CCCCCC"> and then</font>

333
00:14:13,810 --> 00:14:17,609
it's going<font color="#E5E5E5"> to start</font><font color="#CCCCCC"> trying to exploit</font>

334
00:14:15,010 --> 00:14:20,830
<font color="#E5E5E5">that it'll try to use that to put an</font>

335
00:14:17,610 --> 00:14:23,860
administrator policy<font color="#E5E5E5"> into my users set</font>

336
00:14:20,830 --> 00:14:25,960
of<font color="#E5E5E5"> inline policies it's done so and it</font>

337
00:14:23,860 --> 00:14:27,550
gives<font color="#E5E5E5"> me the name</font><font color="#CCCCCC"> and so now I should</font>

338
00:14:25,960 --> 00:14:32,590
have administrator privileges

339
00:14:27,550 --> 00:14:35,729
I can run<font color="#E5E5E5"> confirm permissions once more</font>

340
00:14:32,590 --> 00:14:39,610
to<font color="#E5E5E5"> get the new set</font><font color="#CCCCCC"> of permissions and</font>

341
00:14:35,730 --> 00:14:41,710
then run<font color="#E5E5E5"> Who am I and I can</font><font color="#CCCCCC"> see that</font>

342
00:14:39,610 --> 00:14:44,290
I've<font color="#E5E5E5"> got a new policy under policies</font>

343
00:14:41,710 --> 00:14:45,040
with that name<font color="#CCCCCC"> and</font><font color="#E5E5E5"> then under</font>

344
00:14:44,290 --> 00:14:47,949
permissions

345
00:14:45,040 --> 00:14:51,130
<font color="#CCCCCC">I have star permissions allowed on star</font>

346
00:14:47,950 --> 00:14:53,460
resources which<font color="#E5E5E5"> is anything</font><font color="#CCCCCC"> alright</font><font color="#E5E5E5"> it's</font>

347
00:14:51,130 --> 00:14:56,590
an administrator level<font color="#E5E5E5"> account basically</font>

348
00:14:53,460 --> 00:14:59,310
<font color="#E5E5E5">so now you know prove it even further I</font>

349
00:14:56,590 --> 00:15:04,150
<font color="#E5E5E5">can run the</font><font color="#CCCCCC"> you know ec2</font><font color="#E5E5E5"> module</font><font color="#CCCCCC"> again</font>

350
00:14:59,310 --> 00:15:07,300
against instances and we<font color="#CCCCCC"> can see there</font>

351
00:15:04,150 --> 00:15:09,790
it found one instance in<font color="#CCCCCC"> uswest queue</font>

352
00:15:07,300 --> 00:15:11,469
and<font color="#E5E5E5"> so now</font><font color="#CCCCCC"> that data</font><font color="#E5E5E5"> is saved into the</font>

353
00:15:09,790 --> 00:15:13,780
database<font color="#CCCCCC"> I could</font><font color="#E5E5E5"> run the services</font>

354
00:15:11,470 --> 00:15:16,330
command it'll give me all the AWS

355
00:15:13,780 --> 00:15:20,890
services that have data<font color="#E5E5E5"> stored in the</font>

356
00:15:16,330 --> 00:15:23,650
database<font color="#CCCCCC"> and</font><font color="#E5E5E5"> so we can see ec2 not</font><font color="#CCCCCC"> gonna</font>

357
00:15:20,890 --> 00:15:25,870
look into<font color="#CCCCCC"> that right now but we</font><font color="#E5E5E5"> could</font>

358
00:15:23,650 --> 00:15:28,270
run we could establish some persistence

359
00:15:25,870 --> 00:15:30,040
now that we have administrator access<font color="#E5E5E5"> so</font>

360
00:15:28,270 --> 00:15:33,220
<font color="#CCCCCC">we can use the</font><font color="#E5E5E5"> backdoor users</font><font color="#CCCCCC"> keys</font>

361
00:15:30,040 --> 00:15:34,000
module run that it's going to<font color="#E5E5E5"> let me</font>

362
00:15:33,220 --> 00:15:36,100
<font color="#CCCCCC">know it's missing</font>

363
00:15:34,000 --> 00:15:38,680
I am user data<font color="#E5E5E5"> because we</font><font color="#CCCCCC"> haven't ran</font>

364
00:15:36,100 --> 00:15:40,660
that module<font color="#CCCCCC"> to enumerate that data then</font>

365
00:15:38,680 --> 00:15:43,269
it's gonna<font color="#CCCCCC"> ask if I want to run the enum</font>

366
00:15:40,660 --> 00:15:44,709
users<font color="#E5E5E5"> roles policies groups module to</font>

367
00:15:43,269 --> 00:15:47,410
fetch that data<font color="#CCCCCC"> so that this module</font>

368
00:15:44,709 --> 00:15:49,839
couldn't complete successfully<font color="#E5E5E5"> say yes</font>

369
00:15:47,410 --> 00:15:51,670
<font color="#E5E5E5">it's gonna run found nine users now it's</font>

370
00:15:49,839 --> 00:15:53,800
going<font color="#E5E5E5"> to prompt me</font><font color="#CCCCCC"> for all the users</font>

371
00:15:51,670 --> 00:15:58,719
<font color="#CCCCCC">that</font><font color="#E5E5E5"> it found and</font><font color="#CCCCCC"> asked if I want to add</font>

372
00:15:53,800 --> 00:16:02,649
keys to those or not<font color="#CCCCCC"> so I'm gonna add</font>

373
00:15:58,720 --> 00:16:04,689
<font color="#E5E5E5">them to the sysadmin user say yes okay</font>

374
00:16:02,649 --> 00:16:06,730
we<font color="#CCCCCC"> get to set the</font><font color="#E5E5E5"> keys back you know</font>

375
00:16:04,689 --> 00:16:09,160
<font color="#E5E5E5">feel free</font><font color="#CCCCCC"> to try</font><font color="#E5E5E5"> and have fun</font><font color="#CCCCCC"> with</font><font color="#E5E5E5"> those</font>

376
00:16:06,730 --> 00:16:10,779
you won't have any fun but it's worth

377
00:16:09,160 --> 00:16:14,350
it's worth a shot

378
00:16:10,779 --> 00:16:16,180
so finish that up<font color="#CCCCCC"> now I can add</font><font color="#E5E5E5"> them to</font>

379
00:16:14,350 --> 00:16:18,550
the<font color="#CCCCCC"> PACU database using the set keys</font>

380
00:16:16,180 --> 00:16:24,420
command<font color="#E5E5E5"> we know it's the sysadmin user</font>

381
00:16:18,550 --> 00:16:24,420
and then we can copy the keys in there

382
00:16:25,350 --> 00:16:34,680
and so now<font color="#CCCCCC"> i'm this has had been user it</font>

383
00:16:32,410 --> 00:16:36,879
<font color="#E5E5E5">within</font><font color="#CCCCCC"> PACU and</font><font color="#E5E5E5"> if I run Who am I</font><font color="#CCCCCC"> again</font>

384
00:16:34,680 --> 00:16:38,319
<font color="#CCCCCC">it's it's a whole</font><font color="#E5E5E5"> different</font><font color="#CCCCCC"> set</font><font color="#E5E5E5"> of data</font>

385
00:16:36,879 --> 00:16:40,389
because<font color="#E5E5E5"> you</font><font color="#CCCCCC"> know pocky doesn't know</font>

386
00:16:38,319 --> 00:16:41,740
whether this these keys belong to the

387
00:16:40,389 --> 00:16:41,980
same account or<font color="#CCCCCC"> not or anything like</font>

388
00:16:41,740 --> 00:16:44,860
<font color="#E5E5E5">that</font>

389
00:16:41,980 --> 00:16:46,480
<font color="#E5E5E5">so they're fully separated and then I</font>

390
00:16:44,860 --> 00:16:48,850
can use<font color="#E5E5E5"> the swap</font><font color="#CCCCCC"> Keys command to go back</font>

391
00:16:46,480 --> 00:16:52,899
to my administrator user<font color="#E5E5E5"> well I still</font>

392
00:16:48,850 --> 00:16:56,350
have access<font color="#E5E5E5"> to</font><font color="#CCCCCC"> them so follow that</font><font color="#E5E5E5"> up</font>

393
00:16:52,899 --> 00:16:59,199
with executing<font color="#E5E5E5"> some code on</font><font color="#CCCCCC"> an ec2</font>

394
00:16:56,350 --> 00:17:01,480
instance that<font color="#E5E5E5"> I have set up to get a</font>

395
00:16:59,199 --> 00:17:05,139
reverse shell<font color="#E5E5E5"> as the root</font><font color="#CCCCCC"> user so I'm</font>

396
00:17:01,480 --> 00:17:08,559
gonna use NC -<font color="#E5E5E5"> and I'll VP listen on</font>

397
00:17:05,140 --> 00:17:12,490
port<font color="#CCCCCC"> 5050</font><font color="#E5E5E5"> this is just my</font><font color="#CCCCCC"> c2 server</font><font color="#E5E5E5"> I've</font>

398
00:17:08,559 --> 00:17:19,569
<font color="#CCCCCC">setup</font><font color="#E5E5E5"> separately then in</font><font color="#CCCCCC"> PACU I can run</font>

399
00:17:12,490 --> 00:17:25,079
the<font color="#E5E5E5"> add ec2 startup SH</font><font color="#CCCCCC"> script module</font>

400
00:17:19,569 --> 00:17:29,408
with the script<font color="#E5E5E5"> path</font><font color="#CCCCCC"> - slash temp</font><font color="#E5E5E5"> and</font>

401
00:17:25,079 --> 00:17:32,230
<font color="#E5E5E5">reverse shell SH so what this is gonna</font>

402
00:17:29,409 --> 00:17:34,960
do is it's<font color="#E5E5E5"> gonna stop an ec2 instance</font>

403
00:17:32,230 --> 00:17:36,940
that it finds<font color="#CCCCCC"> wait for it to be stopped</font>

404
00:17:34,960 --> 00:17:38,770
<font color="#E5E5E5">and then modify the user data that's</font>

405
00:17:36,940 --> 00:17:41,620
associated<font color="#E5E5E5"> with it which can only be</font>

406
00:17:38,770 --> 00:17:43,899
<font color="#E5E5E5">modified well in instances off</font><font color="#CCCCCC"> it's</font>

407
00:17:41,620 --> 00:17:46,209
going<font color="#CCCCCC"> to</font><font color="#E5E5E5"> give it a directive</font><font color="#CCCCCC"> that will</font>

408
00:17:43,899 --> 00:17:47,129
instruct it to<font color="#E5E5E5"> every startup run this</font>

409
00:17:46,210 --> 00:17:49,020
bash script

410
00:17:47,130 --> 00:17:51,300
<font color="#E5E5E5">that I've included in the user data</font>

411
00:17:49,020 --> 00:17:52,889
<font color="#CCCCCC">which is my reverse shell and so when</font>

412
00:17:51,300 --> 00:17:54,899
this<font color="#CCCCCC"> is done every</font><font color="#E5E5E5"> single time that</font>

413
00:17:52,890 --> 00:17:58,380
<font color="#E5E5E5">instance restarts</font><font color="#CCCCCC"> I'll get a new</font>

414
00:17:54,900 --> 00:18:01,650
connection<font color="#E5E5E5"> of the river shell so</font><font color="#CCCCCC"> we can</font>

415
00:17:58,380 --> 00:18:06,300
wait<font color="#CCCCCC"> on this it takes a little</font><font color="#E5E5E5"> bit to</font>

416
00:18:01,650 --> 00:18:09,240
stop the instance just part of AWS<font color="#E5E5E5"> part</font>

417
00:18:06,300 --> 00:18:11,460
of shutting down<font color="#CCCCCC"> a server</font><font color="#E5E5E5"> but there are</font>

418
00:18:09,240 --> 00:18:14,340
a couple of different<font color="#E5E5E5"> way so here we go</font>

419
00:18:11,460 --> 00:18:16,530
<font color="#E5E5E5">we see that it updated the</font><font color="#CCCCCC"> user data for</font>

420
00:18:14,340 --> 00:18:18,449
the instance<font color="#E5E5E5"> and then it's starting it</font>

421
00:18:16,530 --> 00:18:20,490
back up<font color="#E5E5E5"> so now we can wait for that</font>

422
00:18:18,450 --> 00:18:24,360
<font color="#E5E5E5">connection</font><font color="#CCCCCC"> here it might take a little</font>

423
00:18:20,490 --> 00:18:26,850
<font color="#E5E5E5">bit</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> obviously in general you don't</font>

424
00:18:24,360 --> 00:18:28,649
<font color="#CCCCCC">want to</font><font color="#E5E5E5"> restart people's servers and you</font>

425
00:18:26,850 --> 00:18:31,050
know<font color="#E5E5E5"> cause some problems in an account</font>

426
00:18:28,650 --> 00:18:33,510
or<font color="#E5E5E5"> something like that</font><font color="#CCCCCC"> there are other</font>

427
00:18:31,050 --> 00:18:33,990
modules that<font color="#E5E5E5"> will get</font><font color="#CCCCCC"> route or system</font>

428
00:18:33,510 --> 00:18:37,050
<font color="#CCCCCC">rze</font>

429
00:18:33,990 --> 00:18:39,780
without a restart required so the shell

430
00:18:37,050 --> 00:18:42,210
<font color="#CCCCCC">just showed up now you</font><font color="#E5E5E5"> know i'm route in</font>

431
00:18:39,780 --> 00:18:44,420
<font color="#E5E5E5">this account anything</font><font color="#CCCCCC"> like that</font><font color="#E5E5E5"> doesn't</font>

432
00:18:42,210 --> 00:18:47,160
matter<font color="#E5E5E5"> pretty</font><font color="#CCCCCC"> cool</font>

433
00:18:44,420 --> 00:18:51,360
get out<font color="#CCCCCC"> of</font><font color="#E5E5E5"> that and to confirm it again</font>

434
00:18:47,160 --> 00:18:55,290
<font color="#CCCCCC">I could run the download ec2 user data</font>

435
00:18:51,360 --> 00:18:57,899
module which will run downloads all the

436
00:18:55,290 --> 00:19:01,050
user data<font color="#E5E5E5"> for the various instances that</font>

437
00:18:57,900 --> 00:19:02,990
we had targeted<font color="#CCCCCC"> and we can see I added</font>

438
00:19:01,050 --> 00:19:04,980
<font color="#E5E5E5">the cloud boot hook directive which</font>

439
00:19:02,990 --> 00:19:07,140
instructs<font color="#E5E5E5"> the instance to run this</font>

440
00:19:04,980 --> 00:19:12,510
following script<font color="#E5E5E5"> every startup and we</font>

441
00:19:07,140 --> 00:19:13,890
can see my bash reverse shell here<font color="#CCCCCC"> so in</font>

442
00:19:12,510 --> 00:19:15,390
in the case<font color="#CCCCCC"> that you don't</font><font color="#E5E5E5"> want to</font>

443
00:19:13,890 --> 00:19:20,310
restart<font color="#CCCCCC"> an instance there's also the</font>

444
00:19:15,390 --> 00:19:23,760
system an ec2<font color="#CCCCCC"> RCE module which uses</font><font color="#E5E5E5"> AWS</font>

445
00:19:20,310 --> 00:19:25,530
Systems Manager<font color="#E5E5E5"> to execute code on</font>

446
00:19:23,760 --> 00:19:28,470
instances that<font color="#E5E5E5"> have the Systems Manager</font>

447
00:19:25,530 --> 00:19:30,330
<font color="#E5E5E5">agent installed on them</font><font color="#CCCCCC"> requires a</font>

448
00:19:28,470 --> 00:19:32,880
little bit more permission than what

449
00:19:30,330 --> 00:19:34,169
this<font color="#E5E5E5"> one does</font><font color="#CCCCCC"> but you know it's</font>

450
00:19:32,880 --> 00:19:36,900
<font color="#CCCCCC">something</font><font color="#E5E5E5"> I've encountered</font><font color="#CCCCCC"> quite a few</font>

451
00:19:34,170 --> 00:19:38,610
quite<font color="#E5E5E5"> a few times and gets you a lot of</font>

452
00:19:36,900 --> 00:19:41,570
<font color="#CCCCCC">access to</font><font color="#E5E5E5"> the environment</font><font color="#CCCCCC"> without any</font>

453
00:19:38,610 --> 00:19:41,570
need<font color="#CCCCCC"> of disruption</font>

454
00:19:51,120 --> 00:19:56,909
so that kind of wraps<font color="#E5E5E5"> up the demo there</font>

455
00:19:56,970 --> 00:20:01,080
didn't want to start where I was at

456
00:20:01,830 --> 00:20:07,810
<font color="#CCCCCC">alright</font><font color="#E5E5E5"> so basically today I talked</font>

457
00:20:04,630 --> 00:20:11,080
<font color="#CCCCCC">about the</font><font color="#E5E5E5"> the problem with AWS security</font>

458
00:20:07,810 --> 00:20:14,379
and what that how we can<font color="#CCCCCC"> solve that</font>

459
00:20:11,080 --> 00:20:17,350
<font color="#CCCCCC">problem with you know the problem being</font>

460
00:20:14,380 --> 00:20:19,240
the lack of AWS attack tools which means

461
00:20:17,350 --> 00:20:20,860
there's a lack of AWS security<font color="#CCCCCC"> awareness</font>

462
00:20:19,240 --> 00:20:23,260
because people aren't<font color="#E5E5E5"> aware</font><font color="#CCCCCC"> of what</font>

463
00:20:20,860 --> 00:20:25,689
possible<font color="#E5E5E5"> attacks can happen against</font>

464
00:20:23,260 --> 00:20:27,400
<font color="#E5E5E5">their environment when you're just</font>

465
00:20:25,690 --> 00:20:29,830
<font color="#CCCCCC">following best</font><font color="#E5E5E5"> practices</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> don't know</font>

466
00:20:27,400 --> 00:20:32,770
you know you might not<font color="#CCCCCC"> even know about</font>

467
00:20:29,830 --> 00:20:36,189
<font color="#E5E5E5">that</font><font color="#CCCCCC"> kind of RCE</font><font color="#E5E5E5"> in your environment</font><font color="#CCCCCC"> so</font>

468
00:20:32,770 --> 00:20:38,530
any user who has<font color="#E5E5E5"> run instances modify</font>

469
00:20:36,190 --> 00:20:41,260
instance attribute<font color="#E5E5E5"> and stop instance</font>

470
00:20:38,530 --> 00:20:43,360
permissions can get route code execution

471
00:20:41,260 --> 00:20:44,590
on any one<font color="#E5E5E5"> of your instances</font><font color="#CCCCCC"> that's</font>

472
00:20:43,360 --> 00:20:46,979
something that would<font color="#CCCCCC"> be hard to</font>

473
00:20:44,590 --> 00:20:49,689
necessarily figure out<font color="#E5E5E5"> - unless you're</font>

474
00:20:46,980 --> 00:20:54,750
there's something more<font color="#E5E5E5"> awareness around</font>

475
00:20:49,690 --> 00:20:57,640
this so we can fix it<font color="#CCCCCC"> with</font><font color="#E5E5E5"> PACU and more</font>

476
00:20:54,750 --> 00:21:00,190
offensive research in AWS<font color="#E5E5E5"> there's</font>

477
00:20:57,640 --> 00:21:03,670
definitely a lot<font color="#CCCCCC"> of</font><font color="#E5E5E5"> lot going on but</font>

478
00:21:00,190 --> 00:21:05,380
could use more in<font color="#CCCCCC"> general and that's</font>

479
00:21:03,670 --> 00:21:07,420
<font color="#E5E5E5">kind of what</font><font color="#CCCCCC"> Paco is aiming to do is</font>

480
00:21:05,380 --> 00:21:09,250
<font color="#E5E5E5">increase the amount of research</font><font color="#CCCCCC"> that's</font>

481
00:21:07,420 --> 00:21:13,120
going<font color="#E5E5E5"> into this finding more attack</font>

482
00:21:09,250 --> 00:21:16,270
paths more you know more viable options

483
00:21:13,120 --> 00:21:18,310
as an attacker<font color="#E5E5E5"> as in something other</font>

484
00:21:16,270 --> 00:21:20,590
areas of<font color="#E5E5E5"> pen testing where there's you</font>

485
00:21:18,310 --> 00:21:25,210
<font color="#CCCCCC">know</font><font color="#E5E5E5"> decades of research and stuff like</font>

486
00:21:20,590 --> 00:21:26,620
that<font color="#CCCCCC"> so I've included the link to that</font>

487
00:21:25,210 --> 00:21:29,410
privilege escalation blog post for

488
00:21:26,620 --> 00:21:30,969
<font color="#E5E5E5">anyone that's interested in the 21</font>

489
00:21:29,410 --> 00:21:34,450
methods that the<font color="#CCCCCC"> privilege escalation</font>

490
00:21:30,970 --> 00:21:36,670
scanner<font color="#E5E5E5"> checks for it's got a demo or</font>

491
00:21:34,450 --> 00:21:38,170
<font color="#E5E5E5">guide and you know information</font><font color="#CCCCCC"> about</font>

492
00:21:36,670 --> 00:21:42,160
each one<font color="#E5E5E5"> of</font><font color="#CCCCCC"> those methods</font><font color="#E5E5E5"> in there as</font>

493
00:21:38,170 --> 00:21:44,080
well as the PACU github repo<font color="#CCCCCC"> if you want</font>

494
00:21:42,160 --> 00:21:47,170
to get in<font color="#CCCCCC"> contact with me there's my</font>

495
00:21:44,080 --> 00:21:50,199
email<font color="#CCCCCC"> spencer Dietzen at rhinos cootie</font>

496
00:21:47,170 --> 00:21:52,150
labs<font color="#CCCCCC"> calm or my twitter at spin beats</font>

497
00:21:50,200 --> 00:21:55,450
and then<font color="#E5E5E5"> rhinos twitter at rhino</font>

498
00:21:52,150 --> 00:21:59,870
security so<font color="#CCCCCC"> wanna</font><font color="#E5E5E5"> thank everyone for</font>

499
00:21:55,450 --> 00:22:06,920
coming out and thank you

500
00:21:59,870 --> 00:22:06,919
[Applause]

