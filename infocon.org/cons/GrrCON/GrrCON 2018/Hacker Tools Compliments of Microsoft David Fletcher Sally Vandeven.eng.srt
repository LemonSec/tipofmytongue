1
00:02:18,180 --> 00:02:26,530
hey<font color="#CCCCCC"> can</font><font color="#E5E5E5"> you hear me now</font>

2
00:02:22,209 --> 00:02:30,250
hi hi hi<font color="#CCCCCC"> are you</font><font color="#E5E5E5"> guys having fun at</font>

3
00:02:26,530 --> 00:02:33,879
<font color="#E5E5E5">gherkin</font><font color="#CCCCCC"> whoa wow that's</font><font color="#E5E5E5"> a great response</font>

4
00:02:30,250 --> 00:02:35,170
for like the end of two crazy days<font color="#CCCCCC"> have</font>

5
00:02:33,879 --> 00:02:39,459
you<font color="#CCCCCC"> guys heard of Black Hills</font>

6
00:02:35,170 --> 00:02:40,809
<font color="#E5E5E5">Information Security well</font><font color="#CCCCCC"> yeh we we were</font>

7
00:02:39,459 --> 00:02:42,730
a little worried that<font color="#E5E5E5"> at the end of</font>

8
00:02:40,810 --> 00:02:44,709
<font color="#E5E5E5">Friday there might be like four of you</font>

9
00:02:42,730 --> 00:02:48,280
who decided to<font color="#E5E5E5"> come to the talk and then</font>

10
00:02:44,709 --> 00:02:50,230
<font color="#CCCCCC">Sally was like</font><font color="#E5E5E5"> oh and</font><font color="#CCCCCC"> I was like well</font>

11
00:02:48,280 --> 00:02:52,870
hey even<font color="#E5E5E5"> if we have four people</font><font color="#CCCCCC"> we're</font>

12
00:02:50,230 --> 00:02:56,409
gonna<font color="#E5E5E5"> have an awesome</font><font color="#CCCCCC"> time</font><font color="#E5E5E5"> right so</font><font color="#CCCCCC"> I'm</font>

13
00:02:52,870 --> 00:02:58,480
Sierra<font color="#E5E5E5"> and I host the BHS</font><font color="#CCCCCC"> webcasts and</font>

14
00:02:56,409 --> 00:03:00,459
<font color="#E5E5E5">if you've ever been on</font><font color="#CCCCCC"> a BHS webcast</font>

15
00:02:58,480 --> 00:03:03,399
you'll know that<font color="#E5E5E5"> we like to</font><font color="#CCCCCC"> do our</font>

16
00:03:00,459 --> 00:03:05,470
<font color="#CCCCCC">soundcheck</font><font color="#E5E5E5"> really</font><font color="#CCCCCC"> early and we have some</font>

17
00:03:03,400 --> 00:03:08,170
like fun chit chat<font color="#E5E5E5"> before we</font><font color="#CCCCCC"> actually</font>

18
00:03:05,470 --> 00:03:10,780
start so<font color="#E5E5E5"> I just wanted</font><font color="#CCCCCC"> to come say hi if</font>

19
00:03:08,170 --> 00:03:12,250
you haven't been on<font color="#CCCCCC"> a BHS webcast we</font>

20
00:03:10,780 --> 00:03:14,859
hope that you'll go<font color="#E5E5E5"> sign up for our</font>

21
00:03:12,250 --> 00:03:17,799
stuff we<font color="#E5E5E5"> really find that education is</font>

22
00:03:14,859 --> 00:03:20,079
super important<font color="#CCCCCC"> so we do a lot of</font>

23
00:03:17,799 --> 00:03:23,139
<font color="#E5E5E5">webcasts we do a blog</font><font color="#CCCCCC"> it's really fun</font>

24
00:03:20,079 --> 00:03:25,629
<font color="#E5E5E5">and really we mostly think</font><font color="#CCCCCC"> that</font>

25
00:03:23,139 --> 00:03:28,359
<font color="#E5E5E5">information security should</font><font color="#CCCCCC"> be fun so we</font>

26
00:03:25,629 --> 00:03:30,340
try<font color="#CCCCCC"> to have a good time and I'm here</font>

27
00:03:28,359 --> 00:03:32,790
<font color="#E5E5E5">with Sally and David they're pretty</font>

28
00:03:30,340 --> 00:03:36,040
awesome<font color="#E5E5E5"> so I just wanted to say hi and</font>

29
00:03:32,790 --> 00:03:38,078
this actually was<font color="#E5E5E5"> a webcast</font><font color="#CCCCCC"> that they</font>

30
00:03:36,040 --> 00:03:40,179
turned into a talk so thank you for

31
00:03:38,079 --> 00:03:46,329
coming<font color="#CCCCCC"> to their talk</font><font color="#E5E5E5"> and thank you to</font>

32
00:03:40,180 --> 00:03:50,889
them for<font color="#E5E5E5"> thank you Microsoft yes</font><font color="#CCCCCC"> all</font>

33
00:03:46,329 --> 00:03:53,169
right Thank You<font color="#E5E5E5"> Sierra all right</font>

34
00:03:50,889 --> 00:03:55,690
so Sierra introduced us<font color="#E5E5E5"> I'm Sally van de</font>

35
00:03:53,169 --> 00:03:58,090
Ven<font color="#CCCCCC"> pentester at Black Hills David</font>

36
00:03:55,690 --> 00:03:59,980
Fletcher<font color="#E5E5E5"> pentester at Black Hills and</font>

37
00:03:58,090 --> 00:04:02,230
we're here to talk to you about some<font color="#CCCCCC"> of</font>

38
00:03:59,980 --> 00:04:05,198
our<font color="#CCCCCC"> favorite tools they are free they</font>

39
00:04:02,230 --> 00:04:07,238
<font color="#CCCCCC">are signed by Microsoft</font><font color="#E5E5E5"> and we use them</font>

40
00:04:05,199 --> 00:04:09,459
<font color="#CCCCCC">on every</font><font color="#E5E5E5"> internal test that we're on</font>

41
00:04:07,239 --> 00:04:11,379
they're pretty awesome<font color="#CCCCCC"> how many of you</font>

42
00:04:09,459 --> 00:04:14,099
have used or<font color="#CCCCCC"> are familiar</font><font color="#E5E5E5"> with</font>

43
00:04:11,379 --> 00:04:18,699
sysinternals<font color="#E5E5E5"> yeah that's right</font>

44
00:04:14,099 --> 00:04:20,858
how<font color="#E5E5E5"> many of</font><font color="#CCCCCC"> yous them offensively oh you</font>

45
00:04:18,699 --> 00:04:24,250
should<font color="#E5E5E5"> think about that especially as a</font>

46
00:04:20,858 --> 00:04:25,169
defensive guy or girl<font color="#E5E5E5"> we kind of thought</font>

47
00:04:24,250 --> 00:04:26,789
well maybe<font color="#E5E5E5"> we should</font>

48
00:04:25,169 --> 00:04:29,039
really tell people<font color="#CCCCCC"> that we use these</font>

49
00:04:26,789 --> 00:04:31,498
tools because that we usually<font color="#E5E5E5"> find them</font>

50
00:04:29,039 --> 00:04:33,599
<font color="#CCCCCC">inside and we want to</font><font color="#E5E5E5"> keep using them so</font>

51
00:04:31,499 --> 00:04:37,349
<font color="#E5E5E5">please let us keep using these tools if</font>

52
00:04:33,599 --> 00:04:40,639
<font color="#E5E5E5">you're on the blue team so if you're not</font>

53
00:04:37,349 --> 00:04:43,289
familiar which<font color="#E5E5E5"> I saw a lot</font><font color="#CCCCCC"> of hands</font>

54
00:04:40,639 --> 00:04:46,020
<font color="#CCCCCC">seasoned</font><font color="#E5E5E5"> Turtles tool</font><font color="#CCCCCC"> suite is didn't</font>

55
00:04:43,289 --> 00:04:48,150
start out as a Microsoft product<font color="#E5E5E5"> mark</font>

56
00:04:46,020 --> 00:04:52,378
<font color="#CCCCCC">Russinovich</font><font color="#E5E5E5"> and one of his</font><font color="#CCCCCC"> co-workers</font>

57
00:04:48,150 --> 00:04:55,080
<font color="#CCCCCC">actually wrote sysinternals and they</font>

58
00:04:52,379 --> 00:04:58,259
published it for free for<font color="#E5E5E5"> Windows</font><font color="#CCCCCC"> sis</font>

59
00:04:55,080 --> 00:05:01,979
admins to<font color="#E5E5E5"> provide better support for</font><font color="#CCCCCC"> the</font>

60
00:04:58,259 --> 00:05:04,169
Windows environment<font color="#E5E5E5"> what happened after</font>

61
00:05:01,979 --> 00:05:07,289
that<font color="#E5E5E5"> was you know mark spent a long time</font>

62
00:05:04,169 --> 00:05:09,990
<font color="#E5E5E5">making Microsoft angry as you</font><font color="#CCCCCC"> can see on</font>

63
00:05:07,289 --> 00:05:12,270
the slide<font color="#CCCCCC"> there's</font><font color="#E5E5E5"> a press release about</font>

64
00:05:09,990 --> 00:05:13,319
you know hey<font color="#CCCCCC"> I've figured</font><font color="#E5E5E5"> out what the</font>

65
00:05:12,270 --> 00:05:15,900
difference between Windows NT

66
00:05:13,319 --> 00:05:18,139
workstation and server is you can change

67
00:05:15,900 --> 00:05:20,188
this<font color="#CCCCCC"> little bit in the registry and</font>

68
00:05:18,139 --> 00:05:22,500
workstation<font color="#E5E5E5"> become server</font>

69
00:05:20,189 --> 00:05:24,719
<font color="#E5E5E5">well Microsoft and their infinite</font><font color="#CCCCCC"> wisdom</font>

70
00:05:22,500 --> 00:05:28,259
didn't get too mad about that and

71
00:05:24,719 --> 00:05:31,949
eventually<font color="#E5E5E5"> they hired mark</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> become the</font>

72
00:05:28,259 --> 00:05:33,750
Microsoft Azure<font color="#E5E5E5"> CTO and he is a great</font>

73
00:05:31,949 --> 00:05:36,000
<font color="#E5E5E5">advocate for</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> community</font>

74
00:05:33,750 --> 00:05:39,240
when Sally and I first<font color="#E5E5E5"> did this webcast</font>

75
00:05:36,000 --> 00:05:41,189
we got a shout<font color="#CCCCCC"> out from mark for talking</font>

76
00:05:39,240 --> 00:05:43,439
about<font color="#E5E5E5"> his tools and I thought that was</font>

77
00:05:41,189 --> 00:05:47,339
horribly flattering so he's a really

78
00:05:43,439 --> 00:05:50,279
<font color="#CCCCCC">nice guy too so let's go ahead and</font><font color="#E5E5E5"> talk</font>

79
00:05:47,339 --> 00:05:51,960
about<font color="#E5E5E5"> the tools yeah so like they've</font>

80
00:05:50,279 --> 00:05:54,000
said they've been<font color="#E5E5E5"> around for a long</font><font color="#CCCCCC"> time</font>

81
00:05:51,960 --> 00:05:56,339
it<font color="#E5E5E5"> started out as a small set of tools</font>

82
00:05:54,000 --> 00:05:57,930
but<font color="#CCCCCC"> I just looked yesterday and they're</font>

83
00:05:56,339 --> 00:06:00,180
<font color="#E5E5E5">currently a hundred and twenty six</font>

84
00:05:57,930 --> 00:06:02,389
utilities posted in the<font color="#CCCCCC"> sysinternals</font>

85
00:06:00,180 --> 00:06:05,240
<font color="#CCCCCC">suite so if you</font><font color="#E5E5E5"> haven't looked recently</font>

86
00:06:02,389 --> 00:06:09,149
revisit<font color="#E5E5E5"> that it's it's pretty exciting</font>

87
00:06:05,240 --> 00:06:11,430
<font color="#E5E5E5">and this is our little</font><font color="#CCCCCC"> screenshot hairs</font>

88
00:06:09,149 --> 00:06:15,569
from<font color="#E5E5E5"> the wayback machine so yeah that's</font>

89
00:06:11,430 --> 00:06:20,909
<font color="#E5E5E5">pretty fun so Microsoft</font><font color="#CCCCCC"> Sox why should I</font>

90
00:06:15,569 --> 00:06:23,969
care<font color="#CCCCCC"> one since acquiring</font><font color="#E5E5E5"> sysinternals</font>

91
00:06:20,909 --> 00:06:26,669
<font color="#CCCCCC">all of these tools</font><font color="#E5E5E5"> have become Microsoft</font>

92
00:06:23,969 --> 00:06:28,469
signed utilities<font color="#E5E5E5"> so if I'm using them</font>

93
00:06:26,669 --> 00:06:31,710
inside of<font color="#CCCCCC"> a Windows Active Directory</font>

94
00:06:28,469 --> 00:06:33,690
environment<font color="#E5E5E5"> and I've got tools that are</font>

95
00:06:31,710 --> 00:06:35,698
looking<font color="#E5E5E5"> for things that I might be doing</font>

96
00:06:33,690 --> 00:06:38,849
<font color="#E5E5E5">as a red teamer like running the net</font>

97
00:06:35,699 --> 00:06:39,360
commands or using<font color="#CCCCCC"> Winnick they might be</font>

98
00:06:38,849 --> 00:06:42,210
<font color="#E5E5E5">a really</font>

99
00:06:39,360 --> 00:06:44,310
great alternative<font color="#CCCCCC"> to using</font><font color="#E5E5E5"> those</font>

100
00:06:42,210 --> 00:06:46,948
traditional built-in tools that might

101
00:06:44,310 --> 00:06:49,289
get<font color="#E5E5E5"> caught</font><font color="#CCCCCC"> as we've tested you know more</font>

102
00:06:46,949 --> 00:06:52,620
<font color="#CCCCCC">and more</font><font color="#E5E5E5"> we've seen more and</font><font color="#CCCCCC"> more</font>

103
00:06:49,289 --> 00:06:55,110
advanced<font color="#E5E5E5"> organizations instrumenting for</font>

104
00:06:52,620 --> 00:06:57,689
use of<font color="#E5E5E5"> those commands so what we</font>

105
00:06:55,110 --> 00:07:01,199
typically do<font color="#CCCCCC"> is we use these tools</font>

106
00:06:57,689 --> 00:07:04,580
instead so we<font color="#CCCCCC"> can get by</font><font color="#E5E5E5"> and get all the</font>

107
00:07:01,199 --> 00:07:08,039
information<font color="#CCCCCC"> that we</font><font color="#E5E5E5"> normally want for an</font>

108
00:07:04,580 --> 00:07:09,719
effect offensive engagement<font color="#CCCCCC"> a lot of</font>

109
00:07:08,039 --> 00:07:14,340
times you find them resident on the

110
00:07:09,719 --> 00:07:18,180
<font color="#CCCCCC">network so we found systems</font><font color="#E5E5E5"> system</font>

111
00:07:14,340 --> 00:07:21,239
<font color="#CCCCCC">Center</font><font color="#E5E5E5"> software distribution installed</font>

112
00:07:18,180 --> 00:07:24,419
on machines with sysinternals<font color="#CCCCCC"> tool suite</font>

113
00:07:21,240 --> 00:07:26,370
available<font color="#E5E5E5"> to users we found them on file</font>

114
00:07:24,419 --> 00:07:29,549
shares<font color="#E5E5E5"> we found them deployed on every</font>

115
00:07:26,370 --> 00:07:32,909
<font color="#E5E5E5">workstation</font><font color="#CCCCCC"> this is huge for</font><font color="#E5E5E5"> us</font><font color="#CCCCCC"> because</font>

116
00:07:29,550 --> 00:07:35,069
<font color="#E5E5E5">now</font><font color="#CCCCCC"> we've got a set</font><font color="#E5E5E5"> of tools that are</font><font color="#CCCCCC"> on</font>

117
00:07:32,909 --> 00:07:38,219
the machine<font color="#CCCCCC"> that we don't have to bring</font>

118
00:07:35,069 --> 00:07:41,069
you know<font color="#E5E5E5"> additional elements</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> might</font>

119
00:07:38,219 --> 00:07:42,750
get get us caught into<font color="#CCCCCC"> the network</font><font color="#E5E5E5"> and</font>

120
00:07:41,069 --> 00:07:44,339
if<font color="#E5E5E5"> you if they're not on the system</font>

121
00:07:42,750 --> 00:07:46,139
already<font color="#E5E5E5"> you haven't found them you can</font>

122
00:07:44,339 --> 00:07:47,870
usually<font color="#CCCCCC"> download them</font><font color="#E5E5E5"> if you're</font>

123
00:07:46,139 --> 00:07:51,150
downloading straight from sysinternals

124
00:07:47,870 --> 00:07:53,069
<font color="#CCCCCC">I've never been caught doing that</font><font color="#E5E5E5"> I mean</font>

125
00:07:51,150 --> 00:07:57,599
I<font color="#E5E5E5"> mean it's never been detected as as</font>

126
00:07:53,069 --> 00:07:59,639
<font color="#E5E5E5">something evil or you can you can use</font>

127
00:07:57,599 --> 00:08:01,860
this<font color="#E5E5E5"> UNC path here</font><font color="#CCCCCC"> we show in the run</font>

128
00:07:59,639 --> 00:08:03,839
command you can just literally<font color="#E5E5E5"> run the</font>

129
00:08:01,860 --> 00:08:06,810
utilities from<font color="#E5E5E5"> there you don't have</font><font color="#CCCCCC"> to</font>

130
00:08:03,839 --> 00:08:11,939
download<font color="#E5E5E5"> them which can be very handy as</font>

131
00:08:06,810 --> 00:08:13,589
<font color="#CCCCCC">well so PS exec I think everybody knows</font>

132
00:08:11,939 --> 00:08:15,960
<font color="#E5E5E5">probably the most common sysinternals</font>

133
00:08:13,589 --> 00:08:19,409
tool<font color="#E5E5E5"> it's also the most commonly</font>

134
00:08:15,960 --> 00:08:21,448
detected as an attacker tool so<font color="#E5E5E5"> we like</font>

135
00:08:19,409 --> 00:08:23,819
<font color="#CCCCCC">to</font><font color="#E5E5E5"> use it but we do often get caught</font>

136
00:08:21,449 --> 00:08:25,860
with this<font color="#E5E5E5"> one but this basically</font><font color="#CCCCCC"> allows</font>

137
00:08:23,819 --> 00:08:28,560
you<font color="#CCCCCC"> to run commands remotely on</font>

138
00:08:25,860 --> 00:08:30,539
different machines<font color="#CCCCCC"> you have to have a</font>

139
00:08:28,560 --> 00:08:33,839
credential<font color="#E5E5E5"> but credentials are not</font><font color="#CCCCCC"> that</font>

140
00:08:30,539 --> 00:08:35,718
<font color="#E5E5E5">hard</font><font color="#CCCCCC"> to come by</font><font color="#E5E5E5"> so that's usually pretty</font>

141
00:08:33,839 --> 00:08:37,860
<font color="#E5E5E5">simple these screenshots here show</font>

142
00:08:35,719 --> 00:08:39,899
running a command<font color="#E5E5E5"> shell on a remote</font>

143
00:08:37,860 --> 00:08:42,419
system<font color="#E5E5E5"> that's the top one and on the</font>

144
00:08:39,899 --> 00:08:44,610
<font color="#CCCCCC">bottom it shows running a local batch</font>

145
00:08:42,419 --> 00:08:47,640
file<font color="#E5E5E5"> that we've created but you're</font>

146
00:08:44,610 --> 00:08:49,079
running<font color="#CCCCCC"> that on</font><font color="#E5E5E5"> a remote system so it's</font>

147
00:08:47,640 --> 00:08:52,079
it's<font color="#CCCCCC"> pretty interesting</font>

148
00:08:49,079 --> 00:08:53,160
there you<font color="#E5E5E5"> can do all the same stuff with</font>

149
00:08:52,079 --> 00:08:56,160
wmic

150
00:08:53,160 --> 00:08:58,319
with<font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> but this is</font><font color="#E5E5E5"> just</font>

151
00:08:56,160 --> 00:09:00,750
provides another alternative<font color="#CCCCCC"> that</font><font color="#E5E5E5"> may or</font>

152
00:08:58,320 --> 00:09:03,230
may<font color="#CCCCCC"> not get</font><font color="#E5E5E5"> caught</font><font color="#CCCCCC"> and the idea</font><font color="#E5E5E5"> is that</font>

153
00:09:00,750 --> 00:09:05,550
you know it's such interesting

154
00:09:03,230 --> 00:09:08,010
functionality<font color="#CCCCCC"> that it's been ported to a</font>

155
00:09:05,550 --> 00:09:09,540
bunch of different security tools<font color="#CCCCCC"> and as</font>

156
00:09:08,010 --> 00:09:13,530
we go<font color="#E5E5E5"> through the tools if you've got</font>

157
00:09:09,540 --> 00:09:15,930
<font color="#CCCCCC">questions ask</font><font color="#E5E5E5"> them</font><font color="#CCCCCC"> just raise your hand</font>

158
00:09:13,530 --> 00:09:18,990
and<font color="#E5E5E5"> we'll we'll see if we can answer</font>

159
00:09:15,930 --> 00:09:22,250
<font color="#E5E5E5">whatever you want to know</font><font color="#CCCCCC"> next</font><font color="#E5E5E5"> tool</font><font color="#CCCCCC"> that</font>

160
00:09:18,990 --> 00:09:25,410
we typically use<font color="#E5E5E5"> on a frequent basis</font>

161
00:09:22,250 --> 00:09:28,830
is proc dump<font color="#E5E5E5"> and proc process Explorer</font>

162
00:09:25,410 --> 00:09:30,959
<font color="#E5E5E5">so we all know that on modern</font><font color="#CCCCCC"> Windows</font>

163
00:09:28,830 --> 00:09:32,790
systems you can start task manager<font color="#E5E5E5"> and</font>

164
00:09:30,960 --> 00:09:35,550
then<font color="#CCCCCC"> you can</font><font color="#E5E5E5"> right-click on the</font><font color="#CCCCCC"> LSS</font>

165
00:09:32,790 --> 00:09:37,439
<font color="#E5E5E5">process and dump memory and then you can</font>

166
00:09:35,550 --> 00:09:39,780
pull that<font color="#E5E5E5"> memory off onto a separate</font>

167
00:09:37,440 --> 00:09:42,410
<font color="#CCCCCC">machine and do</font><font color="#E5E5E5"> things</font><font color="#CCCCCC"> like from run mini</font>

168
00:09:39,780 --> 00:09:44,939
cats against it to get<font color="#CCCCCC"> plain text creds</font>

169
00:09:42,410 --> 00:09:47,790
<font color="#E5E5E5">we can do the same thing with proc dump</font>

170
00:09:44,940 --> 00:09:50,940
and process Explorer except we have

171
00:09:47,790 --> 00:09:54,060
really nice options<font color="#CCCCCC"> in one organization</font>

172
00:09:50,940 --> 00:09:58,560
<font color="#CCCCCC">that</font><font color="#E5E5E5"> I tested they were instrumenting</font>

173
00:09:54,060 --> 00:10:01,589
<font color="#E5E5E5">the</font><font color="#CCCCCC"> appearance of L SAS DMP on endpoints</font>

174
00:09:58,560 --> 00:10:03,479
with proc dump<font color="#CCCCCC"> and process Explorer you</font>

175
00:10:01,590 --> 00:10:06,510
<font color="#E5E5E5">can actually name your dump file</font>

176
00:10:03,480 --> 00:10:08,760
<font color="#E5E5E5">whatever you want so when you run task</font>

177
00:10:06,510 --> 00:10:10,860
manager<font color="#CCCCCC"> and</font><font color="#E5E5E5"> right-click and dump else as</font>

178
00:10:08,760 --> 00:10:12,660
it gets<font color="#E5E5E5"> that name by default</font><font color="#CCCCCC"> you don't</font>

179
00:10:10,860 --> 00:10:14,940
have an<font color="#CCCCCC"> option to change that name yeah</font>

180
00:10:12,660 --> 00:10:17,310
so with with these tools<font color="#E5E5E5"> I</font><font color="#CCCCCC"> can stick it</font>

181
00:10:14,940 --> 00:10:19,200
anywhere<font color="#E5E5E5"> I want I can name it whatever I</font>

182
00:10:17,310 --> 00:10:22,020
want<font color="#CCCCCC"> so if somebody's doing some</font>

183
00:10:19,200 --> 00:10:24,690
simplistic<font color="#E5E5E5"> detection that way you can</font>

184
00:10:22,020 --> 00:10:29,130
bypass that<font color="#E5E5E5"> pretty easily you</font><font color="#CCCCCC"> can name</font>

185
00:10:24,690 --> 00:10:31,250
it cheese dot<font color="#E5E5E5"> whiz yeah and our typical</font>

186
00:10:29,130 --> 00:10:35,430
<font color="#E5E5E5">workflow is get on a machine using creds</font>

187
00:10:31,250 --> 00:10:37,380
<font color="#E5E5E5">dump the</font><font color="#CCCCCC"> L sass process and then analyze</font>

188
00:10:35,430 --> 00:10:39,689
with with mini cats to get creds

189
00:10:37,380 --> 00:10:41,220
keep in mind that<font color="#E5E5E5"> L SAS isn't the only</font>

190
00:10:39,690 --> 00:10:43,830
<font color="#E5E5E5">thing</font><font color="#CCCCCC"> that you might be interested in</font>

191
00:10:41,220 --> 00:10:46,050
<font color="#E5E5E5">we'll talk about a</font><font color="#CCCCCC"> couple of</font><font color="#E5E5E5"> other tools</font>

192
00:10:43,830 --> 00:10:48,480
<font color="#CCCCCC">that we'll use</font><font color="#E5E5E5"> proc dump to get memory</font>

193
00:10:46,050 --> 00:10:52,020
from to do the same<font color="#E5E5E5"> same sort</font><font color="#CCCCCC"> of</font>

194
00:10:48,480 --> 00:10:53,760
analysis<font color="#E5E5E5"> and</font><font color="#CCCCCC"> practie</font><font color="#E5E5E5"> is being detected a</font>

195
00:10:52,020 --> 00:10:56,490
<font color="#E5E5E5">little more frequently now but process</font>

196
00:10:53,760 --> 00:10:58,770
Explorer doesn't<font color="#E5E5E5"> seem to be so well I</font>

197
00:10:56,490 --> 00:11:00,920
would say proc<font color="#E5E5E5"> dump when it's targeting</font>

198
00:10:58,770 --> 00:11:03,540
else<font color="#E5E5E5"> ass is getting detected a lot</font>

199
00:11:00,920 --> 00:11:05,819
anything that messes with LCS nowadays

200
00:11:03,540 --> 00:11:06,599
<font color="#E5E5E5">hopefully you've</font><font color="#CCCCCC"> gotten</font><font color="#E5E5E5"> endpoint</font>

201
00:11:05,820 --> 00:11:10,110
protection so<font color="#E5E5E5"> we</font>

202
00:11:06,600 --> 00:11:12,810
or<font color="#E5E5E5"> or something that's going</font><font color="#CCCCCC"> to detect</font>

203
00:11:10,110 --> 00:11:18,990
<font color="#E5E5E5">that interaction with LSS and tell you</font>

204
00:11:12,810 --> 00:11:21,300
and<font color="#E5E5E5"> hopefully prevent it as well in this</font>

205
00:11:18,990 --> 00:11:24,690
one this<font color="#E5E5E5"> is our favorite ad</font><font color="#CCCCCC"> explorer</font>

206
00:11:21,300 --> 00:11:26,520
<font color="#E5E5E5">such a wonderful tool I wrote a whole</font>

207
00:11:24,690 --> 00:11:29,850
blog post on this one<font color="#E5E5E5"> because it's so</font>

208
00:11:26,520 --> 00:11:31,500
<font color="#E5E5E5">awesome</font><font color="#CCCCCC"> dave told</font><font color="#E5E5E5"> me about it</font><font color="#CCCCCC"> a couple</font>

209
00:11:29,850 --> 00:11:32,670
<font color="#CCCCCC">years back and I've used</font><font color="#E5E5E5"> it on every</font>

210
00:11:31,500 --> 00:11:36,300
test<font color="#E5E5E5"> ever since</font>

211
00:11:32,670 --> 00:11:38,310
so<font color="#CCCCCC"> ad explorer basically allows any</font>

212
00:11:36,300 --> 00:11:41,939
authenticated user to connect to a date

213
00:11:38,310 --> 00:11:44,550
domain controller<font color="#E5E5E5"> and read every</font>

214
00:11:41,940 --> 00:11:47,040
readable attribute for that user in

215
00:11:44,550 --> 00:11:49,560
Active Directory<font color="#CCCCCC"> and that</font><font color="#E5E5E5"> content that</font>

216
00:11:47,040 --> 00:11:51,630
means a lot<font color="#E5E5E5"> of</font><font color="#CCCCCC"> attributes</font><font color="#E5E5E5"> you can't read</font>

217
00:11:49,560 --> 00:11:53,849
<font color="#CCCCCC">people's passwords</font><font color="#E5E5E5"> but you can read a</font>

218
00:11:51,630 --> 00:11:54,390
whole<font color="#CCCCCC"> lot of the attributes in Active</font>

219
00:11:53,850 --> 00:11:57,990
Directory

220
00:11:54,390 --> 00:12:00,420
so what we typically do is in the

221
00:11:57,990 --> 00:12:02,430
beginning<font color="#CCCCCC"> of an engagement that you can</font>

222
00:12:00,420 --> 00:12:04,260
create<font color="#E5E5E5"> a snapshot with</font><font color="#CCCCCC"> it which means</font>

223
00:12:02,430 --> 00:12:06,300
<font color="#E5E5E5">you can go in and just pull all the data</font>

224
00:12:04,260 --> 00:12:08,790
<font color="#CCCCCC">out and</font><font color="#E5E5E5"> then pull it offline and then</font>

225
00:12:06,300 --> 00:12:10,609
you can analyze<font color="#CCCCCC"> that data offline</font><font color="#E5E5E5"> so you</font>

226
00:12:08,790 --> 00:12:13,410
don't you can learn<font color="#E5E5E5"> a lot of things</font>

227
00:12:10,610 --> 00:12:15,300
through<font color="#E5E5E5"> that snapshot data so you don't</font>

228
00:12:13,410 --> 00:12:17,430
have<font color="#E5E5E5"> to run commands on</font><font color="#CCCCCC"> the system like</font>

229
00:12:15,300 --> 00:12:19,770
net commands to figure out different

230
00:12:17,430 --> 00:12:23,280
<font color="#CCCCCC">things</font><font color="#E5E5E5"> as you're doing</font><font color="#CCCCCC"> reconnaissance on</font>

231
00:12:19,770 --> 00:12:26,430
the network so it also gives you a

232
00:12:23,280 --> 00:12:28,829
really<font color="#CCCCCC"> good idea situational awareness</font>

233
00:12:26,430 --> 00:12:30,540
on the network so<font color="#CCCCCC"> you can you you have</font>

234
00:12:28,830 --> 00:12:33,150
this tree view of<font color="#CCCCCC"> how Active Directory</font>

235
00:12:30,540 --> 00:12:34,949
is organized so<font color="#CCCCCC"> it allows you to kind of</font>

236
00:12:33,150 --> 00:12:37,140
see<font color="#CCCCCC"> how the network sits together</font><font color="#E5E5E5"> you</font>

237
00:12:34,950 --> 00:12:38,640
can kind<font color="#CCCCCC"> of get inside</font><font color="#E5E5E5"> the admins head</font>

238
00:12:37,140 --> 00:12:40,620
and say this is<font color="#E5E5E5"> where they have these</font>

239
00:12:38,640 --> 00:12:42,420
this is you can you can see these

240
00:12:40,620 --> 00:12:46,620
<font color="#E5E5E5">relationships</font><font color="#CCCCCC"> by the way it's presented</font>

241
00:12:42,420 --> 00:12:49,680
<font color="#CCCCCC">to you here</font><font color="#E5E5E5"> and if you have this on your</font>

242
00:12:46,620 --> 00:12:51,930
network<font color="#E5E5E5"> think about any user that</font><font color="#CCCCCC"> you</font>

243
00:12:49,680 --> 00:12:53,719
wouldn't<font color="#E5E5E5"> want to</font><font color="#CCCCCC"> be able to</font><font color="#E5E5E5"> peer into</font>

244
00:12:51,930 --> 00:12:56,310
Active Directory users<font color="#CCCCCC"> and computers</font>

245
00:12:53,720 --> 00:12:59,010
<font color="#E5E5E5">because this is really what it looks</font>

246
00:12:56,310 --> 00:13:01,800
like and<font color="#CCCCCC"> you can you can</font><font color="#E5E5E5"> grab</font>

247
00:12:59,010 --> 00:13:04,680
information<font color="#E5E5E5"> from multiple domains in a</font>

248
00:13:01,800 --> 00:13:08,130
forest<font color="#CCCCCC"> and you've got everything at</font><font color="#E5E5E5"> your</font>

249
00:13:04,680 --> 00:13:10,199
<font color="#CCCCCC">fingertips</font><font color="#E5E5E5"> if you only have say a</font>

250
00:13:08,130 --> 00:13:12,450
meterpreter session<font color="#E5E5E5"> on a machine</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> you</font>

251
00:13:10,200 --> 00:13:14,430
don't have GUI access to run this you

252
00:13:12,450 --> 00:13:16,580
can run it through<font color="#E5E5E5"> the command line so</font>

253
00:13:14,430 --> 00:13:18,900
you can<font color="#CCCCCC"> issue</font><font color="#E5E5E5"> the command ad explorer</font>

254
00:13:16,580 --> 00:13:20,190
<font color="#CCCCCC">accept EULA there that</font><font color="#E5E5E5"> just means don't</font>

255
00:13:18,900 --> 00:13:22,019
<font color="#E5E5E5">show</font><font color="#CCCCCC"> that pop</font>

256
00:13:20,190 --> 00:13:26,220
that you normally<font color="#E5E5E5"> get with sysinternals</font>

257
00:13:22,019 --> 00:13:28,019
tools and then create a snapshot<font color="#E5E5E5"> and the</font>

258
00:13:26,220 --> 00:13:29,850
double quotes are the connection string

259
00:13:28,019 --> 00:13:31,620
you can<font color="#E5E5E5"> leave that</font><font color="#CCCCCC"> blank for the default</font>

260
00:13:29,850 --> 00:13:33,480
<font color="#E5E5E5">domain controller or you can put a</font>

261
00:13:31,620 --> 00:13:35,700
server name in there and then you give

262
00:13:33,480 --> 00:13:37,649
it<font color="#E5E5E5"> a an output file name and then you</font>

263
00:13:35,700 --> 00:13:39,360
pull that's that's your snapshot and

264
00:13:37,649 --> 00:13:43,589
then<font color="#CCCCCC"> you pull that off the machine so</font>

265
00:13:39,360 --> 00:13:44,970
<font color="#E5E5E5">you don't need GUI access to do this so</font>

266
00:13:43,589 --> 00:13:46,139
we're gonna talk<font color="#E5E5E5"> about some</font><font color="#CCCCCC"> of the</font>

267
00:13:44,970 --> 00:13:48,990
<font color="#E5E5E5">things that we do with</font><font color="#CCCCCC"> Active Directory</font>

268
00:13:46,139 --> 00:13:52,170
<font color="#CCCCCC">Explorer every time we pull a snapshot</font>

269
00:13:48,990 --> 00:13:54,120
<font color="#E5E5E5">off of a target</font><font color="#CCCCCC"> network the first</font><font color="#E5E5E5"> things</font>

270
00:13:52,170 --> 00:13:55,860
that<font color="#E5E5E5"> we like to</font><font color="#CCCCCC"> do is the same things we</font>

271
00:13:54,120 --> 00:13:58,649
like<font color="#CCCCCC"> to do when we're looking for an</font>

272
00:13:55,860 --> 00:14:00,899
opportunity<font color="#E5E5E5"> escalate privilege and pivot</font>

273
00:13:58,649 --> 00:14:02,370
across<font color="#CCCCCC"> the</font><font color="#E5E5E5"> network</font><font color="#CCCCCC"> we want to know who</font>

274
00:14:00,899 --> 00:14:04,800
the important people are who<font color="#CCCCCC"> are the</font>

275
00:14:02,370 --> 00:14:06,600
<font color="#E5E5E5">domain admins who are local system</font>

276
00:14:04,800 --> 00:14:08,609
administrators who are Enterprise admins

277
00:14:06,600 --> 00:14:11,670
who can modify the Active<font color="#CCCCCC"> Directory</font>

278
00:14:08,610 --> 00:14:13,889
schema<font color="#E5E5E5"> well now we don't have to use the</font>

279
00:14:11,670 --> 00:14:17,910
net commands which are likely<font color="#E5E5E5"> to get us</font>

280
00:14:13,889 --> 00:14:19,560
<font color="#E5E5E5">caught we can just run ad</font><font color="#CCCCCC"> explorer</font><font color="#E5E5E5"> take</font>

281
00:14:17,910 --> 00:14:21,380
a look at the attributes associated<font color="#E5E5E5"> with</font>

282
00:14:19,560 --> 00:14:24,209
the things<font color="#CCCCCC"> that we're interested in</font><font color="#E5E5E5"> and</font>

283
00:14:21,380 --> 00:14:26,760
we have<font color="#E5E5E5"> everything at our fingerprints</font>

284
00:14:24,209 --> 00:14:29,719
<font color="#E5E5E5">to include stuff</font><font color="#CCCCCC"> like the default</font><font color="#E5E5E5"> domain</font>

285
00:14:26,760 --> 00:14:34,680
password policy if<font color="#E5E5E5"> you look at the</font>

286
00:14:29,720 --> 00:14:36,560
<font color="#CCCCCC">left-hand screen</font><font color="#E5E5E5"> capture that is the</font>

287
00:14:34,680 --> 00:14:39,689
attributes for default domain policy

288
00:14:36,560 --> 00:14:43,109
they<font color="#E5E5E5"> are right hand is it right hand</font>

289
00:14:39,690 --> 00:14:45,690
yeah<font color="#CCCCCC"> okay so they are</font><font color="#E5E5E5"> in integer</font><font color="#CCCCCC"> eight</font>

290
00:14:43,110 --> 00:14:49,860
format<font color="#E5E5E5"> but what that</font><font color="#CCCCCC"> really means is</font>

291
00:14:45,690 --> 00:14:52,680
it's a hundred nanosecond ticks identify

292
00:14:49,860 --> 00:14:54,140
how<font color="#E5E5E5"> much time so you</font><font color="#CCCCCC"> just</font><font color="#E5E5E5"> divide by ten</font>

293
00:14:52,680 --> 00:14:56,209
million<font color="#CCCCCC"> or well convert it to</font><font color="#E5E5E5"> decimal</font>

294
00:14:54,140 --> 00:14:59,850
<font color="#E5E5E5">make the negative number positive</font>

295
00:14:56,209 --> 00:15:05,040
<font color="#E5E5E5">divided</font><font color="#CCCCCC"> by</font><font color="#E5E5E5"> ten million divided by</font><font color="#CCCCCC"> 60</font><font color="#E5E5E5"> 60</font>

296
00:14:59,850 --> 00:15:06,510
<font color="#E5E5E5">24 to get minutes seconds and days and</font>

297
00:15:05,040 --> 00:15:08,310
that all sounds way<font color="#CCCCCC"> too difficult</font><font color="#E5E5E5"> but</font>

298
00:15:06,510 --> 00:15:10,199
<font color="#E5E5E5">you see you figure that out once and</font>

299
00:15:08,310 --> 00:15:16,170
script it and then you can<font color="#E5E5E5"> convert that</font>

300
00:15:10,199 --> 00:15:19,229
<font color="#E5E5E5">timestamp</font><font color="#CCCCCC"> anytime yeah I was on a test</font>

301
00:15:16,170 --> 00:15:22,199
recently<font color="#E5E5E5"> where I did enumerate the</font>

302
00:15:19,230 --> 00:15:23,760
password policy<font color="#CCCCCC"> and they said hey what</font>

303
00:15:22,199 --> 00:15:26,399
are you doing we see you using<font color="#CCCCCC"> that</font>

304
00:15:23,760 --> 00:15:28,709
command<font color="#E5E5E5"> users don't do that so you can</font>

305
00:15:26,399 --> 00:15:31,140
you<font color="#CCCCCC"> can learn that information without</font>

306
00:15:28,709 --> 00:15:33,859
running the<font color="#E5E5E5"> connect commands then I</font>

307
00:15:31,140 --> 00:15:36,330
would<font color="#E5E5E5"> recommend</font><font color="#CCCCCC"> that in any organization</font>

308
00:15:33,860 --> 00:15:38,820
users<font color="#E5E5E5"> don't use whim accusers don't use</font>

309
00:15:36,330 --> 00:15:40,560
net you should be<font color="#E5E5E5"> looking for</font><font color="#CCCCCC"> the</font>

310
00:15:38,820 --> 00:15:45,360
activity if you're a blue<font color="#CCCCCC"> Timur</font><font color="#E5E5E5"> and</font>

311
00:15:40,560 --> 00:15:48,359
<font color="#CCCCCC">users don't normally use</font><font color="#E5E5E5"> ad</font><font color="#CCCCCC"> explore</font><font color="#E5E5E5"> so</font>

312
00:15:45,360 --> 00:15:50,940
<font color="#E5E5E5">yeah I kind of mentioned early earlier</font>

313
00:15:48,360 --> 00:15:52,830
the hierarchy view the<font color="#E5E5E5"> hierarchical view</font>

314
00:15:50,940 --> 00:15:55,860
<font color="#E5E5E5">that you</font><font color="#CCCCCC"> see of Active Directory</font><font color="#E5E5E5"> but you</font>

315
00:15:52,830 --> 00:15:59,400
can also I mean Active Directory is

316
00:15:55,860 --> 00:16:01,440
arranged<font color="#CCCCCC"> by OU's organizational units</font><font color="#E5E5E5"> to</font>

317
00:15:59,400 --> 00:16:03,630
which group<font color="#E5E5E5"> policy</font><font color="#CCCCCC"> is applied so</font><font color="#E5E5E5"> things</font>

318
00:16:01,440 --> 00:16:04,980
are things<font color="#E5E5E5"> are organized in groups so</font>

319
00:16:03,630 --> 00:16:06,689
<font color="#CCCCCC">that you can apply</font><font color="#E5E5E5"> certain group</font>

320
00:16:04,980 --> 00:16:08,670
policies to each of those<font color="#CCCCCC"> groups because</font>

321
00:16:06,690 --> 00:16:10,260
<font color="#CCCCCC">they all have different</font><font color="#E5E5E5"> functions and</font>

322
00:16:08,670 --> 00:16:12,449
<font color="#E5E5E5">all have different</font><font color="#CCCCCC"> levels of permission</font>

323
00:16:10,260 --> 00:16:14,760
but<font color="#E5E5E5"> you can see that in Active Directory</font>

324
00:16:12,450 --> 00:16:17,160
<font color="#E5E5E5">Explorer you can</font><font color="#CCCCCC"> also see the naming</font>

325
00:16:14,760 --> 00:16:18,720
<font color="#E5E5E5">convention used on the network</font><font color="#CCCCCC"> whereas</font>

326
00:16:17,160 --> 00:16:20,850
if<font color="#E5E5E5"> you don't have this you're kind of</font>

327
00:16:18,720 --> 00:16:22,920
blind you get on a network<font color="#E5E5E5"> and</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> don't</font>

328
00:16:20,850 --> 00:16:24,780
really know what's out<font color="#E5E5E5"> there</font><font color="#CCCCCC"> but this</font>

329
00:16:22,920 --> 00:16:26,310
gives<font color="#E5E5E5"> you this beautiful picture</font><font color="#CCCCCC"> of</font>

330
00:16:24,780 --> 00:16:29,579
what's out<font color="#E5E5E5"> on the network and how</font><font color="#CCCCCC"> it's</font>

331
00:16:26,310 --> 00:16:31,290
organized and you can<font color="#CCCCCC"> see usually not</font>

332
00:16:29,580 --> 00:16:33,960
always but usually from<font color="#E5E5E5"> the naming</font>

333
00:16:31,290 --> 00:16:36,150
conventions you can see what the<font color="#E5E5E5"> servers</font>

334
00:16:33,960 --> 00:16:38,190
are for sequel servers typically<font color="#E5E5E5"> will</font>

335
00:16:36,150 --> 00:16:40,920
have sequel in the<font color="#E5E5E5"> name many times</font>

336
00:16:38,190 --> 00:16:43,950
workstations<font color="#CCCCCC"> one of the things we</font><font color="#E5E5E5"> like</font>

337
00:16:40,920 --> 00:16:46,500
love<font color="#CCCCCC"> to do is target the CEO right so if</font>

338
00:16:43,950 --> 00:16:49,620
<font color="#E5E5E5">the if the workstation names or laptop</font>

339
00:16:46,500 --> 00:16:51,630
names have the CEOs name in it it's

340
00:16:49,620 --> 00:16:54,060
<font color="#E5E5E5">really easy</font><font color="#CCCCCC"> to find his machine</font><font color="#E5E5E5"> to</font>

341
00:16:51,630 --> 00:17:00,630
<font color="#E5E5E5">target that machine so it's it's really</font>

342
00:16:54,060 --> 00:17:04,079
<font color="#E5E5E5">fun when we see that the</font><font color="#CCCCCC"> next thing</font><font color="#E5E5E5"> we</font>

343
00:17:00,630 --> 00:17:05,849
love is easy credentials<font color="#E5E5E5"> so there are</font>

344
00:17:04,079 --> 00:17:09,389
several attributes<font color="#E5E5E5"> in Active Directory</font>

345
00:17:05,849 --> 00:17:12,179
that are used to store passwords<font color="#CCCCCC"> and you</font>

346
00:17:09,390 --> 00:17:14,400
may or may<font color="#CCCCCC"> not know that they exist</font><font color="#E5E5E5"> in</font>

347
00:17:12,180 --> 00:17:16,740
<font color="#E5E5E5">most organizations that we found easy</font>

348
00:17:14,400 --> 00:17:18,720
creds like this in we<font color="#E5E5E5"> presented to the</font>

349
00:17:16,740 --> 00:17:19,200
organization they<font color="#CCCCCC"> go how did that get</font>

350
00:17:18,720 --> 00:17:22,380
there

351
00:17:19,200 --> 00:17:23,990
how long has it been<font color="#E5E5E5"> there and nine</font>

352
00:17:22,380 --> 00:17:27,000
times out of<font color="#E5E5E5"> ten it's a service account</font>

353
00:17:23,990 --> 00:17:29,280
<font color="#E5E5E5">with high privileges and</font><font color="#CCCCCC"> the password</font>

354
00:17:27,000 --> 00:17:32,700
hasn't been<font color="#CCCCCC"> changed in</font><font color="#E5E5E5"> ten years and it</font>

355
00:17:29,280 --> 00:17:34,410
<font color="#CCCCCC">never yeah and it never expires so what</font>

356
00:17:32,700 --> 00:17:36,480
we do is we look<font color="#CCCCCC"> for these attributes</font>

357
00:17:34,410 --> 00:17:41,190
user password<font color="#E5E5E5"> and</font><font color="#CCCCCC"> unix user password</font>

358
00:17:36,480 --> 00:17:44,190
unicode password ms/ms<font color="#CCCCCC"> SFU</font><font color="#E5E5E5"> 30 password</font>

359
00:17:41,190 --> 00:17:47,240
so that<font color="#E5E5E5"> ms</font><font color="#CCCCCC"> SFU 30 only shows up if</font>

360
00:17:44,190 --> 00:17:49,860
you've got<font color="#E5E5E5"> unix LDAP integration enabled</font>

361
00:17:47,240 --> 00:17:52,080
<font color="#CCCCCC">but I look through we</font><font color="#E5E5E5"> looked through all</font>

362
00:17:49,860 --> 00:17:53,699
<font color="#CCCCCC">of these attributes just to see if you</font>

363
00:17:52,080 --> 00:17:55,230
<font color="#CCCCCC">know maybe the helpdesk</font><font color="#E5E5E5"> is using a</font>

364
00:17:53,700 --> 00:17:58,260
<font color="#E5E5E5">default password putting it in the in</font>

365
00:17:55,230 --> 00:18:00,630
the comments and you<font color="#CCCCCC"> know they think</font>

366
00:17:58,260 --> 00:18:02,220
<font color="#E5E5E5">that nobody can read that literally</font>

367
00:18:00,630 --> 00:18:05,130
everyone in<font color="#E5E5E5"> your Active Directory can</font>

368
00:18:02,220 --> 00:18:07,740
<font color="#E5E5E5">read those things so the one that we</font>

369
00:18:05,130 --> 00:18:10,860
find the passwords in the most is user

370
00:18:07,740 --> 00:18:14,910
password<font color="#E5E5E5"> and the user password field</font>

371
00:18:10,860 --> 00:18:16,860
stores<font color="#E5E5E5"> the password as decimal encoded</font>

372
00:18:14,910 --> 00:18:20,250
ASCII<font color="#CCCCCC"> I can just copy the</font><font color="#E5E5E5"> value out</font>

373
00:18:16,860 --> 00:18:22,830
<font color="#E5E5E5">paste it into a web converter and I get</font>

374
00:18:20,250 --> 00:18:26,220
a<font color="#CCCCCC"> plaintext password out now</font><font color="#E5E5E5"> two weeks</font>

375
00:18:22,830 --> 00:18:28,800
<font color="#E5E5E5">ago organization high privilege service</font>

376
00:18:26,220 --> 00:18:30,120
account with one of these<font color="#CCCCCC"> passwords in</font>

377
00:18:28,800 --> 00:18:33,570
there that hadn't<font color="#CCCCCC"> been changed</font><font color="#E5E5E5"> in</font><font color="#CCCCCC"> ten</font>

378
00:18:30,120 --> 00:18:35,399
<font color="#E5E5E5">years</font><font color="#CCCCCC"> and the</font><font color="#E5E5E5"> credentials were good if I</font>

379
00:18:33,570 --> 00:18:37,230
land<font color="#E5E5E5"> on a network and I'm pulling Active</font>

380
00:18:35,400 --> 00:18:39,180
Directory snapshot<font color="#E5E5E5"> Active Directory</font>

381
00:18:37,230 --> 00:18:40,500
<font color="#CCCCCC">Explorer</font><font color="#E5E5E5"> snapshot this is</font><font color="#CCCCCC"> going to be</font>

382
00:18:39,180 --> 00:18:42,090
one of<font color="#CCCCCC"> the first things that</font><font color="#E5E5E5"> I look</font><font color="#CCCCCC"> for</font>

383
00:18:40,500 --> 00:18:44,580
because<font color="#E5E5E5"> it's an easy win for me because</font>

384
00:18:42,090 --> 00:18:47,520
now I'm at least<font color="#E5E5E5"> a moderately privileged</font>

385
00:18:44,580 --> 00:18:50,340
admin or I might<font color="#E5E5E5"> be admin of one server</font>

386
00:18:47,520 --> 00:18:53,730
<font color="#E5E5E5">and who knows how many creds</font>

387
00:18:50,340 --> 00:18:56,250
<font color="#E5E5E5">are in memory on that box and it may</font>

388
00:18:53,730 --> 00:18:58,470
seem<font color="#CCCCCC"> you may say Oh</font><font color="#E5E5E5"> our Active Directory</font>

389
00:18:56,250 --> 00:19:00,660
domain is so huge and<font color="#E5E5E5"> there's so much</font>

390
00:18:58,470 --> 00:19:02,160
data that<font color="#E5E5E5"> you'd never find that stuff</font>

391
00:19:00,660 --> 00:19:05,220
<font color="#E5E5E5">right it's like finding a needle in a</font>

392
00:19:02,160 --> 00:19:06,720
haystack<font color="#CCCCCC"> in</font><font color="#E5E5E5"> this database but</font><font color="#CCCCCC"> AD</font>

393
00:19:05,220 --> 00:19:08,460
<font color="#CCCCCC">Explorer has this wonderful search</font>

394
00:19:06,720 --> 00:19:12,390
feature so all you have<font color="#E5E5E5"> to do is say</font>

395
00:19:08,460 --> 00:19:15,870
show<font color="#CCCCCC"> me</font><font color="#E5E5E5"> all the records that have a user</font>

396
00:19:12,390 --> 00:19:17,850
password field that's not<font color="#E5E5E5"> like and and</font>

397
00:19:15,870 --> 00:19:20,280
it will populate those for you and so

398
00:19:17,850 --> 00:19:23,040
it's it makes it really<font color="#E5E5E5"> simple</font><font color="#CCCCCC"> to find</font>

399
00:19:20,280 --> 00:19:25,410
<font color="#E5E5E5">and I was also</font><font color="#CCCCCC"> on a test recently</font><font color="#E5E5E5"> where</font>

400
00:19:23,040 --> 00:19:27,680
I had the test said it hadn't even

401
00:19:25,410 --> 00:19:30,720
started<font color="#E5E5E5"> but I took the</font><font color="#CCCCCC"> Active Directory</font>

402
00:19:27,680 --> 00:19:33,390
<font color="#E5E5E5">snapshot when I was testing access to</font>

403
00:19:30,720 --> 00:19:36,480
the internal system and then when the

404
00:19:33,390 --> 00:19:39,120
test started<font color="#CCCCCC"> I found a high privileged</font>

405
00:19:36,480 --> 00:19:42,330
user password this way and I was I<font color="#E5E5E5"> was</font>

406
00:19:39,120 --> 00:19:44,939
basically done on day<font color="#E5E5E5"> one right so it it</font>

407
00:19:42,330 --> 00:19:46,500
makes it<font color="#E5E5E5"> so</font><font color="#CCCCCC"> simple</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> you should</font>

408
00:19:44,940 --> 00:19:48,750
<font color="#CCCCCC">definitely check</font><font color="#E5E5E5"> for this stuff in your</font>

409
00:19:46,500 --> 00:19:51,210
<font color="#E5E5E5">own environments because we found it</font><font color="#CCCCCC"> a</font>

410
00:19:48,750 --> 00:19:56,310
lot<font color="#CCCCCC"> especially in older active</font>

411
00:19:51,210 --> 00:19:58,080
<font color="#E5E5E5">directories yeah and so you can do quite</font>

412
00:19:56,310 --> 00:19:59,790
a<font color="#E5E5E5"> bit of password analysis here because</font>

413
00:19:58,080 --> 00:20:00,970
really<font color="#E5E5E5"> on Windows it's really all</font><font color="#CCCCCC"> about</font>

414
00:19:59,790 --> 00:20:02,200
getting credentials

415
00:20:00,970 --> 00:20:03,700
when<font color="#E5E5E5"> you're when you're on a domain</font>

416
00:20:02,200 --> 00:20:05,320
<font color="#E5E5E5">you're looking for credentials you're</font>

417
00:20:03,700 --> 00:20:07,240
trying to elevate you're trying to get

418
00:20:05,320 --> 00:20:09,879
<font color="#CCCCCC">access to different things</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> that</font>

419
00:20:07,240 --> 00:20:12,520
requires credentials so this with its

420
00:20:09,880 --> 00:20:15,730
search feature allows you to<font color="#E5E5E5"> do some</font>

421
00:20:12,520 --> 00:20:18,129
<font color="#E5E5E5">interesting</font><font color="#CCCCCC"> searching</font><font color="#E5E5E5"> through the</font>

422
00:20:15,730 --> 00:20:19,960
database<font color="#E5E5E5"> to find the accounts that</font><font color="#CCCCCC"> you</font>

423
00:20:18,130 --> 00:20:21,850
want to target<font color="#E5E5E5"> you can find which</font>

424
00:20:19,960 --> 00:20:24,580
accounts are disabled which accounts<font color="#E5E5E5"> are</font>

425
00:20:21,850 --> 00:20:26,559
service accounts<font color="#CCCCCC"> when they had their</font>

426
00:20:24,580 --> 00:20:29,110
password last set if the<font color="#E5E5E5"> password</font>

427
00:20:26,559 --> 00:20:31,928
expires or<font color="#E5E5E5"> not all those things you can</font>

428
00:20:29,110 --> 00:20:32,949
you can search<font color="#CCCCCC"> for and again</font><font color="#E5E5E5"> offline so</font>

429
00:20:31,929 --> 00:20:35,230
you don't have to do any of<font color="#E5E5E5"> this</font>

430
00:20:32,950 --> 00:20:39,039
<font color="#E5E5E5">querying that</font><font color="#CCCCCC"> might get you caught on</font>

431
00:20:35,230 --> 00:20:41,530
the network<font color="#E5E5E5"> there is user account</font>

432
00:20:39,039 --> 00:20:43,450
control is one of the really fun<font color="#CCCCCC"> ones</font>

433
00:20:41,530 --> 00:20:46,418
because that tells you the<font color="#CCCCCC"> status of</font>

434
00:20:43,450 --> 00:20:48,309
that account<font color="#CCCCCC"> it tells you how it's</font>

435
00:20:46,419 --> 00:20:50,919
stored it tells you whether it's the

436
00:20:48,309 --> 00:20:53,678
password<font color="#E5E5E5"> expires whether the account is</font>

437
00:20:50,919 --> 00:20:57,820
<font color="#CCCCCC">enabled or disabled</font><font color="#E5E5E5"> and it can be that</font>

438
00:20:53,679 --> 00:20:59,830
value<font color="#CCCCCC"> can is like a bit mask so it can</font>

439
00:20:57,820 --> 00:21:03,490
be a<font color="#CCCCCC"> little bit tricky to decipher but</font>

440
00:20:59,830 --> 00:21:05,559
we put some references<font color="#E5E5E5"> here and the the</font>

441
00:21:03,490 --> 00:21:07,330
Jack Stromberg reference is a really

442
00:21:05,559 --> 00:21:10,178
good one<font color="#E5E5E5"> and so basically all you have</font>

443
00:21:07,330 --> 00:21:11,590
<font color="#CCCCCC">to do is</font><font color="#E5E5E5"> Google</font><font color="#CCCCCC"> the value for user</font>

444
00:21:10,179 --> 00:21:16,929
account control and it will tell you

445
00:21:11,590 --> 00:21:19,230
exactly<font color="#E5E5E5"> what's up with</font><font color="#CCCCCC"> that account next</font>

446
00:21:16,929 --> 00:21:21,970
one we like<font color="#E5E5E5"> to use a lot is PS</font><font color="#CCCCCC"> logged</font><font color="#E5E5E5"> on</font>

447
00:21:19,230 --> 00:21:22,809
<font color="#CCCCCC">so typically</font><font color="#E5E5E5"> when</font><font color="#CCCCCC"> you're running a tool</font>

448
00:21:21,970 --> 00:21:24,549
like bloodhound

449
00:21:22,809 --> 00:21:27,190
<font color="#CCCCCC">it's</font><font color="#E5E5E5"> enumerate all of</font><font color="#CCCCCC"> the active</font>

450
00:21:24,549 --> 00:21:30,220
sessions on the network and this does

451
00:21:27,190 --> 00:21:31,960
very similar work<font color="#E5E5E5"> so if we know</font><font color="#CCCCCC"> that</font>

452
00:21:30,220 --> 00:21:32,650
we're<font color="#E5E5E5"> gonna get caught running running</font>

453
00:21:31,960 --> 00:21:35,080
<font color="#E5E5E5">bloodhound</font>

454
00:21:32,650 --> 00:21:37,990
we might pivot to one of these tools

455
00:21:35,080 --> 00:21:40,178
<font color="#CCCCCC">right</font><font color="#E5E5E5"> a quick batch file that just runs</font>

456
00:21:37,990 --> 00:21:41,530
PS logged on<font color="#E5E5E5"> to a bunch of servers</font><font color="#CCCCCC"> and</font>

457
00:21:40,179 --> 00:21:44,110
identify the user that we're targeting

458
00:21:41,530 --> 00:21:47,740
<font color="#E5E5E5">on specific machines that we might be</font>

459
00:21:44,110 --> 00:21:49,510
able<font color="#CCCCCC"> to access</font><font color="#E5E5E5"> so again</font><font color="#CCCCCC"> very great tool</font>

460
00:21:47,740 --> 00:21:51,789
for user hunting and we go through<font color="#CCCCCC"> that</font>

461
00:21:49,510 --> 00:21:54,610
same workflow<font color="#E5E5E5"> where we're identifying</font>

462
00:21:51,789 --> 00:21:57,070
those admin<font color="#E5E5E5"> chat sessions pivoting to</font>

463
00:21:54,610 --> 00:21:59,289
the other machine<font color="#E5E5E5"> using PS exec running</font>

464
00:21:57,070 --> 00:22:01,928
else ass dump on the machine and<font color="#E5E5E5"> then</font>

465
00:21:59,289 --> 00:22:04,900
<font color="#E5E5E5">analyzing with mini cats and getting</font>

466
00:22:01,929 --> 00:22:07,630
creds<font color="#CCCCCC"> for that particular user so this</font>

467
00:22:04,900 --> 00:22:09,460
is a great tool to<font color="#E5E5E5"> find and use on the</font>

468
00:22:07,630 --> 00:22:11,049
network just<font color="#CCCCCC"> to you</font><font color="#E5E5E5"> know figure out</font>

469
00:22:09,460 --> 00:22:13,240
<font color="#E5E5E5">where</font><font color="#CCCCCC"> people</font><font color="#E5E5E5"> are logging on and who</font>

470
00:22:11,049 --> 00:22:14,559
might have lots of sessions<font color="#E5E5E5"> on a</font>

471
00:22:13,240 --> 00:22:17,320
particular server<font color="#E5E5E5"> you have</font><font color="#CCCCCC"> ax</font>

472
00:22:14,559 --> 00:22:19,090
- yeah and sometimes<font color="#E5E5E5"> when you run like</font>

473
00:22:17,320 --> 00:22:21,370
<font color="#E5E5E5">bloodhound or sharp pound it takes a</font>

474
00:22:19,090 --> 00:22:23,620
while<font color="#CCCCCC"> to</font><font color="#E5E5E5"> run and and typically what I'll</font>

475
00:22:21,370 --> 00:22:25,479
do is I'll run it and it's running<font color="#E5E5E5"> and</font>

476
00:22:23,620 --> 00:22:27,370
I'll be doing<font color="#CCCCCC"> other stuff and then I'll</font>

477
00:22:25,480 --> 00:22:29,889
eventually<font color="#E5E5E5"> go back and look at the</font>

478
00:22:27,370 --> 00:22:32,498
results<font color="#E5E5E5"> but those results may be stale</font>

479
00:22:29,889 --> 00:22:34,899
by then right<font color="#E5E5E5"> so so the same users may</font>

480
00:22:32,499 --> 00:22:36,399
<font color="#CCCCCC">not be logged in in the same places</font><font color="#E5E5E5"> so</font>

481
00:22:34,899 --> 00:22:38,049
then you can<font color="#E5E5E5"> just look at your</font>

482
00:22:36,399 --> 00:22:40,418
<font color="#E5E5E5">bloodhound results</font><font color="#CCCCCC"> and bloodhound</font>

483
00:22:38,049 --> 00:22:42,580
basically shows<font color="#CCCCCC"> you where everybody's</font>

484
00:22:40,419 --> 00:22:45,370
has sessions on the network and shows

485
00:22:42,580 --> 00:22:48,220
you a path to domain admin so you can

486
00:22:45,370 --> 00:22:49,989
take those<font color="#CCCCCC"> results and look look</font><font color="#E5E5E5"> at</font>

487
00:22:48,220 --> 00:22:51,970
where you<font color="#E5E5E5"> want to go and then use PS</font>

488
00:22:49,990 --> 00:22:53,950
logged on to<font color="#E5E5E5"> say is that user still</font>

489
00:22:51,970 --> 00:22:56,230
logged in there so you cut<font color="#E5E5E5"> it</font><font color="#CCCCCC"> a one-off</font>

490
00:22:53,950 --> 00:22:58,779
<font color="#E5E5E5">check and the other thing I like to use</font>

491
00:22:56,230 --> 00:23:01,210
<font color="#CCCCCC">it for is if I'm gonna use stolen</font>

492
00:22:58,779 --> 00:23:03,820
credentials<font color="#CCCCCC"> and I have say an admins</font>

493
00:23:01,210 --> 00:23:06,519
account that I want to use somewhere if

494
00:23:03,820 --> 00:23:08,590
<font color="#E5E5E5">I log on to a server that he or</font><font color="#CCCCCC"> she</font><font color="#E5E5E5"> is</font>

495
00:23:06,519 --> 00:23:11,379
already logged on to it's gonna kick

496
00:23:08,590 --> 00:23:12,668
them off<font color="#E5E5E5"> right so I that will alert them</font>

497
00:23:11,379 --> 00:23:15,129
that<font color="#CCCCCC"> I'm up to no good</font>

498
00:23:12,669 --> 00:23:17,259
so I check first with PS logged on<font color="#CCCCCC"> are</font>

499
00:23:15,129 --> 00:23:22,748
they logged on<font color="#E5E5E5"> no</font><font color="#CCCCCC"> okay</font><font color="#E5E5E5"> it's safe to go</font>

500
00:23:17,259 --> 00:23:25,240
to that<font color="#E5E5E5"> server so strings is a fun one</font>

501
00:23:22,749 --> 00:23:26,919
<font color="#E5E5E5">too everybody knows probably</font><font color="#CCCCCC"> anybody</font>

502
00:23:25,240 --> 00:23:29,950
that's worked with Linux<font color="#E5E5E5"> and UNIX</font>

503
00:23:26,919 --> 00:23:32,440
strings just pulls the ASCII readable

504
00:23:29,950 --> 00:23:35,999
<font color="#E5E5E5">and</font><font color="#CCCCCC"> Unicode read it both</font><font color="#E5E5E5"> strings out of</font>

505
00:23:32,440 --> 00:23:39,100
whatever file binary file or any file

506
00:23:35,999 --> 00:23:43,299
<font color="#E5E5E5">but so they wrote a version of this for</font>

507
00:23:39,100 --> 00:23:45,009
<font color="#E5E5E5">Windows which is handy</font><font color="#CCCCCC"> to have</font><font color="#E5E5E5"> you can</font>

508
00:23:43,299 --> 00:23:47,139
use<font color="#E5E5E5"> it against a memory dump</font><font color="#CCCCCC"> you can use</font>

509
00:23:45,009 --> 00:23:50,220
it against an<font color="#E5E5E5"> Active Directory Explorer</font>

510
00:23:47,139 --> 00:23:52,539
snapshot<font color="#E5E5E5"> - it will sometimes show</font>

511
00:23:50,220 --> 00:23:54,309
hard-coded credentials you<font color="#CCCCCC"> can search</font>

512
00:23:52,539 --> 00:23:56,799
<font color="#CCCCCC">through the strings that</font><font color="#E5E5E5"> you find for</font>

513
00:23:54,309 --> 00:24:01,509
<font color="#CCCCCC">say URLs that</font><font color="#E5E5E5"> might be embedded in a</font>

514
00:23:56,799 --> 00:24:04,269
binary file<font color="#CCCCCC"> it</font><font color="#E5E5E5"> can</font><font color="#CCCCCC"> be very handy and it</font>

515
00:24:01,509 --> 00:24:06,220
will<font color="#E5E5E5"> sometimes display credentials so</font>

516
00:24:04,269 --> 00:24:09,090
depending you<font color="#CCCCCC"> know depending</font><font color="#E5E5E5"> on</font><font color="#CCCCCC"> what</font>

517
00:24:06,220 --> 00:24:11,830
you're running strings against but yeah

518
00:24:09,090 --> 00:24:14,379
<font color="#E5E5E5">we find that especially where</font>

519
00:24:11,830 --> 00:24:17,559
<font color="#E5E5E5">organizations are using</font><font color="#CCCCCC"> custom developed</font>

520
00:24:14,379 --> 00:24:20,379
tools on their machines<font color="#E5E5E5"> that's one of</font>

521
00:24:17,559 --> 00:24:22,418
the favorite<font color="#CCCCCC"> places to use it so I find</font>

522
00:24:20,379 --> 00:24:24,519
<font color="#E5E5E5">something that's running as an actual</font>

523
00:24:22,419 --> 00:24:27,830
<font color="#E5E5E5">domain user by looking in the services</font>

524
00:24:24,519 --> 00:24:29,929
control panel applet and<font color="#E5E5E5"> then I go whoa</font>

525
00:24:27,830 --> 00:24:32,779
<font color="#E5E5E5">what process memory is associated with</font>

526
00:24:29,929 --> 00:24:35,450
<font color="#CCCCCC">that</font><font color="#E5E5E5"> dump that process</font><font color="#CCCCCC"> memory</font><font color="#E5E5E5"> take a</font>

527
00:24:32,779 --> 00:24:38,360
look at the content<font color="#E5E5E5"> that pops out in</font>

528
00:24:35,450 --> 00:24:40,010
this case we've wrote a<font color="#E5E5E5"> binary and</font>

529
00:24:38,360 --> 00:24:43,100
compiled it with hard-coded credentials

530
00:24:40,010 --> 00:24:44,720
in it you can see<font color="#E5E5E5"> that those hard-coded</font>

531
00:24:43,100 --> 00:24:46,370
credentials pop out of<font color="#E5E5E5"> the memory dump</font>

532
00:24:44,720 --> 00:24:51,460
<font color="#E5E5E5">and they pop out of the binary</font><font color="#CCCCCC"> that</font>

533
00:24:46,370 --> 00:24:53,959
itself<font color="#E5E5E5"> and we do find this on or in</font>

534
00:24:51,460 --> 00:24:56,019
environments where people<font color="#E5E5E5"> have developed</font>

535
00:24:53,960 --> 00:24:59,419
<font color="#E5E5E5">their own tools</font><font color="#CCCCCC"> in addition when we do</font>

536
00:24:56,019 --> 00:25:01,669
point-of-sale evaluations<font color="#E5E5E5"> we find the</font>

537
00:24:59,419 --> 00:25:04,100
<font color="#CCCCCC">point of</font><font color="#E5E5E5"> sale</font><font color="#CCCCCC"> process</font><font color="#E5E5E5"> do this exact same</font>

538
00:25:01,669 --> 00:25:07,610
<font color="#CCCCCC">thing</font><font color="#E5E5E5"> see if we can find credit cards</font>

539
00:25:04,100 --> 00:25:11,178
that pop out<font color="#CCCCCC"> so think wider than</font><font color="#E5E5E5"> else</font>

540
00:25:07,610 --> 00:25:13,010
<font color="#E5E5E5">ass and you know identify the processes</font>

541
00:25:11,179 --> 00:25:15,889
<font color="#E5E5E5">that might be interesting to</font><font color="#CCCCCC"> an attacker</font>

542
00:25:13,010 --> 00:25:17,629
<font color="#CCCCCC">that they might instrument to look for</font>

543
00:25:15,889 --> 00:25:19,399
either sensitive information<font color="#E5E5E5"> that might</font>

544
00:25:17,630 --> 00:25:20,510
get<font color="#E5E5E5"> them further access to the</font>

545
00:25:19,399 --> 00:25:30,678
environment or sensitive information

546
00:25:20,510 --> 00:25:34,820
<font color="#E5E5E5">that</font><font color="#CCCCCC"> you want to protect next one is</font>

547
00:25:30,679 --> 00:25:38,559
autoruns autoruns<font color="#CCCCCC"> us Auto NC so</font><font color="#E5E5E5"> autoruns</font>

548
00:25:34,820 --> 00:25:41,899
is the auto start entry point enumerator

549
00:25:38,559 --> 00:25:46,549
<font color="#CCCCCC">that has a GUI front-end</font><font color="#E5E5E5"> auto run see is</font>

550
00:25:41,899 --> 00:25:48,620
the console application but typically

551
00:25:46,549 --> 00:25:49,879
<font color="#E5E5E5">when you want to land on a machine</font><font color="#CCCCCC"> as an</font>

552
00:25:48,620 --> 00:25:52,789
attacker<font color="#CCCCCC"> you want to see if you can</font>

553
00:25:49,880 --> 00:25:55,580
escalate<font color="#E5E5E5"> privilege and see if you can do</font>

554
00:25:52,789 --> 00:25:57,320
Nats<font color="#E5E5E5"> nasty things to the</font><font color="#CCCCCC"> Box this</font><font color="#E5E5E5"> is a</font>

555
00:25:55,580 --> 00:26:01,100
great way to do it<font color="#CCCCCC"> if you can't run</font>

556
00:25:57,320 --> 00:26:03,500
tools like<font color="#E5E5E5"> powerup</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> evaluate</font><font color="#CCCCCC"> privilege</font>

557
00:26:01,100 --> 00:26:05,418
<font color="#E5E5E5">escalation opportunities this gives you</font>

558
00:26:03,500 --> 00:26:06,889
an<font color="#E5E5E5"> opportunity</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> take</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> look at the</font>

559
00:26:05,419 --> 00:26:08,779
entry points that are<font color="#E5E5E5"> going to start up</font>

560
00:26:06,889 --> 00:26:10,250
when you log<font color="#E5E5E5"> on</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> the machine</font><font color="#CCCCCC"> when you</font>

561
00:26:08,779 --> 00:26:12,980
start up the<font color="#E5E5E5"> machine</font>

562
00:26:10,250 --> 00:26:14,830
beyond just services and make a

563
00:26:12,980 --> 00:26:20,389
<font color="#E5E5E5">determination as</font><font color="#CCCCCC"> to whether</font><font color="#E5E5E5"> you can</font>

564
00:26:14,830 --> 00:26:21,980
<font color="#CCCCCC">actually exploit something so it's</font>

565
00:26:20,389 --> 00:26:24,709
another<font color="#E5E5E5"> great tool</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> have in your</font>

566
00:26:21,980 --> 00:26:26,510
arsenal<font color="#E5E5E5"> beyond those standard tools that</font>

567
00:26:24,710 --> 00:26:29,710
you would<font color="#E5E5E5"> you would potentially use on</font>

568
00:26:26,510 --> 00:26:29,710
an<font color="#E5E5E5"> everyday basis</font>

569
00:26:30,870 --> 00:26:36,000
access check<font color="#E5E5E5"> we have two</font><font color="#CCCCCC"> here the next</font>

570
00:26:33,720 --> 00:26:38,250
<font color="#CCCCCC">ones</font><font color="#E5E5E5"> access</font><font color="#CCCCCC"> a new access check those are</font>

571
00:26:36,000 --> 00:26:42,450
two tools<font color="#E5E5E5"> that will kind of scour</font>

572
00:26:38,250 --> 00:26:45,090
through<font color="#E5E5E5"> file shares and tell you where a</font>

573
00:26:42,450 --> 00:26:48,510
user has access<font color="#E5E5E5"> and what type of access</font>

574
00:26:45,090 --> 00:26:51,470
<font color="#CCCCCC">write access read access execute etc so</font>

575
00:26:48,510 --> 00:26:55,560
access check is a<font color="#CCCCCC"> command-line</font><font color="#E5E5E5"> tool and</font>

576
00:26:51,470 --> 00:26:57,120
it's really<font color="#E5E5E5"> helpful</font><font color="#CCCCCC"> to when you're</font>

577
00:26:55,560 --> 00:27:00,659
looking when you're looking<font color="#E5E5E5"> through</font><font color="#CCCCCC"> the</font>

578
00:26:57,120 --> 00:27:03,510
<font color="#E5E5E5">network and</font><font color="#CCCCCC"> you need to find where where</font>

579
00:27:00,660 --> 00:27:05,430
you might have<font color="#CCCCCC"> read access</font><font color="#E5E5E5"> for one but I</font>

580
00:27:03,510 --> 00:27:08,250
use<font color="#E5E5E5"> it more often when I'm looking</font><font color="#CCCCCC"> for</font>

581
00:27:05,430 --> 00:27:10,410
where I can<font color="#E5E5E5"> write so because though</font>

582
00:27:08,250 --> 00:27:12,390
those<font color="#CCCCCC"> are fewer and</font><font color="#E5E5E5"> far between and to</font>

583
00:27:10,410 --> 00:27:14,760
do that manually it's very very tedious

584
00:27:12,390 --> 00:27:16,320
<font color="#E5E5E5">so you have you</font><font color="#CCCCCC"> know you</font><font color="#E5E5E5"> have some file</font>

585
00:27:14,760 --> 00:27:18,330
shares you<font color="#CCCCCC"> have access to and you just</font>

586
00:27:16,320 --> 00:27:20,550
<font color="#CCCCCC">feed that to access check</font><font color="#E5E5E5"> and you say</font>

587
00:27:18,330 --> 00:27:22,470
hey where do I have<font color="#E5E5E5"> write access</font><font color="#CCCCCC"> and it</font>

588
00:27:20,550 --> 00:27:24,060
goes out and<font color="#E5E5E5"> it hunts and it really puts</font>

589
00:27:22,470 --> 00:27:27,830
back to you here's where you<font color="#CCCCCC"> have read</font>

590
00:27:24,060 --> 00:27:30,750
access<font color="#CCCCCC"> it's really really nice</font><font color="#E5E5E5"> to use</font>

591
00:27:27,830 --> 00:27:33,030
and the use<font color="#E5E5E5"> case on the slide is for</font>

592
00:27:30,750 --> 00:27:34,890
privilege escalation<font color="#CCCCCC"> I can</font><font color="#E5E5E5"> look at</font>

593
00:27:33,030 --> 00:27:37,260
particular services installed on a

594
00:27:34,890 --> 00:27:40,920
<font color="#CCCCCC">machine I</font><font color="#E5E5E5"> can evaluate what permissions</font>

595
00:27:37,260 --> 00:27:43,650
I have over that service<font color="#E5E5E5"> find out where</font>

596
00:27:40,920 --> 00:27:45,450
the service binary is look at NTFS

597
00:27:43,650 --> 00:27:49,110
permissions associated with it and see

598
00:27:45,450 --> 00:27:51,420
if I can<font color="#CCCCCC"> trojan eyes</font><font color="#E5E5E5"> and executable to</font>

599
00:27:49,110 --> 00:27:54,090
put to replace that service or escalate

600
00:27:51,420 --> 00:27:57,090
<font color="#CCCCCC">that</font><font color="#E5E5E5"> your privilege on the box again a</font>

601
00:27:54,090 --> 00:28:00,240
little bit more manual than say<font color="#CCCCCC"> powerup</font>

602
00:27:57,090 --> 00:28:02,189
<font color="#E5E5E5">but it's still a great way</font><font color="#CCCCCC"> to do do</font><font color="#E5E5E5"> this</font>

603
00:28:00,240 --> 00:28:04,950
sort<font color="#E5E5E5"> of thing when you can't run power</font>

604
00:28:02,190 --> 00:28:09,120
to<font color="#E5E5E5"> power up you can't run PowerShell</font><font color="#CCCCCC"> or</font>

605
00:28:04,950 --> 00:28:11,970
you can't you know natively execute the

606
00:28:09,120 --> 00:28:19,169
tools<font color="#E5E5E5"> that you want to use in a target</font>

607
00:28:11,970 --> 00:28:22,110
environment access enum does very

608
00:28:19,170 --> 00:28:24,390
similar activity except it's got<font color="#CCCCCC"> a nice</font>

609
00:28:22,110 --> 00:28:26,580
<font color="#E5E5E5">GUI on the front end</font><font color="#CCCCCC"> so if I can't</font>

610
00:28:24,390 --> 00:28:29,490
access<font color="#CCCCCC"> the command prompt I can't access</font>

611
00:28:26,580 --> 00:28:31,770
PowerShell<font color="#CCCCCC"> Daxi I can still run</font>

612
00:28:29,490 --> 00:28:35,420
something<font color="#E5E5E5"> like this and point it at</font><font color="#CCCCCC"> the</font>

613
00:28:31,770 --> 00:28:37,740
<font color="#E5E5E5">network to see where</font><font color="#CCCCCC"> can I write data</font>

614
00:28:35,420 --> 00:28:39,630
<font color="#E5E5E5">one of the really great amplifier</font>

615
00:28:37,740 --> 00:28:42,510
attacks that<font color="#E5E5E5"> we use all the</font><font color="#CCCCCC"> time is to</font>

616
00:28:39,630 --> 00:28:44,090
<font color="#E5E5E5">write a shortcut or a malicious shortcut</font>

617
00:28:42,510 --> 00:28:48,110
that points<font color="#CCCCCC"> back to</font><font color="#E5E5E5"> our machines</font>

618
00:28:44,090 --> 00:28:51,649
we can gather creds<font color="#E5E5E5"> and</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> tread</font><font color="#CCCCCC"> it</font>

619
00:28:48,110 --> 00:28:54,080
<font color="#CCCCCC">yeah and try to crack hashes</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> this</font>

620
00:28:51,650 --> 00:28:56,179
allows you<font color="#E5E5E5"> to identify those writable</font>

621
00:28:54,080 --> 00:29:00,408
locations<font color="#E5E5E5"> then you can drop your</font>

622
00:28:56,179 --> 00:29:03,340
malicious<font color="#CCCCCC"> L&K file entice users to you</font>

623
00:29:00,409 --> 00:29:06,020
know<font color="#E5E5E5"> just browse to</font><font color="#CCCCCC"> that location</font><font color="#E5E5E5"> and</font>

624
00:29:03,340 --> 00:29:10,908
see if you can gather hashes to<font color="#E5E5E5"> crack</font>

625
00:29:06,020 --> 00:29:12,710
<font color="#CCCCCC">mm-hmm access Inu can also scan the</font>

626
00:29:10,909 --> 00:29:15,650
registry<font color="#E5E5E5"> for where you might have</font><font color="#CCCCCC"> right</font>

627
00:29:12,710 --> 00:29:20,929
<font color="#E5E5E5">access in there so I haven't used that</font>

628
00:29:15,650 --> 00:29:24,289
in that regard<font color="#E5E5E5"> but it can do that ad</font>

629
00:29:20,929 --> 00:29:26,270
restore Active Directory restore<font color="#CCCCCC"> there's</font>

630
00:29:24,289 --> 00:29:29,299
when you delete an object<font color="#E5E5E5"> from Active</font>

631
00:29:26,270 --> 00:29:31,070
Directory<font color="#E5E5E5"> it does it get tombstone right</font>

632
00:29:29,299 --> 00:29:32,929
away or after a<font color="#E5E5E5"> certain amount of time</font>

633
00:29:31,070 --> 00:29:35,389
but there's there's something<font color="#E5E5E5"> called a</font>

634
00:29:32,929 --> 00:29:38,929
<font color="#E5E5E5">tombstone object in Active Directory so</font>

635
00:29:35,390 --> 00:29:40,610
it's basically it's it's not functional

636
00:29:38,929 --> 00:29:43,909
anymore but it's still<font color="#CCCCCC"> there but ad</font>

637
00:29:40,610 --> 00:29:48,889
restore can resurrect<font color="#E5E5E5"> objects in Active</font>

638
00:29:43,909 --> 00:29:52,730
Directory<font color="#E5E5E5"> so you could enable or</font>

639
00:29:48,890 --> 00:29:55,520
resurrect<font color="#E5E5E5"> an account</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> was previously</font>

640
00:29:52,730 --> 00:29:58,070
deleted<font color="#E5E5E5"> in order to reuse that you'd</font>

641
00:29:55,520 --> 00:29:59,570
have<font color="#E5E5E5"> to reset the</font><font color="#CCCCCC"> password and</font><font color="#E5E5E5"> then</font><font color="#CCCCCC"> you</font>

642
00:29:58,070 --> 00:30:01,580
could use that<font color="#E5E5E5"> account why would you</font>

643
00:29:59,570 --> 00:30:03,049
want<font color="#E5E5E5"> to do that I mean you need domain</font>

644
00:30:01,580 --> 00:30:04,908
admin to do that so if you already have

645
00:30:03,049 --> 00:30:07,549
domain admin why in the world would<font color="#CCCCCC"> you</font>

646
00:30:04,909 --> 00:30:09,770
bother<font color="#CCCCCC"> but it might be something worth</font>

647
00:30:07,549 --> 00:30:12,440
trying<font color="#CCCCCC"> to cover</font><font color="#E5E5E5"> your tracks to use an</font>

648
00:30:09,770 --> 00:30:14,990
<font color="#E5E5E5">account that existed at one point and</font>

649
00:30:12,440 --> 00:30:18,740
might not trip an alarm<font color="#E5E5E5"> if you create a</font>

650
00:30:14,990 --> 00:30:21,230
<font color="#E5E5E5">new</font><font color="#CCCCCC"> account</font><font color="#E5E5E5"> or it's just one</font><font color="#CCCCCC"> of the many</font>

651
00:30:18,740 --> 00:30:23,330
<font color="#CCCCCC">options that</font><font color="#E5E5E5"> might be</font><font color="#CCCCCC"> a way to cover</font>

652
00:30:21,230 --> 00:30:26,059
your<font color="#CCCCCC"> tracks on the system but it does</font>

653
00:30:23,330 --> 00:30:29,360
require<font color="#CCCCCC"> domain admin on many engagements</font>

654
00:30:26,059 --> 00:30:31,450
once we escalate the domain admin we

655
00:30:29,360 --> 00:30:33,949
typically test

656
00:30:31,450 --> 00:30:35,929
<font color="#CCCCCC">detective capabilities to identify</font>

657
00:30:33,950 --> 00:30:40,520
whether the<font color="#CCCCCC"> organization can see us</font><font color="#E5E5E5"> add</font>

658
00:30:35,929 --> 00:30:43,159
a new admin or or manipulate domain

659
00:30:40,520 --> 00:30:44,990
admins<font color="#CCCCCC"> the enterprise admins group</font><font color="#E5E5E5"> and</font>

660
00:30:43,159 --> 00:30:47,809
this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> a great way to test that</font>

661
00:30:44,990 --> 00:30:50,630
manipulation<font color="#CCCCCC"> so when</font><font color="#E5E5E5"> I decommission my</font>

662
00:30:47,809 --> 00:30:52,129
accounts<font color="#CCCCCC"> what's my process do I remove</font>

663
00:30:50,630 --> 00:30:54,440
<font color="#E5E5E5">all the group memberships before I</font>

664
00:30:52,130 --> 00:30:57,140
delete<font color="#CCCCCC"> that account</font><font color="#E5E5E5"> when it gets</font>

665
00:30:54,440 --> 00:30:57,980
tombstone can<font color="#CCCCCC"> I resurrect that account</font>

666
00:30:57,140 --> 00:31:01,250
with<font color="#CCCCCC"> all of</font><font color="#E5E5E5"> those</font>

667
00:30:57,980 --> 00:31:05,120
memberships still in place<font color="#E5E5E5"> and now does</font>

668
00:31:01,250 --> 00:31:06,710
<font color="#CCCCCC">your instrumentation</font><font color="#E5E5E5"> still work maybe a</font>

669
00:31:05,120 --> 00:31:08,689
<font color="#E5E5E5">month ago we had an engagement where</font><font color="#CCCCCC"> we</font>

670
00:31:06,710 --> 00:31:11,149
were<font color="#E5E5E5"> doing</font><font color="#CCCCCC"> exactly that we found a</font>

671
00:31:08,690 --> 00:31:13,519
decommissioned<font color="#CCCCCC"> domain admin account</font><font color="#E5E5E5"> we</font>

672
00:31:11,149 --> 00:31:15,949
<font color="#E5E5E5">just reenable dit change the password</font>

673
00:31:13,519 --> 00:31:18,230
and nobody ever<font color="#E5E5E5"> saw</font><font color="#CCCCCC"> anything</font><font color="#E5E5E5"> but when we</font>

674
00:31:15,950 --> 00:31:21,500
<font color="#E5E5E5">put a new domain admin into the domain</font>

675
00:31:18,230 --> 00:31:23,299
admins group<font color="#E5E5E5"> they saw it so this is</font>

676
00:31:21,500 --> 00:31:25,610
<font color="#E5E5E5">another thing to</font><font color="#CCCCCC"> think about</font><font color="#E5E5E5"> you know</font>

677
00:31:23,299 --> 00:31:28,309
what's<font color="#E5E5E5"> your decommissioning process and</font>

678
00:31:25,610 --> 00:31:34,039
how can<font color="#E5E5E5"> I get</font><font color="#CCCCCC"> around</font><font color="#E5E5E5"> that from a</font>

679
00:31:28,309 --> 00:31:38,750
detective capability the last one<font color="#E5E5E5"> that</font>

680
00:31:34,039 --> 00:31:41,809
we have<font color="#E5E5E5"> is EFS dump</font><font color="#CCCCCC"> so EFS is old</font><font color="#E5E5E5"> but it</font>

681
00:31:38,750 --> 00:31:45,529
is<font color="#CCCCCC"> still</font><font color="#E5E5E5"> supported and it may be useful</font>

682
00:31:41,809 --> 00:31:47,510
to find EFS<font color="#E5E5E5"> encrypted files and</font>

683
00:31:45,529 --> 00:31:49,130
directories on the network because

684
00:31:47,510 --> 00:31:52,760
typically they're gonna have something

685
00:31:49,130 --> 00:31:55,970
<font color="#CCCCCC">in them that</font><font color="#E5E5E5"> someone at some</font><font color="#CCCCCC"> point did</font>

686
00:31:52,760 --> 00:31:59,330
not intend you<font color="#CCCCCC"> to get at so what's</font><font color="#E5E5E5"> nice</font>

687
00:31:55,970 --> 00:32:01,549
about EFS dump<font color="#E5E5E5"> is it can tell you who</font>

688
00:31:59,330 --> 00:32:03,860
has permissions to open<font color="#E5E5E5"> those particular</font>

689
00:32:01,549 --> 00:32:07,668
files and then<font color="#CCCCCC"> you can take a look at</font>

690
00:32:03,860 --> 00:32:09,260
whether you<font color="#E5E5E5"> can get into</font><font color="#CCCCCC"> that context</font>

691
00:32:07,669 --> 00:32:12,529
and then get at those particular

692
00:32:09,260 --> 00:32:15,139
protected files<font color="#E5E5E5"> it also kind of</font>

693
00:32:12,529 --> 00:32:18,080
indicates where<font color="#CCCCCC"> the sensitive data might</font>

694
00:32:15,139 --> 00:32:20,120
be<font color="#CCCCCC"> so even if you</font><font color="#E5E5E5"> find it you you might</font>

695
00:32:18,080 --> 00:32:22,428
<font color="#E5E5E5">be able to decrypt</font><font color="#CCCCCC"> the data to there's a</font>

696
00:32:20,120 --> 00:32:25,820
link<font color="#CCCCCC"> there</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> kind of shows</font><font color="#E5E5E5"> how you</font>

697
00:32:22,429 --> 00:32:28,159
<font color="#E5E5E5">can go about</font><font color="#CCCCCC"> that but if nothing else it</font>

698
00:32:25,820 --> 00:32:34,309
will tell you where sensitive data is

699
00:32:28,159 --> 00:32:37,970
which can<font color="#E5E5E5"> be helpful</font><font color="#CCCCCC"> too so we've</font><font color="#E5E5E5"> listed</font>

700
00:32:34,309 --> 00:32:40,340
there like I<font color="#E5E5E5"> said</font><font color="#CCCCCC"> 126</font><font color="#E5E5E5"> different tools in</font>

701
00:32:37,970 --> 00:32:42,710
<font color="#E5E5E5">the suite and we've listed some</font><font color="#CCCCCC"> of them</font>

702
00:32:40,340 --> 00:32:48,260
here<font color="#CCCCCC"> in</font><font color="#E5E5E5"> three</font><font color="#CCCCCC"> categories that</font><font color="#E5E5E5"> we think</font>

703
00:32:42,710 --> 00:32:50,240
are useful<font color="#E5E5E5"> as attackers</font><font color="#CCCCCC"> there may be</font>

704
00:32:48,260 --> 00:32:52,149
other<font color="#E5E5E5"> uses</font><font color="#CCCCCC"> for others that we haven't</font>

705
00:32:50,240 --> 00:32:54,889
<font color="#E5E5E5">thought</font><font color="#CCCCCC"> about yet so if anybody knows</font>

706
00:32:52,149 --> 00:32:56,418
knows of uses for these tools<font color="#E5E5E5"> that we</font>

707
00:32:54,889 --> 00:32:58,908
<font color="#E5E5E5">haven't thought about we'd love to hear</font>

708
00:32:56,419 --> 00:33:01,929
<font color="#E5E5E5">about it</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> we've kind of categorized</font>

709
00:32:58,909 --> 00:33:04,639
them here for<font color="#CCCCCC"> you and recon and</font>

710
00:33:01,929 --> 00:33:07,970
privilege escalation and<font color="#E5E5E5"> then covering</font>

711
00:33:04,639 --> 00:33:11,059
<font color="#E5E5E5">your tracks and OPSEC here and the whole</font>

712
00:33:07,970 --> 00:33:13,120
idea<font color="#CCCCCC"> is as a thought</font><font color="#E5E5E5"> exercise</font>

713
00:33:11,059 --> 00:33:16,460
<font color="#E5E5E5">you know as an attacker this is great</font>

714
00:33:13,120 --> 00:33:19,340
<font color="#CCCCCC">because now I have</font><font color="#E5E5E5"> different options</font><font color="#CCCCCC"> for</font>

715
00:33:16,460 --> 00:33:21,499
<font color="#CCCCCC">living off the land</font><font color="#E5E5E5"> as a defender</font><font color="#CCCCCC"> you</font>

716
00:33:19,340 --> 00:33:22,970
have to think<font color="#E5E5E5"> about how you these things</font>

717
00:33:21,499 --> 00:33:24,590
are<font color="#E5E5E5"> sitting on the network who has</font>

718
00:33:22,970 --> 00:33:26,779
access to them where they<font color="#E5E5E5"> live at</font>

719
00:33:24,590 --> 00:33:29,629
whether you're deploying them to every

720
00:33:26,779 --> 00:33:32,360
machine<font color="#CCCCCC"> because now they become</font><font color="#E5E5E5"> a really</font>

721
00:33:29,629 --> 00:33:36,709
handy tool<font color="#CCCCCC"> for attackers to</font><font color="#E5E5E5"> use against</font>

722
00:33:32,360 --> 00:33:39,529
you<font color="#CCCCCC"> so hopefully</font><font color="#E5E5E5"> this is</font><font color="#CCCCCC"> illustrated the</font>

723
00:33:36,710 --> 00:33:41,720
power of the tool suite beyond just you

724
00:33:39,529 --> 00:33:43,460
<font color="#CCCCCC">know supporting system</font><font color="#E5E5E5"> administration as</font>

725
00:33:41,720 --> 00:33:45,889
an attacker I can use these things

726
00:33:43,460 --> 00:33:50,629
against you and it can<font color="#CCCCCC"> be</font><font color="#E5E5E5"> pretty</font>

727
00:33:45,889 --> 00:33:52,519
<font color="#CCCCCC">devastating pretty quickly</font><font color="#E5E5E5"> all right</font>

728
00:33:50,629 --> 00:33:55,240
does anybody have any<font color="#E5E5E5"> questions about</font>

729
00:33:52,519 --> 00:33:55,240
<font color="#E5E5E5">any of these</font>

730
00:34:13,399 --> 00:34:18,509
yeah good question<font color="#E5E5E5"> so the question</font><font color="#CCCCCC"> is</font>

731
00:34:15,899 --> 00:34:22,350
the<font color="#CCCCCC"> in AD</font><font color="#E5E5E5"> Explorer the user password</font>

732
00:34:18,510 --> 00:34:25,050
fields<font color="#E5E5E5"> do those exist by default in a</font>

733
00:34:22,350 --> 00:34:29,399
the ad<font color="#E5E5E5"> explorer kind of default schema</font>

734
00:34:25,050 --> 00:34:31,260
the the ones that we showed exist by

735
00:34:29,399 --> 00:34:32,460
default<font color="#E5E5E5"> I think</font><font color="#CCCCCC"> all of them exist by</font>

736
00:34:31,260 --> 00:34:35,970
default<font color="#E5E5E5"> that doesn't mean they're</font>

737
00:34:32,460 --> 00:34:38,580
populated<font color="#CCCCCC"> right</font><font color="#E5E5E5"> so admins have to go in</font>

738
00:34:35,969 --> 00:34:40,678
and populate those fields but the schema

739
00:34:38,580 --> 00:34:42,810
in<font color="#CCCCCC"> Active Directory is also expandable</font>

740
00:34:40,679 --> 00:34:45,600
<font color="#E5E5E5">so there could be custom attributes as</font>

741
00:34:42,810 --> 00:34:48,090
<font color="#CCCCCC">well that stores similar information</font>

742
00:34:45,600 --> 00:34:53,360
another attribute<font color="#E5E5E5"> that we've typically</font>

743
00:34:48,090 --> 00:35:00,870
been checking is the what is it MS

744
00:34:53,360 --> 00:35:03,600
it's the<font color="#CCCCCC"> Labs labs password field yeah</font>

745
00:35:00,870 --> 00:35:05,520
so when you enable<font color="#CCCCCC"> Ops</font><font color="#E5E5E5"> those passwords</font>

746
00:35:03,600 --> 00:35:07,980
<font color="#E5E5E5">get stored in Active Directory in plain</font>

747
00:35:05,520 --> 00:35:10,800
text you can delegate who has the

748
00:35:07,980 --> 00:35:14,870
ability<font color="#CCCCCC"> to read those passwords well if</font>

749
00:35:10,800 --> 00:35:18,480
I if if you set<font color="#CCCCCC"> up</font><font color="#E5E5E5"> your delegation wrong</font>

750
00:35:14,870 --> 00:35:20,850
<font color="#E5E5E5">then I might any user might be able to</font>

751
00:35:18,480 --> 00:35:22,770
see them if I hit the right<font color="#E5E5E5"> user account</font>

752
00:35:20,850 --> 00:35:24,990
<font color="#CCCCCC">I</font><font color="#E5E5E5"> might be able</font><font color="#CCCCCC"> to see them</font><font color="#E5E5E5"> and it's an</font>

753
00:35:22,770 --> 00:35:27,270
easy way to pivot across the network

754
00:35:24,990 --> 00:35:29,129
because now<font color="#CCCCCC"> I know all the all the local</font>

755
00:35:27,270 --> 00:35:33,120
admin passwords despite them being

756
00:35:29,130 --> 00:35:36,930
<font color="#E5E5E5">randomized</font><font color="#CCCCCC"> in addition a lot of the the</font>

757
00:35:33,120 --> 00:35:39,480
fields that that we mentioned are not by

758
00:35:36,930 --> 00:35:42,109
default<font color="#E5E5E5"> readable by anybody in the</font>

759
00:35:39,480 --> 00:35:46,100
schema<font color="#CCCCCC"> the user password password</font><font color="#E5E5E5"> one</font>

760
00:35:42,110 --> 00:35:50,640
<font color="#E5E5E5">I've seen</font><font color="#CCCCCC"> it as a standard domain user</font>

761
00:35:46,100 --> 00:35:53,970
every time that<font color="#CCCCCC"> I've found</font><font color="#E5E5E5"> it</font><font color="#CCCCCC"> but other</font>

762
00:35:50,640 --> 00:35:57,210
fields<font color="#E5E5E5"> are only</font><font color="#CCCCCC"> only populated</font><font color="#E5E5E5"> for read</font>

763
00:35:53,970 --> 00:35:59,490
access<font color="#CCCCCC"> by certain privilege levels</font><font color="#E5E5E5"> but</font>

764
00:35:57,210 --> 00:36:01,680
<font color="#E5E5E5">the idea</font><font color="#CCCCCC"> here is well if somebody's</font>

765
00:35:59,490 --> 00:36:03,779
<font color="#E5E5E5">active directory is messed up and the</font>

766
00:36:01,680 --> 00:36:05,879
permissions allow<font color="#E5E5E5"> me to read them I want</font>

767
00:36:03,780 --> 00:36:08,940
<font color="#E5E5E5">to let them know because</font><font color="#CCCCCC"> they need to</font>

768
00:36:05,880 --> 00:36:11,310
<font color="#E5E5E5">fix that situation yeah I found recently</font>

769
00:36:08,940 --> 00:36:13,920
<font color="#E5E5E5">in the comment we mentioned earlier</font>

770
00:36:11,310 --> 00:36:17,130
<font color="#E5E5E5">comma comment info description those</font>

771
00:36:13,920 --> 00:36:19,470
fields I found a comment that said the

772
00:36:17,130 --> 00:36:22,400
<font color="#CCCCCC">password for this account is and it said</font>

773
00:36:19,470 --> 00:36:26,419
the password<font color="#CCCCCC"> don't</font><font color="#E5E5E5"> change this or</font>

774
00:36:22,400 --> 00:36:28,099
the application will break yeah<font color="#CCCCCC"> anybody</font>

775
00:36:26,420 --> 00:36:31,220
<font color="#CCCCCC">in</font><font color="#E5E5E5"> Active Directory can read that yeah</font>

776
00:36:28,099 --> 00:36:32,990
<font color="#E5E5E5">anybody</font><font color="#CCCCCC"> can read that</font><font color="#E5E5E5"> but many admins</font>

777
00:36:31,220 --> 00:36:36,259
don't know that everyone can read that

778
00:36:32,990 --> 00:36:37,788
they don't<font color="#E5E5E5"> realize that so</font><font color="#CCCCCC"> but that's</font>

779
00:36:36,260 --> 00:36:40,099
<font color="#E5E5E5">why we're telling you about it so you</font>

780
00:36:37,789 --> 00:36:51,380
know<font color="#E5E5E5"> anybody can see that</font>

781
00:36:40,099 --> 00:36:54,380
other questions<font color="#E5E5E5"> yes</font><font color="#CCCCCC"> sir so the question</font>

782
00:36:51,380 --> 00:36:55,970
<font color="#E5E5E5">was whether or not the user admin being</font>

783
00:36:54,380 --> 00:36:59,869
<font color="#E5E5E5">populated is that something</font><font color="#CCCCCC"> that an</font>

784
00:36:55,970 --> 00:37:03,439
admin has to<font color="#E5E5E5"> actually type in usually</font>

785
00:36:59,869 --> 00:37:05,510
it's some application that needs<font color="#E5E5E5"> legacy</font>

786
00:37:03,440 --> 00:37:09,789
authentication<font color="#E5E5E5"> support that plops it in</font>

787
00:37:05,510 --> 00:37:12,740
there itself<font color="#E5E5E5"> when it's</font><font color="#CCCCCC"> installed and</font><font color="#E5E5E5"> on</font>

788
00:37:09,789 --> 00:37:16,670
100%<font color="#E5E5E5"> of the occasions that we found it</font><font color="#CCCCCC"> I</font>

789
00:37:12,740 --> 00:37:18,229
go back to the<font color="#E5E5E5"> POC and I say hey we</font>

790
00:37:16,670 --> 00:37:20,599
found this in Active Directory we were

791
00:37:18,230 --> 00:37:22,309
<font color="#CCCCCC">able to use this credential you know</font>

792
00:37:20,599 --> 00:37:25,339
it's sitting out<font color="#E5E5E5"> there for</font><font color="#CCCCCC"> anyone to</font>

793
00:37:22,309 --> 00:37:29,510
<font color="#E5E5E5">read and they go well how did that get</font>

794
00:37:25,339 --> 00:37:32,538
<font color="#CCCCCC">there and I never set that password</font><font color="#E5E5E5"> but</font>

795
00:37:29,510 --> 00:37:34,849
it they are valid credentials<font color="#CCCCCC"> so it's</font>

796
00:37:32,539 --> 00:37:36,740
it's a great<font color="#E5E5E5"> thing to look for and a</font>

797
00:37:34,849 --> 00:37:40,059
great thing<font color="#E5E5E5"> to hunt down because like</font>

798
00:37:36,740 --> 00:37:42,529
Sally and I have done some<font color="#E5E5E5"> research on</font>

799
00:37:40,059 --> 00:37:45,650
<font color="#E5E5E5">reversible encryption there are</font>

800
00:37:42,529 --> 00:37:47,660
conditions<font color="#E5E5E5"> where Active Directory will</font>

801
00:37:45,650 --> 00:37:49,609
<font color="#E5E5E5">store a password with reversible</font>

802
00:37:47,660 --> 00:37:56,868
encryption despite you not selecting the

803
00:37:49,609 --> 00:37:58,848
reversible encryption checkbox or if

804
00:37:56,869 --> 00:38:02,390
you're doing<font color="#E5E5E5"> web authentication that</font>

805
00:37:58,849 --> 00:38:06,020
<font color="#CCCCCC">require</font><font color="#E5E5E5"> letting legacy</font><font color="#CCCCCC"> farm SSO and and</font>

806
00:38:02,390 --> 00:38:08,450
it requires legacy protocol support it's

807
00:38:06,020 --> 00:38:11,420
crazy<font color="#CCCCCC"> because we wouldn't expect</font><font color="#E5E5E5"> it to</font>

808
00:38:08,450 --> 00:38:14,419
<font color="#E5E5E5">work that</font><font color="#CCCCCC"> way and you know explaining</font><font color="#E5E5E5"> it</font>

809
00:38:11,420 --> 00:38:15,980
to<font color="#CCCCCC"> a customer and saying hey we found a</font>

810
00:38:14,420 --> 00:38:18,440
lot of reversible encryption in your

811
00:38:15,980 --> 00:38:20,480
environment<font color="#E5E5E5"> well we don't do that</font><font color="#CCCCCC"> why is</font>

812
00:38:18,440 --> 00:38:22,160
<font color="#E5E5E5">it set up that way exactly what happened</font>

813
00:38:20,480 --> 00:38:25,039
<font color="#E5E5E5">to me recently and I extracted all the</font>

814
00:38:22,160 --> 00:38:27,288
hashes<font color="#E5E5E5"> and I submitted it to hash cat in</font>

815
00:38:25,039 --> 00:38:31,730
about two minutes<font color="#E5E5E5"> later</font><font color="#CCCCCC"> ninety-eight</font>

816
00:38:27,289 --> 00:38:34,130
<font color="#CCCCCC">percent of</font><font color="#E5E5E5"> all like</font><font color="#CCCCCC"> 6000</font><font color="#E5E5E5"> accounts the</font>

817
00:38:31,730 --> 00:38:35,960
passwords had cracked<font color="#E5E5E5"> and I said this is</font>

818
00:38:34,130 --> 00:38:37,460
<font color="#CCCCCC">not possible something</font><font color="#E5E5E5"> went wrong</font>

819
00:38:35,960 --> 00:38:39,170
and it was because they were all stored

820
00:38:37,460 --> 00:38:42,170
<font color="#E5E5E5">in reversible encryption and there were</font>

821
00:38:39,170 --> 00:38:44,510
128 character passwords in there for

822
00:38:42,170 --> 00:38:46,220
service accounts so you<font color="#E5E5E5"> got a</font><font color="#CCCCCC"> really</font>

823
00:38:44,510 --> 00:38:48,470
look at those third-party<font color="#E5E5E5"> applications</font>

824
00:38:46,220 --> 00:38:51,109
<font color="#E5E5E5">and do your own auditing of Active</font>

825
00:38:48,470 --> 00:38:52,370
Directory to make sure that<font color="#E5E5E5"> you're that</font>

826
00:38:51,110 --> 00:38:54,920
you're<font color="#E5E5E5"> not seeing those</font><font color="#CCCCCC"> attributes</font>

827
00:38:52,370 --> 00:38:57,440
populated if you do see them test them

828
00:38:54,920 --> 00:39:00,890
<font color="#CCCCCC">make</font><font color="#E5E5E5"> sure that you know the</font><font color="#CCCCCC"> value that's</font>

829
00:38:57,440 --> 00:39:06,740
<font color="#E5E5E5">stored in there I've seen engagements</font>

830
00:39:00,890 --> 00:39:11,930
where<font color="#CCCCCC"> the its Unicode PWD</font><font color="#E5E5E5"> field</font><font color="#CCCCCC"> Bay 64</font>

831
00:39:06,740 --> 00:39:14,990
encoded binary information<font color="#CCCCCC"> so a hashed</font>

832
00:39:11,930 --> 00:39:17,930
representation of the password that's

833
00:39:14,990 --> 00:39:20,029
not as<font color="#CCCCCC"> much of an issue but I can still</font>

834
00:39:17,930 --> 00:39:22,190
crack<font color="#E5E5E5"> whatever value is in there if I</font>

835
00:39:20,030 --> 00:39:26,620
<font color="#E5E5E5">can figure out how it's been hashed how</font>

836
00:39:22,190 --> 00:39:29,210
many<font color="#CCCCCC"> rounds so if there is some risk</font>

837
00:39:26,620 --> 00:39:30,890
<font color="#E5E5E5">what I like too</font><font color="#CCCCCC"> is when you find when</font>

838
00:39:29,210 --> 00:39:34,190
<font color="#CCCCCC">you look through there for passwords and</font>

839
00:39:30,890 --> 00:39:35,509
you look at maybe executives password

840
00:39:34,190 --> 00:39:37,420
fields the user account control

841
00:39:35,510 --> 00:39:40,100
attribute we were talking about<font color="#E5E5E5"> earlier</font>

842
00:39:37,420 --> 00:39:42,950
<font color="#E5E5E5">password never expires password hasn't</font>

843
00:39:40,100 --> 00:39:44,779
been changed<font color="#E5E5E5"> in five years because they</font>

844
00:39:42,950 --> 00:39:46,970
have<font color="#E5E5E5"> special exceptions for them but</font>

845
00:39:44,780 --> 00:39:49,280
<font color="#E5E5E5">that also means their passwords probably</font>

846
00:39:46,970 --> 00:40:01,430
<font color="#E5E5E5">aren't nearly as</font><font color="#CCCCCC"> strong</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> it makes it</font>

847
00:39:49,280 --> 00:40:03,800
for easy targeting the recommendation

848
00:40:01,430 --> 00:40:05,899
for reversible encryption<font color="#CCCCCC"> that's</font><font color="#E5E5E5"> a great</font>

849
00:40:03,800 --> 00:40:09,770
<font color="#E5E5E5">question</font><font color="#CCCCCC"> because we</font><font color="#E5E5E5"> haven't we haven't</font>

850
00:40:05,900 --> 00:40:13,250
drilled down<font color="#CCCCCC"> too far</font><font color="#E5E5E5"> enough to find to</font>

851
00:40:09,770 --> 00:40:16,730
figure out why<font color="#E5E5E5"> so we've got like if you</font>

852
00:40:13,250 --> 00:40:18,680
look at the<font color="#E5E5E5"> test en documentation for</font>

853
00:40:16,730 --> 00:40:21,470
each<font color="#E5E5E5"> of these attributes</font><font color="#CCCCCC"> it's like one</font>

854
00:40:18,680 --> 00:40:23,390
sentence<font color="#CCCCCC"> and it doesn't describe the use</font>

855
00:40:21,470 --> 00:40:26,029
cases where one of<font color="#E5E5E5"> them might be</font>

856
00:40:23,390 --> 00:40:29,180
populated so it's really hard<font color="#E5E5E5"> to</font><font color="#CCCCCC"> run</font><font color="#E5E5E5"> it</font>

857
00:40:26,030 --> 00:40:32,360
<font color="#CCCCCC">down but you know</font><font color="#E5E5E5"> like reversible</font>

858
00:40:29,180 --> 00:40:34,100
encryption if you can<font color="#CCCCCC"> avoid</font><font color="#E5E5E5"> it you</font>

859
00:40:32,360 --> 00:40:35,360
<font color="#CCCCCC">definitely should because if somebody</font>

860
00:40:34,100 --> 00:40:39,110
can dump your<font color="#E5E5E5"> hashes they're gonna have</font>

861
00:40:35,360 --> 00:40:42,650
passwords in a couple of seconds<font color="#CCCCCC"> but I</font>

862
00:40:39,110 --> 00:40:44,060
would say<font color="#E5E5E5"> audit for all of these</font>

863
00:40:42,650 --> 00:40:45,830
attributes<font color="#CCCCCC"> and just make sure that</font>

864
00:40:44,060 --> 00:40:48,650
<font color="#E5E5E5">people who shouldn't be able to read</font>

865
00:40:45,830 --> 00:40:49,759
them can't read them<font color="#CCCCCC"> or that</font><font color="#E5E5E5"> they're</font><font color="#CCCCCC"> not</font>

866
00:40:48,650 --> 00:40:51,350
populated<font color="#E5E5E5"> or</font>

867
00:40:49,760 --> 00:41:00,620
you can control<font color="#E5E5E5"> whether they stay</font>

868
00:40:51,350 --> 00:41:05,660
<font color="#E5E5E5">populated so yeah user password UNIX</font>

869
00:41:00,620 --> 00:41:08,690
user password<font color="#E5E5E5"> Unicode PWD</font><font color="#CCCCCC"> comment</font><font color="#E5E5E5"> and</font>

870
00:41:05,660 --> 00:41:12,859
description for<font color="#E5E5E5"> sure because you know</font>

871
00:41:08,690 --> 00:41:18,020
the<font color="#E5E5E5"> helpdesk can populate those and</font><font color="#CCCCCC"> MSS</font>

872
00:41:12,860 --> 00:41:21,050
EV<font color="#E5E5E5"> you 30 password so MSS fu 30 is an</font>

873
00:41:18,020 --> 00:41:23,180
LDAP integration<font color="#CCCCCC"> field so if you're not</font>

874
00:41:21,050 --> 00:41:30,130
<font color="#E5E5E5">doing</font><font color="#CCCCCC"> that sort of thing</font><font color="#E5E5E5"> that attribute</font>

875
00:41:23,180 --> 00:41:33,290
might not show<font color="#CCCCCC"> up and what</font><font color="#E5E5E5"> you can do is</font>

876
00:41:30,130 --> 00:41:35,210
as part<font color="#E5E5E5"> of your audit extract all</font><font color="#CCCCCC"> the</font>

877
00:41:33,290 --> 00:41:38,390
hashes from Active Directory and try to

878
00:41:35,210 --> 00:41:40,820
crack them as opposed to<font color="#E5E5E5"> looking at</font>

879
00:41:38,390 --> 00:41:42,950
settings<font color="#CCCCCC"> try to crack them</font><font color="#E5E5E5"> see see how</font>

880
00:41:40,820 --> 00:41:45,320
<font color="#E5E5E5">that works do we see reduce do we have a</font>

881
00:41:42,950 --> 00:41:48,049
blog on how<font color="#CCCCCC"> to do that do you</font><font color="#E5E5E5"> know yet</font>

882
00:41:45,320 --> 00:41:51,050
<font color="#CCCCCC">Canton yeah</font><font color="#E5E5E5"> Ken Jordan did a blog post</font>

883
00:41:48,050 --> 00:41:53,000
<font color="#CCCCCC">on dumping domain hashes and using hash</font>

884
00:41:51,050 --> 00:41:54,920
cat to crack<font color="#CCCCCC"> them</font><font color="#E5E5E5"> okay if you've got</font>

885
00:41:53,000 --> 00:41:57,920
reversible encryption<font color="#E5E5E5"> you're gonna know</font>

886
00:41:54,920 --> 00:41:59,870
it<font color="#E5E5E5"> because hash</font><font color="#CCCCCC"> cat produces several</font>

887
00:41:57,920 --> 00:42:02,240
<font color="#E5E5E5">different output files one of them is</font>

888
00:41:59,870 --> 00:42:11,870
clear text passwords<font color="#E5E5E5"> and if you see that</font>

889
00:42:02,240 --> 00:42:14,109
you're<font color="#CCCCCC"> like what yeah game over anything</font>

890
00:42:11,870 --> 00:42:14,109
<font color="#CCCCCC">else</font>

891
00:42:18,270 --> 00:42:24,840
going once<font color="#E5E5E5"> going twice</font><font color="#CCCCCC"> alright</font><font color="#E5E5E5"> well</font>

892
00:42:22,830 --> 00:42:27,799
thank<font color="#E5E5E5"> you everybody for staying so late</font>

893
00:42:24,840 --> 00:42:27,800
<font color="#E5E5E5">we appreciate it</font>

