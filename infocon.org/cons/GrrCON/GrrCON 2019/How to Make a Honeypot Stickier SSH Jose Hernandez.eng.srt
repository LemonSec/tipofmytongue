1
00:00:00,000 --> 00:00:06,839
30 time period today I have the pleasure

2
00:00:03,570 --> 00:00:07,890
of introducing Jose Hernandez he's from

3
00:00:06,839 --> 00:00:13,110
boom

4
00:00:07,890 --> 00:00:14,580
you guys don't say like that though this

5
00:00:13,110 --> 00:00:17,038
plug security research team he's going

6
00:00:14,580 --> 00:00:18,750
to talk to you about honey pots and how

7
00:00:17,039 --> 00:00:20,279
to make them stickier and probably

8
00:00:18,750 --> 00:00:27,439
collect a lot of really cool data from

9
00:00:20,279 --> 00:00:27,439
attacks sounds like a thing thank you oh

10
00:00:27,930 --> 00:00:33,480
[Applause]

11
00:00:29,869 --> 00:00:35,790
good afternoon everyone hope everybody's

12
00:00:33,480 --> 00:00:36,839
like poster like lunch coma at this

13
00:00:35,790 --> 00:00:38,550
point I had to like drink a ton of

14
00:00:36,840 --> 00:00:42,329
coffee because I was falling asleep but

15
00:00:38,550 --> 00:00:45,000
uh I I'm gonna talk to you a little bit

16
00:00:42,329 --> 00:00:47,160
about some lessons learned we had an in

17
00:00:45,000 --> 00:00:51,030
the research team at Splunk running

18
00:00:47,160 --> 00:00:52,288
honey pots on the wild and and what

19
00:00:51,030 --> 00:00:55,739
we're planning to do from there and

20
00:00:52,289 --> 00:00:57,629
maybe share some of this with you Nepali

21
00:00:55,739 --> 00:00:59,489
try to execute it on your own

22
00:00:57,629 --> 00:01:02,730
environment like this is this was pretty

23
00:00:59,489 --> 00:01:05,339
fun but just say why so I was gonna play

24
00:01:02,730 --> 00:01:08,000
an audio back from you guys I I got

25
00:01:05,339 --> 00:01:12,450
really annoyed I had my phone number for

26
00:01:08,000 --> 00:01:14,369
about 15 years now and I get spam calls

27
00:01:12,450 --> 00:01:15,509
I those appeareth on was getting spam

28
00:01:14,369 --> 00:01:16,740
coughs of spam because it got really

29
00:01:15,509 --> 00:01:18,689
annoyed I got this like global killer

30
00:01:16,740 --> 00:01:21,240
app it's garbage don't get it

31
00:01:18,689 --> 00:01:23,460
but it was really really fun for about

32
00:01:21,240 --> 00:01:26,009
two weeks because it would it plays back

33
00:01:23,460 --> 00:01:27,479
a recording of like of your choosing

34
00:01:26,009 --> 00:01:29,909
whatever recording and it the whole

35
00:01:27,479 --> 00:01:31,799
purpose of the app is to keep spammers

36
00:01:29,909 --> 00:01:33,509
on the phone listening to the recording

37
00:01:31,799 --> 00:01:34,740
that looks like an actual person that

38
00:01:33,509 --> 00:01:36,570
this sounds like an actual person having

39
00:01:34,740 --> 00:01:38,039
that conversation and then they record

40
00:01:36,570 --> 00:01:42,839
that interaction and you can play it

41
00:01:38,040 --> 00:01:44,549
back on your phone and so this if you

42
00:01:42,840 --> 00:01:46,649
can for human on the phone that a

43
00:01:44,549 --> 00:01:50,070
recording on the other end is an actual

44
00:01:46,649 --> 00:01:52,439
human it to me that's the perfect

45
00:01:50,070 --> 00:01:54,419
example the honey pots do work even in a

46
00:01:52,439 --> 00:01:56,339
human level right imagine when you're

47
00:01:54,420 --> 00:02:02,299
fooling machines probably can argue

48
00:01:56,340 --> 00:02:05,700
probably easier to some extent so but

49
00:02:02,299 --> 00:02:07,740
I'm not gonna play the audio I leave you

50
00:02:05,700 --> 00:02:09,090
guys up to if you guys wanna go I upload

51
00:02:07,740 --> 00:02:10,470
it or upload the slides afterwards you

52
00:02:09,090 --> 00:02:12,209
can play the audio from there it's

53
00:02:10,470 --> 00:02:13,650
pretty a little easy we don't have a mic

54
00:02:12,209 --> 00:02:16,920
here but

55
00:02:13,650 --> 00:02:20,220
for the audio quick rundown of the

56
00:02:16,920 --> 00:02:23,190
agenda you know introduce some some

57
00:02:20,220 --> 00:02:26,849
ideas and do this myself I share a

58
00:02:23,190 --> 00:02:28,410
little bit of what we saw the like what

59
00:02:26,849 --> 00:02:29,609
we call the data challenge or what we

60
00:02:28,410 --> 00:02:32,819
call the data challenge when it comes to

61
00:02:29,610 --> 00:02:34,950
security and and then share a bit of the

62
00:02:32,819 --> 00:02:36,958
experience of what our first experiment

63
00:02:34,950 --> 00:02:41,910
was like running honey pots on the wild

64
00:02:36,959 --> 00:02:43,980
then talk a little bit of what analysis

65
00:02:41,910 --> 00:02:46,079
methodology we ran through when we

66
00:02:43,980 --> 00:02:47,369
collected this data and and and the

67
00:02:46,080 --> 00:02:50,130
reasonings behind an analysis

68
00:02:47,370 --> 00:02:52,200
methodology and finally I'll share with

69
00:02:50,130 --> 00:02:53,609
you you know some of the work we've been

70
00:02:52,200 --> 00:02:55,829
doing as a next face from this

71
00:02:53,610 --> 00:02:59,700
experiment like where do we want to go

72
00:02:55,830 --> 00:03:01,560
with it little bit of myself actually

73
00:02:59,700 --> 00:03:03,119
before say anything about myself I this

74
00:03:01,560 --> 00:03:06,060
is my first time in Michigan first time

75
00:03:03,120 --> 00:03:09,330
in gerakan this is amazing like I'm so

76
00:03:06,060 --> 00:03:10,890
impressed you all had me at Macquarie er

77
00:03:09,330 --> 00:03:16,110
like the moment I saw the spots on like

78
00:03:10,890 --> 00:03:18,720
this is amazing so I'm a former Akamai

79
00:03:16,110 --> 00:03:22,260
Rolex tech security architect like my

80
00:03:18,720 --> 00:03:24,390
Publix co-founder image which became

81
00:03:22,260 --> 00:03:27,450
where is now the Oracle Wow

82
00:03:24,390 --> 00:03:29,548
and a lot of times plunker actually just

83
00:03:27,450 --> 00:03:30,958
returned after you know our the

84
00:03:29,549 --> 00:03:33,299
acquisition is a niche I left actually

85
00:03:30,959 --> 00:03:36,180
and came back to Splunk to do research

86
00:03:33,299 --> 00:03:39,120
Splunk has you can afford a license a

87
00:03:36,180 --> 00:03:41,790
limited freaking indexing and data is

88
00:03:39,120 --> 00:03:44,010
really King for a lot of the problems we

89
00:03:41,790 --> 00:03:48,090
work on so it's a good place to solve

90
00:03:44,010 --> 00:03:49,980
this problems and came back and so yeah

91
00:03:48,090 --> 00:03:52,680
let me show with you again a little bit

92
00:03:49,980 --> 00:03:54,780
of what we've been up to so first before

93
00:03:52,680 --> 00:03:56,850
we jump into any solutions let's talk

94
00:03:54,780 --> 00:04:02,269
about what the data challenges are like

95
00:03:56,850 --> 00:04:06,810
I would with security specifically

96
00:04:02,269 --> 00:04:08,549
attacks today like when you when you're

97
00:04:06,810 --> 00:04:10,639
getting attack it's really hard from the

98
00:04:08,549 --> 00:04:12,930
tool sets out there today to really this

99
00:04:10,639 --> 00:04:14,760
understand what techniques are getting

100
00:04:12,930 --> 00:04:16,049
used in that exploitation right I get to

101
00:04:14,760 --> 00:04:17,519
the store depending on the tools that

102
00:04:16,048 --> 00:04:19,798
you have an idea of yourself architected

103
00:04:17,519 --> 00:04:21,239
and it's never extremely obvious and

104
00:04:19,798 --> 00:04:22,620
they're not really most tools out there

105
00:04:21,238 --> 00:04:23,880
are built to protect you not to

106
00:04:22,620 --> 00:04:25,919
understand what the attack has been

107
00:04:23,880 --> 00:04:26,760
doing right it's to remediate it or

108
00:04:25,919 --> 00:04:31,229
collect some day

109
00:04:26,760 --> 00:04:32,880
right second it's really hard to do

110
00:04:31,230 --> 00:04:33,810
attribution Robert just was saying it's

111
00:04:32,880 --> 00:04:34,290
really hard to do attribution more

112
00:04:33,810 --> 00:04:36,240
important

113
00:04:34,290 --> 00:04:41,040
not even digging into our traditions

114
00:04:36,240 --> 00:04:42,630
really to categorize look at the context

115
00:04:41,040 --> 00:04:44,370
of an attack with regards to your

116
00:04:42,630 --> 00:04:46,260
specific network it's something targeted

117
00:04:44,370 --> 00:04:49,110
at me or is something hitting the entire

118
00:04:46,260 --> 00:04:51,450
world right is this something that was

119
00:04:49,110 --> 00:04:53,490
at a targeted event or not is this a

120
00:04:51,450 --> 00:04:55,380
malware I got used on me specifically or

121
00:04:53,490 --> 00:04:59,570
specific set of people under my industry

122
00:04:55,380 --> 00:05:03,540
individuals or not and and and thus like

123
00:04:59,570 --> 00:05:04,860
yeah and and so for the most part again

124
00:05:03,540 --> 00:05:06,480
we've used a bunch of products to try to

125
00:05:04,860 --> 00:05:10,100
answer some of this stuff but did not

126
00:05:06,480 --> 00:05:12,270
really built for the most part and so

127
00:05:10,100 --> 00:05:14,490
alongside again following this train of

128
00:05:12,270 --> 00:05:17,490
thought and 2018 there was a Black Hawk

129
00:05:14,490 --> 00:05:21,180
talk on it's called like don't eat

130
00:05:17,490 --> 00:05:22,590
spaghetti with the spoon and and one

131
00:05:21,180 --> 00:05:24,060
other this is this is like the last

132
00:05:22,590 --> 00:05:26,580
slide or one of the last slides like the

133
00:05:24,060 --> 00:05:27,870
takeaway points and I'm highlighting up

134
00:05:26,580 --> 00:05:30,060
there like to me the one that addressed

135
00:05:27,870 --> 00:05:35,850
that I did the most was they found out

136
00:05:30,060 --> 00:05:37,980
like they found out that taking open

137
00:05:35,850 --> 00:05:41,460
source intelligence feeds out of the box

138
00:05:37,980 --> 00:05:44,520
was twice as less effective as running

139
00:05:41,460 --> 00:05:47,760
your own honey pots for CNET new attacks

140
00:05:44,520 --> 00:05:49,710
in the wild what that means is this

141
00:05:47,760 --> 00:05:51,780
gentleman's running honeypot saw tax

142
00:05:49,710 --> 00:05:54,440
twice twice as fast in their network

143
00:05:51,780 --> 00:05:56,609
then actually from throwing selfies and

144
00:05:54,440 --> 00:05:59,430
going back to payin products and

145
00:05:56,610 --> 00:06:05,550
technologies we lean into hurting

146
00:05:59,430 --> 00:06:07,770
selfies heaven as an industry and so you

147
00:06:05,550 --> 00:06:09,600
know in a nutshell trend so for us

148
00:06:07,770 --> 00:06:11,669
doesn't necessarily solve the problem so

149
00:06:09,600 --> 00:06:13,890
Jason I just saw Jason start next door

150
00:06:11,670 --> 00:06:15,840
earlier and him he said something I

151
00:06:13,890 --> 00:06:19,140
really like just I'm still storing my

152
00:06:15,840 --> 00:06:22,109
name my brain like I'm so digesting it

153
00:06:19,140 --> 00:06:24,419
but basically 2012 feeds it was just a

154
00:06:22,110 --> 00:06:27,600
hundred percent accurate they're really

155
00:06:24,420 --> 00:06:29,550
good at looking at things that have

156
00:06:27,600 --> 00:06:31,290
already been known but not things that

157
00:06:29,550 --> 00:06:33,960
you don't know yet they're ahead in your

158
00:06:31,290 --> 00:06:38,430
environment right so I've known bad not

159
00:06:33,960 --> 00:06:40,320
unknown that now why the

160
00:06:38,430 --> 00:06:41,700
we decide to use Honeybuns why do we

161
00:06:40,320 --> 00:06:44,130
even bother with this project to begin

162
00:06:41,700 --> 00:06:46,229
with we we it's plug security research

163
00:06:44,130 --> 00:06:47,450
basically wanted to do a few things

164
00:06:46,230 --> 00:06:50,100
first

165
00:06:47,450 --> 00:06:52,260
we ship this thing called the security

166
00:06:50,100 --> 00:06:54,030
content update pack it's it's basically

167
00:06:52,260 --> 00:06:57,690
think of like a pretty signature update

168
00:06:54,030 --> 00:06:59,190
in our sim to our customers and and so

169
00:06:57,690 --> 00:07:00,510
in order for us to produce this pack we

170
00:06:59,190 --> 00:07:02,400
got to write detections right for net

171
00:07:00,510 --> 00:07:04,890
new malware and new exploits new

172
00:07:02,400 --> 00:07:06,989
attackers and so my intent behind this

173
00:07:04,890 --> 00:07:09,510
was well I want we wanted a lure and new

174
00:07:06,990 --> 00:07:11,250
attackers that we never seen before so

175
00:07:09,510 --> 00:07:13,230
we can write detection for specifically

176
00:07:11,250 --> 00:07:15,270
things that were either topical or

177
00:07:13,230 --> 00:07:17,100
things that were interesting to us or

178
00:07:15,270 --> 00:07:18,990
things I've hit one of our customers in

179
00:07:17,100 --> 00:07:22,020
the past that really maybe wasn't

180
00:07:18,990 --> 00:07:24,150
written about second we wanted to be

181
00:07:22,020 --> 00:07:25,979
able to produce produce in some way

182
00:07:24,150 --> 00:07:28,280
programmatically this content box right

183
00:07:25,980 --> 00:07:30,030
we were spending a whole lot of time

184
00:07:28,280 --> 00:07:32,130
individually each of us are just

185
00:07:30,030 --> 00:07:33,780
reversing things understanding how they

186
00:07:32,130 --> 00:07:37,290
work so then it actually generate a

187
00:07:33,780 --> 00:07:38,969
detection for customers and third we

188
00:07:37,290 --> 00:07:41,310
really again we really wanted to cover

189
00:07:38,970 --> 00:07:43,230
relative relevant attacks and what I

190
00:07:41,310 --> 00:07:44,940
mean by that is it's sometimes when you

191
00:07:43,230 --> 00:07:46,320
see written on a news article isn't that

192
00:07:44,940 --> 00:07:49,290
necessarily what's hitting right now in

193
00:07:46,320 --> 00:07:51,930
the Internet right like for example blue

194
00:07:49,290 --> 00:07:54,240
key it'll keep was hitting before even

195
00:07:51,930 --> 00:07:57,120
the article was out right there was a

196
00:07:54,240 --> 00:07:59,040
new near the exploit there were scans

197
00:07:57,120 --> 00:08:04,380
already happening like a week before two

198
00:07:59,040 --> 00:08:06,860
weeks before that an Expos already our

199
00:08:04,380 --> 00:08:11,820
goal is walking into this was basically

200
00:08:06,860 --> 00:08:15,750
to collect mall but more specifically

201
00:08:11,820 --> 00:08:17,940
payloads from malware and of study is

202
00:08:15,750 --> 00:08:20,970
connections and his behaviors when they

203
00:08:17,940 --> 00:08:23,300
hit a system again we bring tailoring

204
00:08:20,970 --> 00:08:25,470
this thing for what we wanted to collect

205
00:08:23,300 --> 00:08:28,290
second we wanted to emulate and

206
00:08:25,470 --> 00:08:30,120
manipulate common system parameters to

207
00:08:28,290 --> 00:08:32,430
make some sort to make our honey pots

208
00:08:30,120 --> 00:08:34,409
look like suppose as possible a real

209
00:08:32,429 --> 00:08:36,510
system if we could and I'll explain to

210
00:08:34,409 --> 00:08:39,900
you why like how do we reach that

211
00:08:36,510 --> 00:08:41,370
conclusion in a second but up and we

212
00:08:39,900 --> 00:08:43,319
also want to ensure that whatever we

213
00:08:41,370 --> 00:08:45,090
ended up using to collect this

214
00:08:43,320 --> 00:08:47,670
information was easy enough for us to

215
00:08:45,090 --> 00:08:50,610
manage for small team we're not a big

216
00:08:47,670 --> 00:08:52,020
team and so you know we in order for us

217
00:08:50,610 --> 00:08:52,380
to this effectively learned at the point

218
00:08:52,020 --> 00:08:54,030
across

219
00:08:52,380 --> 00:08:55,140
multiple cloud environments multiple

220
00:08:54,030 --> 00:08:57,540
customers so you needed to be something

221
00:08:55,140 --> 00:09:00,300
else was easy fast to deploy and to

222
00:08:57,540 --> 00:09:02,760
customize and finally because again

223
00:09:00,300 --> 00:09:04,650
spunk we're gonna eventually analyze

224
00:09:02,760 --> 00:09:06,750
this ice plunk really needed to have

225
00:09:04,650 --> 00:09:08,430
something that allows to have something

226
00:09:06,750 --> 00:09:10,890
like scene indexing relic for

227
00:09:08,430 --> 00:09:12,479
normalizing data out of this box it's

228
00:09:10,890 --> 00:09:13,740
spending a bunch of time on it it was a

229
00:09:12,480 --> 00:09:19,590
non-starter from a technology

230
00:09:13,740 --> 00:09:22,830
perspective so we decided to start the

231
00:09:19,590 --> 00:09:25,950
experiment with Kali and Kari if we

232
00:09:22,830 --> 00:09:28,620
never heard of it as a ssh medium

233
00:09:25,950 --> 00:09:31,470
interaction honeypot actually a fork of

234
00:09:28,620 --> 00:09:33,270
keeper old-school ssh medium interaction

235
00:09:31,470 --> 00:09:38,880
honeypot how he's actually written by a

236
00:09:33,270 --> 00:09:41,730
currents plonker and carry carry

237
00:09:38,880 --> 00:09:44,280
emulates relates a real system but it's

238
00:09:41,730 --> 00:09:45,720
not soft fake almost like when you

239
00:09:44,280 --> 00:09:46,650
interact with it you're running commands

240
00:09:45,720 --> 00:09:48,810
and stuff you're not really actually

241
00:09:46,650 --> 00:09:51,270
running any commands you know you're

242
00:09:48,810 --> 00:09:53,160
emulating back to the attacker and it

243
00:09:51,270 --> 00:09:55,910
records everything that that attacker is

244
00:09:53,160 --> 00:09:55,910
doing on that box

245
00:09:57,230 --> 00:10:05,730
so before I again before I dig in to

246
00:10:01,080 --> 00:10:06,810
what we did with Cori and what data that

247
00:10:05,730 --> 00:10:08,490
we collect out of this and how we

248
00:10:06,810 --> 00:10:12,000
analyze it I want to show you some

249
00:10:08,490 --> 00:10:13,950
before and afters like before we you

250
00:10:12,000 --> 00:10:15,930
know default install card we just got it

251
00:10:13,950 --> 00:10:17,550
just started playing with it and then

252
00:10:15,930 --> 00:10:20,959
after we've made a bunch of stuff that

253
00:10:17,550 --> 00:10:24,719
we modified a bunch of stuff out of it

254
00:10:20,960 --> 00:10:26,640
the first image here so before is the

255
00:10:24,720 --> 00:10:29,100
left-hand side after his right-hand side

256
00:10:26,640 --> 00:10:30,930
is the top countries that we're hitting

257
00:10:29,100 --> 00:10:33,630
our sensors that we build the khari

258
00:10:30,930 --> 00:10:36,150
sensors we built we deployed so before

259
00:10:33,630 --> 00:10:37,950
we did anything to it most traffic we

260
00:10:36,150 --> 00:10:41,459
were seeing against the sensors on ssh

261
00:10:37,950 --> 00:10:42,600
again was out of russia and then a bunch

262
00:10:41,460 --> 00:10:45,600
other little countries in between but

263
00:10:42,600 --> 00:10:47,880
like by far so we're like well why

264
00:10:45,600 --> 00:10:49,920
started dig into the data we're getting

265
00:10:47,880 --> 00:10:51,150
a bunch of garbage from your eye which

266
00:10:49,920 --> 00:10:53,160
is still around still scanning the

267
00:10:51,150 --> 00:10:55,319
internet and still affecting association

268
00:10:53,160 --> 00:10:58,110
points with the phone credentials which

269
00:10:55,320 --> 00:10:59,700
we had on this host when we cleaned out

270
00:10:58,110 --> 00:11:01,650
all the me right traffic and what i mean

271
00:10:59,700 --> 00:11:03,980
by clean out in a second I'll show you

272
00:11:01,650 --> 00:11:06,569
we basically stopped allowing

273
00:11:03,980 --> 00:11:10,100
authentications from things like

274
00:11:06,570 --> 00:11:14,610
fault credentials the Mirai uses we saw

275
00:11:10,100 --> 00:11:16,800
way more more distributed attack surface

276
00:11:14,610 --> 00:11:18,000
that is honeypot receiver the attacker

277
00:11:16,800 --> 00:11:22,290
for coming from all over the place

278
00:11:18,000 --> 00:11:24,480
essentially another thing that again

279
00:11:22,290 --> 00:11:26,760
before the change and after the change I

280
00:11:24,480 --> 00:11:28,350
found completely interesting was before

281
00:11:26,760 --> 00:11:31,110
we made any modifications we're roughly

282
00:11:28,350 --> 00:11:34,680
getting about if you guys consider but

283
00:11:31,110 --> 00:11:36,570
about eighty connections a day or so

284
00:11:34,680 --> 00:11:37,920
where it was increasing the holiday

285
00:11:36,570 --> 00:11:41,910
season but about any connections a day

286
00:11:37,920 --> 00:11:44,490
to all of our notes and about twenty of

287
00:11:41,910 --> 00:11:45,959
those actually result in the attacker

288
00:11:44,490 --> 00:11:47,280
interacting with the honey poverty so

289
00:11:45,960 --> 00:11:49,020
one thing is actually connected to the

290
00:11:47,280 --> 00:11:50,670
SSH endpoint yeah things like actually

291
00:11:49,020 --> 00:11:53,010
started inputting commands dropping out

292
00:11:50,670 --> 00:11:55,439
within whatever right when we made our

293
00:11:53,010 --> 00:11:57,720
modifications that's skyrocket at all I

294
00:11:55,440 --> 00:11:59,520
mean we were we jumped all over to life

295
00:11:57,720 --> 00:12:02,130
at some point that that spike was like

296
00:11:59,520 --> 00:12:04,560
500 connections and roughly about a

297
00:12:02,130 --> 00:12:10,980
hundred of them were actually resulted

298
00:12:04,560 --> 00:12:15,000
in interactions with them finally before

299
00:12:10,980 --> 00:12:17,160
and after we should can you guys guess

300
00:12:15,000 --> 00:12:21,450
which was a is a before and wishes the

301
00:12:17,160 --> 00:12:24,300
after so actually the right hand side

302
00:12:21,450 --> 00:12:25,620
now is the before before we made any

303
00:12:24,300 --> 00:12:27,599
modifications we're getting roughly

304
00:12:25,620 --> 00:12:29,580
about ten payloads or ten malware's

305
00:12:27,600 --> 00:12:33,420
being collected on all of our sensors a

306
00:12:29,580 --> 00:12:35,400
day ten fifteen sunglass spike after we

307
00:12:33,420 --> 00:12:37,589
made our modifications we were seeing a

308
00:12:35,400 --> 00:12:38,790
lot more malicious stuff from this why

309
00:12:37,590 --> 00:12:41,280
this is what we wanted right we wanted

310
00:12:38,790 --> 00:12:46,079
to collect malware so we can then

311
00:12:41,280 --> 00:12:47,910
produce detections out of it this is

312
00:12:46,080 --> 00:12:50,840
essentially the proof is in the pudding

313
00:12:47,910 --> 00:12:53,189
kind of slide right this is this is like

314
00:12:50,840 --> 00:12:55,830
whatever we ended up doing it's the

315
00:12:53,190 --> 00:12:57,180
process of change it resulted in gap

316
00:12:55,830 --> 00:12:58,560
we're collecting a lot more bad stuff we

317
00:12:57,180 --> 00:13:03,449
have a better examples now that we can

318
00:12:58,560 --> 00:13:05,550
work through this is a soap so one of

319
00:13:03,450 --> 00:13:08,970
the things we were playing with as part

320
00:13:05,550 --> 00:13:15,420
of analyzing this data was we basically

321
00:13:08,970 --> 00:13:16,770
loaded up a noise and we wrote this

322
00:13:15,420 --> 00:13:17,550
custom command gray noise if you're not

323
00:13:16,770 --> 00:13:20,189
familiar with gray noise

324
00:13:17,550 --> 00:13:23,569
three nurses are they

325
00:13:20,190 --> 00:13:25,650
a company that provides an API for

326
00:13:23,570 --> 00:13:28,050
sensors that they run so they run a

327
00:13:25,650 --> 00:13:30,090
bunch of honey pots all over the world

328
00:13:28,050 --> 00:13:32,130
and and then you can query that data

329
00:13:30,090 --> 00:13:34,020
those honey pots are seeing through

330
00:13:32,130 --> 00:13:35,880
their API and so we wrote a command in

331
00:13:34,020 --> 00:13:37,770
Splunk that pulls please you can query

332
00:13:35,880 --> 00:13:40,230
the API and bring back data and we

333
00:13:37,770 --> 00:13:41,550
analyze what we're basically the

334
00:13:40,230 --> 00:13:44,850
organization's that we're hitting our

335
00:13:41,550 --> 00:13:47,430
honey pots the most given what grey

336
00:13:44,850 --> 00:13:49,200
nurse knows about right and by the most

337
00:13:47,430 --> 00:13:52,229
part for them it was kind of odd like

338
00:13:49,200 --> 00:13:54,540
when we saw the data or like Romania

339
00:13:52,230 --> 00:13:58,560
communications there's a lot of Comcast

340
00:13:54,540 --> 00:13:59,699
in there as well Italy again more kin

341
00:13:58,560 --> 00:14:01,609
with that there wasn't necessarily a

342
00:13:59,700 --> 00:14:05,820
single attacker who was just hitting a

343
00:14:01,610 --> 00:14:08,280
box or our sensors right a honey busting

344
00:14:05,820 --> 00:14:12,840
surgeon it was a very very wolf spread

345
00:14:08,280 --> 00:14:15,900
attack so what do we do like how do we

346
00:14:12,840 --> 00:14:18,060
respond it was that we modified in our

347
00:14:15,900 --> 00:14:19,680
SSH honey pots to actually start

348
00:14:18,060 --> 00:14:22,500
collecting a lot more data and then

349
00:14:19,680 --> 00:14:23,849
translated to the detections well before

350
00:14:22,500 --> 00:14:27,270
I jump into that I want to show you a

351
00:14:23,850 --> 00:14:34,470
quick video of a of an actual attacker

352
00:14:27,270 --> 00:14:36,800
we let me just play for you oh no

353
00:14:34,470 --> 00:14:36,800
nevermind

354
00:14:39,970 --> 00:14:43,860
I love my mosque

355
00:14:52,730 --> 00:14:58,880
I don't believe so this video is a video

356
00:14:56,150 --> 00:15:01,189
of an attacker I logged into one of our

357
00:14:58,880 --> 00:15:02,780
sensors lucky enough to see it when it

358
00:15:01,190 --> 00:15:04,550
happened so I started recording the

359
00:15:02,780 --> 00:15:06,520
session and this is before we started

360
00:15:04,550 --> 00:15:09,050
doing any modifications right this is

361
00:15:06,520 --> 00:15:16,730
basically a plain vanilla carry instance

362
00:15:09,050 --> 00:15:18,199
we just saw one of the things is this

363
00:15:16,730 --> 00:15:19,550
guy the first thing is just trying to

364
00:15:18,200 --> 00:15:22,940
get a lay of the land he's listening

365
00:15:19,550 --> 00:15:25,370
directories right and so he goes to home

366
00:15:22,940 --> 00:15:27,860
says well there's only one user on the

367
00:15:25,370 --> 00:15:29,270
home directory Richard that's odd let me

368
00:15:27,860 --> 00:15:31,100
go back is there anything else in here

369
00:15:29,270 --> 00:15:36,069
just has like a regular you know SSH

370
00:15:31,100 --> 00:15:39,980
profile etc and then he's like whoa is

371
00:15:36,070 --> 00:15:41,900
do have a car user he knew he was in a

372
00:15:39,980 --> 00:15:43,490
honeypot immediately he noticed it right

373
00:15:41,900 --> 00:15:45,949
he notice he was in a honeypot that's

374
00:15:43,490 --> 00:15:50,470
the zero-calorie home user in here and

375
00:15:45,950 --> 00:15:53,390
so what's what does he do next I'm out

376
00:15:50,470 --> 00:15:55,310
I'm out like I know this is the sensor

377
00:15:53,390 --> 00:15:57,350
I'm not dropping anything in here this

378
00:15:55,310 --> 00:15:59,180
is the reason why we started modifying

379
00:15:57,350 --> 00:16:01,160
kauri we knew we weren't collecting

380
00:15:59,180 --> 00:16:02,540
anything useful and this was this is

381
00:16:01,160 --> 00:16:05,270
again the proof is in the pudding this

382
00:16:02,540 --> 00:16:06,800
is this is our proof what were we doing

383
00:16:05,270 --> 00:16:08,810
wrong was immediately what we started

384
00:16:06,800 --> 00:16:10,130
asking what are we doing wrong we can

385
00:16:08,810 --> 00:16:14,359
see what this attackers are actually

386
00:16:10,130 --> 00:16:20,689
doing on the box what you're gonna gets

387
00:16:14,360 --> 00:16:24,410
me to let me go back gets me to what do

388
00:16:20,690 --> 00:16:25,270
we change so Kari has a default config

389
00:16:24,410 --> 00:16:28,969
though

390
00:16:25,270 --> 00:16:31,400
HC carries a CFG and and the default

391
00:16:28,970 --> 00:16:34,430
config file you get for example setting

392
00:16:31,400 --> 00:16:35,600
like hosting that's a dead giveaway if

393
00:16:34,430 --> 00:16:37,550
you don't change your host name in your

394
00:16:35,600 --> 00:16:41,330
machine and you're using the standard

395
00:16:37,550 --> 00:16:42,949
default the honeypot hostname so I had

396
00:16:41,330 --> 00:16:44,060
done that actually on that video that's

397
00:16:42,950 --> 00:16:46,160
the only setting I think I ended up

398
00:16:44,060 --> 00:16:48,170
changing but the not so obvious ones

399
00:16:46,160 --> 00:16:49,910
where things like the interactive time

400
00:16:48,170 --> 00:16:51,650
up remember that shorter you showed you

401
00:16:49,910 --> 00:16:53,990
about the interaction versus connection

402
00:16:51,650 --> 00:16:56,329
and how I spiked up that's because we

403
00:16:53,990 --> 00:17:01,200
realize that attackers will connect to

404
00:16:56,330 --> 00:17:02,790
the SSH session and sit there do nothing

405
00:17:01,200 --> 00:17:04,650
two minutes three minutes five minutes

406
00:17:02,790 --> 00:17:07,980
and then those sorry launched in the

407
00:17:04,650 --> 00:17:09,750
attack why a lot of corporations closes

408
00:17:07,980 --> 00:17:11,190
SSH connections really fast you don't

409
00:17:09,750 --> 00:17:15,569
want any resources just keeping somebody

410
00:17:11,190 --> 00:17:18,089
listening on a socket so we increase the

411
00:17:15,569 --> 00:17:20,639
time out so first it was five minutes

412
00:17:18,089 --> 00:17:22,349
and then we went from 180 seconds then

413
00:17:20,640 --> 00:17:24,360
five minutes and then I think we ended

414
00:17:22,349 --> 00:17:27,179
up making it like an hour at some point

415
00:17:24,359 --> 00:17:29,850
and the longer we let the attacker sit

416
00:17:27,180 --> 00:17:32,610
there typically the more data we ended

417
00:17:29,850 --> 00:17:36,560
up getting as results other things were

418
00:17:32,610 --> 00:17:39,959
because we're going Korea's

419
00:17:36,560 --> 00:17:42,480
out-of-the-box shifts trying to emulate

420
00:17:39,960 --> 00:17:45,840
a debian Lenny server so the old school

421
00:17:42,480 --> 00:17:49,380
day beam server we wanted to emulate an

422
00:17:45,840 --> 00:17:50,520
AWS boon to 1404 instance and so in

423
00:17:49,380 --> 00:17:53,190
order for us to do that

424
00:17:50,520 --> 00:17:56,129
we had to change the kernel build string

425
00:17:53,190 --> 00:18:00,240
we had to change the actual SSH banner

426
00:17:56,130 --> 00:18:02,640
that comes back all those were telltale

427
00:18:00,240 --> 00:18:05,040
signs for the attacker where they would

428
00:18:02,640 --> 00:18:06,570
connect and say well I'm expecting in a

429
00:18:05,040 --> 00:18:08,360
bun to box but you're getting me the

430
00:18:06,570 --> 00:18:11,639
build strength for Debian box

431
00:18:08,360 --> 00:18:16,050
something's on there out they don't they

432
00:18:11,640 --> 00:18:17,790
don't drop them all right oh they're not

433
00:18:16,050 --> 00:18:20,159
so obvious things right that we again

434
00:18:17,790 --> 00:18:23,370
this is lessons learned running this on

435
00:18:20,160 --> 00:18:26,250
the world was carry has a user database

436
00:18:23,370 --> 00:18:29,100
and there's a set of users user

437
00:18:26,250 --> 00:18:32,100
databases with what you will do with

438
00:18:29,100 --> 00:18:34,679
that is when whatever user name lands on

439
00:18:32,100 --> 00:18:36,719
this database you have here so allow an

440
00:18:34,680 --> 00:18:39,240
attacker to log into it without any

441
00:18:36,720 --> 00:18:40,470
passwords so power under the hood

442
00:18:39,240 --> 00:18:43,020
they'll put a path like when they

443
00:18:40,470 --> 00:18:44,430
connect or put a password but though it

444
00:18:43,020 --> 00:18:45,960
doesn't matter what they write they'll

445
00:18:44,430 --> 00:18:47,880
be let in right so it's basically a I'm

446
00:18:45,960 --> 00:18:52,080
going to allow this user so see if I can

447
00:18:47,880 --> 00:18:54,060
catch an attack on this user so remember

448
00:18:52,080 --> 00:18:56,129
that the first shot I showed you with

449
00:18:54,060 --> 00:18:57,360
Russia being all the trek all the

450
00:18:56,130 --> 00:19:00,150
traffic we got originally then we

451
00:18:57,360 --> 00:19:02,310
cleaned it up afterwards we denied admin

452
00:19:00,150 --> 00:19:04,800
admin admin that's one of the most

453
00:19:02,310 --> 00:19:07,409
common murre I attempted authentication

454
00:19:04,800 --> 00:19:09,360
accounts and all the garbage went away

455
00:19:07,410 --> 00:19:12,450
anyway we cleaned up some of the stuff

456
00:19:09,360 --> 00:19:14,969
in there but other things that we did

457
00:19:12,450 --> 00:19:17,700
was for example we were seeing all

458
00:19:14,970 --> 00:19:19,620
connections from the user PI and because

459
00:19:17,700 --> 00:19:21,870
we didn't have it on this database we

460
00:19:19,620 --> 00:19:23,219
would deny that connection don't have

461
00:19:21,870 --> 00:19:25,949
we're not allowing you in so we're

462
00:19:23,220 --> 00:19:28,740
kicking as we're missing the malware

463
00:19:25,950 --> 00:19:32,400
that that attack was trying to drop we

464
00:19:28,740 --> 00:19:33,419
changed that we allowed the user PI and

465
00:19:32,400 --> 00:19:36,360
we started seeing some really

466
00:19:33,419 --> 00:19:37,980
interesting stuff as a result so another

467
00:19:36,360 --> 00:19:41,000
thing that again gain does a lot of

468
00:19:37,980 --> 00:19:42,870
gamers are the value was just make sure

469
00:19:41,000 --> 00:19:44,640
when you if you do go through this

470
00:19:42,870 --> 00:19:46,530
process you're looking at what users

471
00:19:44,640 --> 00:19:49,080
your attacker to attend and adjust for

472
00:19:46,530 --> 00:19:55,260
that right change change your honeypot

473
00:19:49,080 --> 00:19:57,000
for that but not the final but I think

474
00:19:55,260 --> 00:19:59,158
the second most important thing the we

475
00:19:57,000 --> 00:20:02,850
ended up changing was the file system

476
00:19:59,159 --> 00:20:04,260
layout so again out-of-the-box carries

477
00:20:02,850 --> 00:20:08,610
Debian completely different file systems

478
00:20:04,260 --> 00:20:10,470
at a boon to 1404 and so Tiger jumps on

479
00:20:08,610 --> 00:20:12,809
says oh wait this directory structure

480
00:20:10,470 --> 00:20:16,289
doesn't really match this operating

481
00:20:12,809 --> 00:20:19,110
system I'm out Kari has a very

482
00:20:16,289 --> 00:20:21,210
convenient tool called creative s that

483
00:20:19,110 --> 00:20:22,799
allows you to basically create an

484
00:20:21,210 --> 00:20:24,390
emulation of a file system out of the

485
00:20:22,799 --> 00:20:28,080
box you're sitting on this is the

486
00:20:24,390 --> 00:20:30,390
command that I use to create a mimic of

487
00:20:28,080 --> 00:20:32,129
Ubuntu 1404 but the coolest thing I

488
00:20:30,390 --> 00:20:33,900
found did this blew my mind the coolest

489
00:20:32,130 --> 00:20:36,390
thing I found from this command was he

490
00:20:33,900 --> 00:20:37,919
passed it at minus P at the end not only

491
00:20:36,390 --> 00:20:40,110
do they emulate the full file system

492
00:20:37,919 --> 00:20:43,200
they emulate everything under death and

493
00:20:40,110 --> 00:20:47,129
proc so all the devices on the machine

494
00:20:43,200 --> 00:20:50,760
are also emulated super useful because

495
00:20:47,130 --> 00:20:52,740
again now it looks like even more of a

496
00:20:50,760 --> 00:20:54,330
real mission you have related devices on

497
00:20:52,740 --> 00:20:56,970
there right it's off I mean it's all

498
00:20:54,330 --> 00:20:58,799
faking that sense of like there's not an

499
00:20:56,970 --> 00:21:00,659
actual device just text empty text files

500
00:20:58,799 --> 00:21:02,070
where they come back but that was pretty

501
00:21:00,659 --> 00:21:04,860
neat

502
00:21:02,070 --> 00:21:06,210
and then the final I think I left the

503
00:21:04,860 --> 00:21:09,209
best for last the final most important

504
00:21:06,210 --> 00:21:09,990
part was the commands that we had

505
00:21:09,210 --> 00:21:13,350
available

506
00:21:09,990 --> 00:21:15,600
Akari out of the box we're now returning

507
00:21:13,350 --> 00:21:17,370
what you would expect the box to be what

508
00:21:15,600 --> 00:21:19,199
do I mean by that curry again for

509
00:21:17,370 --> 00:21:22,770
limited environment medium interaction

510
00:21:19,200 --> 00:21:24,149
so it's now an actual environment has

511
00:21:22,770 --> 00:21:27,299
pre build

512
00:21:24,149 --> 00:21:28,919
text outputs or out-of-the-box Linux

513
00:21:27,299 --> 00:21:30,330
commands so when you run when

514
00:21:28,920 --> 00:21:33,060
if you're logged into the server and you

515
00:21:30,330 --> 00:21:36,659
run daemon you're gonna get some tax

516
00:21:33,060 --> 00:21:39,419
output that me the defender with a pre

517
00:21:36,660 --> 00:21:41,580
program for that attacker well some of

518
00:21:39,420 --> 00:21:43,560
those tax outputs again we're 4gb and

519
00:21:41,580 --> 00:21:46,830
half through bun too so if you did a

520
00:21:43,560 --> 00:21:49,020
mount for example you will see SDA well

521
00:21:46,830 --> 00:21:53,010
man this attacker sitting on a bunt no

522
00:21:49,020 --> 00:21:56,730
Bunton since in AWS so the default

523
00:21:53,010 --> 00:21:58,950
Mountain AWS s XV da the end there give

524
00:21:56,730 --> 00:22:01,740
the giveaways a lot of crypto miners

525
00:21:58,950 --> 00:22:04,320
that we saw hitting us would do will run

526
00:22:01,740 --> 00:22:06,270
LS CPU they want to see what CPU I have

527
00:22:04,320 --> 00:22:07,590
so they can actually mine well guess

528
00:22:06,270 --> 00:22:08,550
what if you don't have the right CPU for

529
00:22:07,590 --> 00:22:11,270
them they're not even gonna drop that

530
00:22:08,550 --> 00:22:13,620
miner and so they're just gonna hop up

531
00:22:11,270 --> 00:22:16,620
so we modified all these commands

532
00:22:13,620 --> 00:22:19,679
essentially to return Rio outputs from

533
00:22:16,620 --> 00:22:22,169
the boom to 1404 box and and again this

534
00:22:19,680 --> 00:22:25,140
this helps us just it invited a lot more

535
00:22:22,170 --> 00:22:29,300
attacks into our instances which

536
00:22:25,140 --> 00:22:29,300
resulted in just way better data for us

537
00:22:30,350 --> 00:22:36,270
it was again it was so I was a little

538
00:22:34,440 --> 00:22:37,860
bit blown back this was on experiment

539
00:22:36,270 --> 00:22:39,330
this was not a project like we were just

540
00:22:37,860 --> 00:22:40,469
when so like a how we're gonna tackle

541
00:22:39,330 --> 00:22:42,810
this we started thinking through

542
00:22:40,470 --> 00:22:44,520
complete experiments but this was almost

543
00:22:42,810 --> 00:22:45,840
like the moment where you know when your

544
00:22:44,520 --> 00:22:47,730
experiment and just blows up in your

545
00:22:45,840 --> 00:22:49,649
face and you're like this is it works

546
00:22:47,730 --> 00:22:52,770
you know kind of thing this is the

547
00:22:49,650 --> 00:22:54,030
moment we caught a the malware is

548
00:22:52,770 --> 00:22:57,200
nothing to go home write about it was an

549
00:22:54,030 --> 00:23:00,840
r SE baat pearl bot that got dropped but

550
00:22:57,200 --> 00:23:02,760
we saw it five days before anybody pub

551
00:23:00,840 --> 00:23:06,120
loaded into our store we saw it 5 days

552
00:23:02,760 --> 00:23:09,180
ahead of again any other researcher

553
00:23:06,120 --> 00:23:12,080
essentially and I'm just going to find

554
00:23:09,180 --> 00:23:15,150
out we saw it 5 days ahead

555
00:23:12,080 --> 00:23:17,280
that's the body right there we're seeing

556
00:23:15,150 --> 00:23:19,020
something ahead of essentially what you

557
00:23:17,280 --> 00:23:21,330
were seen by restored or any 13 so feed

558
00:23:19,020 --> 00:23:22,980
here ahead of the curve and by the way

559
00:23:21,330 --> 00:23:24,570
this is running outside of River not

560
00:23:22,980 --> 00:23:25,980
remember I was like in the same

561
00:23:24,570 --> 00:23:28,200
innocence and same at consoles or Club

562
00:23:25,980 --> 00:23:29,700
providers so if we're seeing it that

563
00:23:28,200 --> 00:23:32,280
means all of our other servers are

564
00:23:29,700 --> 00:23:33,900
seeing it right so this is stuff we

565
00:23:32,280 --> 00:23:38,430
gotta worry about this was scanning us

566
00:23:33,900 --> 00:23:41,730
essentially that was a fun day

567
00:23:38,430 --> 00:23:43,470
so how do we break this data down so

568
00:23:41,730 --> 00:23:47,400
like one thing one thing is to run this

569
00:23:43,470 --> 00:23:48,870
honeypot servers and get a tag and see

570
00:23:47,400 --> 00:23:49,590
the attacker but like you're gonna want

571
00:23:48,870 --> 00:23:53,060
to do something with that data

572
00:23:49,590 --> 00:23:55,949
eventually and so what are you after

573
00:23:53,060 --> 00:23:57,690
our goal was primarily again to build

574
00:23:55,950 --> 00:23:58,860
detections out of it and more

575
00:23:57,690 --> 00:24:01,290
importantly we were looking to build

576
00:23:58,860 --> 00:24:05,459
detections for net new things

577
00:24:01,290 --> 00:24:07,500
so specifically attacks that did not

578
00:24:05,460 --> 00:24:11,010
have proof of concept code out in the

579
00:24:07,500 --> 00:24:12,240
world things that are not been known but

580
00:24:11,010 --> 00:24:15,350
they were hitting

581
00:24:12,240 --> 00:24:18,630
us individually or the entire Internet

582
00:24:15,350 --> 00:24:20,699
how do we answer that question the first

583
00:24:18,630 --> 00:24:22,710
thing that we did was we search for the

584
00:24:20,700 --> 00:24:26,220
rare files that were being dropped in

585
00:24:22,710 --> 00:24:27,780
coloring not the common fault why if

586
00:24:26,220 --> 00:24:30,570
you're scanning the internet you know

587
00:24:27,780 --> 00:24:31,920
you know you have blue key as an exploit

588
00:24:30,570 --> 00:24:35,070
and now you're gonna infect audio these

589
00:24:31,920 --> 00:24:37,950
open RDP instances out there you you're

590
00:24:35,070 --> 00:24:39,330
you're likely you're likely so so and

591
00:24:37,950 --> 00:24:40,830
and and a bunch of people are doing this

592
00:24:39,330 --> 00:24:42,929
because now the exploit is public I

593
00:24:40,830 --> 00:24:44,490
don't care you know that exploits public

594
00:24:42,930 --> 00:24:47,940
just probably 10 right up somehow the

595
00:24:44,490 --> 00:24:49,320
exploit works and I'm most likely most

596
00:24:47,940 --> 00:24:51,450
vendor already has signatures and

597
00:24:49,320 --> 00:24:52,649
analysis for that I can just right look

598
00:24:51,450 --> 00:24:55,290
at one of those write-ups and reverse it

599
00:24:52,650 --> 00:24:57,930
and bake it into the product so I want

600
00:24:55,290 --> 00:25:00,270
to look at again the stuff that it's not

601
00:24:57,930 --> 00:25:02,130
common in the industry so look at the

602
00:25:00,270 --> 00:25:04,680
river or not comment out being exploited

603
00:25:02,130 --> 00:25:06,720
so look at the rare files but the next

604
00:25:04,680 --> 00:25:08,370
question we were asking ourselves was is

605
00:25:06,720 --> 00:25:10,410
this in virustotal or in this in the

606
00:25:08,370 --> 00:25:14,340
public to me so if though if there was a

607
00:25:10,410 --> 00:25:16,410
malware drop take the hash say a run it

608
00:25:14,340 --> 00:25:17,939
against run it against virus total and

609
00:25:16,410 --> 00:25:20,310
see there's a report for it we had this

610
00:25:17,940 --> 00:25:23,820
one-liner it's not pretty but it works

611
00:25:20,310 --> 00:25:25,139
the basically just lists all the hashes

612
00:25:23,820 --> 00:25:28,220
that have been downloaded into your

613
00:25:25,140 --> 00:25:31,260
sensor then filters out just crud and

614
00:25:28,220 --> 00:25:33,300
submits it into the virus total into

615
00:25:31,260 --> 00:25:35,400
virus total for analysis for reporting

616
00:25:33,300 --> 00:25:37,440
using the command line interface and

617
00:25:35,400 --> 00:25:39,870
then we obviously sleep because virus

618
00:25:37,440 --> 00:25:40,860
total rate limits is to four requests

619
00:25:39,870 --> 00:25:43,469
per second unless you're paying them

620
00:25:40,860 --> 00:25:47,040
actual money which we should we weren't

621
00:25:43,470 --> 00:25:51,210
in this case so if it was in the public

622
00:25:47,040 --> 00:25:52,330
so going back to is a rare okay it's

623
00:25:51,210 --> 00:25:55,239
rare awesome

624
00:25:52,330 --> 00:25:57,099
is it in the public domain if it's not

625
00:25:55,239 --> 00:25:59,080
in the public domain if it is we're done

626
00:25:57,099 --> 00:26:01,149
we're not interested in this or we

627
00:25:59,080 --> 00:26:03,039
already know what it is there's a viral

628
00:26:01,149 --> 00:26:04,299
report for it we can probably find more

629
00:26:03,039 --> 00:26:06,339
information about it we're not

630
00:26:04,299 --> 00:26:10,749
necessarily interested in prefer their

631
00:26:06,339 --> 00:26:13,509
analysis but if it's not was it seen by

632
00:26:10,749 --> 00:26:15,909
grey noise and what this tells us is we

633
00:26:13,509 --> 00:26:18,129
saw it our honeypot sensor saw it but

634
00:26:15,909 --> 00:26:18,909
grain rays were just again this is what

635
00:26:18,129 --> 00:26:23,408
they do for a living

636
00:26:18,909 --> 00:26:25,539
did not which most likely means we were

637
00:26:23,409 --> 00:26:27,519
either individually targeted or there

638
00:26:25,539 --> 00:26:29,709
was something specific about what this

639
00:26:27,519 --> 00:26:32,169
sunny pulse was running it that made

640
00:26:29,709 --> 00:26:33,639
them attack it versus just scanning the

641
00:26:32,169 --> 00:26:36,070
internet for it and hitting a gray noise

642
00:26:33,639 --> 00:26:37,418
node and like I mentioned earlier we

643
00:26:36,070 --> 00:26:40,718
build a custom command for green house

644
00:26:37,419 --> 00:26:43,269
that we can just through Splunk hit that

645
00:26:40,719 --> 00:26:45,059
reggae we were indexing Alana theta pipe

646
00:26:43,269 --> 00:26:49,629
gave me a date from grey noise and

647
00:26:45,059 --> 00:26:53,469
bringing that back so rare it's not in

648
00:26:49,629 --> 00:26:55,478
the public domain and it's not hitting

649
00:26:53,469 --> 00:26:58,690
anybody else I set my honey pot as far

650
00:26:55,479 --> 00:27:00,309
as I know and what do we do next is

651
00:26:58,690 --> 00:27:05,320
there proof of concept code out there

652
00:27:00,309 --> 00:27:06,579
attack if there's proof of concept code

653
00:27:05,320 --> 00:27:07,928
out there excellent

654
00:27:06,579 --> 00:27:09,908
I knows where it's hitting us

655
00:27:07,929 --> 00:27:11,709
individually and I know what the code I

656
00:27:09,909 --> 00:27:14,499
know I know what this expert is doing I

657
00:27:11,709 --> 00:27:15,009
also have now collected it in our

658
00:27:14,499 --> 00:27:16,989
sensors

659
00:27:15,009 --> 00:27:19,419
I know it's behavior when it works I can

660
00:27:16,989 --> 00:27:21,969
write a detection for this amazing great

661
00:27:19,419 --> 00:27:25,359
this is exactly the state we want to be

662
00:27:21,969 --> 00:27:27,339
at this is where our researchers go from

663
00:27:25,359 --> 00:27:29,889
studying something to actually again

664
00:27:27,339 --> 00:27:31,178
affecting our users game getting them to

665
00:27:29,889 --> 00:27:34,238
be a little bit more secure if we can

666
00:27:31,179 --> 00:27:36,849
ship that out for them if there is no

667
00:27:34,239 --> 00:27:40,450
proof of concept exploit also amazing

668
00:27:36,849 --> 00:27:45,158
now I know what to hunt for nobody else

669
00:27:40,450 --> 00:27:48,039
has seen it right so we have a bit of

670
00:27:45,159 --> 00:27:49,629
like a hunting process when there is no

671
00:27:48,039 --> 00:27:52,929
proof of concept of proof of concept

672
00:27:49,629 --> 00:27:54,699
code publicly it's a we basically put a

673
00:27:52,929 --> 00:27:58,119
yahwah rule up in virustotal

674
00:27:54,700 --> 00:27:59,709
a hunting rule when it matches it will

675
00:27:58,119 --> 00:28:02,049
submit there's a process of submits this

676
00:27:59,709 --> 00:28:03,779
into writes instances plunk but Splunk

677
00:28:02,049 --> 00:28:05,400
automatically submits it into a VM ray

678
00:28:03,779 --> 00:28:08,850
the sandbox

679
00:28:05,400 --> 00:28:11,160
VM Rae explodes it looks at all its

680
00:28:08,850 --> 00:28:13,649
behavior all that data also gets indexed

681
00:28:11,160 --> 00:28:16,290
back into Splunk weari analyze that data

682
00:28:13,650 --> 00:28:18,390
and now we can actually write a

683
00:28:16,290 --> 00:28:19,860
detection from that exploitation right

684
00:28:18,390 --> 00:28:22,410
from that behavior analysis from that

685
00:28:19,860 --> 00:28:23,760
from the sandbox expectation plus we

686
00:28:22,410 --> 00:28:25,230
also have all the data that we collect

687
00:28:23,760 --> 00:28:26,850
in the honeypot so only that we know

688
00:28:25,230 --> 00:28:28,650
what it does when it affects you but

689
00:28:26,850 --> 00:28:31,620
also you know how is it targeting you

690
00:28:28,650 --> 00:28:34,770
right from the honeypot so that's that's

691
00:28:31,620 --> 00:28:36,870
basically what we use for analysis one

692
00:28:34,770 --> 00:28:39,480
two three four you kept doing that every

693
00:28:36,870 --> 00:28:42,060
every payload every every day show up

694
00:28:39,480 --> 00:28:43,380
like show up to work all right what do

695
00:28:42,060 --> 00:28:45,000
we what do we got what are we fishing

696
00:28:43,380 --> 00:28:47,070
what do we catch it's almost like going

697
00:28:45,000 --> 00:28:48,390
fishing every morning right we cast it

698
00:28:47,070 --> 00:28:50,010
in there we build a bunch of sense every

699
00:28:48,390 --> 00:28:51,930
morning we built a bunch of sensors for

700
00:28:50,010 --> 00:28:53,340
we wanted a cache next day we come

701
00:28:51,930 --> 00:28:54,630
around it what do we catch I let's

702
00:28:53,340 --> 00:28:55,800
analyze it what was interesting

703
00:28:54,630 --> 00:28:58,220
all right this is what we got a right

704
00:28:55,800 --> 00:29:00,600
detections for now we had a workflow I

705
00:28:58,220 --> 00:29:03,000
something I started off as an experiment

706
00:29:00,600 --> 00:29:05,909
became a workflow for us to build

707
00:29:03,000 --> 00:29:10,610
detections the next step is how can I do

708
00:29:05,910 --> 00:29:13,110
it faster we'll get to that in a second

709
00:29:10,610 --> 00:29:16,139
what do we learn first off let me just

710
00:29:13,110 --> 00:29:17,790
really really quickly recap what the

711
00:29:16,140 --> 00:29:19,550
learning exercise was and going through

712
00:29:17,790 --> 00:29:23,220
this workflow a few times afterwards

713
00:29:19,550 --> 00:29:24,540
first like you saw in the video some

714
00:29:23,220 --> 00:29:27,600
actors just knew they were in a honeypot

715
00:29:24,540 --> 00:29:29,520
they just knew either they did because

716
00:29:27,600 --> 00:29:31,679
we made a mistake in the way things were

717
00:29:29,520 --> 00:29:33,300
configured or we learned something or we

718
00:29:31,680 --> 00:29:36,390
didn't know how to configure but some

719
00:29:33,300 --> 00:29:38,610
knew and they just hopped off second

720
00:29:36,390 --> 00:29:41,370
thing we learned was the longer we took

721
00:29:38,610 --> 00:29:43,050
to analyze something the worse the more

722
00:29:41,370 --> 00:29:45,300
worthless it became the less useful

723
00:29:43,050 --> 00:29:47,940
became what do I mean Bella again let's

724
00:29:45,300 --> 00:29:50,520
take back the purl the purl bar because

725
00:29:47,940 --> 00:29:52,620
we've clarified days in advance we were

726
00:29:50,520 --> 00:29:54,870
able to build the detections five days

727
00:29:52,620 --> 00:29:57,209
before anybody else knew in the public

728
00:29:54,870 --> 00:29:58,889
domain that this was the thing which

729
00:29:57,210 --> 00:30:03,600
means our customers now can get a

730
00:29:58,890 --> 00:30:05,970
detection sooner and the only reason

731
00:30:03,600 --> 00:30:07,500
timing is key is that attacker knows is

732
00:30:05,970 --> 00:30:09,030
being exposed right there's public

733
00:30:07,500 --> 00:30:12,570
reports about this guess what he's gonna

734
00:30:09,030 --> 00:30:15,720
do is gonna burn you see to move on he

735
00:30:12,570 --> 00:30:18,879
lost so can't sit on this stuff for too

736
00:30:15,720 --> 00:30:23,350
long I'm gonna see too long on me like

737
00:30:18,880 --> 00:30:25,540
a week is too long already so we we we

738
00:30:23,350 --> 00:30:28,270
learned that we needed to improve how

739
00:30:25,540 --> 00:30:30,250
fast we analyze system this winter that

740
00:30:28,270 --> 00:30:32,800
worked when I 1 2 3 4 needed to be

741
00:30:30,250 --> 00:30:34,930
almost as automated as possible last

742
00:30:32,800 --> 00:30:36,220
thing we learn is we were dropping date

743
00:30:34,930 --> 00:30:37,840
and we're leaving data in the table we

744
00:30:36,220 --> 00:30:41,170
were not collecting everything we wanted

745
00:30:37,840 --> 00:30:42,970
to with an SSH honeypot because by its

746
00:30:41,170 --> 00:30:45,970
nature we were not hosting any

747
00:30:42,970 --> 00:30:48,460
applications he was just as SSA service

748
00:30:45,970 --> 00:30:51,670
we were in lost in Drupal we're hosting

749
00:30:48,460 --> 00:30:53,590
anything like WordPress or a database as

750
00:30:51,670 --> 00:30:56,920
public or any worse plunking business

751
00:30:53,590 --> 00:30:59,129
but public Splunk instance so we knew

752
00:30:56,920 --> 00:31:01,780
that the next thing we wanted to do to

753
00:30:59,130 --> 00:31:04,360
continue this experiment was cache

754
00:31:01,780 --> 00:31:05,560
application-specific the day of the

755
00:31:04,360 --> 00:31:07,449
application layer of the attack and

756
00:31:05,560 --> 00:31:14,500
application specific attacks as well not

757
00:31:07,450 --> 00:31:16,060
just the SSH service so enter Club and

758
00:31:14,500 --> 00:31:18,520
this is why I'm not in marketing by the

759
00:31:16,060 --> 00:31:21,899
way they let me call it clap and I go

760
00:31:18,520 --> 00:31:26,950
surprise it stands for kernel log

761
00:31:21,900 --> 00:31:28,990
application and the reason it's kernel

762
00:31:26,950 --> 00:31:31,480
long application mainly is because

763
00:31:28,990 --> 00:31:34,660
assisting forget the Cystic in a second

764
00:31:31,480 --> 00:31:35,710
what is clap clap is first off its a

765
00:31:34,660 --> 00:31:39,610
real operating system

766
00:31:35,710 --> 00:31:42,790
nothing is emulated Rio us that has its

767
00:31:39,610 --> 00:31:44,679
pros and it's cons Pro we no longer have

768
00:31:42,790 --> 00:31:46,149
to do this whole I need to fake a

769
00:31:44,680 --> 00:31:47,440
command for the attacker because we

770
00:31:46,150 --> 00:31:48,550
don't have the command or how to fake

771
00:31:47,440 --> 00:31:49,930
the date of the attacker

772
00:31:48,550 --> 00:31:51,909
no no you're inflicting a real system

773
00:31:49,930 --> 00:31:52,360
this is the real deal my friend come

774
00:31:51,910 --> 00:31:56,310
hack it

775
00:31:52,360 --> 00:31:59,469
wait come come deploy your malware here

776
00:31:56,310 --> 00:32:01,330
there's a contra you're giving the

777
00:31:59,470 --> 00:32:03,220
attacker an infected sister or you learn

778
00:32:01,330 --> 00:32:05,889
about that infect the system

779
00:32:03,220 --> 00:32:07,780
clearly for research purposes here but

780
00:32:05,890 --> 00:32:11,650
you still need to go clean that up

781
00:32:07,780 --> 00:32:13,210
because I know they can pivot off of

782
00:32:11,650 --> 00:32:14,710
your system and do all the bad things

783
00:32:13,210 --> 00:32:18,700
and you don't want that you're gonna get

784
00:32:14,710 --> 00:32:21,160
in trouble result but second I mention

785
00:32:18,700 --> 00:32:23,650
cystic I love system assist a fanboy

786
00:32:21,160 --> 00:32:25,840
enough familiar with cystic cystic is

787
00:32:23,650 --> 00:32:29,920
like if somebody took TCP dump Wireshark

788
00:32:25,840 --> 00:32:32,709
DTrace ass trace and oddity smash it on

789
00:32:29,920 --> 00:32:34,450
to one giant beautiful tool since this

790
00:32:32,710 --> 00:32:36,429
sits at the kernel level of the

791
00:32:34,450 --> 00:32:37,600
operating system it can see everything

792
00:32:36,429 --> 00:32:39,460
that's happening at the kernel level of

793
00:32:37,600 --> 00:32:40,209
the US what does that mean it sees our

794
00:32:39,460 --> 00:32:42,279
network

795
00:32:40,210 --> 00:32:44,679
everything goes everything every network

796
00:32:42,279 --> 00:32:48,700
packet goes to the kernel every

797
00:32:44,679 --> 00:32:50,980
application call so everything basically

798
00:32:48,700 --> 00:32:54,039
every kernel call that any user land

799
00:32:50,980 --> 00:32:56,230
application is making and as well as it

800
00:32:54,039 --> 00:32:57,309
it again because it's also seen in the

801
00:32:56,230 --> 00:32:58,629
kernel level is also seeing all that all

802
00:32:57,309 --> 00:33:00,279
the behaviors from the operating system

803
00:32:58,629 --> 00:33:02,678
logs being written by different

804
00:33:00,279 --> 00:33:04,210
applications in the US and so forth it's

805
00:33:02,679 --> 00:33:09,039
almost like having god mode visibility

806
00:33:04,210 --> 00:33:10,720
on the US so certain extent Falco so so

807
00:33:09,039 --> 00:33:13,690
we use this big basic sorry before I

808
00:33:10,720 --> 00:33:16,149
jump into parkour we uses dig to collect

809
00:33:13,690 --> 00:33:18,369
Oh what one thing the Cystic does is it

810
00:33:16,149 --> 00:33:21,039
allows you to write the information is

811
00:33:18,369 --> 00:33:23,499
seen on the kernel to a thing called

812
00:33:21,039 --> 00:33:25,240
like s cap again think of P cups just

813
00:33:23,499 --> 00:33:27,369
ran extensive in unfamiliar thing but

814
00:33:25,240 --> 00:33:28,480
basic a capture file of everything to

815
00:33:27,369 --> 00:33:30,129
happen in the operating system so you

816
00:33:28,480 --> 00:33:32,049
can write it to a file and then read it

817
00:33:30,129 --> 00:33:33,549
back and some other system right you can

818
00:33:32,049 --> 00:33:37,779
move it off there and read it back at

819
00:33:33,549 --> 00:33:39,610
some other system so far co-develop by

820
00:33:37,779 --> 00:33:42,490
the same company that writes the the

821
00:33:39,610 --> 00:33:44,799
build system both there's a software

822
00:33:42,490 --> 00:33:46,960
behind like they saw a cloud service but

823
00:33:44,799 --> 00:33:49,830
most tools are open-source parkus is on

824
00:33:46,960 --> 00:33:52,299
top of cystic and has implements rules

825
00:33:49,830 --> 00:33:54,759
detection rules for everything that's

826
00:33:52,299 --> 00:33:56,679
happening on the kernel so if your

827
00:33:54,759 --> 00:33:58,330
attacker is messing for example he's

828
00:33:56,679 --> 00:34:00,580
dropping a rootkit and he's messing with

829
00:33:58,330 --> 00:34:03,699
binaries like changing the way binaries

830
00:34:00,580 --> 00:34:04,090
behave Paco will detect that can alert

831
00:34:03,700 --> 00:34:06,850
you

832
00:34:04,090 --> 00:34:08,409
well since Dixie's de Oracle has a rule

833
00:34:06,850 --> 00:34:10,480
checking it or anybody near is being

834
00:34:08,409 --> 00:34:16,290
modified consistently and in with one

835
00:34:10,480 --> 00:34:18,879
matches it alerts you finally or

836
00:34:16,290 --> 00:34:20,319
applications where our application was

837
00:34:18,879 --> 00:34:21,790
that the other thing we wanna layer on

838
00:34:20,319 --> 00:34:22,989
top of this honeypot right we were

839
00:34:21,790 --> 00:34:26,168
living that in the table so we want to

840
00:34:22,989 --> 00:34:29,888
be able to support mimicking

841
00:34:26,168 --> 00:34:31,509
applications on honor systems and so

842
00:34:29,889 --> 00:34:32,559
because you have a real operating

843
00:34:31,510 --> 00:34:34,270
systems we don't have to take anything

844
00:34:32,559 --> 00:34:36,460
we can literally just install anything

845
00:34:34,270 --> 00:34:38,250
we want and reconfigure it to log and

846
00:34:36,460 --> 00:34:41,649
see how an exploit

847
00:34:38,250 --> 00:34:43,809
and finally we wrote this thing called

848
00:34:41,649 --> 00:34:46,299
the got an s3 bucket sink that we were

849
00:34:43,809 --> 00:34:47,980
basically a sink two tools like really

850
00:34:46,300 --> 00:34:52,179
way too much credit is like a one-liner

851
00:34:47,980 --> 00:34:55,300
but what it does is very important to

852
00:34:52,179 --> 00:34:58,320
the functionality of club which is we

853
00:34:55,300 --> 00:35:02,050
uses the to write captures of the kernel

854
00:34:58,320 --> 00:35:04,300
ds3 sink to pools that back out to out

855
00:35:02,050 --> 00:35:07,090
of the system and into a bucket that we

856
00:35:04,300 --> 00:35:09,790
only have access to that right function

857
00:35:07,090 --> 00:35:11,500
that's only it does only although the

858
00:35:09,790 --> 00:35:13,270
credit that we basically put in the

859
00:35:11,500 --> 00:35:15,370
honeypot can only write you can't list

860
00:35:13,270 --> 00:35:17,320
items on the bucket you can't get items

861
00:35:15,370 --> 00:35:18,910
from that bucket you can only dump stuff

862
00:35:17,320 --> 00:35:20,290
into the bucket so if god forbid an

863
00:35:18,910 --> 00:35:22,600
attacker realizes that we have this

864
00:35:20,290 --> 00:35:24,790
thing to land they get the bucket URL

865
00:35:22,600 --> 00:35:26,920
all they can do is a big dump a bunch of

866
00:35:24,790 --> 00:35:28,120
garbage in there which is okay we can

867
00:35:26,920 --> 00:35:31,080
just rotate the bucket you are on life

868
00:35:28,120 --> 00:35:34,299
is good and then they leave the garbage

869
00:35:31,080 --> 00:35:37,060
but the high level I'm a visual person

870
00:35:34,300 --> 00:35:38,350
so like a quick diagram for this this is

871
00:35:37,060 --> 00:35:40,660
what the architecture kind of looks like

872
00:35:38,350 --> 00:35:42,130
you have an attacker will exploit an

873
00:35:40,660 --> 00:35:44,700
application take you to the typical

874
00:35:42,130 --> 00:35:50,670
WordPress Drupal so on and so forth

875
00:35:44,700 --> 00:35:53,169
application once he exploits it again

876
00:35:50,670 --> 00:35:54,970
for example this is like a remote code

877
00:35:53,170 --> 00:35:57,340
execution he finds a remote connection

878
00:35:54,970 --> 00:35:59,529
in an application to drop malware and

879
00:35:57,340 --> 00:36:01,330
we'll have cystic sitting on that box

880
00:35:59,530 --> 00:36:02,220
listening to everything that's happening

881
00:36:01,330 --> 00:36:04,240
in writing

882
00:36:02,220 --> 00:36:06,850
captures of everything that's happening

883
00:36:04,240 --> 00:36:09,189
in the box so since they will see the

884
00:36:06,850 --> 00:36:11,049
network traffic since they will see how

885
00:36:09,190 --> 00:36:13,330
he exploited it and since they will also

886
00:36:11,050 --> 00:36:18,820
see the events that get generated every

887
00:36:13,330 --> 00:36:20,920
soak up Fargo this has rules based on

888
00:36:18,820 --> 00:36:22,510
what system is seen and it serves as an

889
00:36:20,920 --> 00:36:24,580
early warning system for us going back

890
00:36:22,510 --> 00:36:27,630
to you guys remember analysis timing is

891
00:36:24,580 --> 00:36:31,029
key that's how we split that up

892
00:36:27,630 --> 00:36:33,250
basically wired Falco to send us a slack

893
00:36:31,030 --> 00:36:36,970
message and we have this team channel

894
00:36:33,250 --> 00:36:39,100
like a this honeypot is to mean tamper

895
00:36:36,970 --> 00:36:40,930
with now we know which honeypot to look

896
00:36:39,100 --> 00:36:42,700
at immediately we don't know what they

897
00:36:40,930 --> 00:36:44,230
did we don't know what's getting done in

898
00:36:42,700 --> 00:36:45,250
there but at least we know which ones

899
00:36:44,230 --> 00:36:48,160
getting messed with and we know which

900
00:36:45,250 --> 00:36:49,720
one we got to rebuild and that way we

901
00:36:48,160 --> 00:36:51,279
can jump on it right away so you're

902
00:36:49,720 --> 00:36:54,910
almost research becomes almost to some

903
00:36:51,280 --> 00:36:56,650
extent operational finally the sync tool

904
00:36:54,910 --> 00:36:58,899
is grabbing all those capture files

905
00:36:56,650 --> 00:37:00,160
assisted is writing and pulling it back

906
00:36:58,900 --> 00:37:02,050
into an s3 bucket

907
00:37:00,160 --> 00:37:03,460
that then we have access to that way we

908
00:37:02,050 --> 00:37:05,650
can burn the machine when the attacker

909
00:37:03,460 --> 00:37:07,270
where we think the attacker is done you

910
00:37:05,650 --> 00:37:09,520
can burn the machine but we still keep

911
00:37:07,270 --> 00:37:12,340
the data that they generated to build

912
00:37:09,520 --> 00:37:14,700
detections out of and that's the idea

913
00:37:12,340 --> 00:37:17,710
behind clock essentially real machine

914
00:37:14,700 --> 00:37:19,180
will be emulated application using

915
00:37:17,710 --> 00:37:21,310
sitting on file call in the hood

916
00:37:19,180 --> 00:37:24,430
Marko's are only warning system presence

917
00:37:21,310 --> 00:37:27,670
is did to collect data and then we pull

918
00:37:24,430 --> 00:37:29,080
everything off for analysis and I just

919
00:37:27,670 --> 00:37:31,360
explain the analysis methodology behind

920
00:37:29,080 --> 00:37:35,860
it although with clap it's a little bit

921
00:37:31,360 --> 00:37:37,180
different why we assisted since thing

922
00:37:35,860 --> 00:37:40,600
has this beautiful thing

923
00:37:37,180 --> 00:37:43,000
and this really is beautiful like called

924
00:37:40,600 --> 00:37:46,120
chisels and chisels it chisels nothing

925
00:37:43,000 --> 00:37:48,760
more than a filter applied to this is a

926
00:37:46,120 --> 00:37:50,710
data think of like an map NSE scripts if

927
00:37:48,760 --> 00:37:52,900
you're familiar just rebuild scripts

928
00:37:50,710 --> 00:37:56,050
basically the operating supper cystic to

929
00:37:52,900 --> 00:37:58,960
queries data now why are sizzles amazing

930
00:37:56,050 --> 00:38:02,230
from from an analysis standpoint with

931
00:37:58,960 --> 00:38:04,210
the chisel simple chisel you can grab

932
00:38:02,230 --> 00:38:06,490
all the system logs I no longer have to

933
00:38:04,210 --> 00:38:08,170
put a Splunk forwarder or a file B

934
00:38:06,490 --> 00:38:11,319
folder or any kind of forwarder and

935
00:38:08,170 --> 00:38:13,090
compromise that I can do it offline

936
00:38:11,320 --> 00:38:14,470
after I've bring down the machine

937
00:38:13,090 --> 00:38:18,970
because I know that machine is infected

938
00:38:14,470 --> 00:38:21,040
and Greta's logs for analysis but not

939
00:38:18,970 --> 00:38:22,810
only that's it can your query logs or

940
00:38:21,040 --> 00:38:25,840
can you pull logs out of a capture file

941
00:38:22,810 --> 00:38:27,690
you can also look at all the TCP

942
00:38:25,840 --> 00:38:29,980
connections clearly again you can

943
00:38:27,690 --> 00:38:31,030
extract capture files out of this if you

944
00:38:29,980 --> 00:38:34,750
wanted to look at stuff in the neck

945
00:38:31,030 --> 00:38:36,240
earlier top connections if you wanted to

946
00:38:34,750 --> 00:38:40,450
see easily like what's getting us ready

947
00:38:36,240 --> 00:38:43,140
extradite out of our box cystic also has

948
00:38:40,450 --> 00:38:48,009
a break down for all HTTP communication

949
00:38:43,140 --> 00:38:51,040
requests some responses he DP long super

950
00:38:48,010 --> 00:38:53,620
super simple and straightforward this is

951
00:38:51,040 --> 00:38:56,470
one of the coolest Liz login shells sis

952
00:38:53,620 --> 00:38:57,850
dig then everything on the kernel not

953
00:38:56,470 --> 00:38:59,259
only doesn't know what shells are logged

954
00:38:57,850 --> 00:39:02,380
in but it gives you all the commands

955
00:38:59,260 --> 00:39:05,170
being typed on my show so I know every

956
00:39:02,380 --> 00:39:08,220
command that attacker typed while he was

957
00:39:05,170 --> 00:39:08,220
hacking the box

958
00:39:08,790 --> 00:39:14,970
very useful finally the final example

959
00:39:12,780 --> 00:39:17,520
when I show you this pipe or hey you

960
00:39:14,970 --> 00:39:19,290
need TCB done out of the box

961
00:39:17,520 --> 00:39:20,910
alrighty see beyond outer box this is

962
00:39:19,290 --> 00:39:22,740
pretty much it's my port gives you all a

963
00:39:20,910 --> 00:39:25,109
network traffic for a specific port from

964
00:39:22,740 --> 00:39:26,790
a capture file again this is not on a

965
00:39:25,109 --> 00:39:29,430
live system this is post tense after

966
00:39:26,790 --> 00:39:31,790
we've burned the box and you know we've

967
00:39:29,430 --> 00:39:35,460
already seen the attack

968
00:39:31,790 --> 00:39:37,880
it makes Batman cry basically from the

969
00:39:35,460 --> 00:39:40,380
tools of perspective is so useful I

970
00:39:37,880 --> 00:39:44,550
didn't mention right I mentioned the fog

971
00:39:40,380 --> 00:39:46,080
go has we wired up for slack right and

972
00:39:44,550 --> 00:39:48,570
this is what da slack alerts kind of

973
00:39:46,080 --> 00:39:50,240
look like Mike you know imagine if

974
00:39:48,570 --> 00:39:53,280
somebody was in you know it's a bad foul

975
00:39:50,240 --> 00:39:55,229
you get an alert it's like a mr.

976
00:39:53,280 --> 00:39:55,710
researcher this honey pots just got

977
00:39:55,230 --> 00:40:00,060
tampered with

978
00:39:55,710 --> 00:40:03,210
does we build it well all set

979
00:40:00,060 --> 00:40:06,380
let me show you a quick demo so you know

980
00:40:03,210 --> 00:40:10,080
prefaces them away we're not releasing

981
00:40:06,380 --> 00:40:12,270
collapse code yet we're only releasing a

982
00:40:10,080 --> 00:40:15,450
sample of the code we don't feel ready

983
00:40:12,270 --> 00:40:19,800
yet to release it but this is a demo of

984
00:40:15,450 --> 00:40:20,640
the sample code we're releasing and the

985
00:40:19,800 --> 00:40:23,130
other thing I want to make a note of

986
00:40:20,640 --> 00:40:27,750
before I show you the demo is going back

987
00:40:23,130 --> 00:40:31,740
to that point of ease-of-use and speed

988
00:40:27,750 --> 00:40:34,200
of building we've rewired clap to be

989
00:40:31,740 --> 00:40:36,118
built using terraform and ansible see

990
00:40:34,200 --> 00:40:38,220
all of this you know the build process

991
00:40:36,119 --> 00:40:41,310
purse siz they file quick cetera et

992
00:40:38,220 --> 00:40:44,368
cetera it's now done by ansible as Play

993
00:40:41,310 --> 00:40:47,220
Books and using terraform we can easy to

994
00:40:44,369 --> 00:40:50,550
deploy swath of claps across multiple

995
00:40:47,220 --> 00:40:52,919
cloud providers hey I need to study and

996
00:40:50,550 --> 00:40:54,330
it's Australia the latest WordPress for

997
00:40:52,920 --> 00:40:58,770
nobility or I wanna study where personal

998
00:40:54,330 --> 00:41:01,680
abilities across AWS GCP and Zuri to

999
00:40:58,770 --> 00:41:02,790
perfect 15 minutes later we have a bunch

1000
00:41:01,680 --> 00:41:05,640
of sensors all over the place for that

1001
00:41:02,790 --> 00:41:08,160
so we can easily tailor them and then

1002
00:41:05,640 --> 00:41:10,980
deploy them and again the idea is to do

1003
00:41:08,160 --> 00:41:12,089
this almost in a weekly basis or per

1004
00:41:10,980 --> 00:41:16,520
whatever I talked with want to study

1005
00:41:12,089 --> 00:41:16,520
okay let me pull up the demo really

1006
00:41:20,979 --> 00:41:29,209
so again clap sample releasing the

1007
00:41:26,959 --> 00:41:30,859
fourth thing yet but here's a here's a

1008
00:41:29,209 --> 00:41:35,989
quick example of like what the build

1009
00:41:30,859 --> 00:41:38,679
process looks like so nearly terraform

1010
00:41:35,989 --> 00:41:40,729
apply like I mentioned earlier the

1011
00:41:38,679 --> 00:41:42,859
machines it solved for just

1012
00:41:40,729 --> 00:41:45,319
orchestrating the build to terraform it

1013
00:41:42,859 --> 00:41:47,808
goes out there not only does it build it

1014
00:41:45,319 --> 00:41:49,819
builds up a full-blown BBC this one's

1015
00:41:47,809 --> 00:41:50,449
actually we're operating off of AWS

1016
00:41:49,819 --> 00:41:53,269
right now

1017
00:41:50,449 --> 00:41:56,029
so those full-blown BBC with all the

1018
00:41:53,269 --> 00:41:58,069
security groups allowing whatever ports

1019
00:41:56,029 --> 00:42:00,079
you need in this instance I'm trying to

1020
00:41:58,069 --> 00:42:01,880
emulate the same thing as we were doing

1021
00:42:00,079 --> 00:42:05,390
with the car II kind of like continue

1022
00:42:01,880 --> 00:42:07,429
that experiment so builds your firewall

1023
00:42:05,390 --> 00:42:10,089
rules the subnets for that for the

1024
00:42:07,429 --> 00:42:12,559
region they're built their abilities own

1025
00:42:10,089 --> 00:42:13,819
Alban access for attackers so in case he

1026
00:42:12,559 --> 00:42:15,979
wants to extradite anything from the

1027
00:42:13,819 --> 00:42:18,619
honeypot hey you have an outbound Rob

1028
00:42:15,979 --> 00:42:21,169
please go for it let me know where

1029
00:42:18,619 --> 00:42:23,660
you're talking to so I can know you know

1030
00:42:21,170 --> 00:42:28,119
which city to shut down right oh what's

1031
00:42:23,660 --> 00:42:31,489
your drop site and sorry

1032
00:42:28,119 --> 00:42:33,459
builds an instance apply some public IP

1033
00:42:31,489 --> 00:42:35,509
to that instance and now you have a

1034
00:42:33,459 --> 00:42:43,308
honeypot out in the public Internet

1035
00:42:35,509 --> 00:42:46,039
running out of PWS and some again going

1036
00:42:43,309 --> 00:42:47,239
back from the work we do a Cowrie when

1037
00:42:46,039 --> 00:42:53,150
we're trying to emulate some of that

1038
00:42:47,239 --> 00:42:55,369
with cloud right it's version 1 we we we

1039
00:42:53,150 --> 00:42:57,650
put as a as a variables file and ansible

1040
00:42:55,369 --> 00:43:01,640
you can put any any user name you want

1041
00:42:57,650 --> 00:43:03,640
to capture traffic for in SSH and we do

1042
00:43:01,640 --> 00:43:06,348
some magic under the hood with Pandy and

1043
00:43:03,640 --> 00:43:08,420
any login will be allowed under that

1044
00:43:06,349 --> 00:43:13,519
user so for example in the Postgres user

1045
00:43:08,420 --> 00:43:15,859
here if you try to assess age using a

1046
00:43:13,519 --> 00:43:17,058
sample that was just no matter what the

1047
00:43:15,859 --> 00:43:19,308
passphrase was just like let that

1048
00:43:17,059 --> 00:43:21,109
attacker in hell by the way that pastor

1049
00:43:19,309 --> 00:43:25,099
also gets captured it's part of the

1050
00:43:21,109 --> 00:43:26,900
honeypot locks so and and again just

1051
00:43:25,099 --> 00:43:29,299
imagine this is an attacker messing with

1052
00:43:26,900 --> 00:43:30,109
with things dropping now a shell right

1053
00:43:29,299 --> 00:43:33,559
that logged in

1054
00:43:30,109 --> 00:43:35,180
you're dropping a shell running a bunch

1055
00:43:33,559 --> 00:43:37,369
of commands which is generating noise

1056
00:43:35,180 --> 00:43:39,529
here but under the hood cystic is

1057
00:43:37,369 --> 00:43:40,430
capturing all of this right it's running

1058
00:43:39,529 --> 00:43:44,749
on the kernel capturing everything

1059
00:43:40,430 --> 00:43:48,230
that's happening and so you're gonna see

1060
00:43:44,749 --> 00:43:51,288
in a second the analysis of uh actually

1061
00:43:48,230 --> 00:43:52,670
I'm going to jump up up to another box

1062
00:43:51,289 --> 00:43:54,410
where the collector collection is

1063
00:43:52,670 --> 00:43:56,210
happening so I can show you what the

1064
00:43:54,410 --> 00:43:58,519
syncing process looks like out of the

1065
00:43:56,210 --> 00:44:00,739
box the syncing process today is not

1066
00:43:58,519 --> 00:44:03,859
ideal I warn you it's it's using cron

1067
00:44:00,739 --> 00:44:05,660
and it's a simple very done dump again

1068
00:44:03,859 --> 00:44:08,150
cron job that just sings everything

1069
00:44:05,660 --> 00:44:11,509
that's getting collected by Cystic up to

1070
00:44:08,150 --> 00:44:13,039
an s3 bucket that again

1071
00:44:11,509 --> 00:44:15,680
I didn't go home right about but it

1072
00:44:13,039 --> 00:44:17,539
works and if an attacker again gets

1073
00:44:15,680 --> 00:44:20,239
ahold of whatever the bucket is we can

1074
00:44:17,539 --> 00:44:22,519
always rotate it credentials only allow

1075
00:44:20,239 --> 00:44:24,049
you to write or is it rotate credentials

1076
00:44:22,519 --> 00:44:25,368
in that case but we will know if they

1077
00:44:24,049 --> 00:44:32,269
did because we have all the commands

1078
00:44:25,369 --> 00:44:34,489
they ran on our again our researchers on

1079
00:44:32,269 --> 00:44:37,279
on our and we sync that data back down

1080
00:44:34,489 --> 00:44:39,319
and then we start analyzing it with sis

1081
00:44:37,279 --> 00:44:40,849
dig we're now actually working with

1082
00:44:39,319 --> 00:44:43,308
other things we're not ready to release

1083
00:44:40,849 --> 00:44:45,349
the CSS we want to build scripts that

1084
00:44:43,309 --> 00:44:47,960
will automatically run all those system

1085
00:44:45,349 --> 00:44:49,549
chisels and get that data and index into

1086
00:44:47,960 --> 00:44:51,499
Splunk so we can just build a nice

1087
00:44:49,549 --> 00:44:52,970
pretty dashboard but all the data we

1088
00:44:51,499 --> 00:44:55,308
collected we're not there yeah but

1089
00:44:52,970 --> 00:44:58,459
that's that's this kind of the goal the

1090
00:44:55,309 --> 00:45:02,269
next next systems here is a spy user

1091
00:44:58,460 --> 00:45:04,970
shizzle from the capture file and I'm

1092
00:45:02,269 --> 00:45:07,519
grabbing from heap I'm gripping your I'm

1093
00:45:04,970 --> 00:45:09,019
filtering for here remember that I typed

1094
00:45:07,519 --> 00:45:11,209
the first thing I did when I logged into

1095
00:45:09,019 --> 00:45:13,879
the box was my malicious script here or

1096
00:45:11,210 --> 00:45:19,039
whatever you see that command from the

1097
00:45:13,880 --> 00:45:20,450
capture file and insist a grid no I mean

1098
00:45:19,039 --> 00:45:23,319
we can analyze everything that I talked

1099
00:45:20,450 --> 00:45:26,029
I did everything he typed on that shell

1100
00:45:23,319 --> 00:45:27,769
us by users by users gives you basically

1101
00:45:26,029 --> 00:45:28,099
all the users interaction broken down by

1102
00:45:27,769 --> 00:45:30,919
user

1103
00:45:28,099 --> 00:45:34,940
Spy logs gives you other raw logs on

1104
00:45:30,920 --> 00:45:38,210
that box every raw log written on that

1105
00:45:34,940 --> 00:45:40,999
system which is awesome without any

1106
00:45:38,210 --> 00:45:42,750
agents on you have a bunch other stuff

1107
00:45:40,999 --> 00:45:45,359
that you can run right like just

1108
00:45:42,750 --> 00:45:46,410
I can mention this Login shells there's

1109
00:45:45,359 --> 00:45:48,450
stuff like if you're if you're running

1110
00:45:46,410 --> 00:45:49,920
containers there's most of you you can

1111
00:45:48,450 --> 00:45:51,509
you can look into like see they're

1112
00:45:49,920 --> 00:45:53,280
trying to do like container escapes and

1113
00:45:51,510 --> 00:45:55,190
see what they're getting hooked into for

1114
00:45:53,280 --> 00:45:57,660
that kind of stuff

1115
00:45:55,190 --> 00:45:58,980
now here I'm listening the login shells

1116
00:45:57,660 --> 00:46:01,259
for example the different bids for the

1117
00:45:58,980 --> 00:46:03,800
flying shelf and you can query what what

1118
00:46:01,260 --> 00:46:06,330
those bids in as well

1119
00:46:03,800 --> 00:46:08,010
top connections actually this is a

1120
00:46:06,330 --> 00:46:09,540
pretty neat one for like if you want to

1121
00:46:08,010 --> 00:46:12,330
see if your attackers extraditing data

1122
00:46:09,540 --> 00:46:14,400
and what port and what would they're

1123
00:46:12,330 --> 00:46:17,069
trying to put on top connections I'm

1124
00:46:14,400 --> 00:46:19,530
sorry is getting caught up but clearly

1125
00:46:17,070 --> 00:46:22,170
is the necessary pot so top connection

1126
00:46:19,530 --> 00:46:37,050
is gonna be SSH inbound which is we

1127
00:46:22,170 --> 00:46:40,140
you're seeing there so yeah so that's an

1128
00:46:37,050 --> 00:46:42,750
example of again how less than like a

1129
00:46:40,140 --> 00:46:45,240
minute or to build a honeypot sensor in

1130
00:46:42,750 --> 00:46:47,130
AWS and he was already collecting data I

1131
00:46:45,240 --> 00:46:49,649
showed you how we unlike you can analyze

1132
00:46:47,130 --> 00:46:51,630
some of the data out of the box and and

1133
00:46:49,650 --> 00:46:55,859
I show you some of the power you get out

1134
00:46:51,630 --> 00:46:58,680
of assisting if for whatever reason you

1135
00:46:55,859 --> 00:47:00,990
can I use this thing another good

1136
00:46:58,680 --> 00:47:03,419
alternative not perfect but a good

1137
00:47:00,990 --> 00:47:05,189
alternative it's always squirt the

1138
00:47:03,420 --> 00:47:07,230
reason it's not perfect this is dig is

1139
00:47:05,190 --> 00:47:09,000
not query base it's always listening and

1140
00:47:07,230 --> 00:47:11,520
it's always capturing or squaring is

1141
00:47:09,000 --> 00:47:12,720
querying the OS internals storing that

1142
00:47:11,520 --> 00:47:15,240
an in-memory database and then you've

1143
00:47:12,720 --> 00:47:16,740
got a query the hop so it's a good

1144
00:47:15,240 --> 00:47:19,169
alternative if you can't for two reasons

1145
00:47:16,740 --> 00:47:21,479
one cystic um citizen does this by the

1146
00:47:19,170 --> 00:47:23,369
way as a kernel injects the kernel

1147
00:47:21,480 --> 00:47:28,650
module so as I was doing that enjoy that

1148
00:47:23,369 --> 00:47:31,250
collection so some takeaways for us and

1149
00:47:28,650 --> 00:47:31,250
you

1150
00:47:31,960 --> 00:47:36,460
hi interaction honeypot silhouette ago I

1151
00:47:33,940 --> 00:47:37,869
think it was a wasn't necessarily a

1152
00:47:36,460 --> 00:47:40,930
mistake but it was a lesson learned from

1153
00:47:37,869 --> 00:47:41,829
us not not to use medium interaction or

1154
00:47:40,930 --> 00:47:43,390
anything like that we spent a lot of

1155
00:47:41,829 --> 00:47:45,010
time trying to tailor that medium

1156
00:47:43,390 --> 00:47:46,390
interaction environment to make a

1157
00:47:45,010 --> 00:47:47,740
palpable for the attacker meanwhile we

1158
00:47:46,390 --> 00:47:50,558
could have just ran a real box would be

1159
00:47:47,740 --> 00:47:54,910
so much easier so PI interaction honey

1160
00:47:50,559 --> 00:47:59,680
pots here we go go honeypot data can be

1161
00:47:54,910 --> 00:48:00,970
as valuable story intelligence it the

1162
00:47:59,680 --> 00:48:04,149
proof is in the pudding we were seeing

1163
00:48:00,970 --> 00:48:05,919
stuff way orally they will show an open

1164
00:48:04,150 --> 00:48:08,859
source oversaw spiritual feeds

1165
00:48:05,920 --> 00:48:10,690
I'm not saying turn until it's useless

1166
00:48:08,859 --> 00:48:12,299
at all there's actually really really

1167
00:48:10,690 --> 00:48:16,059
great training so providers out there

1168
00:48:12,299 --> 00:48:18,819
but this gives you a whole other set of

1169
00:48:16,059 --> 00:48:20,799
visibility and sometimes this as good or

1170
00:48:18,819 --> 00:48:22,329
better than threat intelligence for

1171
00:48:20,799 --> 00:48:25,839
being able detections into your

1172
00:48:22,329 --> 00:48:29,460
organization if you're going to mimic an

1173
00:48:25,839 --> 00:48:32,200
environment it pays off to spend time i

1174
00:48:29,460 --> 00:48:35,529
modifying it you're gonna take any

1175
00:48:32,200 --> 00:48:38,078
honeypot today available out of the box

1176
00:48:35,529 --> 00:48:39,609
and you put it in internet it's next to

1177
00:48:38,079 --> 00:48:42,069
useless that's the experience at least

1178
00:48:39,609 --> 00:48:43,538
we have a carry it was not giving us any

1179
00:48:42,069 --> 00:48:45,190
useful data at the moment we installed

1180
00:48:43,539 --> 00:48:48,010
it but we started tinkering with him

1181
00:48:45,190 --> 00:48:51,700
modifying it boy did we get really get

1182
00:48:48,010 --> 00:48:54,160
to good stuff back another point that we

1183
00:48:51,700 --> 00:48:55,629
learned was when we moved and we started

1184
00:48:54,160 --> 00:48:59,379
building a terraform logic and ansible

1185
00:48:55,630 --> 00:49:02,770
our speed collection just went through

1186
00:48:59,380 --> 00:49:06,750
the roof so infrastructure as code is

1187
00:49:02,770 --> 00:49:09,339
speed and speed means better data better

1188
00:49:06,750 --> 00:49:13,359
detections better data means better

1189
00:49:09,339 --> 00:49:15,279
detections essentially so i mean i can't

1190
00:49:13,359 --> 00:49:17,109
speak highly enough of like we're going

1191
00:49:15,279 --> 00:49:18,190
to do this kind of stuff do use them

1192
00:49:17,109 --> 00:49:19,630
just don't don't build your honey pots

1193
00:49:18,190 --> 00:49:21,160
by hand it's gonna be painful it's gonna

1194
00:49:19,630 --> 00:49:21,579
be you're gonna make mistakes it's not

1195
00:49:21,160 --> 00:49:23,970
with it

1196
00:49:21,579 --> 00:49:27,700
make it as infrastructure as code and

1197
00:49:23,970 --> 00:49:29,230
finally analysis timing is key and i

1198
00:49:27,700 --> 00:49:32,410
mentioned earlier the reason he's behind

1199
00:49:29,230 --> 00:49:33,220
the right the longer you wait the faster

1200
00:49:32,410 --> 00:49:34,629
the more time you're give me that

1201
00:49:33,220 --> 00:49:36,490
attacker just burned that environment

1202
00:49:34,630 --> 00:49:37,359
and move on the longer you wait the more

1203
00:49:36,490 --> 00:49:39,490
likely you're not gonna be able to

1204
00:49:37,359 --> 00:49:42,598
collect that data you need out of it or

1205
00:49:39,490 --> 00:49:44,759
you make use of the data you collected

1206
00:49:42,599 --> 00:49:47,280
if you wanted to get started

1207
00:49:44,760 --> 00:49:50,760
this is the github repo where the

1208
00:49:47,280 --> 00:49:52,170
example code is the installation steps

1209
00:49:50,760 --> 00:49:53,900
are really straightforward I kind of

1210
00:49:52,170 --> 00:49:57,089
just wanted to list them here for you

1211
00:49:53,900 --> 00:49:59,309
literally install terraform star WSDL I

1212
00:49:57,089 --> 00:50:04,020
put some creds for AWS in there

1213
00:49:59,309 --> 00:50:08,520
I'm just set you ready to go um any

1214
00:50:04,020 --> 00:50:11,590
questions comments suggestions please

1215
00:50:08,520 --> 00:50:11,590
[Music]

1216
00:50:13,250 --> 00:50:25,890
sure we had a so the question is do we

1217
00:50:24,089 --> 00:50:29,849
had a lot of tigers that came back or

1218
00:50:25,890 --> 00:50:31,618
they just waited we had a lot of uh but

1219
00:50:29,849 --> 00:50:33,150
we have seen a lot was like things just

1220
00:50:31,619 --> 00:50:36,900
scanning the internet and being a pro to

1221
00:50:33,150 --> 00:50:38,220
nist ik we did have two occasions where

1222
00:50:36,900 --> 00:50:41,010
things were just targeting us

1223
00:50:38,220 --> 00:50:42,509
specifically and that was again this is

1224
00:50:41,010 --> 00:50:44,819
the reason we wanted to do this to begin

1225
00:50:42,510 --> 00:50:47,849
with right but a lot of uh I would say

1226
00:50:44,819 --> 00:50:50,339
like 80% of the attacks we capture we're

1227
00:50:47,849 --> 00:50:51,660
just internet white attacks so stuff not

1228
00:50:50,339 --> 00:50:55,619
necessarily not being talked about but

1229
00:50:51,660 --> 00:51:00,740
happening in the internet consistent of

1230
00:50:55,619 --> 00:51:02,920
course questions questions comments

1231
00:51:00,740 --> 00:51:07,569
thank you very much

1232
00:51:02,920 --> 00:51:07,570
[Applause]

