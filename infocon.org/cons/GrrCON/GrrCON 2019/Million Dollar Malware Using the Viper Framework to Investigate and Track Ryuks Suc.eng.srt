1
00:00:00,000 --> 00:00:05,370
was a bloody incident I promise we don't

2
00:00:02,340 --> 00:00:06,810
want to repeat other than that we're

3
00:00:05,370 --> 00:00:08,849
gonna get this thing going

4
00:00:06,810 --> 00:00:10,980
coming up our next talk we're talking

5
00:00:08,849 --> 00:00:13,769
all about the Viper framework and using

6
00:00:10,980 --> 00:00:14,940
that to track malicious actors and so

7
00:00:13,769 --> 00:00:19,250
with that I'm gonna turn it over to

8
00:00:14,940 --> 00:00:21,420
Colin Cowie hi thank you for having me

9
00:00:19,250 --> 00:00:23,910
so just a quick introduction about

10
00:00:21,420 --> 00:00:26,400
myself I go to Purdue University I am

11
00:00:23,910 --> 00:00:29,400
about a semester and a few weeks away

12
00:00:26,400 --> 00:00:31,380
from graduating with the Bachelors of

13
00:00:29,400 --> 00:00:33,000
Science in cyber security I'll be a part

14
00:00:31,380 --> 00:00:34,769
of the first class that has gone from

15
00:00:33,000 --> 00:00:36,899
freshman year to senior year with a

16
00:00:34,770 --> 00:00:39,600
Bachelors of Science in cyber security

17
00:00:36,899 --> 00:00:41,250
as our degree track title and when I'm

18
00:00:39,600 --> 00:00:42,660
not doing it cyber security stuff I'm

19
00:00:41,250 --> 00:00:45,719
playing across on the men's lacrosse

20
00:00:42,660 --> 00:00:47,459
team and I enjoy running and skiing so

21
00:00:45,719 --> 00:00:50,340
just a quick overview about what I'll be

22
00:00:47,460 --> 00:00:52,590
talking about today is I'll be going

23
00:00:50,340 --> 00:00:54,629
over the ryuk ransomware a little bit

24
00:00:52,590 --> 00:00:56,550
about it when it first came into the

25
00:00:54,629 --> 00:00:58,379
scene and what it's done since then and

26
00:00:56,550 --> 00:01:00,629
from there I'm gonna talk about my

27
00:00:58,379 --> 00:01:03,239
individual journey of tracking this

28
00:01:00,629 --> 00:01:05,039
ransomware over time specifically with

29
00:01:03,239 --> 00:01:06,899
the Viper framework and how I've made

30
00:01:05,040 --> 00:01:09,330
some custom modules for that framework

31
00:01:06,900 --> 00:01:10,680
to assist in tracking this ransomware

32
00:01:09,330 --> 00:01:13,439
and then finally we're gonna wrap it up

33
00:01:10,680 --> 00:01:15,479
with how this methodology of tracking

34
00:01:13,439 --> 00:01:20,130
ryuk could be applied towards tracking

35
00:01:15,479 --> 00:01:23,039
other groups of ransomware or actors so

36
00:01:20,130 --> 00:01:25,080
ryuk is named after a anime character

37
00:01:23,040 --> 00:01:27,960
from Death Note and essentially in the

38
00:01:25,080 --> 00:01:30,509
show he goes around and leaves a death

39
00:01:27,960 --> 00:01:32,729
note that gives the person who picks it

40
00:01:30,509 --> 00:01:34,409
up the ability to kill one person that

41
00:01:32,729 --> 00:01:37,140
he chooses and he's seen as kind of a

42
00:01:34,409 --> 00:01:39,210
very chaotic character in the show and I

43
00:01:37,140 --> 00:01:41,009
think the actors that first developed

44
00:01:39,210 --> 00:01:44,039
ryuk really embodied that with the way

45
00:01:41,009 --> 00:01:46,979
they go about things so

46
00:01:44,040 --> 00:01:50,220
ryuk was actually modified from hermas

47
00:01:46,979 --> 00:01:52,470
2.1 which was originally used by the

48
00:01:50,220 --> 00:01:55,320
lazarus group which is attributed to

49
00:01:52,470 --> 00:01:58,649
north korea however it is not North

50
00:01:55,320 --> 00:02:00,689
Koreans who create ryuk and so initially

51
00:01:58,649 --> 00:02:03,509
when this was first identified by

52
00:02:00,689 --> 00:02:04,169
checkpoint in August of 2018 a lot of

53
00:02:03,509 --> 00:02:06,450
people said Oh

54
00:02:04,170 --> 00:02:08,039
hürmüz was used by North Korea so this

55
00:02:06,450 --> 00:02:09,869
must be North Koreans and it wasn't

56
00:02:08,038 --> 00:02:11,869
until about a few months later when some

57
00:02:09,869 --> 00:02:13,860
other security companies like

58
00:02:11,870 --> 00:02:15,810
CrowdStrike and

59
00:02:13,860 --> 00:02:17,160
I came to the public and said hey you

60
00:02:15,810 --> 00:02:19,050
guys are completely wrong this is not

61
00:02:17,160 --> 00:02:21,870
North Korea this is our typical cyber

62
00:02:19,050 --> 00:02:25,230
crime groups the way that they

63
00:02:21,870 --> 00:02:27,150
maintained their foothold and are so

64
00:02:25,230 --> 00:02:28,530
successful with actually ransom wearing

65
00:02:27,150 --> 00:02:31,290
their environments is they wait until

66
00:02:28,530 --> 00:02:33,390
they have escalated their access to

67
00:02:31,290 --> 00:02:35,970
achieving domain administrator levels

68
00:02:33,390 --> 00:02:38,040
they disable security controls disable

69
00:02:35,970 --> 00:02:40,350
antivirus and then they just encrypt

70
00:02:38,040 --> 00:02:44,070
everything they leverage good encryption

71
00:02:40,350 --> 00:02:47,390
and oftentimes they get paid so it was

72
00:02:44,070 --> 00:02:50,760
first posted on exploit a.m. in August

73
00:02:47,390 --> 00:02:53,040
2017 it is written C pretty small

74
00:02:50,760 --> 00:02:54,899
lightweight at first it only cost three

75
00:02:53,040 --> 00:02:58,049
hundred dollars I'm assuming since then

76
00:02:54,900 --> 00:03:00,390
it's probably gone up in cost but

77
00:02:58,050 --> 00:03:01,739
there's two main methods of deployment

78
00:03:00,390 --> 00:03:04,350
the first which is a little bit less

79
00:03:01,739 --> 00:03:06,060
common is through RDP brute-forcing but

80
00:03:04,350 --> 00:03:08,400
the most common methodology which you

81
00:03:06,060 --> 00:03:11,010
may have heard about in a track earlier

82
00:03:08,400 --> 00:03:13,890
yesterday is through the trick bots

83
00:03:11,010 --> 00:03:16,470
malware so first they use a motet to

84
00:03:13,890 --> 00:03:18,839
fish and obtain access to that

85
00:03:16,470 --> 00:03:21,180
environment from them from there they

86
00:03:18,840 --> 00:03:25,680
deploy trick bots as well as utilize

87
00:03:21,180 --> 00:03:27,480
other typical access privilege

88
00:03:25,680 --> 00:03:29,970
escalation tools like cobalt strike

89
00:03:27,480 --> 00:03:31,950
Empire some of that kind of stuff to

90
00:03:29,970 --> 00:03:33,750
pivot until they have control of the

91
00:03:31,950 --> 00:03:36,119
Active Directory environment and then

92
00:03:33,750 --> 00:03:40,170
ultimately they deploy ryuk and encrypt

93
00:03:36,120 --> 00:03:42,480
everything so the first thing they do

94
00:03:40,170 --> 00:03:45,298
when it actually runs on a system is it

95
00:03:42,480 --> 00:03:47,670
drops a script which runs net stop on

96
00:03:45,299 --> 00:03:49,709
pretty much every service or security

97
00:03:47,670 --> 00:03:52,018
tool that it knows it's been known to

98
00:03:49,709 --> 00:03:54,780
just try and stop literally everything

99
00:03:52,019 --> 00:03:57,480
they will because if those services are

100
00:03:54,780 --> 00:03:58,860
using files that are on that system when

101
00:03:57,480 --> 00:04:01,018
it tries to encrypt it it's not going

102
00:03:58,860 --> 00:04:03,150
able to get that file handle and it

103
00:04:01,019 --> 00:04:04,890
won't actually be able to encrypt it

104
00:04:03,150 --> 00:04:08,310
from the user so what it first does is

105
00:04:04,890 --> 00:04:11,010
it uses net stop SC config taskkill as

106
00:04:08,310 --> 00:04:13,920
well as VSS admin to delete shadow

107
00:04:11,010 --> 00:04:16,529
copies and finally it does some manual

108
00:04:13,920 --> 00:04:20,039
searching for dot back files and other

109
00:04:16,529 --> 00:04:22,349
common backup format files from there it

110
00:04:20,040 --> 00:04:27,060
looks for processes that are anything

111
00:04:22,349 --> 00:04:29,730
except for CS RSS Explorer L SAS and a

112
00:04:27,060 --> 00:04:32,130
to hallow them and inject their

113
00:04:29,730 --> 00:04:34,620
malicious code into their and finally

114
00:04:32,130 --> 00:04:37,800
they encrypt everything except for exe

115
00:04:34,620 --> 00:04:40,280
z' dll's and a file called dom log which

116
00:04:37,800 --> 00:04:44,280
is actually legacy code from the hermus

117
00:04:40,280 --> 00:04:46,469
ransomware originally they first started

118
00:04:44,280 --> 00:04:49,409
off by dropping a text file called ryuk

119
00:04:46,470 --> 00:04:50,940
readme.txt which in claimed which had

120
00:04:49,410 --> 00:04:53,220
the typical content that you see from

121
00:04:50,940 --> 00:04:55,650
ransomware files so it had a Bitcoin

122
00:04:53,220 --> 00:04:57,570
address it had an email address and it

123
00:04:55,650 --> 00:04:59,520
said you know the normal stuff of your

124
00:04:57,570 --> 00:05:01,169
files have been encrypted there is no

125
00:04:59,520 --> 00:05:03,419
way to recover it except for contacting

126
00:05:01,169 --> 00:05:05,729
us after about a couple months they

127
00:05:03,419 --> 00:05:08,099
ended up switching this to a dot HTML

128
00:05:05,730 --> 00:05:10,110
file as well as removing all that

129
00:05:08,100 --> 00:05:12,480
content and leaving it just the email

130
00:05:10,110 --> 00:05:17,280
address and the word ryuk in the dead

131
00:05:12,480 --> 00:05:19,380
middle without any Bitcoin address so

132
00:05:17,280 --> 00:05:21,479
within the first six months they made

133
00:05:19,380 --> 00:05:23,940
four million dollars and that's just

134
00:05:21,479 --> 00:05:25,560
what was reported since then due to the

135
00:05:23,940 --> 00:05:28,050
fact that they took out the Bitcoin

136
00:05:25,560 --> 00:05:30,180
address from those ransomware notes it's

137
00:05:28,050 --> 00:05:31,830
made it a lot harder for researchers

138
00:05:30,180 --> 00:05:34,070
like myself to actually figure out how

139
00:05:31,830 --> 00:05:36,479
much money they've made additionally

140
00:05:34,070 --> 00:05:38,280
many of their victims aren't coming to

141
00:05:36,479 --> 00:05:40,380
the public and saying hey guys like I

142
00:05:38,280 --> 00:05:41,789
got infected the ransomware and I paid

143
00:05:40,380 --> 00:05:43,500
six hundred thousand dollars yesterday

144
00:05:41,790 --> 00:05:46,080
if they're even gonna say anything

145
00:05:43,500 --> 00:05:47,940
they're most likely gonna not tell them

146
00:05:46,080 --> 00:05:49,890
how much or not tell the public how much

147
00:05:47,940 --> 00:05:52,289
they paid so if I were to guess I would

148
00:05:49,890 --> 00:05:56,460
say it at least over ten million in

149
00:05:52,289 --> 00:05:59,039
profit since then maybe even more for an

150
00:05:56,460 --> 00:06:00,840
example here are some entities that had

151
00:05:59,039 --> 00:06:04,080
to disclose to the public most of them

152
00:06:00,840 --> 00:06:07,049
being schools and public utilities or

153
00:06:04,080 --> 00:06:08,719
counties themselves but the range of

154
00:06:07,050 --> 00:06:12,150
price that they normally charge is

155
00:06:08,720 --> 00:06:13,380
typically at least six figures you know

156
00:06:12,150 --> 00:06:15,630
there's a school in New York that paid

157
00:06:13,380 --> 00:06:17,539
eighty eight K but then on the high end

158
00:06:15,630 --> 00:06:20,039
of things there is a town in

159
00:06:17,539 --> 00:06:23,400
Massachusetts where they demand at five

160
00:06:20,039 --> 00:06:25,349
point three million in ransom the SIS

161
00:06:23,400 --> 00:06:26,729
admins at the town contacted the actors

162
00:06:25,350 --> 00:06:29,280
and said hey you know we don't really

163
00:06:26,729 --> 00:06:31,080
have 5.3 million to pay for this but our

164
00:06:29,280 --> 00:06:32,669
insurance can cover up to four hundred K

165
00:06:31,080 --> 00:06:38,370
will that work and they're sure all

166
00:06:32,669 --> 00:06:40,919
right an example of this that actually

167
00:06:38,370 --> 00:06:43,590
happened one week ago today was

168
00:06:40,919 --> 00:06:44,849
a shipping company called Pitney Bowes I

169
00:06:43,590 --> 00:06:48,599
don't have a promise that sorry if

170
00:06:44,849 --> 00:06:50,279
anyone works a but in 2016 they made 3.4

171
00:06:48,599 --> 00:06:52,680
billion in revenue so they are a very

172
00:06:50,279 --> 00:06:56,279
successful company have a very big

173
00:06:52,680 --> 00:06:58,199
international presence and about a week

174
00:06:56,279 --> 00:06:59,879
ago they got infected with Ryuga

175
00:06:58,199 --> 00:07:01,800
ransomware on the right here's a

176
00:06:59,879 --> 00:07:04,349
screenshot from it looks like maybe a

177
00:07:01,800 --> 00:07:06,270
customer or an employee who they

178
00:07:04,349 --> 00:07:08,340
commented on that tweet and said they

179
00:07:06,270 --> 00:07:10,139
were trying to ship out their IRS tax

180
00:07:08,340 --> 00:07:11,998
form and in need of proof that they just

181
00:07:10,139 --> 00:07:15,509
shipped it also to get a some sort of

182
00:07:11,999 --> 00:07:17,219
penalty but unfortunately not nothing

183
00:07:15,509 --> 00:07:18,990
was working their computers had errors

184
00:07:17,219 --> 00:07:21,949
it told him just to unplug the power and

185
00:07:18,990 --> 00:07:24,270
put it back in but that did not work

186
00:07:21,949 --> 00:07:26,610
after they got infected with that their

187
00:07:24,270 --> 00:07:29,188
stock decreased by 4% within the first

188
00:07:26,610 --> 00:07:33,839
24 hours and within three days they paid

189
00:07:29,189 --> 00:07:35,759
the ransom fee a security researcher at

190
00:07:33,839 --> 00:07:37,979
the same time of this went on Twitter

191
00:07:35,759 --> 00:07:40,379
and said Oh looking at our data we can

192
00:07:37,979 --> 00:07:42,599
see that they were infected with Imhotep

193
00:07:40,379 --> 00:07:45,389
before which is really continuing that

194
00:07:42,599 --> 00:07:47,339
pattern of Imhotep to trick BOTS to ryuk

195
00:07:45,389 --> 00:07:49,199
they will also drop other ransomware

196
00:07:47,339 --> 00:07:53,189
like bitpay mire and stuff like that but

197
00:07:49,199 --> 00:07:55,770
it really just depends on the group so a

198
00:07:53,189 --> 00:07:58,080
little bit about how I personally got

199
00:07:55,770 --> 00:08:00,508
involved with ryuk so at a previous role

200
00:07:58,080 --> 00:08:03,000
I was in I was providing consulting

201
00:08:00,509 --> 00:08:04,649
services did some pen testing some

202
00:08:03,000 --> 00:08:07,139
incident response really just depends on

203
00:08:04,649 --> 00:08:09,330
what our customers want it and we had a

204
00:08:07,139 --> 00:08:10,949
global inventory warehouse management

205
00:08:09,330 --> 00:08:13,258
company that got hit with ryuk

206
00:08:10,949 --> 00:08:15,449
ransomware this was in October last fall

207
00:08:13,259 --> 00:08:17,789
so about a year ago they came to me and

208
00:08:15,449 --> 00:08:19,409
said hey we've been really badly it

209
00:08:17,789 --> 00:08:21,120
could like be infected we don't have any

210
00:08:19,409 --> 00:08:23,129
backups right now our warehouses are

211
00:08:21,120 --> 00:08:24,930
shut down can you take a look at this

212
00:08:23,129 --> 00:08:27,539
for eight hours and let us know if we

213
00:08:24,930 --> 00:08:29,399
can decrypt if it's even possible so for

214
00:08:27,539 --> 00:08:31,500
eight hours I you know I threw it and I

215
00:08:29,399 --> 00:08:33,059
to start reverse engineering it trying

216
00:08:31,500 --> 00:08:35,429
to see if there was any flaws in their

217
00:08:33,059 --> 00:08:37,468
key management unfortunately I had to go

218
00:08:35,429 --> 00:08:39,149
back to my boss and say hey you know you

219
00:08:37,469 --> 00:08:41,099
guys are out of luck here everything's

220
00:08:39,149 --> 00:08:42,899
encrypted unless you have their keys you

221
00:08:41,099 --> 00:08:46,140
can't do anything but for me personally

222
00:08:42,899 --> 00:08:48,660
I felt very defeated by the fact that I

223
00:08:46,140 --> 00:08:52,140
was unable to find any flaws but it also

224
00:08:48,660 --> 00:08:54,390
made me curious as to how could a group

225
00:08:52,140 --> 00:08:56,730
be so successful that

226
00:08:54,390 --> 00:08:58,140
they can make this money and for the

227
00:08:56,730 --> 00:09:00,990
record that company ended up paying

228
00:08:58,140 --> 00:09:02,819
500,000 in Bitcoin so that that number

229
00:09:00,990 --> 00:09:06,270
alone made me interested in what they

230
00:09:02,820 --> 00:09:08,340
did that was so successful so the viper

231
00:09:06,270 --> 00:09:10,770
framework is a Joe get to that in a

232
00:09:08,340 --> 00:09:12,630
little bit just my methodology of how I

233
00:09:10,770 --> 00:09:14,430
went about this research was first I

234
00:09:12,630 --> 00:09:16,620
developed signatures around ryuk

235
00:09:14,430 --> 00:09:19,020
ransomware specifically with yarra rules

236
00:09:16,620 --> 00:09:21,180
from there I did threat hunting on

237
00:09:19,020 --> 00:09:23,370
virustotal as well as other platforms

238
00:09:21,180 --> 00:09:25,620
such as hybrid analysis collected

239
00:09:23,370 --> 00:09:27,390
malware samples and then finally I put

240
00:09:25,620 --> 00:09:31,140
it in the Viper framework and did some

241
00:09:27,390 --> 00:09:35,400
clustering and similarity analysis over

242
00:09:31,140 --> 00:09:37,350
here is a screenshot of just the the

243
00:09:35,400 --> 00:09:39,480
yard rule that I've been using to this

244
00:09:37,350 --> 00:09:42,330
day over time I've modified this and

245
00:09:39,480 --> 00:09:43,770
tweaked this as I can and as I've

246
00:09:42,330 --> 00:09:45,720
determined what strings are the most

247
00:09:43,770 --> 00:09:48,900
necessary and what maybe has some false

248
00:09:45,720 --> 00:09:51,690
positives but stuff like hermas and no

249
00:09:48,900 --> 00:09:53,130
system is safe and the SS admin those

250
00:09:51,690 --> 00:09:54,480
commands that they use when they first

251
00:09:53,130 --> 00:09:56,400
dropped have remained the same

252
00:09:54,480 --> 00:09:58,950
throughout the full year that they've

253
00:09:56,400 --> 00:10:02,610
been acting and this er rule has helped

254
00:09:58,950 --> 00:10:05,700
me make a lot of pattern matches on ryuk

255
00:10:02,610 --> 00:10:07,230
ransomware so the Viper framework quick

256
00:10:05,700 --> 00:10:09,480
show of hands who here has heard of the

257
00:10:07,230 --> 00:10:11,610
Viper framework before today a good

258
00:10:09,480 --> 00:10:14,940
couple of you so for those who haven't

259
00:10:11,610 --> 00:10:17,040
it's a binary binary management

260
00:10:14,940 --> 00:10:19,020
framework system so basically all you

261
00:10:17,040 --> 00:10:21,329
can do is just plug in a bunch of files

262
00:10:19,020 --> 00:10:23,460
it stores it in a small back-end and

263
00:10:21,330 --> 00:10:25,590
then you can run Python plug-ins on it

264
00:10:23,460 --> 00:10:27,210
it really just helped me store

265
00:10:25,590 --> 00:10:29,130
everything in one place because when I

266
00:10:27,210 --> 00:10:30,900
first started this research I was

267
00:10:29,130 --> 00:10:32,730
keeping everything in just one folder

268
00:10:30,900 --> 00:10:34,949
and a Google sheets and I quickly

269
00:10:32,730 --> 00:10:39,180
started to realize that that was not a

270
00:10:34,950 --> 00:10:41,310
good course of action but VIPRE has a

271
00:10:39,180 --> 00:10:43,229
series of plugins that you can run some

272
00:10:41,310 --> 00:10:44,790
of them are custom built some of them

273
00:10:43,230 --> 00:10:49,110
are more popular but they can do stuff

274
00:10:44,790 --> 00:10:51,270
like pull PE information exif data you

275
00:10:49,110 --> 00:10:53,490
can analyze stuff with radare - directly

276
00:10:51,270 --> 00:10:55,850
from vipre or you can develop your own

277
00:10:53,490 --> 00:10:59,130
custom plugins to do whatever you want

278
00:10:55,850 --> 00:11:02,210
so a custom plug-in that I built

279
00:10:59,130 --> 00:11:04,650
basically will go through every single

280
00:11:02,210 --> 00:11:07,830
file that you have in there and just

281
00:11:04,650 --> 00:11:11,160
pull out the name the md5 the timestamp

282
00:11:07,830 --> 00:11:12,750
through some red X for ipv4 s and see if

283
00:11:11,160 --> 00:11:14,910
it sees that has any emails in there as

284
00:11:12,750 --> 00:11:16,920
well and so on this screenshot on the

285
00:11:14,910 --> 00:11:18,959
right this is actually within my ryuk

286
00:11:16,920 --> 00:11:21,420
data set and one of the interesting

287
00:11:18,960 --> 00:11:25,500
things here is I added a custom search

288
00:11:21,420 --> 00:11:27,510
for FTP put file and out of all the ryuk

289
00:11:25,500 --> 00:11:29,010
samples that I found there's about like

290
00:11:27,510 --> 00:11:30,840
three or four of them where someone

291
00:11:29,010 --> 00:11:32,970
modified it so that it would actually go

292
00:11:30,840 --> 00:11:35,790
through that file system that infects an

293
00:11:32,970 --> 00:11:37,980
attempt to ship off any files that

294
00:11:35,790 --> 00:11:40,800
matched a keyword to some FTP server

295
00:11:37,980 --> 00:11:44,460
they threw up just a unique variant of

296
00:11:40,800 --> 00:11:46,170
ryuk so for what I did with similarity

297
00:11:44,460 --> 00:11:47,850
analysis when I started this research I

298
00:11:46,170 --> 00:11:49,469
was reading a book called malware data

299
00:11:47,850 --> 00:11:51,930
science which really got me more

300
00:11:49,470 --> 00:11:54,090
interested in involved and they talked

301
00:11:51,930 --> 00:11:57,300
about engrams which essentially looks at

302
00:11:54,090 --> 00:11:59,610
patterns but not just what's in the

303
00:11:57,300 --> 00:12:02,160
binary but actually the sequence that

304
00:11:59,610 --> 00:12:05,070
it's in so if I had a executable and it

305
00:12:02,160 --> 00:12:06,569
had string a B and C it would take that

306
00:12:05,070 --> 00:12:08,880
sequence and it would put it as one

307
00:12:06,570 --> 00:12:11,600
Engram from there it would go to the

308
00:12:08,880 --> 00:12:14,189
next BCD and that would be one Engram

309
00:12:11,600 --> 00:12:15,840
then within my actual research I would

310
00:12:14,190 --> 00:12:17,670
look at the total number of features

311
00:12:15,840 --> 00:12:19,230
that it could extract which is just the

312
00:12:17,670 --> 00:12:21,360
pattern of strings in the order that

313
00:12:19,230 --> 00:12:23,820
it's in and compare that to the number

314
00:12:21,360 --> 00:12:25,470
of patterns that are in other samples so

315
00:12:23,820 --> 00:12:27,480
instead of just looking at the content

316
00:12:25,470 --> 00:12:32,970
we're looking at the order of content

317
00:12:27,480 --> 00:12:35,190
and comparing them with other samples so

318
00:12:32,970 --> 00:12:37,410
one interesting thing that I quickly saw

319
00:12:35,190 --> 00:12:39,720
with the ryuk ransomware

320
00:12:37,410 --> 00:12:42,540
that helped me track it over time was

321
00:12:39,720 --> 00:12:46,110
the use of PDB files so every time you

322
00:12:42,540 --> 00:12:49,290
compile a file it will include a string

323
00:12:46,110 --> 00:12:51,510
that has a path to that debug symbol so

324
00:12:49,290 --> 00:12:53,670
even if the malicious actor doesn't have

325
00:12:51,510 --> 00:12:55,650
that debug file in there ransomware or

326
00:12:53,670 --> 00:12:57,329
whatever malware it is there's a good

327
00:12:55,650 --> 00:13:00,030
chance that they didn't scrub this path

328
00:12:57,330 --> 00:13:02,280
and so this can give you some insight as

329
00:13:00,030 --> 00:13:04,199
to what the developer who is creating

330
00:13:02,280 --> 00:13:07,260
the ransomware or malware was actually

331
00:13:04,200 --> 00:13:09,600
developing it in so the very first PDB

332
00:13:07,260 --> 00:13:12,510
file that was Spotify or spotted within

333
00:13:09,600 --> 00:13:15,510
the ryuk ransomware is this one right

334
00:13:12,510 --> 00:13:18,060
here projects from ryuk from there it

335
00:13:15,510 --> 00:13:20,520
actually adapted and modified to console

336
00:13:18,060 --> 00:13:21,119
application which then went to console

337
00:13:20,520 --> 00:13:23,670
application

338
00:13:21,120 --> 00:13:26,250
fifty-four console application 54 new

339
00:13:23,670 --> 00:13:27,870
cryptid new cryptid with process kill

340
00:13:26,250 --> 00:13:30,900
new cryptid with process kill within

341
00:13:27,870 --> 00:13:34,320
another process and so forth so although

342
00:13:30,900 --> 00:13:35,550
some actors didn't include pdb paths

343
00:13:34,320 --> 00:13:37,920
within their ransomware

344
00:13:35,550 --> 00:13:39,510
some of the actors that war using ryuk

345
00:13:37,920 --> 00:13:41,640
would leave it in and that actually

346
00:13:39,510 --> 00:13:43,260
helps me track it over time because I

347
00:13:41,640 --> 00:13:45,360
could see as they were changing the code

348
00:13:43,260 --> 00:13:47,010
that those pdb paths were actually

349
00:13:45,360 --> 00:13:52,650
changing with little comments on top of

350
00:13:47,010 --> 00:13:54,300
it I created a plugin for the Viper

351
00:13:52,650 --> 00:13:56,910
framework that would go through all my

352
00:13:54,300 --> 00:13:59,520
samples run that similarity analysis

353
00:13:56,910 --> 00:14:01,589
using those engrams and then graph it on

354
00:13:59,520 --> 00:14:03,360
the left is the first iteration that I

355
00:14:01,589 --> 00:14:06,150
did with this which was just using

356
00:14:03,360 --> 00:14:09,270
graphviz which is a open source Python

357
00:14:06,150 --> 00:14:11,040
library but as my dataset got bigger it

358
00:14:09,270 --> 00:14:13,410
got more and more messy and harder to

359
00:14:11,040 --> 00:14:16,650
manage so I ended up porting it over to

360
00:14:13,410 --> 00:14:18,689
neo4j which is a web application

361
00:14:16,650 --> 00:14:20,189
framework that's used in bloodhound and

362
00:14:18,690 --> 00:14:24,600
a bunch of other projects as well which

363
00:14:20,190 --> 00:14:25,830
is shown on the right some results from

364
00:14:24,600 --> 00:14:29,130
a data set that I've been collecting

365
00:14:25,830 --> 00:14:32,250
over the past year if you look within

366
00:14:29,130 --> 00:14:36,480
this actual cluster all these samples

367
00:14:32,250 --> 00:14:40,560
have the exact same timestamp which was

368
00:14:36,480 --> 00:14:44,700
in july 2019 this cluster over here was

369
00:14:40,560 --> 00:14:47,219
all had the same PDB path of new crypt

370
00:14:44,700 --> 00:14:49,020
it with process kill but not all of them

371
00:14:47,220 --> 00:14:50,850
as I mentioned have pdb so you can see

372
00:14:49,020 --> 00:14:55,560
this cluster over here didn't have

373
00:14:50,850 --> 00:14:57,360
anything this one D was right after the

374
00:14:55,560 --> 00:14:59,459
Chinese New Year so I think the Chinese

375
00:14:57,360 --> 00:15:04,080
New Year was literally the day before

376
00:14:59,459 --> 00:15:06,359
all these were compiled and then you can

377
00:15:04,080 --> 00:15:08,940
see this smaller cluster over here had

378
00:15:06,360 --> 00:15:11,580
PDB paths that were projects from ryuk

379
00:15:08,940 --> 00:15:13,680
which are from the original data set so

380
00:15:11,580 --> 00:15:16,350
through engrams and clustering with

381
00:15:13,680 --> 00:15:18,719
neo4j I could actually visualize these

382
00:15:16,350 --> 00:15:20,910
groups of malware and start to pick out

383
00:15:18,720 --> 00:15:22,650
you know what outliers are there and why

384
00:15:20,910 --> 00:15:25,920
are there outliers is it an issue with

385
00:15:22,650 --> 00:15:28,290
my is it an issue of my yard rules is it

386
00:15:25,920 --> 00:15:30,660
an issue with their code is it a flaw in

387
00:15:28,290 --> 00:15:33,540
the way I did this or is it just a false

388
00:15:30,660 --> 00:15:34,920
positive of that nature but it also

389
00:15:33,540 --> 00:15:37,199
helped me

390
00:15:34,920 --> 00:15:40,380
we visualize how they were changing over

391
00:15:37,200 --> 00:15:42,540
time and see that although there is some

392
00:15:40,380 --> 00:15:44,160
overlap in these samples there is enough

393
00:15:42,540 --> 00:15:45,420
difference and variance that they

394
00:15:44,160 --> 00:15:48,510
actually are clustered entirely

395
00:15:45,420 --> 00:15:50,579
different and it was really reinforcing

396
00:15:48,510 --> 00:15:54,510
to see that the PDB paths would actually

397
00:15:50,579 --> 00:15:56,160
match with that clustering so some of

398
00:15:54,510 --> 00:15:58,319
those groups are have very high

399
00:15:56,160 --> 00:16:00,480
threshold where a ton of samples were

400
00:15:58,320 --> 00:16:02,130
pushed out in a short period of time one

401
00:16:00,480 --> 00:16:03,540
of which being that rate after New

402
00:16:02,130 --> 00:16:09,930
Year's and the other one being in the

403
00:16:03,540 --> 00:16:12,029
middle of July of 2019 so right now this

404
00:16:09,930 --> 00:16:13,529
is where I've taken this research but in

405
00:16:12,029 --> 00:16:16,260
the future one of the things that I want

406
00:16:13,529 --> 00:16:18,240
to do is actually incorporate kaku-san

407
00:16:16,260 --> 00:16:21,449
box to this and start to do some

408
00:16:18,240 --> 00:16:23,820
similarity analysis on dynamic not just

409
00:16:21,449 --> 00:16:26,120
static as well as compare how those

410
00:16:23,820 --> 00:16:32,430
ransom note has changed over time and

411
00:16:26,120 --> 00:16:39,209
continue to get more samples on ryuk are

412
00:16:32,430 --> 00:16:40,829
there any questions so the the plugins

413
00:16:39,209 --> 00:16:45,239
that I have and that I've written are

414
00:16:40,829 --> 00:16:48,719
all on github and open source but I have

415
00:16:45,240 --> 00:16:50,459
done some like I have some paper that is

416
00:16:48,720 --> 00:16:52,470
in process in the progress of being

417
00:16:50,459 --> 00:16:57,989
written but I haven't published it but I

418
00:16:52,470 --> 00:16:59,699
can do that I haven't looked at any

419
00:16:57,990 --> 00:17:02,060
specific journals or anything most

420
00:16:59,699 --> 00:17:10,168
likely I'll probably put it on Twitter

421
00:17:02,060 --> 00:17:16,020
they seem to accept it the protocol are

422
00:17:10,169 --> 00:17:18,290
there questions thank you one more

423
00:17:16,020 --> 00:17:18,290
question

424
00:17:23,970 --> 00:17:30,340
so they some ryuk samples will go

425
00:17:27,549 --> 00:17:33,789
through a lot more to encrypt their

426
00:17:30,340 --> 00:17:35,830
static content and so some of these some

427
00:17:33,789 --> 00:17:37,990
of these outliers here it seems like the

428
00:17:35,830 --> 00:17:39,668
actor that deployed it took another step

429
00:17:37,990 --> 00:17:41,980
to go through the content and just

430
00:17:39,669 --> 00:17:44,529
harden it a little bit so maybe maybe

431
00:17:41,980 --> 00:17:46,059
it's a more elite actor or maybe it's

432
00:17:44,529 --> 00:17:48,669
someone thought hey maybe we shouldn't

433
00:17:46,059 --> 00:17:58,720
leave the debug path in our binary that

434
00:17:48,669 --> 00:18:04,720
we're sending to production the pdb

435
00:17:58,720 --> 00:18:07,360
paths so I think it's still very new

436
00:18:04,720 --> 00:18:09,940
research Steve Miller from fire I just

437
00:18:07,360 --> 00:18:11,649
recently published a report about two

438
00:18:09,940 --> 00:18:13,539
months ago where he took a bunch of

439
00:18:11,649 --> 00:18:15,908
these debug symbols that he knew and

440
00:18:13,539 --> 00:18:18,669
that fire I has seen and they mapped it

441
00:18:15,909 --> 00:18:20,529
to common samples and known families so

442
00:18:18,669 --> 00:18:22,480
I think that the process of looking at

443
00:18:20,529 --> 00:18:25,080
those patterns and utilizing that to

444
00:18:22,480 --> 00:18:34,419
track them is still a up and coming

445
00:18:25,080 --> 00:18:35,290
methodology any other questions thank

446
00:18:34,419 --> 00:18:42,210
you

447
00:18:35,290 --> 00:18:42,210
[Applause]

