1
00:00:09,349 --> 00:00:25,619
you got time to my tonight yep hey how's

2
00:00:23,039 --> 00:00:27,090
it going everyone sorry uh I'm a little

3
00:00:25,619 --> 00:00:28,619
like a zombie fired right now

4
00:00:27,090 --> 00:00:32,159
you know I sink a little bit too much

5
00:00:28,619 --> 00:00:35,149
last night so my voice is cracked saying

6
00:00:32,159 --> 00:00:38,010
exclusively just sublime songs is or no

7
00:00:35,149 --> 00:00:39,660
so yeah it was a good time last night so

8
00:00:38,010 --> 00:00:52,800
I blame Grand Rapids for all the good

9
00:00:39,660 --> 00:00:55,069
beer so bells okay I'll try founders

10
00:00:52,800 --> 00:00:55,070
tonight

11
00:00:55,579 --> 00:01:02,460
so this host on the budget will be

12
00:00:59,129 --> 00:01:05,399
starting now and my name is a cyber goat

13
00:01:02,460 --> 00:01:06,270
or Leo you ferment Twitter cyber ghost I

14
00:01:05,400 --> 00:01:08,010
opps

15
00:01:06,270 --> 00:01:11,210
does anybody know where that names from

16
00:01:08,010 --> 00:01:14,750
why is my handle cyber ghost I ops

17
00:01:11,210 --> 00:01:18,179
they got prize for you say again

18
00:01:14,750 --> 00:01:22,080
yes so that's my old mos and army the

19
00:01:18,180 --> 00:01:25,340
psyops so so yeah we did a lot of

20
00:01:22,080 --> 00:01:28,860
information operation stuff all right

21
00:01:25,340 --> 00:01:31,020
so Who am I oh speaking of that 13 years

22
00:01:28,860 --> 00:01:34,350
in the military two years in a private

23
00:01:31,020 --> 00:01:36,298
sector started out as sysadmin for MPS

24
00:01:34,350 --> 00:01:37,979
military police was pretty cool you go

25
00:01:36,299 --> 00:01:41,009
to a lot forensic courses a lot of

26
00:01:37,979 --> 00:01:44,039
forensic classes both forensics went to

27
00:01:41,009 --> 00:01:46,680
incident response before there's 25

28
00:01:44,040 --> 00:01:49,439
deltas or 17 Charlie's I was doing that

29
00:01:46,680 --> 00:01:51,840
then the last half my career was Special

30
00:01:49,439 --> 00:01:53,880
Operations currently working for a

31
00:01:51,840 --> 00:01:56,790
Japanese company so don't think about

32
00:01:53,880 --> 00:02:00,210
real conservative DoD types now company

33
00:01:56,790 --> 00:02:02,680
five bosses everybody's everyone works

34
00:02:00,210 --> 00:02:06,559
in the silo that type of environment

35
00:02:02,680 --> 00:02:08,720
so what do you do if you're broke you

36
00:02:06,560 --> 00:02:10,729
know you can beg if you have no money

37
00:02:08,720 --> 00:02:13,130
you can beg you can do that even you

38
00:02:10,729 --> 00:02:16,580
know work up a tear you can't wait for

39
00:02:13,130 --> 00:02:19,040
Brian Krebs you know he's my talk to you

40
00:02:16,580 --> 00:02:21,440
but you can't wait for Brian Krebs to

41
00:02:19,040 --> 00:02:23,750
call your call your executive be like

42
00:02:21,440 --> 00:02:26,390
hey we found something or call in during

43
00:02:23,750 --> 00:02:29,030
quarters earnings call and you can wait

44
00:02:26,390 --> 00:02:30,410
for that to get exposed and then all of

45
00:02:29,030 --> 00:02:33,200
a sudden you got unlimited funds right

46
00:02:30,410 --> 00:02:35,030
all sudden for about three months and

47
00:02:33,200 --> 00:02:38,839
don't say yes to anything for about

48
00:02:35,030 --> 00:02:40,190
three months or he's what I did and my

49
00:02:38,840 --> 00:02:42,800
infrastructure is used free and

50
00:02:40,190 --> 00:02:44,920
open-source tools tools like cysmart

51
00:02:42,800 --> 00:02:48,650
which is not open source but it's free

52
00:02:44,920 --> 00:02:50,899
he's ELQ stack - for your analytics

53
00:02:48,650 --> 00:02:54,680
he's always query was cross-platform

54
00:02:50,900 --> 00:02:57,670
he's go by Google he's velociraptor

55
00:02:54,680 --> 00:03:00,560
which is pretty pretty cool or he's mala

56
00:02:57,670 --> 00:03:02,119
for packing packing on you snores

57
00:03:00,560 --> 00:03:05,060
tsukada so there's a lot of open source

58
00:03:02,120 --> 00:03:11,510
alternatives to expensive EDR Network

59
00:03:05,060 --> 00:03:13,280
appliances right so this main talks

60
00:03:11,510 --> 00:03:14,720
don't be about this mom always query in

61
00:03:13,280 --> 00:03:16,940
the Windows environment but I'll get

62
00:03:14,720 --> 00:03:19,280
that in a little bit so I'm gonna try to

63
00:03:16,940 --> 00:03:20,480
get you to buy into using the system on

64
00:03:19,280 --> 00:03:23,540
in your environment and why he should

65
00:03:20,480 --> 00:03:26,750
use this monocles query who creates this

66
00:03:23,540 --> 00:03:29,510
Mon well mark was on a bitch he's a CTO

67
00:03:26,750 --> 00:03:31,310
for Azure and Microsoft he still updated

68
00:03:29,510 --> 00:03:33,850
pretty regularly and they actually do

69
00:03:31,310 --> 00:03:35,720
have one engineer working on system on

70
00:03:33,850 --> 00:03:38,180
four guys and they I think it's mark

71
00:03:35,720 --> 00:03:39,829
cook but it's not a day job so it's not

72
00:03:38,180 --> 00:03:45,260
officially supported by Microsoft so

73
00:03:39,829 --> 00:03:47,209
just realize that what is this mine so

74
00:03:45,260 --> 00:03:49,459
what is it why you'll implement into

75
00:03:47,209 --> 00:03:51,380
your infrastructure well it's every

76
00:03:49,459 --> 00:03:53,180
course Windows events anybody done any

77
00:03:51,380 --> 00:03:55,790
type of forensic analysis friends

78
00:03:53,180 --> 00:03:57,260
forensic investigation knows that native

79
00:03:55,790 --> 00:04:00,679
Windows Lars leaves a lot to be desired

80
00:03:57,260 --> 00:04:04,510
so sis mom makes that very easy easy to

81
00:04:00,680 --> 00:04:04,510
read easy to parse easy

82
00:04:07,020 --> 00:04:14,360
man a simple flat text file config file

83
00:04:10,920 --> 00:04:16,829
you can do a simple include or exclude

84
00:04:14,360 --> 00:04:19,020
you can use that and it's real easy

85
00:04:16,829 --> 00:04:20,849
we're doing a forensic analysis because

86
00:04:19,019 --> 00:04:24,210
if you look at the native window logs is

87
00:04:20,850 --> 00:04:25,890
real hard to decipher some of the cool

88
00:04:24,210 --> 00:04:27,599
things you can do with this mom you can

89
00:04:25,890 --> 00:04:29,909
create you can catch the process

90
00:04:27,600 --> 00:04:32,610
creations what do you care about puzzle

91
00:04:29,910 --> 00:04:36,870
creations well it can spawn something's

92
00:04:32,610 --> 00:04:39,810
not supposed to say a explorer.exe or

93
00:04:36,870 --> 00:04:42,120
WordPad is this Bonnie PowerShell or

94
00:04:39,810 --> 00:04:43,560
something like that right there were

95
00:04:42,120 --> 00:04:46,320
connections from the host that's really

96
00:04:43,560 --> 00:04:48,510
awesome analytics you can use every time

97
00:04:46,320 --> 00:04:50,540
a file is created you know it was

98
00:04:48,510 --> 00:04:53,490
changes to a file you can capture that

99
00:04:50,540 --> 00:04:55,110
it generates events early in the boot

100
00:04:53,490 --> 00:04:59,160
process so thank you for your boot kids

101
00:04:55,110 --> 00:05:02,400
route kids and currently there's DNS

102
00:04:59,160 --> 00:05:04,440
logging which is real real hard to

103
00:05:02,400 --> 00:05:06,510
implement because just so much noise

104
00:05:04,440 --> 00:05:09,090
anyway you've done proxy filtering or

105
00:05:06,510 --> 00:05:11,750
DNS logging is very hard

106
00:05:09,090 --> 00:05:13,979
same thing with system on it's very hard

107
00:05:11,750 --> 00:05:16,160
but it's just some of the cool things

108
00:05:13,980 --> 00:05:18,450
you can do with it

109
00:05:16,160 --> 00:05:20,850
when is it needed when you want to

110
00:05:18,450 --> 00:05:22,229
enhance your native window logging you

111
00:05:20,850 --> 00:05:24,390
want to enhance it it's not it's not a

112
00:05:22,230 --> 00:05:26,730
navy it's not a bi-product it just

113
00:05:24,390 --> 00:05:29,400
enhances enriches your your windows

114
00:05:26,730 --> 00:05:31,860
logging is what it does so it's

115
00:05:29,400 --> 00:05:34,590
retroactive analysis it's not active

116
00:05:31,860 --> 00:05:36,330
analysis so every 15 minutes your logs

117
00:05:34,590 --> 00:05:39,330
get pushed to a Windows collector and

118
00:05:36,330 --> 00:05:42,180
you can do a retroactive analysis on

119
00:05:39,330 --> 00:05:44,099
that you want to look for the initial

120
00:05:42,180 --> 00:05:47,580
attack vector this market help out with

121
00:05:44,100 --> 00:05:49,620
that improve reaction time for instant

122
00:05:47,580 --> 00:05:52,650
responders for the analyst helps a lot

123
00:05:49,620 --> 00:05:54,810
in the technical adder movement so

124
00:05:52,650 --> 00:05:57,349
where's the deploy the only on Windows 6

125
00:05:54,810 --> 00:06:02,640
miles only deployed on Windows servers

126
00:05:57,350 --> 00:06:06,810
domain controllers endpoint users see

127
00:06:02,640 --> 00:06:09,120
and default native since Monologues it's

128
00:06:06,810 --> 00:06:11,340
about sixty five megabytes I know CEOs

129
00:06:09,120 --> 00:06:14,280
and executives care about how much is it

130
00:06:11,340 --> 00:06:14,669
gonna bog down my system whoa natively

131
00:06:14,280 --> 00:06:16,830
or

132
00:06:14,669 --> 00:06:18,359
out-of-the-box configuration is 65

133
00:06:16,830 --> 00:06:21,030
megabytes

134
00:06:18,360 --> 00:06:26,699
is my research is about six weeks of

135
00:06:21,030 --> 00:06:29,669
user data what we need says mondo what

136
00:06:26,699 --> 00:06:32,099
we need is this mine in my case there

137
00:06:29,669 --> 00:06:34,799
was no employ visibility no EDR we had a

138
00:06:32,099 --> 00:06:36,750
V but it's black box we can't we can't

139
00:06:34,800 --> 00:06:38,610
use it for analytics its signature bass

140
00:06:36,750 --> 00:06:40,949
we couldn't do nothing with it with

141
00:06:38,610 --> 00:06:43,020
antivirus so we we had an e and

142
00:06:40,949 --> 00:06:45,150
necessity to look at the end point and

143
00:06:43,020 --> 00:06:47,039
system on you know I had party at prior

144
00:06:45,150 --> 00:06:49,349
knowledge system on this is he easy to

145
00:06:47,039 --> 00:06:52,259
implement so I had to get buy-in from

146
00:06:49,349 --> 00:06:56,460
management to implement it and this was

147
00:06:52,259 --> 00:07:01,229
my my way of trying to get them to to to

148
00:06:56,460 --> 00:07:03,090
buy into using system on also some

149
00:07:01,229 --> 00:07:06,719
selfish reasons that I like system on is

150
00:07:03,090 --> 00:07:08,698
I'm not threatened by day so I love the

151
00:07:06,719 --> 00:07:13,379
more data I can I can analyze the better

152
00:07:08,699 --> 00:07:16,259
it is for me so this talk wouldn't be

153
00:07:13,379 --> 00:07:18,569
made without these contributors Robert

154
00:07:16,259 --> 00:07:20,310
Rodriguez cyber war dog awesome leads

155
00:07:18,569 --> 00:07:22,979
the field and tree hunting it does Assam

156
00:07:20,310 --> 00:07:23,460
work with Mordor and he does a lot of

157
00:07:22,979 --> 00:07:27,029
cool stuff

158
00:07:23,460 --> 00:07:28,979
he's always posting edge cases and and

159
00:07:27,029 --> 00:07:31,620
new stuff worked right honey first on

160
00:07:28,979 --> 00:07:35,699
security the the windows professional

161
00:07:31,620 --> 00:07:41,039
and he or she not sure what they are but

162
00:07:35,699 --> 00:07:42,539
he or she they swift posters a lot of

163
00:07:41,039 --> 00:07:44,159
stuff boss this man she even gets to

164
00:07:42,539 --> 00:07:46,919
play around the beta version before she

165
00:07:44,159 --> 00:07:48,620
even released so follow her follow her

166
00:07:46,919 --> 00:07:51,900
because they're awesome

167
00:07:48,620 --> 00:07:53,909
just the pain her blog matter what

168
00:07:51,900 --> 00:07:55,888
mattered mommy what matters change my

169
00:07:53,909 --> 00:07:57,870
life so she talks about how to set up

170
00:07:55,889 --> 00:07:59,370
Windows event forwarding and a Windows

171
00:07:57,870 --> 00:08:00,259
Event collector well I'll get into here

172
00:07:59,370 --> 00:08:03,750
in a little bit

173
00:08:00,259 --> 00:08:05,639
now Erica piano from reclining full

174
00:08:03,750 --> 00:08:07,710
second open sock

175
00:08:05,639 --> 00:08:13,080
he taught me a line Olaf he does great

176
00:08:07,710 --> 00:08:14,609
work with this - plank so alright so

177
00:08:13,080 --> 00:08:16,650
there's gonna be my a little background

178
00:08:14,610 --> 00:08:19,440
a little context to how I deployed

179
00:08:16,650 --> 00:08:21,659
system on and how I used it so think

180
00:08:19,440 --> 00:08:23,520
about a real conservative Japanese

181
00:08:21,659 --> 00:08:26,159
company that doesn't trust a cloud

182
00:08:23,520 --> 00:08:28,568
everyone's in silo and I'm in this

183
00:08:26,159 --> 00:08:30,580
environment for the first hundred days

184
00:08:28,569 --> 00:08:32,829
make a impact I want to make a return

185
00:08:30,580 --> 00:08:34,718
investment where I'm pushing the needle

186
00:08:32,828 --> 00:08:36,458
forward and our security posture so this

187
00:08:34,719 --> 00:08:38,709
is the first one today's what I'm going

188
00:08:36,458 --> 00:08:41,348
to show you here how can I help that

189
00:08:38,708 --> 00:08:43,958
organization as a I came in at 300 but I

190
00:08:41,349 --> 00:08:46,360
saw the need of endpoint visibility of

191
00:08:43,958 --> 00:08:48,819
gain analytics in there because I I did

192
00:08:46,360 --> 00:08:51,519
a data I did later land and I thought

193
00:08:48,819 --> 00:08:54,329
that a gap data gap analysis on the

194
00:08:51,519 --> 00:08:59,259
endpoint we were just one getting none

195
00:08:54,329 --> 00:09:01,599
so our breakdowns about 8% Windows 90%

196
00:08:59,259 --> 00:09:04,329
Mac and I'm the one purse sorry

197
00:09:01,600 --> 00:09:07,089
19% Linux and I'm the 1% back I'm like

198
00:09:04,329 --> 00:09:11,399
the only Mac user so so this model fit

199
00:09:07,089 --> 00:09:17,970
in perfect a small InfoSec team

200
00:09:11,399 --> 00:09:20,649
responsible for like 30 K endpoints see

201
00:09:17,970 --> 00:09:22,899
so how did I deploy it are you gonna

202
00:09:20,649 --> 00:09:26,649
play a few couple ways right you can

203
00:09:22,899 --> 00:09:28,509
deploy it through GPO that's what I did

204
00:09:26,649 --> 00:09:31,990
I use GPO you can deploy it through a

205
00:09:28,509 --> 00:09:32,649
bat strip you can use SCCM I recommend

206
00:09:31,990 --> 00:09:35,709
SCCM

207
00:09:32,649 --> 00:09:37,870
just cuz IT ops they love their the

208
00:09:35,709 --> 00:09:40,569
metrics on how many endpoints actually

209
00:09:37,870 --> 00:09:44,889
receive receive the system on they like

210
00:09:40,569 --> 00:09:46,870
those kind of stats about 80 use for

211
00:09:44,889 --> 00:09:49,360
orchestration or for deployment you can

212
00:09:46,870 --> 00:09:50,920
use that tool create a package and sense

213
00:09:49,360 --> 00:09:53,259
this my on the way but if you have

214
00:09:50,920 --> 00:09:55,120
nothing that can deploy easily we got

215
00:09:53,259 --> 00:09:57,670
trouble secm for whatever reason the

216
00:09:55,120 --> 00:10:04,630
package was failing so we use GPO real

217
00:09:57,670 --> 00:10:07,810
easy to set up so some of things the so

218
00:10:04,630 --> 00:10:09,399
this is about David Bianco he's awesome

219
00:10:07,810 --> 00:10:11,469
but the pyramid paint everybody knows a

220
00:10:09,399 --> 00:10:14,170
pyramid pain right so this is things I

221
00:10:11,470 --> 00:10:17,529
want to capture with system on you know

222
00:10:14,170 --> 00:10:20,589
real easy has values IP addresses domain

223
00:10:17,529 --> 00:10:23,290
names all that Network host artifacts

224
00:10:20,589 --> 00:10:25,660
that's perfect but the tough stuff is

225
00:10:23,290 --> 00:10:28,719
tools and TTP's which analysts will have

226
00:10:25,660 --> 00:10:31,719
to create but the bottom for sis mark

227
00:10:28,720 --> 00:10:34,509
can capture easy and this is a pyramid

228
00:10:31,720 --> 00:10:36,939
pain by their Bianco pretty cool he has

229
00:10:34,509 --> 00:10:39,460
a cool blog post on this at these flags

230
00:10:36,939 --> 00:10:42,969
of be on my website cyber goes psyops

231
00:10:39,460 --> 00:10:44,580
and you can follow the links there so

232
00:10:42,970 --> 00:10:47,890
that wasn't so that's my background

233
00:10:44,580 --> 00:10:49,450
that's what I'm trying to capture so I

234
00:10:47,890 --> 00:10:51,490
now need buy-in from management how do I

235
00:10:49,450 --> 00:10:54,730
do that well I noticed there's a

236
00:10:51,490 --> 00:10:57,310
malicious beacon in in our sim in this

237
00:10:54,730 --> 00:10:58,630
case it was a ELQ stack so there's a

238
00:10:57,310 --> 00:11:00,520
Melissa speaking and that's all we had

239
00:10:58,630 --> 00:11:02,290
that's how we go on I'm not great I have

240
00:11:00,520 --> 00:11:03,939
all these five different managers who

241
00:11:02,290 --> 00:11:05,500
are real conservative that don't want to

242
00:11:03,940 --> 00:11:06,640
implement new technologies because it

243
00:11:05,500 --> 00:11:09,010
might bog down the system

244
00:11:06,640 --> 00:11:11,350
and they don't know what the return on

245
00:11:09,010 --> 00:11:13,029
investment is so I take that malicious

246
00:11:11,350 --> 00:11:16,029
beginning the IP address you know the

247
00:11:13,029 --> 00:11:18,640
very bottom of the pyramid pain deploys

248
00:11:16,029 --> 00:11:21,010
system on with PowerShell script I'm

249
00:11:18,640 --> 00:11:23,949
able to find a custom malware which

250
00:11:21,010 --> 00:11:25,450
nobody cares about it's a fraud its

251
00:11:23,950 --> 00:11:27,070
commodity malware nobody cares about

252
00:11:25,450 --> 00:11:29,740
this the vendors don't care about it

253
00:11:27,070 --> 00:11:31,839
antivirus doesn't catch it so that was

254
00:11:29,740 --> 00:11:34,330
my time to shine and to prove to

255
00:11:31,839 --> 00:11:36,760
management all five different managers

256
00:11:34,330 --> 00:11:40,209
look what I can do with system on real

257
00:11:36,760 --> 00:11:45,370
easy PowerShell script but as you can

258
00:11:40,209 --> 00:11:47,319
see I'm able to capture a confident

259
00:11:45,370 --> 00:11:49,180
pretty easily it was basically four

260
00:11:47,320 --> 00:11:52,380
encoded you know PowerShell should never

261
00:11:49,180 --> 00:11:54,969
be you know basics before encoded right

262
00:11:52,380 --> 00:11:55,510
and this is what I used to capture it

263
00:11:54,970 --> 00:11:58,959
real easy

264
00:11:55,510 --> 00:12:02,260
I just parse the system on logs with a

265
00:11:58,959 --> 00:12:03,939
query of the hash tables so I'm doing

266
00:12:02,260 --> 00:12:08,110
all the hashes or the executables real

267
00:12:03,940 --> 00:12:10,270
easy I'm also doing you know I did the

268
00:12:08,110 --> 00:12:13,000
file hash tables of every executable and

269
00:12:10,270 --> 00:12:15,670
I'm not also able to parse the command

270
00:12:13,000 --> 00:12:17,290
line arguments as well which I care

271
00:12:15,670 --> 00:12:20,079
about that if something's base64 I'm

272
00:12:17,290 --> 00:12:27,189
going to dig into it real easy ten

273
00:12:20,080 --> 00:12:32,200
points catch him in about 30 minutes so

274
00:12:27,190 --> 00:12:34,630
say you do why implement this mahn but

275
00:12:32,200 --> 00:12:36,490
you have no money to implement it you

276
00:12:34,630 --> 00:12:38,439
don't have no crazy infrastructure you

277
00:12:36,490 --> 00:12:41,680
have no money he's built in tools from

278
00:12:38,440 --> 00:12:43,450
Windows servers to actually collect logs

279
00:12:41,680 --> 00:12:46,390
from your endpoint from your windows

280
00:12:43,450 --> 00:12:48,500
endpoint and how you do that is through

281
00:12:46,390 --> 00:12:50,540
windows and when forwarding

282
00:12:48,500 --> 00:12:52,430
and a Windows Event collector so you

283
00:12:50,540 --> 00:12:54,650
turn on windows event 14 on every

284
00:12:52,430 --> 00:12:57,079
endpoint through GPO real easy to do is

285
00:12:54,650 --> 00:12:58,280
a GPO setting you turn it on you point

286
00:12:57,080 --> 00:13:00,170
it at the right direction though you do

287
00:12:58,280 --> 00:13:01,819
have to point to a certain direction and

288
00:13:00,170 --> 00:13:06,199
that's to your Windows Event collector

289
00:13:01,820 --> 00:13:08,450
was it Server 2016 so all your endpoints

290
00:13:06,200 --> 00:13:13,460
are being collected with this Windows

291
00:13:08,450 --> 00:13:15,800
Server 2016 and uh server and acts as a

292
00:13:13,460 --> 00:13:17,810
logging mechanism for all your windows

293
00:13:15,800 --> 00:13:19,280
endpoints any law you want it doesn't

294
00:13:17,810 --> 00:13:20,270
have to be system on it could be

295
00:13:19,280 --> 00:13:22,370
PowerShell logs

296
00:13:20,270 --> 00:13:25,280
it could be RTP logs it could be

297
00:13:22,370 --> 00:13:27,200
security dating logs it can be 81 I just

298
00:13:25,280 --> 00:13:29,350
taught it to collect security and system

299
00:13:27,200 --> 00:13:32,360
on logs eventually you get into

300
00:13:29,350 --> 00:13:34,790
PowerShell and some other logs but real

301
00:13:32,360 --> 00:13:36,410
easy system on and security and turn

302
00:13:34,790 --> 00:13:38,990
that on on every endpoint or one as we

303
00:13:36,410 --> 00:13:40,880
went 14 but when does the collector you

304
00:13:38,990 --> 00:13:42,950
make sure you turn on subscription on

305
00:13:40,880 --> 00:13:45,230
ones of that collector then you push

306
00:13:42,950 --> 00:13:48,380
that out to your sim whereas it's blunt

307
00:13:45,230 --> 00:13:51,470
forward because file beat whatever you

308
00:13:48,380 --> 00:13:56,780
want to use and bam you're collecting

309
00:13:51,470 --> 00:14:00,140
all windows logs so this was my that's

310
00:13:56,780 --> 00:14:03,050
what I use I use the server 2016 we use

311
00:14:00,140 --> 00:14:07,300
GPO for deployment we use Alex TAC for

312
00:14:03,050 --> 00:14:10,099
our sim and we for all the host data

313
00:14:07,300 --> 00:14:12,349
that's it we stuck like but you got make

314
00:14:10,100 --> 00:14:15,320
sure it does take a lot maintenance you

315
00:14:12,350 --> 00:14:17,600
do have to you do have to parse out a

316
00:14:15,320 --> 00:14:19,310
lot of normal traffic otherwise your

317
00:14:17,600 --> 00:14:23,510
analyst will just get bogged down with

318
00:14:19,310 --> 00:14:25,640
all these alerts so how do you create

319
00:14:23,510 --> 00:14:27,920
the winners event collector which is

320
00:14:25,640 --> 00:14:29,600
just a server and you turn on in certain

321
00:14:27,920 --> 00:14:30,969
settings in all sudden you collecting

322
00:14:29,600 --> 00:14:34,580
logs from all your windows endpoints

323
00:14:30,970 --> 00:14:37,790
well you have to turn on win RM make

324
00:14:34,580 --> 00:14:40,610
sure it has access to security logs the

325
00:14:37,790 --> 00:14:44,750
right permissions you can GPO you turn

326
00:14:40,610 --> 00:14:48,310
on Windows with at 14 and make sure the

327
00:14:44,750 --> 00:14:48,310
descriptions turned on to write targets

328
00:14:54,600 --> 00:15:00,940
so what I used was a bad script pine not

329
00:14:58,180 --> 00:15:03,699
the most resilient but it's a bad script

330
00:15:00,940 --> 00:15:05,920
that pulls from our app server pulls a

331
00:15:03,700 --> 00:15:10,390
system on package and then deploys it

332
00:15:05,920 --> 00:15:12,900
through a GPO I recommend SCCM if you

333
00:15:10,390 --> 00:15:12,900
can get to work

334
00:15:12,960 --> 00:15:17,980
Alex acts really easy stand-up of course

335
00:15:15,280 --> 00:15:20,170
so these are all free built-in tools

336
00:15:17,980 --> 00:15:22,720
free open-source tools alex tags elastic

337
00:15:20,170 --> 00:15:26,050
search log stash and cabana front end

338
00:15:22,720 --> 00:15:32,500
right yeah it is usually Ubuntu server

339
00:15:26,050 --> 00:15:38,620
to stand that up now of course you want

340
00:15:32,500 --> 00:15:41,110
proxy it all right let me stop for okay

341
00:15:38,620 --> 00:15:44,260
we log be win Lobby is a stripper is a

342
00:15:41,110 --> 00:15:46,660
event shipper it's kinda like a agent

343
00:15:44,260 --> 00:15:50,280
and it pushes all your logs to the to

344
00:15:46,660 --> 00:15:50,280
your Elks tag to your last six search

345
00:15:50,580 --> 00:15:54,340
but before I move on does anybody have

346
00:15:52,720 --> 00:15:56,310
any questions so far if I'm talking too

347
00:15:54,340 --> 00:16:00,610
fast or my voice is cracking too much

348
00:15:56,310 --> 00:16:08,680
any questions so far before I get into a

349
00:16:00,610 --> 00:16:12,070
little bit deeper yes sir yep so this is

350
00:16:08,680 --> 00:16:14,849
where knowing your your environment and

351
00:16:12,070 --> 00:16:16,960
I selected I'll show you I have a

352
00:16:14,850 --> 00:16:19,480
configuration file but the original

353
00:16:16,960 --> 00:16:21,370
configuration file is on github is to

354
00:16:19,480 --> 00:16:23,740
switch on security and that's a great

355
00:16:21,370 --> 00:16:26,560
baseline but it's not production ready

356
00:16:23,740 --> 00:16:28,840
so what I did is we did like a live and

357
00:16:26,560 --> 00:16:32,859
learn type environment where we shipped

358
00:16:28,840 --> 00:16:35,350
our system on to a test test GPO and

359
00:16:32,860 --> 00:16:37,420
I'll let the users run for like two

360
00:16:35,350 --> 00:16:39,670
weeks and then I can filter out all the

361
00:16:37,420 --> 00:16:41,650
all the white noise all the legit

362
00:16:39,670 --> 00:16:43,329
programs so I let it run for about two

363
00:16:41,650 --> 00:16:45,130
weeks but I was looking at the logs

364
00:16:43,330 --> 00:16:47,590
every day filtering out and it's real

365
00:16:45,130 --> 00:16:49,120
simple config file you just exclude what

366
00:16:47,590 --> 00:16:50,800
you want but that's when it's come into

367
00:16:49,120 --> 00:16:53,500
play as well they know the advanced

368
00:16:50,800 --> 00:16:55,060
techniques they know the latter movement

369
00:16:53,500 --> 00:16:57,700
they know what mimic at artifacts they

370
00:16:55,060 --> 00:16:59,319
drop so you gotta do a little bit

371
00:16:57,700 --> 00:17:02,040
research if your analyst is not up to

372
00:16:59,320 --> 00:17:03,540
speed but he also got to make a

373
00:17:02,040 --> 00:17:05,879
offices what do you want to look for

374
00:17:03,540 --> 00:17:07,889
what's important to you do you care

375
00:17:05,880 --> 00:17:10,470
about lateral movement you care about

376
00:17:07,890 --> 00:17:12,449
persistence and ideally you want to

377
00:17:10,470 --> 00:17:16,319
capture the whole attack lifecycle The

378
00:17:12,449 --> 00:17:19,339
MITRE attack lifecycle is great but your

379
00:17:16,319 --> 00:17:21,750
environment is specific / / department

380
00:17:19,339 --> 00:17:24,839
finance might have an HR program that's

381
00:17:21,750 --> 00:17:28,230
there's logging crazy alerts but you

382
00:17:24,839 --> 00:17:30,360
just filter that out of finance HR they

383
00:17:28,230 --> 00:17:33,059
all have their own drone applications

384
00:17:30,360 --> 00:17:36,120
that they use so you have to filter that

385
00:17:33,059 --> 00:17:37,889
out out little by little ad hoc so I

386
00:17:36,120 --> 00:17:38,870
just did it like a two-week live and

387
00:17:37,890 --> 00:17:41,429
learn something

388
00:17:38,870 --> 00:17:43,949
any other questions yeah answer your

389
00:17:41,429 --> 00:17:53,040
questions sir okay any other questions

390
00:17:43,950 --> 00:17:54,750
ER so the question was did I use the

391
00:17:53,040 --> 00:17:56,370
winners of my collector and Windows

392
00:17:54,750 --> 00:17:59,610
event forwarding was that the question

393
00:17:56,370 --> 00:18:02,699
yes so what I did is I turned on Windows

394
00:17:59,610 --> 00:18:04,168
Oh event forwarding and that's that's an

395
00:18:02,700 --> 00:18:06,000
every endpoint it's one of them and

396
00:18:04,169 --> 00:18:08,309
forwarding and what that does it directs

397
00:18:06,000 --> 00:18:09,630
it to the ones on that collector and the

398
00:18:08,309 --> 00:18:11,908
winners of that collector is just a

399
00:18:09,630 --> 00:18:15,210
server Windows server and you turn that

400
00:18:11,909 --> 00:18:16,980
on and although all the windows logs it

401
00:18:15,210 --> 00:18:18,330
could be any type of window log goes

402
00:18:16,980 --> 00:18:24,330
through one is event collective and from

403
00:18:18,330 --> 00:18:28,129
there you shouldn't reach them yes yes

404
00:18:24,330 --> 00:18:32,340
[Music]

405
00:18:28,130 --> 00:18:36,570
yes yeah yeah distribute of platform

406
00:18:32,340 --> 00:18:38,549
distribute distributed format we I guess

407
00:18:36,570 --> 00:18:41,990
you call it but you have more than one

408
00:18:38,549 --> 00:18:41,990
window rent collector that's correct

409
00:18:51,350 --> 00:18:58,649
we'd like like redundancy we have not

410
00:18:55,470 --> 00:19:00,799
implemented redundancy at all yet so if

411
00:18:58,650 --> 00:19:04,140
it goes down and it does happen

412
00:19:00,799 --> 00:19:07,080
and when it goes down I'm in there you

413
00:19:04,140 --> 00:19:09,960
know trying to fix it so but the logs

414
00:19:07,080 --> 00:19:11,610
are still are still kept on the end

415
00:19:09,960 --> 00:19:13,770
point so it does eventually get pushed

416
00:19:11,610 --> 00:19:14,658
so it's not it's not the best-case

417
00:19:13,770 --> 00:19:21,408
scenario

418
00:19:14,659 --> 00:19:23,149
but you're right yes I have seen that

419
00:19:21,409 --> 00:19:25,309
from I t's witness security or something

420
00:19:23,149 --> 00:19:28,070
like that yeah he's awesome we haven't

421
00:19:25,309 --> 00:19:33,619
looked at it because I don't think it's

422
00:19:28,070 --> 00:19:36,109
free is it free yeah so we didn't look

423
00:19:33,619 --> 00:19:37,939
at it anything it's an uphill battle any

424
00:19:36,109 --> 00:19:39,678
time I want implement something I've got

425
00:19:37,940 --> 00:19:41,330
to get these five managers on board and

426
00:19:39,679 --> 00:19:45,080
the departments and there's a lot

427
00:19:41,330 --> 00:19:47,269
political play in there it's crazy so

428
00:19:45,080 --> 00:19:50,178
every time we implement something it

429
00:19:47,269 --> 00:19:52,340
takes a lot of battling with each

430
00:19:50,179 --> 00:19:55,549
manager in their own little book or

431
00:19:52,340 --> 00:19:59,359
world but not we haven't looked at it I

432
00:19:55,549 --> 00:20:01,580
know of it I use his resources a lot but

433
00:19:59,359 --> 00:20:04,279
his superstars koffe supercharger is by

434
00:20:01,580 --> 00:20:09,289
IT Windows security I believe and it's

435
00:20:04,279 --> 00:20:11,889
awesome anything else sir okay any other

436
00:20:09,289 --> 00:20:11,889
questions okay

437
00:20:13,489 --> 00:20:17,629
so we also had Puma always query so what

438
00:20:16,309 --> 00:20:22,249
we're trying to build here is an ad-hoc

439
00:20:17,629 --> 00:20:24,590
EDR platform that's what it is

440
00:20:22,249 --> 00:20:26,869
you know just without the nice front-end

441
00:20:24,590 --> 00:20:29,299
and stuff like that so what always

442
00:20:26,869 --> 00:20:31,249
queries built was built by Facebook

443
00:20:29,299 --> 00:20:34,809
trail bits actually owns it now and

444
00:20:31,249 --> 00:20:36,769
they're updating Dakota currently so

445
00:20:34,809 --> 00:20:39,559
always query is pretty awesome it's

446
00:20:36,769 --> 00:20:40,190
cross-platform great support for Linux

447
00:20:39,559 --> 00:20:41,869
in Mac's

448
00:20:40,190 --> 00:20:44,869
windows are starting to get there as

449
00:20:41,869 --> 00:20:46,668
well it's a great supplement that

450
00:20:44,869 --> 00:20:49,090
replacement is a great supplement

451
00:20:46,669 --> 00:20:54,200
companion to system on and vice versa

452
00:20:49,090 --> 00:20:55,879
it's open source we use the product of

453
00:20:54,200 --> 00:20:58,340
the abilities as well with Diffie so

454
00:20:55,879 --> 00:21:00,918
that's pretty cool we have in our CI CD

455
00:20:58,340 --> 00:21:05,840
pipeline and always query actually gets

456
00:21:00,919 --> 00:21:06,950
deployed with every new instance you

457
00:21:05,840 --> 00:21:08,928
know so you can use it for file

458
00:21:06,950 --> 00:21:12,349
integrity monitoring so anything the

459
00:21:08,929 --> 00:21:13,639
eight and time something changes on the

460
00:21:12,349 --> 00:21:16,279
endpoint that's not supposed to change

461
00:21:13,639 --> 00:21:19,789
you I'll tell you what changed on the

462
00:21:16,279 --> 00:21:20,960
endpoint so that's pretty cool there

463
00:21:19,789 --> 00:21:21,979
it's also a front-end if you're not

464
00:21:20,960 --> 00:21:24,750
comfortable in the command line

465
00:21:21,979 --> 00:21:30,990
we're always query you can do a life

466
00:21:24,750 --> 00:21:32,070
and I use a sequel query language so

467
00:21:30,990 --> 00:21:34,409
it's just some of the cool things you

468
00:21:32,070 --> 00:21:36,510
can some couple cool queries you can do

469
00:21:34,409 --> 00:21:39,179
with always query and this is taking

470
00:21:36,510 --> 00:21:41,280
from open sock there's a link in the

471
00:21:39,179 --> 00:21:44,669
bottom so if you go to a web page so the

472
00:21:41,280 --> 00:21:47,280
the Erica piano runs open sock I

473
00:21:44,669 --> 00:21:48,990
contribute to open sock but these are

474
00:21:47,280 --> 00:21:50,549
like a creep at the called query packs

475
00:21:48,990 --> 00:21:52,890
so some of the cool things you can do

476
00:21:50,549 --> 00:21:56,730
always query and always query is

477
00:21:52,890 --> 00:21:58,710
actively querying the end point where

478
00:21:56,730 --> 00:22:01,140
system on is retroactive it's not live

479
00:21:58,710 --> 00:22:03,419
but always query is it's like you're on

480
00:22:01,140 --> 00:22:06,240
you're on the box and actually creating

481
00:22:03,419 --> 00:22:08,070
the system on the command line so

482
00:22:06,240 --> 00:22:10,140
initial access right we care about

483
00:22:08,070 --> 00:22:11,850
initial access this is some pretty cool

484
00:22:10,140 --> 00:22:13,740
queries you can see email attachments

485
00:22:11,850 --> 00:22:18,149
you can see when the file was downloaded

486
00:22:13,740 --> 00:22:21,740
it so that's pretty cool and once again

487
00:22:18,150 --> 00:22:24,840
it's a sequel a sequel query language

488
00:22:21,740 --> 00:22:28,260
you can do execution so anybody that

489
00:22:24,840 --> 00:22:29,699
does forensics I do forensics you care

490
00:22:28,260 --> 00:22:32,669
about the pre fast right and the shim

491
00:22:29,700 --> 00:22:34,890
cache you can query the shim cash and

492
00:22:32,669 --> 00:22:37,169
the prefetch was always query so anytime

493
00:22:34,890 --> 00:22:40,020
there's executable on the endpoint or

494
00:22:37,169 --> 00:22:42,090
you want to see if it's actually running

495
00:22:40,020 --> 00:22:46,980
an endpoint you can query that way

496
00:22:42,090 --> 00:22:48,449
always query persistence schedule tasks

497
00:22:46,980 --> 00:22:50,340
what kind of schedule tasks on the

498
00:22:48,450 --> 00:22:52,710
endpoint is there already using that for

499
00:22:50,340 --> 00:22:53,970
persistence what kind of services are

500
00:22:52,710 --> 00:22:55,380
running on the endpoint you can't do

501
00:22:53,970 --> 00:23:01,409
that with this mom but you can do that

502
00:22:55,380 --> 00:23:07,080
well it's query my good on time there's

503
00:23:01,409 --> 00:23:11,070
no time in person okay logged in users

504
00:23:07,080 --> 00:23:14,129
that's pretty cool you know the laptop

505
00:23:11,070 --> 00:23:18,030
we're asking in my environment is hidden

506
00:23:14,130 --> 00:23:20,700
windows account like some the attacker

507
00:23:18,030 --> 00:23:23,639
crazy account and the used by hidden

508
00:23:20,700 --> 00:23:27,000
flag in the registry so we can never see

509
00:23:23,640 --> 00:23:32,160
the account but it was created but at

510
00:23:27,000 --> 00:23:34,679
you see who's locked in command control

511
00:23:32,160 --> 00:23:37,290
you can see listening processes what

512
00:23:34,679 --> 00:23:40,080
processes are being active in bikini now

513
00:23:37,290 --> 00:23:43,409
you know what YP address or is it zero

514
00:23:40,080 --> 00:23:44,040
zero zero file downloads again for

515
00:23:43,410 --> 00:23:47,760
command control

516
00:23:44,040 --> 00:23:51,720
so the mru the the save the open say kid

517
00:23:47,760 --> 00:23:57,000
right so the open say pig mr you that's

518
00:23:51,720 --> 00:23:59,720
when the little the little assist or the

519
00:23:57,000 --> 00:24:01,860
oh like the recent is the recent file

520
00:23:59,720 --> 00:24:03,690
any recent files on there on your

521
00:24:01,860 --> 00:24:09,629
endpoint those i'll be showed up on this

522
00:24:03,690 --> 00:24:15,270
on this artifact any questions about

523
00:24:09,630 --> 00:24:16,800
those always queries if not what would

524
00:24:15,270 --> 00:24:19,410
have done differently so now that i've

525
00:24:16,800 --> 00:24:20,820
gone through this experience good and

526
00:24:19,410 --> 00:24:22,470
bad what would have done differently

527
00:24:20,820 --> 00:24:25,200
what what would I do what would i

528
00:24:22,470 --> 00:24:27,540
recommend myself two years ago right a

529
00:24:25,200 --> 00:24:30,059
year ago what would i recommend myself i

530
00:24:27,540 --> 00:24:33,059
will set up a source control environment

531
00:24:30,059 --> 00:24:34,950
what do you got github pirate repo i

532
00:24:33,059 --> 00:24:36,420
would have definitely set up a source

533
00:24:34,950 --> 00:24:38,370
environment because we have different

534
00:24:36,420 --> 00:24:40,530
analysts different people changing your

535
00:24:38,370 --> 00:24:42,330
config file you want it's not all the

536
00:24:40,530 --> 00:24:44,879
times not annotated if it's source

537
00:24:42,330 --> 00:24:47,010
controlled you have to annotate it kind

538
00:24:44,880 --> 00:24:49,230
of demands to be annotated with good

539
00:24:47,010 --> 00:24:52,410
practices right so anything that changes

540
00:24:49,230 --> 00:24:54,929
it could break config file code could

541
00:24:52,410 --> 00:24:56,400
break the syntax of the config file the

542
00:24:54,929 --> 00:25:00,330
in source control just makes it easy to

543
00:24:56,400 --> 00:25:02,760
work back or see what changed have

544
00:25:00,330 --> 00:25:05,309
different configuration files for users

545
00:25:02,760 --> 00:25:07,890
servers and domain controllers because

546
00:25:05,309 --> 00:25:09,990
they're spying off different artifacts

547
00:25:07,890 --> 00:25:12,690
that you might not care about in one

548
00:25:09,990 --> 00:25:15,929
environment to the next so what I have

549
00:25:12,690 --> 00:25:22,200
in my environment is six config files

550
00:25:15,929 --> 00:25:25,350
I got users prod dev servers Prada

551
00:25:22,200 --> 00:25:27,239
domain controllers positive just so I

552
00:25:25,350 --> 00:25:31,649
can test my config rules before I

553
00:25:27,239 --> 00:25:34,049
shipping out to production so this is

554
00:25:31,649 --> 00:25:36,299
probably very important you want to have

555
00:25:34,049 --> 00:25:39,059
a champion on a different team because

556
00:25:36,299 --> 00:25:40,980
if it was just you saying to management

557
00:25:39,059 --> 00:25:42,389
this why I ran into like I want

558
00:25:40,980 --> 00:25:44,580
implements this monster's gonna help out

559
00:25:42,389 --> 00:25:46,859
but maybe someone that's trusted in the

560
00:25:44,580 --> 00:25:48,809
environment for 10 20 years five years

561
00:25:46,859 --> 00:25:51,330
in a different organist in different

562
00:25:48,809 --> 00:25:53,158
departments IT ops my case he was

563
00:25:51,330 --> 00:25:55,139
actually champion for system on he was

564
00:25:53,159 --> 00:25:56,940
my ally when I went up to those five

565
00:25:55,139 --> 00:25:59,279
different managers so that's that's a

566
00:25:56,940 --> 00:26:02,279
big deal that's awesome you know I took

567
00:25:59,279 --> 00:26:03,539
him to lunch I paid for his lunch and it

568
00:26:02,279 --> 00:26:06,649
was awesome he was like he was my

569
00:26:03,539 --> 00:26:09,570
champion when it came to deploying

570
00:26:06,649 --> 00:26:13,139
system on which they were hesitant it

571
00:26:09,570 --> 00:26:15,178
was uphill battle but we got it done

572
00:26:13,139 --> 00:26:18,600
we're retired team so I don't work I

573
00:26:15,179 --> 00:26:21,419
work dry honey but I saw the need of the

574
00:26:18,600 --> 00:26:24,299
ir team needing this system on OS query

575
00:26:21,419 --> 00:26:27,779
so I work with them Tom how to update

576
00:26:24,299 --> 00:26:29,999
the config file how to use sequel sequel

577
00:26:27,779 --> 00:26:33,029
queries on always query so work with

578
00:26:29,999 --> 00:26:36,570
your IR team from the beginning so it's

579
00:26:33,029 --> 00:26:38,970
easier to get your technical your your

580
00:26:36,570 --> 00:26:40,739
arms out of the pot I guess so when you

581
00:26:38,970 --> 00:26:42,419
back away they can troubleshoot their

582
00:26:40,739 --> 00:26:44,820
own or they can update their own config

583
00:26:42,419 --> 00:26:46,889
files and do their own queries and they

584
00:26:44,820 --> 00:26:48,689
can start less maintenance for yourself

585
00:26:46,889 --> 00:26:51,719
gotta wise you're the person that's it

586
00:26:48,690 --> 00:26:55,379
anything goes wrong they call you in you

587
00:26:51,720 --> 00:26:57,989
don't want that turn on our login as

588
00:26:55,379 --> 00:27:02,070
well so let me let me show you something

589
00:26:57,989 --> 00:27:14,869
pretty cool about our logging if I have

590
00:27:02,070 --> 00:27:14,869
time there we go

591
00:27:17,299 --> 00:27:26,960
so this is by Robert Rodriguez this is

592
00:27:20,840 --> 00:27:29,779
OS m OS sem and he actually annotated

593
00:27:26,960 --> 00:27:32,719
what does system on capture what

594
00:27:29,779 --> 00:27:34,399
the native login captures and he tells

595
00:27:32,719 --> 00:27:39,769
you

596
00:27:34,399 --> 00:27:42,799
for instance file Martin dry rot access

597
00:27:39,769 --> 00:27:46,519
can be captured by system on but if you

598
00:27:42,799 --> 00:27:49,820
turn on should creating and it which is

599
00:27:46,519 --> 00:27:51,859
it which is option right on uh on the

600
00:27:49,820 --> 00:27:54,049
endpoint you can actually have your

601
00:27:51,859 --> 00:27:55,939
hands login and you can actually have

602
00:27:54,049 --> 00:27:57,710
file monitoring with native log as well

603
00:27:55,940 --> 00:28:00,590
system on just makes a little bit easier

604
00:27:57,710 --> 00:28:03,489
and there is stuff that day login is

605
00:28:00,590 --> 00:28:07,099
better at this assessment and vice versa

606
00:28:03,489 --> 00:28:09,619
like Active Directory stuff native log

607
00:28:07,099 --> 00:28:11,389
is a lot better this month so that's

608
00:28:09,619 --> 00:28:18,320
pretty cool and it's by Robert Rodriguez

609
00:28:11,389 --> 00:28:22,939
cyber war dog and its OS SM iam so he

610
00:28:18,320 --> 00:28:25,489
done a lot a lot of research on what law

611
00:28:22,940 --> 00:28:28,700
captures what so I definitely recommend

612
00:28:25,489 --> 00:28:30,589
that as a baseline and what you want to

613
00:28:28,700 --> 00:28:36,669
capture what you want to look for this

614
00:28:30,589 --> 00:28:36,668
will help out oh crap how about get back

615
00:28:43,059 --> 00:28:48,889
yes sir will you be my friend

616
00:28:46,369 --> 00:28:51,289
a me on Twitter LinkedIn it doesn't

617
00:28:48,889 --> 00:28:53,449
matter that's my blog this slides will

618
00:28:51,289 --> 00:28:55,639
be posted with the links that's my

619
00:28:53,450 --> 00:28:59,419
github with some configuration files for

620
00:28:55,639 --> 00:29:01,939
system on what we use and some other

621
00:28:59,419 --> 00:29:04,309
cool projects like I work on the hive as

622
00:29:01,940 --> 00:29:06,889
well did some work with the hive which

623
00:29:04,309 --> 00:29:09,009
is a security incident response platform

624
00:29:06,889 --> 00:29:12,738
so I got couple apps on the hive there

625
00:29:09,009 --> 00:29:13,489
yeah that's about it any questions give

626
00:29:12,739 --> 00:29:19,419
you three minutes back

627
00:29:13,489 --> 00:29:19,419
any questions alright thank you

