1
00:00:00,000 --> 00:00:07,690
pain live Linux forensics so what's that
about anyway I'm gonna tell you how in a

2
00:00:07,690 --> 00:00:12,500
few minutes time you can determine with
some level of certainty if someone

3
00:00:12,500 --> 00:00:18,619
hacked your not so you know can you
figure this out can you

4
00:00:18,619 --> 00:00:24,710
minimally disturbed your subject system
can you automate this process with some

5
00:00:24,710 --> 00:00:35,070
shell scripting so why should you care
if someone calls you about a suspected

6
00:00:35,070 --> 00:00:41,050
breach and you need to figure out pretty
quickly if they were hot you know you

7
00:00:41,050 --> 00:00:47,730
want to do this quickly so they don't
avoid or so that you do avoid any

8
00:00:47,730 --> 00:00:54,329
further harm to their system you also
don't want to destroy any evidence and

9
00:00:54,329 --> 00:00:58,570
if it's a critical system you don't want
to take it offline while you try to

10
00:00:58,570 --> 00:01:04,930
figure it out some of you might know me
some of you might wonder who this

11
00:01:04,930 --> 00:01:10,510
extremely handsome guy is a digital
forensics professor at each at

12
00:01:10,510 --> 00:01:15,090
Bloomsburg University of Pennsylvania
I've been programming since I was a

13
00:01:15,090 --> 00:01:20,340
bitch in the same way since I was 10
also been known to hawk electronic

14
00:01:20,340 --> 00:01:26,790
sensors around 12 per cell use latex for
a long time I actually have my own

15
00:01:26,790 --> 00:01:31,590
version of what it's called Equinix runs
on the BeagleBoard BeagleBone in similar

16
00:01:31,590 --> 00:01:38,500
things and I've written a couple pots
rubicam no power hacking devices last

17
00:01:38,500 --> 00:01:45,100
year book and Lenox forensics they came
out the summer and have another bought

18
00:01:45,100 --> 00:01:51,079
and USB friends that's coming out maybe
around the end of this year which is why

19
00:01:51,079 --> 00:01:56,680
it says insert who will cover out here
and I think that the cover art and the

20
00:01:56,680 --> 00:01:58,259
friends it's pretty good

21
00:01:58,259 --> 00:02:04,420
alright so what do you wanna talk about
we don't talk about how do you open in

22
00:02:04,420 --> 00:02:11,020
case you know how do you talk to the
users and from there how do you make out

23
00:02:11,020 --> 00:02:19,000
known good binaries how do you minimize
the disruption to the system how do you

24
00:02:19,000 --> 00:02:22,310
collect data what kind did you want to
collapse

25
00:02:22,310 --> 00:02:28,690
automate all this stuff with scripting
and some next steps if there actually

26
00:02:28,690 --> 00:02:30,260
was a breach

27
00:02:30,260 --> 00:02:39,360
so the first thing you want to do is
open in case so the first thing you have

28
00:02:39,360 --> 00:02:45,450
to do when you open a case is figure out
what you gonna call that case well if

29
00:02:45,450 --> 00:02:50,290
you don't know what to do is to use the
day you probably not investigating

30
00:02:50,290 --> 00:02:56,940
multiple rating systems any given day if
you are maybe you have some problems you

31
00:02:56,940 --> 00:03:00,650
know maybe he's more people in your
organization or better security or

32
00:03:00,650 --> 00:03:06,980
parole so what you probably want to do
is create a case folder on your laptop

33
00:03:06,980 --> 00:03:09,510
on your friends ex workstation

34
00:03:09,510 --> 00:03:17,150
and you also want to start making some
entries he in your notebook so I like to

35
00:03:17,150 --> 00:03:21,459
have you know some people think this is
old school but I like to have a balanced

36
00:03:21,459 --> 00:03:27,620
no clogged with numbered page now if you
can't find one with numbered pages you

37
00:03:27,620 --> 00:03:32,180
can easily number them yourself assuming
of course that you know how to count

38
00:03:32,180 --> 00:03:41,000
right these are easy to carry their hard
to insert or remove pages so if anyone

39
00:03:41,000 --> 00:03:46,980
ever says oh you added that later you
can say no i didnt or fake wonder

40
00:03:46,980 --> 00:03:52,849
something's missing you can say there's
no pages here might know also they don't

41
00:03:52,849 --> 00:04:01,730
need any batteries so that's a plus so
once you open this case and you started

42
00:04:01,730 --> 00:04:08,180
making entries in the first thing you
want to do is talk to the user's why

43
00:04:08,180 --> 00:04:12,849
won't they know the situation better
than you know they have some good

44
00:04:12,849 --> 00:04:17,019
contacts for the situation

45
00:04:17,019 --> 00:04:22,090
other reasons why do you want to talk to
the user's first you might be able to

46
00:04:22,090 --> 00:04:27,229
avoid doing any of the fun technical
stuff because you might talk to them and

47
00:04:27,229 --> 00:04:32,120
find out all while someone was running
the script from this little class that

48
00:04:32,120 --> 00:04:36,639
he took last we and nobody else knew
about it and nothing really happened

49
00:04:36,639 --> 00:04:44,460
here if you do talk to them and it's not
something that simple you might want to

50
00:04:44,460 --> 00:04:52,330
ask questions like why did you call me
know what do you think happened you call

51
00:04:52,330 --> 00:04:59,250
me for a reason why are there no
internal experts I'm Linux at your

52
00:04:59,250 --> 00:05:04,620
organization or perhaps there's some
sort of policy where they say if we

53
00:05:04,620 --> 00:05:08,500
suspected breach we always get an
external person come in and evaluate

54
00:05:08,500 --> 00:05:12,820
that you know why do you think there was
something

55
00:05:12,820 --> 00:05:18,710
everything you know about that subject
system what's it used for what operating

56
00:05:18,710 --> 00:05:23,660
system does it run who's typically on it
except these are the kinds of things you

57
00:05:23,660 --> 00:05:33,820
want to get from a user's once you've
finished interviewing the user's you

58
00:05:33,820 --> 00:05:37,640
want to start thinking about actually
touching the machine actually doing the

59
00:05:37,640 --> 00:05:45,780
fun stuff so you are a USB response
drive and what's going to be on this

60
00:05:45,780 --> 00:05:50,610
response Dr well one thing you
definitely need are some known good

61
00:05:50,610 --> 00:05:51,900
wineries

62
00:05:51,900 --> 00:05:57,640
you don't want to be running possibly
Trojan binaries on the subject system

63
00:05:57,640 --> 00:06:05,000
adding minimum you're going to want to
get then and has been for the same

64
00:06:05,000 --> 00:06:12,070
architecture so they're running 64 bit
limits grab those running 32 bit Linux

65
00:06:12,070 --> 00:06:21,530
by the way is anyone here still run 32
bit Linux helpful if you read it was

66
00:06:21,530 --> 00:06:27,870
available for Linux 64 bit Linux was
available before that you could buy the

67
00:06:27,870 --> 00:06:29,220
stinking chips

68
00:06:29,220 --> 00:06:33,880
just I was a little surprised that
people still run it but anyway

69
00:06:33,880 --> 00:06:43,380
grab a compatible architecture you might
also want to grab user user user web if

70
00:06:43,380 --> 00:06:47,380
you want to run a couple of extra
towards that you don't really need for

71
00:06:47,380 --> 00:06:54,220
this part but you must no matter what
you grab it has to be on some sort of an

72
00:06:54,220 --> 00:06:57,780
ex our system either X 2304

73
00:06:57,780 --> 00:07:03,389
and the reason for that is permission
you can't put it on a FAT file system

74
00:07:03,389 --> 00:07:10,050
and how they maintain all the execution
permissions etc it was not gonna work

75
00:07:10,050 --> 00:07:10,540
for you

76
00:07:10,540 --> 00:07:17,360
definitely not for system minors so you
might decide that you also want to have

77
00:07:17,360 --> 00:07:22,470
a bootable Linux now that bootable Linux
is probably gonna have to be on another

78
00:07:22,470 --> 00:07:30,390
partition because most of those
installed on a FAT partition it also has

79
00:07:30,390 --> 00:07:35,090
to be the first partition so you can't
say later on let me let me add this to

80
00:07:35,090 --> 00:07:39,150
the end of my drive it's probably not
gonna work so you have to make that

81
00:07:39,150 --> 00:07:48,010
decision if you go to this link here
when it's forensics book dot com we have

82
00:07:48,010 --> 00:07:53,550
a bunch of videos that go along with
this one extrinsic spot and there you

83
00:07:53,550 --> 00:07:58,380
can watch them they're freer and my
friend is selling anything but this

84
00:07:58,380 --> 00:08:03,900
video actually goes through this process
and shows you a easy way to develop one

85
00:08:03,900 --> 00:08:08,580
of these response drives inside a
virtual machine so that you don't have

86
00:08:08,580 --> 00:08:15,090
to tie up your nice computer forever
does anyone ever installed sift it was

87
00:08:15,090 --> 00:08:21,470
installed safety does it take a long
time to download all those packages can

88
00:08:21,470 --> 00:08:27,200
can take hours so why type your home
machine just put that sucker in a

89
00:08:27,200 --> 00:08:30,930
virtual machine so if you watch that
video it will show you how you can mount

90
00:08:30,930 --> 00:08:36,589
a physical problem drive inside of
VirtualBox and do it that way I find a

91
00:08:36,589 --> 00:08:44,480
lot more so you've got your thumb drive
and now you need to mount you're no good

92
00:08:44,480 --> 00:08:46,930
by owners so how's that going

93
00:08:46,930 --> 00:08:53,010
you want to insert a response drive and
then you need to exact your version of

94
00:08:53,010 --> 00:08:58,920
Flash not the one that's there that
would be a bad idea then you have to set

95
00:08:58,920 --> 00:09:05,990
your power to point to your binaries and
only turbine areas then you need to set

96
00:09:05,990 --> 00:09:13,310
ldlibrarypath so that all the shared
libs are the correct ones and you want

97
00:09:13,310 --> 00:09:20,500
to run all of your scripts as Bosch
followed by the name of the script don't

98
00:09:20,500 --> 00:09:27,730
have she bangs on the first line of the
scripts right because what is that gonna

99
00:09:27,730 --> 00:09:34,220
point to its gonna point to the Trojan
ones don't go through all this work of

100
00:09:34,220 --> 00:09:41,149
loading known good binaries and then run
the Trojan ones in the end a lot of

101
00:09:41,149 --> 00:09:41,540
effort

102
00:09:41,540 --> 00:09:48,339
absolutely nothing right so what does
that look like he might have audio

103
00:09:48,339 --> 00:09:59,830
might just near frequency

104
00:09:59,830 --> 00:10:12,520
now that's a little bit scratchy August
dairy so here I live in my drive and now

105
00:10:12,520 --> 00:10:23,150
and now it has auto mounted this file
system because it was an export file

106
00:10:23,150 --> 00:10:29,230
system so I'm gonna pull a shell and
this is on the subject system by the way

107
00:10:29,230 --> 00:10:34,420
you might have noticed warning messages
and the reason for that the system has

108
00:10:34,420 --> 00:10:42,640
actually been hacked so now I'm changing
to the directory where I how my own good

109
00:10:42,640 --> 00:10:55,850
binaries and exact my Bosch said my path
so I'm going to use a little trick that

110
00:10:55,850 --> 00:11:02,110
you can do in a bad cell where if you
take a command and you put it inside the

111
00:11:02,110 --> 00:11:10,420
parentheses following that follow a
dollar sign he will run that come in and

112
00:11:10,420 --> 00:11:15,940
then put the results in that place so
you see where I have dollar sign PWD

113
00:11:15,940 --> 00:11:24,330
repeatedly its gonna put that huge path
to my thumb drive repeatedly in my power

114
00:11:24,330 --> 00:11:30,700
and I do the exact same thing for the
library and this is just a quick test

115
00:11:30,700 --> 00:11:40,700
morning if config to make sure that it's
working properly so now I have some

116
00:11:40,700 --> 00:11:47,090
known good binaries I want to start
doing some frenzies again I want to

117
00:11:47,090 --> 00:11:50,730
minimize the disturbance to my system

118
00:11:50,730 --> 00:11:54,550
you know you're always gonna change it a
little bit but we want to try to

119
00:11:54,550 --> 00:12:02,190
minimize that as much as I can we now
have ever won a right to the subject to

120
00:12:02,190 --> 00:12:08,510
media and we want to try to minimize our
memory footprint so there are two basic

121
00:12:08,510 --> 00:12:16,250
options here you can either write
everything to your USB Drive or you can

122
00:12:16,250 --> 00:12:25,029
send it over the network so sunny Leone
over the network I think that this is

123
00:12:25,029 --> 00:12:31,070
better than using the USB Drive
primarily due to cash if you know

124
00:12:31,070 --> 00:12:38,440
anything about USB flash media it is
very slow for writing operations so it

125
00:12:38,440 --> 00:12:44,570
is highly cashed so if you don't do that
if you don't send stuff over the

126
00:12:44,570 --> 00:12:49,070
networking think I'll just put it on a
thumb drive cuz it's super easy you

127
00:12:49,070 --> 00:12:57,380
might consume a lot more memory is some
evidence or so they think so if he want

128
00:12:57,380 --> 00:13:04,149
to send it over the network you can use
your old friend that cat by the way pat

129
00:13:04,149 --> 00:13:10,079
or in C and most systems are exactly the
same alias sometimes I hear people have

130
00:13:10,079 --> 00:13:15,860
these debates are you then see that cat
it's the same thing about you can

131
00:13:15,860 --> 00:13:21,949
actually figure that out of my system so
what you want to do is created listener

132
00:13:21,949 --> 00:13:26,420
on your friends workstation for log
information so I'm gonna run a bunch of

133
00:13:26,420 --> 00:13:32,110
commands and I'm gonna pipe the output
which I call log information to my

134
00:13:32,110 --> 00:13:39,680
friend's ex workstation so I will create
a listener as well my friends its

135
00:13:39,680 --> 00:13:46,100
workstation her files that you might see
a suspicious-looking file and you might

136
00:13:46,100 --> 00:13:50,050
want to send that or you might even have
something as simple as the password file

137
00:13:50,050 --> 00:13:51,350
that you want to send

138
00:13:51,350 --> 00:13:57,890
etcetera so the way that the file
listener works is i've a listener that

139
00:13:57,890 --> 00:14:02,830
just sit there and it waits for someone
to say I'm gonna send you a file here's

140
00:14:02,830 --> 00:14:08,470
the files once it receives a message
like that its bonds in new listener to

141
00:14:08,470 --> 00:14:16,770
actually receive a binary data and
that's just a little bit easier so how

142
00:14:16,770 --> 00:14:22,380
do you set up a listener well you can
run net and how many have you used that

143
00:14:22,380 --> 00:14:27,600
catch a lot of you that he is not happy
for C you know if you want to set up a

144
00:14:27,600 --> 00:14:34,450
listener he just saying that shell and
the dash lol option for sale I want to

145
00:14:34,450 --> 00:14:40,470
list her support and by the fall it will
listen on all of your eye peas on that

146
00:14:40,470 --> 00:14:46,310
for the dash option is meant that
connection a lot

147
00:14:46,310 --> 00:14:52,470
typically price and a line to my
listener it says thank you and I will

148
00:14:52,470 --> 00:15:01,110
tell me so we want to keep it alive
during our tests so from the subject you

149
00:15:01,110 --> 00:15:06,810
have a command and then you can wipe it
to netcat and then give it the IP of

150
00:15:06,810 --> 00:15:13,360
your friends it's worth station and then
we report you and we will use shell

151
00:15:13,360 --> 00:15:20,480
scripting to automate this now some of
you might like pipeline who like I like

152
00:15:20,480 --> 00:15:23,930
pipeline to buy it for this purpose

153
00:15:23,930 --> 00:15:29,120
python is going to use a little bit more
memory so I want to minimize that

154
00:15:29,120 --> 00:15:35,760
disturbance so I'm actually going to use
shell scripting instead of pipeline

155
00:15:35,760 --> 00:15:38,850
so I'm trying out on me

156
00:15:38,850 --> 00:15:45,180
the listener so I have a simple shell
script here that runs on my friends its

157
00:15:45,180 --> 00:15:52,090
workstation and I just run it and I give
it a case number so you can see the

158
00:15:52,090 --> 00:16:00,720
statement is showing up here and then I
say did you give me less than one

159
00:16:00,720 --> 00:16:07,320
argument if you did I'm gonna tell you a
messed up and show you use it otherwise

160
00:16:07,320 --> 00:16:15,510
I'm gonna say I'm starting a case if the
directory doesn't exist that's the if

161
00:16:15,510 --> 00:16:24,590
not the dollar sign one then I create it
I create a log listener again I use and

162
00:16:24,590 --> 00:16:31,270
see with the desk hey option to keep it
alive and then I said all of this

163
00:16:31,270 --> 00:16:38,370
information to a file called log txt and
notice I have that running back ticks

164
00:16:38,370 --> 00:16:44,510
and I background it with him percent and
then I just print out a little message

165
00:16:44,510 --> 00:16:51,500
saying well guess what I just started
this blog listener I also start the file

166
00:16:51,500 --> 00:17:00,070
faster which is a separate script right
at the very bottom

167
00:17:00,070 --> 00:17:06,220
minds so I'm a client-side I have a
little script that sets a couple of

168
00:17:06,220 --> 00:17:12,050
environment variables I will admit this
is not the world's most sophisticated

169
00:17:12,050 --> 00:17:17,370
script right I could have done this
different ways but again remember the

170
00:17:17,370 --> 00:17:23,300
goal here was to be simple and use the
least amount of memory and that's why I

171
00:17:23,300 --> 00:17:29,840
just a whole bunch it if then statements
are you say did you give me an IP

172
00:17:29,840 --> 00:17:37,570
address cuz I need at least that and I
set things if you didn't give me things

173
00:17:37,570 --> 00:17:43,230
I said the false all throughout this
script and that's it it's setting these

174
00:17:43,230 --> 00:17:56,310
environment variables to automating the
client side of this is to have a man or

175
00:17:56,310 --> 00:18:02,590
a script that will run a command and
send the output across the network to my

176
00:18:02,590 --> 00:18:08,660
friends experts deja so you can see from
the usage statement how does this work

177
00:18:08,660 --> 00:18:12,540
you just run the script and then you
give it the thing that you want to run

178
00:18:12,540 --> 00:18:21,960
what is it do it just a little banner so
the the line at the UN might look a

179
00:18:21,960 --> 00:18:27,930
little involved but if you decode it
here's what it's gonna do so i'm gona C

180
00:18:27,930 --> 00:18:29,960
Eko dash E

181
00:18:29,960 --> 00:18:35,270
that means please interpret things like
the backslash so i'm saying sending the

182
00:18:35,270 --> 00:18:43,780
wall for a dollar sign at his command
that was passed to the script and then

183
00:18:43,780 --> 00:18:48,130
the date and a couple more plus signs
and then a new run

184
00:18:48,130 --> 00:18:53,080
and then noticed that I'm using my
little trick again I have dollar sign

185
00:18:53,080 --> 00:18:55,040
and then a command in parentheses

186
00:18:55,040 --> 00:18:59,620
that command just happens to be dollar
sign at everything you passed it right

187
00:18:59,620 --> 00:19:05,730
so any command you passed it and all the
arguments and that gets output and then

188
00:19:05,730 --> 00:19:11,380
I put a little better at the end saying
that ok that was your and output and I

189
00:19:11,380 --> 00:19:20,050
passed that to netcat it's really pretty
simple what about sending files so I

190
00:19:20,050 --> 00:19:24,950
thought listener I'm forensics
workstation that's listening for filing

191
00:19:24,950 --> 00:19:31,510
so when it receives a file it creates a
new listener to receive the file data

192
00:19:31,510 --> 00:19:40,400
and it redirects the file to the one
with incorrect name right so there I

193
00:19:40,400 --> 00:19:44,350
don't want to keep a lifeless I wanna
listener that's going to get the file

194
00:19:44,350 --> 00:19:50,680
and when I get to the end of the file I
want that lets her go away on the client

195
00:19:50,680 --> 00:19:59,000
side I will send the file may cause just
a little bit I probably don't really

196
00:19:59,000 --> 00:20:02,320
have to but I would rather pause for a
few seconds

197
00:20:02,320 --> 00:20:08,280
know that it's gonna work than risk that
you know maybe he should I try to send

198
00:20:08,280 --> 00:20:20,040
up to sales and the listener wasn't up
yet so here is the file listener and if

199
00:20:20,040 --> 00:20:29,760
you call it you need to give it a file
and all it does is it creates a filing

200
00:20:29,760 --> 00:20:30,900
was dinner

201
00:20:30,900 --> 00:20:35,010
notice this one doesn't have the
keepalive switch and I have a little

202
00:20:35,010 --> 00:20:36,020
dulu

203
00:20:36,020 --> 00:20:41,590
infinite you live and as soon as it
exits that first line that means that

204
00:20:41,590 --> 00:20:46,470
somebody sent me something so it's gonna
drop into the next line where create

205
00:20:46,470 --> 00:20:53,100
another listener port 55 56 and I
redirect everything to my file

206
00:20:53,100 --> 00:21:00,160
and what its gonna do is it's going to
go back to the top and create another

207
00:21:00,160 --> 00:21:06,309
listener profile name it works pretty
well it's like the poor man's at TV

208
00:21:06,309 --> 00:21:15,010
actually what about the client side so
that clients these first couple lines

209
00:21:15,010 --> 00:21:19,530
are just defaults for testing in case I
didn't you know set up that other stuff

210
00:21:19,530 --> 00:21:27,809
that I showed you on a previous trip and
it's easy I just say this script given a

211
00:21:27,809 --> 00:21:33,960
filename and it says did you give me a
filename or not if you didn't even give

212
00:21:33,960 --> 00:21:43,299
you usage ID law get to my little log
file and then I sent it across and

213
00:21:43,299 --> 00:21:47,450
here's where I wait I sleep for five
seconds just to make sure everything

214
00:21:47,450 --> 00:21:55,390
that's going on the other side and then
I send the data when I'm done I want to

215
00:21:55,390 --> 00:22:02,000
clean up so how do I do that I want to
close all these listeners close the case

216
00:22:02,000 --> 00:22:11,419
file so here's my script for that I just
say hey let me record in my log that I

217
00:22:11,419 --> 00:22:19,260
shut this down and I just use case start
file listener and then finally I do kill

218
00:22:19,260 --> 00:22:26,080
all on that cat because occasionally you
might how netcat listener that's kind of

219
00:22:26,080 --> 00:22:32,929
orphaned out there so there's just kind
of cleans up so that's some of the you

220
00:22:32,929 --> 00:22:37,870
know technical details it's not really
sophisticated scripting but it works

221
00:22:37,870 --> 00:22:45,000
so let's talk about collecting data so
what did you want to collapse and why

222
00:22:45,000 --> 00:22:51,260
the first thing you wanna get is the
date why do you want that well because

223
00:22:51,260 --> 00:23:00,450
there can be a clocks you on a subject
system as most of you probably know most

224
00:23:00,450 --> 00:23:06,970
computer clocks clock rate they are
horrible at keeping time what's the only

225
00:23:06,970 --> 00:23:11,450
thing that keeps them sort of accurate
is the time served and not everybody

226
00:23:11,450 --> 00:23:17,420
uses right some people lot time servers
I used to work at University of redacted

227
00:23:17,420 --> 00:23:28,179
where they blocked I see freddy is like
for university university they blocked

228
00:23:28,179 --> 00:23:32,950
time servers like oh you can't go out on
the internet you get the correct I'm

229
00:23:32,950 --> 00:23:39,100
sorry Blackett you might also have a
different time zone maybe the time zones

230
00:23:39,100 --> 00:23:44,830
messed up maybe the time zone is
different from your times then you want

231
00:23:44,830 --> 00:23:50,940
to collect the kernel version using you
named a this will tell you exactly what

232
00:23:50,940 --> 00:23:55,559
colonel was being run and you can check
that kernel for any known

233
00:23:55,559 --> 00:24:02,760
vulnerabilities other things you want to
collapse

234
00:24:02,760 --> 00:24:07,530
what network interfaces are on this
machine so you can do it if config dash

235
00:24:07,530 --> 00:24:12,110
and you can say are there any new
interface

236
00:24:12,110 --> 00:24:18,420
are there any strange addresses being
assigned to my interfaces what is the

237
00:24:18,420 --> 00:24:26,410
network connections like you can run
netstat ANP and you can check for

238
00:24:26,410 --> 00:24:31,429
suspicious internet addresses that are
being connected to like here in Grand

239
00:24:31,429 --> 00:24:32,340
Rapids and

240
00:24:32,340 --> 00:24:36,220
machines talking to Russia a lot

241
00:24:36,220 --> 00:24:43,039
doing that are there any strange
localhost connection sometimes attackers

242
00:24:43,039 --> 00:24:49,240
will start services on the local host
because most IDS and IPS systems don't

243
00:24:49,240 --> 00:24:55,539
look at though they only look at the
real network interfaces are there any

244
00:24:55,539 --> 00:25:02,640
suspicious for its programs running on
the wrong ports a lot of people might

245
00:25:02,640 --> 00:25:14,370
try to run malware on port 80 lie port
8080 not many people right yeah yeah

246
00:25:14,370 --> 00:25:19,870
University redacted exactly yeah they
probably blocked it I know they block it

247
00:25:19,870 --> 00:25:28,890
actually so more things you might want
to collect you want to look at what

248
00:25:28,890 --> 00:25:35,299
files are open so you can use lsof -i
its capital he gives you some nice

249
00:25:35,299 --> 00:25:41,659
verbose output so you know you can see
what programs are using certain files

250
00:25:41,659 --> 00:25:49,340
and ports and if you have malware on
your system in general if any of these

251
00:25:49,340 --> 00:25:55,860
commands fail a lot that's a good
indication of malware right and the

252
00:25:55,860 --> 00:26:02,970
windows world you're like a man it feels
like its windows but most Linux users

253
00:26:02,970 --> 00:26:07,710
they want something that fails they go
oh I'm suspicious right they don't just

254
00:26:07,710 --> 00:26:15,679
go home just reboot reboot see what
happened so we might see this failed

255
00:26:15,679 --> 00:26:20,649
this is actually very common to me that
does feel when you have malware analytic

256
00:26:20,649 --> 00:26:28,460
spots what running processes are there
for the ps2 ash which will give you a

257
00:26:28,460 --> 00:26:30,540
full listing of everything

258
00:26:30,540 --> 00:26:36,770
you might also like pas aux so slightly
different listening you can run on both

259
00:26:36,770 --> 00:26:43,490
its ok electrons are cheap you can run
both of them are there things that are

260
00:26:43,490 --> 00:26:51,570
running as root that should be our their
accounts that shouldn't be logging in

261
00:26:51,570 --> 00:26:59,170
that our login in running start again
this might also fail if you've got some

262
00:26:59,170 --> 00:27:05,660
malware on that system what about
routing information you can run a

263
00:27:05,660 --> 00:27:10,880
netstat dash are in here and you can
also run route I recommend that you run

264
00:27:10,880 --> 00:27:14,220
both if they differ

265
00:27:14,220 --> 00:27:22,030
that's another pretty good indication
you been happy if they don't run you

266
00:27:22,030 --> 00:27:29,290
been hot guys see sense a theme here so
things don't run you gonna agree youve

267
00:27:29,290 --> 00:27:35,120
been had also you can look for things
that are routed through a new interface

268
00:27:35,120 --> 00:27:40,580
as one of the interfaces become the
default on its not normally that way for

269
00:27:40,580 --> 00:27:49,370
their new gateways in your network what
about mounted filesystem you can run out

270
00:27:49,370 --> 00:27:56,680
and see if there's anything new you can
also run this free you might think why

271
00:27:56,680 --> 00:28:00,270
would I run that you get slightly
different information and again

272
00:28:00,270 --> 00:28:05,780
sometimes people will alter the
information from out and not for dia

273
00:28:05,780 --> 00:28:10,920
also an EF will show you thought systems
are filling up which might be another

274
00:28:10,920 --> 00:28:18,320
indication that something bad has been
happening it's sometimes depending on

275
00:28:18,320 --> 00:28:23,240
the file system mount options might
matter you might find that amount

276
00:28:23,240 --> 00:28:30,380
options have been changed again you know
disagreements equals malware some other

277
00:28:30,380 --> 00:28:36,270
things that you might want to look at
you can create temporary file system and

278
00:28:36,270 --> 00:28:39,309
these are used a lot in some Linux
system

279
00:28:39,309 --> 00:28:46,409
in fact and some distros by the false /
TMP there's actually a temp files so

280
00:28:46,409 --> 00:28:56,139
when you reboot goes away so if I was a
hacker about how that is I might want to

281
00:28:56,139 --> 00:29:02,809
store stuff on a temporary file system
so the evidence goes away a reboot by

282
00:29:02,809 --> 00:29:08,100
the way I will give you this little hit
if you're looking for pictures for your

283
00:29:08,100 --> 00:29:09,789
slide

284
00:29:09,789 --> 00:29:18,980
very careful when you use Google Images
to look up mounted you'll get a lot of

285
00:29:18,980 --> 00:29:26,700
very interesting sick right panel
modules what kernel modules are loaded

286
00:29:26,700 --> 00:29:32,730
you can use a less mod to list them are
there new device drivers did somebody

287
00:29:32,730 --> 00:29:37,460
change in the modules are there just
strange modules that you've never seen

288
00:29:37,460 --> 00:29:46,549
before who is logged in now you can run
the W commands some of you might be

289
00:29:46,549 --> 00:29:47,460
familiar with it

290
00:29:47,460 --> 00:29:54,629
who command w's the same thing except it
also gives you the command line that was

291
00:29:54,629 --> 00:29:57,190
the last run by that user

292
00:29:57,190 --> 00:30:02,929
which is yet another reason you should
not be entering your passwords on the

293
00:30:02,929 --> 00:30:08,129
command line right some databases etc
have an option where he could be lazy

294
00:30:08,129 --> 00:30:13,289
and not type in your password a prom you
know maybe you want to put it in the

295
00:30:13,289 --> 00:30:16,029
script hey that's great idea

296
00:30:16,029 --> 00:30:25,460
secure the date it just plain text so
yes I can run W and I can get the full

297
00:30:25,460 --> 00:30:30,529
command not just what they ran but
exactly what they were in including any

298
00:30:30,529 --> 00:30:31,700
parameters

299
00:30:31,700 --> 00:30:39,309
I can see who's been logging in using
asked you know are there any system

300
00:30:39,309 --> 00:30:44,960
accounts that shouldn't be logging in
that have been logging in their accounts

301
00:30:44,960 --> 00:30:50,330
that don't normally log into this
machine you know maybe it's machine and

302
00:30:50,330 --> 00:30:57,200
I got Bob from accounting is logging in
their innings failed logins that's where

303
00:30:57,200 --> 00:31:04,279
the last to be a man can help you so if
you see repeated failures and then a

304
00:31:04,279 --> 00:31:09,330
success right so I run last and I see
that someone logged in at a certain time

305
00:31:09,330 --> 00:31:14,130
and before that I C 30 failed login
attempts what does that tell me

306
00:31:14,130 --> 00:31:22,169
someone's got a bad right if I only see
30 attempts in the top 30 of that

307
00:31:22,169 --> 00:31:28,350
passwords for graduation so that tells
me that someone's passwords been cracked

308
00:31:28,350 --> 00:31:39,549
and finally user login information so I
probably when a sin at C password and at

309
00:31:39,549 --> 00:31:47,610
sea shower or I want to look for a newly
created loggins not everyone would do

310
00:31:47,610 --> 00:31:52,809
that but some people will use system
tools to create a new login is so

311
00:31:52,809 --> 00:31:58,200
where's that you logging in and be right
at the bottom of these files it's like

312
00:31:58,200 --> 00:32:05,380
our own there's nothing I look there's a
new one looks at all suspicious are

313
00:32:05,380 --> 00:32:10,820
their system accounts with shells again
things that shouldn't be logged in

314
00:32:10,820 --> 00:32:17,430
that suddenly have a shell and a home
directory their accounts with I D 0

315
00:32:17,430 --> 00:32:24,960
a company where I once worked had a
sysadmin tell me the story which I can

316
00:32:24,960 --> 00:32:29,830
only go on what he said because I surely
have zero knowledge of what actually

317
00:32:29,830 --> 00:32:37,840
happened in this case but he said he
felt that this strange thing there's

318
00:32:37,840 --> 00:32:46,000
this new account called nobody that
showed up and are the main here at this

319
00:32:46,000 --> 00:32:56,980
company and Scott user 80 really don't
say it's this kind of interesting wonder

320
00:32:56,980 --> 00:33:04,880
how that happened but so of course what
did that mean you had someone with root

321
00:33:04,880 --> 00:33:08,410
access they created a new account

322
00:33:08,410 --> 00:33:13,670
gave it user IDs 0 give it a name that
sounded kinda like Generic like nobody

323
00:33:13,670 --> 00:33:21,220
here no one something like that and sure
enough from what I remember that the

324
00:33:21,220 --> 00:33:22,380
sysadmin told me

325
00:33:22,380 --> 00:33:28,670
course I have no personal knowledge of
what happened here the that account was

326
00:33:28,670 --> 00:33:37,470
out there for about six months before
anybody now I suspect using my detective

327
00:33:37,470 --> 00:33:43,980
skills what might have happened is that
say a system admin left themselves login

328
00:33:43,980 --> 00:33:54,500
as root on a console and they actually
had the root login for the entire NIS

329
00:33:54,500 --> 00:33:57,540
domain

330
00:33:57,540 --> 00:34:03,510
across the system they weren't using
local root logins said one root password

331
00:34:03,510 --> 00:34:09,910
for the whole friggin domain so I
suspect but I can't prove again I have

332
00:34:09,910 --> 00:34:13,200
no personal knowledge as to what exactly
happened here

333
00:34:13,200 --> 00:34:20,470
that someone noticed this root shell and
created this account my case at around

334
00:34:20,470 --> 00:34:24,609
six months to look for stuff like that

335
00:34:24,609 --> 00:34:31,970
accounts with passwords that shouldn't
have passwords or do you have system

336
00:34:31,970 --> 00:34:37,169
accounts don't know again and suddenly
they have a password password doesn't

337
00:34:37,169 --> 00:34:43,000
make any sense so how do you put all
this together you can put it together

338
00:34:43,000 --> 00:34:48,460
and one big happy script and that's
always done here is I have the script

339
00:34:48,460 --> 00:34:55,329
it's like my initial scan script and all
I do is call myself my script and I run

340
00:34:55,329 --> 00:35:04,200
all the commands I just talked about by
the way who else loves this teacher

341
00:35:04,200 --> 00:35:08,560
don't know if you can read it it says
Goraya replace you with a very small

342
00:35:08,560 --> 00:35:14,720
shell script I just thought it was
hilarious so here's what it looks like

343
00:35:14,720 --> 00:35:23,420
when you run that script so here again I
mounted mine own good binaries and I

344
00:35:23,420 --> 00:35:34,950
have mine own good bash already and I'm
just going to run this script

345
00:35:34,950 --> 00:35:49,770
so I'm on my forensic work station I
started their case and PSU can see some

346
00:35:49,770 --> 00:35:58,290
of my net cut listeners are associated
files and processes I source file or

347
00:35:58,290 --> 00:36:03,490
setup script we're set those parameters
and I give it that I P of my friends its

348
00:36:03,490 --> 00:36:11,320
workstation I run my initial scan and
boom I'm done already done so that was

349
00:36:11,320 --> 00:36:16,290
easy so now the question is well I guess
I should probably look at the log file

350
00:36:16,290 --> 00:36:24,650
you know I know that's kinda like who
works at the log files so many people

351
00:36:24,650 --> 00:36:32,089
walk stuff never low so I'm still trying
to ask that question have I been hacked

352
00:36:32,089 --> 00:36:38,670
well I'm running that's that what
happened what's my output formats that

353
00:36:38,670 --> 00:36:43,730
nothing

354
00:36:43,730 --> 00:36:52,140
Ellis OS output from that command
nothing looking pretty bad as it's

355
00:36:52,140 --> 00:37:02,540
looking unlikely that I've been hacked
who is John with to end so if you look

356
00:37:02,540 --> 00:37:07,530
at the highlighted portion you'll notice
that there is a user a legit user John

357
00:37:07,530 --> 00:37:14,500
John Smith and I see this John with 2
N's

358
00:37:14,500 --> 00:37:20,660
and it almost looks like someone tried
to impersonating the first user didn't

359
00:37:20,660 --> 00:37:33,890
check out the home directory home / .
John and then their shell has been bash

360
00:37:33,890 --> 00:37:37,830
so why would it be

361
00:37:37,830 --> 00:37:43,710
. John it's a hidden file right so
that's another thing that I might want

362
00:37:43,710 --> 00:37:48,910
to look at it later but again right now
we're just trying to do triage we're

363
00:37:48,910 --> 00:37:56,410
trying to say fifteen minutes or so its
own happy or not should I go further in

364
00:37:56,410 --> 00:38:07,510
this investigation why did these
accounts have passwords WEP see what she

365
00:38:07,510 --> 00:38:19,570
has a password for a strange might like
diem is a display manager for my GUI

366
00:38:19,570 --> 00:38:27,400
environment this is a system account why
would it ever have a password that

367
00:38:27,400 --> 00:38:38,240
doesn't make any sense who's been logged
in lately John with 2 N's bin Laden and

368
00:38:38,240 --> 00:38:47,880
his good old buddy like p.m. has been
logging into my system and I see that

369
00:38:47,880 --> 00:38:54,730
John with 2 N's has long been multiple
times and I can note when this occurred

370
00:38:54,730 --> 00:38:59,980
right this can tell me about a breach
might have occurred and that will help

371
00:38:59,980 --> 00:39:07,660
me when I started doing my later dead
analysis etc

372
00:39:07,660 --> 00:39:15,369
who failed again your attacker screwed
up at least ones he he tried to set up

373
00:39:15,369 --> 00:39:21,780
this light p.m. account to be able to
log in but I don't know if you fat

374
00:39:21,780 --> 00:39:25,630
fingered password or maybe didn't get
the shell set up correctly or some some

375
00:39:25,630 --> 00:39:28,450
sort of problem prevented it from one
yet

376
00:39:28,450 --> 00:39:37,859
alright it's looking pretty good right
so now what are you gonna do well this

377
00:39:37,859 --> 00:39:43,690
is kind of my high level incident
response so the first thing is somebody

378
00:39:43,690 --> 00:39:49,640
called you he said was there incident or
not and if it if it wasn't the case you

379
00:39:49,640 --> 00:39:55,760
can adopt him that you know why do they
think so but that in your knowledge of

380
00:39:55,760 --> 00:40:02,140
lessons to learn so in this case you're
pretty sure there was an incident now

381
00:40:02,140 --> 00:40:11,079
you can decide you live in houses or not
and then announces you know sometimes

382
00:40:11,079 --> 00:40:14,460
you want to do that sometimes you don't

383
00:40:14,460 --> 00:40:19,980
and of course everyone's favorite is the
writing reports part they're always

384
00:40:19,980 --> 00:40:27,020
trying to avoid that 100 baht that can
be your job I'll do all the funds so if

385
00:40:27,020 --> 00:40:30,859
you are doing live in else's

386
00:40:30,859 --> 00:40:36,700
in some cases you might actually skip
the lab analysis just go straight to bed

387
00:40:36,700 --> 00:40:41,339
analysis but if you do want to do live
in Dallas as you can use the same kind

388
00:40:41,339 --> 00:40:48,630
of technique you can grab some file
metadata Istanbul scripts all the

389
00:40:48,630 --> 00:40:52,829
scripts are available for download on
extrinsic spoke.com

390
00:40:52,829 --> 00:40:59,490
again I try to sell you think they're
all open source and you can grab things

391
00:40:59,490 --> 00:41:04,030
like the user's history someone walk
files

392
00:41:04,030 --> 00:41:11,320
you can get hashes of suspicious files
you can dump the RAM now any of you use

393
00:41:11,320 --> 00:41:17,160
volatility is usable chilean Linux

394
00:41:17,160 --> 00:41:23,010
couple of you so you probably know that
you have to compile program called live

395
00:41:23,010 --> 00:41:28,260
the Linux memory extractor do not come

396
00:41:28,260 --> 00:41:36,730
files on the subject computer right
especially this guy so it's a really bad

397
00:41:36,730 --> 00:41:40,540
idea again remember one of our rules was
you don't write to the subject media

398
00:41:40,540 --> 00:41:48,910
well don't compiles on that computer cuz
you're gonna write to the media to

399
00:41:48,910 --> 00:41:52,130
compile it on your friends at work
station there's some pretty easy ways

400
00:41:52,130 --> 00:41:57,810
that it's also you know you should know
that it is a little bit risky when you

401
00:41:57,810 --> 00:42:02,990
run line there's always the chance that
the system will just straight-up crash

402
00:42:02,990 --> 00:42:08,060
so I do recommend you might want to
collect some volatile data like the

403
00:42:08,060 --> 00:42:14,140
network information etc before you run
like right and then you can compare

404
00:42:14,140 --> 00:42:21,510
those results as well you might want to
do some traditional data analysis in

405
00:42:21,510 --> 00:42:28,170
most cases unless you just can not take
that system off why it's a lot better to

406
00:42:28,170 --> 00:42:32,830
do that analysis is just so much more
mature there so many more tools

407
00:42:32,830 --> 00:42:39,680
available to you however if you can't
shut down that system you can still get

408
00:42:39,680 --> 00:42:54,290
a file system image CCFL the house that
cool I better see at least 30 so DCF Ltd

409
00:42:54,290 --> 00:43:00,580
if you're not familiar is just a
forensic Lee enhanced version DVD for

410
00:43:00,580 --> 00:43:07,820
all good at pushing friend and it will
allow you to get an image of a running

411
00:43:07,820 --> 00:43:13,920
system and life how you might not be
able to use that court sometimes you

412
00:43:13,920 --> 00:43:19,420
don't care if you can figure out what
happened and you can find other evidence

413
00:43:19,420 --> 00:43:28,190
that you can use in court that still
good as I said it's a lot more mature

414
00:43:28,190 --> 00:43:34,480
one thing I will warn you about
volatility is a somewhat new tool and

415
00:43:34,480 --> 00:43:42,050
Linux support is due to a new tool and
as a result I found that it falls down a

416
00:43:42,050 --> 00:43:48,870
lot if you're running a recent Linux
Bernal and I don't mean just a 4.0

417
00:43:48,870 --> 00:43:54,820
colonel I mean if you're running a later
three . they 16 or higher

418
00:43:54,820 --> 00:44:03,400
colonel i've seen that a lot of the
volatility modules just falling ice also

419
00:44:03,400 --> 00:44:11,320
I have not found anyone that could point
me to a single incident where something

420
00:44:11,320 --> 00:44:16,910
they discovered from a memory dump
wasn't also discoverable somewhere else

421
00:44:16,910 --> 00:44:22,660
so again you know sometimes you might
hear people debating can I even use

422
00:44:22,660 --> 00:44:31,060
things from volatility as part of my
keys and i know i would say why not but

423
00:44:31,060 --> 00:44:37,380
in addition to that you will almost
always mean I have not seen a

424
00:44:37,380 --> 00:44:46,410
counterexample at least find the same
evidence somewhere else other place that

425
00:44:46,410 --> 00:44:51,369
you can say I got some good majority
rules that proved that this happened

426
00:44:51,369 --> 00:44:58,509
alright so if you wanted to find out
some more I heard a rumor that there was

427
00:44:58,509 --> 00:45:03,269
a new book out it had cool cover
everything

428
00:45:03,269 --> 00:45:08,920
other things as they said there's some
good resources for free you can download

429
00:45:08,920 --> 00:45:17,539
videos also some of these scripts from
when its forensic spoke.com feel free to

430
00:45:17,539 --> 00:45:23,740
come talk to me later with you have any
questions

431
00:45:23,740 --> 00:45:50,089
yes sir you're concerned about using
unencrypted stuff to push it over the

432
00:45:50,089 --> 00:45:57,309
network yet always if that's a concern
you could encrypt it there is a small

433
00:45:57,309 --> 00:46:01,670
concerned that that's going to increase
your memory footprints on the subject

434
00:46:01,670 --> 00:46:08,140
system but sometimes it makes sense now
the other thing I would say is what's

435
00:46:08,140 --> 00:46:13,170
the best situation let's let's say I'm
going to the subject system if I can

436
00:46:13,170 --> 00:46:19,230
physically touch it I could probably do
something like you know connect a

437
00:46:19,230 --> 00:46:23,289
crossover cable to it if if it has an
available network or and then I don't

438
00:46:23,289 --> 00:46:26,960
have to worry about that so much but
yeah definitely

439
00:46:26,960 --> 00:46:47,940
yes sir I don't have a book no question
was recommendations for mobile forensics

440
00:46:47,940 --> 00:46:54,450
and offhand I'd like nothing's coming to
mind you're correct things like Android

441
00:46:54,450 --> 00:46:59,619
Android is sort of like Linux but not
exactly and I think the other thing is

442
00:46:59,619 --> 00:47:02,920
there's not an equivalent that I know of

443
00:47:02,920 --> 00:47:10,700
like for volatility memory analysis for
Android it's also the file systems used

444
00:47:10,700 --> 00:47:21,290
on your Android device are not gonna be
like text or call systems in case anyone

445
00:47:21,290 --> 00:47:28,140
else thanks for staying alive you know
till three o'clock on a Saturday

446
00:47:28,140 --> 00:47:28,650
afternoon

