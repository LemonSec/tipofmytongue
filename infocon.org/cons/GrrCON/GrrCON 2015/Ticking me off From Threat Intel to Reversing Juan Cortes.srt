1
00:00:00,000 --> 00:00:05,560
to hear me talk about stuff and cups
many Swan Cup score test if you want to

2
00:00:05,560 --> 00:00:09,769
know the nickname we can't chat about it
later but the two-time what was best re

3
00:00:09,769 --> 00:00:17,070
this might put a hand 08260 networks
with the G Global Security Response Team

4
00:00:17,070 --> 00:00:22,150
so it's a new team and what particularly
with the mower racing team so we reverse

5
00:00:22,150 --> 00:00:30,619
all thinks disorder the outline in a way
that question marks there but that's

6
00:00:30,619 --> 00:00:39,059
anyway so we're going to do anyways we
have talked with autofocus that we do

7
00:00:39,059 --> 00:00:44,600
cool things to do in autofocus story
time and then some reversing its gonna

8
00:00:44,600 --> 00:00:49,820
be a lot of cups so embrace it and and
hope you have a good time so I decided

9
00:00:49,820 --> 00:00:53,800
another trend into platform yes another
one

10
00:00:53,800 --> 00:01:01,109
basically out of focus acute dataset
with about 600 million samples that we

11
00:01:01,109 --> 00:01:05,650
dynamically an ally analyzed from a
wildfire system rebuild reports on that

12
00:01:05,650 --> 00:01:09,950
and then we can carry all that although
samples all those reports and we have

13
00:01:09,950 --> 00:01:12,900
all the session they did you see what
i'm talking bout with the session they

14
00:01:12,900 --> 00:01:19,100
go back and it's all elastic lot of
magic in the back in I'm not familiar

15
00:01:19,100 --> 00:01:23,689
with but anyway so I don't really focus
it to kind of took up security

16
00:01:23,689 --> 00:01:28,580
operations group you received these
things called tags I just can't actual

17
00:01:28,580 --> 00:01:31,869
meanings to your searches and you'll see
what I'm talking my name in it

18
00:01:31,869 --> 00:01:37,869
USS and find evidence to this and tell
you apply it to your infrastructure and

19
00:01:37,869 --> 00:01:42,290
you get your preventing things the other
one is the threat analyst people which

20
00:01:42,290 --> 00:01:43,490
is you know you search

21
00:01:43,490 --> 00:01:50,610
I'll see samples equally all this data
where attribution campaign etcetera

22
00:01:50,610 --> 00:01:53,710
you build these tags until and

23
00:01:53,710 --> 00:01:57,700
you're good to go so that's sort of
turned into analyst jobs that I feel

24
00:01:57,700 --> 00:02:04,400
like it is so let me show you real quick
to let them know hopefully I figured it

25
00:02:04,400 --> 00:02:23,239
work better if we do in life so let's
see here

26
00:02:23,239 --> 00:02:29,620
shrink it allowed here

27
00:02:29,620 --> 00:02:34,180
dashboard about a focus you know grabs
Sarah

28
00:02:34,180 --> 00:02:40,180
you know programs maps toted killed the
way you can look at tax here but the

29
00:02:40,180 --> 00:02:44,030
target no waves so we can do

30
00:02:44,030 --> 00:02:49,720
behavior of searches all the powers that
we collect with the behavior so we can

31
00:02:49,720 --> 00:02:54,440
only detect about 300 different
behaviors in wildfire we can't detect

32
00:02:54,440 --> 00:02:58,890
and then make a decision based on those
behaviors so for example him just really

33
00:02:58,890 --> 00:03:03,910
quickly search for behaviour long sleep
so anything that lead to sleep for a

34
00:03:03,910 --> 00:03:04,570
long time

35
00:03:04,570 --> 00:03:09,989
registry changes anything that sets
itself autostart anything that writes

36
00:03:09,989 --> 00:03:14,690
the Windows folder and then I kinda not
narrowed down to this date it's not

37
00:03:14,690 --> 00:03:16,660
specifically for this demolition

38
00:03:16,660 --> 00:03:21,620
this is what I feel comfortable with
then this is what I practice and so we

39
00:03:21,620 --> 00:03:28,459
searched it said Gina and then all
samples cause I have to research and we

40
00:03:28,459 --> 00:03:34,459
got about 26,000 samples and then you
see some of these are texts are private

41
00:03:34,459 --> 00:03:39,549
so for my team etc and then just once
but the little icon therefore uniformly

42
00:03:39,549 --> 00:03:46,269
to their public so sexy things right on
the allows well can you do with that you

43
00:03:46,269 --> 00:03:49,350
can do for the exit if anything that's
trying to reach out there so it could

44
00:03:49,350 --> 00:03:53,500
cut it off here but again

45
00:03:53,500 --> 00:04:02,730
all samples

46
00:04:02,730 --> 00:04:06,880
33 and they're all lots of musical
chairs there's a blog post out there

47
00:04:06,880 --> 00:04:08,940
interested in to what that is

48
00:04:08,940 --> 00:04:16,010
its activity you know we can search for
HPI post get all the regulations p

49
00:04:16,010 --> 00:04:25,750
user agents and so true that way again

50
00:04:25,750 --> 00:04:35,919
multi plug i mean I don't get in trouble
anyway so you can also search for files

51
00:04:35,919 --> 00:04:41,480
activity prospect AV registry couple in
behaviour there and they can search for

52
00:04:41,480 --> 00:04:53,270
that and that's akin awhile till samples
so but track my where you know cool and

53
00:04:53,270 --> 00:04:57,230
that's what I can also search for that
activity

54
00:04:57,230 --> 00:05:05,360
sort of this one you can search for see
this one comes up as poison ivy ok

55
00:05:05,360 --> 00:05:16,110
that's it for the number right out of
focus now lets them over to go back to

56
00:05:16,110 --> 00:05:26,860
story time so we get we get reports from
my in so people are wearing me just

57
00:05:26,860 --> 00:05:31,350
looking at Auto Show you and we're
getting reports that there was a smaller

58
00:05:31,350 --> 00:05:35,690
that was in 2008 incorrectly in awhile
fire system for whatever reason so we

59
00:05:35,690 --> 00:05:39,250
wanted to know what would it was great
so this would happen to be a part trade

60
00:05:39,250 --> 00:05:40,440
nothing you

61
00:05:40,440 --> 00:05:44,919
has been around since 2013 it's
extremely relevant or prevalent in the

62
00:05:44,919 --> 00:05:51,510
article is in our until platform 600,000
samples so Downloader downloads more now

63
00:05:51,510 --> 00:05:59,640
where you can find more references I
think they're interested so quick what

64
00:05:59,640 --> 00:06:05,610
looked like an autofocus very low
activity there not a lot you can go off

65
00:06:05,610 --> 00:06:12,030
this kind of DBT report historic recent
Halo deductions

66
00:06:12,030 --> 00:06:17,390
there's another one really knew back in
october first again not a lot of

67
00:06:17,390 --> 00:06:21,979
activity there you can really go off
until this is definitely not where the

68
00:06:21,979 --> 00:06:27,169
top their AC while we mentally fit that
so but essentially when we looked at

69
00:06:27,169 --> 00:06:33,080
this in Lisbon nine so definitely you
know whatever same thing same sample

70
00:06:33,080 --> 00:06:39,940
showed you previously and btw so time to
reverse right this is where we get this

71
00:06:39,940 --> 00:06:42,479
is where I get to have someone's right
you know

72
00:06:42,479 --> 00:06:49,580
fill my cup with overseeing joy so
initial analysis really quick throw it

73
00:06:49,580 --> 00:06:56,680
in Novi MI changed exe and PDF icon
right whilst fishy Russian info with us

74
00:06:56,680 --> 00:07:01,640
eff Explorer be partially familiar with
that if not you know definitely talk to

75
00:07:01,640 --> 00:07:06,349
you more about it later but you know we
get some version info there that's you

76
00:07:06,349 --> 00:07:11,430
know if the bathtub at the other thing I
like to look at two is the peace action

77
00:07:11,430 --> 00:07:13,960
so visually with the P

78
00:07:13,960 --> 00:07:19,900
file format particularly this one caught
my attention that that data such as you

79
00:07:19,900 --> 00:07:26,210
can see the virtual size X 1128 and
they're all sizes X 800 what does that

80
00:07:26,210 --> 00:07:29,710
mean if you're not familiar with it
basically means that there's either code

81
00:07:29,710 --> 00:07:33,940
that's gonna be read into that section
or its packed going to impact in memory

82
00:07:33,940 --> 00:07:39,970
again just to kind of show you you know
we're definitely looking at my where

83
00:07:39,970 --> 00:07:43,640
it's not you know it's predictable right
where we're not dealing with anything

84
00:07:43,640 --> 00:07:49,270
that's only got to try to hide it so so
again what mitchell dynamic analysis

85
00:07:49,270 --> 00:07:54,560
through it up and picnic lunch faking
that process monitor you can see I ran

86
00:07:54,560 --> 00:08:00,520
it three times other times if process
monitor works the little green burrito

87
00:08:00,520 --> 00:08:05,580
bar here just shows you how long it's
been running for you know ran very very

88
00:08:05,580 --> 00:08:09,680
little and then an accident so what what
is it doing what you know what what's

89
00:08:09,680 --> 00:08:14,190
going on now we're really going to get
to reverse real tanks

90
00:08:14,190 --> 00:08:20,900
so suddenly i dont shots so wasn't sure
how to presented to you guys but you

91
00:08:20,900 --> 00:08:25,270
know well if you have any questions the
other talks just shoot me you know talk

92
00:08:25,270 --> 00:08:37,210
to me so it basically a very simple code
below its trade set-ups Windows typical

93
00:08:37,210 --> 00:08:43,520
windows window in order to do that you
called a Windows 32 API and one of them

94
00:08:43,520 --> 00:08:49,300
special class which is registers your
window to window system pushes one

95
00:08:49,300 --> 00:08:56,050
argument which is the window class
structure that structure has a member

96
00:08:56,050 --> 00:08:59,920
call when product which is a Windows
call back they get calls every time you

97
00:08:59,920 --> 00:09:03,880
interact with the window so that's
interested in because this is what it

98
00:09:03,880 --> 00:09:08,710
looks like to call back and that's the
particular code block away interested in

99
00:09:08,710 --> 00:09:13,770
what does that look like so I need a
couple of things they're not the best

100
00:09:13,770 --> 00:09:17,810
naming convention but I just wanna show
you how you know when you reverse you

101
00:09:17,810 --> 00:09:23,290
don't go in the back and I'm gonna name
this this is the model code or you know

102
00:09:23,290 --> 00:09:27,670
this is a global variable that it uses
for something just as you perceive

103
00:09:27,670 --> 00:09:35,570
things and whatever works for you so
obviously interested in that global

104
00:09:35,570 --> 00:09:40,290
variable something he worked as it gets
pushed the stack you know in the ESX

105
00:09:40,290 --> 00:09:43,670
value be traced back as obviously come
from ECI

106
00:09:43,670 --> 00:09:49,550
I get the time from the global coming
from what is it doing so again in the

107
00:09:49,550 --> 00:09:53,900
same windows callback you see that
little better but in the something D

108
00:09:53,900 --> 00:09:58,959
where you can see it's getting at it
from Sun Valley ECI acts coming from the

109
00:09:58,960 --> 00:10:04,130
bottom same thing it's whatever value
it's a TX is getting a tattoo that

110
00:10:04,130 --> 00:10:05,660
something

111
00:10:05,660 --> 00:10:14,740
and its housing being used so going back
to that goal blocked a way Justin this

112
00:10:14,740 --> 00:10:20,150
is basically about again keeping track
that hold our global variable is moving

113
00:10:20,150 --> 00:10:25,440
to TX in its call into the other Coco
location in this weather looks and I

114
00:10:25,440 --> 00:10:35,080
don't know so keep in mind that value
from the outset its gonna move to ATX

115
00:10:35,080 --> 00:10:41,580
and it's getting attractive and well as
holding our global variable rate and

116
00:10:41,580 --> 00:10:46,870
what did that turn out to be well then
exchanges with TX and TX and then I

117
00:10:46,870 --> 00:10:53,720
suppose that new value that been
subtracted and from the global variable

118
00:10:53,720 --> 00:10:56,620
and is getting pushed the stack and
you'll see why

119
00:10:56,620 --> 00:11:01,450
and getting pushed us to give it away at
the with the comment section but

120
00:11:01,450 --> 00:11:07,280
eventually called makes it onto the jump
in that location which is just doing

121
00:11:07,280 --> 00:11:07,650
this

122
00:11:07,650 --> 00:11:14,590
adding 26 any Chinese million with cold
flow what is returning to you never

123
00:11:14,590 --> 00:11:19,460
called anything how's it going to return
to something that doesn't know well from

124
00:11:19,460 --> 00:11:23,410
their house only works for Chinese just
whatever is on top of the stack up Santi

125
00:11:23,410 --> 00:11:28,930
AP and starts executing their so was on
top of the stack was our index value

126
00:11:28,930 --> 00:11:33,760
which was you know figure out from the
offset subtracted from my global

127
00:11:33,760 --> 00:11:39,920
variable that was I get in the car
before and it lands here so

128
00:11:39,920 --> 00:11:43,810
I dot has not some of this for you
because just going it to the address

129
00:11:43,810 --> 00:11:51,079
that we're interested in this 4289
impress c4 code and then disassembled

130
00:11:51,079 --> 00:11:55,279
for you rate this is all good we're
getting somewhere just noting that when

131
00:11:55,279 --> 00:11:59,620
I show you how to handle things here at
the bottom there I just telling you that

132
00:11:59,620 --> 00:12:05,470
it's labeled a chunk code location 402 E
72 but the actual code is jumping plus

133
00:12:05,470 --> 00:12:10,010
two bites from that location so if you
go to that location and i dont the first

134
00:12:10,010 --> 00:12:15,870
two instructions are make no sense if
you're familiar with assembly or from

135
00:12:15,870 --> 00:12:22,350
looking at to become our honeymoon with
us but we can go ahead and change that

136
00:12:22,350 --> 00:12:28,610
so what we do is good I don t change
although the data bytes go back to the

137
00:12:28,610 --> 00:12:33,079
right location which is 40 to 60 70
fuller dressy and you have to call it

138
00:12:33,079 --> 00:12:37,480
now makes more sense the first lunch
options obviously flow better with the

139
00:12:37,480 --> 00:12:44,760
code at this point I haven't showed you
an impersonation but I'm obviously and

140
00:12:44,760 --> 00:12:49,410
at the same time at this point there's
nothing more I can show you here and

141
00:12:49,410 --> 00:12:56,430
that's beneficial but essentially this
is what I do at 72 at the code loop

142
00:12:56,430 --> 00:13:01,889
throughout the cold all the time keeping
all the uninteresting parts and

143
00:13:01,889 --> 00:13:07,279
you know I show you why so here just
want to show you how the code starts to

144
00:13:07,279 --> 00:13:12,189
call in itself here we have a loop it's
Xin subtracting values and storing them

145
00:13:12,189 --> 00:13:17,369
somewhere else so kinda hard to
visualize but focus may be on to it

146
00:13:17,369 --> 00:13:22,549
three bites and then that's before the
code and then after the colon you know

147
00:13:22,549 --> 00:13:24,059
what has changed

148
00:13:24,059 --> 00:13:29,720
Estacada itself right it does a couple
of times where the whole matter what the

149
00:13:29,720 --> 00:13:34,279
law states up seven out seven while I
find something interesting but we get to

150
00:13:34,279 --> 00:13:38,689
a Windows 32 API call which is better
protect which will protect basically

151
00:13:38,689 --> 00:13:44,529
just changes the memory protections on
my memory page and for example here is

152
00:13:44,529 --> 00:13:50,889
changing it on hex 41042 41,000
allocated memory map is obviously the

153
00:13:50,889 --> 00:13:55,519
top tax section of this now our sample
which already has paycheck secure and

154
00:13:55,519 --> 00:14:00,730
read but it's obviously going to add
right and you'll see why in a minute so

155
00:14:00,730 --> 00:14:06,669
eventually again at seven of seven and
we land to call yaks

156
00:14:06,669 --> 00:14:13,309
told that forty 1090 show here but if
you went to the bug and then step into

157
00:14:13,309 --> 00:14:18,249
this call and and look at item and that
memory location and look at the code is

158
00:14:18,249 --> 00:14:20,809
not going to be the same it probably
won't either probably won't even to

159
00:14:20,809 --> 00:14:26,249
somewhere for you cause the code it's
obviously not recorded so that's why the

160
00:14:26,249 --> 00:14:30,529
bug was necessary at this point or
beyond this point but I think it done

161
00:14:30,529 --> 00:14:31,559
right

162
00:14:31,559 --> 00:14:36,079
obviously they called it a section I was
looking at you know when those 32 API

163
00:14:36,079 --> 00:14:42,399
calls but there's a large again quickly
show you how the co starts to the code

164
00:14:42,399 --> 00:14:47,429
itself as I reverse this and you start
seemed coach closing you start member I

165
00:14:47,429 --> 00:14:52,629
know memorizing but recognizing
different coaching you start labeling

166
00:14:52,629 --> 00:14:54,049
things

167
00:14:54,049 --> 00:15:00,660
label that call to the code P dozen
Dakota P doesn't mean that the coho p

168
00:15:00,660 --> 00:15:05,749
file issues I just what I named a tattoo
at that time but again focus on those

169
00:15:05,749 --> 00:15:09,480
instructions there if you notice they
don't pretty much makes sense right

170
00:15:09,480 --> 00:15:12,970
you're moving 2.0 values from UCI plus
tax

171
00:15:12,970 --> 00:15:15,180
night after nine

172
00:15:15,180 --> 00:15:21,370
really not with the code below after
that call for that call we have

173
00:15:21,370 --> 00:15:24,030
obviously shocked that makes sense so
again

174
00:15:24,030 --> 00:15:27,250
gonna show you that you need to you know
can really do the statically kind of

175
00:15:27,250 --> 00:15:34,560
have to the bucket so eventually we make
it to this coal block and cytosine it's

176
00:15:34,560 --> 00:15:36,230
calling things off stack

177
00:15:36,230 --> 00:15:47,820
ok so maybe maybe we're done but there's
more stuff so I step into that call off

178
00:15:47,820 --> 00:15:54,600
the stack that location and are
presented with again find something

179
00:15:54,600 --> 00:15:58,540
interesting here if you're not familiar
with it this is just the according to

180
00:15:58,540 --> 00:16:05,760
API with some aspects are again I didn't
mention this earlier and I apologize but

181
00:16:05,760 --> 00:16:09,750
when will reverse something to my boss
has taught me is you have to have a goal

182
00:16:09,750 --> 00:16:13,130
when you reverse you know you can't just
go in a filing start reversing

183
00:16:13,130 --> 00:16:16,980
everything instruction or figured out
what every coach unless that's your goal

184
00:16:16,980 --> 00:16:21,050
that's fine but for example for here we
already know it's a party so we don't

185
00:16:21,050 --> 00:16:25,070
need to identify them out we already
know that what a party does we can look

186
00:16:25,070 --> 00:16:30,390
up in Google hundreds of different parts
of what up I does we're interested in to

187
00:16:30,390 --> 00:16:36,130
why is it not running within our system
and that's that's our goal here we don't

188
00:16:36,130 --> 00:16:44,420
care but once we get out of there this
time the clear but yet function pointer

189
00:16:44,420 --> 00:16:50,910
232 API calls now so this one is create
process and its towing it to memory

190
00:16:50,910 --> 00:16:55,370
location whatever planning at EDI EDI is
off the stack at that moment so it's

191
00:16:55,370 --> 00:17:01,910
starting to tilt the API calls onto the
stack so so we were here I'd up to that

192
00:17:01,910 --> 00:17:09,300
call me come out of it he star scene
star see get takeout get much of

193
00:17:09,300 --> 00:17:14,609
filename create process great success I
think we made it we have when the

194
00:17:14,610 --> 00:17:20,690
stadium to API calls now I think we're
inside with Josh I'm hours doing so then

195
00:17:20,690 --> 00:17:23,240
we stopped over there gets account

196
00:17:23,240 --> 00:17:28,790
it compares it to some value that get to
come returns and if it's below it comes

197
00:17:28,790 --> 00:17:34,640
down to a process which is just quits is
done and this is kind of where we

198
00:17:34,640 --> 00:17:39,780
figured out what it was doing great get
taken into Windows API that checks the

199
00:17:39,780 --> 00:17:46,390
returns the value in milliseconds
physicist has been up 49.7 days so going

200
00:17:46,390 --> 00:17:47,120
back

201
00:17:47,120 --> 00:17:53,620
can see that get takeout gets called and
the ballot this comparing it it's much

202
00:17:53,620 --> 00:18:02,240
easier where point whatever acts AFC 80
which is close to 12 minutes so the

203
00:18:02,240 --> 00:18:05,650
sample is checking whether the system
was up for two minutes

204
00:18:05,650 --> 00:18:10,670
wasn't it exited out and just didn't do
any of the cool stuff that was meant to

205
00:18:10,670 --> 00:18:15,080
do again we don't care what the cost of
this day which is killer wireless-n

206
00:18:15,080 --> 00:18:22,730
money we figured it out on my cup has
been filled we improved the platform

207
00:18:22,730 --> 00:18:28,740
with obviously better detection for
these kind of anti analysis techniques

208
00:18:28,740 --> 00:18:34,510
you know we can go back to clean cups
and a leader with more common knowledge

209
00:18:34,510 --> 00:18:42,210
in time but good awesome when I practice
I was going over Lake two minutes so you

210
00:18:42,210 --> 00:18:47,179
have any questions if not hope you guys
learn something I know some of the

211
00:18:47,179 --> 00:18:50,940
assembly and the person I went through
quickly but if you have any questions

212
00:18:50,940 --> 00:18:53,690
I'll be more than happy to sit down and
talk to you about it

213
00:18:53,690 --> 00:19:07,850
yep to which i would tell him and we're
hiring if you're reverser and you want

214
00:19:07,850 --> 00:19:23,580
to rehearse with us let me know so an
autofocus we saw that this is the right

215
00:19:23,580 --> 00:19:27,350
there ready know how stuff works and
there were getting information from

216
00:19:27,350 --> 00:19:34,440
either out of focus reports or from the
intelligence that they have no back and

217
00:19:34,440 --> 00:19:41,110
they figured things out so this is kind
of how we work so I I love in tow and I

218
00:19:41,110 --> 00:19:44,370
will do it but i'm not the best at it
and

219
00:19:44,370 --> 00:19:47,680
they'll ever seen but they don't tend to
not the best at it so we kind of

220
00:19:47,680 --> 00:19:59,400
complement each other this is where I
jump in figure out why it was that

221
00:19:59,400 --> 00:20:02,140
correctly

222
00:20:02,140 --> 00:20:15,930
questions no ok so forget it was going
we talked to a lot of our system which

223
00:20:15,930 --> 00:20:20,540
is developed by the bank and for that we
told you made this is what's going on

224
00:20:20,540 --> 00:20:26,970
you guys should you know look this API
call in return something else actually

225
00:20:26,970 --> 00:20:30,960
does a good job of catching it too so
that's that's how they caught it caused

226
00:20:30,960 --> 00:20:41,650
a running on anarchic winston's and cook
who was did a better job in real time

227
00:20:41,650 --> 00:20:53,340
day so they have just a seven step into
it so yeah questions so I was told that

228
00:20:53,340 --> 00:21:01,620
I guess that's so if you have a chance
for business card in here know you are

229
00:21:01,620 --> 00:21:06,850
ok but we have a couple more minutes

230
00:21:06,850 --> 00:21:43,000
ok I gotta come running up and

231
00:21:43,000 --> 00:21:57,150
consumer you guys thank you

