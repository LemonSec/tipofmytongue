1
00:00:04,000 --> 00:00:05,120
brings me to

2
00:00:05,120 --> 00:00:08,320
uh blake here uh i i feel like we are

3
00:00:08,320 --> 00:00:12,799
uh kindred spirits uh uh blake

4
00:00:12,799 --> 00:00:15,440
reagan reagan i should have asked regan

5
00:00:15,440 --> 00:00:16,320
regan ah

6
00:00:16,320 --> 00:00:18,640
man yes pronunciation is hard uh works

7
00:00:18,640 --> 00:00:20,640
as a senior security engineer for westco

8
00:00:20,640 --> 00:00:21,439
international

9
00:00:21,439 --> 00:00:23,840
where he focuses on blue team improving

10
00:00:23,840 --> 00:00:25,119
enterprise security posture and

11
00:00:25,119 --> 00:00:26,800
automating active directive related

12
00:00:26,800 --> 00:00:28,640
business processes with powershell

13
00:00:28,640 --> 00:00:31,760
uh i this is what the moment in reading

14
00:00:31,760 --> 00:00:33,120
your bio that i felt the kindred

15
00:00:33,120 --> 00:00:34,000
spiritness

16
00:00:34,000 --> 00:00:36,800
i came from an admin world as well lots

17
00:00:36,800 --> 00:00:38,960
of active directory lots of powershell

18
00:00:38,960 --> 00:00:41,600
and excellent all right uh prior to

19
00:00:41,600 --> 00:00:43,200
westco blake worked at motorola

20
00:00:43,200 --> 00:00:44,960
solutions as an engineer securing

21
00:00:44,960 --> 00:00:46,640
government and public safety land mobile

22
00:00:46,640 --> 00:00:48,239
radio systems uh

23
00:00:48,239 --> 00:00:50,239
itt technical institute in oakbrook

24
00:00:50,239 --> 00:00:51,440
illinois where you graduate with

25
00:00:51,440 --> 00:00:54,000
bachelors in information system security

26
00:00:54,000 --> 00:00:56,079
you have a lot of letters after your

27
00:00:56,079 --> 00:00:57,600
name i heard this

28
00:00:57,600 --> 00:01:00,719
giac is this like it's

29
00:01:00,719 --> 00:01:03,680
from this yeah it's this

30
00:01:05,360 --> 00:01:07,680
hi everybody jeff mcjuggern uh sense

31
00:01:07,680 --> 00:01:09,840
instructor and author as well by the way

32
00:01:09,840 --> 00:01:12,720
so you hold the gcwn sand security 505

33
00:01:12,720 --> 00:01:13,920
securing windows

34
00:01:13,920 --> 00:01:17,119
gcih which is from sand security 504

35
00:01:17,119 --> 00:01:20,960
uh hackier hacker techniques

36
00:01:20,960 --> 00:01:22,960
ethical hacking security plus network

37
00:01:22,960 --> 00:01:24,400
plus and project plus

38
00:01:24,400 --> 00:01:26,240
priority starting in infosec 10 years

39
00:01:26,240 --> 00:01:27,840
ago blake worked in building

40
00:01:27,840 --> 00:01:29,520
trades and ran his own remodeling

41
00:01:29,520 --> 00:01:31,360
business he lives with a wife and

42
00:01:31,360 --> 00:01:32,960
daughter in illinois sorry

43
00:01:32,960 --> 00:01:34,720
his wife his one and only wife didn't

44
00:01:34,720 --> 00:01:37,759
mean to imply otherwise

45
00:01:39,200 --> 00:01:41,520
and blake's talk today is on limiting

46
00:01:41,520 --> 00:01:44,399
admin user risk in a windows environment

47
00:01:44,399 --> 00:01:46,799
and other tips to avoid making the news

48
00:01:46,799 --> 00:01:48,159
right to avoid appearing

49
00:01:48,159 --> 00:01:50,320
like hey we are breached and i know

50
00:01:50,320 --> 00:01:52,560
because i read uh krebs on security

51
00:01:52,560 --> 00:01:52,960
today

52
00:01:52,960 --> 00:01:55,439
right that's a bad way to wake up so

53
00:01:55,439 --> 00:01:56,799
this is a

54
00:01:56,799 --> 00:01:59,200
this ties in nicely to our last talk as

55
00:01:59,200 --> 00:02:00,159
well on

56
00:02:00,159 --> 00:02:02,560
turns out admin users are users as well

57
00:02:02,560 --> 00:02:05,520
it's right there in the name

58
00:02:05,520 --> 00:02:08,239
they just can result in a breach more

59
00:02:08,239 --> 00:02:10,399
quickly if they are compromised so

60
00:02:10,399 --> 00:02:13,520
uh blake any uh questions for us are you

61
00:02:13,520 --> 00:02:14,879
ready to

62
00:02:14,879 --> 00:02:17,040
uh have us drop off audio and video and

63
00:02:17,040 --> 00:02:18,319
take it away

64
00:02:18,319 --> 00:02:21,120
so thanks for the great intro that's a

65
00:02:21,120 --> 00:02:22,080
great um

66
00:02:22,080 --> 00:02:25,120
i you know feel overwhelmed there i do

67
00:02:25,120 --> 00:02:26,239
have a link for

68
00:02:26,239 --> 00:02:28,400
um the slides i'd like to share with

69
00:02:28,400 --> 00:02:29,440
folks so if you

70
00:02:29,440 --> 00:02:32,000
want me to share it now um yeah i'll

71
00:02:32,000 --> 00:02:37,680
click on any link you provide me

72
00:02:37,680 --> 00:02:41,760
i'll send it to you real quick um okay

73
00:02:41,760 --> 00:02:44,720
i will be your relay point as well thank

74
00:02:44,720 --> 00:02:45,599
you

75
00:02:45,599 --> 00:02:48,959
thank you oh my goodness posting your

76
00:02:48,959 --> 00:02:52,160
slides on github just before the talk

77
00:02:52,160 --> 00:02:55,760
i am swooning over here

78
00:02:57,040 --> 00:02:58,159
all right so yeah if you don't need

79
00:02:58,159 --> 00:03:00,640
anything else any other info

80
00:03:00,640 --> 00:03:03,680
i'm ready to get started excellent all

81
00:03:03,680 --> 00:03:04,239
right

82
00:03:04,239 --> 00:03:06,879
uh lee and i will sorry wesley and i

83
00:03:06,879 --> 00:03:07,840
will drop off

84
00:03:07,840 --> 00:03:09,920
and take it away blake thank you very

85
00:03:09,920 --> 00:03:11,519
much

86
00:03:11,519 --> 00:03:14,720
okay hi my name is blake regan and my

87
00:03:14,720 --> 00:03:15,519
talk is

88
00:03:15,519 --> 00:03:17,840
limiting admin user risk in a windows

89
00:03:17,840 --> 00:03:18,879
environment

90
00:03:18,879 --> 00:03:21,280
and other tips to avoid making the news

91
00:03:21,280 --> 00:03:23,200
thanks jeff for the great intro

92
00:03:23,200 --> 00:03:25,040
we can probably cut some time out of the

93
00:03:25,040 --> 00:03:27,680
presentation now

94
00:03:27,680 --> 00:03:28,879
two of the things that were covered in

95
00:03:28,879 --> 00:03:31,680
there automation enthusiast

96
00:03:31,680 --> 00:03:33,920
i love automating things with powershell

97
00:03:33,920 --> 00:03:34,959
um

98
00:03:34,959 --> 00:03:37,519
many years back a manager challenged me

99
00:03:37,519 --> 00:03:38,480
said hey

100
00:03:38,480 --> 00:03:39,680
you know i'd like you to get into

101
00:03:39,680 --> 00:03:41,680
automation so here's a project

102
00:03:41,680 --> 00:03:44,879
make an automated usb scanner out of a

103
00:03:44,879 --> 00:03:46,080
raspberry pi

104
00:03:46,080 --> 00:03:49,519
and so uh we got a raspberry pi i i did

105
00:03:49,519 --> 00:03:51,760
the work on it that is up on my github

106
00:03:51,760 --> 00:03:53,280
but that was a really fun experience

107
00:03:53,280 --> 00:03:54,799
that kind of really opened some doors

108
00:03:54,799 --> 00:03:55,760
for me

109
00:03:55,760 --> 00:03:58,560
new challenges so and also a serial

110
00:03:58,560 --> 00:03:59,120
learner

111
00:03:59,120 --> 00:04:01,040
right we all have to continue our

112
00:04:01,040 --> 00:04:04,159
education in this field

113
00:04:04,159 --> 00:04:06,319
threats are changing every day new

114
00:04:06,319 --> 00:04:07,760
technologies are coming out

115
00:04:07,760 --> 00:04:11,200
and in order to stay relevant

116
00:04:11,200 --> 00:04:13,599
i found it to be important to continue

117
00:04:13,599 --> 00:04:14,799
your education

118
00:04:14,799 --> 00:04:16,720
right and that comes into training i do

119
00:04:16,720 --> 00:04:18,720
have a couple certifications

120
00:04:18,720 --> 00:04:22,240
um i've got those through that that

121
00:04:22,240 --> 00:04:24,080
constant learning right so what are we

122
00:04:24,080 --> 00:04:25,919
going to talk about today

123
00:04:25,919 --> 00:04:27,440
we're going to talk about unauthorized

124
00:04:27,440 --> 00:04:29,440
local administrator privileges

125
00:04:29,440 --> 00:04:31,360
we're going to talk about managing local

126
00:04:31,360 --> 00:04:34,479
administrator credentials at scale

127
00:04:34,479 --> 00:04:35,600
we're also going to talk about

128
00:04:35,600 --> 00:04:37,919
protecting administrative account hashes

129
00:04:37,919 --> 00:04:39,919
and credentials as best we can

130
00:04:39,919 --> 00:04:41,600
right we're talking about limiting that

131
00:04:41,600 --> 00:04:44,000
risk we're also going to talk about weak

132
00:04:44,000 --> 00:04:45,040
password policies

133
00:04:45,040 --> 00:04:47,040
for administrative accounts and how to

134
00:04:47,040 --> 00:04:48,560
fix that and then

135
00:04:48,560 --> 00:04:49,919
we're also going to talk about how to

136
00:04:49,919 --> 00:04:53,840
limit your risk from efs ransomware

137
00:04:53,840 --> 00:04:56,560
so just a disclaimer here i am going to

138
00:04:56,560 --> 00:04:57,520
reference

139
00:04:57,520 --> 00:04:59,600
a couple scripts that i these were

140
00:04:59,600 --> 00:05:01,280
things that i came up with to solve a

141
00:05:01,280 --> 00:05:02,000
problem

142
00:05:02,000 --> 00:05:04,000
um in my day-to-day job and i thought

143
00:05:04,000 --> 00:05:05,520
that they'd be beneficial

144
00:05:05,520 --> 00:05:07,440
for others to at least start that idea

145
00:05:07,440 --> 00:05:10,080
of how to accomplish it right so

146
00:05:10,080 --> 00:05:12,000
please run these scripts in a test

147
00:05:12,000 --> 00:05:13,600
environment before running them in

148
00:05:13,600 --> 00:05:14,479
production

149
00:05:14,479 --> 00:05:16,479
there's no dangerous actions being taken

150
00:05:16,479 --> 00:05:18,240
by these but that's just best practice

151
00:05:18,240 --> 00:05:19,759
right there's a lot of information

152
00:05:19,759 --> 00:05:22,240
great information on github it's just

153
00:05:22,240 --> 00:05:24,160
always important to vet that information

154
00:05:24,160 --> 00:05:25,840
before putting it into your production

155
00:05:25,840 --> 00:05:28,000
environment

156
00:05:28,000 --> 00:05:30,880
so unauthorized local administrator

157
00:05:30,880 --> 00:05:31,759
privileges

158
00:05:31,759 --> 00:05:33,919
it's like breaking through a wall right

159
00:05:33,919 --> 00:05:36,080
it's unexpected you don't want it

160
00:05:36,080 --> 00:05:37,919
it can cause problems so let's talk

161
00:05:37,919 --> 00:05:40,880
about some of those problems

162
00:05:40,880 --> 00:05:42,479
so we have unapproved and dangerous

163
00:05:42,479 --> 00:05:44,160
software installation right

164
00:05:44,160 --> 00:05:47,360
a lot of software requires access to

165
00:05:47,360 --> 00:05:50,000
um areas of the windows operating system

166
00:05:50,000 --> 00:05:51,680
that only an administrator

167
00:05:51,680 --> 00:05:55,280
can can have right so that's one of the

168
00:05:55,280 --> 00:05:56,479
things that you want to limit

169
00:05:56,479 --> 00:06:00,479
in a production environment

170
00:06:00,479 --> 00:06:01,759
we're also going to talk about user

171
00:06:01,759 --> 00:06:03,919
compromise turns to instant privilege

172
00:06:03,919 --> 00:06:06,479
escalation if that user that is an

173
00:06:06,479 --> 00:06:08,160
administrator

174
00:06:08,160 --> 00:06:10,800
is compromised that eliminates one step

175
00:06:10,800 --> 00:06:11,680
from

176
00:06:11,680 --> 00:06:13,199
you know that kill chain that the

177
00:06:13,199 --> 00:06:15,039
attacker has to take

178
00:06:15,039 --> 00:06:16,800
in order to get to their objective right

179
00:06:16,800 --> 00:06:20,160
they got local admin right away

180
00:06:20,160 --> 00:06:21,680
so we're also going to talk about uh

181
00:06:21,680 --> 00:06:23,280
just this improve

182
00:06:23,280 --> 00:06:26,000
configuration changes um you know

183
00:06:26,000 --> 00:06:28,080
maintaining a baseline in an environment

184
00:06:28,080 --> 00:06:31,680
is very important and when

185
00:06:31,680 --> 00:06:34,240
an unauthorized user gets administrative

186
00:06:34,240 --> 00:06:35,840
privileges they can make changes that

187
00:06:35,840 --> 00:06:37,680
may deviate from your

188
00:06:37,680 --> 00:06:39,759
you know your your acceptable risk

189
00:06:39,759 --> 00:06:42,479
baseline or just cause production issues

190
00:06:42,479 --> 00:06:44,240
right and those are that's a bad day for

191
00:06:44,240 --> 00:06:46,560
everybody

192
00:06:46,560 --> 00:06:49,680
and then insider threat um unfortunately

193
00:06:49,680 --> 00:06:51,599
there are those situations where

194
00:06:51,599 --> 00:06:53,919
someone who is trusted has elevated

195
00:06:53,919 --> 00:06:55,280
access and

196
00:06:55,280 --> 00:06:57,680
does take advantage of that many

197
00:06:57,680 --> 00:06:58,560
instances

198
00:06:58,560 --> 00:07:00,720
in the past you could just check the

199
00:07:00,720 --> 00:07:02,080
news and there's many many

200
00:07:02,080 --> 00:07:04,319
more this isn't an all-encompassing list

201
00:07:04,319 --> 00:07:07,120
of of risks right

202
00:07:07,120 --> 00:07:08,720
so how do we detect this how do we

203
00:07:08,720 --> 00:07:10,160
detect this

204
00:07:10,160 --> 00:07:13,199
unauthorized local administrator access

205
00:07:13,199 --> 00:07:15,120
so one of the ways that we can do this

206
00:07:15,120 --> 00:07:18,400
is by keeping a

207
00:07:18,479 --> 00:07:20,880
a management system a records management

208
00:07:20,880 --> 00:07:22,160
you put in a request

209
00:07:22,160 --> 00:07:24,479
the request gets approved you either get

210
00:07:24,479 --> 00:07:25,440
the access

211
00:07:25,440 --> 00:07:28,000
for the consultant for the project for

212
00:07:28,000 --> 00:07:29,039
yourself

213
00:07:29,039 --> 00:07:31,440
or it gets denied right but the the idea

214
00:07:31,440 --> 00:07:32,800
behind that is it's all

215
00:07:32,800 --> 00:07:35,599
it's recorded and now there's a baseline

216
00:07:35,599 --> 00:07:36,560
that if there

217
00:07:36,560 --> 00:07:38,960
is an incident you can go back and check

218
00:07:38,960 --> 00:07:40,160
hey did we actually

219
00:07:40,160 --> 00:07:41,840
like what were we thinking when we said

220
00:07:41,840 --> 00:07:44,080
that this was okay or no we have no

221
00:07:44,080 --> 00:07:44,720
record

222
00:07:44,720 --> 00:07:46,319
right that can kind of help fill in some

223
00:07:46,319 --> 00:07:48,080
of those those blanks

224
00:07:48,080 --> 00:07:51,199
in the event of an incident and it's

225
00:07:51,199 --> 00:07:53,360
important to have that information at

226
00:07:53,360 --> 00:07:54,240
the very start

227
00:07:54,240 --> 00:07:55,680
right kind of track down how did

228
00:07:55,680 --> 00:07:58,160
something happen we can also use our

229
00:07:58,160 --> 00:08:00,479
our sign our security information event

230
00:08:00,479 --> 00:08:02,080
manager

231
00:08:02,080 --> 00:08:06,080
by creating an alert for event 4732

232
00:08:06,080 --> 00:08:07,759
windows event id

233
00:08:07,759 --> 00:08:09,919
that's a member was added to a security

234
00:08:09,919 --> 00:08:11,199
enabled group

235
00:08:11,199 --> 00:08:13,440
so now across if you have a domain

236
00:08:13,440 --> 00:08:14,800
wherever you have

237
00:08:14,800 --> 00:08:19,360
50 servers or you have 50 000 servers

238
00:08:19,360 --> 00:08:21,280
now you're letting that that sign do

239
00:08:21,280 --> 00:08:22,960
that work for you instead of checking

240
00:08:22,960 --> 00:08:24,240
each server every day

241
00:08:24,240 --> 00:08:26,560
that's not a task anybody wants to do

242
00:08:26,560 --> 00:08:28,000
now you can get alerted when that

243
00:08:28,000 --> 00:08:30,560
that privilege escalation happens you

244
00:08:30,560 --> 00:08:32,159
can get tipped off and you can either go

245
00:08:32,159 --> 00:08:34,000
check your record system

246
00:08:34,000 --> 00:08:36,080
and say do i have a record for this and

247
00:08:36,080 --> 00:08:37,440
i just didn't know about it

248
00:08:37,440 --> 00:08:39,519
or is this something that is not

249
00:08:39,519 --> 00:08:40,479
expected

250
00:08:40,479 --> 00:08:43,440
right a lot of environments do not have

251
00:08:43,440 --> 00:08:44,080
a sign

252
00:08:44,080 --> 00:08:46,000
and that's okay there's powershell to

253
00:08:46,000 --> 00:08:48,320
the rescue um i created a script that

254
00:08:48,320 --> 00:08:49,600
can go out and query

255
00:08:49,600 --> 00:08:53,279
members of a domain servers workstations

256
00:08:53,279 --> 00:08:56,640
and using wmi

257
00:08:56,640 --> 00:08:58,399
that accounts for older powershell

258
00:08:58,399 --> 00:09:00,720
versions or older operating systems

259
00:09:00,720 --> 00:09:02,959
to query the members of the groups that

260
00:09:02,959 --> 00:09:04,720
you specify

261
00:09:04,720 --> 00:09:07,440
right so now we can have this baseline

262
00:09:07,440 --> 00:09:08,399
we can identify

263
00:09:08,399 --> 00:09:11,760
what's going on in our environment and

264
00:09:11,760 --> 00:09:13,200
the other step that comes with this is

265
00:09:13,200 --> 00:09:15,440
holding people accountable right in

266
00:09:15,440 --> 00:09:17,279
in your whether you're an enterprise

267
00:09:17,279 --> 00:09:20,160
environment or a standalone environment

268
00:09:20,160 --> 00:09:21,519
trying to understand what was the

269
00:09:21,519 --> 00:09:24,480
reasoning why an account or a user was

270
00:09:24,480 --> 00:09:26,480
granted administrative access

271
00:09:26,480 --> 00:09:28,320
if it's just so that someone can log on

272
00:09:28,320 --> 00:09:30,880
to a server and giving them admin access

273
00:09:30,880 --> 00:09:32,959
that's not the best way to do it right

274
00:09:32,959 --> 00:09:34,160
um so it's just

275
00:09:34,160 --> 00:09:35,360
it's creating that culture of

276
00:09:35,360 --> 00:09:38,000
accountability and security

277
00:09:38,000 --> 00:09:40,000
um you know from the sysadmin from the

278
00:09:40,000 --> 00:09:42,320
administrator level domain admin

279
00:09:42,320 --> 00:09:43,440
and then all the way up through

280
00:09:43,440 --> 00:09:45,279
leadership right and that that'll create

281
00:09:45,279 --> 00:09:46,399
that bond

282
00:09:46,399 --> 00:09:49,440
that's very important um you know when

283
00:09:49,440 --> 00:09:53,760
maintaining defenses for an environment

284
00:09:53,760 --> 00:09:57,680
so um you will find that if you start

285
00:09:57,680 --> 00:10:00,720
generating events on an

286
00:10:00,720 --> 00:10:02,640
account was added to a security-enabled

287
00:10:02,640 --> 00:10:04,000
group and you start

288
00:10:04,000 --> 00:10:06,240
asking people why this is happening you

289
00:10:06,240 --> 00:10:07,920
may get some pushback

290
00:10:07,920 --> 00:10:09,680
right but that's part of building that

291
00:10:09,680 --> 00:10:11,440
culture of accountability and

292
00:10:11,440 --> 00:10:12,240
understanding

293
00:10:12,240 --> 00:10:16,240
the risk that that comes from it right

294
00:10:16,240 --> 00:10:18,160
so let's use a little scenario here um

295
00:10:18,160 --> 00:10:19,440
this is referencing my

296
00:10:19,440 --> 00:10:22,640
uh get local membership domain script

297
00:10:22,640 --> 00:10:24,720
so we see that when we run this this is

298
00:10:24,720 --> 00:10:26,560
just a test environment so we have

299
00:10:26,560 --> 00:10:29,279
two servers here but we can see we have

300
00:10:29,279 --> 00:10:30,160
a whole bunch of

301
00:10:30,160 --> 00:10:32,560
accounts that are local administrators

302
00:10:32,560 --> 00:10:33,839
um

303
00:10:33,839 --> 00:10:35,839
some of these may be known we even have

304
00:10:35,839 --> 00:10:37,120
the domain controller

305
00:10:37,120 --> 00:10:40,320
as a local admin on the server that's

306
00:10:40,320 --> 00:10:42,399
not a good thing but this helps us get

307
00:10:42,399 --> 00:10:43,440
that baseline

308
00:10:43,440 --> 00:10:45,680
right you can't protect what you don't

309
00:10:45,680 --> 00:10:48,160
know so

310
00:10:48,160 --> 00:10:50,000
using this baseline you now have a

311
00:10:50,000 --> 00:10:52,240
foundation to do cleanup

312
00:10:52,240 --> 00:10:54,640
to use for incident response and then

313
00:10:54,640 --> 00:10:55,839
also for audits

314
00:10:55,839 --> 00:10:59,040
right a lot of times if if your

315
00:10:59,040 --> 00:11:02,160
organization is subject to audits you

316
00:11:02,160 --> 00:11:04,240
may need to prove

317
00:11:04,240 --> 00:11:06,480
um principle of least privilege right

318
00:11:06,480 --> 00:11:09,200
using this baseline can help with that

319
00:11:09,200 --> 00:11:11,360
so let's look at example scenario now

320
00:11:11,360 --> 00:11:12,399
this

321
00:11:12,399 --> 00:11:14,399
i believe is a bug in the windows

322
00:11:14,399 --> 00:11:15,519
operating system

323
00:11:15,519 --> 00:11:18,480
right where if a user is named dollar

324
00:11:18,480 --> 00:11:19,440
sign

325
00:11:19,440 --> 00:11:21,680
you know if you see here we we said show

326
00:11:21,680 --> 00:11:23,200
me the net users

327
00:11:23,200 --> 00:11:25,200
right and you can see that dollar sign

328
00:11:25,200 --> 00:11:26,399
does not appear

329
00:11:26,399 --> 00:11:29,519
on this list and so that's right here

330
00:11:29,519 --> 00:11:31,279
sorry

331
00:11:31,279 --> 00:11:33,360
so that may be something that would get

332
00:11:33,360 --> 00:11:35,519
missed a lot of times administrators do

333
00:11:35,519 --> 00:11:37,200
things via command line because it's

334
00:11:37,200 --> 00:11:40,640
it's faster it's easier but as we can

335
00:11:40,640 --> 00:11:42,399
see here that if we view

336
00:11:42,399 --> 00:11:45,200
local users and groups via the gui we

337
00:11:45,200 --> 00:11:45,600
can

338
00:11:45,600 --> 00:11:47,920
see that dollar sign account right and

339
00:11:47,920 --> 00:11:48,640
if we check

340
00:11:48,640 --> 00:11:50,399
the local administrators group on that

341
00:11:50,399 --> 00:11:52,480
host we see that dollar sign

342
00:11:52,480 --> 00:11:56,160
is a local admin on this host along with

343
00:11:56,160 --> 00:11:59,120
other accounts here

344
00:11:59,440 --> 00:12:01,839
and so

345
00:12:04,160 --> 00:12:06,639
and so now when we run this script again

346
00:12:06,639 --> 00:12:08,320
and we compare against our baseline we

347
00:12:08,320 --> 00:12:10,079
see that we have a deviation

348
00:12:10,079 --> 00:12:12,399
right so we need to look into this and

349
00:12:12,399 --> 00:12:14,000
that's where coming back to our

350
00:12:14,000 --> 00:12:17,279
our crm or our security request form

351
00:12:17,279 --> 00:12:18,240
management

352
00:12:18,240 --> 00:12:20,399
can say hey do we have a record for this

353
00:12:20,399 --> 00:12:22,399
no we don't okay

354
00:12:22,399 --> 00:12:24,480
did you add this do we have a sime alert

355
00:12:24,480 --> 00:12:25,680
for this well

356
00:12:25,680 --> 00:12:28,720
luckily if we set up the sim alert we

357
00:12:28,720 --> 00:12:29,680
will have one

358
00:12:29,680 --> 00:12:31,680
and we can see the actual time we can

359
00:12:31,680 --> 00:12:32,800
start to get some of that

360
00:12:32,800 --> 00:12:36,079
that telemetry data right the time the

361
00:12:36,079 --> 00:12:39,120
the account that was used to add that

362
00:12:39,120 --> 00:12:40,560
dollar signed account

363
00:12:40,560 --> 00:12:43,760
to local administrators and other

364
00:12:43,760 --> 00:12:45,680
information right but now we have that

365
00:12:45,680 --> 00:12:48,399
that chronicled over time where even if

366
00:12:48,399 --> 00:12:49,120
this wasn't

367
00:12:49,120 --> 00:12:52,160
uh a malicious incident

368
00:12:52,160 --> 00:12:53,680
we now have this pattern that we can

369
00:12:53,680 --> 00:12:55,279
establish right instead of

370
00:12:55,279 --> 00:12:57,680
trying to remember oh i think i saw this

371
00:12:57,680 --> 00:12:59,040
account here but i don't remember if

372
00:12:59,040 --> 00:13:01,600
it's supposed to be there

373
00:13:01,600 --> 00:13:05,040
um so

374
00:13:05,040 --> 00:13:06,480
one of the ways that we can remediate

375
00:13:06,480 --> 00:13:08,639
this is to use

376
00:13:08,639 --> 00:13:11,120
restricted groups in a domain

377
00:13:11,120 --> 00:13:11,760
environment

378
00:13:11,760 --> 00:13:15,200
now this is a good solution to

379
00:13:15,200 --> 00:13:18,399
maintain a baseline of approved

380
00:13:18,399 --> 00:13:21,040
accounts that are supposed to be um

381
00:13:21,040 --> 00:13:21,680
enabled

382
00:13:21,680 --> 00:13:24,800
on a particular set of servers um or

383
00:13:24,800 --> 00:13:27,279
organizational unit or even workstations

384
00:13:27,279 --> 00:13:29,040
and every policy enforcement what

385
00:13:29,040 --> 00:13:29,680
happens is

386
00:13:29,680 --> 00:13:32,800
this restricted group will refresh

387
00:13:32,800 --> 00:13:34,880
the list of members that are supposed to

388
00:13:34,880 --> 00:13:36,639
be there so if we go back to our

389
00:13:36,639 --> 00:13:38,160
incident where we had

390
00:13:38,160 --> 00:13:41,440
um get added that wasn't supposed to be

391
00:13:41,440 --> 00:13:43,680
that isn't a member restricted groups

392
00:13:43,680 --> 00:13:44,800
policy

393
00:13:44,800 --> 00:13:46,839
that'll get cleaned up at policy

394
00:13:46,839 --> 00:13:48,560
enforcement okay

395
00:13:48,560 --> 00:13:54,000
and mouse died here so we're gonna

396
00:13:54,320 --> 00:13:58,160
we're gonna offer out a bit

397
00:13:58,160 --> 00:14:00,480
so how do we remediate this we talked

398
00:14:00,480 --> 00:14:02,320
about our policy so in the last slide we

399
00:14:02,320 --> 00:14:03,120
created our

400
00:14:03,120 --> 00:14:05,120
our restricted group policy and you can

401
00:14:05,120 --> 00:14:07,519
see that before we apply the policy

402
00:14:07,519 --> 00:14:10,160
we still have dollar sign we have um

403
00:14:10,160 --> 00:14:11,680
some other accounts we have bob

404
00:14:11,680 --> 00:14:15,199
tech9 controllers with the domain

405
00:14:15,199 --> 00:14:16,079
controller

406
00:14:16,079 --> 00:14:18,240
when we run that policy enforcement now

407
00:14:18,240 --> 00:14:19,519
we're cleaning up that list

408
00:14:19,519 --> 00:14:21,040
now we're only having the local

409
00:14:21,040 --> 00:14:23,519
administrator that will always be there

410
00:14:23,519 --> 00:14:25,279
and then we will have domain

411
00:14:25,279 --> 00:14:27,040
administrators which

412
00:14:27,040 --> 00:14:28,959
um there's different theories on that

413
00:14:28,959 --> 00:14:30,639
being in local admin but

414
00:14:30,639 --> 00:14:32,240
now you can see we've we've cleaned up

415
00:14:32,240 --> 00:14:35,040
our baseline right

416
00:14:39,279 --> 00:14:41,600
so uh just going back over remediation

417
00:14:41,600 --> 00:14:43,519
you can also do this for remote desktop

418
00:14:43,519 --> 00:14:44,079
users

419
00:14:44,079 --> 00:14:48,480
very often a user gets added to local

420
00:14:48,480 --> 00:14:49,600
administrators

421
00:14:49,600 --> 00:14:50,959
just so that they can log on to the

422
00:14:50,959 --> 00:14:53,519
machine or check some things out

423
00:14:53,519 --> 00:14:56,000
that's dangerous right you can add those

424
00:14:56,000 --> 00:14:56,800
people to

425
00:14:56,800 --> 00:14:59,360
those accounts to remote desktop users

426
00:14:59,360 --> 00:14:59,920
using

427
00:14:59,920 --> 00:15:02,720
the restricted group policy again and

428
00:15:02,720 --> 00:15:04,000
that allows you that if you have to

429
00:15:04,000 --> 00:15:05,680
remove that access

430
00:15:05,680 --> 00:15:08,800
whether we have 50 or 50 000 servers

431
00:15:08,800 --> 00:15:10,240
that if we're doing it through group

432
00:15:10,240 --> 00:15:12,399
policy we now don't have to touch

433
00:15:12,399 --> 00:15:14,399
every single server to do that we can do

434
00:15:14,399 --> 00:15:16,000
this at scale

435
00:15:16,000 --> 00:15:19,360
using our policies here and so we can

436
00:15:19,360 --> 00:15:20,720
see here that

437
00:15:20,720 --> 00:15:24,880
remote desktop users has no members

438
00:15:25,199 --> 00:15:26,639
before we apply our policy and then

439
00:15:26,639 --> 00:15:28,720
afterwards we now have our limited

440
00:15:28,720 --> 00:15:30,959
access group

441
00:15:30,959 --> 00:15:32,720
uh and then to remove it like i

442
00:15:32,720 --> 00:15:35,279
mentioned you remove it from the policy

443
00:15:35,279 --> 00:15:38,480
policy updates no more access on the

444
00:15:38,480 --> 00:15:38,959
server

445
00:15:38,959 --> 00:15:43,040
right so and this is just coming back to

446
00:15:43,040 --> 00:15:44,399
our

447
00:15:44,399 --> 00:15:46,959
our get local membership domain i

448
00:15:46,959 --> 00:15:48,480
configured it to look for local

449
00:15:48,480 --> 00:15:49,440
administrators

450
00:15:49,440 --> 00:15:52,880
and local remote desktop user

451
00:15:52,880 --> 00:15:54,560
rights so that's just showing here the

452
00:15:54,560 --> 00:15:56,000
remote desktop

453
00:15:56,000 --> 00:15:57,920
if you like this idea you can go modify

454
00:15:57,920 --> 00:16:00,800
this look for any group that you want to

455
00:16:00,800 --> 00:16:04,320
the script also does have powershell

456
00:16:04,320 --> 00:16:07,199
commandlets to look for users but a lot

457
00:16:07,199 --> 00:16:09,360
of times in environments

458
00:16:09,360 --> 00:16:11,199
the powershell versions may not be up to

459
00:16:11,199 --> 00:16:13,920
date so wmi may be

460
00:16:13,920 --> 00:16:17,120
a better way to do that so

461
00:16:17,120 --> 00:16:20,240
um so let's say you like this idea of

462
00:16:20,240 --> 00:16:22,000
restricted groups

463
00:16:22,000 --> 00:16:24,399
there are some no no's for restricted

464
00:16:24,399 --> 00:16:25,040
groups

465
00:16:25,040 --> 00:16:28,480
do not apply restricted group

466
00:16:28,480 --> 00:16:31,360
administrators to domain controllers and

467
00:16:31,360 --> 00:16:33,040
the reason for this is

468
00:16:33,040 --> 00:16:35,120
the administrator on a domain controller

469
00:16:35,120 --> 00:16:36,560
the built-in administrator

470
00:16:36,560 --> 00:16:40,160
is de facto uh domain

471
00:16:40,160 --> 00:16:42,639
administrator it also runs a system when

472
00:16:42,639 --> 00:16:44,399
you connect to other hosts

473
00:16:44,399 --> 00:16:47,519
so it makes it very hard to detect what

474
00:16:47,519 --> 00:16:49,040
actions were taken by

475
00:16:49,040 --> 00:16:51,839
a user

476
00:16:52,079 --> 00:16:54,399
running that way and so just showing

477
00:16:54,399 --> 00:16:56,240
here this instant privilege escalation

478
00:16:56,240 --> 00:16:58,000
so just be careful with this and do this

479
00:16:58,000 --> 00:16:59,279
in a test environment

480
00:16:59,279 --> 00:17:01,040
if this is something that looks that

481
00:17:01,040 --> 00:17:02,800
could be very helpful to you

482
00:17:02,800 --> 00:17:06,079
test it out in your test environment

483
00:17:06,079 --> 00:17:08,240
the other thing to think about is that

484
00:17:08,240 --> 00:17:09,439
if you

485
00:17:09,439 --> 00:17:12,480
if you modify here you can add users in

486
00:17:12,480 --> 00:17:13,679
this section here

487
00:17:13,679 --> 00:17:16,839
and it will not overwrite the currently

488
00:17:16,839 --> 00:17:19,919
enabled users in that group

489
00:17:19,919 --> 00:17:23,199
if you use this option up here

490
00:17:23,199 --> 00:17:25,599
this will wipe out everything that is in

491
00:17:25,599 --> 00:17:26,480
that group

492
00:17:26,480 --> 00:17:29,200
and apply what's in here so again be

493
00:17:29,200 --> 00:17:30,640
careful with it

494
00:17:30,640 --> 00:17:35,360
it's a great way to limit that risk

495
00:17:35,360 --> 00:17:36,559
but you need to check it out in your

496
00:17:36,559 --> 00:17:39,280
test environment first

497
00:17:39,280 --> 00:17:40,240
so now we're going to talk about

498
00:17:40,240 --> 00:17:42,559
managing local administrator

499
00:17:42,559 --> 00:17:45,280
account credentials at scale also known

500
00:17:45,280 --> 00:17:46,320
as lap

501
00:17:46,320 --> 00:17:49,760
now lapse does have its shortcomings but

502
00:17:49,760 --> 00:17:51,919
it is better than having the same

503
00:17:51,919 --> 00:17:54,480
account password on every single host as

504
00:17:54,480 --> 00:17:55,360
administrator

505
00:17:55,360 --> 00:17:58,720
in your environment there's also another

506
00:17:58,720 --> 00:17:59,520
way to do this

507
00:17:59,520 --> 00:18:03,039
jason fawson um has documented

508
00:18:03,039 --> 00:18:05,600
a way to do this with powershell protect

509
00:18:05,600 --> 00:18:06,880
cms message

510
00:18:06,880 --> 00:18:09,039
and the benefit of this method is that

511
00:18:09,039 --> 00:18:10,080
it can be used

512
00:18:10,080 --> 00:18:12,640
in a non-domain environment so that's

513
00:18:12,640 --> 00:18:14,720
one of the caveats of lapse

514
00:18:14,720 --> 00:18:17,039
is that it requires a domain and so that

515
00:18:17,039 --> 00:18:18,080
kind of leaves

516
00:18:18,080 --> 00:18:21,200
um that leaves out a large scope of

517
00:18:21,200 --> 00:18:22,080
systems

518
00:18:22,080 --> 00:18:24,559
you know that that can have this feature

519
00:18:24,559 --> 00:18:26,960
applied to it so

520
00:18:26,960 --> 00:18:31,039
um some of the risks of having the same

521
00:18:31,039 --> 00:18:33,760
credential on all the hosts in your

522
00:18:33,760 --> 00:18:35,679
environment for local administrator are

523
00:18:35,679 --> 00:18:38,400
if that hash is compromised um popular

524
00:18:38,400 --> 00:18:40,640
tools like responder

525
00:18:40,640 --> 00:18:43,760
using llmr or netbios relay

526
00:18:43,760 --> 00:18:46,080
um can get that hash can actually get

527
00:18:46,080 --> 00:18:48,160
authentication to happen and send to the

528
00:18:48,160 --> 00:18:49,039
attacker

529
00:18:49,039 --> 00:18:52,400
and get that hash okay and now

530
00:18:52,400 --> 00:18:54,880
that we have that hash we can either

531
00:18:54,880 --> 00:18:56,559
pass that hash

532
00:18:56,559 --> 00:19:00,320
or we can crack the hash a great tool

533
00:19:00,320 --> 00:19:04,640
um by marcelo salvati is crack map exec

534
00:19:04,640 --> 00:19:07,120
it's very common way to pass the hash

535
00:19:07,120 --> 00:19:08,799
there's also some powershell versions

536
00:19:08,799 --> 00:19:11,120
out there invoke the hash

537
00:19:11,120 --> 00:19:12,880
but again that's that danger right and

538
00:19:12,880 --> 00:19:15,360
we want to we want to eliminate that so

539
00:19:15,360 --> 00:19:18,960
and what does lapse do um lapse differs

540
00:19:18,960 --> 00:19:20,799
that credential on all of the hosts and

541
00:19:20,799 --> 00:19:22,400
the environment that it's applied to so

542
00:19:22,400 --> 00:19:26,000
there's a unique password for every host

543
00:19:26,000 --> 00:19:30,000
because windows does not salt the hashes

544
00:19:30,000 --> 00:19:33,039
for passwords if i have the same

545
00:19:33,039 --> 00:19:35,200
password that you have our hashes are

546
00:19:35,200 --> 00:19:37,520
identical but if it's in a linux

547
00:19:37,520 --> 00:19:38,640
operating system

548
00:19:38,640 --> 00:19:41,280
they have a assault and that makes the

549
00:19:41,280 --> 00:19:43,039
same password hash different

550
00:19:43,039 --> 00:19:44,720
for as long as you don't get a hold of

551
00:19:44,720 --> 00:19:48,480
the salt for different users so

552
00:19:49,200 --> 00:19:52,480
um a couple things that you can do here

553
00:19:52,480 --> 00:19:53,679
right is deploying the laps in the

554
00:19:53,679 --> 00:19:55,280
domain environment that's going to help

555
00:19:55,280 --> 00:19:56,960
to solve that issue

556
00:19:56,960 --> 00:19:58,960
uh lapse has some built-in functions

557
00:19:58,960 --> 00:20:00,480
that can help you for delegating

558
00:20:00,480 --> 00:20:02,480
permissions or building that into your

559
00:20:02,480 --> 00:20:03,200
role-based

560
00:20:03,200 --> 00:20:06,880
access controls right so different

561
00:20:06,880 --> 00:20:10,159
different levels of access need

562
00:20:10,159 --> 00:20:13,280
can be applied to different to different

563
00:20:13,280 --> 00:20:15,678
um

564
00:20:15,760 --> 00:20:18,320
organizational units of servers based on

565
00:20:18,320 --> 00:20:19,440
sensitivity level

566
00:20:19,440 --> 00:20:21,200
so i know that sounded like a bunch of

567
00:20:21,200 --> 00:20:22,880
complex words but really

568
00:20:22,880 --> 00:20:25,360
you can grant access to the people that

569
00:20:25,360 --> 00:20:27,600
need access to those credentials

570
00:20:27,600 --> 00:20:31,200
and then denying access to the

571
00:20:31,200 --> 00:20:35,440
to those individuals who do not right

572
00:20:35,440 --> 00:20:37,760
um

573
00:20:39,280 --> 00:20:42,480
so tips and tricks for laps

574
00:20:42,480 --> 00:20:45,520
um i struggled with this last year

575
00:20:45,520 --> 00:20:47,440
and a couple of things that i came up

576
00:20:47,440 --> 00:20:48,640
with and

577
00:20:48,640 --> 00:20:51,600
successfully um completing that struggle

578
00:20:51,600 --> 00:20:52,000
were

579
00:20:52,000 --> 00:20:53,679
to rename the local administrator

580
00:20:53,679 --> 00:20:55,120
account via group policy

581
00:20:55,120 --> 00:20:57,679
that that lapse is going to manage now

582
00:20:57,679 --> 00:20:58,640
that doesn't

583
00:20:58,640 --> 00:21:00,320
it just makes things more difficult for

584
00:21:00,320 --> 00:21:02,080
an attacker to enumerate

585
00:21:02,080 --> 00:21:04,960
right the the rid will stay the same but

586
00:21:04,960 --> 00:21:05,520
the

587
00:21:05,520 --> 00:21:08,480
the name will be different right and so

588
00:21:08,480 --> 00:21:09,600
then we're looking about

589
00:21:09,600 --> 00:21:11,600
uh to assign laps to manage that new

590
00:21:11,600 --> 00:21:13,280
account name that's what we're talking

591
00:21:13,280 --> 00:21:14,480
about there

592
00:21:14,480 --> 00:21:16,480
renaming the local guest account via

593
00:21:16,480 --> 00:21:17,840
group policy if you're going to

594
00:21:17,840 --> 00:21:20,400
take the time and invest in deploying

595
00:21:20,400 --> 00:21:21,679
laps to your environment

596
00:21:21,679 --> 00:21:24,159
also take the time to make sure that the

597
00:21:24,159 --> 00:21:26,400
guest account is renamed and then also

598
00:21:26,400 --> 00:21:28,960
disable that account if it's not already

599
00:21:28,960 --> 00:21:32,480
disabled via group policy right

600
00:21:32,480 --> 00:21:33,600
this was something that was a little

601
00:21:33,600 --> 00:21:36,320
puzzling to me

602
00:21:36,320 --> 00:21:39,200
so deployed laps in the environment all

603
00:21:39,200 --> 00:21:42,240
of the servers were reporting values

604
00:21:42,240 --> 00:21:43,679
but when you went to go use that

605
00:21:43,679 --> 00:21:45,600
password it wouldn't authenticate

606
00:21:45,600 --> 00:21:48,559
and so going back checking over all the

607
00:21:48,559 --> 00:21:49,440
settings

608
00:21:49,440 --> 00:21:52,880
everything was good i found a post um

609
00:21:52,880 --> 00:21:57,039
i believe it was on stack overflow

610
00:21:57,039 --> 00:21:59,200
where someone said when they force reset

611
00:21:59,200 --> 00:22:01,280
the password for the lapse

612
00:22:01,280 --> 00:22:04,080
client that the password synced and then

613
00:22:04,080 --> 00:22:06,240
the password was able to authenticate

614
00:22:06,240 --> 00:22:09,120
and so that ended up being the case and

615
00:22:09,120 --> 00:22:10,320
if you see here on this

616
00:22:10,320 --> 00:22:12,960
this screenshot here if you deploy laps

617
00:22:12,960 --> 00:22:14,400
or you have in the past and it didn't

618
00:22:14,400 --> 00:22:15,440
work for you

619
00:22:15,440 --> 00:22:18,640
you saw this timestamp here this means

620
00:22:18,640 --> 00:22:19,039
that

621
00:22:19,039 --> 00:22:23,120
there's no password expiration set

622
00:22:23,120 --> 00:22:24,720
because those values haven't synced up

623
00:22:24,720 --> 00:22:27,520
on the host yet and

624
00:22:27,520 --> 00:22:30,559
authentication will not be possible so

625
00:22:30,559 --> 00:22:33,600
to fix that for

626
00:22:33,600 --> 00:22:36,799
at scale right i came up with a simple

627
00:22:36,799 --> 00:22:37,919
script to

628
00:22:37,919 --> 00:22:40,000
you know target the organizational unit

629
00:22:40,000 --> 00:22:41,919
where my servers existed

630
00:22:41,919 --> 00:22:44,799
and then using the command to um with

631
00:22:44,799 --> 00:22:46,320
the appropriate permissions

632
00:22:46,320 --> 00:22:49,360
to force reset the password i was able

633
00:22:49,360 --> 00:22:51,200
to force reset the password on

634
00:22:51,200 --> 00:22:53,520
all of the host and then all the

635
00:22:53,520 --> 00:22:54,240
credentials

636
00:22:54,240 --> 00:22:56,320
synced and started working again this

637
00:22:56,320 --> 00:22:57,600
was a huge relief

638
00:22:57,600 --> 00:22:59,760
we had a red time red team exercise

639
00:22:59,760 --> 00:23:01,919
coming up laughs wasn't working

640
00:23:01,919 --> 00:23:04,960
um but by persevering and

641
00:23:04,960 --> 00:23:06,480
reaching out into the community and

642
00:23:06,480 --> 00:23:08,159
looking for information

643
00:23:08,159 --> 00:23:09,840
it was very hard to find this i don't

644
00:23:09,840 --> 00:23:11,200
think it was because people weren't

645
00:23:11,200 --> 00:23:12,000
sharing it

646
00:23:12,000 --> 00:23:14,640
it's just very obscure and you know

647
00:23:14,640 --> 00:23:15,679
surprise surprise

648
00:23:15,679 --> 00:23:17,840
is not documented in any microsoft

649
00:23:17,840 --> 00:23:19,120
documentation

650
00:23:19,120 --> 00:23:22,880
but i digress and so

651
00:23:22,880 --> 00:23:25,520
are there some downfalls to lapse uh it

652
00:23:25,520 --> 00:23:26,559
can be viewed that way

653
00:23:26,559 --> 00:23:29,600
all right the lapse values are encrypted

654
00:23:29,600 --> 00:23:31,760
in transit but not at rest

655
00:23:31,760 --> 00:23:35,120
so when the admin password dll

656
00:23:35,120 --> 00:23:37,120
is communicating between the domain

657
00:23:37,120 --> 00:23:39,200
controller and the host

658
00:23:39,200 --> 00:23:42,240
that communication is encrypted

659
00:23:42,240 --> 00:23:45,039
but at rest those values are in clear

660
00:23:45,039 --> 00:23:46,480
text

661
00:23:46,480 --> 00:23:49,520
with the caveat that the account has the

662
00:23:49,520 --> 00:23:51,600
been delegated the privileges to view

663
00:23:51,600 --> 00:23:52,559
those values

664
00:23:52,559 --> 00:23:56,480
okay so there are some controls in there

665
00:23:56,480 --> 00:23:58,000
there's some active directory magic

666
00:23:58,000 --> 00:23:59,679
that's going on to

667
00:23:59,679 --> 00:24:02,799
to manage those extended rights um

668
00:24:02,799 --> 00:24:05,039
but if you're viewing information

669
00:24:05,039 --> 00:24:08,400
through a third-party ldap viewer tool

670
00:24:08,400 --> 00:24:10,000
that attribute will be shown in clear

671
00:24:10,000 --> 00:24:12,720
text because it's not being encrypted in

672
00:24:12,720 --> 00:24:14,159
transit between

673
00:24:14,159 --> 00:24:16,720
communication between the dll so that

674
00:24:16,720 --> 00:24:17,600
could be

675
00:24:17,600 --> 00:24:20,000
inadvertent information disclosure so

676
00:24:20,000 --> 00:24:21,440
how can we solve that

677
00:24:21,440 --> 00:24:24,000
well we can use packet encryption in in

678
00:24:24,000 --> 00:24:24,799
windows

679
00:24:24,799 --> 00:24:27,679
domain environment we can use ipsec with

680
00:24:27,679 --> 00:24:28,960
no encapsulation

681
00:24:28,960 --> 00:24:31,520
which i know that sounds complicated but

682
00:24:31,520 --> 00:24:32,480
basically

683
00:24:32,480 --> 00:24:36,000
it's just using kerberos and ipsec

684
00:24:36,000 --> 00:24:40,080
to generate a secure um

685
00:24:40,080 --> 00:24:43,120
connection between the client

686
00:24:43,120 --> 00:24:46,480
and the the target right

687
00:24:46,480 --> 00:24:49,679
and so um is there a better way to do

688
00:24:49,679 --> 00:24:50,480
this

689
00:24:50,480 --> 00:24:52,880
possibly definitely for environments

690
00:24:52,880 --> 00:24:53,919
that are not

691
00:24:53,919 --> 00:24:56,720
on a domain

692
00:24:57,840 --> 00:25:00,799
jason fawson uh documented this so the

693
00:25:00,799 --> 00:25:02,080
credentials are stored

694
00:25:02,080 --> 00:25:05,279
um in a certificate encrypted file on

695
00:25:05,279 --> 00:25:06,159
the host

696
00:25:06,159 --> 00:25:09,600
and that certificate can come from a ca

697
00:25:09,600 --> 00:25:12,719
or a self-signed cert

698
00:25:12,799 --> 00:25:14,880
the password gets encrypted with a

699
00:25:14,880 --> 00:25:16,400
public key on the host

700
00:25:16,400 --> 00:25:18,880
or network share so the attacker gets

701
00:25:18,880 --> 00:25:20,480
that public key that's not the end of

702
00:25:20,480 --> 00:25:22,080
the world because it's the private key

703
00:25:22,080 --> 00:25:23,440
that matters

704
00:25:23,440 --> 00:25:27,200
um and then those passwords get

705
00:25:27,200 --> 00:25:29,039
decrypted with a private key that can be

706
00:25:29,039 --> 00:25:30,720
stored on a smart card

707
00:25:30,720 --> 00:25:33,840
you and then you use a scheduled task

708
00:25:33,840 --> 00:25:36,159
that handles the cadence of the password

709
00:25:36,159 --> 00:25:36,960
update

710
00:25:36,960 --> 00:25:40,000
um running the script to do this and

711
00:25:40,000 --> 00:25:42,159
then archiving it on a network share

712
00:25:42,159 --> 00:25:43,760
i realize i'm running a little behind on

713
00:25:43,760 --> 00:25:46,000
time so i'm gonna

714
00:25:46,000 --> 00:25:47,600
and the best part is it does not require

715
00:25:47,600 --> 00:25:49,120
a domain to use so for

716
00:25:49,120 --> 00:25:52,080
a lot of ics and ot environments that

717
00:25:52,080 --> 00:25:54,000
are not on a domain or some segments or

718
00:25:54,000 --> 00:25:54,640
not

719
00:25:54,640 --> 00:25:57,120
this may be a solution for you and as

720
00:25:57,120 --> 00:25:58,159
you can see here

721
00:25:58,159 --> 00:26:00,400
just encrypts the um you know it names

722
00:26:00,400 --> 00:26:01,440
with the host

723
00:26:01,440 --> 00:26:04,320
the account name the timestamp and then

724
00:26:04,320 --> 00:26:06,320
the thumbprint certificate so that when

725
00:26:06,320 --> 00:26:07,919
you're going back to uncover this

726
00:26:07,919 --> 00:26:09,440
credential

727
00:26:09,440 --> 00:26:11,600
you know which certificate is is needed

728
00:26:11,600 --> 00:26:12,880
to access this

729
00:26:12,880 --> 00:26:14,720
you can also use our back here if you

730
00:26:14,720 --> 00:26:16,799
have views different certificates to

731
00:26:16,799 --> 00:26:17,679
encrypt

732
00:26:17,679 --> 00:26:20,000
different levels of credentials and then

733
00:26:20,000 --> 00:26:21,200
you you control

734
00:26:21,200 --> 00:26:25,360
the access to those private keys

735
00:26:25,360 --> 00:26:27,760
for your your staff you can then also

736
00:26:27,760 --> 00:26:29,279
kind of balance in some

737
00:26:29,279 --> 00:26:33,520
some role based access control there so

738
00:26:34,720 --> 00:26:37,600
protected users this is really important

739
00:26:37,600 --> 00:26:38,720
protected users

740
00:26:38,720 --> 00:26:41,600
in the windows domain environment has

741
00:26:41,600 --> 00:26:43,200
some major protections

742
00:26:43,200 --> 00:26:46,159
for active directory side for accounts

743
00:26:46,159 --> 00:26:48,240
and then on the client side for accounts

744
00:26:48,240 --> 00:26:50,880
so the main things are restricting the

745
00:26:50,880 --> 00:26:51,440
use of

746
00:26:51,440 --> 00:26:54,400
ntlm authentication so that will break

747
00:26:54,400 --> 00:26:57,200
past the hash for ntlm

748
00:26:57,200 --> 00:26:59,919
also restricts the use of das or rc4 for

749
00:26:59,919 --> 00:27:01,919
kerberos pre-authentication

750
00:27:01,919 --> 00:27:05,120
so a lot of older protocols may not work

751
00:27:05,120 --> 00:27:06,559
when you have an accountant protected

752
00:27:06,559 --> 00:27:09,840
users but the the main benefit is the

753
00:27:09,840 --> 00:27:12,000
restricts the use of kerberos delegation

754
00:27:12,000 --> 00:27:13,360
so um

755
00:27:13,360 --> 00:27:14,400
you know you definitely don't want to

756
00:27:14,400 --> 00:27:16,480
have your domain administrators or your

757
00:27:16,480 --> 00:27:17,039
account

758
00:27:17,039 --> 00:27:19,840
operators be delegated to authenticate

759
00:27:19,840 --> 00:27:21,840
to different services right protected

760
00:27:21,840 --> 00:27:23,039
users kind of

761
00:27:23,039 --> 00:27:25,679
puts the brakes on that and then the

762
00:27:25,679 --> 00:27:26,960
kerberos

763
00:27:26,960 --> 00:27:30,240
tgt ticket granting ticket cannot be

764
00:27:30,240 --> 00:27:31,200
renewed

765
00:27:31,200 --> 00:27:32,960
um you have to request a new ticket

766
00:27:32,960 --> 00:27:34,320
granting ticket so

767
00:27:34,320 --> 00:27:37,200
if you are able to to steal a ticket or

768
00:27:37,200 --> 00:27:38,720
forge a ticket

769
00:27:38,720 --> 00:27:41,520
that ticket can't be renewed it has to

770
00:27:41,520 --> 00:27:42,799
be

771
00:27:42,799 --> 00:27:45,039
created from scratch so that kind of

772
00:27:45,039 --> 00:27:46,799
adds another protection there

773
00:27:46,799 --> 00:27:48,640
and the biggest thing about protected

774
00:27:48,640 --> 00:27:49,919
users is

775
00:27:49,919 --> 00:27:51,679
eliminates the caching of plain text

776
00:27:51,679 --> 00:27:53,679
credentials for cred ssp

777
00:27:53,679 --> 00:27:56,880
and w digest so the downfall to that is

778
00:27:56,880 --> 00:27:58,720
it will break offline sight in

779
00:27:58,720 --> 00:28:01,360
but again you don't want to have your

780
00:28:01,360 --> 00:28:03,360
administrative users be able to sign

781
00:28:03,360 --> 00:28:06,559
in offline on any kind of device

782
00:28:06,559 --> 00:28:10,320
um also ldap and ntlm authentication

783
00:28:10,320 --> 00:28:11,440
will no longer work

784
00:28:11,440 --> 00:28:13,840
so what it's kind of a big deal because

785
00:28:13,840 --> 00:28:16,480
a lot of technologies use ldap and ntlm

786
00:28:16,480 --> 00:28:20,000
authentication so looking at protected

787
00:28:20,000 --> 00:28:20,720
users

788
00:28:20,720 --> 00:28:23,360
you really need to take a approach of a

789
00:28:23,360 --> 00:28:24,720
small test group

790
00:28:24,720 --> 00:28:26,640
and then monitoring and kind of

791
00:28:26,640 --> 00:28:28,399
increasing the scope of that

792
00:28:28,399 --> 00:28:29,679
because there may be some things that

793
00:28:29,679 --> 00:28:31,679
break that you don't know or won't

794
00:28:31,679 --> 00:28:33,120
expect

795
00:28:33,120 --> 00:28:36,240
so definitely uh important to

796
00:28:36,240 --> 00:28:38,399
take small steps there one interesting

797
00:28:38,399 --> 00:28:39,440
thing is

798
00:28:39,440 --> 00:28:42,080
tacx plus for administrative access on

799
00:28:42,080 --> 00:28:44,159
cisco devices

800
00:28:44,159 --> 00:28:47,279
ends up using rc4 for kerberos

801
00:28:47,279 --> 00:28:49,440
pre-authentication now attack x plus is

802
00:28:49,440 --> 00:28:50,159
a

803
00:28:50,159 --> 00:28:52,720
20 plus year old protocol maybe it's

804
00:28:52,720 --> 00:28:55,360
time to move on from that i don't know

805
00:28:55,360 --> 00:28:59,440
that's something to think about there

806
00:28:59,440 --> 00:29:01,200
weak password policies for

807
00:29:01,200 --> 00:29:02,960
administrative accounts and non-admin

808
00:29:02,960 --> 00:29:04,720
accounts so the problem here

809
00:29:04,720 --> 00:29:08,399
is that with lan man authentication

810
00:29:08,399 --> 00:29:11,279
is an older protocol you take the

811
00:29:11,279 --> 00:29:12,399
password clever

812
00:29:12,399 --> 00:29:14,720
and lowercase so what happens is lanman

813
00:29:14,720 --> 00:29:18,000
converts that password to all uppercase

814
00:29:18,000 --> 00:29:21,520
and then it splits that it pads it to 14

815
00:29:21,520 --> 00:29:23,520
characters

816
00:29:23,520 --> 00:29:25,440
and then it splits that password into

817
00:29:25,440 --> 00:29:27,919
two seven character chunks

818
00:29:27,919 --> 00:29:29,440
right so if you anybody that has

819
00:29:29,440 --> 00:29:31,200
password policies where they say well we

820
00:29:31,200 --> 00:29:31,919
have 10

821
00:29:31,919 --> 00:29:35,039
we only require 10 characters

822
00:29:35,039 --> 00:29:36,960
guess what lan man hashes can still be

823
00:29:36,960 --> 00:29:38,320
stored on

824
00:29:38,320 --> 00:29:42,080
devices and they're very easy to crack

825
00:29:42,080 --> 00:29:45,200
the last part about landman um is that

826
00:29:45,200 --> 00:29:47,279
it uses those two chunks

827
00:29:47,279 --> 00:29:50,399
and then uses a des encryption

828
00:29:50,399 --> 00:29:53,919
uh method to bring those hashes together

829
00:29:53,919 --> 00:29:55,760
uh i didn't do the best job explaining

830
00:29:55,760 --> 00:29:58,399
it but that's why i provided the slides

831
00:29:58,399 --> 00:30:00,559
so um and that's the thing i mentioned

832
00:30:00,559 --> 00:30:02,799
before windows hashes lack of salt

833
00:30:02,799 --> 00:30:05,200
so again those that one password hash

834
00:30:05,200 --> 00:30:06,559
for a user is the same

835
00:30:06,559 --> 00:30:10,960
for another user with the same password

836
00:30:11,520 --> 00:30:14,640
so as you can see here using hash cat i

837
00:30:14,640 --> 00:30:16,240
was able to crack this hash

838
00:30:16,240 --> 00:30:19,039
in one second

839
00:30:19,360 --> 00:30:21,440
so it really focuses on the need for

840
00:30:21,440 --> 00:30:23,919
length over complexity

841
00:30:23,919 --> 00:30:26,799
and so the downfalls of a windows domain

842
00:30:26,799 --> 00:30:28,880
default password policy

843
00:30:28,880 --> 00:30:30,880
is that there's some limitations on what

844
00:30:30,880 --> 00:30:32,640
you can enforce and as you see here

845
00:30:32,640 --> 00:30:34,720
here's a screenshot

846
00:30:34,720 --> 00:30:37,840
14 characters i think the default if you

847
00:30:37,840 --> 00:30:41,120
install active directory is seven

848
00:30:41,120 --> 00:30:42,880
characters right now that's still the

849
00:30:42,880 --> 00:30:45,360
default

850
00:30:45,360 --> 00:30:46,559
weak password policies for

851
00:30:46,559 --> 00:30:48,399
administrative accounts the solution

852
00:30:48,399 --> 00:30:49,120
here

853
00:30:49,120 --> 00:30:52,640
is to use fine grain password policies

854
00:30:52,640 --> 00:30:54,880
a lot of people may not know about this

855
00:30:54,880 --> 00:30:56,799
this is accessible

856
00:30:56,799 --> 00:30:58,799
through active directory administration

857
00:30:58,799 --> 00:31:00,960
center which comes with your remote

858
00:31:00,960 --> 00:31:02,799
server administration tools

859
00:31:02,799 --> 00:31:04,080
and then these screenshots here will

860
00:31:04,080 --> 00:31:06,159
show you how to access that but

861
00:31:06,159 --> 00:31:08,240
the benefit of that fine grain password

862
00:31:08,240 --> 00:31:09,200
policy is

863
00:31:09,200 --> 00:31:12,240
we have the option to say if my admin

864
00:31:12,240 --> 00:31:13,519
account

865
00:31:13,519 --> 00:31:14,640
keep it locked out until an

866
00:31:14,640 --> 00:31:16,320
administrator manually unlocks the

867
00:31:16,320 --> 00:31:17,360
account

868
00:31:17,360 --> 00:31:20,320
enforce account lockout policy for admin

869
00:31:20,320 --> 00:31:21,679
accounts you definitely want to have

870
00:31:21,679 --> 00:31:23,279
manual intervention needed

871
00:31:23,279 --> 00:31:25,600
to unlock this account for user accounts

872
00:31:25,600 --> 00:31:27,200
it may be based differently on your

873
00:31:27,200 --> 00:31:29,919
your risk model here but the the minimum

874
00:31:29,919 --> 00:31:31,279
here i would say minimum

875
00:31:31,279 --> 00:31:34,399
is 20 characters for passwords uh for

876
00:31:34,399 --> 00:31:35,919
administrative users

877
00:31:35,919 --> 00:31:39,279
and for your regular users at least 16.

878
00:31:39,279 --> 00:31:41,840
if we remember lan man hashes are 14.

879
00:31:41,840 --> 00:31:43,760
can only compute a hash with 14

880
00:31:43,760 --> 00:31:44,799
characters

881
00:31:44,799 --> 00:31:47,519
if you take it a step further to that 16

882
00:31:47,519 --> 00:31:48,240
um

883
00:31:48,240 --> 00:31:51,519
you're still having that that complexity

884
00:31:51,519 --> 00:31:55,600
right and so um unfortunately i ran over

885
00:31:55,600 --> 00:31:57,919
talking about a couple things so

886
00:31:57,919 --> 00:32:01,760
um just reviewing here

887
00:32:01,760 --> 00:32:03,600
and these are all on the slides folks uh

888
00:32:03,600 --> 00:32:05,279
one of the last things that we can do

889
00:32:05,279 --> 00:32:08,000
is use um password spraying in our

890
00:32:08,000 --> 00:32:08,559
domain

891
00:32:08,559 --> 00:32:11,600
to identify weak passwords right and so

892
00:32:11,600 --> 00:32:12,720
there's a tool by

893
00:32:12,720 --> 00:32:14,880
uh written by bo bullock from black

894
00:32:14,880 --> 00:32:16,559
hills information security

895
00:32:16,559 --> 00:32:19,120
called domain password spray again use

896
00:32:19,120 --> 00:32:19,760
this tool

897
00:32:19,760 --> 00:32:22,080
in a test domain first but this can help

898
00:32:22,080 --> 00:32:24,320
you find passwords like summer 2020

899
00:32:24,320 --> 00:32:26,840
exclamation point

900
00:32:26,840 --> 00:32:29,840
um

901
00:32:31,279 --> 00:32:33,279
just so you know we we have uh 15

902
00:32:33,279 --> 00:32:35,039
minutes of buffer for q a

903
00:32:35,039 --> 00:32:36,640
do not oh you don't have to fly through

904
00:32:36,640 --> 00:32:38,320
these slides you're okay okay i

905
00:32:38,320 --> 00:32:39,919
appreciate it i was going for the 30

906
00:32:39,919 --> 00:32:41,039
minutes so

907
00:32:41,039 --> 00:32:43,519
let me just step back here uh thank you

908
00:32:43,519 --> 00:32:44,559
thank you

909
00:32:44,559 --> 00:32:47,679
so as we see here in the slide um

910
00:32:47,679 --> 00:32:49,519
we have our fine grain password policies

911
00:32:49,519 --> 00:32:51,039
that we created we created one for

912
00:32:51,039 --> 00:32:52,960
administrative users and then we created

913
00:32:52,960 --> 00:32:53,760
one for

914
00:32:53,760 --> 00:32:56,240
just regular users and so you can see

915
00:32:56,240 --> 00:32:57,919
that this tool will pick up those

916
00:32:57,919 --> 00:32:59,279
policies

917
00:32:59,279 --> 00:33:01,840
and looks at our our lockout threshold

918
00:33:01,840 --> 00:33:02,320
the

919
00:33:02,320 --> 00:33:04,799
password length so it's identifying that

920
00:33:04,799 --> 00:33:06,559
we have different password policies

921
00:33:06,559 --> 00:33:07,200
applied

922
00:33:07,200 --> 00:33:10,559
right and by doing this password

923
00:33:10,559 --> 00:33:12,559
spraying right the password was password

924
00:33:12,559 --> 00:33:14,000
this is for example

925
00:33:14,000 --> 00:33:16,320
but it will identify the different

926
00:33:16,320 --> 00:33:18,320
accounts that you have here so we've got

927
00:33:18,320 --> 00:33:19,440
tyler durden

928
00:33:19,440 --> 00:33:22,240
lazarus group sec moto all we're using

929
00:33:22,240 --> 00:33:23,200
the password

930
00:33:23,200 --> 00:33:26,559
of password so now

931
00:33:26,559 --> 00:33:28,080
we either know that we need to change

932
00:33:28,080 --> 00:33:29,919
these passwords

933
00:33:29,919 --> 00:33:31,600
if we're doing this as a blue team

934
00:33:31,600 --> 00:33:34,000
exercise or if we're doing this as a red

935
00:33:34,000 --> 00:33:36,159
team exercise we now know that we have

936
00:33:36,159 --> 00:33:36,799
some

937
00:33:36,799 --> 00:33:39,200
access that we can use right to do

938
00:33:39,200 --> 00:33:42,240
further enumeration

939
00:33:42,240 --> 00:33:44,640
and so that's the power of that it's

940
00:33:44,640 --> 00:33:46,320
great it's one of those things related

941
00:33:46,320 --> 00:33:47,760
to password policies

942
00:33:47,760 --> 00:33:50,960
right now i know the the future

943
00:33:50,960 --> 00:33:52,640
of authentication is going to

944
00:33:52,640 --> 00:33:54,159
passwordless

945
00:33:54,159 --> 00:33:58,399
but until greater strides can be made in

946
00:33:58,399 --> 00:34:01,440
usability and and applicability we'll be

947
00:34:01,440 --> 00:34:03,120
using passwords for some time

948
00:34:03,120 --> 00:34:06,000
right so and passwords are like

949
00:34:06,000 --> 00:34:06,880
underpants

950
00:34:06,880 --> 00:34:08,719
change them often keep them private and

951
00:34:08,719 --> 00:34:10,960
don't share them with anyone

952
00:34:10,960 --> 00:34:14,879
so uh kind of wrapping it up

953
00:34:14,879 --> 00:34:18,239
uh limiting risk from efs ransomware

954
00:34:18,239 --> 00:34:20,000
this is also something that i picked up

955
00:34:20,000 --> 00:34:22,159
in my sec 505 class

956
00:34:22,159 --> 00:34:23,679
and i just thought it was amazing i

957
00:34:23,679 --> 00:34:25,599
thought it was so smart

958
00:34:25,599 --> 00:34:29,280
um so efs our encrypting file system

959
00:34:29,280 --> 00:34:32,320
is built into windows

960
00:34:32,320 --> 00:34:35,679
okay and it uses a certificate

961
00:34:35,679 --> 00:34:38,399
to the private key or sorry the public

962
00:34:38,399 --> 00:34:39,520
key

963
00:34:39,520 --> 00:34:42,560
of a certificate

964
00:34:42,560 --> 00:34:46,560
to encrypt files so only the private key

965
00:34:46,560 --> 00:34:47,760
can decrypt that

966
00:34:47,760 --> 00:34:50,719
so think about that if an attacker was

967
00:34:50,719 --> 00:34:52,320
able to get access

968
00:34:52,320 --> 00:34:54,639
into your environment and escalate to

969
00:34:54,639 --> 00:34:56,000
the domain

970
00:34:56,000 --> 00:34:59,599
or enterprise admin level access

971
00:34:59,599 --> 00:35:02,079
they can now take and use that built-in

972
00:35:02,079 --> 00:35:03,200
efs

973
00:35:03,200 --> 00:35:06,240
function against you and ransom

974
00:35:06,240 --> 00:35:08,880
and lock up your system right it can

975
00:35:08,880 --> 00:35:10,880
even be done with a with a key that's

976
00:35:10,880 --> 00:35:12,160
created

977
00:35:12,160 --> 00:35:14,320
outside of the environment and imported

978
00:35:14,320 --> 00:35:16,400
as a string of characters

979
00:35:16,400 --> 00:35:18,720
once that private key is gone you can't

980
00:35:18,720 --> 00:35:20,480
decrypt those files

981
00:35:20,480 --> 00:35:24,400
unless you have an efs recovery agent

982
00:35:24,400 --> 00:35:28,839
key set up and so what that does is

983
00:35:28,839 --> 00:35:31,839
um

984
00:35:31,839 --> 00:35:35,200
creates in a policy a using a

985
00:35:35,200 --> 00:35:36,800
certificate

986
00:35:36,800 --> 00:35:40,079
that when the efs mechanism

987
00:35:40,079 --> 00:35:43,440
goes to encrypt files that private key

988
00:35:43,440 --> 00:35:45,200
that is used

989
00:35:45,200 --> 00:35:48,320
is encrypted with the public

990
00:35:48,320 --> 00:35:52,320
key of the efs recovery agent

991
00:35:52,320 --> 00:35:55,520
so now if you have the private key

992
00:35:55,520 --> 00:35:58,640
to the efs recovery agent you could have

993
00:35:58,640 --> 00:35:59,440
a recourse

994
00:35:59,440 --> 00:36:03,119
to decrypt your files that an attacker

995
00:36:03,119 --> 00:36:06,160
tried to use efs ransomware that's

996
00:36:06,160 --> 00:36:07,520
something to think about even if you

997
00:36:07,520 --> 00:36:09,280
don't use efs

998
00:36:09,280 --> 00:36:12,160
in your environment it is good to check

999
00:36:12,160 --> 00:36:13,599
and make sure that you have a recovery

1000
00:36:13,599 --> 00:36:15,040
agent set up

1001
00:36:15,040 --> 00:36:17,920
the caveat to this is you must you must

1002
00:36:17,920 --> 00:36:19,440
have that private key

1003
00:36:19,440 --> 00:36:21,359
store that offline put it on a smart

1004
00:36:21,359 --> 00:36:22,880
card put it in a safe

1005
00:36:22,880 --> 00:36:24,800
it may never be used but in the event

1006
00:36:24,800 --> 00:36:26,079
that it's needed

1007
00:36:26,079 --> 00:36:28,800
i mean how awesome what what a great

1008
00:36:28,800 --> 00:36:30,160
feeling and what a great outcome that

1009
00:36:30,160 --> 00:36:31,359
would be that

1010
00:36:31,359 --> 00:36:35,599
you know you prevented that and so

1011
00:36:35,599 --> 00:36:37,280
closing thoughts what do we say to the

1012
00:36:37,280 --> 00:36:39,599
god of death we say not today

1013
00:36:39,599 --> 00:36:42,880
right uh limiting risk as much as we can

1014
00:36:42,880 --> 00:36:46,160
in our environments is very important um

1015
00:36:46,160 --> 00:36:49,040
i think we know or or are learning you

1016
00:36:49,040 --> 00:36:50,240
can never be

1017
00:36:50,240 --> 00:36:54,240
100 secure and even the most elite

1018
00:36:54,240 --> 00:36:57,680
um and mature organizations can be

1019
00:36:57,680 --> 00:36:58,720
compromised

1020
00:36:58,720 --> 00:37:01,040
it happens right the important thing is

1021
00:37:01,040 --> 00:37:01,760
to have that

1022
00:37:01,760 --> 00:37:04,800
baseline of access that baseline of your

1023
00:37:04,800 --> 00:37:05,760
systems

1024
00:37:05,760 --> 00:37:08,000
limiting that risk strong password

1025
00:37:08,000 --> 00:37:09,119
policies now

1026
00:37:09,119 --> 00:37:12,079
i know that it's not the end-all be-all

1027
00:37:12,079 --> 00:37:13,760
solution but it really

1028
00:37:13,760 --> 00:37:16,240
can help to mitigate that risk on a very

1029
00:37:16,240 --> 00:37:17,760
large scale

1030
00:37:17,760 --> 00:37:21,200
and these are quick these are

1031
00:37:21,200 --> 00:37:24,560
easy wins to say to upper management

1032
00:37:24,560 --> 00:37:26,640
and you know infrastructure and say

1033
00:37:26,640 --> 00:37:28,640
listen this is what we want this is the

1034
00:37:28,640 --> 00:37:30,000
problem we have this is what we want to

1035
00:37:30,000 --> 00:37:30,640
do

1036
00:37:30,640 --> 00:37:32,560
it takes some some testing and

1037
00:37:32,560 --> 00:37:34,079
cooperation to get there

1038
00:37:34,079 --> 00:37:36,720
but it's it's such a better place to be

1039
00:37:36,720 --> 00:37:38,079
than just having

1040
00:37:38,079 --> 00:37:41,119
you know the same password for all local

1041
00:37:41,119 --> 00:37:43,040
admin accounts on servers and

1042
00:37:43,040 --> 00:37:45,200
password policies under 20 characters

1043
00:37:45,200 --> 00:37:47,200
for administrative users

1044
00:37:47,200 --> 00:37:50,000
there's so many other things right some

1045
00:37:50,000 --> 00:37:51,599
acknowledgements here i'd like to give

1046
00:37:51,599 --> 00:37:53,280
acknowledgement to jason fawson

1047
00:37:53,280 --> 00:37:56,280
um you can find his information at

1048
00:37:56,280 --> 00:37:57,920
blueteampowershell.com

1049
00:37:57,920 --> 00:38:00,800
also black hills information security

1050
00:38:00,800 --> 00:38:02,400
when i really started getting focused on

1051
00:38:02,400 --> 00:38:02,880
info

1052
00:38:02,880 --> 00:38:05,920
information security that was a has

1053
00:38:05,920 --> 00:38:09,040
has been and is a great resource

1054
00:38:09,040 --> 00:38:11,839
for um for people new to information

1055
00:38:11,839 --> 00:38:12,720
security

1056
00:38:12,720 --> 00:38:15,839
and advanced people also beau ballock

1057
00:38:15,839 --> 00:38:19,119
davtec with the domain password spray um

1058
00:38:19,119 --> 00:38:21,440
and then also tyrone e wilson from cover

1059
00:38:21,440 --> 00:38:22,800
6 solutions

1060
00:38:22,800 --> 00:38:25,359
tyrone was my mentor for the

1061
00:38:25,359 --> 00:38:26,400
presentation

1062
00:38:26,400 --> 00:38:28,320
and really gave me some great feedback

1063
00:38:28,320 --> 00:38:30,640
and just given him acknowledgement there

1064
00:38:30,640 --> 00:38:32,000
nice to meet another person in the

1065
00:38:32,000 --> 00:38:33,520
community

1066
00:38:33,520 --> 00:38:36,079
we also both play hockey so that's you

1067
00:38:36,079 --> 00:38:37,520
know it's cool to meet another hockey

1068
00:38:37,520 --> 00:38:39,599
player

1069
00:38:39,599 --> 00:38:41,520
and i'd like to say thank you to graham

1070
00:38:41,520 --> 00:38:42,960
and scythe for the opportunity to

1071
00:38:42,960 --> 00:38:43,520
present

1072
00:38:43,520 --> 00:38:46,240
um i think it's great to create a

1073
00:38:46,240 --> 00:38:47,599
community where people can share

1074
00:38:47,599 --> 00:38:48,800
information

1075
00:38:48,800 --> 00:38:51,839
and share um different ideas in kind of

1076
00:38:51,839 --> 00:38:52,800
an open way

1077
00:38:52,800 --> 00:38:56,000
and just collaborate this is my first

1078
00:38:56,000 --> 00:38:58,880
major talk to a large audience and it's

1079
00:38:58,880 --> 00:39:00,320
been a great experience working with

1080
00:39:00,320 --> 00:39:01,280
tyrone

1081
00:39:01,280 --> 00:39:04,320
and graham and scythe to get prepared if

1082
00:39:04,320 --> 00:39:05,680
you want to connect

1083
00:39:05,680 --> 00:39:09,040
i have a github linkedin and on twitter

1084
00:39:09,040 --> 00:39:10,400
i go by the handle blake

1085
00:39:10,400 --> 00:39:13,520
underscore r38 i think the first handle

1086
00:39:13,520 --> 00:39:15,280
i went to pick out was taken so i just

1087
00:39:15,280 --> 00:39:16,240
used

1088
00:39:16,240 --> 00:39:18,160
the next one there so i really

1089
00:39:18,160 --> 00:39:19,280
appreciate the time

1090
00:39:19,280 --> 00:39:22,240
and i look forward to watching um the

1091
00:39:22,240 --> 00:39:23,599
other events and

1092
00:39:23,599 --> 00:39:26,320
and hoping that uh 2021 is a is a much

1093
00:39:26,320 --> 00:39:27,440
better year for all of us

1094
00:39:27,440 --> 00:39:29,359
i know that it's been difficult and just

1095
00:39:29,359 --> 00:39:31,280
looking forward to um

1096
00:39:31,280 --> 00:39:33,200
to a brighter year next year so thank

1097
00:39:33,200 --> 00:39:35,839
you very much

1098
00:39:36,320 --> 00:39:39,760
well done blake nicely done uh that was

1099
00:39:39,760 --> 00:39:42,880
thank you that was an amazing talk um so

1100
00:39:42,880 --> 00:39:45,200
perspective again i came from blue team

1101
00:39:45,200 --> 00:39:46,320
ops i'm now

1102
00:39:46,320 --> 00:39:49,440
on the red team and literally yesterday

1103
00:39:49,440 --> 00:39:51,280
i presented a report to the client

1104
00:39:51,280 --> 00:39:53,359
where the in the even up to the

1105
00:39:53,359 --> 00:39:55,280
executive summary the example path i

1106
00:39:55,280 --> 00:39:56,079
gave

1107
00:39:56,079 --> 00:39:58,960
was hi if my attack if the attacker

1108
00:39:58,960 --> 00:40:00,480
gains access by a phishing which it

1109
00:40:00,480 --> 00:40:02,000
almost always is

1110
00:40:02,000 --> 00:40:03,680
almost always they'll have limited user

1111
00:40:03,680 --> 00:40:06,240
access unless there's some way to get

1112
00:40:06,240 --> 00:40:09,839
local admin that's a significant uh

1113
00:40:09,839 --> 00:40:11,599
sync for attackers they don't always

1114
00:40:11,599 --> 00:40:13,200
have to get local admin but it's always

1115
00:40:13,200 --> 00:40:13,920
useful

1116
00:40:13,920 --> 00:40:17,119
and the single fastest path

1117
00:40:17,119 --> 00:40:21,280
to failure as a defender is having

1118
00:40:21,280 --> 00:40:23,920
sets of computers with the same local

1119
00:40:23,920 --> 00:40:26,160
administrative credentials

1120
00:40:26,160 --> 00:40:29,760
let me say that again the single

1121
00:40:29,760 --> 00:40:33,440
fastest path to failure as a defender

1122
00:40:33,440 --> 00:40:36,079
is having the same local administrator

1123
00:40:36,079 --> 00:40:37,520
or administrative

1124
00:40:37,520 --> 00:40:41,040
credentials across multiple machines

1125
00:40:41,040 --> 00:40:43,359
another path i used with that exact same

1126
00:40:43,359 --> 00:40:45,680
client the report delivered yesterday

1127
00:40:45,680 --> 00:40:48,880
was one random admin machine with

1128
00:40:48,880 --> 00:40:51,200
authenticated users in the remote

1129
00:40:51,200 --> 00:40:52,560
desktop users group

1130
00:40:52,560 --> 00:40:55,200
so anybody across any domain that has

1131
00:40:55,200 --> 00:40:57,440
any trust could log into that box

1132
00:40:57,440 --> 00:41:00,319
i log in i'm a limited user oh no but

1133
00:41:00,319 --> 00:41:00,720
the

1134
00:41:00,720 --> 00:41:03,200
local administrator password that was

1135
00:41:03,200 --> 00:41:05,200
shared on public file shares

1136
00:41:05,200 --> 00:41:06,960
lets me escalate and hey look there's a

1137
00:41:06,960 --> 00:41:08,640
domain admin logged in

1138
00:41:08,640 --> 00:41:10,720
right that was oh yeah from limited user

1139
00:41:10,720 --> 00:41:11,760
to domain admin

1140
00:41:11,760 --> 00:41:14,880
in two steps right log in and log in

1141
00:41:14,880 --> 00:41:15,440
again with

1142
00:41:15,440 --> 00:41:18,160
uh local administrator credentials so

1143
00:41:18,160 --> 00:41:18,720
this

1144
00:41:18,720 --> 00:41:21,760
happens i love your talk actionable

1145
00:41:21,760 --> 00:41:22,800
advice and

1146
00:41:22,800 --> 00:41:24,400
this is where a lot of attackers look

1147
00:41:24,400 --> 00:41:26,400
both pen testers red teamers and

1148
00:41:26,400 --> 00:41:28,880
real world attackers so i cannot give

1149
00:41:28,880 --> 00:41:30,960
this a strong enough endorsement i love

1150
00:41:30,960 --> 00:41:32,319
laps as well

1151
00:41:32,319 --> 00:41:34,800
um i do share a couple extra links of

1152
00:41:34,800 --> 00:41:36,400
just setting up laps so it's not

1153
00:41:36,400 --> 00:41:38,240
terribly surprising doing a lab

1154
00:41:38,240 --> 00:41:39,920
environment first so you know what's

1155
00:41:39,920 --> 00:41:40,960
going to happen

1156
00:41:40,960 --> 00:41:42,960
um thank you for talking about what

1157
00:41:42,960 --> 00:41:44,880
happens with the protected users group

1158
00:41:44,880 --> 00:41:46,880
um in terms of like tacx i hadn't seen

1159
00:41:46,880 --> 00:41:48,560
that before right most of the

1160
00:41:48,560 --> 00:41:50,000
repercussions for admins

1161
00:41:50,000 --> 00:41:51,520
they don't care if they can't log into

1162
00:41:51,520 --> 00:41:52,960
the domains unavailable because they're

1163
00:41:52,960 --> 00:41:54,400
a freaking domain admin they're

1164
00:41:54,400 --> 00:41:56,560
there to admin the domain so it's not

1165
00:41:56,560 --> 00:41:58,000
usually relevant

1166
00:41:58,000 --> 00:42:00,400
um but but yes thank you for showing

1167
00:42:00,400 --> 00:42:02,000
that the possible downsides to

1168
00:42:02,000 --> 00:42:02,960
protective users

1169
00:42:02,960 --> 00:42:06,000
as well uh ghost mentions

1170
00:42:06,000 --> 00:42:07,760
abusing trust issues with bad security

1171
00:42:07,760 --> 00:42:10,079
practices and responder is my thing yeah

1172
00:42:10,079 --> 00:42:11,200
if you want to get into that you can

1173
00:42:11,200 --> 00:42:12,480
disable

1174
00:42:12,480 --> 00:42:14,240
link local management name resolution

1175
00:42:14,240 --> 00:42:16,079
protocol r you can disable

1176
00:42:16,079 --> 00:42:18,640
net bios for name resolution both are

1177
00:42:18,640 --> 00:42:19,359
default

1178
00:42:19,359 --> 00:42:21,920
right before giving up on a dns name

1179
00:42:21,920 --> 00:42:23,680
windows will say hey anybody

1180
00:42:23,680 --> 00:42:25,599
have you heard of that old sccm server

1181
00:42:25,599 --> 00:42:27,440
that's what i'm looking for

1182
00:42:27,440 --> 00:42:31,520
responders like i'll respond to that

1183
00:42:31,520 --> 00:42:33,359
that's totally me connect to me please

1184
00:42:33,359 --> 00:42:35,119
and you can either relay your crack

1185
00:42:35,119 --> 00:42:37,839
credentials from there yeah

1186
00:42:37,839 --> 00:42:39,920
ah thank you that was it that was

1187
00:42:39,920 --> 00:42:42,160
fantastic talk i'm i'm glad to

1188
00:42:42,160 --> 00:42:45,200
see you at grimcon and i will happily uh

1189
00:42:45,200 --> 00:42:46,319
attend your talks

1190
00:42:46,319 --> 00:42:48,240
at future events because this should not

1191
00:42:48,240 --> 00:42:49,760
be your your

1192
00:42:49,760 --> 00:42:51,760
one and only step into presenting you

1193
00:42:51,760 --> 00:42:52,880
did a great job blake

1194
00:42:52,880 --> 00:42:54,160
thank you thank you very much thank you

1195
00:42:54,160 --> 00:42:55,920
thank you yeah uh

1196
00:42:55,920 --> 00:42:58,560
let's see any other questions or

1197
00:42:58,560 --> 00:43:00,319
comments wesley

1198
00:43:00,319 --> 00:43:03,520
oh man no no the great presentation

1199
00:43:03,520 --> 00:43:05,839
um you know something that can be added

1200
00:43:05,839 --> 00:43:07,599
on to this as far as just another

1201
00:43:07,599 --> 00:43:09,440
another presentation is that you know

1202
00:43:09,440 --> 00:43:11,119
for people like jeff you and me this

1203
00:43:11,119 --> 00:43:12,000
makes perfect sense

1204
00:43:12,000 --> 00:43:13,119
you know this is definitely something

1205
00:43:13,119 --> 00:43:15,040
that we can see we can visualize we see

1206
00:43:15,040 --> 00:43:15,839
it done

1207
00:43:15,839 --> 00:43:18,319
but you know i'll be i'll be interested

1208
00:43:18,319 --> 00:43:20,400
to see how we report this to somebody

1209
00:43:20,400 --> 00:43:22,720
you know who may not have this type of

1210
00:43:22,720 --> 00:43:24,079
uh in-depth knowledge

1211
00:43:24,079 --> 00:43:25,599
and everything and like i said this may

1212
00:43:25,599 --> 00:43:27,599
be a presentation i did because

1213
00:43:27,599 --> 00:43:29,520
this is all great we understand this uh

1214
00:43:29,520 --> 00:43:31,839
from this from from that technical level

1215
00:43:31,839 --> 00:43:34,000
but hey how do you take this and put it

1216
00:43:34,000 --> 00:43:35,599
into a word that hey you know

1217
00:43:35,599 --> 00:43:37,920
oh yeah no absolutely somebody somebody

1218
00:43:37,920 --> 00:43:39,280
can actually understand like you know

1219
00:43:39,280 --> 00:43:39,680
what

1220
00:43:39,680 --> 00:43:41,839
i need to fix this right now that's the

1221
00:43:41,839 --> 00:43:43,280
biggest thing let's see these are

1222
00:43:43,280 --> 00:43:45,599
some talks ideas that can definitely um

1223
00:43:45,599 --> 00:43:47,680
come throughout the next grim con

1224
00:43:47,680 --> 00:43:49,599
or whatever conference to because these

1225
00:43:49,599 --> 00:43:51,359
are very

1226
00:43:51,359 --> 00:43:53,920
these are things that people like me

1227
00:43:53,920 --> 00:43:54,800
jeff and

1228
00:43:54,800 --> 00:43:55,920
anybody who've been in this field

1229
00:43:55,920 --> 00:43:57,280
struggle with just trying to communicate

1230
00:43:57,280 --> 00:43:58,079
this up

1231
00:43:58,079 --> 00:43:59,520
so that they understand like you know

1232
00:43:59,520 --> 00:44:01,440
what this is an action this needs to be

1233
00:44:01,440 --> 00:44:02,079
fixed

1234
00:44:02,079 --> 00:44:04,640
so um definitely something to think

1235
00:44:04,640 --> 00:44:05,760
about you know if you have

1236
00:44:05,760 --> 00:44:08,079
any ideas and how you how you present

1237
00:44:08,079 --> 00:44:10,160
that how you put it in a language or

1238
00:44:10,160 --> 00:44:12,079
how you get somebody to how did you

1239
00:44:12,079 --> 00:44:13,520
influence somebody to take action on

1240
00:44:13,520 --> 00:44:14,400
this

1241
00:44:14,400 --> 00:44:17,599
great presentation idea uh so

1242
00:44:17,599 --> 00:44:19,920
as an aside on that i i just literally

1243
00:44:19,920 --> 00:44:20,800
pulled up the

1244
00:44:20,800 --> 00:44:22,880
pen test report and it's nice to start

1245
00:44:22,880 --> 00:44:24,079
off with

1246
00:44:24,079 --> 00:44:26,560
start off with basic kind of orient your

1247
00:44:26,560 --> 00:44:27,599
audience so

1248
00:44:27,599 --> 00:44:29,440
my first sentence for the finding about

1249
00:44:29,440 --> 00:44:30,880
multiple computers with the same lock

1250
00:44:30,880 --> 00:44:32,079
and password

1251
00:44:32,079 --> 00:44:34,720
domain credentials are nicely centrally

1252
00:44:34,720 --> 00:44:36,800
managed inside of active directory

1253
00:44:36,800 --> 00:44:38,880
however each domain join also has its

1254
00:44:38,880 --> 00:44:40,560
own local credentials that are

1255
00:44:40,560 --> 00:44:41,760
separately managed

1256
00:44:41,760 --> 00:44:44,400
because there's a lack of visibility

1257
00:44:44,400 --> 00:44:45,920
that's where

1258
00:44:45,920 --> 00:44:49,359
security problems fester so

1259
00:44:49,359 --> 00:44:51,520
gaining increasing that visibility is a

1260
00:44:51,520 --> 00:44:52,560
huge thing so i said

1261
00:44:52,560 --> 00:44:54,079
commonly a lack of configuration

1262
00:44:54,079 --> 00:44:55,760
management on those local accounts are a

1263
00:44:55,760 --> 00:44:58,079
source of security related issues

1264
00:44:58,079 --> 00:44:59,440
for example using the same local

1265
00:44:59,440 --> 00:45:00,720
administrator password across multiple

1266
00:45:00,720 --> 00:45:02,240
machines allows by default

1267
00:45:02,240 --> 00:45:04,160
attacker who gains control of any one

1268
00:45:04,160 --> 00:45:05,680
computer to control

1269
00:45:05,680 --> 00:45:07,119
all other computers with the same

1270
00:45:07,119 --> 00:45:09,920
password i'm not hedging my phrasing

1271
00:45:09,920 --> 00:45:10,720
there but that's

1272
00:45:10,720 --> 00:45:14,319
huge and i go into specifics but uh

1273
00:45:14,319 --> 00:45:16,640
keep the make the complex simple and

1274
00:45:16,640 --> 00:45:18,000
orient your audience to the

1275
00:45:18,000 --> 00:45:20,480
idea quickly um so that you can then

1276
00:45:20,480 --> 00:45:21,760
talk into specifics but

1277
00:45:21,760 --> 00:45:24,800
start from very general is coming advice

1278
00:45:24,800 --> 00:45:26,720
there for a finding itself

1279
00:45:26,720 --> 00:45:29,440
um so uh that was awesome blake are you

1280
00:45:29,440 --> 00:45:30,000
i

1281
00:45:30,000 --> 00:45:31,599
shared your links inside of the noobs

1282
00:45:31,599 --> 00:45:33,280
track channel inside of discord uh

1283
00:45:33,280 --> 00:45:34,800
you should be judging me on the discord

1284
00:45:34,800 --> 00:45:36,560
shows

1285
00:45:36,560 --> 00:45:38,160
i'll answer questions if people have

1286
00:45:38,160 --> 00:45:40,240
questions you know it's great and i

1287
00:45:40,240 --> 00:45:41,920
thanks for the opportunity and i look

1288
00:45:41,920 --> 00:45:44,000
forward to um learning from the other

1289
00:45:44,000 --> 00:45:44,720
presenters

1290
00:45:44,720 --> 00:45:46,800
so yeah absolutely well i'll look

1291
00:45:46,800 --> 00:45:48,400
forward to seeing you at uh future

1292
00:45:48,400 --> 00:45:49,119
conferences

1293
00:45:49,119 --> 00:45:52,319
as well okay thanks jeff huxley

1294
00:45:52,319 --> 00:45:55,440
absolutely absolutely

1295
00:45:55,440 --> 00:46:00,160
uh powers from you all right get that

1296
00:46:00,160 --> 00:46:01,599
local admin back

1297
00:46:01,599 --> 00:46:04,400
yeah that's right we're not we're not to

1298
00:46:04,400 --> 00:46:06,000
the point of sharing root passwords yet

1299
00:46:06,000 --> 00:46:08,440
blake sorry

1300
00:46:08,440 --> 00:46:11,440
yes

