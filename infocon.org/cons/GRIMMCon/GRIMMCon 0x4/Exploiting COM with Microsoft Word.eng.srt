1
00:00:05,520 --> 00:00:06,560
okay cool

2
00:00:06,560 --> 00:00:09,360
can't wait um so i'll just get right

3
00:00:09,360 --> 00:00:10,960
into it here and um

4
00:00:10,960 --> 00:00:13,360
my name is will dorman i am a

5
00:00:13,360 --> 00:00:14,160
professional

6
00:00:14,160 --> 00:00:16,400
bug magnet at the cert coordination

7
00:00:16,400 --> 00:00:17,279
center

8
00:00:17,279 --> 00:00:20,560
and this talk is kind of uh the focus of

9
00:00:20,560 --> 00:00:21,760
this talk is about

10
00:00:21,760 --> 00:00:25,599
attacking calm by a microsoft word

11
00:00:25,599 --> 00:00:28,480
uh but before i get into the um the

12
00:00:28,480 --> 00:00:30,080
actual details

13
00:00:30,080 --> 00:00:32,238
uh let's take a little trip down memory

14
00:00:32,238 --> 00:00:33,200
lane which

15
00:00:33,200 --> 00:00:35,040
they might have alluded to a little bit

16
00:00:35,040 --> 00:00:36,719
earlier here

17
00:00:36,719 --> 00:00:38,800
think of the early days maybe like 20

18
00:00:38,800 --> 00:00:40,399
years ago you've got your internet

19
00:00:40,399 --> 00:00:42,960
explorer 6 and you've got

20
00:00:42,960 --> 00:00:46,000
text links pictures tables

21
00:00:46,000 --> 00:00:49,360
um that's kind of cool

22
00:00:49,360 --> 00:00:52,480
but like we we want a little bit more

23
00:00:52,480 --> 00:00:53,840
we want something better we want

24
00:00:53,840 --> 00:00:57,120
something a little more interactive

25
00:00:57,120 --> 00:00:59,760
so uh i don't know if anybody remembers

26
00:00:59,760 --> 00:01:01,440
activex it was very big

27
00:01:01,440 --> 00:01:03,440
we'll say 20 years ago it started out

28
00:01:03,440 --> 00:01:04,720
before then

29
00:01:04,720 --> 00:01:06,400
but the nice thing about it is it gives

30
00:01:06,400 --> 00:01:08,080
you an interactive web

31
00:01:08,080 --> 00:01:11,600
experience so this is a very simple html

32
00:01:11,600 --> 00:01:12,799
page

33
00:01:12,799 --> 00:01:15,280
all i'm doing here is i'm referencing a

34
00:01:15,280 --> 00:01:18,560
class id for a particular object

35
00:01:18,560 --> 00:01:22,320
and this is my rendered web page

36
00:01:22,320 --> 00:01:25,840
which is pretty cool because i know i

37
00:01:25,840 --> 00:01:27,600
typed a little bit of text but now i

38
00:01:27,600 --> 00:01:30,159
have this interactive sort of

39
00:01:30,159 --> 00:01:32,640
um i've got my real player which i you

40
00:01:32,640 --> 00:01:35,759
know i need to have that in my web page

41
00:01:35,759 --> 00:01:37,360
so that's really cool to have that sort

42
00:01:37,360 --> 00:01:39,439
of interactive experience beyond just

43
00:01:39,439 --> 00:01:40,960
like your pictures and everything like

44
00:01:40,960 --> 00:01:42,720
that

45
00:01:42,720 --> 00:01:45,360
the problem is is it gives you an attack

46
00:01:45,360 --> 00:01:46,000
surface

47
00:01:46,000 --> 00:01:48,799
second to none so think about uh code

48
00:01:48,799 --> 00:01:50,720
like 20 years ago

49
00:01:50,720 --> 00:01:52,479
you've got cnc plus plus code written

50
00:01:52,479 --> 00:01:53,840
when i say written by anyone it's

51
00:01:53,840 --> 00:01:54,720
basically

52
00:01:54,720 --> 00:01:56,960
anybody can create an activex control

53
00:01:56,960 --> 00:01:58,479
and release it you can host it on your

54
00:01:58,479 --> 00:01:59,920
website

55
00:01:59,920 --> 00:02:02,000
this are the days before you have dep

56
00:02:02,000 --> 00:02:03,040
and aslr

57
00:02:03,040 --> 00:02:06,880
so exploitation is pretty damn easy

58
00:02:06,880 --> 00:02:09,199
um and the interesting thing about this

59
00:02:09,199 --> 00:02:11,520
at least in the days of ie6 is all of

60
00:02:11,520 --> 00:02:13,520
this was exposed

61
00:02:13,520 --> 00:02:16,000
to any website being able to use without

62
00:02:16,000 --> 00:02:17,680
prompting so you visit a website and

63
00:02:17,680 --> 00:02:19,280
it's like boom there you know

64
00:02:19,280 --> 00:02:21,040
if i visit youtube the way that it

65
00:02:21,040 --> 00:02:22,959
implemented the video as it gave me an

66
00:02:22,959 --> 00:02:24,560
activex control

67
00:02:24,560 --> 00:02:27,280
uh so we'd release this tool years i

68
00:02:27,280 --> 00:02:29,920
don't know a million years ago it seems

69
00:02:29,920 --> 00:02:32,239
called draenzer and it will basically

70
00:02:32,239 --> 00:02:34,160
take an activex control and it'll just

71
00:02:34,160 --> 00:02:34,560
try

72
00:02:34,560 --> 00:02:37,280
very simple things like you know if you

73
00:02:37,280 --> 00:02:38,480
have something that takes a string

74
00:02:38,480 --> 00:02:40,720
parameter it'll give it a long string

75
00:02:40,720 --> 00:02:42,239
so here we can see we've got the real

76
00:02:42,239 --> 00:02:44,319
one player uh the first thing it does is

77
00:02:44,319 --> 00:02:45,599
it just calls

78
00:02:45,599 --> 00:02:47,680
real player version the very next thing

79
00:02:47,680 --> 00:02:50,080
it does is it calls this function called

80
00:02:50,080 --> 00:02:51,200
component version

81
00:02:51,200 --> 00:02:54,560
or sorry it does a property get

82
00:02:54,560 --> 00:02:56,879
the component version property takes an

83
00:02:56,879 --> 00:02:58,239
argument

84
00:02:58,239 --> 00:03:00,720
of name and we give it a long string

85
00:03:00,720 --> 00:03:01,760
what do we see here

86
00:03:01,760 --> 00:03:04,159
drainser has logged in access violation

87
00:03:04,159 --> 00:03:05,920
at seventy eight seven eight seven eight

88
00:03:05,920 --> 00:03:06,560
all right

89
00:03:06,560 --> 00:03:09,840
bad read on 78 um if anybody knows their

90
00:03:09,840 --> 00:03:11,200
ascii table

91
00:03:11,200 --> 00:03:14,560
78 is the lowercase x so we basically

92
00:03:14,560 --> 00:03:16,879
gave it a long string of lowercase x's

93
00:03:16,879 --> 00:03:18,800
and we now have

94
00:03:18,800 --> 00:03:22,000
an access violation so let's think about

95
00:03:22,000 --> 00:03:23,760
this interactivity

96
00:03:23,760 --> 00:03:26,959
uh rather than my sample website where

97
00:03:26,959 --> 00:03:27,519
i'm just

98
00:03:27,519 --> 00:03:29,680
like putting this activex control i'm

99
00:03:29,680 --> 00:03:31,120
actually going to script it so i can

100
00:03:31,120 --> 00:03:32,560
control it

101
00:03:32,560 --> 00:03:34,080
with the script section here and i'm

102
00:03:34,080 --> 00:03:35,680
just going to call this component

103
00:03:35,680 --> 00:03:38,640
version uh with this variable that i

104
00:03:38,640 --> 00:03:40,080
call big string and it's like a

105
00:03:40,080 --> 00:03:43,840
10k long string what happens when we

106
00:03:43,840 --> 00:03:44,319
load

107
00:03:44,319 --> 00:03:47,519
this page in internet explorer 6.

108
00:03:47,519 --> 00:03:49,920
we get our favorite 32-bit windows

109
00:03:49,920 --> 00:03:50,799
debugger

110
00:03:50,799 --> 00:03:53,840
immunity debugger and i can see access

111
00:03:53,840 --> 00:03:54,799
violation while

112
00:03:54,799 --> 00:03:57,920
executing 78 so

113
00:03:57,920 --> 00:03:59,920
if that you know if anybody's ever done

114
00:03:59,920 --> 00:04:01,760
any crash analysis or

115
00:04:01,760 --> 00:04:02,959
trying to find bugs that they can

116
00:04:02,959 --> 00:04:05,280
exploit like this is the biggest home

117
00:04:05,280 --> 00:04:06,879
run that you could possibly get

118
00:04:06,879 --> 00:04:10,080
ever this was the world of you know

119
00:04:10,080 --> 00:04:14,000
the web 20 years ago

120
00:04:14,000 --> 00:04:16,560
now i mentioned in the prior slide that

121
00:04:16,560 --> 00:04:17,680
um

122
00:04:17,680 --> 00:04:19,918
we have this activex control that we are

123
00:04:19,918 --> 00:04:20,880
scripting

124
00:04:20,880 --> 00:04:24,800
um so you know activex controls and calm

125
00:04:24,800 --> 00:04:27,040
the two terms can be used kind of

126
00:04:27,040 --> 00:04:28,960
interchangeably but basically

127
00:04:28,960 --> 00:04:31,040
take a com object is the generic term

128
00:04:31,040 --> 00:04:32,880
for it activex is something that's

129
00:04:32,880 --> 00:04:34,560
designed to be used with internet

130
00:04:34,560 --> 00:04:36,479
explorer

131
00:04:36,479 --> 00:04:39,600
and these objects can be marked safe

132
00:04:39,600 --> 00:04:41,360
to be used by internet explorer in one

133
00:04:41,360 --> 00:04:42,880
of two ways you can have

134
00:04:42,880 --> 00:04:44,800
a control that is safe for scripting

135
00:04:44,800 --> 00:04:46,240
which means that just like with that

136
00:04:46,240 --> 00:04:48,479
prior example where i showed the crash

137
00:04:48,479 --> 00:04:50,960
um i got a property and i gave it a per

138
00:04:50,960 --> 00:04:52,479
i gave it a really long string and it

139
00:04:52,479 --> 00:04:54,560
crashed in a very fun way

140
00:04:54,560 --> 00:04:56,080
safe for scripting safe for

141
00:04:56,080 --> 00:04:58,000
initialization with persistent data is

142
00:04:58,000 --> 00:04:59,120
vaguely similar

143
00:04:59,120 --> 00:05:00,479
in that it's a little bit less

144
00:05:00,479 --> 00:05:02,560
interactive but you can still provide

145
00:05:02,560 --> 00:05:04,320
information or you can provide data to

146
00:05:04,320 --> 00:05:06,800
that activex control

147
00:05:06,800 --> 00:05:10,000
now think about this for a second

148
00:05:10,000 --> 00:05:13,199
how does internet explorer

149
00:05:13,199 --> 00:05:15,440
know given any particular com object

150
00:05:15,440 --> 00:05:16,479
that you're dealing with

151
00:05:16,479 --> 00:05:18,479
how does internet explorer know if that

152
00:05:18,479 --> 00:05:19,680
object is safe

153
00:05:19,680 --> 00:05:23,840
to be scripted or initialized

154
00:05:23,840 --> 00:05:25,600
how can it do it i mean a class id is

155
00:05:25,600 --> 00:05:28,400
just a reference to registry value

156
00:05:28,400 --> 00:05:32,080
um how does a control specify

157
00:05:32,080 --> 00:05:35,680
if it is to be if it is safe or not

158
00:05:35,680 --> 00:05:38,400
um and this is the thing that really

159
00:05:38,400 --> 00:05:40,560
didn't sit well with me for a bit but

160
00:05:40,560 --> 00:05:42,479
in order for internet explorer to know

161
00:05:42,479 --> 00:05:44,240
if a control is safe or not

162
00:05:44,240 --> 00:05:47,680
it asks the control are you safe and it

163
00:05:47,680 --> 00:05:49,600
says through its eye object safety

164
00:05:49,600 --> 00:05:51,280
interface okay yes i'm safe for

165
00:05:51,280 --> 00:05:52,240
scripting

166
00:05:52,240 --> 00:05:54,720
but in order for a control to answer the

167
00:05:54,720 --> 00:05:56,639
question of are you safe

168
00:05:56,639 --> 00:05:59,280
the browser actually has to run code

169
00:05:59,280 --> 00:06:00,560
within that object

170
00:06:00,560 --> 00:06:03,680
so it's a little bit of a chicken in an

171
00:06:03,680 --> 00:06:06,240
egg sort of situation um

172
00:06:06,240 --> 00:06:08,319
and what i noticed very early on i think

173
00:06:08,319 --> 00:06:10,639
even before drains or exist

174
00:06:10,639 --> 00:06:12,319
drains are existed as a tool i was able

175
00:06:12,319 --> 00:06:13,600
to do some stuff with some basic

176
00:06:13,600 --> 00:06:14,720
scripting

177
00:06:14,720 --> 00:06:18,639
um and we basically have certain com

178
00:06:18,639 --> 00:06:21,199
objects that kind of behave

179
00:06:21,199 --> 00:06:23,520
poorly so this is a com object this is

180
00:06:23,520 --> 00:06:24,800
an html file

181
00:06:24,800 --> 00:06:27,039
all it's doing is referencing a class id

182
00:06:27,039 --> 00:06:28,639
and what happens when i load

183
00:06:28,639 --> 00:06:31,759
that website access

184
00:06:31,759 --> 00:06:34,880
violation while executing some

185
00:06:34,880 --> 00:06:37,520
memory address which happens to be in

186
00:06:37,520 --> 00:06:39,039
the heap sprayable

187
00:06:39,039 --> 00:06:42,000
realm of memory so like that's pretty

188
00:06:42,000 --> 00:06:42,720
bad

189
00:06:42,720 --> 00:06:45,520
so we cert published a vulnerability

190
00:06:45,520 --> 00:06:47,520
note on this

191
00:06:47,520 --> 00:06:49,599
apply an update is to fix microsoft did

192
00:06:49,599 --> 00:06:51,039
a thing called a kill bit which is

193
00:06:51,039 --> 00:06:52,639
basically where you can disable

194
00:06:52,639 --> 00:06:56,319
an activex control funny little aside

195
00:06:56,319 --> 00:06:57,599
about the kill bit i kind of

196
00:06:57,599 --> 00:06:59,360
accidentally noticed at some point in

197
00:06:59,360 --> 00:07:00,400
time that

198
00:07:00,400 --> 00:07:02,880
if you put curly brackets around a class

199
00:07:02,880 --> 00:07:03,840
id

200
00:07:03,840 --> 00:07:07,039
internet explorer ignores that kill bit

201
00:07:07,039 --> 00:07:09,919
so um they fixed it eventually but i

202
00:07:09,919 --> 00:07:11,280
thought it was kind of a hilarious sort

203
00:07:11,280 --> 00:07:12,800
of thing where i'm testing kill bits and

204
00:07:12,800 --> 00:07:13,680
it's like wait these

205
00:07:13,680 --> 00:07:15,840
don't work at all well turns out curly

206
00:07:15,840 --> 00:07:17,919
brackets

207
00:07:17,919 --> 00:07:21,039
anyway so that's our history lesson

208
00:07:21,039 --> 00:07:24,720
let's think about modern computing you

209
00:07:24,720 --> 00:07:26,479
probably have a windows system

210
00:07:26,479 --> 00:07:30,560
probably have microsoft office on it

211
00:07:30,560 --> 00:07:32,240
the question that i have right now is

212
00:07:32,240 --> 00:07:36,240
have we learned our lessons

213
00:07:36,639 --> 00:07:38,800
this is a while ago actually this is

214
00:07:38,800 --> 00:07:40,000
actually

215
00:07:40,000 --> 00:07:42,080
literally the text the email that i had

216
00:07:42,080 --> 00:07:44,319
sent to microsoft a while ago um and i

217
00:07:44,319 --> 00:07:44,800
had

218
00:07:44,800 --> 00:07:46,080
i had noticed i'm playing around with

219
00:07:46,080 --> 00:07:47,759
com objects and it's like you know you

220
00:07:47,759 --> 00:07:49,759
can open up word and you can embed

221
00:07:49,759 --> 00:07:52,400
a windows media player and i noticed you

222
00:07:52,400 --> 00:07:53,520
know if i take a doc

223
00:07:53,520 --> 00:07:55,680
and i embed windows media player into it

224
00:07:55,680 --> 00:07:56,720
like you get

225
00:07:56,720 --> 00:07:59,039
this you know security warning saying

226
00:07:59,039 --> 00:08:00,000
hey

227
00:08:00,000 --> 00:08:03,039
some of this content is disabled um and

228
00:08:03,039 --> 00:08:04,800
the actual picture that you see there

229
00:08:04,800 --> 00:08:06,639
that that windows media player that was

230
00:08:06,639 --> 00:08:08,960
the windows media player on the version

231
00:08:08,960 --> 00:08:11,039
of windows that i used to construct the

232
00:08:11,039 --> 00:08:12,639
document

233
00:08:12,639 --> 00:08:16,319
um not the actual version of windows

234
00:08:16,319 --> 00:08:18,240
media player on the one that i used to

235
00:08:18,240 --> 00:08:19,759
view this document so that basically

236
00:08:19,759 --> 00:08:21,039
it's like they're they're doing some

237
00:08:21,039 --> 00:08:22,960
things to protect you as a viewer of

238
00:08:22,960 --> 00:08:24,479
this document

239
00:08:24,479 --> 00:08:26,319
what i also mentioned so i'm just kind

240
00:08:26,319 --> 00:08:27,759
of saying yeah i'm guessing at some

241
00:08:27,759 --> 00:08:29,440
point microsoft realized that

242
00:08:29,440 --> 00:08:31,039
you know you can't just you shouldn't be

243
00:08:31,039 --> 00:08:32,719
able to just embed objects without

244
00:08:32,719 --> 00:08:33,679
prompting

245
00:08:33,679 --> 00:08:36,320
let's take this exact same file and save

246
00:08:36,320 --> 00:08:37,440
it as an rtf

247
00:08:37,440 --> 00:08:39,360
so here we've got the rtf version of it

248
00:08:39,360 --> 00:08:40,880
and wait

249
00:08:40,880 --> 00:08:43,519
that windows media player is the actual

250
00:08:43,519 --> 00:08:45,440
version of windows media player

251
00:08:45,440 --> 00:08:47,680
on my system so it's actually running it

252
00:08:47,680 --> 00:08:50,160
all i did is i opened up an rtf

253
00:08:50,160 --> 00:08:54,560
um it's running the code in that object

254
00:08:54,560 --> 00:08:56,080
and i mentioned i was like well so if

255
00:08:56,080 --> 00:08:58,560
you take the steps to restrict a

256
00:08:58,560 --> 00:08:59,360
document

257
00:08:59,360 --> 00:09:02,320
from just running an embedded object you

258
00:09:02,320 --> 00:09:04,080
should probably do the same thing in rtf

259
00:09:04,080 --> 00:09:05,040
right

260
00:09:05,040 --> 00:09:08,720
this is november 10th 2016.

261
00:09:08,720 --> 00:09:12,000
five what five and a half years ago

262
00:09:12,000 --> 00:09:15,279
anyway uh i didn't get any answer and

263
00:09:15,279 --> 00:09:16,880
then i like dug a little bit deeper you

264
00:09:16,880 --> 00:09:18,640
know about ten days later i was like hey

265
00:09:18,640 --> 00:09:20,640
you know like this might actually be a

266
00:09:20,640 --> 00:09:21,279
problem

267
00:09:21,279 --> 00:09:24,160
um you know if i have a com object that

268
00:09:24,160 --> 00:09:26,320
doesn't opt into aslr somebody could use

269
00:09:26,320 --> 00:09:28,399
that as an aslr bypass they could use

270
00:09:28,399 --> 00:09:29,839
rop and they could basically write an

271
00:09:29,839 --> 00:09:31,200
exploit for it

272
00:09:31,200 --> 00:09:33,600
um it's possible that like there's

273
00:09:33,600 --> 00:09:35,120
certain com objects that can cause a

274
00:09:35,120 --> 00:09:36,000
crash like back

275
00:09:36,000 --> 00:09:38,320
in the i hope the horrible ie6 days

276
00:09:38,320 --> 00:09:39,680
there's certain objects that just

277
00:09:39,680 --> 00:09:41,920
referencing that causes a crash

278
00:09:41,920 --> 00:09:43,600
um the other thing that i did for kind

279
00:09:43,600 --> 00:09:45,200
of testing is i

280
00:09:45,200 --> 00:09:47,920
use the concept of an evil com object

281
00:09:47,920 --> 00:09:49,600
just for my own testing i wrote a comm

282
00:09:49,600 --> 00:09:50,000
object

283
00:09:50,000 --> 00:09:52,480
that basically spawns calc.exe when it's

284
00:09:52,480 --> 00:09:53,600
initialized

285
00:09:53,600 --> 00:09:55,440
just so that when i'm testing these

286
00:09:55,440 --> 00:09:58,560
sorts of environment

287
00:09:58,640 --> 00:10:01,040
nothing bad happens i mean that's that's

288
00:10:01,040 --> 00:10:02,800
the standard sort of security researcher

289
00:10:02,800 --> 00:10:04,079
mindset is if you ever see

290
00:10:04,079 --> 00:10:07,440
calc pop up like i hope you

291
00:10:07,440 --> 00:10:09,920
actually intended to run calc or

292
00:10:09,920 --> 00:10:10,560
something

293
00:10:10,560 --> 00:10:12,399
some sort of shenanigans are going on so

294
00:10:12,399 --> 00:10:14,079
microsoft's response

295
00:10:14,079 --> 00:10:15,600
they said well the difference between

296
00:10:15,600 --> 00:10:18,560
doc and rtf it is not an indicator of a

297
00:10:18,560 --> 00:10:19,519
difference with how

298
00:10:19,519 --> 00:10:22,079
word handles the control uh we will

299
00:10:22,079 --> 00:10:25,120
proceed with closing this case

300
00:10:25,120 --> 00:10:28,560
and that was november 28th 2016 right so

301
00:10:28,560 --> 00:10:30,240
i'm like uh whatever i'm

302
00:10:30,240 --> 00:10:31,839
busy enough with like a lot of the

303
00:10:31,839 --> 00:10:33,200
things that i'm doing at work that i

304
00:10:33,200 --> 00:10:34,880
easily get distracted and i start

305
00:10:34,880 --> 00:10:37,279
working on other stuff so

306
00:10:37,279 --> 00:10:40,160
uh every now and then you get reminded

307
00:10:40,160 --> 00:10:42,320
of certain things

308
00:10:42,320 --> 00:10:45,120
so there was a researcher trying to

309
00:10:45,120 --> 00:10:46,320
think of when this was a couple

310
00:10:46,320 --> 00:10:49,360
couple months ago i think maybe uh jonas

311
00:10:49,360 --> 00:10:51,279
l had mentioned hey there's this global

312
00:10:51,279 --> 00:10:53,480
root path and if you ever

313
00:10:53,480 --> 00:10:56,880
reference that path

314
00:10:56,880 --> 00:10:59,279
it will crash windows and i started

315
00:10:59,279 --> 00:11:00,959
thinking i was like wait

316
00:11:00,959 --> 00:11:04,160
when i was messing with rtfs

317
00:11:04,160 --> 00:11:06,079
uh there was an aspect of that where you

318
00:11:06,079 --> 00:11:08,079
could like reference where that object

319
00:11:08,079 --> 00:11:10,000
was hosted like you can have an rtf

320
00:11:10,000 --> 00:11:12,240
word or a document that ref that

321
00:11:12,240 --> 00:11:14,079
references a locally stored object or it

322
00:11:14,079 --> 00:11:16,079
could be a remotely stored object

323
00:11:16,079 --> 00:11:19,600
um so i tried well what if i take an rtf

324
00:11:19,600 --> 00:11:22,480
and here i call it doc but whatever i'm

325
00:11:22,480 --> 00:11:23,600
opening it in

326
00:11:23,600 --> 00:11:26,959
outlook uh my favorite email program oh

327
00:11:26,959 --> 00:11:30,320
wait all i did there is i

328
00:11:30,320 --> 00:11:33,360
previewed a document and now my whole

329
00:11:33,360 --> 00:11:34,959
computer's crashed

330
00:11:34,959 --> 00:11:38,800
that's bad so that got me thinking a

331
00:11:38,800 --> 00:11:40,560
little bit well let's let's revisit

332
00:11:40,560 --> 00:11:42,640
like rtf in word and what what can you

333
00:11:42,640 --> 00:11:45,440
do with com objects

334
00:11:45,440 --> 00:11:47,600
so as i'm like looking for like you know

335
00:11:47,600 --> 00:11:49,040
i'm trying to figure out what's the best

336
00:11:49,040 --> 00:11:50,880
way that i can construct an rtf i want

337
00:11:50,880 --> 00:11:52,560
to do it programmatically because i want

338
00:11:52,560 --> 00:11:53,600
to like generate

339
00:11:53,600 --> 00:11:55,279
for all com objects i don't want to have

340
00:11:55,279 --> 00:11:57,440
to use the word interface

341
00:11:57,440 --> 00:12:01,040
um i actually found this is text from a

342
00:12:01,040 --> 00:12:02,800
google project zero report

343
00:12:02,800 --> 00:12:05,040
to microsoft and they say hey you can do

344
00:12:05,040 --> 00:12:08,480
a dll planting attack which is basically

345
00:12:08,480 --> 00:12:10,000
a dll gets loaded from the current

346
00:12:10,000 --> 00:12:11,839
directory um

347
00:12:11,839 --> 00:12:13,600
and they had mentioned here it's also so

348
00:12:13,600 --> 00:12:15,920
the original report is about a document

349
00:12:15,920 --> 00:12:17,760
they say it's also possible to trigger

350
00:12:17,760 --> 00:12:20,240
it with an rtf document and they say

351
00:12:20,240 --> 00:12:23,279
without a user click

352
00:12:23,279 --> 00:12:26,079
and this was october 21 2015. so all

353
00:12:26,079 --> 00:12:26,720
this stuff

354
00:12:26,720 --> 00:12:28,720
that i'm talking about right now is

355
00:12:28,720 --> 00:12:32,240
essentially public since 2015.

356
00:12:32,240 --> 00:12:34,800
none of this is cutting edge zero day

357
00:12:34,800 --> 00:12:36,000
sort of stuff but

358
00:12:36,000 --> 00:12:38,079
there are current behaviors that are

359
00:12:38,079 --> 00:12:39,839
kind of surprising

360
00:12:39,839 --> 00:12:42,480
um on december 8th they closed it

361
00:12:42,480 --> 00:12:45,480
microsoft published cv 2015

362
00:12:45,480 --> 00:12:48,959
6128 and they disabled this one

363
00:12:48,959 --> 00:12:52,160
particular com object and problem

364
00:12:52,160 --> 00:12:55,440
solved uh we fixed it hey everybody

365
00:12:55,440 --> 00:12:55,839
let's

366
00:12:55,839 --> 00:12:59,519
celebrate but based on this google

367
00:12:59,519 --> 00:13:01,360
project zero report i actually

368
00:13:01,360 --> 00:13:03,360
now have a template for creating my own

369
00:13:03,360 --> 00:13:05,040
rtfs

370
00:13:05,040 --> 00:13:06,800
i added some line feeds here just to

371
00:13:06,800 --> 00:13:08,639
make it a little bit more readable as to

372
00:13:08,639 --> 00:13:09,279
like

373
00:13:09,279 --> 00:13:12,399
you know what is representing what um

374
00:13:12,399 --> 00:13:14,079
the only thing that really matters here

375
00:13:14,079 --> 00:13:15,600
is the part that's in yellow and that's

376
00:13:15,600 --> 00:13:17,040
the class id for a com

377
00:13:17,040 --> 00:13:20,399
object what do we do let's just

378
00:13:20,399 --> 00:13:22,000
make them all let's take our window

379
00:13:22,000 --> 00:13:24,639
system and let's make all of the rtfs

380
00:13:24,639 --> 00:13:28,000
this is a subset of a python script

381
00:13:28,000 --> 00:13:30,240
in the end it will give you just like a

382
00:13:30,240 --> 00:13:32,639
directory full of rtf documents

383
00:13:32,639 --> 00:13:34,880
each one is named for the class id that

384
00:13:34,880 --> 00:13:37,600
it tries to instantiate

385
00:13:37,600 --> 00:13:39,360
so i've got like i don't know six

386
00:13:39,360 --> 00:13:40,639
thousand

387
00:13:40,639 --> 00:13:42,720
this is just a stock windows system with

388
00:13:42,720 --> 00:13:44,480
office and i've got about six thousand

389
00:13:44,480 --> 00:13:45,600
um com objects

390
00:13:45,600 --> 00:13:48,480
six thousand rtf documents here's

391
00:13:48,480 --> 00:13:50,320
another tool that we released that can

392
00:13:50,320 --> 00:13:51,120
actually help

393
00:13:51,120 --> 00:13:53,600
us automate that and that's cert bff and

394
00:13:53,600 --> 00:13:54,160
that's our

395
00:13:54,160 --> 00:13:57,360
basic fuzzing framework i basically

396
00:13:57,360 --> 00:13:59,600
specify my target that i want to run

397
00:13:59,600 --> 00:14:01,360
and i specify the mode that i want to

398
00:14:01,360 --> 00:14:03,040
run the fuzzer in and in this particular

399
00:14:03,040 --> 00:14:04,079
case i don't care about

400
00:14:04,079 --> 00:14:06,240
fuzzing the documents i just want to

401
00:14:06,240 --> 00:14:07,519
open them

402
00:14:07,519 --> 00:14:09,600
so verify mode all it does is it takes

403
00:14:09,600 --> 00:14:11,440
each seed file that you have and it will

404
00:14:11,440 --> 00:14:15,040
try to open it and just see what happens

405
00:14:15,040 --> 00:14:18,399
so i had noticed that some crash um bff

406
00:14:18,399 --> 00:14:20,240
will put it in the bang exploitable

407
00:14:20,240 --> 00:14:23,279
uh uh categorization of these and i can

408
00:14:23,279 --> 00:14:26,000
see all right probably not exploitable

409
00:14:26,000 --> 00:14:29,600
read access violation near null

410
00:14:29,600 --> 00:14:31,519
i don't really care that's it's way

411
00:14:31,519 --> 00:14:33,920
different than the ie6 days where it's

412
00:14:33,920 --> 00:14:34,800
like hey

413
00:14:34,800 --> 00:14:36,800
i've got an access violation trying to

414
00:14:36,800 --> 00:14:38,320
execute code at an

415
00:14:38,320 --> 00:14:40,480
address that i can get to these are like

416
00:14:40,480 --> 00:14:41,519
kind of shrug worthy

417
00:14:41,519 --> 00:14:43,600
but still i've got rtfs that if i just

418
00:14:43,600 --> 00:14:47,760
open the rtf it'll cause word to crash

419
00:14:47,839 --> 00:14:50,880
um every now and then i send out

420
00:14:50,880 --> 00:14:53,680
tweets about things um this was in

421
00:14:53,680 --> 00:14:55,519
response to swifton security mentioned

422
00:14:55,519 --> 00:14:57,199
something about process monitor

423
00:14:57,199 --> 00:14:59,120
and i had basically said you know

424
00:14:59,120 --> 00:15:00,959
process monitor is great for problem

425
00:15:00,959 --> 00:15:02,000
solving

426
00:15:02,000 --> 00:15:04,720
but actually i can't even count the

427
00:15:04,720 --> 00:15:06,480
number of vulnerabilities that i found

428
00:15:06,480 --> 00:15:09,519
using nothing but process monitor

429
00:15:09,519 --> 00:15:11,519
in this case it's bff plus process

430
00:15:11,519 --> 00:15:13,199
monitor but there's a whole slew of ones

431
00:15:13,199 --> 00:15:14,480
all you have to do is look at what a

432
00:15:14,480 --> 00:15:16,000
system is doing and

433
00:15:16,000 --> 00:15:17,360
quite often you'll see things that are

434
00:15:17,360 --> 00:15:20,240
like yeah that's bad

435
00:15:20,240 --> 00:15:21,519
so what do we do with our process

436
00:15:21,519 --> 00:15:23,680
monitor filter um

437
00:15:23,680 --> 00:15:25,440
kind of along the lines of that dll

438
00:15:25,440 --> 00:15:27,519
hijacking attack i wanted to look

439
00:15:27,519 --> 00:15:30,560
for um words

440
00:15:30,560 --> 00:15:32,399
trying to load files that didn't exist

441
00:15:32,399 --> 00:15:34,160
so i just basically set a filter with

442
00:15:34,160 --> 00:15:35,680
two different things you know

443
00:15:35,680 --> 00:15:38,560
if the result contains no such or uh not

444
00:15:38,560 --> 00:15:39,360
found then just

445
00:15:39,360 --> 00:15:42,880
tell me what's there uh so let's look at

446
00:15:42,880 --> 00:15:43,839
what happens

447
00:15:43,839 --> 00:15:45,440
you know basically you run through the

448
00:15:45,440 --> 00:15:48,639
bff routine it opens your 6000 documents

449
00:15:48,639 --> 00:15:52,000
if process monitor is running while that

450
00:15:52,000 --> 00:15:55,680
uh campaign is go

451
00:15:55,680 --> 00:15:58,399
it's kind of like all things that um are

452
00:15:58,399 --> 00:16:00,320
unexpected and these are basically

453
00:16:00,320 --> 00:16:02,000
unexpected file loads that i'm dealing

454
00:16:02,000 --> 00:16:05,120
with so let's look at the first one here

455
00:16:05,120 --> 00:16:07,920
um this is from a product called lotus

456
00:16:07,920 --> 00:16:08,720
notes

457
00:16:08,720 --> 00:16:11,519
which one might laugh and say well

458
00:16:11,519 --> 00:16:12,880
honestly like who's running

459
00:16:12,880 --> 00:16:15,759
lotus notes these days i will admit that

460
00:16:15,759 --> 00:16:16,880
one year ago today

461
00:16:16,880 --> 00:16:19,519
cert was using lotus notes in order to

462
00:16:19,519 --> 00:16:21,360
write up our ball notes and manage all

463
00:16:21,360 --> 00:16:22,000
of our tickets

464
00:16:22,000 --> 00:16:25,040
and doing everything so yeah we love

465
00:16:25,040 --> 00:16:27,360
living in the past

466
00:16:27,360 --> 00:16:30,160
so here we can see your path um this has

467
00:16:30,160 --> 00:16:32,000
got an in-proc server 32 which is

468
00:16:32,000 --> 00:16:34,000
basically like a library that word will

469
00:16:34,000 --> 00:16:34,480
load

470
00:16:34,480 --> 00:16:37,920
into the process space when um

471
00:16:37,920 --> 00:16:39,920
a document tries to reference it so this

472
00:16:39,920 --> 00:16:41,279
what's on the screen right now is the

473
00:16:41,279 --> 00:16:42,720
actual rtf

474
00:16:42,720 --> 00:16:45,040
um that stop the stuff at the very top

475
00:16:45,040 --> 00:16:47,040
is basically like text that i just have

476
00:16:47,040 --> 00:16:49,040
in the rtf just so i can look at it and

477
00:16:49,040 --> 00:16:50,079
then there's after that

478
00:16:50,079 --> 00:16:52,399
it's referencing the class id what

479
00:16:52,399 --> 00:16:54,399
happens when we now open up this word

480
00:16:54,399 --> 00:16:54,959
document

481
00:16:54,959 --> 00:16:57,040
again we use our favorite friend process

482
00:16:57,040 --> 00:16:58,079
monitor

483
00:16:58,079 --> 00:16:59,920
and i could see this is a document that

484
00:16:59,920 --> 00:17:02,000
i happen to have in my bff directory and

485
00:17:02,000 --> 00:17:02,880
i can see

486
00:17:02,880 --> 00:17:05,359
just by double clicking on this rtf it

487
00:17:05,359 --> 00:17:08,520
tries to load a dll called

488
00:17:08,520 --> 00:17:10,480
ndb2key.dll now

489
00:17:10,480 --> 00:17:12,160
i don't necessarily know why it's

490
00:17:12,160 --> 00:17:14,319
loading that but if i see a dll being

491
00:17:14,319 --> 00:17:17,679
loaded then or attempted to be loaded um

492
00:17:17,679 --> 00:17:19,679
that's suspicious

493
00:17:19,679 --> 00:17:22,160
so let's actually plant that dll there

494
00:17:22,160 --> 00:17:23,919
so here i just placed in this case i

495
00:17:23,919 --> 00:17:25,199
moved it to temp slash

496
00:17:25,199 --> 00:17:28,079
interesting but i created a dll that

497
00:17:28,079 --> 00:17:28,559
just

498
00:17:28,559 --> 00:17:32,160
launches calc and well there we go

499
00:17:32,160 --> 00:17:35,039
there's windward creating a calc.exe

500
00:17:35,039 --> 00:17:36,000
process

501
00:17:36,000 --> 00:17:38,400
what to trigger that it's just an rtf

502
00:17:38,400 --> 00:17:40,559
that references a class id

503
00:17:40,559 --> 00:17:43,840
nothing more nothing more let's

504
00:17:43,840 --> 00:17:45,440
dig a little bit deeper here's a

505
00:17:45,440 --> 00:17:47,919
component that comes with a particular

506
00:17:47,919 --> 00:17:52,320
python package called pi win32

507
00:17:52,320 --> 00:17:54,799
here it doesn't specify a full path but

508
00:17:54,799 --> 00:17:56,559
maybe that's good enough because it's in

509
00:17:56,559 --> 00:17:58,320
a system-wide path

510
00:17:58,320 --> 00:18:00,000
but it's just called python comm loader

511
00:18:00,000 --> 00:18:01,840
27.

512
00:18:01,840 --> 00:18:03,520
here's a little bit different i can see

513
00:18:03,520 --> 00:18:04,960
at the top there it's it's trying to

514
00:18:04,960 --> 00:18:07,039
load something from slash lib

515
00:18:07,039 --> 00:18:09,440
which on the windows platform is sql and

516
00:18:09,440 --> 00:18:10,320
slash lib

517
00:18:10,320 --> 00:18:13,039
so that doesn't exist here i can see in

518
00:18:13,039 --> 00:18:14,480
this case i'm loading it from the seed

519
00:18:14,480 --> 00:18:16,000
files directory it tries to load a

520
00:18:16,000 --> 00:18:19,760
python script called site customize.pi

521
00:18:19,760 --> 00:18:22,000
let's try placing our own python file

522
00:18:22,000 --> 00:18:23,600
there uh two lines

523
00:18:23,600 --> 00:18:26,720
import os os.systemcalc

524
00:18:26,720 --> 00:18:29,840
see what happens we open up our document

525
00:18:29,840 --> 00:18:33,760
it sees site customize and now i can see

526
00:18:33,760 --> 00:18:36,240
there's my calc.exe similar sort of

527
00:18:36,240 --> 00:18:38,880
thing all i'm doing is opening an rtf

528
00:18:38,880 --> 00:18:41,200
reference is a class id and now i've got

529
00:18:41,200 --> 00:18:43,600
code execution

530
00:18:43,600 --> 00:18:45,520
now this python script i mean i'm just

531
00:18:45,520 --> 00:18:47,520
doing os dot system calc i could do

532
00:18:47,520 --> 00:18:49,200
something a little bit more

533
00:18:49,200 --> 00:18:51,360
interesting if i wanted but you know

534
00:18:51,360 --> 00:18:53,520
like i said security researchers stop at

535
00:18:53,520 --> 00:18:56,559
popping calc um

536
00:18:56,559 --> 00:18:57,919
so that's enough to show that there's

537
00:18:57,919 --> 00:18:59,760
something of interest here now here's

538
00:18:59,760 --> 00:19:01,200
another one this one was a little bit

539
00:19:01,200 --> 00:19:02,080
more interesting

540
00:19:02,080 --> 00:19:04,400
it kind of peaked my curiosity a little

541
00:19:04,400 --> 00:19:05,760
bit more

542
00:19:05,760 --> 00:19:07,840
um here's something that comes with

543
00:19:07,840 --> 00:19:10,880
microsoft office click to run and it's

544
00:19:10,880 --> 00:19:13,520
from system 32 it's trying to load an

545
00:19:13,520 --> 00:19:14,960
exe which is

546
00:19:14,960 --> 00:19:17,600
rather than in proc server 32 this is

547
00:19:17,600 --> 00:19:19,679
using local server 32 which means it's

548
00:19:19,679 --> 00:19:21,520
an actual executable

549
00:19:21,520 --> 00:19:24,720
that provides the com object does all

550
00:19:24,720 --> 00:19:27,440
the dirty work

551
00:19:27,600 --> 00:19:30,960
when i load this document from the temp

552
00:19:30,960 --> 00:19:32,000
directory it

553
00:19:32,000 --> 00:19:36,240
looks for a file called.exe

554
00:19:36,240 --> 00:19:38,240
that's like even more interesting than a

555
00:19:38,240 --> 00:19:39,919
dll like

556
00:19:39,919 --> 00:19:42,880
why would we be looking for or sorry why

557
00:19:42,880 --> 00:19:45,919
would windows be looking for an exe file

558
00:19:45,919 --> 00:19:49,520
um if not to run it

559
00:19:49,520 --> 00:19:52,880
let's try it let's place

560
00:19:52,880 --> 00:19:55,760
a file called.exe in this case i i just

561
00:19:55,760 --> 00:19:58,160
copied calc.exe and i can see based on

562
00:19:58,160 --> 00:20:00,000
the icon there yeah okay

563
00:20:00,000 --> 00:20:04,000
it's running that file called.exe

564
00:20:04,000 --> 00:20:06,000
let's look a little bit deeper into like

565
00:20:06,000 --> 00:20:10,720
this com object server this local server

566
00:20:11,000 --> 00:20:12,720
vdsldr.exe

567
00:20:12,720 --> 00:20:14,960
um if i go into the registry i can see

568
00:20:14,960 --> 00:20:16,799
okay um

569
00:20:16,799 --> 00:20:20,880
system32 vd sldr

570
00:20:20,880 --> 00:20:23,440
it happens to be in wow 6432 node so

571
00:20:23,440 --> 00:20:24,640
that basically means

572
00:20:24,640 --> 00:20:27,120
this is a 32-bit app and when a 32-bit

573
00:20:27,120 --> 00:20:28,559
app asks for

574
00:20:28,559 --> 00:20:31,280
system 32 it's going to give it a little

575
00:20:31,280 --> 00:20:32,799
bit of a different directory it'll give

576
00:20:32,799 --> 00:20:35,200
it syswise64.

577
00:20:35,200 --> 00:20:38,400
let's look at that file

578
00:20:39,200 --> 00:20:42,400
it's not there

579
00:20:43,600 --> 00:20:48,320
how is it that a com object server

580
00:20:48,320 --> 00:20:51,679
can cause windows to look for exe but

581
00:20:51,679 --> 00:20:53,039
the com object server

582
00:20:53,039 --> 00:20:57,520
isn't actually there

583
00:20:57,520 --> 00:20:59,760
so i dug a little bit deeper and i

584
00:20:59,760 --> 00:21:01,520
realized well it's actually nothing

585
00:21:01,520 --> 00:21:02,000
about that

586
00:21:02,000 --> 00:21:05,120
particular com object that is at fault

587
00:21:05,120 --> 00:21:08,480
um i just created a class id deadbeef

588
00:21:08,480 --> 00:21:10,320
and then i had this i basically said the

589
00:21:10,320 --> 00:21:12,960
local server is sql slash does not exist

590
00:21:12,960 --> 00:21:14,240
dot exe

591
00:21:14,240 --> 00:21:15,679
let's look at what happens when i open

592
00:21:15,679 --> 00:21:17,679
the rtf it looks to see okay is c

593
00:21:17,679 --> 00:21:20,640
colon does not exist dot exe is it there

594
00:21:20,640 --> 00:21:23,039
no it's not there

595
00:21:23,039 --> 00:21:24,960
i'm going to try harder if c colon slash

596
00:21:24,960 --> 00:21:26,880
does not exist dot exe is there what

597
00:21:26,880 --> 00:21:27,360
about

598
00:21:27,360 --> 00:21:31,280
sql does not exist.exe dash embedding

599
00:21:31,280 --> 00:21:36,720
now is it there still not there

600
00:21:36,720 --> 00:21:40,080
i give up i'm just going to run.exe

601
00:21:40,080 --> 00:21:42,799
why not look a little bit deeper into

602
00:21:42,799 --> 00:21:44,720
the calls trace and this is all from

603
00:21:44,720 --> 00:21:46,000
process monitor or

604
00:21:46,000 --> 00:21:49,039
process monitor it's a great tool

605
00:21:49,039 --> 00:21:50,799
based on any activity that happens on

606
00:21:50,799 --> 00:21:52,240
windows i can look at the call

607
00:21:52,240 --> 00:21:55,679
stack and see okay well what led to me

608
00:21:55,679 --> 00:21:57,360
doing this and i can see okay this is

609
00:21:57,360 --> 00:21:58,960
microsoft click to run

610
00:21:58,960 --> 00:22:00,720
it's the way that they package office

611
00:22:00,720 --> 00:22:02,000
recently

612
00:22:02,000 --> 00:22:06,240
um this actually was just addressed last

613
00:22:06,240 --> 00:22:06,960
week

614
00:22:06,960 --> 00:22:10,080
uh march 9th 2021 i think that was a

615
00:22:10,080 --> 00:22:12,320
week and a day ago um

616
00:22:12,320 --> 00:22:14,960
they give me credit yeah let's celebrate

617
00:22:14,960 --> 00:22:15,679
um

618
00:22:15,679 --> 00:22:17,440
so they addressed the one variant that

619
00:22:17,440 --> 00:22:19,840
i've demonstrated so far where

620
00:22:19,840 --> 00:22:21,840
windows or microsoft word will try to

621
00:22:21,840 --> 00:22:24,720
run exe

622
00:22:24,720 --> 00:22:26,880
they didn't change anything else about

623
00:22:26,880 --> 00:22:28,640
how microsoft office

624
00:22:28,640 --> 00:22:30,320
operates it will still try to

625
00:22:30,320 --> 00:22:31,840
instantiate any com

626
00:22:31,840 --> 00:22:34,480
object when you open an rtf document so

627
00:22:34,480 --> 00:22:35,600
they basically

628
00:22:35,600 --> 00:22:37,679
rather than addressing the class of a

629
00:22:37,679 --> 00:22:39,120
problem saying hey you probably

630
00:22:39,120 --> 00:22:40,159
shouldn't instantiate

631
00:22:40,159 --> 00:22:42,240
com objects without you know maybe

632
00:22:42,240 --> 00:22:44,400
asking the user

633
00:22:44,400 --> 00:22:45,919
rather than addressing the class of

634
00:22:45,919 --> 00:22:47,360
vulnerabilities they said you know what

635
00:22:47,360 --> 00:22:48,559
i'm going to solve this

636
00:22:48,559 --> 00:22:51,440
i'm going to fix just that one com

637
00:22:51,440 --> 00:22:52,000
object

638
00:22:52,000 --> 00:22:54,400
or that one class of com object for a

639
00:22:54,400 --> 00:22:55,919
thing that doesn't exist

640
00:22:55,919 --> 00:22:57,840
so let's look at attack vectors one one

641
00:22:57,840 --> 00:22:59,600
of the things that we do

642
00:22:59,600 --> 00:23:04,480
as like a vulnerability analyst is

643
00:23:04,480 --> 00:23:05,840
we want to look okay you find the

644
00:23:05,840 --> 00:23:07,280
underlying vulnerabilities what are the

645
00:23:07,280 --> 00:23:08,400
ways that you can trigger that

646
00:23:08,400 --> 00:23:10,080
vulnerability so let's look at a couple

647
00:23:10,080 --> 00:23:10,960
ways that you can

648
00:23:10,960 --> 00:23:16,480
trigger um an rtf document

649
00:23:16,559 --> 00:23:20,320
um and the general idea for this whole

650
00:23:20,320 --> 00:23:22,559
class of issues is you you have a same

651
00:23:22,559 --> 00:23:24,720
file you have a malicious file in the

652
00:23:24,720 --> 00:23:26,799
same directory as the document that

653
00:23:26,799 --> 00:23:28,159
you're trying to open up so

654
00:23:28,159 --> 00:23:29,600
that's the general thing that we're

655
00:23:29,600 --> 00:23:31,440
trying to achieve uh

656
00:23:31,440 --> 00:23:33,679
the very simplest way is like well what

657
00:23:33,679 --> 00:23:36,320
if you just put it on a network share

658
00:23:36,320 --> 00:23:39,120
like an smb link it's very simple it's

659
00:23:39,120 --> 00:23:41,360
not practical because i don't

660
00:23:41,360 --> 00:23:43,360
i probably don't use computers in the

661
00:23:43,360 --> 00:23:45,440
way that most people use computers but i

662
00:23:45,440 --> 00:23:46,080
don't

663
00:23:46,080 --> 00:23:50,000
often visit smb servers that like i

664
00:23:50,000 --> 00:23:50,720
don't

665
00:23:50,720 --> 00:23:54,640
trust although if it's a shared work

666
00:23:54,640 --> 00:23:57,039
network share and every person in the

667
00:23:57,039 --> 00:23:58,960
company is using that then yeah

668
00:23:58,960 --> 00:24:00,799
i'd probably be skeptical about opening

669
00:24:00,799 --> 00:24:02,320
stuff up direct from it

670
00:24:02,320 --> 00:24:04,400
so let's look at this uh let's take our

671
00:24:04,400 --> 00:24:06,080
windows xp

672
00:24:06,080 --> 00:24:09,679
um looks like i made this just one month

673
00:24:09,679 --> 00:24:11,520
ago so this is timely

674
00:24:11,520 --> 00:24:13,679
uh so what am i gonna do i'm gonna run

675
00:24:13,679 --> 00:24:15,840
and i'm going to go to slash slash

676
00:24:15,840 --> 00:24:18,880
attacker smb okay here's my

677
00:24:18,880 --> 00:24:22,310
lol rtf i'm going to click on it and

678
00:24:22,310 --> 00:24:24,559
[Music]

679
00:24:24,559 --> 00:24:30,080
there's my windows xp version of calc

680
00:24:30,720 --> 00:24:32,080
didn't i just say that there needed to

681
00:24:32,080 --> 00:24:33,840
be another file in that same directory

682
00:24:33,840 --> 00:24:35,760
well there is but windows

683
00:24:35,760 --> 00:24:38,640
very helpfully by default will hide

684
00:24:38,640 --> 00:24:40,320
files that say that they want to be

685
00:24:40,320 --> 00:24:41,600
hidden

686
00:24:41,600 --> 00:24:43,840
um so the default behavior with windows

687
00:24:43,840 --> 00:24:45,360
is

688
00:24:45,360 --> 00:24:47,279
anything that like says that it's hidden

689
00:24:47,279 --> 00:24:48,880
like it just won't show it to you

690
00:24:48,880 --> 00:24:50,400
kind of in the same way that it doesn't

691
00:24:50,400 --> 00:24:52,559
show you the file extension

692
00:24:52,559 --> 00:24:55,440
uh because microsoft has decided that

693
00:24:55,440 --> 00:24:56,799
this makes people

694
00:24:56,799 --> 00:25:00,880
um makes it easier to use windows

695
00:25:00,880 --> 00:25:03,919
i don't know uh security folks have

696
00:25:03,919 --> 00:25:04,400
different

697
00:25:04,400 --> 00:25:06,720
expectations as to what is reasonable

698
00:25:06,720 --> 00:25:07,600
versus like

699
00:25:07,600 --> 00:25:11,039
the real world unwashed masses

700
00:25:11,039 --> 00:25:14,960
um another thing that i ran into um

701
00:25:14,960 --> 00:25:16,880
this is a thing that i've you know

702
00:25:16,880 --> 00:25:18,799
talking about like what security people

703
00:25:18,799 --> 00:25:20,159
think is reasonable and what

704
00:25:20,159 --> 00:25:22,400
regular people think is reasonable i've

705
00:25:22,400 --> 00:25:24,480
noticed any browser based on chromium

706
00:25:24,480 --> 00:25:26,400
it will automatically download a file

707
00:25:26,400 --> 00:25:29,600
without asking you

708
00:25:29,600 --> 00:25:32,480
i thought that that was odd and i told

709
00:25:32,480 --> 00:25:34,320
google about it years ago and they said

710
00:25:34,320 --> 00:25:36,720
no we need that

711
00:25:36,720 --> 00:25:38,320
if you visit a website with a

712
00:25:38,320 --> 00:25:40,320
chromium-based browser it's possible

713
00:25:40,320 --> 00:25:42,320
that that website could plant

714
00:25:42,320 --> 00:25:44,720
on your hard drive a file without you

715
00:25:44,720 --> 00:25:46,159
even knowing about it

716
00:25:46,159 --> 00:25:47,600
now maybe if you look at it or you're

717
00:25:47,600 --> 00:25:48,960
paying close attention because you're

718
00:25:48,960 --> 00:25:50,720
aware of your surroundings

719
00:25:50,720 --> 00:25:55,039
maybe you'll notice one thing about this

720
00:25:57,600 --> 00:26:01,039
um and also in order for this file to be

721
00:26:01,039 --> 00:26:02,799
downloaded without prompting

722
00:26:02,799 --> 00:26:04,960
chrome has to consider it safe there's a

723
00:26:04,960 --> 00:26:06,159
whole lot of things that it'll still

724
00:26:06,159 --> 00:26:08,400
download so here we've got a video

725
00:26:08,400 --> 00:26:10,159
um and this basically rather than

726
00:26:10,159 --> 00:26:11,840
viewing an smb location i'm just going

727
00:26:11,840 --> 00:26:12,840
to

728
00:26:12,840 --> 00:26:16,080
attacker.example.com now notice i just

729
00:26:16,080 --> 00:26:17,600
visited the website and it already

730
00:26:17,600 --> 00:26:20,000
planted a pyc file

731
00:26:20,000 --> 00:26:23,039
okay now okay i want this rtf document i

732
00:26:23,039 --> 00:26:25,679
open it one thing that's interesting

733
00:26:25,679 --> 00:26:26,240
here is

734
00:26:26,240 --> 00:26:28,159
office opens in protected view i click

735
00:26:28,159 --> 00:26:29,360
enable editing

736
00:26:29,360 --> 00:26:31,840
and oops i own it.text something

737
00:26:31,840 --> 00:26:33,279
something really bad happened there

738
00:26:33,279 --> 00:26:36,840
so yeah it requires a little bit of user

739
00:26:36,840 --> 00:26:38,400
interaction

740
00:26:38,400 --> 00:26:40,080
let's consider another popular web

741
00:26:40,080 --> 00:26:41,919
browser firefox

742
00:26:41,919 --> 00:26:45,279
um if the target platform has office

743
00:26:45,279 --> 00:26:47,520
2013 or earlier if you have

744
00:26:47,520 --> 00:26:50,080
a document that has an embedded package

745
00:26:50,080 --> 00:26:50,720
in it

746
00:26:50,720 --> 00:26:51,840
and that's basically you know if you

747
00:26:51,840 --> 00:26:54,240
have a document and you drag calc.exe

748
00:26:54,240 --> 00:26:54,880
into it or

749
00:26:54,880 --> 00:26:57,440
do whatever um it stores it as a package

750
00:26:57,440 --> 00:26:58,559
object

751
00:26:58,559 --> 00:27:01,840
with office 2013 or earlier it will

752
00:27:01,840 --> 00:27:03,440
when you open that document it'll

753
00:27:03,440 --> 00:27:06,000
automatically extract those to your

754
00:27:06,000 --> 00:27:09,520
temp environment variable firefox on the

755
00:27:09,520 --> 00:27:10,720
other hand

756
00:27:10,720 --> 00:27:13,120
when you open a file from a web page

757
00:27:13,120 --> 00:27:14,960
directly it'll open it in

758
00:27:14,960 --> 00:27:18,880
the percent temp same directory

759
00:27:18,880 --> 00:27:22,799
what happens if you combine these two

760
00:27:22,799 --> 00:27:24,559
again you have to exit protected view

761
00:27:24,559 --> 00:27:27,600
but let's take a look at this

762
00:27:27,600 --> 00:27:30,720
here i'm going to my attacker's website

763
00:27:30,720 --> 00:27:32,799
using firefox all i'm doing is i'm

764
00:27:32,799 --> 00:27:36,720
opening up an rtf i'm doing nothing else

765
00:27:36,720 --> 00:27:40,320
um i would like to enable editing sure

766
00:27:40,320 --> 00:27:42,320
because whatever protected view i click

767
00:27:42,320 --> 00:27:45,279
it and now i've got compromised

768
00:27:45,279 --> 00:27:47,679
that's pretty bad now how does this

769
00:27:47,679 --> 00:27:50,000
protected view even work

770
00:27:50,000 --> 00:27:52,320
um how does windows know when it opens

771
00:27:52,320 --> 00:27:53,200
up a document

772
00:27:53,200 --> 00:27:56,320
like it's actually um something that

773
00:27:56,320 --> 00:27:57,840
came from the internet

774
00:27:57,840 --> 00:28:01,679
um if i do a directory listing of this

775
00:28:01,679 --> 00:28:04,480
file that i downloaded lol rtf i just

776
00:28:04,480 --> 00:28:05,919
see the file there

777
00:28:05,919 --> 00:28:09,919
right but let's try something else let's

778
00:28:09,919 --> 00:28:10,559
do it there

779
00:28:10,559 --> 00:28:13,440
slash capital r and if this is an ntfs

780
00:28:13,440 --> 00:28:15,120
file system it has a thing called

781
00:28:15,120 --> 00:28:18,000
our alternate data streams and i can

782
00:28:18,000 --> 00:28:19,760
actually see here there's not only the

783
00:28:19,760 --> 00:28:20,480
document

784
00:28:20,480 --> 00:28:23,600
but there's also a alternate data stream

785
00:28:23,600 --> 00:28:26,159
that specifies information about that

786
00:28:26,159 --> 00:28:28,159
thing that i downloaded

787
00:28:28,159 --> 00:28:29,919
and it turns out you can actually just

788
00:28:29,919 --> 00:28:31,919
open up that alternate data stream it's

789
00:28:31,919 --> 00:28:32,240
a

790
00:28:32,240 --> 00:28:35,200
text file um you can just say notepad

791
00:28:35,200 --> 00:28:38,000
okay i'm going to look at that

792
00:28:38,000 --> 00:28:41,279
and now i can see right here i just have

793
00:28:41,279 --> 00:28:42,799
a file that i've downloaded onto my

794
00:28:42,799 --> 00:28:44,559
system but it also has this alternate

795
00:28:44,559 --> 00:28:46,480
data stream that says okay zone id is

796
00:28:46,480 --> 00:28:46,880
three

797
00:28:46,880 --> 00:28:49,520
that's the internet zone so basically

798
00:28:49,520 --> 00:28:51,200
any windows app that is

799
00:28:51,200 --> 00:28:53,200
buying into the whole mark of the web

800
00:28:53,200 --> 00:28:54,880
sort of thing um

801
00:28:54,880 --> 00:28:57,120
it can see that okay this is a dangerous

802
00:28:57,120 --> 00:28:59,200
file

803
00:28:59,200 --> 00:29:02,640
but now as us security

804
00:29:02,640 --> 00:29:05,120
as we security researchers do we got to

805
00:29:05,120 --> 00:29:06,480
figure out well there's got to be a way

806
00:29:06,480 --> 00:29:06,960
to

807
00:29:06,960 --> 00:29:10,559
bypass the mark of the web um

808
00:29:10,559 --> 00:29:12,720
that alternate data stream is placed

809
00:29:12,720 --> 00:29:14,880
there if i use like the built-in windows

810
00:29:14,880 --> 00:29:16,799
unzipping capability if i use like a

811
00:29:16,799 --> 00:29:17,840
third-party

812
00:29:17,840 --> 00:29:21,039
uh archiving program it might not choose

813
00:29:21,039 --> 00:29:21,679
to mark

814
00:29:21,679 --> 00:29:23,120
to place that mark of the web there so

815
00:29:23,120 --> 00:29:24,880
if i use 7-zip it doesn't have to be an

816
00:29:24,880 --> 00:29:26,960
actual 7-zip archive i could just you

817
00:29:26,960 --> 00:29:27,440
know

818
00:29:27,440 --> 00:29:29,520
open a zip file with 7-zip if i extract

819
00:29:29,520 --> 00:29:31,279
that no mark of the web that's kind of

820
00:29:31,279 --> 00:29:32,480
nice

821
00:29:32,480 --> 00:29:36,159
um if i look at vhd or vhdx contents

822
00:29:36,159 --> 00:29:39,120
those are a virtual hard drive

823
00:29:39,120 --> 00:29:40,799
and then the modern version of virtual

824
00:29:40,799 --> 00:29:43,360
hard drive um

825
00:29:43,360 --> 00:29:45,760
the contents of those are not tagged

826
00:29:45,760 --> 00:29:47,679
with the

827
00:29:47,679 --> 00:29:50,480
mark of the web that the container has

828
00:29:50,480 --> 00:29:52,240
the problem with that is it requires

829
00:29:52,240 --> 00:29:54,880
that the user is an admin um

830
00:29:54,880 --> 00:29:57,200
i didn't notice this because like this

831
00:29:57,200 --> 00:29:59,120
is an automatic elevation that windows

832
00:29:59,120 --> 00:29:59,679
does

833
00:29:59,679 --> 00:30:01,360
if you are logged into your computer as

834
00:30:01,360 --> 00:30:03,200
an admin which

835
00:30:03,200 --> 00:30:06,240
that's a bold thing to do

836
00:30:06,240 --> 00:30:07,679
if you're logged into windows as an

837
00:30:07,679 --> 00:30:09,440
admin it will just automatically you can

838
00:30:09,440 --> 00:30:12,640
double click on a vhd or vhdx

839
00:30:12,640 --> 00:30:16,720
i did a blog about this in 2019 um

840
00:30:16,720 --> 00:30:19,039
go ahead and use your favorite search

841
00:30:19,039 --> 00:30:21,120
engine to find that

842
00:30:21,120 --> 00:30:24,159
uh what i found is interesting is an iso

843
00:30:24,159 --> 00:30:26,159
or an img they're both handled by the

844
00:30:26,159 --> 00:30:28,080
same handler in windows

845
00:30:28,080 --> 00:30:30,799
and that's basically like a cd image um

846
00:30:30,799 --> 00:30:32,720
your iso 9660.

847
00:30:32,720 --> 00:30:34,480
when i double click an iso or an img

848
00:30:34,480 --> 00:30:36,320
it'll open up it'll mount it as if it's

849
00:30:36,320 --> 00:30:37,760
a cd and i can

850
00:30:37,760 --> 00:30:40,640
view the contents of it so let's look

851
00:30:40,640 --> 00:30:43,679
and consider about an rtf in an iso file

852
00:30:43,679 --> 00:30:45,520
i don't need admin privs there's no mark

853
00:30:45,520 --> 00:30:46,960
of the web for the contents

854
00:30:46,960 --> 00:30:49,760
and as windows conveniently does for you

855
00:30:49,760 --> 00:30:50,000
it

856
00:30:50,000 --> 00:30:52,000
hides files that say that they should be

857
00:30:52,000 --> 00:30:54,559
hidden so let's look at

858
00:30:54,559 --> 00:30:57,600
this example here i'm

859
00:30:57,600 --> 00:31:00,480
viewing my website it automatically

860
00:31:00,480 --> 00:31:02,159
downloads an iso file okay

861
00:31:02,159 --> 00:31:04,559
whatever um here's an rtf i'm gonna

862
00:31:04,559 --> 00:31:05,360
click on it

863
00:31:05,360 --> 00:31:08,720
and i just got compromised

864
00:31:08,720 --> 00:31:12,480
all i did so far is i opened an iso file

865
00:31:12,480 --> 00:31:14,320
and i double clicked on an rtf

866
00:31:14,320 --> 00:31:16,159
nothing else i didn't exit protected

867
00:31:16,159 --> 00:31:19,840
view protected view never came into play

868
00:31:20,880 --> 00:31:24,480
that's pretty bad

869
00:31:24,480 --> 00:31:27,279
um so just to kind of wrap things up

870
00:31:27,279 --> 00:31:28,240
let's talk about

871
00:31:28,240 --> 00:31:30,840
defenses i think i'm pretty close to on

872
00:31:30,840 --> 00:31:33,039
schedule uh what can we do to protect

873
00:31:33,039 --> 00:31:35,039
against this microsoft fixed just

874
00:31:35,039 --> 00:31:37,039
last week just one of these attack

875
00:31:37,039 --> 00:31:38,880
vectors or not one of the attack vectors

876
00:31:38,880 --> 00:31:39,440
but they

877
00:31:39,440 --> 00:31:41,919
fixed one of the the the target com

878
00:31:41,919 --> 00:31:43,120
payloads which is

879
00:31:43,120 --> 00:31:45,679
an exe server that doesn't exist what

880
00:31:45,679 --> 00:31:46,559
can we do

881
00:31:46,559 --> 00:31:48,159
what can we do if we're in charge of

882
00:31:48,159 --> 00:31:50,240
defending systems

883
00:31:50,240 --> 00:31:51,919
one thing that you could potentially do

884
00:31:51,919 --> 00:31:53,919
is look at your workflows and see

885
00:31:53,919 --> 00:31:57,519
do we actually do we have a work need

886
00:31:57,519 --> 00:32:01,360
to receive rtf files i find them to be

887
00:32:01,360 --> 00:32:04,240
pretty uncommon

888
00:32:04,240 --> 00:32:06,480
the one thing that you need to consider

889
00:32:06,480 --> 00:32:10,080
is it's not just the extension.rtf

890
00:32:10,080 --> 00:32:11,360
if you think about the video that i

891
00:32:11,360 --> 00:32:13,120
played earlier that was a thing that had

892
00:32:13,120 --> 00:32:13,519
a

893
00:32:13,519 --> 00:32:16,320
doc extension you double click on a dot

894
00:32:16,320 --> 00:32:17,039
doc

895
00:32:17,039 --> 00:32:19,120
it says okay windows says i'm going to

896
00:32:19,120 --> 00:32:20,159
open that in word

897
00:32:20,159 --> 00:32:22,080
it opens it in word word says okay

898
00:32:22,080 --> 00:32:23,440
that's an rtf

899
00:32:23,440 --> 00:32:25,279
you know so you can't just base you know

900
00:32:25,279 --> 00:32:27,519
with with the way that windows works for

901
00:32:27,519 --> 00:32:28,880
most cases you can't just

902
00:32:28,880 --> 00:32:30,799
base blocking on extensions you would

903
00:32:30,799 --> 00:32:33,200
have to look at the file content

904
00:32:33,200 --> 00:32:36,880
um the other thing that you could do

905
00:32:36,880 --> 00:32:39,360
i i i personally i don't see a

906
00:32:39,360 --> 00:32:41,279
legitimate work

907
00:32:41,279 --> 00:32:44,559
flow for this but right now

908
00:32:44,559 --> 00:32:46,559
probably most people have the ability to

909
00:32:46,559 --> 00:32:48,640
receive over email a vhd

910
00:32:48,640 --> 00:32:52,320
vhdx iso or an img file

911
00:32:52,320 --> 00:32:54,399
um if you're operating an email gateway

912
00:32:54,399 --> 00:32:57,120
i would say probably turn those off

913
00:32:57,120 --> 00:32:58,320
the other thing that i mentioned in my

914
00:32:58,320 --> 00:33:01,360
blog post about vhd and vhdx files is

915
00:33:01,360 --> 00:33:03,440
there's no anti-virus product that will

916
00:33:03,440 --> 00:33:03,919
scan

917
00:33:03,919 --> 00:33:08,080
on the wire the contents of a vhd

918
00:33:08,480 --> 00:33:11,600
so i could put mimikats in a vhd and

919
00:33:11,600 --> 00:33:13,600
email it to you and nothing would detect

920
00:33:13,600 --> 00:33:14,559
it

921
00:33:14,559 --> 00:33:16,399
until you actually mounted it and then

922
00:33:16,399 --> 00:33:18,799
windows looked at the contents of it

923
00:33:18,799 --> 00:33:20,240
so it seems like a high risk sort of

924
00:33:20,240 --> 00:33:21,840
thing to allow that

925
00:33:21,840 --> 00:33:23,360
the other thing that you can do rather

926
00:33:23,360 --> 00:33:25,120
than just focusing on the email

927
00:33:25,120 --> 00:33:28,480
attack vector is in windows

928
00:33:28,480 --> 00:33:30,880
you can change with file associations

929
00:33:30,880 --> 00:33:33,200
and i can say okay well

930
00:33:33,200 --> 00:33:35,519
none of my employees ever have the need

931
00:33:35,519 --> 00:33:37,279
to double click on a vhd

932
00:33:37,279 --> 00:33:40,559
so i'm just going to associate that with

933
00:33:40,559 --> 00:33:43,200
nothing so if i double click on a vhd or

934
00:33:43,200 --> 00:33:44,799
an iso nothing happens

935
00:33:44,799 --> 00:33:47,840
now if i am in your it department and i

936
00:33:47,840 --> 00:33:49,120
need to mount a vhd

937
00:33:49,120 --> 00:33:51,039
okay i'll go to computer management i'll

938
00:33:51,039 --> 00:33:52,720
go to disk management and i'll say mount

939
00:33:52,720 --> 00:33:54,399
vhd and i could still do it

940
00:33:54,399 --> 00:33:55,760
it doesn't actually prevent me from

941
00:33:55,760 --> 00:33:58,000
doing my job as an i.t person but

942
00:33:58,000 --> 00:34:01,120
it prevents your

943
00:34:01,840 --> 00:34:06,159
less aware of how computers work

944
00:34:06,159 --> 00:34:07,919
employee from double clicking on

945
00:34:07,919 --> 00:34:10,960
something and something bad happening

946
00:34:10,960 --> 00:34:12,560
the other thing i mentioned earlier is

947
00:34:12,560 --> 00:34:14,800
office 2013 and earlier does an

948
00:34:14,800 --> 00:34:18,000
unsafe extracting of

949
00:34:18,000 --> 00:34:19,839
embedded packages it uses the temp

950
00:34:19,839 --> 00:34:22,560
directory starting with office 2016 and

951
00:34:22,560 --> 00:34:23,040
newer

952
00:34:23,040 --> 00:34:26,239
it will extract it to like a unique grid

953
00:34:26,239 --> 00:34:28,239
subdirectory of there so microsoft has

954
00:34:28,239 --> 00:34:29,520
realized wait we should probably do

955
00:34:29,520 --> 00:34:31,760
something about that

956
00:34:31,760 --> 00:34:33,679
if you're using a chromium-based web

957
00:34:33,679 --> 00:34:35,199
browser and that includes the new

958
00:34:35,199 --> 00:34:38,719
version of edge or chrome or chromium

959
00:34:38,719 --> 00:34:40,639
there is a preference to turn off auto

960
00:34:40,639 --> 00:34:42,159
download

961
00:34:42,159 --> 00:34:45,520
please turn that off i can't think of

962
00:34:45,520 --> 00:34:48,079
anybody that is annoyed slash bothered

963
00:34:48,079 --> 00:34:50,159
by the fact that they have to like say

964
00:34:50,159 --> 00:34:52,079
yes i really do want to download that

965
00:34:52,079 --> 00:34:54,239
file that this random website wants to

966
00:34:54,239 --> 00:34:56,879
put on my computer

967
00:34:56,879 --> 00:34:59,359
and finally just to wrap things all up

968
00:34:59,359 --> 00:35:00,320
if there's one

969
00:35:00,320 --> 00:35:03,359
thing that i've learned in my years at

970
00:35:03,359 --> 00:35:04,400
the cert cc

971
00:35:04,400 --> 00:35:07,920
is this is a very good example of it the

972
00:35:07,920 --> 00:35:09,920
more calm that is installed on your

973
00:35:09,920 --> 00:35:11,040
system the

974
00:35:11,040 --> 00:35:13,359
larger your attack surface is but that

975
00:35:13,359 --> 00:35:14,320
happens

976
00:35:14,320 --> 00:35:16,960
that that basically that that idea that

977
00:35:16,960 --> 00:35:18,560
mindset can be applied towards

978
00:35:18,560 --> 00:35:21,839
anything on any system that you ever use

979
00:35:21,839 --> 00:35:23,839
the more software you have on your

980
00:35:23,839 --> 00:35:25,200
system

981
00:35:25,200 --> 00:35:28,839
the larger your attack surface is

982
00:35:28,839 --> 00:35:32,960
so if you ever in a situation where you

983
00:35:32,960 --> 00:35:34,960
want to solve a problem and your

984
00:35:34,960 --> 00:35:37,040
solution to increase your security is to

985
00:35:37,040 --> 00:35:39,599
put more software on your computer

986
00:35:39,599 --> 00:35:42,839
um i would think twice about that

987
00:35:42,839 --> 00:35:45,920
and that is it um

988
00:35:45,920 --> 00:35:49,040
i will be hanging out in the chat feel

989
00:35:49,040 --> 00:35:49,599
free to

990
00:35:49,599 --> 00:35:52,880
send me a tweet um

991
00:35:52,880 --> 00:35:59,839
but thank you much

992
00:36:02,400 --> 00:36:05,280
boom back

993
00:36:06,720 --> 00:36:09,760
that was great i told you dave

994
00:36:09,760 --> 00:36:11,440
activex you think you thought it went

995
00:36:11,440 --> 00:36:12,880
away 20 years ago

996
00:36:12,880 --> 00:36:15,359
get real unless unless you live in korea

997
00:36:15,359 --> 00:36:16,160
or

998
00:36:16,160 --> 00:36:19,440
use government systems i guess oh yes

999
00:36:19,440 --> 00:36:22,160
it's everywhere i can't i was talking

1000
00:36:22,160 --> 00:36:23,200
with dave about

1001
00:36:23,200 --> 00:36:25,839
format string vulnerabilities yesterday

1002
00:36:25,839 --> 00:36:28,160
so nothing ever goes away

1003
00:36:28,160 --> 00:36:31,280
no no we live in an endless cycle of

1004
00:36:31,280 --> 00:36:31,920
pain

1005
00:36:31,920 --> 00:36:34,960
which i enjoy so

1006
00:36:34,960 --> 00:36:36,720
one of the questions i had because we

1007
00:36:36,720 --> 00:36:38,839
have just like a couple minutes

1008
00:36:38,839 --> 00:36:43,119
is can't i create a iso partition

1009
00:36:43,119 --> 00:36:46,240
on a usb drive and then throw those

1010
00:36:46,240 --> 00:36:46,880
around

1011
00:36:46,880 --> 00:36:48,640
and like make something like super

1012
00:36:48,640 --> 00:36:50,160
interesting

1013
00:36:50,160 --> 00:36:54,400
uh as the rtf file name

1014
00:36:54,400 --> 00:36:55,920
would that just work should i start

1015
00:36:55,920 --> 00:36:57,599
doing that right now like

1016
00:36:57,599 --> 00:37:01,520
after this what you could do if you're

1017
00:37:01,520 --> 00:37:02,880
putting things on a thumb drive there's

1018
00:37:02,880 --> 00:37:04,160
two things that you can do is you can

1019
00:37:04,160 --> 00:37:05,920
put the rtf and its payload

1020
00:37:05,920 --> 00:37:08,560
directly on the file system of the usb

1021
00:37:08,560 --> 00:37:10,400
drive and if somebody plugs it in

1022
00:37:10,400 --> 00:37:12,400
they'll have to double click on the rtf

1023
00:37:12,400 --> 00:37:13,839
and open it

1024
00:37:13,839 --> 00:37:16,720
if you put an iso file on a usb drive

1025
00:37:16,720 --> 00:37:17,920
when they plug it in

1026
00:37:17,920 --> 00:37:20,480
windows will depending on how you have

1027
00:37:20,480 --> 00:37:21,680
windows configured

1028
00:37:21,680 --> 00:37:24,160
it might pop up with windows explorer

1029
00:37:24,160 --> 00:37:25,599
and it'll just

1030
00:37:25,599 --> 00:37:27,920
give you that iso file and then it's up

1031
00:37:27,920 --> 00:37:28,800
to you

1032
00:37:28,800 --> 00:37:30,640
as the user to double click on it to

1033
00:37:30,640 --> 00:37:32,079
mount it um

1034
00:37:32,079 --> 00:37:33,760
so i don't know if there's anything that

1035
00:37:33,760 --> 00:37:36,000
that's really fully automated

1036
00:37:36,000 --> 00:37:39,520
um the best thing that i and i don't

1037
00:37:39,520 --> 00:37:41,280
yeah i don't know if you still have my

1038
00:37:41,280 --> 00:37:43,520
my screen sharing but the thing that is

1039
00:37:43,520 --> 00:37:44,560
uh

1040
00:37:44,560 --> 00:37:47,839
probably the the best example was

1041
00:37:47,839 --> 00:37:50,640
the iso file um this the example that i

1042
00:37:50,640 --> 00:37:52,320
had was basically downloading it from a

1043
00:37:52,320 --> 00:37:53,280
website

1044
00:37:53,280 --> 00:37:55,680
i could email an iso to somebody i don't

1045
00:37:55,680 --> 00:37:57,599
think they generally have that disabled

1046
00:37:57,599 --> 00:37:59,760
all it requires is you double click on

1047
00:37:59,760 --> 00:38:01,680
the iso that mounts it you double click

1048
00:38:01,680 --> 00:38:03,839
on the rtf and then that's it that's

1049
00:38:03,839 --> 00:38:04,960
game over

1050
00:38:04,960 --> 00:38:06,800
and those in my mind you know part of

1051
00:38:06,800 --> 00:38:08,560
like when you're thinking about the

1052
00:38:08,560 --> 00:38:11,040
viability or the plausibility of certain

1053
00:38:11,040 --> 00:38:12,880
attack vectors part of what you have to

1054
00:38:12,880 --> 00:38:14,560
do is think about

1055
00:38:14,560 --> 00:38:17,520
is this an activity that a user would

1056
00:38:17,520 --> 00:38:18,000
likely

1057
00:38:18,000 --> 00:38:22,480
do and these both seem pretty reasonable

1058
00:38:22,480 --> 00:38:24,000
once you get into the point and i've

1059
00:38:24,000 --> 00:38:25,680
talked with microsoft about this and you

1060
00:38:25,680 --> 00:38:26,240
can embed

1061
00:38:26,240 --> 00:38:28,160
things into word documents i can embed

1062
00:38:28,160 --> 00:38:29,760
an exe in the word document

1063
00:38:29,760 --> 00:38:32,160
and if i have to click out of protected

1064
00:38:32,160 --> 00:38:33,839
view and then i have to click past that

1065
00:38:33,839 --> 00:38:35,040
dialog that says hey

1066
00:38:35,040 --> 00:38:36,880
we're about to do a thing do you want to

1067
00:38:36,880 --> 00:38:38,800
do that they're kind of in the point of

1068
00:38:38,800 --> 00:38:39,920
well we don't care

1069
00:38:39,920 --> 00:38:42,480
you as the end user have clicked through

1070
00:38:42,480 --> 00:38:44,400
that dialog so you as the end user have

1071
00:38:44,400 --> 00:38:46,000
decided i want the malware

1072
00:38:46,000 --> 00:38:49,200
that that document is giving me

1073
00:38:49,200 --> 00:38:52,640
so i guess there's there's one thing i

1074
00:38:52,640 --> 00:38:53,920
really liked about

1075
00:38:53,920 --> 00:38:55,839
this technique is when something's

1076
00:38:55,839 --> 00:38:57,680
executing inside

1077
00:38:57,680 --> 00:39:00,320
of windward you have to assume it's

1078
00:39:00,320 --> 00:39:00,880
probably

1079
00:39:00,880 --> 00:39:03,359
not going to be looked at by an endpoint

1080
00:39:03,359 --> 00:39:05,200
protection system

1081
00:39:05,200 --> 00:39:07,680
of the type that there are so many of in

1082
00:39:07,680 --> 00:39:09,680
the world right now

1083
00:39:09,680 --> 00:39:11,440
it's just a dll it happens to be loaded

1084
00:39:11,440 --> 00:39:13,599
into that space and there's just not

1085
00:39:13,599 --> 00:39:15,920
like a lot you can do about that this is

1086
00:39:15,920 --> 00:39:18,240
microsoft word behaving in the way that

1087
00:39:18,240 --> 00:39:19,920
it was designed to operate

1088
00:39:19,920 --> 00:39:23,040
and unless you are really certain

1089
00:39:23,040 --> 00:39:26,720
and unless you're actually looking um

1090
00:39:26,720 --> 00:39:28,960
these things will probably go unnoticed

1091
00:39:28,960 --> 00:39:31,359
um i just happen to have process monitor

1092
00:39:31,359 --> 00:39:32,160
opening

1093
00:39:32,160 --> 00:39:35,359
open while i'm doing my bff campaign

1094
00:39:35,359 --> 00:39:38,320
and when i saw it try to load dot a file

1095
00:39:38,320 --> 00:39:38,960
called

1096
00:39:38,960 --> 00:39:42,400
exe that's the um that's where your

1097
00:39:42,400 --> 00:39:45,040
security researcher flags all go off

1098
00:39:45,040 --> 00:39:47,920
like that's that's not right

1099
00:39:47,920 --> 00:39:51,680
okay so uh i have a bunch more questions

1100
00:39:51,680 --> 00:39:53,599
we're gonna probably

1101
00:39:53,599 --> 00:39:56,240
roll those in the discord chat which you

1102
00:39:56,240 --> 00:39:57,359
promised you would be

1103
00:39:57,359 --> 00:39:59,680
attending i will i will hang out in the

1104
00:39:59,680 --> 00:40:03,040
expert channel

