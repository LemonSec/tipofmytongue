1
00:00:00,550 --> 00:00:16,439
[Music]

2
00:00:12,320 --> 00:00:17,939
well welcome<font color="#E5E5E5"> it's awesome to</font><font color="#CCCCCC"> see all you</font>

3
00:00:16,439 --> 00:00:18,739
folks<font color="#E5E5E5"> out here today thank you</font><font color="#CCCCCC"> for being</font>

4
00:00:17,939 --> 00:00:21,419
here

5
00:00:18,739 --> 00:00:23,460
special thanks to<font color="#CCCCCC"> the</font><font color="#E5E5E5"> organizers</font><font color="#CCCCCC"> for</font>

6
00:00:21,419 --> 00:00:25,880
making this conference<font color="#E5E5E5"> possible</font><font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> very</font>

7
00:00:23,460 --> 00:00:27,770
<font color="#E5E5E5">excited and very humbled to</font><font color="#CCCCCC"> be up here</font>

8
00:00:25,880 --> 00:00:30,210
<font color="#E5E5E5">presenting with you today</font>

9
00:00:27,770 --> 00:00:32,610
this is extending<font color="#E5E5E5"> bloodhound for red</font>

10
00:00:30,210 --> 00:00:34,920
teamers I'm Tom Porter<font color="#E5E5E5"> you can find me</font>

11
00:00:32,610 --> 00:00:37,230
at Porter house on Twitter and github<font color="#CCCCCC"> a</font>

12
00:00:34,920 --> 00:00:39,060
lot<font color="#CCCCCC"> to talk about</font><font color="#E5E5E5"> today</font><font color="#CCCCCC"> I have also</font>

13
00:00:37,230 --> 00:00:41,809
started<font color="#E5E5E5"> blogging about so you can find</font>

14
00:00:39,060 --> 00:00:44,400
<font color="#CCCCCC">those post</font><font color="#E5E5E5"> archived on Porter house calm</font>

15
00:00:41,810 --> 00:00:46,410
my<font color="#CCCCCC"> infoset career start on the blue</font><font color="#E5E5E5"> side</font>

16
00:00:44,400 --> 00:00:47,910
I'm doing data flow analytics and

17
00:00:46,410 --> 00:00:49,828
<font color="#E5E5E5">network situational awareness</font>

18
00:00:47,910 --> 00:00:52,290
I eventually migrated<font color="#E5E5E5"> up to the red side</font>

19
00:00:49,829 --> 00:00:53,130
doing penetration testing primarily in

20
00:00:52,290 --> 00:00:56,339
the PCI realm

21
00:00:53,130 --> 00:00:59,730
<font color="#CCCCCC">more recently red teaming as of late</font>

22
00:00:56,340 --> 00:01:01,890
<font color="#CCCCCC">I've been working on password</font><font color="#E5E5E5"> analysis</font>

23
00:00:59,730 --> 00:01:04,408
and<font color="#E5E5E5"> wordlist generation so if that</font>

24
00:01:01,890 --> 00:01:06,810
<font color="#E5E5E5">interests you</font><font color="#CCCCCC"> come check out</font><font color="#E5E5E5"> Stan Jeff</font>

25
00:01:04,409 --> 00:01:10,590
<font color="#CCCCCC">catalyze talk</font><font color="#E5E5E5"> tomorrow at</font><font color="#CCCCCC"> 2:20</font><font color="#E5E5E5"> I think</font>

26
00:01:06,810 --> 00:01:12,180
right here<font color="#E5E5E5"> recently</font><font color="#CCCCCC"> I joined</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> team</font><font color="#E5E5E5"> at</font>

27
00:01:10,590 --> 00:01:14,970
fusion X the red team has<font color="#E5E5E5"> a security</font>

28
00:01:12,180 --> 00:01:17,040
consultant<font color="#E5E5E5"> but in a previous life my</font>

29
00:01:14,970 --> 00:01:19,260
true passion<font color="#CCCCCC"> seems to</font><font color="#E5E5E5"> be a professional</font>

30
00:01:17,040 --> 00:01:22,530
baseball player<font color="#CCCCCC"> so if you guys wanted to</font>

31
00:01:19,260 --> 00:01:24,360
discuss anything about<font color="#E5E5E5"> the talk you find</font>

32
00:01:22,530 --> 00:01:26,070
me out<font color="#E5E5E5"> in the lobby if you want to</font>

33
00:01:24,360 --> 00:01:27,780
discuss why and the Braves just finished

34
00:01:26,070 --> 00:01:31,529
under 500 for the fourth year<font color="#CCCCCC"> in</font><font color="#E5E5E5"> a row</font>

35
00:01:27,780 --> 00:01:34,020
<font color="#CCCCCC">you find me at the bar so today we're</font>

36
00:01:31,530 --> 00:01:36,180
talking about bloodhound<font color="#E5E5E5"> specifically</font>

37
00:01:34,020 --> 00:01:38,850
how<font color="#E5E5E5"> we can extend it to match our</font>

38
00:01:36,180 --> 00:01:41,190
workflow as a red team or<font color="#E5E5E5"> blue team and</font>

39
00:01:38,850 --> 00:01:42,479
we'll see examples<font color="#E5E5E5"> for both now</font><font color="#CCCCCC"> that's</font>

40
00:01:41,190 --> 00:01:44,869
<font color="#E5E5E5">kind of a high level overview of</font><font color="#CCCCCC"> some</font>

41
00:01:42,479 --> 00:01:47,850
<font color="#CCCCCC">one things we're going</font><font color="#E5E5E5"> to chat about</font><font color="#CCCCCC"> a</font>

42
00:01:44,869 --> 00:01:50,189
lot<font color="#E5E5E5"> of this work culminates into these</font>

43
00:01:47,850 --> 00:01:51,570
two projects you<font color="#CCCCCC"> see here at the</font><font color="#E5E5E5"> bottom</font>

44
00:01:50,189 --> 00:01:53,070
and<font color="#E5E5E5"> I'm going</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> make these slides</font>

45
00:01:51,570 --> 00:01:54,059
<font color="#E5E5E5">publicly available to someone to worry</font>

46
00:01:53,070 --> 00:01:56,669
about<font color="#E5E5E5"> jotting down links or anything</font>

47
00:01:54,060 --> 00:01:58,229
like<font color="#E5E5E5"> that one of the reasons I</font>

48
00:01:56,670 --> 00:02:00,750
formulated<font color="#E5E5E5"> this talk was because I had</font>

49
00:01:58,229 --> 00:02:02,880
folks coming to me and saying<font color="#E5E5E5"> hey</font><font color="#CCCCCC"> but</font>

50
00:02:00,750 --> 00:02:04,830
<font color="#CCCCCC">Helen looks really cool</font><font color="#E5E5E5"> but</font><font color="#CCCCCC"> it's a</font>

51
00:02:02,880 --> 00:02:06,600
<font color="#E5E5E5">little intimidating</font><font color="#CCCCCC"> if I want to try to</font>

52
00:02:04,830 --> 00:02:09,568
<font color="#E5E5E5">muck what the data or write my own</font>

53
00:02:06,600 --> 00:02:11,459
custom queries so today isn't<font color="#E5E5E5"> gonna be</font>

54
00:02:09,568 --> 00:02:13,649
<font color="#E5E5E5">just a tool demo we're also going to be</font>

55
00:02:11,459 --> 00:02:16,170
diving<font color="#E5E5E5"> into the underlying technologies</font>

56
00:02:13,650 --> 00:02:18,630
that<font color="#CCCCCC"> player</font><font color="#E5E5E5"> we're</font><font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> talk</font><font color="#CCCCCC"> about</font>

57
00:02:16,170 --> 00:02:22,230
for<font color="#CCCCCC"> J the graph database and how we can</font>

58
00:02:18,630 --> 00:02:26,100
<font color="#E5E5E5">manipulate that data with cipher so I</font>

59
00:02:22,230 --> 00:02:29,060
may<font color="#E5E5E5"> ask who here has used blood</font><font color="#CCCCCC"> hem cool</font>

60
00:02:26,100 --> 00:02:31,709
awesome how do you guys<font color="#CCCCCC"> our blue teamers</font>

61
00:02:29,060 --> 00:02:33,030
fantastic<font color="#E5E5E5"> that's awesome to see</font><font color="#CCCCCC"> so we're</font>

62
00:02:31,709 --> 00:02:36,150
seeing<font color="#E5E5E5"> more</font><font color="#CCCCCC"> and more blue teamers adapt</font>

63
00:02:33,030 --> 00:02:37,770
this<font color="#CCCCCC"> now</font><font color="#E5E5E5"> for those unfamiliar</font><font color="#CCCCCC"> blood</font>

64
00:02:36,150 --> 00:02:40,260
<font color="#CCCCCC">Alan's released well</font><font color="#E5E5E5"> over a year ago</font><font color="#CCCCCC"> Def</font>

65
00:02:37,770 --> 00:02:41,550
<font color="#CCCCCC">Con 24 by</font><font color="#E5E5E5"> Andy Robbins Rohan</font><font color="#CCCCCC"> buzzer Kerr</font>

66
00:02:40,260 --> 00:02:44,100
and<font color="#CCCCCC"> wool</font><font color="#E5E5E5"> Schrader whoever</font><font color="#CCCCCC"> its spectre</font>

67
00:02:41,550 --> 00:02:46,970
<font color="#E5E5E5">ups the initial idea behind it was</font><font color="#CCCCCC"> to</font>

68
00:02:44,100 --> 00:02:50,310
find and automate the collection<font color="#E5E5E5"> of</font>

69
00:02:46,970 --> 00:02:52,410
finding a escalation<font color="#CCCCCC"> paths and</font><font color="#E5E5E5"> Active</font>

70
00:02:50,310 --> 00:02:54,660
<font color="#E5E5E5">Directory environments you see the</font>

71
00:02:52,410 --> 00:02:56,880
project link there now a<font color="#E5E5E5"> lot people</font><font color="#CCCCCC"> are</font>

72
00:02:54,660 --> 00:02:58,950
<font color="#E5E5E5">familiar with the app itself but</font>

73
00:02:56,880 --> 00:03:00,510
necessarily the<font color="#CCCCCC"> stacks surrounding it so</font>

74
00:02:58,950 --> 00:03:02,549
the<font color="#CCCCCC"> bloodhound app is built</font><font color="#E5E5E5"> on land</font>

75
00:03:00,510 --> 00:03:05,160
<font color="#E5E5E5">curious</font><font color="#CCCCCC"> TAS it's the open</font><font color="#E5E5E5"> source and</font>

76
00:03:02,550 --> 00:03:07,350
<font color="#E5E5E5">free version</font><font color="#CCCCCC"> only</font><font color="#E5E5E5"> curious it is compiled</font>

77
00:03:05,160 --> 00:03:09,690
with a tool<font color="#E5E5E5"> called</font><font color="#CCCCCC"> electron electron</font>

78
00:03:07,350 --> 00:03:12,350
crates these cross-platform applications

79
00:03:09,690 --> 00:03:15,090
built<font color="#E5E5E5"> on top of chromium that means that</font>

80
00:03:12,350 --> 00:03:17,100
bloodhound is a<font color="#E5E5E5"> single page JavaScript</font>

81
00:03:15,090 --> 00:03:18,390
application and<font color="#E5E5E5"> so it's built on top of</font>

82
00:03:17,100 --> 00:03:20,400
chromium<font color="#E5E5E5"> you</font><font color="#CCCCCC"> can fire up things like</font>

83
00:03:18,390 --> 00:03:21,779
chrome<font color="#E5E5E5"> dev tools so you have access</font><font color="#CCCCCC"> to</font>

84
00:03:20,400 --> 00:03:24,870
<font color="#CCCCCC">your console</font><font color="#E5E5E5"> and debugger and</font><font color="#CCCCCC"> all that</font>

85
00:03:21,780 --> 00:03:26,760
stuff<font color="#E5E5E5"> on the back end is neo4j</font><font color="#CCCCCC"> is a</font>

86
00:03:24,870 --> 00:03:29,010
graph<font color="#E5E5E5"> database we'll talk about what</font>

87
00:03:26,760 --> 00:03:31,470
that<font color="#E5E5E5"> means the back end in front end</font>

88
00:03:29,010 --> 00:03:34,260
communicate<font color="#E5E5E5"> over this proprietary binary</font>

89
00:03:31,470 --> 00:03:36,870
protocol called bolt<font color="#E5E5E5"> when we'll talk</font>

90
00:03:34,260 --> 00:03:38,340
about<font color="#E5E5E5"> much bolt today we'll touch on</font>

91
00:03:36,870 --> 00:03:40,320
data collection<font color="#CCCCCC"> now there's a few</font>

92
00:03:38,340 --> 00:03:42,600
<font color="#E5E5E5">different options of how</font><font color="#CCCCCC"> you can run and</font>

93
00:03:40,320 --> 00:03:44,700
how you can ingest data<font color="#E5E5E5"> you can either</font>

94
00:03:42,600 --> 00:03:47,010
generate<font color="#CCCCCC"> CSVs which get ingested through</font>

95
00:03:44,700 --> 00:03:48,690
the<font color="#E5E5E5"> front end app or you can stream data</font>

96
00:03:47,010 --> 00:03:52,109
across the network into a REST API

97
00:03:48,690 --> 00:03:54,480
sitting on neo4j so on the data

98
00:03:52,110 --> 00:03:55,860
collection side<font color="#CCCCCC"> it has evolved quite</font><font color="#E5E5E5"> a</font>

99
00:03:54,480 --> 00:03:58,130
bit<font color="#E5E5E5"> since bloodhounds initial release</font>

100
00:03:55,860 --> 00:04:01,650
<font color="#E5E5E5">used to be a</font><font color="#CCCCCC"> powershell script called</font>

101
00:03:58,130 --> 00:04:03,780
bloodhound<font color="#E5E5E5"> ps1 has now been completely</font>

102
00:04:01,650 --> 00:04:06,090
rewritten<font color="#CCCCCC"> in c-sharp</font><font color="#E5E5E5"> and it's just</font>

103
00:04:03,780 --> 00:04:08,250
<font color="#E5E5E5">really says shark</font><font color="#CCCCCC"> pound last month at</font>

104
00:04:06,090 --> 00:04:09,420
Derby con and this is an<font color="#CCCCCC"> example of what</font>

105
00:04:08,250 --> 00:04:13,109
the<font color="#E5E5E5"> invocation of that might look like</font>

106
00:04:09,420 --> 00:04:14,790
<font color="#CCCCCC">and if you</font><font color="#E5E5E5"> haven't seen this project</font>

107
00:04:13,109 --> 00:04:15,870
before<font color="#CCCCCC"> I encourage</font><font color="#E5E5E5"> you to go</font><font color="#CCCCCC"> check</font><font color="#E5E5E5"> out</font>

108
00:04:14,790 --> 00:04:17,430
the Derby<font color="#E5E5E5"> con talk there's some really</font>

109
00:04:15,870 --> 00:04:20,940
<font color="#E5E5E5">cool features and</font><font color="#CCCCCC"> a lot performance</font>

110
00:04:17,430 --> 00:04:23,669
bonuses from sharp<font color="#E5E5E5"> em now neo4j being a</font>

111
00:04:20,940 --> 00:04:25,950
graph<font color="#CCCCCC"> database what that means it's the</font>

112
00:04:23,669 --> 00:04:28,560
<font color="#E5E5E5">property graph model and that's just one</font>

113
00:04:25,950 --> 00:04:29,240
particular<font color="#E5E5E5"> application</font><font color="#CCCCCC"> of graph theory</font>

114
00:04:28,560 --> 00:04:30,620
now

115
00:04:29,240 --> 00:04:32,900
a property graph model we have<font color="#E5E5E5"> this</font>

116
00:04:30,620 --> 00:04:35,360
notion of nodes<font color="#CCCCCC"> you might know them as</font>

117
00:04:32,900 --> 00:04:36,169
vertices<font color="#CCCCCC"> saying</font><font color="#E5E5E5"> much the same thing and</font>

118
00:04:35,360 --> 00:04:38,840
on the right here we're kind<font color="#CCCCCC"> of building</font>

119
00:04:36,169 --> 00:04:40,250
<font color="#E5E5E5">our visual database those nodes are</font>

120
00:04:38,840 --> 00:04:41,869
connected<font color="#CCCCCC"> together via relationships</font>

121
00:04:40,250 --> 00:04:43,759
<font color="#CCCCCC">just kind of tells us how</font><font color="#E5E5E5"> to reverse</font>

122
00:04:41,870 --> 00:04:46,310
from one node to another<font color="#E5E5E5"> you might hear</font>

123
00:04:43,759 --> 00:04:47,660
<font color="#CCCCCC">that referred to as edges now we get</font>

124
00:04:46,310 --> 00:04:49,069
little<font color="#CCCCCC"> more specific with our nodes and</font>

125
00:04:47,660 --> 00:04:50,449
<font color="#E5E5E5">give them labels</font><font color="#CCCCCC"> it just kind of tells</font>

126
00:04:49,069 --> 00:04:53,360
<font color="#CCCCCC">us what type of node we're dealing with</font>

127
00:04:50,449 --> 00:04:56,000
<font color="#E5E5E5">so you can have a person node a house</font>

128
00:04:53,360 --> 00:04:57,889
node a sword node<font color="#E5E5E5"> we can do the same</font>

129
00:04:56,000 --> 00:04:59,240
thing<font color="#E5E5E5"> for relationships and but sub</font>

130
00:04:57,889 --> 00:05:01,669
<font color="#E5E5E5">column labels we call them relationship</font>

131
00:04:59,240 --> 00:05:03,319
types so now you can see how a node

132
00:05:01,669 --> 00:05:04,940
might be<font color="#CCCCCC"> related to a house cuz it's a</font>

133
00:05:03,319 --> 00:05:06,470
member of it<font color="#E5E5E5"> or sword might have a</font>

134
00:05:04,940 --> 00:05:08,930
knight or a house might<font color="#E5E5E5"> have a knight</font>

135
00:05:06,470 --> 00:05:11,169
<font color="#E5E5E5">and that's a sword if you can't see</font>

136
00:05:08,930 --> 00:05:13,580
where<font color="#E5E5E5"> I'm</font><font color="#CCCCCC"> going yet</font><font color="#E5E5E5"> we have properties</font>

137
00:05:11,169 --> 00:05:17,419
properties are key<font color="#CCCCCC"> value pairs</font><font color="#E5E5E5"> that we</font>

138
00:05:13,580 --> 00:05:19,068
can give to<font color="#E5E5E5"> nodes or relationships so</font>

139
00:05:17,419 --> 00:05:20,599
now we can<font color="#E5E5E5"> get kind of a distinct unique</font>

140
00:05:19,069 --> 00:05:21,650
field for our nodes and relationships<font color="#E5E5E5"> so</font>

141
00:05:20,599 --> 00:05:25,610
<font color="#CCCCCC">you have like a person whose name</font><font color="#E5E5E5"> is</font>

142
00:05:21,650 --> 00:05:26,750
<font color="#E5E5E5">Tyrion</font><font color="#CCCCCC"> or sword whose name is ice now</font>

143
00:05:25,610 --> 00:05:29,650
one of the cool<font color="#CCCCCC"> things about graph</font>

144
00:05:26,750 --> 00:05:32,060
databases<font color="#E5E5E5"> is that we can define paths</font>

145
00:05:29,650 --> 00:05:34,400
paths are basically<font color="#E5E5E5"> a way to</font><font color="#CCCCCC"> represent</font>

146
00:05:32,060 --> 00:05:36,259
how two nodes that<font color="#E5E5E5"> are disjoint are</font>

147
00:05:34,400 --> 00:05:38,719
connected so if<font color="#E5E5E5"> I want to know how the</font>

148
00:05:36,259 --> 00:05:40,580
person Tyrion<font color="#E5E5E5"> is related to the sword</font>

149
00:05:38,719 --> 00:05:42,740
<font color="#CCCCCC">widow's wail well I can see he's a</font>

150
00:05:40,580 --> 00:05:45,109
member of House Lannister<font color="#E5E5E5"> house a</font><font color="#CCCCCC"> Nestor</font>

151
00:05:42,740 --> 00:05:46,639
has<font color="#CCCCCC"> a item that's a</font><font color="#E5E5E5"> sword called wood as</font>

152
00:05:45,110 --> 00:05:49,120
well<font color="#E5E5E5"> or if you approach you from the</font>

153
00:05:46,639 --> 00:05:51,590
other end<font color="#CCCCCC"> you see a sword named</font><font color="#E5E5E5"> ice</font>

154
00:05:49,120 --> 00:05:54,199
that's been<font color="#E5E5E5"> stolen and then reforged</font>

155
00:05:51,590 --> 00:05:56,869
<font color="#E5E5E5">into a sword named widow's wail this is</font>

156
00:05:54,199 --> 00:05:58,400
cool we<font color="#E5E5E5"> can define paths that</font><font color="#CCCCCC"> have the</font>

157
00:05:56,870 --> 00:06:00,590
shortest<font color="#E5E5E5"> route or maybe the longest</font>

158
00:05:58,400 --> 00:06:01,638
<font color="#E5E5E5">route or maybe all possible paths</font>

159
00:06:00,590 --> 00:06:04,849
depends<font color="#E5E5E5"> what problem you're trying to</font>

160
00:06:01,639 --> 00:06:06,380
solve now a bloodhound this is how it

161
00:06:04,849 --> 00:06:07,909
translate over in<font color="#E5E5E5"> terms of the nodes so</font>

162
00:06:06,380 --> 00:06:10,550
these are app icons that you<font color="#E5E5E5"> see</font><font color="#CCCCCC"> and</font>

163
00:06:07,909 --> 00:06:13,219
those all<font color="#E5E5E5"> are associated with these</font>

164
00:06:10,550 --> 00:06:15,469
<font color="#E5E5E5">labels so domains are the blue worlds</font>

165
00:06:13,219 --> 00:06:17,270
users are<font color="#E5E5E5"> the green people groups are</font>

166
00:06:15,469 --> 00:06:21,620
the<font color="#E5E5E5"> yellow people</font><font color="#CCCCCC"> computers are the</font><font color="#E5E5E5"> red</font>

167
00:06:17,270 --> 00:06:24,258
monitors one bloodhound collects data<font color="#CCCCCC"> it</font>

168
00:06:21,620 --> 00:06:26,960
generates more<font color="#CCCCCC"> clicks this name property</font>

169
00:06:24,259 --> 00:06:28,250
<font color="#CCCCCC">and does this for every specific</font><font color="#E5E5E5"> node so</font>

170
00:06:26,960 --> 00:06:30,289
here you see<font color="#CCCCCC"> some examples</font><font color="#E5E5E5"> of what those</font>

171
00:06:28,250 --> 00:06:34,039
name values look like<font color="#E5E5E5"> you got internal</font>

172
00:06:30,289 --> 00:06:35,210
dot<font color="#CCCCCC"> local</font><font color="#E5E5E5"> as a domain</font><font color="#CCCCCC"> the user is just</font>

173
00:06:34,039 --> 00:06:36,650
username a domain name

174
00:06:35,210 --> 00:06:38,419
computers<font color="#CCCCCC"> are computer name a domain</font>

175
00:06:36,650 --> 00:06:40,159
name I'm sorry groups are group name at

176
00:06:38,419 --> 00:06:42,060
the main name and the computers<font color="#CCCCCC"> are the</font>

177
00:06:40,159 --> 00:06:44,800
<font color="#CCCCCC">fully qualified domain</font><font color="#E5E5E5"> name</font>

178
00:06:42,060 --> 00:06:45,880
on the relationship<font color="#CCCCCC"> side</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> is are the</font>

179
00:06:44,800 --> 00:06:48,160
<font color="#E5E5E5">four relationships</font><font color="#CCCCCC"> that what he'll</font>

180
00:06:45,880 --> 00:06:50,290
initially came out with now since then

181
00:06:48,160 --> 00:06:52,780
they've had update 1.3 which is the

182
00:06:50,290 --> 00:06:54,250
attack low attack path update<font color="#CCCCCC"> where they</font>

183
00:06:52,780 --> 00:06:56,289
added<font color="#CCCCCC"> a</font><font color="#E5E5E5"> bunch more</font><font color="#CCCCCC"> and I encourage you</font>

184
00:06:54,250 --> 00:06:57,520
<font color="#CCCCCC">to</font><font color="#E5E5E5"> go</font><font color="#CCCCCC"> check that out for</font><font color="#E5E5E5"> this talk and</font>

185
00:06:56,290 --> 00:07:00,360
<font color="#E5E5E5">simplicity's sake where it's going to</font>

186
00:06:57,520 --> 00:07:02,680
<font color="#CCCCCC">focus on these now</font><font color="#E5E5E5"> these four were</font>

187
00:07:00,360 --> 00:07:05,380
created to<font color="#CCCCCC"> answer four pretty simple</font>

188
00:07:02,680 --> 00:07:07,870
questions who is<font color="#CCCCCC"> a member of</font><font color="#E5E5E5"> what groups</font>

189
00:07:05,380 --> 00:07:09,520
<font color="#CCCCCC">it could be a user that's given access</font>

190
00:07:07,870 --> 00:07:12,090
to a<font color="#E5E5E5"> group or put inside a group or it</font>

191
00:07:09,520 --> 00:07:16,060
could be a nested group relationship

192
00:07:12,090 --> 00:07:17,530
which which groups and users<font color="#E5E5E5"> have admin</font>

193
00:07:16,060 --> 00:07:19,000
<font color="#E5E5E5">to a computer</font><font color="#CCCCCC"> now</font><font color="#E5E5E5"> a group could</font><font color="#CCCCCC"> be a</font>

194
00:07:17,530 --> 00:07:20,979
given explicit have an access<font color="#E5E5E5"> to a</font>

195
00:07:19,000 --> 00:07:23,770
machine<font color="#CCCCCC"> or might</font><font color="#E5E5E5"> come be its group</font>

196
00:07:20,979 --> 00:07:25,659
delegation for computers for<font color="#CCCCCC"> its</font>

197
00:07:23,770 --> 00:07:26,380
<font color="#E5E5E5">computer which users</font><font color="#CCCCCC"> have an active</font>

198
00:07:25,660 --> 00:07:29,050
session<font color="#E5E5E5"> on it</font>

199
00:07:26,380 --> 00:07:30,639
and domains which domains are trusted by

200
00:07:29,050 --> 00:07:31,750
another now if you notice<font color="#E5E5E5"> these</font>

201
00:07:30,639 --> 00:07:35,590
relationships they'll have an

202
00:07:31,750 --> 00:07:37,449
indirection directions in the o4j can't

203
00:07:35,590 --> 00:07:38,560
have that can't be<font color="#CCCCCC"> bi-directional and</font>

204
00:07:37,449 --> 00:07:39,850
<font color="#CCCCCC">they can't have no direction they have</font>

205
00:07:38,560 --> 00:07:41,560
<font color="#CCCCCC">to at least</font><font color="#E5E5E5"> one</font><font color="#CCCCCC"> direction point to</font>

206
00:07:39,850 --> 00:07:44,470
another<font color="#E5E5E5"> node now in Active Directory</font>

207
00:07:41,560 --> 00:07:45,220
environments we also have we often have

208
00:07:44,470 --> 00:07:48,220
needs to have bi-directional

209
00:07:45,220 --> 00:07:49,960
<font color="#E5E5E5">relationships so need for neo4j the way</font>

210
00:07:48,220 --> 00:07:51,550
we specify that<font color="#E5E5E5"> is just by creating</font>

211
00:07:49,960 --> 00:07:53,729
unidirectional relationships in both

212
00:07:51,550 --> 00:07:56,229
directions

213
00:07:53,729 --> 00:07:59,139
what those<font color="#E5E5E5"> pieces defined we</font><font color="#CCCCCC"> can now</font>

214
00:07:56,229 --> 00:08:01,300
build graphs that<font color="#E5E5E5"> look like this now as</font>

215
00:07:59,139 --> 00:08:02,320
your eyes<font color="#E5E5E5"> start to skim that over so I</font>

216
00:08:01,300 --> 00:08:04,120
want you<font color="#E5E5E5"> to keep in mind that's</font><font color="#CCCCCC"> the</font>

217
00:08:02,320 --> 00:08:05,460
first<font color="#E5E5E5"> most important thing I want you to</font>

218
00:08:04,120 --> 00:08:09,280
remember when<font color="#E5E5E5"> you're</font><font color="#CCCCCC"> using bloodhound is</font>

219
00:08:05,460 --> 00:08:12,489
about the arrows<font color="#CCCCCC"> the arrows always point</font>

220
00:08:09,280 --> 00:08:13,840
towards escalating access always under

221
00:08:12,490 --> 00:08:15,099
<font color="#E5E5E5">the first time I heard that is</font><font color="#CCCCCC"> when this</font>

222
00:08:13,840 --> 00:08:17,289
<font color="#E5E5E5">kind of clicked for me because the</font>

223
00:08:15,099 --> 00:08:19,330
arrows<font color="#CCCCCC"> seemed kind</font><font color="#E5E5E5"> of arbitrary but if</font>

224
00:08:17,289 --> 00:08:20,620
you keep in<font color="#CCCCCC"> mind</font><font color="#E5E5E5"> that the arrows are</font>

225
00:08:19,330 --> 00:08:22,930
always<font color="#E5E5E5"> pointing towards escalating</font>

226
00:08:20,620 --> 00:08:24,910
access this makes a lot more sense<font color="#CCCCCC"> so</font>

227
00:08:22,930 --> 00:08:26,889
you have a user<font color="#CCCCCC"> jeido</font><font color="#E5E5E5"> who's</font><font color="#CCCCCC"> Adam</font><font color="#E5E5E5"> into</font><font color="#CCCCCC"> an</font>

228
00:08:24,910 --> 00:08:28,780
application development<font color="#E5E5E5"> server that</font>

229
00:08:26,889 --> 00:08:31,690
server has<font color="#CCCCCC"> a session belong to a</font><font color="#E5E5E5"> B Smith</font>

230
00:08:28,780 --> 00:08:34,088
user that<font color="#E5E5E5"> user is a nested member of a</font>

231
00:08:31,690 --> 00:08:35,919
server admins<font color="#CCCCCC"> group which has a session</font>

232
00:08:34,089 --> 00:08:38,260
belong to a user that's<font color="#E5E5E5"> a member of the</font>

233
00:08:35,919 --> 00:08:40,990
<font color="#E5E5E5">DA account and now you can see why this</font>

234
00:08:38,260 --> 00:08:43,630
<font color="#E5E5E5">is so powerful</font><font color="#CCCCCC"> right all we needed was</font>

235
00:08:40,990 --> 00:08:45,550
an authenticated user<font color="#E5E5E5"> on the domain and</font>

236
00:08:43,630 --> 00:08:48,939
the ability to make some LDAP queries

237
00:08:45,550 --> 00:08:52,500
<font color="#E5E5E5">and maybe some 138 132 API calls and we</font>

238
00:08:48,940 --> 00:08:52,500
can build graphs<font color="#CCCCCC"> that look like this</font>

239
00:08:55,860 --> 00:08:59,589
when you fire up<font color="#E5E5E5"> the Bloodhound app for</font>

240
00:08:57,970 --> 00:09:01,839
the first<font color="#CCCCCC"> time you'll see</font><font color="#E5E5E5"> something like</font>

241
00:08:59,589 --> 00:09:03,970
this<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is assuming you've connected</font>

242
00:09:01,839 --> 00:09:06,580
<font color="#CCCCCC">to a neo4j back in and that back-end is</font>

243
00:09:03,970 --> 00:09:09,279
populated<font color="#CCCCCC"> with data now from</font><font color="#E5E5E5"> here on</font><font color="#CCCCCC"> out</font>

244
00:09:06,580 --> 00:09:11,079
I'll<font color="#E5E5E5"> be using the example database</font>

245
00:09:09,279 --> 00:09:12,939
<font color="#E5E5E5">that's in the github repo</font><font color="#CCCCCC"> for bloodhound</font>

246
00:09:11,079 --> 00:09:15,219
<font color="#E5E5E5">so the guys are nice not to have this</font>

247
00:09:12,940 --> 00:09:17,230
<font color="#E5E5E5">pre-canned data set</font><font color="#CCCCCC"> that you can</font><font color="#E5E5E5"> toy and</font>

248
00:09:15,220 --> 00:09:19,720
tinker with to get<font color="#E5E5E5"> a feel for</font><font color="#CCCCCC"> the</font>

249
00:09:17,230 --> 00:09:21,880
application so little<font color="#CCCCCC"> tour the AI in</font><font color="#E5E5E5"> the</font>

250
00:09:19,720 --> 00:09:24,010
top right<font color="#CCCCCC"> we have their menu buttons</font><font color="#E5E5E5"> you</font>

251
00:09:21,880 --> 00:09:25,510
can<font color="#E5E5E5"> import data you can export graphs</font>

252
00:09:24,010 --> 00:09:27,700
<font color="#E5E5E5">you can change how</font><font color="#CCCCCC"> the graphs laid out a</font>

253
00:09:25,510 --> 00:09:29,529
handful<font color="#E5E5E5"> of other things bottom right</font>

254
00:09:27,700 --> 00:09:31,660
zooming in and out<font color="#E5E5E5"> on the bottom we have</font>

255
00:09:29,529 --> 00:09:32,950
<font color="#E5E5E5">the raw query bar this is where you</font>

256
00:09:31,660 --> 00:09:35,410
<font color="#E5E5E5">could put in our own cipher queries to</font>

257
00:09:32,950 --> 00:09:36,880
run against the<font color="#CCCCCC"> data set</font><font color="#E5E5E5"> the middle of</font>

258
00:09:35,410 --> 00:09:37,959
the space<font color="#E5E5E5"> there just called the graph in</font>

259
00:09:36,880 --> 00:09:40,089
the top left we have<font color="#CCCCCC"> the search</font>

260
00:09:37,959 --> 00:09:41,739
container<font color="#E5E5E5"> the top bar that search</font>

261
00:09:40,089 --> 00:09:42,190
container is where we can search<font color="#CCCCCC"> for</font>

262
00:09:41,740 --> 00:09:43,750
<font color="#CCCCCC">noes</font>

263
00:09:42,190 --> 00:09:46,180
so you start typing<font color="#CCCCCC"> it will autocomplete</font>

264
00:09:43,750 --> 00:09:48,130
and find<font color="#E5E5E5"> notes for you below</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> we</font>

265
00:09:46,180 --> 00:09:50,739
have<font color="#E5E5E5"> our</font><font color="#CCCCCC"> three tabs queries note info</font>

266
00:09:48,130 --> 00:09:53,050
and database info database info tab<font color="#E5E5E5"> just</font>

267
00:09:50,740 --> 00:09:55,380
has some metadata about<font color="#E5E5E5"> the</font><font color="#CCCCCC"> database the</font>

268
00:09:53,050 --> 00:09:58,120
queries<font color="#E5E5E5"> tab what you see here has some</font>

269
00:09:55,380 --> 00:10:01,240
<font color="#E5E5E5">pre-populated queries that exist in the</font>

270
00:09:58,120 --> 00:10:02,709
repo<font color="#E5E5E5"> so here you</font><font color="#CCCCCC"> see the find all domain</font>

271
00:10:01,240 --> 00:10:06,880
admins query<font color="#CCCCCC"> that's the graph</font><font color="#E5E5E5"> that's</font>

272
00:10:02,709 --> 00:10:08,920
being displayed if you click<font color="#E5E5E5"> on one of</font>

273
00:10:06,880 --> 00:10:11,410
the<font color="#E5E5E5"> nodes and go over</font><font color="#CCCCCC"> set</font><font color="#E5E5E5"> node info tab</font>

274
00:10:08,920 --> 00:10:12,910
you see some metadata<font color="#E5E5E5"> about that node so</font>

275
00:10:11,410 --> 00:10:15,490
you see the name<font color="#E5E5E5"> property that we pulled</font>

276
00:10:12,910 --> 00:10:17,649
in you see some of<font color="#CCCCCC"> the other</font><font color="#E5E5E5"> properties</font>

277
00:10:15,490 --> 00:10:19,270
<font color="#CCCCCC">that were added</font><font color="#E5E5E5"> in the object</font><font color="#CCCCCC"> properties</font>

278
00:10:17,649 --> 00:10:21,279
update which was 1.4 with a few weeks

279
00:10:19,270 --> 00:10:22,449
ago<font color="#CCCCCC"> you have to run the object</font>

280
00:10:21,279 --> 00:10:24,490
<font color="#CCCCCC">properties collection method in order</font><font color="#E5E5E5"> to</font>

281
00:10:22,450 --> 00:10:27,100
get those below that you<font color="#E5E5E5"> see group</font>

282
00:10:24,490 --> 00:10:29,350
memberships<font color="#E5E5E5"> local admins so where users</font>

283
00:10:27,100 --> 00:10:31,060
<font color="#CCCCCC">have explicit local admin access where</font>

284
00:10:29,350 --> 00:10:33,010
they have local<font color="#E5E5E5"> admin access via their</font>

285
00:10:31,060 --> 00:10:34,469
group delegation and where they have

286
00:10:33,010 --> 00:10:36,939
derivative<font color="#E5E5E5"> of local admin access</font>

287
00:10:34,470 --> 00:10:38,440
<font color="#E5E5E5">derivative local admins are if you</font>

288
00:10:36,940 --> 00:10:40,600
explore the attack<font color="#CCCCCC"> graph from</font><font color="#E5E5E5"> that</font>

289
00:10:38,440 --> 00:10:43,270
<font color="#CCCCCC">particular node what other computers can</font>

290
00:10:40,600 --> 00:10:45,699
it now reach beyond that we<font color="#CCCCCC"> have some</font>

291
00:10:43,270 --> 00:10:49,240
object control paths<font color="#CCCCCC"> this</font><font color="#E5E5E5"> is going back</font>

292
00:10:45,699 --> 00:10:51,459
to<font color="#CCCCCC"> that 1.3</font><font color="#E5E5E5"> update basically they comb</font>

293
00:10:49,240 --> 00:10:53,380
these discretionary<font color="#E5E5E5"> access control lists</font>

294
00:10:51,459 --> 00:10:55,569
<font color="#E5E5E5">pulled out the introduce the entries</font>

295
00:10:53,380 --> 00:10:57,670
<font color="#CCCCCC">that were interesting</font><font color="#E5E5E5"> and that give some</font>

296
00:10:55,570 --> 00:10:59,800
facet of control of their other other

297
00:10:57,670 --> 00:11:02,949
objects and you see<font color="#CCCCCC"> those displayed</font>

298
00:10:59,800 --> 00:11:04,540
<font color="#E5E5E5">there all my favorite features is</font>

299
00:11:02,949 --> 00:11:05,589
something called<font color="#E5E5E5"> path finding so if you</font>

300
00:11:04,540 --> 00:11:08,140
click<font color="#CCCCCC"> on a little road</font><font color="#E5E5E5"> I</font>

301
00:11:05,590 --> 00:11:10,720
<font color="#CCCCCC">on that top bar expands down to a bottom</font>

302
00:11:08,140 --> 00:11:12,580
<font color="#E5E5E5">or to a second bar in the top</font><font color="#CCCCCC"> one you</font>

303
00:11:10,720 --> 00:11:14,620
put in<font color="#E5E5E5"> your user node or your start node</font>

304
00:11:12,580 --> 00:11:16,540
the second bar you put in your

305
00:11:14,620 --> 00:11:18,010
<font color="#CCCCCC">destination node</font><font color="#E5E5E5"> this could be domain</font>

306
00:11:16,540 --> 00:11:20,199
admins like in<font color="#E5E5E5"> this</font><font color="#CCCCCC"> example it might</font><font color="#E5E5E5"> be</font>

307
00:11:18,010 --> 00:11:22,060
<font color="#E5E5E5">a group or a particular computer that</font>

308
00:11:20,200 --> 00:11:24,180
you're looking for and<font color="#CCCCCC"> we'll do</font><font color="#E5E5E5"> is I'll</font>

309
00:11:22,060 --> 00:11:26,319
<font color="#E5E5E5">try to find a path</font><font color="#CCCCCC"> between those two</font>

310
00:11:24,180 --> 00:11:28,510
it's pretty simple to<font color="#E5E5E5"> read you see Bart</font>

311
00:11:26,320 --> 00:11:30,730
<font color="#CCCCCC">see</font><font color="#E5E5E5"> our users see</font><font color="#CCCCCC"> barclay internal</font><font color="#E5E5E5"> dot</font>

312
00:11:28,510 --> 00:11:32,620
local<font color="#E5E5E5"> on the bottom left it's a member</font>

313
00:11:30,730 --> 00:11:34,120
of an R&D group<font color="#E5E5E5"> which is a min</font><font color="#CCCCCC"> to a</font>

314
00:11:32,620 --> 00:11:36,460
handful<font color="#CCCCCC"> of computers those computers</font>

315
00:11:34,120 --> 00:11:38,340
have a session<font color="#E5E5E5"> belonging to users are</font>

316
00:11:36,460 --> 00:11:40,570
part of<font color="#E5E5E5"> a</font><font color="#CCCCCC"> nested domain admins group and</font>

317
00:11:38,340 --> 00:11:42,820
this<font color="#E5E5E5"> is why I think bloodhound is so</font>

318
00:11:40,570 --> 00:11:45,040
sexy like<font color="#CCCCCC"> I</font><font color="#E5E5E5"> can do this with just</font><font color="#CCCCCC"> barely</font>

319
00:11:42,820 --> 00:11:47,380
lifting<font color="#CCCCCC"> a finger</font><font color="#E5E5E5"> this is something that</font>

320
00:11:45,040 --> 00:11:48,939
red teamers and<font color="#E5E5E5"> penetration testers have</font>

321
00:11:47,380 --> 00:11:50,770
been kind<font color="#E5E5E5"> of empirically finding on</font>

322
00:11:48,940 --> 00:11:52,630
their own for years<font color="#CCCCCC"> but now we have a</font>

323
00:11:50,770 --> 00:11:54,930
way to automate that process and<font color="#E5E5E5"> find a</font>

324
00:11:52,630 --> 00:11:57,430
lot more<font color="#E5E5E5"> interesting attack paths</font>

325
00:11:54,930 --> 00:12:00,280
bloodhound<font color="#CCCCCC"> protip</font><font color="#E5E5E5"> you go over to</font><font color="#CCCCCC"> the</font>

326
00:11:57,430 --> 00:12:02,050
settings and look at the option for

327
00:12:00,280 --> 00:12:03,660
query debug mode it's turned off by

328
00:12:02,050 --> 00:12:05,979
<font color="#CCCCCC">default I encourage that you turn it on</font>

329
00:12:03,660 --> 00:12:07,719
when<font color="#E5E5E5"> you do what happens this as you</font>

330
00:12:05,980 --> 00:12:10,720
click<font color="#CCCCCC"> around the app so as you run these</font>

331
00:12:07,720 --> 00:12:13,060
<font color="#CCCCCC">queries</font><font color="#E5E5E5"> you see</font><font color="#CCCCCC"> the cipher that's going</font>

332
00:12:10,720 --> 00:12:15,670
on<font color="#E5E5E5"> underneath</font><font color="#CCCCCC"> the hood</font><font color="#E5E5E5"> be populated down</font>

333
00:12:13,060 --> 00:12:17,560
here in the raw query bar so when folks

334
00:12:15,670 --> 00:12:18,610
<font color="#E5E5E5">come</font><font color="#CCCCCC"> to me and they're asking what's</font><font color="#E5E5E5"> the</font>

335
00:12:17,560 --> 00:12:20,109
way for them to<font color="#E5E5E5"> get started</font><font color="#CCCCCC"> learning</font>

336
00:12:18,610 --> 00:12:22,000
<font color="#E5E5E5">cipher</font><font color="#CCCCCC"> that's the first thing I always</font>

337
00:12:20,110 --> 00:12:24,790
<font color="#E5E5E5">tell them because you can kind of see</font>

338
00:12:22,000 --> 00:12:27,730
what's happening as<font color="#CCCCCC"> you click on nodes</font>

339
00:12:24,790 --> 00:12:30,040
or<font color="#E5E5E5"> as you generate queries now</font><font color="#CCCCCC"> this</font>

340
00:12:27,730 --> 00:12:32,020
<font color="#E5E5E5">particular query is</font><font color="#CCCCCC"> the find all domain</font>

341
00:12:30,040 --> 00:12:35,530
admins query<font color="#CCCCCC"> I know it looks a little</font>

342
00:12:32,020 --> 00:12:36,910
long<font color="#CCCCCC"> and</font><font color="#E5E5E5"> may be complex or intimidating</font>

343
00:12:35,530 --> 00:12:39,459
but we're gonna dive in and show you

344
00:12:36,910 --> 00:12:41,199
it's not<font color="#E5E5E5"> too bad so if you go up to New</font>

345
00:12:39,460 --> 00:12:43,390
<font color="#E5E5E5">York</font><font color="#CCCCCC"> for J's website you look at the</font>

346
00:12:41,200 --> 00:12:45,940
developer documentation<font color="#CCCCCC"> this is the</font>

347
00:12:43,390 --> 00:12:50,500
first example<font color="#E5E5E5"> you see when you look at</font>

348
00:12:45,940 --> 00:12:52,540
cypher you<font color="#CCCCCC"> have two nodes a and B where</font>

349
00:12:50,500 --> 00:12:55,120
a likes B it's<font color="#E5E5E5"> about as</font><font color="#CCCCCC"> simple as</font><font color="#E5E5E5"> you</font>

350
00:12:52,540 --> 00:12:58,630
<font color="#CCCCCC">can</font><font color="#E5E5E5"> get below</font><font color="#CCCCCC"> that is</font><font color="#E5E5E5"> the cypher</font>

351
00:12:55,120 --> 00:13:01,420
representation of this graph and the<font color="#E5E5E5"> o4j</font>

352
00:12:58,630 --> 00:13:04,240
calls us the<font color="#E5E5E5"> ASCII art style of syntax</font>

353
00:13:01,420 --> 00:13:07,240
<font color="#CCCCCC">and if you squint and blur your eyes</font>

354
00:13:04,240 --> 00:13:08,620
just<font color="#E5E5E5"> enough you can see why the nodes a</font>

355
00:13:07,240 --> 00:13:10,270
and B are encapsulating these round

356
00:13:08,620 --> 00:13:12,520
<font color="#E5E5E5">parentheses that kind of look like nodes</font>

357
00:13:10,270 --> 00:13:14,170
<font color="#E5E5E5">and then the relationship</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> in these</font>

358
00:13:12,520 --> 00:13:16,720
square brackets<font color="#CCCCCC"> that kind of looks like</font>

359
00:13:14,170 --> 00:13:18,040
a big<font color="#E5E5E5"> block arrow you can even see the</font>

360
00:13:16,720 --> 00:13:18,910
arrow pointing<font color="#CCCCCC"> out of it towards the B</font>

361
00:13:18,040 --> 00:13:22,060
note

362
00:13:18,910 --> 00:13:25,630
the way we denote labels and relation

363
00:13:22,060 --> 00:13:27,760
types<font color="#E5E5E5"> in</font><font color="#CCCCCC"> cipher</font><font color="#E5E5E5"> is using this : notation</font>

364
00:13:25,630 --> 00:13:29,770
<font color="#E5E5E5">so we have our relationship type of</font>

365
00:13:27,760 --> 00:13:32,560
likes<font color="#E5E5E5"> we put it inside</font><font color="#CCCCCC"> our</font><font color="#E5E5E5"> square</font>

366
00:13:29,770 --> 00:13:36,490
relationship<font color="#CCCCCC"> brackets</font><font color="#E5E5E5"> and then we put :</font>

367
00:13:32,560 --> 00:13:38,050
likes<font color="#CCCCCC"> denotes a likes B this is a simple</font>

368
00:13:36,490 --> 00:13:40,030
<font color="#E5E5E5">cipher pattern if you can understand</font>

369
00:13:38,050 --> 00:13:41,439
this you<font color="#E5E5E5"> can understand more complex</font>

370
00:13:40,030 --> 00:13:43,689
cipher patterns because a lot<font color="#E5E5E5"> more</font>

371
00:13:41,440 --> 00:13:48,100
<font color="#E5E5E5">complex patterns are</font><font color="#CCCCCC"> just these simple</font>

372
00:13:43,690 --> 00:13:49,900
<font color="#E5E5E5">patterns</font><font color="#CCCCCC"> chained together so let's look</font>

373
00:13:48,100 --> 00:13:50,950
at the context of<font color="#E5E5E5"> bloodhound</font><font color="#CCCCCC"> before you</font>

374
00:13:49,900 --> 00:13:52,780
dive in<font color="#E5E5E5"> try figure out where all is</font>

375
00:13:50,950 --> 00:13:55,300
going<font color="#E5E5E5"> on here just take a step</font><font color="#CCCCCC"> back and</font>

376
00:13:52,780 --> 00:13:58,510
look<font color="#E5E5E5"> at the browser itself or connected</font>

377
00:13:55,300 --> 00:13:59,760
to port<font color="#CCCCCC"> 74 74</font><font color="#E5E5E5"> and this is on the neo4j</font>

378
00:13:58,510 --> 00:14:02,890
<font color="#E5E5E5">database server</font>

379
00:13:59,760 --> 00:14:05,980
this is neo4j<font color="#E5E5E5"> x' web browser</font><font color="#CCCCCC"> it's kind</font>

380
00:14:02,890 --> 00:14:07,590
of like a web IDE for<font color="#E5E5E5"> safer so if you're</font>

381
00:14:05,980 --> 00:14:09,880
going to tinker<font color="#E5E5E5"> with cipher queries</font><font color="#CCCCCC"> I</font>

382
00:14:07,590 --> 00:14:12,400
encourage that<font color="#E5E5E5"> you do it here instead of</font>

383
00:14:09,880 --> 00:14:13,960
<font color="#CCCCCC">in</font><font color="#E5E5E5"> the app because here you get syntax</font>

384
00:14:12,400 --> 00:14:17,110
highlighting some helpful debugging

385
00:14:13,960 --> 00:14:19,510
output<font color="#E5E5E5"> the ability to save queries and a</font>

386
00:14:17,110 --> 00:14:20,650
handful of other<font color="#CCCCCC"> things now below that</font>

387
00:14:19,510 --> 00:14:21,069
you see<font color="#CCCCCC"> our site for query that we're</font>

388
00:14:20,650 --> 00:14:24,640
issuing

389
00:14:21,070 --> 00:14:26,290
you see match and return<font color="#E5E5E5"> and for any of</font>

390
00:14:24,640 --> 00:14:27,850
<font color="#CCCCCC">you guys that I've read or written</font><font color="#E5E5E5"> SQL</font>

391
00:14:26,290 --> 00:14:29,500
before it's<font color="#E5E5E5"> gonna feel</font><font color="#CCCCCC"> pretty familiar a</font>

392
00:14:27,850 --> 00:14:32,110
match<font color="#E5E5E5"> is kind of like our select</font>

393
00:14:29,500 --> 00:14:34,180
statement<font color="#E5E5E5"> so we're gonna match in return</font>

394
00:14:32,110 --> 00:14:36,280
and we're matching nodes<font color="#CCCCCC"> node</font><font color="#E5E5E5"> by the</font>

395
00:14:34,180 --> 00:14:37,630
round<font color="#E5E5E5"> parentheses we store the variable</font>

396
00:14:36,280 --> 00:14:40,660
or a<font color="#CCCCCC"> syllable result in a</font><font color="#E5E5E5"> variable</font>

397
00:14:37,630 --> 00:14:43,510
<font color="#CCCCCC">called n and then we return it now the</font>

398
00:14:40,660 --> 00:14:45,400
graph neo4j did not discriminate it

399
00:14:43,510 --> 00:14:46,000
returned every single node in<font color="#CCCCCC"> our</font>

400
00:14:45,400 --> 00:14:48,610
database

401
00:14:46,000 --> 00:14:51,910
you see our green users are yellow

402
00:14:48,610 --> 00:14:53,500
groups<font color="#CCCCCC"> are red computers and so</font><font color="#E5E5E5"> on what</font>

403
00:14:51,910 --> 00:14:55,600
fun<font color="#E5E5E5"> we'll find just one</font><font color="#CCCCCC"> specific type</font><font color="#E5E5E5"> of</font>

404
00:14:53,500 --> 00:14:57,790
<font color="#CCCCCC">node may be the</font><font color="#E5E5E5"> computers that's where</font>

405
00:14:55,600 --> 00:14:59,440
the labels come back in so it<font color="#E5E5E5"> still</font>

406
00:14:57,790 --> 00:15:01,360
<font color="#E5E5E5">match in return in the only thing that</font>

407
00:14:59,440 --> 00:15:02,980
changes that underlined portion we've

408
00:15:01,360 --> 00:15:04,960
added then that we've added back in that

409
00:15:02,980 --> 00:15:06,610
computer label so we're matching a

410
00:15:04,960 --> 00:15:08,400
computer node<font color="#E5E5E5"> we store the result in</font>

411
00:15:06,610 --> 00:15:10,600
variable<font color="#E5E5E5"> called</font><font color="#CCCCCC"> n and then</font><font color="#E5E5E5"> we return it</font>

412
00:15:08,400 --> 00:15:11,709
now the resulting graph isn't very

413
00:15:10,600 --> 00:15:14,080
interesting because<font color="#E5E5E5"> these computers</font>

414
00:15:11,710 --> 00:15:15,550
don't have<font color="#E5E5E5"> relationships between them so</font>

415
00:15:14,080 --> 00:15:16,960
maybe<font color="#E5E5E5"> I</font><font color="#CCCCCC"> just want to get the name</font>

416
00:15:15,550 --> 00:15:20,829
properties<font color="#E5E5E5"> for all</font><font color="#CCCCCC"> these different</font>

417
00:15:16,960 --> 00:15:22,180
<font color="#E5E5E5">computers same query as before but</font><font color="#CCCCCC"> now</font>

418
00:15:20,830 --> 00:15:24,040
<font color="#CCCCCC">instead of just returning those nodes</font>

419
00:15:22,180 --> 00:15:26,260
<font color="#E5E5E5">we're returning</font><font color="#CCCCCC"> the name</font><font color="#E5E5E5"> property for</font>

420
00:15:24,040 --> 00:15:28,630
those nodes<font color="#E5E5E5"> it's just the variable dot</font>

421
00:15:26,260 --> 00:15:30,280
property name got<font color="#E5E5E5"> lots of computers</font>

422
00:15:28,630 --> 00:15:32,640
there<font color="#E5E5E5"> what if I want to find a</font>

423
00:15:30,280 --> 00:15:35,130
particular<font color="#E5E5E5"> user that know the name for</font>

424
00:15:32,640 --> 00:15:37,680
so I have this user<font color="#E5E5E5"> see</font><font color="#CCCCCC"> Barclay internal</font>

425
00:15:35,130 --> 00:15:39,660
<font color="#CCCCCC">dot local I</font><font color="#E5E5E5"> want to find we changed our</font>

426
00:15:37,680 --> 00:15:41,430
from our computer label<font color="#E5E5E5"> to a user label</font>

427
00:15:39,660 --> 00:15:42,959
<font color="#E5E5E5">so going to match a user store</font><font color="#CCCCCC"> their</font>

428
00:15:41,430 --> 00:15:45,000
variable so the resultant variable

429
00:15:42,959 --> 00:15:47,790
called n<font color="#E5E5E5"> we're going to filter that</font><font color="#CCCCCC"> down</font>

430
00:15:45,000 --> 00:15:50,519
with our where<font color="#CCCCCC"> clause to say</font><font color="#E5E5E5"> only if</font>

431
00:15:47,790 --> 00:15:53,069
this<font color="#CCCCCC"> user's name</font><font color="#E5E5E5"> property is equal to</font>

432
00:15:50,519 --> 00:15:55,800
this string<font color="#E5E5E5"> that we specified we return</font>

433
00:15:53,070 --> 00:15:57,570
<font color="#E5E5E5">it we see we</font><font color="#CCCCCC"> have our user there now</font>

434
00:15:55,800 --> 00:16:00,810
from<font color="#E5E5E5"> that user</font><font color="#CCCCCC"> let's say we want to</font><font color="#E5E5E5"> find</font>

435
00:15:57,570 --> 00:16:02,220
where<font color="#E5E5E5"> that user has admin access and</font>

436
00:16:00,810 --> 00:16:04,380
<font color="#E5E5E5">that's where we bring back in that very</font>

437
00:16:02,220 --> 00:16:05,579
first<font color="#CCCCCC"> example with a likes B we're</font>

438
00:16:04,380 --> 00:16:08,630
bringing back<font color="#CCCCCC"> in relationships</font><font color="#E5E5E5"> in the</font>

439
00:16:05,579 --> 00:16:10,859
<font color="#E5E5E5">destination node so same queries before</font>

440
00:16:08,630 --> 00:16:12,209
<font color="#E5E5E5">now we've added added back in that</font>

441
00:16:10,860 --> 00:16:14,370
relationship<font color="#CCCCCC"> so we've got the square</font>

442
00:16:12,209 --> 00:16:16,319
brackets for<font color="#E5E5E5"> the relationship we got :</font>

443
00:16:14,370 --> 00:16:18,300
admin<font color="#CCCCCC"> 2 because that's the brush</font><font color="#E5E5E5"> up type</font>

444
00:16:16,320 --> 00:16:20,459
that we're<font color="#CCCCCC"> looking for and then</font><font color="#E5E5E5"> we have</font>

445
00:16:18,300 --> 00:16:22,469
<font color="#CCCCCC">an arrow pointing towards</font><font color="#E5E5E5"> the end node</font>

446
00:16:20,459 --> 00:16:23,910
of our path<font color="#E5E5E5"> we just call it</font><font color="#CCCCCC"> m it</font><font color="#E5E5E5"> could</font>

447
00:16:22,470 --> 00:16:26,100
be anything<font color="#CCCCCC"> but</font><font color="#E5E5E5"> check out those round</font>

448
00:16:23,910 --> 00:16:27,719
<font color="#E5E5E5">parentheses around it and the result is</font>

449
00:16:26,100 --> 00:16:30,149
this graph we see<font color="#CCCCCC"> that our user is admin</font>

450
00:16:27,720 --> 00:16:34,459
has<font color="#CCCCCC"> a man access to one computer a</font>

451
00:16:30,149 --> 00:16:37,260
laptop<font color="#E5E5E5"> now we've pretty much built up to</font>

452
00:16:34,459 --> 00:16:38,399
a legitimate<font color="#E5E5E5"> bloodhound query that you</font>

453
00:16:37,260 --> 00:16:40,410
would see in the<font color="#E5E5E5"> app with a few</font>

454
00:16:38,399 --> 00:16:42,449
different changes<font color="#CCCCCC"> so we're finding</font>

455
00:16:40,410 --> 00:16:45,510
<font color="#E5E5E5">derivative local admin access</font><font color="#CCCCCC"> they're up</font>

456
00:16:42,449 --> 00:16:48,300
<font color="#E5E5E5">to three hops away</font><font color="#CCCCCC"> a couple changes with</font>

457
00:16:45,510 --> 00:16:51,390
the<font color="#E5E5E5"> syntax one I've moved that where</font>

458
00:16:48,300 --> 00:16:53,099
<font color="#CCCCCC">Clause</font><font color="#E5E5E5"> inside that user node so</font><font color="#CCCCCC"> it's</font>

459
00:16:51,390 --> 00:16:55,380
still the same effect<font color="#E5E5E5"> but some people</font>

460
00:16:53,100 --> 00:16:57,269
find<font color="#E5E5E5"> this easier to read so now we've</font>

461
00:16:55,380 --> 00:17:00,510
got<font color="#CCCCCC"> our name property associated</font><font color="#E5E5E5"> with in</font>

462
00:16:57,269 --> 00:17:01,980
that round<font color="#E5E5E5"> parentheses of that user for</font>

463
00:17:00,510 --> 00:17:05,760
relationships you see the square

464
00:17:01,980 --> 00:17:06,959
brackets<font color="#CCCCCC"> asterisks 1.3 the</font><font color="#E5E5E5"> asterisk</font>

465
00:17:05,760 --> 00:17:08,720
<font color="#E5E5E5">means give me any relationship that</font>

466
00:17:06,959 --> 00:17:12,720
<font color="#E5E5E5">exists I don't care what kind it is and</font>

467
00:17:08,720 --> 00:17:14,610
the 1.3 denotes our hops<font color="#CCCCCC"> so</font><font color="#E5E5E5"> anything</font>

468
00:17:12,720 --> 00:17:17,220
<font color="#E5E5E5">that's one two three hops away from our</font>

469
00:17:14,609 --> 00:17:20,129
initial<font color="#E5E5E5"> start node and</font><font color="#CCCCCC"> the destination</font>

470
00:17:17,220 --> 00:17:21,419
<font color="#E5E5E5">we want to land on a computer so we want</font>

471
00:17:20,130 --> 00:17:23,910
the last<font color="#CCCCCC"> node in our path to be a</font>

472
00:17:21,419 --> 00:17:26,280
<font color="#E5E5E5">computer we wrap that all up into a</font>

473
00:17:23,910 --> 00:17:28,350
<font color="#E5E5E5">variable called P short for path and we</font>

474
00:17:26,280 --> 00:17:30,899
return all<font color="#CCCCCC"> those paths and this is the</font>

475
00:17:28,349 --> 00:17:32,309
result<font color="#E5E5E5"> we see our C barclay the green</font>

476
00:17:30,900 --> 00:17:34,740
node towards the middle of<font color="#CCCCCC"> the screen as</font>

477
00:17:32,309 --> 00:17:36,899
our user he's a member<font color="#E5E5E5"> of an R&D group</font>

478
00:17:34,740 --> 00:17:39,299
the R&D<font color="#E5E5E5"> group has admin access</font><font color="#CCCCCC"> to a</font>

479
00:17:36,900 --> 00:17:40,980
bunch<font color="#CCCCCC"> of computers</font><font color="#E5E5E5"> on the other way he</font>

480
00:17:39,299 --> 00:17:42,418
has admin access<font color="#CCCCCC"> to that laptop where he</font>

481
00:17:40,980 --> 00:17:44,400
<font color="#E5E5E5">found that laptop had a session</font>

482
00:17:42,419 --> 00:17:45,330
<font color="#E5E5E5">belonging to another user if you</font>

483
00:17:44,400 --> 00:17:47,190
compromise that

484
00:17:45,330 --> 00:17:49,379
assume<font color="#E5E5E5"> that users identity you would</font>

485
00:17:47,190 --> 00:17:52,320
have<font color="#E5E5E5"> having access to another machine if</font>

486
00:17:49,380 --> 00:17:54,240
you copy that<font color="#E5E5E5"> site for query and paste</font>

487
00:17:52,320 --> 00:17:56,760
it in the<font color="#CCCCCC"> wrong query bar bloodhound</font><font color="#E5E5E5"> you</font>

488
00:17:54,240 --> 00:17:58,470
generate the same graph<font color="#CCCCCC"> but here we have</font>

489
00:17:56,760 --> 00:18:00,360
the<font color="#E5E5E5"> power of the bloodhound app now</font><font color="#CCCCCC"> we</font>

490
00:17:58,470 --> 00:18:02,309
can click<font color="#E5E5E5"> on nodes we can look at</font>

491
00:18:00,360 --> 00:18:05,149
metadata we<font color="#E5E5E5"> can pivot off this to run</font>

492
00:18:02,309 --> 00:18:07,110
other queries<font color="#E5E5E5"> whatever you might want</font>

493
00:18:05,149 --> 00:18:10,590
now it's kind<font color="#CCCCCC"> of a crash course on</font>

494
00:18:07,110 --> 00:18:12,120
<font color="#E5E5E5">cipher it's not too bad right like a</font>

495
00:18:10,590 --> 00:18:16,980
cipher it's not such a bad guy<font color="#E5E5E5"> anything</font>

496
00:18:12,120 --> 00:18:21,090
wrong<font color="#CCCCCC"> but</font><font color="#E5E5E5"> now that we have those</font>

497
00:18:16,980 --> 00:18:22,649
building blocks<font color="#E5E5E5"> in</font><font color="#CCCCCC"> place</font><font color="#E5E5E5"> we can go in</font>

498
00:18:21,090 --> 00:18:23,639
and do some<font color="#CCCCCC"> more interesting things so</font>

499
00:18:22,649 --> 00:18:25,739
these are some of<font color="#E5E5E5"> the extensions</font><font color="#CCCCCC"> that</font>

500
00:18:23,640 --> 00:18:29,880
I've written<font color="#E5E5E5"> I'm gonna start with owned</font>

501
00:18:25,740 --> 00:18:32,940
and wave so I would be on an<font color="#E5E5E5"> engagement</font>

502
00:18:29,880 --> 00:18:35,880
<font color="#CCCCCC">stamp like a pen test</font><font color="#E5E5E5"> and I</font><font color="#CCCCCC"> already have</font>

503
00:18:32,940 --> 00:18:38,190
<font color="#CCCCCC">my database populated</font><font color="#E5E5E5"> I would compromise</font>

504
00:18:35,880 --> 00:18:40,740
<font color="#CCCCCC">a new user</font><font color="#E5E5E5"> so I kept really excited I've</font>

505
00:18:38,190 --> 00:18:42,659
run over<font color="#CCCCCC"> to bloodhound I put in</font><font color="#E5E5E5"> my user</font>

506
00:18:40,740 --> 00:18:45,529
as my start node domain admins as my

507
00:18:42,659 --> 00:18:49,529
<font color="#CCCCCC">destination node I hit</font><font color="#E5E5E5"> enter and I see</font>

508
00:18:45,529 --> 00:18:51,090
no data returned from query<font color="#E5E5E5"> and I see</font>

509
00:18:49,529 --> 00:18:54,419
that<font color="#E5E5E5"> and I</font><font color="#CCCCCC"> die a little bit on the</font>

510
00:18:51,090 --> 00:18:58,139
inside<font color="#CCCCCC"> I start like question all my life</font>

511
00:18:54,419 --> 00:19:00,179
choices<font color="#E5E5E5"> but all hope isn't lost</font><font color="#CCCCCC"> red</font>

512
00:18:58,140 --> 00:19:01,620
teamers and pen testers for years have

513
00:19:00,179 --> 00:19:04,950
<font color="#E5E5E5">been finding other interesting ways</font><font color="#CCCCCC"> to</font>

514
00:19:01,620 --> 00:19:08,760
<font color="#E5E5E5">either escalate or ladder remove so as</font>

515
00:19:04,950 --> 00:19:10,620
an example<font color="#CCCCCC"> password reuse</font><font color="#E5E5E5"> ye guys</font><font color="#CCCCCC"> by CS</font>

516
00:19:08,760 --> 00:19:11,908
on almost every single engagement you

517
00:19:10,620 --> 00:19:13,289
<font color="#E5E5E5">have users</font><font color="#CCCCCC"> that are</font><font color="#E5E5E5"> sharing passwords</font>

518
00:19:11,909 --> 00:19:15,179
between their normal count on their

519
00:19:13,289 --> 00:19:16,559
admin account<font color="#E5E5E5"> or maybe from an account</font>

520
00:19:15,179 --> 00:19:17,340
to<font color="#E5E5E5"> another account</font><font color="#CCCCCC"> line</font><font color="#E5E5E5"> from their</font>

521
00:19:16,559 --> 00:19:19,770
accounts from<font color="#E5E5E5"> their account on</font><font color="#CCCCCC"> a</font>

522
00:19:17,340 --> 00:19:22,408
different<font color="#E5E5E5"> domain or with local admin</font>

523
00:19:19,770 --> 00:19:23,820
accounts on computers<font color="#CCCCCC"> Forks</font><font color="#E5E5E5"> that have</font>

524
00:19:22,409 --> 00:19:26,490
implemented<font color="#E5E5E5"> laps yet you might be able</font>

525
00:19:23,820 --> 00:19:27,899
<font color="#CCCCCC">to</font><font color="#E5E5E5"> see the rid 500 account that has</font>

526
00:19:26,490 --> 00:19:30,840
access<font color="#E5E5E5"> or has the same password hash</font>

527
00:19:27,899 --> 00:19:33,299
across multiple machines<font color="#E5E5E5"> Kerberos nearby</font>

528
00:19:30,840 --> 00:19:35,039
here Kerberos<font color="#CCCCCC"> team if you're not you</font>

529
00:19:33,299 --> 00:19:37,529
<font color="#CCCCCC">should be feels like cheating sometimes</font>

530
00:19:35,039 --> 00:19:39,390
it's<font color="#E5E5E5"> great but in short it's a simple</font>

531
00:19:37,529 --> 00:19:42,929
way<font color="#CCCCCC"> for us to</font><font color="#E5E5E5"> potentially escalate up to</font>

532
00:19:39,390 --> 00:19:45,090
a service<font color="#CCCCCC"> level account</font><font color="#E5E5E5"> on a domain and</font>

533
00:19:42,929 --> 00:19:47,250
then<font color="#E5E5E5"> SMB share plundering you guys come</font>

534
00:19:45,090 --> 00:19:49,100
across<font color="#E5E5E5"> this config files you come across</font>

535
00:19:47,250 --> 00:19:51,000
<font color="#E5E5E5">those database</font><font color="#CCCCCC"> animal files that</font>

536
00:19:49,100 --> 00:19:54,418
credentials haven't changed<font color="#E5E5E5"> since we</font>

537
00:19:51,000 --> 00:19:57,529
<font color="#CCCCCC">went</font><font color="#E5E5E5"> from dev QA to</font><font color="#CCCCCC"> prawn my favorite is</font>

538
00:19:54,419 --> 00:19:59,110
the notes txt you might know this as

539
00:19:57,529 --> 00:20:01,929
logins<font color="#CCCCCC"> Excel</font>

540
00:19:59,110 --> 00:20:03,580
<font color="#CCCCCC">Sara counts docx we always find</font><font color="#E5E5E5"> these</font>

541
00:20:01,929 --> 00:20:05,710
clear text passwords written<font color="#E5E5E5"> somewhere</font>

542
00:20:03,580 --> 00:20:08,080
around the network<font color="#CCCCCC"> but these just some</font>

543
00:20:05,710 --> 00:20:09,669
examples of ways<font color="#CCCCCC"> that we can move around</font>

544
00:20:08,080 --> 00:20:12,879
<font color="#E5E5E5">the network that isn't represented by a</font>

545
00:20:09,669 --> 00:20:14,320
bloodhound<font color="#E5E5E5"> so the kid that's context</font>

546
00:20:12,880 --> 00:20:17,649
gonna walk you through a really<font color="#E5E5E5"> simple</font>

547
00:20:14,320 --> 00:20:19,990
example penetration test engagement so

548
00:20:17,649 --> 00:20:22,809
let's say I've gone<font color="#CCCCCC"> on site I've fired</font>

549
00:20:19,990 --> 00:20:25,840
<font color="#E5E5E5">up Python responder</font><font color="#CCCCCC"> for a dissin</font>

550
00:20:22,809 --> 00:20:28,418
poisoning<font color="#E5E5E5"> for</font><font color="#CCCCCC"> from a BW pad I captured</font>

551
00:20:25,840 --> 00:20:31,959
and<font color="#E5E5E5"> cracked some in TM until</font><font color="#CCCCCC"> MB - hashes</font>

552
00:20:28,419 --> 00:20:34,000
and<font color="#CCCCCC"> I attained three accounts</font><font color="#E5E5E5"> cool so</font>

553
00:20:31,960 --> 00:20:35,889
<font color="#E5E5E5">now I asked myself what these accounts</font>

554
00:20:34,000 --> 00:20:37,750
what can I do now<font color="#CCCCCC"> that I couldn't do</font>

555
00:20:35,889 --> 00:20:38,769
before<font color="#CCCCCC"> what I have access to now that</font>

556
00:20:37,750 --> 00:20:41,169
couldn't<font color="#E5E5E5"> do before they didn't have</font>

557
00:20:38,769 --> 00:20:43,090
access<font color="#E5E5E5"> to you before maybe I take one of</font>

558
00:20:41,169 --> 00:20:44,470
<font color="#E5E5E5">those authenticated users query the</font>

559
00:20:43,090 --> 00:20:46,209
domain controller pull down a list<font color="#E5E5E5"> of</font>

560
00:20:44,470 --> 00:20:48,399
users<font color="#E5E5E5"> and do a password spray against a</font>

561
00:20:46,210 --> 00:20:51,070
subset of them<font color="#E5E5E5"> using fall 2017 because</font>

562
00:20:48,399 --> 00:20:54,250
<font color="#E5E5E5">it's gonna work and I get</font><font color="#CCCCCC"> access to</font><font color="#E5E5E5"> a</font>

563
00:20:51,070 --> 00:20:55,120
couple<font color="#E5E5E5"> more accounts so now I ask</font><font color="#CCCCCC"> myself</font>

564
00:20:54,250 --> 00:20:57,700
what<font color="#CCCCCC"> can I do</font>

565
00:20:55,120 --> 00:20:59,139
maybe<font color="#E5E5E5"> I revisit that list of users</font><font color="#CCCCCC"> I see</font>

566
00:20:57,700 --> 00:21:01,630
that one of<font color="#CCCCCC"> the</font><font color="#E5E5E5"> users</font><font color="#CCCCCC"> that I guess the</font>

567
00:20:59,139 --> 00:21:03,879
<font color="#CCCCCC">password for also has a local</font><font color="#E5E5E5"> admin</font>

568
00:21:01,630 --> 00:21:06,130
account<font color="#E5E5E5"> and there you reuse them that</font>

569
00:21:03,880 --> 00:21:09,070
same password for<font color="#CCCCCC"> the admin account</font>

570
00:21:06,130 --> 00:21:12,970
<font color="#E5E5E5">maybe the admin account has a man access</font>

571
00:21:09,070 --> 00:21:14,230
to that users workstation<font color="#E5E5E5"> so now -</font><font color="#CCCCCC"> -</font>

572
00:21:12,970 --> 00:21:16,570
<font color="#CCCCCC">fear of compromise are starting to</font>

573
00:21:14,230 --> 00:21:17,590
expand<font color="#CCCCCC"> I ask myself what</font><font color="#E5E5E5"> can I do now</font>

574
00:21:16,570 --> 00:21:19,330
that<font color="#CCCCCC"> I</font><font color="#E5E5E5"> couldn't</font><font color="#CCCCCC"> do</font><font color="#E5E5E5"> before</font>

575
00:21:17,590 --> 00:21:21,220
<font color="#CCCCCC">well I've admin access to the machine</font>

576
00:21:19,330 --> 00:21:23,230
<font color="#E5E5E5">maybe I'll use secret stuff from the</font><font color="#CCCCCC"> in</font>

577
00:21:21,220 --> 00:21:25,299
<font color="#CCCCCC">packet library to pull local account</font>

578
00:21:23,230 --> 00:21:28,299
hashes from<font color="#E5E5E5"> the remote host so I pull</font>

579
00:21:25,299 --> 00:21:30,570
down three local accounts<font color="#CCCCCC"> and here I'm</font>

580
00:21:28,299 --> 00:21:33,010
starting<font color="#CCCCCC"> to</font><font color="#E5E5E5"> deviate a little bit from</font>

581
00:21:30,570 --> 00:21:35,408
<font color="#E5E5E5">bloodhound and Active Directory</font><font color="#CCCCCC"> because</font>

582
00:21:33,010 --> 00:21:36,879
we're<font color="#E5E5E5"> talking</font><font color="#CCCCCC"> about local accounts</font><font color="#E5E5E5"> there</font>

583
00:21:35,409 --> 00:21:39,669
was a<font color="#E5E5E5"> really interesting talk at blue</font>

584
00:21:36,880 --> 00:21:40,899
hat Israel earlier this year by<font color="#E5E5E5"> marina</font>

585
00:21:39,669 --> 00:21:43,179
<font color="#CCCCCC">Simic</font><font color="#E5E5E5"> Avant</font><font color="#CCCCCC"> al-bari</font>

586
00:21:40,899 --> 00:21:45,250
where they explored this concept a

587
00:21:43,179 --> 00:21:47,950
little<font color="#E5E5E5"> deeper they called it the hidden</font>

588
00:21:45,250 --> 00:21:49,330
or invisible attack graphs<font color="#E5E5E5"> and you can</font>

589
00:21:47,950 --> 00:21:51,370
see why because<font color="#CCCCCC"> these local accounts</font>

590
00:21:49,330 --> 00:21:53,080
aren't necessarily<font color="#E5E5E5"> under the command of</font>

591
00:21:51,370 --> 00:21:54,850
a configuration<font color="#CCCCCC"> overlord like Active</font>

592
00:21:53,080 --> 00:21:57,689
Directory<font color="#CCCCCC"> you might</font><font color="#E5E5E5"> have to take</font><font color="#CCCCCC"> some</font>

593
00:21:54,850 --> 00:22:00,219
intrusive actions to get<font color="#E5E5E5"> these</font><font color="#CCCCCC"> details</font>

594
00:21:57,690 --> 00:22:01,750
now also talked about defenses one of

595
00:22:00,220 --> 00:22:03,130
them being<font color="#CCCCCC"> laps where</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> organization</font>

596
00:22:01,750 --> 00:22:06,460
has not heard<font color="#E5E5E5"> of so you take that rid</font>

597
00:22:03,130 --> 00:22:08,770
500 hash you pass it around<font color="#CCCCCC"> an L</font><font color="#E5E5E5"> axis is</font>

598
00:22:06,460 --> 00:22:10,960
<font color="#E5E5E5">just kind of</font><font color="#CCCCCC"> snowballed now obviously</font>

599
00:22:08,770 --> 00:22:12,580
this<font color="#CCCCCC"> is not going</font><font color="#E5E5E5"> to fit many or most</font>

600
00:22:10,960 --> 00:22:14,140
penetration<font color="#CCCCCC"> tests</font>

601
00:22:12,580 --> 00:22:17,529
<font color="#E5E5E5">but you can see how the framework holds</font>

602
00:22:14,140 --> 00:22:19,570
<font color="#E5E5E5">we own a set of nodes we look for our</font>

603
00:22:17,529 --> 00:22:22,210
spread of compromise<font color="#E5E5E5"> and then we take</font>

604
00:22:19,570 --> 00:22:24,070
<font color="#CCCCCC">another action</font><font color="#E5E5E5"> then we compromise maybe</font>

605
00:22:22,210 --> 00:22:25,419
another<font color="#E5E5E5"> set of nodes we look for our</font>

606
00:22:24,070 --> 00:22:26,769
spread of compromise<font color="#CCCCCC"> and we ask</font>

607
00:22:25,419 --> 00:22:29,049
ourselves what do we have<font color="#E5E5E5"> access to</font><font color="#CCCCCC"> now</font>

608
00:22:26,769 --> 00:22:31,090
<font color="#E5E5E5">that we didn't have before</font><font color="#CCCCCC"> where are</font>

609
00:22:29,049 --> 00:22:33,190
those deltas<font color="#E5E5E5"> in access because that's</font>

610
00:22:31,090 --> 00:22:33,850
where I want<font color="#E5E5E5"> to focus on those fringes</font>

611
00:22:33,190 --> 00:22:37,330
are where we're going to find

612
00:22:33,850 --> 00:22:40,000
interesting<font color="#CCCCCC"> things so that in mind we'll</font>

613
00:22:37,330 --> 00:22:43,149
use bloodhound answer a question<font color="#E5E5E5"> what a</font>

614
00:22:40,000 --> 00:22:45,639
set of nodes are owned or by some method

615
00:22:43,149 --> 00:22:48,279
or technique<font color="#E5E5E5"> what can i collaterally now</font>

616
00:22:45,639 --> 00:22:50,559
reach that couldn't before<font color="#CCCCCC"> I call it</font>

617
00:22:48,279 --> 00:22:54,519
wave<font color="#E5E5E5"> you call it a spread a compromise</font>

618
00:22:50,559 --> 00:22:56,200
<font color="#E5E5E5">or a sphere compromise same thing we're</font>

619
00:22:54,519 --> 00:22:58,840
gonna use<font color="#E5E5E5"> this notion that a node can</font><font color="#CCCCCC"> be</font>

620
00:22:56,200 --> 00:23:02,139
owned during a wave of compromise<font color="#CCCCCC"> to</font>

621
00:22:58,840 --> 00:23:03,899
<font color="#CCCCCC">build tension</font><font color="#E5E5E5"> queries my approach was</font>

622
00:23:02,139 --> 00:23:07,330
<font color="#CCCCCC">create two new</font><font color="#E5E5E5"> properties</font><font color="#CCCCCC"> owned in wave</font>

623
00:23:03,899 --> 00:23:09,370
and I set these on compromised nodes so

624
00:23:07,330 --> 00:23:10,570
you have the owned property it's<font color="#CCCCCC"> just</font>

625
00:23:09,370 --> 00:23:13,268
give me the math<font color="#CCCCCC"> of how you compromised</font>

626
00:23:10,570 --> 00:23:15,010
it so this could be<font color="#CCCCCC"> l bernard w pad you</font>

627
00:23:13,269 --> 00:23:15,299
fish them<font color="#CCCCCC"> pastor spray whatever it may</font>

628
00:23:15,010 --> 00:23:18,429
be

629
00:23:15,299 --> 00:23:20,620
wave is<font color="#E5E5E5"> gonna be the order in which you</font>

630
00:23:18,429 --> 00:23:23,139
compromise you set of nodes<font color="#E5E5E5"> so maybe</font>

631
00:23:20,620 --> 00:23:25,899
your<font color="#E5E5E5"> first action was</font><font color="#CCCCCC"> i'm</font><font color="#E5E5E5"> an</font><font color="#CCCCCC"> hour w poor</font>

632
00:23:23,139 --> 00:23:28,658
<font color="#CCCCCC">L&R NM B&S poisoning</font><font color="#E5E5E5"> that could be wave</font>

633
00:23:25,899 --> 00:23:32,889
<font color="#E5E5E5">1 if</font><font color="#CCCCCC"> pastor sprain was your next</font><font color="#E5E5E5"> action</font>

634
00:23:28,659 --> 00:23:36,880
<font color="#E5E5E5">I'd be wave 2 and</font><font color="#CCCCCC"> so on</font><font color="#E5E5E5"> now to do this</font>

635
00:23:32,889 --> 00:23:39,760
we have to<font color="#E5E5E5"> set some properties so let's</font>

636
00:23:36,880 --> 00:23:42,460
say<font color="#CCCCCC"> that we did our</font><font color="#E5E5E5"> element</font><font color="#CCCCCC"> or net</font>

637
00:23:39,760 --> 00:23:44,139
<font color="#CCCCCC">Mina's poisoning for</font><font color="#E5E5E5"> W pad we captured</font>

638
00:23:42,460 --> 00:23:46,120
and cracked hashes for<font color="#E5E5E5"> two users be</font>

639
00:23:44,139 --> 00:23:48,820
<font color="#CCCCCC">loper on the internal network or the</font>

640
00:23:46,120 --> 00:23:51,340
internal<font color="#CCCCCC"> domain and Jake our Neal this</font>

641
00:23:48,820 --> 00:23:53,049
<font color="#E5E5E5">is what the</font><font color="#CCCCCC"> cipher syntax</font><font color="#E5E5E5"> looks like so</font>

642
00:23:51,340 --> 00:23:55,269
we're going to match for our user with a

643
00:23:53,049 --> 00:23:56,620
specified<font color="#E5E5E5"> name that we know and then</font>

644
00:23:55,269 --> 00:23:59,309
instead of return anything<font color="#E5E5E5"> we're gonna</font>

645
00:23:56,620 --> 00:24:01,779
use a set<font color="#E5E5E5"> clause</font><font color="#CCCCCC"> and we can use set to</font>

646
00:23:59,309 --> 00:24:03,428
create these properties<font color="#E5E5E5"> so we have n dot</font>

647
00:24:01,779 --> 00:24:05,340
owned which we're going<font color="#E5E5E5"> to give it our</font>

648
00:24:03,429 --> 00:24:07,990
method<font color="#E5E5E5"> of compromise</font><font color="#CCCCCC"> oh man our</font><font color="#E5E5E5"> W pad</font>

649
00:24:05,340 --> 00:24:09,309
and we have n dot wave which is<font color="#CCCCCC"> the</font>

650
00:24:07,990 --> 00:24:10,630
order in<font color="#CCCCCC"> which we</font><font color="#E5E5E5"> compromise</font><font color="#CCCCCC"> it this</font><font color="#E5E5E5"> is</font>

651
00:24:09,309 --> 00:24:12,370
the first<font color="#E5E5E5"> action we took</font><font color="#CCCCCC"> visiting a part</font>

652
00:24:10,630 --> 00:24:15,549
of<font color="#CCCCCC"> the first wave</font><font color="#E5E5E5"> so we add both of</font>

653
00:24:12,370 --> 00:24:17,279
<font color="#CCCCCC">those</font><font color="#E5E5E5"> users</font><font color="#CCCCCC"> to our</font><font color="#E5E5E5"> first wave and if you</font>

654
00:24:15,549 --> 00:24:19,240
go back<font color="#CCCCCC"> over to</font><font color="#E5E5E5"> the bloodhound app</font>

655
00:24:17,279 --> 00:24:21,250
excuse me you can see that<font color="#E5E5E5"> these</font>

656
00:24:19,240 --> 00:24:24,159
properties<font color="#CCCCCC"> have been updated in the node</font>

657
00:24:21,250 --> 00:24:25,230
info<font color="#E5E5E5"> now this</font><font color="#CCCCCC"> isn't no the main</font>

658
00:24:24,159 --> 00:24:27,390
bloodhound app

659
00:24:25,230 --> 00:24:29,070
this is a fork of<font color="#E5E5E5"> the project because</font><font color="#CCCCCC"> if</font>

660
00:24:27,390 --> 00:24:30,660
you want to take if you want<font color="#E5E5E5"> to modify</font>

661
00:24:29,070 --> 00:24:31,830
anything<font color="#E5E5E5"> about the display here so if</font>

662
00:24:30,660 --> 00:24:33,900
you<font color="#E5E5E5"> gonna do something</font><font color="#CCCCCC"> like this or to</font>

663
00:24:31,830 --> 00:24:35,220
change<font color="#E5E5E5"> how nodes are laid out or</font>

664
00:24:33,900 --> 00:24:39,030
displayed

665
00:24:35,220 --> 00:24:41,460
it requires tweaking the source<font color="#CCCCCC"> it's</font>

666
00:24:39,030 --> 00:24:45,389
mostly react JavaScript<font color="#E5E5E5"> guess there's a</font>

667
00:24:41,460 --> 00:24:46,620
JavaScript developer<font color="#CCCCCC"> not me but</font><font color="#E5E5E5"> the code</font>

668
00:24:45,390 --> 00:24:47,760
is<font color="#CCCCCC"> written cleanly enough to where I</font>

669
00:24:46,620 --> 00:24:51,750
think<font color="#E5E5E5"> you can intuitively figure out</font>

670
00:24:47,760 --> 00:24:53,250
where<font color="#CCCCCC"> to make your</font><font color="#E5E5E5"> changes so we have</font>

671
00:24:51,750 --> 00:24:54,929
those two users<font color="#E5E5E5"> that we've compromised</font>

672
00:24:53,250 --> 00:24:59,280
<font color="#E5E5E5">we've owned now we want to see what our</font>

673
00:24:54,929 --> 00:25:01,590
<font color="#E5E5E5">wave or our collateral spread is so if</font>

674
00:24:59,280 --> 00:25:04,500
you look<font color="#CCCCCC"> at the</font><font color="#E5E5E5"> cipher at the top we're</font>

675
00:25:01,590 --> 00:25:05,850
starting at a node n<font color="#E5E5E5"> where n wave equals</font>

676
00:25:04,500 --> 00:25:08,070
<font color="#CCCCCC">1 so we're starting from</font><font color="#E5E5E5"> our</font><font color="#CCCCCC"> two green</font>

677
00:25:05,850 --> 00:25:11,219
users there and then we're gonna reach

678
00:25:08,070 --> 00:25:13,590
out<font color="#CCCCCC"> to</font><font color="#E5E5E5"> another node</font><font color="#CCCCCC"> M following any</font>

679
00:25:11,220 --> 00:25:14,250
number of<font color="#E5E5E5"> a relationships</font><font color="#CCCCCC"> basically from</font>

680
00:25:13,590 --> 00:25:16,709
these<font color="#E5E5E5"> two nodes</font>

681
00:25:14,250 --> 00:25:19,320
<font color="#E5E5E5">how far out can I go and return that</font>

682
00:25:16,710 --> 00:25:21,690
<font color="#E5E5E5">graph</font><font color="#CCCCCC"> to me you see that it</font><font color="#E5E5E5"> has domain</font>

683
00:25:19,320 --> 00:25:24,120
users on the internal domain<font color="#E5E5E5"> and this is</font>

684
00:25:21,690 --> 00:25:25,799
system 38 just admin that<font color="#CCCCCC"> one</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> user's</font>

685
00:25:24,120 --> 00:25:27,479
has access to so not<font color="#E5E5E5"> very interesting</font>

686
00:25:25,799 --> 00:25:30,629
<font color="#E5E5E5">but now there's two other nodes in</font><font color="#CCCCCC"> our</font>

687
00:25:27,480 --> 00:25:32,490
graph if you<font color="#E5E5E5"> copy and paste that site</font>

688
00:25:30,630 --> 00:25:36,510
for<font color="#E5E5E5"> query over</font><font color="#CCCCCC"> in the bloodhound app you</font>

689
00:25:32,490 --> 00:25:38,190
see pretty<font color="#E5E5E5"> much</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> same result now with</font>

690
00:25:36,510 --> 00:25:40,650
now that<font color="#CCCCCC"> we found those two other knows</font>

691
00:25:38,190 --> 00:25:43,100
that group and<font color="#E5E5E5"> that computer we want</font><font color="#CCCCCC"> to</font>

692
00:25:40,650 --> 00:25:45,720
<font color="#E5E5E5">add those two nodes into our first wave</font>

693
00:25:43,100 --> 00:25:46,709
so<font color="#E5E5E5"> we do that</font><font color="#CCCCCC"> by using the</font><font color="#E5E5E5"> same queries</font>

694
00:25:45,720 --> 00:25:48,330
<font color="#CCCCCC">before but instead of</font><font color="#E5E5E5"> returning</font>

695
00:25:46,710 --> 00:25:50,160
something<font color="#E5E5E5"> we're gonna set a property</font>

696
00:25:48,330 --> 00:25:52,799
we're gonna set<font color="#CCCCCC"> that wave property on</font>

697
00:25:50,160 --> 00:25:54,120
<font color="#E5E5E5">that group and on that computer</font><font color="#CCCCCC"> and this</font>

698
00:25:52,799 --> 00:25:56,370
<font color="#E5E5E5">is what that looks like</font><font color="#CCCCCC"> to in order to</font>

699
00:25:54,120 --> 00:25:58,379
<font color="#E5E5E5">do it and we have</font><font color="#CCCCCC"> a little sanity check</font>

700
00:25:56,370 --> 00:25:59,969
down here<font color="#CCCCCC"> at the bottom to display all</font>

701
00:25:58,380 --> 00:26:01,770
nodes that have that<font color="#E5E5E5"> wave property set</font>

702
00:25:59,970 --> 00:26:03,360
to<font color="#CCCCCC"> one so these four nodes were</font>

703
00:26:01,770 --> 00:26:08,370
basically compromised during<font color="#CCCCCC"> our first</font>

704
00:26:03,360 --> 00:26:10,110
<font color="#E5E5E5">action so let's say that we couldn't go</font>

705
00:26:08,370 --> 00:26:11,909
any<font color="#CCCCCC"> further with those four sets</font><font color="#E5E5E5"> of</font>

706
00:26:10,110 --> 00:26:13,860
nodes so we make<font color="#E5E5E5"> it</font><font color="#CCCCCC"> take</font><font color="#E5E5E5"> the next action</font>

707
00:26:11,910 --> 00:26:15,960
<font color="#E5E5E5">of doing the password spray and we</font>

708
00:26:13,860 --> 00:26:17,189
<font color="#E5E5E5">compromise two more accounts</font><font color="#CCCCCC"> see Devin's</font>

709
00:26:15,960 --> 00:26:19,679
on the internal network and<font color="#E5E5E5"> then be</font>

710
00:26:17,190 --> 00:26:22,080
pickerel so we<font color="#E5E5E5"> gotta set the properties</font>

711
00:26:19,679 --> 00:26:23,669
it's the sink where queries before<font color="#CCCCCC"> we've</font>

712
00:26:22,080 --> 00:26:26,520
now just<font color="#E5E5E5"> substituted in our new values</font>

713
00:26:23,669 --> 00:26:27,990
so the new<font color="#CCCCCC"> usernames</font><font color="#E5E5E5"> the new own method</font>

714
00:26:26,520 --> 00:26:30,660
we're doing a password spray instead<font color="#E5E5E5"> of</font>

715
00:26:27,990 --> 00:26:32,250
the poisoning<font color="#E5E5E5"> and then the wave random</font><font color="#CCCCCC"> -</font>

716
00:26:30,660 --> 00:26:35,280
is<font color="#CCCCCC"> - since this</font><font color="#E5E5E5"> is our second</font><font color="#CCCCCC"> action</font>

717
00:26:32,250 --> 00:26:37,860
that we've taken<font color="#E5E5E5"> now we go</font><font color="#CCCCCC"> back at a</font>

718
00:26:35,280 --> 00:26:38,610
bloodhound<font color="#CCCCCC"> we look at all the</font><font color="#E5E5E5"> the spread</font>

719
00:26:37,860 --> 00:26:40,290
of compromised

720
00:26:38,610 --> 00:26:43,500
these two nodes<font color="#E5E5E5"> and we see we have</font>

721
00:26:40,290 --> 00:26:45,420
<font color="#CCCCCC">access to a few</font><font color="#E5E5E5"> more things now it's</font>

722
00:26:43,500 --> 00:26:47,429
pretty cool<font color="#E5E5E5"> the problem is is that we</font>

723
00:26:45,420 --> 00:26:49,710
<font color="#CCCCCC">have these two nodes from the first wave</font>

724
00:26:47,429 --> 00:26:51,900
<font color="#CCCCCC">we</font><font color="#E5E5E5"> already knew about if you think about</font>

725
00:26:49,710 --> 00:26:53,460
this<font color="#E5E5E5"> that's scale</font><font color="#CCCCCC"> Allah that's going to</font>

726
00:26:51,900 --> 00:26:55,350
get lost in the noise of<font color="#E5E5E5"> what you had</font>

727
00:26:53,460 --> 00:26:57,240
<font color="#CCCCCC">access to and what's new to you because</font>

728
00:26:55,350 --> 00:27:00,360
of this<font color="#E5E5E5"> action</font><font color="#CCCCCC"> so we want to filter</font>

729
00:26:57,240 --> 00:27:02,850
those two out to do that we use this<font color="#E5E5E5"> a</font>

730
00:27:00,360 --> 00:27:04,949
function called<font color="#CCCCCC"> exist and what exists</font>

731
00:27:02,850 --> 00:27:07,199
does is that<font color="#E5E5E5"> you pass it in a node or a</font>

732
00:27:04,950 --> 00:27:08,370
property and<font color="#E5E5E5"> it's</font><font color="#CCCCCC"> gonna tell you it</font>

733
00:27:07,200 --> 00:27:11,190
gives<font color="#E5E5E5"> you this boolean responsive it</font>

734
00:27:08,370 --> 00:27:14,520
exists or not<font color="#E5E5E5"> it's pretty simple so we</font>

735
00:27:11,190 --> 00:27:16,410
have this and<font color="#CCCCCC"> Clause it says make sure</font>

736
00:27:14,520 --> 00:27:17,820
<font color="#E5E5E5">that these nodes don't have a wave</font>

737
00:27:16,410 --> 00:27:19,950
property that already exists if it does

738
00:27:17,820 --> 00:27:22,200
get rid of<font color="#E5E5E5"> them so we get rid of those</font>

739
00:27:19,950 --> 00:27:24,530
two<font color="#E5E5E5"> nodes from that previous graph</font><font color="#CCCCCC"> what</font>

740
00:27:22,200 --> 00:27:26,520
we're left<font color="#E5E5E5"> is left with is this graph</font>

741
00:27:24,530 --> 00:27:28,740
now we're<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to copy that</font><font color="#E5E5E5"> cipher</font>

742
00:27:26,520 --> 00:27:31,110
syntax change that return<font color="#E5E5E5"> Clause to a</font>

743
00:27:28,740 --> 00:27:35,100
set<font color="#E5E5E5"> clause and set a wave property for</font>

744
00:27:31,110 --> 00:27:37,229
all<font color="#CCCCCC"> those new nodes the result is a true</font>

745
00:27:35,100 --> 00:27:39,480
Delta<font color="#E5E5E5"> this is all the stuff</font><font color="#CCCCCC"> that you</font>

746
00:27:37,230 --> 00:27:41,490
<font color="#CCCCCC">have</font><font color="#E5E5E5"> access to now that you didn't have</font>

747
00:27:39,480 --> 00:27:43,410
access to<font color="#CCCCCC"> before because of your</font>

748
00:27:41,490 --> 00:27:45,150
<font color="#E5E5E5">password spring these are the things you</font>

749
00:27:43,410 --> 00:27:48,630
might<font color="#CCCCCC"> want to go investigate to keep</font>

750
00:27:45,150 --> 00:27:50,429
escalating or moving laterally now

751
00:27:48,630 --> 00:27:51,900
that's a lot<font color="#CCCCCC"> of</font><font color="#E5E5E5"> manual work so I took</font>

752
00:27:50,429 --> 00:27:54,330
the<font color="#CCCCCC"> approach of automating it with a</font>

753
00:27:51,900 --> 00:27:57,419
ruby script<font color="#CCCCCC"> it just talks to neo4j a</font>

754
00:27:54,330 --> 00:27:58,918
<font color="#E5E5E5">rest</font><font color="#CCCCCC"> api it's pretty</font><font color="#E5E5E5"> simple at the top</font>

755
00:27:57,419 --> 00:28:00,980
there you<font color="#E5E5E5"> see some of</font><font color="#CCCCCC"> the options for</font>

756
00:27:58,919 --> 00:28:04,500
connecting<font color="#CCCCCC"> to your neo4j database</font>

757
00:28:00,980 --> 00:28:06,299
<font color="#E5E5E5">everything below</font><font color="#CCCCCC"> that focus on these</font>

758
00:28:04,500 --> 00:28:08,100
extensions so right now we're looking<font color="#CCCCCC"> at</font>

759
00:28:06,299 --> 00:28:13,470
<font color="#E5E5E5">the owned and wave and shares password</font>

760
00:28:08,100 --> 00:28:15,480
with section we're<font color="#E5E5E5"> gonna walk</font><font color="#CCCCCC"> down</font><font color="#E5E5E5"> some</font>

761
00:28:13,470 --> 00:28:17,549
of<font color="#E5E5E5"> these</font><font color="#CCCCCC"> we'll touch on a few</font><font color="#E5E5E5"> of them</font>

762
00:28:15,480 --> 00:28:20,450
<font color="#E5E5E5">for now we're going to focus on that -</font>

763
00:28:17,549 --> 00:28:24,870
<font color="#CCCCCC">lower case a option this</font><font color="#E5E5E5"> is how we add</font>

764
00:28:20,450 --> 00:28:26,720
nodes to our database<font color="#E5E5E5"> so let's say our</font>

765
00:28:24,870 --> 00:28:29,010
<font color="#E5E5E5">next action with SMB share plundering</font>

766
00:28:26,720 --> 00:28:31,380
<font color="#E5E5E5">let's say we found two credentials for</font>

767
00:28:29,010 --> 00:28:32,820
users and<font color="#E5E5E5"> a file somewhere so we got s</font>

768
00:28:31,380 --> 00:28:35,520
<font color="#CCCCCC">maddox on the internal domain and q</font>

769
00:28:32,820 --> 00:28:36,780
bullets on the external<font color="#E5E5E5"> domain or q</font>

770
00:28:35,520 --> 00:28:39,418
bolts on the external s<font color="#CCCCCC"> Mattox on the</font>

771
00:28:36,780 --> 00:28:41,700
internal we put those into a file

772
00:28:39,419 --> 00:28:44,669
<font color="#CCCCCC">I just</font><font color="#E5E5E5"> got named it third wave dot txt</font>

773
00:28:41,700 --> 00:28:46,890
but<font color="#E5E5E5"> the format is the name of the node</font>

774
00:28:44,669 --> 00:28:48,809
<font color="#E5E5E5">comma and then</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> method</font><font color="#CCCCCC"> you used</font><font color="#E5E5E5"> to</font>

775
00:28:46,890 --> 00:28:50,160
compromise it<font color="#E5E5E5"> so let's say these two</font>

776
00:28:48,809 --> 00:28:52,020
users I found their credentials in a

777
00:28:50,160 --> 00:28:55,290
<font color="#E5E5E5">file I use</font><font color="#CCCCCC"> a - a</font>

778
00:28:52,020 --> 00:28:57,770
<font color="#E5E5E5">to add those in now there's kind</font><font color="#CCCCCC"> of a</font>

779
00:28:55,290 --> 00:28:59,940
<font color="#E5E5E5">lot going</font><font color="#CCCCCC"> on here underneath the</font><font color="#E5E5E5"> hood</font>

780
00:28:57,770 --> 00:29:02,129
<font color="#CCCCCC">but</font><font color="#E5E5E5"> cut</font><font color="#CCCCCC"> summarized here at the bottom</font>

781
00:28:59,940 --> 00:29:03,560
first<font color="#E5E5E5"> we create the cipher queries to</font>

782
00:29:02,130 --> 00:29:06,030
set the properties for<font color="#E5E5E5"> those two nodes</font>

783
00:29:03,560 --> 00:29:08,190
so we're<font color="#E5E5E5"> setting the</font><font color="#CCCCCC"> own property in the</font>

784
00:29:06,030 --> 00:29:09,660
wave property then we create<font color="#E5E5E5"> the cipher</font>

785
00:29:08,190 --> 00:29:12,600
query to<font color="#E5E5E5"> find our sprite</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> compromise</font>

786
00:29:09,660 --> 00:29:14,670
or that wave we wrap<font color="#CCCCCC"> it in JSON we post</font>

787
00:29:12,600 --> 00:29:16,820
it to the<font color="#CCCCCC"> REST API we get a response</font>

788
00:29:14,670 --> 00:29:19,740
<font color="#E5E5E5">back and we parse it and display it here</font>

789
00:29:16,820 --> 00:29:22,830
so we have two nodes domain users<font color="#E5E5E5"> on the</font>

790
00:29:19,740 --> 00:29:25,560
external<font color="#E5E5E5"> that local</font><font color="#CCCCCC"> an office for</font><font color="#E5E5E5"> an</font>

791
00:29:22,830 --> 00:29:26,879
<font color="#E5E5E5">internet local these are the nodes that</font>

792
00:29:25,560 --> 00:29:28,350
<font color="#E5E5E5">are now part</font><font color="#CCCCCC"> of our third wave that we</font>

793
00:29:26,880 --> 00:29:31,710
<font color="#E5E5E5">can collaterally reach that</font><font color="#CCCCCC"> we didn't</font>

794
00:29:28,350 --> 00:29:33,659
<font color="#E5E5E5">have access to before so if you go look</font>

795
00:29:31,710 --> 00:29:35,250
in bloodhound at this third wave<font color="#E5E5E5"> see</font>

796
00:29:33,660 --> 00:29:37,020
it's not<font color="#CCCCCC"> very interesting we</font><font color="#E5E5E5"> don't have</font>

797
00:29:35,250 --> 00:29:38,400
access<font color="#E5E5E5"> to much but you see that all</font><font color="#CCCCCC"> I</font>

798
00:29:37,020 --> 00:29:41,010
populated our properties there in the

799
00:29:38,400 --> 00:29:42,810
node<font color="#E5E5E5"> info and this forked repo the</font>

800
00:29:41,010 --> 00:29:44,520
problem is we still<font color="#CCCCCC"> have to write in our</font>

801
00:29:42,810 --> 00:29:47,460
own custom cipher query there at the

802
00:29:44,520 --> 00:29:50,010
bottom<font color="#E5E5E5"> now an update 1.2 bloodhound they</font>

803
00:29:47,460 --> 00:29:52,530
ability they added the ability<font color="#E5E5E5"> to define</font>

804
00:29:50,010 --> 00:29:53,910
your<font color="#E5E5E5"> own</font><font color="#CCCCCC"> custom queries and you</font><font color="#E5E5E5"> can see</font>

805
00:29:52,530 --> 00:29:56,610
the<font color="#CCCCCC"> paths for them here at the bottom</font>

806
00:29:53,910 --> 00:29:59,700
for<font color="#E5E5E5"> mac and</font><font color="#CCCCCC"> windows these</font><font color="#E5E5E5"> are</font><font color="#CCCCCC"> just json</font>

807
00:29:56,610 --> 00:30:02,129
files that have been decoupled from the

808
00:29:59,700 --> 00:30:04,230
<font color="#E5E5E5">source code so</font><font color="#CCCCCC"> as</font><font color="#E5E5E5"> you use bloodhound</font><font color="#CCCCCC"> and</font>

809
00:30:02,130 --> 00:30:06,480
make changes these files will<font color="#CCCCCC"> be</font>

810
00:30:04,230 --> 00:30:08,970
unaffected<font color="#E5E5E5"> here</font><font color="#CCCCCC"> i've got a few</font><font color="#E5E5E5"> examples</font>

811
00:30:06,480 --> 00:30:10,530
<font color="#E5E5E5">of those</font><font color="#CCCCCC"> who got fined all domain and</font>

812
00:30:08,970 --> 00:30:13,230
domain admin the shortest path from<font color="#CCCCCC"> own</font>

813
00:30:10,530 --> 00:30:14,580
notes bid to domain admins and a handful

814
00:30:13,230 --> 00:30:16,890
<font color="#E5E5E5">of</font><font color="#CCCCCC"> others</font><font color="#E5E5E5"> well we'll talk about a few of</font>

815
00:30:14,580 --> 00:30:19,919
<font color="#E5E5E5">them and there's a lot more</font><font color="#CCCCCC"> that we'll</font>

816
00:30:16,890 --> 00:30:21,750
<font color="#E5E5E5">talk about</font><font color="#CCCCCC"> too now in that custom query</font>

817
00:30:19,920 --> 00:30:24,120
<font color="#CCCCCC">is that JSON file it follows this kind</font>

818
00:30:21,750 --> 00:30:25,380
of syntax<font color="#E5E5E5"> you see an</font><font color="#CCCCCC"> example if you</font><font color="#E5E5E5"> look</font>

819
00:30:24,120 --> 00:30:27,570
<font color="#E5E5E5">in the source code repository for</font>

820
00:30:25,380 --> 00:30:30,870
bloodhound for the pre-built queries<font color="#E5E5E5"> a</font>

821
00:30:27,570 --> 00:30:32,340
JSON file you'll<font color="#E5E5E5"> see what's going on so</font>

822
00:30:30,870 --> 00:30:33,810
this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> query for find all own</font>

823
00:30:32,340 --> 00:30:35,459
domain admins<font color="#E5E5E5"> it's the same query as</font>

824
00:30:33,810 --> 00:30:39,690
before but<font color="#E5E5E5"> now</font><font color="#CCCCCC"> we only want to</font><font color="#E5E5E5"> start our</font>

825
00:30:35,460 --> 00:30:40,860
pass from my own node<font color="#E5E5E5"> the name is what</font>

826
00:30:39,690 --> 00:30:43,080
you<font color="#E5E5E5"> see displayed in the bloodhound UI</font>

827
00:30:40,860 --> 00:30:44,669
<font color="#E5E5E5">that required notes select means do I</font>

828
00:30:43,080 --> 00:30:47,399
want to prompt the<font color="#CCCCCC"> user for input before</font>

829
00:30:44,670 --> 00:30:50,190
<font color="#CCCCCC">I run this query and then the query</font><font color="#E5E5E5"> is</font>

830
00:30:47,400 --> 00:30:52,980
just a<font color="#E5E5E5"> cipher query itself</font><font color="#CCCCCC"> the allow</font>

831
00:30:50,190 --> 00:30:54,000
collapse means do I want to have don't

832
00:30:52,980 --> 00:30:55,260
want to have the ability<font color="#CCCCCC"> to just</font><font color="#E5E5E5"> have</font>

833
00:30:54,000 --> 00:30:56,670
<font color="#CCCCCC">all the notes</font><font color="#E5E5E5"> displayed or do one on the</font>

834
00:30:55,260 --> 00:30:58,860
collapse of<font color="#E5E5E5"> an a certain threshold</font><font color="#CCCCCC"> and</font>

835
00:30:56,670 --> 00:31:01,320
then<font color="#E5E5E5"> the</font><font color="#CCCCCC"> prop cesare kind of query</font>

836
00:30:58,860 --> 00:31:03,179
prompts or query parameters<font color="#CCCCCC"> if see we</font>

837
00:31:01,320 --> 00:31:05,310
<font color="#E5E5E5">have a name property there and</font>

838
00:31:03,180 --> 00:31:06,870
the regular<font color="#E5E5E5"> expression for domain admins</font>

839
00:31:05,310 --> 00:31:08,760
so it's fine<font color="#CCCCCC"> to main admins group it</font>

840
00:31:06,870 --> 00:31:11,129
takes that and<font color="#E5E5E5"> inserts it back up into</font>

841
00:31:08,760 --> 00:31:12,840
the query for that<font color="#E5E5E5"> name parameter you</font>

842
00:31:11,130 --> 00:31:14,850
see<font color="#E5E5E5"> there in</font><font color="#CCCCCC"> the curly brackets towards</font>

843
00:31:12,840 --> 00:31:20,580
the middle the reason we do that<font color="#CCCCCC"> just</font>

844
00:31:14,850 --> 00:31:22,949
<font color="#CCCCCC">for performance so let's see</font><font color="#E5E5E5"> you in</font>

845
00:31:20,580 --> 00:31:24,870
<font color="#E5E5E5">action</font><font color="#CCCCCC"> we have a fourth way let's say we</font>

846
00:31:22,950 --> 00:31:26,070
made me catch an account or<font color="#E5E5E5"> maybe that's</font>

847
00:31:24,870 --> 00:31:28,560
<font color="#E5E5E5">where gets a local account whatever</font><font color="#CCCCCC"> it</font>

848
00:31:26,070 --> 00:31:32,159
may have<font color="#CCCCCC"> been so we create</font><font color="#E5E5E5"> those two</font>

849
00:31:28,560 --> 00:31:36,060
nodes<font color="#E5E5E5"> we put them in a file with our own</font>

850
00:31:32,160 --> 00:31:38,460
<font color="#E5E5E5">method and then we add them via - a you</font>

851
00:31:36,060 --> 00:31:40,530
see the result there we have<font color="#CCCCCC"> 572 nodes</font>

852
00:31:38,460 --> 00:31:43,050
now be collaterally reach we hit a

853
00:31:40,530 --> 00:31:45,120
jackpot somewhere one of these nodes<font color="#E5E5E5"> had</font>

854
00:31:43,050 --> 00:31:46,620
an attack path maybe<font color="#CCCCCC"> got to da and</font><font color="#E5E5E5"> then</font>

855
00:31:45,120 --> 00:31:49,979
could<font color="#CCCCCC"> therefrom get to a bunch of</font><font color="#E5E5E5"> other</font>

856
00:31:46,620 --> 00:31:52,679
computers so if<font color="#CCCCCC"> you go</font><font color="#E5E5E5"> over</font><font color="#CCCCCC"> to the the</font>

857
00:31:49,980 --> 00:31:54,420
fork<font color="#E5E5E5"> tap you see run the custom query</font>

858
00:31:52,680 --> 00:31:55,920
<font color="#CCCCCC">fund I'll own domain admins again</font><font color="#E5E5E5"> this</font>

859
00:31:54,420 --> 00:31:58,020
is the one<font color="#E5E5E5"> that we</font><font color="#CCCCCC"> just</font><font color="#E5E5E5"> built is the</font>

860
00:31:55,920 --> 00:31:59,550
same as find all domain admins but now

861
00:31:58,020 --> 00:32:02,340
we're<font color="#E5E5E5"> only</font><font color="#CCCCCC"> seeing</font><font color="#E5E5E5"> it for our own nodes</font>

862
00:31:59,550 --> 00:32:04,530
<font color="#CCCCCC">and turns out</font><font color="#E5E5E5"> that B Griffin on the</font>

863
00:32:02,340 --> 00:32:07,290
<font color="#CCCCCC">external domain was a nested member of</font>

864
00:32:04,530 --> 00:32:09,000
the Dominions group one of<font color="#E5E5E5"> the changes</font>

865
00:32:07,290 --> 00:32:10,830
that<font color="#CCCCCC"> also made in this</font><font color="#E5E5E5"> app was that all</font>

866
00:32:09,000 --> 00:32:12,690
the nodes<font color="#E5E5E5"> that you've owned have this a</font>

867
00:32:10,830 --> 00:32:13,830
<font color="#E5E5E5">little magenta lightning bolt so it kind</font>

868
00:32:12,690 --> 00:32:18,840
of sticks<font color="#E5E5E5"> out to</font><font color="#CCCCCC"> you as you're running</font>

869
00:32:13,830 --> 00:32:21,360
<font color="#E5E5E5">these queries this is a modified version</font>

870
00:32:18,840 --> 00:32:22,620
of<font color="#CCCCCC"> find shortest path</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> Mattoon minions</font>

871
00:32:21,360 --> 00:32:24,990
but<font color="#E5E5E5"> now we're</font><font color="#CCCCCC"> doing</font><font color="#E5E5E5"> it</font><font color="#CCCCCC"> just from knows</font>

872
00:32:22,620 --> 00:32:28,409
that<font color="#E5E5E5"> have been owned by us so now as you</font>

873
00:32:24,990 --> 00:32:30,060
add nodes<font color="#E5E5E5"> that you've owned you can</font>

874
00:32:28,410 --> 00:32:31,950
quickly<font color="#E5E5E5"> run this one custom query and</font>

875
00:32:30,060 --> 00:32:33,899
find where those nodes<font color="#E5E5E5"> if any of them do</font>

876
00:32:31,950 --> 00:32:35,130
have<font color="#E5E5E5"> access to main</font><font color="#CCCCCC"> admins</font><font color="#E5E5E5"> so you see</font>

877
00:32:33,900 --> 00:32:37,170
<font color="#E5E5E5">there in the bottom left we have file</font>

878
00:32:35,130 --> 00:32:39,120
server<font color="#E5E5E5"> 6 which</font><font color="#CCCCCC"> is one</font><font color="#E5E5E5"> of</font><font color="#CCCCCC"> the nodes</font><font color="#E5E5E5"> from</font>

879
00:32:37,170 --> 00:32:42,060
<font color="#E5E5E5">our fourth wave on the right side we</font>

880
00:32:39,120 --> 00:32:43,320
have<font color="#E5E5E5"> B Griffin which was our our node</font>

881
00:32:42,060 --> 00:32:45,600
from<font color="#E5E5E5"> the fourth way to our user and</font>

882
00:32:43,320 --> 00:32:47,129
<font color="#E5E5E5">they're a member</font><font color="#CCCCCC"> you see their</font>

883
00:32:45,600 --> 00:32:50,610
respective paths<font color="#CCCCCC"> and domain admins on</font>

884
00:32:47,130 --> 00:32:52,890
the<font color="#E5E5E5"> external domain if you want to see</font>

885
00:32:50,610 --> 00:32:55,439
one specific waves<font color="#E5E5E5"> use a show wave query</font>

886
00:32:52,890 --> 00:32:57,450
<font color="#E5E5E5">it prompts you</font><font color="#CCCCCC"> for which know do you</font>

887
00:32:55,440 --> 00:32:59,070
want to<font color="#E5E5E5"> see if you select</font><font color="#CCCCCC"> two you see</font>

888
00:32:57,450 --> 00:33:00,150
the second wave<font color="#E5E5E5"> this</font><font color="#CCCCCC"> is the</font><font color="#E5E5E5"> same thing</font>

889
00:32:59,070 --> 00:33:02,460
that<font color="#E5E5E5"> you saw before just a little</font>

890
00:33:00,150 --> 00:33:04,290
different formatting<font color="#CCCCCC"> we have</font><font color="#E5E5E5"> this</font>

891
00:33:02,460 --> 00:33:07,170
highlight for Delta show Delta<font color="#E5E5E5"> for wave</font>

892
00:33:04,290 --> 00:33:09,120
as well<font color="#E5E5E5"> this is where when you choose a</font>

893
00:33:07,170 --> 00:33:11,760
certain wave it's gonna<font color="#E5E5E5"> highlight all</font>

894
00:33:09,120 --> 00:33:13,169
the nodes that<font color="#E5E5E5"> were new in that wave so</font>

895
00:33:11,760 --> 00:33:15,060
you see a<font color="#E5E5E5"> bunch of them have the magenta</font>

896
00:33:13,170 --> 00:33:16,490
<font color="#E5E5E5">lightning bolt towards the bottom</font><font color="#CCCCCC"> here</font>

897
00:33:15,060 --> 00:33:18,270
and<font color="#E5E5E5"> some of them towards the top don't</font>

898
00:33:16,490 --> 00:33:20,430
because those are the<font color="#E5E5E5"> guys</font><font color="#CCCCCC"> from</font><font color="#E5E5E5"> the</font>

899
00:33:18,270 --> 00:33:21,840
first wave<font color="#E5E5E5"> and I found this really</font>

900
00:33:20,430 --> 00:33:23,220
<font color="#E5E5E5">interesting because I could sit down</font>

901
00:33:21,840 --> 00:33:25,980
<font color="#E5E5E5">with a client</font><font color="#CCCCCC"> and do like an interactive</font>

902
00:33:23,220 --> 00:33:27,810
<font color="#E5E5E5">demo and</font><font color="#CCCCCC"> that could show them as I step</font>

903
00:33:25,980 --> 00:33:30,090
through the waves<font color="#CCCCCC"> kind of how</font><font color="#E5E5E5"> am</font><font color="#CCCCCC"> i</font>

904
00:33:27,810 --> 00:33:32,340
access expanded and they gave this I

905
00:33:30,090 --> 00:33:35,070
gave the the clients<font color="#CCCCCC"> kind of a real</font>

906
00:33:32,340 --> 00:33:39,090
tangible field or network<font color="#E5E5E5"> to see how was</font>

907
00:33:35,070 --> 00:33:42,780
compromised like this so now that we

908
00:33:39,090 --> 00:33:44,129
<font color="#E5E5E5">have that established</font><font color="#CCCCCC"> we can look at</font>

909
00:33:42,780 --> 00:33:46,530
some<font color="#E5E5E5"> of the password reuse with shared</font>

910
00:33:44,130 --> 00:33:48,150
<font color="#CCCCCC">password with so we talked about pass</font>

911
00:33:46,530 --> 00:33:50,490
reuse before and we talked about<font color="#E5E5E5"> these</font>

912
00:33:48,150 --> 00:33:52,380
<font color="#E5E5E5">four relationships</font><font color="#CCCCCC"> I wanted a way</font><font color="#E5E5E5"> to</font>

913
00:33:50,490 --> 00:33:53,910
represent password or use between nodes

914
00:33:52,380 --> 00:33:54,450
my approach was just to<font color="#E5E5E5"> create a new</font>

915
00:33:53,910 --> 00:33:57,330
relationship

916
00:33:54,450 --> 00:33:59,280
I call it shares password with<font color="#CCCCCC"> it's</font>

917
00:33:57,330 --> 00:34:02,490
<font color="#CCCCCC">between either</font><font color="#E5E5E5"> two users or two</font>

918
00:33:59,280 --> 00:34:05,250
computers so if<font color="#CCCCCC"> you</font><font color="#E5E5E5"> remember this graph</font>

919
00:34:02,490 --> 00:34:07,530
from before what if you<font color="#E5E5E5"> found that that</font>

920
00:34:05,250 --> 00:34:09,000
<font color="#E5E5E5">come that computer the application</font>

921
00:34:07,530 --> 00:34:12,120
development server<font color="#CCCCCC"> shared a password</font>

922
00:34:09,000 --> 00:34:13,290
with<font color="#CCCCCC"> the file server down there you see</font>

923
00:34:12,120 --> 00:34:15,239
it kind<font color="#E5E5E5"> of short-circuits our graph</font>

924
00:34:13,290 --> 00:34:17,100
right<font color="#CCCCCC"> it sound much simpler path and</font>

925
00:34:15,239 --> 00:34:19,290
gives us more<font color="#CCCCCC"> options for</font><font color="#E5E5E5"> how we might</font>

926
00:34:17,100 --> 00:34:21,060
get<font color="#E5E5E5"> to da same thing for the user if you</font>

927
00:34:19,290 --> 00:34:23,100
found<font color="#E5E5E5"> that beat</font><font color="#CCCCCC"> smith was sharing the</font>

928
00:34:21,060 --> 00:34:26,580
same password with as da account<font color="#E5E5E5"> now</font>

929
00:34:23,100 --> 00:34:27,960
it's a<font color="#E5E5E5"> pretty simple path the manual way</font>

930
00:34:26,580 --> 00:34:32,250
of doing this<font color="#CCCCCC"> of creating relationships</font>

931
00:34:27,960 --> 00:34:34,260
<font color="#CCCCCC">is it uses these</font><font color="#E5E5E5"> merge clauses there's</font>

932
00:34:32,250 --> 00:34:36,900
<font color="#E5E5E5">merge statements so imagine you have two</font>

933
00:34:34,260 --> 00:34:38,970
<font color="#E5E5E5">users be Reyes and</font><font color="#CCCCCC"> B</font><font color="#E5E5E5"> races admin account</font>

934
00:34:36,900 --> 00:34:40,350
which is a<font color="#CCCCCC"> bureau admin and they're</font>

935
00:34:38,969 --> 00:34:42,270
<font color="#CCCCCC">Steve</font><font color="#E5E5E5"> found they're sharing a password</font>

936
00:34:40,350 --> 00:34:43,739
so you match those two nodes you put

937
00:34:42,270 --> 00:34:46,290
them in variables called a and B and

938
00:34:43,739 --> 00:34:48,120
then<font color="#CCCCCC"> you use these merge statements to</font>

939
00:34:46,290 --> 00:34:50,219
create these<font color="#CCCCCC"> patterns emerge basically</font>

940
00:34:48,120 --> 00:34:54,870
says create this if it doesn't already

941
00:34:50,219 --> 00:34:57,359
exist<font color="#CCCCCC"> so we create the pattern from a</font>

942
00:34:54,870 --> 00:35:01,560
<font color="#CCCCCC">sure it's password with two</font><font color="#E5E5E5"> B and vice</font>

943
00:34:57,360 --> 00:35:03,870
versa<font color="#CCCCCC"> and we have it in</font><font color="#E5E5E5"> there you can</font>

944
00:35:01,560 --> 00:35:05,940
also do<font color="#E5E5E5"> this via the script which</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> the</font>

945
00:35:03,870 --> 00:35:08,009
automated way and much<font color="#CCCCCC"> faster</font><font color="#E5E5E5"> so using</font>

946
00:35:05,940 --> 00:35:09,680
<font color="#CCCCCC">dash S flag</font><font color="#E5E5E5"> this example we're looking</font>

947
00:35:08,010 --> 00:35:12,090
at common local administrator passwords

948
00:35:09,680 --> 00:35:13,649
somebody you found that<font color="#E5E5E5"> these four</font>

949
00:35:12,090 --> 00:35:15,540
computers were<font color="#E5E5E5"> sharing a local admin</font>

950
00:35:13,650 --> 00:35:17,640
password<font color="#E5E5E5"> put them all in</font><font color="#CCCCCC"> a file</font>

951
00:35:15,540 --> 00:35:19,020
pass that<font color="#E5E5E5"> file in with the dash</font><font color="#CCCCCC"> S flag</font>

952
00:35:17,640 --> 00:35:20,490
and it's going<font color="#E5E5E5"> to create</font><font color="#CCCCCC"> that shares</font>

953
00:35:19,020 --> 00:35:22,590
password with relationship between all

954
00:35:20,490 --> 00:35:24,029
those different nodes<font color="#CCCCCC"> I can use this</font>

955
00:35:22,590 --> 00:35:25,620
<font color="#CCCCCC">custom query for fine clusters of</font>

956
00:35:24,030 --> 00:35:28,010
<font color="#E5E5E5">password use just kind of visually see</font>

957
00:35:25,620 --> 00:35:30,560
those clusters

958
00:35:28,010 --> 00:35:33,470
but the cool<font color="#CCCCCC"> thing about this</font><font color="#E5E5E5"> is that</font>

959
00:35:30,560 --> 00:35:37,430
you now open<font color="#E5E5E5"> up more avenues and more</font>

960
00:35:33,470 --> 00:35:38,750
paths<font color="#CCCCCC"> for users to get or to</font><font color="#E5E5E5"> escalate</font><font color="#CCCCCC"> so</font>

961
00:35:37,430 --> 00:35:41,029
you see we<font color="#CCCCCC"> have</font><font color="#E5E5E5"> beer a is there in the</font>

962
00:35:38,750 --> 00:35:42,380
left<font color="#E5E5E5"> he shares a password with his admin</font>

963
00:35:41,030 --> 00:35:44,270
account which is a member of<font color="#E5E5E5"> a</font><font color="#CCCCCC"> group</font>

964
00:35:42,380 --> 00:35:45,770
that<font color="#E5E5E5"> group has admin access</font><font color="#CCCCCC"> to a</font>

965
00:35:44,270 --> 00:35:49,850
computer<font color="#CCCCCC"> that was part of that</font><font color="#E5E5E5"> cluster</font>

966
00:35:45,770 --> 00:35:51,530
<font color="#CCCCCC">of</font><font color="#E5E5E5"> common local administrators you hop</font>

967
00:35:49,850 --> 00:35:53,210
to<font color="#CCCCCC"> the next</font><font color="#E5E5E5"> computer and has a session</font>

968
00:35:51,530 --> 00:35:54,650
belong to a user<font color="#E5E5E5"> that's a nested member</font>

969
00:35:53,210 --> 00:35:57,470
or<font color="#E5E5E5"> that's a member of the</font><font color="#CCCCCC"> domain admins</font>

970
00:35:54,650 --> 00:35:59,000
group pretty<font color="#CCCCCC"> cool you can see some of</font>

971
00:35:57,470 --> 00:36:00,770
<font color="#CCCCCC">our friends from</font><font color="#E5E5E5"> earlier wave so Z</font>

972
00:35:59,000 --> 00:36:01,490
<font color="#E5E5E5">Devon's from wave 2 and</font><font color="#CCCCCC"> B Loper from</font>

973
00:36:00,770 --> 00:36:04,610
wave 1

974
00:36:01,490 --> 00:36:06,560
they now have a path<font color="#E5E5E5"> da because a</font>

975
00:36:04,610 --> 00:36:11,690
password reuse and now we can represent

976
00:36:06,560 --> 00:36:14,090
<font color="#E5E5E5">that in</font><font color="#CCCCCC"> bloodhound blacklisting so as</font>

977
00:36:11,690 --> 00:36:16,640
you've got data ingested<font color="#E5E5E5"> and you start</font>

978
00:36:14,090 --> 00:36:18,170
running<font color="#CCCCCC"> these queries you might come</font>

979
00:36:16,640 --> 00:36:21,589
<font color="#CCCCCC">across</font><font color="#E5E5E5"> a case where you see</font><font color="#CCCCCC"> a pattern</font>

980
00:36:18,170 --> 00:36:23,750
<font color="#E5E5E5">like</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> you're like</font><font color="#CCCCCC"> cool I</font><font color="#E5E5E5"> own no Jade</font>

981
00:36:21,590 --> 00:36:25,430
<font color="#CCCCCC">oh</font><font color="#E5E5E5"> let's go over to the application</font>

982
00:36:23,750 --> 00:36:26,570
development server and grab the session

983
00:36:25,430 --> 00:36:29,359
<font color="#E5E5E5">from it but you find that computers</font>

984
00:36:26,570 --> 00:36:31,280
offline maybe you can't reach it maybe

985
00:36:29,360 --> 00:36:35,390
the<font color="#E5E5E5"> ports have been shut down whatever</font>

986
00:36:31,280 --> 00:36:36,620
<font color="#CCCCCC">it</font><font color="#E5E5E5"> may be</font><font color="#CCCCCC"> or maybe find that the session</font>

987
00:36:35,390 --> 00:36:38,779
<font color="#CCCCCC">that you want to grab has been expired</font>

988
00:36:36,620 --> 00:36:40,100
<font color="#E5E5E5">or just doesn't</font><font color="#CCCCCC"> live there anymore or</font>

989
00:36:38,780 --> 00:36:42,110
maybe<font color="#CCCCCC"> you see that that user accounts</font>

990
00:36:40,100 --> 00:36:48,140
disabled<font color="#E5E5E5"> and you can't take advantage of</font>

991
00:36:42,110 --> 00:36:50,600
<font color="#E5E5E5">it yet the approach here was to add a</font>

992
00:36:48,140 --> 00:36:52,370
new property<font color="#CCCCCC"> to handle blacklist</font><font color="#E5E5E5"> now you</font>

993
00:36:50,600 --> 00:36:53,930
could remove these nodes entirely<font color="#E5E5E5"> or the</font>

994
00:36:52,370 --> 00:36:56,290
relationships entirely but<font color="#E5E5E5"> you might</font>

995
00:36:53,930 --> 00:36:58,669
want<font color="#CCCCCC"> to save them</font><font color="#E5E5E5"> for whatever reason</font>

996
00:36:56,290 --> 00:37:00,380
<font color="#E5E5E5">the problem with bloodhound is if you</font>

997
00:36:58,670 --> 00:37:01,700
come across this where these

998
00:37:00,380 --> 00:37:03,380
<font color="#E5E5E5">relationships</font><font color="#CCCCCC"> or nodes aren't available</font>

999
00:37:01,700 --> 00:37:05,419
<font color="#CCCCCC">to you but</font><font color="#E5E5E5"> you keep running the queries</font>

1000
00:37:03,380 --> 00:37:08,420
<font color="#E5E5E5">it's still going to</font><font color="#CCCCCC"> traverse those paths</font>

1001
00:37:05,420 --> 00:37:10,090
<font color="#E5E5E5">and you</font><font color="#CCCCCC"> want to filter those out so my</font>

1002
00:37:08,420 --> 00:37:13,190
<font color="#E5E5E5">approach I create that blacklist</font>

1003
00:37:10,090 --> 00:37:16,130
property you can add it<font color="#E5E5E5"> via two ways one</font>

1004
00:37:13,190 --> 00:37:18,560
via the UI<font color="#E5E5E5"> so if you right click on</font><font color="#CCCCCC"> a</font>

1005
00:37:16,130 --> 00:37:20,600
node in the UI<font color="#E5E5E5"> it brings up this tooltip</font>

1006
00:37:18,560 --> 00:37:22,880
and<font color="#E5E5E5"> you can just select blacklist and</font>

1007
00:37:20,600 --> 00:37:24,799
<font color="#CCCCCC">I'll add the notes of the blacklist</font><font color="#E5E5E5"> if</font>

1008
00:37:22,880 --> 00:37:26,660
you use the script<font color="#CCCCCC"> you can</font><font color="#E5E5E5"> add a lot</font><font color="#CCCCCC"> of</font>

1009
00:37:24,800 --> 00:37:28,730
nodes at once<font color="#CCCCCC"> use create</font><font color="#E5E5E5"> text file with</font>

1010
00:37:26,660 --> 00:37:32,660
the<font color="#E5E5E5"> name</font><font color="#CCCCCC"> of the node on a new line</font>

1011
00:37:28,730 --> 00:37:34,550
delimited file<font color="#CCCCCC"> pass that envía - B and</font>

1012
00:37:32,660 --> 00:37:37,129
it's going<font color="#E5E5E5"> to create that</font><font color="#CCCCCC"> blacklist</font>

1013
00:37:34,550 --> 00:37:38,390
property for each of those nodes<font color="#E5E5E5"> now the</font>

1014
00:37:37,130 --> 00:37:40,370
way<font color="#CCCCCC"> to</font><font color="#E5E5E5"> actually incorporate</font><font color="#CCCCCC"> that into</font>

1015
00:37:38,390 --> 00:37:41,770
the queries<font color="#E5E5E5"> here we see an example</font><font color="#CCCCCC"> to</font>

1016
00:37:40,370 --> 00:37:43,700
<font color="#E5E5E5">find all domain admins</font>

1017
00:37:41,770 --> 00:37:45,920
this is what it looks like<font color="#E5E5E5"> with</font>

1018
00:37:43,700 --> 00:37:47,808
<font color="#E5E5E5">blacklisting enabled so the first line</font>

1019
00:37:45,920 --> 00:37:49,700
<font color="#E5E5E5">and the bottom</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> the last line are</font>

1020
00:37:47,809 --> 00:37:52,849
still the same<font color="#CCCCCC"> we've</font><font color="#E5E5E5"> added in these two</font>

1021
00:37:49,700 --> 00:37:55,359
new clauses<font color="#E5E5E5"> so we have where none</font><font color="#CCCCCC"> X and</font>

1022
00:37:52,849 --> 00:37:57,049
<font color="#CCCCCC">nodes P</font><font color="#E5E5E5"> where exists X</font><font color="#CCCCCC"> out blacklist</font>

1023
00:37:55,359 --> 00:37:58,730
<font color="#E5E5E5">basically we're going to</font><font color="#CCCCCC"> iterate through</font>

1024
00:37:57,049 --> 00:38:00,980
<font color="#E5E5E5">those paths so domain admins</font><font color="#CCCCCC"> that we</font>

1025
00:37:58,730 --> 00:38:02,390
<font color="#E5E5E5">found we're gonna look at each of the</font>

1026
00:38:00,980 --> 00:38:04,490
<font color="#E5E5E5">nodes in there if any of the nodes have</font>

1027
00:38:02,390 --> 00:38:06,920
that<font color="#E5E5E5"> blacklist property set we're gonna</font>

1028
00:38:04,490 --> 00:38:08,509
<font color="#E5E5E5">toss out that path my results we do the</font>

1029
00:38:06,920 --> 00:38:10,190
same<font color="#E5E5E5"> thing with relationships we look at</font>

1030
00:38:08,510 --> 00:38:13,520
each<font color="#E5E5E5"> relationship in that path P from</font>

1031
00:38:10,190 --> 00:38:16,160
<font color="#CCCCCC">two domain admins we filter out any of</font>

1032
00:38:13,520 --> 00:38:20,390
the paths that<font color="#CCCCCC"> have a relationship with</font>

1033
00:38:16,160 --> 00:38:22,190
the blacklist<font color="#E5E5E5"> property set I've</font>

1034
00:38:20,390 --> 00:38:24,740
incorporated this logic and it's a lot

1035
00:38:22,190 --> 00:38:25,940
<font color="#E5E5E5">of my custom queries if you want to see</font>

1036
00:38:24,740 --> 00:38:27,229
the<font color="#E5E5E5"> black list have some queries for</font>

1037
00:38:25,940 --> 00:38:29,089
that<font color="#CCCCCC"> too</font><font color="#E5E5E5"> so you see some notes here</font><font color="#CCCCCC"> that</font>

1038
00:38:27,230 --> 00:38:30,170
<font color="#E5E5E5">I've either</font><font color="#CCCCCC"> add</font><font color="#E5E5E5"> the note to the black</font>

1039
00:38:29,089 --> 00:38:32,990
list<font color="#E5E5E5"> so you can see the relationships</font>

1040
00:38:30,170 --> 00:38:34,789
I've been<font color="#E5E5E5"> add to the black list and last</font>

1041
00:38:32,990 --> 00:38:36,788
one<font color="#CCCCCC"> integrating network connections this</font>

1042
00:38:34,789 --> 00:38:39,770
seemed like<font color="#CCCCCC"> a logical next step for</font>

1043
00:38:36,789 --> 00:38:41,630
where I see bloodhound going especially

1044
00:38:39,770 --> 00:38:44,030
<font color="#CCCCCC">using this graph</font><font color="#E5E5E5"> database is kinda like</font>

1045
00:38:41,630 --> 00:38:46,849
a social<font color="#CCCCCC"> network so</font><font color="#E5E5E5"> imagine</font><font color="#CCCCCC"> that you're</font>

1046
00:38:44,030 --> 00:38:48,079
in<font color="#E5E5E5"> a post exploitation scenario where</font>

1047
00:38:46,849 --> 00:38:49,970
you've already compromised a bunch of

1048
00:38:48,079 --> 00:38:51,410
<font color="#CCCCCC">machines maybe even in domain and you're</font>

1049
00:38:49,970 --> 00:38:54,049
looking for ways<font color="#CCCCCC"> that</font><font color="#E5E5E5"> you might want to</font>

1050
00:38:51,410 --> 00:38:56,118
<font color="#E5E5E5">pivot out</font><font color="#CCCCCC"> of that network</font><font color="#E5E5E5"> and maybe by</font>

1051
00:38:54,049 --> 00:38:57,950
tech bypass segmentation boundaries<font color="#E5E5E5"> you</font>

1052
00:38:56,119 --> 00:39:00,049
<font color="#E5E5E5">looking for jump boxes looking for</font>

1053
00:38:57,950 --> 00:39:03,288
<font color="#E5E5E5">avenues where you can abuse your access</font>

1054
00:39:00,049 --> 00:39:05,480
to get<font color="#E5E5E5"> to other secure environments now</font>

1055
00:39:03,289 --> 00:39:06,859
that's that data is a<font color="#E5E5E5"> goldmine because</font>

1056
00:39:05,480 --> 00:39:09,799
you can find really<font color="#CCCCCC"> interesting things</font>

1057
00:39:06,859 --> 00:39:12,470
like<font color="#E5E5E5"> web apps on various like 80 and 443</font>

1058
00:39:09,799 --> 00:39:15,319
<font color="#E5E5E5">other various ports</font><font color="#CCCCCC"> remote access</font>

1059
00:39:12,470 --> 00:39:17,779
services like<font color="#CCCCCC"> Association RDP or like</font>

1060
00:39:15,319 --> 00:39:22,069
databases<font color="#E5E5E5"> you might see this with ms SQL</font>

1061
00:39:17,779 --> 00:39:24,559
or<font color="#E5E5E5"> Oracle</font><font color="#CCCCCC"> wherever maybe now the problem</font>

1062
00:39:22,069 --> 00:39:26,029
here is that typically we run<font color="#CCCCCC"> netstat</font>

1063
00:39:24,559 --> 00:39:28,579
you're just getting IP addresses back

1064
00:39:26,029 --> 00:39:31,160
and bloodhound does not store by default

1065
00:39:28,579 --> 00:39:32,000
IP addresses in this database<font color="#E5E5E5"> now</font>

1066
00:39:31,160 --> 00:39:34,910
there's a few<font color="#E5E5E5"> different</font><font color="#CCCCCC"> ways you</font><font color="#E5E5E5"> could</font>

1067
00:39:32,000 --> 00:39:36,680
<font color="#E5E5E5">tackle this</font><font color="#CCCCCC"> you could run net stat with</font>

1068
00:39:34,910 --> 00:39:39,379
to do name resolution<font color="#CCCCCC"> and work off that</font>

1069
00:39:36,680 --> 00:39:41,990
data you could write your<font color="#CCCCCC"> own collection</font>

1070
00:39:39,380 --> 00:39:43,160
<font color="#E5E5E5">method for char pound so it actually</font>

1071
00:39:41,990 --> 00:39:45,558
<font color="#E5E5E5">pulled in IP addresses when you're</font>

1072
00:39:43,160 --> 00:39:47,328
querying computers if you're lazy<font color="#E5E5E5"> like</font>

1073
00:39:45,559 --> 00:39:49,460
me<font color="#E5E5E5"> you just take that list of computers</font>

1074
00:39:47,329 --> 00:39:52,520
use<font color="#CCCCCC"> nmap resolve</font><font color="#E5E5E5"> those back to IP</font>

1075
00:39:49,460 --> 00:39:54,910
addresses<font color="#CCCCCC"> and then</font><font color="#E5E5E5"> I created a file here</font>

1076
00:39:52,520 --> 00:39:57,579
it's called<font color="#E5E5E5"> DNS mappings txt but space</font>

1077
00:39:54,910 --> 00:39:59,799
just an IP address<font color="#CCCCCC"> comma in the name of</font>

1078
00:39:57,579 --> 00:40:01,089
the node her name of the<font color="#E5E5E5"> computer I'm</font>

1079
00:39:59,799 --> 00:40:04,720
<font color="#E5E5E5">gonna use this file and do some name</font>

1080
00:40:01,089 --> 00:40:07,750
resolution<font color="#E5E5E5"> so that's how we translate a</font>

1081
00:40:04,720 --> 00:40:09,220
<font color="#E5E5E5">netstat record into a cipher query so</font>

1082
00:40:07,750 --> 00:40:12,430
here we look at<font color="#CCCCCC"> example we have a user</font>

1083
00:40:09,220 --> 00:40:14,828
connecting to a server<font color="#E5E5E5"> on port 3389 we</font>

1084
00:40:12,430 --> 00:40:17,649
pull out that source IP address<font color="#CCCCCC"> we pull</font>

1085
00:40:14,829 --> 00:40:20,680
out it we pull that<font color="#E5E5E5"> source IP address we</font>

1086
00:40:17,650 --> 00:40:22,089
pull out<font color="#CCCCCC"> the destination IP address</font><font color="#E5E5E5"> we</font>

1087
00:40:20,680 --> 00:40:25,029
use our mappings file to translate those

1088
00:40:22,089 --> 00:40:27,430
<font color="#E5E5E5">a host names we then put that into the</font>

1089
00:40:25,030 --> 00:40:29,380
source node for that particular host

1090
00:40:27,430 --> 00:40:30,759
<font color="#E5E5E5">name destination now we</font><font color="#CCCCCC"> substitute in</font>

1091
00:40:29,380 --> 00:40:33,069
the name<font color="#CCCCCC"> of the disk of that of that</font>

1092
00:40:30,760 --> 00:40:34,960
computer<font color="#CCCCCC"> and in the middle I've created</font>

1093
00:40:33,069 --> 00:40:36,880
relationship that's connected underscore

1094
00:40:34,960 --> 00:40:38,799
<font color="#E5E5E5">and then the port number so</font><font color="#CCCCCC"> in this case</font>

1095
00:40:36,880 --> 00:40:42,069
<font color="#E5E5E5">3</font><font color="#CCCCCC"> 389 so</font><font color="#E5E5E5"> I'm currently creating a</font>

1096
00:40:38,799 --> 00:40:45,369
relationship<font color="#E5E5E5"> from desktop 7 to</font>

1097
00:40:42,069 --> 00:40:46,869
<font color="#E5E5E5">management 3 via 3389 and this is what</font>

1098
00:40:45,369 --> 00:40:50,980
the resulting graph<font color="#E5E5E5"> looks like for this</font>

1099
00:40:46,869 --> 00:40:53,289
<font color="#CCCCCC">particular query this is how you do it</font>

1100
00:40:50,980 --> 00:40:55,390
in the script itself<font color="#E5E5E5"> so we have the</font>

1101
00:40:53,289 --> 00:40:56,920
<font color="#CCCCCC">gnash CD options the net</font><font color="#E5E5E5"> staffs would be</font>

1102
00:40:55,390 --> 00:40:59,200
our -<font color="#E5E5E5"> sea for our connections</font>

1103
00:40:56,920 --> 00:41:00,549
you see example at the top -<font color="#E5E5E5"> D is going</font>

1104
00:40:59,200 --> 00:41:02,109
<font color="#E5E5E5">to be our DNS mappings you see there in</font>

1105
00:41:00,549 --> 00:41:04,240
the<font color="#E5E5E5"> middle</font><font color="#CCCCCC"> and then we pass those two</font>

1106
00:41:02,109 --> 00:41:07,450
files into blood<font color="#CCCCCC"> to the script</font><font color="#E5E5E5"> and</font>

1107
00:41:04,240 --> 00:41:08,828
<font color="#E5E5E5">parses amount as 158 connections and now</font>

1108
00:41:07,450 --> 00:41:10,598
we have<font color="#E5E5E5"> data</font><font color="#CCCCCC"> in the database like this</font>

1109
00:41:08,829 --> 00:41:12,760
you can see on the left some<font color="#E5E5E5"> other</font>

1110
00:41:10,599 --> 00:41:16,450
custom queries I've created<font color="#E5E5E5"> for some of</font>

1111
00:41:12,760 --> 00:41:20,200
the more<font color="#E5E5E5"> interesting ports SSH</font><font color="#CCCCCC"> RDP</font><font color="#E5E5E5"> SMB</font>

1112
00:41:16,450 --> 00:41:21,609
whoever may<font color="#CCCCCC"> be here is a 33</font><font color="#E5E5E5"> d9 commonly</font>

1113
00:41:20,200 --> 00:41:25,058
associated with LDAP and<font color="#E5E5E5"> you kind of see</font>

1114
00:41:21,609 --> 00:41:26,920
this<font color="#E5E5E5"> LDAP hierarchy being built</font><font color="#CCCCCC"> 4 4</font><font color="#E5E5E5"> 4 5</font>

1115
00:41:25,059 --> 00:41:29,440
<font color="#E5E5E5">you can see</font><font color="#CCCCCC"> this guy interesting master</font>

1116
00:41:26,920 --> 00:41:30,549
<font color="#E5E5E5">4 4 5 connections for web apps</font>

1117
00:41:29,440 --> 00:41:32,680
I found this<font color="#CCCCCC"> brilliant scheme</font><font color="#E5E5E5"> because</font>

1118
00:41:30,549 --> 00:41:34,690
you have the left column there<font color="#E5E5E5"> if you</font>

1119
00:41:32,680 --> 00:41:36,970
can't read this left or right<font color="#CCCCCC"> computer's</font>

1120
00:41:34,690 --> 00:41:39,250
<font color="#E5E5E5">initiating connection via web port</font><font color="#CCCCCC"> 2</font><font color="#E5E5E5"> the</font>

1121
00:41:36,970 --> 00:41:40,660
second<font color="#CCCCCC"> column of computers and then some</font>

1122
00:41:39,250 --> 00:41:42,549
of those are going<font color="#CCCCCC"> to a third</font><font color="#E5E5E5"> column or</font>

1123
00:41:40,660 --> 00:41:44,470
even a fourth column so<font color="#E5E5E5"> you see this</font>

1124
00:41:42,549 --> 00:41:46,809
chain of<font color="#E5E5E5"> web app connections and then</font>

1125
00:41:44,470 --> 00:41:48,549
use and this kind of screams to me<font color="#E5E5E5"> we've</font>

1126
00:41:46,809 --> 00:41:52,390
got<font color="#E5E5E5"> a proxy</font><font color="#CCCCCC"> or maybe a load balancer in</font>

1127
00:41:48,549 --> 00:41:54,038
place and then I see connected<font color="#CCCCCC"> 82 me as</font>

1128
00:41:52,390 --> 00:41:55,720
an attacker<font color="#E5E5E5"> that looks like a juicy spot</font>

1129
00:41:54,039 --> 00:41:57,970
to go hit maybe<font color="#CCCCCC"> I can</font><font color="#E5E5E5"> get some clear</font>

1130
00:41:55,720 --> 00:42:01,689
text data as<font color="#CCCCCC"> it's traversing</font><font color="#E5E5E5"> this</font>

1131
00:41:57,970 --> 00:42:03,819
<font color="#CCCCCC">particular machine</font><font color="#E5E5E5"> now that's all well</font>

1132
00:42:01,690 --> 00:42:05,980
<font color="#CCCCCC">and good but I want to marry netstat</font>

1133
00:42:03,819 --> 00:42:08,230
connection<font color="#E5E5E5"> data to my attack graph data</font>

1134
00:42:05,980 --> 00:42:09,730
<font color="#E5E5E5">and this might</font><font color="#CCCCCC"> be</font><font color="#E5E5E5"> one</font><font color="#CCCCCC"> way to do</font><font color="#E5E5E5"> it</font>

1135
00:42:08,230 --> 00:42:11,710
so it's<font color="#E5E5E5"> kind of a long query</font><font color="#CCCCCC"> by broke</font><font color="#E5E5E5"> up</font>

1136
00:42:09,730 --> 00:42:14,339
<font color="#E5E5E5">in two sections on the</font><font color="#CCCCCC"> left side</font><font color="#E5E5E5"> we have</font>

1137
00:42:11,710 --> 00:42:16,839
<font color="#E5E5E5">kind</font><font color="#CCCCCC"> of a simple</font><font color="#E5E5E5"> derivative local admin</font>

1138
00:42:14,339 --> 00:42:19,089
so we're<font color="#CCCCCC"> batching a path P that starts</font>

1139
00:42:16,839 --> 00:42:20,980
at a node<font color="#CCCCCC"> that goes to a computer that</font>

1140
00:42:19,089 --> 00:42:22,869
traverses any number of admin tubes and

1141
00:42:20,980 --> 00:42:24,670
member of x' when it ends at<font color="#E5E5E5"> that</font>

1142
00:42:22,869 --> 00:42:26,470
computer node<font color="#CCCCCC"> I want to know from</font><font color="#E5E5E5"> that</font>

1143
00:42:24,670 --> 00:42:30,180
<font color="#E5E5E5">computer node can I by talking to</font><font color="#CCCCCC"> a</font>

1144
00:42:26,470 --> 00:42:33,910
kneeler<font color="#CCCCCC"> of computers via RDP the result</font>

1145
00:42:30,180 --> 00:42:35,290
<font color="#E5E5E5">looks like that but now we've you see on</font>

1146
00:42:33,910 --> 00:42:36,940
the top<font color="#CCCCCC"> left</font><font color="#E5E5E5"> we</font><font color="#CCCCCC"> have some of our groups</font>

1147
00:42:35,290 --> 00:42:39,099
and<font color="#CCCCCC"> users the Sonoma escalation paths</font>

1148
00:42:36,940 --> 00:42:41,440
and then they're ending<font color="#E5E5E5"> at these</font>

1149
00:42:39,099 --> 00:42:42,310
computers<font color="#E5E5E5"> if you remove the labels</font><font color="#CCCCCC"> you</font>

1150
00:42:41,440 --> 00:42:43,990
<font color="#CCCCCC">can kind of see this</font><font color="#E5E5E5"> interesting</font>

1151
00:42:42,310 --> 00:42:45,310
relationship<font color="#CCCCCC"> pop-up where you</font><font color="#E5E5E5"> have a</font>

1152
00:42:43,990 --> 00:42:47,348
<font color="#E5E5E5">computer that's connected to another</font>

1153
00:42:45,310 --> 00:42:49,630
<font color="#E5E5E5">computer and then from</font><font color="#CCCCCC"> that computer</font>

1154
00:42:47,349 --> 00:42:54,010
<font color="#E5E5E5">connecting</font><font color="#CCCCCC"> out to other computers via</font>

1155
00:42:49,630 --> 00:42:56,380
3389<font color="#E5E5E5"> this is kind of like a jump box</font><font color="#CCCCCC"> and</font>

1156
00:42:54,010 --> 00:42:57,609
so it screams out<font color="#E5E5E5"> to me so basically</font>

1157
00:42:56,380 --> 00:42:59,740
what<font color="#E5E5E5"> this query we've created an</font>

1158
00:42:57,609 --> 00:43:01,210
escalation path to find where our pivot

1159
00:42:59,740 --> 00:43:04,750
<font color="#E5E5E5">points are and potentially jump into</font>

1160
00:43:01,210 --> 00:43:06,400
other secure environments so I think<font color="#E5E5E5"> I'm</font>

1161
00:43:04,750 --> 00:43:08,260
low on time but<font color="#CCCCCC"> I just want to say if</font>

1162
00:43:06,400 --> 00:43:10,150
you want<font color="#E5E5E5"> to collaborate anything if you</font>

1163
00:43:08,260 --> 00:43:11,320
<font color="#E5E5E5">have ideas if you want chat grabbing a</font>

1164
00:43:10,150 --> 00:43:13,589
lobby reach out to me on<font color="#CCCCCC"> Twitter and</font>

1165
00:43:11,320 --> 00:43:15,670
github<font color="#CCCCCC"> love to exchange ideas</font><font color="#E5E5E5"> with you</font>

1166
00:43:13,589 --> 00:43:17,920
<font color="#E5E5E5">references here the only one want to</font>

1167
00:43:15,670 --> 00:43:19,930
call out is<font color="#CCCCCC"> the top one there's a slack</font>

1168
00:43:17,920 --> 00:43:21,730
channel for<font color="#E5E5E5"> bloodhound</font><font color="#CCCCCC"> it started off</font><font color="#E5E5E5"> as</font>

1169
00:43:19,930 --> 00:43:24,129
just kind of<font color="#E5E5E5"> bloodhound Q&A</font><font color="#CCCCCC"> it's since</font>

1170
00:43:21,730 --> 00:43:26,609
morphed into this huge<font color="#E5E5E5"> Red Team pen</font>

1171
00:43:24,130 --> 00:43:29,770
<font color="#E5E5E5">testing just security in general chat</font>

1172
00:43:26,609 --> 00:43:32,140
it's<font color="#E5E5E5"> awesome and with that</font><font color="#CCCCCC"> let me say</font>

1173
00:43:29,770 --> 00:43:38,199
thank you

1174
00:43:32,140 --> 00:43:38,199
[Applause]

