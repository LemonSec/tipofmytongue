1
00:00:11,330 --> 00:00:19,230
so welcome<font color="#CCCCCC"> how's it how's the conference</font>

2
00:00:14,670 --> 00:00:21,509
going so far great so we're gonna be

3
00:00:19,230 --> 00:00:23,510
<font color="#E5E5E5">talking about crack map</font><font color="#CCCCCC"> exec the tool</font>

4
00:00:21,510 --> 00:00:27,300
that<font color="#CCCCCC"> I wrote</font><font color="#E5E5E5"> I've been diving for around</font>

5
00:00:23,510 --> 00:00:29,670
<font color="#CCCCCC">two</font><font color="#E5E5E5"> years now I think around</font><font color="#CCCCCC"> and</font>

6
00:00:27,300 --> 00:00:31,620
specifically the 4.0 update so<font color="#E5E5E5"> this if</font>

7
00:00:29,670 --> 00:00:35,850
quick show of hands who's used this tool

8
00:00:31,620 --> 00:00:37,079
before<font color="#E5E5E5"> Wow okay who has never heard of</font>

9
00:00:35,850 --> 00:00:40,470
<font color="#E5E5E5">this tool before and doesn't even know</font>

10
00:00:37,079 --> 00:00:41,550
what<font color="#E5E5E5"> the hell it is awesome</font><font color="#CCCCCC"> alright so</font>

11
00:00:40,470 --> 00:00:43,500
hopefully<font color="#CCCCCC"> there'll be</font><font color="#E5E5E5"> a little</font><font color="#CCCCCC"> bit of</font>

12
00:00:41,550 --> 00:00:45,569
<font color="#E5E5E5">they'll be mixed content so it'll be</font>

13
00:00:43,500 --> 00:00:47,130
good for<font color="#CCCCCC"> all of</font><font color="#E5E5E5"> you hopefully everyone</font>

14
00:00:45,570 --> 00:00:48,840
get something out of this<font color="#E5E5E5"> so as you're</font>

15
00:00:47,130 --> 00:00:50,520
probably well I'm<font color="#CCCCCC"> Justine</font><font color="#E5E5E5"> by the title</font><font color="#CCCCCC"> I</font>

16
00:00:48,840 --> 00:00:51,809
don't know if that can<font color="#E5E5E5"> you everyone see</font>

17
00:00:50,520 --> 00:00:55,140
that by the<font color="#E5E5E5"> way I don't know if the font</font>

18
00:00:51,809 --> 00:00:56,459
<font color="#E5E5E5">you know</font><font color="#CCCCCC"> alright cool</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> this tool is</font>

19
00:00:55,140 --> 00:00:58,620
<font color="#E5E5E5">primarily meant to test</font><font color="#CCCCCC"> Active Directory</font>

20
00:00:56,460 --> 00:01:01,020
<font color="#E5E5E5">networks specifically large Active</font>

21
00:00:58,620 --> 00:01:02,430
Directory networks<font color="#CCCCCC"> and we'll</font><font color="#E5E5E5"> talk about</font>

22
00:01:01,020 --> 00:01:04,589
<font color="#E5E5E5">that</font><font color="#CCCCCC"> in a</font><font color="#E5E5E5"> minute but it specifically</font>

23
00:01:02,430 --> 00:01:06,659
before<font color="#E5E5E5"> the 4.0 update really</font><font color="#CCCCCC"> sort of</font>

24
00:01:04,589 --> 00:01:08,880
expanded the scope of<font color="#CCCCCC"> this tool quite</font>

25
00:01:06,659 --> 00:01:10,140
significantly as introduces modular

26
00:01:08,880 --> 00:01:12,780
protocols<font color="#E5E5E5"> and we'll get into that as</font>

27
00:01:10,140 --> 00:01:14,609
well<font color="#CCCCCC"> but</font><font color="#E5E5E5"> now again it's not only</font><font color="#CCCCCC"> for</font>

28
00:01:12,780 --> 00:01:17,490
<font color="#E5E5E5">Active Directory it's a little bit for</font>

29
00:01:14,609 --> 00:01:18,780
everything quite frankly<font color="#CCCCCC"> and you'll see</font>

30
00:01:17,490 --> 00:01:21,420
a little bit<font color="#E5E5E5"> of that</font><font color="#CCCCCC"> most of</font><font color="#E5E5E5"> the top</font>

31
00:01:18,780 --> 00:01:24,090
most<font color="#E5E5E5"> of the talk will be live demos so</font>

32
00:01:21,420 --> 00:01:27,719
<font color="#E5E5E5">that's all start</font><font color="#CCCCCC"> sacrificing stuff right</font>

33
00:01:24,090 --> 00:01:29,759
<font color="#E5E5E5">now so</font><font color="#CCCCCC"> Who am</font><font color="#E5E5E5"> I work for</font><font color="#CCCCCC"> cool fire labs</font>

34
00:01:27,719 --> 00:01:31,770
<font color="#CCCCCC">I go by bike bleeder</font><font color="#E5E5E5"> it's linked to my</font>

35
00:01:29,759 --> 00:01:33,569
github page<font color="#E5E5E5"> they're kind enough to</font>

36
00:01:31,770 --> 00:01:34,740
sponsor<font color="#E5E5E5"> my trips out here to all these</font>

37
00:01:33,569 --> 00:01:40,289
conferences<font color="#CCCCCC"> and talk about</font><font color="#E5E5E5"> this cool</font>

38
00:01:34,740 --> 00:01:42,958
<font color="#E5E5E5">stuff</font><font color="#CCCCCC"> so for anyone</font><font color="#E5E5E5"> who is not familiar</font>

39
00:01:40,289 --> 00:01:45,509
<font color="#CCCCCC">with the tool I like I said again</font><font color="#E5E5E5"> this</font>

40
00:01:42,959 --> 00:01:47,009
is meant<font color="#CCCCCC"> to pentest large active</font>

41
00:01:45,509 --> 00:01:48,899
<font color="#CCCCCC">directory networks or large networks in</font>

42
00:01:47,009 --> 00:01:51,869
general<font color="#CCCCCC"> right so when I</font><font color="#E5E5E5"> first started</font>

43
00:01:48,899 --> 00:01:53,849
<font color="#E5E5E5">pentesting professionally I immediately</font>

44
00:01:51,869 --> 00:01:56,880
noticed a pattern<font color="#E5E5E5"> which was</font><font color="#CCCCCC"> okay</font>

45
00:01:53,849 --> 00:01:58,770
clients drop you<font color="#CCCCCC"> into</font><font color="#E5E5E5"> network and it's</font>

46
00:01:56,880 --> 00:02:02,068
<font color="#E5E5E5">probably like 30 20 thousand</font><font color="#CCCCCC"> host</font>

47
00:01:58,770 --> 00:02:04,560
<font color="#CCCCCC">Network and you may say here and</font><font color="#E5E5E5"> that's</font>

48
00:02:02,069 --> 00:02:07,619
this<font color="#E5E5E5"> and you only have one week</font><font color="#CCCCCC"> to do it</font>

49
00:02:04,560 --> 00:02:09,330
so have fun with<font color="#E5E5E5"> that well okay</font><font color="#CCCCCC"> and</font>

50
00:02:07,619 --> 00:02:10,860
you're like<font color="#E5E5E5"> okay that's</font><font color="#CCCCCC"> good</font><font color="#E5E5E5"> it's gonna</font>

51
00:02:09,330 --> 00:02:12,360
<font color="#E5E5E5">be fun</font><font color="#CCCCCC"> but it's gonna</font><font color="#E5E5E5"> be challenging</font><font color="#CCCCCC"> as</font>

52
00:02:10,860 --> 00:02:14,190
well<font color="#E5E5E5"> right because you know you have to</font>

53
00:02:12,360 --> 00:02:16,710
<font color="#E5E5E5">sort of really manage your time really</font>

54
00:02:14,190 --> 00:02:18,210
really<font color="#E5E5E5"> well and the second</font><font color="#CCCCCC"> question</font><font color="#E5E5E5"> is</font>

55
00:02:16,710 --> 00:02:20,140
probably<font color="#E5E5E5"> the</font><font color="#CCCCCC"> question</font><font color="#E5E5E5"> that I get asked</font>

56
00:02:18,210 --> 00:02:22,660
most is what's up with the weird name

57
00:02:20,140 --> 00:02:25,149
we'll get<font color="#E5E5E5"> into that as well</font><font color="#CCCCCC"> so initially</font>

58
00:02:22,660 --> 00:02:27,760
just the it's all started with<font color="#E5E5E5"> a simple</font>

59
00:02:25,150 --> 00:02:29,500
<font color="#CCCCCC">question how can I pawn things</font><font color="#E5E5E5"> at scale</font>

60
00:02:27,760 --> 00:02:33,519
<font color="#CCCCCC">right how can I just own things at scale</font>

61
00:02:29,500 --> 00:02:34,810
<font color="#E5E5E5">and it was difficult</font><font color="#CCCCCC"> because</font><font color="#E5E5E5"> a lot of</font>

62
00:02:33,520 --> 00:02:37,600
the existing open<font color="#E5E5E5"> source tool sets</font>

63
00:02:34,810 --> 00:02:39,910
obviously<font color="#CCCCCC"> CMA is open source and I</font>

64
00:02:37,600 --> 00:02:41,320
<font color="#E5E5E5">usually all use open source stuff</font><font color="#CCCCCC"> a lot</font>

65
00:02:39,910 --> 00:02:44,470
<font color="#E5E5E5">of the existing</font><font color="#CCCCCC"> open source tool sets at</font>

66
00:02:41,320 --> 00:02:45,760
the<font color="#E5E5E5"> time didn't</font><font color="#CCCCCC"> really do what I wanted</font>

67
00:02:44,470 --> 00:02:47,590
<font color="#CCCCCC">like they were there were all different</font>

68
00:02:45,760 --> 00:02:50,799
<font color="#E5E5E5">tools that sort of had part of things</font>

69
00:02:47,590 --> 00:02:52,450
that I wanted<font color="#E5E5E5"> in something like this</font><font color="#CCCCCC"> but</font>

70
00:02:50,800 --> 00:02:54,220
<font color="#E5E5E5">they didn't really do</font><font color="#CCCCCC"> it well like there</font>

71
00:02:52,450 --> 00:02:56,200
was SMB exec which was awesome<font color="#E5E5E5"> at the</font>

72
00:02:54,220 --> 00:02:58,470
time but it<font color="#E5E5E5"> was really just a wrapper</font>

73
00:02:56,200 --> 00:03:01,000
around<font color="#E5E5E5"> like the passing the hash</font><font color="#CCCCCC"> toolkit</font>

74
00:02:58,470 --> 00:03:03,760
<font color="#E5E5E5">and to get it to install and anything</font>

75
00:03:01,000 --> 00:03:05,709
other<font color="#E5E5E5"> than</font><font color="#CCCCCC"> Kali was just a pain in the</font>

76
00:03:03,760 --> 00:03:07,239
butt<font color="#CCCCCC"> and I still can't</font><font color="#E5E5E5"> really get</font>

77
00:03:05,709 --> 00:03:10,480
anything<font color="#CCCCCC"> anything from passing</font><font color="#E5E5E5"> the hash</font>

78
00:03:07,239 --> 00:03:11,680
tool kit<font color="#CCCCCC"> to install</font><font color="#E5E5E5"> correctly</font><font color="#CCCCCC"> but it all</font>

79
00:03:10,480 --> 00:03:13,630
started<font color="#E5E5E5"> with a</font><font color="#CCCCCC"> simple question like</font><font color="#E5E5E5"> how</font>

80
00:03:11,680 --> 00:03:16,360
can<font color="#CCCCCC"> I just</font>

81
00:03:13,630 --> 00:03:21,910
legitimately and really effectively<font color="#E5E5E5"> own</font>

82
00:03:16,360 --> 00:03:24,430
things at scale<font color="#CCCCCC"> so it all started with</font>

83
00:03:21,910 --> 00:03:26,140
SMB map<font color="#E5E5E5"> and so SMB map was a project</font>

84
00:03:24,430 --> 00:03:27,160
<font color="#CCCCCC">written by Sean Evans which I got them</font>

85
00:03:26,140 --> 00:03:30,220
<font color="#E5E5E5">out</font><font color="#CCCCCC"> of black had a couple</font><font color="#E5E5E5"> years ago</font>

86
00:03:27,160 --> 00:03:32,769
<font color="#E5E5E5">which was</font><font color="#CCCCCC"> amazing and</font><font color="#E5E5E5"> it was a project</font>

87
00:03:30,220 --> 00:03:34,720
<font color="#E5E5E5">that sort of got got me thinking about</font>

88
00:03:32,769 --> 00:03:37,000
<font color="#E5E5E5">how</font><font color="#CCCCCC"> can I</font><font color="#E5E5E5"> do this it was just a little</font>

89
00:03:34,720 --> 00:03:41,560
<font color="#CCCCCC">python script</font><font color="#E5E5E5"> that basically used some</font>

90
00:03:37,000 --> 00:03:43,900
of<font color="#E5E5E5"> the impacted toolkit to just just own</font>

91
00:03:41,560 --> 00:03:46,209
things via<font color="#CCCCCC"> WMI just a quick game code</font>

92
00:03:43,900 --> 00:03:49,000
execution via<font color="#CCCCCC"> WMI</font><font color="#E5E5E5"> on a fair amount of</font>

93
00:03:46,209 --> 00:03:50,980
hosts at the same time right and the

94
00:03:49,000 --> 00:03:52,930
output was<font color="#E5E5E5"> awesome</font><font color="#CCCCCC"> too like if you're</font>

95
00:03:50,980 --> 00:03:54,488
familiar with the<font color="#CCCCCC"> auxiliary module</font>

96
00:03:52,930 --> 00:03:56,350
<font color="#CCCCCC">Metasploit like the SMB version scanner</font>

97
00:03:54,489 --> 00:03:58,780
<font color="#E5E5E5">that's</font><font color="#CCCCCC"> a really quick</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> easy</font><font color="#E5E5E5"> way to</font>

98
00:03:56,350 --> 00:04:00,100
<font color="#CCCCCC">identify windows</font><font color="#E5E5E5"> how I get into</font><font color="#CCCCCC"> other</font>

99
00:03:58,780 --> 00:04:02,350
<font color="#E5E5E5">different</font><font color="#CCCCCC"> windows boxes in the domain</font>

100
00:04:00,100 --> 00:04:04,750
<font color="#E5E5E5">just like SMB fingerprinting in general</font>

101
00:04:02,350 --> 00:04:06,070
<font color="#CCCCCC">just a really easy way to just</font><font color="#E5E5E5"> get that</font>

102
00:04:04,750 --> 00:04:09,220
<font color="#CCCCCC">in the OS version a lot</font><font color="#E5E5E5"> of other</font>

103
00:04:06,070 --> 00:04:12,730
different<font color="#E5E5E5"> stuff</font><font color="#CCCCCC"> so I took a</font><font color="#E5E5E5"> look at this</font>

104
00:04:09,220 --> 00:04:15,519
<font color="#CCCCCC">project and I rewrote it</font><font color="#E5E5E5"> so that it was</font>

105
00:04:12,730 --> 00:04:17,260
<font color="#E5E5E5">concurrent and because initially</font><font color="#CCCCCC"> was</font>

106
00:04:15,519 --> 00:04:18,548
using the<font color="#E5E5E5"> Python threading module which</font>

107
00:04:17,260 --> 00:04:20,709
is parallelism it's not really

108
00:04:18,548 --> 00:04:23,560
concurrency so I<font color="#E5E5E5"> wanted</font><font color="#CCCCCC"> something</font>

109
00:04:20,709 --> 00:04:25,030
concurrent so it does multiple stuff at

110
00:04:23,560 --> 00:04:26,440
the same<font color="#E5E5E5"> time I suppose the parallelism</font>

111
00:04:25,030 --> 00:04:28,630
while you're doing one things across

112
00:04:26,440 --> 00:04:29,860
<font color="#E5E5E5">multiple threads right so it's it's a</font>

113
00:04:28,630 --> 00:04:32,330
very<font color="#E5E5E5"> different it's very different</font>

114
00:04:29,860 --> 00:04:41,870
<font color="#E5E5E5">yep</font>

115
00:04:32,330 --> 00:04:43,430
and it died<font color="#CCCCCC"> oh yeah back something okay</font>

116
00:04:41,870 --> 00:04:48,379
<font color="#E5E5E5">well that's not</font><font color="#CCCCCC"> a good start for</font><font color="#E5E5E5"> the</font>

117
00:04:43,430 --> 00:04:51,199
<font color="#CCCCCC">Devils okay yeah I don't</font><font color="#E5E5E5"> know we'll see</font>

118
00:04:48,379 --> 00:04:52,909
<font color="#CCCCCC">yeah that's yeah</font><font color="#E5E5E5"> okay see we'll see</font><font color="#CCCCCC"> how</font>

119
00:04:51,199 --> 00:04:58,340
that<font color="#E5E5E5"> goes</font><font color="#CCCCCC"> oh yeah that's how it all</font>

120
00:04:52,909 --> 00:05:00,620
started<font color="#E5E5E5"> and I took that and I rewrote it</font>

121
00:04:58,340 --> 00:05:03,560
<font color="#E5E5E5">and there was a point where just the</font>

122
00:05:00,620 --> 00:05:05,479
<font color="#E5E5E5">code base was so vastly different that</font>

123
00:05:03,560 --> 00:05:06,680
<font color="#E5E5E5">insided</font><font color="#CCCCCC"> to start my own project which</font>

124
00:05:05,479 --> 00:05:09,830
was cracked<font color="#E5E5E5"> mine exactly these are some</font>

125
00:05:06,680 --> 00:05:12,770
of<font color="#E5E5E5"> the tools that sort of inspired crack</font>

126
00:05:09,830 --> 00:05:16,250
my<font color="#CCCCCC"> exec so it took I took</font><font color="#E5E5E5"> the last three</font>

127
00:05:12,770 --> 00:05:18,080
verbs or nouns or whatever<font color="#E5E5E5"> of the names</font>

128
00:05:16,250 --> 00:05:19,759
and<font color="#E5E5E5"> smashed them</font><font color="#CCCCCC"> all</font><font color="#E5E5E5"> together it was a</font>

129
00:05:18,080 --> 00:05:22,310
really<font color="#E5E5E5"> horrible idea I regret the</font>

130
00:05:19,759 --> 00:05:25,759
decision<font color="#E5E5E5"> I was alcohol might have been</font>

131
00:05:22,310 --> 00:05:27,440
<font color="#CCCCCC">involved at the time um yes and these</font>

132
00:05:25,759 --> 00:05:29,300
<font color="#E5E5E5">were basically</font><font color="#CCCCCC"> just the tools that</font><font color="#E5E5E5"> the</font>

133
00:05:27,440 --> 00:05:31,400
my tool was inspired upon so<font color="#E5E5E5"> quick crack</font>

134
00:05:29,300 --> 00:05:33,050
did some really<font color="#E5E5E5"> neat</font><font color="#CCCCCC"> stuff with me me</font>

135
00:05:31,400 --> 00:05:35,359
cats<font color="#E5E5E5"> it allowed you to basically just</font>

136
00:05:33,050 --> 00:05:36,740
<font color="#CCCCCC">mimic cats an entire network</font><font color="#E5E5E5"> really</font>

137
00:05:35,360 --> 00:05:39,319
easily the implementation was<font color="#CCCCCC"> a little</font>

138
00:05:36,740 --> 00:05:41,569
not exactly the<font color="#CCCCCC"> best use of the patch it</font>

139
00:05:39,319 --> 00:05:43,759
was a pain to<font color="#CCCCCC"> set up SMB nap was</font><font color="#E5E5E5"> the</font>

140
00:05:41,569 --> 00:05:45,800
project<font color="#CCCCCC"> that I talked about an SMB</font><font color="#E5E5E5"> exact</font>

141
00:05:43,759 --> 00:05:49,069
is what I said it<font color="#E5E5E5"> was it was a really</font>

142
00:05:45,800 --> 00:05:50,630
<font color="#E5E5E5">neat project it</font><font color="#CCCCCC"> was just to</font><font color="#E5E5E5"> install it</font>

143
00:05:49,069 --> 00:05:52,250
was a pain and<font color="#E5E5E5"> it was basically a</font>

144
00:05:50,630 --> 00:05:54,020
wrapper<font color="#E5E5E5"> I wanted something</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> was just</font>

145
00:05:52,250 --> 00:05:57,199
<font color="#E5E5E5">a pure Python implementation of the</font>

146
00:05:54,020 --> 00:05:59,479
stuff<font color="#E5E5E5"> that I wanted and like I said</font>

147
00:05:57,199 --> 00:06:00,919
<font color="#E5E5E5">these are</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> eight problem slash</font>

148
00:05:59,479 --> 00:06:03,919
features that<font color="#E5E5E5"> I wanted in a tool like</font>

149
00:06:00,919 --> 00:06:05,690
<font color="#CCCCCC">this</font><font color="#E5E5E5"> so large networks</font><font color="#CCCCCC"> I said like you</font>

150
00:06:03,919 --> 00:06:08,900
get dropped in an environment with like

151
00:06:05,690 --> 00:06:10,729
<font color="#E5E5E5">20,000 hosts obviously and you</font><font color="#CCCCCC"> get</font><font color="#E5E5E5"> the</font>

152
00:06:08,900 --> 00:06:12,620
<font color="#E5E5E5">client has only one week gives you only</font>

153
00:06:10,729 --> 00:06:13,849
<font color="#E5E5E5">one week to do it obviously</font><font color="#CCCCCC"> that's gonna</font>

154
00:06:12,620 --> 00:06:15,680
be a problem all right<font color="#E5E5E5"> Corinne chill</font>

155
00:06:13,849 --> 00:06:17,449
overload this is something that<font color="#CCCCCC"> I</font>

156
00:06:15,680 --> 00:06:18,830
<font color="#CCCCCC">mediately noticed when I started doing</font>

157
00:06:17,449 --> 00:06:20,360
<font color="#CCCCCC">this professionally like once we pop</font>

158
00:06:18,830 --> 00:06:22,310
about once<font color="#E5E5E5"> you get initial foothold on a</font>

159
00:06:20,360 --> 00:06:24,919
<font color="#E5E5E5">machine</font><font color="#CCCCCC"> the amount of credentials that</font>

160
00:06:22,310 --> 00:06:26,389
<font color="#E5E5E5">you get after moving laterally it just</font>

161
00:06:24,919 --> 00:06:28,128
keeps increasing exponentially so you

162
00:06:26,389 --> 00:06:30,469
need to<font color="#CCCCCC"> need like a</font><font color="#E5E5E5"> a way of tracking</font>

163
00:06:28,129 --> 00:06:31,849
all<font color="#CCCCCC"> of these credentials and what those</font>

164
00:06:30,469 --> 00:06:32,930
credentials<font color="#E5E5E5"> have access to on the</font>

165
00:06:31,849 --> 00:06:35,240
network right need to track<font color="#E5E5E5"> those</font>

166
00:06:32,930 --> 00:06:36,710
relationships<font color="#E5E5E5"> somehow situational</font>

167
00:06:35,240 --> 00:06:38,840
awareness was also a big<font color="#E5E5E5"> deal especially</font>

168
00:06:36,710 --> 00:06:40,339
<font color="#E5E5E5">in large networks situation awareness is</font>

169
00:06:38,840 --> 00:06:42,799
key on<font color="#CCCCCC"> a pen test because you need to</font>

170
00:06:40,339 --> 00:06:45,249
<font color="#E5E5E5">know okay what defenses they have how</font>

171
00:06:42,800 --> 00:06:48,009
<font color="#E5E5E5">can i potentially bypass those defenses</font>

172
00:06:45,249 --> 00:06:49,539
they have<font color="#E5E5E5"> exchanged sirs</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> laps</font>

173
00:06:48,009 --> 00:06:51,819
installed or something along<font color="#E5E5E5"> those</font><font color="#CCCCCC"> lines</font>

174
00:06:49,539 --> 00:06:53,259
<font color="#E5E5E5">so you</font><font color="#CCCCCC"> know a situational awareness</font><font color="#E5E5E5"> and</font>

175
00:06:51,819 --> 00:06:55,269
thankfully while I was developing this

176
00:06:53,259 --> 00:06:56,889
<font color="#E5E5E5">tool</font><font color="#CCCCCC"> a lot</font><font color="#E5E5E5"> of other</font><font color="#CCCCCC"> open-source</font><font color="#E5E5E5"> tools</font>

177
00:06:55,269 --> 00:06:58,299
were coming<font color="#E5E5E5"> out like</font><font color="#CCCCCC"> power</font><font color="#E5E5E5"> sploit and</font>

178
00:06:56,889 --> 00:07:00,099
Power View so it just kept getting

179
00:06:58,299 --> 00:07:02,438
easier as I<font color="#CCCCCC"> progressed which</font><font color="#E5E5E5"> is awesome</font>

180
00:07:00,099 --> 00:07:05,169
<font color="#CCCCCC">I mean it was less work for</font><font color="#E5E5E5"> me</font><font color="#CCCCCC"> isn't</font>

181
00:07:02,439 --> 00:07:07,539
<font color="#CCCCCC">it's</font><font color="#E5E5E5"> awesome right a</font><font color="#CCCCCC"> bee detection this</font>

182
00:07:05,169 --> 00:07:09,938
is another thing that<font color="#CCCCCC"> I wanted</font><font color="#E5E5E5"> a lot of</font>

183
00:07:07,539 --> 00:07:11,919
the<font color="#E5E5E5"> S&B</font><font color="#CCCCCC"> exist stuff a lot of the</font><font color="#E5E5E5"> SMB</font>

184
00:07:09,939 --> 00:07:14,529
<font color="#CCCCCC">exact stuff</font><font color="#E5E5E5"> kept getting popped by AV</font>

185
00:07:11,919 --> 00:07:17,709
for one reason<font color="#CCCCCC"> or another so I wanted a</font>

186
00:07:14,529 --> 00:07:21,069
way just<font color="#E5E5E5"> to do bypass not worry about</font>

187
00:07:17,709 --> 00:07:22,389
<font color="#E5E5E5">endpoint protections at all stealth</font>

188
00:07:21,069 --> 00:07:24,069
living off the land that sort of goes up

189
00:07:22,389 --> 00:07:27,159
<font color="#E5E5E5">there with</font><font color="#CCCCCC"> AV detection I wanted to use</font>

190
00:07:24,069 --> 00:07:30,039
native preferably<font color="#E5E5E5"> native protocols or</font>

191
00:07:27,159 --> 00:07:31,929
native tools features API calls<font color="#E5E5E5"> and</font>

192
00:07:30,039 --> 00:07:33,489
<font color="#CCCCCC">built-in windows to accomplish my goals</font>

193
00:07:31,929 --> 00:07:35,708
as supposed to using<font color="#CCCCCC"> third-party</font><font color="#E5E5E5"> stuff</font>

194
00:07:33,489 --> 00:07:36,638
like windows credential editor like I

195
00:07:35,709 --> 00:07:38,739
<font color="#E5E5E5">wanted to stay away from</font><font color="#CCCCCC"> that kind of</font>

196
00:07:36,639 --> 00:07:41,739
stuff<font color="#CCCCCC"> like third party so stuff like</font>

197
00:07:38,739 --> 00:07:43,268
<font color="#E5E5E5">that wrappers nope I didn't want to</font>

198
00:07:41,739 --> 00:07:44,709
<font color="#E5E5E5">create another wrapper</font><font color="#CCCCCC"> it just</font><font color="#E5E5E5"> maybe</font>

199
00:07:43,269 --> 00:07:46,329
already<font color="#E5E5E5"> got those they're all over the</font>

200
00:07:44,709 --> 00:07:47,799
<font color="#CCCCCC">place I don't</font><font color="#E5E5E5"> want a wrapper</font><font color="#CCCCCC"> I didn't</font>

201
00:07:46,329 --> 00:07:48,819
want to rely on<font color="#CCCCCC"> external tools I didn't</font>

202
00:07:47,799 --> 00:07:50,589
want to rely on anything else<font color="#E5E5E5"> I just</font>

203
00:07:48,819 --> 00:07:54,039
<font color="#E5E5E5">wanted something written Python that's</font>

204
00:07:50,589 --> 00:07:55,599
<font color="#E5E5E5">it</font><font color="#CCCCCC"> the glue between Metasploit and</font>

205
00:07:54,039 --> 00:07:57,159
<font color="#E5E5E5">Empire this is something that I noticed</font>

206
00:07:55,599 --> 00:07:58,748
<font color="#E5E5E5">was key as well because I need something</font>

207
00:07:57,159 --> 00:08:02,829
that could I could just like easily<font color="#CCCCCC"> lob</font>

208
00:07:58,749 --> 00:08:05,349
shells or<font color="#E5E5E5"> agents in the Empire in in the</font>

209
00:08:02,829 --> 00:08:08,229
Empire world<font color="#CCCCCC"> between the two frameworks</font>

210
00:08:05,349 --> 00:08:10,899
<font color="#CCCCCC">because I</font><font color="#E5E5E5"> usually use a combination of</font>

211
00:08:08,229 --> 00:08:12,699
<font color="#E5E5E5">both of</font><font color="#CCCCCC"> my pen tests because some of</font><font color="#E5E5E5"> the</font>

212
00:08:10,899 --> 00:08:14,169
pros and<font color="#CCCCCC"> cons of</font><font color="#E5E5E5"> each</font><font color="#CCCCCC"> frame works sort</font>

213
00:08:12,699 --> 00:08:16,239
<font color="#E5E5E5">of</font><font color="#CCCCCC"> outweigh each other so I used like</font>

214
00:08:14,169 --> 00:08:18,878
Empire for like the<font color="#CCCCCC"> PowerShell stuff and</font>

215
00:08:16,239 --> 00:08:20,589
<font color="#CCCCCC">Metasploit some has sometimes</font><font color="#E5E5E5"> some post</font>

216
00:08:18,879 --> 00:08:22,659
modules that<font color="#E5E5E5"> are a little bit better</font>

217
00:08:20,589 --> 00:08:25,059
written<font color="#E5E5E5"> so I usually use both and I</font>

218
00:08:22,659 --> 00:08:27,639
wanted<font color="#E5E5E5"> something modular</font><font color="#CCCCCC"> too so if I</font>

219
00:08:25,059 --> 00:08:30,159
<font color="#CCCCCC">came across an environment that had a</font>

220
00:08:27,639 --> 00:08:31,209
certain protection in place<font color="#CCCCCC"> or</font><font color="#E5E5E5"> something</font>

221
00:08:30,159 --> 00:08:33,879
that I saw that<font color="#E5E5E5"> was out of the ordinary</font>

222
00:08:31,209 --> 00:08:36,009
<font color="#CCCCCC">I wanted a way</font><font color="#E5E5E5"> to quickly write either</font>

223
00:08:33,879 --> 00:08:37,089
plugins or something that can<font color="#CCCCCC"> I can use</font>

224
00:08:36,009 --> 00:08:41,199
to take<font color="#E5E5E5"> advantage of that</font><font color="#CCCCCC"> Mis</font>

225
00:08:37,089 --> 00:08:44,589
configuration or whatever I find so

226
00:08:41,198 --> 00:08:49,269
while I was<font color="#E5E5E5"> writing this</font><font color="#CCCCCC"> round</font><font color="#E5E5E5"> version</font>

227
00:08:44,589 --> 00:08:50,920
<font color="#E5E5E5">2.0 2.0 3.0</font><font color="#CCCCCC"> the of the tool</font><font color="#E5E5E5"> it sort of</font>

228
00:08:49,269 --> 00:08:52,540
occurred to me but wait a second<font color="#E5E5E5"> I've</font>

229
00:08:50,920 --> 00:08:55,809
sort of<font color="#E5E5E5"> been focusing only</font><font color="#CCCCCC"> an</font><font color="#E5E5E5"> active</font>

230
00:08:52,540 --> 00:08:57,339
<font color="#E5E5E5">directory here but just the framework</font>

231
00:08:55,809 --> 00:08:58,839
itself<font color="#E5E5E5"> have gotten got has</font><font color="#CCCCCC"> got to a</font>

232
00:08:57,339 --> 00:09:03,040
point<font color="#E5E5E5"> where I can just expand this</font>

233
00:08:58,840 --> 00:09:04,660
<font color="#CCCCCC">two other protocols as well like</font><font color="#E5E5E5"> sshh GP</font>

234
00:09:03,040 --> 00:09:06,339
like this is something these<font color="#CCCCCC"> are all the</font>

235
00:09:04,660 --> 00:09:08,230
stuff that<font color="#CCCCCC"> we</font><font color="#E5E5E5"> see on internal networks</font>

236
00:09:06,340 --> 00:09:09,580
right it's<font color="#CCCCCC"> not just Windows</font><font color="#E5E5E5"> Network</font><font color="#CCCCCC"> it's</font>

237
00:09:08,230 --> 00:09:12,100
not just<font color="#E5E5E5"> windows although that is the</font>

238
00:09:09,580 --> 00:09:14,770
vast majority but you also see like HTTP

239
00:09:12,100 --> 00:09:16,990
<font color="#E5E5E5">we see SSH win</font><font color="#CCCCCC"> RM which</font><font color="#E5E5E5"> we'll get into a</font>

240
00:09:14,770 --> 00:09:20,170
second which is<font color="#E5E5E5"> the new feature that was</font>

241
00:09:16,990 --> 00:09:22,240
<font color="#E5E5E5">released a couple of days</font><font color="#CCCCCC"> ago so</font><font color="#E5E5E5"> that's</font>

242
00:09:20,170 --> 00:09:25,060
what version 4.0<font color="#E5E5E5"> it turned out to be so</font>

243
00:09:22,240 --> 00:09:26,710
it's not just SMB anymore I<font color="#E5E5E5"> don't know</font>

244
00:09:25,060 --> 00:09:29,229
if you can see that but it's not<font color="#E5E5E5"> just</font><font color="#CCCCCC"> a</font>

245
00:09:26,710 --> 00:09:31,270
<font color="#CCCCCC">sim</font><font color="#E5E5E5"> be any more you got SSH</font><font color="#CCCCCC"> ms SQL</font><font color="#E5E5E5"> that</font>

246
00:09:29,230 --> 00:09:34,300
<font color="#CCCCCC">which is a</font><font color="#E5E5E5"> really cool thing well we'll</font>

247
00:09:31,270 --> 00:09:35,470
get<font color="#E5E5E5"> into</font><font color="#CCCCCC"> that HTTP which</font><font color="#E5E5E5"> is sort of an</font>

248
00:09:34,300 --> 00:09:37,780
alpha<font color="#CCCCCC"> I'm not going to be showing that</font>

249
00:09:35,470 --> 00:09:40,810
off because<font color="#E5E5E5"> I know it'll break and win</font>

250
00:09:37,780 --> 00:09:41,860
RM<font color="#E5E5E5"> we know</font><font color="#CCCCCC"> Emma's a new thing</font><font color="#E5E5E5"> so when RM</font>

251
00:09:40,810 --> 00:09:44,439
is the protocol<font color="#E5E5E5"> that PowerShell remoting</font>

252
00:09:41,860 --> 00:09:46,360
uses so I've seen this deployed more<font color="#E5E5E5"> and</font>

253
00:09:44,440 --> 00:09:47,590
more in environments<font color="#E5E5E5"> but initially when</font>

254
00:09:46,360 --> 00:09:49,720
<font color="#CCCCCC">it</font><font color="#E5E5E5"> first came out like no one was really</font>

255
00:09:47,590 --> 00:09:51,910
<font color="#E5E5E5">using it but and it also helps</font><font color="#CCCCCC"> that</font>

256
00:09:49,720 --> 00:09:54,100
<font color="#E5E5E5">Windows 2012 if I recall correctly and</font>

257
00:09:51,910 --> 00:09:55,890
Windows Server 2016 had this on by

258
00:09:54,100 --> 00:09:58,090
<font color="#CCCCCC">default so it's a</font><font color="#E5E5E5"> really good way of</font>

259
00:09:55,890 --> 00:10:01,510
code execution and lateral movement

260
00:09:58,090 --> 00:10:04,900
<font color="#E5E5E5">without requiring any sort of funky RPC</font>

261
00:10:01,510 --> 00:10:07,600
calls or anything along those lines<font color="#E5E5E5"> so</font>

262
00:10:04,900 --> 00:10:08,920
we got HTTP<font color="#E5E5E5"> ms6q</font><font color="#CCCCCC"> SSH as I said sort</font><font color="#E5E5E5"> of</font>

263
00:10:07,600 --> 00:10:11,080
went over this<font color="#CCCCCC"> already</font><font color="#E5E5E5"> and fresh off the</font>

264
00:10:08,920 --> 00:10:15,699
<font color="#E5E5E5">presses</font><font color="#CCCCCC"> winner RMPs from ruining which</font>

265
00:10:11,080 --> 00:10:18,010
I'll demonstrate<font color="#E5E5E5"> in a bit so it was just</font>

266
00:10:15,700 --> 00:10:19,480
a question<font color="#CCCCCC"> of how to put all this stuff</font>

267
00:10:18,010 --> 00:10:22,150
<font color="#E5E5E5">together like there was bits and pieces</font>

268
00:10:19,480 --> 00:10:25,210
of all<font color="#E5E5E5"> the functionality</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> I wanted</font>

269
00:10:22,150 --> 00:10:26,980
<font color="#E5E5E5">out</font><font color="#CCCCCC"> there</font><font color="#E5E5E5"> between</font><font color="#CCCCCC"> open</font><font color="#E5E5E5"> source tool sets</font>

270
00:10:25,210 --> 00:10:28,690
and stuff so I<font color="#CCCCCC"> just wanted something I</font>

271
00:10:26,980 --> 00:10:29,290
just<font color="#E5E5E5"> wanted to put all that</font><font color="#CCCCCC"> stuff</font>

272
00:10:28,690 --> 00:10:39,720
together

273
00:10:29,290 --> 00:10:39,719
<font color="#E5E5E5">oh it's delicate it's very delicate</font><font color="#CCCCCC"> okay</font>

274
00:10:39,780 --> 00:10:45,550
so the impact in packet library if you

275
00:10:44,530 --> 00:10:47,650
<font color="#CCCCCC">don't know what this</font><font color="#E5E5E5"> is is basically</font>

276
00:10:45,550 --> 00:10:50,170
<font color="#E5E5E5">just a</font><font color="#CCCCCC"> Python implementation of a lot of</font>

277
00:10:47,650 --> 00:10:51,819
<font color="#CCCCCC">Windows</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> that API calls and</font><font color="#E5E5E5"> RPC calls</font>

278
00:10:50,170 --> 00:10:53,560
and<font color="#CCCCCC"> stuff</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> that's awesome</font><font color="#E5E5E5"> if you're</font>

279
00:10:51,820 --> 00:10:54,940
<font color="#E5E5E5">not using in packet on your daily pen</font>

280
00:10:53,560 --> 00:10:58,630
test you're probably<font color="#E5E5E5"> doing it wrong my</font>

281
00:10:54,940 --> 00:11:00,010
opinion<font color="#CCCCCC"> PI win RM is the this part is</font>

282
00:10:58,630 --> 00:11:01,540
how I implemented the<font color="#CCCCCC"> winner</font><font color="#E5E5E5"> end</font>

283
00:11:00,010 --> 00:11:01,810
protocol and we'll<font color="#E5E5E5"> get to that in</font><font color="#CCCCCC"> a</font>

284
00:11:01,540 --> 00:11:03,400
<font color="#E5E5E5">minute</font>

285
00:11:01,810 --> 00:11:04,869
<font color="#CCCCCC">hi review</font><font color="#E5E5E5"> this is something that a</font><font color="#CCCCCC"> lot</font>

286
00:11:03,400 --> 00:11:08,829
of people don't<font color="#E5E5E5"> know about but PI review</font>

287
00:11:04,870 --> 00:11:12,430
is a framework which basically just<font color="#CCCCCC"> port</font>

288
00:11:08,830 --> 00:11:14,740
ported<font color="#E5E5E5"> some guy I forget</font><font color="#CCCCCC"> his name</font><font color="#E5E5E5"> ported</font>

289
00:11:12,430 --> 00:11:16,870
the<font color="#E5E5E5"> Power View functionality to Python</font>

290
00:11:14,740 --> 00:11:18,300
<font color="#CCCCCC">so everything</font><font color="#E5E5E5"> you can do with power view</font>

291
00:11:16,870 --> 00:11:21,189
through<font color="#E5E5E5"> PowerShell you can now do</font>

292
00:11:18,300 --> 00:11:23,589
through<font color="#E5E5E5"> Python on a Linux box which is</font>

293
00:11:21,189 --> 00:11:25,209
awesome power sploit<font color="#E5E5E5"> we all know</font>

294
00:11:23,589 --> 00:11:27,970
<font color="#E5E5E5">probably what that is</font><font color="#CCCCCC"> invoke</font>

295
00:11:25,209 --> 00:11:29,529
confiscation<font color="#E5E5E5"> version 4 also includes</font>

296
00:11:27,970 --> 00:11:31,029
<font color="#E5E5E5">powershell obfuscation capabilities</font>

297
00:11:29,529 --> 00:11:34,470
through invoke confiscation using

298
00:11:31,029 --> 00:11:37,029
<font color="#CCCCCC">powershell enix which is awesome</font><font color="#E5E5E5"> and</font>

299
00:11:34,470 --> 00:11:39,160
<font color="#CCCCCC">Vulcan E&C so that's just a really</font><font color="#E5E5E5"> quick</font>

300
00:11:37,029 --> 00:11:41,220
and<font color="#CCCCCC"> easy way to inject</font><font color="#E5E5E5"> a VNC client</font><font color="#CCCCCC"> and</font>

301
00:11:39,160 --> 00:11:45,339
memory using<font color="#E5E5E5"> PowerShell many kittens</font>

302
00:11:41,220 --> 00:11:46,990
<font color="#E5E5E5">basically just dumps like processes</font>

303
00:11:45,339 --> 00:11:49,089
<font color="#E5E5E5">memory space looking for potentials and</font>

304
00:11:46,990 --> 00:11:52,029
parses it net Ripper<font color="#E5E5E5"> pretty much the</font>

305
00:11:49,089 --> 00:11:54,430
same thing only<font color="#E5E5E5"> then injects</font><font color="#CCCCCC"> a DLL ran</font>

306
00:11:52,029 --> 00:11:56,170
<font color="#CCCCCC">the</font><font color="#E5E5E5"> PS scripts is just a repository that</font>

307
00:11:54,430 --> 00:11:58,239
contains some cool stuff<font color="#E5E5E5"> from</font><font color="#CCCCCC"> exterior</font>

308
00:11:56,170 --> 00:11:59,498
he's the<font color="#CCCCCC"> Empire</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> he's some great</font>

309
00:11:58,240 --> 00:12:01,689
<font color="#CCCCCC">stuff such</font><font color="#E5E5E5"> and gopher is one of my</font>

310
00:11:59,499 --> 00:12:05,230
favorite tools for post exploitation<font color="#E5E5E5"> it</font>

311
00:12:01,689 --> 00:12:06,490
<font color="#E5E5E5">basically finds just credentials like</font>

312
00:12:05,230 --> 00:12:08,430
store credentials<font color="#CCCCCC"> from a lot of</font>

313
00:12:06,490 --> 00:12:11,800
administration utilities like<font color="#E5E5E5"> winscp</font>

314
00:12:08,430 --> 00:12:14,279
FileZilla on Windows boxes<font color="#E5E5E5"> it's a great</font>

315
00:12:11,800 --> 00:12:16,569
easy way of identifying credentials

316
00:12:14,279 --> 00:12:18,699
<font color="#E5E5E5">identifying John boxes potentially and</font>

317
00:12:16,569 --> 00:12:20,979
identifying like an administrative<font color="#CCCCCC"> boxes</font>

318
00:12:18,699 --> 00:12:22,209
on the network as well<font color="#E5E5E5"> me penguins and a</font>

319
00:12:20,980 --> 00:12:23,559
lot of<font color="#E5E5E5"> people know</font><font color="#CCCCCC"> about this as well me</font>

320
00:12:22,209 --> 00:12:26,290
<font color="#E5E5E5">thing this is basically the equivalent</font>

321
00:12:23,559 --> 00:12:28,499
<font color="#E5E5E5">of me me cats in Linux world</font><font color="#CCCCCC"> it dumps</font>

322
00:12:26,290 --> 00:12:30,540
credentials from memory in Linux

323
00:12:28,499 --> 00:12:33,670
<font color="#E5E5E5">specifically from usually like desktop</font>

324
00:12:30,540 --> 00:12:35,230
<font color="#E5E5E5">managers like</font><font color="#CCCCCC"> Nome for example or some</font>

325
00:12:33,670 --> 00:12:37,839
<font color="#E5E5E5">FTP</font><font color="#CCCCCC"> server store those credentials in</font>

326
00:12:35,230 --> 00:12:44,430
memory so it's a great easy way<font color="#E5E5E5"> to move</font>

327
00:12:37,839 --> 00:12:49,470
laterally<font color="#CCCCCC"> on the network ok so</font>

328
00:12:44,430 --> 00:12:52,140
I do have<font color="#CCCCCC"> backup videos</font><font color="#E5E5E5"> a couple</font><font color="#CCCCCC"> but I'm</font>

329
00:12:49,470 --> 00:13:01,320
going<font color="#E5E5E5"> to try and doing this live</font><font color="#CCCCCC"> so just</font>

330
00:12:52,140 --> 00:13:05,720
everyone bear with me here and I'm<font color="#E5E5E5"> also</font>

331
00:13:01,320 --> 00:13:05,720
new to max<font color="#E5E5E5"> so I might be slow with this</font>

332
00:13:11,460 --> 00:13:15,230
that's not what I want it<font color="#E5E5E5"> okay</font>

333
00:13:20,830 --> 00:13:24,190
Kenny once everyone can see<font color="#E5E5E5"> that pretty</font>

334
00:13:23,300 --> 00:13:33,260
<font color="#E5E5E5">well</font>

335
00:13:24,190 --> 00:13:36,380
<font color="#CCCCCC">fonts good alright already</font>

336
00:13:33,260 --> 00:13:38,230
so first thing you<font color="#E5E5E5"> do once you stop see</font>

337
00:13:36,380 --> 00:13:40,370
me and I'll have<font color="#E5E5E5"> the</font><font color="#CCCCCC"> link to</font><font color="#E5E5E5"> the github</font>

338
00:13:38,230 --> 00:13:41,480
page where there's an installation

339
00:13:40,370 --> 00:13:43,460
instructions it's pretty it's gotten

340
00:13:41,480 --> 00:13:45,250
pretty easy actually<font color="#CCCCCC"> so you can pretty</font>

341
00:13:43,460 --> 00:13:49,700
much it supports pretty<font color="#E5E5E5"> much any</font><font color="#CCCCCC"> system</font>

342
00:13:45,250 --> 00:13:52,220
<font color="#E5E5E5">except windows obviously but first thing</font>

343
00:13:49,700 --> 00:13:55,280
you do is if you just<font color="#E5E5E5"> want to view the</font>

344
00:13:52,220 --> 00:14:00,580
general protocols that it supports<font color="#CCCCCC"> CA me</font>

345
00:13:55,280 --> 00:14:02,839
- - help<font color="#E5E5E5"> gives you a list of all of the</font>

346
00:14:00,580 --> 00:14:05,150
options<font color="#E5E5E5"> and protocols that</font><font color="#CCCCCC"> are currently</font>

347
00:14:02,840 --> 00:14:07,040
supports we're gonna start<font color="#E5E5E5"> with the</font><font color="#CCCCCC"> SNB</font>

348
00:14:05,150 --> 00:14:08,720
protocol<font color="#E5E5E5"> just</font><font color="#CCCCCC"> because that's</font><font color="#E5E5E5"> usually</font>

349
00:14:07,040 --> 00:14:10,760
where like most of the you<font color="#CCCCCC"> know you'll</font>

350
00:14:08,720 --> 00:14:13,070
<font color="#CCCCCC">probably</font><font color="#E5E5E5"> spend most of your time on and</font>

351
00:14:10,760 --> 00:14:15,590
<font color="#CCCCCC">-</font><font color="#E5E5E5"> just call that protocol</font><font color="#CCCCCC"> you just OCME</font>

352
00:14:13,070 --> 00:14:17,900
SMB<font color="#E5E5E5"> and I wanted it to something I</font>

353
00:14:15,590 --> 00:14:20,330
wanted something really<font color="#E5E5E5"> easy</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> a</font>

354
00:14:17,900 --> 00:14:21,709
matter of<font color="#E5E5E5"> fact let me I forgot</font><font color="#CCCCCC"> - didn't</font>

355
00:14:20,330 --> 00:14:23,480
have<font color="#E5E5E5"> that much time to</font><font color="#CCCCCC"> prepare</font><font color="#E5E5E5"> before</font>

356
00:14:21,710 --> 00:14:25,900
<font color="#E5E5E5">this so let me just spin up those VMs</font>

357
00:14:23,480 --> 00:14:25,900
real quick

358
00:14:32,680 --> 00:14:35,368
yes

359
00:14:44,460 --> 00:14:47,300
right

360
00:14:48,800 --> 00:14:59,258
<font color="#E5E5E5">okay so everything should be spinning up</font>

361
00:14:50,839 --> 00:15:01,429
now okay<font color="#E5E5E5"> so in theory we should be good</font>

362
00:14:59,259 --> 00:15:02,989
<font color="#E5E5E5">so I wanted a really quick</font><font color="#CCCCCC"> and easy</font><font color="#E5E5E5"> way</font>

363
00:15:01,429 --> 00:15:05,299
of just identifying<font color="#CCCCCC"> Windows boxes</font><font color="#E5E5E5"> to</font>

364
00:15:02,989 --> 00:15:07,220
start out right so and<font color="#CCCCCC"> it's II mean it's</font>

365
00:15:05,299 --> 00:15:11,449
<font color="#CCCCCC">really easy</font><font color="#E5E5E5"> just</font><font color="#CCCCCC"> give</font><font color="#E5E5E5"> it</font><font color="#CCCCCC"> the protocol</font>

366
00:15:07,220 --> 00:15:12,980
<font color="#CCCCCC">and</font><font color="#E5E5E5"> the range or IP address</font><font color="#CCCCCC"> or a site or</font>

367
00:15:11,449 --> 00:15:18,498
range or whatever<font color="#CCCCCC"> we really really</font>

368
00:15:12,980 --> 00:15:19,579
accepts<font color="#CCCCCC"> anything at this point</font><font color="#E5E5E5"> and it</font>

369
00:15:18,499 --> 00:15:22,670
helps if I get the IP addresses

370
00:15:19,579 --> 00:15:23,809
correctly<font color="#E5E5E5"> okay there you go</font><font color="#CCCCCC"> so in this</font>

371
00:15:22,670 --> 00:15:28,040
case we're scanning<font color="#E5E5E5"> from everything from</font>

372
00:15:23,809 --> 00:15:29,540
<font color="#CCCCCC">dock 10.15</font><font color="#E5E5E5"> and using SMB obviously so</font>

373
00:15:28,040 --> 00:15:31,519
this is just<font color="#E5E5E5"> doing SMB fingerprinting</font>

374
00:15:29,540 --> 00:15:34,069
<font color="#E5E5E5">and the outputs a little weird because</font>

375
00:15:31,519 --> 00:15:35,299
<font color="#E5E5E5">the font is really big but you can see</font>

376
00:15:34,069 --> 00:15:37,009
here<font color="#E5E5E5"> that it gives you the operating</font>

377
00:15:35,299 --> 00:15:39,379
system type gives you the architecture

378
00:15:37,009 --> 00:15:41,420
<font color="#CCCCCC">if you don't know you can actually</font><font color="#E5E5E5"> get</font>

379
00:15:39,379 --> 00:15:43,670
the<font color="#CCCCCC"> architecture of</font><font color="#E5E5E5"> an operating</font><font color="#CCCCCC"> system</font>

380
00:15:41,420 --> 00:15:46,160
without any authentication<font color="#E5E5E5"> whatsoever</font>

381
00:15:43,670 --> 00:15:47,599
through RPC calls which<font color="#E5E5E5"> is awesome you</font>

382
00:15:46,160 --> 00:15:49,549
get<font color="#E5E5E5"> the</font><font color="#CCCCCC"> hostname and the</font><font color="#E5E5E5"> domain is</font>

383
00:15:47,600 --> 00:15:51,110
joined to<font color="#CCCCCC"> MSN be signing is enabled</font>

384
00:15:49,549 --> 00:15:52,670
which is sort of a big<font color="#CCCCCC"> deal</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> if you</font>

385
00:15:51,110 --> 00:15:54,230
want to know more<font color="#E5E5E5"> about that if you</font>

386
00:15:52,670 --> 00:15:56,449
<font color="#CCCCCC">don't</font><font color="#E5E5E5"> know what that</font><font color="#CCCCCC"> entails</font><font color="#E5E5E5"> I can</font>

387
00:15:54,230 --> 00:15:59,149
definitely<font color="#E5E5E5"> talk</font><font color="#CCCCCC"> about that later and it</font>

388
00:15:56,449 --> 00:16:00,829
gives you if be v1 is supported which is

389
00:15:59,149 --> 00:16:05,899
also something<font color="#E5E5E5"> just really handy in and</font>

390
00:16:00,829 --> 00:16:08,089
<font color="#E5E5E5">out so this</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> very much a post</font>

391
00:16:05,899 --> 00:16:09,470
exploitation tool so you<font color="#E5E5E5"> can't really do</font>

392
00:16:08,089 --> 00:16:11,809
a whole<font color="#E5E5E5"> lot</font><font color="#CCCCCC"> without a set of credentials</font>

393
00:16:09,470 --> 00:16:12,889
in<font color="#E5E5E5"> the first place once it man you can</font>

394
00:16:11,809 --> 00:16:14,299
get<font color="#E5E5E5"> the set of credentials</font><font color="#CCCCCC"> in whichever</font>

395
00:16:12,889 --> 00:16:16,369
<font color="#E5E5E5">means you prefer but once you do have</font><font color="#CCCCCC"> a</font>

396
00:16:14,299 --> 00:16:18,170
set of credentials<font color="#E5E5E5"> you can start doing</font>

397
00:16:16,369 --> 00:16:21,470
<font color="#E5E5E5">some really fun stuff so in this case</font>

398
00:16:18,170 --> 00:16:23,240
I'm<font color="#CCCCCC"> just</font><font color="#E5E5E5"> gonna be using this user that</font>

399
00:16:21,470 --> 00:16:25,759
<font color="#CCCCCC">doesn't really have any sort</font><font color="#E5E5E5"> of</font>

400
00:16:23,240 --> 00:16:27,019
privileges on<font color="#E5E5E5"> the network whatsoever and</font>

401
00:16:25,759 --> 00:16:31,040
what did that shoot flag I'm gonna give

402
00:16:27,019 --> 00:16:33,740
it<font color="#CCCCCC"> the username</font><font color="#E5E5E5"> and with the - PFLAG I'm</font>

403
00:16:31,040 --> 00:16:34,939
gonna give it<font color="#CCCCCC"> the password and what this</font>

404
00:16:33,740 --> 00:16:38,329
<font color="#E5E5E5">is going to do is just going to go</font><font color="#CCCCCC"> out</font>

405
00:16:34,939 --> 00:16:39,709
and it's going to authenticate<font color="#E5E5E5"> to all of</font>

406
00:16:38,329 --> 00:16:42,199
those<font color="#E5E5E5"> machines at</font><font color="#CCCCCC"> the same time so you</font>

407
00:16:39,709 --> 00:16:45,378
might see<font color="#E5E5E5"> here that we have four</font>

408
00:16:42,199 --> 00:16:47,258
authentications<font color="#CCCCCC"> - all those machines be</font>

409
00:16:45,379 --> 00:16:49,879
<font color="#E5E5E5">authenticated to the active directory</font>

410
00:16:47,259 --> 00:16:51,169
these ones<font color="#E5E5E5"> as you</font><font color="#CCCCCC"> see don't</font><font color="#E5E5E5"> have the</font>

411
00:16:49,879 --> 00:16:53,569
little<font color="#CCCCCC"> yellow pwned at the end of it</font>

412
00:16:51,169 --> 00:16:54,499
when you do this<font color="#E5E5E5"> to the a little yellow</font>

413
00:16:53,569 --> 00:16:57,469
<font color="#CCCCCC">pwned at the end of an authentication</font>

414
00:16:54,499 --> 00:17:00,139
attempt<font color="#E5E5E5"> that means you have local admin</font>

415
00:16:57,470 --> 00:17:02,600
privileges<font color="#E5E5E5"> on that machine</font><font color="#CCCCCC"> so this is a</font>

416
00:17:00,139 --> 00:17:05,120
really<font color="#CCCCCC"> quick</font><font color="#E5E5E5"> and easy way of identifying</font>

417
00:17:02,600 --> 00:17:06,770
which set of<font color="#CCCCCC"> credentials you have has</font>

418
00:17:05,119 --> 00:17:08,089
admin<font color="#CCCCCC"> access through those Hope has</font>

419
00:17:06,770 --> 00:17:11,780
admin<font color="#CCCCCC"> access to the hosts that</font><font color="#E5E5E5"> you</font>

420
00:17:08,089 --> 00:17:15,649
specify and once you do that you can

421
00:17:11,780 --> 00:17:17,329
<font color="#E5E5E5">start performing basically everything</font>

422
00:17:15,650 --> 00:17:19,850
your heart desires<font color="#E5E5E5"> or just</font><font color="#CCCCCC"> whatever's</font>

423
00:17:17,329 --> 00:17:23,750
implemented so if I wanted to damp<font color="#E5E5E5"> all</font>

424
00:17:19,849 --> 00:17:25,490
the Sam hashes from<font color="#E5E5E5"> those</font><font color="#CCCCCC"> machines</font><font color="#E5E5E5"> it</font>

425
00:17:23,750 --> 00:17:27,470
will go<font color="#CCCCCC"> out and</font><font color="#E5E5E5"> it'll start dumping and</font>

426
00:17:25,490 --> 00:17:30,410
of course<font color="#E5E5E5"> you might have our first</font><font color="#CCCCCC"> demo</font>

427
00:17:27,470 --> 00:17:35,660
<font color="#CCCCCC">fail</font><font color="#E5E5E5"> here but I do see Sam hashes</font><font color="#CCCCCC"> so</font><font color="#E5E5E5"> it</font>

428
00:17:30,410 --> 00:17:39,800
worked<font color="#E5E5E5"> sort</font><font color="#CCCCCC"> of so yes we do</font><font color="#E5E5E5"> have we did</font>

429
00:17:35,660 --> 00:17:41,660
<font color="#E5E5E5">dump the Sam hashes</font><font color="#CCCCCC"> from</font><font color="#E5E5E5"> those</font><font color="#CCCCCC"> machines</font>

430
00:17:39,800 --> 00:17:43,610
<font color="#E5E5E5">which is awesome and</font><font color="#CCCCCC"> this is all through</font>

431
00:17:41,660 --> 00:17:45,140
<font color="#E5E5E5">Windows RPC calls in the remote</font><font color="#CCCCCC"> registry</font>

432
00:17:43,610 --> 00:17:47,120
by the<font color="#CCCCCC"> way so</font><font color="#E5E5E5"> this</font><font color="#CCCCCC"> is not touching disk</font>

433
00:17:45,140 --> 00:17:49,460
in any way shape or form<font color="#E5E5E5"> and you can see</font>

434
00:17:47,120 --> 00:17:50,989
that also at<font color="#CCCCCC"> the end</font><font color="#E5E5E5"> of here</font><font color="#CCCCCC"> those</font>

435
00:17:49,460 --> 00:17:54,380
credentials<font color="#E5E5E5"> were added to a database and</font>

436
00:17:50,990 --> 00:17:57,650
we'll<font color="#E5E5E5"> get into</font><font color="#CCCCCC"> that in a</font><font color="#E5E5E5"> minute</font><font color="#CCCCCC"> you can</font>

437
00:17:54,380 --> 00:18:00,020
<font color="#E5E5E5">execute commands also on those machines</font>

438
00:17:57,650 --> 00:18:01,460
<font color="#E5E5E5">nightly you have local admin access so</font>

439
00:18:00,020 --> 00:18:05,180
if we wanted to<font color="#CCCCCC"> just</font><font color="#E5E5E5"> do</font><font color="#CCCCCC"> it like I don't</font>

440
00:18:01,460 --> 00:18:07,060
<font color="#E5E5E5">know</font><font color="#CCCCCC"> with the dash X flag you wanted to</font>

441
00:18:05,180 --> 00:18:11,090
<font color="#E5E5E5">just run Who am I</font>

442
00:18:07,060 --> 00:18:12,530
it'll execute that command<font color="#E5E5E5"> all those</font>

443
00:18:11,090 --> 00:18:13,820
<font color="#E5E5E5">machines</font><font color="#CCCCCC"> through WM are by default it</font>

444
00:18:12,530 --> 00:18:16,370
also supports different<font color="#E5E5E5"> execution</font>

445
00:18:13,820 --> 00:18:22,189
methods and it'll give you<font color="#CCCCCC"> the output</font><font color="#E5E5E5"> as</font>

446
00:18:16,370 --> 00:18:23,600
well so once<font color="#E5E5E5"> so we have a way</font><font color="#CCCCCC"> of</font>

447
00:18:22,190 --> 00:18:25,850
executing<font color="#E5E5E5"> code we have a way</font><font color="#CCCCCC"> of</font>

448
00:18:23,600 --> 00:18:27,949
executing<font color="#E5E5E5"> commands what can we do</font><font color="#CCCCCC"> what</font>

449
00:18:25,850 --> 00:18:30,949
<font color="#E5E5E5">else can we do well there's a module</font>

450
00:18:27,950 --> 00:18:34,400
<font color="#CCCCCC">system</font><font color="#E5E5E5"> so if you do that if</font><font color="#CCCCCC"> you use dash</font>

451
00:18:30,950 --> 00:18:36,140
capital<font color="#E5E5E5"> L you'll see that every every</font>

452
00:18:34,400 --> 00:18:38,720
protocol<font color="#E5E5E5"> soap has a different set of</font>

453
00:18:36,140 --> 00:18:40,130
<font color="#E5E5E5">modules in this case this is the SMB</font>

454
00:18:38,720 --> 00:18:42,380
<font color="#CCCCCC">protease env protocol is probably the</font>

455
00:18:40,130 --> 00:18:45,650
most mature one just because<font color="#E5E5E5"> it's really</font>

456
00:18:42,380 --> 00:18:46,610
<font color="#E5E5E5">what it was</font><font color="#CCCCCC"> it started out</font><font color="#E5E5E5"> with but we</font>

457
00:18:45,650 --> 00:18:48,530
can see<font color="#CCCCCC"> that they have a whole different</font>

458
00:18:46,610 --> 00:18:50,659
<font color="#E5E5E5">bunch of modules here that do</font><font color="#CCCCCC"> different</font>

459
00:18:48,530 --> 00:18:52,940
things<font color="#E5E5E5"> so my favorite one is of course</font>

460
00:18:50,660 --> 00:18:56,360
<font color="#CCCCCC">the Mimi Kats one and this really does</font>

461
00:18:52,940 --> 00:18:58,490
what it sounds like<font color="#E5E5E5"> it just invokes Mimi</font>

462
00:18:56,360 --> 00:19:02,209
<font color="#CCCCCC">Kats using</font><font color="#E5E5E5"> PowerShell on all the hosts</font>

463
00:18:58,490 --> 00:19:03,890
you have local admin<font color="#CCCCCC"> access to so what</font>

464
00:19:02,210 --> 00:19:05,450
this is<font color="#E5E5E5"> doing now is going out</font>

465
00:19:03,890 --> 00:19:08,780
authenticating to those<font color="#E5E5E5"> machines</font>

466
00:19:05,450 --> 00:19:11,030
executing a PowerShell one-liner<font color="#CCCCCC"> an IX</font>

467
00:19:08,780 --> 00:19:13,870
cradle<font color="#E5E5E5"> if you're familiar with those to</font>

468
00:19:11,030 --> 00:19:13,870
retrieve invoke mimikatz

469
00:19:14,279 --> 00:19:21,799
then we should be getting output here

470
00:19:16,769 --> 00:19:21,799
which let's try that<font color="#E5E5E5"> again</font>

471
00:19:29,480 --> 00:19:35,140
I'm just gonna<font color="#E5E5E5"> real fast forward here</font>

472
00:19:32,030 --> 00:19:35,139
<font color="#E5E5E5">real quick let's try that again</font>

473
00:19:37,900 --> 00:19:43,400
so it's executing invoke mimikatz using

474
00:19:40,340 --> 00:19:45,379
<font color="#CCCCCC">powershell and there you go</font><font color="#E5E5E5"> Wow okay</font>

475
00:19:43,400 --> 00:19:47,840
<font color="#E5E5E5">perfect that's better</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> we're getting</font>

476
00:19:45,380 --> 00:19:49,720
<font color="#E5E5E5">some credentials right there in memory</font>

477
00:19:47,840 --> 00:19:52,820
that's<font color="#E5E5E5"> better</font>

478
00:19:49,720 --> 00:19:54,410
perfect<font color="#E5E5E5"> so we really so we've actually</font>

479
00:19:52,820 --> 00:19:56,230
can mimic<font color="#E5E5E5"> ATS on four machines at the</font>

480
00:19:54,410 --> 00:19:59,360
same time now of<font color="#CCCCCC"> course</font><font color="#E5E5E5"> I'm I'm gonna</font>

481
00:19:56,230 --> 00:20:01,460
limited in a<font color="#E5E5E5"> lab environment here but</font>

482
00:19:59,360 --> 00:20:03,559
<font color="#E5E5E5">again like you can do this on a slash 24</font>

483
00:20:01,460 --> 00:20:04,970
I don't recommend<font color="#E5E5E5"> it</font><font color="#CCCCCC"> but you can</font>

484
00:20:03,559 --> 00:20:08,149
<font color="#E5E5E5">definitely do this on a slash 24 I've</font>

485
00:20:04,970 --> 00:20:11,270
seen people do<font color="#CCCCCC"> it it yeah it's it's very</font>

486
00:20:08,150 --> 00:20:13,250
noisy<font color="#CCCCCC"> but it can be</font><font color="#E5E5E5"> done so again we</font>

487
00:20:11,270 --> 00:20:14,929
talked about<font color="#E5E5E5"> that database</font><font color="#CCCCCC"> what's</font><font color="#E5E5E5"> great</font>

488
00:20:13,250 --> 00:20:17,630
about<font color="#CCCCCC"> CA me and this is probably some</font>

489
00:20:14,929 --> 00:20:19,070
like some of the some of<font color="#E5E5E5"> those none of</font>

490
00:20:17,630 --> 00:20:20,750
that<font color="#E5E5E5"> functionality that I don't think</font>

491
00:20:19,070 --> 00:20:24,200
<font color="#E5E5E5">people know about that well it is</font>

492
00:20:20,750 --> 00:20:26,059
documented<font color="#E5E5E5"> but again it's not all the</font>

493
00:20:24,200 --> 00:20:28,640
functionality has<font color="#CCCCCC"> been documented</font><font color="#E5E5E5"> but</font>

494
00:20:26,059 --> 00:20:31,010
the tool ships with a<font color="#E5E5E5"> secondary command</font>

495
00:20:28,640 --> 00:20:33,350
<font color="#E5E5E5">line script called</font><font color="#CCCCCC"> CME</font><font color="#E5E5E5"> DB and what this</font>

496
00:20:31,010 --> 00:20:35,450
<font color="#E5E5E5">does is it's a database and it's just a</font>

497
00:20:33,350 --> 00:20:37,790
menu<font color="#E5E5E5"> system it</font><font color="#CCCCCC"> just abstract sort</font><font color="#E5E5E5"> of</font>

498
00:20:35,450 --> 00:20:39,200
interacting<font color="#CCCCCC"> with the database and all of</font>

499
00:20:37,790 --> 00:20:41,990
the stuff<font color="#CCCCCC"> that you do in simi gets</font>

500
00:20:39,200 --> 00:20:43,730
logged here so if you type creds<font color="#CCCCCC"> you'll</font>

501
00:20:41,990 --> 00:20:47,450
see that<font color="#E5E5E5"> all the credentials that we</font>

502
00:20:43,730 --> 00:20:48,740
<font color="#E5E5E5">dumped in some other stuff which it was</font>

503
00:20:47,450 --> 00:20:51,490
just me playing<font color="#E5E5E5"> around so let me just</font>

504
00:20:48,740 --> 00:20:51,490
delete<font color="#CCCCCC"> that real quick</font>

505
00:20:55,940 --> 00:20:59,210
<font color="#E5E5E5">all right</font>

506
00:21:03,070 --> 00:21:06,549
<font color="#E5E5E5">I'm gonna do that one</font><font color="#CCCCCC"> more time</font><font color="#E5E5E5"> so it</font>

507
00:21:04,960 --> 00:21:08,139
populates with<font color="#E5E5E5"> stuff but all the</font>

508
00:21:06,549 --> 00:21:09,940
<font color="#E5E5E5">credentials that we</font><font color="#CCCCCC"> dump</font><font color="#E5E5E5"> either through</font>

509
00:21:08,139 --> 00:21:11,610
<font color="#E5E5E5">mini cats or whatever technique you</font>

510
00:21:09,940 --> 00:21:13,990
<font color="#E5E5E5">prefer it gets logged to this database</font>

511
00:21:11,610 --> 00:21:18,549
<font color="#CCCCCC">so you can you</font><font color="#E5E5E5"> can easily query them</font>

512
00:21:13,990 --> 00:21:27,700
afterwards okay there we go<font color="#E5E5E5"> so I try</font>

513
00:21:18,549 --> 00:21:29,500
<font color="#CCCCCC">that again</font><font color="#E5E5E5"> and each protocol has its own</font>

514
00:21:27,700 --> 00:21:31,000
database<font color="#CCCCCC"> obviously so</font><font color="#E5E5E5"> in this case we're</font>

515
00:21:29,500 --> 00:21:32,769
using<font color="#CCCCCC"> SB protocol so we're an SMU</font>

516
00:21:31,000 --> 00:21:33,899
database<font color="#CCCCCC"> so if you type creds all the</font>

517
00:21:32,769 --> 00:21:37,000
<font color="#E5E5E5">credits</font><font color="#CCCCCC"> that we dumped</font><font color="#E5E5E5"> are stored here</font>

518
00:21:33,899 --> 00:21:39,489
<font color="#E5E5E5">it's also great is all the hosts</font><font color="#CCCCCC"> that we</font>

519
00:21:37,000 --> 00:21:40,929
touched or stored<font color="#E5E5E5"> in this database as</font>

520
00:21:39,490 --> 00:21:44,529
well<font color="#CCCCCC"> you</font><font color="#E5E5E5"> just I post it gives you a list</font>

521
00:21:40,929 --> 00:21:46,559
it also<font color="#E5E5E5"> associates credentials with the</font>

522
00:21:44,529 --> 00:21:49,690
hosts which is great for tracking<font color="#E5E5E5"> those</font>

523
00:21:46,559 --> 00:21:52,629
relationships so<font color="#CCCCCC"> we see here</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> we</font>

524
00:21:49,690 --> 00:21:55,269
have the administrator password

525
00:21:52,629 --> 00:21:57,969
credential here and it tells you<font color="#CCCCCC"> that</font>

526
00:21:55,269 --> 00:22:00,039
it's admin on<font color="#E5E5E5"> for hosts and</font><font color="#CCCCCC"> vice-versa</font>

527
00:21:57,970 --> 00:22:02,230
if<font color="#CCCCCC"> you type hosts it'll tell you that oh</font>

528
00:22:00,039 --> 00:22:04,840
the this<font color="#E5E5E5"> Windows Server this box right</font>

529
00:22:02,230 --> 00:22:08,139
<font color="#CCCCCC">here at 10 you have</font><font color="#E5E5E5"> one credential that</font>

530
00:22:04,840 --> 00:22:09,220
has local admin on that pass and<font color="#E5E5E5"> it's so</font>

531
00:22:08,139 --> 00:22:11,158
that's this is<font color="#E5E5E5"> a really quick</font><font color="#CCCCCC"> and</font><font color="#E5E5E5"> easy</font>

532
00:22:09,220 --> 00:22:14,080
way<font color="#CCCCCC"> of tracking those relationships and</font>

533
00:22:11,159 --> 00:22:16,299
to retrieve<font color="#E5E5E5"> for example if you types</font>

534
00:22:14,080 --> 00:22:18,549
hosts<font color="#E5E5E5"> and you wanted to know like what</font>

535
00:22:16,299 --> 00:22:20,139
credentials<font color="#E5E5E5"> actually have admin access</font>

536
00:22:18,549 --> 00:22:24,250
to those all you give it as the host ID

537
00:22:20,139 --> 00:22:25,600
and it tells you so in this case we have

538
00:22:24,250 --> 00:22:28,629
we see that that credential set has

539
00:22:25,600 --> 00:22:31,209
<font color="#E5E5E5">local admin access</font><font color="#CCCCCC"> to the host where</font>

540
00:22:28,629 --> 00:22:34,029
this<font color="#E5E5E5"> really starts to shine</font><font color="#CCCCCC"> is when you</font>

541
00:22:31,210 --> 00:22:36,580
perform situational awareness<font color="#E5E5E5"> so once</font>

542
00:22:34,029 --> 00:22:43,090
you have even just<font color="#CCCCCC"> a basic set of user</font>

543
00:22:36,580 --> 00:22:44,710
credentials<font color="#CCCCCC"> I'm</font><font color="#E5E5E5"> gonna do this this set</font>

544
00:22:43,090 --> 00:22:46,178
<font color="#E5E5E5">of user credentials so this doesn't have</font>

545
00:22:44,710 --> 00:22:48,220
any privileges<font color="#E5E5E5"> on the network whatsoever</font>

546
00:22:46,179 --> 00:22:49,330
and<font color="#CCCCCC"> we specified the main controller</font>

547
00:22:48,220 --> 00:22:53,879
because<font color="#CCCCCC"> obviously you need</font><font color="#E5E5E5"> the main</font>

548
00:22:49,330 --> 00:22:53,879
controller to pull this information<font color="#E5E5E5"> down</font>

549
00:22:53,970 --> 00:22:58,090
and you give<font color="#CCCCCC"> it a</font><font color="#E5E5E5"> dash dash groups</font>

550
00:22:55,990 --> 00:23:03,450
option<font color="#E5E5E5"> that'll just pull</font><font color="#CCCCCC"> down a list of</font>

551
00:22:58,090 --> 00:23:06,668
<font color="#E5E5E5">all the main groups on in the domain and</font>

552
00:23:03,450 --> 00:23:08,409
it will also<font color="#E5E5E5"> give you a member account</font>

553
00:23:06,669 --> 00:23:10,840
<font color="#E5E5E5">and you can also enumerate members of</font>

554
00:23:08,409 --> 00:23:13,600
those<font color="#CCCCCC"> groups by just</font><font color="#E5E5E5"> passing the name of</font>

555
00:23:10,840 --> 00:23:15,129
the group to<font color="#E5E5E5"> the domain the dash dash</font>

556
00:23:13,600 --> 00:23:16,209
groups flag so in this case domain

557
00:23:15,129 --> 00:23:17,800
admins

558
00:23:16,210 --> 00:23:18,730
<font color="#CCCCCC">funny thing to write that you can see we</font>

559
00:23:17,800 --> 00:23:22,990
have two<font color="#E5E5E5"> members of the main evidence</font>

560
00:23:18,730 --> 00:23:26,830
group here and this gets logged to the

561
00:23:22,990 --> 00:23:31,980
database as<font color="#CCCCCC"> well</font><font color="#E5E5E5"> and I keep forgetting</font>

562
00:23:26,830 --> 00:23:31,980
<font color="#CCCCCC">to put</font><font color="#E5E5E5"> Souter with</font><font color="#CCCCCC"> thee</font><font color="#E5E5E5"> any of this</font>

563
00:23:34,710 --> 00:23:37,780
there you go

564
00:23:36,100 --> 00:23:40,480
so all<font color="#E5E5E5"> the all that information</font><font color="#CCCCCC"> gets</font>

565
00:23:37,780 --> 00:23:42,010
logged to the database and<font color="#E5E5E5"> this kits</font>

566
00:23:40,480 --> 00:23:43,720
constantly updated<font color="#CCCCCC"> just the more</font>

567
00:23:42,010 --> 00:23:45,550
information<font color="#CCCCCC"> you pull from</font><font color="#E5E5E5"> the Active</font>

568
00:23:43,720 --> 00:23:47,650
Directory<font color="#E5E5E5"> so at the end your pen test</font>

569
00:23:45,550 --> 00:23:50,710
this database<font color="#E5E5E5"> is going to look a lot</font>

570
00:23:47,650 --> 00:23:52,240
<font color="#CCCCCC">like</font><font color="#E5E5E5"> your in your just Active Directory</font>

571
00:23:50,710 --> 00:23:54,310
environment<font color="#E5E5E5"> is the same it's going</font><font color="#CCCCCC"> to be</font>

572
00:23:52,240 --> 00:23:56,140
<font color="#E5E5E5">basically almost well if you</font><font color="#CCCCCC"> pulled out</font>

573
00:23:54,310 --> 00:23:57,250
<font color="#E5E5E5">all the</font><font color="#CCCCCC"> information</font><font color="#E5E5E5"> it'll be a complete</font>

574
00:23:56,140 --> 00:23:59,740
<font color="#E5E5E5">copy of</font><font color="#CCCCCC"> your the Active</font><font color="#E5E5E5"> Directory</font>

575
00:23:57,250 --> 00:24:02,740
environment to a certain point<font color="#E5E5E5"> I mean if</font>

576
00:23:59,740 --> 00:24:07,300
we wanted<font color="#CCCCCC"> to</font><font color="#E5E5E5"> query the members of that</font>

577
00:24:02,740 --> 00:24:12,240
<font color="#CCCCCC">domain admins group again just give</font><font color="#E5E5E5"> it</font>

578
00:24:07,300 --> 00:24:12,240
the a group ID rather

579
00:24:21,049 --> 00:24:25,970
there you go<font color="#E5E5E5"> okay</font><font color="#CCCCCC"> so give it the</font><font color="#E5E5E5"> groups</font>

580
00:24:23,989 --> 00:24:27,289
you<font color="#E5E5E5"> see in it you can search so if you</font>

581
00:24:25,970 --> 00:24:28,549
just give it admins it'll just give you

582
00:24:27,289 --> 00:24:33,860
<font color="#CCCCCC">all the groups that</font><font color="#E5E5E5"> have admins in the</font>

583
00:24:28,549 --> 00:24:37,519
name and<font color="#E5E5E5"> give it the group ID and it</font>

584
00:24:33,860 --> 00:24:38,959
<font color="#E5E5E5">tells you those those members and if you</font>

585
00:24:37,519 --> 00:24:41,059
already<font color="#E5E5E5"> have</font><font color="#CCCCCC"> that password</font><font color="#E5E5E5"> it'll</font>

586
00:24:38,960 --> 00:24:42,440
automatically populate that<font color="#E5E5E5"> as well so</font>

587
00:24:41,059 --> 00:24:43,908
<font color="#CCCCCC">it'll it just</font><font color="#E5E5E5"> keeps track of everything</font>

588
00:24:42,440 --> 00:24:48,799
<font color="#E5E5E5">for you which is really</font><font color="#CCCCCC"> really</font><font color="#E5E5E5"> handy</font><font color="#CCCCCC"> and</font>

589
00:24:43,909 --> 00:24:50,570
large engagements another really cool

590
00:24:48,799 --> 00:24:51,980
<font color="#CCCCCC">feature is that you can just it really</font>

591
00:24:50,570 --> 00:24:57,499
<font color="#E5E5E5">this is a really</font><font color="#CCCCCC"> quick</font><font color="#E5E5E5"> and easy way</font><font color="#CCCCCC"> of a</font>

592
00:24:51,980 --> 00:24:58,820
new<font color="#CCCCCC"> morang shares on</font><font color="#E5E5E5"> the network so you</font>

593
00:24:57,499 --> 00:25:00,830
give<font color="#E5E5E5"> it</font><font color="#CCCCCC"> the IP address range you're</font>

594
00:24:58,820 --> 00:25:02,809
getting specified - - shares<font color="#E5E5E5"> it'll go</font>

595
00:25:00,830 --> 00:25:05,359
out<font color="#CCCCCC"> and it'll</font><font color="#E5E5E5"> just you knew</font><font color="#CCCCCC"> more eight</font>

596
00:25:02,809 --> 00:25:06,889
all the available shares on every host

597
00:25:05,359 --> 00:25:09,649
<font color="#E5E5E5">and it'll give you permission so that</font>

598
00:25:06,889 --> 00:25:11,330
<font color="#E5E5E5">share as well so we have read</font><font color="#CCCCCC"> premier we</font>

599
00:25:09,649 --> 00:25:13,820
have read permissions on everything

600
00:25:11,330 --> 00:25:15,049
except for this share here called don't

601
00:25:13,820 --> 00:25:16,340
<font color="#E5E5E5">look which obviously we're going to want</font>

602
00:25:15,049 --> 00:25:17,960
<font color="#CCCCCC">to</font><font color="#E5E5E5"> look at that</font><font color="#CCCCCC"> because that sounds</font>

603
00:25:16,340 --> 00:25:19,488
interesting<font color="#CCCCCC"> and we have read/write</font>

604
00:25:17,960 --> 00:25:24,109
permissions as well so that that might

605
00:25:19,489 --> 00:25:26,389
<font color="#E5E5E5">be fun so what happens if we want to</font>

606
00:25:24,109 --> 00:25:28,879
spider that<font color="#E5E5E5"> share for example looking</font>

607
00:25:26,389 --> 00:25:31,459
for information<font color="#CCCCCC"> well we have the</font><font color="#E5E5E5"> -</font><font color="#CCCCCC"> our</font>

608
00:25:28,879 --> 00:25:35,389
spider flag<font color="#E5E5E5"> you give it the name</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the</font>

609
00:25:31,460 --> 00:25:38,210
share so in this<font color="#E5E5E5"> case it's don't look</font>

610
00:25:35,389 --> 00:25:40,248
<font color="#E5E5E5">and we just give it</font><font color="#CCCCCC"> the one IP address</font>

611
00:25:38,210 --> 00:25:42,440
because<font color="#E5E5E5"> otherwise it'll just try</font><font color="#CCCCCC"> and</font>

612
00:25:40,249 --> 00:25:43,999
spider<font color="#CCCCCC"> all of</font><font color="#E5E5E5"> those machines which I</font>

613
00:25:42,440 --> 00:25:49,669
mean<font color="#E5E5E5"> you could but they don't have that</font>

614
00:25:43,999 --> 00:25:52,220
share<font color="#E5E5E5"> alrighty and we'll just give it a</font>

615
00:25:49,669 --> 00:25:54,529
<font color="#E5E5E5">pattern to search for in this case pass</font>

616
00:25:52,220 --> 00:25:55,879
really quick<font color="#E5E5E5"> and easy</font><font color="#CCCCCC"> so there</font><font color="#E5E5E5"> you go</font><font color="#CCCCCC"> so</font>

617
00:25:54,529 --> 00:25:57,830
<font color="#E5E5E5">we have password that txt in there</font>

618
00:25:55,879 --> 00:26:01,609
<font color="#CCCCCC">what's also great about this is</font><font color="#E5E5E5"> that you</font>

619
00:25:57,830 --> 00:26:03,649
can<font color="#CCCCCC"> spider file content</font><font color="#E5E5E5"> as well and then</font>

620
00:26:01,609 --> 00:26:06,230
not just<font color="#E5E5E5"> the name</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> the file so for</font>

621
00:26:03,649 --> 00:26:09,080
<font color="#E5E5E5">example</font><font color="#CCCCCC"> I if</font><font color="#E5E5E5"> we just wanted to look for</font>

622
00:26:06,230 --> 00:26:10,429
<font color="#E5E5E5">the pattern and password and the file</font>

623
00:26:09,080 --> 00:26:13,908
contents you just give<font color="#E5E5E5"> it the - -</font>

624
00:26:10,429 --> 00:26:15,739
content flag on<font color="#CCCCCC"> top of that and it'll</font><font color="#E5E5E5"> go</font>

625
00:26:13,909 --> 00:26:17,299
out spider that share and you<font color="#E5E5E5"> can see</font>

626
00:26:15,739 --> 00:26:19,309
there's a second here now<font color="#E5E5E5"> it said just</font>

627
00:26:17,299 --> 00:26:22,070
<font color="#E5E5E5">cooking that txt but apparently</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> that</font>

628
00:26:19,309 --> 00:26:23,739
file has the<font color="#E5E5E5"> pattern password in it so</font>

629
00:26:22,070 --> 00:26:26,989
that's really<font color="#CCCCCC"> sick quick and easy way of</font>

630
00:26:23,739 --> 00:26:28,970
spidering shares as<font color="#CCCCCC"> well once you do</font>

631
00:26:26,989 --> 00:26:32,140
<font color="#CCCCCC">have once</font><font color="#E5E5E5"> you do know where the domain</font>

632
00:26:28,970 --> 00:26:33,700
controls are you can<font color="#E5E5E5"> also</font>

633
00:26:32,140 --> 00:26:35,740
<font color="#E5E5E5">this is one</font><font color="#CCCCCC"> of the first things that</font><font color="#E5E5E5"> I</font>

634
00:26:33,700 --> 00:26:39,370
do once I have some set<font color="#CCCCCC"> of user</font>

635
00:26:35,740 --> 00:26:44,140
credentials<font color="#CCCCCC"> I use the GP passwords</font>

636
00:26:39,370 --> 00:26:45,459
module which what this is<font color="#CCCCCC"> it'll spider</font>

637
00:26:44,140 --> 00:26:47,860
the sysvol share on a domain<font color="#CCCCCC"> controller</font>

638
00:26:45,460 --> 00:26:50,980
<font color="#E5E5E5">it'll look for</font><font color="#CCCCCC"> a group group policy</font>

639
00:26:47,860 --> 00:26:52,689
objects<font color="#E5E5E5"> XML objects in that</font><font color="#CCCCCC"> sis file</font>

640
00:26:50,980 --> 00:26:54,880
share containing the<font color="#E5E5E5"> C password tribute</font>

641
00:26:52,690 --> 00:26:57,130
and what that and<font color="#E5E5E5"> usually what that</font>

642
00:26:54,880 --> 00:27:01,470
<font color="#E5E5E5">means is that someone pushed out local</font>

643
00:26:57,130 --> 00:27:03,520
accounts<font color="#E5E5E5"> using</font><font color="#CCCCCC"> Group</font><font color="#E5E5E5"> Policy preferences</font>

644
00:27:01,470 --> 00:27:05,520
<font color="#E5E5E5">so there you go so it's part of the</font>

645
00:27:03,520 --> 00:27:08,950
sysvol share looking for<font color="#E5E5E5"> those XML files</font>

646
00:27:05,520 --> 00:27:10,930
<font color="#CCCCCC">it</font><font color="#E5E5E5"> found a couple of XML files which</font>

647
00:27:08,950 --> 00:27:12,730
could contain that<font color="#E5E5E5"> C password attribute</font>

648
00:27:10,930 --> 00:27:14,530
that's<font color="#E5E5E5"> the password</font><font color="#CCCCCC"> tribute if you don't</font>

649
00:27:12,730 --> 00:27:17,380
know is encrypted<font color="#E5E5E5"> with AES but Microsoft</font>

650
00:27:14,530 --> 00:27:19,930
<font color="#CCCCCC">around</font><font color="#E5E5E5"> I'm gonna say 2010 release the</font>

651
00:27:17,380 --> 00:27:22,690
private key for<font color="#CCCCCC"> that</font><font color="#E5E5E5"> for that encryption</font>

652
00:27:19,930 --> 00:27:24,370
so we can just anyone can<font color="#E5E5E5"> just go out</font>

653
00:27:22,690 --> 00:27:25,660
<font color="#CCCCCC">and decrypt that now since everyone can</font>

654
00:27:24,370 --> 00:27:28,360
<font color="#E5E5E5">access this is full share it's just how</font>

655
00:27:25,660 --> 00:27:29,650
Active Directory works so we found<font color="#E5E5E5"> that</font>

656
00:27:28,360 --> 00:27:31,659
we have a<font color="#E5E5E5"> local administrator</font><font color="#CCCCCC"> account</font>

657
00:27:29,650 --> 00:27:32,730
for<font color="#E5E5E5"> example that pushed out that was</font>

658
00:27:31,660 --> 00:27:40,840
pushed out<font color="#CCCCCC"> of a group policy preferences</font>

659
00:27:32,730 --> 00:27:42,490
<font color="#E5E5E5">with that password another really cool</font>

660
00:27:40,840 --> 00:27:45,030
<font color="#CCCCCC">thing that you</font><font color="#E5E5E5"> can</font><font color="#CCCCCC"> do with this is just</font>

661
00:27:42,490 --> 00:27:47,860
<font color="#CCCCCC">get shells on every boxes once you have</font>

662
00:27:45,030 --> 00:27:50,889
active that local admin permission you

663
00:27:47,860 --> 00:27:52,479
can either via Empire or<font color="#E5E5E5"> Metasploit</font><font color="#CCCCCC"> you</font>

664
00:27:50,890 --> 00:27:53,680
can get shell in those boxes I<font color="#CCCCCC"> have a</font>

665
00:27:52,480 --> 00:28:02,620
video<font color="#E5E5E5"> for this because I don't trust</font>

666
00:27:53,680 --> 00:28:05,950
<font color="#E5E5E5">myself doing this live yes it does</font>

667
00:28:02,620 --> 00:28:07,659
so did he he asked if the spiders

668
00:28:05,950 --> 00:28:09,730
proposed regex I gave it a<font color="#E5E5E5"> pattern there</font>

669
00:28:07,660 --> 00:28:11,650
<font color="#E5E5E5">but yeah with a - -</font><font color="#CCCCCC"> Greg X flag</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> can</font>

670
00:28:09,730 --> 00:28:21,270
specify<font color="#E5E5E5"> red X and it'll spotted</font><font color="#CCCCCC"> it for</font>

671
00:28:11,650 --> 00:28:21,270
you let's see if I can pull this<font color="#E5E5E5"> up</font>

672
00:28:25,450 --> 00:28:31,929
<font color="#CCCCCC">all righty</font><font color="#E5E5E5"> so this is just getting an</font>

673
00:28:29,610 --> 00:28:35,500
empire this is just getting<font color="#CCCCCC"> an empire</font>

674
00:28:31,929 --> 00:28:37,960
agent on<font color="#E5E5E5"> every machine in this lab</font>

675
00:28:35,500 --> 00:28:41,230
environment so what I'm doing<font color="#E5E5E5"> here</font><font color="#CCCCCC"> is I</font>

676
00:28:37,960 --> 00:28:42,760
am<font color="#E5E5E5"> querying</font><font color="#CCCCCC"> the Empire the Empire exact</font>

677
00:28:41,230 --> 00:28:45,389
model for the options so with the dashed

678
00:28:42,760 --> 00:28:48,220
<font color="#CCCCCC">options</font><font color="#E5E5E5"> flag you</font><font color="#CCCCCC"> can query those options</font>

679
00:28:45,389 --> 00:28:49,510
and you see it and<font color="#E5E5E5"> it only supported one</font>

680
00:28:48,220 --> 00:28:50,260
<font color="#E5E5E5">which was the listener so you should</font>

681
00:28:49,510 --> 00:28:52,059
have to give you the name<font color="#CCCCCC"> of the</font>

682
00:28:50,260 --> 00:28:57,908
listener<font color="#CCCCCC"> that you spun up an empire</font><font color="#E5E5E5"> this</font>

683
00:28:52,059 --> 00:29:00,450
<font color="#E5E5E5">case the name is HDPE so they give the</font>

684
00:28:57,909 --> 00:29:00,450
<font color="#E5E5E5">target range</font>

685
00:29:06,660 --> 00:29:12,350
and the<font color="#E5E5E5"> user password</font>

686
00:29:14,840 --> 00:29:19,260
specify the module in<font color="#E5E5E5"> this case the</font>

687
00:29:16,680 --> 00:29:22,350
modules name is Empire exec<font color="#E5E5E5"> and you give</font>

688
00:29:19,260 --> 00:29:24,379
it<font color="#CCCCCC"> that listener name and you're good</font><font color="#E5E5E5"> to</font>

689
00:29:22,350 --> 00:29:24,379
go

690
00:29:25,550 --> 00:29:30,540
<font color="#E5E5E5">so it goes out it authenticates to every</font>

691
00:29:28,590 --> 00:29:32,639
machine on<font color="#CCCCCC"> the network</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> you can see</font>

692
00:29:30,540 --> 00:29:35,040
that<font color="#E5E5E5"> it and it automatically generated</font>

693
00:29:32,640 --> 00:29:37,010
the Empire launcher<font color="#CCCCCC"> through the</font><font color="#E5E5E5"> Empire's</font>

694
00:29:35,040 --> 00:29:39,870
<font color="#E5E5E5">restful api which I spun up beforehand</font>

695
00:29:37,010 --> 00:29:41,879
<font color="#CCCCCC">and</font><font color="#E5E5E5"> it goes out</font><font color="#CCCCCC"> executes</font><font color="#E5E5E5"> that Empire</font>

696
00:29:39,870 --> 00:29:44,909
launcher<font color="#E5E5E5"> and you see here we got an</font>

697
00:29:41,880 --> 00:29:46,770
agent<font color="#CCCCCC"> every machine now which is</font><font color="#E5E5E5"> really</font>

698
00:29:44,910 --> 00:29:55,710
cool I've seen people<font color="#CCCCCC"> do this</font><font color="#E5E5E5"> on a slash</font>

699
00:29:46,770 --> 00:29:57,480
24 again I do<font color="#E5E5E5"> not recommend it and here</font>

700
00:29:55,710 --> 00:29:59,850
I just interact with<font color="#CCCCCC"> the agent</font><font color="#E5E5E5"> just</font><font color="#CCCCCC"> make</font>

701
00:29:57,480 --> 00:30:05,100
<font color="#E5E5E5">sure you guys</font><font color="#CCCCCC"> know I'm</font><font color="#E5E5E5"> not cheating it</font>

702
00:29:59,850 --> 00:30:06,780
anyway<font color="#E5E5E5"> and there you go so that's</font>

703
00:30:05,100 --> 00:30:09,899
through<font color="#E5E5E5"> Empire you do the same thing</font>

704
00:30:06,780 --> 00:30:11,490
through<font color="#CCCCCC"> Metasploit using the</font><font color="#E5E5E5"> Met inject</font>

705
00:30:09,900 --> 00:30:13,740
module there's actually two modules

706
00:30:11,490 --> 00:30:16,650
there's a<font color="#CCCCCC"> Met inject module just pull</font>

707
00:30:13,740 --> 00:30:18,570
that<font color="#E5E5E5"> up real quick as this met inject</font>

708
00:30:16,650 --> 00:30:20,460
module which basically downloads the

709
00:30:18,570 --> 00:30:24,350
<font color="#E5E5E5">shellcode</font><font color="#CCCCCC"> mint in this case of reverse</font>

710
00:30:20,460 --> 00:30:26,610
<font color="#E5E5E5">HTTP shell code from the multi handler</font>

711
00:30:24,350 --> 00:30:28,740
<font color="#E5E5E5">there's also the web delivery</font><font color="#CCCCCC"> module</font>

712
00:30:26,610 --> 00:30:30,629
which just<font color="#CCCCCC"> executes</font><font color="#E5E5E5"> that one-liner</font>

713
00:30:28,740 --> 00:30:33,690
PowerShell script from<font color="#CCCCCC"> the web delivery</font>

714
00:30:30,630 --> 00:30:36,090
<font color="#E5E5E5">module and Metasploit so this module</font>

715
00:30:33,690 --> 00:30:39,350
<font color="#E5E5E5">except a couple</font><font color="#CCCCCC"> other options in this</font>

716
00:30:36,090 --> 00:30:41,399
case<font color="#E5E5E5"> there is</font><font color="#CCCCCC"> the l host and l port</font>

717
00:30:39,350 --> 00:30:43,219
option which of course<font color="#E5E5E5"> you just have to</font>

718
00:30:41,400 --> 00:30:47,010
give<font color="#E5E5E5"> it those parameters from the</font>

719
00:30:43,220 --> 00:30:51,990
listener that<font color="#E5E5E5"> you spun up shall we give</font>

720
00:30:47,010 --> 00:30:54,890
<font color="#CCCCCC">it the help the l host l port we start</font>

721
00:30:51,990 --> 00:30:54,890
the handler here

722
00:30:59,910 --> 00:31:05,170
and perfect<font color="#CCCCCC"> so you got that going</font><font color="#E5E5E5"> it's</font>

723
00:31:03,580 --> 00:31:06,970
now<font color="#E5E5E5"> going out it's executing a</font>

724
00:31:05,170 --> 00:31:08,170
PowerShell script which<font color="#CCCCCC"> is just</font><font color="#E5E5E5"> gonna</font>

725
00:31:06,970 --> 00:31:10,060
pull down<font color="#CCCCCC"> that shellcode</font><font color="#E5E5E5"> from the</font>

726
00:31:08,170 --> 00:31:11,410
listener and we see we got<font color="#CCCCCC"> Roo getting</font>

727
00:31:10,060 --> 00:31:19,600
mature<font color="#E5E5E5"> for shells from all the</font><font color="#CCCCCC"> machines</font>

728
00:31:11,410 --> 00:31:20,560
on<font color="#E5E5E5"> the subnet so that's awesome so again</font>

729
00:31:19,600 --> 00:31:24,240
this is just<font color="#E5E5E5"> a quick and easy way of</font>

730
00:31:20,560 --> 00:31:24,240
blobbing shells between frameworks

731
00:31:30,980 --> 00:31:36,289
so as I<font color="#E5E5E5"> said before</font><font color="#CCCCCC"> sort</font><font color="#E5E5E5"> of version 4.0</font>

732
00:31:35,240 --> 00:31:38,539
of<font color="#CCCCCC"> the framework supports other</font>

733
00:31:36,289 --> 00:31:41,539
protocols as<font color="#CCCCCC"> well so you've</font><font color="#E5E5E5"> seen so</font><font color="#CCCCCC"> far</font>

734
00:31:38,539 --> 00:31:43,429
<font color="#E5E5E5">on some of this stuff that I can do with</font>

735
00:31:41,539 --> 00:31:45,500
SMB I can't show everything<font color="#E5E5E5"> there's a</font>

736
00:31:43,429 --> 00:31:47,870
ton of flags for the SMB protocol just

737
00:31:45,500 --> 00:31:49,760
<font color="#E5E5E5">because for</font><font color="#CCCCCC"> interest</font><font color="#E5E5E5"> of time but I'm</font>

738
00:31:47,870 --> 00:31:51,830
going<font color="#CCCCCC"> to show off the mssql module now</font>

739
00:31:49,760 --> 00:31:54,500
so this basically allows<font color="#E5E5E5"> you to do the</font>

740
00:31:51,830 --> 00:31:56,240
<font color="#E5E5E5">same things through MSS sequel databases</font>

741
00:31:54,500 --> 00:31:58,130
that<font color="#E5E5E5"> you find that are network enabled</font>

742
00:31:56,240 --> 00:32:10,130
<font color="#E5E5E5">so if in this case</font><font color="#CCCCCC"> if I just</font><font color="#E5E5E5"> give it</font><font color="#CCCCCC"> the</font>

743
00:31:58,130 --> 00:32:13,039
IP address range again it'll<font color="#E5E5E5"> go</font><font color="#CCCCCC"> out and</font>

744
00:32:10,130 --> 00:32:14,750
it'll try<font color="#CCCCCC"> to discover all the MSS sequel</font>

745
00:32:13,039 --> 00:32:17,000
instances that<font color="#CCCCCC"> are network enabled on</font>

746
00:32:14,750 --> 00:32:20,059
the<font color="#E5E5E5"> subnet so in this case we see that</font>

747
00:32:17,000 --> 00:32:24,230
<font color="#E5E5E5">there's only one</font><font color="#CCCCCC"> running on a Windows 7</font>

748
00:32:20,059 --> 00:32:26,168
<font color="#CCCCCC">machine</font><font color="#E5E5E5"> and what's great about this is</font>

749
00:32:24,230 --> 00:32:28,730
that<font color="#E5E5E5"> if</font><font color="#CCCCCC"> you do happen</font><font color="#E5E5E5"> to find</font>

750
00:32:26,169 --> 00:32:30,649
<font color="#E5E5E5">credentials for those for that MSS</font>

751
00:32:28,730 --> 00:32:32,299
sequel database<font color="#E5E5E5"> either via</font><font color="#CCCCCC"> responders</font>

752
00:32:30,649 --> 00:32:34,340
some other means you can authenticate to

753
00:32:32,299 --> 00:32:38,779
<font color="#E5E5E5">that sequel database and</font><font color="#CCCCCC"> XE</font><font color="#E5E5E5"> who commands</font>

754
00:32:34,340 --> 00:32:43,899
through it so I'm just<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to give it</font>

755
00:32:38,779 --> 00:32:43,899
the<font color="#CCCCCC"> straighter password here</font>

756
00:32:46,810 --> 00:32:52,060
<font color="#E5E5E5">the</font><font color="#CCCCCC"> dash</font><font color="#E5E5E5"> X flag specifies again just the</font>

757
00:32:49,450 --> 00:32:52,750
command that<font color="#E5E5E5"> I want to run so what this</font>

758
00:32:52,060 --> 00:32:54,280
is<font color="#CCCCCC"> going</font><font color="#E5E5E5"> to do it's going to</font>

759
00:32:52,750 --> 00:32:57,040
authenticate to<font color="#E5E5E5"> that sequel database</font>

760
00:32:54,280 --> 00:32:58,600
it's going to use<font color="#E5E5E5"> the XP CMD shell</font><font color="#CCCCCC"> trick</font>

761
00:32:57,040 --> 00:33:02,500
<font color="#E5E5E5">to execute commands through the database</font>

762
00:32:58,600 --> 00:33:05,469
and you see we got output from<font color="#CCCCCC"> that</font>

763
00:33:02,500 --> 00:33:07,330
command so what's cool<font color="#E5E5E5"> about this is</font><font color="#CCCCCC"> now</font>

764
00:33:05,470 --> 00:33:09,070
we<font color="#E5E5E5"> can execute PowerShell commands and</font>

765
00:33:07,330 --> 00:33:10,750
modules through the sequel database<font color="#CCCCCC"> so</font>

766
00:33:09,070 --> 00:33:13,300
if you wanted the<font color="#CCCCCC"> Mimi Kats something</font>

767
00:33:10,750 --> 00:33:15,520
through the<font color="#E5E5E5"> sake sequel database you can</font>

768
00:33:13,300 --> 00:33:20,770
do<font color="#E5E5E5"> that with</font><font color="#CCCCCC"> CMA so just by specifying</font>

769
00:33:15,520 --> 00:33:22,300
the<font color="#E5E5E5"> module again in a cat's module what</font>

770
00:33:20,770 --> 00:33:23,860
this is<font color="#E5E5E5"> going to do is it's gonna Afeni</font>

771
00:33:22,300 --> 00:33:25,840
<font color="#E5E5E5">Kate to the sequel database execute that</font>

772
00:33:23,860 --> 00:33:28,260
PowerShell launcher<font color="#CCCCCC"> you should be</font>

773
00:33:25,840 --> 00:33:30,580
getting<font color="#E5E5E5"> a call</font><font color="#CCCCCC"> back here real quick</font>

774
00:33:28,260 --> 00:33:31,150
there you go so it downloaded invoke

775
00:33:30,580 --> 00:33:34,240
mimikatz

776
00:33:31,150 --> 00:33:36,910
and this is all going<font color="#E5E5E5"> through HTTP by</font>

777
00:33:34,240 --> 00:33:40,330
the way so it's spinning up a local HTTP

778
00:33:36,910 --> 00:33:43,380
server the<font color="#E5E5E5"> post that we're attacking</font><font color="#CCCCCC"> is</font>

779
00:33:40,330 --> 00:33:45,970
downloading that<font color="#E5E5E5"> PowerShell script and</font>

780
00:33:43,380 --> 00:33:47,530
<font color="#E5E5E5">it's executing it</font><font color="#CCCCCC"> in this</font><font color="#E5E5E5"> case we don't</font>

781
00:33:45,970 --> 00:33:52,330
<font color="#E5E5E5">get it in your output because apparently</font>

782
00:33:47,530 --> 00:33:57,160
I might have not logged<font color="#E5E5E5"> in but it does</font>

783
00:33:52,330 --> 00:33:58,449
<font color="#E5E5E5">work so we</font><font color="#CCCCCC"> just executed it meaty cats</font>

784
00:33:57,160 --> 00:34:00,490
through the sequel database which i

785
00:33:58,450 --> 00:34:06,040
think is pretty<font color="#E5E5E5"> cool another really cool</font>

786
00:34:00,490 --> 00:34:11,699
trick<font color="#E5E5E5"> is let me see if I</font><font color="#CCCCCC"> wanna see if</font>

787
00:34:06,040 --> 00:34:15,279
<font color="#E5E5E5">this works this might be its might</font>

788
00:34:11,699 --> 00:34:22,000
whenever I do this<font color="#CCCCCC"> it's just demo fails</font>

789
00:34:15,280 --> 00:34:24,460
but I'm<font color="#E5E5E5"> gonna do this real quick so what</font>

790
00:34:22,000 --> 00:34:28,179
I did<font color="#E5E5E5"> here</font><font color="#CCCCCC"> is</font><font color="#E5E5E5"> I'm starting up a VNC</font>

791
00:34:24,460 --> 00:34:30,240
viewer<font color="#E5E5E5"> and</font><font color="#CCCCCC"> verse in</font><font color="#E5E5E5"> Reverse mode so</font><font color="#CCCCCC"> that</font>

792
00:34:28,179 --> 00:34:33,220
it<font color="#E5E5E5"> releases for incoming VNC connections</font>

793
00:34:30,239 --> 00:34:35,290
so I have a VNC viewer<font color="#E5E5E5"> instance set up</font>

794
00:34:33,219 --> 00:34:36,969
there I'm<font color="#E5E5E5"> going to target this</font><font color="#CCCCCC"> machines</font>

795
00:34:35,290 --> 00:34:39,250
and I'm gonna execute<font color="#E5E5E5"> invoke VNC</font>

796
00:34:36,969 --> 00:34:40,569
you'd both be in<font color="#CCCCCC"> C module which</font>

797
00:34:39,250 --> 00:34:44,020
basically does<font color="#CCCCCC"> what it sounded</font><font color="#E5E5E5"> like</font>

798
00:34:40,570 --> 00:34:49,990
it just injects<font color="#E5E5E5"> a VNC client in memory</font>

799
00:34:44,020 --> 00:34:51,600
using PowerShell I'm just<font color="#CCCCCC"> gonna</font><font color="#E5E5E5"> look at</font>

800
00:34:49,989 --> 00:34:54,489
<font color="#E5E5E5">the options for</font><font color="#CCCCCC"> this module real quick</font>

801
00:34:51,600 --> 00:34:56,949
<font color="#E5E5E5">so by default it's a reverse connection</font>

802
00:34:54,489 --> 00:34:57,939
but you<font color="#E5E5E5"> can set it to bind as well you</font>

803
00:34:56,949 --> 00:34:59,560
just<font color="#CCCCCC"> have to give it the port in the</font>

804
00:34:57,940 --> 00:35:00,339
<font color="#E5E5E5">password for the connection so I'm just</font>

805
00:34:59,560 --> 00:35:04,420
<font color="#E5E5E5">gonna</font>

806
00:35:00,339 --> 00:35:10,089
specify those real quick so the<font color="#E5E5E5"> port I</font>

807
00:35:04,420 --> 00:35:17,999
think it was five five<font color="#E5E5E5"> five zero I'm</font>

808
00:35:10,089 --> 00:35:23,799
pretty sure the password we're gonna do

809
00:35:17,999 --> 00:35:25,299
<font color="#E5E5E5">demo up this but</font><font color="#CCCCCC"> oh okay</font>

810
00:35:23,799 --> 00:35:27,219
<font color="#E5E5E5">almost see well we're gonna be executing</font>

811
00:35:25,299 --> 00:35:28,690
VNC through the MSS sequel database

812
00:35:27,219 --> 00:35:36,279
apparently<font color="#E5E5E5"> so let's see if this works</font>

813
00:35:28,690 --> 00:35:37,539
I'm not exactly sure they're<font color="#E5E5E5"> actually</font>

814
00:35:36,279 --> 00:35:39,930
<font color="#E5E5E5">done this before</font><font color="#CCCCCC"> is it gonna be</font>

815
00:35:37,539 --> 00:35:39,930
interesting

816
00:35:45,300 --> 00:35:51,350
well that I<font color="#E5E5E5"> think I closed out the hold</font>

817
00:35:48,300 --> 00:35:51,350
<font color="#E5E5E5">on let's try</font><font color="#CCCCCC"> that again</font>

818
00:35:55,490 --> 00:36:00,009
<font color="#E5E5E5">oh I</font><font color="#CCCCCC"> dress already yes okay</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> it's here</font>

819
00:35:57,800 --> 00:36:00,010
somewhere

820
00:36:09,290 --> 00:36:13,509
<font color="#E5E5E5">all right five five zero zero</font><font color="#CCCCCC"> oh</font><font color="#E5E5E5"> yeah</font>

821
00:36:12,110 --> 00:36:17,200
I'm gonna<font color="#E5E5E5"> try that one more time</font>

822
00:36:13,510 --> 00:36:17,200
only through<font color="#CCCCCC"> SMB</font>

823
00:36:29,110 --> 00:36:38,500
<font color="#CCCCCC">okay and</font><font color="#E5E5E5"> see perfect</font><font color="#CCCCCC"> oh and now we have</font>

824
00:36:33,280 --> 00:36:39,910
a full VNC session with the<font color="#E5E5E5"> hosts so it</font>

825
00:36:38,500 --> 00:36:42,280
really quick and<font color="#CCCCCC"> easy</font><font color="#E5E5E5"> wait so if you</font>

826
00:36:39,910 --> 00:36:43,600
ever done this via<font color="#CCCCCC"> Metasploit or</font><font color="#E5E5E5"> I don't</font>

827
00:36:42,280 --> 00:36:45,190
<font color="#CCCCCC">think Empire even</font><font color="#E5E5E5"> supports this but if</font>

828
00:36:43,600 --> 00:36:47,049
you<font color="#E5E5E5"> ever done this via</font><font color="#CCCCCC"> Metasploit you'll</font>

829
00:36:45,190 --> 00:36:48,670
know that it's sort of a pain to<font color="#E5E5E5"> set up</font>

830
00:36:47,050 --> 00:36:57,010
so this<font color="#E5E5E5"> is just</font><font color="#CCCCCC"> a really</font><font color="#E5E5E5"> quick and</font><font color="#CCCCCC"> easy</font>

831
00:36:48,670 --> 00:36:59,050
<font color="#E5E5E5">way</font><font color="#CCCCCC"> to do</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> so I said before it's the</font>

832
00:36:57,010 --> 00:37:02,440
<font color="#CCCCCC">protocols</font><font color="#E5E5E5"> it supports is are now modular</font>

833
00:36:59,050 --> 00:37:06,040
so we're doing<font color="#E5E5E5"> stuff via</font><font color="#CCCCCC"> MS sequel we're</font>

834
00:37:02,440 --> 00:37:09,220
doing stuff via<font color="#E5E5E5"> SMB but it also supports</font>

835
00:37:06,040 --> 00:37:12,430
SSH so if you know I have to give<font color="#CCCCCC"> Lena</font>

836
00:37:09,220 --> 00:37:15,430
some love so I<font color="#CCCCCC"> added ssh</font><font color="#E5E5E5"> support into</font>

837
00:37:12,430 --> 00:37:19,359
this as<font color="#E5E5E5"> well</font><font color="#CCCCCC"> so again</font><font color="#E5E5E5"> if you give it</font>

838
00:37:15,430 --> 00:37:21,609
like a<font color="#CCCCCC"> side arrange or just a IP address</font>

839
00:37:19,360 --> 00:37:28,090
range<font color="#E5E5E5"> it'll go</font><font color="#CCCCCC"> out and try to discover</font>

840
00:37:21,610 --> 00:37:30,300
all SSH servers pretty sure<font color="#CCCCCC"> about that</font>

841
00:37:28,090 --> 00:37:30,300
<font color="#E5E5E5">yeah</font>

842
00:37:37,550 --> 00:37:40,540
<font color="#CCCCCC">right</font>

843
00:37:46,690 --> 00:37:49,690
wholesomeness

844
00:37:50,590 --> 00:37:53,580
if not we<font color="#E5E5E5"> can</font>

845
00:37:53,809 --> 00:37:57,849
move to something<font color="#E5E5E5"> else</font><font color="#CCCCCC"> here but</font>

846
00:38:05,290 --> 00:38:10,830
<font color="#E5E5E5">quickly well I think we have our first</font>

847
00:38:08,050 --> 00:38:10,830
<font color="#CCCCCC">demo</font><font color="#E5E5E5"> fail here</font>

848
00:38:17,839 --> 00:38:23,180
all right well first<font color="#E5E5E5"> demo</font><font color="#CCCCCC"> fail</font><font color="#E5E5E5"> well</font>

849
00:38:20,239 --> 00:38:24,920
<font color="#CCCCCC">hopefully it works but what you</font><font color="#E5E5E5"> should</font>

850
00:38:23,180 --> 00:38:27,019
<font color="#E5E5E5">have seen is</font><font color="#CCCCCC"> that you know it</font>

851
00:38:24,920 --> 00:38:28,400
authenticates to the<font color="#CCCCCC"> ssh server you give</font>

852
00:38:27,019 --> 00:38:29,839
it the<font color="#CCCCCC"> same credentials that</font>

853
00:38:28,400 --> 00:38:35,839
authenticating<font color="#E5E5E5"> it has execute commands</font>

854
00:38:29,839 --> 00:38:37,219
through<font color="#E5E5E5"> ssh as well and finally just for</font>

855
00:38:35,839 --> 00:38:40,339
<font color="#E5E5E5">interest of time I'm gonna show off the</font>

856
00:38:37,219 --> 00:38:41,869
<font color="#E5E5E5">winner I'm protocol again this is like</font>

857
00:38:40,339 --> 00:38:43,969
this<font color="#E5E5E5"> is</font><font color="#CCCCCC"> just a</font><font color="#E5E5E5"> subset of all the things</font>

858
00:38:41,869 --> 00:38:45,170
that<font color="#E5E5E5"> it supports you can do one see if</font>

859
00:38:43,969 --> 00:38:47,089
you do install this tool<font color="#CCCCCC"> you</font><font color="#E5E5E5"> can just</font>

860
00:38:45,170 --> 00:38:48,140
look at<font color="#E5E5E5"> the help information just all</font>

861
00:38:47,089 --> 00:38:49,819
the flags<font color="#E5E5E5"> that</font><font color="#CCCCCC"> it supports and you'll</font>

862
00:38:48,140 --> 00:38:52,308
see it that does a<font color="#E5E5E5"> whole bunch</font><font color="#CCCCCC"> of stuff</font>

863
00:38:49,819 --> 00:38:54,079
like<font color="#E5E5E5"> dumbing the NTDs</font><font color="#CCCCCC"> a bit from domain</font>

864
00:38:52,309 --> 00:38:57,979
controllers and all that<font color="#E5E5E5"> information</font>

865
00:38:54,079 --> 00:39:01,209
<font color="#CCCCCC">gets stored</font><font color="#E5E5E5"> in a database as well I'm</font>

866
00:38:57,979 --> 00:39:01,209
just<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to use one RM here</font>

867
00:39:07,850 --> 00:39:11,330
<font color="#CCCCCC">No there</font><font color="#E5E5E5"> you go perfect so you can see</font>

868
00:39:10,040 --> 00:39:14,900
that you<font color="#E5E5E5"> to do</font><font color="#CCCCCC"> mine controllers</font><font color="#E5E5E5"> that I</font>

869
00:39:11,330 --> 00:39:16,730
have have a WS man<font color="#CCCCCC"> and</font><font color="#E5E5E5"> points up so we</font>

870
00:39:14,900 --> 00:39:19,040
can theoretically just authenticate to

871
00:39:16,730 --> 00:39:28,370
<font color="#E5E5E5">those</font><font color="#CCCCCC"> via</font><font color="#E5E5E5"> credentials and execute</font>

872
00:39:19,040 --> 00:39:31,370
through those as well I'm just<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to</font>

873
00:39:28,370 --> 00:39:34,029
give it<font color="#CCCCCC"> the</font><font color="#E5E5E5"> range here so</font><font color="#CCCCCC"> that takes</font><font color="#E5E5E5"> a</font>

874
00:39:31,370 --> 00:39:34,029
<font color="#E5E5E5">little bit less time</font>

875
00:39:45,390 --> 00:39:49,950
perfect so we authenticate to<font color="#E5E5E5"> that and</font>

876
00:39:48,180 --> 00:39:53,839
now we can<font color="#E5E5E5"> just execute commands through</font>

877
00:39:49,950 --> 00:39:53,839
win<font color="#CCCCCC"> RM which is great</font>

878
00:40:00,440 --> 00:40:03,950
perfect<font color="#E5E5E5"> and</font><font color="#CCCCCC"> see the execute adjust to</font>

879
00:40:02,660 --> 00:40:06,190
Who am I command through that as<font color="#E5E5E5"> well</font>

880
00:40:03,950 --> 00:40:10,910
and really<font color="#CCCCCC"> quickly just because</font><font color="#E5E5E5"> it's</font>

881
00:40:06,190 --> 00:40:12,500
visually pretty impressive<font color="#CCCCCC"> say we wanted</font>

882
00:40:10,910 --> 00:40:13,910
<font color="#E5E5E5">to dump the NTDs update from the domain</font>

883
00:40:12,500 --> 00:40:15,650
controller<font color="#E5E5E5"> so the what this work you're</font>

884
00:40:13,910 --> 00:40:17,990
<font color="#E5E5E5">I'm about to show you it does things</font>

885
00:40:15,650 --> 00:40:19,700
<font color="#CCCCCC">through the DC sync approach so it's</font>

886
00:40:17,990 --> 00:40:22,640
using<font color="#E5E5E5"> domain replication and just</font>

887
00:40:19,700 --> 00:40:23,689
<font color="#E5E5E5">streaming down that NTDs file through</font>

888
00:40:22,640 --> 00:40:26,779
<font color="#E5E5E5">the network and it's not really</font>

889
00:40:23,690 --> 00:40:34,940
executing<font color="#E5E5E5"> anything on the binaries or</font>

890
00:40:26,780 --> 00:40:39,170
anything on<font color="#E5E5E5"> the remote host and</font><font color="#CCCCCC"> tds</font><font color="#E5E5E5"> not</font>

891
00:40:34,940 --> 00:40:44,510
helps<font color="#CCCCCC"> absolute</font><font color="#E5E5E5"> I specify the</font><font color="#CCCCCC"> right</font>

892
00:40:39,170 --> 00:40:46,370
<font color="#E5E5E5">protocol here it's authenticates</font><font color="#CCCCCC"> the</font>

893
00:40:44,510 --> 00:40:49,400
domain controller<font color="#E5E5E5"> and you see it pull</font>

894
00:40:46,370 --> 00:40:51,440
<font color="#E5E5E5">down</font><font color="#CCCCCC"> all of those hashes from</font><font color="#E5E5E5"> that NTDs</font>

895
00:40:49,400 --> 00:40:52,790
static file<font color="#E5E5E5"> and you can</font><font color="#CCCCCC"> notice how fast</font>

896
00:40:51,440 --> 00:40:54,500
<font color="#E5E5E5">it is this because it's using the DC</font>

897
00:40:52,790 --> 00:40:56,150
sync approach rather than<font color="#E5E5E5"> like volume</font>

898
00:40:54,500 --> 00:40:58,010
Shadow Copy or anything<font color="#E5E5E5"> else</font><font color="#CCCCCC"> and again</font>

899
00:40:56,150 --> 00:41:00,980
like all<font color="#E5E5E5"> this information gets stored in</font>

900
00:40:58,010 --> 00:41:02,510
<font color="#CCCCCC">the database</font><font color="#E5E5E5"> so it really like also</font>

901
00:41:00,980 --> 00:41:04,550
limits the<font color="#E5E5E5"> amount of traffic that you</font>

902
00:41:02,510 --> 00:41:06,350
<font color="#CCCCCC">actually send</font><font color="#E5E5E5"> out on</font><font color="#CCCCCC"> a network</font><font color="#E5E5E5"> so you</font>

903
00:41:04,550 --> 00:41:07,940
<font color="#E5E5E5">don't have to keep executing the same</font>

904
00:41:06,350 --> 00:41:09,830
commands over and over again and keep

905
00:41:07,940 --> 00:41:11,840
generating just tons and<font color="#CCCCCC"> tons of traffic</font>

906
00:41:09,830 --> 00:41:15,710
<font color="#E5E5E5">so it</font><font color="#CCCCCC"> also it really helps with</font><font color="#E5E5E5"> that as</font>

907
00:41:11,840 --> 00:41:17,720
<font color="#CCCCCC">well so I just</font><font color="#E5E5E5"> dig</font><font color="#CCCCCC"> creds here now</font><font color="#E5E5E5"> all</font>

908
00:41:15,710 --> 00:41:24,860
those<font color="#E5E5E5"> hashes are stored here as you can</font>

909
00:41:17,720 --> 00:41:26,950
<font color="#CCCCCC">see</font><font color="#E5E5E5"> okay so you sort of get an</font><font color="#CCCCCC"> hopefully</font>

910
00:41:24,860 --> 00:41:29,950
<font color="#E5E5E5">that sort of give you an idea of the</font>

911
00:41:26,950 --> 00:41:29,950
tool

912
00:41:32,170 --> 00:41:42,850
let's go back<font color="#E5E5E5"> to this am i doing on</font><font color="#CCCCCC"> the</font>

913
00:41:39,170 --> 00:41:42,850
<font color="#E5E5E5">time here all right a little bit left</font><font color="#CCCCCC"> so</font>

914
00:41:43,120 --> 00:41:47,740
<font color="#CCCCCC">we had some demo fails</font><font color="#E5E5E5"> but hopefully</font>

915
00:41:46,160 --> 00:41:51,770
that gives you<font color="#E5E5E5"> an idea of the tool</font>

916
00:41:47,740 --> 00:41:55,520
<font color="#CCCCCC">future</font><font color="#E5E5E5"> things that</font><font color="#CCCCCC"> I would like to add</font>

917
00:41:51,770 --> 00:41:56,840
WSH<font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> in terms of</font><font color="#E5E5E5"> execution</font>

918
00:41:55,520 --> 00:41:59,060
like just executing stuff through

919
00:41:56,840 --> 00:42:02,090
PowerShell is sort of<font color="#E5E5E5"> dying if you're</font>

920
00:41:59,060 --> 00:42:04,400
familiar with all the<font color="#E5E5E5"> recent Microsoft</font>

921
00:42:02,090 --> 00:42:05,990
updates<font color="#E5E5E5"> that they put</font><font color="#CCCCCC"> out into</font>

922
00:42:04,400 --> 00:42:08,570
<font color="#CCCCCC">PowerShell PowerShell is probably the</font>

923
00:42:05,990 --> 00:42:11,390
<font color="#E5E5E5">most secure scripting language now in</font>

924
00:42:08,570 --> 00:42:13,550
<font color="#E5E5E5">existence so between PowerShell logging</font>

925
00:42:11,390 --> 00:42:15,410
and everything else<font color="#CCCCCC"> it is definitely</font>

926
00:42:13,550 --> 00:42:16,700
<font color="#E5E5E5">cutting down the</font><font color="#CCCCCC"> amount of stuff that we</font>

927
00:42:15,410 --> 00:42:18,440
<font color="#E5E5E5">can do through that so we're definitely</font>

928
00:42:16,700 --> 00:42:19,279
<font color="#E5E5E5">gonna be I'm gonna</font><font color="#CCCCCC"> definitely taking a</font>

929
00:42:18,440 --> 00:42:21,020
look at the windows script host

930
00:42:19,280 --> 00:42:22,520
<font color="#CCCCCC">environment so this</font><font color="#E5E5E5"> is some of</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> stuff</font>

931
00:42:21,020 --> 00:42:24,590
<font color="#CCCCCC">that's up he's been doing enigma</font><font color="#E5E5E5"> has</font>

932
00:42:22,520 --> 00:42:27,080
been doing<font color="#CCCCCC"> just executing stuff through</font>

933
00:42:24,590 --> 00:42:30,470
all<font color="#CCCCCC"> different types of either</font><font color="#E5E5E5"> SCT files</font>

934
00:42:27,080 --> 00:42:32,210
or<font color="#CCCCCC"> j/s scripts or VB scripts there's</font>

935
00:42:30,470 --> 00:42:34,250
also some<font color="#E5E5E5"> other frameworks that are out</font>

936
00:42:32,210 --> 00:42:36,200
there<font color="#CCCCCC"> already like</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> Kodiak project if</font>

937
00:42:34,250 --> 00:42:38,240
you've heard<font color="#E5E5E5"> of</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> it sort</font><font color="#CCCCCC"> of tries to</font>

938
00:42:36,200 --> 00:42:39,589
<font color="#E5E5E5">emulate what</font><font color="#CCCCCC"> Empire does only</font><font color="#E5E5E5"> in like</font>

939
00:42:38,240 --> 00:42:41,720
the windows script host<font color="#CCCCCC"> environment</font>

940
00:42:39,590 --> 00:42:42,830
there's also great<font color="#CCCCCC"> SCT which is another</font>

941
00:42:41,720 --> 00:42:44,959
project and<font color="#E5E5E5"> I'm hoping to</font><font color="#CCCCCC"> add</font>

942
00:42:42,830 --> 00:42:46,520
integration with those frameworks<font color="#E5E5E5"> as</font>

943
00:42:44,960 --> 00:42:48,230
well so like<font color="#E5E5E5"> we can dynamically generate</font>

944
00:42:46,520 --> 00:42:50,780
pails which is which<font color="#E5E5E5"> would be pretty</font>

945
00:42:48,230 --> 00:42:52,160
cool<font color="#E5E5E5"> whitelisting bypasses this is</font>

946
00:42:50,780 --> 00:42:53,570
something<font color="#E5E5E5"> I want to look into as well as</font>

947
00:42:52,160 --> 00:42:56,089
more and more<font color="#CCCCCC"> devices have like</font><font color="#E5E5E5"> app</font>

948
00:42:53,570 --> 00:42:57,170
Locker and device guard enabled we want

949
00:42:56,090 --> 00:42:58,880
to try to integrate<font color="#E5E5E5"> some</font><font color="#CCCCCC"> of the work</font>

950
00:42:57,170 --> 00:43:00,530
that's<font color="#E5E5E5"> been discovered</font><font color="#CCCCCC"> recently</font><font color="#E5E5E5"> into</font>

951
00:42:58,880 --> 00:43:02,390
this<font color="#E5E5E5"> framework so that we can take</font>

952
00:43:00,530 --> 00:43:03,410
advantage<font color="#CCCCCC"> of</font><font color="#E5E5E5"> those module</font><font color="#CCCCCC"> training this</font>

953
00:43:02,390 --> 00:43:04,520
<font color="#E5E5E5">is something that I</font><font color="#CCCCCC"> initially</font>

954
00:43:03,410 --> 00:43:06,379
implemented<font color="#E5E5E5"> and it didn't really work</font>

955
00:43:04,520 --> 00:43:08,450
<font color="#E5E5E5">out that well</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> because it just kept</font>

956
00:43:06,380 --> 00:43:09,590
they just it was just<font color="#CCCCCC"> a</font><font color="#E5E5E5"> nightmare to</font>

957
00:43:08,450 --> 00:43:12,620
implement so<font color="#E5E5E5"> I have to figure</font><font color="#CCCCCC"> out a way</font>

958
00:43:09,590 --> 00:43:15,080
<font color="#CCCCCC">to make this</font><font color="#E5E5E5"> work in and I guess in a</font>

959
00:43:12,620 --> 00:43:16,700
more<font color="#CCCCCC"> elegant way but this</font><font color="#E5E5E5"> is really the</font>

960
00:43:15,080 --> 00:43:18,290
<font color="#CCCCCC">future</font><font color="#E5E5E5"> of the framework so what I really</font>

961
00:43:16,700 --> 00:43:20,029
wanted to<font color="#E5E5E5"> have this</font><font color="#CCCCCC"> do is be able to</font>

962
00:43:18,290 --> 00:43:22,640
<font color="#E5E5E5">chain modules together so that you can</font>

963
00:43:20,030 --> 00:43:25,630
use like<font color="#E5E5E5"> different application bypasses</font>

964
00:43:22,640 --> 00:43:28,879
or windows script host

965
00:43:25,630 --> 00:43:30,020
<font color="#CCCCCC">to execute these payloads so for example</font>

966
00:43:28,880 --> 00:43:32,720
if we wanted to<font color="#E5E5E5"> use like a comm</font>

967
00:43:30,020 --> 00:43:36,190
scriptlet to execute me me cats<font color="#E5E5E5"> we can</font>

968
00:43:32,720 --> 00:43:38,720
do<font color="#E5E5E5"> that like we can just do a comm</font><font color="#CCCCCC"> exec</font>

969
00:43:36,190 --> 00:43:40,160
<font color="#E5E5E5">arrow like me me cats or</font><font color="#CCCCCC"> something like</font>

970
00:43:38,720 --> 00:43:42,200
using a domain-specific language and we

971
00:43:40,160 --> 00:43:44,210
<font color="#CCCCCC">can use those models to</font><font color="#E5E5E5"> chain stuff</font>

972
00:43:42,200 --> 00:43:46,118
together<font color="#CCCCCC"> so</font><font color="#E5E5E5"> that's where I think this is</font>

973
00:43:44,210 --> 00:43:47,619
<font color="#E5E5E5">going to really shine and hopefully a</font>

974
00:43:46,119 --> 00:43:51,039
<font color="#CCCCCC">a way</font><font color="#E5E5E5"> to actually implement that</font><font color="#CCCCCC"> in a</font>

975
00:43:47,619 --> 00:43:53,980
<font color="#CCCCCC">near-future how do I stop this this is</font>

976
00:43:51,039 --> 00:43:55,720
something<font color="#CCCCCC"> that I get a lot</font><font color="#E5E5E5"> as</font><font color="#CCCCCC"> well well</font>

977
00:43:53,980 --> 00:43:57,400
start with<font color="#E5E5E5"> the basics I'd say like</font>

978
00:43:55,720 --> 00:43:59,169
having an account<font color="#CCCCCC"> like a</font><font color="#E5E5E5"> policy helps</font>

979
00:43:57,400 --> 00:44:00,369
that really does<font color="#CCCCCC"> I can't believe I'm</font>

980
00:43:59,170 --> 00:44:03,279
right I'm<font color="#E5E5E5"> still recommending</font><font color="#CCCCCC"> this in</font>

981
00:44:00,369 --> 00:44:04,990
2017 but<font color="#E5E5E5"> I've seen networks that do not</font>

982
00:44:03,279 --> 00:44:08,740
have an account lockout policy so start

983
00:44:04,990 --> 00:44:12,368
<font color="#E5E5E5">with that</font><font color="#CCCCCC"> vlogging</font><font color="#E5E5E5"> that helps as well</font>

984
00:44:08,740 --> 00:44:14,799
segmentation<font color="#E5E5E5"> helps as well</font><font color="#CCCCCC"> lapse</font><font color="#E5E5E5"> for the</font>

985
00:44:12,369 --> 00:44:16,539
love of<font color="#E5E5E5"> God just your local</font>

986
00:44:14,799 --> 00:44:18,400
administrator passwords don't<font color="#E5E5E5"> have them</font>

987
00:44:16,539 --> 00:44:18,789
the same on every<font color="#CCCCCC"> endpoint please change</font>

988
00:44:18,400 --> 00:44:20,410
them

989
00:44:18,789 --> 00:44:21,849
Microsoft lapse is probably the best

990
00:44:20,410 --> 00:44:23,348
solution<font color="#E5E5E5"> to do that</font><font color="#CCCCCC"> it's a</font><font color="#E5E5E5"> third-party</font>

991
00:44:21,849 --> 00:44:25,269
<font color="#E5E5E5">tool from Microsoft but it's</font><font color="#CCCCCC"> completely</font>

992
00:44:23,349 --> 00:44:26,440
free<font color="#E5E5E5"> that's and it's fairly easy to</font>

993
00:44:25,269 --> 00:44:28,979
implement<font color="#E5E5E5"> just make sure you configure</font>

994
00:44:26,440 --> 00:44:31,390
<font color="#CCCCCC">it correctly this is also a really cool</font>

995
00:44:28,980 --> 00:44:34,930
<font color="#E5E5E5">article that my</font><font color="#CCCCCC"> coworker wrote and I</font>

996
00:44:31,390 --> 00:44:36,819
think he's here somewhere<font color="#CCCCCC"> but in</font><font color="#E5E5E5"> also he</font>

997
00:44:34,930 --> 00:44:38,980
basically found a just implemented a way

998
00:44:36,819 --> 00:44:40,920
of detecting see me<font color="#E5E5E5"> using row system on</font>

999
00:44:38,980 --> 00:44:43,420
and<font color="#CCCCCC"> Pausch a</font><font color="#E5E5E5"> log so that's</font><font color="#CCCCCC"> a really a</font>

1000
00:44:40,920 --> 00:44:47,220
<font color="#E5E5E5">really effective way</font><font color="#CCCCCC"> of</font><font color="#E5E5E5"> detecting it</font>

1001
00:44:43,420 --> 00:44:47,220
using<font color="#CCCCCC"> open source tools</font><font color="#E5E5E5"> which is great</font>

1002
00:44:49,289 --> 00:44:56,220
so questions insults yes

1003
00:45:04,490 --> 00:45:10,770
yes<font color="#E5E5E5"> usually yeah I would say yeah I'm</font>

1004
00:45:07,860 --> 00:45:12,060
not<font color="#E5E5E5"> I think I've did that once and I'm</font>

1005
00:45:10,770 --> 00:45:13,850
not<font color="#CCCCCC"> sure if there was a</font><font color="#E5E5E5"> proxy in place</font>

1006
00:45:12,060 --> 00:45:16,170
but I'm pretty<font color="#E5E5E5"> sure it would play well</font>

1007
00:45:13,850 --> 00:45:17,910
mostly because it does have<font color="#E5E5E5"> like some of</font>

1008
00:45:16,170 --> 00:45:21,270
the<font color="#E5E5E5"> most of the payloads when it comes</font>

1009
00:45:17,910 --> 00:45:23,460
to<font color="#CCCCCC"> shells</font><font color="#E5E5E5"> have like proxy they use some</font>

1010
00:45:21,270 --> 00:45:25,710
windows<font color="#E5E5E5"> API to detect that there's a</font>

1011
00:45:23,460 --> 00:45:32,760
proxy configured on the host<font color="#E5E5E5"> and it'll</font>

1012
00:45:25,710 --> 00:45:35,160
just tunnel through that just<font color="#E5E5E5"> equal</font>

1013
00:45:32,760 --> 00:45:39,560
light so it's<font color="#E5E5E5"> just a file on disk that</font>

1014
00:45:35,160 --> 00:45:39,560
just gets populated<font color="#E5E5E5"> it's pretty easy</font>

1015
00:45:47,080 --> 00:45:52,900
by<font color="#E5E5E5"> default I</font><font color="#CCCCCC"> think it yeah</font><font color="#E5E5E5"> I by default</font>

1016
00:45:50,680 --> 00:45:55,000
it outputs in the<font color="#E5E5E5"> format that hash cat</font>

1017
00:45:52,900 --> 00:45:56,010
does support so in theory you could just

1018
00:45:55,000 --> 00:45:58,720
copy<font color="#E5E5E5"> and paste it</font>

1019
00:45:56,010 --> 00:45:59,860
yeah I'm<font color="#E5E5E5"> pretty certain it</font><font color="#CCCCCC"> the hash cat</font>

1020
00:45:58,720 --> 00:46:04,089
does<font color="#E5E5E5"> support the format that it</font><font color="#CCCCCC"> outputs</font>

1021
00:45:59,860 --> 00:46:17,460
in yeah<font color="#E5E5E5"> pretty sure I'm</font><font color="#CCCCCC"> pretty sure</font><font color="#E5E5E5"> yeah</font>

1022
00:46:04,090 --> 00:46:19,210
it supports it anything<font color="#E5E5E5"> else no but</font>

1023
00:46:17,460 --> 00:46:20,950
that's<font color="#CCCCCC"> different that's definitely</font>

1024
00:46:19,210 --> 00:46:22,810
something that<font color="#E5E5E5"> we could implement it's</font>

1025
00:46:20,950 --> 00:46:24,609
usually<font color="#E5E5E5"> it's meant to be stored in like</font>

1026
00:46:22,810 --> 00:46:27,730
on your<font color="#E5E5E5"> pen testing box so unless</font>

1027
00:46:24,610 --> 00:46:29,260
someone pops your pen testing box but

1028
00:46:27,730 --> 00:46:30,850
yeah that's<font color="#E5E5E5"> a good thing that that's</font>

1029
00:46:29,260 --> 00:46:38,530
<font color="#E5E5E5">actually a good feature</font><font color="#CCCCCC"> I should look</font>

1030
00:46:30,850 --> 00:46:40,779
<font color="#E5E5E5">into</font><font color="#CCCCCC"> that perfect</font><font color="#E5E5E5"> so this is</font><font color="#CCCCCC"> it's he</font>

1031
00:46:38,530 --> 00:46:43,180
<font color="#CCCCCC">means fully open source</font><font color="#E5E5E5"> it's hosted here</font>

1032
00:46:40,780 --> 00:46:44,590
<font color="#E5E5E5">again this is like it just</font><font color="#CCCCCC"> may be like a</font>

1033
00:46:43,180 --> 00:46:47,080
quarter<font color="#CCCCCC"> of the functionality that</font>

1034
00:46:44,590 --> 00:46:48,430
supports<font color="#E5E5E5"> I'm at this</font><font color="#CCCCCC"> guy could sit here</font>

1035
00:46:47,080 --> 00:46:50,170
<font color="#E5E5E5">and talk</font><font color="#CCCCCC"> about all day like all those</font>

1036
00:46:48,430 --> 00:46:52,450
<font color="#E5E5E5">things</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> it supports really encourage</font>

1037
00:46:50,170 --> 00:46:53,980
you if<font color="#E5E5E5"> you are</font><font color="#CCCCCC"> interested to download</font>

1038
00:46:52,450 --> 00:46:56,140
see me and take a look<font color="#E5E5E5"> all the options</font>

1039
00:46:53,980 --> 00:46:58,240
<font color="#E5E5E5">for yourself</font><font color="#CCCCCC"> it supports everything</font><font color="#E5E5E5"> from</font>

1040
00:46:56,140 --> 00:47:00,640
situational awareness to just executing

1041
00:46:58,240 --> 00:47:01,930
commands through different ways<font color="#E5E5E5"> it</font>

1042
00:47:00,640 --> 00:47:03,490
<font color="#E5E5E5">really does have a lot</font><font color="#CCCCCC"> of features</font><font color="#E5E5E5"> at</font>

1043
00:47:01,930 --> 00:47:04,629
this point so if<font color="#E5E5E5"> you're definitely</font>

1044
00:47:03,490 --> 00:47:07,359
interested you<font color="#E5E5E5"> can definitely take a</font>

1045
00:47:04,630 --> 00:47:08,740
look<font color="#E5E5E5"> at that</font><font color="#CCCCCC"> one</font><font color="#E5E5E5"> final note these are</font>

1046
00:47:07,360 --> 00:47:10,450
the<font color="#E5E5E5"> people that are really driving this</font>

1047
00:47:08,740 --> 00:47:11,979
industry like<font color="#E5E5E5"> I wouldn't be able to do</font>

1048
00:47:10,450 --> 00:47:14,439
any<font color="#E5E5E5"> of this if it wasn't work for them</font>

1049
00:47:11,980 --> 00:47:16,540
hey<font color="#CCCCCC"> I'm Musolino</font><font color="#E5E5E5"> jus soli</font><font color="#CCCCCC"> know in</font>

1050
00:47:14,440 --> 00:47:19,060
particular he's he's a developer<font color="#CCCCCC"> of in</font>

1051
00:47:16,540 --> 00:47:22,000
packet and I have to tell you<font color="#E5E5E5"> like</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> I</font>

1052
00:47:19,060 --> 00:47:24,610
have<font color="#E5E5E5"> no clue how he does it but</font><font color="#CCCCCC"> he just</font>

1053
00:47:22,000 --> 00:47:27,160
basically wrote an entire SMB stack in

1054
00:47:24,610 --> 00:47:28,990
Python<font color="#E5E5E5"> just amazes me to know one</font>

1055
00:47:27,160 --> 00:47:32,830
gentle wiki<font color="#CCCCCC"> subti pyrotech all these</font>

1056
00:47:28,990 --> 00:47:34,270
people<font color="#E5E5E5"> if you are into if you're into in</font>

1057
00:47:32,830 --> 00:47:35,799
<font color="#E5E5E5">any</font><font color="#CCCCCC"> way in Active Directory I recommend</font>

1058
00:47:34,270 --> 00:47:37,960
you follow<font color="#E5E5E5"> these</font><font color="#CCCCCC"> people and stalk them</font>

1059
00:47:35,800 --> 00:47:41,820
and on every<font color="#E5E5E5"> social media platform in</font>

1060
00:47:37,960 --> 00:47:41,820
existence<font color="#E5E5E5"> and</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> think that's it</font>

1061
00:47:42,099 --> 00:47:44,160
you

1062
00:47:53,210 --> 00:47:55,270
you

