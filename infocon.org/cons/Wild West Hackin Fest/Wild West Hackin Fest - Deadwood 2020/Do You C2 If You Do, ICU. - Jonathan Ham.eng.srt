1
00:00:00,400 --> 00:00:07,970
hi everyone I'm Jonathan this is just a

2
00:00:05,480 --> 00:00:11,420
test screen to make sure that we can do

3
00:00:07,970 --> 00:00:17,080
tests if this were a real emergency then

4
00:00:11,420 --> 00:00:22,220
you would need a wambulance or yeah well

5
00:00:17,080 --> 00:00:24,019
this this is a thing so up until a year

6
00:00:22,220 --> 00:00:27,250
ago I've been an independent consultant

7
00:00:24,019 --> 00:00:31,009
for almost my entire career and

8
00:00:27,250 --> 00:00:33,860
rendition recruited me and managed to

9
00:00:31,009 --> 00:00:37,910
get me to join and early on in the

10
00:00:33,860 --> 00:00:41,600
conversation with our CEO Brandon

11
00:00:37,910 --> 00:00:44,620
acrylic was texting on the slack and

12
00:00:41,600 --> 00:00:47,510
there was something about an ambulance

13
00:00:44,620 --> 00:00:50,660
and I was like what we have an ambulance

14
00:00:47,510 --> 00:00:53,150
and he's like what security company

15
00:00:50,660 --> 00:00:54,290
doesn't have an ambulance so apparently

16
00:00:53,150 --> 00:00:56,830
we have an ambulance

17
00:00:54,290 --> 00:01:01,100
that actually exists in Augusta Georgia

18
00:00:56,830 --> 00:01:04,220
but it not available for coated 19 and I

19
00:01:01,100 --> 00:01:09,040
almost cut this entire slide because in

20
00:01:04,220 --> 00:01:12,620
heels too soon but hey here we are

21
00:01:09,040 --> 00:01:18,230
that's that's not available so let's get

22
00:01:12,620 --> 00:01:20,870
on to the top and and Jason wanted to

23
00:01:18,230 --> 00:01:25,790
know how did this even happen and so I'm

24
00:01:20,870 --> 00:01:29,030
happy to tell you so that's the talk for

25
00:01:25,790 --> 00:01:35,690
this year but here's the prologue so it

26
00:01:29,030 --> 00:01:38,570
was it was years ago when my very nope

27
00:01:35,690 --> 00:01:41,210
oops not my very best friend in the

28
00:01:38,570 --> 00:01:45,050
world my best man at my wedding but my

29
00:01:41,210 --> 00:01:48,080
very best friend would be my wife so my

30
00:01:45,050 --> 00:01:50,690
next very best friend in the world said

31
00:01:48,080 --> 00:01:52,490
hey we're having a conference it's

32
00:01:50,690 --> 00:01:56,780
official we're going to do this and I

33
00:01:52,490 --> 00:02:00,408
said yay John man how can I help and he

34
00:01:56,780 --> 00:02:02,600
said you're a speaker and that wasn't

35
00:02:00,409 --> 00:02:07,240
what I expected because the whole thing

36
00:02:02,600 --> 00:02:10,910
is explicitly a stunt hacking on and I

37
00:02:07,240 --> 00:02:13,210
can I can hack boxes it's cool but I

38
00:02:10,910 --> 00:02:17,560
don't do stun hacking that's not

39
00:02:13,210 --> 00:02:21,910
I thing I'm kind of purple more blue

40
00:02:17,560 --> 00:02:26,230
than red and then I watched the speaker

41
00:02:21,910 --> 00:02:28,750
list grow laterally to the point where I

42
00:02:26,230 --> 00:02:30,910
was like oh my god these people these

43
00:02:28,750 --> 00:02:35,080
people I can't stand next to them at a

44
00:02:30,910 --> 00:02:38,730
conference out of our in holy smokes

45
00:02:35,080 --> 00:02:41,920
what to do and that's it

46
00:02:38,730 --> 00:02:44,679
panic I panicked I panicked

47
00:02:41,920 --> 00:02:47,470
and John's low dude I need an abstract

48
00:02:44,680 --> 00:02:51,640
and a title from you and I'm like well

49
00:02:47,470 --> 00:02:55,440
here's one title I have no idea what

50
00:02:51,640 --> 00:02:59,410
relic did just there or alternately a

51
00:02:55,440 --> 00:03:03,010
network forensic be invited to hacker

52
00:02:59,410 --> 00:03:05,859
conference for comic relief and strand

53
00:03:03,010 --> 00:03:08,709
thought either was a fun title but

54
00:03:05,860 --> 00:03:10,990
either way and then finally in the first

55
00:03:08,710 --> 00:03:13,900
year I was like oh it's fine because

56
00:03:10,990 --> 00:03:16,600
there's two tracks and the time my time

57
00:03:13,900 --> 00:03:18,820
slot is the same as Egypt's time slot so

58
00:03:16,600 --> 00:03:21,010
everyone was you so much Egypt and no

59
00:03:18,820 --> 00:03:21,790
one will come to my talk and I'm fine

60
00:03:21,010 --> 00:03:27,750
either way

61
00:03:21,790 --> 00:03:27,750
and it'll be fine but people show

62
00:03:28,080 --> 00:03:35,580
I don't like to do a lot of Who am I

63
00:03:32,760 --> 00:03:38,609
look if you wonder who I am just you can

64
00:03:35,580 --> 00:03:41,130
just google me it's fine the quick the

65
00:03:38,610 --> 00:03:44,520
the quickest way I figured is just to

66
00:03:41,130 --> 00:03:48,000
say Who am I so in the ICU domain I'm J

67
00:03:44,520 --> 00:03:50,910
Hamm in the rendition domain I'm the

68
00:03:48,000 --> 00:03:53,070
threat hunting ops lead in the SANS

69
00:03:50,910 --> 00:03:55,740
Institute domain our principle is

70
00:03:53,070 --> 00:03:57,840
Drucker in the author domain I'm part of

71
00:03:55,740 --> 00:04:02,040
the network forensics group little hook

72
00:03:57,840 --> 00:04:04,590
and if I say Who am I slash prove you

73
00:04:02,040 --> 00:04:07,970
can see I've taken some liberties with

74
00:04:04,590 --> 00:04:10,260
the prims the sed bug privilege

75
00:04:07,970 --> 00:04:14,900
understanding what relic did just there

76
00:04:10,260 --> 00:04:17,279
when he rift lit on some crazy

77
00:04:14,900 --> 00:04:20,370
obfuscated PowerShell nope didn't

78
00:04:17,279 --> 00:04:25,669
understand that at all um stun hacking

79
00:04:20,370 --> 00:04:30,060
not me rocket surgery impossible feats

80
00:04:25,670 --> 00:04:34,050
not me but I can see packets and I can

81
00:04:30,060 --> 00:04:37,410
see bad guys and I can do some blue

82
00:04:34,050 --> 00:04:39,800
team's stuff so there's that this is

83
00:04:37,410 --> 00:04:46,169
this gets into the the history of it I'm

84
00:04:39,800 --> 00:04:48,840
blue sorry red team conference I'm blue

85
00:04:46,169 --> 00:04:51,210
I don't start hatch but maybe I can

86
00:04:48,840 --> 00:04:54,010
stuff hot anyone want to watch that

87
00:04:51,210 --> 00:04:59,830
I hope someone wants to watch that

88
00:04:54,010 --> 00:05:04,030
so version 1 this is the SE v3 so season

89
00:04:59,830 --> 00:05:06,010
1 version that our episode 1 when I

90
00:05:04,030 --> 00:05:08,260
finally decided that I had to give a

91
00:05:06,010 --> 00:05:10,750
talk at what last because I couldn't

92
00:05:08,260 --> 00:05:15,190
tell John no I mean when he says you

93
00:05:10,750 --> 00:05:17,890
have to be a speaker it's like look if

94
00:05:15,190 --> 00:05:21,400
he told me to go to South Dakota and

95
00:05:17,890 --> 00:05:23,710
wash his car I wanna know why but I'd

96
00:05:21,400 --> 00:05:26,830
still have to go because you know

97
00:05:23,710 --> 00:05:29,200
besties and all that so so I finally

98
00:05:26,830 --> 00:05:32,320
told him here's what I want I want your

99
00:05:29,200 --> 00:05:35,969
best geeks to get into the environment

100
00:05:32,320 --> 00:05:38,890
and do all the tricks iasts things and

101
00:05:35,970 --> 00:05:41,170
just give me the packets so I get a call

102
00:05:38,890 --> 00:05:42,849
back from one of the engineers of Black

103
00:05:41,170 --> 00:05:44,440
Hills he says any what do you want a

104
00:05:42,850 --> 00:05:47,110
phone campaign or whatever and I just

105
00:05:44,440 --> 00:05:50,500
don't know you do the trickiest things

106
00:05:47,110 --> 00:05:55,380
that Black Hills engineers know how to

107
00:05:50,500 --> 00:05:59,110
do in the lab whatever it is and just

108
00:05:55,380 --> 00:06:01,600
send me the evil in the form of packets

109
00:05:59,110 --> 00:06:03,370
and let me hunt you and I won't know

110
00:06:01,600 --> 00:06:06,670
what you did but I got to figure it out

111
00:06:03,370 --> 00:06:08,620
so they gave me the traffic I said give

112
00:06:06,670 --> 00:06:10,120
me the give me the traffic on the switch

113
00:06:08,620 --> 00:06:14,700
for the tap whatever they gave it to me

114
00:06:10,120 --> 00:06:17,350
and I said whatever bespoke malware yeah

115
00:06:14,700 --> 00:06:21,729
create new things do whatever you're

116
00:06:17,350 --> 00:06:24,820
gonna do and give it to me right and so

117
00:06:21,730 --> 00:06:28,470
back in 2000 something I ran to ground

118
00:06:24,820 --> 00:06:32,610
patient zero no content just flow data

119
00:06:28,470 --> 00:06:37,330
no contact I had full content but I

120
00:06:32,610 --> 00:06:40,270
adhere to my desire to not use anything

121
00:06:37,330 --> 00:06:43,810
but flow data and I still ran patient

122
00:06:40,270 --> 00:06:45,780
zero to ground nothing but TCP don't

123
00:06:43,810 --> 00:06:52,030
snort Z that's it

124
00:06:45,780 --> 00:06:54,280
so the sequel apparently I know threat

125
00:06:52,030 --> 00:06:56,049
hunting is a popular spectator sport is

126
00:06:54,280 --> 00:06:59,409
awesome they asked me that to do a

127
00:06:56,050 --> 00:07:02,980
sequel so I did seriously I really still

128
00:06:59,410 --> 00:07:05,339
can see you and I used more peak apps

129
00:07:02,980 --> 00:07:10,259
because they sent me like seven

130
00:07:05,339 --> 00:07:14,430
and I used to the first year and one the

131
00:07:10,259 --> 00:07:18,089
next year and I figured that at least at

132
00:07:14,430 --> 00:07:21,629
some point somebody at Black Hills had

133
00:07:18,089 --> 00:07:25,020
to be playing some LMR game so I ran

134
00:07:21,629 --> 00:07:27,180
that to ground - that was fun oh by the

135
00:07:25,020 --> 00:07:32,399
way as you can see on this light

136
00:07:27,180 --> 00:07:36,779
I like the acronym MIT M but the first M

137
00:07:32,399 --> 00:07:41,819
doesn't stand firm man because I have to

138
00:07:36,779 --> 00:07:45,169
be gender nonspecific I've got my wife's

139
00:07:41,819 --> 00:07:49,159
a hacker and she's awesome I have girls

140
00:07:45,169 --> 00:07:51,688
there I can't I can't be gender specific

141
00:07:49,159 --> 00:07:53,430
nor should anyone be you shouldn't even

142
00:07:51,689 --> 00:07:55,949
have to have girls in your lives to not

143
00:07:53,430 --> 00:07:57,809
be gender nonspecific it could be a

144
00:07:55,949 --> 00:07:59,879
woman in the world doesn't have to be a

145
00:07:57,809 --> 00:08:02,219
man in the middle so I've redefined the

146
00:07:59,879 --> 00:08:05,069
first down as monkey in the middle

147
00:08:02,219 --> 00:08:08,819
because what else you going to do in the

148
00:08:05,069 --> 00:08:10,620
middle but monkey with bats right so I

149
00:08:08,819 --> 00:08:13,169
think that makes it fairly gender

150
00:08:10,620 --> 00:08:15,599
nonspecific monkey in the middle I hope

151
00:08:13,169 --> 00:08:18,029
that catches on everyone everyone tweet

152
00:08:15,599 --> 00:08:19,289
it all out monkey in the middle not man

153
00:08:18,029 --> 00:08:21,419
in the middle monkey in the middle

154
00:08:19,289 --> 00:08:26,159
cuz what else you gonna do in the middle

155
00:08:21,419 --> 00:08:30,508
of anyhow I had a grand deal with the

156
00:08:26,159 --> 00:08:33,389
LMR and the W bad stuff last year then

157
00:08:30,509 --> 00:08:36,899
this came they asked if I would complete

158
00:08:33,389 --> 00:08:39,870
the trilogy of hunts and open the

159
00:08:36,899 --> 00:08:43,380
conference in Deadwood within October

160
00:08:39,870 --> 00:08:46,680
2010 team which was I thought that I've

161
00:08:43,380 --> 00:08:49,139
been asked in error but they said no

162
00:08:46,680 --> 00:08:50,459
they really wanted me to do that but my

163
00:08:49,139 --> 00:08:54,630
situation has changed

164
00:08:50,459 --> 00:08:58,739
so I'm now surrendered my independence I

165
00:08:54,630 --> 00:09:02,339
am now at rendition you can see my

166
00:08:58,740 --> 00:09:05,339
little go it's my fine logo as a

167
00:09:02,339 --> 00:09:08,519
principal consultant and now officially

168
00:09:05,339 --> 00:09:11,699
the threat hunting operations lead at

169
00:09:08,519 --> 00:09:16,290
rendition there it is

170
00:09:11,699 --> 00:09:18,599
so I had this opportunity to think okay

171
00:09:16,290 --> 00:09:23,069
if I'm going to do another quick dirty

172
00:09:18,600 --> 00:09:26,490
time for another quick dirty talk it

173
00:09:23,069 --> 00:09:29,519
might be fun to go ahead ahead with

174
00:09:26,490 --> 00:09:32,220
notorious nation-state adversary Jake

175
00:09:29,519 --> 00:09:36,300
Williams and here's here's here's the

176
00:09:32,220 --> 00:09:39,959
asterisks there first off fun I decided

177
00:09:36,300 --> 00:09:44,899
to do this and I hadn't clearly thought

178
00:09:39,959 --> 00:09:47,819
it through because holy holy shit really

179
00:09:44,899 --> 00:09:51,000
I'm going up against Jake Williams and

180
00:09:47,819 --> 00:09:52,610
you can read the double asterisk after I

181
00:09:51,000 --> 00:09:56,930
mean if you don't know who Jake is

182
00:09:52,610 --> 00:10:02,220
well he's the founder rendition and

183
00:09:56,930 --> 00:10:05,758
notoriously ex nation-state operator and

184
00:10:02,220 --> 00:10:09,360
I said hey Jake why don't you create for

185
00:10:05,759 --> 00:10:11,819
me some scenes who that's never existed

186
00:10:09,360 --> 00:10:18,089
in the world and it's going to be my job

187
00:10:11,819 --> 00:10:22,040
for a talk to find you Wow

188
00:10:18,089 --> 00:10:24,930
yeah these both malware he built that

189
00:10:22,040 --> 00:10:28,189
crafted using your columns channel never

190
00:10:24,930 --> 00:10:28,189
used before never seen before

191
00:10:28,740 --> 00:10:33,600
and he gets back to me finally he's like

192
00:10:31,020 --> 00:10:36,540
okay I built it I built the thing I'm

193
00:10:33,600 --> 00:10:39,810
pretty sure I've never seen this done

194
00:10:36,540 --> 00:10:43,560
before I've never done this before so

195
00:10:39,810 --> 00:10:46,469
it's custom crafted but now we have to

196
00:10:43,560 --> 00:10:48,920
have a place to put the traffic right

197
00:10:46,470 --> 00:10:52,170
because he built a tool to do the situ

198
00:10:48,920 --> 00:10:54,420
but where to put it and his first

199
00:10:52,170 --> 00:10:57,630
suggestion I won't even say publicly

200
00:10:54,420 --> 00:11:01,589
because I thought it might have required

201
00:10:57,630 --> 00:11:07,529
a CFA a violation for me to sample it

202
00:11:01,589 --> 00:11:10,080
and so then we came up with some place

203
00:11:07,529 --> 00:11:13,529
as real as possible we need some help

204
00:11:10,080 --> 00:11:17,370
and Dale Hobbs came to the rescue

205
00:11:13,529 --> 00:11:20,820
thank you so much Dale so introducing

206
00:11:17,370 --> 00:11:23,279
Dale Hobbs he's a friend of mine he's a

207
00:11:20,820 --> 00:11:25,279
former student of mine he's a former

208
00:11:23,279 --> 00:11:28,410
student of Black Hills

209
00:11:25,279 --> 00:11:33,120
he's a former client of Black Hills and

210
00:11:28,410 --> 00:11:35,670
J Hamm Corp and also renditions and he

211
00:11:33,120 --> 00:11:40,940
went to his employer and said hey can we

212
00:11:35,670 --> 00:11:44,579
run this and capture this traffic for

213
00:11:40,940 --> 00:11:47,040
community use well I can't I can't make

214
00:11:44,579 --> 00:11:48,890
the peak out of a little community line

215
00:11:47,040 --> 00:11:54,300
but I can but but I

216
00:11:48,890 --> 00:11:58,860
thanks to Dale were able to have a game

217
00:11:54,300 --> 00:12:01,529
so I get a slice of a giant enormous

218
00:11:58,860 --> 00:12:05,820
haystack of Dale's

219
00:12:01,529 --> 00:12:08,850
Enterprise operations here and J here

220
00:12:05,820 --> 00:12:12,360
and a stool in the in the environment in

221
00:12:08,850 --> 00:12:15,450
a very busy environment a one-hour slice

222
00:12:12,360 --> 00:12:18,750
I get of the corporate traffic it's full

223
00:12:15,450 --> 00:12:21,300
content pcap that's what I expected here

224
00:12:18,750 --> 00:12:25,709
and that Jake's buried in all the things

225
00:12:21,300 --> 00:12:29,370
doing all the things even on a Saturday

226
00:12:25,709 --> 00:12:33,000
morning it was for a one-hour slice 5

227
00:12:29,370 --> 00:12:38,310
gigs of packet data so I've got a 5 gig

228
00:12:33,000 --> 00:12:41,779
slice of a one hour traffic with Jake in

229
00:12:38,310 --> 00:12:44,748
it now mind you

230
00:12:41,779 --> 00:12:46,850
I asked Jake hey when you built this did

231
00:12:44,749 --> 00:12:48,560
you at least put like an easter egg or

232
00:12:46,850 --> 00:12:52,279
something in there so I know it was you

233
00:12:48,560 --> 00:12:54,410
if I count you because you know Dale's

234
00:12:52,279 --> 00:12:55,189
Dale's Enterprise is getting a pretty

235
00:12:54,410 --> 00:12:57,850
threat huh

236
00:12:55,189 --> 00:13:01,879
I mean I'm I'm hunting the threat on

237
00:12:57,850 --> 00:13:04,819
Dale's corporate network for an hour on

238
00:13:01,879 --> 00:13:07,670
Saturday I'm like man free threat huh I

239
00:13:04,819 --> 00:13:09,829
may find something besides change how do

240
00:13:07,670 --> 00:13:11,479
we know if I find Jake I ask Jake did

241
00:13:09,829 --> 00:13:13,430
you put an easter egg in there so I know

242
00:13:11,480 --> 00:13:16,579
it's you instead of somebody else he's

243
00:13:13,430 --> 00:13:19,849
like no wait how do I know it's you he's

244
00:13:16,579 --> 00:13:21,979
like well you know if you think it's me

245
00:13:19,850 --> 00:13:24,319
give me the IP address that's the

246
00:13:21,980 --> 00:13:29,329
endpoint of the c2 and then I'll tell

247
00:13:24,319 --> 00:13:33,110
you if it's me or not great yeah

248
00:13:29,329 --> 00:13:34,939
so we go we go we go there's a needle in

249
00:13:33,110 --> 00:13:37,579
the haystack couldn't be more real

250
00:13:34,939 --> 00:13:39,949
because thankfully there's no

251
00:13:37,579 --> 00:13:43,489
maliciousness going on on the inside

252
00:13:39,949 --> 00:13:47,059
asset other than it's running Jake c2 so

253
00:13:43,490 --> 00:13:52,339
there we go all right so the plan well

254
00:13:47,059 --> 00:13:54,230
my plan last year hold on I got a little

255
00:13:52,339 --> 00:13:56,899
window real quick so I can see it on my

256
00:13:54,230 --> 00:14:00,559
slices if anybody has a thing to say

257
00:13:56,899 --> 00:14:03,230
text me at the end any other so the plan

258
00:14:00,559 --> 00:14:05,120
same last year all the analysis just

259
00:14:03,230 --> 00:14:08,959
quick and earn anything I need two

260
00:14:05,120 --> 00:14:13,850
creeks and dirt right oops got a quick

261
00:14:08,959 --> 00:14:16,819
back here nothing beyond what's easily

262
00:14:13,850 --> 00:14:19,100
instrumented in a corporate network like

263
00:14:16,819 --> 00:14:21,559
seriously if you can download security

264
00:14:19,100 --> 00:14:24,189
onion you couldn't do what I did because

265
00:14:21,559 --> 00:14:28,100
my platform for all of this was just

266
00:14:24,189 --> 00:14:33,579
stock security onion by the way Doug

267
00:14:28,100 --> 00:14:36,230
Burks Thank You Man

268
00:14:33,579 --> 00:14:38,059
so I got a lot of NetFlow gate I got

269
00:14:36,230 --> 00:14:40,910
some traffic houses that had correlated

270
00:14:38,059 --> 00:14:43,999
transactions I got snore okay so there's

271
00:14:40,910 --> 00:14:44,959
there's a bit of transactional content

272
00:14:43,999 --> 00:14:48,740
day that's stored

273
00:14:44,959 --> 00:14:51,170
looking but mostly only whatever Doug

274
00:14:48,740 --> 00:14:53,179
put into the security onion by default

275
00:14:51,170 --> 00:14:56,560
command line inspection you're going to

276
00:14:53,179 --> 00:15:00,050
see that nothing that can't be scripted

277
00:14:56,560 --> 00:15:02,630
well in previous years I did know full

278
00:15:00,050 --> 00:15:04,490
content inspection but that's redacted

279
00:15:02,630 --> 00:15:06,860
and no water sugar candy shark is

280
00:15:04,490 --> 00:15:11,300
redacted no session reconstruction is

281
00:15:06,860 --> 00:15:15,410
redacted because this year on haunting

282
00:15:11,300 --> 00:15:16,219
Jake so I figured gloves off I think

283
00:15:15,410 --> 00:15:21,199
that's fair

284
00:15:16,220 --> 00:15:24,560
except for this part humble pie to start

285
00:15:21,200 --> 00:15:27,740
so if you see my previous talks in this

286
00:15:24,560 --> 00:15:29,390
forum you're expecting a bunch of Clyde

287
00:15:27,740 --> 00:15:32,150
gonne crazy

288
00:15:29,390 --> 00:15:33,100
yeah we're getting to that but here's

289
00:15:32,150 --> 00:15:37,640
the thing

290
00:15:33,100 --> 00:15:41,860
Wow how dumb am i humble pie Hebrews

291
00:15:37,640 --> 00:15:45,410
flavored because here's the thing so I

292
00:15:41,860 --> 00:15:49,100
thought that with nothing more than the

293
00:15:45,410 --> 00:15:50,750
traffic dump from Dale because he said

294
00:15:49,100 --> 00:15:53,900
I'll get you all the traffic in and out

295
00:15:50,750 --> 00:15:57,020
from the from the internet I figured oh

296
00:15:53,900 --> 00:15:59,900
I'll be able to figure out the internal

297
00:15:57,020 --> 00:16:01,550
topology just from that point then I

298
00:15:59,900 --> 00:16:03,050
wouldn't need to know it was behind it

299
00:16:01,550 --> 00:16:04,359
that I would be able to figure it all

300
00:16:03,050 --> 00:16:10,040
out

301
00:16:04,360 --> 00:16:14,570
ya know as it turns out I'm not that

302
00:16:10,040 --> 00:16:17,949
smart maybe somebody is hey Mike for

303
00:16:14,570 --> 00:16:21,110
they Boulder challenge it didn't show me

304
00:16:17,950 --> 00:16:25,760
Johanna's alright challenge challenging

305
00:16:21,110 --> 00:16:27,440
you guys but man um I I couldn't I

306
00:16:25,760 --> 00:16:30,380
couldn't figure out the internal

307
00:16:27,440 --> 00:16:32,750
topology from the chill point that I got

308
00:16:30,380 --> 00:16:34,189
so I haven't heat told more about it you

309
00:16:32,750 --> 00:16:38,030
can see on screen that's that's

310
00:16:34,190 --> 00:16:40,550
literally the bar napkin that I started

311
00:16:38,030 --> 00:16:44,410
to try and scroll the scribble things

312
00:16:40,550 --> 00:16:49,069
out on it it didn't work that well so

313
00:16:44,410 --> 00:16:54,890
there's that and that's not even half

314
00:16:49,070 --> 00:17:00,800
the story here's the half of story so me

315
00:16:54,890 --> 00:17:03,439
reading in my pcap that adds a lot of

316
00:17:00,800 --> 00:17:07,250
packets for one hour I mean it's not

317
00:17:03,440 --> 00:17:08,910
it's not the most chain so then I read

318
00:17:07,250 --> 00:17:12,000
in the P cap

319
00:17:08,910 --> 00:17:15,660
and if you're familiar with vpf language

320
00:17:12,000 --> 00:17:20,190
I'm telling I'm telling TCP dome to

321
00:17:15,660 --> 00:17:24,089
ignore the the higher order to bits by

322
00:17:20,190 --> 00:17:27,300
offset 30 and a TCP just in case there's

323
00:17:24,089 --> 00:17:30,300
some ecn going on

324
00:17:27,300 --> 00:17:35,120
that's the TCP 13 in per second 0x are

325
00:17:30,300 --> 00:17:37,770
half able 0 at 0 2 I'm looking for sins

326
00:17:35,120 --> 00:17:41,189
right I'm looking for sins whether or

327
00:17:37,770 --> 00:17:44,040
not ecn protocols and use and I'm

328
00:17:41,190 --> 00:17:47,190
looking at looking for them from source

329
00:17:44,040 --> 00:17:49,710
net one of the insides and not that's

330
00:17:47,190 --> 00:17:52,470
not one of the insides and not des that

331
00:17:49,710 --> 00:17:57,300
another one the insides because God

332
00:17:52,470 --> 00:18:03,780
knows what's going on and I find as you

333
00:17:57,300 --> 00:18:06,120
see zero packets so look again same

334
00:18:03,780 --> 00:18:08,399
thing ignoring the ecn in the first in

335
00:18:06,120 --> 00:18:12,090
the first paragraph or in first

336
00:18:08,400 --> 00:18:14,430
parentheses deaths net local and not

337
00:18:12,090 --> 00:18:20,610
source net local and not source that

338
00:18:14,430 --> 00:18:23,280
local and yeah get packets anyone see

339
00:18:20,610 --> 00:18:28,580
what's happened here if my source net

340
00:18:23,280 --> 00:18:31,680
and des net networks are as had been

341
00:18:28,580 --> 00:18:35,460
illustrated on a napkin which turned out

342
00:18:31,680 --> 00:18:40,320
finally to be correct all I've got is

343
00:18:35,460 --> 00:18:44,700
inbound traffic no outbound I've got

344
00:18:40,320 --> 00:18:46,860
half duplex so apparently there's a bit

345
00:18:44,700 --> 00:18:50,070
of an oopsie with the high availability

346
00:18:46,860 --> 00:18:52,199
load balancers that fog gave you traffic

347
00:18:50,070 --> 00:18:54,330
is half duplex it's inbound only I

348
00:18:52,200 --> 00:18:57,450
having a single outbound soon segment

349
00:18:54,330 --> 00:19:01,320
beacon or no nothing outbound I'm

350
00:18:57,450 --> 00:19:03,600
hunting Jake Williams doing c2 from the

351
00:19:01,320 --> 00:19:06,899
inside out and I don't have a single

352
00:19:03,600 --> 00:19:11,149
city since I'm at see now how real world

353
00:19:06,900 --> 00:19:15,450
is this you can see on the screen

354
00:19:11,150 --> 00:19:15,990
iiiii honest my first response was Jesus

355
00:19:15,450 --> 00:19:19,740
really

356
00:19:15,990 --> 00:19:21,220
they'll did you and Jake conspire to

357
00:19:19,740 --> 00:19:24,490
make it that much more

358
00:19:21,220 --> 00:19:29,530
for me did you really do that on purpose

359
00:19:24,490 --> 00:19:32,470
or do I accept that maybe that was a

360
00:19:29,530 --> 00:19:34,030
boo-boo in any case I just gotta chalk

361
00:19:32,470 --> 00:19:37,210
it up to the fact that you know what

362
00:19:34,030 --> 00:19:39,550
doing an investigation is hard and the

363
00:19:37,210 --> 00:19:42,780
world doesn't care that you're seeking

364
00:19:39,550 --> 00:19:45,610
the truth so there we have it

365
00:19:42,780 --> 00:19:48,370
never mind the gloves that I've shaken

366
00:19:45,610 --> 00:19:50,620
off to find Jake I got one hand tied

367
00:19:48,370 --> 00:19:53,290
behind my back now at this point I will

368
00:19:50,620 --> 00:19:55,870
say I talked to Jake and I said hey dude

369
00:19:53,290 --> 00:19:59,050
man here's what happened I've got

370
00:19:55,870 --> 00:20:03,090
nothing but inbound he's like well yeah

371
00:19:59,050 --> 00:20:06,970
you should see my inbound see two

372
00:20:03,090 --> 00:20:09,370
responses them so you should be able to

373
00:20:06,970 --> 00:20:13,990
find me in a one-hour window that he's

374
00:20:09,370 --> 00:20:16,560
thinking like how often did I yeah you

375
00:20:13,990 --> 00:20:20,550
should see me at least once in and out

376
00:20:16,560 --> 00:20:24,790
great and then he's like come on hands

377
00:20:20,550 --> 00:20:31,690
and I'm like no no I don't want hands no

378
00:20:24,790 --> 00:20:34,960
no Jake no hints cuz to brown so I'm not

379
00:20:31,690 --> 00:20:37,840
so proud but by the time I finally got

380
00:20:34,960 --> 00:20:40,770
the pcap data from them I had one week

381
00:20:37,840 --> 00:20:43,689
to on Jake and electro 'fuck and

382
00:20:40,770 --> 00:20:47,740
meanwhile during that week was teaching

383
00:20:43,690 --> 00:20:50,770
sans management for 14 the longest

384
00:20:47,740 --> 00:20:52,150
bootcamp course ever which runs from 8

385
00:20:50,770 --> 00:20:55,960
a.m. till 7 p.m.

386
00:20:52,150 --> 00:20:58,300
all week long all days no labs neither

387
00:20:55,960 --> 00:21:01,360
so I don't even get breaks for labs it's

388
00:20:58,300 --> 00:21:03,330
just all lecture so all I had was time

389
00:21:01,360 --> 00:21:06,129
in the evenings

390
00:21:03,330 --> 00:21:09,580
if you familiar the CISSP

391
00:21:06,130 --> 00:21:12,310
it's soul-crushing to even contemplate

392
00:21:09,580 --> 00:21:14,679
let alone to lecture about all day every

393
00:21:12,310 --> 00:21:17,790
day and I'm just at the end of every day

394
00:21:14,680 --> 00:21:24,250
like oh my god what's the throughput of

395
00:21:17,790 --> 00:21:30,420
cat-free and the bandwidth used by 802

396
00:21:24,250 --> 00:21:34,960
11 dot B no 802 11 B wouldn't be dot P

397
00:21:30,420 --> 00:21:38,890
god I'm out of my frickin mind I'm try

398
00:21:34,960 --> 00:21:41,529
a-hunting so I said I said this I said

399
00:21:38,890 --> 00:21:43,929
to all my students anybody want to come

400
00:21:41,529 --> 00:21:47,169
down to the bar and hang out and

401
00:21:43,929 --> 00:21:48,399
shoulder surfing wall I'm looking help

402
00:21:47,169 --> 00:21:52,000
help

403
00:21:48,399 --> 00:21:53,408
look for anything I'm missing and then

404
00:21:52,000 --> 00:21:56,289
that was that was a really good

405
00:21:53,409 --> 00:21:58,120
experience it was fun here was the

406
00:21:56,289 --> 00:22:00,070
general methodology of everything I've

407
00:21:58,120 --> 00:22:03,610
done in the past for this talk and I

408
00:22:00,070 --> 00:22:06,668
know on like 2025 minutes into it but

409
00:22:03,610 --> 00:22:09,279
you're gonna see how it wraps typically

410
00:22:06,669 --> 00:22:10,870
I'm gonna do reconnaissance I have to do

411
00:22:09,279 --> 00:22:14,169
the reconnaissance the bad guys do the

412
00:22:10,870 --> 00:22:16,029
reconnaissance so a lot if anyone on the

413
00:22:14,169 --> 00:22:18,580
blue team goes to blue screen there it

414
00:22:16,029 --> 00:22:21,929
is look if you don't think you have to

415
00:22:18,580 --> 00:22:25,178
do reconnaissance Palmer do you know

416
00:22:21,929 --> 00:22:28,210
perfectly the asset layout of your

417
00:22:25,179 --> 00:22:32,289
entire enterprise do you know all the

418
00:22:28,210 --> 00:22:36,460
things where all the things are what all

419
00:22:32,289 --> 00:22:39,490
the things run do you know that as a

420
00:22:36,460 --> 00:22:41,590
consultant coming in I don't know your

421
00:22:39,490 --> 00:22:43,559
environment until I get there and it's

422
00:22:41,590 --> 00:22:46,689
going to take me a bit to figure it out

423
00:22:43,559 --> 00:22:48,399
but even if it's your own environment

424
00:22:46,690 --> 00:22:49,500
come on do you really know it do you

425
00:22:48,399 --> 00:22:52,418
really know it reconnaissance

426
00:22:49,500 --> 00:22:55,870
reconnaissance now then I got a drill

427
00:22:52,419 --> 00:22:57,850
down on anomalous behavior maybe I think

428
00:22:55,870 --> 00:22:59,168
I know what might be anomalous but do

429
00:22:57,850 --> 00:23:01,330
you know what's anomalous in your

430
00:22:59,169 --> 00:23:03,610
environment how do you figure that out

431
00:23:01,330 --> 00:23:05,889
you got to figure that out and the last

432
00:23:03,610 --> 00:23:08,289
thing timeline analysis of important

433
00:23:05,890 --> 00:23:11,890
events right so that's always going to

434
00:23:08,289 --> 00:23:13,629
be the thing so if you've seen me do

435
00:23:11,890 --> 00:23:17,350
this before in a couple of previous

436
00:23:13,630 --> 00:23:19,750
episodes you know I've just trusted my

437
00:23:17,350 --> 00:23:22,539
tools mostly Zeke

438
00:23:19,750 --> 00:23:24,429
seriously mostly Zeke almost everything

439
00:23:22,539 --> 00:23:29,260
I've done before has been the thief and

440
00:23:24,429 --> 00:23:31,480
probably you've seen that it's good for

441
00:23:29,260 --> 00:23:33,309
flow data it's good for transactional

442
00:23:31,480 --> 00:23:36,520
data connection data it's good for all

443
00:23:33,309 --> 00:23:38,168
those things but in this case suddenly I

444
00:23:36,520 --> 00:23:40,720
don't have a single app bouncing

445
00:23:38,169 --> 00:23:43,840
segments no stimulus no outbound

446
00:23:40,720 --> 00:23:46,590
stimulus because I expect that whatever

447
00:23:43,840 --> 00:23:48,519
Jake is doing for z2 is

448
00:23:46,590 --> 00:23:51,639
outbound connection

449
00:23:48,519 --> 00:23:53,139
and I I don't have any of that all I've

450
00:23:51,639 --> 00:23:56,468
got his response packets

451
00:23:53,139 --> 00:23:58,478
why would I assume that Zeke can

452
00:23:56,469 --> 00:24:03,359
understand a connection if it never sees

453
00:23:58,479 --> 00:24:05,529
the center pretty sad pretty sad

454
00:24:03,359 --> 00:24:12,489
yeah damn it

455
00:24:05,529 --> 00:24:14,739
what do well the subtext here ironically

456
00:24:12,489 --> 00:24:18,849
I'm just going to take gloves off on

457
00:24:14,739 --> 00:24:22,599
Jake and go full packet content full

458
00:24:18,849 --> 00:24:25,570
streamer reconstruction anything I had

459
00:24:22,599 --> 00:24:27,789
to do it on today and one way or another

460
00:24:25,570 --> 00:24:31,450
bail made sure I couldn't cheat that way

461
00:24:27,789 --> 00:24:35,249
there's no way to reconstruct the TCP

462
00:24:31,450 --> 00:24:38,679
sink as a sequence if you only got

463
00:24:35,249 --> 00:24:41,769
segments in one direction so no session

464
00:24:38,679 --> 00:24:45,759
reconstruction for me well alright well

465
00:24:41,769 --> 00:24:48,639
it's okay so I go adapter this is a copy

466
00:24:45,759 --> 00:24:51,219
of this life for past years where I

467
00:24:48,639 --> 00:24:53,439
would say initial reconnaissance what

468
00:24:51,219 --> 00:24:55,239
what this stuff start and then where

469
00:24:53,440 --> 00:24:57,309
does it count I don't care because I

470
00:24:55,239 --> 00:24:58,929
know it's one hour and I know I'm we can

471
00:24:57,309 --> 00:25:02,109
proceed to I don't care about the rest

472
00:24:58,929 --> 00:25:03,999
what protocols are involved clearly I

473
00:25:02,109 --> 00:25:06,249
need to know that and who is who I still

474
00:25:03,999 --> 00:25:08,799
need no drilling down on the anomalous

475
00:25:06,249 --> 00:25:10,690
behavior I just need to know who is evil

476
00:25:08,799 --> 00:25:13,089
I don't care who they're being equal to

477
00:25:10,690 --> 00:25:17,049
I don't care people try to propagate I

478
00:25:13,089 --> 00:25:20,700
don't care how because it's not it's

479
00:25:17,049 --> 00:25:22,079
just as t2 though I'm looking for whoops

480
00:25:20,700 --> 00:25:25,179
sorry

481
00:25:22,079 --> 00:25:29,739
timeline analysis also don't care it's

482
00:25:25,179 --> 00:25:33,070
just any time in this our new ICC - so

483
00:25:29,739 --> 00:25:37,419
first sanity check of course I'm gonna

484
00:25:33,070 --> 00:25:40,418
run cap infos on my pea cap make sure I

485
00:25:37,419 --> 00:25:43,719
understand the hour involved that yeah

486
00:25:40,419 --> 00:25:48,940
it's saying it's real then if you look

487
00:25:43,719 --> 00:25:53,469
at the bottom here I'll highlight this

488
00:25:48,940 --> 00:25:56,649
stuff down bottom here this TCP dump so

489
00:25:53,469 --> 00:26:01,960
I'm saying if the ninth byte offset of

490
00:25:56,649 --> 00:26:05,559
the IP packet isn't

491
00:26:01,960 --> 00:26:11,020
or six or 17 in other words if the

492
00:26:05,559 --> 00:26:15,789
embedded protocol isn't TCP or use an

493
00:26:11,020 --> 00:26:19,779
icing key or TCP or UDP in order one six

494
00:26:15,789 --> 00:26:22,210
or 17 it's not ICMP TCP or UDP let me

495
00:26:19,779 --> 00:26:25,240
know if there's any packets because man

496
00:26:22,210 --> 00:26:28,029
I don't trust Jake at all not to be

497
00:26:25,240 --> 00:26:30,909
clever more clever than clever he could

498
00:26:28,029 --> 00:26:33,429
have used a non standard protocol

499
00:26:30,909 --> 00:26:35,919
thinking he'd slide under my radar but

500
00:26:33,429 --> 00:26:38,350
no it's everything in the pcap

501
00:26:35,919 --> 00:26:43,049
everything the feed cabs even I seem to

502
00:26:38,350 --> 00:26:45,699
hear TCP or UDP poop sanity check so

503
00:26:43,049 --> 00:26:49,029
first thing I got to figure the most

504
00:26:45,700 --> 00:26:53,830
obvious thing is well if Jake's gonna be

505
00:26:49,029 --> 00:26:57,190
like skiddy a--the script kiddies Gideon

506
00:26:53,830 --> 00:27:01,480
then he'd be headed outbound and post

507
00:26:57,190 --> 00:27:04,779
via HTTP so but but I don't I don't have

508
00:27:01,480 --> 00:27:10,600
any way to look at HTV HTTP traffic

509
00:27:04,779 --> 00:27:14,279
outbound looking for posts so let's look

510
00:27:10,600 --> 00:27:18,178
at the inbound traffic for that hour

511
00:27:14,279 --> 00:27:22,240
you'll understand that I've converted my

512
00:27:18,179 --> 00:27:25,149
my peek at to something called 170 2.16

513
00:27:22,240 --> 00:27:28,720
inbound pcap emma is doing strings on it

514
00:27:25,149 --> 00:27:31,629
looking for 200 okay looking for when

515
00:27:28,720 --> 00:27:36,340
the server responds with yep I got a

516
00:27:31,630 --> 00:27:41,559
thing and Counting lines for Apple and

517
00:27:36,340 --> 00:27:43,539
that's too many 27,000 server responses

518
00:27:41,559 --> 00:27:48,299
in an hour but I should have expected

519
00:27:43,539 --> 00:27:53,140
that so knowing what I know about use of

520
00:27:48,299 --> 00:27:57,940
posts for beacons I should look for lots

521
00:27:53,140 --> 00:28:04,720
of small responses with regular timing

522
00:27:57,940 --> 00:28:08,500
right so let's look for okay tea shark

523
00:28:04,720 --> 00:28:12,899
yay thr with the same pcap looking for

524
00:28:08,500 --> 00:28:15,580
anywhere where the content my pattern is

525
00:28:12,899 --> 00:28:18,669
saying I got less than

526
00:28:15,580 --> 00:28:21,460
for you because commonly outbound

527
00:28:18,670 --> 00:28:23,170
beacons phone home phone home hey mom

528
00:28:21,460 --> 00:28:26,050
hey mom hey mommy mommy mommy mommy

529
00:28:23,170 --> 00:28:29,610
mommy mom every once in a while

530
00:28:26,050 --> 00:28:33,940
mom says yeah I got something for you

531
00:28:29,610 --> 00:28:36,550
but most commonly mom says 200 ok 200

532
00:28:33,940 --> 00:28:40,840
okay and I'm thinking for you nothing

533
00:28:36,550 --> 00:28:45,490
but 200 okay so it's a it's it's a it's

534
00:28:40,840 --> 00:28:48,330
worth a look for looking for something

535
00:28:45,490 --> 00:28:52,570
coming from a web server to the client

536
00:28:48,330 --> 00:28:55,120
with almost no content at all because

537
00:28:52,570 --> 00:28:58,659
why would there be almost no content at

538
00:28:55,120 --> 00:29:02,919
all so we look ah

539
00:28:58,660 --> 00:29:05,890
striking only 29 times because the

540
00:29:02,920 --> 00:29:09,640
server said from the outside of the

541
00:29:05,890 --> 00:29:13,060
world down to Dale's Enterprise in that

542
00:29:09,640 --> 00:29:16,230
hour only 29 times as a server-side I

543
00:29:13,060 --> 00:29:19,990
got nothing for yet I mean 200 okay

544
00:29:16,230 --> 00:29:20,200
probably or maybe but I got nothing for

545
00:29:19,990 --> 00:29:24,850
you

546
00:29:20,200 --> 00:29:28,270
so we look this is doable I can look at

547
00:29:24,850 --> 00:29:33,340
29 things even in a week I can look at

548
00:29:28,270 --> 00:29:36,100
29 things so is Jake in the HTTP boom

549
00:29:33,340 --> 00:29:41,189
so I say t shard look at that looking

550
00:29:36,100 --> 00:29:47,560
for anything well what are we enough I

551
00:29:41,190 --> 00:29:51,630
got a bunch of 300 - 300 - 300 - 302

552
00:29:47,560 --> 00:29:54,940
bunch of for free it's a 403 forbidden I

553
00:29:51,630 --> 00:29:58,690
looked at those three or two move

554
00:29:54,940 --> 00:30:02,380
through to move the 302 moves are going

555
00:29:58,690 --> 00:30:08,170
to be probably benign and be like if you

556
00:30:02,380 --> 00:30:11,080
went to HTTP not HTTPS but HTTP Google

557
00:30:08,170 --> 00:30:15,310
comm you're going to get a 302 move to

558
00:30:11,080 --> 00:30:18,520
HTTPS and I figure that's what probably

559
00:30:15,310 --> 00:30:21,929
most of those are there's a bunch of

560
00:30:18,520 --> 00:30:27,129
forbidden on what that is except yeah

561
00:30:21,930 --> 00:30:29,530
yeah except I did in fact work through

562
00:30:27,130 --> 00:30:34,650
all of those like it dummy

563
00:30:29,530 --> 00:30:37,690
because sometimes I'm not so smart I

564
00:30:34,650 --> 00:30:43,950
tried I looked I thought maybe Jake

565
00:30:37,690 --> 00:30:47,250
would be an HTTP but he was not so

566
00:30:43,950 --> 00:30:50,230
finally here's here's what went down

567
00:30:47,250 --> 00:30:54,370
there there are slides missing from this

568
00:30:50,230 --> 00:30:59,850
deck that I will maybe include someday

569
00:30:54,370 --> 00:31:03,729
and put online because this this was me

570
00:30:59,850 --> 00:31:07,000
starting today then I dug more then I

571
00:31:03,730 --> 00:31:12,450
dug more done dug more and I dug and dug

572
00:31:07,000 --> 00:31:17,290
and dug in dirt and got all muddy cuz if

573
00:31:12,450 --> 00:31:20,730
there there was no obviously I didn't

574
00:31:17,290 --> 00:31:24,610
trust that Zeke would have had any

575
00:31:20,730 --> 00:31:28,180
purchase on the problem because how

576
00:31:24,610 --> 00:31:31,510
would they know a connection if it never

577
00:31:28,180 --> 00:31:35,110
seen an outbound sin right I mean I

578
00:31:31,510 --> 00:31:38,910
think that's a reasonable assumption so

579
00:31:35,110 --> 00:31:43,899
I was using TCP dump and VPS filters

580
00:31:38,910 --> 00:31:50,770
like you see here at the bottom of the

581
00:31:43,900 --> 00:31:59,680
page just nothing but BPF filters I ran

582
00:31:50,770 --> 00:32:02,860
some crazy vpf filters hold on like the

583
00:31:59,680 --> 00:32:06,100
one at the bottom that's sane I did all

584
00:32:02,860 --> 00:32:09,159
sorts of crazy BPF stuff triangle TCP

585
00:32:06,100 --> 00:32:12,159
Nam and I finally got frustrated because

586
00:32:09,160 --> 00:32:22,770
I figured he's gotta be someplace that I

587
00:32:12,160 --> 00:32:27,700
can see you know and even this yeah well

588
00:32:22,770 --> 00:32:30,850
so I finally decided let's give Zeke a

589
00:32:27,700 --> 00:32:33,690
chance maybe maybe Zeke knows more than

590
00:32:30,850 --> 00:32:37,689
I'm thinking so you can see here I

591
00:32:33,690 --> 00:32:43,300
created a secret here and Zeke against

592
00:32:37,690 --> 00:32:53,620
the pcap and lo and behold

593
00:32:43,300 --> 00:32:57,090
this the Khan log it figured out

594
00:32:53,620 --> 00:33:02,020
connections so I asked it ma'am

595
00:32:57,090 --> 00:33:05,470
really who's responding on what ports on

596
00:33:02,020 --> 00:33:06,850
what responding ports and that's if you

597
00:33:05,470 --> 00:33:09,790
look at the command line I'm cutting out

598
00:33:06,850 --> 00:33:15,699
the Conn log two broke out now Zika

599
00:33:09,790 --> 00:33:18,610
looking for the ID dot recipe field

600
00:33:15,700 --> 00:33:20,830
which if you know if you know Zeke and

601
00:33:18,610 --> 00:33:23,050
the Conn log that's the responding port

602
00:33:20,830 --> 00:33:26,800
otherwise known as the destination port

603
00:33:23,050 --> 00:33:29,230
and sorted out a nigga Phi it with

604
00:33:26,800 --> 00:33:34,360
account so that the column that you see

605
00:33:29,230 --> 00:33:37,420
on the left hand is how many times that

606
00:33:34,360 --> 00:33:42,760
port was seen and on the right hand is

607
00:33:37,420 --> 00:33:45,880
what porter so check that way tons of

608
00:33:42,760 --> 00:33:49,960
stuff on port 53 but that makes sense

609
00:33:45,880 --> 00:33:52,810
because it's UDP port 53 which is in

610
00:33:49,960 --> 00:33:58,720
connection based so apparently zeke can

611
00:33:52,810 --> 00:34:00,879
figure out that a DNS response is part

612
00:33:58,720 --> 00:34:04,150
of a connection that may have resulted

613
00:34:00,880 --> 00:34:08,260
from a DNS request it didn't see but so

614
00:34:04,150 --> 00:34:14,159
it logs it is a connection 443 that's

615
00:34:08,260 --> 00:34:19,300
trickier Zeke sees an X dot 509 served

616
00:34:14,159 --> 00:34:22,620
coming down on port 443 even though it

617
00:34:19,300 --> 00:34:26,669
never saw the since and I act it still

618
00:34:22,620 --> 00:34:28,359
recognizes that it sees a clear text

619
00:34:26,668 --> 00:34:36,100
x.509 sir

620
00:34:28,360 --> 00:34:39,010
coming down on 443 and 480 well 200 okay

621
00:34:36,100 --> 00:34:41,679
so let's look right Zeke sees

622
00:34:39,010 --> 00:34:44,620
connections some of them in halves to

623
00:34:41,679 --> 00:34:49,270
DNS it has to because of what I just

624
00:34:44,620 --> 00:34:51,310
said sees inbound X dot 509 search just

625
00:34:49,270 --> 00:34:54,190
like I said even though it doesn't see

626
00:34:51,310 --> 00:34:56,349
the Stinson ikat and the HTTP on the

627
00:34:54,190 --> 00:35:01,869
inbound wow hole

628
00:34:56,349 --> 00:35:04,200
smokes Zeke is so smart set halt fern

629
00:35:01,869 --> 00:35:07,180
Paxson thank you

630
00:35:04,200 --> 00:35:13,739
thank you for this thank you for this

631
00:35:07,180 --> 00:35:13,739
because now I can see how about this

632
00:35:14,309 --> 00:35:26,130
let's go sorry there we go so you

633
00:35:23,710 --> 00:35:30,849
already saw that I looked for Jake in

634
00:35:26,130 --> 00:35:35,410
the HTTP and and find anything pay dirt

635
00:35:30,849 --> 00:35:38,170
so Jake in the DNS now honestly I don't

636
00:35:35,410 --> 00:35:42,249
think Jake would hide in the DNS I had

637
00:35:38,170 --> 00:35:44,680
to look just out of completeness because

638
00:35:42,249 --> 00:35:47,379
I think Jake's too clever I in the DNS

639
00:35:44,680 --> 00:35:52,660
everybody hides in the DNS if you're not

640
00:35:47,380 --> 00:35:55,630
looking at your DNS data then all the

641
00:35:52,660 --> 00:35:59,319
all the c2 is happening and you don't

642
00:35:55,630 --> 00:36:03,219
know the absence of detection is not the

643
00:35:59,319 --> 00:36:05,079
absence of a breach you should be

644
00:36:03,219 --> 00:36:06,729
looking at your DNS data if you're not

645
00:36:05,079 --> 00:36:09,099
looking at your DNS a - let me back you

646
00:36:06,729 --> 00:36:11,618
up and say look you got to be looking at

647
00:36:09,099 --> 00:36:14,049
your DNS data if you go to your DNS

648
00:36:11,619 --> 00:36:17,079
server administrator and ask them to

649
00:36:14,049 --> 00:36:19,299
start logging all the DNS requests and

650
00:36:17,079 --> 00:36:21,309
replies they're going to throat punch

651
00:36:19,299 --> 00:36:23,739
you or best tell you to go packs and

652
00:36:21,309 --> 00:36:26,619
because they're not going to like the

653
00:36:23,739 --> 00:36:29,349
load on your DNS server to do that but

654
00:36:26,619 --> 00:36:32,469
that's okay all you got to do slap a tab

655
00:36:29,349 --> 00:36:36,999
right in front of your inside DNS server

656
00:36:32,469 --> 00:36:39,999
and put security onion on it slurping

657
00:36:36,999 --> 00:36:43,029
with Zeke let Zeke take care of it here

658
00:36:39,999 --> 00:36:46,689
Zeke taken care of it cat vns log broke

659
00:36:43,029 --> 00:36:48,880
out query grip via the query roughing

660
00:36:46,690 --> 00:36:52,559
out anything that's our code anything

661
00:36:48,880 --> 00:36:55,930
that starts with a - that's reverse

662
00:36:52,559 --> 00:36:59,680
lookups and anything that starts with a

663
00:36:55,930 --> 00:37:01,629
- is no answer and then we pipe it

664
00:36:59,680 --> 00:37:04,450
through sad if you don't know sad it's

665
00:37:01,630 --> 00:37:08,589
just a regular expression switcher that

666
00:37:04,450 --> 00:37:09,759
just does stream stream editing where

667
00:37:08,589 --> 00:37:12,430
we're saying

668
00:37:09,760 --> 00:37:15,460
everything that begins with a to Z

669
00:37:12,430 --> 00:37:19,089
lowercase or it is the uppercase for 0

670
00:37:15,460 --> 00:37:22,000
through 9 or - any number of those up

671
00:37:19,090 --> 00:37:25,900
until a literal dot squeeze those out so

672
00:37:22,000 --> 00:37:29,080
we can sort out just the unique TLD ours

673
00:37:25,900 --> 00:37:29,800
oh did I say tail here too long didn't

674
00:37:29,080 --> 00:37:32,950
right now I'm sorry

675
00:37:29,800 --> 00:37:34,840
@q en and domain name anything but the

676
00:37:32,950 --> 00:37:37,779
host name let's get everything but the

677
00:37:34,840 --> 00:37:40,930
host name squeezed off and then you need

678
00:37:37,780 --> 00:37:43,890
to fire them and gamma and look at the

679
00:37:40,930 --> 00:37:47,109
unique ones now if something like iodine

680
00:37:43,890 --> 00:37:50,170
or DNS quatre something's going on

681
00:37:47,110 --> 00:37:52,750
you can see a really spiky high number

682
00:37:50,170 --> 00:37:56,140
but we're not seeing early spiky high

683
00:37:52,750 --> 00:37:58,540
number so apparently Jake's not doing

684
00:37:56,140 --> 00:38:05,440
some obvious thing with the ass alright

685
00:37:58,540 --> 00:38:09,520
but how about this how about weirdness

686
00:38:05,440 --> 00:38:12,280
in the in the x.509 certificates now I

687
00:38:09,520 --> 00:38:15,040
got to give a major hat tip to Eric

688
00:38:12,280 --> 00:38:17,680
Conrad and Seth my son our faculty

689
00:38:15,040 --> 00:38:20,430
fellows at the SANS Institute for

690
00:38:17,680 --> 00:38:23,290
tipping me off to some of this magic but

691
00:38:20,430 --> 00:38:23,830
apparently Jake skipped it because here

692
00:38:23,290 --> 00:38:27,070
we go

693
00:38:23,830 --> 00:38:32,799
I'm looking at the X dot 509 lock like I

694
00:38:27,070 --> 00:38:35,050
said Zeke consumed the X dot 509 certain

695
00:38:32,800 --> 00:38:37,840
though it didn't see syn synack act and

696
00:38:35,050 --> 00:38:40,450
still consume them and so I look at

697
00:38:37,840 --> 00:38:42,970
nothing but the issuer field of their

698
00:38:40,450 --> 00:38:45,939
certificate that minds you lots of

699
00:38:42,970 --> 00:38:48,910
flailing around before this before I got

700
00:38:45,940 --> 00:38:53,740
to this but then all I'm doing is

701
00:38:48,910 --> 00:38:57,730
printing out the length of the cert plus

702
00:38:53,740 --> 00:39:00,370
the the then link to this the issuer

703
00:38:57,730 --> 00:39:04,090
field plus the issuer reveal itself

704
00:39:00,370 --> 00:39:06,700
sorting counting on the length sorting

705
00:39:04,090 --> 00:39:10,990
again and tailing and looking at the

706
00:39:06,700 --> 00:39:18,279
shortest issuer fields of the certs and

707
00:39:10,990 --> 00:39:23,229
I'm pretty sure that this is base64

708
00:39:18,280 --> 00:39:26,800
encoding in this in the o u + o field

709
00:39:23,230 --> 00:39:30,540
of the issuer field of the X dot 509 so

710
00:39:26,800 --> 00:39:36,810
I think I found shape did I find Jake

711
00:39:30,540 --> 00:39:41,740
yeah I found Jake if you're looking here

712
00:39:36,810 --> 00:39:44,980
catting out the X dot 509 long bro

713
00:39:41,740 --> 00:39:48,629
cutting out the issuer field sorting

714
00:39:44,980 --> 00:39:51,100
unique applying grepping that re

715
00:39:48,630 --> 00:39:54,340
anything that has a canonical name

716
00:39:51,100 --> 00:39:56,618
because apparently Jake forgot to

717
00:39:54,340 --> 00:40:01,330
include a canonical name in his issuer

718
00:39:56,619 --> 00:40:05,109
field and so I got some base64 if I echo

719
00:40:01,330 --> 00:40:11,170
out that basics T 4 it says run format

720
00:40:05,109 --> 00:40:15,369
see /y that's the for switch and that's

721
00:40:11,170 --> 00:40:18,070
not nice Jake but found found in any

722
00:40:15,369 --> 00:40:21,280
case I'm coming up for the end of my 45

723
00:40:18,070 --> 00:40:23,680
minutes here's my summary you can find

724
00:40:21,280 --> 00:40:25,660
what you're looking for if you look you

725
00:40:23,680 --> 00:40:27,759
can't find what you're looking for if

726
00:40:25,660 --> 00:40:30,279
you're not looking I think that's I

727
00:40:27,760 --> 00:40:32,320
think that's fairly canonical in the

728
00:40:30,280 --> 00:40:38,230
land of the blind the one-eyed man is

729
00:40:32,320 --> 00:40:39,880
king the quote in Latin I won't try to

730
00:40:38,230 --> 00:40:45,280
pronounce because they don't actually

731
00:40:39,880 --> 00:40:48,550
speak Latin but in any case a monk in

732
00:40:45,280 --> 00:40:52,450
the Netherlands I've been famous for

733
00:40:48,550 --> 00:40:56,410
that one summary plus I could not have

734
00:40:52,450 --> 00:41:00,609
pulled this off without an attacker my

735
00:40:56,410 --> 00:41:02,890
nation state blue blue attacker willing

736
00:41:00,609 --> 00:41:05,259
to construct something never been seen

737
00:41:02,890 --> 00:41:08,790
before burning basic C 4 encoded

738
00:41:05,260 --> 00:41:14,140
commands in the next time 509 cert

739
00:41:08,790 --> 00:41:16,930
lovely clever nice and nobody better

740
00:41:14,140 --> 00:41:20,410
ever try that because now I know - look

741
00:41:16,930 --> 00:41:23,350
there - ha ha I'll find you but also

742
00:41:20,410 --> 00:41:28,109
Dale Hobbs Ben thanks for varying that

743
00:41:23,350 --> 00:41:31,890
traffic in an environment which holy

744
00:41:28,109 --> 00:41:35,170
smokes what a huge case that that was

745
00:41:31,890 --> 00:41:36,819
for the folks at home listening to this

746
00:41:35,170 --> 00:41:40,960
again you can imagine but

747
00:41:36,820 --> 00:41:43,240
that it was it was the most generous

748
00:41:40,960 --> 00:41:45,700
haystack I've ever had this sort through

749
00:41:43,240 --> 00:41:50,080
to find a nation-state attacker doing

750
00:41:45,700 --> 00:41:54,399
situ through fields and an x.509 certain

751
00:41:50,080 --> 00:41:58,840
basics before Wow also though huge

752
00:41:54,400 --> 00:42:02,080
thanks to to the queen of all packets

753
00:41:58,840 --> 00:42:04,660
Miss Judy Novak and Dave ulcer who is

754
00:42:02,080 --> 00:42:09,340
now the current owner and operator of

755
00:42:04,660 --> 00:42:11,500
SEC 503 at sands for whom both both from

756
00:42:09,340 --> 00:42:14,500
whom I've learned an incredible amount

757
00:42:11,500 --> 00:42:17,800
and Eric Conrad and Seth Maxima

758
00:42:14,500 --> 00:42:22,960
thank you very much for the time I get

759
00:42:17,800 --> 00:42:25,420
to teach 511 which is all about threat

760
00:42:22,960 --> 00:42:29,140
hunting and sans all about threat

761
00:42:25,420 --> 00:42:31,570
hunting just all about friends and learn

762
00:42:29,140 --> 00:42:36,120
a bunch from these guys from these

763
00:42:31,570 --> 00:42:41,620
people and so my thanks to them too and

764
00:42:36,120 --> 00:42:45,190
that's pretty much it I'm gonna expand

765
00:42:41,620 --> 00:42:48,569
my window for any questions that roll in

766
00:42:45,190 --> 00:42:51,430
if anyone has any Oh

767
00:42:48,570 --> 00:42:54,550
I'll be standing here when I can and

768
00:42:51,430 --> 00:42:56,230
looking for any questions there's a

769
00:42:54,550 --> 00:43:00,150
question from spin now do you have a

770
00:42:56,230 --> 00:43:02,470
book do I have a book yeah that's one

771
00:43:00,150 --> 00:43:06,640
it's hard to see can you tell us what it

772
00:43:02,470 --> 00:43:10,629
is I'm currently working on volume two

773
00:43:06,640 --> 00:43:12,730
of network forensics I don't know what

774
00:43:10,630 --> 00:43:15,750
it's going to be done I'm trying like

775
00:43:12,730 --> 00:43:19,440
hell but I write really really slowly

776
00:43:15,750 --> 00:43:22,600
it's it'll be it'll be out when it's out

777
00:43:19,440 --> 00:43:25,690
yeah John another question is uh what is

778
00:43:22,600 --> 00:43:26,500
the specs of your analysis machine like

779
00:43:25,690 --> 00:43:30,850
RAM

780
00:43:26,500 --> 00:43:34,480
Paul that's oh yeah I did all that

781
00:43:30,850 --> 00:43:38,020
analysis seriously with the latest

782
00:43:34,480 --> 00:43:43,240
version of security onion at the time

783
00:43:38,020 --> 00:43:47,470
which was still like a $14 release I put

784
00:43:43,240 --> 00:43:50,259
on a on a Lenovo ThinkPad at carbon our

785
00:43:47,470 --> 00:43:55,029
x1 carbon with 16 gigs of RAM

786
00:43:50,260 --> 00:43:59,170
and an SSD I mean it's not high-powered

787
00:43:55,030 --> 00:44:01,860
box and the only reason why that was my

788
00:43:59,170 --> 00:44:07,030
platform is because I used to do all my

789
00:44:01,860 --> 00:44:10,480
analysis on math power book until my Mac

790
00:44:07,030 --> 00:44:12,280
power look for when 2007 died the like

791
00:44:10,480 --> 00:44:13,840
the motherboard died everything had been

792
00:44:12,280 --> 00:44:16,810
replaced with the motherboard and just

793
00:44:13,840 --> 00:44:19,240
fried and I was so frustrated when I

794
00:44:16,810 --> 00:44:19,900
looked at Mac prices I didn't want to

795
00:44:19,240 --> 00:44:22,149
buy another one

796
00:44:19,900 --> 00:44:26,200
I was talking to strand and he's like

797
00:44:22,150 --> 00:44:28,930
dude why he he's like I banned in the

798
00:44:26,200 --> 00:44:31,299
Apple why not go back to your roots just

799
00:44:28,930 --> 00:44:33,960
get a Linux box and black roots you'll

800
00:44:31,300 --> 00:44:36,700
be happier man because I started with

801
00:44:33,960 --> 00:44:40,240
Slackware Linux in the dock 99 pearl

802
00:44:36,700 --> 00:44:43,830
days like about a year after Linus

803
00:44:40,240 --> 00:44:48,100
released it in in the in the mid-90s and

804
00:44:43,830 --> 00:44:49,930
and I told him all right I'm going to do

805
00:44:48,100 --> 00:44:52,569
that he's like well did you did you pick

806
00:44:49,930 --> 00:44:56,529
a box and I was like no he's like well

807
00:44:52,570 --> 00:44:58,660
what you need to get is an x1 carbon it

808
00:44:56,530 --> 00:45:01,660
was like why are you so sure he's like

809
00:44:58,660 --> 00:45:03,490
remember when I fell and broke my ribs I

810
00:45:01,660 --> 00:45:07,210
was like yeah a few plots

811
00:45:03,490 --> 00:45:10,149
he's like I fell on my x1 carbon my ribs

812
00:45:07,210 --> 00:45:12,880
broke it didn't so that's what I'm

813
00:45:10,150 --> 00:45:16,110
running with to 16 gigs or ham it's a

814
00:45:12,880 --> 00:45:20,470
little light for a lot of bm's but for

815
00:45:16,110 --> 00:45:24,190
processing finding Jake it worked just

816
00:45:20,470 --> 00:45:26,319
fine the other buttons yeah one more

817
00:45:24,190 --> 00:45:30,520
what lab setup do you prefer for limited

818
00:45:26,320 --> 00:45:32,320
hardware labs do you see gns3 providing

819
00:45:30,520 --> 00:45:35,530
the level of detail required in the

820
00:45:32,320 --> 00:45:39,070
capture for my labs I'm just I'm just

821
00:45:35,530 --> 00:45:42,010
running VMs individually I can I can

822
00:45:39,070 --> 00:45:43,870
manage with that lenovo x1 carbon i can

823
00:45:42,010 --> 00:45:48,220
manage a couple of them with a small

824
00:45:43,870 --> 00:45:51,370
footprint but that's that's pretty much

825
00:45:48,220 --> 00:45:54,520
it for for a lightweight lab setup i

826
00:45:51,370 --> 00:45:57,370
mean in in my office across town which

827
00:45:54,520 --> 00:46:01,560
here in Missoula have an office across

828
00:45:57,370 --> 00:46:03,609
town but I've gotten more hardware but

829
00:46:01,560 --> 00:46:07,150
honestly

830
00:46:03,610 --> 00:46:13,290
when we're talking about like DNS stuff

831
00:46:07,150 --> 00:46:17,860
I'm still just a block all DNS over TLS

832
00:46:13,290 --> 00:46:19,600
which you can do by for 853 blocking it

833
00:46:17,860 --> 00:46:22,420
doesn't belong on an enterprise network

834
00:46:19,600 --> 00:46:24,400
it should be block block block make it

835
00:46:22,420 --> 00:46:28,750
Dodds it needs to die in a fire

836
00:46:24,400 --> 00:46:32,290
DNS over HTTP over HTTP is harder

837
00:46:28,750 --> 00:46:35,110
because it's on port 443 for that you

838
00:46:32,290 --> 00:46:38,950
kind of need to reach out to your

839
00:46:35,110 --> 00:46:42,460
endpoints via GPOs and use the fact that

840
00:46:38,950 --> 00:46:45,910
GPOs can reconfigure Firefox and edge

841
00:46:42,460 --> 00:46:49,030
and chrome to not do that because DNS

842
00:46:45,910 --> 00:46:53,200
over HTTP do H which is pronounced what

843
00:46:49,030 --> 00:46:57,550
go back bad news if you can't if you

844
00:46:53,200 --> 00:47:00,189
can't log all your HTTP you've got a

845
00:46:57,550 --> 00:47:03,010
problem that's what I'm saying biggest

846
00:47:00,190 --> 00:47:07,000
biggest gain make sure everything is

847
00:47:03,010 --> 00:47:09,910
running over 453 and put a tap in front

848
00:47:07,000 --> 00:47:13,330
of your DNS server and put Zeke on the

849
00:47:09,910 --> 00:47:15,430
job and record everything in and out I

850
00:47:13,330 --> 00:47:18,480
really actually have expected to find

851
00:47:15,430 --> 00:47:21,160
Jake in videos that is it never boils

852
00:47:18,480 --> 00:47:23,680
John that's it thank you so much

853
00:47:21,160 --> 00:47:25,629
no worries we have the discord channel

854
00:47:23,680 --> 00:47:27,310
so John if you're not in there just let

855
00:47:25,630 --> 00:47:28,720
me know if you get a chance to join it

856
00:47:27,310 --> 00:47:30,549
might be some more questions that people

857
00:47:28,720 --> 00:47:33,160
have and they want to interact with you

858
00:47:30,550 --> 00:47:35,580
later on no worries I'll try and find my

859
00:47:33,160 --> 00:47:35,580
way there

