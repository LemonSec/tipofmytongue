1
00:00:10,377 --> 00:00:13,747
(audience claps)

2
00:00:13,747 --> 00:00:16,583
- So, we presented a very
similar presentation,

3
00:00:16,583 --> 00:00:20,020
three weeks ago, at the
international cyber conference

4
00:00:20,020 --> 00:00:21,187
up at a

5
00:00:21,187 --> 00:00:22,655
New York with the FBI fortem,

6
00:00:22,655 --> 00:00:25,291
they were god, we
can't come to SANS CTI,

7
00:00:25,291 --> 00:00:26,526
and not present new stuff.

8
00:00:26,526 --> 00:00:27,694
So,

9
00:00:27,694 --> 00:00:28,962
new presentation

10
00:00:28,962 --> 00:00:30,096
is very exciting,

11
00:00:31,064 --> 00:00:33,533
hidden empires of malware,

12
00:00:33,533 --> 00:00:34,567
now,

13
00:00:34,567 --> 00:00:36,202
with blockchain and AI

14
00:00:36,202 --> 00:00:37,037
(audience claps)

15
00:00:37,037 --> 00:00:38,171
boom,

16
00:00:38,171 --> 00:00:39,172
this already

17
00:00:39,172 --> 00:00:41,741
400%, better than it was before,

18
00:00:41,741 --> 00:00:43,576
right, so, we're done,

19
00:00:43,576 --> 00:00:44,844
out,

20
00:00:44,844 --> 00:00:46,846
but yeah, if you
say, there you go.

21
00:00:46,846 --> 00:00:48,080
So, before we do any talk,

22
00:00:48,081 --> 00:00:50,350
we like to go over what
legal makes us say,

23
00:00:50,350 --> 00:00:51,618
which is

24
00:00:51,618 --> 00:00:53,386
don't buy stock on
anything we say,

25
00:00:53,386 --> 00:00:55,488
don't believe
anything Dave says,

26
00:00:55,488 --> 00:00:58,992
we lean very forward,
and sometimes we trip,

27
00:00:58,992 --> 00:01:00,226
as we'll discuss today.

28
00:01:00,226 --> 00:01:02,262
So, with that in mind,
we'll keep going.

29
00:01:03,463 --> 00:01:04,931
As said, I'm Ryan Kovar,

30
00:01:04,931 --> 00:01:07,801
been doing cyber security
stuff for 17 or 18 years now,

31
00:01:07,801 --> 00:01:09,269
got my start in the US navy,

32
00:01:09,269 --> 00:01:12,338
done everything from pulling
cat five on an aircraft carrier

33
00:01:12,338 --> 00:01:13,839
to

34
00:01:13,840 --> 00:01:15,842
working here at Splunk, and
traveling all over the world.

35
00:01:17,010 --> 00:01:18,711
- Yeah, I've worked at
Splunk for a long time,

36
00:01:18,711 --> 00:01:21,114
about three years, been
in IT for a long time,

37
00:01:21,114 --> 00:01:22,982
I'm a big advocate of SANS,

38
00:01:22,982 --> 00:01:24,784
always loved coming
to these events,

39
00:01:24,784 --> 00:01:26,019
I'm a GSE,

40
00:01:26,019 --> 00:01:27,954
been through lot's
of SANS courses,

41
00:01:27,954 --> 00:01:29,856
been a SANS mentor,

42
00:01:29,856 --> 00:01:31,124
and

43
00:01:31,124 --> 00:01:32,357
one think that Ryan
and I work on a lot

44
00:01:32,358 --> 00:01:33,993
is our Boss of the
SOCs, at Splunk,

45
00:01:33,993 --> 00:01:36,229
and sometimes people
know us for that,

46
00:01:36,229 --> 00:01:39,332
so, that's something that
we've put a lot of effort into,

47
00:01:39,332 --> 00:01:40,699
the last couple years.

48
00:01:40,700 --> 00:01:41,968
- [Ryan] Cool,

49
00:01:41,968 --> 00:01:44,471
So, agenda's, this has
come up multiple times,

50
00:01:44,471 --> 00:01:47,040
the who, what, where,
when, how, why,

51
00:01:47,040 --> 00:01:48,808
I believe you've learned
everything you need,

52
00:01:48,808 --> 00:01:50,477
in just about under 6th grade,

53
00:01:50,477 --> 00:01:52,011
which is about my
education level.

54
00:01:52,011 --> 00:01:53,813
So, we're gonna
go over those now.

55
00:01:53,813 --> 00:01:55,815
So, why are we doing
this talk, right,

56
00:01:55,815 --> 00:01:57,684
what was so
interesting about it,

57
00:01:57,684 --> 00:01:59,551
what are we talking about
with hunting empires,

58
00:01:59,552 --> 00:02:02,789
it's a clever play on words,
hopefully people find amusing,

59
00:02:02,789 --> 00:02:04,724
what are SSL certificates,
a lot of people

60
00:02:04,724 --> 00:02:07,193
don't really dig into 'em,
as much as they should,

61
00:02:07,193 --> 00:02:09,929
I was converted by Mark
Parsons evangelism,

62
00:02:09,929 --> 00:02:11,631
that we'll go over
quite a bit today.

63
00:02:11,631 --> 00:02:13,700
What can you do
with them, right.

64
00:02:13,700 --> 00:02:15,667
Now, let's talk about the H's,

65
00:02:15,668 --> 00:02:19,072
how can I get the data
yourself, and why should you,

66
00:02:19,072 --> 00:02:21,774
and how does blockchain,
no automate, no,

67
00:02:21,774 --> 00:02:25,612
ML, machine learning, how can
machine learning help you,

68
00:02:25,612 --> 00:02:27,513
and where do I get all
this awesome stuff,

69
00:02:27,514 --> 00:02:28,882
but before all of that,

70
00:02:28,882 --> 00:02:30,083
I want everyone up,

71
00:02:30,083 --> 00:02:32,385
c'mon, we're in the yawn
phase, c'mon get up,

72
00:02:32,385 --> 00:02:34,487
I know it's awkward,
I'm making ya stand up,

73
00:02:34,487 --> 00:02:35,922
shake it off, shake if off,

74
00:02:35,922 --> 00:02:38,691
get your inner Taylor
Swift, there we go, alright,

75
00:02:38,691 --> 00:02:41,227
keep standing, keep
standing, as a clever ploy,

76
00:02:42,629 --> 00:02:43,863
we're gonna have a
counseling session,

77
00:02:43,863 --> 00:02:45,565
little bit of come
to Jesus, right,

78
00:02:45,565 --> 00:02:46,833
alright, if you don't know

79
00:02:46,833 --> 00:02:48,868
what SSL Pivoting and
Hunting is sit down,

80
00:02:50,436 --> 00:02:51,971
oh, that's pretty
good, s'awesome,

81
00:02:51,971 --> 00:02:54,073
go ahead be honest with
yourself, or just be lazy,

82
00:02:56,643 --> 00:02:58,344
if your org can't capture

83
00:02:58,344 --> 00:03:00,313
SSL certificates
at scale sit down,

84
00:03:02,715 --> 00:03:03,550
oh,

85
00:03:03,550 --> 00:03:04,584
that's pretty good,

86
00:03:04,584 --> 00:03:06,019
alright, finally,

87
00:03:07,086 --> 00:03:08,288
if you've never applied
machine learning

88
00:03:08,288 --> 00:03:10,356
to SSL certificates sit down,

89
00:03:12,425 --> 00:03:13,893
there's two people
who should be standing

90
00:03:13,893 --> 00:03:15,395
Rebecca Brown, and Al's Pinto,

91
00:03:15,395 --> 00:03:17,163
oh my god, how surprising,

92
00:03:17,163 --> 00:03:18,031
(Dave and audience laugh)

93
00:03:18,031 --> 00:03:18,865
right.

94
00:03:18,865 --> 00:03:20,567
You'll see why shortly,

95
00:03:20,567 --> 00:03:21,568
so,

96
00:03:22,635 --> 00:03:24,703
we have a lot of
knowledge about things,

97
00:03:24,704 --> 00:03:27,106
we are at consummate
generalists of all the things,

98
00:03:27,106 --> 00:03:28,507
all the places for everything,

99
00:03:28,508 --> 00:03:30,410
but we're not deep
dive, with the exception

100
00:03:30,410 --> 00:03:32,679
of two people in the audience,
neither are you, right,

101
00:03:32,679 --> 00:03:34,480
and that's part of
what I like to do is,

102
00:03:34,480 --> 00:03:35,748
I think it as bringing like

103
00:03:35,748 --> 00:03:37,784
I'm the little man
going up to Ariethius,

104
00:03:37,784 --> 00:03:39,352
and stealing some
awesome cyber thunder,

105
00:03:39,352 --> 00:03:40,887
and fire, bringing
it down, right.

106
00:03:40,887 --> 00:03:42,789
We're trying to make this
approachable for everyone,

107
00:03:42,789 --> 00:03:44,323
and we hope that you think that.

108
00:03:46,159 --> 00:03:48,628
- Alright, so, SSL certificates,

109
00:03:48,628 --> 00:03:50,396
so, we know what's TLS, right.

110
00:03:50,396 --> 00:03:54,000
So, first question can
be answered right away.

111
00:03:54,000 --> 00:03:57,337
We just use the term SSL
and TLS interchangeably,

112
00:03:57,337 --> 00:03:59,572
for the purposes of this talk,

113
00:03:59,572 --> 00:04:02,842
and first of all, yeah,
Mark, where's Mark at,

114
00:04:02,842 --> 00:04:04,344
he's sitting over there, he is.

115
00:04:04,344 --> 00:04:05,345
So,

116
00:04:05,345 --> 00:04:06,179
yeah.

117
00:04:06,179 --> 00:04:08,047
(audience claps)

118
00:04:08,047 --> 00:04:11,351
So, Mark has kind
of pioneered this,

119
00:04:11,351 --> 00:04:12,819
this area of research.

120
00:04:12,819 --> 00:04:15,554
I know the first time I ever
heard him talk about it,

121
00:04:15,555 --> 00:04:16,589
over beers one time,

122
00:04:16,589 --> 00:04:17,790
I was just blown away,

123
00:04:17,790 --> 00:04:21,327
at the insight that
can be gathered through

124
00:04:21,327 --> 00:04:24,264
analyzing SSL and
TSL certificates.

125
00:04:24,264 --> 00:04:25,164
He has a

126
00:04:25,164 --> 00:04:26,164
very

127
00:04:26,165 --> 00:04:27,634
long

128
00:04:27,634 --> 00:04:30,770
history of publishing all kinds
of great tools and research,

129
00:04:30,770 --> 00:04:32,272
talks on this topic,

130
00:04:32,272 --> 00:04:34,274
so, you should check
those out for sure.

131
00:04:34,274 --> 00:04:37,677
Also, as Rob mentioned,
a lot of these techniques

132
00:04:37,677 --> 00:04:40,380
are being added
into forensics 578,

133
00:04:40,380 --> 00:04:41,881
which is a great class,

134
00:04:41,881 --> 00:04:43,950
we took it last
year at this event.

135
00:04:43,950 --> 00:04:45,183
Just absolutely,

136
00:04:45,184 --> 00:04:47,320
for me it kind of
changed, changed

137
00:04:47,320 --> 00:04:49,822
the world a little bit about,
about how I think about,

138
00:04:49,822 --> 00:04:51,991
ya know, how I think
about my own biases,

139
00:04:51,991 --> 00:04:53,626
and how to try to
eliminate those,

140
00:04:53,626 --> 00:04:57,363
when I'm doing things like
threat intelligence analysis.

141
00:04:57,363 --> 00:04:59,932
So, highly recommend
forensics 578.

142
00:04:59,932 --> 00:05:01,434
So,

143
00:05:01,434 --> 00:05:03,236
SSL certificates, we're not
gonna dwell on this too much,

144
00:05:03,236 --> 00:05:05,570
cause you most
likely all know this,

145
00:05:05,571 --> 00:05:07,273
but their small, right,

146
00:05:07,273 --> 00:05:10,009
little artifacts
files, if you will,

147
00:05:10,009 --> 00:05:11,210
that,

148
00:05:11,210 --> 00:05:13,546
bind some details
about an organization

149
00:05:13,546 --> 00:05:14,480
to

150
00:05:14,480 --> 00:05:15,982
something like a subject,

151
00:05:15,982 --> 00:05:19,485
which is usually a common
name is usually like,

152
00:05:19,485 --> 00:05:21,120
a fully qualified domain name.

153
00:05:21,120 --> 00:05:22,889
There's lot's of different
varieties of these things,

154
00:05:22,889 --> 00:05:24,691
they can be self signed certs.

155
00:05:24,691 --> 00:05:26,426
They can be certificates
that are signed

156
00:05:26,426 --> 00:05:29,361
by a publicly trusted
certificate authority,

157
00:05:29,362 --> 00:05:32,298
or issued by a, an organization
certificate authority,

158
00:05:32,298 --> 00:05:35,535
suffice to say, there's
a ton of detail in here,

159
00:05:35,535 --> 00:05:37,637
that we can track, and
use to our advantage,

160
00:05:37,637 --> 00:05:41,808
in the context of cyber
threat intelligence.

161
00:05:41,808 --> 00:05:44,811
- [Ryan] So, what, where
can we get these, right.

162
00:05:44,811 --> 00:05:46,979
Like, you're not gonna
go, and do a right click,

163
00:05:46,979 --> 00:05:48,881
on a certificate lock
every five minutes,

164
00:05:48,881 --> 00:05:50,650
or ask your users, to
do a lot of screenshots,

165
00:05:50,650 --> 00:05:53,019
and since this is
a CTI conference

166
00:05:53,019 --> 00:05:54,253
what we really wanna talk about

167
00:05:54,253 --> 00:05:55,955
are giant repositories
of fricking data, right,

168
00:05:55,955 --> 00:05:57,022
cause that's where you guys

169
00:05:57,023 --> 00:05:58,291
are Pivoting and
Hunting through,

170
00:05:58,291 --> 00:06:00,226
so, the most famous,
the most common one,

171
00:06:00,226 --> 00:06:03,162
the one that Mark talked
a lot about is Censys.io,

172
00:06:03,162 --> 00:06:04,597
it used to be completely free,

173
00:06:04,597 --> 00:06:07,166
they recently went commercial,
wonderful resource.

174
00:06:07,166 --> 00:06:09,369
Dave's gonna go more into
how to get their data,

175
00:06:09,369 --> 00:06:10,403
and things along those lines,

176
00:06:10,403 --> 00:06:11,804
but if you used a free version,

177
00:06:11,804 --> 00:06:14,974
it's kind of, weakly, bi-weekly
scans that are updated,

178
00:06:14,974 --> 00:06:17,909
and you have access to
search through them.

179
00:06:17,910 --> 00:06:20,246
Passive or Circl.lu
is kind of like

180
00:06:20,246 --> 00:06:21,813
the OG in the room for this,

181
00:06:21,814 --> 00:06:23,082
they've been doing
it a long time,

182
00:06:23,082 --> 00:06:24,851
they're pulling SSL
certificate information

183
00:06:24,851 --> 00:06:26,986
passively off their sensors,

184
00:06:26,986 --> 00:06:28,187
Passivetotal,

185
00:06:28,187 --> 00:06:29,355
awesome tool,

186
00:06:29,355 --> 00:06:31,057
aggregation of multiple
different sources,

187
00:06:31,057 --> 00:06:32,925
but you can do a lot of
SSL Pivoting and Hunting

188
00:06:32,925 --> 00:06:34,160
in there as well.

189
00:06:34,160 --> 00:06:35,928
A lot of SOCs use
it, I love the tool,

190
00:06:35,928 --> 00:06:37,864
and finally,

191
00:06:37,864 --> 00:06:39,899
your own analysis platform,

192
00:06:39,899 --> 00:06:40,833
right,

193
00:06:40,833 --> 00:06:42,535
bringing all this SSL data

194
00:06:42,535 --> 00:06:44,871
into your own SSL
analysis platform,

195
00:06:44,871 --> 00:06:46,972
whether you use ELK,
whether you use Splunk,

196
00:06:46,973 --> 00:06:48,941
whether you use SQL, it
doesn't really matter,

197
00:06:48,941 --> 00:06:50,510
a lot of different
reasons for both,

198
00:06:50,510 --> 00:06:51,777
but actually bringing in house,

199
00:06:51,778 --> 00:06:53,646
so, you can do more
advanced analytics.

200
00:06:55,415 --> 00:06:57,683
- [Dave] Okay, so, let's
talk about the data source,

201
00:06:57,683 --> 00:07:00,420
and, and we're gonna
kinda advocate for

202
00:07:00,420 --> 00:07:01,821
the possibility you could create

203
00:07:01,821 --> 00:07:03,790
an analysis platform like this.

204
00:07:03,790 --> 00:07:07,059
The raw materials are
the search results,

205
00:07:07,059 --> 00:07:09,796
at the internet-wide
scan data repository,

206
00:07:09,796 --> 00:07:11,431
it's also known as scans.io,

207
00:07:11,431 --> 00:07:14,534
hosted by the Censys team,
University of Michigan,

208
00:07:14,534 --> 00:07:16,969
that team performs
a lot of scans,

209
00:07:16,969 --> 00:07:18,471
and publishes
those on that site,

210
00:07:18,471 --> 00:07:21,140
there's also a lot of data
published on that site,

211
00:07:21,140 --> 00:07:22,842
that's run by other
organizations,

212
00:07:22,842 --> 00:07:24,477
we can talk about
rapid 7 quite a bit,

213
00:07:24,477 --> 00:07:25,977
here in just a minute,

214
00:07:25,978 --> 00:07:29,582
so, how many people came to
this conference last year?

215
00:07:30,783 --> 00:07:32,051
Kay,

216
00:07:32,051 --> 00:07:34,120
so, I was here last
year, I also spoke,

217
00:07:34,120 --> 00:07:36,322
I'm the guy, last
year, that recommended,

218
00:07:36,322 --> 00:07:38,958
that you violate the
terms of service,

219
00:07:38,958 --> 00:07:42,328
of a major internet site,
and I gave you code to do it,

220
00:07:42,328 --> 00:07:44,063
in case you remember.

221
00:07:44,063 --> 00:07:45,565
So, we're gonna learn from that.

222
00:07:45,565 --> 00:07:48,234
- [Ryan] It's all about
growth, growth as people.

223
00:07:48,234 --> 00:07:52,138
- I'm still employed, and
I still have my CISSP,

224
00:07:52,138 --> 00:07:54,739
by boss showed up this year
to watch over me though.

225
00:07:55,908 --> 00:07:56,909
So,

226
00:07:56,909 --> 00:07:58,110
the data on this site

227
00:07:58,110 --> 00:07:59,545
is restricted to
non-commercial use,

228
00:07:59,545 --> 00:08:01,380
so, make sure, if you're
gonna try any of these things,

229
00:08:01,380 --> 00:08:02,315
that

230
00:08:02,315 --> 00:08:03,549
you are

231
00:08:03,549 --> 00:08:06,118
operating in line
with all the posted

232
00:08:07,587 --> 00:08:11,357
licenses and restrictions
on use, that's all on you,

233
00:08:11,357 --> 00:08:13,559
so, let's talk about
the sonar data.

234
00:08:13,559 --> 00:08:14,494
So,

235
00:08:14,494 --> 00:08:17,597
project Sonar's by Rapid 7 labs,

236
00:08:17,597 --> 00:08:19,298
tremendous

237
00:08:19,298 --> 00:08:20,132
value

238
00:08:20,132 --> 00:08:21,400
to the community,

239
00:08:21,400 --> 00:08:22,667
that they're, that
they're providing,

240
00:08:22,668 --> 00:08:24,403
they run a lot of
different studies,

241
00:08:24,403 --> 00:08:26,172
studies like a type of a scan,

242
00:08:26,172 --> 00:08:28,674
one that we're gonna
talk a lot about

243
00:08:28,674 --> 00:08:30,476
is the SSL certificate study.

244
00:08:32,410 --> 00:08:33,945
we also pull in HTTPS

245
00:08:33,946 --> 00:08:37,483
study as well, and do some
interesting things with that,

246
00:08:37,482 --> 00:08:39,684
that one's cool,
because it actually

247
00:08:39,684 --> 00:08:42,188
pulled down payload
from port 443 on

248
00:08:42,188 --> 00:08:44,557
every IPv4 address
on the internet.

249
00:08:44,557 --> 00:08:48,027
They have all kinds of
other studies as well,

250
00:08:48,027 --> 00:08:49,295
that you can check out,

251
00:08:49,295 --> 00:08:52,497
that's, they have a
separate license .

252
00:08:52,498 --> 00:08:53,966
So, to my earlier point,

253
00:08:53,966 --> 00:08:56,769
make sure that you're
doing everything, in, in,

254
00:08:56,769 --> 00:09:00,006
ya know, concert with
the posted license,

255
00:09:00,006 --> 00:09:01,107
and terms of service,

256
00:09:01,107 --> 00:09:02,675
and a big thanks to Rapid 7,

257
00:09:02,675 --> 00:09:05,444
we wouldn't have any of
this, if not for them.

258
00:09:05,444 --> 00:09:06,378
So,

259
00:09:06,379 --> 00:09:08,180
the SSL certificate study,

260
00:09:08,180 --> 00:09:12,852
sonar.ssl, if you're
accessing it programatically,

261
00:09:12,852 --> 00:09:14,053
goes back to

262
00:09:14,053 --> 00:09:15,555
2013,

263
00:09:15,555 --> 00:09:17,022
it's

264
00:09:17,023 --> 00:09:18,157
fairly,

265
00:09:18,157 --> 00:09:20,760
it's big, 315
gigabytes compressed,

266
00:09:20,760 --> 00:09:23,194
like when I pulled it
down a few weeks ago,

267
00:09:23,195 --> 00:09:24,430
but

268
00:09:24,430 --> 00:09:26,899
315 gigs is, is, is
reasonable, right,

269
00:09:26,899 --> 00:09:28,067
it, it can be done,

270
00:09:28,067 --> 00:09:31,270
grows a couple gigabytes a week,

271
00:09:31,270 --> 00:09:32,972
compressed

272
00:09:32,972 --> 00:09:33,839
we

273
00:09:33,839 --> 00:09:35,107
indexed it into Splunk.

274
00:09:35,107 --> 00:09:37,009
We work at Splunk, so we
Splunk for the platform,

275
00:09:37,009 --> 00:09:39,478
but you could do these
things in any platform,

276
00:09:39,478 --> 00:09:41,479
but it's about 1.2 Terabytes,

277
00:09:41,480 --> 00:09:45,251
once we sort of expand it,
decompress it, and enrich it,

278
00:09:45,251 --> 00:09:47,887
a little bit, with
some of Mark's scripts.

279
00:09:47,887 --> 00:09:51,122
The key things in this
study, that we're looking at

280
00:09:51,123 --> 00:09:52,325
is

281
00:09:52,325 --> 00:09:53,626
first of all, the
observed certificate,

282
00:09:53,626 --> 00:09:55,627
so, every certificate
that's been observed,

283
00:09:55,628 --> 00:09:57,630
as part of the study.

284
00:09:57,630 --> 00:09:58,464
Also,

285
00:09:58,464 --> 00:09:59,832
a list of IP addresses,

286
00:09:59,832 --> 00:10:03,035
and time stamps of
when they were seen,

287
00:10:03,035 --> 00:10:04,770
and on what IP address.

288
00:10:04,770 --> 00:10:05,972
There's also some other things,

289
00:10:05,972 --> 00:10:07,239
that are distributed
with that study,

290
00:10:07,239 --> 00:10:09,308
we won't talk too much
about those right now.

291
00:10:09,308 --> 00:10:13,512
So, this is after we sort of
index all this data, right,

292
00:10:13,512 --> 00:10:17,382
this history of SSL
certificates, TLS certificates,

293
00:10:17,383 --> 00:10:18,918
you can pull those up,

294
00:10:18,918 --> 00:10:21,320
and it's really actually
quite interesting

295
00:10:21,320 --> 00:10:22,221
just to

296
00:10:22,221 --> 00:10:23,322
sort of browse the data,

297
00:10:23,322 --> 00:10:25,758
this is what a
certificate looks like,

298
00:10:25,758 --> 00:10:27,293
it's got ya know,
the extensions,

299
00:10:27,293 --> 00:10:29,228
and the public key, and the,

300
00:10:29,228 --> 00:10:31,097
the issuer and the subject,

301
00:10:31,097 --> 00:10:33,499
and all the things you'd
expect to see there.

302
00:10:36,168 --> 00:10:38,037
One thing that actually
that, that Mark

303
00:10:38,037 --> 00:10:40,072
put a lot of effort into is

304
00:10:40,072 --> 00:10:41,774
we're kind of looking
through some of his code

305
00:10:41,774 --> 00:10:44,877
was tracking first seen
and last seen data,

306
00:10:44,877 --> 00:10:46,344
very, very useful,

307
00:10:46,345 --> 00:10:49,649
aside from all the other
stuff we're gonna talk about,

308
00:10:49,649 --> 00:10:52,051
if all you do is sort
of gain the ability,

309
00:10:52,051 --> 00:10:53,786
to, to see when a certificate

310
00:10:53,786 --> 00:10:56,821
was starting to be used,
and when it was stopped,

311
00:10:56,822 --> 00:10:58,324
your last, last use,

312
00:10:58,324 --> 00:11:02,428
and know what IP addresses,
that's a super valuable,

313
00:11:03,529 --> 00:11:06,064
it's just a very
valuable use of this,

314
00:11:06,065 --> 00:11:07,533
and we'll show you, some,

315
00:11:07,533 --> 00:11:10,469
some sort of concrete examples
of that, in just a second.

316
00:11:10,469 --> 00:11:11,937
- So, those are,
that's the data,

317
00:11:11,937 --> 00:11:13,673
those are things
where you can store,

318
00:11:13,673 --> 00:11:15,074
that's how you can play with it,

319
00:11:15,074 --> 00:11:17,108
but what can you actually
do with it, right?

320
00:11:17,109 --> 00:11:20,813
I like to break it down
in known and unknowns,

321
00:11:20,813 --> 00:11:22,348
right, there's two
things you can really do

322
00:11:22,348 --> 00:11:24,150
with SSL data, as
far as I'm concerned,

323
00:11:24,150 --> 00:11:25,418
and there maybe more,
but these are the two,

324
00:11:25,418 --> 00:11:27,753
I'm aware of, or I
like to talk about.

325
00:11:27,753 --> 00:11:29,689
The first is when you're
hunting down an incident,

326
00:11:29,689 --> 00:11:31,156
when you have a problem,

327
00:11:31,157 --> 00:11:32,458
when you have something
going on in your SOC, right,

328
00:11:32,458 --> 00:11:34,126
and you have malware,
you have something

329
00:11:34,126 --> 00:11:35,661
that's connected to

330
00:11:35,661 --> 00:11:38,363
external website
that has an SSL cert,

331
00:11:38,364 --> 00:11:41,000
and you get the SHA-1
hash of that, right,

332
00:11:41,000 --> 00:11:43,202
now, we're bender, so,
we don't necessarily

333
00:11:43,202 --> 00:11:44,670
have your data, your
real world data.

334
00:11:44,670 --> 00:11:46,472
So, we're gonna mock
that up a little bit.

335
00:11:46,472 --> 00:11:50,376
We're gonna use the SSL
BL, so, the SSL black list,

336
00:11:50,376 --> 00:11:51,644
published by abuse.ch,

337
00:11:51,644 --> 00:11:53,179
will show up some links earlier,

338
00:11:53,179 --> 00:11:55,481
and you can think of this as
just an open source repository,

339
00:11:55,481 --> 00:11:58,718
of SSL's certs have been
seen to do naughty stuff,

340
00:11:58,718 --> 00:12:02,353
and although we're not gonna
cover ACT or SAT at all

341
00:12:02,354 --> 00:12:04,557
today, in our talk
for once, first time,

342
00:12:04,557 --> 00:12:06,826
well, we will talk
about our biases here,

343
00:12:06,826 --> 00:12:09,328
and you need to be aware of
the bias of this black list,

344
00:12:09,328 --> 00:12:11,564
it's almost all
crimeware, right.

345
00:12:11,564 --> 00:12:13,833
A lot of you don't
care about crimeware,

346
00:12:13,833 --> 00:12:15,367
you're dealing
with nation states,

347
00:12:15,367 --> 00:12:17,036
but if you use this list,
just be cognizant of that,

348
00:12:17,036 --> 00:12:18,237
it'll make much more sense here,

349
00:12:18,237 --> 00:12:19,738
when we get to the
machine learning part.

350
00:12:19,739 --> 00:12:22,408
So, I'm gonna pull out one
of SHA-1 hashes, right,

351
00:12:22,408 --> 00:12:24,210
Gozi Trojan, which
nothing really special,

352
00:12:24,210 --> 00:12:25,911
pretty typical little trojan,

353
00:12:25,911 --> 00:12:27,946
but it does
communicate over SSL,

354
00:12:27,947 --> 00:12:31,317
for it's command and
control in xfilt.

355
00:12:31,317 --> 00:12:32,785
So, I take that SHA-1 hash,

356
00:12:32,785 --> 00:12:35,320
and I go ahead, and do a search
in our analysis platform,

357
00:12:35,321 --> 00:12:36,589
right, and you can
do similar in Censys,

358
00:12:36,589 --> 00:12:38,758
if you pay for the
upgraded access,

359
00:12:38,758 --> 00:12:40,826
you can get more historical,
but in this case,

360
00:12:40,826 --> 00:12:42,495
we're gonna search
through all three years,

361
00:12:42,495 --> 00:12:44,497
against 160 million
certificates,

362
00:12:44,497 --> 00:12:46,365
and see what comes up, right,

363
00:12:46,365 --> 00:12:48,033
and immediately I see
a couple of results,

364
00:12:48,033 --> 00:12:50,870
47 things pop up, so,
that's pretty interesting,

365
00:12:50,870 --> 00:12:51,637
enhance,

366
00:12:52,972 --> 00:12:54,106
we go in, right,

367
00:12:54,106 --> 00:12:55,540
let's dig a little deeper.

368
00:12:55,541 --> 00:12:57,209
So, using that graph,
we saw earlier,

369
00:12:57,209 --> 00:12:58,176
we can see,

370
00:12:58,177 --> 00:13:00,913
that in between two scan cycles,

371
00:13:00,913 --> 00:13:04,116
this SHA-1 cert was
seen 46 other times

372
00:13:04,116 --> 00:13:05,651
on 46 unique IP addresses,

373
00:13:05,651 --> 00:13:09,722
and only during one, one
week or two week period.

374
00:13:09,722 --> 00:13:12,391
Now, as a SOC analyst, as
a TI guy, I look at this,

375
00:13:12,391 --> 00:13:13,892
and this pretty damn
suspicious, right,

376
00:13:13,893 --> 00:13:16,896
you have a cert, and it's
only seen for one time, ever,

377
00:13:16,896 --> 00:13:19,430
it comes up immediately
all on the same day,

378
00:13:19,431 --> 00:13:23,235
for 47 different IP
addresses, and then goes away,

379
00:13:23,235 --> 00:13:24,904
right, your spidy
sense is tingling,

380
00:13:24,904 --> 00:13:26,138
if you're in the middle
of investigation,

381
00:13:26,138 --> 00:13:27,907
you're adding this,
you're Pivoting,

382
00:13:27,907 --> 00:13:29,141
you're putting this in MutltiGo,

383
00:13:29,141 --> 00:13:30,276
and you're blowing
up your graphs,

384
00:13:30,276 --> 00:13:31,310
right,

385
00:13:31,310 --> 00:13:32,578
the second used case,

386
00:13:32,578 --> 00:13:34,180
we always have to go
back to Cybersfeld,

387
00:13:34,180 --> 00:13:35,680
Donald Cybersfeld,
right, the known

388
00:13:35,681 --> 00:13:37,349
unknowns in hunting for there.

389
00:13:37,349 --> 00:13:39,351
So, we wanna find
stuff where we know,

390
00:13:39,351 --> 00:13:41,420
that bad people live in a place,

391
00:13:41,420 --> 00:13:42,988
how do we go hunt them down.

392
00:13:42,988 --> 00:13:46,358
In this case, we wanna go
hunt down bad TLS information,

393
00:13:46,358 --> 00:13:48,194
but we have to
start with a focus,

394
00:13:48,194 --> 00:13:49,562
so, we're gonna hunt,

395
00:13:49,562 --> 00:13:50,963
we're gonna pick on PowerShell
Empire a little bit,

396
00:13:50,963 --> 00:13:52,397
and I got really interested
in PowerShell Empire

397
00:13:52,398 --> 00:13:54,300
awhile ago, after working
through an incident,

398
00:13:54,300 --> 00:13:56,801
for those of you not familiar
with PowerShell Empire,

399
00:13:56,802 --> 00:13:58,337
a very bad explanation of it,

400
00:13:58,337 --> 00:14:01,207
it's kind of like
Metasploit and PowerShell,

401
00:14:01,207 --> 00:14:02,074
but

402
00:14:02,074 --> 00:14:03,007
it's fun stuff.

403
00:14:03,008 --> 00:14:04,543
It's fire lists, it runs,

404
00:14:04,543 --> 00:14:06,579
it's very heavily used
by some adversaries,

405
00:14:06,579 --> 00:14:08,981
a lot of crimeware at
script kiddie red teams,

406
00:14:08,981 --> 00:14:10,216
but

407
00:14:10,216 --> 00:14:11,016
the neat thing about
PowerShell Empire,

408
00:14:11,016 --> 00:14:12,450
it's all in GitHub,

409
00:14:12,451 --> 00:14:13,385
a very nice gentleman
created this out of Seattle,

410
00:14:13,385 --> 00:14:14,787
and you can go look at the code,

411
00:14:14,787 --> 00:14:15,955
and if your reverse the code,

412
00:14:15,955 --> 00:14:18,057
right, and actually
look into it,

413
00:14:18,057 --> 00:14:19,859
you see a very interesting fact,

414
00:14:19,859 --> 00:14:21,093
one

415
00:14:21,093 --> 00:14:22,228
is that you can run
PowerShell Empire

416
00:14:22,228 --> 00:14:24,896
with SSL encryption by default,

417
00:14:24,897 --> 00:14:26,365
now most people
like me are lazy.

418
00:14:26,365 --> 00:14:28,267
So, a lot people just
turn on that SSL switch,

419
00:14:28,267 --> 00:14:32,004
and then their PowerShell
Empire in encrypt with SSL,

420
00:14:32,004 --> 00:14:34,373
what they don't look at,
and what they don't realize

421
00:14:34,373 --> 00:14:36,775
is all their doing is
running an SSL certificate

422
00:14:36,775 --> 00:14:38,077
generation with open SSL,

423
00:14:38,077 --> 00:14:40,646
and it has meta data
hard coded in there,

424
00:14:40,646 --> 00:14:42,046
that you can start Pivoting on,

425
00:14:42,047 --> 00:14:43,549
the primary being one,

426
00:14:43,549 --> 00:14:45,483
that certificate is only
gonna be up for one year,

427
00:14:45,484 --> 00:14:48,754
and then two, it has a
subject of C equals US,

428
00:14:48,754 --> 00:14:49,788
which is a little weird,

429
00:14:49,788 --> 00:14:51,423
when you dig in a little bit,

430
00:14:51,423 --> 00:14:53,726
and you look at what a
normal certificate is,

431
00:14:53,726 --> 00:14:56,262
so, on the left and right
is Splunk certificate,

432
00:14:56,262 --> 00:14:59,632
and on the right left are
one of those directions,

433
00:14:59,632 --> 00:15:00,833
you have Google on one side,

434
00:15:00,833 --> 00:15:02,767
and Splunk on the
other, how bout that,

435
00:15:02,768 --> 00:15:04,703
and those are legitimate
SSL certificates,

436
00:15:04,703 --> 00:15:06,071
that I've broken down
into visual form.

437
00:15:06,071 --> 00:15:08,874
Now, the anaylist is
immediately drawn to the fact,

438
00:15:08,874 --> 00:15:11,644
that one of these is not
like the other, right.

439
00:15:11,644 --> 00:15:13,479
So, let's do more
analysis on that,

440
00:15:13,479 --> 00:15:16,015
how can we find more
things like that?

441
00:15:16,015 --> 00:15:19,184
So, I'm gonna do a search here
using our analysis platform,

442
00:15:19,184 --> 00:15:21,687
and basically, the gobbly
gook up there just says

443
00:15:21,687 --> 00:15:25,090
find me everything that
has a certificate of C=US,

444
00:15:25,090 --> 00:15:26,025
and nothing else, right,

445
00:15:26,025 --> 00:15:27,860
cause we saw that earlier.

446
00:15:27,860 --> 00:15:30,763
Two, I wanna see if the website
has returned the value of

447
00:15:30,763 --> 00:15:31,764
Microsoft

448
00:15:31,764 --> 00:15:32,598
IIS

449
00:15:32,598 --> 00:15:33,531
7.5,

450
00:15:33,532 --> 00:15:34,733
remember Dave talked earlier,

451
00:15:34,733 --> 00:15:35,901
there's a Sonar
study, that actually

452
00:15:35,901 --> 00:15:37,569
pulls back that information.

453
00:15:37,569 --> 00:15:39,003
So, what we're looking here for

454
00:15:39,004 --> 00:15:40,406
is a combination of
these two things,

455
00:15:40,406 --> 00:15:42,308
and a pullback 245 events.

456
00:15:42,308 --> 00:15:45,277
Now, one of the reasons I'm
really interested in this,

457
00:15:45,277 --> 00:15:46,211
is

458
00:15:46,211 --> 00:15:47,746
PowerShell Empire primarily runs

459
00:15:47,746 --> 00:15:48,579
on

460
00:15:48,580 --> 00:15:49,815
Linux,

461
00:15:49,815 --> 00:15:51,450
but it has a web server
that returns a value,

462
00:15:51,450 --> 00:15:53,619
after a git request of IIS

463
00:15:53,619 --> 00:15:54,453
7.5,

464
00:15:55,387 --> 00:15:56,921
tres suspicious,

465
00:15:56,922 --> 00:15:57,756
so,

466
00:15:57,756 --> 00:15:58,589
let's dig in,

467
00:15:58,590 --> 00:15:59,858
enhance,

468
00:15:59,858 --> 00:16:01,260
run a quick script here
doing an OS fingerprint

469
00:16:01,260 --> 00:16:03,128
against these IP addresses,

470
00:16:03,128 --> 00:16:04,763
and we find out the one's
that are up and available,

471
00:16:04,763 --> 00:16:07,399
every single one of them
is either running Linux,

472
00:16:07,399 --> 00:16:10,269
or for some reason FortiGate,
a next gen firewall,

473
00:16:10,269 --> 00:16:12,538
right, so, let's discard
the next gen firewall stuff,

474
00:16:12,538 --> 00:16:13,806
I'm, I'm okay with that,

475
00:16:13,806 --> 00:16:15,674
we're just gonna dig
a little bit deeper.

476
00:16:15,674 --> 00:16:17,675
Mark was kind enough to hand
over a script he's used before,

477
00:16:17,676 --> 00:16:19,645
and I made some modifications,

478
00:16:19,645 --> 00:16:21,146
and what we do here is we're

479
00:16:21,146 --> 00:16:23,147
just gonna take all the
IP addresses that were up,

480
00:16:23,148 --> 00:16:25,250
and had Microsoft, as a return,

481
00:16:25,250 --> 00:16:26,618
or sorry, that were Linux,

482
00:16:26,618 --> 00:16:28,654
as we go on through,
went through this,

483
00:16:28,654 --> 00:16:29,855
a lot were down,

484
00:16:29,855 --> 00:16:30,789
cause remember we're
looking through

485
00:16:30,789 --> 00:16:31,723
three years worth of data,

486
00:16:31,724 --> 00:16:33,425
but three ended up coming back.

487
00:16:33,425 --> 00:16:35,661
What's very interesting
about these three

488
00:16:35,661 --> 00:16:37,396
is the first was is a canary,

489
00:16:37,396 --> 00:16:39,064
that I put in, in the very
beginning of the data set,

490
00:16:39,064 --> 00:16:41,333
right, so, that was my tester,

491
00:16:41,333 --> 00:16:44,435
and it came through every
single iteration of my testing,

492
00:16:44,436 --> 00:16:46,372
that IP address came through.

493
00:16:46,372 --> 00:16:49,007
The other two, I can't
prove with a positive,

494
00:16:49,008 --> 00:16:51,010
without going, and ya
know, sending some agents,

495
00:16:51,010 --> 00:16:52,811
but those two really
do appear to be

496
00:16:52,811 --> 00:16:55,014
active PowerShell
Empire on the network

497
00:16:55,014 --> 00:16:56,749
at the time of this
research, right.

498
00:16:56,749 --> 00:16:58,617
I talked to the PowerShell
Empire developers,

499
00:16:58,617 --> 00:17:01,587
very difficult to actually
dig in any further,

500
00:17:01,587 --> 00:17:02,588
but I'm pretty confident,

501
00:17:02,588 --> 00:17:03,856
if I was running
a SOC right now,

502
00:17:03,856 --> 00:17:05,257
those would on a black list.

503
00:17:06,892 --> 00:17:09,461
So, we went from many many
million, which is my map

504
00:17:09,461 --> 00:17:11,463
to three, which is pretty cool

505
00:17:11,463 --> 00:17:13,866
but that was a lot of work,
and that was a lot of research

506
00:17:13,866 --> 00:17:16,568
actually just to understand
a single malware entity,

507
00:17:16,568 --> 00:17:17,836
that I was looking at,

508
00:17:17,836 --> 00:17:18,837
there's other things
that have been done,

509
00:17:18,837 --> 00:17:20,204
for a couple other, like puppy,

510
00:17:20,204 --> 00:17:21,673
I think Mark worked
on for awhile,

511
00:17:21,673 --> 00:17:23,442
and there's other things like
this, that you can dig on,

512
00:17:23,442 --> 00:17:25,411
but damn, it is
hard work, right.

513
00:17:25,411 --> 00:17:26,645
So,

514
00:17:26,645 --> 00:17:28,714
I was told there was AI
in this presentation,

515
00:17:28,714 --> 00:17:30,081
no, but there is ML,

516
00:17:30,082 --> 00:17:33,152
and this why this
is gonna be fun,

517
00:17:33,152 --> 00:17:33,986
but first,

518
00:17:33,986 --> 00:17:35,721
(audience laughs)

519
00:17:35,721 --> 00:17:38,524
I apply what I call the
Al's Pinto bullshit test,

520
00:17:38,524 --> 00:17:40,492
which is whenever I start
thinking machine language

521
00:17:40,492 --> 00:17:43,829
is an answer to
something, is it bullshit?

522
00:17:43,829 --> 00:17:45,664
Right, is it just a
bender coming through

523
00:17:45,664 --> 00:17:47,433
with machine learning that
doesn't actually help,

524
00:17:47,433 --> 00:17:48,801
or solve the problem.

525
00:17:48,801 --> 00:17:51,403
Is it actually machine
learning, or is just statistics,

526
00:17:51,403 --> 00:17:52,671
right, so keep that in mind,

527
00:17:52,671 --> 00:17:54,773
we did actually do a
very rigorous Pinto test

528
00:17:54,773 --> 00:17:57,743
on every iteration of our
analysis and research.

529
00:17:57,743 --> 00:17:59,678
So, we'll go from there.

530
00:18:01,613 --> 00:18:02,881
- And now, you're
leaving it to me,

531
00:18:02,881 --> 00:18:04,016
- Yeah, you're all done,
this is all your stuff.

532
00:18:04,016 --> 00:18:06,385
- Okay, this our
standard, we use Splunk,

533
00:18:06,385 --> 00:18:07,653
but you don't have to,

534
00:18:07,653 --> 00:18:08,887
as we've mentioned a
couple times today,

535
00:18:08,887 --> 00:18:11,490
everything we're
gonna do here is

536
00:18:11,490 --> 00:18:14,193
is really nothing more than
an application of Python

537
00:18:14,193 --> 00:18:15,794
scikit-learn so,

538
00:18:15,794 --> 00:18:16,829
again

539
00:18:16,829 --> 00:18:18,263
you don't,

540
00:18:18,263 --> 00:18:20,331
you can use, Elastic Search,
you can use whatever,

541
00:18:20,332 --> 00:18:22,234
but our examples use Splunk.

542
00:18:24,169 --> 00:18:25,003
Okay,

543
00:18:25,003 --> 00:18:25,838
so,

544
00:18:27,473 --> 00:18:29,241
one of things, that,
that we've done,

545
00:18:29,241 --> 00:18:32,211
we've been lucky enough to
speak at a few of these,

546
00:18:32,211 --> 00:18:34,213
at these conferences
as Ryan mentioned.

547
00:18:34,213 --> 00:18:37,049
We always like to try to
bring things that are,

548
00:18:37,049 --> 00:18:38,484
we feel are useful,

549
00:18:38,484 --> 00:18:42,588
and that are achievable,
right, in most organizations,

550
00:18:42,588 --> 00:18:43,822
so,

551
00:18:43,822 --> 00:18:45,323
we

552
00:18:45,324 --> 00:18:46,625
decided to apply a little
bit of machine learning to,

553
00:18:46,625 --> 00:18:48,227
to this data that we have,

554
00:18:48,227 --> 00:18:51,096
and we're trying to
achieve a certain outcome,

555
00:18:51,096 --> 00:18:52,664
which we'll share
in just a second,

556
00:18:52,664 --> 00:18:54,466
this is not gonna be
the most advanced,

557
00:18:54,466 --> 00:18:57,803
machine learning application
that you've ever seen,

558
00:18:57,803 --> 00:18:59,705
we think it's an achievable one,

559
00:18:59,705 --> 00:19:01,240
that might be useful
to this audience.

560
00:19:01,240 --> 00:19:02,441
So,

561
00:19:02,441 --> 00:19:03,742
we start with this
SSL blacklist,

562
00:19:03,742 --> 00:19:05,177
Ryan mentioned earlier,

563
00:19:06,345 --> 00:19:08,080
we actually have a
list of, of things,

564
00:19:08,080 --> 00:19:09,615
that at least some
group of people,

565
00:19:09,615 --> 00:19:13,485
who are, are, are somewhat
trusted in some way right,

566
00:19:13,485 --> 00:19:15,219
the people that
publish the black list,

567
00:19:15,220 --> 00:19:19,591
they've said, hey, these
certificates are bad, right,

568
00:19:19,591 --> 00:19:20,926
they're on the black
list for a reason,

569
00:19:20,926 --> 00:19:23,662
and we have a lot of
certificates that aren't, right.

570
00:19:23,662 --> 00:19:26,398
So, we actually start
to have this collection

571
00:19:26,398 --> 00:19:27,966
of labeled data, right,

572
00:19:27,966 --> 00:19:29,967
things that are on this black
list, things that aren't.

573
00:19:29,968 --> 00:19:32,271
So, we started to ask
ourselves this question,

574
00:19:32,271 --> 00:19:34,473
can we build a model
that would predict

575
00:19:34,473 --> 00:19:38,342
inclusion on the black list,
and if we could do that,

576
00:19:38,343 --> 00:19:40,646
more importantly
is that something,

577
00:19:40,646 --> 00:19:43,682
that would actually alert
us to something bad, right,

578
00:19:43,682 --> 00:19:44,950
something that we
didn't know about

579
00:19:44,950 --> 00:19:46,418
before that's valuable to us.

580
00:19:46,418 --> 00:19:48,954
So, we kept this question
extremely simple,

581
00:19:48,954 --> 00:19:52,057
this is our goal, of, of
going through this exercise.

582
00:19:53,058 --> 00:19:54,326
So, we have labeled data,

583
00:19:54,326 --> 00:19:56,562
we can get the black
listed certificates,

584
00:19:56,562 --> 00:19:58,530
we can load that into
our, our platform

585
00:19:58,530 --> 00:20:00,331
as a CSV easily enough.

586
00:20:00,332 --> 00:20:03,702
We have lot's of good
certs, to, to use as well,

587
00:20:03,702 --> 00:20:06,205
we essentially have a
labeled data set, right,

588
00:20:06,205 --> 00:20:07,438
things that are
on the black list,

589
00:20:07,439 --> 00:20:10,342
things that aren't, and
this allows us, right

590
00:20:10,342 --> 00:20:12,711
to start to think about
supervised machine learning.

591
00:20:12,711 --> 00:20:14,246
We have some data
that's labeled.

592
00:20:14,246 --> 00:20:15,847
So, we can divide up that data,

593
00:20:15,847 --> 00:20:18,383
and test, train on half of
it, test on the other half,

594
00:20:18,383 --> 00:20:21,820
and then see if it actually
does something useful for us.

595
00:20:21,820 --> 00:20:23,722
If you follow along at home,

596
00:20:23,722 --> 00:20:26,425
there's some, some searches
on that last page that'll,

597
00:20:26,425 --> 00:20:29,394
that'll help, help you out in
building some of those things,

598
00:20:29,394 --> 00:20:30,729
so,

599
00:20:30,729 --> 00:20:32,097
one of things that we did

600
00:20:32,097 --> 00:20:34,800
starting out extremely
simply, right,

601
00:20:34,800 --> 00:20:36,301
again,

602
00:20:36,301 --> 00:20:39,037
not trying to split the
atom with machine learning,

603
00:20:39,037 --> 00:20:41,473
we're trying to show examples
of how it could be used,

604
00:20:41,473 --> 00:20:42,741
so,

605
00:20:42,741 --> 00:20:44,610
one thing is we started
out with a certificate

606
00:20:44,610 --> 00:20:47,079
on the left hand side, it's
kind of how a human being

607
00:20:47,079 --> 00:20:48,746
might look at that certificate,

608
00:20:48,747 --> 00:20:50,015
it's what I described earlier,

609
00:20:50,015 --> 00:20:52,584
issue or subject,
that sort of thing,

610
00:20:53,685 --> 00:20:54,519
we

611
00:20:54,519 --> 00:20:55,821
decided to extract some

612
00:20:55,821 --> 00:20:58,090
quantitative features
from that, right,

613
00:20:58,090 --> 00:20:59,390
so,

614
00:20:59,391 --> 00:21:02,494
numbers right, instead
of using qualitative,

615
00:21:02,494 --> 00:21:03,695
sort of categorical

616
00:21:04,863 --> 00:21:06,098
variables,

617
00:21:06,098 --> 00:21:07,032
which we could have
used those as well

618
00:21:07,032 --> 00:21:08,934
using ya know, one hot encoding,

619
00:21:08,934 --> 00:21:11,136
and things that,
that more advanced,

620
00:21:11,136 --> 00:21:15,040
through features like that in
supervised machine learning,

621
00:21:15,040 --> 00:21:16,274
we kept it very simple.

622
00:21:16,275 --> 00:21:18,443
So, this is actually
the list of features,

623
00:21:18,443 --> 00:21:21,747
super simple, look at the number
of certificate extensions,

624
00:21:21,747 --> 00:21:24,283
the number of elements
and the issuer,

625
00:21:24,283 --> 00:21:27,485
the number of elements
in the subject,

626
00:21:27,486 --> 00:21:29,655
the length of those things,

627
00:21:29,655 --> 00:21:32,324
the string length of
extensions, issuer and subject,

628
00:21:32,324 --> 00:21:33,759
and then we took
Shannon Entropy,

629
00:21:33,759 --> 00:21:36,928
which is a measurement of
randomness, of the common name,

630
00:21:36,928 --> 00:21:39,264
that's in the subject,

631
00:21:39,264 --> 00:21:40,098
and

632
00:21:40,098 --> 00:21:41,300
and there's some, yeah,

633
00:21:41,300 --> 00:21:42,834
so, again, if you download this,

634
00:21:42,834 --> 00:21:44,369
and wanna follow along at
home, and try this out,

635
00:21:44,369 --> 00:21:45,971
there's some code,
that will help you

636
00:21:45,971 --> 00:21:48,907
generate all those things,
that I just described,

637
00:21:48,907 --> 00:21:50,442
and

638
00:21:50,442 --> 00:21:53,111
ya know, after we sort of
selected those features,

639
00:21:53,111 --> 00:21:54,613
and there's a whole,

640
00:21:54,613 --> 00:21:56,148
like,

641
00:21:56,148 --> 00:21:58,783
we could do a whole talk, on
how to select feature, right,

642
00:21:58,784 --> 00:22:00,052
so, there's,

643
00:22:00,052 --> 00:22:01,887
we could do principle
component analysis,

644
00:22:01,887 --> 00:22:04,589
and we could do, ya
know, all sorts of,

645
00:22:04,589 --> 00:22:06,692
sort of measurement, right of,

646
00:22:06,692 --> 00:22:08,794
of ya know, which
of these features

647
00:22:08,794 --> 00:22:10,996
has the most impact
on the outcome,

648
00:22:10,996 --> 00:22:13,198
we didn't do a ton of that,

649
00:22:13,198 --> 00:22:15,834
but that's where you
would do it, right,

650
00:22:15,834 --> 00:22:17,302
before, before this step,

651
00:22:17,302 --> 00:22:20,004
the next step, selecting
a model, right,

652
00:22:20,005 --> 00:22:22,474
so I mentioned earlier we
use machine learning tool kit

653
00:22:22,474 --> 00:22:24,810
from Splunk, it's a free,
free app from Splunk,

654
00:22:24,810 --> 00:22:28,046
but it's just a wrapper
around Python scikit-learn,

655
00:22:28,046 --> 00:22:30,782
scikit-learn has a
bunch of algorithms

656
00:22:30,782 --> 00:22:35,454
for detecting category, or
doing categorical predictions,

657
00:22:35,454 --> 00:22:37,755
so, on a black list,
not on a black list,

658
00:22:37,756 --> 00:22:39,424
that's a categorical prediction.

659
00:22:39,424 --> 00:22:40,792
So, we ran through all those,

660
00:22:40,792 --> 00:22:43,195
one thing that we were
really interested in

661
00:22:43,195 --> 00:22:45,764
was minimizing
false positive rate,

662
00:22:45,764 --> 00:22:47,933
and of course,
maximizing accuracy,

663
00:22:47,933 --> 00:22:50,669
so, we a couple that
were, or a few that were

664
00:22:50,669 --> 00:22:53,772
pretty close in accuracy, but
one that was a clear winner

665
00:22:53,772 --> 00:22:54,973
in the false positive rate,

666
00:22:54,973 --> 00:22:56,575
and the lowest
false positive rate,

667
00:22:56,575 --> 00:22:59,177
and for the use
cases we had in mind,

668
00:22:59,177 --> 00:23:01,513
we were a lot more worried
about false positives,

669
00:23:01,513 --> 00:23:03,615
than we were about
false negatives.

670
00:23:03,615 --> 00:23:06,518
For, basically, cause we
already have the black list,

671
00:23:06,518 --> 00:23:08,587
which is a list of all
the bad ones, right,

672
00:23:08,587 --> 00:23:09,988
so,

673
00:23:09,988 --> 00:23:12,157
the false negatives weren't
as big of a problem,

674
00:23:12,157 --> 00:23:14,226
for the use cases
we had in mind,

675
00:23:14,226 --> 00:23:16,294
so, this is the one
that we selected,

676
00:23:18,797 --> 00:23:20,432
yeah, this is what
it looks like,

677
00:23:20,432 --> 00:23:22,100
and inside the machine
learning toolkit,

678
00:23:22,100 --> 00:23:23,235
it has some of those metrics,

679
00:23:23,235 --> 00:23:24,770
at the bottom,
they're hard to read,

680
00:23:24,770 --> 00:23:27,372
but they're the ones we just
summarized on the last page,

681
00:23:29,307 --> 00:23:30,542
then we applied the model,

682
00:23:30,542 --> 00:23:33,445
which is an interesting,
an interesting thing,

683
00:23:33,445 --> 00:23:35,013
we're gonna talk about
a couple different ways,

684
00:23:35,013 --> 00:23:37,215
you could use a model like this,

685
00:23:38,383 --> 00:23:39,851
one is

686
00:23:39,851 --> 00:23:42,154
you're basically just
applying it to the corpus,

687
00:23:42,154 --> 00:23:43,655
right, this giant collection

688
00:23:43,655 --> 00:23:45,524
of SSL certificates that we had,

689
00:23:45,524 --> 00:23:49,727
of course, that returns a
huge, huge, result set, right,

690
00:23:49,728 --> 00:23:52,531
and true to form,
it, it did just that,

691
00:23:52,531 --> 00:23:54,132
there was a bunch
of certificates,

692
00:23:54,132 --> 00:23:56,301
that were predicted to
be on the black list,

693
00:23:56,301 --> 00:23:57,535
that, that weren't,

694
00:23:57,536 --> 00:23:58,804
and

695
00:23:58,804 --> 00:24:00,439
if you go back to
our question, right,

696
00:24:00,439 --> 00:24:02,174
can we learn from
something from that,

697
00:24:02,174 --> 00:24:03,108
yeah,

698
00:24:03,108 --> 00:24:05,076
I mean, we can, so if we,

699
00:24:05,076 --> 00:24:07,813
we sort of wrote some,
some scripts to go through,

700
00:24:07,813 --> 00:24:10,382
those certificates
that were predicated

701
00:24:10,382 --> 00:24:11,616
to be on that list that weren't.

702
00:24:11,616 --> 00:24:14,519
We Pivoted to the IP
addresses that we had

703
00:24:14,519 --> 00:24:15,787
from the Sonar data,

704
00:24:15,787 --> 00:24:18,123
and then we just
started looking for

705
00:24:18,123 --> 00:24:19,391
are those IP addresses known,

706
00:24:19,391 --> 00:24:21,259
to some other source
to be bad, right.

707
00:24:21,259 --> 00:24:23,562
Now, this is very
simplistic, right,

708
00:24:23,562 --> 00:24:24,663
we did some

709
00:24:24,663 --> 00:24:27,399
requests against virus total,

710
00:24:27,399 --> 00:24:30,302
and we found a ton
of bad stuff, right,

711
00:24:30,302 --> 00:24:32,536
which sort of led me to believe,

712
00:24:32,537 --> 00:24:33,772
that

713
00:24:33,772 --> 00:24:36,508
this is a viable, right,
this is a simplistic,

714
00:24:36,508 --> 00:24:39,244
but viable way to
sort of meet that,

715
00:24:39,244 --> 00:24:43,048
meet that question that
we asked of ourselves.

716
00:24:43,048 --> 00:24:44,683
So,

717
00:24:44,683 --> 00:24:47,786
there's a couple ways that'd
you'd use this, right,

718
00:24:47,786 --> 00:24:48,987
and we're gonna talk about that,

719
00:24:48,987 --> 00:24:50,722
I think now Ryan's
gonna talk about that.

720
00:24:50,722 --> 00:24:52,157
- [Ryan] So, why do you care?

721
00:24:52,157 --> 00:24:55,327
It's a lot of math mumbo jumbo,
right, and I'll be honest,

722
00:24:56,194 --> 00:24:57,462
I'm a simple boy

723
00:24:57,462 --> 00:24:58,730
from the mountains
of Arizona, right,

724
00:24:58,730 --> 00:25:00,665
and what I'm used to
is vendors coming up

725
00:25:00,665 --> 00:25:02,200
saying, here ye, here ye,

726
00:25:02,200 --> 00:25:04,069
I got the solution for you
right here, I say, I say,

727
00:25:04,069 --> 00:25:06,538
we got the solution, have you
looked at our latest machine

728
00:25:06,538 --> 00:25:07,772
learning toolkit, my god,

729
00:25:07,772 --> 00:25:09,640
it can find all
the cyber hackers,

730
00:25:09,641 --> 00:25:12,344
it find the APTs, it
can find the Turlas,

731
00:25:12,344 --> 00:25:13,812
it can find the satellite

732
00:25:13,812 --> 00:25:15,413
just come over here and sign
our PO, right over here,

733
00:25:15,413 --> 00:25:16,815
with our local sales person,

734
00:25:18,383 --> 00:25:20,552
that's kind of what I seal up,

735
00:25:20,552 --> 00:25:21,986
that's kind of my gut feeling,

736
00:25:21,987 --> 00:25:23,488
being a former customer
and an analyst,

737
00:25:23,488 --> 00:25:25,223
like a lot of the
ML stuff, right

738
00:25:25,223 --> 00:25:26,892
and I'll be honest,
I ain't good at math,

739
00:25:26,892 --> 00:25:28,894
right, that's my first
grade report card.

740
00:25:28,894 --> 00:25:29,828
(Dave laughs)

741
00:25:29,828 --> 00:25:31,196
Mrs. Johnson failed me in math,

742
00:25:31,196 --> 00:25:32,464
how do you fail a first grader,

743
00:25:32,464 --> 00:25:34,533
it's like how many fruit
roll ups do I have, six?

744
00:25:34,533 --> 00:25:36,134
Oh, Mr. Kovar,

745
00:25:36,134 --> 00:25:37,636
so,

746
00:25:37,636 --> 00:25:39,704
it's hard for me, right,
like I struggle with math,

747
00:25:39,704 --> 00:25:41,806
I get the concepts, but
putting one plus two,

748
00:25:41,806 --> 00:25:43,341
I often get six or seven,

749
00:25:43,341 --> 00:25:45,377
or I end with six apples, I
don't really understand it,

750
00:25:45,377 --> 00:25:47,979
but is this approachable for us,

751
00:25:47,979 --> 00:25:49,848
right, can we actually
institute machine learning,

752
00:25:49,848 --> 00:25:52,884
usably, in our network
without really complicated

753
00:25:52,884 --> 00:25:54,319
vendor mumbo jumbo,

754
00:25:54,319 --> 00:25:55,120
or

755
00:25:55,120 --> 00:25:56,053
like I said earlier,

756
00:25:56,054 --> 00:25:57,522
I want take the IEEE papers,

757
00:25:57,522 --> 00:26:00,292
which are incredible, from
about ten years ago, frankly,

758
00:26:00,292 --> 00:26:01,659
and see if I can
actually get 'em working

759
00:26:01,660 --> 00:26:03,962
in today's SOC and
analyst platform.

760
00:26:03,962 --> 00:26:07,499
So, there's two major ways
that I see this working,

761
00:26:07,499 --> 00:26:11,736
right, one machine learning
can add context to your events.

762
00:26:11,736 --> 00:26:15,140
If you ran that model
earlier, right, 4%,

763
00:26:15,140 --> 00:26:18,877
now, we have a 160 million
certificates at our data base,

764
00:26:18,877 --> 00:26:20,879
if we had 4% of those
were false positives,

765
00:26:20,879 --> 00:26:24,582
you will be lynched,
by your SOC team,

766
00:26:24,583 --> 00:26:26,051
right,

767
00:26:26,051 --> 00:26:27,586
and rightfully so, that's
way too many false positives,

768
00:26:27,586 --> 00:26:29,988
it's huge, however, I want
you to change your paradigm,

769
00:26:29,988 --> 00:26:31,222
change the pot a
little bit, right,

770
00:26:31,222 --> 00:26:33,491
you have a PDF,
that's downloaded,

771
00:26:33,491 --> 00:26:35,427
you happen to run
Sysmon or Carbon Black,

772
00:26:35,427 --> 00:26:37,361
that PDF is executed,

773
00:26:37,362 --> 00:26:39,698
and then contacts a brand new
domain for the first time,

774
00:26:39,698 --> 00:26:41,232
well, those two things,

775
00:26:41,232 --> 00:26:43,501
first of a PDF, I hate, so,
I'm immediately suspicious,

776
00:26:43,501 --> 00:26:46,237
two, a PDF that goes
off, and pulls something

777
00:26:46,237 --> 00:26:48,907
from a foreign domain or
different domain, that's weird,

778
00:26:48,907 --> 00:26:51,176
and then a new domain,
that's super odd.

779
00:26:51,176 --> 00:26:53,110
Now, if you've been
applying the model,

780
00:26:53,111 --> 00:26:54,379
that Dave just talked about,

781
00:26:54,379 --> 00:26:56,680
and you have the machine
learning model on there,

782
00:26:56,681 --> 00:26:57,983
that says hey, and by the way,

783
00:26:57,983 --> 00:27:00,018
that was an SSL
encrypted session,

784
00:27:00,018 --> 00:27:03,421
and that certificate really
matches our model for badness,

785
00:27:03,421 --> 00:27:06,157
you're gonna set your
mulers on, right,

786
00:27:06,157 --> 00:27:07,692
you're gonna start
your investigatoin,

787
00:27:07,692 --> 00:27:10,161
you should be
interested in that.

788
00:27:10,161 --> 00:27:11,296
- [Dave] That's muller.

789
00:27:11,296 --> 00:27:12,664
- That's Muller,
meuler, muller, meuler,

790
00:27:12,664 --> 00:27:15,367
okay, let's mull over
that for a second,

791
00:27:15,367 --> 00:27:16,635
while we go to my next slide.

792
00:27:16,635 --> 00:27:17,702
(Dave laughs)

793
00:27:17,702 --> 00:27:18,536
Boom,

794
00:27:18,536 --> 00:27:19,771
alright,

795
00:27:19,771 --> 00:27:21,473
this is a cyber threat
intelligent conference,

796
00:27:21,473 --> 00:27:23,808
not a computer network
defense conference,

797
00:27:23,808 --> 00:27:24,976
so, I want you to think about it

798
00:27:24,976 --> 00:27:26,611
in a different
approach once again.

799
00:27:26,611 --> 00:27:30,415
We don't have a corpus of
AP 28 SSL certificates,

800
00:27:30,415 --> 00:27:31,916
but many of you probably do,

801
00:27:31,916 --> 00:27:33,618
whether you know
it or not, frankly,

802
00:27:33,618 --> 00:27:35,754
but you may have that
corpus in your network,

803
00:27:35,754 --> 00:27:37,254
or you already have a
whole bunch of things

804
00:27:37,255 --> 00:27:38,690
you can pull.

805
00:27:38,690 --> 00:27:40,925
So, imagine a world
where you create a model,

806
00:27:40,925 --> 00:27:43,395
not based on a
crimeware black list,

807
00:27:43,395 --> 00:27:46,331
which is gonna have inherent
biases towards crimeware,

808
00:27:46,331 --> 00:27:48,099
but instead create a model,

809
00:27:48,099 --> 00:27:51,535
that's geared towards an actor
that you're following, right,

810
00:27:51,536 --> 00:27:54,639
and suddenly, you
go from 160 million

811
00:27:57,709 --> 00:28:00,745
to finding the bears in your
network much easier, right,

812
00:28:00,745 --> 00:28:02,781
I'm not gonna say, I'm
not gonna stand up here,

813
00:28:02,781 --> 00:28:05,250
and sell you cyber
snake oil, right,

814
00:28:05,250 --> 00:28:08,053
machine learning doesn't
solve with problem with cyber,

815
00:28:08,053 --> 00:28:09,487
but it can really help you

816
00:28:09,487 --> 00:28:10,989
find the bears in
your network faster

817
00:28:10,989 --> 00:28:12,257
than you may have before,

818
00:28:12,257 --> 00:28:14,759
if you can go from 160
million to 8 million,

819
00:28:14,759 --> 00:28:17,462
and then start applying
different analytical trade craft

820
00:28:17,462 --> 00:28:18,897
to that smaller data set,

821
00:28:18,897 --> 00:28:20,532
you're gonna be way
better off than you were,

822
00:28:20,532 --> 00:28:21,765
when you started the day,

823
00:28:23,368 --> 00:28:24,202
oh,

824
00:28:24,202 --> 00:28:25,136
one more thing.

825
00:28:25,136 --> 00:28:27,038
- [Dave] Just one more thing.

826
00:28:27,038 --> 00:28:28,273
So,

827
00:28:28,273 --> 00:28:30,574
if you wanna build
any of these things,

828
00:28:30,575 --> 00:28:32,110
that we're showing you today,

829
00:28:32,110 --> 00:28:34,344
so, that first link is, is
a link to a presentation,

830
00:28:34,345 --> 00:28:35,814
it's a variant of this one,

831
00:28:35,814 --> 00:28:37,315
but it has a ton more
about the plumbing,

832
00:28:37,315 --> 00:28:40,285
like this is how many
servers you might need,

833
00:28:40,285 --> 00:28:42,053
this is how you run
the code to download,

834
00:28:42,053 --> 00:28:45,924
ya know, download the studies,
and that sort of thing,

835
00:28:47,759 --> 00:28:48,960
the second link here

836
00:28:50,428 --> 00:28:51,896
is

837
00:28:51,896 --> 00:28:52,897
the code that will help
you do a lot of that stuff,

838
00:28:52,897 --> 00:28:54,064
there's

839
00:28:54,065 --> 00:28:55,300
gives you the
ability to download,

840
00:28:55,300 --> 00:28:58,837
download the studies,
which I think is useful,

841
00:28:58,837 --> 00:29:01,473
or even to sort of
explore the size of them,

842
00:29:01,473 --> 00:29:02,974
and things like
that for planning

843
00:29:02,974 --> 00:29:05,376
the bottom link there is a
link to some code from Mark,

844
00:29:05,376 --> 00:29:08,079
that, that we
borrowed from heavily

845
00:29:08,079 --> 00:29:11,116
with permission,
thank goodness, so.

846
00:29:11,116 --> 00:29:12,450
- [Ryan] Held off those
terms of service, baby,

847
00:29:12,450 --> 00:29:13,384
- That's right.

848
00:29:13,384 --> 00:29:14,486
- [Ryan] Legals a service.

849
00:29:15,754 --> 00:29:16,687
- So, check those out,

850
00:29:16,688 --> 00:29:18,323
good resources, hopefully.

851
00:29:18,323 --> 00:29:22,827
- [Ryan] Okay, let's
wrap this up, alright,

852
00:29:22,827 --> 00:29:24,062
conclusion,

853
00:29:24,062 --> 00:29:26,331
I really hope you guys
come away from this,

854
00:29:26,331 --> 00:29:27,564
we had a lot of you stand,

855
00:29:27,565 --> 00:29:29,000
and said yes we know
what SSL Pivoting is,

856
00:29:29,000 --> 00:29:30,835
go forth and do so, right,

857
00:29:30,835 --> 00:29:33,404
look last years
presentation that Mark did,

858
00:29:33,404 --> 00:29:35,540
it really opened my eyes,
it'll open your eyes,

859
00:29:35,540 --> 00:29:37,207
and then take it
to the next level,

860
00:29:37,208 --> 00:29:38,309
and say how can
we automate this,

861
00:29:38,309 --> 00:29:39,577
how can we find things,

862
00:29:39,577 --> 00:29:41,312
that we've never
looked for before,

863
00:29:41,312 --> 00:29:43,380
right, don't be afraid
of the unknowns,

864
00:29:43,381 --> 00:29:46,351
like we're, at least I
personally, we talked earlier

865
00:29:46,351 --> 00:29:48,286
about kind of lazy, we
had the horrible image

866
00:29:48,286 --> 00:29:49,521
that Rick showed, right,

867
00:29:49,521 --> 00:29:52,157
I get lazy, and I
just do the same way

868
00:29:52,157 --> 00:29:54,826
of finding adversaries every
day of the week, right,

869
00:29:54,826 --> 00:29:56,494
look at it from a
different angle,

870
00:29:56,494 --> 00:29:58,295
where you know nothing, and
you have a giant canvas,

871
00:29:58,296 --> 00:30:00,064
and you have to start
picking things through,

872
00:30:00,064 --> 00:30:02,500
do that research ahead of time,
and start looking through,

873
00:30:02,500 --> 00:30:04,869
and finally don't be
scared of machine learning

874
00:30:04,869 --> 00:30:06,404
to reduce that data set,

875
00:30:06,404 --> 00:30:08,373
it is not going to always
find the problem for you,

876
00:30:08,373 --> 00:30:09,574
and if it does,

877
00:30:09,574 --> 00:30:10,875
it's probably the wrong
question you asked,

878
00:30:10,875 --> 00:30:12,277
and has probably given
you the wrong answer,

879
00:30:12,277 --> 00:30:14,512
at least that's my
mathematical abilities for it,

880
00:30:14,512 --> 00:30:16,214
but you can do that,

881
00:30:16,214 --> 00:30:19,250
and you can really help
yourself out and your org.

882
00:30:19,250 --> 00:30:21,286
Special thanks,
obviously, Mark Parsons,

883
00:30:21,286 --> 00:30:23,521
IKBD, Rapid 7, we
couldn't do any of this

884
00:30:23,521 --> 00:30:25,322
without their data,
and their niceness,

885
00:30:25,323 --> 00:30:26,424
with their licensing,

886
00:30:26,424 --> 00:30:27,926
Censys team at
University of Michigan,

887
00:30:27,926 --> 00:30:30,762
and special call out to John
Lankau and Lauren Deason,

888
00:30:30,762 --> 00:30:33,063
John acted as our SOC analyst,

889
00:30:33,064 --> 00:30:35,033
and Lauren was the data
scientist in a box,

890
00:30:35,033 --> 00:30:36,801
who said, hey, you're
probably not gonna make a fool

891
00:30:36,801 --> 00:30:38,269
out of yourselves
if you say this.

892
00:30:38,269 --> 00:30:39,771
- [Dave] Too late.

893
00:30:39,771 --> 00:30:41,039
- [Ryan] Oh, well, should
have said that first,

894
00:30:41,039 --> 00:30:42,674
but it was very nice
of 'em to actually

895
00:30:42,674 --> 00:30:43,641
sit through our presentation,

896
00:30:43,641 --> 00:30:44,876
and give us some critiques.

897
00:30:44,876 --> 00:30:46,077
I'm Ryan Kovar.

898
00:30:46,077 --> 00:30:47,312
- [Dave] I'm Dave.

899
00:30:47,312 --> 00:30:48,478
- [Ryan] And thank
you very much.

900
00:30:48,479 --> 00:30:51,182
(audience claps)

901
00:30:52,317 --> 00:30:54,953
(intense music)

