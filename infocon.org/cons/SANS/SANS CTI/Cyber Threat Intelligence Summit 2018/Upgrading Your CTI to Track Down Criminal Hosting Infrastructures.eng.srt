1
00:00:00,600 --> 00:00:02,502
(light music)

2
00:00:09,843 --> 00:00:12,946
(audience clapping)

3
00:00:12,946 --> 00:00:15,115
- This talk actually is
about how can we move

4
00:00:15,115 --> 00:00:17,217
from the reactive
chasing of IOCs

5
00:00:17,217 --> 00:00:19,586
into a more proactive approach

6
00:00:19,586 --> 00:00:21,755
and understand how the
bad guys are operating

7
00:00:21,755 --> 00:00:23,355
behind the scenes.

8
00:00:23,356 --> 00:00:25,525
I'm gonna start backwards.

9
00:00:25,525 --> 00:00:27,593
I'm gonna propose
some takeaways,

10
00:00:27,594 --> 00:00:30,463
and you need to
hold me accountable.

11
00:00:30,463 --> 00:00:31,965
Will you learn these
things at the end?

12
00:00:31,965 --> 00:00:35,535
If not, then you'll have
to press with questions.

13
00:00:35,535 --> 00:00:37,736
The first one, we want
to learn something

14
00:00:37,737 --> 00:00:39,939
about the business model that
bulletproof hosting providers.

15
00:00:39,939 --> 00:00:41,341
I'll explain what that is.

16
00:00:41,341 --> 00:00:43,176
And then I'm gonna
propose a taxonomy

17
00:00:43,176 --> 00:00:45,478
for BPH operations.

18
00:00:45,478 --> 00:00:46,746
And then we're gonna look

19
00:00:46,746 --> 00:00:48,615
into the bulletproof
hosting providers

20
00:00:48,615 --> 00:00:51,151
behind the current
malspam campaigns

21
00:00:51,151 --> 00:00:53,520
that I'm sure a lot
of us are chasing.

22
00:00:53,520 --> 00:00:55,889
Finally I'm gonna propose
some repeatable techniques

23
00:00:55,889 --> 00:00:59,526
and signals that can help you
track these BPH operations

24
00:00:59,526 --> 00:01:02,195
as well as some current
malware campaigns.

25
00:01:04,297 --> 00:01:06,298
Some of you know me,
some of you don't.

26
00:01:06,299 --> 00:01:08,401
I'm @DhiaLite on Twitter.

27
00:01:08,401 --> 00:01:10,136
I'm the head of
Security Research

28
00:01:10,136 --> 00:01:12,905
at Cisco Umbrella,
formerly OpenDNS.

29
00:01:12,906 --> 00:01:17,010
My background is network
security, network
traffic analysis.

30
00:01:17,010 --> 00:01:21,781
And then I got a PhD in graph
algorithms at SMU, Dallas,

31
00:01:21,781 --> 00:01:23,583
hence Rick's mentioned there.

32
00:01:23,583 --> 00:01:26,586
I've been in the US
for like 15 years.

33
00:01:26,586 --> 00:01:31,124
At the bottom, you have a hint
of where I'm from originally.

34
00:01:31,124 --> 00:01:33,226
To the left, that's like
one of the finest generals

35
00:01:33,226 --> 00:01:34,494
in ancient history.

36
00:01:34,494 --> 00:01:36,529
He used elephants as a hint.

37
00:01:36,529 --> 00:01:40,100
And then the next two are fine
generals from World War II.

38
00:01:40,100 --> 00:01:42,202
They fought one of
the fiercest battles

39
00:01:42,202 --> 00:01:44,504
on my home country soil.

40
00:01:44,504 --> 00:01:46,206
You must have
figured out already.

41
00:01:48,908 --> 00:01:52,745
Here is like a
typical in a SOC life.

42
00:01:52,745 --> 00:01:54,914
Basically you're
collecting a lot of data,

43
00:01:54,914 --> 00:01:56,883
some of it useful,
some of it not.

44
00:01:56,883 --> 00:01:59,419
From your internal network,
your endpoints, firewalls,

45
00:01:59,419 --> 00:02:02,387
proxy, a variety
of other devices.

46
00:02:02,388 --> 00:02:05,058
And then you collect a lot of
feeds from external sources,

47
00:02:05,058 --> 00:02:07,894
some of it you pay, some
of it is open source,

48
00:02:07,894 --> 00:02:09,696
some of it is
through some ISACs.

49
00:02:09,696 --> 00:02:11,965
But then you're trying to
make sense out of all of this,

50
00:02:11,965 --> 00:02:14,801
so you pump it into a SIEM
or you build your own,

51
00:02:14,801 --> 00:02:17,237
and then you try to
take advantage of a TIP

52
00:02:17,237 --> 00:02:19,105
to help you enrich and correlate

53
00:02:19,105 --> 00:02:20,773
and make some more sense.

54
00:02:20,773 --> 00:02:22,609
Eventually, hopefully
you can have

55
00:02:22,609 --> 00:02:24,844
some actionable threat intel.

56
00:02:26,179 --> 00:02:28,515
Again, what is threat
intel, to be honest?

57
00:02:28,515 --> 00:02:32,084
It's that insight and
information, post analysis

58
00:02:32,085 --> 00:02:36,022
that can help you make
some good decisions

59
00:02:36,022 --> 00:02:37,923
tied to your requirements
and your needs.

60
00:02:37,924 --> 00:02:39,993
It's not like something off
the shell that you can get.

61
00:02:39,993 --> 00:02:41,528
You have to tie it
to your own needs,

62
00:02:41,528 --> 00:02:43,429
and you have to do some effort

63
00:02:43,429 --> 00:02:44,898
to get the right intel.

64
00:02:44,898 --> 00:02:47,767
This talk is about
how can we move up

65
00:02:47,767 --> 00:02:48,868
from the tactical intel,

66
00:02:48,868 --> 00:02:50,203
which is like chasing IOCs,

67
00:02:50,203 --> 00:02:52,272
pushing them into
enforcement devices.

68
00:02:52,272 --> 00:02:55,475
Try to get some
further understanding
of proactive insight

69
00:02:55,475 --> 00:02:57,177
into what's behind the scenes

70
00:02:57,177 --> 00:02:59,445
in all of these
crime or operations.

71
00:02:59,445 --> 00:03:01,748
Hopefully maybe we can
get some strategic insight

72
00:03:01,748 --> 00:03:04,584
that can help us in the long
term in terms of investments,

73
00:03:04,584 --> 00:03:06,085
how can we grow our teams,

74
00:03:06,085 --> 00:03:09,689
what type of feeds or
collaborations or partnerships

75
00:03:09,689 --> 00:03:11,991
we should do in the long term.

76
00:03:14,360 --> 00:03:15,295
Here it is.

77
00:03:15,295 --> 00:03:16,595
Let's learn about the enemy.

78
00:03:16,596 --> 00:03:20,800
For that, I'm gonna
propose to describe

79
00:03:20,800 --> 00:03:24,537
like the threat intel
production cycle we have

80
00:03:24,537 --> 00:03:26,005
in my research lab.

81
00:03:26,005 --> 00:03:28,174
We start with a requirement
of protecting customers.

82
00:03:28,174 --> 00:03:30,210
This is basically
what everybody does.

83
00:03:30,210 --> 00:03:32,312
We need to find like
some high-fidelity IOCs,

84
00:03:32,312 --> 00:03:34,047
domains and IPs typically.

85
00:03:34,047 --> 00:03:36,382
We start with our
worldwide collection system

86
00:03:36,382 --> 00:03:38,151
of recursive DNS resolvers

87
00:03:38,151 --> 00:03:41,187
but also a variety of
other big data sources.

88
00:03:41,187 --> 00:03:42,655
After that, you have
to do processing.

89
00:03:42,655 --> 00:03:46,659
You have to basically
summarize this data, index it,

90
00:03:46,659 --> 00:03:49,295
and make it searchable,
so you can test hypotheses

91
00:03:49,295 --> 00:03:51,831
and ask questions and
get answers quick.

92
00:03:51,831 --> 00:03:53,232
That's how you can do analysis,

93
00:03:53,233 --> 00:03:56,069
whether it's machine-based
or human-based,

94
00:03:56,069 --> 00:03:59,505
and get deeper into the
investigation you're carrying.

95
00:03:59,505 --> 00:04:02,809
Finally you'd have
to disseminate that
to your customer,

96
00:04:02,809 --> 00:04:04,277
and he will have
to give feedback,

97
00:04:04,277 --> 00:04:06,578
so you know if you're succeeding
and if you're failing.

98
00:04:06,579 --> 00:04:09,048
With that, you can
adjust and adapt.

99
00:04:09,048 --> 00:04:11,618
With our lab, actually we
have done a lot of work

100
00:04:11,618 --> 00:04:14,487
in the analysis phase where
we find a lot of these threats

101
00:04:14,487 --> 00:04:15,622
with different signals.

102
00:04:17,757 --> 00:04:19,959
Now you ask me okay,
why are we talking about

103
00:04:19,959 --> 00:04:22,262
bulletproof hosting and criminal
hosting infrastructures.

104
00:04:22,262 --> 00:04:25,198
It's because practically all
of the threats we see nowadays,

105
00:04:25,198 --> 00:04:28,268
they had to use or they have
to use some sort of hosting.

106
00:04:28,268 --> 00:04:29,902
It's the fundamental technology

107
00:04:29,902 --> 00:04:31,938
that enables everything
around there.

108
00:04:31,938 --> 00:04:33,506
Malware, phishing, dump shops,

109
00:04:33,506 --> 00:04:35,008
crimeware forums, you name it.

110
00:04:36,676 --> 00:04:39,646
In fact, if I step back,
and now I propose a way

111
00:04:39,646 --> 00:04:42,115
to break down the
cyber crime ecosystem,

112
00:04:42,115 --> 00:04:44,517
and you realize that the
offerings in the underground,

113
00:04:44,517 --> 00:04:46,119
they are broken
into three classes.

114
00:04:46,119 --> 00:04:47,387
You have the goods.

115
00:04:47,387 --> 00:04:49,222
Those are your items you
can consume right away.

116
00:04:49,222 --> 00:04:50,890
You can buy and use

117
00:04:50,890 --> 00:04:53,325
like the dumps, the
credentials, the PIIs.

118
00:04:53,326 --> 00:04:54,827
And then you have the products.

119
00:04:54,827 --> 00:04:58,064
These are your tools that allow
you to infect organizations

120
00:04:58,064 --> 00:05:00,133
or individuals at scale.

121
00:05:00,133 --> 00:05:02,335
And then in the middle, you
have like the core technologies

122
00:05:02,335 --> 00:05:05,238
that allow everything else
to exist, your services

123
00:05:05,238 --> 00:05:07,407
such as the ransomware
as a service

124
00:05:07,407 --> 00:05:09,008
or the bulletproof
hosting providers,

125
00:05:09,008 --> 00:05:10,643
which are the
focus of this talk,

126
00:05:13,279 --> 00:05:14,614
hence the definition.

127
00:05:14,614 --> 00:05:16,748
What's a bulletproof
hosting provider?

128
00:05:16,749 --> 00:05:19,919
Simply put, it's a
criminal hosting company

129
00:05:19,919 --> 00:05:22,087
that will shield the
criminal customers

130
00:05:22,088 --> 00:05:25,792
against abuse complaints
and takedown operations.

131
00:05:25,792 --> 00:05:26,758
How do they do that?

132
00:05:26,759 --> 00:05:28,061
We'll see a few hints.

133
00:05:30,296 --> 00:05:33,166
Now actually I want to go back

134
00:05:36,469 --> 00:05:39,472
and describe the spectrum
of hosting space.

135
00:05:39,472 --> 00:05:43,008
You will see that you have
the good stuff to the left.

136
00:05:43,009 --> 00:05:45,812
These are your legit
companies doing hosting.

137
00:05:45,812 --> 00:05:48,014
And then unfortunately
a lot of them get abused

138
00:05:48,014 --> 00:05:49,849
because they don't
have enough staff,

139
00:05:49,849 --> 00:05:53,453
because they have not
defined a clear TOS,

140
00:05:53,453 --> 00:05:55,655
or because they're lax
and they are in countries

141
00:05:55,655 --> 00:05:56,856
that allow this type of thing.

142
00:05:56,856 --> 00:05:59,926
And then finally you
have the pure criminals.

143
00:05:59,926 --> 00:06:01,894
Those are the ones
living in certain areas.

144
00:06:01,894 --> 00:06:03,629
They are leveraging
certain technologies

145
00:06:03,629 --> 00:06:05,431
and certain regulations,

146
00:06:05,431 --> 00:06:07,567
and that allows it to
thrive and to succeed.

147
00:06:07,567 --> 00:06:09,936
That's the topic of
this presentation here.

148
00:06:11,104 --> 00:06:13,705
For that, I want to
propose a taxonomy

149
00:06:13,706 --> 00:06:16,709
that we can all use to
classify bulletproof hosting.

150
00:06:16,709 --> 00:06:18,778
Here, what I'm proposing
is that we have a class

151
00:06:18,778 --> 00:06:21,280
we call botnet-based, I'm
gonna have an example,

152
00:06:21,280 --> 00:06:23,181
and then the other
one is host-based,

153
00:06:23,182 --> 00:06:25,084
and I'm gonna have
an example as well.

154
00:06:26,419 --> 00:06:29,489
Before that, let me
describe the business model.

155
00:06:30,656 --> 00:06:32,725
There is an interesting
recipe we came up with

156
00:06:32,725 --> 00:06:35,561
after doing a few
years of analyses.

157
00:06:35,561 --> 00:06:37,530
We saw that the barrier
of entry is quite low.

158
00:06:37,530 --> 00:06:39,399
You could spend less than $2,000

159
00:06:39,399 --> 00:06:43,236
to come up with a dedicated
bulletproof hosting operation.

160
00:06:43,236 --> 00:06:44,804
You basically have to
register your business

161
00:06:44,804 --> 00:06:46,938
in an offshore country,
I'll describe that,

162
00:06:46,939 --> 00:06:49,609
and then you have to acquire
an autonomous system number,

163
00:06:49,609 --> 00:06:52,378
get some IP space, do
peering relationships,

164
00:06:52,378 --> 00:06:53,780
and then you set
up your website.

165
00:06:53,780 --> 00:06:55,080
You have to bring in customers

166
00:06:55,081 --> 00:06:57,483
so you can have a public site

167
00:06:57,483 --> 00:07:00,119
or you have just the presence
in the underground forums,

168
00:07:00,119 --> 00:07:01,454
whether open or closed

169
00:07:01,454 --> 00:07:04,223
or just stay private
to a VIP clientele,

170
00:07:04,223 --> 00:07:05,391
and then you generate revenue.

171
00:07:05,391 --> 00:07:06,959
People will start using you.

172
00:07:06,959 --> 00:07:08,227
They will host traffic.

173
00:07:08,227 --> 00:07:10,563
They will send spam,
generate bad stuff.

174
00:07:10,563 --> 00:07:12,063
And then if you're
really bulletproof,

175
00:07:12,064 --> 00:07:13,566
you'll be able to handle abuse,

176
00:07:13,566 --> 00:07:16,169
but if not, you'll have to
shut down your operation

177
00:07:16,169 --> 00:07:17,436
and move somewhere else.

178
00:07:17,437 --> 00:07:18,871
And then hopefully you
can repeat the process

179
00:07:18,871 --> 00:07:20,772
because the recipe
is quite simple.

180
00:07:20,773 --> 00:07:22,475
I'm not saying it's trivial,

181
00:07:22,475 --> 00:07:24,510
I'm saying you have
like some set steps

182
00:07:24,510 --> 00:07:26,546
that you can follow to succeed.

183
00:07:28,448 --> 00:07:30,248
So then now how about detection?

184
00:07:30,249 --> 00:07:31,951
What can we do about this?

185
00:07:31,951 --> 00:07:33,519
These are some of the
technical features

186
00:07:33,519 --> 00:07:35,855
we have used in
the past few years

187
00:07:35,855 --> 00:07:38,691
to identify these
different infrastructures.

188
00:07:38,691 --> 00:07:41,227
The first one is what we
call a leaf ASN model.

189
00:07:41,227 --> 00:07:42,494
I'll describe that.

190
00:07:42,495 --> 00:07:44,063
The second one is you
register your business

191
00:07:44,063 --> 00:07:45,498
in offshore countries.

192
00:07:45,498 --> 00:07:46,966
I'll describe that.

193
00:07:46,966 --> 00:07:48,568
And then usually they will
use anonymous payment methods

194
00:07:48,568 --> 00:07:50,669
like the Bitcoin,
the Perfect Money,

195
00:07:50,670 --> 00:07:53,573
and some of the new
ones we see nowadays.

196
00:07:53,573 --> 00:07:55,775
Also, they will
use small IP space

197
00:07:55,775 --> 00:07:58,744
just for flexibility
and for low cost.

198
00:07:58,744 --> 00:08:01,080
Finally obviously if
you follow the traffic

199
00:08:01,080 --> 00:08:04,015
hosted or generated
out of this IP space,

200
00:08:04,016 --> 00:08:05,952
you will see it's purely toxic

201
00:08:05,952 --> 00:08:08,554
and most of the time
bad and criminal.

202
00:08:09,622 --> 00:08:10,890
For the outgoing traffic,

203
00:08:10,890 --> 00:08:14,260
it's usually SSH brute
forcing, DDoS attacks,

204
00:08:14,260 --> 00:08:16,295
sending spam, that
type of thing.

205
00:08:17,964 --> 00:08:20,466
How about the leaf
stub ASN idea?

206
00:08:20,466 --> 00:08:23,870
We came up with this
concept at Black Hat 2014.

207
00:08:23,870 --> 00:08:25,638
The idea is that on
the public internet,

208
00:08:25,638 --> 00:08:28,974
an organization needs to acquire
an autonomous system number

209
00:08:28,975 --> 00:08:30,042
to identify their network.

210
00:08:30,042 --> 00:08:31,611
They have to have some IP space,

211
00:08:31,611 --> 00:08:33,379
and then they will do
peering relationships

212
00:08:33,379 --> 00:08:35,081
and advertise their IP space,

213
00:08:35,081 --> 00:08:38,918
so then now they become
visible to the global internet,

214
00:08:38,918 --> 00:08:41,453
and now they can route
traffic in and out.

215
00:08:41,453 --> 00:08:42,621
In this case, we can see

216
00:08:42,621 --> 00:08:45,190
that the relationship
is directional.

217
00:08:45,191 --> 00:08:47,593
You have arrows pointing up.

218
00:08:47,593 --> 00:08:49,094
SINARO and HOSTSLIM,

219
00:08:49,095 --> 00:08:52,632
they happen to be having
an upstream in SERVERIUS.

220
00:08:52,632 --> 00:08:55,367
Usually you'll have either
upstream or downstreams,

221
00:08:55,368 --> 00:08:57,203
but the leaf is when
you only have upstreams.

222
00:08:57,203 --> 00:08:59,605
You don't have any buddy
below you relying on you

223
00:08:59,605 --> 00:09:01,374
because if you have
relationship up,

224
00:09:01,374 --> 00:09:05,378
it means you have to
advertise your IP space,

225
00:09:05,378 --> 00:09:08,147
and that person will have
to advertise it for you.

226
00:09:08,147 --> 00:09:09,582
So if you don't have
anybody below you,

227
00:09:09,582 --> 00:09:11,317
it means no one depends on you.

228
00:09:11,317 --> 00:09:12,785
Now why is this interesting?

229
00:09:12,785 --> 00:09:15,755
It's because it offers you this
like nomadic flexible setup

230
00:09:15,755 --> 00:09:17,757
where you can just be as a leaf,

231
00:09:17,757 --> 00:09:19,824
set up your operation,
do your thing,

232
00:09:19,825 --> 00:09:21,127
and then if you want
to move somewhere else,

233
00:09:21,127 --> 00:09:22,194
no one will be affected.

234
00:09:22,194 --> 00:09:23,728
You can just go away,

235
00:09:23,729 --> 00:09:28,200
and basically create
another kind of link

236
00:09:28,200 --> 00:09:29,702
with another upstream provider,

237
00:09:29,702 --> 00:09:32,805
and it's as if nothing
happened, in fact.

238
00:09:32,805 --> 00:09:34,674
This is not
necessarily criminal,

239
00:09:34,674 --> 00:09:38,077
but we noticed it oftentimes
with this criminal

240
00:09:38,077 --> 00:09:40,413
or suspicious
hosting operations.

241
00:09:42,248 --> 00:09:44,016
The offshore countries,

242
00:09:44,016 --> 00:09:45,184
these are the ones we saw

243
00:09:45,184 --> 00:09:47,053
in the Panama Papers,
Offshore Leaks.

244
00:09:47,053 --> 00:09:49,355
They are not necessarily
used by the BPH guys

245
00:09:49,355 --> 00:09:53,059
for tax evasion but
mainly for an extra layer

246
00:09:53,059 --> 00:09:55,661
of a resistance because
in these countries,

247
00:09:55,661 --> 00:09:59,531
they are not forced to give
away the private information

248
00:09:59,532 --> 00:10:01,734
of the customer, so law
enforcement has no clue

249
00:10:01,734 --> 00:10:04,670
on who is behind
the BPH operation.

250
00:10:04,670 --> 00:10:06,005
That's the advantage here.

251
00:10:07,473 --> 00:10:10,476
In fact, we realized after
further analysis of that,

252
00:10:10,476 --> 00:10:13,312
these bad guys or
these BPH actors,

253
00:10:13,312 --> 00:10:15,381
they leverage the
best of three worlds.

254
00:10:15,381 --> 00:10:16,848
The actors will be,

255
00:10:16,849 --> 00:10:18,751
the operators will be
mainly from Eastern Europe

256
00:10:18,751 --> 00:10:20,752
like Ukraine or Russia,

257
00:10:20,753 --> 00:10:21,887
and then the servers
will be using

258
00:10:21,887 --> 00:10:24,189
the best connectivity
in the world,

259
00:10:24,190 --> 00:10:25,925
North America and Europe,

260
00:10:25,925 --> 00:10:27,526
and finally the business
will be protected

261
00:10:27,526 --> 00:10:29,829
in offshore countries
like the ones we saw.

262
00:10:29,829 --> 00:10:32,098
So you basically have
an ideal recipe here

263
00:10:32,098 --> 00:10:34,467
and no one practically
can touch you.

264
00:10:34,467 --> 00:10:37,770
I'm not saying no
one or impossible

265
00:10:37,770 --> 00:10:40,372
because we had some
successful takedown operations

266
00:10:40,373 --> 00:10:42,274
like the Avalanche
and a few others,

267
00:10:42,274 --> 00:10:44,844
but you realize they
last like a few years

268
00:10:44,844 --> 00:10:47,480
because it takes a lot
of work and collaboration

269
00:10:47,480 --> 00:10:51,450
between law enforcement,
countries, local agencies,

270
00:10:51,450 --> 00:10:56,188
security companies, private
sector, and government.

271
00:10:56,188 --> 00:10:58,457
It's not an easy task,
but it's possible.

272
00:11:00,026 --> 00:11:02,694
Now let me talk about
some major BPH operations.

273
00:11:03,996 --> 00:11:06,098
Let me start with the
botnet-based points.

274
00:11:07,333 --> 00:11:09,101
In this case, this
is a known one.

275
00:11:09,101 --> 00:11:10,302
We have been tracking it

276
00:11:10,302 --> 00:11:13,105
for, I would say,
like four, five years.

277
00:11:13,105 --> 00:11:15,508
We call it the Zbot
Fast Flux proxy network.

278
00:11:15,508 --> 00:11:18,310
Some others in the industry
call it Fluxxy or Darkcloud.

279
00:11:18,310 --> 00:11:21,680
It's typically around
20 to 30 to 40,000

280
00:11:21,681 --> 00:11:23,649
compromised
residential machines,

281
00:11:23,649 --> 00:11:26,252
typically WiFi, access
points, and routers,

282
00:11:26,252 --> 00:11:27,786
and mainly Ukraine and Russia,

283
00:11:27,787 --> 00:11:29,655
and they are used as a CDN

284
00:11:29,655 --> 00:11:31,723
or reverse proxy
infrastructure for criminals.

285
00:11:31,724 --> 00:11:33,492
The idea is that you
come to the actor,

286
00:11:33,492 --> 00:11:34,860
you have a site you
want to protect.

287
00:11:34,860 --> 00:11:37,797
It could be a phishing
site, a malware C2,

288
00:11:37,797 --> 00:11:41,300
a ransomware payment site, a
dump shop, a criminal forum.

289
00:11:41,300 --> 00:11:43,703
And then you tell the guy
for a few hundred dollars,

290
00:11:43,703 --> 00:11:46,038
"Hey, I want to protect the
origin IP of my server."

291
00:11:46,038 --> 00:11:48,140
It'd be like, "Okay,
give me the domain.

292
00:11:48,140 --> 00:11:51,242
"I'm gonna change the name
server setup of your domain,

293
00:11:51,243 --> 00:11:53,979
"and make it point to Flax
Flux IPs from the botnet."

294
00:11:53,979 --> 00:11:56,082
So then everybody who
resolves the domain

295
00:11:56,082 --> 00:11:57,983
will only see Fast Flux IPs,

296
00:11:57,983 --> 00:12:00,319
but in those bots
controlled by the actor,

297
00:12:00,319 --> 00:12:03,222
they will have like a
redirection via Nginx usually

298
00:12:03,222 --> 00:12:05,391
to the origin IP server,

299
00:12:05,391 --> 00:12:07,459
and then back and
forth, you have traffic.

300
00:12:07,460 --> 00:12:11,230
It's like a criminal Cloudflare
or Akamai in a sense.

301
00:12:11,230 --> 00:12:12,832
This guy has been
very successful.

302
00:12:12,832 --> 00:12:17,503
Currently he is powering the
Gozi ISFB banking Trojan,

303
00:12:17,503 --> 00:12:18,971
and in the past,

304
00:12:18,971 --> 00:12:20,473
he's done practically
everything under the sun.

305
00:12:24,143 --> 00:12:27,213
Now the other model or the
other class is the host-based.

306
00:12:27,213 --> 00:12:29,714
We saw an example where
it was mainly botnet-based

307
00:12:29,715 --> 00:12:31,751
like compromise
people's machines.

308
00:12:31,751 --> 00:12:33,285
Now it's host-based,

309
00:12:33,285 --> 00:12:36,288
meaning he will either have
his own ASN infrastructure,

310
00:12:36,288 --> 00:12:38,958
or he will lease
servers and VPSs

311
00:12:38,958 --> 00:12:41,293
from third-party companies,

312
00:12:41,293 --> 00:12:42,695
or he will combine both.

313
00:12:43,929 --> 00:12:45,831
These are examples
of known hosters

314
00:12:45,831 --> 00:12:47,433
that are rogue or criminal

315
00:12:47,433 --> 00:12:50,202
that are using the
host-based model.

316
00:12:50,202 --> 00:12:52,004
You can take a picture
or you can ask me later

317
00:12:52,004 --> 00:12:53,973
for these examples to study.

318
00:12:55,941 --> 00:12:58,844
Now let's talk about one
of the most prominent guys

319
00:12:58,844 --> 00:13:01,447
in the host-based BPH space.

320
00:13:01,447 --> 00:13:03,115
This guy is named Alex.

321
00:13:03,115 --> 00:13:06,085
In fact, this is a
very interesting and
close relationship

322
00:13:06,085 --> 00:13:07,787
with Intel 471,

323
00:13:07,787 --> 00:13:10,589
so they track the
actor-centric intelligence.

324
00:13:10,589 --> 00:13:12,658
They are the experts
in the field in that.

325
00:13:12,658 --> 00:13:17,196
From our side, we are like
the worldwide telemetry guy,

326
00:13:17,196 --> 00:13:20,533
so we are able to track this
thing all over the place

327
00:13:20,533 --> 00:13:21,967
and kinda pinpoint
where they are

328
00:13:21,967 --> 00:13:23,202
and what they are doing.

329
00:13:23,202 --> 00:13:25,137
This guy actually
now is powering

330
00:13:25,137 --> 00:13:26,704
practically everything you see,

331
00:13:26,705 --> 00:13:29,241
the malspam campaigns, the
phishing, the dump shops,

332
00:13:29,241 --> 00:13:30,943
anything, you name it.

333
00:13:30,943 --> 00:13:33,279
He's been successful since 2016.

334
00:13:33,279 --> 00:13:36,314
In fact, all of the activity
that we see nowadays,

335
00:13:36,315 --> 00:13:40,286
they have used this guy at
least once or a few times.

336
00:13:40,286 --> 00:13:41,587
He has a presence in China,

337
00:13:41,587 --> 00:13:43,489
but he's a Russian-speaking guy.

338
00:13:44,356 --> 00:13:45,891
The other interesting thing

339
00:13:45,891 --> 00:13:48,661
is that he also abused his
third-party cloud services

340
00:13:48,661 --> 00:13:50,529
such as Amazon and Google Cloud

341
00:13:50,529 --> 00:13:53,032
although they have cleaned
up their act recently,

342
00:13:53,032 --> 00:13:55,768
and now he's focused mainly
in European hosting companies

343
00:13:55,768 --> 00:13:58,070
like in Russia,
France, Netherlands,

344
00:13:58,070 --> 00:13:59,338
and a few other countries.

345
00:14:01,707 --> 00:14:03,475
This is the interesting
slide I like here,

346
00:14:03,475 --> 00:14:04,977
which is the one we came up with

347
00:14:04,977 --> 00:14:07,847
by studying his dedicated
internet infrastructure.

348
00:14:07,847 --> 00:14:12,084
The guy owns and operates
three ASNs of his own,

349
00:14:12,084 --> 00:14:13,986
the three ones in gray.

350
00:14:13,986 --> 00:14:16,488
In fact, they have that
leaf-chained ASN structure

351
00:14:16,488 --> 00:14:19,725
I described earlier because
they have no downstreams.

352
00:14:19,725 --> 00:14:21,493
They kinda link to each other,

353
00:14:21,493 --> 00:14:22,962
the ones to the left,

354
00:14:22,962 --> 00:14:25,798
and then they share some handles

355
00:14:25,798 --> 00:14:28,067
with another ASN to the right,

356
00:14:28,067 --> 00:14:30,603
and that's the Alex,
Alexander, Volosovyk,

357
00:14:30,603 --> 00:14:33,405
a name that we used in,
like the way we call them.

358
00:14:33,405 --> 00:14:34,906
In fact, that's his name,

359
00:14:34,907 --> 00:14:36,976
and then he has another
handle in the underground.

360
00:14:36,976 --> 00:14:39,545
What's interesting is
that the chain there

361
00:14:39,545 --> 00:14:41,012
of those two to the left,

362
00:14:41,013 --> 00:14:42,948
they can sever their
relationship with OBIT,

363
00:14:42,948 --> 00:14:45,317
which is a typical
hosting company in Russia,

364
00:14:45,317 --> 00:14:48,320
and move somewhere else
like nothing happened.

365
00:14:48,320 --> 00:14:49,989
I'm not saying
they do it easily,

366
00:14:49,989 --> 00:14:52,091
but then that's the
setup I described earlier

367
00:14:52,091 --> 00:14:53,792
that makes it very flexible.

368
00:14:53,792 --> 00:14:58,631
Finally the guy in
gray to the right,

369
00:14:58,631 --> 00:15:00,733
that one is sharing
some credentials

370
00:15:00,733 --> 00:15:02,267
that appeared in
the Panama Papers

371
00:15:02,268 --> 00:15:04,069
like the address in Seychelle,

372
00:15:04,069 --> 00:15:05,503
that one, if you look it up,

373
00:15:05,504 --> 00:15:08,540
it's the same with maybe
tens or hundreds of companies

374
00:15:08,540 --> 00:15:09,808
that are in the Panama Papers,

375
00:15:09,808 --> 00:15:12,044
so they use like
some front companies

376
00:15:12,044 --> 00:15:14,713
to protect their identity,
some for tax evasion

377
00:15:14,713 --> 00:15:17,049
and some for bulletproof
hosting operation.

378
00:15:17,049 --> 00:15:18,617
The funny thing is
that you can see

379
00:15:18,617 --> 00:15:22,253
that, I would say, different
worlds will overlap

380
00:15:22,254 --> 00:15:23,856
for the same, I
would say, evasion

381
00:15:23,856 --> 00:15:25,724
and money laundering purposes.

382
00:15:28,093 --> 00:15:31,296
Now let me go with
a use case here,

383
00:15:31,297 --> 00:15:34,233
which is one of the most
prominent malspam campaigns

384
00:15:34,233 --> 00:15:37,202
right now, are leveraging
the Alex infrastructure,

385
00:15:37,202 --> 00:15:39,805
and I'm gonna describe
those signals and features

386
00:15:39,805 --> 00:15:43,342
I described earlier to track
this type of malware campaign.

387
00:15:45,044 --> 00:15:47,579
Your typical malspam
campaign infection chain

388
00:15:47,579 --> 00:15:49,882
looks something like this.

389
00:15:49,882 --> 00:15:51,416
So you have a phishing email

390
00:15:51,417 --> 00:15:55,487
or like a few phishing
emails sent in large amounts

391
00:15:55,487 --> 00:15:56,921
to potential victims.

392
00:15:56,922 --> 00:15:59,591
In this case, they spoofed
performanceair.com.

393
00:15:59,591 --> 00:16:00,826
That's the legit domain,

394
00:16:00,826 --> 00:16:02,761
but it has been made
look like it's the one

395
00:16:02,761 --> 00:16:05,264
who is sending the spam emails,

396
00:16:05,264 --> 00:16:06,799
and they're trying to lure you

397
00:16:06,799 --> 00:16:09,367
into thinking it's a Delta
Air Lines, like a invoice,

398
00:16:09,368 --> 00:16:12,471
you have to click on a
link to download whatever.

399
00:16:12,471 --> 00:16:14,239
The next step is
that when you open up

400
00:16:14,239 --> 00:16:15,708
the body of the email,

401
00:16:15,708 --> 00:16:18,377
you'll have some phishing
URLs that you have to click on

402
00:16:18,377 --> 00:16:19,911
if you make the mistake.

403
00:16:19,912 --> 00:16:23,782
And those will go and drop
a malicious Word document

404
00:16:23,782 --> 00:16:26,785
who will bring in
Hancitor dropper.

405
00:16:26,785 --> 00:16:28,454
It's not the malware itself

406
00:16:28,454 --> 00:16:30,322
because the Hancitor
dropper will call out

407
00:16:30,322 --> 00:16:34,259
to its own C2s, which
are in step four.

408
00:16:34,259 --> 00:16:36,895
And then the Hancitor
dropper will now call out

409
00:16:36,895 --> 00:16:41,165
to its own C2s who will bring
the actual banking Trojan.

410
00:16:41,166 --> 00:16:44,370
In this case, it's been
Zloader, Pony, Evil Pony,

411
00:16:44,370 --> 00:16:46,472
and then Panda Banker.

412
00:16:46,472 --> 00:16:47,906
Finally those Trojans,

413
00:16:47,906 --> 00:16:51,709
they will call out to
their own C2s in step five,

414
00:16:51,710 --> 00:16:56,248
and now they bring in like
extra modules for infection.

415
00:16:56,248 --> 00:16:57,649
They will exfiltrate data,

416
00:16:57,649 --> 00:16:59,485
or they will just
announce their existence.

417
00:16:59,485 --> 00:17:02,221
Step six can vary
depending on the purpose

418
00:17:02,221 --> 00:17:05,124
of the malware being
dropped in step four.

419
00:17:06,157 --> 00:17:07,626
This is your infection chain.

420
00:17:07,626 --> 00:17:08,827
Now how can we track it

421
00:17:08,827 --> 00:17:11,630
with our worldwide
signals intelligence?

422
00:17:11,630 --> 00:17:12,464
We're gonna see.

423
00:17:13,632 --> 00:17:15,134
This is how the email looks like

424
00:17:15,134 --> 00:17:19,371
when you just receive in your
spam trap or email mailbox.

425
00:17:20,539 --> 00:17:22,875
Now let me start with
a signal analysis here.

426
00:17:22,875 --> 00:17:24,843
This is from our
global telemetry.

427
00:17:24,843 --> 00:17:28,180
This is, I would say, an
interface we use for research

428
00:17:28,180 --> 00:17:30,816
but it's also offered
for our customers

429
00:17:30,816 --> 00:17:32,317
for their own purpose,

430
00:17:32,317 --> 00:17:35,487
but the point is, the spike
in traffic to performanceair,

431
00:17:35,487 --> 00:17:37,890
remember, that's the
spoofed sender domain.

432
00:17:37,890 --> 00:17:39,391
It's legit.

433
00:17:39,391 --> 00:17:41,427
They just made it look like
it's the one sending the spam,

434
00:17:41,427 --> 00:17:45,430
but then you see a 50K spike
in queries, DNS queries

435
00:17:45,431 --> 00:17:46,932
from all over the world.

436
00:17:46,932 --> 00:17:48,801
Those clients
scouring this domain,

437
00:17:48,801 --> 00:17:50,135
they could have been spam traps,

438
00:17:50,135 --> 00:17:51,737
email appliances, mail servers.

439
00:17:51,737 --> 00:17:52,938
They could have been

440
00:17:52,938 --> 00:17:56,308
the potential mail
servers of the victim.

441
00:17:56,308 --> 00:17:57,543
It varies.

442
00:17:57,543 --> 00:17:59,812
But the point is, here
you can get the idea

443
00:17:59,812 --> 00:18:00,946
about the volume of the attack,

444
00:18:00,946 --> 00:18:03,081
so you have like 50K queries

445
00:18:03,082 --> 00:18:06,452
that might give you like
the extent of this campaign,

446
00:18:06,452 --> 00:18:07,586
and this is done daily.

447
00:18:09,455 --> 00:18:10,956
That was the first step.

448
00:18:10,956 --> 00:18:12,224
How about the second step?

449
00:18:12,224 --> 00:18:14,626
Can we have some signals
intelligence around it?

450
00:18:14,626 --> 00:18:15,928
In fact, we do.

451
00:18:15,928 --> 00:18:18,263
We can see that some those URLs

452
00:18:18,263 --> 00:18:20,866
in the body of the email,
they also have spikes,

453
00:18:20,866 --> 00:18:22,434
but the spikes are lower.

454
00:18:22,434 --> 00:18:25,504
They're around 1,000
to 1,200 DNS queries.

455
00:18:25,504 --> 00:18:29,073
Here it tells you how
the funnel tightens,

456
00:18:29,074 --> 00:18:31,343
but then you now
become more focused

457
00:18:31,343 --> 00:18:33,178
in your potential infections

458
00:18:33,178 --> 00:18:35,714
because by the time you
clicked on the link,

459
00:18:37,516 --> 00:18:39,284
you're about to be infected.

460
00:18:39,284 --> 00:18:41,687
Potentially it's a spam trap
or like in a mail appliance,

461
00:18:41,687 --> 00:18:43,187
so there is no real victim,

462
00:18:43,188 --> 00:18:45,424
but then if it happens to be
a real person who clicked,

463
00:18:45,424 --> 00:18:46,758
then you got an idea

464
00:18:46,758 --> 00:18:49,828
about how many potential
victims were infection.

465
00:18:49,828 --> 00:18:51,897
Now think about it also is that,

466
00:18:51,897 --> 00:18:53,197
what you should
think about as well

467
00:18:53,198 --> 00:18:55,801
is that you have
six URLs per day,

468
00:18:55,801 --> 00:18:58,203
per malspam daily campaign.

469
00:18:58,203 --> 00:19:01,807
So you multiply
that by the volume,

470
00:19:01,807 --> 00:19:02,741
and that tells you around,

471
00:19:02,741 --> 00:19:04,877
1,200 times six or seven,

472
00:19:04,877 --> 00:19:07,546
that's around like the
number of potential queries

473
00:19:07,546 --> 00:19:10,149
to that domain that
might lead to infections.

474
00:19:11,650 --> 00:19:14,653
In fact, another interesting,
I would say, signal

475
00:19:14,653 --> 00:19:18,190
is that not only the volume
of the spike is interesting,

476
00:19:18,190 --> 00:19:20,125
it's also the duration.

477
00:19:20,125 --> 00:19:23,262
When we zoom in,
or zoom out, sorry,

478
00:19:23,262 --> 00:19:24,796
whatever the right term is,

479
00:19:24,796 --> 00:19:28,567
you'll realize the spike
will last for a few hours.

480
00:19:28,567 --> 00:19:29,902
It's like seven hours.

481
00:19:29,902 --> 00:19:32,404
It's not just like
one hit of a button

482
00:19:32,404 --> 00:19:33,639
and then everything happens.

483
00:19:33,639 --> 00:19:36,241
So you basically have
potentially victims

484
00:19:36,241 --> 00:19:37,776
who will spend seven hours

485
00:19:37,776 --> 00:19:41,280
to get into the flow of
this infection chain.

486
00:19:41,280 --> 00:19:43,682
And then if you calculate
the area under the curve,

487
00:19:43,682 --> 00:19:45,684
you can kind of come up
with a potential number

488
00:19:45,684 --> 00:19:50,689
of how many infections
this campaign is yielding.

489
00:19:53,325 --> 00:19:56,195
Now let's do our typical
passive DNS exercise

490
00:19:56,195 --> 00:19:57,529
that everybody likes.

491
00:19:57,529 --> 00:19:59,264
I'm gonna look
into one of the IPs

492
00:19:59,264 --> 00:20:02,700
of the phishing URL
on the 30th of August,

493
00:20:02,701 --> 00:20:05,003
that IP 52.14.

494
00:20:05,003 --> 00:20:07,172
Fun fact, it's on Amazon.

495
00:20:07,172 --> 00:20:09,274
It's one of the IPs from Alex.

496
00:20:09,274 --> 00:20:12,311
Remember he was abusing
Google Cloud and AWS?

497
00:20:12,311 --> 00:20:14,012
Now this was like
several months ago.

498
00:20:14,012 --> 00:20:15,647
This IP is not used anymore.

499
00:20:15,647 --> 00:20:17,349
It has been cleaned
up by Amazon.

500
00:20:17,349 --> 00:20:19,083
But then back then
in the summer,

501
00:20:19,084 --> 00:20:20,586
this was being
leveraged by Alex,

502
00:20:20,586 --> 00:20:24,156
and being offered for
his Hancitor actors.

503
00:20:24,156 --> 00:20:26,591
Basically you have Alex
operating on his own,

504
00:20:26,592 --> 00:20:28,827
he's catering to
variety of customers,

505
00:20:28,827 --> 00:20:31,129
and the Hancitor
gang were using him

506
00:20:31,129 --> 00:20:33,532
for their first stage infection.

507
00:20:34,733 --> 00:20:36,501
Now if I dig deeper
into the passive DNS,

508
00:20:36,501 --> 00:20:37,735
I'll see that that IP

509
00:20:37,736 --> 00:20:40,505
is hosting like a
lot of other domains.

510
00:20:40,505 --> 00:20:42,541
In fact, a lot of
them also spiking.

511
00:20:42,541 --> 00:20:44,775
I took one of
them, heymamaradio.

512
00:20:44,776 --> 00:20:47,279
That guy is also spiking
at the same volume.

513
00:20:47,279 --> 00:20:50,682
Remember the 1,200
queries, not the first one?

514
00:20:50,682 --> 00:20:52,217
Now I pivoted from the IP

515
00:20:52,217 --> 00:20:55,554
and now I get a domain with
the same signals intelligence

516
00:20:55,554 --> 00:20:57,222
or signals feature.

517
00:20:57,222 --> 00:20:58,757
That's the interesting fact.

518
00:20:58,757 --> 00:21:01,860
Now I can tie in together
a few domains via the IP

519
00:21:01,860 --> 00:21:03,629
that are part of the same,

520
00:21:03,629 --> 00:21:05,731
I would say, spike,
malspam campaign.

521
00:21:07,165 --> 00:21:10,002
Now an interesting fact
here about the passive DNS

522
00:21:10,002 --> 00:21:14,172
is that not only should you
look at the IPs themselves

523
00:21:14,172 --> 00:21:17,009
but also look at the Flux,
and who do they belong to,

524
00:21:17,009 --> 00:21:19,411
and tie that with other,
I would say, insights.

525
00:21:19,411 --> 00:21:23,115
In this case, that
domain, the top one,

526
00:21:23,115 --> 00:21:26,852
the phishing URL is in fact
a compromised GoDaddy domain.

527
00:21:26,852 --> 00:21:29,521
The IPs surrounded by green,

528
00:21:29,521 --> 00:21:32,524
those are IPs from
the GoDaddy IP space.

529
00:21:32,524 --> 00:21:34,693
Initially on the 29th of August,

530
00:21:34,693 --> 00:21:36,862
it was a GoDaddy legit IP.

531
00:21:36,862 --> 00:21:40,198
Sorry, yeah, the domain was
hosted on a GoDaddy legit IP.

532
00:21:40,198 --> 00:21:42,868
And then all of a sudden,
on the 29th of August,

533
00:21:42,868 --> 00:21:46,204
it switched to an
IP that is 47.74.

534
00:21:46,204 --> 00:21:47,906
That lasted for like
the next six days.

535
00:21:47,906 --> 00:21:50,809
So all of the IPs in
red, those are IPs

536
00:21:50,809 --> 00:21:53,445
under the Alex bulletproof
hosting infrastructure.

537
00:21:53,445 --> 00:21:54,946
This is kind of the point here.

538
00:21:54,946 --> 00:21:58,015
The malspam campaigns are
leveraging Alex infrastructure

539
00:21:58,016 --> 00:22:00,552
by weaponizing
formerly legit domains,

540
00:22:00,552 --> 00:22:04,121
switching them into
the new criminal IPs,

541
00:22:04,122 --> 00:22:05,791
and then using them.

542
00:22:05,791 --> 00:22:07,259
As we saw, they spiked

543
00:22:07,259 --> 00:22:09,361
because you had a lot
of victims go into them.

544
00:22:09,361 --> 00:22:11,096
Finally they de-weaponize them

545
00:22:11,096 --> 00:22:14,499
and bring them back to the
GoDaddy previous space.

546
00:22:15,934 --> 00:22:18,136
That's another interesting
signal we need to look for.

547
00:22:19,071 --> 00:22:21,406
Now the classic approach WHOIS.

548
00:22:21,406 --> 00:22:22,640
Everyone can do it.

549
00:22:22,641 --> 00:22:24,910
I look into the
registrant email.

550
00:22:24,910 --> 00:22:28,080
That one happens to
be using GoDaddy,

551
00:22:28,080 --> 00:22:30,649
so we can see here it's
a compromised registrant.

552
00:22:30,649 --> 00:22:32,516
It's not like a dedicated thing

553
00:22:32,517 --> 00:22:35,487
that was registered
in August of 2017.

554
00:22:35,487 --> 00:22:38,957
We confirm that because the
domains under that registrant,

555
00:22:38,957 --> 00:22:40,826
they were not malicious before,

556
00:22:40,826 --> 00:22:43,829
but once the account got
popped by the actors,

557
00:22:43,829 --> 00:22:46,264
or it got acquired
by the actors,

558
00:22:46,264 --> 00:22:48,132
they're not necessarily
the same people,

559
00:22:48,133 --> 00:22:49,701
they weaponize all
of those domains,

560
00:22:49,701 --> 00:22:52,237
and now they use them
in similar campaigns

561
00:22:52,237 --> 00:22:53,538
or campaigns of the same day.

562
00:22:53,538 --> 00:22:55,474
In fact, if we
pick one of those,

563
00:22:55,474 --> 00:23:00,412
the .info, we can see
that it also has a spike.

564
00:23:01,346 --> 00:23:03,815
Same volume, 1,200 queries.

565
00:23:03,815 --> 00:23:06,084
You can see here I found
three different domains

566
00:23:06,084 --> 00:23:07,519
from different avenues

567
00:23:07,519 --> 00:23:10,789
that had the exact same
signal feature here.

568
00:23:13,625 --> 00:23:16,628
Another interesting
feature we have

569
00:23:16,628 --> 00:23:18,496
that we use in our
research and analysis

570
00:23:18,497 --> 00:23:22,100
is what we call a
related domains or
co-occurrences concept.

571
00:23:22,100 --> 00:23:23,368
The idea is that we build

572
00:23:23,368 --> 00:23:25,870
like this internal
large-scale graph

573
00:23:25,871 --> 00:23:27,439
where we take all of the domains

574
00:23:27,439 --> 00:23:29,708
queried by the same IPs
during a short time period.

575
00:23:29,708 --> 00:23:31,777
It's almost like
locality and time

576
00:23:31,777 --> 00:23:33,512
based on who queries
those domains.

577
00:23:33,512 --> 00:23:35,914
With that, you can build
a very interesting graph,

578
00:23:35,914 --> 00:23:37,182
the co-occurrence graph,

579
00:23:37,182 --> 00:23:39,017
which will tie domains
that are shared

580
00:23:39,017 --> 00:23:41,953
between the same infected
machines like DGAs typically

581
00:23:41,953 --> 00:23:44,389
or like machines following
like the infection chain,

582
00:23:44,389 --> 00:23:46,591
so usually you'll see
the compromised site

583
00:23:46,591 --> 00:23:48,427
leading with the
iFrame injection

584
00:23:48,427 --> 00:23:50,962
leading to the exploit
kit landing page

585
00:23:50,962 --> 00:23:52,964
to maybe the C2 domain.

586
00:23:52,964 --> 00:23:56,067
Oftentimes it's also
used for tracking people

587
00:23:56,067 --> 00:23:58,837
who browse the same topics

588
00:23:58,837 --> 00:24:02,841
like crimeware forums, you'll
see co-occurring altogether.

589
00:24:02,841 --> 00:24:04,609
Jabber servers, they
will co-occur together.

590
00:24:04,609 --> 00:24:08,379
VPN, proxy, SOC servers,
they will co-occur together

591
00:24:08,380 --> 00:24:10,115
because the customers
who go there,

592
00:24:10,115 --> 00:24:11,316
they will tend to have

593
00:24:11,316 --> 00:24:16,087
the same topics or
interests altogether.

594
00:24:17,255 --> 00:24:19,691
Now in this case,
the phishing URL

595
00:24:19,691 --> 00:24:21,259
that we see here at the top,

596
00:24:21,259 --> 00:24:23,295
that one co-occurs with
the performanceair.

597
00:24:23,295 --> 00:24:25,730
Remember, performanceair
was the spoofed sender.

598
00:24:25,730 --> 00:24:27,933
It was stage one in
the infection chain.

599
00:24:27,933 --> 00:24:30,402
The phishing URL is stage two.

600
00:24:30,402 --> 00:24:32,771
And then the bottom
one, the three there,

601
00:24:32,771 --> 00:24:34,272
they are also stage two.

602
00:24:34,272 --> 00:24:35,607
Those are like phishing URLs

603
00:24:35,607 --> 00:24:37,976
who are dropping the
Hancitor malware.

604
00:24:37,976 --> 00:24:39,478
You can see here with
the co-occurrences now,

605
00:24:39,478 --> 00:24:42,280
you can also recreate the
infection chain somewhat

606
00:24:42,280 --> 00:24:45,317
because you have stage one
co-occurring with stage two

607
00:24:45,317 --> 00:24:47,719
and also some other
guys, some other domains

608
00:24:47,719 --> 00:24:49,454
from the stage two
of the same campaign,

609
00:24:49,454 --> 00:24:52,456
or a campaign from
a following day.

610
00:24:52,457 --> 00:24:54,125
That's kind of the
interesting thing here.

611
00:24:54,125 --> 00:24:56,761
Now you might tell me okay,
how can I do this on my own.

612
00:24:56,761 --> 00:25:00,999
If you have like your large
DNS collection infrastructure,

613
00:25:00,999 --> 00:25:03,268
you can try to create
this sort of analysis

614
00:25:03,268 --> 00:25:04,703
like you'll have to
collect the data,

615
00:25:04,703 --> 00:25:05,937
you'll have to process it,

616
00:25:05,937 --> 00:25:07,772
create like the right
data structures,

617
00:25:07,772 --> 00:25:09,006
use the right technology,

618
00:25:09,007 --> 00:25:09,975
and then now maybe
you can come up

619
00:25:09,975 --> 00:25:11,141
with this type of analysis.

620
00:25:11,142 --> 00:25:13,044
These are like some recipes

621
00:25:13,044 --> 00:25:15,447
that you might be
able to reproduce.

622
00:25:15,447 --> 00:25:17,882
Some of them might
require, maybe use

623
00:25:17,883 --> 00:25:19,150
like some third
party or whatnot.

624
00:25:19,150 --> 00:25:20,585
But I guess the takeaway

625
00:25:20,585 --> 00:25:23,088
is that a lot of these
things are worth looking at

626
00:25:23,088 --> 00:25:24,623
because they give
you a lot of insight

627
00:25:24,623 --> 00:25:27,592
beyond just like the domains
and IPs and running around

628
00:25:27,592 --> 00:25:28,827
and trying to push
them and block them

629
00:25:28,827 --> 00:25:30,095
and all of that stuff.

630
00:25:33,164 --> 00:25:35,500
I guess one of the final slides

631
00:25:35,500 --> 00:25:38,103
is an interesting recap

632
00:25:38,103 --> 00:25:42,107
on the exploration
graph I described.

633
00:25:42,107 --> 00:25:45,343
And then I can go
over it in slow-mo

634
00:25:45,343 --> 00:25:46,645
if you have questions later.

635
00:25:46,645 --> 00:25:48,780
We started with stage one,

636
00:25:48,780 --> 00:25:51,649
and then we were able to
find the related domains,

637
00:25:51,650 --> 00:25:54,319
and then we found like the WHOIS

638
00:25:54,319 --> 00:25:57,322
helped us find some
more malicious domains.

639
00:25:57,322 --> 00:25:59,056
We looked into the hosting IP,

640
00:25:59,057 --> 00:26:01,760
which happened to be on Alex
that we described earlier.

641
00:26:01,760 --> 00:26:03,228
And then from that hosting IP,

642
00:26:03,228 --> 00:26:06,064
we found domains that happen
to resolve to other IPs

643
00:26:06,064 --> 00:26:07,799
under the Alex infrastructure.

644
00:26:07,799 --> 00:26:10,368
And then I could have also
looked into the hashes

645
00:26:10,368 --> 00:26:13,071
that are tied to that
malicious domain.

646
00:26:13,071 --> 00:26:14,272
I didn't show it.

647
00:26:14,272 --> 00:26:15,840
But then if you look
into the network trace,

648
00:26:15,840 --> 00:26:18,243
you can also find some more C2s

649
00:26:18,243 --> 00:26:20,745
that are part of this
entire infection chain.

650
00:26:21,780 --> 00:26:23,281
We found it very useful for us

651
00:26:23,281 --> 00:26:27,552
to map out the
exploration paths we have

652
00:26:27,552 --> 00:26:29,588
because that gives you
a visual perspective

653
00:26:29,588 --> 00:26:30,989
of how things operating.

654
00:26:30,989 --> 00:26:32,557
You could do this
with some visual tools

655
00:26:32,557 --> 00:26:35,093
or you can just draw
it on the board.

656
00:26:35,093 --> 00:26:36,795
We found that very powerful.

657
00:26:36,795 --> 00:26:39,097
Now we do this with
pencil and paper,

658
00:26:39,097 --> 00:26:41,199
but then oftentimes if
you have the expertise

659
00:26:41,199 --> 00:26:44,102
and technology, you
can build the systems

660
00:26:44,102 --> 00:26:45,470
who will do this at scale.

661
00:26:45,470 --> 00:26:46,705
That's the fun part.

662
00:26:46,705 --> 00:26:49,573
How can you transfer
your human insight

663
00:26:49,574 --> 00:26:51,710
into something scalable
and repeatable.

664
00:26:51,710 --> 00:26:53,044
I think that's
one of the lessons

665
00:26:53,044 --> 00:26:55,080
we can learn from
this conference,

666
00:26:55,080 --> 00:26:56,581
which I found very exciting,

667
00:26:56,581 --> 00:26:58,716
is that can we make all of
this knowledge we have here

668
00:26:58,717 --> 00:27:00,885
into something scalable
and repeatable,

669
00:27:00,885 --> 00:27:02,487
so we can save time.

670
00:27:04,089 --> 00:27:05,690
Finally one of my
favorite slides

671
00:27:05,690 --> 00:27:10,395
is that it's a summary of the
TTPs across malspam campaigns

672
00:27:10,395 --> 00:27:13,431
covering a few months, I
would say six or seven months.

673
00:27:13,431 --> 00:27:15,433
I just put like
two here for space,

674
00:27:15,433 --> 00:27:17,502
but then we see that
the first stage,

675
00:27:17,502 --> 00:27:19,937
which is like the
spoofed sender URL,

676
00:27:19,938 --> 00:27:21,740
the spoofed sender email,

677
00:27:21,740 --> 00:27:23,008
they happen to be using

678
00:27:23,008 --> 00:27:27,812
legit unfortunate
innocent domains,

679
00:27:29,247 --> 00:27:32,684
but those happen to have a
very distinct spiked volume.

680
00:27:32,684 --> 00:27:35,053
It's around 50 or 60K.

681
00:27:35,053 --> 00:27:38,423
Whereas the phishing URLs
in the body of the email,

682
00:27:38,423 --> 00:27:42,694
they happen to have that
spike around 1,200, no more.

683
00:27:42,694 --> 00:27:44,195
But then the other
cool thing about it

684
00:27:44,195 --> 00:27:46,297
is that all of the phishing URLs

685
00:27:46,297 --> 00:27:49,501
like the stage two in the
infection are using Alex.

686
00:27:49,501 --> 00:27:51,603
They never divert from that.

687
00:27:51,603 --> 00:27:53,104
Why?

688
00:27:53,104 --> 00:27:54,506
Because Alex happens to be
one of the most successful,

689
00:27:54,506 --> 00:27:57,509
reliable, fault
tolerant, et cetera

690
00:27:57,509 --> 00:28:00,178
bulletproof hosting
infrastructures
we've seen nowadays

691
00:28:00,178 --> 00:28:02,514
in the ecosystem
of a cyber crime.

692
00:28:02,514 --> 00:28:04,416
The actors behind Hancitor,

693
00:28:04,416 --> 00:28:06,451
they chose, for
practicality, to use him

694
00:28:06,451 --> 00:28:07,952
because they were like okay,

695
00:28:07,952 --> 00:28:10,955
let's guarantee the best
infection rate we can get

696
00:28:10,955 --> 00:28:13,925
by using the best guy very
early in our infection chain,

697
00:28:13,925 --> 00:28:16,428
and the rest we can,
maybe we don't care.

698
00:28:16,428 --> 00:28:18,096
In fact, the next C2s,

699
00:28:18,096 --> 00:28:21,599
they are all using like a
variety of smalltime BPH

700
00:28:21,599 --> 00:28:24,703
and abused hosters in
European countries,

701
00:28:24,703 --> 00:28:27,172
in Russia and
Ukraine especially.

702
00:28:27,172 --> 00:28:29,774
This is shows you how,
like we saw earlier

703
00:28:29,774 --> 00:28:31,008
with the talk about AlphaBay,

704
00:28:31,009 --> 00:28:33,712
where it's a very
opportunistic ecosystem.

705
00:28:33,712 --> 00:28:35,413
They will try to use
the best expertise

706
00:28:35,413 --> 00:28:39,751
from different groups, and
the goal is to basically make

707
00:28:41,052 --> 00:28:42,620
money and be the most successful

708
00:28:42,620 --> 00:28:44,889
in the cyber crime ecosystem.

709
00:28:49,327 --> 00:28:50,895
I know I had a lot of material.

710
00:28:50,895 --> 00:28:52,163
I went a little bit fast.

711
00:28:52,163 --> 00:28:54,899
But then if you want
to get more details,

712
00:28:54,899 --> 00:28:57,001
I invite you to check some
of our previous talks.

713
00:28:57,001 --> 00:29:01,940
We had a few talks at
Black Hat 2014, 2016, 2017,

714
00:29:03,007 --> 00:29:04,542
Defcon, Virus
Bulletin, you name it.

715
00:29:04,542 --> 00:29:07,312
You can take a picture or you
can get those from the slides.

716
00:29:07,312 --> 00:29:09,613
But if not, then I'll
be more than happy

717
00:29:09,614 --> 00:29:12,183
to talk offline
about any questions.

718
00:29:14,052 --> 00:29:16,387
Some acknowledgements, some
good friends helped out

719
00:29:16,387 --> 00:29:17,388
with a few things.

720
00:29:18,523 --> 00:29:19,524
Thank you again.

721
00:29:19,524 --> 00:29:20,492
I appreciate it.

722
00:29:20,492 --> 00:29:24,095
(audience clapping)

723
00:29:24,095 --> 00:29:26,598
(tense music)

