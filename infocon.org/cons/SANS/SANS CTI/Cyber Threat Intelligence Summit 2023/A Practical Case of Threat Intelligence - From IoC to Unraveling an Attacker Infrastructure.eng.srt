1
00:00:00,659 --> 00:00:02,900
foreign

2
00:00:07,460 --> 00:00:10,559
we were debating yesterday after after

3
00:00:10,559 --> 00:00:12,660
seeing all the cool graphics uh the

4
00:00:12,660 --> 00:00:14,940
graphic recordings how long we need to

5
00:00:14,940 --> 00:00:16,440
stay on this slide in order for the

6
00:00:16,440 --> 00:00:18,539
butterfly to appear there

7
00:00:18,539 --> 00:00:20,640
uh so I'll try to take as much time as

8
00:00:20,640 --> 00:00:22,560
possible

9
00:00:22,560 --> 00:00:24,300
um so first of all it's not a butterfly

10
00:00:24,300 --> 00:00:26,400
it's a moss and more specifically a luna

11
00:00:26,400 --> 00:00:29,820
moth we track a threat regroup by this

12
00:00:29,820 --> 00:00:32,098
name Luna Moss

13
00:00:32,098 --> 00:00:33,840
um and what we want to share with you

14
00:00:33,840 --> 00:00:36,899
today is a case study of how we took

15
00:00:36,899 --> 00:00:40,379
iocs that we discovered by responding to

16
00:00:40,379 --> 00:00:41,340
incident

17
00:00:41,340 --> 00:00:43,860
and through the process of pivoting how

18
00:00:43,860 --> 00:00:45,840
we uncovered and unraveled their

19
00:00:45,840 --> 00:00:47,879
infrastructure

20
00:00:47,879 --> 00:00:49,140
um

21
00:00:49,140 --> 00:00:51,800
in our talk we'll have three main parts

22
00:00:51,800 --> 00:00:54,780
uh we'll give you a bit of background on

23
00:00:54,780 --> 00:00:57,719
this group and their go-to technique

24
00:00:57,719 --> 00:00:59,460
that they use in order to infiltrate

25
00:00:59,460 --> 00:01:02,699
networks next we'll share two pivoting

26
00:01:02,699 --> 00:01:04,619
examples that we used in order to track

27
00:01:04,619 --> 00:01:05,640
this group

28
00:01:05,640 --> 00:01:07,439
and of course we'll wrap it up with some

29
00:01:07,439 --> 00:01:08,760
insights

30
00:01:08,760 --> 00:01:11,220
before we start a bit about ourselves

31
00:01:11,220 --> 00:01:15,240
I'm Nam uh it's a pleasure to be here uh

32
00:01:15,240 --> 00:01:17,040
I am an incident responder at signia

33
00:01:17,040 --> 00:01:18,900
I've been with signia for three years

34
00:01:18,900 --> 00:01:19,740
almost

35
00:01:19,740 --> 00:01:22,500
uh tomorrow actually

36
00:01:22,500 --> 00:01:24,900
um and I come from an ex-military

37
00:01:24,900 --> 00:01:27,740
background so that's about it

38
00:01:27,740 --> 00:01:31,140
hi nice to meet you on I'm Owen for the

39
00:01:31,140 --> 00:01:33,000
past three years I've been working as a

40
00:01:33,000 --> 00:01:35,460
senior IR expert at signia I'm a

41
00:01:35,460 --> 00:01:36,659
bookworm

42
00:01:36,659 --> 00:01:39,240
a foodie and a coffee lover

43
00:01:39,240 --> 00:01:41,839
let's start

44
00:01:42,060 --> 00:01:45,960
so we all get fishing messages all the

45
00:01:45,960 --> 00:01:48,420
time right you know the message from the

46
00:01:48,420 --> 00:01:51,600
prince that really needs our help and if

47
00:01:51,600 --> 00:01:54,000
we would just help him now he would make

48
00:01:54,000 --> 00:01:55,920
us rich one day

49
00:01:55,920 --> 00:01:58,799
but there are different types of fishing

50
00:01:58,799 --> 00:02:00,960
events out there take this simple

51
00:02:00,960 --> 00:02:03,000
message for example if we carefully

52
00:02:03,000 --> 00:02:05,399
write the email we can say that it's not

53
00:02:05,399 --> 00:02:07,439
from the prince it's from a well-known

54
00:02:07,439 --> 00:02:10,440
service it's for master class and there

55
00:02:10,440 --> 00:02:13,800
are no typos in the email no links there

56
00:02:13,800 --> 00:02:16,920
is a PDF attachment but it's not

57
00:02:16,920 --> 00:02:19,319
malicious at all if we click and open

58
00:02:19,319 --> 00:02:22,800
the PDF we can see there a receipt for

59
00:02:22,800 --> 00:02:25,560
one of Gordon Ramsay's cooking classes

60
00:02:25,560 --> 00:02:28,200
the foodie I would love to attend this

61
00:02:28,200 --> 00:02:31,140
class but if you don't want Gordon

62
00:02:31,140 --> 00:02:33,900
Ramsay to yell at you you can just call

63
00:02:33,900 --> 00:02:35,220
the number at the bottom of the email

64
00:02:35,220 --> 00:02:37,920
and cancel the subscription

65
00:02:37,920 --> 00:02:40,440
since there is nothing malicious about

66
00:02:40,440 --> 00:02:42,260
this email message

67
00:02:42,260 --> 00:02:45,540
anti-spam Solutions won't flag or block

68
00:02:45,540 --> 00:02:48,239
it but this email is in fact the first

69
00:02:48,239 --> 00:02:50,459
stage of an attack called holdback

70
00:02:50,459 --> 00:02:51,780
fishing

71
00:02:51,780 --> 00:02:54,000
callback fishing is an initial access

72
00:02:54,000 --> 00:02:57,060
attack Vector heavily reliant on social

73
00:02:57,060 --> 00:02:59,640
engineering it's comprised of three

74
00:02:59,640 --> 00:03:02,879
stages first a phishing email like the

75
00:03:02,879 --> 00:03:05,940
message we just saw second a phone call

76
00:03:05,940 --> 00:03:08,700
which the victim initiates and third

77
00:03:08,700 --> 00:03:12,180
some sort of software deployment the

78
00:03:12,180 --> 00:03:14,640
email messages originate from free email

79
00:03:14,640 --> 00:03:17,400
Services they may themselves do not

80
00:03:17,400 --> 00:03:20,220
contain any links and while some of them

81
00:03:20,220 --> 00:03:23,099
have an attachment it is not weaponized

82
00:03:23,099 --> 00:03:25,319
in any way

83
00:03:25,319 --> 00:03:29,220
the emails mimic well-known Brands like

84
00:03:29,220 --> 00:03:32,940
master class or Duolingo and they inform

85
00:03:32,940 --> 00:03:35,819
the victim about an upcoming charge due

86
00:03:35,819 --> 00:03:38,400
to a service or subscription that they

87
00:03:38,400 --> 00:03:41,060
purchased if the victim wants to cancel

88
00:03:41,060 --> 00:03:44,340
the charge they can just call the call

89
00:03:44,340 --> 00:03:46,980
center and a human operator will answer

90
00:03:46,980 --> 00:03:49,680
the call and will manipulate them into

91
00:03:49,680 --> 00:03:52,560
downloading some sort of project

92
00:03:52,560 --> 00:03:55,500
the Trojan will be later used by the

93
00:03:55,500 --> 00:03:57,780
threat actor to gain Hands-On keyboard

94
00:03:57,780 --> 00:04:00,780
access to the compromised host or and

95
00:04:00,780 --> 00:04:02,340
depending on the group conducting this

96
00:04:02,340 --> 00:04:04,560
activity it can lead to that

97
00:04:04,560 --> 00:04:07,500
acceleration ransomware deployment and

98
00:04:07,500 --> 00:04:11,280
quick compromise of an entire network

99
00:04:11,280 --> 00:04:13,739
how is this all connected to Luna mode

100
00:04:13,739 --> 00:04:17,060
well Luna mode is a group that

101
00:04:17,060 --> 00:04:20,760
specializes in callback fishing based on

102
00:04:20,760 --> 00:04:22,860
a research conducted by Advanced Intel

103
00:04:22,860 --> 00:04:25,320
Luna mode were originally part of the

104
00:04:25,320 --> 00:04:30,780
ryuk county operation back then in 2020

105
00:04:30,780 --> 00:04:32,400
and

106
00:04:32,400 --> 00:04:36,060
Luna mode had a different flow the call

107
00:04:36,060 --> 00:04:38,520
center operator will try to trick the

108
00:04:38,520 --> 00:04:41,280
user into downloading a weaponized

109
00:04:41,280 --> 00:04:44,220
Office document when the user enabled

110
00:04:44,220 --> 00:04:47,460
macros Bazaar loader will be executed on

111
00:04:47,460 --> 00:04:49,800
the endpoint ultimately leading to

112
00:04:49,800 --> 00:04:52,820
ransomware deployment

113
00:04:53,040 --> 00:04:55,800
following the Russo cranewall Concrete

114
00:04:55,800 --> 00:04:58,620
disintegrated into several groups and

115
00:04:58,620 --> 00:05:01,199
Luna mode emerged as an independent

116
00:05:01,199 --> 00:05:04,740
group in merch of 2022.

117
00:05:04,740 --> 00:05:08,100
in their post container Incarnation the

118
00:05:08,100 --> 00:05:10,919
group is not yet another ransomware

119
00:05:10,919 --> 00:05:11,780
group

120
00:05:11,780 --> 00:05:15,780
they their technique is a bit different

121
00:05:15,780 --> 00:05:18,419
things they do not use malware they

122
00:05:18,419 --> 00:05:21,000
don't encrypt files and they do not

123
00:05:21,000 --> 00:05:24,540
maintain elixir

124
00:05:24,600 --> 00:05:27,780
lunamix avoidance for malware combined

125
00:05:27,780 --> 00:05:30,600
with the highly Reliance on social

126
00:05:30,600 --> 00:05:33,360
engineering means that technology alone

127
00:05:33,360 --> 00:05:37,259
is not enough to stop this threat what

128
00:05:37,259 --> 00:05:42,199
can stop them good with intelligence

129
00:05:42,240 --> 00:05:43,440
awesome

130
00:05:43,440 --> 00:05:46,500
so I want to finish this background on

131
00:05:46,500 --> 00:05:48,600
luna moth by sharing with you what a

132
00:05:48,600 --> 00:05:51,180
Luna Mata tax flow looks like it all

133
00:05:51,180 --> 00:05:54,060
starts just as we've explained with a

134
00:05:54,060 --> 00:05:55,280
phishing email

135
00:05:55,280 --> 00:05:57,419
containing a receipt for a purchase

136
00:05:57,419 --> 00:06:00,780
service let's say a Duolingo sir

137
00:06:00,780 --> 00:06:04,020
um the phishing email contains the U.S

138
00:06:04,020 --> 00:06:06,960
phone number and the victim calls the

139
00:06:06,960 --> 00:06:09,180
phone number on the other side sits the

140
00:06:09,180 --> 00:06:11,639
operator who leads the victim to

141
00:06:11,639 --> 00:06:13,919
installing remote Administration tools

142
00:06:13,919 --> 00:06:15,960
on their device right these are not

143
00:06:15,960 --> 00:06:18,180
malicious tools by nature but they are

144
00:06:18,180 --> 00:06:20,520
used maliciously by lunima

145
00:06:20,520 --> 00:06:23,039
now just to to be able to get you the

146
00:06:23,039 --> 00:06:25,139
feel of how they work these operators

147
00:06:25,139 --> 00:06:27,120
during an investigation that we

148
00:06:27,120 --> 00:06:30,360
conducted we found out that the victim

149
00:06:30,360 --> 00:06:33,000
who was on the call with this operator

150
00:06:33,000 --> 00:06:35,280
was instructed to install these tools on

151
00:06:35,280 --> 00:06:37,680
their device however they didn't have

152
00:06:37,680 --> 00:06:40,380
the permissions to install these tools

153
00:06:40,380 --> 00:06:43,560
on the device so the operator led the

154
00:06:43,560 --> 00:06:46,199
victim to open a ticket with I.T in

155
00:06:46,199 --> 00:06:47,759
order to install these tools on their

156
00:06:47,759 --> 00:06:49,020
device

157
00:06:49,020 --> 00:06:51,479
it's a very bold move but they got

158
00:06:51,479 --> 00:06:52,919
initial access

159
00:06:52,919 --> 00:06:55,440
so they have these tools on the first

160
00:06:55,440 --> 00:06:59,100
device and they use these tools for the

161
00:06:59,100 --> 00:07:01,380
next phases of the attack they deploy

162
00:07:01,380 --> 00:07:04,139
additional tools such as our clone and

163
00:07:04,139 --> 00:07:06,960
sharp shares and many others in order to

164
00:07:06,960 --> 00:07:09,539
explore the network locate sensitive

165
00:07:09,539 --> 00:07:12,479
files and information and explicate them

166
00:07:12,479 --> 00:07:13,680
outside

167
00:07:13,680 --> 00:07:15,840
once they believe that they have enough

168
00:07:15,840 --> 00:07:18,360
information on their hand they turn into

169
00:07:18,360 --> 00:07:21,960
the Final Phase which is extortion they

170
00:07:21,960 --> 00:07:24,060
send out a ransom demand to the

171
00:07:24,060 --> 00:07:26,220
organization demanding a large sum of

172
00:07:26,220 --> 00:07:28,620
money while holding the sensitive data

173
00:07:28,620 --> 00:07:31,020
hostage right so just to reiterate we're

174
00:07:31,020 --> 00:07:33,060
talking about short breaches

175
00:07:33,060 --> 00:07:37,080
very focused on the the the location and

176
00:07:37,080 --> 00:07:39,479
locating information and stealing it and

177
00:07:39,479 --> 00:07:42,120
then moving on to the extortion

178
00:07:42,120 --> 00:07:45,180
so this summarizes our background at

179
00:07:45,180 --> 00:07:48,479
this point we have these iocs and we

180
00:07:48,479 --> 00:07:51,960
want to start to find additional iot we

181
00:07:51,960 --> 00:07:53,759
want to understand this attacker's

182
00:07:53,759 --> 00:07:56,220
infrastructure naturally we turn to

183
00:07:56,220 --> 00:07:58,440
pivoting as you can see

184
00:07:58,440 --> 00:08:01,919
um and so let's start pivoting right

185
00:08:01,919 --> 00:08:04,860
so two years ago at Sun City I Summit

186
00:08:04,860 --> 00:08:08,180
Joe stovic shared with us this amazing

187
00:08:08,180 --> 00:08:11,880
visualization of how to Pivot on network

188
00:08:11,880 --> 00:08:14,940
infrastructure so the method takes each

189
00:08:14,940 --> 00:08:17,280
one of the indicator domain IP

190
00:08:17,280 --> 00:08:20,220
certificate and breaks them down into

191
00:08:20,220 --> 00:08:22,080
their building blocks into small

192
00:08:22,080 --> 00:08:24,780
observables so if you want to Pivot on

193
00:08:24,780 --> 00:08:27,000
domain name we can for example pivot on

194
00:08:27,000 --> 00:08:29,460
registrar or registrant if you want to

195
00:08:29,460 --> 00:08:31,860
Pivot on IP address you can for example

196
00:08:31,860 --> 00:08:34,140
pivot on hosting provider hosting

197
00:08:34,140 --> 00:08:38,159
location or on the jam Hash a quick

198
00:08:38,159 --> 00:08:41,219
refresher Jam is an active DLS server

199
00:08:41,219 --> 00:08:43,440
fingerprinting tool it's a very useful

200
00:08:43,440 --> 00:08:46,860
tool to Cluster servers together

201
00:08:46,860 --> 00:08:50,760
now I know this is highly theoretical in

202
00:08:50,760 --> 00:08:53,580
practice it all comes down to an Excel

203
00:08:53,580 --> 00:08:54,660
spreadsheet

204
00:08:54,660 --> 00:08:56,940
and this is a snippet from our Excel

205
00:08:56,940 --> 00:08:58,980
spreadsheet don't bother reading the

206
00:08:58,980 --> 00:09:00,959
information in the table it's not as

207
00:09:00,959 --> 00:09:03,779
important as the method so we first

208
00:09:03,779 --> 00:09:06,360
encountered Luna mode doing IR

209
00:09:06,360 --> 00:09:08,820
engagement and doing the investigation

210
00:09:08,820 --> 00:09:10,920
phase we collected all the indicators of

211
00:09:10,920 --> 00:09:13,140
compromise and then we wanted to Pivot

212
00:09:13,140 --> 00:09:17,040
so we took the iocs broke them down into

213
00:09:17,040 --> 00:09:19,740
their observables and put the data into

214
00:09:19,740 --> 00:09:21,360
the table

215
00:09:21,360 --> 00:09:23,640
since people think is an iterative

216
00:09:23,640 --> 00:09:26,160
process each new indicator that was

217
00:09:26,160 --> 00:09:28,380
discovered was broken down and inserted

218
00:09:28,380 --> 00:09:30,000
into the table

219
00:09:30,000 --> 00:09:32,760
analyzing the data in the table clear

220
00:09:32,760 --> 00:09:36,120
patterns were starting to emerge

221
00:09:36,120 --> 00:09:39,300
all the phishing domains shared enemy

222
00:09:39,300 --> 00:09:41,339
thing it was the name of a known service

223
00:09:41,339 --> 00:09:44,580
like Zoho or masterclass with the word

224
00:09:44,580 --> 00:09:47,339
appendages okay so Master Class cooking

225
00:09:47,339 --> 00:09:50,940
the hot teaching Master Duolingo class

226
00:09:50,940 --> 00:09:54,660
the top level domain was either.com or

227
00:09:54,660 --> 00:09:56,700
dot XYZ

228
00:09:56,700 --> 00:09:59,519
and there was no sub domain all the

229
00:09:59,519 --> 00:10:02,279
domains were registered under namecheap

230
00:10:02,279 --> 00:10:05,519
during 2022 in a short time spent before

231
00:10:05,519 --> 00:10:07,820
the actual campaign started

232
00:10:07,820 --> 00:10:11,220
analyzing the IP address information we

233
00:10:11,220 --> 00:10:14,399
noticed that all the domains were hosted

234
00:10:14,399 --> 00:10:16,980
under host wind and they share a

235
00:10:16,980 --> 00:10:19,680
specific Jam hush

236
00:10:19,680 --> 00:10:22,920
at first when we started to Pivot the

237
00:10:22,920 --> 00:10:25,560
jam hash looked promising

238
00:10:25,560 --> 00:10:28,560
but we quickly realized it yields far

239
00:10:28,560 --> 00:10:30,019
too many results

240
00:10:30,019 --> 00:10:32,519
turns out that the jump fingerprint we

241
00:10:32,519 --> 00:10:34,620
used actually fingerprints a clean

242
00:10:34,620 --> 00:10:37,260
installation of Apache web server on

243
00:10:37,260 --> 00:10:39,779
Ubuntu and clearly lunamo does not own

244
00:10:39,779 --> 00:10:43,620
all Apache web servers on Ubuntu so we

245
00:10:43,620 --> 00:10:46,740
decided to combine the jam hash with the

246
00:10:46,740 --> 00:10:50,160
hosting provider and we got few results

247
00:10:50,160 --> 00:10:52,740
to filter out additional cost positives

248
00:10:52,740 --> 00:10:55,800
we added the top level domain

249
00:10:55,800 --> 00:10:58,620
this allowed us to create a very strong

250
00:10:58,620 --> 00:11:01,740
signature that helped us identify the

251
00:11:01,740 --> 00:11:05,279
entire Luna modes infrastructure

252
00:11:05,279 --> 00:11:07,620
additional IR engagements that we

253
00:11:07,620 --> 00:11:10,440
conducted help us confirm and validate

254
00:11:10,440 --> 00:11:13,200
our signature and and I can tell you it

255
00:11:13,200 --> 00:11:14,760
feels great when the signature is

256
00:11:14,760 --> 00:11:17,640
created works and identifies attackers

257
00:11:17,640 --> 00:11:19,800
in the real world

258
00:11:19,800 --> 00:11:21,360
okay cool

259
00:11:21,360 --> 00:11:24,480
um so we have this signature on the

260
00:11:24,480 --> 00:11:27,060
infrastructure at this at this point of

261
00:11:27,060 --> 00:11:28,740
time we were starting to look for

262
00:11:28,740 --> 00:11:31,140
another key element that we can use in

263
00:11:31,140 --> 00:11:33,360
order to Pivot on this attack

264
00:11:33,360 --> 00:11:35,820
we decided to Deep dive into the PDF

265
00:11:35,820 --> 00:11:37,800
files that are sent out as part of the

266
00:11:37,800 --> 00:11:40,320
phishing scenarios and that's because uh

267
00:11:40,320 --> 00:11:42,600
we you can see them in all of the

268
00:11:42,600 --> 00:11:44,220
different luna moth attacks it's the

269
00:11:44,220 --> 00:11:46,440
first stage of the attack

270
00:11:46,440 --> 00:11:49,260
now the methodology behind pivoting on

271
00:11:49,260 --> 00:11:51,779
PDF files is not that different we just

272
00:11:51,779 --> 00:11:53,760
take the samples and break them down

273
00:11:53,760 --> 00:11:55,620
into different building blocks let's say

274
00:11:55,620 --> 00:11:58,440
for example the pdf version The Creator

275
00:11:58,440 --> 00:12:01,620
the producer the amount of pages in the

276
00:12:01,620 --> 00:12:03,480
file has all these different

277
00:12:03,480 --> 00:12:05,700
characteristics which we can use and

278
00:12:05,700 --> 00:12:07,500
work with in order to Pivot on these

279
00:12:07,500 --> 00:12:08,519
files

280
00:12:08,519 --> 00:12:11,040
now before we start it is important to

281
00:12:11,040 --> 00:12:13,019
understand our Viewpoint into the

282
00:12:13,019 --> 00:12:14,579
landscape

283
00:12:14,579 --> 00:12:16,860
um and as incident responders our

284
00:12:16,860 --> 00:12:19,920
Viewpoint is or are the incidents that

285
00:12:19,920 --> 00:12:23,640
we respond to and on top of those we add

286
00:12:23,640 --> 00:12:27,000
the layer of engine such as virustotal

287
00:12:27,000 --> 00:12:29,459
and many others in order to widen and

288
00:12:29,459 --> 00:12:32,459
broaden our pipeline as much as possible

289
00:12:32,459 --> 00:12:35,399
okay so we start with the complete

290
00:12:35,399 --> 00:12:38,160
Universe of PDF files that we have in

291
00:12:38,160 --> 00:12:40,260
our pipeline

292
00:12:40,260 --> 00:12:42,540
the first characteristic that we decided

293
00:12:42,540 --> 00:12:45,360
to look at touches to the process in

294
00:12:45,360 --> 00:12:48,180
which these PDF files are created

295
00:12:48,180 --> 00:12:53,639
we often like to look at these uh the

296
00:12:53,639 --> 00:12:56,700
way the files are created because in

297
00:12:56,700 --> 00:12:59,940
many cases when attackers send out Mass

298
00:12:59,940 --> 00:13:01,980
amounts of files they often have some

299
00:13:01,980 --> 00:13:04,260
sort of automated way or process of

300
00:13:04,260 --> 00:13:06,779
creating these files with Luna Moth they

301
00:13:06,779 --> 00:13:10,860
use a tool called WK HTML to pedia and

302
00:13:10,860 --> 00:13:13,920
by using this tool it also adds certain

303
00:13:13,920 --> 00:13:16,620
information to all of the different PDFs

304
00:13:16,620 --> 00:13:18,720
that they send out and you can see on

305
00:13:18,720 --> 00:13:21,300
the snippet to the right we have the pdf

306
00:13:21,300 --> 00:13:23,760
version we have the creator and producer

307
00:13:23,760 --> 00:13:26,339
tags that are added to all of the files

308
00:13:26,339 --> 00:13:28,380
that they send out

309
00:13:28,380 --> 00:13:30,959
so this is a good starting point right

310
00:13:30,959 --> 00:13:33,120
we can use this information we can take

311
00:13:33,120 --> 00:13:36,240
it in order to start pivoting but Luna

312
00:13:36,240 --> 00:13:38,100
Moss are not the only ones who are using

313
00:13:38,100 --> 00:13:40,620
this tool which means it's not a it's

314
00:13:40,620 --> 00:13:43,800
not a signature yet right however it did

315
00:13:43,800 --> 00:13:45,959
take us a step forward right we started

316
00:13:45,959 --> 00:13:49,019
with the whole universe of PDF files and

317
00:13:49,019 --> 00:13:51,420
we started narrowing it down to a

318
00:13:51,420 --> 00:13:53,339
smaller subset of files

319
00:13:53,339 --> 00:13:56,940
so next we started looking at the file

320
00:13:56,940 --> 00:13:59,399
structure we're talking about receipts

321
00:13:59,399 --> 00:14:02,579
about some kind of payment and all of

322
00:14:02,579 --> 00:14:04,800
the samples that we had only had one

323
00:14:04,800 --> 00:14:06,779
page and we can use this information

324
00:14:06,779 --> 00:14:09,060
right we can filter out anything that

325
00:14:09,060 --> 00:14:12,120
has more than one page right at this

326
00:14:12,120 --> 00:14:15,000
point we wanted to look at another layer

327
00:14:15,000 --> 00:14:18,180
we calculated the average file sizes of

328
00:14:18,180 --> 00:14:20,160
all the samples that we had

329
00:14:20,160 --> 00:14:22,079
we found out that when we limit the

330
00:14:22,079 --> 00:14:24,300
signature to look at files that range

331
00:14:24,300 --> 00:14:27,480
between 30 and 50 kilobytes in size we

332
00:14:27,480 --> 00:14:29,760
were left with a subset of files that

333
00:14:29,760 --> 00:14:31,680
were all related to Luna month campaigns

334
00:14:31,680 --> 00:14:36,420
now that's amazing now theoretically if

335
00:14:36,420 --> 00:14:38,940
that was not enough we could also add

336
00:14:38,940 --> 00:14:41,279
another layer of the process right let's

337
00:14:41,279 --> 00:14:43,560
say for example looking at the file

338
00:14:43,560 --> 00:14:46,500
contents itself we know this is a

339
00:14:46,500 --> 00:14:48,560
subscription related

340
00:14:48,560 --> 00:14:50,940
receipt right so we can look for any

341
00:14:50,940 --> 00:14:53,279
keywords that might be found in these

342
00:14:53,279 --> 00:14:56,160
files in this case we didn't add this

343
00:14:56,160 --> 00:14:58,560
layer but of course we could if if it

344
00:14:58,560 --> 00:14:59,639
was needed

345
00:14:59,639 --> 00:15:02,639
so we started with the whole universe of

346
00:15:02,639 --> 00:15:05,339
PDF files in our Pipeline and we ended

347
00:15:05,339 --> 00:15:07,560
with a subset of files that were all

348
00:15:07,560 --> 00:15:09,720
related to Luna moth's Campaign which

349
00:15:09,720 --> 00:15:12,779
means we have another signature right so

350
00:15:12,779 --> 00:15:15,180
we have the first signature on the

351
00:15:15,180 --> 00:15:17,940
domains and infrastructure we have this

352
00:15:17,940 --> 00:15:21,959
second signature on the PDF files and

353
00:15:21,959 --> 00:15:24,240
then the question to you guys is what's

354
00:15:24,240 --> 00:15:26,279
next naturally

355
00:15:26,279 --> 00:15:29,339
because we want to track this group we

356
00:15:29,339 --> 00:15:32,579
turn to automating the process of using

357
00:15:32,579 --> 00:15:34,620
these signatures

358
00:15:34,620 --> 00:15:35,220
um

359
00:15:35,220 --> 00:15:37,260
so you can see on the right there's a

360
00:15:37,260 --> 00:15:39,540
alert of the that popped up as part of

361
00:15:39,540 --> 00:15:42,600
this automation process it's showing two

362
00:15:42,600 --> 00:15:44,760
new domains that luna moth registered

363
00:15:44,760 --> 00:15:48,060
back in June uh one is related to a

364
00:15:48,060 --> 00:15:50,100
Master Class campaign the other two a

365
00:15:50,100 --> 00:15:51,740
Duolingo campaign doesn't really matter

366
00:15:51,740 --> 00:15:54,180
but we have some sort of automated

367
00:15:54,180 --> 00:15:57,000
process that's popping up new domains

368
00:15:57,000 --> 00:16:00,240
that we think are related to Luna months

369
00:16:00,240 --> 00:16:02,120
potentially of course

370
00:16:02,120 --> 00:16:05,220
another angle that these two signatures

371
00:16:05,220 --> 00:16:07,740
helped us with is to determine the start

372
00:16:07,740 --> 00:16:11,100
start starting point in time of of Luna

373
00:16:11,100 --> 00:16:13,260
moth's operation and that dated back to

374
00:16:13,260 --> 00:16:15,720
March of 2022 right but the first

375
00:16:15,720 --> 00:16:17,459
samples that we saw the first domain

376
00:16:17,459 --> 00:16:20,220
that we saw in register

377
00:16:20,220 --> 00:16:22,860
um a couple months after we we reached

378
00:16:22,860 --> 00:16:24,899
this conclusion and published it in our

379
00:16:24,899 --> 00:16:27,660
blog post uh we also saw uh Advanced

380
00:16:27,660 --> 00:16:31,139
Intel I released a nice paper on on this

381
00:16:31,139 --> 00:16:32,100
group

382
00:16:32,100 --> 00:16:33,959
where they reached that same conclusion

383
00:16:33,959 --> 00:16:36,660
and it's always nice to see other fellow

384
00:16:36,660 --> 00:16:38,519
researchers reach these same same

385
00:16:38,519 --> 00:16:40,860
conclusions about these groups

386
00:16:40,860 --> 00:16:44,040
now one thing about automation that we

387
00:16:44,040 --> 00:16:46,139
really really want to share with you is

388
00:16:46,139 --> 00:16:49,100
that in practice many times automation

389
00:16:49,100 --> 00:16:52,620
doesn't doesn't go as as neat as we want

390
00:16:52,620 --> 00:16:55,019
it to right sometimes we have false

391
00:16:55,019 --> 00:16:57,300
positives now the new alert you can see

392
00:16:57,300 --> 00:17:00,600
on screen shows three different domains

393
00:17:00,600 --> 00:17:03,120
two of these domains are actually really

394
00:17:03,120 --> 00:17:04,919
related to Luna Moth but the one in the

395
00:17:04,919 --> 00:17:06,299
middle is not connected at all right

396
00:17:06,299 --> 00:17:08,099
it's a false positive

397
00:17:08,099 --> 00:17:10,980
so since we want to create threat

398
00:17:10,980 --> 00:17:13,020
intelligence or actionable threat

399
00:17:13,020 --> 00:17:14,819
intelligence in the form of domains that

400
00:17:14,819 --> 00:17:17,280
we can block and we don't want to block

401
00:17:17,280 --> 00:17:19,439
legitimate domains

402
00:17:19,439 --> 00:17:22,079
um this is a problem right we can't just

403
00:17:22,079 --> 00:17:25,619
use this information and stream it

404
00:17:25,619 --> 00:17:28,199
um so what we decided to do with this

405
00:17:28,199 --> 00:17:30,419
problem is use two different layers

406
00:17:30,419 --> 00:17:33,240
through our process of automation the

407
00:17:33,240 --> 00:17:35,580
first layer of automation uses a more

408
00:17:35,580 --> 00:17:38,280
permissive signature and this is exactly

409
00:17:38,280 --> 00:17:40,320
what you see right now on the screen it

410
00:17:40,320 --> 00:17:42,360
allows these false positives right

411
00:17:42,360 --> 00:17:45,660
however and more importantly it allows

412
00:17:45,660 --> 00:17:48,660
us to determine the new campaign themes

413
00:17:48,660 --> 00:17:50,340
as they emerge

414
00:17:50,340 --> 00:17:54,120
and by knowing these new themes as they

415
00:17:54,120 --> 00:17:56,700
emerge we can actually use it and apply

416
00:17:56,700 --> 00:17:59,280
it to the second layer of automation to

417
00:17:59,280 --> 00:18:02,460
filter out or actually filter in only

418
00:18:02,460 --> 00:18:05,100
domains that are related to these new

419
00:18:05,100 --> 00:18:06,419
themes

420
00:18:06,419 --> 00:18:09,840
so we have an automated way

421
00:18:09,840 --> 00:18:14,179
to find new domains find new PDF samples

422
00:18:14,179 --> 00:18:16,740
we know they're related there's a

423
00:18:16,740 --> 00:18:18,720
connection between the PDF files to

424
00:18:18,720 --> 00:18:20,820
these domains so we have some sort of

425
00:18:20,820 --> 00:18:23,880
validation that we're on the right track

426
00:18:23,880 --> 00:18:28,020
which is exactly what we were aiming at

427
00:18:28,020 --> 00:18:31,080
we also took the signature on the PDF

428
00:18:31,080 --> 00:18:35,280
files and applied it and across time a

429
00:18:35,280 --> 00:18:38,039
bunch of different samples popped up you

430
00:18:38,039 --> 00:18:40,980
can see uh a few of them on screen

431
00:18:40,980 --> 00:18:42,720
um one thing to note about all these

432
00:18:42,720 --> 00:18:45,000
samples is that they all share a certain

433
00:18:45,000 --> 00:18:48,419
footer they all say secured with SSL and

434
00:18:48,419 --> 00:18:50,039
of course we know that if it says secure

435
00:18:50,039 --> 00:18:52,200
with SSL the actual vendor incentive

436
00:18:52,200 --> 00:18:55,580
right of course if

437
00:18:55,679 --> 00:18:59,160
so taking all the information created by

438
00:18:59,160 --> 00:19:01,860
the automation process and putting it

439
00:19:01,860 --> 00:19:06,480
into a graph allowed us to analyze past

440
00:19:06,480 --> 00:19:08,460
lunar mod campaigns and complete

441
00:19:08,460 --> 00:19:10,799
continue tracking the goal it also

442
00:19:10,799 --> 00:19:13,860
allowed us to identify patterns at the

443
00:19:13,860 --> 00:19:16,559
macro level so if we go back to the

444
00:19:16,559 --> 00:19:19,140
beginning of lunar month activity

445
00:19:19,140 --> 00:19:22,919
we can see that in April and May they

446
00:19:22,919 --> 00:19:24,919
would run multiple campaigns

447
00:19:24,919 --> 00:19:26,900
simultaneously for example for

448
00:19:26,900 --> 00:19:30,539
masterclass subscription scam and

449
00:19:30,539 --> 00:19:31,980
Duolingo

450
00:19:31,980 --> 00:19:35,160
a July all their campaigns suddenly

451
00:19:35,160 --> 00:19:38,280
stopped this is when signia published

452
00:19:38,280 --> 00:19:41,039
our blog post on the group and we would

453
00:19:41,039 --> 00:19:42,360
like to believe that we have the power

454
00:19:42,360 --> 00:19:44,340
to stop touching it

455
00:19:44,340 --> 00:19:47,400
after a month of Silence the group to

456
00:19:47,400 --> 00:19:49,559
return the resume their activity but

457
00:19:49,559 --> 00:19:52,080
this time the picnic was a bit different

458
00:19:52,080 --> 00:19:55,440
so instead of running multiple campaigns

459
00:19:55,440 --> 00:19:58,160
simultaneously they would switch

460
00:19:58,160 --> 00:20:01,559
campaigns approximately each month so

461
00:20:01,559 --> 00:20:04,200
from class pass to Philo to Bubble to

462
00:20:04,200 --> 00:20:06,799
curiosity

463
00:20:07,280 --> 00:20:10,559
although the the different campaigns use

464
00:20:10,559 --> 00:20:13,919
different teams our signature was still

465
00:20:13,919 --> 00:20:15,539
valid because they did not change their

466
00:20:15,539 --> 00:20:18,299
ttps so we were able to track the

467
00:20:18,299 --> 00:20:21,720
group's activity for almost a year we

468
00:20:21,720 --> 00:20:23,520
are still tracking them and we are

469
00:20:23,520 --> 00:20:25,740
waiting to see what fishing team they

470
00:20:25,740 --> 00:20:28,559
have next to us

471
00:20:28,559 --> 00:20:31,500
Okay cool so I see the timer there we

472
00:20:31,500 --> 00:20:35,039
need to start wrapping things up

473
00:20:35,039 --> 00:20:37,440
um we talked about Luna months we talked

474
00:20:37,440 --> 00:20:39,299
about callback fishing we understand

475
00:20:39,299 --> 00:20:40,799
this technique

476
00:20:40,799 --> 00:20:42,780
through this case study we wanted to

477
00:20:42,780 --> 00:20:46,080
show you our process our thought process

478
00:20:46,080 --> 00:20:49,020
step by step of how we took these iocs

479
00:20:49,020 --> 00:20:51,299
how we broke them down and through this

480
00:20:51,299 --> 00:20:53,400
process of pivoting created these

481
00:20:53,400 --> 00:20:56,280
signatures to track this through

482
00:20:56,280 --> 00:20:58,860
to do this we first needed to understand

483
00:20:58,860 --> 00:21:01,200
our Viewpoint into the landscape and

484
00:21:01,200 --> 00:21:03,900
widen it as much as possible and then by

485
00:21:03,900 --> 00:21:05,340
working through a structured line of

486
00:21:05,340 --> 00:21:07,440
thought we're able to connect all the

487
00:21:07,440 --> 00:21:09,660
different dots and uncover this

488
00:21:09,660 --> 00:21:11,100
infrastructure

489
00:21:11,100 --> 00:21:13,140
attackers and even the most

490
00:21:13,140 --> 00:21:15,840
sophisticated ones often leave ways we

491
00:21:15,840 --> 00:21:18,900
can use to track their infrastructure

492
00:21:18,900 --> 00:21:22,740
now we talked a lot about Luna moss and

493
00:21:22,740 --> 00:21:26,100
this type of family of threats that

494
00:21:26,100 --> 00:21:30,120
focus on on the human factor right these

495
00:21:30,120 --> 00:21:32,039
might not be the most technologically

496
00:21:32,039 --> 00:21:33,840
sophisticated threats

497
00:21:33,840 --> 00:21:37,860
but as such they often sometimes over

498
00:21:37,860 --> 00:21:40,080
overcome the security stack that we have

499
00:21:40,080 --> 00:21:41,520
right

500
00:21:41,520 --> 00:21:43,919
now in order to tackle and Bridge this

501
00:21:43,919 --> 00:21:47,340
Gap we we turn to threat intelligence to

502
00:21:47,340 --> 00:21:49,260
be able to create

503
00:21:49,260 --> 00:21:51,179
actionable threat intelligence in the

504
00:21:51,179 --> 00:21:54,299
form of ioc that we can block even

505
00:21:54,299 --> 00:21:56,820
before we see them being used in

506
00:21:56,820 --> 00:21:58,200
breaches

507
00:21:58,200 --> 00:21:59,880
another angle to this threat

508
00:21:59,880 --> 00:22:01,559
intelligence that we

509
00:22:01,559 --> 00:22:04,140
we took is that we provided this

510
00:22:04,140 --> 00:22:07,200
information to authorities and worked

511
00:22:07,200 --> 00:22:08,940
with them in order to track this group

512
00:22:08,940 --> 00:22:10,980
while they were running their operation

513
00:22:10,980 --> 00:22:13,140
of course you can learn a lot about a

514
00:22:13,140 --> 00:22:15,179
group when you track them while they're

515
00:22:15,179 --> 00:22:18,320
running their operation

516
00:22:18,780 --> 00:22:21,659
so we shared with you the research that

517
00:22:21,659 --> 00:22:24,600
we conducted and the two signatures that

518
00:22:24,600 --> 00:22:26,280
we created

519
00:22:26,280 --> 00:22:28,860
our goal was to show you how you can

520
00:22:28,860 --> 00:22:33,120
take separated isolated iocs and create

521
00:22:33,120 --> 00:22:36,120
a strong signature the method that we

522
00:22:36,120 --> 00:22:38,159
used was to take the indicators of

523
00:22:38,159 --> 00:22:40,559
compromise and break them down into

524
00:22:40,559 --> 00:22:42,120
their building block into small

525
00:22:42,120 --> 00:22:44,760
observables and then we started pivoting

526
00:22:44,760 --> 00:22:48,419
on these observables the the problem or

527
00:22:48,419 --> 00:22:50,220
the challenge that you have when you

528
00:22:50,220 --> 00:22:53,940
pivot on such small indicators that you

529
00:22:53,940 --> 00:22:56,760
are likely to get a lot of results

530
00:22:56,760 --> 00:22:59,159
for example the jamas that we started

531
00:22:59,159 --> 00:23:01,320
with retired nearly half a Million

532
00:23:01,320 --> 00:23:02,220
results

533
00:23:02,220 --> 00:23:04,740
and this makes you think that you are

534
00:23:04,740 --> 00:23:06,659
not on the right path

535
00:23:06,659 --> 00:23:09,480
but when we started to combine the

536
00:23:09,480 --> 00:23:12,360
different observables together we were

537
00:23:12,360 --> 00:23:14,880
able to refine our signature by by

538
00:23:14,880 --> 00:23:17,400
layering the different building blocks

539
00:23:17,400 --> 00:23:19,980
on top of each other we were able to

540
00:23:19,980 --> 00:23:22,559
create a very robust signature that

541
00:23:22,559 --> 00:23:25,080
allowed us to create that allowed us to

542
00:23:25,080 --> 00:23:27,840
track the group over a long period of

543
00:23:27,840 --> 00:23:31,020
time and multiple campaign

544
00:23:31,020 --> 00:23:33,840
so the next time that you get half a

545
00:23:33,840 --> 00:23:36,299
Million results remember that you might

546
00:23:36,299 --> 00:23:38,880
just be on the right path

547
00:23:38,880 --> 00:23:41,840
thank you very much

548
00:23:42,539 --> 00:23:44,720
thank you

