1
00:00:00,659 --> 00:00:02,960
foreign

2
00:00:05,700 --> 00:00:08,220
thank you all very much for coming along

3
00:00:08,220 --> 00:00:09,960
today

4
00:00:09,960 --> 00:00:12,480
um as we introduce my name is Josh and

5
00:00:12,480 --> 00:00:14,340
and Megan but we do have to give a big

6
00:00:14,340 --> 00:00:17,520
shout out also to David and Pierre who

7
00:00:17,520 --> 00:00:19,320
are out there sometimes in the audience

8
00:00:19,320 --> 00:00:21,840
so uh feel free to go and hassle them as

9
00:00:21,840 --> 00:00:23,460
well and ask them lots and lots of

10
00:00:23,460 --> 00:00:27,300
questions about Cloud forensics as well

11
00:00:27,300 --> 00:00:30,180
so we essentially we wanted to put

12
00:00:30,180 --> 00:00:32,520
together a bit of content to kind of

13
00:00:32,520 --> 00:00:34,500
help people and to kind of give them

14
00:00:34,500 --> 00:00:36,420
something to take away if they have to

15
00:00:36,420 --> 00:00:39,360
do investigations in the cloud one of

16
00:00:39,360 --> 00:00:41,520
the one of the biggest challenges I know

17
00:00:41,520 --> 00:00:44,040
that I kind of find when working with

18
00:00:44,040 --> 00:00:45,840
clients or when working with the victims

19
00:00:45,840 --> 00:00:48,300
of incidents is that often you kind of

20
00:00:48,300 --> 00:00:49,559
go all right

21
00:00:49,559 --> 00:00:51,120
um like what infrastructure have you got

22
00:00:51,120 --> 00:00:52,140
and they're like all right we've got

23
00:00:52,140 --> 00:00:55,860
Microsoft 365 or we've got AWS so we've

24
00:00:55,860 --> 00:00:57,840
got Google Cloud it's like all right

25
00:00:57,840 --> 00:01:00,899
cool have you turned on logs or what is

26
00:01:00,899 --> 00:01:02,100
turned on or what's not turned on

27
00:01:02,100 --> 00:01:04,140
they're like turned on logs what what is

28
00:01:04,140 --> 00:01:07,619
that so hopefully today will give you

29
00:01:07,619 --> 00:01:09,060
something to take away in terms of

30
00:01:09,060 --> 00:01:11,159
understanding what is turned on by

31
00:01:11,159 --> 00:01:13,380
default and what is not turned on by

32
00:01:13,380 --> 00:01:15,960
default and how you can potentially

33
00:01:15,960 --> 00:01:18,960
extend the life of the evidence that you

34
00:01:18,960 --> 00:01:20,700
have sitting up inside of your Cloud

35
00:01:20,700 --> 00:01:22,020
platforms

36
00:01:22,020 --> 00:01:23,880
now

37
00:01:23,880 --> 00:01:25,259
um we're going to very much try to take

38
00:01:25,259 --> 00:01:27,360
this fast because there's a lot of

39
00:01:27,360 --> 00:01:29,580
content to cover so feel free to ask

40
00:01:29,580 --> 00:01:32,460
questions as um as we kind of come off I

41
00:01:32,460 --> 00:01:33,240
think we're gonna leave five minutes

42
00:01:33,240 --> 00:01:34,799
towards the end but if there's more

43
00:01:34,799 --> 00:01:36,900
questions hit us up in Slack

44
00:01:36,900 --> 00:01:38,340
so as we kind of introduce my name is

45
00:01:38,340 --> 00:01:39,840
Josh lemon I also work for a company

46
00:01:39,840 --> 00:01:41,520
called ancura which is an international

47
00:01:41,520 --> 00:01:43,619
consulting company and I look after

48
00:01:43,619 --> 00:01:46,200
their digital forensics and IR team out

49
00:01:46,200 --> 00:01:49,259
in Asia Pacific so yes if my accent

50
00:01:49,259 --> 00:01:51,659
sounds a little unusual it's probably

51
00:01:51,659 --> 00:01:53,820
now a mix of Australian and American and

52
00:01:53,820 --> 00:01:55,140
a little bit of British all mixed

53
00:01:55,140 --> 00:01:57,479
together now but outside of that I'm

54
00:01:57,479 --> 00:02:00,180
also a co-author with sand so I look

55
00:02:00,180 --> 00:02:03,240
after the cloud class and also the dfir

56
00:02:03,240 --> 00:02:05,579
net Wars class as well

57
00:02:05,579 --> 00:02:07,799
um with uh I think ladrina's here as

58
00:02:07,799 --> 00:02:09,360
well so make sure you hit her up and say

59
00:02:09,360 --> 00:02:12,959
hello and then I also teach the 508 572

60
00:02:12,959 --> 00:02:16,379
and the 509 class as well

61
00:02:16,379 --> 00:02:19,140
my name is Megan Roddy I work at a small

62
00:02:19,140 --> 00:02:20,459
company you might have heard of called

63
00:02:20,459 --> 00:02:23,940
IBM as a senior security engineer with

64
00:02:23,940 --> 00:02:26,099
X-Force I'm based out of Austin here so

65
00:02:26,099 --> 00:02:27,720
I'm very happy to have us here in my

66
00:02:27,720 --> 00:02:29,340
hometown I love coming to the deeper

67
00:02:29,340 --> 00:02:32,160
Summit not a far trip and a great time

68
00:02:32,160 --> 00:02:34,920
I'm also one of the co-authors of sans

69
00:02:34,920 --> 00:02:37,020
forensic 509 I'm focused on Google

70
00:02:37,020 --> 00:02:39,420
workspace our Labs uh so if you're

71
00:02:39,420 --> 00:02:41,519
taking that course this week you have a

72
00:02:41,519 --> 00:02:44,099
feedback for sure let me know and it'd

73
00:02:44,099 --> 00:02:45,360
be remiss of me not to use this

74
00:02:45,360 --> 00:02:47,400
opportunity to give a shout out to our

75
00:02:47,400 --> 00:02:50,220
my non-profit mental health hackers the

76
00:02:50,220 --> 00:02:52,319
CFO over there we're doing great work uh

77
00:02:52,319 --> 00:02:54,000
trying to bring mental health awareness

78
00:02:54,000 --> 00:02:56,519
to the industry so go check that out if

79
00:02:56,519 --> 00:02:59,220
you get the opportunity

80
00:02:59,220 --> 00:03:01,560
okay let's have a look at some of the

81
00:03:01,560 --> 00:03:03,300
stuff that we've got so common question

82
00:03:03,300 --> 00:03:05,760
is we're using the cloud what happens if

83
00:03:05,760 --> 00:03:08,220
we have an incident there well it really

84
00:03:08,220 --> 00:03:09,480
depends a little bit too and also

85
00:03:09,480 --> 00:03:12,120
depends on which Cloud you're using now

86
00:03:12,120 --> 00:03:15,120
today in the space of uh just over 30

87
00:03:15,120 --> 00:03:16,800
minutes left we're going to try and

88
00:03:16,800 --> 00:03:20,400
really rapidly run you through AWS Azure

89
00:03:20,400 --> 00:03:23,519
Google Cloud M365 and also Google

90
00:03:23,519 --> 00:03:26,580
workspace Now understand this is all

91
00:03:26,580 --> 00:03:28,980
compressed into a space of sort of 35

92
00:03:28,980 --> 00:03:31,440
minutes so yes there are things we're

93
00:03:31,440 --> 00:03:33,360
going to have to cross over and yes

94
00:03:33,360 --> 00:03:34,379
there are things we're going to have to

95
00:03:34,379 --> 00:03:36,720
assume as part of it but we want to try

96
00:03:36,720 --> 00:03:38,760
to give you enough information to kind

97
00:03:38,760 --> 00:03:40,379
of make you curious and to go and look

98
00:03:40,379 --> 00:03:42,180
at these things inside of your own

99
00:03:42,180 --> 00:03:44,519
environments okay so let's see how far

100
00:03:44,519 --> 00:03:47,099
we can uh we can get in 35 minutes

101
00:03:47,099 --> 00:03:49,260
so to start off with big thing to

102
00:03:49,260 --> 00:03:51,060
understand with the cloud platform your

103
00:03:51,060 --> 00:03:53,400
evidence Source or at least your primary

104
00:03:53,400 --> 00:03:56,599
evidence source is going to be logs

105
00:03:56,599 --> 00:04:00,000
unlike if you've taken the forensics 508

106
00:04:00,000 --> 00:04:02,040
class or the 500 classes where you get

107
00:04:02,040 --> 00:04:03,920
disk images or you get memory images

108
00:04:03,920 --> 00:04:06,720
inside of the cloud your primary

109
00:04:06,720 --> 00:04:09,120
forensic source is logs it's not your

110
00:04:09,120 --> 00:04:11,700
only forensic Source but that is the

111
00:04:11,700 --> 00:04:12,900
evidence source that you have to get

112
00:04:12,900 --> 00:04:15,120
comfortable with and it changes

113
00:04:15,120 --> 00:04:17,519
depending on what type of service you're

114
00:04:17,519 --> 00:04:20,579
actually using inside of the cloud now

115
00:04:20,579 --> 00:04:22,260
if you're using infrastructure as a

116
00:04:22,260 --> 00:04:24,060
service and that's your virtual machines

117
00:04:24,060 --> 00:04:26,040
inside of the cloud you actually have

118
00:04:26,040 --> 00:04:28,139
quite a lot of logs which is really good

119
00:04:28,139 --> 00:04:29,520
like if you're using those virtual

120
00:04:29,520 --> 00:04:31,380
machines lots of logs sitting there for

121
00:04:31,380 --> 00:04:33,720
you to use and to go and consume but if

122
00:04:33,720 --> 00:04:36,419
you're using things like kubernetes or

123
00:04:36,419 --> 00:04:39,060
containers inside of that platform as a

124
00:04:39,060 --> 00:04:41,639
service the logs start to diminish in

125
00:04:41,639 --> 00:04:43,680
terms of how much logs you actually have

126
00:04:43,680 --> 00:04:46,320
access to inside of the cloud platforms

127
00:04:46,320 --> 00:04:48,540
and then even when you start to move up

128
00:04:48,540 --> 00:04:51,000
to things like software as a service the

129
00:04:51,000 --> 00:04:53,580
log sources again start to diminish or

130
00:04:53,580 --> 00:04:56,220
at least they start to get limited based

131
00:04:56,220 --> 00:04:58,080
on what the vendor is going to actually

132
00:04:58,080 --> 00:05:00,240
provide you and you'll see in a minute

133
00:05:00,240 --> 00:05:03,060
particularly in that SAS space that it

134
00:05:03,060 --> 00:05:04,620
changes quite a lot between things like

135
00:05:04,620 --> 00:05:07,380
M365 and Google workspace as well and

136
00:05:07,380 --> 00:05:09,540
you are really very much in the hands of

137
00:05:09,540 --> 00:05:11,460
the vendor of what they're going to hand

138
00:05:11,460 --> 00:05:13,560
over to you to allow you to do some type

139
00:05:13,560 --> 00:05:15,240
of investigation

140
00:05:15,240 --> 00:05:17,280
so quick takeaway here you've got

141
00:05:17,280 --> 00:05:18,720
infrastructure as a service you've got a

142
00:05:18,720 --> 00:05:20,639
lot of logs behind it if you're in that

143
00:05:20,639 --> 00:05:22,380
software as a service platform you have

144
00:05:22,380 --> 00:05:23,820
to engage with the vendor and understand

145
00:05:23,820 --> 00:05:25,020
what they're going to give you by

146
00:05:25,020 --> 00:05:27,360
default but also what is it that you can

147
00:05:27,360 --> 00:05:29,400
call upon them for in the time that you

148
00:05:29,400 --> 00:05:31,560
actually do have a big incident

149
00:05:31,560 --> 00:05:33,300
the other thing to understand too just

150
00:05:33,300 --> 00:05:35,699
from a conceptual background with logs

151
00:05:35,699 --> 00:05:38,580
inside of the the cloud platforms we

152
00:05:38,580 --> 00:05:40,139
kind of break these down into sort of

153
00:05:40,139 --> 00:05:43,680
five broad categories now we've kind of

154
00:05:43,680 --> 00:05:45,300
broken them into five broad categories

155
00:05:45,300 --> 00:05:47,880
to make them best fit and also we've

156
00:05:47,880 --> 00:05:49,680
kind of broken this down from top to

157
00:05:49,680 --> 00:05:51,780
bottom to also kind of show you what

158
00:05:51,780 --> 00:05:53,460
things you should start to look at to

159
00:05:53,460 --> 00:05:54,960
begin with when it comes to a cloud

160
00:05:54,960 --> 00:05:57,240
investigation so to start with you've

161
00:05:57,240 --> 00:05:59,340
got identity and access management

162
00:05:59,340 --> 00:06:01,860
almost everything in the cloud has some

163
00:06:01,860 --> 00:06:04,440
type of authentication tied to it so

164
00:06:04,440 --> 00:06:06,360
start there that is the best place to

165
00:06:06,360 --> 00:06:07,620
start when it comes to doing an

166
00:06:07,620 --> 00:06:10,320
investigation we then have platform

167
00:06:10,320 --> 00:06:13,380
based logs as well they're the logs that

168
00:06:13,380 --> 00:06:14,220
say

169
00:06:14,220 --> 00:06:16,080
um that Megan interacted with a

170
00:06:16,080 --> 00:06:19,139
different API inside of the cloud or

171
00:06:19,139 --> 00:06:20,639
Megan tried to look at something

172
00:06:20,639 --> 00:06:23,220
specific inside of the cloud they're the

173
00:06:23,220 --> 00:06:25,199
things that tell us what a user is doing

174
00:06:25,199 --> 00:06:27,120
as they move around inside of that cloud

175
00:06:27,120 --> 00:06:30,060
platform then we have our Resource

176
00:06:30,060 --> 00:06:32,580
Management logs and pretty much the top

177
00:06:32,580 --> 00:06:33,979
three here are

178
00:06:33,979 --> 00:06:37,380
in most cases most cases but they're

179
00:06:37,380 --> 00:06:38,940
like a big asterisk at the end of it

180
00:06:38,940 --> 00:06:42,180
turned on by default in most cases

181
00:06:42,180 --> 00:06:44,100
and the resource management ones tell me

182
00:06:44,100 --> 00:06:47,160
what resources someone has spun up so

183
00:06:47,160 --> 00:06:50,039
did Megan create a virtual machine did

184
00:06:50,039 --> 00:06:52,440
she spin up an S3 bucket to store data

185
00:06:52,440 --> 00:06:54,840
inside of it so that tells me what has

186
00:06:54,840 --> 00:06:57,180
occurred with the resources now the

187
00:06:57,180 --> 00:06:59,100
fourth one here this is where things

188
00:06:59,100 --> 00:07:00,720
start to get a bit gray and whether

189
00:07:00,720 --> 00:07:02,520
these are turned on or off by default

190
00:07:02,520 --> 00:07:04,800
depends on the platform and sometimes

191
00:07:04,800 --> 00:07:06,240
depends on whether you've turned them

192
00:07:06,240 --> 00:07:08,699
off and in some unusual cases depends on

193
00:07:08,699 --> 00:07:11,220
when you created your tenancy as well so

194
00:07:11,220 --> 00:07:13,860
resource logs are really based around

195
00:07:13,860 --> 00:07:17,819
the actions that a resource takes so for

196
00:07:17,819 --> 00:07:21,780
example if we have AWS and Megan spun up

197
00:07:21,780 --> 00:07:24,720
an S3 bucket she would get a resource

198
00:07:24,720 --> 00:07:26,819
management log to say that new S3 bucket

199
00:07:26,819 --> 00:07:29,099
was created by Megan but if she started

200
00:07:29,099 --> 00:07:31,680
to do things like put files inside of

201
00:07:31,680 --> 00:07:34,080
that bucket these are logs that are

202
00:07:34,080 --> 00:07:35,580
based around what is occurring inside

203
00:07:35,580 --> 00:07:37,199
the bucket itself and when you consider

204
00:07:37,199 --> 00:07:40,919
these resource logs that fourth one from

205
00:07:40,919 --> 00:07:43,680
the top now in a lot of cases as I said

206
00:07:43,680 --> 00:07:45,599
they're off by default so you have to go

207
00:07:45,599 --> 00:07:47,039
and turn those on then the one right

208
00:07:47,039 --> 00:07:48,960
down the bottom there application logs

209
00:07:48,960 --> 00:07:51,419
really applies to Virtual machines or

210
00:07:51,419 --> 00:07:53,940
applications running inside the the

211
00:07:53,940 --> 00:07:55,740
cloud and sucking those logs out as well

212
00:07:55,740 --> 00:07:57,780
again it varies depending on cloud

213
00:07:57,780 --> 00:07:59,460
platform as to whether they're on or off

214
00:07:59,460 --> 00:08:01,139
by default

215
00:08:01,139 --> 00:08:03,960
again the takeaway here is that these

216
00:08:03,960 --> 00:08:05,819
are the sort of the five categories we

217
00:08:05,819 --> 00:08:08,759
try to sort of put logs into across all

218
00:08:08,759 --> 00:08:10,919
the cloud platforms to make some sort of

219
00:08:10,919 --> 00:08:13,620
standard or make them understandable for

220
00:08:13,620 --> 00:08:16,500
most people across all the platforms

221
00:08:16,500 --> 00:08:18,120
now the next thing that people kind of

222
00:08:18,120 --> 00:08:19,440
go to is they go all right let's get

223
00:08:19,440 --> 00:08:21,240
these logs out of the platforms Josh and

224
00:08:21,240 --> 00:08:22,860
Megan told us about all these cool logs

225
00:08:22,860 --> 00:08:24,000
we've been going to investigate them

226
00:08:24,000 --> 00:08:26,099
let's dump them into something and see

227
00:08:26,099 --> 00:08:27,720
prettiness let's go and see these pretty

228
00:08:27,720 --> 00:08:30,060
dashboards and we'll just see evil pop

229
00:08:30,060 --> 00:08:32,520
out all of a sudden this is a lot of

230
00:08:32,520 --> 00:08:34,620
what people expect to see from uh

231
00:08:34,620 --> 00:08:37,020
investigating a cloud environment the

232
00:08:37,020 --> 00:08:39,179
reality of what you often see though is

233
00:08:39,179 --> 00:08:42,479
more like this these are raw logs out of

234
00:08:42,479 --> 00:08:44,039
the platform they don't come out pretty

235
00:08:44,039 --> 00:08:45,959
they don't come out with lovely Graphics

236
00:08:45,959 --> 00:08:47,459
by default

237
00:08:47,459 --> 00:08:49,980
this is more of what you actually get

238
00:08:49,980 --> 00:08:52,200
out of that cloud platform this is an

239
00:08:52,200 --> 00:08:53,760
example from

240
00:08:53,760 --> 00:08:55,620
um from Microsoft's platform as part of

241
00:08:55,620 --> 00:08:56,580
it

242
00:08:56,580 --> 00:08:59,220
so how do we get this into something

243
00:08:59,220 --> 00:09:01,320
that looks like that pretty graphic that

244
00:09:01,320 --> 00:09:02,700
we saw here

245
00:09:02,700 --> 00:09:04,980
well a lot of the time we have to

246
00:09:04,980 --> 00:09:07,740
basically basically take those logs and

247
00:09:07,740 --> 00:09:09,480
then convert them enrich them and

248
00:09:09,480 --> 00:09:11,940
transpose them into something useful

249
00:09:11,940 --> 00:09:13,380
so a lot of times you have to take the

250
00:09:13,380 --> 00:09:16,200
logs you parse them out you then do

251
00:09:16,200 --> 00:09:18,000
enrichment with them so we can do things

252
00:09:18,000 --> 00:09:20,459
like goip lookup it's pretty a pretty

253
00:09:20,459 --> 00:09:22,680
common one and then start to ingest them

254
00:09:22,680 --> 00:09:24,480
into some sort of log aggregation

255
00:09:24,480 --> 00:09:26,940
platform and this can be anything this

256
00:09:26,940 --> 00:09:29,519
can be your elk stack this can be Splunk

257
00:09:29,519 --> 00:09:30,959
this can be greylog this can be similar

258
00:09:30,959 --> 00:09:32,940
logic you kind of take your pick but you

259
00:09:32,940 --> 00:09:35,100
have to ingest them into something to do

260
00:09:35,100 --> 00:09:37,860
something with them as well and this

261
00:09:37,860 --> 00:09:40,260
still Falls part of incident response

262
00:09:40,260 --> 00:09:41,820
and forensics within the cloud because

263
00:09:41,820 --> 00:09:43,740
you might get called upon to look at

264
00:09:43,740 --> 00:09:45,540
M365 today and then you might get called

265
00:09:45,540 --> 00:09:47,120
upon to look at Google Cloud tomorrow

266
00:09:47,120 --> 00:09:49,740
and trying to find somewhere that can

267
00:09:49,740 --> 00:09:52,440
ingest this data quickly is really the

268
00:09:52,440 --> 00:09:53,760
hard part

269
00:09:53,760 --> 00:09:56,940
now as part of the the 509 class we kind

270
00:09:56,940 --> 00:09:58,860
of debated about this quite a lot and in

271
00:09:58,860 --> 00:10:01,980
the end we ended up picking soft L which

272
00:10:01,980 --> 00:10:04,560
is a a basically a virtual machine it

273
00:10:04,560 --> 00:10:07,680
takes the elastic stack and has had some

274
00:10:07,680 --> 00:10:09,899
amazing things wrapped around it so a

275
00:10:09,899 --> 00:10:11,580
big shout out to Phil Hagan who

276
00:10:11,580 --> 00:10:13,500
basically kicked this off a couple of

277
00:10:13,500 --> 00:10:16,080
years ago and it's kind of exploded from

278
00:10:16,080 --> 00:10:17,399
there where we've done things like

279
00:10:17,399 --> 00:10:19,740
create new rules for ingesting different

280
00:10:19,740 --> 00:10:22,740
types of logs and also slowly adding new

281
00:10:22,740 --> 00:10:24,300
dashboards to it

282
00:10:24,300 --> 00:10:26,399
now if you haven't seen soft help before

283
00:10:26,399 --> 00:10:28,800
I won't spend too long on it but go and

284
00:10:28,800 --> 00:10:30,000
take a look at it and we'll give you a

285
00:10:30,000 --> 00:10:32,279
link at the end so you can basically go

286
00:10:32,279 --> 00:10:34,380
and have a look and download it but it's

287
00:10:34,380 --> 00:10:36,420
a virtual machine with a pre-configured

288
00:10:36,420 --> 00:10:40,320
version of elastic Cabana and log stash

289
00:10:40,320 --> 00:10:42,540
to ingest logs and this is exactly what

290
00:10:42,540 --> 00:10:44,220
we actually teach people in the 509

291
00:10:44,220 --> 00:10:45,660
class so it's something that is

292
00:10:45,660 --> 00:10:48,000
approachable by most people

293
00:10:48,000 --> 00:10:49,500
all right

294
00:10:49,500 --> 00:10:50,820
let's start to talk about some of the

295
00:10:50,820 --> 00:10:54,839
platforms we'll start with M365

296
00:10:54,839 --> 00:10:57,000
now as I said before this is going to be

297
00:10:57,000 --> 00:10:59,459
fast so understand there's lots of edge

298
00:10:59,459 --> 00:11:01,040
cases here

299
00:11:01,040 --> 00:11:04,680
M365 by default who thinks the logs are

300
00:11:04,680 --> 00:11:06,540
turned on by defaults I'll show our

301
00:11:06,540 --> 00:11:08,399
hands in the room

302
00:11:08,399 --> 00:11:11,820
oh one okay who thinks they're off by

303
00:11:11,820 --> 00:11:13,920
defaults

304
00:11:13,920 --> 00:11:16,079
okay for those online that's probably a

305
00:11:16,079 --> 00:11:18,180
little bit over half who thinks it's

306
00:11:18,180 --> 00:11:19,800
greater than that who thinks there's no

307
00:11:19,800 --> 00:11:21,480
clear answer

308
00:11:21,480 --> 00:11:23,640
okay and that's about half the room and

309
00:11:23,640 --> 00:11:25,740
you would be correct there is no clear

310
00:11:25,740 --> 00:11:26,760
answer

311
00:11:26,760 --> 00:11:29,040
so let me try and clear some of that up

312
00:11:29,040 --> 00:11:32,040
for you now depending on when you

313
00:11:32,040 --> 00:11:34,079
created your tenancy really depends on

314
00:11:34,079 --> 00:11:36,779
whether logs are on or off by default if

315
00:11:36,779 --> 00:11:39,959
you created an M365 tenancy after

316
00:11:39,959 --> 00:11:42,600
October last year the logs are on by

317
00:11:42,600 --> 00:11:44,880
default so thumbs up for those of you

318
00:11:44,880 --> 00:11:46,920
who have a tendency after October last

319
00:11:46,920 --> 00:11:49,620
year if it was created before October

320
00:11:49,620 --> 00:11:51,240
last year

321
00:11:51,240 --> 00:11:53,940
the official line is their off by

322
00:11:53,940 --> 00:11:57,540
defaults at the moment but Microsoft are

323
00:11:57,540 --> 00:12:00,180
slowly trying to turn them back on for

324
00:12:00,180 --> 00:12:03,120
people now this varies and in practice

325
00:12:03,120 --> 00:12:05,700
it really does vary I I

326
00:12:05,700 --> 00:12:08,040
um I looked at a victim's case I think

327
00:12:08,040 --> 00:12:09,540
it was a week ago before I flew over

328
00:12:09,540 --> 00:12:12,660
here and they had a tendency pre-october

329
00:12:12,660 --> 00:12:15,540
and they were off by default so there

330
00:12:15,540 --> 00:12:17,579
are still people in this state of logs

331
00:12:17,579 --> 00:12:20,279
off by default in M365

332
00:12:20,279 --> 00:12:23,100
so if you have an M365 go and have a

333
00:12:23,100 --> 00:12:24,779
look and see whether your logs are on or

334
00:12:24,779 --> 00:12:26,279
off by default

335
00:12:26,279 --> 00:12:27,540
and you would do that inside the

336
00:12:27,540 --> 00:12:29,180
compliance manager

337
00:12:29,180 --> 00:12:32,459
the other part to M365 is you have

338
00:12:32,459 --> 00:12:34,560
What's called the unified audit log or

339
00:12:34,560 --> 00:12:37,140
the ual and this is where all the logs

340
00:12:37,140 --> 00:12:39,899
are tipped into so if you have exchange

341
00:12:39,899 --> 00:12:41,760
online the logs are in here if you have

342
00:12:41,760 --> 00:12:43,760
SharePoint logs are in here if you have

343
00:12:43,760 --> 00:12:46,200
OneDrive all the logs are here for you

344
00:12:46,200 --> 00:12:47,940
and they include both administrative

345
00:12:47,940 --> 00:12:51,600
actions and user actions so this is your

346
00:12:51,600 --> 00:12:54,360
key resource or your key piece of

347
00:12:54,360 --> 00:12:56,100
evidence if you want to investigate an

348
00:12:56,100 --> 00:12:59,579
M365 instance but depends on whether

349
00:12:59,579 --> 00:13:03,839
it's on or off by default which is tough

350
00:13:03,839 --> 00:13:05,279
okay

351
00:13:05,279 --> 00:13:07,079
now the other thing to be aware of as

352
00:13:07,079 --> 00:13:09,600
well is that the logs aren't always

353
00:13:09,600 --> 00:13:13,200
thrown into the ual buckets instantly

354
00:13:13,200 --> 00:13:16,440
there is a delay on those logs going in

355
00:13:16,440 --> 00:13:19,260
there so they can be delayed by up to 30

356
00:13:19,260 --> 00:13:22,740
minutes for most services in M365 now

357
00:13:22,740 --> 00:13:24,240
you might kind of go well 30 minutes oh

358
00:13:24,240 --> 00:13:25,980
my gosh like the threat is in there for

359
00:13:25,980 --> 00:13:27,180
30 minutes I'm not going to see that

360
00:13:27,180 --> 00:13:31,800
activity well yes true but understand 30

361
00:13:31,800 --> 00:13:34,200
minutes in the space of Microsoft who

362
00:13:34,200 --> 00:13:36,060
have this huge cloud with a bunch of

363
00:13:36,060 --> 00:13:38,160
customers sitting on it is pretty good

364
00:13:38,160 --> 00:13:41,339
it's it's pretty fair but you do have to

365
00:13:41,339 --> 00:13:42,839
understand that if I pull the logs down

366
00:13:42,839 --> 00:13:45,839
right now there's a 30 minute lag that I

367
00:13:45,839 --> 00:13:48,540
might not see data for now it gets a

368
00:13:48,540 --> 00:13:51,660
little bit worse the Azure ad logs that

369
00:13:51,660 --> 00:13:55,560
get thrown into the ual can take up to a

370
00:13:55,560 --> 00:13:58,440
day to get in there which is not great

371
00:13:58,440 --> 00:14:00,660
but there are other places you can go

372
00:14:00,660 --> 00:14:02,399
and get these the

373
00:14:02,399 --> 00:14:03,899
um Azure ad logs which we'll talk about

374
00:14:03,899 --> 00:14:05,040
in a minute

375
00:14:05,040 --> 00:14:06,660
okay so it could be a delay by up to 30

376
00:14:06,660 --> 00:14:08,100
minutes not too bad but just something

377
00:14:08,100 --> 00:14:10,079
to be aware of the other thing to be

378
00:14:10,079 --> 00:14:12,360
aware of is depends on your license type

379
00:14:12,360 --> 00:14:14,519
will depend on how long the logs are

380
00:14:14,519 --> 00:14:15,839
kept for

381
00:14:15,839 --> 00:14:18,899
so if you have an E5 license which is

382
00:14:18,899 --> 00:14:22,200
like the premium license in M365 you've

383
00:14:22,200 --> 00:14:23,820
got a Year's worth of logs being held

384
00:14:23,820 --> 00:14:25,620
for you as part of what you already pay

385
00:14:25,620 --> 00:14:27,660
for M365

386
00:14:27,660 --> 00:14:31,380
if you've got anything under an E5 as an

387
00:14:31,380 --> 00:14:34,279
Enterprise license you've got 90 days

388
00:14:34,279 --> 00:14:36,899
and then the numbers get lower again for

389
00:14:36,899 --> 00:14:39,180
things like standard business they can

390
00:14:39,180 --> 00:14:41,399
go down to even less days as part of

391
00:14:41,399 --> 00:14:42,839
that as well

392
00:14:42,839 --> 00:14:44,820
so the big thing you have to do here is

393
00:14:44,820 --> 00:14:46,800
try to get those logs out so you can

394
00:14:46,800 --> 00:14:49,079
start to investigate them as quickly as

395
00:14:49,079 --> 00:14:51,779
possible so a big part of what we try to

396
00:14:51,779 --> 00:14:53,820
teach in the 509 class is how to get

397
00:14:53,820 --> 00:14:55,500
those logs out so you can actually hold

398
00:14:55,500 --> 00:14:57,240
them and then manipulate them and do

399
00:14:57,240 --> 00:14:59,519
something with them as well

400
00:14:59,519 --> 00:15:01,860
so go and grab those logs quickly make

401
00:15:01,860 --> 00:15:04,079
sure they're turned on for M365 to start

402
00:15:04,079 --> 00:15:06,180
with that's probably your other big um

403
00:15:06,180 --> 00:15:09,000
big thing to kind of watch as part of it

404
00:15:09,000 --> 00:15:12,000
alrighty that's enough on M365

405
00:15:12,000 --> 00:15:14,399
over to my bread and butter Google

406
00:15:14,399 --> 00:15:17,100
workspace so again there's giving

407
00:15:17,100 --> 00:15:19,560
multiple ways to get these logs

408
00:15:19,560 --> 00:15:21,120
the thing with getting the logs from

409
00:15:21,120 --> 00:15:22,920
Google workspace I've always been very

410
00:15:22,920 --> 00:15:25,440
frustrated with their admin portal

411
00:15:25,440 --> 00:15:27,959
um as a responder I love my single pane

412
00:15:27,959 --> 00:15:30,000
of glass I love to be able to get all

413
00:15:30,000 --> 00:15:32,220
the logs one View and then start my

414
00:15:32,220 --> 00:15:34,139
filtering down from everything to the

415
00:15:34,139 --> 00:15:36,839
activity I'm interested in unfortunately

416
00:15:36,839 --> 00:15:39,120
the workspace admin portal when you want

417
00:15:39,120 --> 00:15:40,980
to go to logs you're given an

418
00:15:40,980 --> 00:15:42,720
investigation tool which I'll show in a

419
00:15:42,720 --> 00:15:45,779
few but they're divided up by your

420
00:15:45,779 --> 00:15:48,240
category so I can't look at the drive

421
00:15:48,240 --> 00:15:51,300
logs as they appear within the order of

422
00:15:51,300 --> 00:15:54,240
time with the login logs as they appear

423
00:15:54,240 --> 00:15:56,880
with email activity I have to drive into

424
00:15:56,880 --> 00:15:59,279
each separate walk you do get to use

425
00:15:59,279 --> 00:16:01,680
Google's compute power their filtering

426
00:16:01,680 --> 00:16:03,600
engine which again we'll see in their

427
00:16:03,600 --> 00:16:05,639
investigation tool

428
00:16:05,639 --> 00:16:07,860
um but in order to to do that you have

429
00:16:07,860 --> 00:16:09,779
to do it from their UI with the

430
00:16:09,779 --> 00:16:11,820
information they provide as they provide

431
00:16:11,820 --> 00:16:14,639
it you also they recently when they

432
00:16:14,639 --> 00:16:16,380
moved to their new investigation tool

433
00:16:16,380 --> 00:16:18,180
they want you to download in Google

434
00:16:18,180 --> 00:16:20,220
Sheets obviously a lot of us are not

435
00:16:20,220 --> 00:16:21,899
working with Google Sheets we're working

436
00:16:21,899 --> 00:16:24,839
with Excel we're working with CSV Json

437
00:16:24,839 --> 00:16:27,600
that kind of format so you have to

438
00:16:27,600 --> 00:16:30,240
download a Google Sheets export to CSV

439
00:16:30,240 --> 00:16:32,820
for that reason when I pull logs from

440
00:16:32,820 --> 00:16:35,760
Google I prefer to go through the API it

441
00:16:35,760 --> 00:16:37,740
allows for faster collection because I

442
00:16:37,740 --> 00:16:39,899
can use automation I can use scripts

443
00:16:39,899 --> 00:16:42,480
there's a talk tomorrow that will

444
00:16:42,480 --> 00:16:45,600
release another open source tool for

445
00:16:45,600 --> 00:16:48,120
Gathering logs via API I'll provide in

446
00:16:48,120 --> 00:16:50,820
the resource section the GitHub for our

447
00:16:50,820 --> 00:16:53,459
course which also includes our scripts

448
00:16:53,459 --> 00:16:56,399
allowsing for easy connections one of

449
00:16:56,399 --> 00:16:58,800
the other big things the differences in

450
00:16:58,800 --> 00:17:01,380
these two wall collection activities is

451
00:17:01,380 --> 00:17:04,439
the time stamps unfortunately in the

452
00:17:04,439 --> 00:17:06,419
admin portal you're gonna get the time

453
00:17:06,419 --> 00:17:09,419
stamps in the local admin time I mean a

454
00:17:09,419 --> 00:17:12,660
local user time that is great if all of

455
00:17:12,660 --> 00:17:15,000
your users all of your staff all of your

456
00:17:15,000 --> 00:17:17,339
responders all work from the same time

457
00:17:17,339 --> 00:17:19,199
zone all realize you're working in that

458
00:17:19,199 --> 00:17:20,400
time zone

459
00:17:20,400 --> 00:17:23,220
right now we have remote work many of

460
00:17:23,220 --> 00:17:25,140
you probably work with colleagues in

461
00:17:25,140 --> 00:17:27,599
other time zones so exporting those

462
00:17:27,599 --> 00:17:28,860
sheets there's no additional

463
00:17:28,860 --> 00:17:31,799
communication to occur is this UTC is

464
00:17:31,799 --> 00:17:34,260
this your time zone is this my time zone

465
00:17:34,260 --> 00:17:36,200
to get it all straight

466
00:17:36,200 --> 00:17:39,919
API keeps it simple everything in UTC

467
00:17:39,919 --> 00:17:42,419
often what US responders are working off

468
00:17:42,419 --> 00:17:44,400
of in order to mitigate those issues

469
00:17:44,400 --> 00:17:47,520
with working across time zones

470
00:17:47,520 --> 00:17:50,340
in terms of event extraction when you

471
00:17:50,340 --> 00:17:52,679
export in the admin interface is going

472
00:17:52,679 --> 00:17:54,480
to cap your results obviously you're

473
00:17:54,480 --> 00:17:56,160
exporting a spreadsheet they're not

474
00:17:56,160 --> 00:17:57,720
going to give you millions and millions

475
00:17:57,720 --> 00:18:00,179
of lines in a spreadsheet so depending

476
00:18:00,179 --> 00:18:02,340
on where in the admin interface the tool

477
00:18:02,340 --> 00:18:04,200
you're pulling from you're either going

478
00:18:04,200 --> 00:18:06,600
to get a cap of about 10K or 100 000

479
00:18:06,600 --> 00:18:08,820
records that may be fine if you're a

480
00:18:08,820 --> 00:18:10,740
small business if you're an Enterprise

481
00:18:10,740 --> 00:18:14,039
you could quickly exceed that limit API

482
00:18:14,039 --> 00:18:16,799
as long as workspace has retained those

483
00:18:16,799 --> 00:18:18,480
logs which will go into those retention

484
00:18:18,480 --> 00:18:20,880
limits here in a second then you'll be

485
00:18:20,880 --> 00:18:23,340
able to pull all those back of course

486
00:18:23,340 --> 00:18:26,820
speak of apis some of you who are not as

487
00:18:26,820 --> 00:18:29,220
familiar with Computing Concepts such

488
00:18:29,220 --> 00:18:31,440
that may not have the experience of

489
00:18:31,440 --> 00:18:33,840
working with an API there is more of a

490
00:18:33,840 --> 00:18:36,600
learning curve you do need to set up an

491
00:18:36,600 --> 00:18:39,240
application within the API console a lot

492
00:18:39,240 --> 00:18:41,160
of people find this overwhelming there's

493
00:18:41,160 --> 00:18:43,440
additional setup configuration of a

494
00:18:43,440 --> 00:18:45,960
developer portal but another thing that

495
00:18:45,960 --> 00:18:48,059
I advertise about this method of going

496
00:18:48,059 --> 00:18:51,240
of it is sometimes the option is that

497
00:18:51,240 --> 00:18:53,640
creating this application token that can

498
00:18:53,640 --> 00:18:57,360
quickly be revoked or the lazy sis admin

499
00:18:57,360 --> 00:18:59,580
saying oh my responders need logs here's

500
00:18:59,580 --> 00:19:01,799
a super admin account with a shared

501
00:19:01,799 --> 00:19:04,140
password that I'm going to email them so

502
00:19:04,140 --> 00:19:06,000
while it may sound overwhelming may

503
00:19:06,000 --> 00:19:07,679
sound like this extra step this extra

504
00:19:07,679 --> 00:19:10,799
cow creation is often actually the

505
00:19:10,799 --> 00:19:13,380
shorter route the the more secure route

506
00:19:13,380 --> 00:19:15,960
to giving keys to the kingdom in order

507
00:19:15,960 --> 00:19:18,299
to get logs and like we said before

508
00:19:18,299 --> 00:19:20,760
instead of getting a spreadsheet or a

509
00:19:20,760 --> 00:19:23,520
even worse a proprietary Google sheet

510
00:19:23,520 --> 00:19:26,280
format where you get that Json format

511
00:19:26,280 --> 00:19:28,740
Json is great because that structured

512
00:19:28,740 --> 00:19:31,260
data is exactly what we need to pipe

513
00:19:31,260 --> 00:19:34,140
into the log enrichment parsing

514
00:19:34,140 --> 00:19:36,539
Etc pipeline that Josh explained getting

515
00:19:36,539 --> 00:19:38,880
that structured data enriching it

516
00:19:38,880 --> 00:19:41,220
transforming it and displaying it in our

517
00:19:41,220 --> 00:19:44,280
platform of choice most Sims most log

518
00:19:44,280 --> 00:19:47,940
aggregators most processing tools are

519
00:19:47,940 --> 00:19:50,640
going to accept Json so it's yet another

520
00:19:50,640 --> 00:19:52,980
reason to use the API again it comes

521
00:19:52,980 --> 00:19:54,600
down to your use case if you just

522
00:19:54,600 --> 00:19:57,000
quickly have a question to answer did

523
00:19:57,000 --> 00:19:59,400
this user look at this file maybe the

524
00:19:59,400 --> 00:20:01,620
investigation tools your way to go but

525
00:20:01,620 --> 00:20:03,600
it's important to understand that there

526
00:20:03,600 --> 00:20:05,220
are multiple methods of getting this

527
00:20:05,220 --> 00:20:07,799
data and you need to determine what your

528
00:20:07,799 --> 00:20:10,620
use case is and how you should approach

529
00:20:10,620 --> 00:20:13,520
getting the data

530
00:20:14,039 --> 00:20:16,679
so as I mentioned Google in order to

531
00:20:16,679 --> 00:20:19,440
expose their logs their workspace logs

532
00:20:19,440 --> 00:20:22,020
in the UI they recently released this

533
00:20:22,020 --> 00:20:24,000
investigation tool I believe it is

534
00:20:24,000 --> 00:20:26,220
around February that we start seeing the

535
00:20:26,220 --> 00:20:28,860
roll out and the documentation

536
00:20:28,860 --> 00:20:31,380
um from our spot checking across our

537
00:20:31,380 --> 00:20:34,260
different test organizations it seems

538
00:20:34,260 --> 00:20:35,760
that most of this has been rolled out

539
00:20:35,760 --> 00:20:37,980
now so you're likely going to see this

540
00:20:37,980 --> 00:20:40,380
investigation tool as opposed to the old

541
00:20:40,380 --> 00:20:42,299
reporting interface

542
00:20:42,299 --> 00:20:44,820
as you can see on the search menu on the

543
00:20:44,820 --> 00:20:47,340
right I have selected in the example

544
00:20:47,340 --> 00:20:49,559
Drive log events this is what I was

545
00:20:49,559 --> 00:20:51,539
talking about of I don't have a single

546
00:20:51,539 --> 00:20:53,880
pane of view there is no all log

547
00:20:53,880 --> 00:20:56,100
selection there you must choose your

548
00:20:56,100 --> 00:20:58,679
event source and then you can filter on

549
00:20:58,679 --> 00:21:01,080
your conditions filtering on conditions

550
00:21:01,080 --> 00:21:02,580
like I said if you have an investigation

551
00:21:02,580 --> 00:21:04,440
and all you're trying to answer is a

552
00:21:04,440 --> 00:21:06,900
quick question hey did this user edit

553
00:21:06,900 --> 00:21:09,240
this file I could tell you that very

554
00:21:09,240 --> 00:21:11,280
quickly with the investigation tool I'm

555
00:21:11,280 --> 00:21:14,460
not going to pull 10 000 logs via Json

556
00:21:14,460 --> 00:21:17,039
export them put them into a Sim

557
00:21:17,039 --> 00:21:19,260
just to tell you whether a foot user

558
00:21:19,260 --> 00:21:21,780
looked at a file in that case this will

559
00:21:21,780 --> 00:21:23,880
work perfect for you I go to my drive

560
00:21:23,880 --> 00:21:26,280
logs I do a condition I set it up

561
00:21:26,280 --> 00:21:28,260
another cool thing to note about the

562
00:21:28,260 --> 00:21:30,480
investigation tool is if you're setting

563
00:21:30,480 --> 00:21:32,820
up detections they'll actually let you

564
00:21:32,820 --> 00:21:36,000
create alerts based on your results so

565
00:21:36,000 --> 00:21:37,740
you'll see to the right of search one

566
00:21:37,740 --> 00:21:40,140
it's a bit small text but if you're able

567
00:21:40,140 --> 00:21:42,179
to see it to the right of the search box

568
00:21:42,179 --> 00:21:46,020
it says create activity rule so if I not

569
00:21:46,020 --> 00:21:48,059
only want to know did a user look at

570
00:21:48,059 --> 00:21:51,000
this file you want to be alerted in

571
00:21:51,000 --> 00:21:53,580
future if there's ever show me that file

572
00:21:53,580 --> 00:21:55,799
this is the way I can go about doing it

573
00:21:55,799 --> 00:21:58,980
so the investigation tool while Limited

574
00:21:58,980 --> 00:22:02,700
in its ability to Max produce thousands

575
00:22:02,700 --> 00:22:05,760
of Enterprise laws for large forensic

576
00:22:05,760 --> 00:22:07,860
investigations may not be the way to go

577
00:22:07,860 --> 00:22:09,900
it's good to know about the tools

578
00:22:09,900 --> 00:22:11,520
because you will have that username

579
00:22:11,520 --> 00:22:14,520
where a few hundred laws via the

580
00:22:14,520 --> 00:22:16,740
investigation tool is the way to go so

581
00:22:16,740 --> 00:22:19,380
that that screenshot you can find that

582
00:22:19,380 --> 00:22:21,059
you can go to the right and log side

583
00:22:21,059 --> 00:22:24,419
filter on basically anything important I

584
00:22:24,419 --> 00:22:27,120
will say the new investigation tool

585
00:22:27,120 --> 00:22:32,039
ended up working uh providing a lot more

586
00:22:32,039 --> 00:22:35,220
data than the old audit logs did one of

587
00:22:35,220 --> 00:22:37,520
the things I used to advertise oh

588
00:22:37,520 --> 00:22:40,320
advertising sense when I would discuss

589
00:22:40,320 --> 00:22:43,620
should you pull via API or via sheets I

590
00:22:43,620 --> 00:22:45,600
found I could get a lot more data and

591
00:22:45,600 --> 00:22:48,240
context via the API but luckily Google

592
00:22:48,240 --> 00:22:50,100
has closed that Gap with their new

593
00:22:50,100 --> 00:22:52,500
investigation tool and has surfaced a

594
00:22:52,500 --> 00:22:55,080
lot of the fields that previously were

595
00:22:55,080 --> 00:22:57,299
kept as their own dedicated Json Fields

596
00:22:57,299 --> 00:22:59,340
not exposed in the UI

597
00:22:59,340 --> 00:23:01,679
so worth looking into if you need to

598
00:23:01,679 --> 00:23:04,440
quickly spot check logs you can export

599
00:23:04,440 --> 00:23:06,960
you can save your searches

600
00:23:06,960 --> 00:23:10,020
um so this is a good source to use for

601
00:23:10,020 --> 00:23:13,500
logs if you're doing quick uh question

602
00:23:13,500 --> 00:23:16,940
answering investigations

603
00:23:17,700 --> 00:23:19,919
going into the retention the lag time we

604
00:23:19,919 --> 00:23:22,020
discussed with this with Microsoft a lot

605
00:23:22,020 --> 00:23:25,080
of the licensing is either 30 minutes or

606
00:23:25,080 --> 00:23:27,120
an hour depending on log type it's

607
00:23:27,120 --> 00:23:29,039
similar with Google workspace your

608
00:23:29,039 --> 00:23:31,200
retention your lifetimes it's all going

609
00:23:31,200 --> 00:23:33,000
to depend on the type of logs you're

610
00:23:33,000 --> 00:23:33,960
looking at

611
00:23:33,960 --> 00:23:36,240
you're looking at your admin audit logs

612
00:23:36,240 --> 00:23:38,520
your admin activities people changing

613
00:23:38,520 --> 00:23:40,799
settings to your tenancy

614
00:23:40,799 --> 00:23:42,720
you're going to see a six-month

615
00:23:42,720 --> 00:23:44,220
retention and and that's going to be

616
00:23:44,220 --> 00:23:46,140
kind of common across all the log types

617
00:23:46,140 --> 00:23:48,659
six months is a great retention period

618
00:23:48,659 --> 00:23:51,179
like we saw before 30 days is very

619
00:23:51,179 --> 00:23:54,419
common sometimes you'll see 90 days

620
00:23:54,419 --> 00:23:56,760
um those are the more common default log

621
00:23:56,760 --> 00:23:58,559
retention times regardless of

622
00:23:58,559 --> 00:24:01,380
application or Source or or vendor so

623
00:24:01,380 --> 00:24:03,659
six months relatively generous for a

624
00:24:03,659 --> 00:24:05,039
vendor

625
00:24:05,039 --> 00:24:08,100
admin audit logs login audit logs user

626
00:24:08,100 --> 00:24:09,780
audit log security reports all of those

627
00:24:09,780 --> 00:24:11,760
six months where we differ is the lag

628
00:24:11,760 --> 00:24:13,740
time although we still consider it

629
00:24:13,740 --> 00:24:16,559
pretty good SLA for a vendor with your

630
00:24:16,559 --> 00:24:18,360
admin audit logs those are going to be

631
00:24:18,360 --> 00:24:20,000
within the portal within a few minutes

632
00:24:20,000 --> 00:24:22,140
uh and then within tens of minutes

633
00:24:22,140 --> 00:24:23,820
you're going to see user account audit

634
00:24:23,820 --> 00:24:25,559
logs that's going to be things like I

635
00:24:25,559 --> 00:24:27,960
updated my recovery account email I

636
00:24:27,960 --> 00:24:29,820
disabled 2fa

637
00:24:29,820 --> 00:24:32,220
um I added a recovery phone number those

638
00:24:32,220 --> 00:24:33,900
types of activities within tens of

639
00:24:33,900 --> 00:24:35,460
minutes

640
00:24:35,460 --> 00:24:37,500
were they going to move into if every

641
00:24:37,500 --> 00:24:39,360
few hours is going to be the lag time

642
00:24:39,360 --> 00:24:40,740
for the login audit logs it's

643
00:24:40,740 --> 00:24:42,960
unfortunate again that that 30 minutes

644
00:24:42,960 --> 00:24:45,480
for Microsoft kind of similar yes if

645
00:24:45,480 --> 00:24:47,039
you're responding to an incident or

646
00:24:47,039 --> 00:24:48,659
investigating something that occurred

647
00:24:48,659 --> 00:24:50,419
within the last 30 minutes

648
00:24:50,419 --> 00:24:54,179
unfortunate but if you're a responder in

649
00:24:54,179 --> 00:24:55,380
this room if you've done incident

650
00:24:55,380 --> 00:24:57,840
responses before you know you're very

651
00:24:57,840 --> 00:24:59,700
lucky if you are catching an incident

652
00:24:59,700 --> 00:25:01,260
within the first 30 minutes of

653
00:25:01,260 --> 00:25:02,760
Investigation

654
00:25:02,760 --> 00:25:04,980
um so for me that lag time of a few

655
00:25:04,980 --> 00:25:08,460
hours is likely not going to impact you

656
00:25:08,460 --> 00:25:10,559
in a large number of cases but it's

657
00:25:10,559 --> 00:25:12,240
always good to be aware that's the

658
00:25:12,240 --> 00:25:13,860
purpose of this talk being aware of what

659
00:25:13,860 --> 00:25:16,799
data is there and what is not so if you

660
00:25:16,799 --> 00:25:18,419
are looking for activity within the

661
00:25:18,419 --> 00:25:20,340
first few hours you might have to go

662
00:25:20,340 --> 00:25:22,740
back this was very annoying as a lab

663
00:25:22,740 --> 00:25:24,059
developer

664
00:25:24,059 --> 00:25:25,620
um for the course trying to generate

665
00:25:25,620 --> 00:25:28,020
logs I would have to run my scenario

666
00:25:28,020 --> 00:25:30,539
walk away for a few hours and then come

667
00:25:30,539 --> 00:25:32,520
back and hope my logs appeared from the

668
00:25:32,520 --> 00:25:33,900
activity I did

669
00:25:33,900 --> 00:25:35,700
and then at the longer end of the lag

670
00:25:35,700 --> 00:25:37,500
time we see these security reports

671
00:25:37,500 --> 00:25:39,480
coming in with one to three days which

672
00:25:39,480 --> 00:25:41,640
you see the word security you see this

673
00:25:41,640 --> 00:25:43,500
long lag time it's kind of concerning

674
00:25:43,500 --> 00:25:45,179
but you have to keep in mind that this

675
00:25:45,179 --> 00:25:47,520
is Google's security engine doing their

676
00:25:47,520 --> 00:25:50,340
little magic of their analysis their

677
00:25:50,340 --> 00:25:52,980
assessment of activity over time they

678
00:25:52,980 --> 00:25:54,659
have to run their stuff through engines

679
00:25:54,659 --> 00:25:57,240
so this is not necessarily surprising

680
00:25:57,240 --> 00:25:59,700
that there is a few days lag time

681
00:25:59,700 --> 00:26:01,919
um just due to the nature of the data

682
00:26:01,919 --> 00:26:03,900
you're finding it does require time to

683
00:26:03,900 --> 00:26:06,380
approve

684
00:26:06,419 --> 00:26:08,460
and then one last thing worth mentioning

685
00:26:08,460 --> 00:26:12,480
we talked about the API and the UI as

686
00:26:12,480 --> 00:26:15,299
ways to get logs because of the

687
00:26:15,299 --> 00:26:18,080
integrated nature of uh Google's

688
00:26:18,080 --> 00:26:20,580
environments if you are both a Google

689
00:26:20,580 --> 00:26:23,100
workspace and a Google Cloud platform

690
00:26:23,100 --> 00:26:25,860
user they've created an easy button to

691
00:26:25,860 --> 00:26:28,799
enable log sharing between Google

692
00:26:28,799 --> 00:26:33,179
workspace and Google Cloud perfect great

693
00:26:33,179 --> 00:26:35,700
only problem they are very selective

694
00:26:35,700 --> 00:26:37,559
about what logs you get you either get

695
00:26:37,559 --> 00:26:39,659
the ones that they have offer or you get

696
00:26:39,659 --> 00:26:42,240
none and there's no in between so for

697
00:26:42,240 --> 00:26:43,740
example you'll see here you get the big

698
00:26:43,740 --> 00:26:45,900
ones you get the admin activity the

699
00:26:45,900 --> 00:26:48,299
login audit logs oauth logs all of those

700
00:26:48,299 --> 00:26:49,740
are going to be super useful in

701
00:26:49,740 --> 00:26:52,320
investigations but for me when I'm

702
00:26:52,320 --> 00:26:54,720
investigating Google Google workspace a

703
00:26:54,720 --> 00:26:56,840
lot of the times I'm investigating vecs

704
00:26:56,840 --> 00:26:59,940
well BCS aren't great to investigate

705
00:26:59,940 --> 00:27:02,400
without the email logs which are not

706
00:27:02,400 --> 00:27:04,679
enabled via Google Cloud shipping I

707
00:27:04,679 --> 00:27:06,419
don't have Drive walls so if I'm looking

708
00:27:06,419 --> 00:27:08,820
for activity within Google drive or

709
00:27:08,820 --> 00:27:11,279
Google Chat I don't have those logs so

710
00:27:11,279 --> 00:27:12,779
again it's that concept of visibility

711
00:27:12,779 --> 00:27:15,120
it's great enable it if you use Google

712
00:27:15,120 --> 00:27:16,919
Cloud for logging you might as well have

713
00:27:16,919 --> 00:27:18,900
the logs backed up there but if you're

714
00:27:18,900 --> 00:27:20,820
going there expecting to have all the

715
00:27:20,820 --> 00:27:23,220
data you need for an investigation it is

716
00:27:23,220 --> 00:27:24,779
not going to be there so it's another

717
00:27:24,779 --> 00:27:26,520
one of those things keep in mind what

718
00:27:26,520 --> 00:27:28,799
you do and do not have when you're going

719
00:27:28,799 --> 00:27:31,200
to a specific source

720
00:27:31,200 --> 00:27:33,720
with I'll hand it back to Josh cool all

721
00:27:33,720 --> 00:27:37,799
right so Azure Cloud logs now again back

722
00:27:37,799 --> 00:27:40,679
in the space of Microsoft who who can

723
00:27:40,679 --> 00:27:42,299
chop and change a little bit with the

724
00:27:42,299 --> 00:27:43,740
logs they have turned on and turned off

725
00:27:43,740 --> 00:27:47,340
now we've already talked about M365 and

726
00:27:47,340 --> 00:27:48,720
you have to in your mind kind of

727
00:27:48,720 --> 00:27:50,880
separate although that's Microsoft that

728
00:27:50,880 --> 00:27:52,620
is kind of a platform on its own that's

729
00:27:52,620 --> 00:27:54,900
Microsoft's SAS platform their software

730
00:27:54,900 --> 00:27:55,980
as a service

731
00:27:55,980 --> 00:27:57,900
what I want to talk about quickly is

732
00:27:57,900 --> 00:28:00,539
azure which is their infrastructure or

733
00:28:00,539 --> 00:28:02,640
and also part of their platform as a

734
00:28:02,640 --> 00:28:04,440
service as well this is where we run

735
00:28:04,440 --> 00:28:06,179
virtual machines where I get storage

736
00:28:06,179 --> 00:28:08,880
where I can drop buckets and and data or

737
00:28:08,880 --> 00:28:10,799
files into but this is their

738
00:28:10,799 --> 00:28:13,559
infrastructure side of the house now now

739
00:28:13,559 --> 00:28:16,559
over in Azure Cloud we have a couple of

740
00:28:16,559 --> 00:28:19,020
different log sources in this case

741
00:28:19,020 --> 00:28:21,840
though the tenancy and subscription log

742
00:28:21,840 --> 00:28:23,700
sources which are their correct names in

743
00:28:23,700 --> 00:28:27,120
Azure are on by default so tenancy

744
00:28:27,120 --> 00:28:30,299
allows me to see things like Azure ad or

745
00:28:30,299 --> 00:28:32,820
active directory inside of azure and

746
00:28:32,820 --> 00:28:34,620
these are things like my logging events

747
00:28:34,620 --> 00:28:37,200
now this is a separate log source to the

748
00:28:37,200 --> 00:28:40,260
ual which I talked about a moment ago so

749
00:28:40,260 --> 00:28:42,000
when I said that the Azure logs inside

750
00:28:42,000 --> 00:28:44,880
the ual are delayed by up to a day over

751
00:28:44,880 --> 00:28:46,919
here in the tenancy logs they are much

752
00:28:46,919 --> 00:28:48,480
faster you can actually go and pull them

753
00:28:48,480 --> 00:28:50,820
over here the other really cool thing

754
00:28:50,820 --> 00:28:53,039
from an investigator's point of view is

755
00:28:53,039 --> 00:28:56,340
understand that if the ual logs are off

756
00:28:56,340 --> 00:29:00,360
inside of someone's M365 often you still

757
00:29:00,360 --> 00:29:02,700
have the tenancy logs for authentication

758
00:29:02,700 --> 00:29:06,720
events turned on by defaults now again

759
00:29:06,720 --> 00:29:09,840
this varies by license type as well it

760
00:29:09,840 --> 00:29:12,419
can be as small as seven days worth of

761
00:29:12,419 --> 00:29:14,580
History it can be as large as one years

762
00:29:14,580 --> 00:29:15,840
where the history again depending on

763
00:29:15,840 --> 00:29:17,940
licensing type but a really good place

764
00:29:17,940 --> 00:29:19,919
to go looking for authentication events

765
00:29:19,919 --> 00:29:22,980
is over in Azure inside the Azure ad

766
00:29:22,980 --> 00:29:25,200
logs as part of it we also have things

767
00:29:25,200 --> 00:29:26,820
like the subscription logs inside of

768
00:29:26,820 --> 00:29:28,620
azure and they're things like actions

769
00:29:28,620 --> 00:29:30,539
that have occurred inside of azure so

770
00:29:30,539 --> 00:29:31,799
when someone creates a new virtual

771
00:29:31,799 --> 00:29:33,539
machine I get that inside of my

772
00:29:33,539 --> 00:29:35,940
subscription logs now there are three

773
00:29:35,940 --> 00:29:37,260
other log sources that we've mentioned

774
00:29:37,260 --> 00:29:38,580
to you they're things like resources

775
00:29:38,580 --> 00:29:40,440
operating system and application logs

776
00:29:40,440 --> 00:29:43,380
they are off by default so if I want

777
00:29:43,380 --> 00:29:45,960
things like flow data for Network

778
00:29:45,960 --> 00:29:48,299
traffic off by defaults consider the

779
00:29:48,299 --> 00:29:50,159
resource log you have to go and turn it

780
00:29:50,159 --> 00:29:52,380
on if I want to do things like suck out

781
00:29:52,380 --> 00:29:55,140
my IIs web server logs from a virtual

782
00:29:55,140 --> 00:29:56,820
machine which you can do and side of

783
00:29:56,820 --> 00:29:58,140
azure which is really quite clever

784
00:29:58,140 --> 00:30:00,779
they're considered application logs off

785
00:30:00,779 --> 00:30:02,520
by default you have to go and turn those

786
00:30:02,520 --> 00:30:04,260
on specifically

787
00:30:04,260 --> 00:30:05,940
but you do have tenancy and subscription

788
00:30:05,940 --> 00:30:08,039
logs there now I'm not going to go

789
00:30:08,039 --> 00:30:09,539
through which license types have

790
00:30:09,539 --> 00:30:11,220
different ones because it changes a

791
00:30:11,220 --> 00:30:13,740
little bit for Azure as well but

792
00:30:13,740 --> 00:30:16,500
understand that that there is a short

793
00:30:16,500 --> 00:30:18,779
time frame on those logs and we'll talk

794
00:30:18,779 --> 00:30:20,880
about how to extend those so in this

795
00:30:20,880 --> 00:30:22,919
example here this is looking at the

796
00:30:22,919 --> 00:30:24,480
tenancy logs this is going in looking at

797
00:30:24,480 --> 00:30:27,240
my authentication logs so inside of here

798
00:30:27,240 --> 00:30:30,299
I get 30 days worth of history of those

799
00:30:30,299 --> 00:30:31,980
authentication logs that I can go back

800
00:30:31,980 --> 00:30:34,440
and see now 30 days isn't very long like

801
00:30:34,440 --> 00:30:36,779
if I want to go and see what a threat

802
00:30:36,779 --> 00:30:39,240
actor has potentially been doing 30 days

803
00:30:39,240 --> 00:30:41,159
doesn't give me a long time to go

804
00:30:41,159 --> 00:30:42,960
backwards in time to actually look to

805
00:30:42,960 --> 00:30:44,399
see what has occurred inside of an

806
00:30:44,399 --> 00:30:45,480
environment

807
00:30:45,480 --> 00:30:47,940
so there's often this need to want to

808
00:30:47,940 --> 00:30:50,039
extend the lifetime of these now there's

809
00:30:50,039 --> 00:30:52,320
a number of ways you can do this

810
00:30:52,320 --> 00:30:53,760
but one thing that we kind of want to

811
00:30:53,760 --> 00:30:55,080
show you is how you can use the platform

812
00:30:55,080 --> 00:30:56,880
itself because the idea is for you to

813
00:30:56,880 --> 00:30:58,200
take something back so you can do it

814
00:30:58,200 --> 00:30:59,700
inside of your own environment or inside

815
00:30:59,700 --> 00:31:02,039
of your customers environments inside

816
00:31:02,039 --> 00:31:05,940
the diagnostic settings under the Azure

817
00:31:05,940 --> 00:31:08,520
tenancy components you can go and extend

818
00:31:08,520 --> 00:31:10,679
the life we can go and save these logs

819
00:31:10,679 --> 00:31:13,980
into a storage account and this allows

820
00:31:13,980 --> 00:31:16,200
you to now dump those logs in Json

821
00:31:16,200 --> 00:31:18,779
format using the built-in storage

822
00:31:18,779 --> 00:31:21,360
platform inside of azure and I can go

823
00:31:21,360 --> 00:31:22,860
and extend this for however long I want

824
00:31:22,860 --> 00:31:25,620
in this example here it's 180 days and

825
00:31:25,620 --> 00:31:26,940
what it will do is it will automatically

826
00:31:26,940 --> 00:31:30,059
rotate those logs after 180 days for me

827
00:31:30,059 --> 00:31:32,460
all in the background now the reality is

828
00:31:32,460 --> 00:31:35,100
I could turn this on and forget about it

829
00:31:35,100 --> 00:31:37,320
I could turn this on and just go and use

830
00:31:37,320 --> 00:31:39,480
it when I have an incident and this is

831
00:31:39,480 --> 00:31:41,279
really what a lot of people should be

832
00:31:41,279 --> 00:31:43,260
trying to do yes you're going to pay for

833
00:31:43,260 --> 00:31:45,419
the log storage cost so just be aware

834
00:31:45,419 --> 00:31:47,279
there is an additional cost component to

835
00:31:47,279 --> 00:31:49,679
it but the fact that you can extend from

836
00:31:49,679 --> 00:31:51,360
seven days when you have the standard

837
00:31:51,360 --> 00:31:53,580
business license or even 30 days from

838
00:31:53,580 --> 00:31:55,860
the Enterprise license out to 180 or

839
00:31:55,860 --> 00:31:58,559
even longer is a pretty good win for us

840
00:31:58,559 --> 00:32:01,080
as investigators

841
00:32:01,080 --> 00:32:03,539
alrighty let's look at AWS

842
00:32:03,539 --> 00:32:06,659
ioi comes to AWS we're going to focus in

843
00:32:06,659 --> 00:32:08,340
this talk on cloudtrail that's our

844
00:32:08,340 --> 00:32:10,559
primary source of logging and there are

845
00:32:10,559 --> 00:32:12,120
of course other log sources other

846
00:32:12,120 --> 00:32:15,240
content in AWS we could dive into to to

847
00:32:15,240 --> 00:32:18,539
get data for investigations and 4509

848
00:32:18,539 --> 00:32:20,580
will teach you that if you want to get

849
00:32:20,580 --> 00:32:22,440
into lots of details on lots of

850
00:32:22,440 --> 00:32:24,720
different logging sources but to focus

851
00:32:24,720 --> 00:32:26,940
on cloudtrail as it's created by default

852
00:32:26,940 --> 00:32:28,740
which we love we love having stuff on by

853
00:32:28,740 --> 00:32:31,380
default social retained for 90 days free

854
00:32:31,380 --> 00:32:33,539
again in in the scope of how long things

855
00:32:33,539 --> 00:32:35,700
can be retained we just talked about you

856
00:32:35,700 --> 00:32:37,740
know seven day and 30 day defaults 90

857
00:32:37,740 --> 00:32:39,600
days is pretty good

858
00:32:39,600 --> 00:32:42,299
and the good thing about cloud trail is

859
00:32:42,299 --> 00:32:44,580
that the way it works is every API call

860
00:32:44,580 --> 00:32:46,440
is logged as an event so all your

861
00:32:46,440 --> 00:32:48,779
interactions with your AWS workspace

862
00:32:48,779 --> 00:32:50,760
regardless of the application regardless

863
00:32:50,760 --> 00:32:52,919
of whether it is interactions with your

864
00:32:52,919 --> 00:32:55,860
S3 buckets or with your ec2 instances

865
00:32:55,860 --> 00:32:57,720
everything's gonna be logged in those

866
00:32:57,720 --> 00:33:00,840
crowd Trails there's even a the maximum

867
00:33:00,840 --> 00:33:04,679
SLA for cloudtrail records is 15 minutes

868
00:33:04,679 --> 00:33:07,440
again very good most records will be

869
00:33:07,440 --> 00:33:09,659
available uh in less than five minutes

870
00:33:09,659 --> 00:33:12,120
so you'll get these logs pretty quick

871
00:33:12,120 --> 00:33:13,380
it's a pretty quick turnaround on

872
00:33:13,380 --> 00:33:14,640
getting those logs

873
00:33:14,640 --> 00:33:17,220
even better is just like we talked about

874
00:33:17,220 --> 00:33:19,380
Azure saving off those logs into a

875
00:33:19,380 --> 00:33:22,200
separate storage instance with plow

876
00:33:22,200 --> 00:33:24,899
trail we can configure to retain logs in

877
00:33:24,899 --> 00:33:27,720
S3 once again you are going to pay for

878
00:33:27,720 --> 00:33:29,640
it storage just costs money but it's

879
00:33:29,640 --> 00:33:32,279
cloud storage in the scope of things the

880
00:33:32,279 --> 00:33:33,840
value you get for the logs you're

881
00:33:33,840 --> 00:33:35,880
storing is worth the cost it's

882
00:33:35,880 --> 00:33:37,679
relatively cheap depending on the scale

883
00:33:37,679 --> 00:33:40,679
of your logging so back those up get

884
00:33:40,679 --> 00:33:44,279
them in S3 again if you 90 days is great

885
00:33:44,279 --> 00:33:46,620
but if we're talking about apts someone

886
00:33:46,620 --> 00:33:48,659
who's been in the system for six months

887
00:33:48,659 --> 00:33:51,059
a year slowly making their way through

888
00:33:51,059 --> 00:33:52,200
your network

889
00:33:52,200 --> 00:33:55,080
that 90 days is gonna cut off a lot of

890
00:33:55,080 --> 00:33:57,240
evidence throw them in a bucket worse

891
00:33:57,240 --> 00:33:58,559
comes to worse you need them you grab

892
00:33:58,559 --> 00:33:59,820
them later

893
00:33:59,820 --> 00:34:01,799
in terms of searching the logs if you

894
00:34:01,799 --> 00:34:04,440
don't want to grab those raw logs and

895
00:34:04,440 --> 00:34:06,659
look at the raw log content which we

896
00:34:06,659 --> 00:34:08,359
will teach you to get into softball

897
00:34:08,359 --> 00:34:10,859
n4509 which can be get we do have a

898
00:34:10,859 --> 00:34:13,500
parser for you can use AWS provided

899
00:34:13,500 --> 00:34:14,820
Services

900
00:34:14,820 --> 00:34:16,739
um there's the cloudtrail portal which

901
00:34:16,739 --> 00:34:18,839
like all of the other logging we've

902
00:34:18,839 --> 00:34:20,580
talked about there is a portal you can

903
00:34:20,580 --> 00:34:22,679
log in you can filter you can export

904
00:34:22,679 --> 00:34:25,859
there's also Google sorry aw has

905
00:34:25,859 --> 00:34:29,280
provided Services Athena detective blue

906
00:34:29,280 --> 00:34:31,760
all services you can dive into more

907
00:34:31,760 --> 00:34:34,739
various costs depending again Cloud

908
00:34:34,739 --> 00:34:38,339
costs so typically charged at a very

909
00:34:38,339 --> 00:34:39,480
cheap level

910
00:34:39,480 --> 00:34:42,000
um at scale it starts to build but to

911
00:34:42,000 --> 00:34:43,800
start off you've got a good method of

912
00:34:43,800 --> 00:34:46,139
evaluating logs on the chief

913
00:34:46,139 --> 00:34:49,440
and then along with the internal methods

914
00:34:49,440 --> 00:34:51,980
of analyzing the internal S3 shipping

915
00:34:51,980 --> 00:34:54,960
cloudtrail portals once again there are

916
00:34:54,960 --> 00:34:57,359
ways via the API via the configurations

917
00:34:57,359 --> 00:35:00,000
to get these logs to your preferred

918
00:35:00,000 --> 00:35:01,859
destination if you do have a SIM

919
00:35:01,859 --> 00:35:04,140
configured or even just a simple log

920
00:35:04,140 --> 00:35:06,740
aggregator

921
00:35:06,960 --> 00:35:09,480
here's just an example of that UI I

922
00:35:09,480 --> 00:35:12,180
talked about for searching uh cloud

923
00:35:12,180 --> 00:35:14,880
trail logs so there's filters it's going

924
00:35:14,880 --> 00:35:16,680
to show you the last 90 days that

925
00:35:16,680 --> 00:35:18,720
default 90-day retention

926
00:35:18,720 --> 00:35:20,940
it's worth noting that the download

927
00:35:20,940 --> 00:35:23,040
events is going to download your current

928
00:35:23,040 --> 00:35:24,839
view a lot of people will want to come

929
00:35:24,839 --> 00:35:27,240
in here quick oh download events that's

930
00:35:27,240 --> 00:35:29,280
why I need get my logs get them exported

931
00:35:29,280 --> 00:35:30,900
but it's get download what you have

932
00:35:30,900 --> 00:35:33,000
filtered and obviously there's these

933
00:35:33,000 --> 00:35:35,760
default filters in place so if you do

934
00:35:35,760 --> 00:35:38,339
want to get that full 90 days of logs

935
00:35:38,339 --> 00:35:39,720
you're going to want to click that

936
00:35:39,720 --> 00:35:42,240
custom time range expand out all the way

937
00:35:42,240 --> 00:35:45,660
remove all your filters and see it once

938
00:35:45,660 --> 00:35:47,400
again there are use cases in which cloud

939
00:35:47,400 --> 00:35:49,619
trail is enough for you you just need to

940
00:35:49,619 --> 00:35:52,079
find a specific event or a specific

941
00:35:52,079 --> 00:35:54,720
user's activity download those events

942
00:35:54,720 --> 00:35:56,700
from a time frame so there is this

943
00:35:56,700 --> 00:35:59,160
simple view you can pivot over to Athena

944
00:35:59,160 --> 00:36:01,500
you can export into spreadsheets you can

945
00:36:01,500 --> 00:36:04,859
export into your sim wherever your use

946
00:36:04,859 --> 00:36:07,980
case is gonna most value having these

947
00:36:07,980 --> 00:36:10,920
logs there is a method to get them there

948
00:36:10,920 --> 00:36:13,440
and then here's just one breakdown of a

949
00:36:13,440 --> 00:36:15,119
simple quick Vlog view for you to see

950
00:36:15,119 --> 00:36:18,599
what a uh Trail looks like so this is a

951
00:36:18,599 --> 00:36:21,000
trail configured for logging you can

952
00:36:21,000 --> 00:36:23,280
create your own Trails so if you have

953
00:36:23,280 --> 00:36:25,260
use cases where you want to segregate

954
00:36:25,260 --> 00:36:26,339
out

955
00:36:26,339 --> 00:36:29,880
um specific API calls or events related

956
00:36:29,880 --> 00:36:31,980
to a specific application you can do

957
00:36:31,980 --> 00:36:33,119
that

958
00:36:33,119 --> 00:36:35,579
um you'll see there's an S3 path link to

959
00:36:35,579 --> 00:36:37,440
a trail log location where these are

960
00:36:37,440 --> 00:36:39,359
logged to and all the metadata

961
00:36:39,359 --> 00:36:41,760
Associated so any number of trails can

962
00:36:41,760 --> 00:36:44,220
be created keep an eye on your billing

963
00:36:44,220 --> 00:36:46,920
if if that's important making sure that

964
00:36:46,920 --> 00:36:48,540
you're not just turning on all the

965
00:36:48,540 --> 00:36:50,460
things and now are racking up thousands

966
00:36:50,460 --> 00:36:52,320
of dollars of storage costs

967
00:36:52,320 --> 00:36:53,820
um but there are these methods to set

968
00:36:53,820 --> 00:36:55,980
these up and get these logs saved off

969
00:36:55,980 --> 00:36:58,560
preparing for that incident that may

970
00:36:58,560 --> 00:37:00,359
occur

971
00:37:00,359 --> 00:37:03,180
okay over to Google Cloud

972
00:37:03,180 --> 00:37:05,099
now Megan talked about before Google

973
00:37:05,099 --> 00:37:07,140
workspace which again is that SAS

974
00:37:07,140 --> 00:37:09,480
component to Google's infrastructure

975
00:37:09,480 --> 00:37:11,400
this is the Google Cloud which is the

976
00:37:11,400 --> 00:37:14,339
infrastructure component now the logging

977
00:37:14,339 --> 00:37:16,619
in here is quite a good story when it

978
00:37:16,619 --> 00:37:18,839
comes to what it compares to at least

979
00:37:18,839 --> 00:37:20,359
those other ones that we've looked at

980
00:37:20,359 --> 00:37:23,520
now the way that Google Cloud have

981
00:37:23,520 --> 00:37:25,740
basically enabled logs by default is

982
00:37:25,740 --> 00:37:28,260
pretty cool so on the left hand side

983
00:37:28,260 --> 00:37:30,060
here of this slide you'll see that there

984
00:37:30,060 --> 00:37:33,000
is what's called a required log bucket

985
00:37:33,000 --> 00:37:36,359
now these are five log types that are

986
00:37:36,359 --> 00:37:39,300
turned on by default by Google and there

987
00:37:39,300 --> 00:37:42,480
is no way for you to turn those off they

988
00:37:42,480 --> 00:37:47,040
are held for 400 Days for free for every

989
00:37:47,040 --> 00:37:49,440
user on Google Cloud which is kind of

990
00:37:49,440 --> 00:37:51,780
amazing I mean it is great that Google

991
00:37:51,780 --> 00:37:52,980
have kind of gone all right you know

992
00:37:52,980 --> 00:37:54,000
what we're going to really invest in

993
00:37:54,000 --> 00:37:55,320
this and we're going to enforce people

994
00:37:55,320 --> 00:37:58,619
to have these logs on by default and and

995
00:37:58,619 --> 00:38:00,060
this is really handy that they do this

996
00:38:00,060 --> 00:38:02,339
this includes things like authentication

997
00:38:02,339 --> 00:38:04,680
events into the plan form it includes

998
00:38:04,680 --> 00:38:06,960
admin tasks that occur inside the

999
00:38:06,960 --> 00:38:10,140
platform it includes things like the

1000
00:38:10,140 --> 00:38:11,520
even the one down the bottom there is

1001
00:38:11,520 --> 00:38:13,079
kind of interesting too the transparency

1002
00:38:13,079 --> 00:38:16,140
logs this occurs when if you call Google

1003
00:38:16,140 --> 00:38:17,700
support and you say hey I need a hand

1004
00:38:17,700 --> 00:38:20,099
with my Google Cloud platform I need you

1005
00:38:20,099 --> 00:38:22,079
to enable something or walk me through

1006
00:38:22,079 --> 00:38:24,540
something when a Google support staff

1007
00:38:24,540 --> 00:38:26,280
member does something inside of your

1008
00:38:26,280 --> 00:38:28,980
platform it gets logged and held there

1009
00:38:28,980 --> 00:38:32,099
for 400 days so you can see actions that

1010
00:38:32,099 --> 00:38:34,140
have occurred inside there really really

1011
00:38:34,140 --> 00:38:38,119
handy they do also have What's called

1012
00:38:38,119 --> 00:38:41,760
the denied policy events which are

1013
00:38:41,760 --> 00:38:43,560
turned on by default and this is the

1014
00:38:43,560 --> 00:38:45,300
thing in the the middle column there or

1015
00:38:45,300 --> 00:38:46,859
the the one on the right hand side of

1016
00:38:46,859 --> 00:38:49,380
the two columns these are on by default

1017
00:38:49,380 --> 00:38:50,760
but you can turn them off and they're

1018
00:38:50,760 --> 00:38:53,700
only held for 30 days now these denied

1019
00:38:53,700 --> 00:38:56,160
audit events occur when someone inside

1020
00:38:56,160 --> 00:38:57,780
of the Google Cloud platform does

1021
00:38:57,780 --> 00:38:59,820
something that they're not authorized to

1022
00:38:59,820 --> 00:39:01,859
do regardless of whether they're an

1023
00:39:01,859 --> 00:39:03,480
admin or a standard user

1024
00:39:03,480 --> 00:39:05,400
and you get those turned on by default

1025
00:39:05,400 --> 00:39:07,859
for 30 days as well

1026
00:39:07,859 --> 00:39:09,960
on top of this there's some other really

1027
00:39:09,960 --> 00:39:12,060
cool things that Google do as well like

1028
00:39:12,060 --> 00:39:14,160
give you the ability to go and turn on

1029
00:39:14,160 --> 00:39:16,920
additional auditing logs as well inside

1030
00:39:16,920 --> 00:39:19,560
of the IM section of each project there

1031
00:39:19,560 --> 00:39:21,480
is the audit logs component down the

1032
00:39:21,480 --> 00:39:23,400
left hand side there and then you can go

1033
00:39:23,400 --> 00:39:25,440
and basically tick and turn these on and

1034
00:39:25,440 --> 00:39:26,579
you can turn them on based on whether

1035
00:39:26,579 --> 00:39:28,079
they're standard Jews has been turned on

1036
00:39:28,079 --> 00:39:29,520
or whether they're admin tasks being

1037
00:39:29,520 --> 00:39:31,859
turned on as well the other really nice

1038
00:39:31,859 --> 00:39:33,660
thing that Google do inside the Google

1039
00:39:33,660 --> 00:39:36,660
Cloud platform is they give you 50 gigs

1040
00:39:36,660 --> 00:39:40,500
per month per project for free

1041
00:39:40,500 --> 00:39:43,740
so if you can not produce more than 50

1042
00:39:43,740 --> 00:39:46,339
gigs worth of logs per project per month

1043
00:39:46,339 --> 00:39:48,660
and you're not going to hold the logs

1044
00:39:48,660 --> 00:39:51,000
for longer than 30 days it costs you

1045
00:39:51,000 --> 00:39:53,400
nothing as part of that once you go over

1046
00:39:53,400 --> 00:39:55,560
those limits either of those it starts

1047
00:39:55,560 --> 00:39:57,420
to cost you money but they're trying to

1048
00:39:57,420 --> 00:40:00,420
really enable people to try to hold logs

1049
00:40:00,420 --> 00:40:02,640
and try to be able to investigate things

1050
00:40:02,640 --> 00:40:05,040
as part of it now 30 days is not huge

1051
00:40:05,040 --> 00:40:07,560
yes I get that but they are trying to

1052
00:40:07,560 --> 00:40:09,599
encourage people to hold logs and to

1053
00:40:09,599 --> 00:40:12,300
hold this type of data as well to

1054
00:40:12,300 --> 00:40:14,280
basically do investigations

1055
00:40:14,280 --> 00:40:16,020
the other nice thing is they do give you

1056
00:40:16,020 --> 00:40:18,359
the ability to search these logs as well

1057
00:40:18,359 --> 00:40:20,880
similar to kind of what you saw with the

1058
00:40:20,880 --> 00:40:22,920
cloud trial component the search is a

1059
00:40:22,920 --> 00:40:24,780
little bit more involved inside of

1060
00:40:24,780 --> 00:40:26,820
Google Cloud we can go and search those

1061
00:40:26,820 --> 00:40:29,460
logs we see a histogram we can see we

1062
00:40:29,460 --> 00:40:31,560
can actually write searches in sort of

1063
00:40:31,560 --> 00:40:33,839
sqlite format at the top there and then

1064
00:40:33,839 --> 00:40:35,460
get a bunch of detail down the bottom

1065
00:40:35,460 --> 00:40:37,859
this is just a view of what that looks

1066
00:40:37,859 --> 00:40:39,359
like inside there I won't go into a lot

1067
00:40:39,359 --> 00:40:41,160
of detail for it but understand you can

1068
00:40:41,160 --> 00:40:42,960
go and search those logs inside of there

1069
00:40:42,960 --> 00:40:44,820
as well

1070
00:40:44,820 --> 00:40:46,260
all right the last thing which is just

1071
00:40:46,260 --> 00:40:48,420
around storage for them now Google Cloud

1072
00:40:48,420 --> 00:40:51,599
holds logs in what they call log buckets

1073
00:40:51,599 --> 00:40:53,520
by default you can actually redirect the

1074
00:40:53,520 --> 00:40:55,500
logs to a couple of other places but

1075
00:40:55,500 --> 00:40:56,760
just to start with you can hold them in

1076
00:40:56,760 --> 00:40:58,980
what are called log buckets the bottom

1077
00:40:58,980 --> 00:41:00,660
bucket that you see on the screen here

1078
00:41:00,660 --> 00:41:02,940
which is the underscore required bucket

1079
00:41:02,940 --> 00:41:05,700
it is set to 400 Days you can't change

1080
00:41:05,700 --> 00:41:08,160
that that is hard set whereas that

1081
00:41:08,160 --> 00:41:10,380
default bucket on the first line the

1082
00:41:10,380 --> 00:41:12,900
underscore default it is set to 30 days

1083
00:41:12,900 --> 00:41:15,119
and that holds the policy denied events

1084
00:41:15,119 --> 00:41:16,800
and this is actually where every event

1085
00:41:16,800 --> 00:41:18,660
goes if you don't set up another bucket

1086
00:41:18,660 --> 00:41:21,240
anyway and it is set to 30 Days by

1087
00:41:21,240 --> 00:41:22,740
default but you can go and change that

1088
00:41:22,740 --> 00:41:24,240
so you can go and make that smaller or

1089
00:41:24,240 --> 00:41:26,280
larger depending on what you want to do

1090
00:41:26,280 --> 00:41:28,440
as part of it

1091
00:41:28,440 --> 00:41:30,240
alrighty now let's talk about some

1092
00:41:30,240 --> 00:41:32,040
useful resources to give you something

1093
00:41:32,040 --> 00:41:33,420
to take away

1094
00:41:33,420 --> 00:41:36,440
yeah we'll wrap this up before we get

1095
00:41:36,440 --> 00:41:39,300
offices instead

1096
00:41:39,300 --> 00:41:41,040
and stag things everything we talked

1097
00:41:41,040 --> 00:41:43,619
about here goes way more in depth in our

1098
00:41:43,619 --> 00:41:46,980
now sixth day Enterprise Cloud forensics

1099
00:41:46,980 --> 00:41:49,140
and IR course is running this week is

1100
00:41:49,140 --> 00:41:51,000
running on demand we've got sessions

1101
00:41:51,000 --> 00:41:54,300
throughout the rest of the year go in

1102
00:41:54,300 --> 00:41:57,119
grab that we have a cert now associated

1103
00:41:57,119 --> 00:41:59,220
with this course coming out so very

1104
00:41:59,220 --> 00:42:01,920
exciting stuff go check out that course

1105
00:42:01,920 --> 00:42:04,140
um the schedule is below it at slash

1106
00:42:04,140 --> 00:42:07,500
schedule we mentioned uh a lot of API

1107
00:42:07,500 --> 00:42:09,540
pulling stuff we have a lot of scripts

1108
00:42:09,540 --> 00:42:11,339
to assist you with this and our

1109
00:42:11,339 --> 00:42:15,300
resources on GitHub at 4509.com GitHub

1110
00:42:15,300 --> 00:42:17,099
including my tool to pull Google

1111
00:42:17,099 --> 00:42:18,900
workspace logs

1112
00:42:18,900 --> 00:42:22,980
new new the Google uh the cloud dfir

1113
00:42:22,980 --> 00:42:25,440
poster I created this I wanted it

1114
00:42:25,440 --> 00:42:27,420
perfectly scheduled for release here so

1115
00:42:27,420 --> 00:42:29,520
if you go alcohol across to the swag

1116
00:42:29,520 --> 00:42:31,980
tables you could grab that poster before

1117
00:42:31,980 --> 00:42:34,380
anyone else has access if you're not

1118
00:42:34,380 --> 00:42:37,079
here in person if you're online August

1119
00:42:37,079 --> 00:42:39,240
18th just a couple days after our

1120
00:42:39,240 --> 00:42:41,700
special visitors here get first Peak

1121
00:42:41,700 --> 00:42:43,440
you'll get to grab a digital copy of

1122
00:42:43,440 --> 00:42:45,780
that and then lastly we mentioned how we

1123
00:42:45,780 --> 00:42:48,000
use softball as kind of a way to

1124
00:42:48,000 --> 00:42:51,119
demonstrate log analysis log processing

1125
00:42:51,119 --> 00:42:53,339
um in our course and that is also

1126
00:42:53,339 --> 00:42:55,460
publicly available and free

1127
00:42:55,460 --> 00:42:57,260
4511.com

1128
00:42:57,260 --> 00:43:00,359
the machine and all the parsers for all

1129
00:43:00,359 --> 00:43:03,240
these Cloud surfaces yeah and if you if

1130
00:43:03,240 --> 00:43:04,500
you like doing things like writing

1131
00:43:04,500 --> 00:43:06,359
pauses go and contribute to that project

1132
00:43:06,359 --> 00:43:08,400
as well that is uh that's open on GitHub

1133
00:43:08,400 --> 00:43:10,560
but go and contribute to those parses

1134
00:43:10,560 --> 00:43:12,720
that that tool gets better and better as

1135
00:43:12,720 --> 00:43:14,940
more people add more pauses to it so

1136
00:43:14,940 --> 00:43:16,319
really really handy tool to go and play

1137
00:43:16,319 --> 00:43:17,280
with

1138
00:43:17,280 --> 00:43:19,380
alrighty with that I think we get to

1139
00:43:19,380 --> 00:43:21,820
hand over to q a and

1140
00:43:21,820 --> 00:43:24,969
[Music]

