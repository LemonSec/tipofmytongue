1
00:00:00,000 --> 00:00:05,220
about a specific power analysis

2
00:00:02,009 --> 00:00:07,500
technique that focuses on using timeline

3
00:00:05,220 --> 00:00:10,830
visualization now I know some folks like

4
00:00:07,500 --> 00:00:12,900
Hal Pomeranz that use tide lines to new

5
00:00:10,830 --> 00:00:15,109
malware analysis and I know some other

6
00:00:12,900 --> 00:00:17,400
people that use timelines to do

7
00:00:15,109 --> 00:00:19,529
visualization but I don't really know

8
00:00:17,400 --> 00:00:22,169
anybody that melds those two things

9
00:00:19,529 --> 00:00:25,170
together especially not from an analysis

10
00:00:22,170 --> 00:00:28,199
standpoint to me the analysis is

11
00:00:25,170 --> 00:00:30,029
especially important especially when

12
00:00:28,199 --> 00:00:32,430
you're dealing with situations where you

13
00:00:30,029 --> 00:00:35,239
don't know what it is you're looking for

14
00:00:32,430 --> 00:00:37,920
not who what when why where have you

15
00:00:35,239 --> 00:00:40,559
just know that you have to provide you

16
00:00:37,920 --> 00:00:44,460
have to find the proverbial bad stuff

17
00:00:40,559 --> 00:00:45,930
okay in those types of situations the

18
00:00:44,460 --> 00:00:47,640
most helpful thing from the timeline

19
00:00:45,930 --> 00:00:50,120
perspective I find it's one of the soup

20
00:00:47,640 --> 00:00:53,789
to nuts timelines with long timeline

21
00:00:50,120 --> 00:00:55,709
unfortunately this means that you're

22
00:00:53,789 --> 00:00:57,899
risking making your eyes bleed looking

23
00:00:55,710 --> 00:01:00,180
through millions of lines of entries in

24
00:00:57,899 --> 00:01:01,829
that timeline and they may even fall out

25
00:01:00,180 --> 00:01:05,129
and roll across the floor eventually I

26
00:01:01,829 --> 00:01:06,810
don't want to do that so I use a

27
00:01:05,129 --> 00:01:10,650
visualization technique to help you

28
00:01:06,810 --> 00:01:12,140
drill into it it's also helpful when you

29
00:01:10,650 --> 00:01:14,760
don't have a lot of resources

30
00:01:12,140 --> 00:01:17,280
enterprise-wide Incident Response

31
00:01:14,760 --> 00:01:19,710
platforms malware analysis platforms

32
00:01:17,280 --> 00:01:23,580
things like that that's actually what my

33
00:01:19,710 --> 00:01:27,000
boss and I found ourselves in last year

34
00:01:23,580 --> 00:01:28,740
when our data loss prevention system let

35
00:01:27,000 --> 00:01:31,350
us know that we had some hosts that will

36
00:01:28,740 --> 00:01:33,329
potentially compromised now these hosts

37
00:01:31,350 --> 00:01:35,939
were attempting to very rapidly send

38
00:01:33,329 --> 00:01:38,369
information to servers in Ukraine China

39
00:01:35,939 --> 00:01:40,770
Russia places that they had no business

40
00:01:38,369 --> 00:01:44,460
communicating with we figured that we

41
00:01:40,770 --> 00:01:46,079
had on our hands a add stuff situation

42
00:01:44,460 --> 00:01:47,789
and we needed to get our arms wrapped

43
00:01:46,079 --> 00:01:50,789
around it pretty quickly and be able to

44
00:01:47,790 --> 00:01:52,649
answer some key questions to it my boss

45
00:01:50,790 --> 00:01:54,869
stove down the network side looking at

46
00:01:52,649 --> 00:01:56,579
net flow firewall logs things like that

47
00:01:54,869 --> 00:01:59,780
well I start on systems doing some

48
00:01:56,579 --> 00:02:01,779
triage memory dumps and now

49
00:01:59,780 --> 00:02:04,490
and started imaging hard drive

50
00:02:01,780 --> 00:02:06,440
unfortunately I got nothing from the

51
00:02:04,490 --> 00:02:09,369
triage I got nothing from the ring I

52
00:02:06,440 --> 00:02:11,810
said okay I'm not for Harold I'm not

53
00:02:09,369 --> 00:02:13,430
Andrew case I'm gonna set that stuff

54
00:02:11,810 --> 00:02:16,459
aside for the woman who do what I know

55
00:02:13,430 --> 00:02:18,110
well which is timelines at least that

56
00:02:16,459 --> 00:02:22,760
way maybe I can make Kristin proud of me

57
00:02:18,110 --> 00:02:24,709
so using Intel we had from dlp I started

58
00:02:22,760 --> 00:02:25,850
prepping out sections of timelines that

59
00:02:24,709 --> 00:02:28,760
we figured we're going to be more

60
00:02:25,850 --> 00:02:31,459
relevant for what we needed also cutting

61
00:02:28,760 --> 00:02:35,030
down from millions of rows to hundreds

62
00:02:31,459 --> 00:02:37,940
of thousands of rows load that into all

63
00:02:35,030 --> 00:02:39,980
things Excel let Excel turn on it for a

64
00:02:37,940 --> 00:02:42,560
little bit and then prepared to do some

65
00:02:39,980 --> 00:02:45,649
of the visualization stuff now what can

66
00:02:42,560 --> 00:02:48,680
excel do for me there it's really very

67
00:02:45,650 --> 00:02:51,890
simple using the date field in the

68
00:02:48,680 --> 00:02:54,170
timeline a create a pivot table what

69
00:02:51,890 --> 00:02:57,380
that does for me is it allows me to see

70
00:02:54,170 --> 00:02:59,390
the activity on the system going across

71
00:02:57,380 --> 00:03:01,160
a period of time I get to see the

72
00:02:59,390 --> 00:03:06,768
baseline the normal ebb and flow of

73
00:03:01,160 --> 00:03:08,780
activity and look something like this

74
00:03:06,769 --> 00:03:12,560
we're looking for these kinds of

75
00:03:08,780 --> 00:03:15,200
anomalies all right other than the Evan

76
00:03:12,560 --> 00:03:16,970
flow see huge spike you see a huge drop

77
00:03:15,200 --> 00:03:19,910
you've got something that you need to

78
00:03:16,970 --> 00:03:22,370
dig into further that's what we're going

79
00:03:19,910 --> 00:03:24,620
to do here we now know that I mean this

80
00:03:22,370 --> 00:03:26,570
one date is obviously a key thing we're

81
00:03:24,620 --> 00:03:28,310
going to drill into that we're not done

82
00:03:26,570 --> 00:03:30,620
with the visualization yet though on

83
00:03:28,310 --> 00:03:33,370
that day we're going to create another

84
00:03:30,620 --> 00:03:36,819
pivot table and this one is going

85
00:03:33,370 --> 00:03:39,519
focus on time looking for the same sort

86
00:03:36,819 --> 00:03:42,159
of anomalies and we end up with this so

87
00:03:39,519 --> 00:03:45,340
in the roughly three minutes between 901

88
00:03:42,159 --> 00:03:48,269
and 904 a.m. we've got almost 11,000

89
00:03:45,340 --> 00:03:51,819
events unless last one we had almost

90
00:03:48,269 --> 00:03:56,049
70,000 out of an average of 1700 per day

91
00:03:51,819 --> 00:03:58,060
so we're now down to hoop almost 11,000

92
00:03:56,049 --> 00:03:59,590
that's where we need to start drilling

93
00:03:58,060 --> 00:04:01,629
in that's probably not the point of

94
00:03:59,590 --> 00:04:04,480
infection and it's not that's actually

95
00:04:01,629 --> 00:04:06,760
associated registry changes so we're

96
00:04:04,480 --> 00:04:08,530
going to dive in here look at the actual

97
00:04:06,760 --> 00:04:09,849
brought timeline data but it's not going

98
00:04:08,530 --> 00:04:12,220
to make our eyes to eat because we've

99
00:04:09,849 --> 00:04:15,220
gone from millions of rows to hundreds

100
00:04:12,220 --> 00:04:17,139
of thousands to 70,000 to now maybe

101
00:04:15,220 --> 00:04:18,430
10,000 rows of data that we've got to

102
00:04:17,139 --> 00:04:20,168
look at we're going to look for

103
00:04:18,430 --> 00:04:23,169
anomalies there and they actually will

104
00:04:20,168 --> 00:04:25,359
pop out at us kind of like these to do

105
00:04:23,169 --> 00:04:28,299
else here suspicious from the get-go

106
00:04:25,360 --> 00:04:30,160
they're both the key to the malware they

107
00:04:28,300 --> 00:04:32,680
were found on every single system that

108
00:04:30,160 --> 00:04:35,020
was compromised hashes rawlings the same

109
00:04:32,680 --> 00:04:37,630
name sometimes changed there was also

110
00:04:35,020 --> 00:04:39,820
some mft manipulation did we get to see

111
00:04:37,630 --> 00:04:43,870
in the timeline as well kind of length

112
00:04:39,820 --> 00:04:45,700
with these jpgs here st. jpeg showed up

113
00:04:43,870 --> 00:04:50,229
on every system and you see over there

114
00:04:45,700 --> 00:04:52,990
on the right with the timeline or mft

115
00:04:50,229 --> 00:04:56,169
manipulation on them and also the same

116
00:04:52,990 --> 00:04:57,880
facebook URL on every single system so

117
00:04:56,169 --> 00:05:01,840
now we've got some info that we can take

118
00:04:57,880 --> 00:05:03,520
back to our Graham analysis we've got

119
00:05:01,840 --> 00:05:05,349
the binaries as we can start to do

120
00:05:03,520 --> 00:05:06,700
static analysis on or any kind of

121
00:05:05,349 --> 00:05:09,490
reverse engineering

122
00:05:06,700 --> 00:05:12,340
do and we've got more info for the RAM

123
00:05:09,490 --> 00:05:14,740
as it turns out again the recap stram on

124
00:05:12,340 --> 00:05:17,260
these systems because the malware only

125
00:05:14,740 --> 00:05:20,200
ran under the user that was logged in at

126
00:05:17,260 --> 00:05:22,810
the time that the system got hot so that

127
00:05:20,200 --> 00:05:25,539
kind of impacted our ability to do

128
00:05:22,810 --> 00:05:28,720
things in a normal way anyway that's a

129
00:05:25,540 --> 00:05:31,780
that's pretty much get in a nutshell I'm

130
00:05:28,720 --> 00:05:35,710
here all week I find the technique

131
00:05:31,780 --> 00:05:37,419
helpful I hope others do as well and you

132
00:05:35,710 --> 00:05:39,849
can't talk to me long here you can

133
00:05:37,420 --> 00:05:45,990
certainly find me online by contacting

134
00:05:39,850 --> 00:05:45,990
from you not just arrow or maybe not

135
00:05:49,170 --> 00:05:52,590
thank you very much

