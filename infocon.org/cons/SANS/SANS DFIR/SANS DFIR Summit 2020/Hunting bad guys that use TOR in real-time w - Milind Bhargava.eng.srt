1
00:00:01,040 --> 00:00:07,429
[Music]

2
00:00:12,080 --> 00:00:15,120
excited to

3
00:00:12,799 --> 00:00:16,800
talk about hunting adversaries using

4
00:00:15,120 --> 00:00:20,000
tour so uh

5
00:00:16,800 --> 00:00:22,800
it is the floor is yours sir thank you

6
00:00:20,000 --> 00:00:24,880
so hi everyone i'll be talking today

7
00:00:22,800 --> 00:00:26,240
about hunting bad guys that use store in

8
00:00:24,880 --> 00:00:28,000
real time

9
00:00:26,240 --> 00:00:29,759
and i've got quite a few examples to

10
00:00:28,000 --> 00:00:31,519
talk about like what is store what is

11
00:00:29,760 --> 00:00:33,760
the relation between tor and i are

12
00:00:31,519 --> 00:00:35,839
the lab side up that i built the

13
00:00:33,760 --> 00:00:36,239
patterns the metal framework how it fits

14
00:00:35,840 --> 00:00:38,320
in

15
00:00:36,239 --> 00:00:40,399
some real life examples use cases and

16
00:00:38,320 --> 00:00:41,600
then why is this crucial for iro

17
00:00:40,399 --> 00:00:45,440
why should you pay attention to this

18
00:00:41,600 --> 00:00:48,559
talk rather so first let's talk about

19
00:00:45,440 --> 00:00:49,120
me i have about 12 years of experience

20
00:00:48,559 --> 00:00:51,038
total

21
00:00:49,120 --> 00:00:52,879
my top skills will be threat intel

22
00:00:51,039 --> 00:00:54,559
instant response and accommodation to us

23
00:00:52,879 --> 00:00:56,718
big data analytics

24
00:00:54,559 --> 00:00:58,000
i've been working on torah researching

25
00:00:56,719 --> 00:01:00,559
on tours for the past

26
00:00:58,000 --> 00:01:02,079
12 years and i have spoken at a few

27
00:01:00,559 --> 00:01:03,839
previous conferences as well including

28
00:01:02,079 --> 00:01:06,479
defcon last year

29
00:01:03,840 --> 00:01:07,600
and this has been a passion over time

30
00:01:06,479 --> 00:01:09,280
for me to just find out

31
00:01:07,600 --> 00:01:11,360
more information if i find something as

32
00:01:09,280 --> 00:01:12,320
a black box i have to know about it how

33
00:01:11,360 --> 00:01:15,920
it works

34
00:01:12,320 --> 00:01:18,559
what it is what i can do with it so

35
00:01:15,920 --> 00:01:20,479
let's start with tor so tor stands for

36
00:01:18,560 --> 00:01:22,320
the onion router now this is a very well

37
00:01:20,479 --> 00:01:23,119
known word but most people don't really

38
00:01:22,320 --> 00:01:25,679
understand

39
00:01:23,119 --> 00:01:27,360
what somebody mean by the onion router

40
00:01:25,680 --> 00:01:28,479
now if you focus at the image on the

41
00:01:27,360 --> 00:01:30,479
left side

42
00:01:28,479 --> 00:01:32,560
to explain the onion router part better

43
00:01:30,479 --> 00:01:34,000
i took an image of a sliced onion and i

44
00:01:32,560 --> 00:01:36,000
drew circles on top

45
00:01:34,000 --> 00:01:37,759
just to show what it's like when you

46
00:01:36,000 --> 00:01:39,040
connect to something over tor

47
00:01:37,759 --> 00:01:40,799
you'll use something called a top

48
00:01:39,040 --> 00:01:42,560
browser so you'll first go to an

49
00:01:40,799 --> 00:01:44,479
entry node that's the first layer that

50
00:01:42,560 --> 00:01:46,159
you see outside in red

51
00:01:44,479 --> 00:01:48,159
then you'll come to a relay node which

52
00:01:46,159 --> 00:01:50,320
is completely anonymized

53
00:01:48,159 --> 00:01:51,600
and has every time you pass through

54
00:01:50,320 --> 00:01:53,600
every layer there's a new level of

55
00:01:51,600 --> 00:01:55,600
security that's added on top

56
00:01:53,600 --> 00:01:57,199
so after relay node you come to the exit

57
00:01:55,600 --> 00:01:58,479
node and from the exit node you go to

58
00:01:57,200 --> 00:02:00,240
the actual website

59
00:01:58,479 --> 00:02:01,920
so at minimum there's at least three

60
00:02:00,240 --> 00:02:03,920
layers of production added further

61
00:02:01,920 --> 00:02:05,360
anonymizing and encrypting traffic as

62
00:02:03,920 --> 00:02:07,520
you're going to the actual

63
00:02:05,360 --> 00:02:08,878
website that you're trying to connect to

64
00:02:07,520 --> 00:02:10,239
now based on tor

65
00:02:08,878 --> 00:02:12,640
project website they operate some

66
00:02:10,239 --> 00:02:14,480
metrics on how many people actually use

67
00:02:12,640 --> 00:02:16,000
store on a daily basis

68
00:02:14,480 --> 00:02:18,560
lately there have been more than two

69
00:02:16,000 --> 00:02:20,480
million users and this number was a lot

70
00:02:18,560 --> 00:02:21,520
lower a little while over a few months

71
00:02:20,480 --> 00:02:23,359
earlier rather

72
00:02:21,520 --> 00:02:24,959
and what i feel is just because a lot of

73
00:02:23,360 --> 00:02:26,160
people are now started home and thanks

74
00:02:24,959 --> 00:02:29,200
to covet they're all

75
00:02:26,160 --> 00:02:30,879
enjoying using dog now what is the main

76
00:02:29,200 --> 00:02:31,599
point that people use to order what is

77
00:02:30,879 --> 00:02:33,280
it

78
00:02:31,599 --> 00:02:34,879
that they're trying to have it's

79
00:02:33,280 --> 00:02:36,080
anonymity

80
00:02:34,879 --> 00:02:38,160
there are a lot of countries in the

81
00:02:36,080 --> 00:02:39,760
world where freedom of speech is

82
00:02:38,160 --> 00:02:41,359
prohibited you don't you're not allowed

83
00:02:39,760 --> 00:02:42,720
to post whatever you want or

84
00:02:41,360 --> 00:02:44,879
you're just trying to this is blowing

85
00:02:42,720 --> 00:02:47,599
and so on in those cases

86
00:02:44,879 --> 00:02:48,560
perfect sense is a really helpful thing

87
00:02:47,599 --> 00:02:50,879
but

88
00:02:48,560 --> 00:02:52,319
there's also bad uses of thor like for

89
00:02:50,879 --> 00:02:56,000
example

90
00:02:52,319 --> 00:02:58,238
in uh first of july uh the fbi and cease

91
00:02:56,000 --> 00:02:58,879
advisor of us published an advisory

92
00:02:58,239 --> 00:03:02,000
talking about

93
00:02:58,879 --> 00:03:03,760
how third actors are now using tor

94
00:03:02,000 --> 00:03:05,680
infrastructure for anonymity and

95
00:03:03,760 --> 00:03:07,920
obfuscation to go and do

96
00:03:05,680 --> 00:03:10,560
malicious activities or attack other

97
00:03:07,920 --> 00:03:13,440
systems servers and so on

98
00:03:10,560 --> 00:03:15,120
this is elsa the bad use of torque what

99
00:03:13,440 --> 00:03:16,959
toro is designed for to protect an

100
00:03:15,120 --> 00:03:18,640
opportunity of people trying to use it

101
00:03:16,959 --> 00:03:19,840
trying to protect their freedom of

102
00:03:18,640 --> 00:03:23,599
expression and so on this

103
00:03:19,840 --> 00:03:23,599
not exactly the intended use for it

104
00:03:23,680 --> 00:03:27,920
so how does this fit into ir now

105
00:03:26,480 --> 00:03:29,359
typically if you're working on an

106
00:03:27,920 --> 00:03:31,518
incident responder if you have

107
00:03:29,360 --> 00:03:33,599
worked an incident response and while

108
00:03:31,519 --> 00:03:35,040
going through the log analysis and so on

109
00:03:33,599 --> 00:03:37,280
if you see any traffic

110
00:03:35,040 --> 00:03:38,400
connecting to a tor ip or coming from it

111
00:03:37,280 --> 00:03:40,640
or ib

112
00:03:38,400 --> 00:03:42,080
typically the investigation will end

113
00:03:40,640 --> 00:03:44,399
there because now you're

114
00:03:42,080 --> 00:03:46,799
not sure what to do next because

115
00:03:44,400 --> 00:03:49,519
torrance anonymous and so on

116
00:03:46,799 --> 00:03:50,959
so the top reasons that i found that the

117
00:03:49,519 --> 00:03:53,040
entire investigation

118
00:03:50,959 --> 00:03:54,879
end at a place like this would be

119
00:03:53,040 --> 00:03:55,840
malevolent bad guys communicating

120
00:03:54,879 --> 00:03:58,000
through tor

121
00:03:55,840 --> 00:03:59,599
now recently if you have seen a lot of

122
00:03:58,000 --> 00:04:01,519
malwares and so on when they're

123
00:03:59,599 --> 00:04:04,159
beaconing out to their cnc

124
00:04:01,519 --> 00:04:05,200
system they're going through tor so if

125
00:04:04,159 --> 00:04:07,040
you're typically looking at

126
00:04:05,200 --> 00:04:08,238
investigation you see it's going to tour

127
00:04:07,040 --> 00:04:09,280
and then that's all this kind of

128
00:04:08,239 --> 00:04:11,040
compromise

129
00:04:09,280 --> 00:04:13,599
but still technically your investigation

130
00:04:11,040 --> 00:04:15,760
edit there now that one you're wondering

131
00:04:13,599 --> 00:04:17,519
how did this even happen why didn't the

132
00:04:15,760 --> 00:04:19,680
victim organization actually block

133
00:04:17,519 --> 00:04:22,639
connection to or front or for the

134
00:04:19,680 --> 00:04:25,040
c2 communication to go through and so on

135
00:04:22,639 --> 00:04:27,440
and i work in instant response a lot

136
00:04:25,040 --> 00:04:28,320
and in almost every incident i've been

137
00:04:27,440 --> 00:04:30,320
on

138
00:04:28,320 --> 00:04:32,240
the clients even if they had say a layer

139
00:04:30,320 --> 00:04:33,919
7 firewall very expensive all the bells

140
00:04:32,240 --> 00:04:34,400
and whistles they had thread intel fees

141
00:04:33,919 --> 00:04:36,880
they have

142
00:04:34,400 --> 00:04:38,799
everything money can buy they forgot to

143
00:04:36,880 --> 00:04:40,159
tune it or turn the firewall security

144
00:04:38,800 --> 00:04:41,840
features on

145
00:04:40,160 --> 00:04:43,680
they let all the traffic go through they

146
00:04:41,840 --> 00:04:45,599
let all the traffic come in especially

147
00:04:43,680 --> 00:04:47,919
for tor traffic and so on

148
00:04:45,600 --> 00:04:49,440
and hence even if the client got

149
00:04:47,919 --> 00:04:51,840
compromised through any other means

150
00:04:49,440 --> 00:04:53,520
if they had just disabled this some form

151
00:04:51,840 --> 00:04:54,880
of communication on c2 or data

152
00:04:53,520 --> 00:04:57,280
exploration

153
00:04:54,880 --> 00:04:58,639
may not have happened and data

154
00:04:57,280 --> 00:05:00,479
exploration with todd

155
00:04:58,639 --> 00:05:02,639
for me came out a few interesting things

156
00:05:00,479 --> 00:05:04,000
as well in one client's case actually

157
00:05:02,639 --> 00:05:05,919
noticed data

158
00:05:04,000 --> 00:05:07,600
being infiltrated basically coming in

159
00:05:05,919 --> 00:05:10,080
from another client

160
00:05:07,600 --> 00:05:10,960
or whoever that company was through a

161
00:05:10,080 --> 00:05:13,039
tor node

162
00:05:10,960 --> 00:05:14,638
onto our client's system and then from

163
00:05:13,039 --> 00:05:15,440
our client taken somewhere else again

164
00:05:14,639 --> 00:05:17,600
through talk

165
00:05:15,440 --> 00:05:18,719
so we saw big chunks of data close to a

166
00:05:17,600 --> 00:05:20,880
few terabytes

167
00:05:18,720 --> 00:05:21,840
coming into the client from tor and then

168
00:05:20,880 --> 00:05:23,759
going out

169
00:05:21,840 --> 00:05:25,359
and we still had spaces of file left

170
00:05:23,759 --> 00:05:27,039
when we did the forensics that's why we

171
00:05:25,360 --> 00:05:28,560
found out it's a different company

172
00:05:27,039 --> 00:05:30,080
and it's just interesting how thread

173
00:05:28,560 --> 00:05:31,360
actors are hiding their tracks better by

174
00:05:30,080 --> 00:05:35,840
moving data

175
00:05:31,360 --> 00:05:37,360
through higher organizations now

176
00:05:35,840 --> 00:05:38,880
first of all the incident background to

177
00:05:37,360 --> 00:05:40,800
help you better understand what is it

178
00:05:38,880 --> 00:05:43,280
that i was trying to do

179
00:05:40,800 --> 00:05:44,320
so we got hold of our client they had

180
00:05:43,280 --> 00:05:46,880
ransomware and

181
00:05:44,320 --> 00:05:47,520
issues going on according to the client

182
00:05:46,880 --> 00:05:49,759
they had

183
00:05:47,520 --> 00:05:51,198
some printers available for access

184
00:05:49,759 --> 00:05:52,720
including the kind where you can send an

185
00:05:51,199 --> 00:05:54,560
email and print things and so on so

186
00:05:52,720 --> 00:05:54,960
printers essentially directly connected

187
00:05:54,560 --> 00:05:57,520
or

188
00:05:54,960 --> 00:05:59,599
through an app they had web servers

189
00:05:57,520 --> 00:06:02,240
websites and dmgs in the whole

190
00:05:59,600 --> 00:06:03,039
to buy they also had default apache

191
00:06:02,240 --> 00:06:04,720
pages

192
00:06:03,039 --> 00:06:06,880
now in the clinic's case they were

193
00:06:04,720 --> 00:06:09,039
developing some new technologies

194
00:06:06,880 --> 00:06:10,319
things and so on and they just decided

195
00:06:09,039 --> 00:06:11,840
to leave everything open when the

196
00:06:10,319 --> 00:06:14,400
incident happened and they're not sure

197
00:06:11,840 --> 00:06:16,080
if the incident happened because of that

198
00:06:14,400 --> 00:06:18,719
obviously the client had firewalls and

199
00:06:16,080 --> 00:06:20,800
had a lot of scared and iot devices

200
00:06:18,720 --> 00:06:23,440
so this time you're thinking easily any

201
00:06:20,800 --> 00:06:25,440
of these could be the one responsible

202
00:06:23,440 --> 00:06:27,199
in our ocean scanning and every time we

203
00:06:25,440 --> 00:06:29,520
onboard a client as part of incident

204
00:06:27,199 --> 00:06:30,400
response we perform scans using showdown

205
00:06:29,520 --> 00:06:31,919
and so on

206
00:06:30,400 --> 00:06:34,000
try and understand what part of the

207
00:06:31,919 --> 00:06:36,318
client infrastructure may be exposed

208
00:06:34,000 --> 00:06:38,160
and say based on shorthand science time

209
00:06:36,319 --> 00:06:39,600
when it was last exposed and things like

210
00:06:38,160 --> 00:06:40,639
that so we can get some history out of

211
00:06:39,600 --> 00:06:42,720
it

212
00:06:40,639 --> 00:06:44,560
we found there are a lot of unpatched

213
00:06:42,720 --> 00:06:45,600
web servers some going back at least

214
00:06:44,560 --> 00:06:47,199
seven years

215
00:06:45,600 --> 00:06:48,720
so definitely they don't have a good

216
00:06:47,199 --> 00:06:50,960
patch management system

217
00:06:48,720 --> 00:06:52,800
we found systems running windows 2003

218
00:06:50,960 --> 00:06:54,159
that a client forgot about

219
00:06:52,800 --> 00:06:55,919
apparently there was supposed to be date

220
00:06:54,160 --> 00:06:56,479
commission a few years earlier and then

221
00:06:55,919 --> 00:06:57,919
the client

222
00:06:56,479 --> 00:06:59,520
forgot about it and everybody else

223
00:06:57,919 --> 00:07:01,599
forgot about it but it was still

224
00:06:59,520 --> 00:07:03,599
connected to the network and so on

225
00:07:01,599 --> 00:07:05,599
and then we found ftp servers without

226
00:07:03,599 --> 00:07:06,880
authentication what that means is you

227
00:07:05,599 --> 00:07:09,440
will connect to the client's

228
00:07:06,880 --> 00:07:11,039
ftp system using the username anonymous

229
00:07:09,440 --> 00:07:11,680
and a blank password and just let you

230
00:07:11,039 --> 00:07:13,599
connect

231
00:07:11,680 --> 00:07:15,199
your full read and write access and then

232
00:07:13,599 --> 00:07:17,039
you can take anything you want and even

233
00:07:15,199 --> 00:07:19,440
put anything you want

234
00:07:17,039 --> 00:07:21,199
so at this point any of these could be a

235
00:07:19,440 --> 00:07:22,560
reason for the hat

236
00:07:21,199 --> 00:07:25,039
what we found was something a little

237
00:07:22,560 --> 00:07:28,479
different we also found a lot of linux

238
00:07:25,039 --> 00:07:30,080
embedded systems and of all the

239
00:07:28,479 --> 00:07:31,599
embedded system i'll say the most

240
00:07:30,080 --> 00:07:33,440
popular one that we have seen is

241
00:07:31,599 --> 00:07:35,759
something called busy box

242
00:07:33,440 --> 00:07:37,120
it's like the swiss army knife of linux

243
00:07:35,759 --> 00:07:38,880
embedded systems it has a lot of

244
00:07:37,120 --> 00:07:40,720
frictionality a lot of tools but then it

245
00:07:38,880 --> 00:07:43,360
just makes life easier

246
00:07:40,720 --> 00:07:44,240
so we found was the attacker was able to

247
00:07:43,360 --> 00:07:47,199
compromise

248
00:07:44,240 --> 00:07:48,400
one of the linux embedded system connect

249
00:07:47,199 --> 00:07:49,759
to it because it was accepting

250
00:07:48,400 --> 00:07:53,359
connections over telnet

251
00:07:49,759 --> 00:07:54,800
obviously and then able to get the

252
00:07:53,360 --> 00:07:57,039
credentials that were stored on that

253
00:07:54,800 --> 00:07:58,879
device which coincidentally happened to

254
00:07:57,039 --> 00:08:00,560
be the same credentials used for local

255
00:07:58,879 --> 00:08:02,160
admin across the network

256
00:08:00,560 --> 00:08:03,759
because somebody thought would be easier

257
00:08:02,160 --> 00:08:05,599
to remember passwords that way

258
00:08:03,759 --> 00:08:07,680
and then compromised by lateral movement

259
00:08:05,599 --> 00:08:09,280
through the entire environment

260
00:08:07,680 --> 00:08:10,960
all of these connections based on the

261
00:08:09,280 --> 00:08:12,239
firewall logs which fortunately was

262
00:08:10,960 --> 00:08:16,000
logging everything

263
00:08:12,240 --> 00:08:17,919
came from tor ivs so we did a search

264
00:08:16,000 --> 00:08:19,919
just out of curiosity on showdown how

265
00:08:17,919 --> 00:08:21,599
many busy box devices are there so we

266
00:08:19,919 --> 00:08:22,878
just put the word busybox and double

267
00:08:21,599 --> 00:08:25,199
quotes and searched

268
00:08:22,879 --> 00:08:26,800
and we identified over 2000 busybook

269
00:08:25,199 --> 00:08:28,000
devices directly connected to the

270
00:08:26,800 --> 00:08:29,840
internet

271
00:08:28,000 --> 00:08:31,199
and most of them if you do a search

272
00:08:29,840 --> 00:08:33,199
yourself as well you'll find they're

273
00:08:31,199 --> 00:08:34,640
quite easily vulnerable

274
00:08:33,200 --> 00:08:37,279
now while going through all of the

275
00:08:34,640 --> 00:08:38,479
traffic logs you're trying to identify

276
00:08:37,279 --> 00:08:39,838
what is the first connection that

277
00:08:38,479 --> 00:08:40,800
happened or when the first connection

278
00:08:39,839 --> 00:08:42,800
happened

279
00:08:40,799 --> 00:08:43,919
followed by trying to identify what is

280
00:08:42,799 --> 00:08:45,920
the

281
00:08:43,919 --> 00:08:47,760
most common pattern or what is the

282
00:08:45,920 --> 00:08:48,800
script or what was the attack method

283
00:08:47,760 --> 00:08:52,399
that was used to

284
00:08:48,800 --> 00:08:54,800
attack the actual client so that one

285
00:08:52,399 --> 00:08:57,440
i found three commands or three set of

286
00:08:54,800 --> 00:09:00,640
commands that were repeating every time

287
00:08:57,440 --> 00:09:02,720
there were two scripts lrs deviant.sh

288
00:09:00,640 --> 00:09:06,480
and eight usa.sh

289
00:09:02,720 --> 00:09:08,959
posted on multiple ip addresses but all

290
00:09:06,480 --> 00:09:09,920
having the same name and or rather these

291
00:09:08,959 --> 00:09:12,239
two names

292
00:09:09,920 --> 00:09:13,199
and each job was basically to download a

293
00:09:12,240 --> 00:09:15,360
particular script

294
00:09:13,200 --> 00:09:18,080
shell script onto the box give it

295
00:09:15,360 --> 00:09:20,399
execution privileges and then execute it

296
00:09:18,080 --> 00:09:21,680
and after these two will run there will

297
00:09:20,399 --> 00:09:23,440
be a telnet section that will be

298
00:09:21,680 --> 00:09:26,239
established right after that

299
00:09:23,440 --> 00:09:27,839
and this went on repeating so i took all

300
00:09:26,240 --> 00:09:29,760
of the traffic that was going

301
00:09:27,839 --> 00:09:32,320
expressively matching this pattern of

302
00:09:29,760 --> 00:09:35,200
slash bin slash busy box

303
00:09:32,320 --> 00:09:36,240
and i checked the ips against known

304
00:09:35,200 --> 00:09:37,760
relay nodes and

305
00:09:36,240 --> 00:09:39,279
nodes and so on just to find out how

306
00:09:37,760 --> 00:09:41,519
many of them are top

307
00:09:39,279 --> 00:09:43,120
rated connections and as you can see in

308
00:09:41,519 --> 00:09:44,000
the graph this was actually a rising

309
00:09:43,120 --> 00:09:45,600
number

310
00:09:44,000 --> 00:09:47,200
so we believe at one point of time the

311
00:09:45,600 --> 00:09:49,040
client was compromised and then over

312
00:09:47,200 --> 00:09:50,480
time it just went on increasing

313
00:09:49,040 --> 00:09:52,160
with a definite compromise and

314
00:09:50,480 --> 00:09:55,519
potentially other activities happening

315
00:09:52,160 --> 00:09:58,640
because all of this was automated

316
00:09:55,519 --> 00:10:01,200
now at this point i decided i need to

317
00:09:58,640 --> 00:10:04,399
get more information about this so i

318
00:10:01,200 --> 00:10:07,200
built a lab and

319
00:10:04,399 --> 00:10:07,519
my motivation was to first identify how

320
00:10:07,200 --> 00:10:09,920
the

321
00:10:07,519 --> 00:10:12,079
client was related to like more about

322
00:10:09,920 --> 00:10:13,680
how this works with dollar and so on

323
00:10:12,079 --> 00:10:16,000
how's the torque connection established

324
00:10:13,680 --> 00:10:17,680
i have a rough idea when but how

325
00:10:16,000 --> 00:10:19,200
and then identifying the true patient

326
00:10:17,680 --> 00:10:20,880
zero now

327
00:10:19,200 --> 00:10:22,320
generally when you're seeing ransomware

328
00:10:20,880 --> 00:10:24,320
your first thought is where is this

329
00:10:22,320 --> 00:10:25,920
spearfishing email where is that link

330
00:10:24,320 --> 00:10:27,680
where's the attachment that may have

331
00:10:25,920 --> 00:10:28,959
come through email or through a web link

332
00:10:27,680 --> 00:10:30,959
and so on

333
00:10:28,959 --> 00:10:33,199
you're generally not thinking on how

334
00:10:30,959 --> 00:10:36,000
that initial file got there

335
00:10:33,200 --> 00:10:38,000
in this client's case the linux emitter

336
00:10:36,000 --> 00:10:39,200
system was compromised using that the

337
00:10:38,000 --> 00:10:41,440
attackers were able to

338
00:10:39,200 --> 00:10:43,360
move around laterally and then place a

339
00:10:41,440 --> 00:10:45,120
few links and malicious files on one of

340
00:10:43,360 --> 00:10:46,880
the accounting servers

341
00:10:45,120 --> 00:10:48,160
and then some folks in the accounting

342
00:10:46,880 --> 00:10:50,399
clicked on that link and

343
00:10:48,160 --> 00:10:51,920
so on happened so the first assumed

344
00:10:50,399 --> 00:10:53,040
patient zero at that point was the

345
00:10:51,920 --> 00:10:54,319
accounting machine

346
00:10:53,040 --> 00:10:56,079
no one really thought about a true

347
00:10:54,320 --> 00:10:57,760
patient zero is when the first

348
00:10:56,079 --> 00:10:59,120
breach or the first infection or the

349
00:10:57,760 --> 00:11:01,600
first

350
00:10:59,120 --> 00:11:04,240
had happen and then in the end complete

351
00:11:01,600 --> 00:11:07,279
the ir investigation

352
00:11:04,240 --> 00:11:07,920
now my challenge is so if i set up a tor

353
00:11:07,279 --> 00:11:10,480
exit node

354
00:11:07,920 --> 00:11:12,560
it's been running for a while i set up a

355
00:11:10,480 --> 00:11:14,959
custom honeypot strip to capture all the

356
00:11:12,560 --> 00:11:15,359
std-based attacks so i took glasstop

357
00:11:14,959 --> 00:11:18,000
it's

358
00:11:15,360 --> 00:11:18,800
quite a popular honeypot for http based

359
00:11:18,000 --> 00:11:21,360
attacks

360
00:11:18,800 --> 00:11:22,959
so i used that learned on how i can make

361
00:11:21,360 --> 00:11:25,279
it better suitable especially for the

362
00:11:22,959 --> 00:11:25,279
attacks

363
00:11:25,839 --> 00:11:30,000
and then i had a big issue or by default

364
00:11:28,800 --> 00:11:31,680
doesn't lock traffic

365
00:11:30,000 --> 00:11:33,120
which is actually a good thing because

366
00:11:31,680 --> 00:11:35,680
if you're logging traffic it beats the

367
00:11:33,120 --> 00:11:37,519
point of the security and anonymity

368
00:11:35,680 --> 00:11:39,279
when trying to log all the traffic or

369
00:11:37,519 --> 00:11:41,519
running the third node i had

370
00:11:39,279 --> 00:11:42,800
one issue that was a really big and

371
00:11:41,519 --> 00:11:45,279
annoying one

372
00:11:42,800 --> 00:11:47,680
a lot of people torrent over top what it

373
00:11:45,279 --> 00:11:49,519
does is one exposes still the actual ip

374
00:11:47,680 --> 00:11:51,760
so there's no real benefit in

375
00:11:49,519 --> 00:11:53,600
doing torrent over tor second the

376
00:11:51,760 --> 00:11:54,000
service providers from whom i've taken

377
00:11:53,600 --> 00:11:56,560
the

378
00:11:54,000 --> 00:11:58,320
system on rent for running the exit node

379
00:11:56,560 --> 00:12:00,239
and so on will shut me down because

380
00:11:58,320 --> 00:12:01,680
i'm breaking the sla of torrenting over

381
00:12:00,240 --> 00:12:02,720
the infrastructure which is not what

382
00:12:01,680 --> 00:12:04,638
they wanted

383
00:12:02,720 --> 00:12:06,639
as a result i had a lot of inconsistent

384
00:12:04,639 --> 00:12:08,959
data because every time the

385
00:12:06,639 --> 00:12:10,000
system goes down needs to be rebuilt it

386
00:12:08,959 --> 00:12:12,319
takes time for the

387
00:12:10,000 --> 00:12:14,480
note to come operational and so on and

388
00:12:12,320 --> 00:12:15,839
in general hammered by attacks from thor

389
00:12:14,480 --> 00:12:17,600
and the internet

390
00:12:15,839 --> 00:12:20,000
you're wondering what's the point of

391
00:12:17,600 --> 00:12:22,320
honey pot in this case

392
00:12:20,000 --> 00:12:24,000
uh honeypot in this case the best way to

393
00:12:22,320 --> 00:12:24,720
explain this is if you're just running a

394
00:12:24,000 --> 00:12:26,320
honeypot

395
00:12:24,720 --> 00:12:29,040
you will capture all the attacks coming

396
00:12:26,320 --> 00:12:30,720
to you if you put a honeypot on a torn

397
00:12:29,040 --> 00:12:33,360
node you see the attacks coming to you

398
00:12:30,720 --> 00:12:34,399
and to everybody else who's being routed

399
00:12:33,360 --> 00:12:37,360
through that tower node for that

400
00:12:34,399 --> 00:12:37,360
duration and so on

401
00:12:37,760 --> 00:12:42,880
now i try to find more information on

402
00:12:40,959 --> 00:12:44,399
what else i can find within the honeypot

403
00:12:42,880 --> 00:12:45,519
logs for the same pattern that i had

404
00:12:44,399 --> 00:12:47,760
with the client

405
00:12:45,519 --> 00:12:48,800
so i went through my logs and i found

406
00:12:47,760 --> 00:12:50,800
there's a lot of

407
00:12:48,800 --> 00:12:52,399
exact pattern that has been repeated in

408
00:12:50,800 --> 00:12:52,719
this case three or four different kind

409
00:12:52,399 --> 00:12:55,120
of

410
00:12:52,720 --> 00:12:56,800
shell scripts based on the file name

411
00:12:55,120 --> 00:12:57,760
different ips that are hosting it and

412
00:12:56,800 --> 00:12:59,680
identify

413
00:12:57,760 --> 00:13:00,880
21 unique ips that are hosting the

414
00:12:59,680 --> 00:13:02,638
malicious scripts

415
00:13:00,880 --> 00:13:04,240
so it's entirely possible that all of

416
00:13:02,639 --> 00:13:06,639
this was part of a

417
00:13:04,240 --> 00:13:09,200
attack campaign or a malware campaign

418
00:13:06,639 --> 00:13:10,880
there were 53 tor ips pushing the steps

419
00:13:09,200 --> 00:13:11,360
that doesn't mean it's 53 different

420
00:13:10,880 --> 00:13:14,160
users

421
00:13:11,360 --> 00:13:15,360
it could be 53 different instances of a

422
00:13:14,160 --> 00:13:16,800
torch circuit or

423
00:13:15,360 --> 00:13:19,040
torque connections or could be if

424
00:13:16,800 --> 00:13:20,639
somebody's connected to one exit out now

425
00:13:19,040 --> 00:13:22,800
for security that's just the exit node

426
00:13:20,639 --> 00:13:25,360
so i'm seeing a different ip address or

427
00:13:22,800 --> 00:13:26,240
the relay it is coming through and so on

428
00:13:25,360 --> 00:13:28,880
but in the list

429
00:13:26,240 --> 00:13:29,680
of the last 30 days of time when i ran

430
00:13:28,880 --> 00:13:32,959
this

431
00:13:29,680 --> 00:13:35,839
there were 4036 unique targets

432
00:13:32,959 --> 00:13:37,439
how do i know they were targets since i

433
00:13:35,839 --> 00:13:39,199
was running the exit node

434
00:13:37,440 --> 00:13:40,800
i was able to see all the traffic that

435
00:13:39,199 --> 00:13:42,399
goes out to the end part

436
00:13:40,800 --> 00:13:44,959
and since all of these traffics were

437
00:13:42,399 --> 00:13:46,959
http it's already unencrypted there's no

438
00:13:44,959 --> 00:13:49,119
talk about decryption of anything so i

439
00:13:46,959 --> 00:13:51,599
could easily see who's being targeted

440
00:13:49,120 --> 00:13:55,279
and how bad or roughly what space are

441
00:13:51,600 --> 00:13:55,279
being applied in each place and so on

442
00:13:55,760 --> 00:13:59,920
now i took this information and i try to

443
00:13:58,079 --> 00:14:00,560
learn what else i can get from all of

444
00:13:59,920 --> 00:14:02,959
the

445
00:14:00,560 --> 00:14:04,079
honeypot logs that are going on so i

446
00:14:02,959 --> 00:14:05,439
couldn't see

447
00:14:04,079 --> 00:14:07,359
all the different kinds of attacks so

448
00:14:05,440 --> 00:14:08,079
what i did was i took a lot of yara

449
00:14:07,360 --> 00:14:10,959
rules

450
00:14:08,079 --> 00:14:12,800
uh sigma rules uh slots retardant made

451
00:14:10,959 --> 00:14:13,920
some of my own sigma rules and yellow

452
00:14:12,800 --> 00:14:15,920
rules too

453
00:14:13,920 --> 00:14:17,760
for the classify on the kind of attacks

454
00:14:15,920 --> 00:14:19,680
or the data that i'm seeing pass through

455
00:14:17,760 --> 00:14:21,040
so i can have a better understanding of

456
00:14:19,680 --> 00:14:22,239
what are threat actors doing or

457
00:14:21,040 --> 00:14:23,519
different thread doctors that are doing

458
00:14:22,240 --> 00:14:26,079
this

459
00:14:23,519 --> 00:14:27,920
now i took the last 30 days and last 365

460
00:14:26,079 --> 00:14:29,199
days just to have a comparison to see

461
00:14:27,920 --> 00:14:30,800
what are the trends or what are the

462
00:14:29,199 --> 00:14:32,959
different activities

463
00:14:30,800 --> 00:14:34,399
and those are very interesting finding

464
00:14:32,959 --> 00:14:36,880
over the last 30 days

465
00:14:34,399 --> 00:14:38,000
70.5 percent of the attacks for sql

466
00:14:36,880 --> 00:14:41,040
injection

467
00:14:38,000 --> 00:14:42,560
over the last 365 days 74.5 percent but

468
00:14:41,040 --> 00:14:45,360
also as fuel injection

469
00:14:42,560 --> 00:14:47,199
pretty much the same consistent activity

470
00:14:45,360 --> 00:14:48,880
over the past one year

471
00:14:47,199 --> 00:14:51,199
and if you notice the rest of the ones

472
00:14:48,880 --> 00:14:53,120
as well remote code execution prospect

473
00:14:51,199 --> 00:14:56,639
scripting web scan and so on

474
00:14:53,120 --> 00:14:58,560
but the exact same size or say the

475
00:14:56,639 --> 00:14:59,760
ranking in the pie chart or do not

476
00:14:58,560 --> 00:15:01,599
charge

477
00:14:59,760 --> 00:15:02,959
if it's a skill injection is first here

478
00:15:01,600 --> 00:15:03,519
it's first in the second one if it's

479
00:15:02,959 --> 00:15:05,839
remote

480
00:15:03,519 --> 00:15:06,880
code execution first and last 365 days

481
00:15:05,839 --> 00:15:10,079
same for

482
00:15:06,880 --> 00:15:11,680
process scripting so just as a basic uh

483
00:15:10,079 --> 00:15:13,680
say if i want to give it a price for the

484
00:15:11,680 --> 00:15:16,160
most favored or that type in the last

485
00:15:13,680 --> 00:15:18,479
one year it would be a sql injection

486
00:15:16,160 --> 00:15:19,760
why specifically this more than others

487
00:15:18,480 --> 00:15:23,120
i'm not entirely

488
00:15:19,760 --> 00:15:24,319
uh sure i've just seen a bigger activity

489
00:15:23,120 --> 00:15:26,240
on this one and

490
00:15:24,320 --> 00:15:28,399
you know this i was trying to identify

491
00:15:26,240 --> 00:15:30,880
what are the different injection attacks

492
00:15:28,399 --> 00:15:32,560
so i saw a lot of attacks going on but

493
00:15:30,880 --> 00:15:33,360
most of them turned out to be injection

494
00:15:32,560 --> 00:15:36,160
based

495
00:15:33,360 --> 00:15:37,519
so i did a special search just to

496
00:15:36,160 --> 00:15:37,759
understand what are the different kind

497
00:15:37,519 --> 00:15:39,360
of

498
00:15:37,759 --> 00:15:41,199
attacks i'm seeing and what patterns

499
00:15:39,360 --> 00:15:44,560
they're following and so on

500
00:15:41,199 --> 00:15:46,079
the most common web scan

501
00:15:44,560 --> 00:15:47,680
activity of the attack string i could

502
00:15:46,079 --> 00:15:49,120
find was this

503
00:15:47,680 --> 00:15:51,599
which looks like it was something

504
00:15:49,120 --> 00:15:53,519
somebody made for a test

505
00:15:51,600 --> 00:15:54,959
the second one as well for php injection

506
00:15:53,519 --> 00:15:57,360
was again

507
00:15:54,959 --> 00:15:59,199
a test string this something very used

508
00:15:57,360 --> 00:16:01,600
as a very popular tool

509
00:15:59,199 --> 00:16:03,279
the third one for sql injection didn't

510
00:16:01,600 --> 00:16:04,639
really stand out either even though this

511
00:16:03,279 --> 00:16:06,320
is the most common one

512
00:16:04,639 --> 00:16:09,279
for searching for anything from

513
00:16:06,320 --> 00:16:12,000
information underscore schema.schema

514
00:16:09,279 --> 00:16:13,439
and this is like a standard uh sql

515
00:16:12,000 --> 00:16:15,440
injection that you can find anywhere

516
00:16:13,440 --> 00:16:16,480
else in any tutorials or automated tools

517
00:16:15,440 --> 00:16:18,800
and so on

518
00:16:16,480 --> 00:16:19,680
so this i try to put all the data

519
00:16:18,800 --> 00:16:22,399
together on

520
00:16:19,680 --> 00:16:23,359
what sees net injection attacks i'm

521
00:16:22,399 --> 00:16:26,000
seeing

522
00:16:23,360 --> 00:16:27,040
in the last 30 days i found more than

523
00:16:26,000 --> 00:16:30,240
900 000

524
00:16:27,040 --> 00:16:32,480
sql injection attacks alone followed by

525
00:16:30,240 --> 00:16:32,959
prostate scripting php injection and so

526
00:16:32,480 --> 00:16:34,880
on

527
00:16:32,959 --> 00:16:36,880
this made me feel that at one point of

528
00:16:34,880 --> 00:16:38,079
time whosoever is using the f-sql

529
00:16:36,880 --> 00:16:40,079
injection attacks

530
00:16:38,079 --> 00:16:42,079
is using an automated tool this is

531
00:16:40,079 --> 00:16:42,719
definitely cannot be targeted manually

532
00:16:42,079 --> 00:16:44,638
because

533
00:16:42,720 --> 00:16:46,480
who has the time to sit through 900 000

534
00:16:44,639 --> 00:16:49,600
attacks or somebody does

535
00:16:46,480 --> 00:16:52,320
i'm not aware of that so

536
00:16:49,600 --> 00:16:53,040
i try to make a live dashboard of all

537
00:16:52,320 --> 00:16:54,959
the attacks

538
00:16:53,040 --> 00:16:56,399
as they're coming in so the panel that

539
00:16:54,959 --> 00:16:58,560
you see on the left side

540
00:16:56,399 --> 00:17:00,880
this is a live dashboard that i made

541
00:16:58,560 --> 00:17:02,160
that filters in all the attack payloads

542
00:17:00,880 --> 00:17:04,400
as they're coming in

543
00:17:02,160 --> 00:17:06,559
along with a count of how many times the

544
00:17:04,400 --> 00:17:07,760
exact same string was used in the last

545
00:17:06,559 --> 00:17:09,839
24 hours

546
00:17:07,760 --> 00:17:12,160
so the first one is used 81 times the

547
00:17:09,839 --> 00:17:14,720
second one 75 times and so on

548
00:17:12,160 --> 00:17:17,439
so the benefit of this is if the same

549
00:17:14,720 --> 00:17:19,760
string is used across multiple websites

550
00:17:17,439 --> 00:17:20,720
you can say to a certain degree of

551
00:17:19,760 --> 00:17:22,160
assurance that

552
00:17:20,720 --> 00:17:23,679
all of those websites the actual

553
00:17:22,160 --> 00:17:25,439
targeted ones are part of the same

554
00:17:23,679 --> 00:17:27,280
campaign

555
00:17:25,439 --> 00:17:29,840
and part of a list that the attacker is

556
00:17:27,280 --> 00:17:31,918
using to go out and return

557
00:17:29,840 --> 00:17:34,240
and then same for the remote execution

558
00:17:31,919 --> 00:17:36,559
the frontal one specifically what

559
00:17:34,240 --> 00:17:37,600
say vendor or what device and so on

560
00:17:36,559 --> 00:17:39,678
people are going after

561
00:17:37,600 --> 00:17:42,639
so last 24 hours this command to find

562
00:17:39,679 --> 00:17:45,120
memory info was run 337 times

563
00:17:42,640 --> 00:17:46,480
same for sql injection i was trying to

564
00:17:45,120 --> 00:17:49,199
find out if

565
00:17:46,480 --> 00:17:51,120
the point is true that multiple

566
00:17:49,200 --> 00:17:53,440
injections or multiple attack strings

567
00:17:51,120 --> 00:17:55,039
were used against a list of targets

568
00:17:53,440 --> 00:17:57,200
there's also a very good chance that a

569
00:17:55,039 --> 00:17:58,080
lot of attack strings actually came

570
00:17:57,200 --> 00:18:00,480
through something that

571
00:17:58,080 --> 00:18:01,760
would look like a checklist or a cheat

572
00:18:00,480 --> 00:18:04,000
sheet

573
00:18:01,760 --> 00:18:06,000
so i took all the php injection attacks

574
00:18:04,000 --> 00:18:07,520
and focused on only the truly unique

575
00:18:06,000 --> 00:18:11,039
ones or something

576
00:18:07,520 --> 00:18:12,559
that is unique and can also go under uh

577
00:18:11,039 --> 00:18:14,240
something like a cheat sheet or

578
00:18:12,559 --> 00:18:17,200
something like a checklist

579
00:18:14,240 --> 00:18:18,240
so in the php injections these that you

580
00:18:17,200 --> 00:18:20,880
notice the

581
00:18:18,240 --> 00:18:22,400
five are only differing in numbers and

582
00:18:20,880 --> 00:18:24,480
maybe one character here and then

583
00:18:22,400 --> 00:18:26,240
otherwise they're exactly the same

584
00:18:24,480 --> 00:18:28,320
the crosstalk scripting actually looks

585
00:18:26,240 --> 00:18:29,840
like it came out of a cheat sheet

586
00:18:28,320 --> 00:18:31,520
if you if you try the first one it

587
00:18:29,840 --> 00:18:32,080
doesn't work make a minor change try the

588
00:18:31,520 --> 00:18:33,679
second one

589
00:18:32,080 --> 00:18:35,439
try the third one try the fourth one and

590
00:18:33,679 --> 00:18:37,760
so on if you

591
00:18:35,440 --> 00:18:39,120
google cross side scripting at our cheat

592
00:18:37,760 --> 00:18:41,360
sheets or sql injection g

593
00:18:39,120 --> 00:18:43,360
cheese you'll find all of these there

594
00:18:41,360 --> 00:18:45,760
same for the sql injection ones

595
00:18:43,360 --> 00:18:47,678
all of these are part of different tools

596
00:18:45,760 --> 00:18:49,520
that can be used for automating attack

597
00:18:47,679 --> 00:18:52,880
so no one that is

598
00:18:49,520 --> 00:18:54,639
directly specific and so on so i took

599
00:18:52,880 --> 00:18:56,640
all of the attacks that look like they

600
00:18:54,640 --> 00:18:57,039
came from automated ones and tried to

601
00:18:56,640 --> 00:18:59,360
find

602
00:18:57,039 --> 00:19:01,280
how many were specific attacks or

603
00:18:59,360 --> 00:19:04,479
someone trying to be

604
00:19:01,280 --> 00:19:05,600
manual or not use an automated tool oh

605
00:19:04,480 --> 00:19:09,919
my god

606
00:19:05,600 --> 00:19:11,039
so in the last month about 85.88 percent

607
00:19:09,919 --> 00:19:13,840
of the

608
00:19:11,039 --> 00:19:15,679
attacks were automated scanning tools

609
00:19:13,840 --> 00:19:17,678
all of them are quite popular and

610
00:19:15,679 --> 00:19:18,880
mostly free or piloted versions are

611
00:19:17,679 --> 00:19:21,919
available

612
00:19:18,880 --> 00:19:22,799
and then 14.12 i found that were actual

613
00:19:21,919 --> 00:19:24,720
experts

614
00:19:22,799 --> 00:19:27,520
that is someone actually going after and

615
00:19:24,720 --> 00:19:30,320
targeting actual companies and so on

616
00:19:27,520 --> 00:19:34,160
so i try to pick two examples where this

617
00:19:30,320 --> 00:19:34,159
actually stood out in a big difference

618
00:19:34,320 --> 00:19:39,039
the first one was a payload string that

619
00:19:37,520 --> 00:19:41,520
i identified as

620
00:19:39,039 --> 00:19:42,320
post action equal to login e path equal

621
00:19:41,520 --> 00:19:45,280
to u name

622
00:19:42,320 --> 00:19:46,480
dollar sign ifs and so on and then try

623
00:19:45,280 --> 00:19:48,879
to find

624
00:19:46,480 --> 00:19:49,840
which exploit or which targeted attack

625
00:19:48,880 --> 00:19:52,559
will this point to

626
00:19:49,840 --> 00:19:54,000
and the reason for that is i found 226

627
00:19:52,559 --> 00:19:56,240
versions of this

628
00:19:54,000 --> 00:19:59,600
with the total attacks between april to

629
00:19:56,240 --> 00:20:01,039
july 2020 numbering 2.8 million

630
00:19:59,600 --> 00:20:03,199
and if you see us computer any other

631
00:20:01,039 --> 00:20:06,400
days there's a massive fight

632
00:20:03,200 --> 00:20:08,080
now even within this every time i try to

633
00:20:06,400 --> 00:20:10,240
find out any information up for

634
00:20:08,080 --> 00:20:12,080
exploit and so on my preferred place to

635
00:20:10,240 --> 00:20:13,919
go to is exploit db

636
00:20:12,080 --> 00:20:16,559
and the reason for that is even if the

637
00:20:13,919 --> 00:20:18,400
experts have not been verified and so on

638
00:20:16,559 --> 00:20:20,000
a lot of expert writers will actually

639
00:20:18,400 --> 00:20:22,000
post an experts there wait for someone

640
00:20:20,000 --> 00:20:24,400
to validate verify it and so on

641
00:20:22,000 --> 00:20:27,039
but you'll find a very good source or a

642
00:20:24,400 --> 00:20:28,799
good repository of all the exploits

643
00:20:27,039 --> 00:20:30,720
that are there and for whatever

644
00:20:28,799 --> 00:20:34,000
volatility that exists

645
00:20:30,720 --> 00:20:36,000
now draytek is a router

646
00:20:34,000 --> 00:20:38,799
firewall and so on manufacturer and they

647
00:20:36,000 --> 00:20:41,039
have a pre-auth remote route rce

648
00:20:38,799 --> 00:20:43,280
now just to note the patch for this was

649
00:20:41,039 --> 00:20:44,559
released in march the expert came out in

650
00:20:43,280 --> 00:20:46,879
march 30th

651
00:20:44,559 --> 00:20:47,600
and somebody on the dates of june 9 10

652
00:20:46,880 --> 00:20:50,000
11 12

653
00:20:47,600 --> 00:20:50,959
each bar is a day decided to paint the

654
00:20:50,000 --> 00:20:54,559
town bread with

655
00:20:50,960 --> 00:20:55,600
attacking numerous endpoints or numerous

656
00:20:54,559 --> 00:20:58,158
systems with

657
00:20:55,600 --> 00:21:00,000
remote code executions then the attack

658
00:20:58,159 --> 00:21:02,960
died again then small spike and then

659
00:21:00,000 --> 00:21:05,200
again on june 23rd and 24th

660
00:21:02,960 --> 00:21:07,440
so based on things like this in

661
00:21:05,200 --> 00:21:08,880
different say threaded providers and so

662
00:21:07,440 --> 00:21:10,159
on you'll notice in their blogs that

663
00:21:08,880 --> 00:21:11,679
they talk about how they're seeing

664
00:21:10,159 --> 00:21:14,559
trends of attackers

665
00:21:11,679 --> 00:21:16,159
that's this exploits say for meri botnet

666
00:21:14,559 --> 00:21:17,760
somebody's testing the botnet certain

667
00:21:16,159 --> 00:21:19,600
such activity has happened and so on

668
00:21:17,760 --> 00:21:21,039
and you're often wondering how do people

669
00:21:19,600 --> 00:21:23,280
know that information

670
00:21:21,039 --> 00:21:24,799
well the easier way is that these

671
00:21:23,280 --> 00:21:26,080
attacks are happening against your

672
00:21:24,799 --> 00:21:27,360
clients infrastructure and then you're

673
00:21:26,080 --> 00:21:28,799
taking the locks from the client and

674
00:21:27,360 --> 00:21:29,760
you're able to pick these things out and

675
00:21:28,799 --> 00:21:31,360
so on

676
00:21:29,760 --> 00:21:33,120
but by running a honeycomb i can

677
00:21:31,360 --> 00:21:34,320
actually see without having to do all of

678
00:21:33,120 --> 00:21:36,080
that hard work

679
00:21:34,320 --> 00:21:37,600
that is i don't have to depend on my

680
00:21:36,080 --> 00:21:39,439
client getting attacked for me to know

681
00:21:37,600 --> 00:21:41,120
for trend of a new malware or

682
00:21:39,440 --> 00:21:43,039
new remote execution that is going

683
00:21:41,120 --> 00:21:44,719
around it really help

684
00:21:43,039 --> 00:21:46,640
explain and understand what are the new

685
00:21:44,720 --> 00:21:49,039
trends what are the new things that are

686
00:21:46,640 --> 00:21:49,039
going on

687
00:21:49,840 --> 00:21:54,799
i found another one and the point was

688
00:21:52,480 --> 00:21:57,280
that the previous ones fight it was a

689
00:21:54,799 --> 00:21:58,400
big massive spike so somebody gave me

690
00:21:57,280 --> 00:22:00,720
advice that i should

691
00:21:58,400 --> 00:22:01,840
also focus on the ones that are very low

692
00:22:00,720 --> 00:22:03,919
in comparison

693
00:22:01,840 --> 00:22:04,959
so most of the exploits or the attacks i

694
00:22:03,919 --> 00:22:07,600
saw were

695
00:22:04,960 --> 00:22:08,960
500 000 and higher then there were some

696
00:22:07,600 --> 00:22:11,678
that were quite low so

697
00:22:08,960 --> 00:22:14,080
like this one 947 times now the

698
00:22:11,679 --> 00:22:16,320
interesting for this one is

699
00:22:14,080 --> 00:22:17,360
this expert came out in 2018 it is

700
00:22:16,320 --> 00:22:19,280
patched

701
00:22:17,360 --> 00:22:21,120
but still people are testing different

702
00:22:19,280 --> 00:22:22,399
exploits to see if they can get hold of

703
00:22:21,120 --> 00:22:24,639
somebody's device

704
00:22:22,400 --> 00:22:26,080
and then maybe write havoc use it as

705
00:22:24,640 --> 00:22:28,960
part of botnet or whatever

706
00:22:26,080 --> 00:22:30,960
else they have got in mind for it so

707
00:22:28,960 --> 00:22:32,480
based on all of these attacks i was able

708
00:22:30,960 --> 00:22:35,679
to map everything back

709
00:22:32,480 --> 00:22:37,280
to mithra's attack framework within the

710
00:22:35,679 --> 00:22:39,120
initial access i'm seeing a lot of

711
00:22:37,280 --> 00:22:40,480
exploit public facing applications

712
00:22:39,120 --> 00:22:41,840
that's where all the s fuel injections

713
00:22:40,480 --> 00:22:43,280
won't come in

714
00:22:41,840 --> 00:22:45,840
and the execution i have a lot of

715
00:22:43,280 --> 00:22:48,000
scripting all the busy box examples

716
00:22:45,840 --> 00:22:49,600
in persistence once you have access to

717
00:22:48,000 --> 00:22:51,679
external remote services

718
00:22:49,600 --> 00:22:53,039
even busy blocks for that matter

719
00:22:51,679 --> 00:22:54,400
discovery now there's a lot of web

720
00:22:53,039 --> 00:22:56,320
scanning going on

721
00:22:54,400 --> 00:22:58,880
even if you're running an nmap scan

722
00:22:56,320 --> 00:23:00,639
through or to any of those websites and

723
00:22:58,880 --> 00:23:02,080
so on whether done by you or by an

724
00:23:00,640 --> 00:23:04,080
actual character

725
00:23:02,080 --> 00:23:06,399
if i happen to be the lucky guy through

726
00:23:04,080 --> 00:23:07,199
whose exit node just goes then i can see

727
00:23:06,400 --> 00:23:10,559
that activity

728
00:23:07,200 --> 00:23:12,240
brought you my nice path lots of command

729
00:23:10,559 --> 00:23:13,918
and control traffic so basically c2

730
00:23:12,240 --> 00:23:16,240
traffic going beaconing out and

731
00:23:13,919 --> 00:23:20,720
so on and then excitation through the

732
00:23:16,240 --> 00:23:23,200
same c2 channels c2 ips and so forth

733
00:23:20,720 --> 00:23:24,880
so i decided i'll take all of these

734
00:23:23,200 --> 00:23:26,559
different categories

735
00:23:24,880 --> 00:23:28,320
and then map all of the honeypot

736
00:23:26,559 --> 00:23:29,600
activity along with the 90 day time

737
00:23:28,320 --> 00:23:32,080
period to show

738
00:23:29,600 --> 00:23:32,959
what are the trends that i've noticed

739
00:23:32,080 --> 00:23:36,000
now in terms of

740
00:23:32,960 --> 00:23:37,679
discovery about 770 000 events

741
00:23:36,000 --> 00:23:38,960
i'll say the graph goes up and down

742
00:23:37,679 --> 00:23:40,000
there have been a few spikes here and

743
00:23:38,960 --> 00:23:42,720
there but

744
00:23:40,000 --> 00:23:44,159
not much for substantial in terms of

745
00:23:42,720 --> 00:23:44,960
execution that's the remote code

746
00:23:44,159 --> 00:23:47,840
executing

747
00:23:44,960 --> 00:23:50,159
and the two spikes are pretty much the

748
00:23:47,840 --> 00:23:52,559
draytek one that we spoke about

749
00:23:50,159 --> 00:23:54,240
the initial access still going up and

750
00:23:52,559 --> 00:23:55,760
down the few spikes here and there

751
00:23:54,240 --> 00:23:57,279
probably on weekends when people are

752
00:23:55,760 --> 00:23:59,039
free and they just want to go out and

753
00:23:57,279 --> 00:24:01,360
attack other sites and so on

754
00:23:59,039 --> 00:24:02,720
but the most interesting one was command

755
00:24:01,360 --> 00:24:04,559
control traffic

756
00:24:02,720 --> 00:24:06,400
which has actually been increasing at a

757
00:24:04,559 --> 00:24:08,080
steady state

758
00:24:06,400 --> 00:24:10,240
and all through the forward long run

759
00:24:08,080 --> 00:24:11,840
period this has actually been going up

760
00:24:10,240 --> 00:24:13,120
so i can definitely say that threat

761
00:24:11,840 --> 00:24:16,879
actors have been very busy with

762
00:24:13,120 --> 00:24:20,158
ransomwares and other related activities

763
00:24:16,880 --> 00:24:22,080
now why is this crucial for ir

764
00:24:20,159 --> 00:24:24,080
now if you've ever worked on any

765
00:24:22,080 --> 00:24:25,120
beaconing for malware as it leaves your

766
00:24:24,080 --> 00:24:26,879
environment or

767
00:24:25,120 --> 00:24:28,879
as you're receiving the beginning

768
00:24:26,880 --> 00:24:29,360
information there's one thing that i've

769
00:24:28,880 --> 00:24:31,919
noticed

770
00:24:29,360 --> 00:24:33,360
in all of my traffic analysis the

771
00:24:31,919 --> 00:24:36,799
receive pipes

772
00:24:33,360 --> 00:24:39,360
if it's 60 62 or 66

773
00:24:36,799 --> 00:24:41,279
this is the byte size if the keeper live

774
00:24:39,360 --> 00:24:42,559
command is coming from the c2 server or

775
00:24:41,279 --> 00:24:44,799
the information

776
00:24:42,559 --> 00:24:46,399
or the request and commands are coming

777
00:24:44,799 --> 00:24:48,799
in on what to do next

778
00:24:46,400 --> 00:24:50,480
this size doesn't actually change across

779
00:24:48,799 --> 00:24:52,080
multiple instances that i've worked on

780
00:24:50,480 --> 00:24:53,679
so after taking all of the data from

781
00:24:52,080 --> 00:24:55,279
honeypot actually went back with a bunch

782
00:24:53,679 --> 00:24:56,080
of reports and other blocks that i've

783
00:24:55,279 --> 00:24:57,520
analyzed

784
00:24:56,080 --> 00:24:59,520
to try and understand if there's

785
00:24:57,520 --> 00:25:02,559
something similar that i have

786
00:24:59,520 --> 00:25:04,400
something that can match these and then

787
00:25:02,559 --> 00:25:07,039
this is an example from a client where

788
00:25:04,400 --> 00:25:09,360
there was outbound beaconing activity to

789
00:25:07,039 --> 00:25:10,640
malicious ips so the firewall's not

790
00:25:09,360 --> 00:25:12,399
blocking anything

791
00:25:10,640 --> 00:25:14,640
we could actually see connection to

792
00:25:12,400 --> 00:25:16,720
known c2yps

793
00:25:14,640 --> 00:25:18,400
where the send bytes was much larger

794
00:25:16,720 --> 00:25:20,080
than the received bytes and overall

795
00:25:18,400 --> 00:25:22,320
there was about a terabyte of data that

796
00:25:20,080 --> 00:25:23,760
was uploaded from the client environment

797
00:25:22,320 --> 00:25:25,840
which a client didn't know about because

798
00:25:23,760 --> 00:25:27,200
the firewall was not actually blocking

799
00:25:25,840 --> 00:25:28,720
all of these traffic

800
00:25:27,200 --> 00:25:30,640
and we could see all the beginning

801
00:25:28,720 --> 00:25:31,760
information when it started when it

802
00:25:30,640 --> 00:25:34,320
stopped

803
00:25:31,760 --> 00:25:35,520
and in interesting point of its talk the

804
00:25:34,320 --> 00:25:37,200
moment the beginning

805
00:25:35,520 --> 00:25:39,120
activity stops is when ransomware has

806
00:25:37,200 --> 00:25:41,840
happened in most cases

807
00:25:39,120 --> 00:25:42,959
ransomware is actually encrypting the

808
00:25:41,840 --> 00:25:45,039
malware that is

809
00:25:42,960 --> 00:25:46,799
beaconing out and so on so if the beacon

810
00:25:45,039 --> 00:25:48,720
activity stops you can know roughly when

811
00:25:46,799 --> 00:25:50,240
malware took effect on that particular

812
00:25:48,720 --> 00:25:57,760
sorry ransomware took effect on that

813
00:25:50,240 --> 00:26:00,880
particular device

814
00:25:57,760 --> 00:26:03,039
okay so i tried to find out how many

815
00:26:00,880 --> 00:26:04,799
attacks that we have seen

816
00:26:03,039 --> 00:26:06,080
in terms of attack traffic versus all

817
00:26:04,799 --> 00:26:08,240
the non-returns

818
00:26:06,080 --> 00:26:10,158
so i've got my own set of rules filters

819
00:26:08,240 --> 00:26:12,480
and so on to identify which of these for

820
00:26:10,159 --> 00:26:15,200
attack traffic and which of these were

821
00:26:12,480 --> 00:26:16,480
not attack traffic so over the last 30

822
00:26:15,200 --> 00:26:19,039
days

823
00:26:16,480 --> 00:26:20,080
about 37.55 percent of the traffic the

824
00:26:19,039 --> 00:26:22,480
one in orange

825
00:26:20,080 --> 00:26:24,480
is the non-attack traffic but about

826
00:26:22,480 --> 00:26:26,640
62.45 was the attack

827
00:26:24,480 --> 00:26:27,919
and this was the same trend across the

828
00:26:26,640 --> 00:26:29,919
points here as well

829
00:26:27,919 --> 00:26:31,760
which perfectly matches the attack to a

830
00:26:29,919 --> 00:26:33,120
donut that i made earlier about

831
00:26:31,760 --> 00:26:34,400
all the different kind of attacks that

832
00:26:33,120 --> 00:26:35,520
are coming through that most of the

833
00:26:34,400 --> 00:26:39,360
traffic has been

834
00:26:35,520 --> 00:26:40,158
based in less but over the past 900 days

835
00:26:39,360 --> 00:26:41,760
which is

836
00:26:40,159 --> 00:26:43,919
roughly the extent i've been running

837
00:26:41,760 --> 00:26:46,799
this little experiment

838
00:26:43,919 --> 00:26:48,240
about 50.83 percent of the attack has

839
00:26:46,799 --> 00:26:50,559
been non-attack

840
00:26:48,240 --> 00:26:52,799
but 50.83 percent of traffic has been

841
00:26:50,559 --> 00:26:54,080
non-attack traffic which means that at

842
00:26:52,799 --> 00:26:55,360
one point of time there's something like

843
00:26:54,080 --> 00:26:57,360
the balance of what

844
00:26:55,360 --> 00:26:58,959
most people just using or for the reason

845
00:26:57,360 --> 00:27:01,600
it is to be used and so on and not

846
00:26:58,960 --> 00:27:01,600
really using it

847
00:27:04,640 --> 00:27:09,120
so in conclusion why is this crucial for

848
00:27:08,159 --> 00:27:10,880
ir

849
00:27:09,120 --> 00:27:12,799
the truth of the matter is there's so

850
00:27:10,880 --> 00:27:14,000
much evidence and the iocs that are

851
00:27:12,799 --> 00:27:16,240
available from tor

852
00:27:14,000 --> 00:27:18,480
if you know where to look by building a

853
00:27:16,240 --> 00:27:20,720
honeypot an incident responder can

854
00:27:18,480 --> 00:27:22,960
be proactive in acquiring this data and

855
00:27:20,720 --> 00:27:24,640
stopping attacks before they even occur

856
00:27:22,960 --> 00:27:26,320
like from learning all the different

857
00:27:24,640 --> 00:27:28,159
things i got from trending from the

858
00:27:26,320 --> 00:27:30,799
analysis and the honeypot from all the

859
00:27:28,159 --> 00:27:32,799
patterns signatures and so on identified

860
00:27:30,799 --> 00:27:34,960
i can actually use that information now

861
00:27:32,799 --> 00:27:37,039
as part of the defensive means as well

862
00:27:34,960 --> 00:27:38,320
to proactively say work with a soft team

863
00:27:37,039 --> 00:27:40,158
or general when you're doing thread

864
00:27:38,320 --> 00:27:41,439
hunting now you have a list of all the

865
00:27:40,159 --> 00:27:43,600
different commands

866
00:27:41,440 --> 00:27:44,480
or the new malware or the new exploits

867
00:27:43,600 --> 00:27:47,760
that are in use

868
00:27:44,480 --> 00:27:49,200
and actively tested in the wild

869
00:27:47,760 --> 00:27:50,799
and once you have a general idea you

870
00:27:49,200 --> 00:27:51,360
know what's coming next in terms of

871
00:27:50,799 --> 00:27:53,760
attacks

872
00:27:51,360 --> 00:27:55,199
like even the uh cyber culture framework

873
00:27:53,760 --> 00:27:57,360
by lockheed martin

874
00:27:55,200 --> 00:28:00,159
it shows first there is a web scanning

875
00:27:57,360 --> 00:28:02,479
and then exploitation delivery and so on

876
00:28:00,159 --> 00:28:04,720
you can see the exact same thing even in

877
00:28:02,480 --> 00:28:06,720
all the traffic logs on the honeypot

878
00:28:04,720 --> 00:28:08,480
versus a lot of scanning with nmap or

879
00:28:06,720 --> 00:28:09,520
other tools then there's actual attacks

880
00:28:08,480 --> 00:28:11,200
that are happening

881
00:28:09,520 --> 00:28:13,279
and then you see potential data

882
00:28:11,200 --> 00:28:14,880
exploration or

883
00:28:13,279 --> 00:28:16,320
remote code executions and things like

884
00:28:14,880 --> 00:28:18,720
that

885
00:28:16,320 --> 00:28:20,158
now if you add this to the possibility

886
00:28:18,720 --> 00:28:21,919
of enhancement or

887
00:28:20,159 --> 00:28:24,000
even qualifying the better threat

888
00:28:21,919 --> 00:28:26,240
hunting activities that you can have

889
00:28:24,000 --> 00:28:27,760
this will be a must-have for any any

890
00:28:26,240 --> 00:28:30,000
incident responder you can

891
00:28:27,760 --> 00:28:31,600
definitely improve or rather reduce the

892
00:28:30,000 --> 00:28:33,039
amount of time it takes for you to find

893
00:28:31,600 --> 00:28:34,158
what is the next threat and so on that

894
00:28:33,039 --> 00:28:36,000
is going on

895
00:28:34,159 --> 00:28:38,080
so another key point that is important

896
00:28:36,000 --> 00:28:39,919
to remember from the talk is

897
00:28:38,080 --> 00:28:41,600
it is actually possible to follow the

898
00:28:39,919 --> 00:28:42,640
breadcrumbs during an incident from

899
00:28:41,600 --> 00:28:44,879
beyond talk

900
00:28:42,640 --> 00:28:46,799
to understand how far the attack is

901
00:28:44,880 --> 00:28:47,760
coming from or where it's going and so

902
00:28:46,799 --> 00:28:49,279
on

903
00:28:47,760 --> 00:28:50,720
and while this talk offers a good

904
00:28:49,279 --> 00:28:51,520
understanding of tor and its

905
00:28:50,720 --> 00:28:54,159
implications

906
00:28:51,520 --> 00:28:55,840
if you push the labs and test further

907
00:28:54,159 --> 00:28:56,960
you can realize that you have a really

908
00:28:55,840 --> 00:28:59,120
good opportunity

909
00:28:56,960 --> 00:29:00,799
with some good setup and hopefully your

910
00:28:59,120 --> 00:29:02,959
torque dimensions not going down

911
00:29:00,799 --> 00:29:04,480
to identify what is exactly happening on

912
00:29:02,960 --> 00:29:05,440
a tour note in terms of malicious

913
00:29:04,480 --> 00:29:07,520
activities

914
00:29:05,440 --> 00:29:08,880
excellent thank you very much uh i

915
00:29:07,520 --> 00:29:10,320
really appreciate that and

916
00:29:08,880 --> 00:29:12,399
i think it's always interesting to see

917
00:29:10,320 --> 00:29:14,158
how some of these technologies can be

918
00:29:12,399 --> 00:29:15,760
used for for dual use

919
00:29:14,159 --> 00:29:17,600
and i was very interested to see that as

920
00:29:15,760 --> 00:29:18,399
you extended the horizon to those 900

921
00:29:17,600 --> 00:29:20,158
days

922
00:29:18,399 --> 00:29:22,000
the way you described it hitting kind of

923
00:29:20,159 --> 00:29:23,679
this balance of uh

924
00:29:22,000 --> 00:29:27,840
you know legitimate versus illegitimate

925
00:29:23,679 --> 00:29:27,840
traffic was pretty fascinating

926
00:29:28,190 --> 00:29:33,029
[Music]

