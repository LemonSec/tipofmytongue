1
00:00:05,680 --> 00:00:08,639
ladies and gentlemen our next speaker is

2
00:00:07,279 --> 00:00:11,280
actually going to be joining us

3
00:00:08,639 --> 00:00:11,840
uh with a talk called new tools for your

4
00:00:11,280 --> 00:00:14,079
threat

5
00:00:11,840 --> 00:00:15,599
hunting toolbox and it's mark maggot hey

6
00:00:14,080 --> 00:00:18,880
mark how you doing today

7
00:00:15,599 --> 00:00:20,480
doing very well thanks um i i usually

8
00:00:18,880 --> 00:00:21,520
i'm gonna tell everyone here in this

9
00:00:20,480 --> 00:00:23,119
very quick introduction because i'm

10
00:00:21,520 --> 00:00:24,800
gonna let mark then take over and he

11
00:00:23,119 --> 00:00:27,279
he needs very little introduction inside

12
00:00:24,800 --> 00:00:28,880
of sans uh long-term sans instructor um

13
00:00:27,279 --> 00:00:30,960
awesome awesome guy developed some of

14
00:00:28,880 --> 00:00:33,519
the coolest tools and quite frankly

15
00:00:30,960 --> 00:00:35,600
has wrangled python like no snake

16
00:00:33,520 --> 00:00:37,360
charmer i've ever met in my life

17
00:00:35,600 --> 00:00:38,719
but one of the things that's always

18
00:00:37,360 --> 00:00:39,920
caught my interest about margin if any

19
00:00:38,719 --> 00:00:40,879
of you have not seen this i'll throw it

20
00:00:39,920 --> 00:00:41,920
in the channel i encourage you to go

21
00:00:40,879 --> 00:00:44,160
check it out mark's

22
00:00:41,920 --> 00:00:45,280
bio is quite frankly one of the most

23
00:00:44,160 --> 00:00:46,078
interesting things

24
00:00:45,280 --> 00:00:47,360
i'm just going to read the first

25
00:00:46,079 --> 00:00:48,879
sentence to you mark baggett's first

26
00:00:47,360 --> 00:00:50,399
foray into information security was on

27
00:00:48,879 --> 00:00:52,399
the receiving end

28
00:00:50,399 --> 00:00:54,559
of hacking i'm just going to put that

29
00:00:52,399 --> 00:00:56,879
there as what a way to get into the uh

30
00:00:54,559 --> 00:00:59,280
to get into the industry if you will

31
00:00:56,879 --> 00:01:01,519
with a great intro like that so uh mark

32
00:00:59,280 --> 00:01:02,640
without really too much delay

33
00:01:01,520 --> 00:01:04,080
i'm gonna hand it over to you ladies and

34
00:01:02,640 --> 00:01:05,280
gentlemen our senior instructor from

35
00:01:04,080 --> 00:01:07,119
sans mark baggett

36
00:01:05,280 --> 00:01:09,280
all yours sir thank you for joining us

37
00:01:07,119 --> 00:01:11,760
thanks matt i really appreciate that

38
00:01:09,280 --> 00:01:13,200
so good morning everyone it is my

39
00:01:11,760 --> 00:01:15,360
pleasure to be here

40
00:01:13,200 --> 00:01:17,040
at the sands threat hunting summit um i

41
00:01:15,360 --> 00:01:19,280
want to introduce some tools to you

42
00:01:17,040 --> 00:01:20,960
that are free open source that you can

43
00:01:19,280 --> 00:01:22,159
use to enhance your threat hunting

44
00:01:20,960 --> 00:01:25,119
capability

45
00:01:22,159 --> 00:01:27,200
um just by way of introduction as matt

46
00:01:25,119 --> 00:01:28,960
said i'm a senior sands instructor i'm

47
00:01:27,200 --> 00:01:32,159
the course author for sans sec

48
00:01:28,960 --> 00:01:33,839
573 and i've been doing this information

49
00:01:32,159 --> 00:01:36,159
security thing for a while so

50
00:01:33,840 --> 00:01:37,119
these these tools i want to present to

51
00:01:36,159 --> 00:01:39,280
you today

52
00:01:37,119 --> 00:01:40,400
the first two of them work kind of the

53
00:01:39,280 --> 00:01:43,920
same way

54
00:01:40,400 --> 00:01:47,280
in that they are intended to

55
00:01:43,920 --> 00:01:48,159
will be assistance if you will in your

56
00:01:47,280 --> 00:01:50,479
threat hunting

57
00:01:48,159 --> 00:01:52,159
capabilities right so when i'm going

58
00:01:50,479 --> 00:01:53,920
through a threat hunting process and i'm

59
00:01:52,159 --> 00:01:57,119
looking at

60
00:01:53,920 --> 00:01:59,119
my my network defense systems and

61
00:01:57,119 --> 00:02:00,560
i'm looking at my host logs i'm i'm

62
00:01:59,119 --> 00:02:01,840
going through the zeke logs i'm going

63
00:02:00,560 --> 00:02:03,200
through my intrusion detection system

64
00:02:01,840 --> 00:02:05,439
logs i'm trying to understand the

65
00:02:03,200 --> 00:02:08,560
attacks there's usually a couple of

66
00:02:05,439 --> 00:02:10,878
things that i do as my first

67
00:02:08,560 --> 00:02:12,720
first attempt to understand what's going

68
00:02:10,878 --> 00:02:14,399
on i want to

69
00:02:12,720 --> 00:02:15,599
make those things easier for you i want

70
00:02:14,400 --> 00:02:16,720
to give you some tools that's going to

71
00:02:15,599 --> 00:02:18,319
assist you with that

72
00:02:16,720 --> 00:02:20,000
i'm doing and these first two tools work

73
00:02:18,319 --> 00:02:21,599
in the same way both of them stand up as

74
00:02:20,000 --> 00:02:23,120
an additional web server

75
00:02:21,599 --> 00:02:25,040
that you would you could either run it

76
00:02:23,120 --> 00:02:27,280
on your you know

77
00:02:25,040 --> 00:02:28,319
your sim host or just some network

78
00:02:27,280 --> 00:02:29,840
that's just going to sit there and

79
00:02:28,319 --> 00:02:31,920
listen on a port

80
00:02:29,840 --> 00:02:34,000
and then you can send little queries to

81
00:02:31,920 --> 00:02:35,518
it and it will do something for you give

82
00:02:34,000 --> 00:02:37,360
you back some piece of data that's going

83
00:02:35,519 --> 00:02:38,879
to supplement either an ip address or a

84
00:02:37,360 --> 00:02:40,959
host name

85
00:02:38,879 --> 00:02:42,720
and then get you started in your threat

86
00:02:40,959 --> 00:02:44,080
hunting experience so

87
00:02:42,720 --> 00:02:46,080
you could run different commands on

88
00:02:44,080 --> 00:02:47,680
different ports but both of these first

89
00:02:46,080 --> 00:02:48,720
two tools work the same way

90
00:02:47,680 --> 00:02:51,360
so the first one i want to tell you

91
00:02:48,720 --> 00:02:53,680
about is a tool called apify

92
00:02:51,360 --> 00:02:56,319
okay a little bit of the history of api

93
00:02:53,680 --> 00:02:58,480
if i i wrote a tool called domain stats

94
00:02:56,319 --> 00:03:00,079
and people liked it it was i got

95
00:02:58,480 --> 00:03:01,440
integrated into security onions some

96
00:03:00,080 --> 00:03:03,760
other platforms like that that

97
00:03:01,440 --> 00:03:04,879
were being used by threat hunters in

98
00:03:03,760 --> 00:03:06,480
order to

99
00:03:04,879 --> 00:03:07,840
figure out what's going on now we'll

100
00:03:06,480 --> 00:03:09,200
talk a little bit about what domain

101
00:03:07,840 --> 00:03:11,680
steps does in a minute

102
00:03:09,200 --> 00:03:13,599
but domain stats had some significant

103
00:03:11,680 --> 00:03:15,200
performance issues domain stats relied

104
00:03:13,599 --> 00:03:16,879
on who is queries right so

105
00:03:15,200 --> 00:03:18,480
i want to get some information about a

106
00:03:16,879 --> 00:03:19,679
domain that i've seen on my network so

107
00:03:18,480 --> 00:03:21,119
i'll do a who is query

108
00:03:19,680 --> 00:03:24,319
so it would do that for you in the

109
00:03:21,120 --> 00:03:26,480
background and keep that information

110
00:03:24,319 --> 00:03:28,238
for those domains it's designed to be

111
00:03:26,480 --> 00:03:31,040
integrated into your logs so

112
00:03:28,239 --> 00:03:32,720
every time i see google.com i don't want

113
00:03:31,040 --> 00:03:34,159
to do a who is look up over and over and

114
00:03:32,720 --> 00:03:35,760
over again so

115
00:03:34,159 --> 00:03:37,519
it would do a who is look up cache the

116
00:03:35,760 --> 00:03:41,200
information and then uh

117
00:03:37,519 --> 00:03:42,480
for each additional google um

118
00:03:41,200 --> 00:03:44,000
every other time google showed up in

119
00:03:42,480 --> 00:03:45,280
your logs it would just grab the cached

120
00:03:44,000 --> 00:03:47,120
information

121
00:03:45,280 --> 00:03:48,480
well a couple of problems that were it

122
00:03:47,120 --> 00:03:51,200
ran into is one

123
00:03:48,480 --> 00:03:52,238
is well who is would rate limit your

124
00:03:51,200 --> 00:03:54,560
number of queries

125
00:03:52,239 --> 00:03:55,840
so your the who is servers didn't quite

126
00:03:54,560 --> 00:03:57,680
like that um if you

127
00:03:55,840 --> 00:03:59,040
read it they say yeah don't use who is

128
00:03:57,680 --> 00:04:00,720
this way

129
00:03:59,040 --> 00:04:03,439
and the other thing is the cash would

130
00:04:00,720 --> 00:04:04,400
just grow to an unlimited size consume

131
00:04:03,439 --> 00:04:06,400
all your memory

132
00:04:04,400 --> 00:04:08,159
and then it would just begin to run so

133
00:04:06,400 --> 00:04:09,040
slow so the longer you ran the bigger

134
00:04:08,159 --> 00:04:12,239
cash got

135
00:04:09,040 --> 00:04:14,000
and then well it just became unusable

136
00:04:12,239 --> 00:04:14,959
when you restarted it the cache was gone

137
00:04:14,000 --> 00:04:17,519
and then you had to start all the way

138
00:04:14,959 --> 00:04:19,918
back over so it had some issues

139
00:04:17,519 --> 00:04:21,280
well as i talked to people it seems like

140
00:04:19,918 --> 00:04:22,320
the only thing that people really use

141
00:04:21,279 --> 00:04:25,039
domain stats for

142
00:04:22,320 --> 00:04:25,360
was the domain creation date right why

143
00:04:25,040 --> 00:04:26,720
would

144
00:04:25,360 --> 00:04:28,479
they be interested in that domain

145
00:04:26,720 --> 00:04:30,639
creation date well as it turns out

146
00:04:28,479 --> 00:04:31,840
legitimate domains like google youtube

147
00:04:30,639 --> 00:04:34,000
reddit slack

148
00:04:31,840 --> 00:04:35,599
these have all been around for a really

149
00:04:34,000 --> 00:04:38,080
long time when

150
00:04:35,600 --> 00:04:38,639
a new company buys a domain it'll take

151
00:04:38,080 --> 00:04:41,039
them

152
00:04:38,639 --> 00:04:42,479
two three years before they build a

153
00:04:41,040 --> 00:04:43,520
credible product around there that

154
00:04:42,479 --> 00:04:45,440
people want to use

155
00:04:43,520 --> 00:04:47,440
that they can get their marketing in

156
00:04:45,440 --> 00:04:48,880
place that people will begin to use the

157
00:04:47,440 --> 00:04:51,120
site and so by

158
00:04:48,880 --> 00:04:52,639
before somebody you see these things in

159
00:04:51,120 --> 00:04:53,919
your domains it's usually a couple of

160
00:04:52,639 --> 00:04:55,840
years before

161
00:04:53,919 --> 00:04:59,359
we have legitimate domains showing up in

162
00:04:55,840 --> 00:05:01,039
our domain in our dns logs but

163
00:04:59,360 --> 00:05:03,199
you know command and control phishing

164
00:05:01,039 --> 00:05:04,080
domains typically attackers are going to

165
00:05:03,199 --> 00:05:06,160
buy those

166
00:05:04,080 --> 00:05:08,800
and then begin using them right away so

167
00:05:06,160 --> 00:05:10,639
this creation date of the domains

168
00:05:08,800 --> 00:05:12,080
is useful pieces of information and

169
00:05:10,639 --> 00:05:13,759
that's really the only thing that people

170
00:05:12,080 --> 00:05:16,960
use domain stats for so

171
00:05:13,759 --> 00:05:18,720
domain stats 1.0 it queried things on

172
00:05:16,960 --> 00:05:19,359
the backend and it cached this stuff and

173
00:05:18,720 --> 00:05:20,960
you could

174
00:05:19,360 --> 00:05:22,479
you could set up a website and then you

175
00:05:20,960 --> 00:05:23,039
could send off these queries and it

176
00:05:22,479 --> 00:05:24,960
would work

177
00:05:23,039 --> 00:05:26,560
okay but again the only thing that

178
00:05:24,960 --> 00:05:30,159
people were using it for were these

179
00:05:26,560 --> 00:05:32,400
creation dates of the domain so

180
00:05:30,160 --> 00:05:33,280
i rewrote it focusing on those domains

181
00:05:32,400 --> 00:05:36,080
that those

182
00:05:33,280 --> 00:05:38,000
the creation dates and two-point domain

183
00:05:36,080 --> 00:05:41,198
stats 2.0 i've published that on

184
00:05:38,000 --> 00:05:43,280
my website on my github page and

185
00:05:41,199 --> 00:05:44,240
the reaction from the community was

186
00:05:43,280 --> 00:05:47,198
overwhelming

187
00:05:44,240 --> 00:05:47,680
thank you it was oh boo can we get the

188
00:05:47,199 --> 00:05:50,160
old

189
00:05:47,680 --> 00:05:50,720
tool back right i want my old domain

190
00:05:50,160 --> 00:05:53,039
stats

191
00:05:50,720 --> 00:05:54,479
um because well i've i'm i'm used to how

192
00:05:53,039 --> 00:05:57,520
that works

193
00:05:54,479 --> 00:05:59,680
so um in response to that

194
00:05:57,520 --> 00:06:00,880
right it had so many performance issues

195
00:05:59,680 --> 00:06:02,160
i just didn't want to continue to

196
00:06:00,880 --> 00:06:06,000
support it because it was broke

197
00:06:02,160 --> 00:06:09,120
so i released a tool called apifi

198
00:06:06,000 --> 00:06:10,400
okay and what api if i is is it's

199
00:06:09,120 --> 00:06:12,720
intended to let you run

200
00:06:10,400 --> 00:06:14,560
any command not just who is but whatever

201
00:06:12,720 --> 00:06:17,360
commands that you want to do

202
00:06:14,560 --> 00:06:18,639
as your first look into looking into ip

203
00:06:17,360 --> 00:06:21,199
addresses host names

204
00:06:18,639 --> 00:06:22,240
whatever right i'm going to give you uh

205
00:06:21,199 --> 00:06:24,479
a webpage

206
00:06:22,240 --> 00:06:26,479
that has a cache that will store those

207
00:06:24,479 --> 00:06:27,919
responses so you can continuously query

208
00:06:26,479 --> 00:06:28,880
it over and over again with your log

209
00:06:27,919 --> 00:06:30,719
systems

210
00:06:28,880 --> 00:06:32,880
and it'll just pull that information

211
00:06:30,720 --> 00:06:35,199
back from the cache so the cache is now

212
00:06:32,880 --> 00:06:36,159
stable you can have limits around how

213
00:06:35,199 --> 00:06:38,720
fast or

214
00:06:36,160 --> 00:06:40,720
how big it grows when things expire and

215
00:06:38,720 --> 00:06:42,800
you can run any command line tool

216
00:06:40,720 --> 00:06:45,120
that you want to so just to get an idea

217
00:06:42,800 --> 00:06:47,919
of how we could use api fi

218
00:06:45,120 --> 00:06:48,800
let's look at a first u use case and

219
00:06:47,919 --> 00:06:50,799
reproduce

220
00:06:48,800 --> 00:06:53,680
the thing that we could would have done

221
00:06:50,800 --> 00:06:56,800
inside of domain stats which was

222
00:06:53,680 --> 00:06:59,599
who is queries so here i have an ls of

223
00:06:56,800 --> 00:07:00,880
api ifi and you can see that there's a

224
00:06:59,599 --> 00:07:02,960
bunch of files in the one i'm really

225
00:07:00,880 --> 00:07:03,919
interested in here is the yaml file so

226
00:07:02,960 --> 00:07:08,159
if i look at this

227
00:07:03,919 --> 00:07:09,599
yaml file here i can see that at the top

228
00:07:08,160 --> 00:07:11,520
i've got lots of different settings that

229
00:07:09,599 --> 00:07:13,199
i can use to control the cache

230
00:07:11,520 --> 00:07:14,560
right i've got a number of cached

231
00:07:13,199 --> 00:07:17,120
entries

232
00:07:14,560 --> 00:07:19,120
i've got uh how long things live in the

233
00:07:17,120 --> 00:07:21,280
cache if you have a negative one here

234
00:07:19,120 --> 00:07:23,039
that means that well it's going to stay

235
00:07:21,280 --> 00:07:25,198
in the cache until expires now

236
00:07:23,039 --> 00:07:27,599
the number of items in the cache are

237
00:07:25,199 --> 00:07:30,960
kept on in there based upon

238
00:07:27,599 --> 00:07:32,400
the most recently used is kept but the

239
00:07:30,960 --> 00:07:34,479
least recently used are the ones that

240
00:07:32,400 --> 00:07:35,840
expire out so if i've got a domain i

241
00:07:34,479 --> 00:07:37,520
only queried once that's going to be

242
00:07:35,840 --> 00:07:38,000
what leaves the cache as opposed to the

243
00:07:37,520 --> 00:07:39,840
thing

244
00:07:38,000 --> 00:07:40,960
google.com which is queried over and

245
00:07:39,840 --> 00:07:41,758
over again is going to stay in that

246
00:07:40,960 --> 00:07:43,919
cache

247
00:07:41,759 --> 00:07:45,039
um for whatever period of time or um

248
00:07:43,919 --> 00:07:47,198
that we've got to find

249
00:07:45,039 --> 00:07:48,639
here some other settings that we've

250
00:07:47,199 --> 00:07:49,599
gotten here that i won't go through all

251
00:07:48,639 --> 00:07:51,280
of these

252
00:07:49,599 --> 00:07:53,039
one thing i'll point out is it does have

253
00:07:51,280 --> 00:07:53,840
debug statements which are turned on by

254
00:07:53,039 --> 00:07:55,440
default

255
00:07:53,840 --> 00:07:56,878
and you want to turn those off when you

256
00:07:55,440 --> 00:07:58,560
use this in production

257
00:07:56,879 --> 00:07:59,919
but down here you can see this base

258
00:07:58,560 --> 00:08:00,720
command that i've got set up for this

259
00:07:59,919 --> 00:08:03,840
example of who

260
00:08:00,720 --> 00:08:07,039
who our api if i is to run who is

261
00:08:03,840 --> 00:08:08,638
and then this asterisk net info that

262
00:08:07,039 --> 00:08:11,440
argument right there is going to be

263
00:08:08,639 --> 00:08:14,560
whatever it is that i put on the url

264
00:08:11,440 --> 00:08:15,199
when i run api fi okay so let's uh let's

265
00:08:14,560 --> 00:08:17,680
go ahead

266
00:08:15,199 --> 00:08:20,000
and come over here and let's run api

267
00:08:17,680 --> 00:08:21,759
file with this configuration

268
00:08:20,000 --> 00:08:23,039
and that asked me if i want to load the

269
00:08:21,759 --> 00:08:24,000
cache from the previous one i'll just

270
00:08:23,039 --> 00:08:24,960
say no

271
00:08:24,000 --> 00:08:26,720
it tells me all right this is the

272
00:08:24,960 --> 00:08:28,400
command i'm going to run who is plus

273
00:08:26,720 --> 00:08:30,240
whatever's on the website so

274
00:08:28,400 --> 00:08:32,240
i can go to the web server it's where

275
00:08:30,240 --> 00:08:34,799
it's listening

276
00:08:32,240 --> 00:08:36,399
slash slash 127.01 and i'll go to

277
00:08:34,799 --> 00:08:38,958
google.com

278
00:08:36,399 --> 00:08:40,958
okay and it goes out and it does a who

279
00:08:38,958 --> 00:08:42,399
is query and i get back who is um for

280
00:08:40,958 --> 00:08:45,119
google.com okay so

281
00:08:42,399 --> 00:08:45,839
this will make get running additional

282
00:08:45,120 --> 00:08:47,279
commands

283
00:08:45,839 --> 00:08:49,120
and this is going to be cached and given

284
00:08:47,279 --> 00:08:51,040
back but you know what i really don't

285
00:08:49,120 --> 00:08:51,760
want all this i just want that creation

286
00:08:51,040 --> 00:08:54,079
date

287
00:08:51,760 --> 00:08:56,160
well inside of the yaml file you can

288
00:08:54,080 --> 00:08:58,800
also associate a regular expression

289
00:08:56,160 --> 00:08:59,600
with the different commands so here the

290
00:08:58,800 --> 00:09:01,120
output of

291
00:08:59,600 --> 00:09:02,800
this whois file is going to be run

292
00:09:01,120 --> 00:09:04,160
through this regular expression

293
00:09:02,800 --> 00:09:06,399
you can define whatever regular

294
00:09:04,160 --> 00:09:07,519
expressions you want to capture whatever

295
00:09:06,399 --> 00:09:10,560
data you want i'm going to stop

296
00:09:07,519 --> 00:09:12,160
api if i rerun it again

297
00:09:10,560 --> 00:09:14,239
no i'm not going to load the cache come

298
00:09:12,160 --> 00:09:18,079
back over here now when i ask for google

299
00:09:14,240 --> 00:09:18,080
right now i'm just going to get back

300
00:09:18,480 --> 00:09:24,399
run api if i did i save my

301
00:09:21,680 --> 00:09:25,519
file here let's save this file let's

302
00:09:24,399 --> 00:09:28,640
come over here

303
00:09:25,519 --> 00:09:32,320
let's come over here to api if i

304
00:09:28,640 --> 00:09:36,000
let's stop this let's start it back

305
00:09:32,320 --> 00:09:37,440
up don't load the cache and then let's

306
00:09:36,000 --> 00:09:40,880
make another request

307
00:09:37,440 --> 00:09:42,880
to google.com okay the radio expression

308
00:09:40,880 --> 00:09:44,800
runs and it pulls back just that data

309
00:09:42,880 --> 00:09:47,040
okay so that's that's an example of how

310
00:09:44,800 --> 00:09:48,959
i could reproduce the content that was

311
00:09:47,040 --> 00:09:50,480
inside of domain stats

312
00:09:48,959 --> 00:09:52,800
so it's a very simple yammer you're just

313
00:09:50,480 --> 00:09:54,399
going to put the command you want to run

314
00:09:52,800 --> 00:09:56,079
right inside of this thing and you're

315
00:09:54,399 --> 00:09:57,120
going to get back a nice json response

316
00:09:56,080 --> 00:10:00,399
that you can consume

317
00:09:57,120 --> 00:10:02,079
into whatever your platform is all right

318
00:10:00,399 --> 00:10:03,680
so let's let's look at what another case

319
00:10:02,079 --> 00:10:05,760
um study might be let's

320
00:10:03,680 --> 00:10:07,839
uh let's say that i want to run trace

321
00:10:05,760 --> 00:10:09,680
routes right so every zeke

322
00:10:07,839 --> 00:10:11,680
um every thing that falls into a

323
00:10:09,680 --> 00:10:15,279
particular uh

324
00:10:11,680 --> 00:10:17,920
type of an event in zeek or i want to

325
00:10:15,279 --> 00:10:19,439
do a trace route on that host right so i

326
00:10:17,920 --> 00:10:22,399
have two hosts on there

327
00:10:19,440 --> 00:10:23,120
if they share the same infrastructure

328
00:10:22,399 --> 00:10:25,200
right then

329
00:10:23,120 --> 00:10:26,320
they might be in the same spot so i want

330
00:10:25,200 --> 00:10:28,000
to know which hops

331
00:10:26,320 --> 00:10:30,160
each of these um different connections

332
00:10:28,000 --> 00:10:31,200
to my network go through but there's a

333
00:10:30,160 --> 00:10:34,399
problem with this

334
00:10:31,200 --> 00:10:36,720
idea and that is well if i try to do a

335
00:10:34,399 --> 00:10:38,160
trace route to google.com here

336
00:10:36,720 --> 00:10:40,320
you can see that my traceroute to

337
00:10:38,160 --> 00:10:42,800
google.com takes a minute

338
00:10:40,320 --> 00:10:45,040
and six seconds so if i'm going to run

339
00:10:42,800 --> 00:10:47,279
this at the speed of log

340
00:10:45,040 --> 00:10:48,959
and run a trace route query that's just

341
00:10:47,279 --> 00:10:50,240
that's just not going to work right so

342
00:10:48,959 --> 00:10:52,000
there are some things i can do to make

343
00:10:50,240 --> 00:10:53,760
traceroute faster

344
00:10:52,000 --> 00:10:55,600
traceroute you can do a dash n which

345
00:10:53,760 --> 00:10:56,560
says don't resolve host names which is

346
00:10:55,600 --> 00:10:59,600
going to make that go

347
00:10:56,560 --> 00:11:00,239
much much faster you can use the dash f

348
00:10:59,600 --> 00:11:01,600
option

349
00:11:00,240 --> 00:11:03,440
and then give it a number and it'll

350
00:11:01,600 --> 00:11:06,560
it'll skip that number

351
00:11:03,440 --> 00:11:09,120
of initial hops right i i know what my

352
00:11:06,560 --> 00:11:10,880
infrastructure looks like i know what my

353
00:11:09,120 --> 00:11:12,800
firewall looks like i know what my

354
00:11:10,880 --> 00:11:14,240
internet service providers

355
00:11:12,800 --> 00:11:15,920
infrastructure look like i'm interested

356
00:11:14,240 --> 00:11:17,360
in what's beyond that because that's

357
00:11:15,920 --> 00:11:18,880
what's unique to

358
00:11:17,360 --> 00:11:20,880
these attackers that are coming into my

359
00:11:18,880 --> 00:11:23,920
rpg so i'll skip the first couple of

360
00:11:20,880 --> 00:11:26,880
requests also tracer out by default it

361
00:11:23,920 --> 00:11:28,319
traces each of those links three times

362
00:11:26,880 --> 00:11:29,680
so i'm going to just change that to just

363
00:11:28,320 --> 00:11:31,440
trace once

364
00:11:29,680 --> 00:11:33,040
and i'm also going to do this over tcp

365
00:11:31,440 --> 00:11:36,320
port 80. so

366
00:11:33,040 --> 00:11:38,079
tcp port 80 don't resolve host just

367
00:11:36,320 --> 00:11:40,160
query it once and skip the first three

368
00:11:38,079 --> 00:11:43,760
hops now my traceroute to google.com

369
00:11:40,160 --> 00:11:45,760
is well sub one second all right so

370
00:11:43,760 --> 00:11:46,959
now this is perhaps something i can work

371
00:11:45,760 --> 00:11:49,839
with so let's put this

372
00:11:46,959 --> 00:11:51,839
into api if i so i'll come over here to

373
00:11:49,839 --> 00:11:53,839
my apify.yaml

374
00:11:51,839 --> 00:11:55,920
i'm gonna comment out these two and you

375
00:11:53,839 --> 00:11:57,839
can see that i've got lots of different

376
00:11:55,920 --> 00:11:59,120
api if i commands in here that are

377
00:11:57,839 --> 00:12:00,880
already written for you

378
00:11:59,120 --> 00:12:02,320
here's my traceroute commands i'm just

379
00:12:00,880 --> 00:12:04,000
going to highlight these and

380
00:12:02,320 --> 00:12:05,360
uncomment them and then i'm going to

381
00:12:04,000 --> 00:12:07,360
save it

382
00:12:05,360 --> 00:12:08,399
and so now i'm going to come back over

383
00:12:07,360 --> 00:12:11,600
here i'm going to

384
00:12:08,399 --> 00:12:12,399
run api if i again and we'll stop this

385
00:12:11,600 --> 00:12:13,920
thing

386
00:12:12,399 --> 00:12:15,120
and you'll notice all these debug

387
00:12:13,920 --> 00:12:17,199
messages these are going to

388
00:12:15,120 --> 00:12:20,399
significantly slow down

389
00:12:17,200 --> 00:12:22,079
your uh your programs you do not want

390
00:12:20,399 --> 00:12:23,600
debugs um turned on

391
00:12:22,079 --> 00:12:25,199
when you got this thing in production

392
00:12:23,600 --> 00:12:27,279
okay um so

393
00:12:25,200 --> 00:12:29,200
here i'm gonna now it's it's set up my

394
00:12:27,279 --> 00:12:30,560
command is gonna run that trace route so

395
00:12:29,200 --> 00:12:32,399
we can come back over here

396
00:12:30,560 --> 00:12:33,839
and we can ask it well let's just go

397
00:12:32,399 --> 00:12:35,760
back to google.com

398
00:12:33,839 --> 00:12:38,000
okay and it does my trace route in the

399
00:12:35,760 --> 00:12:41,040
background to google.com

400
00:12:38,000 --> 00:12:43,279
oh this this is cached sorry

401
00:12:41,040 --> 00:12:44,560
did i save it what's going on here no

402
00:12:43,279 --> 00:12:45,920
that is the right thing let's come over

403
00:12:44,560 --> 00:12:51,880
here and try this

404
00:12:45,920 --> 00:12:54,319
http colon 127.001 port 8000

405
00:12:51,880 --> 00:12:57,279
microsoft.com

406
00:12:54,320 --> 00:12:58,480
okay it's going off it's doing my who is

407
00:12:57,279 --> 00:13:00,160
or it's doing my tracer out in the

408
00:12:58,480 --> 00:13:02,800
background and you can see

409
00:13:00,160 --> 00:13:03,680
24 hops that wasn't too bad for 24 hops

410
00:13:02,800 --> 00:13:05,760
now the beauty of that

411
00:13:03,680 --> 00:13:07,599
is but now that's cache so my next

412
00:13:05,760 --> 00:13:10,639
microsoft query is going to be

413
00:13:07,600 --> 00:13:13,120
well returned instantaneously um

414
00:13:10,639 --> 00:13:13,680
so every time i see that in my log again

415
00:13:13,120 --> 00:13:16,160
i'm not

416
00:13:13,680 --> 00:13:18,000
running that query over and over again

417
00:13:16,160 --> 00:13:19,600
okay so well how effective could this

418
00:13:18,000 --> 00:13:21,120
possibly be

419
00:13:19,600 --> 00:13:23,279
oh some other options that you've got in

420
00:13:21,120 --> 00:13:26,240
domain stats so you do have

421
00:13:23,279 --> 00:13:27,680
a cache entry so you can show what's in

422
00:13:26,240 --> 00:13:29,839
your cache

423
00:13:27,680 --> 00:13:30,800
you've got some tools we can sort this

424
00:13:29,839 --> 00:13:32,480
based upon

425
00:13:30,800 --> 00:13:34,800
the number of hits to times that we're

426
00:13:32,480 --> 00:13:35,279
in the cache and information such as

427
00:13:34,800 --> 00:13:36,639
that

428
00:13:35,279 --> 00:13:38,639
that are available so one of the things

429
00:13:36,639 --> 00:13:40,079
i can do if i wanted to use some tools

430
00:13:38,639 --> 00:13:41,680
that are going to analyze the cache is i

431
00:13:40,079 --> 00:13:43,519
could run a save

432
00:13:41,680 --> 00:13:44,800
and then i could use this tool called

433
00:13:43,519 --> 00:13:46,480
dump cache

434
00:13:44,800 --> 00:13:48,160
that will allow me to sort the

435
00:13:46,480 --> 00:13:49,760
information in the cache so even if you

436
00:13:48,160 --> 00:13:51,920
don't have a seam right

437
00:13:49,760 --> 00:13:53,279
if you don't have um soft elk that's

438
00:13:51,920 --> 00:13:56,079
there doing all of your

439
00:13:53,279 --> 00:13:57,600
analysis for you then you could still

440
00:13:56,079 --> 00:13:59,760
just in your home network where you've

441
00:13:57,600 --> 00:14:02,560
got a very simple network use this tool

442
00:13:59,760 --> 00:14:03,439
and get some good information back from

443
00:14:02,560 --> 00:14:05,119
it

444
00:14:03,440 --> 00:14:06,560
so how effective would this be so what i

445
00:14:05,120 --> 00:14:08,720
did is i went and i grabbed

446
00:14:06,560 --> 00:14:09,839
the sans internet storm centers block

447
00:14:08,720 --> 00:14:11,600
list

448
00:14:09,839 --> 00:14:13,120
let's just take sans internet center on

449
00:14:11,600 --> 00:14:14,800
blacklist and just do

450
00:14:13,120 --> 00:14:16,079
i'm going to run my api file that's

451
00:14:14,800 --> 00:14:16,719
going to do the trace route and i'm

452
00:14:16,079 --> 00:14:19,839
going to do

453
00:14:16,720 --> 00:14:23,040
a wget and just

454
00:14:19,839 --> 00:14:25,360
to each of to my api ifi

455
00:14:23,040 --> 00:14:26,560
and pass each of the ip addresses that

456
00:14:25,360 --> 00:14:29,519
were in

457
00:14:26,560 --> 00:14:30,319
the internet storm centers block list to

458
00:14:29,519 --> 00:14:32,800
api if i

459
00:14:30,320 --> 00:14:34,320
it does the traceroute in the background

460
00:14:32,800 --> 00:14:36,160
and then i can use dump cache

461
00:14:34,320 --> 00:14:38,240
in order to analyze this stuff and just

462
00:14:36,160 --> 00:14:40,480
sort it based upon the data

463
00:14:38,240 --> 00:14:42,160
what you see here is a couple of

464
00:14:40,480 --> 00:14:42,639
different trace routes here so here you

465
00:14:42,160 --> 00:14:44,880
can see

466
00:14:42,639 --> 00:14:46,240
each and every one of these ip addresses

467
00:14:44,880 --> 00:14:48,240
the infrastructure

468
00:14:46,240 --> 00:14:50,399
is exactly the same right look at the

469
00:14:48,240 --> 00:14:53,040
number of hops the ip addresses

470
00:14:50,399 --> 00:14:54,720
these all share the exact same

471
00:14:53,040 --> 00:14:58,480
infrastructure between

472
00:14:54,720 --> 00:15:01,440
them and me but look at the ip ranges

473
00:14:58,480 --> 00:15:02,079
i would venture to guess that if you

474
00:15:01,440 --> 00:15:04,639
just saw

475
00:15:02,079 --> 00:15:06,560
these ip addresses without this

476
00:15:04,639 --> 00:15:07,920
contextual information that says that

477
00:15:06,560 --> 00:15:10,638
hey these have the exact same

478
00:15:07,920 --> 00:15:13,760
infrastructure that you would not guess

479
00:15:10,639 --> 00:15:15,680
that this ip address has any relation to

480
00:15:13,760 --> 00:15:17,120
this ip address and this ip address i

481
00:15:15,680 --> 00:15:19,040
mean these are completely

482
00:15:17,120 --> 00:15:20,880
different subnets or completely

483
00:15:19,040 --> 00:15:22,880
different networks right but they

484
00:15:20,880 --> 00:15:24,800
share the same infrastructure and so

485
00:15:22,880 --> 00:15:27,040
that's useful information

486
00:15:24,800 --> 00:15:28,160
when i'm threat hunting on my network

487
00:15:27,040 --> 00:15:30,880
okay so that's

488
00:15:28,160 --> 00:15:31,839
that's apify it comes with in the um the

489
00:15:30,880 --> 00:15:33,759
ammo you get

490
00:15:31,839 --> 00:15:35,759
several examples that i've got there but

491
00:15:33,759 --> 00:15:37,920
it's really whatever the first commands

492
00:15:35,759 --> 00:15:40,399
that you yourself do to investigate

493
00:15:37,920 --> 00:15:41,599
these um different tools you can put

494
00:15:40,399 --> 00:15:42,160
whatever you want to in there just

495
00:15:41,600 --> 00:15:44,160
replace

496
00:15:42,160 --> 00:15:45,360
the ip address or the the host name or

497
00:15:44,160 --> 00:15:47,439
whatever it is

498
00:15:45,360 --> 00:15:49,360
with that web info thing but i've got

499
00:15:47,440 --> 00:15:51,519
examples in there for pings for

500
00:15:49,360 --> 00:15:53,199
whois lookups for just the creation date

501
00:15:51,519 --> 00:15:54,800
from who is for trace routes with just

502
00:15:53,199 --> 00:15:56,319
getting the last hop or trace routes

503
00:15:54,800 --> 00:15:58,800
getting the first hop

504
00:15:56,320 --> 00:15:59,440
um some geolocation using web apis so

505
00:15:58,800 --> 00:16:01,519
it'll go out

506
00:15:59,440 --> 00:16:03,120
to different websites and it'll look up

507
00:16:01,519 --> 00:16:04,800
the physical location

508
00:16:03,120 --> 00:16:06,480
also you can submit to sans internet

509
00:16:04,800 --> 00:16:07,839
storms there's a configuration there to

510
00:16:06,480 --> 00:16:09,199
submit to the sans internet storm

511
00:16:07,839 --> 00:16:10,959
centers api but

512
00:16:09,199 --> 00:16:12,719
really anything that you want to do you

513
00:16:10,959 --> 00:16:13,680
can um have it do this and then that's

514
00:16:12,720 --> 00:16:15,920
going to do the

515
00:16:13,680 --> 00:16:17,680
the focus is on the caching and running

516
00:16:15,920 --> 00:16:20,800
this thing at the speed of log

517
00:16:17,680 --> 00:16:22,638
okay all right so i mentioned that that

518
00:16:20,800 --> 00:16:23,680
api if i was just a response to the fact

519
00:16:22,639 --> 00:16:25,920
that i broke

520
00:16:23,680 --> 00:16:28,479
um domain stats well what was it that i

521
00:16:25,920 --> 00:16:30,319
was so excited about domain stats to do

522
00:16:28,480 --> 00:16:31,680
well domain stats remember we're looking

523
00:16:30,320 --> 00:16:33,360
for those

524
00:16:31,680 --> 00:16:35,040
new domains that are on the network so

525
00:16:33,360 --> 00:16:36,240
domain stat 2 has been a complete

526
00:16:35,040 --> 00:16:39,040
rewrite

527
00:16:36,240 --> 00:16:39,600
and it's focused on making that creation

528
00:16:39,040 --> 00:16:42,800
date

529
00:16:39,600 --> 00:16:43,839
as useful to us as possible

530
00:16:42,800 --> 00:16:45,279
and it's actually going to take the

531
00:16:43,839 --> 00:16:46,079
domains and it's going to categorize

532
00:16:45,279 --> 00:16:47,519
three

533
00:16:46,079 --> 00:16:49,680
it's going to break the domains down

534
00:16:47,519 --> 00:16:50,800
into a couple of different pieces of

535
00:16:49,680 --> 00:16:53,439
information

536
00:16:50,800 --> 00:16:54,479
you're going to get back scene by web

537
00:16:53,440 --> 00:16:57,600
seen by you

538
00:16:54,480 --> 00:16:58,800
and seen by isc or sans internet storm

539
00:16:57,600 --> 00:17:01,920
center

540
00:16:58,800 --> 00:17:04,559
now the scene by web date

541
00:17:01,920 --> 00:17:06,879
is going to be that traditional born on

542
00:17:04,559 --> 00:17:09,760
date this is the first time

543
00:17:06,880 --> 00:17:10,640
that the internet saw this domain it's

544
00:17:09,760 --> 00:17:13,119
when the domain

545
00:17:10,640 --> 00:17:13,760
was born now rather than getting this

546
00:17:13,119 --> 00:17:16,958
from who

547
00:17:13,760 --> 00:17:17,760
is right which had problems running at

548
00:17:16,959 --> 00:17:20,000
scale

549
00:17:17,760 --> 00:17:21,359
i've i've used a couple of other

550
00:17:20,000 --> 00:17:22,880
solutions in order to get this

551
00:17:21,359 --> 00:17:24,879
information one is

552
00:17:22,880 --> 00:17:26,640
this thing has a database all right it's

553
00:17:24,880 --> 00:17:28,720
gonna i'm gonna be populated with say

554
00:17:26,640 --> 00:17:29,760
the top 1 million most commonly used

555
00:17:28,720 --> 00:17:31,679
domains for so

556
00:17:29,760 --> 00:17:34,240
for domains that have been around for a

557
00:17:31,679 --> 00:17:35,919
while and are very commonly used you're

558
00:17:34,240 --> 00:17:37,120
not going to make any web requests at

559
00:17:35,919 --> 00:17:38,240
all you're not going to do any who is

560
00:17:37,120 --> 00:17:39,678
request you're just going to grab it

561
00:17:38,240 --> 00:17:41,760
from the database

562
00:17:39,679 --> 00:17:43,440
um and i've taken into consideration

563
00:17:41,760 --> 00:17:44,879
when things expire so if you have

564
00:17:43,440 --> 00:17:46,480
something in the database and expires

565
00:17:44,880 --> 00:17:47,840
well then it'll do the whois look up and

566
00:17:46,480 --> 00:17:48,880
update the database

567
00:17:47,840 --> 00:17:50,559
right so you're gonna you've got a

568
00:17:48,880 --> 00:17:52,400
backend database that's gonna minimize

569
00:17:50,559 --> 00:17:55,600
the number of requests that you've got

570
00:17:52,400 --> 00:17:58,160
um and when you do have to go to uh the

571
00:17:55,600 --> 00:17:59,439
web in order to look up what things are

572
00:17:58,160 --> 00:18:01,120
i've got a couple of other things that i

573
00:17:59,440 --> 00:18:02,799
want to do rather than you doing a whois

574
00:18:01,120 --> 00:18:05,439
look up yourself

575
00:18:02,799 --> 00:18:06,000
i want you to well do what who is look

576
00:18:05,440 --> 00:18:07,760
up to

577
00:18:06,000 --> 00:18:09,280
a domain stats server that's running for

578
00:18:07,760 --> 00:18:11,039
the stan's internet storm center and

579
00:18:09,280 --> 00:18:11,918
then they will then do the lookup for

580
00:18:11,039 --> 00:18:13,840
you

581
00:18:11,919 --> 00:18:15,360
and give you back the response so what

582
00:18:13,840 --> 00:18:16,159
that means is i can give you an

583
00:18:15,360 --> 00:18:19,039
additional

584
00:18:16,160 --> 00:18:20,400
piece of information i seen by internet

585
00:18:19,039 --> 00:18:22,320
storm center

586
00:18:20,400 --> 00:18:24,240
is now going to be right the first

587
00:18:22,320 --> 00:18:25,678
contact for everybody who's running

588
00:18:24,240 --> 00:18:27,679
domain stats

589
00:18:25,679 --> 00:18:29,280
so when you query a domain you'll see

590
00:18:27,679 --> 00:18:30,320
that okay this domain has been around

591
00:18:29,280 --> 00:18:32,240
for 10 years

592
00:18:30,320 --> 00:18:33,600
okay um but you're the first person

593
00:18:32,240 --> 00:18:35,280
who's ever queried it

594
00:18:33,600 --> 00:18:37,280
who's running domain stats that might be

595
00:18:35,280 --> 00:18:39,280
interesting or here's a domain that's

596
00:18:37,280 --> 00:18:42,000
brand new to the internet

597
00:18:39,280 --> 00:18:43,520
right it was just registered in the last

598
00:18:42,000 --> 00:18:46,000
30 days

599
00:18:43,520 --> 00:18:48,000
and oh by the way you're the only person

600
00:18:46,000 --> 00:18:50,640
who's using domain stats who's

601
00:18:48,000 --> 00:18:52,400
ever seen this domain okay so we've got

602
00:18:50,640 --> 00:18:53,200
some community intelligence that's going

603
00:18:52,400 --> 00:18:55,679
on there

604
00:18:53,200 --> 00:18:57,440
you also got this seen by you record

605
00:18:55,679 --> 00:18:59,360
which is the first time

606
00:18:57,440 --> 00:19:00,880
you've ever queried this domain so this

607
00:18:59,360 --> 00:19:03,678
is you can think of this as the zone of

608
00:19:00,880 --> 00:19:06,559
alarm of dns names on your network

609
00:19:03,679 --> 00:19:06,880
right you no one in your organization

610
00:19:06,559 --> 00:19:09,678
has

611
00:19:06,880 --> 00:19:10,320
ever queried this particular domain

612
00:19:09,679 --> 00:19:12,960
before

613
00:19:10,320 --> 00:19:14,000
that is useful information right and

614
00:19:12,960 --> 00:19:15,760
then

615
00:19:14,000 --> 00:19:17,360
um there's alerts tied into each of

616
00:19:15,760 --> 00:19:19,679
these things so uh

617
00:19:17,360 --> 00:19:21,039
there's a first seen by you first seen

618
00:19:19,679 --> 00:19:22,640
by internet storm center

619
00:19:21,039 --> 00:19:24,720
um these are going to generate alerts

620
00:19:22,640 --> 00:19:26,720
and sans and storm surf they've

621
00:19:24,720 --> 00:19:29,039
tracked a domain and they know that it's

622
00:19:26,720 --> 00:19:30,400
um bad then the intention is

623
00:19:29,039 --> 00:19:32,400
that they'll be able to send additional

624
00:19:30,400 --> 00:19:34,640
alerts now there's some

625
00:19:32,400 --> 00:19:35,840
there's some caveats um on the sans

626
00:19:34,640 --> 00:19:37,440
internet storm center due to some

627
00:19:35,840 --> 00:19:38,559
coveted things we've got some delays

628
00:19:37,440 --> 00:19:39,919
that are there and i'll talk about that

629
00:19:38,559 --> 00:19:42,000
in just a second

630
00:19:39,919 --> 00:19:43,360
it comes with zeke deployment scripts so

631
00:19:42,000 --> 00:19:44,720
it's already got the zeek script thank

632
00:19:43,360 --> 00:19:46,559
you don williams it's um

633
00:19:44,720 --> 00:19:48,080
already integrated into the platform

634
00:19:46,559 --> 00:19:49,918
that you can just um

635
00:19:48,080 --> 00:19:52,000
tie this into your z scripts and it will

636
00:19:49,919 --> 00:19:54,799
automatically make the queries to domain

637
00:19:52,000 --> 00:19:56,160
stats and look up these domains and

638
00:19:54,799 --> 00:19:59,120
provide this information

639
00:19:56,160 --> 00:20:00,880
back to you it's got a container docker

640
00:19:59,120 --> 00:20:02,559
container deployment so you can just

641
00:20:00,880 --> 00:20:04,000
install this thing in just a couple of

642
00:20:02,559 --> 00:20:05,678
minutes if you've got

643
00:20:04,000 --> 00:20:07,280
dockers running on your system and then

644
00:20:05,679 --> 00:20:08,480
it'll expose that service on your

645
00:20:07,280 --> 00:20:11,039
computer

646
00:20:08,480 --> 00:20:11,840
um but the focus is really on making

647
00:20:11,039 --> 00:20:13,919
this thing

648
00:20:11,840 --> 00:20:15,280
run at the speed of log i wanted to be

649
00:20:13,919 --> 00:20:17,440
able to um

650
00:20:15,280 --> 00:20:19,120
give you back this information and

651
00:20:17,440 --> 00:20:20,960
minimize disk io

652
00:20:19,120 --> 00:20:23,360
keep all of the things local to your

653
00:20:20,960 --> 00:20:25,919
network and not have to do those whois

654
00:20:23,360 --> 00:20:27,678
information uh lookups right it's very

655
00:20:25,919 --> 00:20:28,880
easy to deploy with security onion or

656
00:20:27,679 --> 00:20:30,400
anything that you've got a docker you

657
00:20:28,880 --> 00:20:32,400
can just use these instructions docker

658
00:20:30,400 --> 00:20:34,640
build give it a tag name

659
00:20:32,400 --> 00:20:36,960
have it build directly from the github

660
00:20:34,640 --> 00:20:38,159
page you do have to give it a directory

661
00:20:36,960 --> 00:20:39,840
outside the container

662
00:20:38,159 --> 00:20:41,360
where the database and all of the

663
00:20:39,840 --> 00:20:43,360
logging information and the

664
00:20:41,360 --> 00:20:44,479
yaml configuration file and things are

665
00:20:43,360 --> 00:20:46,479
going to be kept

666
00:20:44,480 --> 00:20:48,000
and then you can docker run run this

667
00:20:46,480 --> 00:20:49,840
thing now i would say the first time you

668
00:20:48,000 --> 00:20:50,960
run it you want to run it visibly in the

669
00:20:49,840 --> 00:20:54,000
background with the dash

670
00:20:50,960 --> 00:20:55,840
i t um option so you can see

671
00:20:54,000 --> 00:20:57,840
it building the database right because

672
00:20:55,840 --> 00:20:58,158
as i said i want to have a database that

673
00:20:57,840 --> 00:20:59,918
has

674
00:20:58,159 --> 00:21:01,840
as many records as i can down there on

675
00:20:59,919 --> 00:21:02,480
your system so you don't have to go out

676
00:21:01,840 --> 00:21:04,720
to the web

677
00:21:02,480 --> 00:21:06,480
this takes about 15-20 minutes depending

678
00:21:04,720 --> 00:21:07,919
upon the size of your system to but to

679
00:21:06,480 --> 00:21:10,240
build that database

680
00:21:07,919 --> 00:21:12,240
and so you don't get impatient and kill

681
00:21:10,240 --> 00:21:13,440
your containers run it visibly in the

682
00:21:12,240 --> 00:21:14,799
foreground so you can see it the first

683
00:21:13,440 --> 00:21:17,120
time but once you've done that

684
00:21:14,799 --> 00:21:19,360
well then you can just run it invisibly

685
00:21:17,120 --> 00:21:21,760
and then docker stop docker start

686
00:21:19,360 --> 00:21:23,760
and it will keep all of the information

687
00:21:21,760 --> 00:21:25,520
inside of this mounted directory that

688
00:21:23,760 --> 00:21:27,919
you've provided it

689
00:21:25,520 --> 00:21:28,840
and outside of the the container for

690
00:21:27,919 --> 00:21:31,200
permanent

691
00:21:28,840 --> 00:21:32,320
storage okay all right so let's do a

692
00:21:31,200 --> 00:21:34,000
quick demo on

693
00:21:32,320 --> 00:21:36,080
domain stats so i'm going to come back

694
00:21:34,000 --> 00:21:38,720
over here and let's stop

695
00:21:36,080 --> 00:21:40,480
api fi because i'm using the same port

696
00:21:38,720 --> 00:21:42,480
and i'm going to run my domain stats and

697
00:21:40,480 --> 00:21:44,960
just point it at this directory

698
00:21:42,480 --> 00:21:46,799
where i've already got some ds data so

699
00:21:44,960 --> 00:21:48,559
that contains my database and other

700
00:21:46,799 --> 00:21:50,320
information so now

701
00:21:48,559 --> 00:21:52,799
let's come back over here and let's just

702
00:21:50,320 --> 00:21:56,080
ask for a domain such as google.com

703
00:21:52,799 --> 00:21:59,200
so if i go to google.com here i can see

704
00:21:56,080 --> 00:22:01,199
i very quickly get back the scene by

705
00:21:59,200 --> 00:22:02,320
on web this is when the domain was

706
00:22:01,200 --> 00:22:04,960
created

707
00:22:02,320 --> 00:22:06,720
seen by you it says local meaning that i

708
00:22:04,960 --> 00:22:08,240
didn't have to query anybody this came

709
00:22:06,720 --> 00:22:10,320
from the local database

710
00:22:08,240 --> 00:22:11,679
right so um i queried the information

711
00:22:10,320 --> 00:22:13,760
got it on my database

712
00:22:11,679 --> 00:22:14,960
seen by you this is the very first time

713
00:22:13,760 --> 00:22:17,600
that um i

714
00:22:14,960 --> 00:22:19,679
looked up the google.com domain um using

715
00:22:17,600 --> 00:22:21,520
this instance of domain stats

716
00:22:19,679 --> 00:22:23,039
now you can close as you see i just

717
00:22:21,520 --> 00:22:24,080
started this so it maintains this

718
00:22:23,039 --> 00:22:27,039
information through

719
00:22:24,080 --> 00:22:27,760
a cache and through a database so it

720
00:22:27,039 --> 00:22:29,039
doesn't

721
00:22:27,760 --> 00:22:30,879
matter that i stopped and started the

722
00:22:29,039 --> 00:22:33,120
service here you can see that the

723
00:22:30,880 --> 00:22:33,840
category is established so here this is

724
00:22:33,120 --> 00:22:35,918
telling me

725
00:22:33,840 --> 00:22:36,959
google's been around for a while you're

726
00:22:35,919 --> 00:22:40,159
probably

727
00:22:36,960 --> 00:22:43,360
not that worried about google okay

728
00:22:40,159 --> 00:22:45,520
let's let's take a look at a couple of

729
00:22:43,360 --> 00:22:46,879
other domains here and see what those

730
00:22:45,520 --> 00:22:50,480
look like so

731
00:22:46,880 --> 00:22:54,159
um first let's try reddit.com first

732
00:22:50,480 --> 00:22:56,159
read it

733
00:22:54,159 --> 00:22:58,159
all right so reddit.com i go there i get

734
00:22:56,159 --> 00:22:59,600
the born on date for that

735
00:22:58,159 --> 00:23:00,880
i can see that this is the very first

736
00:22:59,600 --> 00:23:01,840
time that i've done it so i get this

737
00:23:00,880 --> 00:23:04,640
additional alert

738
00:23:01,840 --> 00:23:05,280
first contact this is my first contact

739
00:23:04,640 --> 00:23:08,480
ever

740
00:23:05,280 --> 00:23:10,240
to reddit so i know nobody in my domain

741
00:23:08,480 --> 00:23:12,559
nobody on my network has ever gone to

742
00:23:10,240 --> 00:23:13,760
reddit before and now they have you can

743
00:23:12,559 --> 00:23:16,480
see that i do it again

744
00:23:13,760 --> 00:23:18,240
and that first contact alert goes away

745
00:23:16,480 --> 00:23:21,280
indicating that it's not there

746
00:23:18,240 --> 00:23:23,120
let's try uh some domain that's

747
00:23:21,280 --> 00:23:24,639
brand new so i actually just looked up

748
00:23:23,120 --> 00:23:28,080
this one was just

749
00:23:24,640 --> 00:23:30,720
um registered today then covid hit

750
00:23:28,080 --> 00:23:32,879
dot-com right so if i go up to then

751
00:23:30,720 --> 00:23:34,640
covidhit.com you can see that this one

752
00:23:32,880 --> 00:23:36,400
is my first contact and also the

753
00:23:34,640 --> 00:23:39,600
category here is

754
00:23:36,400 --> 00:23:41,120
new right this is a new domain um first

755
00:23:39,600 --> 00:23:42,240
time it was seen on the web was

756
00:23:41,120 --> 00:23:44,320
yesterday so

757
00:23:42,240 --> 00:23:46,559
um i get that new alert so i can very

758
00:23:44,320 --> 00:23:49,678
quickly go in and to my seam i can

759
00:23:46,559 --> 00:23:50,639
categorize by new i can categorize by

760
00:23:49,679 --> 00:23:53,440
the alerts

761
00:23:50,640 --> 00:23:54,799
and i can find these new domains that

762
00:23:53,440 --> 00:23:57,039
are on the network

763
00:23:54,799 --> 00:23:58,480
and then i can begin my hunt teaming

764
00:23:57,039 --> 00:24:01,600
from there so that's the

765
00:23:58,480 --> 00:24:04,080
um idea behind

766
00:24:01,600 --> 00:24:05,120
behind domain sets and here you can see

767
00:24:04,080 --> 00:24:08,240
for this one

768
00:24:05,120 --> 00:24:11,600
seen by isc is rdap

769
00:24:08,240 --> 00:24:13,039
okay so um at the moment the sans

770
00:24:11,600 --> 00:24:16,158
internet storm center

771
00:24:13,039 --> 00:24:18,320
is not up and running so um we

772
00:24:16,159 --> 00:24:20,320
we plan to release this perhaps at um

773
00:24:18,320 --> 00:24:23,439
sans fire this year but then

774
00:24:20,320 --> 00:24:26,320
but then coveted hit dot com right um

775
00:24:23,440 --> 00:24:26,960
which by the way there's lots and lots

776
00:24:26,320 --> 00:24:29,760
of

777
00:24:26,960 --> 00:24:30,640
covid related domains being registered

778
00:24:29,760 --> 00:24:33,760
many of them i'm

779
00:24:30,640 --> 00:24:36,480
sure have uh not the best of intentions

780
00:24:33,760 --> 00:24:38,400
um for users i think there's 2 000 covid

781
00:24:36,480 --> 00:24:41,520
related domains being

782
00:24:38,400 --> 00:24:43,440
registered a day at the moment so i

783
00:24:41,520 --> 00:24:44,720
don't know what that website is going to

784
00:24:43,440 --> 00:24:46,880
be

785
00:24:44,720 --> 00:24:48,159
once once it's stood up so i'll just

786
00:24:46,880 --> 00:24:49,039
throw that out there as a word of

787
00:24:48,159 --> 00:24:52,159
caution

788
00:24:49,039 --> 00:24:54,000
all right so sorry uh art app sans

789
00:24:52,159 --> 00:24:55,600
internet storm center isn't um they

790
00:24:54,000 --> 00:24:58,000
don't have their domain stats server

791
00:24:55,600 --> 00:24:59,678
right and i i'm waiting to see what the

792
00:24:58,000 --> 00:25:02,159
status of that thing is going to be

793
00:24:59,679 --> 00:25:03,520
but in the meantime until that sans

794
00:25:02,159 --> 00:25:06,400
internet storm center

795
00:25:03,520 --> 00:25:07,120
is stood up you can still use domain

796
00:25:06,400 --> 00:25:10,240
stats today

797
00:25:07,120 --> 00:25:11,600
right but instead of going to um in sans

798
00:25:10,240 --> 00:25:14,080
internet storm center for the lookup

799
00:25:11,600 --> 00:25:16,080
it's going to do an rdap query to look

800
00:25:14,080 --> 00:25:17,918
that information up so rdap is a new

801
00:25:16,080 --> 00:25:20,080
protocol we can use to

802
00:25:17,919 --> 00:25:22,320
it's much more structured information

803
00:25:20,080 --> 00:25:24,080
than who is records right who is

804
00:25:22,320 --> 00:25:26,559
it could be called creation date it

805
00:25:24,080 --> 00:25:29,199
could be called um it could be called

806
00:25:26,559 --> 00:25:30,639
uh um i don't know born on there's just

807
00:25:29,200 --> 00:25:32,080
so many different names when i

808
00:25:30,640 --> 00:25:33,919
when gregory bell was talking about the

809
00:25:32,080 --> 00:25:37,279
need for standardized information i was

810
00:25:33,919 --> 00:25:38,720
yes yes you are correct we need

811
00:25:37,279 --> 00:25:41,120
these things to be called the same way

812
00:25:38,720 --> 00:25:43,760
well art app is one

813
00:25:41,120 --> 00:25:45,039
intention to try and solve that for

814
00:25:43,760 --> 00:25:47,919
those who is records

815
00:25:45,039 --> 00:25:48,240
so it'll use the rdap protocol to look

816
00:25:47,919 --> 00:25:50,240
up

817
00:25:48,240 --> 00:25:51,600
those domains now today art app support

818
00:25:50,240 --> 00:25:54,640
is limited to

819
00:25:51,600 --> 00:25:58,399
um assert the most common uh the most

820
00:25:54,640 --> 00:26:00,799
the top uh tlds like com edu

821
00:25:58,400 --> 00:26:02,400
um the etlds like the the country

822
00:26:00,799 --> 00:26:03,520
specific ones it doesn't have support

823
00:26:02,400 --> 00:26:05,679
for that yet but those

824
00:26:03,520 --> 00:26:07,840
those are coming in the future so art

825
00:26:05,679 --> 00:26:09,679
app um is the mode you'll use until sans

826
00:26:07,840 --> 00:26:10,480
internet storm center becomes available

827
00:26:09,679 --> 00:26:12,640
okay

828
00:26:10,480 --> 00:26:14,720
all right so that's domain stats it's a

829
00:26:12,640 --> 00:26:15,440
new tool um it's out there today i'd

830
00:26:14,720 --> 00:26:18,400
encourage you go

831
00:26:15,440 --> 00:26:19,760
give it a try um tools three and four

832
00:26:18,400 --> 00:26:22,559
that i want to talk about

833
00:26:19,760 --> 00:26:25,200
are all related to that system resource

834
00:26:22,559 --> 00:26:27,360
utilization management database right so

835
00:26:25,200 --> 00:26:29,120
if you go into your task manager you

836
00:26:27,360 --> 00:26:32,080
look at your app history tab on your

837
00:26:29,120 --> 00:26:34,559
task manager you'll see resources

838
00:26:32,080 --> 00:26:35,439
usage since and then it's 30 days back

839
00:26:34,559 --> 00:26:38,240
so for the last

840
00:26:35,440 --> 00:26:39,840
month task manager is keeping this

841
00:26:38,240 --> 00:26:40,720
application history if you look at it in

842
00:26:39,840 --> 00:26:43,120
the gui

843
00:26:40,720 --> 00:26:43,919
you don't see a lot of great information

844
00:26:43,120 --> 00:26:46,479
there right it's

845
00:26:43,919 --> 00:26:47,039
these metro apps that um well there's

846
00:26:46,480 --> 00:26:48,640
just not

847
00:26:47,039 --> 00:26:50,158
there's just not a whole lot of value

848
00:26:48,640 --> 00:26:51,440
when i look at that but the database

849
00:26:50,159 --> 00:26:54,400
itself

850
00:26:51,440 --> 00:26:54,880
keeps a lot of great information in it

851
00:26:54,400 --> 00:26:56,640
right

852
00:26:54,880 --> 00:26:58,240
it maintains a list of all the processes

853
00:26:56,640 --> 00:26:59,600
that are run the amount of cpu time

854
00:26:58,240 --> 00:27:01,520
they've taken the amount of network

855
00:26:59,600 --> 00:27:03,199
traffic they've consumed the users that

856
00:27:01,520 --> 00:27:06,799
ran that tool

857
00:27:03,200 --> 00:27:09,840
it's full of great information for

858
00:27:06,799 --> 00:27:11,520
hunting on the endpoints so

859
00:27:09,840 --> 00:27:13,520
a couple of tools that have been

860
00:27:11,520 --> 00:27:15,360
released that you can use to get access

861
00:27:13,520 --> 00:27:16,639
to this information shrum dump you may

862
00:27:15,360 --> 00:27:19,439
have heard of it's got it's

863
00:27:16,640 --> 00:27:20,000
got a the focus there is on the ease of

864
00:27:19,440 --> 00:27:22,799
use

865
00:27:20,000 --> 00:27:23,520
right i want for investigators to be

866
00:27:22,799 --> 00:27:26,399
able to just

867
00:27:23,520 --> 00:27:28,080
run it point it at a strum and then give

868
00:27:26,399 --> 00:27:29,678
you a nice graphical user interface

869
00:27:28,080 --> 00:27:30,879
that's going to then build excel

870
00:27:29,679 --> 00:27:32,960
spreadsheets

871
00:27:30,880 --> 00:27:34,480
that have multiple tabs with each of the

872
00:27:32,960 --> 00:27:35,600
different fields that are in the

873
00:27:34,480 --> 00:27:38,000
database it does

874
00:27:35,600 --> 00:27:39,520
lookups for you to to translate

875
00:27:38,000 --> 00:27:40,799
information that's

876
00:27:39,520 --> 00:27:43,520
just a good in the database to the

877
00:27:40,799 --> 00:27:45,360
actual usernames just um a profile id to

878
00:27:43,520 --> 00:27:46,320
the actual wireless network names things

879
00:27:45,360 --> 00:27:48,479
like that

880
00:27:46,320 --> 00:27:50,399
are all done for you in srumdump so

881
00:27:48,480 --> 00:27:53,200
let's focus on ease of use

882
00:27:50,399 --> 00:27:53,918
and analyzing one host but what i found

883
00:27:53,200 --> 00:27:56,640
is

884
00:27:53,919 --> 00:27:57,919
what i i wanted to use srumdump on well

885
00:27:56,640 --> 00:27:59,200
everything in the network right you go

886
00:27:57,919 --> 00:28:02,799
into an incident and there's

887
00:27:59,200 --> 00:28:04,399
no logs right you you've you've got no

888
00:28:02,799 --> 00:28:06,799
logs of what's going on in your

889
00:28:04,399 --> 00:28:07,360
endpoints so i wanted to be able to ask

890
00:28:06,799 --> 00:28:10,320
the question

891
00:28:07,360 --> 00:28:10,719
well i want the list of every process

892
00:28:10,320 --> 00:28:14,000
that's

893
00:28:10,720 --> 00:28:14,799
run on every host in the domain over the

894
00:28:14,000 --> 00:28:18,080
last

895
00:28:14,799 --> 00:28:20,320
30 days i want to run srumdump but

896
00:28:18,080 --> 00:28:22,480
on every end point in the system and

897
00:28:20,320 --> 00:28:24,559
bring that back to a centralized

898
00:28:22,480 --> 00:28:25,600
location where i can then analyze the

899
00:28:24,559 --> 00:28:28,240
processes

900
00:28:25,600 --> 00:28:29,600
see who's run what what times and things

901
00:28:28,240 --> 00:28:32,000
like that

902
00:28:29,600 --> 00:28:33,039
so esc to csv was my answer to that

903
00:28:32,000 --> 00:28:36,399
right so it's

904
00:28:33,039 --> 00:28:37,440
a command line version of es of srumdump

905
00:28:36,399 --> 00:28:40,719
that is focused

906
00:28:37,440 --> 00:28:44,399
on well making that mass collection

907
00:28:40,720 --> 00:28:45,200
and analysis easier it is command line

908
00:28:44,399 --> 00:28:47,199
driven

909
00:28:45,200 --> 00:28:48,480
so you can use it with ps exec to launch

910
00:28:47,200 --> 00:28:50,720
this thing on remote host

911
00:28:48,480 --> 00:28:51,919
it creates csvs instead of excel

912
00:28:50,720 --> 00:28:54,720
spreadsheets

913
00:28:51,919 --> 00:28:55,120
a csv for each of the different tables

914
00:28:54,720 --> 00:28:57,279
that's

915
00:28:55,120 --> 00:28:58,479
in this rum so you can then pull back

916
00:28:57,279 --> 00:29:00,480
all these csvs

917
00:28:58,480 --> 00:29:02,880
put them into one big file and analyze

918
00:29:00,480 --> 00:29:04,720
it it does all of the same

919
00:29:02,880 --> 00:29:06,320
analysis all the same lookups and

920
00:29:04,720 --> 00:29:09,840
everything else that strum did

921
00:29:06,320 --> 00:29:12,240
um and it does it through a plug-in

922
00:29:09,840 --> 00:29:13,439
that we have so esc to csv is a plug-in

923
00:29:12,240 --> 00:29:15,360
infrastructure where

924
00:29:13,440 --> 00:29:16,720
um it will you can get you can point it

925
00:29:15,360 --> 00:29:18,240
at any esc

926
00:29:16,720 --> 00:29:20,720
database right it's not why it's not

927
00:29:18,240 --> 00:29:22,880
called srum to csv

928
00:29:20,720 --> 00:29:23,760
you can point it at any esc database you

929
00:29:22,880 --> 00:29:26,720
have on your systems

930
00:29:23,760 --> 00:29:28,480
so this would include all the srum the

931
00:29:26,720 --> 00:29:31,600
edge browser and other things

932
00:29:28,480 --> 00:29:34,240
and it will dump that information

933
00:29:31,600 --> 00:29:36,080
you can also tell point it any esc to

934
00:29:34,240 --> 00:29:37,600
csv and tell it to build a plugin

935
00:29:36,080 --> 00:29:39,439
and it'll build a generic plugin that

936
00:29:37,600 --> 00:29:40,959
basically does nothing but gives you a

937
00:29:39,440 --> 00:29:41,520
template so that you can go in and

938
00:29:40,960 --> 00:29:43,440
rename

939
00:29:41,520 --> 00:29:46,320
fields and add functions that will

940
00:29:43,440 --> 00:29:48,799
process fields and things like that

941
00:29:46,320 --> 00:29:50,879
and it comes with two existing plugins

942
00:29:48,799 --> 00:29:52,080
it comes with with srumdump and it comes

943
00:29:50,880 --> 00:29:55,039
with an edge browser

944
00:29:52,080 --> 00:29:56,720
um plugin and each of these plugins they

945
00:29:55,039 --> 00:29:59,600
well they dump the fields and

946
00:29:56,720 --> 00:30:00,559
they do additional analysis on the the

947
00:29:59,600 --> 00:30:02,959
fields that are in

948
00:30:00,559 --> 00:30:03,600
the database esc to csv is also

949
00:30:02,960 --> 00:30:07,039
available

950
00:30:03,600 --> 00:30:08,719
on my github so the idea with esc to csv

951
00:30:07,039 --> 00:30:10,799
is you can do for mass collection as i

952
00:30:08,720 --> 00:30:12,480
said srumdump is intended to be a single

953
00:30:10,799 --> 00:30:14,000
collection on a single host

954
00:30:12,480 --> 00:30:16,080
srumdump it gives you a nice graphical

955
00:30:14,000 --> 00:30:17,279
user interface you can point it at a

956
00:30:16,080 --> 00:30:19,199
scrum

957
00:30:17,279 --> 00:30:20,559
um you can then tell it what directory

958
00:30:19,200 --> 00:30:22,880
you want to put your output in

959
00:30:20,559 --> 00:30:23,918
and give it a template the template is

960
00:30:22,880 --> 00:30:27,360
intended to give

961
00:30:23,919 --> 00:30:29,120
the analyst a way of renaming fields

962
00:30:27,360 --> 00:30:30,799
or if you don't want it to dump

963
00:30:29,120 --> 00:30:32,639
everything then you

964
00:30:30,799 --> 00:30:34,399
put in your template what it is that you

965
00:30:32,640 --> 00:30:37,360
want it to dump and it will only dump

966
00:30:34,399 --> 00:30:39,918
those things if you try and do

967
00:30:37,360 --> 00:30:41,439
a dump on your live system and you're

968
00:30:39,919 --> 00:30:44,480
running as administrator

969
00:30:41,440 --> 00:30:46,080
this option comes up and says hey auto

970
00:30:44,480 --> 00:30:48,159
extract this now

971
00:30:46,080 --> 00:30:49,600
i will tell you that you can run

972
00:30:48,159 --> 00:30:52,720
srumdump on

973
00:30:49,600 --> 00:30:56,158
a machine and analyze your live shrump

974
00:30:52,720 --> 00:30:58,480
and it will well the file is

975
00:30:56,159 --> 00:31:00,000
pseudo locked right by the operating

976
00:30:58,480 --> 00:31:00,799
system i just made up that term pseudo

977
00:31:00,000 --> 00:31:02,880
locked

978
00:31:00,799 --> 00:31:04,559
i say that because well it's not locked

979
00:31:02,880 --> 00:31:07,200
but it isn't use

980
00:31:04,559 --> 00:31:08,240
and being written to you and so srum

981
00:31:07,200 --> 00:31:11,120
dump if you do an

982
00:31:08,240 --> 00:31:12,880
analysis on just the live file then

983
00:31:11,120 --> 00:31:15,039
you're going to find that it

984
00:31:12,880 --> 00:31:16,640
just doesn't work it gives you corrupt

985
00:31:15,039 --> 00:31:18,559
results so you're going to want to

986
00:31:16,640 --> 00:31:20,399
run it as an administrator and extract a

987
00:31:18,559 --> 00:31:21,279
copy of srumdump when you're doing your

988
00:31:20,399 --> 00:31:23,518
analysis

989
00:31:21,279 --> 00:31:25,279
okay and then it gives you this

990
00:31:23,519 --> 00:31:26,960
spreadsheet with the multiple tabs and

991
00:31:25,279 --> 00:31:30,559
you get things like

992
00:31:26,960 --> 00:31:33,279
a netcat ran on this date and this time

993
00:31:30,559 --> 00:31:34,960
by this user and it will also if you

994
00:31:33,279 --> 00:31:36,640
passed it the correct registry file give

995
00:31:34,960 --> 00:31:37,519
you the username that was associated

996
00:31:36,640 --> 00:31:39,679
with it

997
00:31:37,519 --> 00:31:41,679
they did that over this wireless

998
00:31:39,679 --> 00:31:43,840
connection right you can then see how

999
00:31:41,679 --> 00:31:45,120
much data was transferred over that

1000
00:31:43,840 --> 00:31:47,600
wireless connection

1001
00:31:45,120 --> 00:31:48,320
so you get a lot of information in this

1002
00:31:47,600 --> 00:31:51,519
this is

1003
00:31:48,320 --> 00:31:53,279
this is like the let me go back in time

1004
00:31:51,519 --> 00:31:55,519
over the last 30 days and see

1005
00:31:53,279 --> 00:31:56,880
every process that's run on my computer

1006
00:31:55,519 --> 00:32:00,640
this is very

1007
00:31:56,880 --> 00:32:01,600
useful stuff in an incident but ese the

1008
00:32:00,640 --> 00:32:04,159
csv

1009
00:32:01,600 --> 00:32:05,199
is intended to let you do this at mass

1010
00:32:04,159 --> 00:32:07,600
right it's got a dash

1011
00:32:05,200 --> 00:32:08,480
l option to let you list the tables that

1012
00:32:07,600 --> 00:32:10,480
are in there a dash

1013
00:32:08,480 --> 00:32:11,679
d option and by default it's going to

1014
00:32:10,480 --> 00:32:13,840
dump every table

1015
00:32:11,679 --> 00:32:15,600
unless you do dash d and then give it an

1016
00:32:13,840 --> 00:32:17,600
optional list of tables that i'm only

1017
00:32:15,600 --> 00:32:19,760
interested in this table or that table

1018
00:32:17,600 --> 00:32:21,199
you can give it a plug-in and as i said

1019
00:32:19,760 --> 00:32:22,720
it comes with some existing plug-ins so

1020
00:32:21,200 --> 00:32:23,360
this is what it might look like to run

1021
00:32:22,720 --> 00:32:25,360
this thing

1022
00:32:23,360 --> 00:32:27,760
at mass across my network i'll do a ps

1023
00:32:25,360 --> 00:32:28,240
exec and i want to copy to the remote

1024
00:32:27,760 --> 00:32:30,879
host

1025
00:32:28,240 --> 00:32:31,600
the binary here's my username here's my

1026
00:32:30,880 --> 00:32:33,760
password

1027
00:32:31,600 --> 00:32:35,840
this is what i want to run on the remote

1028
00:32:33,760 --> 00:32:38,960
system and this is going to run es

1029
00:32:35,840 --> 00:32:39,600
ese to csv um it's going to acquire the

1030
00:32:38,960 --> 00:32:42,080
files

1031
00:32:39,600 --> 00:32:44,000
on the locked files on the remote system

1032
00:32:42,080 --> 00:32:46,480
it's going to run this plugin

1033
00:32:44,000 --> 00:32:47,200
i'm going to write my output to a shared

1034
00:32:46,480 --> 00:32:50,480
folder

1035
00:32:47,200 --> 00:32:52,559
that is on the network um and

1036
00:32:50,480 --> 00:32:54,399
this does it does look to see if the

1037
00:32:52,559 --> 00:32:56,399
file already exists with this name

1038
00:32:54,399 --> 00:32:58,080
and then it will create unique files so

1039
00:32:56,399 --> 00:32:59,439
it's not going to it's intended to be

1040
00:32:58,080 --> 00:33:00,799
run at mass so you're going to have

1041
00:32:59,440 --> 00:33:04,399
unique files for each

1042
00:33:00,799 --> 00:33:05,440
system and then we're going to

1043
00:33:04,399 --> 00:33:07,760
and then we're going to tell it to

1044
00:33:05,440 --> 00:33:09,919
analyze pass the

1045
00:33:07,760 --> 00:33:11,120
path to the srum to esc to csv so it

1046
00:33:09,919 --> 00:33:12,799
knows what to analyze

1047
00:33:11,120 --> 00:33:14,320
and this is going to analyze that stuff

1048
00:33:12,799 --> 00:33:16,720
and um i go to that

1049
00:33:14,320 --> 00:33:18,559
network file share and then i'll have a

1050
00:33:16,720 --> 00:33:19,039
csv from each of the different hosts

1051
00:33:18,559 --> 00:33:22,240
from this

1052
00:33:19,039 --> 00:33:25,200
rom for the last 30 days across the for

1053
00:33:22,240 --> 00:33:26,720
as many systems that i run this on so

1054
00:33:25,200 --> 00:33:30,000
here's some examples of running it

1055
00:33:26,720 --> 00:33:31,200
esc to csv run the srum plug-in and list

1056
00:33:30,000 --> 00:33:32,399
the tables here

1057
00:33:31,200 --> 00:33:34,240
because of the plug-in you can see that

1058
00:33:32,399 --> 00:33:36,719
i get back the table names

1059
00:33:34,240 --> 00:33:38,559
if i didn't give it the plug from

1060
00:33:36,720 --> 00:33:40,240
plug-in it would still

1061
00:33:38,559 --> 00:33:41,840
list the table names but it wouldn't

1062
00:33:40,240 --> 00:33:42,799
know what they're called right it would

1063
00:33:41,840 --> 00:33:44,399
just give me back

1064
00:33:42,799 --> 00:33:46,000
guides that are associated with each of

1065
00:33:44,399 --> 00:33:48,479
the tables that are in there

1066
00:33:46,000 --> 00:33:49,519
and it wouldn't have any intelligence

1067
00:33:48,480 --> 00:33:52,799
that goes on to

1068
00:33:49,519 --> 00:33:56,559
convert user sids into user names

1069
00:33:52,799 --> 00:33:57,600
or network profiles into network names

1070
00:33:56,559 --> 00:34:01,840
and things like that

1071
00:33:57,600 --> 00:34:03,840
okay you can also in addition to

1072
00:34:01,840 --> 00:34:05,678
listing files if you just give it the

1073
00:34:03,840 --> 00:34:09,279
plugin and a file it then

1074
00:34:05,679 --> 00:34:11,359
will auto acquire a copy of that

1075
00:34:09,280 --> 00:34:12,720
and then it will begin extracting all of

1076
00:34:11,359 --> 00:34:14,639
the files processing all of them and

1077
00:34:12,719 --> 00:34:16,799
then if i do a dir

1078
00:34:14,639 --> 00:34:18,159
you can see i have a csv file for each

1079
00:34:16,800 --> 00:34:23,040
of the different tables

1080
00:34:18,159 --> 00:34:25,359
that are associated with that strum okay

1081
00:34:23,040 --> 00:34:26,480
i can also dump a specific table so if i

1082
00:34:25,359 --> 00:34:28,239
do use the dash d

1083
00:34:26,480 --> 00:34:30,159
option i give it the name of a specific

1084
00:34:28,239 --> 00:34:32,959
table then

1085
00:34:30,159 --> 00:34:34,960
then it'll only dump that table now just

1086
00:34:32,960 --> 00:34:37,359
as a nuance if you're

1087
00:34:34,960 --> 00:34:38,480
most python programs that are out there

1088
00:34:37,359 --> 00:34:41,598
use a module called

1089
00:34:38,480 --> 00:34:43,918
arg parse um so if you can provide

1090
00:34:41,599 --> 00:34:45,359
multiple arguments here we have dash d

1091
00:34:43,918 --> 00:34:46,879
and i could provide it multiple table

1092
00:34:45,359 --> 00:34:50,159
names the way that you end

1093
00:34:46,879 --> 00:34:51,918
your list of arguments to an argument

1094
00:34:50,159 --> 00:34:53,599
to like the dash d which takes multiple

1095
00:34:51,918 --> 00:34:54,158
arguments is you put a dash dash at the

1096
00:34:53,599 --> 00:34:55,679
end

1097
00:34:54,159 --> 00:34:58,079
so here we i'm telling you to use the

1098
00:34:55,679 --> 00:35:01,040
strum dump plug-in and dump this table

1099
00:34:58,079 --> 00:35:02,480
from um this drum file and it dumps just

1100
00:35:01,040 --> 00:35:06,480
that csv

1101
00:35:02,480 --> 00:35:08,320
okay um so

1102
00:35:06,480 --> 00:35:10,800
what about this tools what if the tool

1103
00:35:08,320 --> 00:35:11,280
doesn't do exactly what you'd like it to

1104
00:35:10,800 --> 00:35:13,680
do

1105
00:35:11,280 --> 00:35:14,640
well i am happy to support these tools

1106
00:35:13,680 --> 00:35:16,480
right so if

1107
00:35:14,640 --> 00:35:18,160
i'd encourage you go download a copy of

1108
00:35:16,480 --> 00:35:20,240
these all of these are available on my

1109
00:35:18,160 --> 00:35:23,359
github page

1110
00:35:20,240 --> 00:35:26,399
github dot com slash mark baggett

1111
00:35:23,359 --> 00:35:28,640
on there you'll find srumdump and esc to

1112
00:35:26,400 --> 00:35:30,480
csv apify

1113
00:35:28,640 --> 00:35:32,000
and and freaking some other tools that

1114
00:35:30,480 --> 00:35:32,560
you can download and use in your tool so

1115
00:35:32,000 --> 00:35:34,079
i'm i'm

1116
00:35:32,560 --> 00:35:35,839
happy to support these tools i plan to

1117
00:35:34,079 --> 00:35:37,520
keep these running and working

1118
00:35:35,839 --> 00:35:39,279
if you have any issues you can you're

1119
00:35:37,520 --> 00:35:41,599
happy to post these but really

1120
00:35:39,280 --> 00:35:43,119
my passion here right it's proverbs 12

1121
00:35:41,599 --> 00:35:44,560
if you give a man a fish you feed them

1122
00:35:43,119 --> 00:35:46,240
for a day but if you show them to catch

1123
00:35:44,560 --> 00:35:48,880
a fish you feed them for a lifetime

1124
00:35:46,240 --> 00:35:49,439
i i would love to teach you how to write

1125
00:35:48,880 --> 00:35:52,400
tools

1126
00:35:49,440 --> 00:35:54,160
similar to this to adapt these tools to

1127
00:35:52,400 --> 00:35:54,560
make things that do exactly what you

1128
00:35:54,160 --> 00:35:57,520
need

1129
00:35:54,560 --> 00:35:59,759
him to do which is really the um the

1130
00:35:57,520 --> 00:36:01,040
crux behind my class 573

1131
00:35:59,760 --> 00:36:03,040
automating information security with

1132
00:36:01,040 --> 00:36:05,040
python so um if you're interested in

1133
00:36:03,040 --> 00:36:06,720
learning how to develop your own tools

1134
00:36:05,040 --> 00:36:08,560
participating in the open source

1135
00:36:06,720 --> 00:36:09,040
community as greg um talked about this

1136
00:36:08,560 --> 00:36:11,520
morning

1137
00:36:09,040 --> 00:36:12,320
i'd encourage you to come check out 573.

1138
00:36:11,520 --> 00:36:22,079
okay

1139
00:36:12,320 --> 00:36:22,079
and that is my talk

