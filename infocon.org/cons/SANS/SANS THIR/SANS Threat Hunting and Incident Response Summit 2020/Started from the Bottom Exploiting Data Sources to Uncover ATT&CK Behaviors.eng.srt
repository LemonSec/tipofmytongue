1
00:00:05,120 --> 00:00:07,600
i'm excited to introduce our next talk

2
00:00:06,879 --> 00:00:10,320
uh here

3
00:00:07,600 --> 00:00:11,519
uh this talk i think is something that

4
00:00:10,320 --> 00:00:14,400
is going to be

5
00:00:11,519 --> 00:00:15,040
very very instrumental and beneficial to

6
00:00:14,400 --> 00:00:18,320
everyone

7
00:00:15,040 --> 00:00:20,880
who watches and one of there's a line

8
00:00:18,320 --> 00:00:22,400
in the cfp that they sent in that jose

9
00:00:20,880 --> 00:00:23,680
and jamie sent in that really captured

10
00:00:22,400 --> 00:00:24,880
my attention here

11
00:00:23,680 --> 00:00:26,720
i'm just going to read it really quick

12
00:00:24,880 --> 00:00:29,679
here which is um

13
00:00:26,720 --> 00:00:30,720
as defenders we have home field

14
00:00:29,679 --> 00:00:33,360
advantage

15
00:00:30,720 --> 00:00:33,760
and i think there's such an awesome data

16
00:00:33,360 --> 00:00:36,800
point

17
00:00:33,760 --> 00:00:39,519
inside of recognizing that someone is on

18
00:00:36,800 --> 00:00:41,120
your turf not the other way around and

19
00:00:39,520 --> 00:00:44,480
as an incident responder who spent

20
00:00:41,120 --> 00:00:45,760
a lot of time playing offense

21
00:00:44,480 --> 00:00:47,839
in an environment where we should be

22
00:00:45,760 --> 00:00:49,280
playing defense

23
00:00:47,840 --> 00:00:50,800
i feel like this is an important lesson

24
00:00:49,280 --> 00:00:52,320
to catch up on and something important

25
00:00:50,800 --> 00:00:53,680
to realize and start to take advantage

26
00:00:52,320 --> 00:00:55,600
and seize the data sources that are

27
00:00:53,680 --> 00:00:58,000
available to you so with that said

28
00:00:55,600 --> 00:01:00,000
started from the bottom exploiting data

29
00:00:58,000 --> 00:01:01,600
sources to uncover attack behaviors i

30
00:01:00,000 --> 00:01:02,559
almost sang started from the bottom it

31
00:01:01,600 --> 00:01:04,640
really catches you

32
00:01:02,559 --> 00:01:05,600
i want to introduce jose rodriguez jamie

33
00:01:04,640 --> 00:01:08,720
williams

34
00:01:05,600 --> 00:01:10,798
gentlemen over to you to take us through

35
00:01:08,720 --> 00:01:12,400
your talk looking forward to it awesome

36
00:01:10,799 --> 00:01:13,840
thank you matt uh let me make sure i

37
00:01:12,400 --> 00:01:16,479
have control of the deck here

38
00:01:13,840 --> 00:01:18,080
uh so yep like matt said um where my

39
00:01:16,479 --> 00:01:18,479
name is jamie williams i'm coming from

40
00:01:18,080 --> 00:01:19,920
the

41
00:01:18,479 --> 00:01:22,400
mitre attack team and i'm here with my

42
00:01:19,920 --> 00:01:24,479
friend great friend jose rodriguez

43
00:01:22,400 --> 00:01:26,000
my name is jose rodriguez and i'm a

44
00:01:24,479 --> 00:01:28,159
cyber security consultant for

45
00:01:26,000 --> 00:01:29,680
the minor attack team yep and we're

46
00:01:28,159 --> 00:01:30,880
really excited and honored to be here

47
00:01:29,680 --> 00:01:32,079
today like i said we really appreciate

48
00:01:30,880 --> 00:01:33,600
everyone joining us

49
00:01:32,079 --> 00:01:34,960
as well as all the work from sans you

50
00:01:33,600 --> 00:01:36,559
know obviously having us you know

51
00:01:34,960 --> 00:01:37,439
coaching us up and also facilitating

52
00:01:36,560 --> 00:01:39,200
this great event

53
00:01:37,439 --> 00:01:40,639
like you said especially in these times

54
00:01:39,200 --> 00:01:42,240
uh you know with everything going on and

55
00:01:40,640 --> 00:01:43,600
you know the rain here and flood going

56
00:01:42,240 --> 00:01:44,960
on in maryland uh

57
00:01:43,600 --> 00:01:46,240
uh we're really thankful we still have

58
00:01:44,960 --> 00:01:46,720
the opportunity to come together share

59
00:01:46,240 --> 00:01:48,960
ideas

60
00:01:46,720 --> 00:01:51,360
uh you know cross-pollinate and grow as

61
00:01:48,960 --> 00:01:52,880
a community and like i said specifically

62
00:01:51,360 --> 00:01:54,240
uh we're pretty anxious and excited to

63
00:01:52,880 --> 00:01:55,920
release some things we've been working

64
00:01:54,240 --> 00:01:57,280
on you know we've been focusing

65
00:01:55,920 --> 00:01:58,799
uh doing a lot of research and a lot of

66
00:01:57,280 --> 00:02:00,159
thought about how we can make the attack

67
00:01:58,799 --> 00:02:01,439
framework better and specifically in

68
00:02:00,159 --> 00:02:03,280
this case we're looking at

69
00:02:01,439 --> 00:02:05,039
uh attack data sources specifically

70
00:02:03,280 --> 00:02:06,960
looking to understand

71
00:02:05,040 --> 00:02:08,160
uh the gap between you know attack data

72
00:02:06,960 --> 00:02:10,560
sources rendered

73
00:02:08,160 --> 00:02:11,520
um in the matrix and the framework and

74
00:02:10,560 --> 00:02:12,640
then looking at the

75
00:02:11,520 --> 00:02:14,800
the difference between how they're

76
00:02:12,640 --> 00:02:16,640
actually applied to uh defenders in the

77
00:02:14,800 --> 00:02:17,840
real world how you guys are actually

78
00:02:16,640 --> 00:02:19,200
you know collecting data and actually

79
00:02:17,840 --> 00:02:20,160
finding adversaries in your environment

80
00:02:19,200 --> 00:02:22,000
like matt said

81
00:02:20,160 --> 00:02:23,520
taking advantage of um that home field

82
00:02:22,000 --> 00:02:25,840
advantage and realizing that you know

83
00:02:23,520 --> 00:02:27,520
we have all the data and all we really

84
00:02:25,840 --> 00:02:28,879
need to do is connect that data

85
00:02:27,520 --> 00:02:31,599
and figure out how do we actually find

86
00:02:28,879 --> 00:02:33,120
the adversaries um in our environment

87
00:02:31,599 --> 00:02:34,319
uh so like i said well this is actually

88
00:02:33,120 --> 00:02:35,760
uh really exciting for us this is our

89
00:02:34,319 --> 00:02:37,440
first time actually sharing this

90
00:02:35,760 --> 00:02:39,440
outside of our team but uh definitely

91
00:02:37,440 --> 00:02:40,319
stay tuned we have some a blog series

92
00:02:39,440 --> 00:02:42,160
coming out

93
00:02:40,319 --> 00:02:44,160
very soon as well as a github project

94
00:02:42,160 --> 00:02:46,239
where you present our initial findings

95
00:02:44,160 --> 00:02:48,879
for this work uh without further ado

96
00:02:46,239 --> 00:02:50,319
let's go ahead and kick this off

97
00:02:48,879 --> 00:02:52,000
um so quick agenda what we're going to

98
00:02:50,319 --> 00:02:53,518
go over today uh we'll start by

99
00:02:52,000 --> 00:02:54,160
introducing the content of attack data

100
00:02:53,519 --> 00:02:55,920
sources you know

101
00:02:54,160 --> 00:02:57,519
what are they as well as you know why do

102
00:02:55,920 --> 00:02:58,640
we focus on them why do we care so much

103
00:02:57,519 --> 00:03:00,239
about these data sources

104
00:02:58,640 --> 00:03:02,000
and you know what answers are we trying

105
00:03:00,239 --> 00:03:04,159
to um you know trying to address here

106
00:03:02,000 --> 00:03:05,680
and what are we actually trying to solve

107
00:03:04,159 --> 00:03:07,120
uh from there i'll turn it over to jose

108
00:03:05,680 --> 00:03:08,080
it's gonna give you a really good and

109
00:03:07,120 --> 00:03:09,599
deep dive

110
00:03:08,080 --> 00:03:11,120
on the exact research we've been doing

111
00:03:09,599 --> 00:03:12,720
specifically you know looking at

112
00:03:11,120 --> 00:03:13,760
you know attack data sources from you

113
00:03:12,720 --> 00:03:15,040
know the stance of you know where are

114
00:03:13,760 --> 00:03:16,480
they where are they falling short and

115
00:03:15,040 --> 00:03:16,879
what we can what can we do to improve

116
00:03:16,480 --> 00:03:18,480
them

117
00:03:16,879 --> 00:03:19,760
and then finally how do we capture you

118
00:03:18,480 --> 00:03:21,599
know those improvements and applying

119
00:03:19,760 --> 00:03:22,799
them back to the attack uh framework to

120
00:03:21,599 --> 00:03:24,480
actually broadcast that

121
00:03:22,800 --> 00:03:26,400
and share it with the wider community

122
00:03:24,480 --> 00:03:26,798
and finally um to prove that point like

123
00:03:26,400 --> 00:03:28,319
i said

124
00:03:26,799 --> 00:03:29,840
we'll share our you know our methodology

125
00:03:28,319 --> 00:03:31,440
and kind of our our current stance and

126
00:03:29,840 --> 00:03:32,879
understanding of this problem

127
00:03:31,440 --> 00:03:34,720
but also to kind of cement that point

128
00:03:32,879 --> 00:03:36,640
we'll share and kind of walk you through

129
00:03:34,720 --> 00:03:38,560
an experiment we did where we actually

130
00:03:36,640 --> 00:03:40,640
um you know we picked a particular

131
00:03:38,560 --> 00:03:42,000
adversary behavior we ran it through an

132
00:03:40,640 --> 00:03:43,279
environment

133
00:03:42,000 --> 00:03:44,959
and collected all the results and all

134
00:03:43,280 --> 00:03:46,319
the data and we actually went and you

135
00:03:44,959 --> 00:03:48,080
know applied our model

136
00:03:46,319 --> 00:03:50,000
and figured out and showed and proved

137
00:03:48,080 --> 00:03:51,680
that you know this new enhanced view of

138
00:03:50,000 --> 00:03:53,280
data sources that we're proposing

139
00:03:51,680 --> 00:03:54,799
it actually provides all the additional

140
00:03:53,280 --> 00:03:55,920
value and all the additional context

141
00:03:54,799 --> 00:03:57,599
that it actually

142
00:03:55,920 --> 00:03:59,280
can provide it makes us better defenders

143
00:03:57,599 --> 00:04:00,879
and more efficient hunters

144
00:03:59,280 --> 00:04:02,640
in terms of finding adversaries in our

145
00:04:00,879 --> 00:04:04,879
environment

146
00:04:02,640 --> 00:04:05,920
so uh you know first question you know

147
00:04:04,879 --> 00:04:07,280
what is an attack source

148
00:04:05,920 --> 00:04:08,958
data source and why we care you know if

149
00:04:07,280 --> 00:04:10,239
anyone has ever been to attack you know

150
00:04:08,959 --> 00:04:10,959
you might have clicked on a technique

151
00:04:10,239 --> 00:04:12,239
page

152
00:04:10,959 --> 00:04:14,000
and browse around a little bit you might

153
00:04:12,239 --> 00:04:15,519
have saw this you know this field or tag

154
00:04:14,000 --> 00:04:17,199
for data sources but you know

155
00:04:15,519 --> 00:04:18,880
what is that and you know why do we why

156
00:04:17,199 --> 00:04:20,079
do we care about that

157
00:04:18,880 --> 00:04:22,000
uh so rather than giving you just a

158
00:04:20,079 --> 00:04:23,440
boring you know a one line definition

159
00:04:22,000 --> 00:04:25,360
i decided to walk you through the story

160
00:04:23,440 --> 00:04:27,120
to kind of emphasize you know um

161
00:04:25,360 --> 00:04:28,560
you know these points i'm trying to make

162
00:04:27,120 --> 00:04:30,000
so in this case you know we've all been

163
00:04:28,560 --> 00:04:31,360
here i know every day we hear about

164
00:04:30,000 --> 00:04:32,880
these new threat groups these new

165
00:04:31,360 --> 00:04:33,600
techniques there's new malware these new

166
00:04:32,880 --> 00:04:34,960
tools

167
00:04:33,600 --> 00:04:36,400
it's new stuff coming out every day and

168
00:04:34,960 --> 00:04:38,560
the big question for us is you know what

169
00:04:36,400 --> 00:04:40,000
can we do about as defenders in the case

170
00:04:38,560 --> 00:04:41,600
of this particular group you know this

171
00:04:40,000 --> 00:04:43,199
is something red canary published within

172
00:04:41,600 --> 00:04:43,759
the last six months the blue mockingbird

173
00:04:43,199 --> 00:04:45,520
group

174
00:04:43,759 --> 00:04:47,040
uh that you know that was published

175
00:04:45,520 --> 00:04:48,400
great intel but you know what do we do

176
00:04:47,040 --> 00:04:50,000
about it how do we understand

177
00:04:48,400 --> 00:04:51,359
uh where we are as defenders in terms of

178
00:04:50,000 --> 00:04:52,400
you know do we stack up are we safe

179
00:04:51,360 --> 00:04:53,759
against this threat

180
00:04:52,400 --> 00:04:55,280
and you know more importantly what can

181
00:04:53,759 --> 00:04:56,720
we do and improve ourselves what do we

182
00:04:55,280 --> 00:04:57,679
need to change what do we need to you

183
00:04:56,720 --> 00:04:59,440
know buy or

184
00:04:57,680 --> 00:05:00,800
you know reconfigure or how do we need

185
00:04:59,440 --> 00:05:02,639
to change the way we approach

186
00:05:00,800 --> 00:05:04,479
uh detecting this particular threat in

187
00:05:02,639 --> 00:05:06,240
our environments uh to ensure that we're

188
00:05:04,479 --> 00:05:08,400
safe

189
00:05:06,240 --> 00:05:09,360
um so like i said um great report from

190
00:05:08,400 --> 00:05:10,560
red canary

191
00:05:09,360 --> 00:05:12,160
you know i definitely recommend it's a

192
00:05:10,560 --> 00:05:12,479
good read for anyone's interested in you

193
00:05:12,160 --> 00:05:14,160
know

194
00:05:12,479 --> 00:05:15,758
novel techniques as well as how

195
00:05:14,160 --> 00:05:17,759
adversaries are you know deploying

196
00:05:15,759 --> 00:05:19,440
crypto miners into your victims but

197
00:05:17,759 --> 00:05:20,960
a long story short this isn't something

198
00:05:19,440 --> 00:05:22,800
that we can just copy and paste

199
00:05:20,960 --> 00:05:24,239
into you know our scenes or the hearts

200
00:05:22,800 --> 00:05:25,759
and mind of our analysts we actually do

201
00:05:24,240 --> 00:05:27,440
need to do a little bit of work to

202
00:05:25,759 --> 00:05:29,520
translate into something that we can

203
00:05:27,440 --> 00:05:30,880
actually operationalize and act on

204
00:05:29,520 --> 00:05:32,400
uh so in this case you know we can read

205
00:05:30,880 --> 00:05:33,759
the report and get a bunch of context

206
00:05:32,400 --> 00:05:35,120
and actually understand a lot about the

207
00:05:33,759 --> 00:05:35,680
group but you know our first step in

208
00:05:35,120 --> 00:05:37,440
actually

209
00:05:35,680 --> 00:05:38,720
acting on this is modeling the threat

210
00:05:37,440 --> 00:05:40,479
you know taking a look at

211
00:05:38,720 --> 00:05:41,840
what actually is the threat doing you

212
00:05:40,479 --> 00:05:42,560
know what are the behaviors associated

213
00:05:41,840 --> 00:05:45,039
with this group

214
00:05:42,560 --> 00:05:46,960
in this case we can see you know blue um

215
00:05:45,039 --> 00:05:47,919
blue mockingbird is going to exploit uh

216
00:05:46,960 --> 00:05:49,599
web servers

217
00:05:47,919 --> 00:05:51,198
and we can keep going down this uh the

218
00:05:49,600 --> 00:05:52,240
same report and carving out more and

219
00:05:51,199 --> 00:05:53,680
more techniques and seeing the

220
00:05:52,240 --> 00:05:55,199
individual behaviors that are

221
00:05:53,680 --> 00:05:57,120
you know this behav this group is

222
00:05:55,199 --> 00:05:59,919
actually taking uh action on their

223
00:05:57,120 --> 00:06:02,080
victims using so in this case we can see

224
00:05:59,919 --> 00:06:03,520
uh the group likes to live off the land

225
00:06:02,080 --> 00:06:05,599
a little bit and use some you know sign

226
00:06:03,520 --> 00:06:06,240
binaries including rundle 32 and red

227
00:06:05,600 --> 00:06:07,520
server

228
00:06:06,240 --> 00:06:10,080
to actually execute their payloads as

229
00:06:07,520 --> 00:06:11,840
well as you know the system services

230
00:06:10,080 --> 00:06:13,758
is uh one thing they use and uh you know

231
00:06:11,840 --> 00:06:14,960
fun fact here we can definitely

232
00:06:13,759 --> 00:06:17,039
we have it on dirty knowledge and we can

233
00:06:14,960 --> 00:06:17,359
definitely tell that the authors report

234
00:06:17,039 --> 00:06:18,960
are

235
00:06:17,360 --> 00:06:20,560
big fans of attack you know they did

236
00:06:18,960 --> 00:06:22,960
inline mappings there that made the

237
00:06:20,560 --> 00:06:24,240
this process pretty easy but even in

238
00:06:22,960 --> 00:06:25,520
cases where they you know they didn't do

239
00:06:24,240 --> 00:06:26,800
inline mapping we actually look at

240
00:06:25,520 --> 00:06:28,719
you know the comm in this case uh red

241
00:06:26,800 --> 00:06:30,639
carrying was graceful enough to actually

242
00:06:28,720 --> 00:06:32,080
uh report the actual command lines being

243
00:06:30,639 --> 00:06:33,919
run by the adversaries we're actually

244
00:06:32,080 --> 00:06:35,280
able to take a look at those as well and

245
00:06:33,919 --> 00:06:36,318
you know map the behaviors out of that

246
00:06:35,280 --> 00:06:37,359
as well as you know continuing through

247
00:06:36,319 --> 00:06:39,280
the rest of the port

248
00:06:37,360 --> 00:06:40,960
um you know long story short at the end

249
00:06:39,280 --> 00:06:41,599
of this process we end up with a you

250
00:06:40,960 --> 00:06:43,359
know the

251
00:06:41,600 --> 00:06:44,720
district data points that we can target

252
00:06:43,360 --> 00:06:46,400
as defenders and saying you know

253
00:06:44,720 --> 00:06:48,960
all this great intel really distills

254
00:06:46,400 --> 00:06:50,400
down to these specific behaviors

255
00:06:48,960 --> 00:06:52,479
um you know it's like that's a that's a

256
00:06:50,400 --> 00:06:54,080
good first step to getting towards you

257
00:06:52,479 --> 00:06:55,520
know our goal of you know

258
00:06:54,080 --> 00:06:58,000
actually figuring out what can we do

259
00:06:55,520 --> 00:06:59,520
about this um this adversary but you

260
00:06:58,000 --> 00:07:00,880
know it's not the end state you need to

261
00:06:59,520 --> 00:07:02,400
do a little bit more work before we're

262
00:07:00,880 --> 00:07:03,840
actually able to act on this

263
00:07:02,400 --> 00:07:05,039
um you know and what i'm going to say

264
00:07:03,840 --> 00:07:06,638
this a couple times throughout the

265
00:07:05,039 --> 00:07:07,039
entire presentation throughout the day

266
00:07:06,639 --> 00:07:08,720
but

267
00:07:07,039 --> 00:07:10,240
the biggest thing is context in this

268
00:07:08,720 --> 00:07:11,440
case we can take those you know those

269
00:07:10,240 --> 00:07:13,759
individual

270
00:07:11,440 --> 00:07:15,199
behaviors actually apply more context to

271
00:07:13,759 --> 00:07:16,960
you know why an adversary is actually

272
00:07:15,199 --> 00:07:17,280
doing this so in this case you know the

273
00:07:16,960 --> 00:07:19,520
y

274
00:07:17,280 --> 00:07:20,880
coming from you know the attack tactics

275
00:07:19,520 --> 00:07:22,240
coming across the top so

276
00:07:20,880 --> 00:07:23,919
a specific example looking at the

277
00:07:22,240 --> 00:07:25,120
exploitation of those web servers you

278
00:07:23,919 --> 00:07:27,039
know we can you know

279
00:07:25,120 --> 00:07:28,319
blue mockingbird exploits web servers

280
00:07:27,039 --> 00:07:29,520
with the particular mechanics

281
00:07:28,319 --> 00:07:30,720
but you know in this case applying it

282
00:07:29,520 --> 00:07:32,080
back to the tactics we can see you know

283
00:07:30,720 --> 00:07:33,759
why are they doing that how that fits

284
00:07:32,080 --> 00:07:35,199
into the greater picture of the breach

285
00:07:33,759 --> 00:07:37,120
in this case this is how they actually

286
00:07:35,199 --> 00:07:39,599
um gain a foothold or gain initial

287
00:07:37,120 --> 00:07:40,800
access into a victim environment

288
00:07:39,599 --> 00:07:42,159
and if you're like me you know you kind

289
00:07:40,800 --> 00:07:43,599
of like was just going this is actually

290
00:07:42,160 --> 00:07:44,639
you know we're getting closer and closer

291
00:07:43,599 --> 00:07:46,400
to being an act on this

292
00:07:44,639 --> 00:07:47,680
but we're still not quite there uh but

293
00:07:46,400 --> 00:07:48,239
thankfully you know rather than walking

294
00:07:47,680 --> 00:07:49,759
you through

295
00:07:48,240 --> 00:07:51,759
the rest of the report um this is

296
00:07:49,759 --> 00:07:52,960
something thankful uh you know thanks to

297
00:07:51,759 --> 00:07:54,400
a really great contribution from red

298
00:07:52,960 --> 00:07:55,680
canary we're able to actually publish

299
00:07:54,400 --> 00:07:57,198
this already in attack

300
00:07:55,680 --> 00:07:58,960
so if you go to that url you would see

301
00:07:57,199 --> 00:08:00,000
the blue mockingbird page that you know

302
00:07:58,960 --> 00:08:01,440
kind of overviews

303
00:08:00,000 --> 00:08:03,039
um you know the background about the

304
00:08:01,440 --> 00:08:05,280
group as well as all the

305
00:08:03,039 --> 00:08:06,719
techniques uh associated from the intel

306
00:08:05,280 --> 00:08:08,159
that's been you know publicly released

307
00:08:06,720 --> 00:08:10,160
on that group

308
00:08:08,160 --> 00:08:12,080
my personal favorite thing about this is

309
00:08:10,160 --> 00:08:13,759
you know we have this magical uh attack

310
00:08:12,080 --> 00:08:14,318
navigator button we can if you click

311
00:08:13,759 --> 00:08:15,919
that

312
00:08:14,319 --> 00:08:17,520
we'll go ahead and finish out the full

313
00:08:15,919 --> 00:08:18,960
mapping of the behaviors associated with

314
00:08:17,520 --> 00:08:20,639
that intel so in this case

315
00:08:18,960 --> 00:08:22,080
you know continuing all the tactics that

316
00:08:20,639 --> 00:08:23,440
you know we haven't quite gotten to in

317
00:08:22,080 --> 00:08:25,440
the report

318
00:08:23,440 --> 00:08:26,719
um at this point like i said we're we're

319
00:08:25,440 --> 00:08:27,919
in a much better place but we're not

320
00:08:26,720 --> 00:08:29,440
quite there but we're actually

321
00:08:27,919 --> 00:08:31,039
able to you know start making decisions

322
00:08:29,440 --> 00:08:32,559
about you know circling back to that

323
00:08:31,039 --> 00:08:33,919
original question what are we going to

324
00:08:32,559 --> 00:08:35,760
do about this threat how do we actually

325
00:08:33,919 --> 00:08:38,319
what do we need to do in our environment

326
00:08:35,760 --> 00:08:39,679
uh to actually confirm or improve uh in

327
00:08:38,320 --> 00:08:41,360
response to you know the behaviors that

328
00:08:39,679 --> 00:08:42,958
the secretary might execute

329
00:08:41,360 --> 00:08:44,720
so in this case we can start to you know

330
00:08:42,958 --> 00:08:46,479
start to understand you know you know

331
00:08:44,720 --> 00:08:47,760
why what they're doing as well as why

332
00:08:46,480 --> 00:08:49,279
and we can start to drill down on

333
00:08:47,760 --> 00:08:49,760
individual behaviors of interest in this

334
00:08:49,279 --> 00:08:51,120
case

335
00:08:49,760 --> 00:08:52,800
let's take a look at how blue

336
00:08:51,120 --> 00:08:54,720
mockingbird establishes persistence

337
00:08:52,800 --> 00:08:56,399
environment so highlighting the core

338
00:08:54,720 --> 00:08:57,600
profiler technique we can actually go to

339
00:08:56,399 --> 00:08:58,800
attack and figure out

340
00:08:57,600 --> 00:09:00,320
you know what is this technique what are

341
00:08:58,800 --> 00:09:01,839
the involved technologies what does it

342
00:09:00,320 --> 00:09:04,560
entail what does an adversary

343
00:09:01,839 --> 00:09:06,080
do to establish the persistence which is

344
00:09:04,560 --> 00:09:07,119
their objective

345
00:09:06,080 --> 00:09:09,120
and you know circling back to our

346
00:09:07,120 --> 00:09:10,160
regular question of attack data sources

347
00:09:09,120 --> 00:09:11,760
this is where that you know that

348
00:09:10,160 --> 00:09:12,959
metadata comes into play we're able to

349
00:09:11,760 --> 00:09:14,560
see you know in this case

350
00:09:12,959 --> 00:09:16,560
data sources defining you know where we

351
00:09:14,560 --> 00:09:17,680
need to collect data as well as um you

352
00:09:16,560 --> 00:09:19,119
know correlating that down to the

353
00:09:17,680 --> 00:09:20,800
detection section telling us

354
00:09:19,120 --> 00:09:22,480
you know based on that data that we're

355
00:09:20,800 --> 00:09:23,920
collecting what how do we make sense of

356
00:09:22,480 --> 00:09:24,720
it how do we actually analyze it and

357
00:09:23,920 --> 00:09:27,120
process it

358
00:09:24,720 --> 00:09:28,240
to actually you know understand and find

359
00:09:27,120 --> 00:09:29,600
these adversaries

360
00:09:28,240 --> 00:09:31,279
executing this behavior in our

361
00:09:29,600 --> 00:09:33,040
environments

362
00:09:31,279 --> 00:09:34,560
so long story short i think that was a

363
00:09:33,040 --> 00:09:36,240
fun little story but you know the

364
00:09:34,560 --> 00:09:37,760
circling back to our bigger question of

365
00:09:36,240 --> 00:09:39,120
you know what is attack data source and

366
00:09:37,760 --> 00:09:41,200
why we care about these

367
00:09:39,120 --> 00:09:42,880
these are the the sources of information

368
00:09:41,200 --> 00:09:43,279
whether it be sensors or logs that you

369
00:09:42,880 --> 00:09:45,360
know help

370
00:09:43,279 --> 00:09:47,040
tell us and help us identify adversary

371
00:09:45,360 --> 00:09:48,480
behaviors in our environment and really

372
00:09:47,040 --> 00:09:50,319
circling back to the justification of

373
00:09:48,480 --> 00:09:51,839
why we should care it's what enables us

374
00:09:50,320 --> 00:09:53,680
to look at a threat group or look at you

375
00:09:51,839 --> 00:09:55,279
know an actor or a malware or a tool

376
00:09:53,680 --> 00:09:57,040
make that translation through the attack

377
00:09:55,279 --> 00:09:58,720
model and attack framework and actually

378
00:09:57,040 --> 00:09:59,920
start to pinpoint the specific data

379
00:09:58,720 --> 00:10:01,360
sources and the particular

380
00:09:59,920 --> 00:10:03,040
telemetry that we need to collect in our

381
00:10:01,360 --> 00:10:03,360
environment to actually start to drill

382
00:10:03,040 --> 00:10:05,920
down

383
00:10:03,360 --> 00:10:08,399
and find these adversaries um operating

384
00:10:05,920 --> 00:10:10,560
in our environments

385
00:10:08,399 --> 00:10:12,320
yep it is really awesome that the attack

386
00:10:10,560 --> 00:10:15,279
framework considers the data

387
00:10:12,320 --> 00:10:17,360
aspect of security operations in fact a

388
00:10:15,279 --> 00:10:19,439
lot of organizations and researchers are

389
00:10:17,360 --> 00:10:21,040
building on top of this concept

390
00:10:19,440 --> 00:10:22,880
in order to improve their security

391
00:10:21,040 --> 00:10:24,800
posture which is at the end

392
00:10:22,880 --> 00:10:25,920
i think our main goal as a community

393
00:10:24,800 --> 00:10:28,640
right but

394
00:10:25,920 --> 00:10:31,199
are we currently getting enough context

395
00:10:28,640 --> 00:10:33,839
from the framework itself

396
00:10:31,200 --> 00:10:35,839
since the origins of attack data have

397
00:10:33,839 --> 00:10:37,920
helped us to understand the adversary

398
00:10:35,839 --> 00:10:40,000
behavior from a data perspective

399
00:10:37,920 --> 00:10:42,079
in order to model threat actors and

400
00:10:40,000 --> 00:10:44,800
define detection strategies

401
00:10:42,079 --> 00:10:46,160
based on relevant data that is being

402
00:10:44,800 --> 00:10:49,279
generated and collected

403
00:10:46,160 --> 00:10:51,120
in our environments for example if we

404
00:10:49,279 --> 00:10:52,800
consider data sources that were

405
00:10:51,120 --> 00:10:55,680
previously mentioned by jamie right

406
00:10:52,800 --> 00:10:57,599
these sources make reference to not only

407
00:10:55,680 --> 00:10:58,959
different network concepts such as a

408
00:10:57,600 --> 00:11:02,480
process a port

409
00:10:58,959 --> 00:11:05,040
an ip a dll for example but also

410
00:11:02,480 --> 00:11:05,920
the interaction among them at the end of

411
00:11:05,040 --> 00:11:07,920
the day

412
00:11:05,920 --> 00:11:09,920
understanding the relationships among

413
00:11:07,920 --> 00:11:11,279
these concepts right will help us to

414
00:11:09,920 --> 00:11:14,079
model threat actors

415
00:11:11,279 --> 00:11:15,839
activities and identify relevant data

416
00:11:14,079 --> 00:11:19,120
such as system event logs 3

417
00:11:15,839 --> 00:11:20,959
network connection or 7 image loaded

418
00:11:19,120 --> 00:11:23,680
this process is helpful not only for

419
00:11:20,959 --> 00:11:25,359
defenders that are interested

420
00:11:23,680 --> 00:11:27,839
on the collection of relevant data to

421
00:11:25,360 --> 00:11:29,600
develop detections but also offensive

422
00:11:27,839 --> 00:11:31,680
teams that should pay attention

423
00:11:29,600 --> 00:11:33,600
to the data they are generating and

424
00:11:31,680 --> 00:11:35,760
could make them easy to detect

425
00:11:33,600 --> 00:11:38,959
the main goal here is to define or

426
00:11:35,760 --> 00:11:41,439
improve an effective detection strategy

427
00:11:38,959 --> 00:11:42,000
so going back to the current state of

428
00:11:41,440 --> 00:11:45,519
attack data

429
00:11:42,000 --> 00:11:48,079
sources the metadata provided by attack

430
00:11:45,519 --> 00:11:48,560
only considers names of data sources

431
00:11:48,079 --> 00:11:50,719
right

432
00:11:48,560 --> 00:11:52,638
which we can use to define some metrics

433
00:11:50,720 --> 00:11:54,639
such as coverage of tactics

434
00:11:52,639 --> 00:11:57,279
techniques or sub techniques for

435
00:11:54,639 --> 00:11:59,519
instance we can see

436
00:11:57,279 --> 00:12:01,839
that process monitoring process command

437
00:11:59,519 --> 00:12:03,680
line and file monitoring are the ones

438
00:12:01,839 --> 00:12:05,279
that provide more coverage from a

439
00:12:03,680 --> 00:12:07,920
subtechniques perspective

440
00:12:05,279 --> 00:12:09,040
this is really cool but are there any

441
00:12:07,920 --> 00:12:11,680
opportunities

442
00:12:09,040 --> 00:12:12,319
right to improve data sources within

443
00:12:11,680 --> 00:12:15,279
attack

444
00:12:12,320 --> 00:12:16,079
and take them to the next level the main

445
00:12:15,279 --> 00:12:18,639
goal here

446
00:12:16,079 --> 00:12:20,800
is to reduce the gap between recommended

447
00:12:18,639 --> 00:12:23,040
data sources by the attack team

448
00:12:20,800 --> 00:12:24,800
and the process of identifying relevant

449
00:12:23,040 --> 00:12:27,360
data that will help us

450
00:12:24,800 --> 00:12:28,959
to model adversary behaviors we will

451
00:12:27,360 --> 00:12:30,399
share with you some initial thoughts to

452
00:12:28,959 --> 00:12:32,880
answer these questions

453
00:12:30,399 --> 00:12:34,639
we are considering lack of context

454
00:12:32,880 --> 00:12:36,839
redundancy and overlapping

455
00:12:34,639 --> 00:12:38,480
and the broader scope of some data

456
00:12:36,839 --> 00:12:40,320
sources so let's

457
00:12:38,480 --> 00:12:41,680
go with the first example when we see

458
00:12:40,320 --> 00:12:43,519
process monitoring

459
00:12:41,680 --> 00:12:45,279
as the recom as a recommended data

460
00:12:43,519 --> 00:12:47,120
source right we might start thinking

461
00:12:45,279 --> 00:12:50,240
about different event logs

462
00:12:47,120 --> 00:12:51,440
that give us as security context around

463
00:12:50,240 --> 00:12:53,519
a process object

464
00:12:51,440 --> 00:12:56,079
but how can we identify the relevant

465
00:12:53,519 --> 00:12:58,399
ones we believe that more contexts will

466
00:12:56,079 --> 00:13:00,239
help us to map data sources

467
00:12:58,399 --> 00:13:01,839
to specific event logs in a more

468
00:13:00,240 --> 00:13:04,320
effective way

469
00:13:01,839 --> 00:13:06,240
going to the next one what if we get

470
00:13:04,320 --> 00:13:07,200
more than one data source that are

471
00:13:06,240 --> 00:13:09,200
referring

472
00:13:07,200 --> 00:13:10,800
to or circulating around the same

473
00:13:09,200 --> 00:13:12,800
concept for example

474
00:13:10,800 --> 00:13:14,079
let's consider process monitoring

475
00:13:12,800 --> 00:13:15,760
process command line

476
00:13:14,079 --> 00:13:17,359
and process use of network that are

477
00:13:15,760 --> 00:13:19,279
recommended for

478
00:13:17,360 --> 00:13:22,240
this sub technique here we can see that

479
00:13:19,279 --> 00:13:24,720
the concept of a process object belongs

480
00:13:22,240 --> 00:13:26,639
to all of them so we believe that

481
00:13:24,720 --> 00:13:28,720
standardizing data sources names

482
00:13:26,639 --> 00:13:30,000
based on the security concept they are

483
00:13:28,720 --> 00:13:32,959
referring to

484
00:13:30,000 --> 00:13:35,040
might be helpful to tackle this issue

485
00:13:32,959 --> 00:13:36,959
regarding our example we could use

486
00:13:35,040 --> 00:13:38,800
just the word process to represent these

487
00:13:36,959 --> 00:13:40,638
three data sources

488
00:13:38,800 --> 00:13:43,040
and finally data sources with a

489
00:13:40,639 --> 00:13:44,160
protoscope might not be helpful when

490
00:13:43,040 --> 00:13:46,560
trying to define

491
00:13:44,160 --> 00:13:48,079
an efficient data collection strategy

492
00:13:46,560 --> 00:13:49,279
for example as you can see on the image

493
00:13:48,079 --> 00:13:51,279
on the left

494
00:13:49,279 --> 00:13:52,399
windows event logs consider several

495
00:13:51,279 --> 00:13:54,800
sources of data

496
00:13:52,399 --> 00:13:56,800
and therefore we need to find a way to

497
00:13:54,800 --> 00:13:59,599
break down these type of sources

498
00:13:56,800 --> 00:14:00,240
into a more specific ones cool that was

499
00:13:59,600 --> 00:14:02,639
awesome

500
00:14:00,240 --> 00:14:04,480
so all this initial opportunities lead

501
00:14:02,639 --> 00:14:06,639
us to the following question

502
00:14:04,480 --> 00:14:08,240
how can we enhance the current state of

503
00:14:06,639 --> 00:14:10,480
attack data sources

504
00:14:08,240 --> 00:14:12,480
here is where the concept of data

505
00:14:10,480 --> 00:14:14,800
modeling comes into play

506
00:14:12,480 --> 00:14:16,639
because it will help us to organize and

507
00:14:14,800 --> 00:14:19,359
describe relevant data

508
00:14:16,639 --> 00:14:21,279
elements in a standardized way with the

509
00:14:19,360 --> 00:14:22,720
goal of getting a better understanding

510
00:14:21,279 --> 00:14:25,839
of the interaction

511
00:14:22,720 --> 00:14:27,440
among these entities as you can see in

512
00:14:25,839 --> 00:14:30,000
the image on the right

513
00:14:27,440 --> 00:14:32,480
but from an infosight perspective how

514
00:14:30,000 --> 00:14:35,040
can we start identifying data elements

515
00:14:32,480 --> 00:14:37,040
and relationships we believe that

516
00:14:35,040 --> 00:14:39,680
documenting telemetry through data

517
00:14:37,040 --> 00:14:41,760
dictionaries will help us to understand

518
00:14:39,680 --> 00:14:43,120
not only the metadata provided by

519
00:14:41,760 --> 00:14:44,880
different event logs

520
00:14:43,120 --> 00:14:47,279
but also the activity that they

521
00:14:44,880 --> 00:14:48,399
represent remember that most event logs

522
00:14:47,279 --> 00:14:51,360
are triggered by an

523
00:14:48,399 --> 00:14:52,639
action performed in our environment

524
00:14:51,360 --> 00:14:55,279
let's check an example

525
00:14:52,639 --> 00:14:56,240
of how can we identify data elements and

526
00:14:55,279 --> 00:14:58,000
relationships

527
00:14:56,240 --> 00:15:00,079
let's consider some data fields from

528
00:14:58,000 --> 00:15:02,240
system event log 7

529
00:15:00,079 --> 00:15:03,359
that describe the action of an image

530
00:15:02,240 --> 00:15:05,519
being loaded

531
00:15:03,360 --> 00:15:07,600
some fields give us context of the

532
00:15:05,519 --> 00:15:09,600
process that triggered this action

533
00:15:07,600 --> 00:15:10,639
and there are other fields that allow us

534
00:15:09,600 --> 00:15:13,040
to identify

535
00:15:10,639 --> 00:15:15,440
the specific image represented in this

536
00:15:13,040 --> 00:15:18,319
case by a dll

537
00:15:15,440 --> 00:15:20,320
at the end of the day this relationship

538
00:15:18,320 --> 00:15:22,240
among these two data elements can be

539
00:15:20,320 --> 00:15:25,519
under the module data source

540
00:15:22,240 --> 00:15:27,680
awesome now we can start doing the same

541
00:15:25,519 --> 00:15:29,759
process or activity for different event

542
00:15:27,680 --> 00:15:33,359
logs such as system 3

543
00:15:29,759 --> 00:15:34,079
8 and 11 for example we will be able to

544
00:15:33,360 --> 00:15:35,920
identify

545
00:15:34,079 --> 00:15:37,680
different relationships under attack

546
00:15:35,920 --> 00:15:40,079
data sources

547
00:15:37,680 --> 00:15:41,040
right so this is really cool but how can

548
00:15:40,079 --> 00:15:43,680
we apply

549
00:15:41,040 --> 00:15:46,639
data modeling concepts and extend the

550
00:15:43,680 --> 00:15:48,638
concept within attack data sources

551
00:15:46,639 --> 00:15:52,079
the first change that will impact data

552
00:15:48,639 --> 00:15:54,639
sources is that it's a name syntax right

553
00:15:52,079 --> 00:15:55,920
based on the the main data element they

554
00:15:54,639 --> 00:15:58,800
are related to

555
00:15:55,920 --> 00:16:00,240
we present for example in this slide on

556
00:15:58,800 --> 00:16:03,839
the left we can see

557
00:16:00,240 --> 00:16:07,680
the process data source in addition to

558
00:16:03,839 --> 00:16:08,160
this uh change of uh of name syntax

559
00:16:07,680 --> 00:16:11,359
right

560
00:16:08,160 --> 00:16:13,519
attack will consider extra information

561
00:16:11,360 --> 00:16:14,240
or metadata that will help the infosec

562
00:16:13,519 --> 00:16:16,800
community

563
00:16:14,240 --> 00:16:18,639
to start mapping telemetry collected in

564
00:16:16,800 --> 00:16:19,439
their environments to attack data

565
00:16:18,639 --> 00:16:21,199
sources

566
00:16:19,440 --> 00:16:23,759
the main concepts included in this

567
00:16:21,199 --> 00:16:24,800
metadata will be relationships among

568
00:16:23,759 --> 00:16:27,279
data elements

569
00:16:24,800 --> 00:16:29,359
and data components that are concept

570
00:16:27,279 --> 00:16:30,399
that will allow us to categorize these

571
00:16:29,360 --> 00:16:31,680
relationships

572
00:16:30,399 --> 00:16:33,839
trying to like summarize these

573
00:16:31,680 --> 00:16:34,399
relationships at the end of the day we

574
00:16:33,839 --> 00:16:36,320
can use

575
00:16:34,399 --> 00:16:39,199
relationships recommended by the attack

576
00:16:36,320 --> 00:16:41,920
framework to model adversary behavior

577
00:16:39,199 --> 00:16:42,560
and identify relevant data the main goal

578
00:16:41,920 --> 00:16:45,120
here

579
00:16:42,560 --> 00:16:45,839
is to expedite the data analysis process

580
00:16:45,120 --> 00:16:49,360
and define

581
00:16:45,839 --> 00:16:51,199
a better data collection strategy

582
00:16:49,360 --> 00:16:52,399
this leaves us in a really good place in

583
00:16:51,199 --> 00:16:53,439
terms of answering that original

584
00:16:52,399 --> 00:16:55,199
question of you know

585
00:16:53,440 --> 00:16:56,480
given an original you know particular

586
00:16:55,199 --> 00:16:58,079
threat or particular behavior

587
00:16:56,480 --> 00:17:00,320
what can we do about it so like jose

588
00:16:58,079 --> 00:17:01,680
said on the right here we can identify

589
00:17:00,320 --> 00:17:03,199
you know our enhanced view of these

590
00:17:01,680 --> 00:17:04,159
process data are these data sources in

591
00:17:03,199 --> 00:17:06,480
this case you know

592
00:17:04,160 --> 00:17:08,319
you know reflecting and updating these

593
00:17:06,480 --> 00:17:09,599
uh data sources to make more room for

594
00:17:08,319 --> 00:17:10,399
the components and relationships that

595
00:17:09,599 --> 00:17:11,839
fall under them

596
00:17:10,400 --> 00:17:12,959
as well as now that we've mapped out the

597
00:17:11,839 --> 00:17:13,918
data that we're actually collecting and

598
00:17:12,959 --> 00:17:14,720
you know taking advantage of that

599
00:17:13,919 --> 00:17:16,480
home-fielded

600
00:17:14,720 --> 00:17:17,839
advantage that like matt said we can

601
00:17:16,480 --> 00:17:18,959
start making these mappings and start

602
00:17:17,839 --> 00:17:21,039
figuring out you know

603
00:17:18,959 --> 00:17:22,400
for all these data sources that um you

604
00:17:21,039 --> 00:17:24,160
know our threats are actually telling us

605
00:17:22,400 --> 00:17:25,439
are relevant that we should collect

606
00:17:24,160 --> 00:17:27,280
where are we actually collecting this

607
00:17:25,439 --> 00:17:28,799
data you know not just a you know a

608
00:17:27,280 --> 00:17:30,960
singular event to a singular

609
00:17:28,799 --> 00:17:32,000
uh data source in the case of process we

610
00:17:30,960 --> 00:17:33,760
can see there's so many

611
00:17:32,000 --> 00:17:35,280
different um events that are collecting

612
00:17:33,760 --> 00:17:36,720
relevant data about our process

613
00:17:35,280 --> 00:17:38,320
so we're able to actually start um you

614
00:17:36,720 --> 00:17:39,200
know respecting and you know

615
00:17:38,320 --> 00:17:41,280
appreciating

616
00:17:39,200 --> 00:17:42,720
those relationships like jose said as

617
00:17:41,280 --> 00:17:44,080
well as more importantly

618
00:17:42,720 --> 00:17:45,440
starting to see our holes and our gaps

619
00:17:44,080 --> 00:17:46,000
in case you see the bottom of these data

620
00:17:45,440 --> 00:17:48,640
sources

621
00:17:46,000 --> 00:17:50,080
where are we not collecting data and um

622
00:17:48,640 --> 00:17:51,360
you know piggybacking on that

623
00:17:50,080 --> 00:17:53,600
you know how do we address those holes

624
00:17:51,360 --> 00:17:55,199
and in case of i think jose already said

625
00:17:53,600 --> 00:17:56,639
you know windows event logs is a very

626
00:17:55,200 --> 00:17:58,160
broad data source it's probably not

627
00:17:56,640 --> 00:17:59,840
you know probably not appropriate to be

628
00:17:58,160 --> 00:18:01,200
a data source but it is a great source

629
00:17:59,840 --> 00:18:01,678
of information that we can use to

630
00:18:01,200 --> 00:18:04,000
address

631
00:18:01,679 --> 00:18:05,360
um other you know relevant information i

632
00:18:04,000 --> 00:18:06,160
think the last talk even covered it

633
00:18:05,360 --> 00:18:09,039
really greatly

634
00:18:06,160 --> 00:18:10,720
we can use the 4624s and the 4625s being

635
00:18:09,039 --> 00:18:12,080
generated within the windows event log

636
00:18:10,720 --> 00:18:13,440
to actually address the authentication

637
00:18:12,080 --> 00:18:14,399
logs that we need to identify

638
00:18:13,440 --> 00:18:17,200
adversaries

639
00:18:14,400 --> 00:18:17,679
executing in our environment um so like

640
00:18:17,200 --> 00:18:20,000
i said

641
00:18:17,679 --> 00:18:21,280
we'll um we're actually this is kind of

642
00:18:20,000 --> 00:18:22,400
a summary of you know where we're going

643
00:18:21,280 --> 00:18:24,240
where we're thinking in terms of

644
00:18:22,400 --> 00:18:26,480
data sources in the future we will be

645
00:18:24,240 --> 00:18:27,840
releasing very soon you know a two-part

646
00:18:26,480 --> 00:18:29,600
two-part series kind of highlighting

647
00:18:27,840 --> 00:18:30,720
everything we've talked about so far as

648
00:18:29,600 --> 00:18:32,000
well as how you can actually

649
00:18:30,720 --> 00:18:33,760
you know operationalize it in your

650
00:18:32,000 --> 00:18:35,520
environment and get all these data these

651
00:18:33,760 --> 00:18:37,120
data libraries and these data objects

652
00:18:35,520 --> 00:18:39,360
based on what data you're collecting

653
00:18:37,120 --> 00:18:41,120
um and then as part of that we're also

654
00:18:39,360 --> 00:18:43,600
releasing a github project showing you

655
00:18:41,120 --> 00:18:45,918
know our initial draft on what these

656
00:18:43,600 --> 00:18:47,120
refined and enhanced data sources may

657
00:18:45,919 --> 00:18:49,679
potentially look like

658
00:18:47,120 --> 00:18:50,959
an attack going in the future uh but to

659
00:18:49,679 --> 00:18:52,559
kind of cement that point like i said

660
00:18:50,960 --> 00:18:53,360
that might have been a bit much and like

661
00:18:52,559 --> 00:18:54,960
i said a little bit

662
00:18:53,360 --> 00:18:56,080
if you've never been exposed you know

663
00:18:54,960 --> 00:18:57,440
that it might have been a little bit um

664
00:18:56,080 --> 00:18:59,199
you know hard to track or

665
00:18:57,440 --> 00:19:00,880
uh you know it would definitely help to

666
00:18:59,200 --> 00:19:01,520
see an example so to address that we

667
00:19:00,880 --> 00:19:04,320
actually did

668
00:19:01,520 --> 00:19:05,679
end up like i said before uh running

669
00:19:04,320 --> 00:19:07,360
through an experiment where we actually

670
00:19:05,679 --> 00:19:08,960
execute a real adversary behavior

671
00:19:07,360 --> 00:19:10,320
and show you how this refined and

672
00:19:08,960 --> 00:19:11,760
enhanced view of data sources actually

673
00:19:10,320 --> 00:19:13,039
helps us find

674
00:19:11,760 --> 00:19:14,960
and trace these adversaries in our

675
00:19:13,039 --> 00:19:17,600
environment so

676
00:19:14,960 --> 00:19:18,799
you know you know a high level overview

677
00:19:17,600 --> 00:19:19,600
of the way we kind of approach this

678
00:19:18,799 --> 00:19:21,200
experiment with

679
00:19:19,600 --> 00:19:22,399
the big goal being you know taking

680
00:19:21,200 --> 00:19:23,919
knowledge and attack and actually

681
00:19:22,400 --> 00:19:25,520
translate it down to the technologies

682
00:19:23,919 --> 00:19:27,360
and the sensors in our environment

683
00:19:25,520 --> 00:19:28,400
we defined a six-step process um you

684
00:19:27,360 --> 00:19:30,080
know starting with you know

685
00:19:28,400 --> 00:19:31,200
understanding and defining our research

686
00:19:30,080 --> 00:19:32,399
goals so taking a look at

687
00:19:31,200 --> 00:19:34,000
you know the adversary behaviors and

688
00:19:32,400 --> 00:19:35,520
attack identifying you know which ones

689
00:19:34,000 --> 00:19:36,799
we're particularly interested in

690
00:19:35,520 --> 00:19:38,879
and figuring out how much we can

691
00:19:36,799 --> 00:19:40,320
actually derive from an understanding of

692
00:19:38,880 --> 00:19:41,600
just you know what is this behavior and

693
00:19:40,320 --> 00:19:43,360
you know what is it used for

694
00:19:41,600 --> 00:19:45,120
which leads us into our second step of

695
00:19:43,360 --> 00:19:46,879
you know defining an initial

696
00:19:45,120 --> 00:19:49,039
you know an initial hypothesis or

697
00:19:46,880 --> 00:19:50,240
notional model for you know what data do

698
00:19:49,039 --> 00:19:50,720
we need to collect you know just looking

699
00:19:50,240 --> 00:19:52,880
at

700
00:19:50,720 --> 00:19:54,080
you know what what data is provided in

701
00:19:52,880 --> 00:19:55,360
attack we can start to figure out you

702
00:19:54,080 --> 00:19:56,320
know what's our starting point you know

703
00:19:55,360 --> 00:19:58,799
what data

704
00:19:56,320 --> 00:20:00,159
should we start looking for uh and then

705
00:19:58,799 --> 00:20:02,240
proceeding to you know my fair

706
00:20:00,160 --> 00:20:04,000
personal favorite step adversary uh

707
00:20:02,240 --> 00:20:05,440
adversary simulation emulation

708
00:20:04,000 --> 00:20:07,039
basically let's get our hands dirty and

709
00:20:05,440 --> 00:20:08,480
actually execute the behavior and

710
00:20:07,039 --> 00:20:09,360
generate the telemetry that we can use

711
00:20:08,480 --> 00:20:11,039
in step four

712
00:20:09,360 --> 00:20:12,399
to actually you know tune and enhance

713
00:20:11,039 --> 00:20:13,280
our initial model you know taking that

714
00:20:12,400 --> 00:20:14,960
notional model

715
00:20:13,280 --> 00:20:16,158
and actually you know applying the real

716
00:20:14,960 --> 00:20:16,720
data that we actually generate in the

717
00:20:16,159 --> 00:20:18,159
lab

718
00:20:16,720 --> 00:20:20,640
and you know fusing those together into

719
00:20:18,159 --> 00:20:23,039
actually a more you know a data-driven

720
00:20:20,640 --> 00:20:24,320
view of what the actual data byproduct

721
00:20:23,039 --> 00:20:25,760
and data sources relevant to this

722
00:20:24,320 --> 00:20:28,158
behavior actually look like

723
00:20:25,760 --> 00:20:29,440
uh step five you know validating that

724
00:20:28,159 --> 00:20:30,880
model taking a look at you know this

725
00:20:29,440 --> 00:20:31,840
model that we've derived from this

726
00:20:30,880 --> 00:20:33,039
experimentation

727
00:20:31,840 --> 00:20:34,559
it's actually something that we want to

728
00:20:33,039 --> 00:20:35,840
apply to the real world how does it will

729
00:20:34,559 --> 00:20:36,720
it scale well how does it deal with

730
00:20:35,840 --> 00:20:37,918
false positives

731
00:20:36,720 --> 00:20:39,039
you know whether ramifications are

732
00:20:37,919 --> 00:20:40,320
actually putting this into our real

733
00:20:39,039 --> 00:20:41,840
environment

734
00:20:40,320 --> 00:20:43,280
and then finally step six once we're

735
00:20:41,840 --> 00:20:44,639
kind of comfortable with the the data

736
00:20:43,280 --> 00:20:45,360
model that we've defined and that we

737
00:20:44,640 --> 00:20:46,880
think it's actually

738
00:20:45,360 --> 00:20:49,199
something practical that we want to you

739
00:20:46,880 --> 00:20:50,320
know operationalize uh documenting it

740
00:20:49,200 --> 00:20:51,600
and communicating with the rest of the

741
00:20:50,320 --> 00:20:53,360
community so that you know

742
00:20:51,600 --> 00:20:55,039
um there is something that you know not

743
00:20:53,360 --> 00:20:55,760
we're not just using an rn but you know

744
00:20:55,039 --> 00:20:57,120
something that you know

745
00:20:55,760 --> 00:20:58,879
translates between customers it

746
00:20:57,120 --> 00:21:00,559
translates between environments so we

747
00:20:58,880 --> 00:21:03,360
can all take advantage of the same of

748
00:21:00,559 --> 00:21:04,559
all the knowledge that we captured here

749
00:21:03,360 --> 00:21:05,760
so starting from the top you know

750
00:21:04,559 --> 00:21:08,000
research goal in this case we're looking

751
00:21:05,760 --> 00:21:09,919
at the core profiler behavior

752
00:21:08,000 --> 00:21:11,600
in this case the blue mockingbird group

753
00:21:09,919 --> 00:21:12,720
use this to establish persistence in

754
00:21:11,600 --> 00:21:13,600
their environment and their victim

755
00:21:12,720 --> 00:21:15,440
environments

756
00:21:13,600 --> 00:21:18,320
specifically what it's doing is you're

757
00:21:15,440 --> 00:21:20,159
able to attach a malicious dll to any

758
00:21:18,320 --> 00:21:22,240
process that loads the.net

759
00:21:20,159 --> 00:21:23,520
library so basically any any process

760
00:21:22,240 --> 00:21:24,480
that's loading you know the those

761
00:21:23,520 --> 00:21:27,760
windows native

762
00:21:24,480 --> 00:21:30,880
utilities this initial uh this uh

763
00:21:27,760 --> 00:21:32,480
additional profiling uh dll or

764
00:21:30,880 --> 00:21:34,400
payload will additionally be loaded and

765
00:21:32,480 --> 00:21:35,919
executed from that process

766
00:21:34,400 --> 00:21:37,520
so you know we can take a look at attack

767
00:21:35,919 --> 00:21:39,520
in the description provided by attack

768
00:21:37,520 --> 00:21:40,960
but also circle back to the intelligence

769
00:21:39,520 --> 00:21:42,480
reference by attack and start figuring

770
00:21:40,960 --> 00:21:43,360
out you know what does this behavior

771
00:21:42,480 --> 00:21:44,400
actually look like what are the

772
00:21:43,360 --> 00:21:45,840
mechanics

773
00:21:44,400 --> 00:21:47,520
that um you know are generated when an

774
00:21:45,840 --> 00:21:48,799
adversary executes this behavior in this

775
00:21:47,520 --> 00:21:50,480
case we can start to pick out you know

776
00:21:48,799 --> 00:21:50,960
particular you know items of interest in

777
00:21:50,480 --> 00:21:53,280
this case

778
00:21:50,960 --> 00:21:55,200
the core profile i mean blue mockingbird

779
00:21:53,280 --> 00:21:57,200
chose to use wimik or wmi

780
00:21:55,200 --> 00:21:58,480
to execute their commands and you know

781
00:21:57,200 --> 00:22:00,080
there's a couple different ways you can

782
00:21:58,480 --> 00:22:01,760
set up core profile

783
00:22:00,080 --> 00:22:03,360
persistence one of which is you know in

784
00:22:01,760 --> 00:22:06,000
this case they're using environment

785
00:22:03,360 --> 00:22:07,918
variables and registry manipulations

786
00:22:06,000 --> 00:22:09,280
uh and finally at the end you can see

787
00:22:07,919 --> 00:22:10,559
you know their additional payload drop

788
00:22:09,280 --> 00:22:11,840
to disk that's i'm assuming that's what

789
00:22:10,559 --> 00:22:12,559
they want loaded into the victim

790
00:22:11,840 --> 00:22:14,080
processes

791
00:22:12,559 --> 00:22:15,280
as well as looking at that path we can

792
00:22:14,080 --> 00:22:17,360
infer you know that's not something

793
00:22:15,280 --> 00:22:18,240
that's native to most system uh windows

794
00:22:17,360 --> 00:22:19,678
systems so they

795
00:22:18,240 --> 00:22:21,360
at some point probably had to drop that

796
00:22:19,679 --> 00:22:21,840
to disk so before any of this all

797
00:22:21,360 --> 00:22:23,199
happened

798
00:22:21,840 --> 00:22:25,280
there's probably a file right that we

799
00:22:23,200 --> 00:22:26,799
can use and trace down as well

800
00:22:25,280 --> 00:22:28,639
but you know big question here is you

801
00:22:26,799 --> 00:22:30,559
know that we've kind of understand

802
00:22:28,640 --> 00:22:32,240
what this adversary behavior looks like

803
00:22:30,559 --> 00:22:33,840
you know where we find the data

804
00:22:32,240 --> 00:22:35,280
uh you know generated by this and

805
00:22:33,840 --> 00:22:37,120
additionally what other data will we

806
00:22:35,280 --> 00:22:38,399
find you know just this is just kind of

807
00:22:37,120 --> 00:22:40,559
us looking at it from the adversary

808
00:22:38,400 --> 00:22:41,760
perspective uh but we know from the

809
00:22:40,559 --> 00:22:43,440
home taking advantage of home fit

810
00:22:41,760 --> 00:22:44,240
advantage taking advantage of home field

811
00:22:43,440 --> 00:22:45,600
advantage

812
00:22:44,240 --> 00:22:47,280
what will you know what what other

813
00:22:45,600 --> 00:22:49,520
byproducts can we actually you know act

814
00:22:47,280 --> 00:22:51,840
on and use

815
00:22:49,520 --> 00:22:53,840
yeah that was awesome jamie very

816
00:22:51,840 --> 00:22:54,480
important first step for any detection

817
00:22:53,840 --> 00:22:56,399
research

818
00:22:54,480 --> 00:22:57,919
process that will help us to identify

819
00:22:56,400 --> 00:22:59,919
adversary actions

820
00:22:57,919 --> 00:23:01,600
and establish an initial detection model

821
00:22:59,919 --> 00:23:03,679
from a data perspective right

822
00:23:01,600 --> 00:23:05,600
so following our process let's consider

823
00:23:03,679 --> 00:23:06,000
data sources recommended by the attack

824
00:23:05,600 --> 00:23:08,158
team

825
00:23:06,000 --> 00:23:10,159
right and start identifying data

826
00:23:08,159 --> 00:23:11,679
components and relationships

827
00:23:10,159 --> 00:23:13,520
that can represent the adversary

828
00:23:11,679 --> 00:23:14,400
behavior for the core profiler sub

829
00:23:13,520 --> 00:23:16,559
technique

830
00:23:14,400 --> 00:23:19,200
we can use them to start mapping a

831
00:23:16,559 --> 00:23:21,120
specific system event logs for example

832
00:23:19,200 --> 00:23:22,720
to every relationship right remember

833
00:23:21,120 --> 00:23:25,120
that this mapping process

834
00:23:22,720 --> 00:23:26,559
might be easier if we have our telemetry

835
00:23:25,120 --> 00:23:28,399
already documented

836
00:23:26,559 --> 00:23:30,799
the content of this sli is very

837
00:23:28,400 --> 00:23:31,840
important because we will use these data

838
00:23:30,799 --> 00:23:34,799
relationships

839
00:23:31,840 --> 00:23:37,280
and event logs as our main reference or

840
00:23:34,799 --> 00:23:41,039
guide when we are analyzing our data in

841
00:23:37,280 --> 00:23:42,480
the next uh stages

842
00:23:41,039 --> 00:23:43,919
all right so now it comes down to now

843
00:23:42,480 --> 00:23:44,320
that we have this initial model of you

844
00:23:43,919 --> 00:23:46,159
know

845
00:23:44,320 --> 00:23:47,840
like jose said what do we need to look

846
00:23:46,159 --> 00:23:48,880
for based on you know the mechanics of

847
00:23:47,840 --> 00:23:50,240
the adversary behavior

848
00:23:48,880 --> 00:23:51,360
and how that actually translates you

849
00:23:50,240 --> 00:23:52,000
know where does that fall in our

850
00:23:51,360 --> 00:23:53,199
environment

851
00:23:52,000 --> 00:23:54,880
we can actually start to you know

852
00:23:53,200 --> 00:23:56,480
actually put the real data on the table

853
00:23:54,880 --> 00:23:58,240
and see does it stack up you know are we

854
00:23:56,480 --> 00:23:59,360
where are our estimations correct and

855
00:23:58,240 --> 00:24:00,559
you know what additional data would

856
00:23:59,360 --> 00:24:02,158
actually be generated

857
00:24:00,559 --> 00:24:03,600
in this case you know emulating the

858
00:24:02,159 --> 00:24:05,279
actual behavior here was pretty simple

859
00:24:03,600 --> 00:24:07,199
you know the report was really great

860
00:24:05,279 --> 00:24:09,200
uh provided a redacted you know subset

861
00:24:07,200 --> 00:24:10,400
of actual commands run by the adversary

862
00:24:09,200 --> 00:24:11,760
as well as looking at you know other

863
00:24:10,400 --> 00:24:12,640
resources online such as you know

864
00:24:11,760 --> 00:24:14,799
there's a couple

865
00:24:12,640 --> 00:24:16,320
really great blogs as well as atomic red

866
00:24:14,799 --> 00:24:17,918
team provided you know

867
00:24:16,320 --> 00:24:19,918
a perfect subset of commands i could

868
00:24:17,919 --> 00:24:21,360
easily run to simulate the behavior that

869
00:24:19,919 --> 00:24:22,960
was able to you know massage into

870
00:24:21,360 --> 00:24:24,240
exactly what we wanted to do

871
00:24:22,960 --> 00:24:25,520
um and then on the other side of this

872
00:24:24,240 --> 00:24:26,880
the blue team side you know i can

873
00:24:25,520 --> 00:24:28,158
execute once i got this working in my

874
00:24:26,880 --> 00:24:30,960
environment and i was able to actually

875
00:24:28,159 --> 00:24:32,000
re regenerate and um you know reproduce

876
00:24:30,960 --> 00:24:34,000
the same effect

877
00:24:32,000 --> 00:24:35,520
that the blue mockingbird created able

878
00:24:34,000 --> 00:24:36,799
using another product like mordor in

879
00:24:35,520 --> 00:24:38,639
case uh in this case we were able to

880
00:24:36,799 --> 00:24:39,760
record the security events generated on

881
00:24:38,640 --> 00:24:40,480
my system when i executed these

882
00:24:39,760 --> 00:24:42,000
behaviors

883
00:24:40,480 --> 00:24:43,360
and actually share that with jose so

884
00:24:42,000 --> 00:24:44,159
we're able to sit down together and comb

885
00:24:43,360 --> 00:24:46,158
through the data and

886
00:24:44,159 --> 00:24:47,360
make sure the data was accurate but also

887
00:24:46,159 --> 00:24:48,880
i could just hand that over to him and

888
00:24:47,360 --> 00:24:50,959
he was able to load that into you know

889
00:24:48,880 --> 00:24:53,279
his health stack or his you know

890
00:24:50,960 --> 00:24:54,320
seem or whatever analytic development um

891
00:24:53,279 --> 00:24:55,440
you know environment

892
00:24:54,320 --> 00:24:57,520
and actually start digging through the

893
00:24:55,440 --> 00:25:01,279
data and actually build on top of that

894
00:24:57,520 --> 00:25:03,360
model that we defined in uh step two

895
00:25:01,279 --> 00:25:04,559
yeah actually we both learned a lot

896
00:25:03,360 --> 00:25:06,799
after this table

897
00:25:04,559 --> 00:25:07,678
and simulating this with provider

898
00:25:06,799 --> 00:25:10,158
technique

899
00:25:07,679 --> 00:25:11,120
it was a really helpful experience for

900
00:25:10,159 --> 00:25:13,279
both of us

901
00:25:11,120 --> 00:25:14,799
so going to the detection modeling stage

902
00:25:13,279 --> 00:25:16,400
of this experiment right

903
00:25:14,799 --> 00:25:18,639
the main goal here is to accomplish

904
00:25:16,400 --> 00:25:20,480
persistence therefore there will be two

905
00:25:18,640 --> 00:25:23,360
different moments

906
00:25:20,480 --> 00:25:25,279
for this experiment before and after a

907
00:25:23,360 --> 00:25:27,199
user reboots his computer right

908
00:25:25,279 --> 00:25:29,440
so we will start analyzing the data

909
00:25:27,200 --> 00:25:30,159
collected focusing on the relationships

910
00:25:29,440 --> 00:25:33,279
provided

911
00:25:30,159 --> 00:25:34,799
by attack data sources a good place to

912
00:25:33,279 --> 00:25:37,120
start our analysis might be the

913
00:25:34,799 --> 00:25:38,960
modification of environment variables

914
00:25:37,120 --> 00:25:41,360
through the registry which is part of

915
00:25:38,960 --> 00:25:42,480
the b4 rebooting stage of this

916
00:25:41,360 --> 00:25:44,879
experiment

917
00:25:42,480 --> 00:25:47,200
so according to the city i collected

918
00:25:44,880 --> 00:25:48,000
mockingbird modifies the core enabled

919
00:25:47,200 --> 00:25:50,400
profiling

920
00:25:48,000 --> 00:25:51,600
environment variable in order to enable

921
00:25:50,400 --> 00:25:53,520
core profiler

922
00:25:51,600 --> 00:25:54,719
so looking for that specific pattern in

923
00:25:53,520 --> 00:25:57,520
our data

924
00:25:54,720 --> 00:25:58,720
helped us to identify a wmig provider

925
00:25:57,520 --> 00:26:01,120
host process

926
00:25:58,720 --> 00:26:03,200
setting the value of the core profiler

927
00:26:01,120 --> 00:26:05,520
using a class identifier

928
00:26:03,200 --> 00:26:07,520
that will allow us to access properties

929
00:26:05,520 --> 00:26:10,240
and methods of a dll

930
00:26:07,520 --> 00:26:12,158
we were able also to validate that the

931
00:26:10,240 --> 00:26:15,240
parent process of this activity

932
00:26:12,159 --> 00:26:16,400
was a command.edc process this

933
00:26:15,240 --> 00:26:19,520
command.edc

934
00:26:16,400 --> 00:26:23,440
process has other child processes

935
00:26:19,520 --> 00:26:26,559
and in one of them we found a rec.edc

936
00:26:23,440 --> 00:26:27,440
process that is using the impro server

937
00:26:26,559 --> 00:26:29,678
sub key

938
00:26:27,440 --> 00:26:31,120
along with the same class identifier

939
00:26:29,679 --> 00:26:34,320
that was said before

940
00:26:31,120 --> 00:26:36,639
with the core profiler variable to point

941
00:26:34,320 --> 00:26:38,480
to the malicious dll

942
00:26:36,640 --> 00:26:40,640
so going back to the relationships

943
00:26:38,480 --> 00:26:42,880
provided by attack data sources

944
00:26:40,640 --> 00:26:45,200
let's update these relationships with

945
00:26:42,880 --> 00:26:47,279
data from our experiment

946
00:26:45,200 --> 00:26:48,799
these relationships were really helpful

947
00:26:47,279 --> 00:26:50,559
to focus our analysis

948
00:26:48,799 --> 00:26:52,240
and get a better understanding of the

949
00:26:50,559 --> 00:26:54,879
adversary behavior

950
00:26:52,240 --> 00:26:56,960
in fact this can help us to identify

951
00:26:54,880 --> 00:26:59,120
which elements right of data

952
00:26:56,960 --> 00:27:00,640
can help us to define a behavioral

953
00:26:59,120 --> 00:27:03,120
detection strategy

954
00:27:00,640 --> 00:27:04,000
the adversary could use other processes

955
00:27:03,120 --> 00:27:08,000
rather than

956
00:27:04,000 --> 00:27:09,840
rather than w or rec in order to modify

957
00:27:08,000 --> 00:27:10,720
the registry and set environment

958
00:27:09,840 --> 00:27:13,520
variables

959
00:27:10,720 --> 00:27:14,400
however what it is not changing are the

960
00:27:13,520 --> 00:27:16,879
names

961
00:27:14,400 --> 00:27:18,720
of the environment variables and the use

962
00:27:16,880 --> 00:27:21,840
of the inbox server sub key

963
00:27:18,720 --> 00:27:24,240
in order to register the dll so

964
00:27:21,840 --> 00:27:26,158
from app behavior perspective right

965
00:27:24,240 --> 00:27:28,399
these are the three components

966
00:27:26,159 --> 00:27:30,799
of data that we should consider to

967
00:27:28,399 --> 00:27:33,439
define an initial data analytic

968
00:27:30,799 --> 00:27:34,639
for the b4 rebooting stage of this

969
00:27:33,440 --> 00:27:37,440
experiment

970
00:27:34,640 --> 00:27:39,679
we will look for a dll registered right

971
00:27:37,440 --> 00:27:42,080
using the improv server sub key

972
00:27:39,679 --> 00:27:44,320
with a class identifier that was also

973
00:27:42,080 --> 00:27:47,039
set for the core profiler

974
00:27:44,320 --> 00:27:47,439
variable after applying wreath rule

975
00:27:47,039 --> 00:27:49,760
right

976
00:27:47,440 --> 00:27:52,080
we were able to get security context

977
00:27:49,760 --> 00:27:54,799
around a potential malicious dll

978
00:27:52,080 --> 00:27:56,158
related to the core profiler environment

979
00:27:54,799 --> 00:27:58,480
variable

980
00:27:56,159 --> 00:28:00,399
this was awesome right but this is this

981
00:27:58,480 --> 00:28:01,279
is just like the first stage of our

982
00:28:00,399 --> 00:28:02,959
experiment

983
00:28:01,279 --> 00:28:05,200
because according to the relationships

984
00:28:02,960 --> 00:28:07,360
provided by attack data sources

985
00:28:05,200 --> 00:28:08,640
and all the cti collected and already

986
00:28:07,360 --> 00:28:10,320
explained by jamie

987
00:28:08,640 --> 00:28:12,240
but there is one more action that should

988
00:28:10,320 --> 00:28:14,799
happen in order to validate

989
00:28:12,240 --> 00:28:16,080
the existence of persistence in our in

990
00:28:14,799 --> 00:28:17,840
our network

991
00:28:16,080 --> 00:28:19,760
which is the load of the malicious or

992
00:28:17,840 --> 00:28:22,158
potential malicious dll by a

993
00:28:19,760 --> 00:28:23,440
net based application when a user

994
00:28:22,159 --> 00:28:25,120
reboots his computer

995
00:28:23,440 --> 00:28:27,440
after enjoying a nice weekend with

996
00:28:25,120 --> 00:28:28,559
friends or families so everyone is back

997
00:28:27,440 --> 00:28:32,000
at work now

998
00:28:28,559 --> 00:28:33,440
on monday and then yep we started

999
00:28:32,000 --> 00:28:36,240
exploring our data

1000
00:28:33,440 --> 00:28:39,200
and we found a net based process in this

1001
00:28:36,240 --> 00:28:39,200
case vs code

1002
00:28:39,919 --> 00:28:44,159
loading the malicious dll right so we

1003
00:28:42,159 --> 00:28:44,880
were able to catch this using sysmon

1004
00:28:44,159 --> 00:28:47,679
event seven

1005
00:28:44,880 --> 00:28:49,360
that triggers when an image or a dll is

1006
00:28:47,679 --> 00:28:51,679
loaded in our system

1007
00:28:49,360 --> 00:28:53,918
so this is awesome right because we can

1008
00:28:51,679 --> 00:28:54,799
now add this context to our previous

1009
00:28:53,919 --> 00:28:56,480
data model

1010
00:28:54,799 --> 00:28:59,279
right so now we are considering the

1011
00:28:56,480 --> 00:29:02,000
entire process that the adversary used

1012
00:28:59,279 --> 00:29:02,480
to accomplish persistence in our network

1013
00:29:02,000 --> 00:29:04,640
with

1014
00:29:02,480 --> 00:29:05,840
this will also help us to improve our

1015
00:29:04,640 --> 00:29:08,480
detection strategy

1016
00:29:05,840 --> 00:29:09,520
considering dlls that were not only

1017
00:29:08,480 --> 00:29:11,840
registered

1018
00:29:09,520 --> 00:29:14,158
using the improv server sub key and

1019
00:29:11,840 --> 00:29:18,720
related to the core profiler variable

1020
00:29:14,159 --> 00:29:21,360
but also now being loaded in our network

1021
00:29:18,720 --> 00:29:22,320
we were able to identify 2.net based

1022
00:29:21,360 --> 00:29:24,799
applications

1023
00:29:22,320 --> 00:29:26,399
such as vs code and powershell loading

1024
00:29:24,799 --> 00:29:28,480
the malicious dll

1025
00:29:26,399 --> 00:29:30,879
right so now you might be asking

1026
00:29:28,480 --> 00:29:31,360
yourself what is this malicious dll

1027
00:29:30,880 --> 00:29:33,919
doing

1028
00:29:31,360 --> 00:29:35,120
after being loaded in fact this dll

1029
00:29:33,919 --> 00:29:37,120
could do anything right

1030
00:29:35,120 --> 00:29:39,439
so in order to show you how the new

1031
00:29:37,120 --> 00:29:40,559
metadata provided by attack data sources

1032
00:29:39,440 --> 00:29:43,279
can help you to go

1033
00:29:40,559 --> 00:29:44,799
deeper into your analysis right let's

1034
00:29:43,279 --> 00:29:46,799
consider a use case

1035
00:29:44,799 --> 00:29:48,360
where the dll is spawning a child

1036
00:29:46,799 --> 00:29:50,799
process in this case

1037
00:29:48,360 --> 00:29:52,799
reg.exe that is making a network

1038
00:29:50,799 --> 00:29:56,000
connection to an external ip

1039
00:29:52,799 --> 00:29:58,399
and download and execute a payload right

1040
00:29:56,000 --> 00:29:59,840
this behavior can be also considered in

1041
00:29:58,399 --> 00:30:01,760
our detection model

1042
00:29:59,840 --> 00:30:03,520
using the relationships provided again

1043
00:30:01,760 --> 00:30:05,520
by attack data sources

1044
00:30:03,520 --> 00:30:08,080
so at the end of the day we can start

1045
00:30:05,520 --> 00:30:11,279
improving our detection strategy

1046
00:30:08,080 --> 00:30:14,080
right we go to the next one

1047
00:30:11,279 --> 00:30:16,399
yeah so you can see now we start like

1048
00:30:14,080 --> 00:30:18,639
adding more context to our analytics so

1049
00:30:16,399 --> 00:30:20,959
we are looking for the dll register

1050
00:30:18,640 --> 00:30:22,880
using the import server sub key that was

1051
00:30:20,960 --> 00:30:24,240
related to the core profiler variable

1052
00:30:22,880 --> 00:30:26,799
that was loaded by

1053
00:30:24,240 --> 00:30:28,559
in our environment but now we have

1054
00:30:26,799 --> 00:30:30,080
processes that are related to this

1055
00:30:28,559 --> 00:30:30,879
activity that are making a network

1056
00:30:30,080 --> 00:30:34,158
connection

1057
00:30:30,880 --> 00:30:36,880
out of our network so at the end

1058
00:30:34,159 --> 00:30:38,799
we were able to identify five results

1059
00:30:36,880 --> 00:30:40,640
after applying this rule

1060
00:30:38,799 --> 00:30:42,879
and let's just take a look really quick

1061
00:30:40,640 --> 00:30:45,760
on one of them we were able to identify

1062
00:30:42,880 --> 00:30:48,080
for example a rec 73 process

1063
00:30:45,760 --> 00:30:50,399
making a network connection after being

1064
00:30:48,080 --> 00:30:53,360
spawned by a powershell process

1065
00:30:50,399 --> 00:30:54,959
that loaded the malicious dll related to

1066
00:30:53,360 --> 00:30:58,080
the core profiler

1067
00:30:54,960 --> 00:30:59,679
core profiler variable so thankfully all

1068
00:30:58,080 --> 00:31:01,918
this analysis process

1069
00:30:59,679 --> 00:31:05,679
was fully supported by the new metadata

1070
00:31:01,919 --> 00:31:07,200
provided by attack data sources

1071
00:31:05,679 --> 00:31:08,960
and like i said before that that

1072
00:31:07,200 --> 00:31:10,159
analytic is very great like i said we

1073
00:31:08,960 --> 00:31:12,080
really are able to drill down

1074
00:31:10,159 --> 00:31:13,440
actually you know hit that behavior to a

1075
00:31:12,080 --> 00:31:14,240
t but you know what what do we do with

1076
00:31:13,440 --> 00:31:15,679
this knowledge what

1077
00:31:14,240 --> 00:31:16,960
where do we actually act on it from now

1078
00:31:15,679 --> 00:31:18,000
you said i think the first step is

1079
00:31:16,960 --> 00:31:19,519
taking a step back and

1080
00:31:18,000 --> 00:31:21,279
getting back to that logical model and

1081
00:31:19,519 --> 00:31:22,559
identifying you know what data is

1082
00:31:21,279 --> 00:31:24,159
actually generated from

1083
00:31:22,559 --> 00:31:25,678
you know this behavior but also how do

1084
00:31:24,159 --> 00:31:27,440
we want to document that and communicate

1085
00:31:25,679 --> 00:31:28,799
with the with the rest of the community

1086
00:31:27,440 --> 00:31:30,240
in this case you know that this is a

1087
00:31:28,799 --> 00:31:31,519
really powerful model and a way of

1088
00:31:30,240 --> 00:31:32,559
looking at the results because rather

1089
00:31:31,519 --> 00:31:35,360
than just looking at

1090
00:31:32,559 --> 00:31:35,760
we can also see um you know particularly

1091
00:31:35,360 --> 00:31:38,479
the

1092
00:31:35,760 --> 00:31:39,679
the behaviors um that what what data is

1093
00:31:38,480 --> 00:31:40,480
generated from the particular behavior

1094
00:31:39,679 --> 00:31:42,240
so in this case

1095
00:31:40,480 --> 00:31:43,679
the core profiler modifying those

1096
00:31:42,240 --> 00:31:44,320
environment variables and those registry

1097
00:31:43,679 --> 00:31:46,559
settings

1098
00:31:44,320 --> 00:31:48,240
uh related to um you know enabling that

1099
00:31:46,559 --> 00:31:49,678
persistence but also that all the

1100
00:31:48,240 --> 00:31:51,360
surrounding context from that you know

1101
00:31:49,679 --> 00:31:51,919
the processes that made those changes as

1102
00:31:51,360 --> 00:31:53,360
well as

1103
00:31:51,919 --> 00:31:54,399
the processes that were victimized by

1104
00:31:53,360 --> 00:31:55,039
those changes and you know any

1105
00:31:54,399 --> 00:31:56,879
subsequent

1106
00:31:55,039 --> 00:31:58,720
you know process tree or behaviors that

1107
00:31:56,880 --> 00:32:00,080
followed on from those victim processes

1108
00:31:58,720 --> 00:32:01,760
and this really puts us in a good place

1109
00:32:00,080 --> 00:32:03,279
to answer that original question of

1110
00:32:01,760 --> 00:32:04,640
you know looking at a behavior looking

1111
00:32:03,279 --> 00:32:05,840
at a threat group you know what can we

1112
00:32:04,640 --> 00:32:07,679
do about it you know

1113
00:32:05,840 --> 00:32:10,000
in this case we can document you know

1114
00:32:07,679 --> 00:32:10,480
the the the data sources that are you

1115
00:32:10,000 --> 00:32:13,200
know

1116
00:32:10,480 --> 00:32:13,760
directly related to the executions

1117
00:32:13,200 --> 00:32:15,519
behavior

1118
00:32:13,760 --> 00:32:17,039
but also all of the surrounding context

1119
00:32:15,519 --> 00:32:18,960
and all the additional relationships

1120
00:32:17,039 --> 00:32:20,879
that like matt said initially during the

1121
00:32:18,960 --> 00:32:22,320
the introduction enables us to you know

1122
00:32:20,880 --> 00:32:23,840
pull those threads and actually

1123
00:32:22,320 --> 00:32:25,918
exploit our home food advantage and

1124
00:32:23,840 --> 00:32:27,039
understand you know if an adversary is a

1125
00:32:25,919 --> 00:32:28,480
step foot in our house

1126
00:32:27,039 --> 00:32:29,919
these are all of the triggers that

1127
00:32:28,480 --> 00:32:30,480
they're going to hit and all the

1128
00:32:29,919 --> 00:32:32,480
different

1129
00:32:30,480 --> 00:32:33,919
cords that we can pull to actually find

1130
00:32:32,480 --> 00:32:34,960
where they are and you know not only

1131
00:32:33,919 --> 00:32:36,159
where they are now but

1132
00:32:34,960 --> 00:32:38,640
where they've been and where they're

1133
00:32:36,159 --> 00:32:40,399
going uh so big question like i said

1134
00:32:38,640 --> 00:32:42,080
uh we're very excited about this work

1135
00:32:40,399 --> 00:32:43,120
this is something we're interested to

1136
00:32:42,080 --> 00:32:44,879
get out in the community

1137
00:32:43,120 --> 00:32:46,239
uh very similar to sub techniques uh

1138
00:32:44,880 --> 00:32:47,919
we're going to publish it

1139
00:32:46,240 --> 00:32:49,360
um you know so that the community can

1140
00:32:47,919 --> 00:32:51,440
take a look provide feedback

1141
00:32:49,360 --> 00:32:53,360
but also provide contributions in this

1142
00:32:51,440 --> 00:32:55,200
case you know we're looking at a

1143
00:32:53,360 --> 00:32:56,879
one technique and one particular

1144
00:32:55,200 --> 00:32:58,720
procedure for technique but this is the

1145
00:32:56,880 --> 00:33:00,159
same concepts and you know exploiting

1146
00:32:58,720 --> 00:33:01,200
these relationships and the context

1147
00:33:00,159 --> 00:33:02,880
between data sources

1148
00:33:01,200 --> 00:33:04,240
is more broad than this you know it's

1149
00:33:02,880 --> 00:33:05,440
you know other techniques

1150
00:33:04,240 --> 00:33:07,120
uh within persistence and other

1151
00:33:05,440 --> 00:33:07,760
techniques across the entire platform as

1152
00:33:07,120 --> 00:33:09,518
well as

1153
00:33:07,760 --> 00:33:11,120
um you know other other technologies

1154
00:33:09,519 --> 00:33:11,519
looking at you know this is very windows

1155
00:33:11,120 --> 00:33:13,039
based

1156
00:33:11,519 --> 00:33:14,720
but how does this apply to linux how

1157
00:33:13,039 --> 00:33:15,600
does this apply to mac how does it apply

1158
00:33:14,720 --> 00:33:16,960
to cloud

1159
00:33:15,600 --> 00:33:18,719
uh we need to make sure that you know

1160
00:33:16,960 --> 00:33:20,159
all the bridges between you know

1161
00:33:18,720 --> 00:33:21,600
all the content and attack in terms of

1162
00:33:20,159 --> 00:33:23,120
what we're telling you are the right

1163
00:33:21,600 --> 00:33:25,039
places to look for adversaries

1164
00:33:23,120 --> 00:33:26,479
are actually being able to quickly and

1165
00:33:25,039 --> 00:33:28,480
efficiently translate

1166
00:33:26,480 --> 00:33:29,919
to you know how ss practitioners how

1167
00:33:28,480 --> 00:33:33,679
we're actually collecting this data

1168
00:33:29,919 --> 00:33:34,480
in our environment uh so conclusions uh

1169
00:33:33,679 --> 00:33:35,679
here like i said

1170
00:33:34,480 --> 00:33:38,159
it should be pretty obvious at this

1171
00:33:35,679 --> 00:33:38,559
point but you know modeling our data is

1172
00:33:38,159 --> 00:33:40,559
you know

1173
00:33:38,559 --> 00:33:42,000
opening up a whole new lens to all the

1174
00:33:40,559 --> 00:33:43,918
context of you know not just

1175
00:33:42,000 --> 00:33:45,519
um you know what data is being generated

1176
00:33:43,919 --> 00:33:46,799
but how all that data is connected and

1177
00:33:45,519 --> 00:33:47,200
all the different places that we can

1178
00:33:46,799 --> 00:33:48,879
look

1179
00:33:47,200 --> 00:33:50,720
to actually find that data and most

1180
00:33:48,880 --> 00:33:51,120
importantly what this enables to do is

1181
00:33:50,720 --> 00:33:52,880
not

1182
00:33:51,120 --> 00:33:54,000
look at you know indiscreet uh discrete

1183
00:33:52,880 --> 00:33:55,279
data points and you know look at

1184
00:33:54,000 --> 00:33:56,559
everything one at a time

1185
00:33:55,279 --> 00:33:58,240
but also look at the bigger picture

1186
00:33:56,559 --> 00:33:59,600
start drawing correlation between events

1187
00:33:58,240 --> 00:34:01,200
and actually take advantage of

1188
00:33:59,600 --> 00:34:02,959
you know you know like jose was saying

1189
00:34:01,200 --> 00:34:04,159
the relationship between processes and

1190
00:34:02,960 --> 00:34:05,760
users and files

1191
00:34:04,159 --> 00:34:07,360
and how that actually relates back to

1192
00:34:05,760 --> 00:34:08,000
the behaviors that you know attack is

1193
00:34:07,360 --> 00:34:09,759
telling us

1194
00:34:08,000 --> 00:34:11,199
that the right actors are um you know

1195
00:34:09,760 --> 00:34:13,599
executing and the behaviors that we

1196
00:34:11,199 --> 00:34:15,040
should care about

1197
00:34:13,599 --> 00:34:16,800
i think we have you know maybe maybe

1198
00:34:15,040 --> 00:34:18,159
come for a couple questions but before

1199
00:34:16,800 --> 00:34:19,679
uh we jump to that i definitely will

1200
00:34:18,159 --> 00:34:22,000
just take another second to you know

1201
00:34:19,679 --> 00:34:23,520
thank sans and everyone for listening

1202
00:34:22,000 --> 00:34:25,280
i'll leave that up that's our contact

1203
00:34:23,520 --> 00:34:26,320
information as well as some links um

1204
00:34:25,280 --> 00:34:28,560
that we used

1205
00:34:26,320 --> 00:34:29,919
for this presentation uh so they had

1206
00:34:28,560 --> 00:34:31,759
great great help from you know

1207
00:34:29,918 --> 00:34:33,520
red canary atomic red team as well as

1208
00:34:31,760 --> 00:34:36,320
the the osun project calc

1209
00:34:33,520 --> 00:34:37,520
mordor and you know anyone else i think

1210
00:34:36,320 --> 00:34:39,359
i covered them all there but

1211
00:34:37,520 --> 00:34:40,480
yeah definitely a big big shout out to

1212
00:34:39,359 --> 00:34:42,078
all those projects really made this

1213
00:34:40,480 --> 00:34:42,960
process really easy and

1214
00:34:42,079 --> 00:34:44,720
definitely looking forward to

1215
00:34:42,960 --> 00:34:45,839
collaborating with you know you guys the

1216
00:34:44,719 --> 00:34:47,359
community

1217
00:34:45,839 --> 00:34:49,040
going forward on you know is this a good

1218
00:34:47,359 --> 00:34:50,960
idea how do we refine this and how do we

1219
00:34:49,040 --> 00:34:53,440
make attack you know more

1220
00:34:50,960 --> 00:34:54,159
usable as practitioners yep thank you

1221
00:34:53,440 --> 00:35:03,680
very much for

1222
00:34:54,159 --> 00:35:03,680
your time

