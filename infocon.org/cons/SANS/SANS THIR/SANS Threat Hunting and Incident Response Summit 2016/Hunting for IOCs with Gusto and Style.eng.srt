1
00:00:15,320 --> 00:00:21,439
thank you so much Rob I will have to buy

2
00:00:17,580 --> 00:00:21,439
you that beer that we agree in now so

3
00:00:21,619 --> 00:00:28,590
it's alright it's alright you wonder you

4
00:00:24,750 --> 00:00:31,080
won the coin so well my name is Matt

5
00:00:28,590 --> 00:00:32,430
Valenzuela and thanks to Robin and to

6
00:00:31,080 --> 00:00:35,519
the rest of stands for putting together

7
00:00:32,430 --> 00:00:36,780
this awesome awesome summit for the next

8
00:00:35,520 --> 00:00:40,860
20 minutes this is a short presentation

9
00:00:36,780 --> 00:00:42,780
I'm gonna try to summarize a very

10
00:00:40,860 --> 00:00:45,180
specific solution to a very specific

11
00:00:42,780 --> 00:00:46,739
problem right and hopefully you can get

12
00:00:45,180 --> 00:00:49,469
away something from this something

13
00:00:46,739 --> 00:00:51,180
useful and this is a line to the sands

14
00:00:49,469 --> 00:00:53,789
motor right just get something that you

15
00:00:51,180 --> 00:00:55,320
can use as soon as you get back to your

16
00:00:53,789 --> 00:00:57,360
office right to get back to work

17
00:00:55,320 --> 00:01:00,030
tomorrow and and play with something

18
00:00:57,360 --> 00:01:01,769
that you have you have seen here and you

19
00:01:00,030 --> 00:01:04,320
have observe probably during the the

20
00:01:01,770 --> 00:01:06,840
last few of tall so since we started the

21
00:01:04,319 --> 00:01:08,130
whole summit with a band be sure talking

22
00:01:06,840 --> 00:01:10,710
about you know squeal and some of the

23
00:01:08,130 --> 00:01:12,990
awesome stuff that he's been doing that

24
00:01:10,710 --> 00:01:15,869
when you mix when you get like a coder

25
00:01:12,990 --> 00:01:18,140
right a pen tester a forensics guy and

26
00:01:15,869 --> 00:01:20,759
an IR guy working together in a sock

27
00:01:18,140 --> 00:01:22,890
something awesome habits all right

28
00:01:20,759 --> 00:01:24,840
you've got the power we've seen this

29
00:01:22,890 --> 00:01:27,420
with Google and their awesome projects

30
00:01:24,840 --> 00:01:30,329
as well there and how to pronounce that

31
00:01:27,420 --> 00:01:33,090
your whatever grr right and all of those

32
00:01:30,329 --> 00:01:34,798
awesome tools because we have we have

33
00:01:33,090 --> 00:01:36,570
issues right we know these issues we

34
00:01:34,799 --> 00:01:38,430
know how to solve them right so if you

35
00:01:36,570 --> 00:01:40,649
have some coding skills you can quickly

36
00:01:38,430 --> 00:01:42,360
put that together and might be quick and

37
00:01:40,650 --> 00:01:44,220
dirty right that code might might hurt

38
00:01:42,360 --> 00:01:46,229
when you actually see it but it works

39
00:01:44,220 --> 00:01:50,399
right so this is the story I want to I

40
00:01:46,229 --> 00:01:51,630
want to share with you today briefly so

41
00:01:50,399 --> 00:01:53,250
a little bit about me

42
00:01:51,630 --> 00:01:55,350
he already mentioned pretty much

43
00:01:53,250 --> 00:01:57,000
everything what I'm a science instructor

44
00:01:55,350 --> 00:02:00,509
I also lead the instant response on

45
00:01:57,000 --> 00:02:02,640
forensics team for Intel security and I

46
00:02:00,509 --> 00:02:05,189
have this problem I am addicted to gr

47
00:02:02,640 --> 00:02:08,818
certs right so I don't know how to stop

48
00:02:05,189 --> 00:02:11,160
and I've been also collecting some

49
00:02:08,818 --> 00:02:13,440
titles right for some some time like

50
00:02:11,160 --> 00:02:15,120
penetration tester instant respond

51
00:02:13,440 --> 00:02:18,060
channel is forensic analyst but I still

52
00:02:15,120 --> 00:02:21,240
have to add that one chaos specialist I

53
00:02:18,060 --> 00:02:24,000
love that one oh but yeah I've been

54
00:02:21,240 --> 00:02:25,290
doing all of this for for a while so

55
00:02:24,000 --> 00:02:25,800
when you've been doing all this for a

56
00:02:25,290 --> 00:02:28,709
while

57
00:02:25,800 --> 00:02:30,450
you know and you've been coding a little

58
00:02:28,710 --> 00:02:32,010
bit I'm a Spaniard some a bit lacy

59
00:02:30,450 --> 00:02:36,000
right so I want to code like something

60
00:02:32,010 --> 00:02:37,679
quick and dirty and so when you you've

61
00:02:36,000 --> 00:02:39,480
been doing this for a while you come up

62
00:02:37,680 --> 00:02:41,310
with solutions right and all you

63
00:02:39,480 --> 00:02:44,730
probably need is just a bit of time to

64
00:02:41,310 --> 00:02:49,050
do actual work and anyone here from the

65
00:02:44,730 --> 00:02:50,369
Northeast probably you know from from my

66
00:02:49,050 --> 00:02:55,080
accent you can tell I haven't been here

67
00:02:50,370 --> 00:02:57,420
for a long long time but and I I live in

68
00:02:55,080 --> 00:02:59,010
Northeast New York area and you probably

69
00:02:57,420 --> 00:03:01,589
remember I think was like couple of

70
00:02:59,010 --> 00:03:04,010
years ago the Snowmageddon right thing

71
00:03:01,590 --> 00:03:06,210
that ended up being a little mageddon

72
00:03:04,010 --> 00:03:08,220
well that was pretty much the the thing

73
00:03:06,210 --> 00:03:09,810
right it wasn't that bad but he actually

74
00:03:08,220 --> 00:03:11,640
gave me like two days where you know

75
00:03:09,810 --> 00:03:13,230
people shut down the city and no trains

76
00:03:11,640 --> 00:03:15,480
nothing so you couldn't commute into an

77
00:03:13,230 --> 00:03:18,149
office and this is how you define work

78
00:03:15,480 --> 00:03:20,310
right that's how I define work the

79
00:03:18,150 --> 00:03:23,130
absence of going to the to the office so

80
00:03:20,310 --> 00:03:24,810
you can actually do stuff so it was like

81
00:03:23,130 --> 00:03:26,790
you know now I'm gonna I'm gonna be able

82
00:03:24,810 --> 00:03:29,010
to work on something that I wanted to

83
00:03:26,790 --> 00:03:31,500
work specifically for a project I was I

84
00:03:29,010 --> 00:03:33,299
was working working on and this is a

85
00:03:31,500 --> 00:03:35,340
challenge that I had right I was working

86
00:03:33,300 --> 00:03:37,290
with a customer and you've probably seen

87
00:03:35,340 --> 00:03:39,239
these might resonate with what you have

88
00:03:37,290 --> 00:03:42,929
in your own organizations large

89
00:03:39,239 --> 00:03:45,870
organization with 50,000 plus endpoints

90
00:03:42,930 --> 00:03:47,610
but we're managed by a central solution

91
00:03:45,870 --> 00:03:49,470
right in this case I mentioned it's the

92
00:03:47,610 --> 00:03:51,120
magg of EPO agent but it could be

93
00:03:49,470 --> 00:03:54,720
anything else right in this case this is

94
00:03:51,120 --> 00:03:56,910
what they have and they had like a you

95
00:03:54,720 --> 00:03:58,769
know a large large environment and no

96
00:03:56,910 --> 00:04:01,620
forensics in place so essentially the

97
00:03:58,769 --> 00:04:04,400
guys the field services guys that would

98
00:04:01,620 --> 00:04:06,870
be just running around running antivirus

99
00:04:04,400 --> 00:04:08,519
scans when you see that a machine was

100
00:04:06,870 --> 00:04:10,680
infected with something what they would

101
00:04:08,519 --> 00:04:13,950
do run another scan and over antivirus

102
00:04:10,680 --> 00:04:14,790
scan and if they found nothing anything

103
00:04:13,950 --> 00:04:16,649
what they do next

104
00:04:14,790 --> 00:04:17,700
they run another scan again right

105
00:04:16,649 --> 00:04:19,168
obviously because you're gonna find

106
00:04:17,700 --> 00:04:24,240
something at the third scan or fourth

107
00:04:19,168 --> 00:04:25,680
scan maybe maybe not so what happens in

108
00:04:24,240 --> 00:04:26,630
the end right if that machine keeps

109
00:04:25,680 --> 00:04:28,490
reinfecting

110
00:04:26,630 --> 00:04:31,460
you just reimage the machine and you

111
00:04:28,490 --> 00:04:33,770
just bring a new one is that that just

112
00:04:31,460 --> 00:04:35,359
resonate with maybe what happens in any

113
00:04:33,770 --> 00:04:37,219
of your environments what are you

114
00:04:35,360 --> 00:04:39,410
learning from that absolutely nothing

115
00:04:37,220 --> 00:04:41,950
right so this is the the can of the

116
00:04:39,410 --> 00:04:44,210
environment we were dealing with and

117
00:04:41,950 --> 00:04:46,880
containment remediation pretty much was

118
00:04:44,210 --> 00:04:48,620
exactly the same thing so how do you

119
00:04:46,880 --> 00:04:51,070
know what's going on with those systems

120
00:04:48,620 --> 00:04:53,480
right this is like the can of the

121
00:04:51,070 --> 00:04:55,790
typical day average day for a stock

122
00:04:53,480 --> 00:04:58,700
analyst you see something like this this

123
00:04:55,790 --> 00:05:01,100
is say an alert for a system that it's

124
00:04:58,700 --> 00:05:02,750
identified as suspicious because it's

125
00:05:01,100 --> 00:05:05,120
going to an IP address that has been

126
00:05:02,750 --> 00:05:06,380
collected in you know this project

127
00:05:05,120 --> 00:05:08,540
collective intelligence framework

128
00:05:06,380 --> 00:05:11,120
awesome open source project that brings

129
00:05:08,540 --> 00:05:14,840
feeds from different different places

130
00:05:11,120 --> 00:05:16,400
right open source sources and if you see

131
00:05:14,840 --> 00:05:20,359
that this machine is connecting to this

132
00:05:16,400 --> 00:05:22,159
over IP address or domain that is deemed

133
00:05:20,360 --> 00:05:25,010
as suspicious you want to know what's

134
00:05:22,160 --> 00:05:26,810
going on right but what if the antivirus

135
00:05:25,010 --> 00:05:28,159
says the endpoint but what have you half

136
00:05:26,810 --> 00:05:29,810
of the endpoint says there's nothing

137
00:05:28,160 --> 00:05:31,460
wrong with this system why is this

138
00:05:29,810 --> 00:05:34,010
machine connected to an IP address in

139
00:05:31,460 --> 00:05:35,989
Russia or Ukraine or Brazil if I don't

140
00:05:34,010 --> 00:05:37,370
have any business with this folks right

141
00:05:35,990 --> 00:05:40,700
why is that happening

142
00:05:37,370 --> 00:05:41,720
you need additional context right and if

143
00:05:40,700 --> 00:05:44,150
you find that there is something

144
00:05:41,720 --> 00:05:46,790
malicious on that box how is that

145
00:05:44,150 --> 00:05:48,530
impacting my business do you have any

146
00:05:46,790 --> 00:05:50,480
information to know what's the the

147
00:05:48,530 --> 00:05:52,609
response strategy and we've had an

148
00:05:50,480 --> 00:05:54,770
awesome talk from from Matt right from

149
00:05:52,610 --> 00:05:56,720
Google mentioning mentioning this Rob

150
00:05:54,770 --> 00:05:58,820
Lee also touched on on that how

151
00:05:56,720 --> 00:06:01,520
important is to know where are you

152
00:05:58,820 --> 00:06:04,610
facing were you dealing with in terms of

153
00:06:01,520 --> 00:06:08,479
strategy we've seen this summer 2012

154
00:06:04,610 --> 00:06:10,460
largest IR we saw after that date 30,000

155
00:06:08,480 --> 00:06:13,250
machines destroyed in the Middle East

156
00:06:10,460 --> 00:06:15,859
largest oil and gas company in the world

157
00:06:13,250 --> 00:06:17,720
you probably remember this thirty

158
00:06:15,860 --> 00:06:22,190
thousand machines destroyed as a result

159
00:06:17,720 --> 00:06:23,860
of a bad containment so would you be

160
00:06:22,190 --> 00:06:26,330
tipping off the attacker if you're just

161
00:06:23,860 --> 00:06:27,350
disconnecting machines here and there

162
00:06:26,330 --> 00:06:29,630
pulling off the cable

163
00:06:27,350 --> 00:06:31,460
maybe attacker just change the tactic or

164
00:06:29,630 --> 00:06:34,100
take retaliation and destroy the whole

165
00:06:31,460 --> 00:06:36,200
environment so that that becomes

166
00:06:34,100 --> 00:06:39,530
relevant right when you do when you do

167
00:06:36,200 --> 00:06:39,950
IR so that's really important so we had

168
00:06:39,530 --> 00:06:41,630
to

169
00:06:39,950 --> 00:06:44,000
type a solution like quick and dirty and

170
00:06:41,630 --> 00:06:46,790
what I was thinking about this was like

171
00:06:44,000 --> 00:06:49,910
okay what can I do that I can bring into

172
00:06:46,790 --> 00:06:54,670
the office into just two days and with

173
00:06:49,910 --> 00:06:57,500
what we have built some basic triage

174
00:06:54,670 --> 00:06:59,530
forensics one forensics like collection

175
00:06:57,500 --> 00:07:01,700
right forensic collection life response

176
00:06:59,530 --> 00:07:04,159
capabilities into this environment that

177
00:07:01,700 --> 00:07:05,719
is highly highly immature

178
00:07:04,160 --> 00:07:08,240
it must be something that must be

179
00:07:05,720 --> 00:07:11,600
crossed cross-platform must support

180
00:07:08,240 --> 00:07:13,910
automated response I should be able to

181
00:07:11,600 --> 00:07:16,250
wrap tools that are already out there

182
00:07:13,910 --> 00:07:18,110
like sis internal tools you don't have

183
00:07:16,250 --> 00:07:19,520
to reinvent the wheel there are awesome

184
00:07:18,110 --> 00:07:21,080
tools out there that will collect all

185
00:07:19,520 --> 00:07:23,060
the information that you need from auto

186
00:07:21,080 --> 00:07:24,440
runs for instance or things like that

187
00:07:23,060 --> 00:07:27,800
you don't have to write that from

188
00:07:24,440 --> 00:07:30,410
scratch just reuse it and also it should

189
00:07:27,800 --> 00:07:32,030
give me the opportunity to scan for

190
00:07:30,410 --> 00:07:34,370
indicators of compromised right the

191
00:07:32,030 --> 00:07:36,380
thread handy so how do you prototype

192
00:07:34,370 --> 00:07:39,140
something like that quick and dirty

193
00:07:36,380 --> 00:07:41,360
without actually having to use or deploy

194
00:07:39,140 --> 00:07:43,130
an additional agent right the Google

195
00:07:41,360 --> 00:07:45,470
grab the response project is an awesome

196
00:07:43,130 --> 00:07:47,090
project but for this particular case I

197
00:07:45,470 --> 00:07:50,330
couldn't deploy an additional additional

198
00:07:47,090 --> 00:07:52,969
agent right so how can I do this in a

199
00:07:50,330 --> 00:07:55,669
short amount of of time so you know

200
00:07:52,970 --> 00:07:57,680
Python allows me to do this I mentioned

201
00:07:55,670 --> 00:07:59,780
before I'm a lazy coder right so python

202
00:07:57,680 --> 00:08:01,550
is awesome for that lots of examples out

203
00:07:59,780 --> 00:08:04,460
there are lots of books out there lots

204
00:08:01,550 --> 00:08:07,850
of security dedicated libraries and

205
00:08:04,460 --> 00:08:09,320
snippets that you can you can use it

206
00:08:07,850 --> 00:08:11,750
also supports the idea of building a

207
00:08:09,320 --> 00:08:14,960
restful api which is awesome to design

208
00:08:11,750 --> 00:08:18,380
client and server services right you can

209
00:08:14,960 --> 00:08:21,020
also use something like py installer to

210
00:08:18,380 --> 00:08:23,540
free start to package your Python code

211
00:08:21,020 --> 00:08:25,729
into a single file a portable executable

212
00:08:23,540 --> 00:08:28,100
a binary that now you can push to your

213
00:08:25,730 --> 00:08:30,370
endpoints or use you know using in your

214
00:08:28,100 --> 00:08:33,349
Windows environment so really awesome

215
00:08:30,370 --> 00:08:35,330
even better it's named after the awesome

216
00:08:33,349 --> 00:08:39,080
Monty Python so what can be better than

217
00:08:35,330 --> 00:08:41,630
that all right so what do we need to

218
00:08:39,080 --> 00:08:43,340
automate we know of this everyone here

219
00:08:41,630 --> 00:08:45,260
in this room we've touched on some of

220
00:08:43,340 --> 00:08:46,820
those things that you have to collect

221
00:08:45,260 --> 00:08:50,000
some of the things you have to hand for

222
00:08:46,820 --> 00:08:51,410
so for instance the guys from our end

223
00:08:50,000 --> 00:08:53,930
game has been they have been mentioned

224
00:08:51,410 --> 00:08:57,410
in this things we have to collect

225
00:08:53,930 --> 00:08:58,699
to examine the machines and taking the

226
00:08:57,410 --> 00:09:01,640
challenge I probably mentioned in the

227
00:08:58,700 --> 00:09:04,490
beginning how do i define threat hunting

228
00:09:01,640 --> 00:09:07,130
or more appropriately

229
00:09:04,490 --> 00:09:09,320
how do I use Fred Han team obviously we

230
00:09:07,130 --> 00:09:11,330
would use it proactively to search for

231
00:09:09,320 --> 00:09:13,399
the bad guys the attackers in our

232
00:09:11,330 --> 00:09:16,130
infrastructure but also something very

233
00:09:13,399 --> 00:09:18,589
important that I just touched on the

234
00:09:16,130 --> 00:09:20,149
idea of scoping the incident right once

235
00:09:18,589 --> 00:09:22,250
you have found something suspicious in a

236
00:09:20,149 --> 00:09:23,660
machine you want to grab that binary you

237
00:09:22,250 --> 00:09:25,730
want to see what's going on with that

238
00:09:23,660 --> 00:09:27,860
with a binary and now create some kind

239
00:09:25,730 --> 00:09:29,810
of rule that will allow you to sweep

240
00:09:27,860 --> 00:09:32,660
your environment and see if there is

241
00:09:29,810 --> 00:09:34,760
anything that is suspicious in any other

242
00:09:32,660 --> 00:09:36,860
system in your environment so you can

243
00:09:34,760 --> 00:09:39,350
scope what would be the impact what's

244
00:09:36,860 --> 00:09:42,860
what's the attackers TTP's right this is

245
00:09:39,350 --> 00:09:45,350
something that no one has seen my before

246
00:09:42,860 --> 00:09:49,339
is this something that could be targeted

247
00:09:45,350 --> 00:09:51,380
so now you can define a gooda scope and

248
00:09:49,339 --> 00:09:54,649
then move into containment eradication

249
00:09:51,380 --> 00:09:56,930
and lessons learned again with the era

250
00:09:54,649 --> 00:09:58,850
I'm not going to touch a lot on this a

251
00:09:56,930 --> 00:09:59,930
lot of things as we mentioned I just

252
00:09:58,850 --> 00:10:02,540
want to add something that probably

253
00:09:59,930 --> 00:10:04,849
hasn't been mentioned before on this

254
00:10:02,540 --> 00:10:07,400
repository he added rules anyone knows

255
00:10:04,850 --> 00:10:09,500
the other rules will come some of you

256
00:10:07,400 --> 00:10:11,209
cool it's it's awesome right it's a

257
00:10:09,500 --> 00:10:13,730
great repository it's actually run by a

258
00:10:11,209 --> 00:10:15,709
friend of mine Spain this folds half

259
00:10:13,730 --> 00:10:19,339
also twitter account yeah da rules comm

260
00:10:15,709 --> 00:10:21,130
sorry yeah rules on Twitter so follow

261
00:10:19,339 --> 00:10:23,600
them go to their repository they have a

262
00:10:21,130 --> 00:10:26,660
huge collection of the errant rules on

263
00:10:23,600 --> 00:10:29,029
github that might be something you can

264
00:10:26,660 --> 00:10:30,860
use straight away in your environment

265
00:10:29,029 --> 00:10:33,740
and you can thing about yarra is that

266
00:10:30,860 --> 00:10:35,930
you can call it call these libraries

267
00:10:33,740 --> 00:10:38,209
from your own Python code so you can

268
00:10:35,930 --> 00:10:42,260
write your own code and now you run your

269
00:10:38,209 --> 00:10:44,209
scans on the endpoints using these

270
00:10:42,260 --> 00:10:47,089
libraries and the scanning memory and

271
00:10:44,209 --> 00:10:49,939
scanning also for artifacts on on disk

272
00:10:47,089 --> 00:10:52,850
right and you may have been in this

273
00:10:49,940 --> 00:10:54,380
situation before you may need to deploy

274
00:10:52,850 --> 00:10:55,910
a security tool that you want right and

275
00:10:54,380 --> 00:10:57,260
it's like oh I need to deploy an

276
00:10:55,910 --> 00:10:59,779
additional agent and you have to

277
00:10:57,260 --> 00:11:02,329
management and sometimes this this is

278
00:10:59,779 --> 00:11:03,790
what happens right when you say you want

279
00:11:02,329 --> 00:11:05,900
to deploy an additional agent or

280
00:11:03,790 --> 00:11:07,490
best-case scenario it might take you

281
00:11:05,900 --> 00:11:09,379
like sometime between three more

282
00:11:07,490 --> 00:11:12,110
for six months to get that approved

283
00:11:09,379 --> 00:11:15,350
because now people have to figure out

284
00:11:12,110 --> 00:11:18,319
whether that's gonna make the Machine it

285
00:11:15,350 --> 00:11:21,139
slow or what's gonna be the impact on on

286
00:11:18,319 --> 00:11:23,059
that so what is the solution that we

287
00:11:21,139 --> 00:11:25,819
came up with this is how I call the

288
00:11:23,059 --> 00:11:27,529
project it's called rust Riyadh or and I

289
00:11:25,819 --> 00:11:29,899
know it sounds weird comes from the

290
00:11:27,529 --> 00:11:32,089
Spanish from Hunter right so hunter

291
00:11:29,899 --> 00:11:35,149
rusted or bit of the elite thing

292
00:11:32,089 --> 00:11:38,540
modifying d with the two that's the

293
00:11:35,149 --> 00:11:39,740
whole deal maybe we can do a poll if you

294
00:11:38,540 --> 00:11:42,679
want to change the name something like

295
00:11:39,740 --> 00:11:45,589
that but it's it's open source right so

296
00:11:42,679 --> 00:11:46,970
the the code is out there if Bandar sure

297
00:11:45,589 --> 00:11:48,259
had actually to apologize for the

298
00:11:46,970 --> 00:11:49,850
quality of the code I don't know what to

299
00:11:48,259 --> 00:11:52,699
say myself I would have to say I will

300
00:11:49,850 --> 00:11:54,290
have to pay you to actually use this as

301
00:11:52,699 --> 00:11:56,660
a compensation or something like that

302
00:11:54,290 --> 00:11:58,069
but you know it's it's out there you can

303
00:11:56,660 --> 00:12:00,139
be use it I have the binary somebody

304
00:11:58,069 --> 00:12:01,759
compiled for you if you don't trust my

305
00:12:00,139 --> 00:12:04,819
binaries which is a good thing to do

306
00:12:01,759 --> 00:12:07,850
you can you can compile yourself but

307
00:12:04,819 --> 00:12:10,069
essentially uses a RESTful API so you

308
00:12:07,850 --> 00:12:12,139
can do your scans and report back to the

309
00:12:10,069 --> 00:12:14,329
to the server it's easy to integrate

310
00:12:12,139 --> 00:12:15,679
with any kind of tool that you have on

311
00:12:14,329 --> 00:12:18,019
the endpoint so if you already have an

312
00:12:15,679 --> 00:12:20,329
agent that can kick off a process or

313
00:12:18,019 --> 00:12:23,529
kick off a binary you can you can use

314
00:12:20,329 --> 00:12:25,849
that that wraps

315
00:12:23,529 --> 00:12:31,579
certain third-party tools so I'll show

316
00:12:25,850 --> 00:12:33,139
you some demos if this works so the

317
00:12:31,579 --> 00:12:34,790
camera functionality in version zero

318
00:12:33,139 --> 00:12:37,670
seven I made it to zero seven likes

319
00:12:34,790 --> 00:12:41,449
wheel I'm so pumped I'm a huge fan of

320
00:12:37,670 --> 00:12:44,149
squeal so we are we have Yarra disk er

321
00:12:41,449 --> 00:12:46,609
mem mem dampen and triage so you can

322
00:12:44,149 --> 00:12:49,699
scan for iosys in in memory you can scan

323
00:12:46,610 --> 00:12:51,259
for iOS's on the disk poorer memory time

324
00:12:49,699 --> 00:12:54,049
so when you see that our system is

325
00:12:51,259 --> 00:12:55,699
behaving suspiciously you can just get a

326
00:12:54,049 --> 00:12:58,040
memory time McNelly across the network

327
00:12:55,699 --> 00:13:00,709
using wimpy mmm it's also embedded into

328
00:12:58,040 --> 00:13:03,139
the recall google project and you can

329
00:13:00,709 --> 00:13:07,518
also triage the endpoints and get

330
00:13:03,139 --> 00:13:09,920
information out of outlet so well this

331
00:13:07,519 --> 00:13:11,839
is just a small diagram on how you would

332
00:13:09,920 --> 00:13:15,139
do that essentially what you need is two

333
00:13:11,839 --> 00:13:17,120
folders I'd read only share where you

334
00:13:15,139 --> 00:13:18,630
have all the binaries all the tools like

335
00:13:17,120 --> 00:13:20,670
Asus internal tools everything

336
00:13:18,630 --> 00:13:23,910
run on the endpoint and then I write

337
00:13:20,670 --> 00:13:25,800
only share where you have where you dump

338
00:13:23,910 --> 00:13:27,660
all the results of that triage process

339
00:13:25,800 --> 00:13:32,219
right so all the artifacts are going to

340
00:13:27,660 --> 00:13:34,020
be written to that share on your network

341
00:13:32,220 --> 00:13:35,880
and also there is another piece which is

342
00:13:34,020 --> 00:13:38,670
a year a server that is going to be used

343
00:13:35,880 --> 00:13:42,810
to pull the error rules and also to

344
00:13:38,670 --> 00:13:45,240
write the results of the ers scans via a

345
00:13:42,810 --> 00:13:47,819
restful api so something that you can

346
00:13:45,240 --> 00:13:49,440
integrate a straightaway now the next

347
00:13:47,820 --> 00:13:51,420
few slides just for you as a reference

348
00:13:49,440 --> 00:13:53,430
right I'm not gonna read these but yeah

349
00:13:51,420 --> 00:13:56,430
since we're gonna share the slides with

350
00:13:53,430 --> 00:13:58,739
you you can see how to invoke this it's

351
00:13:56,430 --> 00:14:00,599
all command line based why because

352
00:13:58,740 --> 00:14:03,660
command line is sexy right it's cool for

353
00:14:00,600 --> 00:14:06,300
us geeks and it's just based on

354
00:14:03,660 --> 00:14:08,459
parameters so it's very flexible very

355
00:14:06,300 --> 00:14:10,380
modular and it allows you to just modify

356
00:14:08,460 --> 00:14:13,290
the behavior of a tool just by adding

357
00:14:10,380 --> 00:14:18,990
different parameters so this is just

358
00:14:13,290 --> 00:14:26,490
like a quick demo at one minute video it

359
00:14:18,990 --> 00:14:28,980
works where you can see a restaurateur

360
00:14:26,490 --> 00:14:30,960
we're gonna do a triage so we can uh

361
00:14:28,980 --> 00:14:34,380
from the command line get information

362
00:14:30,960 --> 00:14:37,740
out of our machine right and we're gonna

363
00:14:34,380 --> 00:14:39,540
use the triage module and these two

364
00:14:37,740 --> 00:14:42,060
folders share folders one is the right

365
00:14:39,540 --> 00:14:44,339
only folder where there's going to be

366
00:14:42,060 --> 00:14:45,989
created a particular folder for each of

367
00:14:44,340 --> 00:14:48,870
the machines that you investigate with a

368
00:14:45,990 --> 00:14:51,930
host name and then each of them inside

369
00:14:48,870 --> 00:14:53,370
that folder you will have another

370
00:14:51,930 --> 00:14:55,260
specific folder for each of the

371
00:14:53,370 --> 00:14:57,420
timestamps where that has been executed

372
00:14:55,260 --> 00:15:01,650
right and inside those folders you will

373
00:14:57,420 --> 00:15:03,150
get the results so this is from the

374
00:15:01,650 --> 00:15:05,430
command-line right you can see all the

375
00:15:03,150 --> 00:15:07,680
different tools that are being being run

376
00:15:05,430 --> 00:15:09,540
or executed on the endpoint and all

377
00:15:07,680 --> 00:15:11,670
different timestamps where this was

378
00:15:09,540 --> 00:15:14,910
executed and you have you know just a

379
00:15:11,670 --> 00:15:18,000
sample of the output right just Windows

380
00:15:14,910 --> 00:15:20,100
commands like are or the DNS cache any

381
00:15:18,000 --> 00:15:22,080
kind of information you wanna you want

382
00:15:20,100 --> 00:15:24,210
to get from from those from those

383
00:15:22,080 --> 00:15:25,350
systems right no rocket science here

384
00:15:24,210 --> 00:15:27,600
something that you probably have already

385
00:15:25,350 --> 00:15:30,000
automated in your environment maybe not

386
00:15:27,600 --> 00:15:32,300
right but it's something that I found

387
00:15:30,000 --> 00:15:34,190
useful in different

388
00:15:32,300 --> 00:15:35,949
mints and I thought I wanted to you know

389
00:15:34,190 --> 00:15:39,440
to share with with you guys

390
00:15:35,950 --> 00:15:41,720
so something also you can do is to

391
00:15:39,440 --> 00:15:44,870
modify some of the batch scripts that I

392
00:15:41,720 --> 00:15:46,970
already have on the read only share so

393
00:15:44,870 --> 00:15:49,160
if you want to execute any kind of

394
00:15:46,970 --> 00:15:51,380
Windows command native commands with

395
00:15:49,160 --> 00:15:53,209
wmic or anything like that you don't

396
00:15:51,380 --> 00:15:55,850
have to modify the code you just go to

397
00:15:53,210 --> 00:15:57,920
the the share and add whatever you want

398
00:15:55,850 --> 00:15:59,840
to execute on the endpoint and rusted or

399
00:15:57,920 --> 00:16:04,670
will just take it and write the output

400
00:15:59,840 --> 00:16:06,170
to the write only share this is what it

401
00:16:04,670 --> 00:16:09,770
looks like with all the different all

402
00:16:06,170 --> 00:16:11,810
different folders also you can grab

403
00:16:09,770 --> 00:16:13,250
memory damp right so you can get a

404
00:16:11,810 --> 00:16:14,839
memory example that machines you can

405
00:16:13,250 --> 00:16:17,660
analyze it later with volatility or

406
00:16:14,840 --> 00:16:20,600
recall and this is what it looks like

407
00:16:17,660 --> 00:16:24,140
just using win pmm and a full memory dam

408
00:16:20,600 --> 00:16:26,330
on draw format so for the era pieced

409
00:16:24,140 --> 00:16:28,610
what you do is you start a server it's a

410
00:16:26,330 --> 00:16:30,680
restful api server with an imp i thumb

411
00:16:28,610 --> 00:16:33,830
again you have the binary so you can run

412
00:16:30,680 --> 00:16:37,099
that on windows but also on mac or linux

413
00:16:33,830 --> 00:16:40,520
and it's going to listen on port 8080

414
00:16:37,100 --> 00:16:42,950
and from there you can run rostral or

415
00:16:40,520 --> 00:16:44,600
with a set of janna rules you can get

416
00:16:42,950 --> 00:16:47,750
from yeah also come or create your own

417
00:16:44,600 --> 00:16:50,540
rules and scan for ioc is both in memory

418
00:16:47,750 --> 00:16:52,100
and on on the disk and that's that's

419
00:16:50,540 --> 00:16:54,650
kind of the format that you will you

420
00:16:52,100 --> 00:16:58,060
would use so again just a shore

421
00:16:54,650 --> 00:16:58,060
one-minute video but i can

422
00:17:06,390 --> 00:17:13,990
so that's the formality of the command

423
00:17:10,179 --> 00:17:15,610
line and this is your memory our memory

424
00:17:13,990 --> 00:17:18,549
our disk we're gonna start the server

425
00:17:15,609 --> 00:17:20,859
that's going to be listening on this on

426
00:17:18,549 --> 00:17:23,760
this box it's going to bind to all the

427
00:17:20,859 --> 00:17:28,469
interfaces and listen on port 8080 and

428
00:17:23,760 --> 00:17:31,480
now we can run a memory memory scan

429
00:17:28,470 --> 00:17:34,960
looking at connecting to the server and

430
00:17:31,480 --> 00:17:37,929
localhost and I'm gonna use fake malware

431
00:17:34,960 --> 00:17:40,240
yet a rule from Florian Roth that it's

432
00:17:37,929 --> 00:17:42,309
on yada rules comm is gonna scan

433
00:17:40,240 --> 00:17:44,169
physical memory and it's not gonna find

434
00:17:42,309 --> 00:17:45,730
anything you can see here the rest of

435
00:17:44,169 --> 00:17:49,240
all API it's pulling the yeah tag rule

436
00:17:45,730 --> 00:17:53,770
from the server and executing that that

437
00:17:49,240 --> 00:17:55,690
scan on the endpoint right I always say

438
00:17:53,770 --> 00:17:57,789
never go hunting on a Friday I always

439
00:17:55,690 --> 00:18:00,039
said that before listen to Heather's

440
00:17:57,789 --> 00:18:01,419
talk right but after that I would say

441
00:18:00,039 --> 00:18:03,850
you know never go hunting on a Friday

442
00:18:01,419 --> 00:18:10,120
unless you work for her and then that's

443
00:18:03,850 --> 00:18:11,889
perfect perfect hit but this is the same

444
00:18:10,120 --> 00:18:14,649
thing now we're doing this on the disk

445
00:18:11,890 --> 00:18:16,750
right so in this case I have a file that

446
00:18:14,649 --> 00:18:18,789
would be actually detected and it will

447
00:18:16,750 --> 00:18:21,880
just create a simple text e-file

448
00:18:18,789 --> 00:18:23,260
text-based file on the same directory

449
00:18:21,880 --> 00:18:25,899
where the server is being executed from

450
00:18:23,260 --> 00:18:27,820
and you will see this this file will be

451
00:18:25,899 --> 00:18:29,199
populated with the details of the scan

452
00:18:27,820 --> 00:18:31,270
so if there's been a match you will get

453
00:18:29,200 --> 00:18:32,890
a timestamp the house name because we

454
00:18:31,270 --> 00:18:35,770
might be running this across hundreds of

455
00:18:32,890 --> 00:18:37,960
systems and you can see where this was

456
00:18:35,770 --> 00:18:40,120
found the module that was used where

457
00:18:37,960 --> 00:18:42,100
there was a memory or on disk the

458
00:18:40,120 --> 00:18:43,719
process where it was found right if it

459
00:18:42,100 --> 00:18:49,469
was a process or the file where this was

460
00:18:43,720 --> 00:18:54,490
found if it's a file on on the disk and

461
00:18:49,470 --> 00:18:56,380
so just based on on this how how would

462
00:18:54,490 --> 00:18:57,070
we solve solving the problem that we

463
00:18:56,380 --> 00:18:58,570
mentioned before

464
00:18:57,070 --> 00:19:00,760
right like two days later but something

465
00:18:58,570 --> 00:19:02,710
like this you go back to the office how

466
00:19:00,760 --> 00:19:06,279
would you be able to get more context

467
00:19:02,710 --> 00:19:10,000
out of an alert like this well if we

468
00:19:06,279 --> 00:19:11,380
would run the tool and this is where you

469
00:19:10,000 --> 00:19:12,700
know it becomes like really useful to

470
00:19:11,380 --> 00:19:14,289
see the integration with some of the

471
00:19:12,700 --> 00:19:16,360
tools you might already have in your

472
00:19:14,289 --> 00:19:17,940
environment and in this particular case

473
00:19:16,360 --> 00:19:20,189
is just like

474
00:19:17,940 --> 00:19:22,399
my PPO but you could use this through

475
00:19:20,190 --> 00:19:25,710
SSC m or whatever mechanism you can

476
00:19:22,399 --> 00:19:28,168
using your environment to push the this

477
00:19:25,710 --> 00:19:30,210
binaries this is just a client task that

478
00:19:28,169 --> 00:19:32,700
we define so we define a client task for

479
00:19:30,210 --> 00:19:36,659
pulling memory temps we define another

480
00:19:32,700 --> 00:19:44,129
client task for doing triage on the

481
00:19:36,659 --> 00:19:47,309
endpoint so exactly the same arguments

482
00:19:44,129 --> 00:19:49,860
command-line arguments that we have we

483
00:19:47,309 --> 00:19:51,658
just we just write them here and we

484
00:19:49,860 --> 00:19:56,758
create those clients as we go back to

485
00:19:51,659 --> 00:19:58,950
the dashboard look at the at the system

486
00:19:56,759 --> 00:20:01,019
we want to investigate and the cool

487
00:19:58,950 --> 00:20:02,639
thing about this is that you can now you

488
00:20:01,019 --> 00:20:04,470
can enable the people that is in the

489
00:20:02,639 --> 00:20:06,840
shock that uses these tools like

490
00:20:04,470 --> 00:20:09,120
point-and-click tools to actually

491
00:20:06,840 --> 00:20:11,189
collect artifacts and do kind of threat

492
00:20:09,120 --> 00:20:13,620
hunting without actually having to open

493
00:20:11,190 --> 00:20:15,570
up a command line and and do more

494
00:20:13,620 --> 00:20:17,639
advanced stuff right so he integrates

495
00:20:15,570 --> 00:20:20,730
these fred hunting and instant response

496
00:20:17,639 --> 00:20:22,949
procedures and tools into the workflow

497
00:20:20,730 --> 00:20:25,289
that you already have in your in your

498
00:20:22,950 --> 00:20:28,350
organization you can see now here now

499
00:20:25,289 --> 00:20:30,480
executing the task and you just have to

500
00:20:28,350 --> 00:20:32,428
go to the share and the share will be

501
00:20:30,480 --> 00:20:35,159
populated with the memory time and all

502
00:20:32,429 --> 00:20:38,190
the information that you have from this

503
00:20:35,159 --> 00:20:39,929
machine within minutes so typically in

504
00:20:38,190 --> 00:20:41,639
this particular environment within like

505
00:20:39,929 --> 00:20:45,629
five minutes you can get like a four gig

506
00:20:41,639 --> 00:20:47,309
memory time and maybe like six or seven

507
00:20:45,629 --> 00:20:50,070
minutes you can get all the information

508
00:20:47,309 --> 00:20:51,658
from the triage so this particular case

509
00:20:50,070 --> 00:20:53,970
you look at the auto runs you see a high

510
00:20:51,659 --> 00:20:55,769
entropy name so something weird

511
00:20:53,970 --> 00:20:58,289
something you want to investigate you

512
00:20:55,769 --> 00:21:00,809
look at that and you also find on the

513
00:20:58,289 --> 00:21:03,389
DNS cache resolution for this mail but

514
00:21:00,809 --> 00:21:05,039
are you how suspicious what's going on

515
00:21:03,389 --> 00:21:06,629
with this box you have already

516
00:21:05,039 --> 00:21:08,908
identified the file and you want to look

517
00:21:06,629 --> 00:21:10,289
at so you pull the file you check the

518
00:21:08,909 --> 00:21:12,570
hashes with virustotal

519
00:21:10,289 --> 00:21:15,450
awesome tool by the way PE estudio

520
00:21:12,570 --> 00:21:18,480
writes something you can you can use and

521
00:21:15,450 --> 00:21:20,940
you see that this is a spam bar that

522
00:21:18,480 --> 00:21:23,250
also steals credentials and do some

523
00:21:20,940 --> 00:21:25,190
other kind of stuff right so that's just

524
00:21:23,250 --> 00:21:27,389
an example of what you can do with them

525
00:21:25,190 --> 00:21:30,779
with something like like this now the

526
00:21:27,389 --> 00:21:31,199
next step would be how to now is scope

527
00:21:30,779 --> 00:21:32,850
the whole

528
00:21:31,200 --> 00:21:34,980
the incident right based on that sample

529
00:21:32,850 --> 00:21:38,370
you can go to your again for instance

530
00:21:34,980 --> 00:21:40,169
generate a Jana rule and now do a search

531
00:21:38,370 --> 00:21:41,879
across all your environment to see this

532
00:21:40,169 --> 00:21:43,860
particular malware has been seen

533
00:21:41,880 --> 00:21:46,289
anywhere else even though you might not

534
00:21:43,860 --> 00:21:49,620
even have you know detections from your

535
00:21:46,289 --> 00:21:52,260
endpoint solution so that's it pretty

536
00:21:49,620 --> 00:21:53,489
much that's the you know the benefit of

537
00:21:52,260 --> 00:21:55,710
having something like this in like two

538
00:21:53,490 --> 00:21:58,919
three days now in this particular

539
00:21:55,710 --> 00:22:02,760
environment we were able to an eight to

540
00:21:58,919 --> 00:22:05,039
to add these capabilities to the sock

541
00:22:02,760 --> 00:22:07,379
where now they could do fret hunting and

542
00:22:05,039 --> 00:22:09,179
do some other instant response and

543
00:22:07,380 --> 00:22:12,059
triage in a quick and dirty way right

544
00:22:09,179 --> 00:22:14,190
this is by no means anything as cool or

545
00:22:12,059 --> 00:22:16,110
fancy or advanced as many of the tools

546
00:22:14,190 --> 00:22:17,580
we have mentioned during the day but you

547
00:22:16,110 --> 00:22:20,399
know it's open source it's out there you

548
00:22:17,580 --> 00:22:22,019
have the code you said write the

549
00:22:20,399 --> 00:22:25,350
commutation is really bad because of

550
00:22:22,019 --> 00:22:28,649
this almost no documentation but you

551
00:22:25,350 --> 00:22:30,750
have but you have my details right so

552
00:22:28,649 --> 00:22:32,158
please you said I would like to have

553
00:22:30,750 --> 00:22:33,990
your feedback on it if you're using it

554
00:22:32,159 --> 00:22:36,380
and that's it thank you very much for

555
00:22:33,990 --> 00:22:36,380
attention

