1
00:00:14,179 --> 00:00:17,910
thanks Rob

2
00:00:16,079 --> 00:00:20,609
like you said my name is Jamie Butler

3
00:00:17,910 --> 00:00:22,609
I'm CTO at endgame which basically means

4
00:00:20,609 --> 00:00:25,410
these guys will be doing all the talking

5
00:00:22,609 --> 00:00:28,109
I just want to take a quick moment to

6
00:00:25,410 --> 00:00:30,269
introduce them to my right here is Anjem

7
00:00:28,109 --> 00:00:33,450
he's a threat researcher in our R&D

8
00:00:30,269 --> 00:00:36,899
department came to us by way of Cisco

9
00:00:33,450 --> 00:00:38,550
his expertise is in network analysis and

10
00:00:36,899 --> 00:00:42,960
machine learning

11
00:00:38,550 --> 00:00:45,750
this is Andrew he came to us with a long

12
00:00:42,960 --> 00:00:48,960
history as you can tell buzz old-aged

13
00:00:45,750 --> 00:00:51,780
beside me of doing pen testing and red

14
00:00:48,960 --> 00:00:53,399
teaming he likes to say lower more time

15
00:00:51,780 --> 00:01:01,949
and other people's computers than in his

16
00:00:53,399 --> 00:01:03,120
own I don't judge the quick agenda you

17
00:01:01,949 --> 00:01:04,170
know we're all here talking about

18
00:01:03,120 --> 00:01:05,610
through out hunting and things like that

19
00:01:04,170 --> 00:01:09,479
and one of the things that endgame is

20
00:01:05,610 --> 00:01:11,820
excited about is going to learn from the

21
00:01:09,479 --> 00:01:13,409
audience and from the summit of what

22
00:01:11,820 --> 00:01:14,908
your thoughts are on threat hunting

23
00:01:13,409 --> 00:01:17,100
because it's like Rob was saying earlier

24
00:01:14,909 --> 00:01:25,229
and bam it's not really totally

25
00:01:17,100 --> 00:01:26,759
well-defined we'll talk about art but

26
00:01:25,229 --> 00:01:29,850
we're going to talk a little bit about

27
00:01:26,759 --> 00:01:31,860
the book again we're going to the main

28
00:01:29,850 --> 00:01:39,240
property for the presentation is on the

29
00:01:31,860 --> 00:01:40,770
cheap so yeah talk about how you can

30
00:01:39,240 --> 00:01:51,179
make sure your organization and build

31
00:01:40,770 --> 00:01:56,520
some pretty decent so this is how we

32
00:01:51,180 --> 00:01:57,840
would all like to Minority Report or

33
00:01:56,520 --> 00:02:00,179
suit if you can do that and it's all

34
00:01:57,840 --> 00:02:01,790
visual it's awesome but it's really

35
00:02:00,180 --> 00:02:05,330
you're coming down

36
00:02:01,790 --> 00:02:06,950
and you're sometimes as been mentioned

37
00:02:05,330 --> 00:02:10,910
maybe you're actually firing with a

38
00:02:06,950 --> 00:02:13,400
spoon it seems so I want to discuss what

39
00:02:10,910 --> 00:02:15,049
we think about Masseria are hunting you

40
00:02:13,400 --> 00:02:16,370
know it was Robin said I mean things

41
00:02:15,050 --> 00:02:19,580
have changed in the last couple years

42
00:02:16,370 --> 00:02:21,680
everyone it seems breach already we talk

43
00:02:19,580 --> 00:02:23,390
about how to sell hunting we're not

44
00:02:21,680 --> 00:02:25,760
talking about hacking back we don't

45
00:02:23,390 --> 00:02:28,640
believe in these awful and it's

46
00:02:25,760 --> 00:02:29,780
attributes really hard to do but we're

47
00:02:28,640 --> 00:02:32,510
talking about finding and eliminating

48
00:02:29,780 --> 00:02:36,680
the ego things or the badness within

49
00:02:32,510 --> 00:02:40,399
your own network and in our interactions

50
00:02:36,680 --> 00:02:42,170
with people that seems to be an evolving

51
00:02:40,400 --> 00:02:44,360
field it's a lot of immature

52
00:02:42,170 --> 00:02:45,589
organizations already doing it and those

53
00:02:44,360 --> 00:02:47,150
that are a little bit of less that

54
00:02:45,590 --> 00:02:49,280
you're really trying to control to see

55
00:02:47,150 --> 00:02:52,220
today we've talked to a few people

56
00:02:49,280 --> 00:02:56,080
actually the clothing retail end of the

57
00:02:52,220 --> 00:02:58,220
spectrum who are building a ton of teams

58
00:02:56,080 --> 00:03:02,060
things are definitely evolved quickly

59
00:02:58,220 --> 00:03:04,850
and everyone understands so it's really

60
00:03:02,060 --> 00:03:07,970
an interesting intersection we believe

61
00:03:04,850 --> 00:03:09,410
between offense and defense and we'll

62
00:03:07,970 --> 00:03:11,560
discuss a little bit about what that

63
00:03:09,410 --> 00:03:11,560
means

64
00:03:13,510 --> 00:03:19,549
so everyone here take on that sounds

65
00:03:17,780 --> 00:03:21,769
like a lot if you already are there's

66
00:03:19,550 --> 00:03:23,900
three way free tools to do it there's

67
00:03:21,769 --> 00:03:27,260
some faculty techniques we we feel

68
00:03:23,900 --> 00:03:29,959
helped us learn a thing and you can do

69
00:03:27,260 --> 00:03:35,149
without with or without the need for

70
00:03:29,959 --> 00:03:37,010
commercial gravitas so what is what are

71
00:03:35,150 --> 00:03:37,600
we talking about ecology how do you go

72
00:03:37,010 --> 00:03:40,100
about that

73
00:03:37,600 --> 00:03:43,489
when I think about the security problem

74
00:03:40,100 --> 00:03:46,190
I really think about it from our number

75
00:03:43,489 --> 00:03:49,070
of devices and from our endpoints or our

76
00:03:46,190 --> 00:03:53,550
hosts those are kind of they make up the

77
00:03:49,070 --> 00:03:56,459
majority of our of our security

78
00:03:53,550 --> 00:03:59,130
and so the general fund methodology that

79
00:03:56,460 --> 00:04:00,780
we have operates here is kind of you

80
00:03:59,130 --> 00:04:02,609
know we need to be able to collect data

81
00:04:00,780 --> 00:04:05,280
so we need to be able to get things off

82
00:04:02,610 --> 00:04:07,380
network devices that may be NetFlow and

83
00:04:05,280 --> 00:04:10,170
other things and she will be talking in

84
00:04:07,380 --> 00:04:12,480
a moment about network analysis that you

85
00:04:10,170 --> 00:04:14,850
do we also we need to be able to get

86
00:04:12,480 --> 00:04:17,610
things off the host the host is where

87
00:04:14,850 --> 00:04:19,200
our assets typically are and that's

88
00:04:17,610 --> 00:04:21,480
where our you know look at the property

89
00:04:19,200 --> 00:04:23,340
rules that are so we want to bring it

90
00:04:21,480 --> 00:04:25,770
back together then we have analyzed so

91
00:04:23,340 --> 00:04:28,380
we need to be able to sift through large

92
00:04:25,770 --> 00:04:30,900
clumps make interesting conclusions

93
00:04:28,380 --> 00:04:32,400
about it you know cold the thread and

94
00:04:30,900 --> 00:04:34,590
follow where it leads

95
00:04:32,400 --> 00:04:37,830
once we find something that is back then

96
00:04:34,590 --> 00:04:39,260
we do we getting in kind of a hard

97
00:04:37,830 --> 00:04:41,909
process

98
00:04:39,260 --> 00:04:45,060
so this talk will discuss the specifics

99
00:04:41,910 --> 00:04:46,650
of the network and host analysis and you

100
00:04:45,060 --> 00:04:49,680
know this is just the beginning into the

101
00:04:46,650 --> 00:04:51,270
point in time with so it's not it's not

102
00:04:49,680 --> 00:04:53,100
everything that we would like to be able

103
00:04:51,270 --> 00:05:00,750
to share with you but it's a space to

104
00:04:53,100 --> 00:05:07,140
the so I'll turn it over to Anjali to

105
00:05:00,750 --> 00:05:14,040
talk about the network all right so when

106
00:05:07,140 --> 00:05:15,650
we talk about all right so let me begin

107
00:05:14,040 --> 00:05:17,910
with explain what we might achieve here

108
00:05:15,650 --> 00:05:22,020
when we talk one hunting for enfoque

109
00:05:17,910 --> 00:05:24,540
iosys we look for known bad domains IP

110
00:05:22,020 --> 00:05:26,370
ciders ramen from raucous former

111
00:05:24,540 --> 00:05:29,910
Baathist be bought or acquired a

112
00:05:26,370 --> 00:05:31,910
challenge these days is that known this

113
00:05:29,910 --> 00:05:35,070
is network eyes with a very short it

114
00:05:31,910 --> 00:05:38,100
kind of choir and I think of it seems

115
00:05:35,070 --> 00:05:39,270
like one of us by time we detect one and

116
00:05:38,100 --> 00:05:41,130
it goes to has already moved on to the

117
00:05:39,270 --> 00:05:43,409
next one so what we really want to be

118
00:05:41,130 --> 00:05:47,659
doing here is to look for some sort of

119
00:05:43,410 --> 00:05:47,660
higher order IRC some patterns that we

120
00:05:49,460 --> 00:05:54,630
so the acid eNOS is really good at

121
00:05:52,290 --> 00:05:56,520
capturing such patterns Pasadena's as

122
00:05:54,630 --> 00:05:58,909
you all know is the data that we

123
00:05:56,520 --> 00:06:00,890
acquired by observing in 30

124
00:05:58,910 --> 00:06:04,250
traffic and reassembling the would be

125
00:06:00,890 --> 00:06:06,469
nice transaction and it is as simple as

126
00:06:04,250 --> 00:06:09,080
it sounds is glorified this beat up with

127
00:06:06,470 --> 00:06:10,430
reasonably large built-in you can use

128
00:06:09,080 --> 00:06:12,859
any of these two sensors that we have

129
00:06:10,430 --> 00:06:16,070
used in the past and paste them on a

130
00:06:12,860 --> 00:06:18,350
recursive DNS resolver or on spam code

131
00:06:16,070 --> 00:06:20,690
within unity book and it spits out the

132
00:06:18,350 --> 00:06:23,780
other looks just like that and of course

133
00:06:20,690 --> 00:06:25,370
a concise and structured is you've got

134
00:06:23,780 --> 00:06:29,030
your query name is very high and the

135
00:06:25,370 --> 00:06:32,690
answers and that's what makes Pasadena

136
00:06:29,030 --> 00:06:34,609
stood easy to work with but the batter

137
00:06:32,690 --> 00:06:38,060
out of the way let me talk about the

138
00:06:34,610 --> 00:06:39,500
workflow so you first won't know what's

139
00:06:38,060 --> 00:06:42,920
the normal in popular in your handbook

140
00:06:39,500 --> 00:06:44,510
and maybe white let's go then we could

141
00:06:42,920 --> 00:06:46,280
slice and dice the remaining data in

142
00:06:44,510 --> 00:06:49,490
various different ways to figure out

143
00:06:46,280 --> 00:06:51,320
outlets and the last step would be look

144
00:06:49,490 --> 00:06:53,300
at those outliers now on those outbursts

145
00:06:51,320 --> 00:07:01,670
and see which of them which of them are

146
00:06:53,300 --> 00:07:04,490
a malicious mature timely look at past

147
00:07:01,670 --> 00:07:06,740
minions data you will find that the big

148
00:07:04,490 --> 00:07:10,460
majority of the DNS queries in your

149
00:07:06,740 --> 00:07:12,970
network our queries so it's it makes

150
00:07:10,460 --> 00:07:15,680
sense to understand what's popular and

151
00:07:12,970 --> 00:07:19,210
popular and normally limit book and what

152
00:07:15,680 --> 00:07:21,770
is out everything i think of popular in

153
00:07:19,210 --> 00:07:24,349
normal the domains i think of elixir of

154
00:07:21,770 --> 00:07:25,490
the winds it is the starting point but

155
00:07:24,350 --> 00:07:28,720
there are some challenges when you use

156
00:07:25,490 --> 00:07:28,720
that or Pasadena's

157
00:07:30,380 --> 00:07:36,500
firstly an excel the winds exit captures

158
00:07:35,000 --> 00:07:39,860
of the idea of the science from a

159
00:07:36,500 --> 00:07:44,000
browsers decided what a dissing capture

160
00:07:39,860 --> 00:07:45,740
is all the Czar's services the Sirians

161
00:07:44,000 --> 00:07:50,930
that actually deliver the content

162
00:07:45,740 --> 00:07:55,910
think your eyes and try to all

163
00:07:50,930 --> 00:07:57,740
of those domains in there and be you

164
00:07:55,910 --> 00:07:58,840
can't wipe this everything that

165
00:07:57,740 --> 00:08:01,850
cinematic set of the winds

166
00:07:58,840 --> 00:08:03,698
typically any time domain if a domain

167
00:08:01,850 --> 00:08:06,300
host content it is

168
00:08:03,699 --> 00:08:08,800
or control you can't just wipe this out

169
00:08:06,300 --> 00:08:12,370
tambul who be dad makes the dynamic inna

170
00:08:08,800 --> 00:08:14,169
students you you would have you

171
00:08:12,370 --> 00:08:16,509
basically four domains that have large

172
00:08:14,169 --> 00:08:18,698
numbers of the winds that have that

173
00:08:16,509 --> 00:08:21,150
resolved to a very diverse IP space both

174
00:08:18,699 --> 00:08:23,590
geographically and battleship

175
00:08:21,150 --> 00:08:24,849
this is diversity of the IP space is a

176
00:08:23,590 --> 00:08:31,719
really interesting topic and we will see

177
00:08:24,849 --> 00:08:35,169
some more examples shortly so onto her

178
00:08:31,719 --> 00:08:37,958
first hunting technique fastest so fast

179
00:08:35,169 --> 00:08:40,000
first was all the rage back in 2010 2012

180
00:08:37,958 --> 00:08:41,890
timeframe where a single domain would

181
00:08:40,000 --> 00:08:44,110
resolve to large two varieties swap in

182
00:08:41,890 --> 00:08:49,170
an hour high frequency typically you've

183
00:08:44,110 --> 00:08:53,140
got to be done ie miss focused now from

184
00:08:49,170 --> 00:08:54,729
passengers perspective it's a domain

185
00:08:53,140 --> 00:08:57,250
that has large number of airports

186
00:08:54,730 --> 00:09:00,180
typically with a small theory but a

187
00:08:57,250 --> 00:09:04,630
challenge is that most load balances and

188
00:09:00,180 --> 00:09:07,420
any gas domains look very similar but

189
00:09:04,630 --> 00:09:12,970
what separates the two classes is again

190
00:09:07,420 --> 00:09:15,099
the diversity of IP space think about it

191
00:09:12,970 --> 00:09:17,740
right google.com main is not too large

192
00:09:15,100 --> 00:09:20,170
the her my keys but those IDs would be

193
00:09:17,740 --> 00:09:22,000
owned by Google or Netflix or comedy

194
00:09:20,170 --> 00:09:24,040
would may resolve a large number of my

195
00:09:22,000 --> 00:09:25,510
keys but it will be won by interviewers

196
00:09:24,040 --> 00:09:28,750
in different types

197
00:09:25,510 --> 00:09:31,779
rigorous in somewhere or the other

198
00:09:28,750 --> 00:09:41,980
benign load-balanced domains have some

199
00:09:31,779 --> 00:09:44,860
homogeneity in the white space but

200
00:09:41,980 --> 00:09:47,140
malicious domains using

201
00:09:44,860 --> 00:09:50,260
faster techniques tend to have a very

202
00:09:47,140 --> 00:09:52,000
diverse IP space and that's a key here

203
00:09:50,260 --> 00:09:53,529
for the main the key part of this

204
00:09:52,000 --> 00:09:54,970
section right we are looking for a

205
00:09:53,529 --> 00:09:56,320
particular pattern we didn't know what

206
00:09:54,970 --> 00:09:57,940
these domains from any block list we

207
00:09:56,320 --> 00:10:00,730
look for this pattern and I found these

208
00:09:57,940 --> 00:10:03,750
three domains which I later confirm were

209
00:10:00,730 --> 00:10:06,130
see two domains by two water stool

210
00:10:03,750 --> 00:10:08,290
that's pretty interesting right we are

211
00:10:06,130 --> 00:10:12,220
just looking for a pattern and we find

212
00:10:08,290 --> 00:10:14,420
that stuff that we didn't know what next

213
00:10:12,220 --> 00:10:17,400
up is details

214
00:10:14,420 --> 00:10:19,829
SoDo international gardens right matters

215
00:10:17,400 --> 00:10:22,170
that use these years to drink large

216
00:10:19,830 --> 00:10:24,960
thousands of pranam domains every day

217
00:10:22,170 --> 00:10:26,540
and tries to reach out there and the

218
00:10:24,960 --> 00:10:28,650
botnet controller would reserve with

219
00:10:26,540 --> 00:10:31,079
registered a few of those domains to get

220
00:10:28,650 --> 00:10:32,819
the botnet coin and in order to take

221
00:10:31,080 --> 00:10:34,500
down the part that one has to register

222
00:10:32,820 --> 00:10:36,270
all those two means before the botnet

223
00:10:34,500 --> 00:10:38,010
what it does right now

224
00:10:36,270 --> 00:10:46,319
that's a jarring problem that we have

225
00:10:38,010 --> 00:10:48,870
faced I think is that we can measure

226
00:10:46,320 --> 00:10:50,970
randomness if somebody's trying to

227
00:10:48,870 --> 00:10:53,850
randomly pick characters from English

228
00:10:50,970 --> 00:10:56,010
alphabet is gonna get Woolworth Building

229
00:10:53,850 --> 00:10:57,780
focus design consonant seven six four

230
00:10:56,010 --> 00:10:59,670
sometimes but English language has a

231
00:10:57,780 --> 00:11:03,630
much higher poverty concentration or

232
00:10:59,670 --> 00:11:05,849
even the knitters that random it is out

233
00:11:03,630 --> 00:11:08,280
of order so you saw these features that

234
00:11:05,850 --> 00:11:09,660
are listed here and put them into a base

235
00:11:08,280 --> 00:11:11,430
of the capacitor called random forest

236
00:11:09,660 --> 00:11:14,130
classifier which is like a code equation

237
00:11:11,430 --> 00:11:17,130
scale we can come up with a really good

238
00:11:14,130 --> 00:11:18,360
DJ transpire we have actually open

239
00:11:17,130 --> 00:11:22,370
source this classifiers front of this

240
00:11:18,360 --> 00:11:22,370
talk and maybe performs really well

241
00:11:22,380 --> 00:11:27,150
now think about how you would do this on

242
00:11:24,060 --> 00:11:28,530
comma traditional Bacardi per second we

243
00:11:27,150 --> 00:11:30,180
are looking for mad at families that

244
00:11:28,530 --> 00:11:33,060
happen that produce thousands of the

245
00:11:30,180 --> 00:11:35,250
domains per day these domains are never

246
00:11:33,060 --> 00:11:38,010
used again this is huge risk of losses

247
00:11:35,250 --> 00:11:39,990
that help you maintain and these domains

248
00:11:38,010 --> 00:11:41,760
you can't is it statically from another

249
00:11:39,990 --> 00:11:44,160
you have this continuously down you can

250
00:11:41,760 --> 00:11:45,540
analyze malice but if you put this DJ

251
00:11:44,160 --> 00:11:47,969
classified in front of you Pasadena's

252
00:11:45,540 --> 00:11:51,589
you're catching these domains as they go

253
00:11:47,970 --> 00:11:51,590
life so that's pretty powerful

254
00:11:58,130 --> 00:12:02,880
now what is the value of these models do

255
00:12:00,930 --> 00:12:04,560
not use random characters but use random

256
00:12:02,880 --> 00:12:06,630
words put them together to make a domain

257
00:12:04,560 --> 00:12:10,709
and so we are being through that

258
00:12:06,630 --> 00:12:12,689
cervical mucus fire if you guys can

259
00:12:10,710 --> 00:12:18,900
recognize the family of malware behind

260
00:12:12,690 --> 00:12:20,880
these domains it's live dot and but you

261
00:12:18,900 --> 00:12:23,069
have another finger case such so these

262
00:12:20,880 --> 00:12:33,150
anomalies that don't really have that

263
00:12:23,070 --> 00:12:36,210
have a different random so remember I

264
00:12:33,150 --> 00:12:38,010
said that a family has thousands of the

265
00:12:36,210 --> 00:12:40,440
main said it produces teeny and when we

266
00:12:38,010 --> 00:12:42,480
feel the resolve right now what happens

267
00:12:40,440 --> 00:12:44,880
to the remaining was they show up as a

268
00:12:42,480 --> 00:12:47,010
DNS error with our good three which

269
00:12:44,880 --> 00:12:49,560
stands for an extra main or non-existent

270
00:12:47,010 --> 00:12:51,810
domain typically you see you know three

271
00:12:49,560 --> 00:12:53,910
to five percent of the traffic as Venus

272
00:12:51,810 --> 00:12:55,500
errors with enhanced domain typically

273
00:12:53,910 --> 00:12:58,980
from you know copy paste journalist

274
00:12:55,500 --> 00:13:02,340
typos browser prefetching malformed HTML

275
00:12:58,980 --> 00:13:03,810
and so on but anytime if the next rate

276
00:13:02,340 --> 00:13:05,250
of a next domain surges inimitable

277
00:13:03,810 --> 00:13:08,729
this is a highlight this is something

278
00:13:05,250 --> 00:13:11,280
going on I can think of this as you know

279
00:13:08,730 --> 00:13:13,020
in current posture again if you see too

280
00:13:11,280 --> 00:13:15,390
many of them there someone is trying to

281
00:13:13,020 --> 00:13:24,410
abuser system and in this it would be in

282
00:13:15,390 --> 00:13:27,360
this case it would be a family so

283
00:13:24,410 --> 00:13:29,880
anytime we do outlier detection there is

284
00:13:27,360 --> 00:13:32,250
going to be false positive of that does

285
00:13:29,880 --> 00:13:34,710
not necessary mean vanishes so here's an

286
00:13:32,250 --> 00:13:36,210
interesting example for the stock we

287
00:13:34,710 --> 00:13:37,980
applied in the material for the stock we

288
00:13:36,210 --> 00:13:39,810
ran some sense of that I mentioned

289
00:13:37,980 --> 00:13:41,550
earlier on our corporate network on our

290
00:13:39,810 --> 00:13:45,839
labs and so on and if found these

291
00:13:41,550 --> 00:13:47,729
domains that were digitally these most

292
00:13:45,840 --> 00:13:49,890
of these domains these queries for an

293
00:13:47,730 --> 00:13:52,260
extra means and the main business is the

294
00:13:49,890 --> 00:13:52,680
domain behind this was behind the who is

295
00:13:52,260 --> 00:13:55,290
posse

296
00:13:52,680 --> 00:13:57,719
and so we scratch ahead for a few days

297
00:13:55,290 --> 00:13:59,839
because rocks were there at the panic

298
00:13:57,720 --> 00:14:05,120
story there but it turns out it was

299
00:13:59,840 --> 00:14:07,130
Chrome's crows DNS wildcard detection

300
00:14:05,120 --> 00:14:09,529
we're not when a user had configured his

301
00:14:07,130 --> 00:14:17,390
personal domain has a search to enter so

302
00:14:09,529 --> 00:14:20,140
there can be false positives we don't

303
00:14:17,390 --> 00:14:25,120
touch about that child to psych it was

304
00:14:20,140 --> 00:14:29,180
hunting techniques next first Ernest is

305
00:14:25,120 --> 00:14:31,070
furiously so medical traffic follows a

306
00:14:29,180 --> 00:14:34,250
particular pattern folks got to work in

307
00:14:31,070 --> 00:14:37,220
the morning take a break for lunch and

308
00:14:34,250 --> 00:14:39,529
then people pay if you figure out the

309
00:14:37,220 --> 00:14:40,279
domains that receive queries only during

310
00:14:39,529 --> 00:14:42,410
office hours

311
00:14:40,279 --> 00:14:46,610
what you're left with is this continuous

312
00:14:42,410 --> 00:14:48,500
trickle of automatron right within that

313
00:14:46,610 --> 00:14:50,810
traffic we are looking for the winds

314
00:14:48,500 --> 00:14:53,210
that are that have received chorus

315
00:14:50,810 --> 00:14:56,180
periodically think of your software

316
00:14:53,210 --> 00:14:58,930
basics access to the right content

317
00:14:56,180 --> 00:15:01,849
refresh and so on right out super wave

318
00:14:58,930 --> 00:15:03,500
detector ASSA t is you know take the

319
00:15:01,850 --> 00:15:05,120
average time between queries for a

320
00:15:03,500 --> 00:15:08,029
particular link for that in the query

321
00:15:05,120 --> 00:15:11,089
tool and see what fraction of domains

322
00:15:08,029 --> 00:15:14,570
caught a query had that it will give it

323
00:15:11,089 --> 00:15:16,850
a margin of error and if it's about

324
00:15:14,570 --> 00:15:23,660
Sarah 5% you have a domain that's

325
00:15:16,850 --> 00:15:25,430
receiving purely queries like I said

326
00:15:23,660 --> 00:15:27,620
normally this is these are software

327
00:15:25,430 --> 00:15:30,140
baby's check or services or technical

328
00:15:27,620 --> 00:15:32,000
updates and qualify and majority of

329
00:15:30,140 --> 00:15:34,790
these signs these so we'll start posted

330
00:15:32,000 --> 00:15:36,650
on well-known and highly available kind

331
00:15:34,790 --> 00:15:39,529
of content delivery networks that you

332
00:15:36,650 --> 00:15:42,880
have already visited in most cases what

333
00:15:39,529 --> 00:15:51,200
you're left with are outliers

334
00:15:42,880 --> 00:15:53,660
now imagine said but really have this

335
00:15:51,200 --> 00:15:55,520
out there that's about this one there

336
00:15:53,660 --> 00:15:59,240
are software running in a very visual

337
00:15:55,520 --> 00:16:03,079
world and two we have see you found a

338
00:15:59,240 --> 00:16:04,760
mother family easy or not again that's

339
00:16:03,080 --> 00:16:07,670
the point here that I'm driving here

340
00:16:04,760 --> 00:16:09,830
that is that we know that zero gravity

341
00:16:07,670 --> 00:16:12,400
on it and if you look for that

342
00:16:09,830 --> 00:16:16,120
particular pattern you find possible

343
00:16:12,400 --> 00:16:16,120
nominees in your network

344
00:16:16,720 --> 00:16:23,210
the last hunting technique that our talk

345
00:16:19,460 --> 00:16:26,060
about is fish indication these examples

346
00:16:23,210 --> 00:16:28,790
is here there are two kinds of commonly

347
00:16:26,060 --> 00:16:30,770
used fishing domains for the first time

348
00:16:28,790 --> 00:16:33,439
the fishing domain is a slightly

349
00:16:30,770 --> 00:16:37,910
modified version often known when I'm

350
00:16:33,440 --> 00:16:39,830
doing and in oil detectors - means we

351
00:16:37,910 --> 00:16:41,480
could use something called at a distance

352
00:16:39,830 --> 00:16:43,610
when he says slightly modified that's

353
00:16:41,480 --> 00:16:44,990
where it is this assumption we can use

354
00:16:43,610 --> 00:16:47,420
this purpose invalided distance to

355
00:16:44,990 --> 00:16:50,990
figure the domains but the domain might

356
00:16:47,420 --> 00:16:54,380
be - smooth and in other other type

357
00:16:50,990 --> 00:16:57,230
where a fish domain would contain a

358
00:16:54,380 --> 00:16:59,030
known brand name to look genuine and in

359
00:16:57,230 --> 00:17:01,240
such cases you could use a technique

360
00:16:59,030 --> 00:17:05,200
called longest common substring search

361
00:17:01,240 --> 00:17:07,400
directly using the suffix tree to search

362
00:17:05,200 --> 00:17:09,140
for these domains at a very large scale

363
00:17:07,400 --> 00:17:11,000
and I figure out the winds that a

364
00:17:09,140 --> 00:17:13,400
particular fishing but a good a place

365
00:17:11,000 --> 00:17:15,890
random fish in those fields

366
00:17:13,400 --> 00:17:17,720
most of a BD address these days are

367
00:17:15,890 --> 00:17:18,980
using fishing domains to accelerate

368
00:17:17,720 --> 00:17:20,810
information out of the network so this

369
00:17:18,980 --> 00:17:25,730
makes it a really good any to figure out

370
00:17:20,810 --> 00:17:28,129
look for the hunt for AP address now

371
00:17:25,730 --> 00:17:30,770
like we saw earlier order doesn't

372
00:17:28,130 --> 00:17:33,680
necessarily mean malicious right so we

373
00:17:30,770 --> 00:17:35,360
need to do some validation so in my mind

374
00:17:33,680 --> 00:17:37,190
I would do three steps to violate a

375
00:17:35,360 --> 00:17:40,040
particular where have I seen it before

376
00:17:37,190 --> 00:17:41,450
or is this a new widget or maybe Goga a

377
00:17:40,040 --> 00:17:44,270
month back and see if you've seen this

378
00:17:41,450 --> 00:17:47,150
before how many hosts when in unity book

379
00:17:44,270 --> 00:17:49,280
had this particular alpha more

380
00:17:47,150 --> 00:17:51,320
widespread the larger the number of

381
00:17:49,280 --> 00:17:52,700
hosts that have a photograph that less

382
00:17:51,320 --> 00:17:55,040
likely that it's gonna be malicious and

383
00:17:52,700 --> 00:17:57,140
how many models would trigger a response

384
00:17:55,040 --> 00:17:59,629
for the clarifier you've seen throughout

385
00:17:57,140 --> 00:18:01,760
the sites each I didn't find a single

386
00:17:59,630 --> 00:18:04,700
man well it did have multiple sort of

387
00:18:01,760 --> 00:18:07,460
skits about last week on them once you

388
00:18:04,700 --> 00:18:10,400
Windom past get in fact resurfaced get

389
00:18:07,460 --> 00:18:14,780
past those filters many one had run down

390
00:18:10,400 --> 00:18:17,740
the process in user level LC punishes

391
00:18:14,780 --> 00:18:20,050
and if so tired

392
00:18:17,740 --> 00:18:23,800
it doesn't you wanna maybe consider

393
00:18:20,050 --> 00:18:28,690
adding that particular domain or I mean

394
00:18:23,800 --> 00:18:30,520
as normal and you might assist we

395
00:18:28,690 --> 00:18:32,950
touched on four or five funny things

396
00:18:30,520 --> 00:18:35,020
today but here really discuss a service

397
00:18:32,950 --> 00:18:37,090
you can do so many more hunting

398
00:18:35,020 --> 00:18:39,129
techniques on top of Pasadena's based on

399
00:18:37,090 --> 00:18:42,790
current trends and don't really have to

400
00:18:39,130 --> 00:18:45,670
know unknown but at three main

401
00:18:42,790 --> 00:18:48,670
guidelines for developing findings on

402
00:18:45,670 --> 00:18:51,250
Pasadena's one every any book is

403
00:18:48,670 --> 00:18:52,900
different you have to find what's normal

404
00:18:51,250 --> 00:18:56,380
why didn't it work it's a learning

405
00:18:52,900 --> 00:18:58,059
process on a same token what's abnormal

406
00:18:56,380 --> 00:19:00,520
for you network is something that

407
00:18:58,059 --> 00:19:02,170
happened when Tina and know is it's

408
00:19:00,520 --> 00:19:03,879
something that we have never seen before

409
00:19:02,170 --> 00:19:05,080
maintain that extra suspicious domains

410
00:19:03,880 --> 00:19:08,920
that are given never seen before

411
00:19:05,080 --> 00:19:11,980
and lastly we have only spoken about

412
00:19:08,920 --> 00:19:14,620
what was rated what was response if you

413
00:19:11,980 --> 00:19:17,010
also include who query in when you make

414
00:19:14,620 --> 00:19:19,899
you add your models really accurate

415
00:19:17,010 --> 00:19:21,610
about that note I'll hide over to Andrew

416
00:19:19,900 --> 00:19:45,850
to talk about hunting on the coast

417
00:19:21,610 --> 00:19:47,800
achieve something sort of desert are

418
00:19:45,850 --> 00:19:54,969
certain yet we have nothing to just kind

419
00:19:47,800 --> 00:19:56,530
of apply it on cheap of course so so the

420
00:19:54,970 --> 00:19:59,500
general idea when we're talking about

421
00:19:56,530 --> 00:20:06,340
finding badness on the actual home so

422
00:19:59,500 --> 00:20:07,960
basically and that's probably going to

423
00:20:06,340 --> 00:20:10,449
use a byproduct of the fact that you

424
00:20:07,960 --> 00:20:13,380
have you know she you know that's

425
00:20:10,450 --> 00:20:13,380
everything

426
00:20:13,720 --> 00:20:34,140
anyway we're gonna use some kind of

427
00:20:15,700 --> 00:20:34,140
image when you were actually do so

428
00:20:41,910 --> 00:20:46,990
doesn't mean it's bad so on and so forth

429
00:20:45,280 --> 00:20:50,260
but that is a really good place to start

430
00:20:46,990 --> 00:20:51,520
so a lot of it there's there's a number

431
00:20:50,260 --> 00:20:53,770
of different things that you can look at

432
00:20:51,520 --> 00:20:55,540
when you're looking at the host you know

433
00:20:53,770 --> 00:20:57,790
you can look at the processes just the

434
00:20:55,540 --> 00:21:00,250
processes that are running the network

435
00:20:57,790 --> 00:21:02,290
connections that are taking place items

436
00:21:00,250 --> 00:21:04,870
on the file system logs

437
00:21:02,290 --> 00:21:05,980
autoruns etc you have to figure out you

438
00:21:04,870 --> 00:21:07,179
know which of the things based on your

439
00:21:05,980 --> 00:21:08,380
network you want to try to look at some

440
00:21:07,180 --> 00:21:09,940
are going to be more effective than

441
00:21:08,380 --> 00:21:11,680
others but there is no right way to do

442
00:21:09,940 --> 00:21:13,660
it there are some cheat codes that you

443
00:21:11,680 --> 00:21:16,030
can use a little bit that are over all

444
00:21:13,660 --> 00:21:23,410
relatively effective and I'm gonna talk

445
00:21:16,030 --> 00:21:25,930
about some of those here now there we go

446
00:21:23,410 --> 00:21:27,190
so the two overarching scenarios that

447
00:21:25,930 --> 00:21:28,480
I'm gonna talk about today are hunting

448
00:21:27,190 --> 00:21:30,130
with open source intelligence or

449
00:21:28,480 --> 00:21:31,360
otherwise just hunting with you know any

450
00:21:30,130 --> 00:21:33,730
piece of intelligence where somebody

451
00:21:31,360 --> 00:21:35,020
tells you exactly you know what you're

452
00:21:33,730 --> 00:21:36,820
looking for you just don't know where

453
00:21:35,020 --> 00:21:38,080
and then the other thing is gonna be

454
00:21:36,820 --> 00:21:39,220
hunting with no intelligence you have no

455
00:21:38,080 --> 00:21:41,679
idea what you're looking for but you're

456
00:21:39,220 --> 00:21:42,820
just going to look based on anomalies

457
00:21:41,680 --> 00:21:44,830
that are in your network and you're

458
00:21:42,820 --> 00:21:45,760
going to then investigate those and

459
00:21:44,830 --> 00:21:46,960
you're looking you're gonna look at

460
00:21:45,760 --> 00:21:48,730
things that stick out you're gonna go

461
00:21:46,960 --> 00:21:50,080
based on that a little bit so first

462
00:21:48,730 --> 00:21:55,600
we're gonna talk about hunting with

463
00:21:50,080 --> 00:21:56,740
intelligence on the cheap so this you

464
00:21:55,600 --> 00:21:58,389
know as I was kind of saying before you

465
00:21:56,740 --> 00:22:00,370
have some kind of indicator of

466
00:21:58,390 --> 00:22:02,560
compromise like a hash share or even

467
00:22:00,370 --> 00:22:04,899
maybe like a TTP write-up or something

468
00:22:02,560 --> 00:22:09,370
like that file name something and you

469
00:22:04,900 --> 00:22:11,170
want I'm so sorry I'm just like dirtying

470
00:22:09,370 --> 00:22:13,449
up this thing for everybody else just so

471
00:22:11,170 --> 00:22:16,120
bad I'm gonna have to buy it up buy

472
00:22:13,450 --> 00:22:17,770
another one for you guys and so like

473
00:22:16,120 --> 00:22:18,909
you're gonna have some some kind of

474
00:22:17,770 --> 00:22:20,560
indicator of compromise that you're

475
00:22:18,910 --> 00:22:21,700
going to want to apply to your network

476
00:22:20,560 --> 00:22:25,149
and your what I want to actually reach

477
00:22:21,700 --> 00:22:26,950
out and and do something to try to find

478
00:22:25,150 --> 00:22:27,820
where that indicator exists it could be

479
00:22:26,950 --> 00:22:30,220
a file

480
00:22:27,820 --> 00:22:31,810
it could be a set a complicated set of

481
00:22:30,220 --> 00:22:33,070
strings it could be it could be a

482
00:22:31,810 --> 00:22:34,000
signature it could be something like

483
00:22:33,070 --> 00:22:35,350
that

484
00:22:34,000 --> 00:22:36,700
and one of the things that we're gonna

485
00:22:35,350 --> 00:22:38,770
talk about is actually just using the

486
00:22:36,700 --> 00:22:40,420
native functionality in windows

487
00:22:38,770 --> 00:22:43,870
administration like PowerShell to

488
00:22:40,420 --> 00:22:45,550
actually reach out and use something

489
00:22:43,870 --> 00:22:47,129
like yarra to actually check for a

490
00:22:45,550 --> 00:22:48,850
signature once you get a piece of

491
00:22:47,130 --> 00:22:50,200
intelligence to your going or an

492
00:22:48,850 --> 00:22:51,639
indicator and you're gonna reach out and

493
00:22:50,200 --> 00:22:53,650
actually use it and then hopefully once

494
00:22:51,640 --> 00:22:55,420
you find something bad you you have a

495
00:22:53,650 --> 00:22:57,700
remediation process or you can kick off

496
00:22:55,420 --> 00:23:00,730
the response process to obviously undo

497
00:22:57,700 --> 00:23:01,990
whatever badness was done there there's

498
00:23:00,730 --> 00:23:04,510
a lot of different places where you can

499
00:23:01,990 --> 00:23:07,120
find open source open source threat

500
00:23:04,510 --> 00:23:08,800
intelligence in one form or another this

501
00:23:07,120 --> 00:23:10,870
is not an exhaustive list this is

502
00:23:08,800 --> 00:23:12,520
basically a list of places to start in

503
00:23:10,870 --> 00:23:14,320
all the different formats that these are

504
00:23:12,520 --> 00:23:16,660
going to give you some semblance of open

505
00:23:14,320 --> 00:23:17,560
source threat intelligence is these are

506
00:23:16,660 --> 00:23:19,030
gonna give it to you in different

507
00:23:17,560 --> 00:23:20,860
formats some are just gonna be big piles

508
00:23:19,030 --> 00:23:22,330
of malware some are going to be blogs

509
00:23:20,860 --> 00:23:23,740
and some are going to be places where

510
00:23:22,330 --> 00:23:25,540
they actually have well-written i/o CS

511
00:23:23,740 --> 00:23:28,390
and such you don't necessarily know

512
00:23:25,540 --> 00:23:29,649
which like it depends on how you're

513
00:23:28,390 --> 00:23:34,150
going to be looking for things this is

514
00:23:29,650 --> 00:23:35,110
just a handful of places to start one of

515
00:23:34,150 --> 00:23:36,520
the things that I'm going to talk about

516
00:23:35,110 --> 00:23:37,510
a little bit today is actually yarra can

517
00:23:36,520 --> 00:23:39,400
you raise your hand if you've ever heard

518
00:23:37,510 --> 00:23:40,780
of Yarra before awesome can you raise

519
00:23:39,400 --> 00:23:42,850
your hand if you've ever used Yarra

520
00:23:40,780 --> 00:23:44,860
before alright that's still good amount

521
00:23:42,850 --> 00:23:46,149
of people um so if you haven't heard of

522
00:23:44,860 --> 00:23:48,820
Yarra before you can kind of think of it

523
00:23:46,150 --> 00:23:50,620
as like grab on crack for binaries it's

524
00:23:48,820 --> 00:23:52,480
basically like if grep became like

525
00:23:50,620 --> 00:23:53,050
self-aware and just like crawled out of

526
00:23:52,480 --> 00:23:55,390
your computer

527
00:23:53,050 --> 00:23:58,020
basically what it does is it's like it's

528
00:23:55,390 --> 00:24:00,100
all month it's you can use very complex

529
00:23:58,020 --> 00:24:02,460
types of logic where you basically

530
00:24:00,100 --> 00:24:05,800
define a bunch of strings or you define

531
00:24:02,460 --> 00:24:07,720
you know binary byte patterns or byte

532
00:24:05,800 --> 00:24:09,129
arrays and then you introduce logic

533
00:24:07,720 --> 00:24:12,250
where you basically say like okay here's

534
00:24:09,130 --> 00:24:14,800
a rule for this this malware family or

535
00:24:12,250 --> 00:24:16,450
this Packer or whatever and then use

536
00:24:14,800 --> 00:24:17,590
you'd name a bunch of conditions in here

537
00:24:16,450 --> 00:24:20,020
and I'll actually show you an example

538
00:24:17,590 --> 00:24:22,179
rule after this but it basically can

539
00:24:20,020 --> 00:24:25,510
scan files on disk or it can scan things

540
00:24:22,180 --> 00:24:28,090
in memory and yarra is really cool

541
00:24:25,510 --> 00:24:30,160
because it's open source it's free it's

542
00:24:28,090 --> 00:24:32,530
great but it is not cool because

543
00:24:30,160 --> 00:24:34,060
signatures are brittle they're not you

544
00:24:32,530 --> 00:24:37,420
know all the bad guys to do is just

545
00:24:34,060 --> 00:24:39,870
change his malware in some some way or

546
00:24:37,420 --> 00:24:41,190
another and your signatures broken

547
00:24:39,870 --> 00:24:42,600
it doesn't work anymore which sucks but

548
00:24:41,190 --> 00:24:44,370
it's free so you get what you pay for

549
00:24:42,600 --> 00:24:47,250
and you can still there's a lot of good

550
00:24:44,370 --> 00:24:48,870
that you can do with it the value that

551
00:24:47,250 --> 00:24:50,700
it really gives you is that if you have

552
00:24:48,870 --> 00:24:53,909
an indicator if you have something if

553
00:24:50,700 --> 00:24:55,500
you have a good yard rule for a bad guy

554
00:24:53,910 --> 00:24:57,630
or a group or a campaign that somebody

555
00:24:55,500 --> 00:24:59,790
knows about the fame formula you can use

556
00:24:57,630 --> 00:25:02,490
yarra to just figure out on a given host

557
00:24:59,790 --> 00:25:04,110
whether the badness that exists is

558
00:25:02,490 --> 00:25:05,520
present or not you just reach out and

559
00:25:04,110 --> 00:25:06,990
you can just check and it gives you the

560
00:25:05,520 --> 00:25:09,720
answer back and you can kind of go from

561
00:25:06,990 --> 00:25:11,820
there um this is an example yar rule so

562
00:25:09,720 --> 00:25:16,070
you can see a little bit that's probably

563
00:25:11,820 --> 00:25:16,070
not big enough to see but that's fine

564
00:25:17,970 --> 00:25:22,800
this is a yar rule for a tool called me

565
00:25:20,250 --> 00:25:24,720
me cats which is a tool that's used both

566
00:25:22,800 --> 00:25:27,629
by kind of red teamers pen testers and

567
00:25:24,720 --> 00:25:29,670
also actual bad guys and it's used to

568
00:25:27,630 --> 00:25:33,390
actually extract plaintext credentials

569
00:25:29,670 --> 00:25:35,820
from memory and it or a couple other

570
00:25:33,390 --> 00:25:37,980
tools that do the same thing it being

571
00:25:35,820 --> 00:25:40,860
present on a host is an indicator of

572
00:25:37,980 --> 00:25:42,360
something bad going on probably it's a

573
00:25:40,860 --> 00:25:43,500
tool that's used it's been written out

574
00:25:42,360 --> 00:25:45,419
before by a lot of different people but

575
00:25:43,500 --> 00:25:47,580
this is just an example the actual

576
00:25:45,420 --> 00:25:49,170
author of the tool wrote a yard

577
00:25:47,580 --> 00:25:51,240
signature for his own tool which is

578
00:25:49,170 --> 00:25:52,650
actually a pretty cool thing to do and

579
00:25:51,240 --> 00:25:54,000
you can see in there it defines a couple

580
00:25:52,650 --> 00:25:55,020
of different byte arrays and then if we

581
00:25:54,000 --> 00:25:56,580
were to go down further it would

582
00:25:55,020 --> 00:25:58,170
actually have the conditions that that

583
00:25:56,580 --> 00:25:59,699
it would look for in a given file but if

584
00:25:58,170 --> 00:26:01,470
you know like oh I'm going to use this

585
00:25:59,700 --> 00:26:04,380
rule I'm going to apply it to an entire

586
00:26:01,470 --> 00:26:06,179
host or to a given directory oh I see me

587
00:26:04,380 --> 00:26:08,280
me cats right there that's definitely

588
00:26:06,179 --> 00:26:10,260
not good and so this is just an example

589
00:26:08,280 --> 00:26:13,320
of kind of what the the makeup of the

590
00:26:10,260 --> 00:26:17,370
the rule is so if you wanted you can you

591
00:26:13,320 --> 00:26:19,550
can use PowerShell native Windows

592
00:26:17,370 --> 00:26:21,959
functionality to actually go out and

593
00:26:19,550 --> 00:26:24,240
transfer the yarra binary over to

594
00:26:21,960 --> 00:26:26,130
another machine and then actually just

595
00:26:24,240 --> 00:26:28,559
remotely execute it against your rule

596
00:26:26,130 --> 00:26:31,080
set and you can do that natively with

597
00:26:28,559 --> 00:26:32,850
PowerShell you can do that with GPO but

598
00:26:31,080 --> 00:26:34,590
basically basically all you're doing is

599
00:26:32,850 --> 00:26:37,320
you know I've got kind of an example

600
00:26:34,590 --> 00:26:39,270
here copying copying the actual yarra

601
00:26:37,320 --> 00:26:41,159
binary to a machine or a set of machines

602
00:26:39,270 --> 00:26:42,929
if you've got like a text file that has

603
00:26:41,160 --> 00:26:44,070
a list of all of the machines on your

604
00:26:42,929 --> 00:26:46,080
network and you're able to authenticate

605
00:26:44,070 --> 00:26:48,210
to those which as we were talking about

606
00:26:46,080 --> 00:26:50,129
before may not always be as easy as I'm

607
00:26:48,210 --> 00:26:51,870
making it sound but that's a battle for

608
00:26:50,130 --> 00:26:53,200
another day and then you copy over a

609
00:26:51,870 --> 00:26:54,459
rules file and then you can be

610
00:26:53,200 --> 00:26:57,360
typically just remotely execute a

611
00:26:54,460 --> 00:26:59,889
command to say hey I want to run this

612
00:26:57,360 --> 00:27:01,689
you're a rule against a folder against

613
00:26:59,889 --> 00:27:05,019
an entire house stir against you know

614
00:27:01,690 --> 00:27:07,029
but just you know any any given location

615
00:27:05,019 --> 00:27:11,289
to try to find if there's some kind of

616
00:27:07,029 --> 00:27:12,639
badness or not this lets you know if you

617
00:27:11,289 --> 00:27:13,899
have a set of rules or if you have a

618
00:27:12,639 --> 00:27:16,479
rule if you're trying to check for

619
00:27:13,899 --> 00:27:19,000
something if there's any badness that

620
00:27:16,480 --> 00:27:20,860
you already know about for example a lot

621
00:27:19,000 --> 00:27:22,389
of the badness that people are going to

622
00:27:20,860 --> 00:27:24,939
detail in some of the open source

623
00:27:22,389 --> 00:27:26,408
intelligence sources that the open

624
00:27:24,940 --> 00:27:28,240
source threat intelligence sources that

625
00:27:26,409 --> 00:27:30,669
I was citing earlier they're not going

626
00:27:28,240 --> 00:27:32,620
to always be talking about the ultra

627
00:27:30,669 --> 00:27:34,600
sexiest of sexy bad guys but they are

628
00:27:32,620 --> 00:27:36,039
going to have some semblance of a

629
00:27:34,600 --> 00:27:39,129
baseline of things that you should have

630
00:27:36,039 --> 00:27:40,960
the ability to check for unfortunately

631
00:27:39,130 --> 00:27:42,580
as I'm sure a lot of people are going to

632
00:27:40,960 --> 00:27:46,230
talk about today malware changes really

633
00:27:42,580 --> 00:27:49,090
fast it's not very hard for a bad guy to

634
00:27:46,230 --> 00:27:51,340
alter their mouth sample their implant

635
00:27:49,090 --> 00:27:53,678
their back door or whatever so that it

636
00:27:51,340 --> 00:27:57,010
kind of fit Nagle's its way around

637
00:27:53,679 --> 00:27:58,779
signatures so signatures are great

638
00:27:57,010 --> 00:28:01,029
they're really useful but they're not

639
00:27:58,779 --> 00:28:04,559
always sufficient and that actually

640
00:28:01,029 --> 00:28:06,940
brings me to my next point

641
00:28:04,559 --> 00:28:08,049
hunting with no intelligence where you

642
00:28:06,940 --> 00:28:12,000
have no idea what you're actually

643
00:28:08,049 --> 00:28:14,320
looking for again of course on the cheap

644
00:28:12,000 --> 00:28:16,320
so one of the things I'm going to talk

645
00:28:14,320 --> 00:28:19,029
about a little bit is auto runs

646
00:28:16,320 --> 00:28:20,590
basically long in the short is there are

647
00:28:19,029 --> 00:28:22,389
as I was saying before there are lots

648
00:28:20,590 --> 00:28:25,120
and lots in different places for you to

649
00:28:22,389 --> 00:28:27,070
look for badness and for you to collect

650
00:28:25,120 --> 00:28:29,768
the data that you're going to use to try

651
00:28:27,070 --> 00:28:31,299
to identify anomalies auto runs is

652
00:28:29,769 --> 00:28:32,889
actually a really great place to start

653
00:28:31,299 --> 00:28:34,269
because an auto run is just

654
00:28:32,889 --> 00:28:35,830
characterized as something that just

655
00:28:34,269 --> 00:28:39,100
starts up when you start your computer

656
00:28:35,830 --> 00:28:41,199
and bad guys really like to hang out

657
00:28:39,100 --> 00:28:42,549
once they compromise your network they

658
00:28:41,200 --> 00:28:44,470
want to stay there they have things that

659
00:28:42,549 --> 00:28:45,940
they want to do they want to have more

660
00:28:44,470 --> 00:28:47,080
evil things they want to be able to come

661
00:28:45,940 --> 00:28:49,000
and go as they please so they're gonna

662
00:28:47,080 --> 00:28:51,158
leave a little treat for you that runs

663
00:28:49,000 --> 00:28:53,320
every time you reboot your machine and

664
00:28:51,159 --> 00:28:55,330
that would be persistence that's gonna

665
00:28:53,320 --> 00:28:57,279
take the form of an auto run and an auto

666
00:28:55,330 --> 00:28:59,289
run can actually take a bunch of

667
00:28:57,279 --> 00:29:01,179
different forms on a windows host you

668
00:28:59,289 --> 00:29:02,680
can I've got a couple of them listed

669
00:29:01,179 --> 00:29:05,050
here the registry

670
00:29:02,680 --> 00:29:07,540
Rawdon run once the different windows

671
00:29:05,050 --> 00:29:09,190
services there's a way that you can

672
00:29:07,540 --> 00:29:11,889
actually you can have drivers do it

673
00:29:09,190 --> 00:29:13,570
there's you can slip into you know like

674
00:29:11,890 --> 00:29:15,790
underneath the operating system and the

675
00:29:13,570 --> 00:29:17,679
in the BIOS and stuff like that there's

676
00:29:15,790 --> 00:29:20,920
a pudgy lien different ways that you can

677
00:29:17,680 --> 00:29:21,970
get something to actually run but you

678
00:29:20,920 --> 00:29:25,090
can actually get a really good

679
00:29:21,970 --> 00:29:27,640
relatively comprehensive picture of the

680
00:29:25,090 --> 00:29:28,750
different auto runs using actually some

681
00:29:27,640 --> 00:29:32,140
really simple tools that I'm going to

682
00:29:28,750 --> 00:29:33,940
talk about today so one of the tools I

683
00:29:32,140 --> 00:29:36,610
thank you oh and if you're actually

684
00:29:33,940 --> 00:29:38,050
looking at doing something like this if

685
00:29:36,610 --> 00:29:40,510
you have the ability to go through and

686
00:29:38,050 --> 00:29:41,950
check identify all the auto runs in your

687
00:29:40,510 --> 00:29:45,250
network it's actually really really

688
00:29:41,950 --> 00:29:48,760
effective you like I said looking at

689
00:29:45,250 --> 00:29:50,770
anomalies in Auto runs does just it

690
00:29:48,760 --> 00:29:52,510
doesn't necessarily mean that something

691
00:29:50,770 --> 00:29:54,310
is bad but it does mean that something

692
00:29:52,510 --> 00:29:55,870
is weird and if something is weird then

693
00:29:54,310 --> 00:30:01,389
there's a good chance that it's going to

694
00:29:55,870 --> 00:30:02,979
be bad so one of the tools I'm going to

695
00:30:01,390 --> 00:30:05,530
talk about is actually sysinternals Auto

696
00:30:02,980 --> 00:30:08,110
runs super super super useful it's a

697
00:30:05,530 --> 00:30:11,760
tool from Microsoft and it enumerates

698
00:30:08,110 --> 00:30:13,750
like time at tiny different places where

699
00:30:11,760 --> 00:30:16,030
something is actually starting up

700
00:30:13,750 --> 00:30:19,180
something is running automatically both

701
00:30:16,030 --> 00:30:21,220
with service start ups or service Auto

702
00:30:19,180 --> 00:30:23,680
runs the registry Auto runs that we were

703
00:30:21,220 --> 00:30:25,570
talking about before drivers lots of

704
00:30:23,680 --> 00:30:27,550
different things like that if you just

705
00:30:25,570 --> 00:30:30,610
run it with all options enabled it'll

706
00:30:27,550 --> 00:30:31,870
give you like I mean it's it's normal to

707
00:30:30,610 --> 00:30:33,729
see like what like a hundred different

708
00:30:31,870 --> 00:30:35,889
things come out but you can filter it

709
00:30:33,730 --> 00:30:38,380
down based on a slightly simpler things

710
00:30:35,890 --> 00:30:41,020
like if you just want service service

711
00:30:38,380 --> 00:30:42,340
Auto runs or if you just want you know

712
00:30:41,020 --> 00:30:43,870
user level Auto runs or someone

713
00:30:42,340 --> 00:30:45,310
something like that one of the really

714
00:30:43,870 --> 00:30:47,229
nice things about system journals auto

715
00:30:45,310 --> 00:30:49,870
runs is that it will actually also hash

716
00:30:47,230 --> 00:30:52,210
the auto runs for you so it'll wrap

717
00:30:49,870 --> 00:30:54,879
it'll take the files that everything's

718
00:30:52,210 --> 00:30:56,710
pointing to and it'll shot 256 it or

719
00:30:54,880 --> 00:30:58,090
whatever and it will it can

720
00:30:56,710 --> 00:30:59,620
automatically like shoot them off to

721
00:30:58,090 --> 00:31:01,360
virustotal for you to just go ahead and

722
00:30:59,620 --> 00:31:02,709
say like oh it's kind of like Clippy

723
00:31:01,360 --> 00:31:04,120
looks like you're looking for badness

724
00:31:02,710 --> 00:31:06,370
like you want me to go ahead and check

725
00:31:04,120 --> 00:31:08,050
virustotal for you sure so you can do

726
00:31:06,370 --> 00:31:09,969
that and it's actually really useful um

727
00:31:08,050 --> 00:31:12,190
you can actually like I was saying

728
00:31:09,970 --> 00:31:14,090
before you can use Auto runs to natively

729
00:31:12,190 --> 00:31:15,920
shoot stuff or you

730
00:31:14,090 --> 00:31:17,929
autoruns to automatically shoot stuff

731
00:31:15,920 --> 00:31:19,040
over to virustotal but you can do the

732
00:31:17,930 --> 00:31:21,950
similar thing that I was talking about

733
00:31:19,040 --> 00:31:25,040
before with using a yard signature when

734
00:31:21,950 --> 00:31:27,050
you have when you have a bunch of hosts

735
00:31:25,040 --> 00:31:28,820
and you have a yard signature and you

736
00:31:27,050 --> 00:31:30,440
want to apply that to a bunch of

737
00:31:28,820 --> 00:31:32,590
different places you can actually do the

738
00:31:30,440 --> 00:31:35,030
same thing with auto runs and the

739
00:31:32,590 --> 00:31:36,290
dependency dll you just copied them over

740
00:31:35,030 --> 00:31:39,410
to the systems that you want to run on

741
00:31:36,290 --> 00:31:41,120
if you have the ability to do so and you

742
00:31:39,410 --> 00:31:42,830
can actually run that to enumerate all

743
00:31:41,120 --> 00:31:44,270
of the different auto runs on that

744
00:31:42,830 --> 00:31:46,250
particular machine and then you can pull

745
00:31:44,270 --> 00:31:47,600
all of that data back and you can start

746
00:31:46,250 --> 00:31:50,510
stacking it up together using some

747
00:31:47,600 --> 00:31:53,000
really really simple just command

748
00:31:50,510 --> 00:31:56,629
command line one-liners to actually do

749
00:31:53,000 --> 00:32:00,650
the actual you know and text

750
00:31:56,630 --> 00:32:01,820
manipulation to find anomalies you can

751
00:32:00,650 --> 00:32:03,590
take all of these and you can submit

752
00:32:01,820 --> 00:32:05,689
them to virustotal if anything comes

753
00:32:03,590 --> 00:32:08,000
back from virustotal you know it's and

754
00:32:05,690 --> 00:32:09,320
it's bad than you know alright that's a

755
00:32:08,000 --> 00:32:11,930
good place for me to go ahead and start

756
00:32:09,320 --> 00:32:13,460
looking for badness or you can build

757
00:32:11,930 --> 00:32:15,020
something yourself that uses the

758
00:32:13,460 --> 00:32:17,030
virustotal api you don't necessarily

759
00:32:15,020 --> 00:32:20,690
have to use sysinternals auto runs to do

760
00:32:17,030 --> 00:32:23,090
this so if you were to do that if you

761
00:32:20,690 --> 00:32:24,890
were to run auto runs get hashes on a

762
00:32:23,090 --> 00:32:26,179
bunch a bunch of different hosts on your

763
00:32:24,890 --> 00:32:27,890
machine like we were talking about pull

764
00:32:26,180 --> 00:32:30,350
all the data back and then you were to

765
00:32:27,890 --> 00:32:33,230
sort it in in just a way you would have

766
00:32:30,350 --> 00:32:36,230
a script sorts it in terms of IP address

767
00:32:33,230 --> 00:32:38,000
or hostname and hashes of the actual

768
00:32:36,230 --> 00:32:41,570
auto run items and your put it in this

769
00:32:38,000 --> 00:32:43,550
format you can stack stuff up in such a

770
00:32:41,570 --> 00:32:46,189
way where you're like okay let me sort

771
00:32:43,550 --> 00:32:49,340
things out and then unique everything

772
00:32:46,190 --> 00:32:50,720
together so that I just have it reduces

773
00:32:49,340 --> 00:32:52,300
everything and puts a little number next

774
00:32:50,720 --> 00:32:55,130
to it of all those different occurrences

775
00:32:52,300 --> 00:32:57,379
and then I see everything in a

776
00:32:55,130 --> 00:32:59,630
descending order you'll see that okay

777
00:32:57,380 --> 00:33:02,570
for these top you know whatever 10 items

778
00:32:59,630 --> 00:33:05,600
all 42 of the machines that I saw had

779
00:33:02,570 --> 00:33:06,679
that same start up item great same with

780
00:33:05,600 --> 00:33:08,360
the next one and the next one of the

781
00:33:06,680 --> 00:33:10,100
next one but then at the bottom too for

782
00:33:08,360 --> 00:33:13,820
some reason there's only one occurrence

783
00:33:10,100 --> 00:33:15,290
of both of those hashes in the end the

784
00:33:13,820 --> 00:33:17,419
network once I've actually reduced this

785
00:33:15,290 --> 00:33:19,820
data together like what is that and so

786
00:33:17,420 --> 00:33:23,840
you can go back and you'd grab again sir

787
00:33:19,820 --> 00:33:25,970
you control F to find you know what

788
00:33:23,840 --> 00:33:27,659
which host was this autorad was this

789
00:33:25,970 --> 00:33:29,160
hash

790
00:33:27,660 --> 00:33:30,840
autorun item two and you can see okay

791
00:33:29,160 --> 00:33:33,540
it's this house right here and then you

792
00:33:30,840 --> 00:33:35,189
go back and you'd find that file and

793
00:33:33,540 --> 00:33:36,960
you're in the raw data and you'd say hey

794
00:33:35,190 --> 00:33:38,640
what is this and you go through and you

795
00:33:36,960 --> 00:33:41,070
look at it you're like oh holy crap this

796
00:33:38,640 --> 00:33:43,260
for some reason this version of VMware

797
00:33:41,070 --> 00:33:46,080
tools has a different hash from all the

798
00:33:43,260 --> 00:33:47,760
other ones is this is did somebody

799
00:33:46,080 --> 00:33:49,470
actually backdoor this binary is this

800
00:33:47,760 --> 00:33:51,060
just a different version of the binary I

801
00:33:49,470 --> 00:33:52,460
found something weird and you can

802
00:33:51,060 --> 00:33:55,230
actually move from there using no

803
00:33:52,460 --> 00:33:58,470
signatures whatsoever just some kind of

804
00:33:55,230 --> 00:34:00,390
just Auto it's basically anomaly

805
00:33:58,470 --> 00:34:07,170
detection of autorun items in your

806
00:34:00,390 --> 00:34:12,060
network yes the question is do we have

807
00:34:07,170 --> 00:34:14,610
any metal glue have any methodology on

808
00:34:12,060 --> 00:34:17,668
fuzzy hashes what do you mean

809
00:34:14,610 --> 00:34:21,630
methodology so they're using fuzzy

810
00:34:17,668 --> 00:34:24,839
hashes right so fuzzy hashes for some of

811
00:34:21,630 --> 00:34:26,610
them are a huge pain on Windows like for

812
00:34:24,840 --> 00:34:28,790
example getting like SS deep to work

813
00:34:26,610 --> 00:34:32,190
programmatically on Windows sucks

814
00:34:28,790 --> 00:34:33,779
because they give you like a premade

815
00:34:32,190 --> 00:34:35,280
binary that you can use but there's no

816
00:34:33,780 --> 00:34:38,280
like programmatic way to use it on

817
00:34:35,280 --> 00:34:41,370
Windows for background SST is a hash

818
00:34:38,280 --> 00:34:43,620
that basically lets you find instead of

819
00:34:41,370 --> 00:34:45,330
with for example an md5 or sha-1 where

820
00:34:43,620 --> 00:34:47,429
if you change one byte it changed the

821
00:34:45,330 --> 00:34:49,290
entire hash completely a fuzzy hash is

822
00:34:47,429 --> 00:34:51,510
more malleable if you change one byte it

823
00:34:49,290 --> 00:34:52,860
doesn't change the entire hash it maybe

824
00:34:51,510 --> 00:34:56,400
changes one part of the hatch and that

825
00:34:52,860 --> 00:34:59,940
lets you find file similarity that's I

826
00:34:56,400 --> 00:35:01,260
think more useful if you have fuzzy hash

827
00:34:59,940 --> 00:35:03,330
of a piece of malware and you want to

828
00:35:01,260 --> 00:35:06,450
find other malware of the same family

829
00:35:03,330 --> 00:35:08,910
that's really similar but I don't think

830
00:35:06,450 --> 00:35:11,490
it's going to be I'm not sure that it

831
00:35:08,910 --> 00:35:14,190
would be as useful if you fuzzy hash all

832
00:35:11,490 --> 00:35:16,919
of the autoruns for example in your

833
00:35:14,190 --> 00:35:19,410
environment I don't know I'd have to go

834
00:35:16,920 --> 00:35:21,840
back and look to to figure out the value

835
00:35:19,410 --> 00:35:24,000
of that but I think it's the majority of

836
00:35:21,840 --> 00:35:26,190
the value is going to be I get a fuzzy

837
00:35:24,000 --> 00:35:28,050
hash for something that's bad I'm going

838
00:35:26,190 --> 00:35:30,570
to try to find things in the same family

839
00:35:28,050 --> 00:35:32,280
that are similar to that kind of bad if

840
00:35:30,570 --> 00:35:34,140
that makes any sense there will be a

841
00:35:32,280 --> 00:35:35,830
fight between Jessica bloom and Andrew

842
00:35:34,140 --> 00:35:39,819
at once

843
00:35:35,830 --> 00:35:45,490
hi I'm Jessica loom I wrote SST I'm

844
00:35:39,820 --> 00:35:48,520
sorry two things one I disagree with you

845
00:35:45,490 --> 00:35:49,689
there is an API for SST and we can talk

846
00:35:48,520 --> 00:35:53,890
afterwards I'm gonna show you how to use

847
00:35:49,690 --> 00:35:56,350
I'd love to but secondly I completely

848
00:35:53,890 --> 00:35:58,960
agree with you that SST isn't very good

849
00:35:56,350 --> 00:36:01,180
for looking for known for this kind of

850
00:35:58,960 --> 00:36:04,720
problem because the variants that you'll

851
00:36:01,180 --> 00:36:06,759
find of known good files are other known

852
00:36:04,720 --> 00:36:09,129
good files so you'll find the next

853
00:36:06,760 --> 00:36:12,300
version of whatever DLL or utility

854
00:36:09,130 --> 00:36:15,820
sharing are you really okay thank you

855
00:36:12,300 --> 00:36:22,780
thank you for being here thank you for

856
00:36:15,820 --> 00:36:23,710
all your work so and extra credit from

857
00:36:22,780 --> 00:36:24,820
some of the stuff I was talking about

858
00:36:23,710 --> 00:36:26,200
you can do this penny number of

859
00:36:24,820 --> 00:36:30,790
technologies but taking all the auto

860
00:36:26,200 --> 00:36:32,470
runs oh well you can just pretend that

861
00:36:30,790 --> 00:36:35,410
there's a slide here that has the

862
00:36:32,470 --> 00:36:37,359
elasticsearch logo and login the shirt

863
00:36:35,410 --> 00:36:39,069
is you know extra credit take all of the

864
00:36:37,360 --> 00:36:40,030
auto runs that you have over time dump

865
00:36:39,070 --> 00:36:41,710
them into something like an elastic

866
00:36:40,030 --> 00:36:42,910
search cluster or a database or

867
00:36:41,710 --> 00:36:45,520
something like that just look at how

868
00:36:42,910 --> 00:36:48,520
they they evolve over time and basically

869
00:36:45,520 --> 00:36:51,640
this gives you the ability to say to go

870
00:36:48,520 --> 00:36:54,340
back and say oh you know did I ever have

871
00:36:51,640 --> 00:36:56,890
this particular you know this particular

872
00:36:54,340 --> 00:36:58,480
item in an auto run ever or when did

873
00:36:56,890 --> 00:37:01,540
this change happen in my environment so

874
00:36:58,480 --> 00:37:02,890
on and so forth and yeah so that's

875
00:37:01,540 --> 00:37:07,029
that's extra credit for hunting on the

876
00:37:02,890 --> 00:37:09,129
house with that back to Jamie can you

877
00:37:07,030 --> 00:37:10,420
hold on one sec I'll just do the

878
00:37:09,130 --> 00:37:13,480
concluding remarks and then we'll go to

879
00:37:10,420 --> 00:37:15,430
QA so you know we've talked about a few

880
00:37:13,480 --> 00:37:19,030
ways that you can hunt both or network

881
00:37:15,430 --> 00:37:20,770
data and host data you know it's not

882
00:37:19,030 --> 00:37:22,630
exhaustive list but it should be enough

883
00:37:20,770 --> 00:37:24,970
to help get you going

884
00:37:22,630 --> 00:37:26,380
we're around the next two days for

885
00:37:24,970 --> 00:37:30,279
questions and so forth if you want to

886
00:37:26,380 --> 00:37:32,140
talk you know we try to present some of

887
00:37:30,280 --> 00:37:35,380
the things that we found useful in our

888
00:37:32,140 --> 00:37:36,779
work and our research we're also doing

889
00:37:35,380 --> 00:37:39,250
some stuff that we want to talk about

890
00:37:36,780 --> 00:37:40,900
that was I believe may be in the

891
00:37:39,250 --> 00:37:42,910
abstract but we didn't get a chance to

892
00:37:40,900 --> 00:37:45,520
talk about today and that is something

893
00:37:42,910 --> 00:37:47,710
we call Faraday so Andrew will kick me

894
00:37:45,520 --> 00:37:49,130
but it's his his project I call it a

895
00:37:47,710 --> 00:37:52,849
global honey net

896
00:37:49,130 --> 00:37:54,230
says no but that's it's there on the

897
00:37:52,849 --> 00:37:55,819
internet getting attacked all the time

898
00:37:54,230 --> 00:37:58,220
and we get a lot of really useful data

899
00:37:55,819 --> 00:38:00,558
around that and so that enables our

900
00:37:58,220 --> 00:38:02,990
hunting as well it's kind of like an an

901
00:38:00,559 --> 00:38:05,150
IOC for bad things like that IPS are bad

902
00:38:02,990 --> 00:38:07,430
two sets dropped on our honey net once

903
00:38:05,150 --> 00:38:08,900
an attacker compromises it so if you

904
00:38:07,430 --> 00:38:13,328
want to talk about that with him after

905
00:38:08,900 --> 00:38:13,329
the after the talk come up to Andrew

906
00:38:13,569 --> 00:38:24,460
maybe the slides will change this is

907
00:38:20,779 --> 00:38:29,660
really crap yes oh don't do a build out

908
00:38:24,460 --> 00:38:32,269
endgame kind of the hunting cycle um it

909
00:38:29,660 --> 00:38:35,180
includes surveying the network securing

910
00:38:32,269 --> 00:38:36,669
your hunting ground detecting the

911
00:38:35,180 --> 00:38:40,640
anomalies and so forth

912
00:38:36,670 --> 00:38:41,829
also surgical so if you're interested in

913
00:38:40,640 --> 00:38:45,140
hearing about that

914
00:38:41,829 --> 00:38:47,390
lyndon brown has a luncheon learn

915
00:38:45,140 --> 00:38:51,049
tomorrow where he'll go into a little

916
00:38:47,390 --> 00:38:53,720
bit of that hunt methodology and with

917
00:38:51,049 --> 00:38:56,980
that we're at the end and so we'll take

918
00:38:53,720 --> 00:38:56,980
any QA that you have

