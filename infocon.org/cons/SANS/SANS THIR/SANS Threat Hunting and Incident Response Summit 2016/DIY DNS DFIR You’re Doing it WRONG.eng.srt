1
00:00:14,070 --> 00:00:18,340
so my name is Andrew hey I am the chief

2
00:00:16,960 --> 00:00:19,119
information security officer at data'

3
00:00:18,340 --> 00:00:21,849
gravity

4
00:00:19,119 --> 00:00:25,180
what's funny is I've only been in that

5
00:00:21,849 --> 00:00:28,869
role since January 4th and as the

6
00:00:25,180 --> 00:00:34,600
speakers know Jennifer really pushes you

7
00:00:28,869 --> 00:00:36,250
hard to submit so I was still at OpenDNS

8
00:00:34,600 --> 00:00:37,660
where as the director of research when I

9
00:00:36,250 --> 00:00:39,700
came up with this idea it's like Oh

10
00:00:37,660 --> 00:00:43,328
threat hunting I was talking a lot about

11
00:00:39,700 --> 00:00:46,390
DNS and threat hunting from that respect

12
00:00:43,329 --> 00:00:47,949
and they all submit something on this

13
00:00:46,390 --> 00:00:50,859
and then I left and went to new company

14
00:00:47,949 --> 00:00:52,300
so I had to retain some of this

15
00:00:50,859 --> 00:00:54,339
knowledge with the great thing is that

16
00:00:52,300 --> 00:00:55,989
after this I can just drink it all away

17
00:00:54,339 --> 00:01:00,550
because I will not need this information

18
00:00:55,989 --> 00:01:02,440
again in the future I was also at cloud

19
00:01:00,550 --> 00:01:06,729
passage that's why Rob calls me mr.

20
00:01:02,440 --> 00:01:09,580
cloud before that I was a dirty industry

21
00:01:06,729 --> 00:01:11,620
analyst at four or five one research so

22
00:01:09,580 --> 00:01:12,908
I would talk to all the vendors and tell

23
00:01:11,620 --> 00:01:15,159
them how what they were doing was not a

24
00:01:12,909 --> 00:01:16,540
good idea and they would say oh that's

25
00:01:15,159 --> 00:01:20,470
right Andrew and then completely ignore

26
00:01:16,540 --> 00:01:23,020
me it was awesome yeah wrote a bunch of

27
00:01:20,470 --> 00:01:24,429
books you've not read any of them you've

28
00:01:23,020 --> 00:01:28,390
heard of the products in them but you've

29
00:01:24,430 --> 00:01:33,010
not read any of them I blogged fairly

30
00:01:28,390 --> 00:01:36,370
erratically sporadically and going back

31
00:01:33,010 --> 00:01:39,490
to the question of the Air Force and the

32
00:01:36,370 --> 00:01:43,060
Navy launching the same time it's hard

33
00:01:39,490 --> 00:01:44,919
to coordinate a tactical strike from the

34
00:01:43,060 --> 00:01:52,300
PX Rob so the Air Force wouldn't have

35
00:01:44,920 --> 00:01:54,570
gotten there before the Navy yeah I'm

36
00:01:52,300 --> 00:01:54,570
out

37
00:01:57,060 --> 00:02:02,950
hey we have the most well defended mall

38
00:02:00,550 --> 00:02:04,539
in North America I'll have you know we

39
00:02:02,950 --> 00:02:08,560
have three submarines in the West

40
00:02:04,540 --> 00:02:10,929
Edmonton Mall so I'm gonna talk about

41
00:02:08,560 --> 00:02:12,550
DNS obviously one of the oldest

42
00:02:10,929 --> 00:02:14,860
protocols out there one of the things

43
00:02:12,550 --> 00:02:17,550
that we take for granted but from a

44
00:02:14,860 --> 00:02:20,500
threat hunting perspective very very

45
00:02:17,550 --> 00:02:22,480
useful one of those things kind of like

46
00:02:20,500 --> 00:02:25,930
peak apps that you wish you had after

47
00:02:22,480 --> 00:02:29,619
the fact the difference is I find that

48
00:02:25,930 --> 00:02:34,870
DNS from a logging perspective much

49
00:02:29,620 --> 00:02:37,030
easier to retain and first smaller of

50
00:02:34,870 --> 00:02:38,830
the storage footprint after the fact I'm

51
00:02:37,030 --> 00:02:41,350
gonna give you a great world real-world

52
00:02:38,830 --> 00:02:43,300
example that might make you think wow

53
00:02:41,350 --> 00:02:48,700
this guy's gonna screw over my company

54
00:02:43,300 --> 00:02:51,550
with and our printers which I'm a CMA a

55
00:02:48,700 --> 00:02:53,140
drink side of tonight and then I'll tell

56
00:02:51,550 --> 00:02:55,660
you about some tools because this is

57
00:02:53,140 --> 00:02:58,290
only this is what Rob two hours to our

58
00:02:55,660 --> 00:03:00,579
talk yeah awesome

59
00:02:58,290 --> 00:03:01,920
I've been constrained to twenty minutes

60
00:03:00,580 --> 00:03:07,690
I don't know what I'm gonna do

61
00:03:01,920 --> 00:03:08,980
so DNS who here knows what DNS is three

62
00:03:07,690 --> 00:03:14,260
people all right cool

63
00:03:08,980 --> 00:03:15,480
so yeah one in the back all right

64
00:03:14,260 --> 00:03:19,899
awesome

65
00:03:15,480 --> 00:03:21,790
so very very high level and you know

66
00:03:19,900 --> 00:03:23,410
don't feel bad if you're if you're not

67
00:03:21,790 --> 00:03:24,489
familiar with DNS it's just one of those

68
00:03:23,410 --> 00:03:30,340
things that kind of happens on the

69
00:03:24,489 --> 00:03:32,140
internet like cats DNS allows you to

70
00:03:30,340 --> 00:03:34,330
have a common name to type in gives you

71
00:03:32,140 --> 00:03:37,268
an IP address in return to tell you how

72
00:03:34,330 --> 00:03:40,480
to get somewhere now there's always a

73
00:03:37,269 --> 00:03:43,209
there's always a lot of confusion

74
00:03:40,480 --> 00:03:47,100
against recursive versus authoritative

75
00:03:43,209 --> 00:03:47,100
DNS does anyone know the difference

76
00:03:47,760 --> 00:03:53,140
no one all right so well because no one

77
00:03:51,280 --> 00:03:58,380
knows well we'll go on and I'll explain

78
00:03:53,140 --> 00:04:00,910
it so recursive DNS and I used Open DNS

79
00:03:58,380 --> 00:04:03,280
because I work there and it's easier and

80
00:04:00,910 --> 00:04:06,640
I I'm one of like 10 people can remember

81
00:04:03,280 --> 00:04:08,670
the IP addresses so it's really

82
00:04:06,640 --> 00:04:11,649
responsible provide

83
00:04:08,670 --> 00:04:13,510
the proper IP address so you query

84
00:04:11,650 --> 00:04:15,730
something says hey I know where that is

85
00:04:13,510 --> 00:04:18,940
here you go now if it doesn't know where

86
00:04:15,730 --> 00:04:20,048
that particular location is then it'll

87
00:04:18,940 --> 00:04:22,960
start going up to the authoritative

88
00:04:20,048 --> 00:04:26,979
nameservers so it'll start checking okay

89
00:04:22,960 --> 00:04:29,159
who has calm okay calm baba and all the

90
00:04:26,980 --> 00:04:32,470
pointers this is how the internet works

91
00:04:29,160 --> 00:04:35,160
I'm not gonna you know this is I guess

92
00:04:32,470 --> 00:04:39,250
the first chapter of the sis

93
00:04:35,160 --> 00:04:41,830
presentation but just so you know keep

94
00:04:39,250 --> 00:04:44,830
this in mind when you're thinking of how

95
00:04:41,830 --> 00:04:47,979
important would it be to record the

96
00:04:44,830 --> 00:04:50,789
information from the client computer to

97
00:04:47,980 --> 00:04:56,490
the websites that the client service

98
00:04:50,790 --> 00:05:00,700
individual file is trying to connect to

99
00:04:56,490 --> 00:05:02,230
so why is it why is it valuable well if

100
00:05:00,700 --> 00:05:03,490
I was still working for a DNS company

101
00:05:02,230 --> 00:05:06,790
you might say oh because you want to

102
00:05:03,490 --> 00:05:08,410
sell me product well no I was in

103
00:05:06,790 --> 00:05:12,610
research so I couldn't sell you a damn

104
00:05:08,410 --> 00:05:15,850
thing even if I want to do I'm very big

105
00:05:12,610 --> 00:05:19,330
on forensic timelines and I took that

106
00:05:15,850 --> 00:05:22,120
knowledge and applied it to network

107
00:05:19,330 --> 00:05:25,210
based traffic specifically DNS because I

108
00:05:22,120 --> 00:05:28,450
want to know what happened from A to B

109
00:05:25,210 --> 00:05:30,549
to C the deed e to F all the way to the

110
00:05:28,450 --> 00:05:32,530
end I want to know when I'm doing an

111
00:05:30,550 --> 00:05:34,990
investigation what is the scope of my

112
00:05:32,530 --> 00:05:37,780
investigation I used to work at a

113
00:05:34,990 --> 00:05:39,130
university in Western Canada where they

114
00:05:37,780 --> 00:05:43,059
don't here ever worked in higher ed

115
00:05:39,130 --> 00:05:43,930
we're still working higher ed did this

116
00:05:43,060 --> 00:05:46,900
ever happen to you

117
00:05:43,930 --> 00:05:48,550
where you come in I had an office I

118
00:05:46,900 --> 00:05:51,400
don't know why that an office I came in

119
00:05:48,550 --> 00:05:54,190
and as I'm coming to the door there was

120
00:05:51,400 --> 00:05:56,919
a guy with a pallet of workstations

121
00:05:54,190 --> 00:06:01,240
on their side there's about 30 or 40 of

122
00:05:56,919 --> 00:06:03,210
them and he's like we had a what we

123
00:06:01,240 --> 00:06:07,060
believe to be a child exploitation

124
00:06:03,210 --> 00:06:11,260
incident in the lab here are all the

125
00:06:07,060 --> 00:06:13,110
workstations from that lab let me know

126
00:06:11,260 --> 00:06:15,180
what you find

127
00:06:13,110 --> 00:06:17,669
the unlocks no we don't have locks but

128
00:06:15,180 --> 00:06:20,360
they're here it's got to be here it was

129
00:06:17,669 --> 00:06:24,359
on one of these machines in this lab

130
00:06:20,360 --> 00:06:27,659
doesn't really narrow the scope not

131
00:06:24,360 --> 00:06:29,659
great so same thing with DNS hey

132
00:06:27,659 --> 00:06:32,639
something happened and there was network

133
00:06:29,659 --> 00:06:34,289
network e stuff involved oh do you know

134
00:06:32,639 --> 00:06:36,810
when it started no do you know what it

135
00:06:34,289 --> 00:06:40,378
ended I know when I reported it to you

136
00:06:36,810 --> 00:06:42,300
does that help no no well I guess it's

137
00:06:40,379 --> 00:06:45,840
the start of a timeline and they would

138
00:06:42,300 --> 00:06:49,349
taken any management courses negotiation

139
00:06:45,840 --> 00:06:52,020
courses especially negotiation ones they

140
00:06:49,349 --> 00:06:53,430
always tell you to set anchors so when

141
00:06:52,020 --> 00:06:56,159
you're going to negotiate for something

142
00:06:53,430 --> 00:07:00,830
on price you have what in your head is

143
00:06:56,159 --> 00:07:04,500
the walkaway price I'd be a good picture

144
00:07:00,830 --> 00:07:06,628
and then the other person on the side of

145
00:07:04,500 --> 00:07:07,919
negotiation has in their head what

146
00:07:06,629 --> 00:07:09,900
they're willing to walk away those are

147
00:07:07,919 --> 00:07:12,120
the anchors so everything in between

148
00:07:09,900 --> 00:07:14,460
there is your negotiation price so you

149
00:07:12,120 --> 00:07:17,879
have or your negotiable price you have

150
00:07:14,460 --> 00:07:20,520
set the anchor of which this transaction

151
00:07:17,879 --> 00:07:23,599
may or may not occur and the same thing

152
00:07:20,520 --> 00:07:26,969
applies to any sort of incident response

153
00:07:23,599 --> 00:07:29,400
activity because it's always good to

154
00:07:26,969 --> 00:07:31,440
know how far back you have to go and how

155
00:07:29,400 --> 00:07:33,810
far forward you have to go otherwise

156
00:07:31,440 --> 00:07:35,729
you're gonna be imaging every single

157
00:07:33,810 --> 00:07:38,279
machine that arrived on that pallet in

158
00:07:35,729 --> 00:07:39,719
the hopes of finding something by the

159
00:07:38,279 --> 00:07:41,430
way there was no information on those

160
00:07:39,719 --> 00:07:43,319
servers are on those workstations on the

161
00:07:41,430 --> 00:07:46,279
pallet because they re images themselves

162
00:07:43,319 --> 00:07:48,839
every time someone logged in like that

163
00:07:46,279 --> 00:07:55,589
so I say DNS is probably the most

164
00:07:48,839 --> 00:07:58,169
overlooked and undervalued asset we have

165
00:07:55,589 --> 00:08:01,400
from an indicator perspective mainly

166
00:07:58,169 --> 00:08:03,628
because not a lot of people capture it

167
00:08:01,400 --> 00:08:06,929
so these are just some of the things

168
00:08:03,629 --> 00:08:08,909
that when I think of what I could use

169
00:08:06,930 --> 00:08:12,740
DNS for come to mind

170
00:08:08,909 --> 00:08:15,719
so what domains are looked at by humans

171
00:08:12,740 --> 00:08:17,699
was there a human actually using that

172
00:08:15,719 --> 00:08:22,620
machine at 3:00 in the morning when that

173
00:08:17,699 --> 00:08:23,719
system was calling out to XYZ fk9 dot

174
00:08:22,620 --> 00:08:26,399
info

175
00:08:23,719 --> 00:08:26,849
probably not hopefully not why would any

176
00:08:26,399 --> 00:08:28,050
human ever

177
00:08:26,849 --> 00:08:30,869
type that in we'll get to that in a

178
00:08:28,050 --> 00:08:34,049
minute what parts of the world were they

179
00:08:30,869 --> 00:08:36,930
query does the IP address map to that

180
00:08:34,049 --> 00:08:37,348
particular part of the world maybe maybe

181
00:08:36,929 --> 00:08:41,120
not

182
00:08:37,349 --> 00:08:42,709
as we know geolocation 100% accurate

183
00:08:41,120 --> 00:08:44,819
uh-huh

184
00:08:42,708 --> 00:08:47,189
there was actually a story in the paper

185
00:08:44,819 --> 00:08:49,170
the other day about that one firm in

186
00:08:47,190 --> 00:08:52,100
Nebraska that everyone keeps showing up

187
00:08:49,170 --> 00:08:54,750
at or it's like the geographic center of

188
00:08:52,100 --> 00:08:56,190
the universe and they're getting sick of

189
00:08:54,750 --> 00:09:02,009
people coming by and saying hey what the

190
00:08:56,190 --> 00:09:04,440
hell all right subsequent redirects

191
00:09:02,009 --> 00:09:08,069
that's important again the time line I

192
00:09:04,440 --> 00:09:10,860
went from A to B it sent me to see that

193
00:09:08,069 --> 00:09:15,569
downloaded some match I'm ruining it I

194
00:09:10,860 --> 00:09:18,690
won't read ahead sometimes you'll see

195
00:09:15,569 --> 00:09:22,259
queries to non-existent websites not

196
00:09:18,690 --> 00:09:25,440
exist in domains that's sketchy and I

197
00:09:22,259 --> 00:09:27,060
can tell you why in a bit there's

198
00:09:25,440 --> 00:09:30,149
probably my fate most favorite Simpsons

199
00:09:27,060 --> 00:09:32,609
scene ever read that he's wearing the

200
00:09:30,149 --> 00:09:36,420
muumuu and walking around your fingers

201
00:09:32,610 --> 00:09:38,339
are too fat so domain generation

202
00:09:36,420 --> 00:09:39,269
algorithm when I'm talking about the

203
00:09:38,339 --> 00:09:41,579
ridiculous

204
00:09:39,269 --> 00:09:47,689
types of domains that no human should

205
00:09:41,579 --> 00:09:51,800
ever type I refer to DJs so it is a

206
00:09:47,689 --> 00:09:55,529
computer created domain that is

207
00:09:51,800 --> 00:09:58,949
available and has not yet been

208
00:09:55,529 --> 00:10:01,699
registered so we will usually see a seed

209
00:09:58,949 --> 00:10:07,170
based on date/time stamp

210
00:10:01,699 --> 00:10:10,339
sports team you name it and really it

211
00:10:07,170 --> 00:10:12,300
allows for rapid deployment of malware

212
00:10:10,339 --> 00:10:14,550
without having to set up your

213
00:10:12,300 --> 00:10:16,349
infrastructure ahead of time because if

214
00:10:14,550 --> 00:10:19,410
we're generating these within the

215
00:10:16,350 --> 00:10:22,019
application on a seed that is time when

216
00:10:19,410 --> 00:10:23,219
it hits on a certain day well then we

217
00:10:22,019 --> 00:10:25,199
have another script that's just gonna go

218
00:10:23,220 --> 00:10:28,680
register a thousand domains for the

219
00:10:25,199 --> 00:10:32,279
scene see it's very cost effective these

220
00:10:28,680 --> 00:10:35,880
criminals so smart so here's a great

221
00:10:32,279 --> 00:10:37,889
example from Talos and this which one is

222
00:10:35,880 --> 00:10:43,799
this this is the

223
00:10:37,889 --> 00:10:46,079
dier dier dier / grayza this is how the

224
00:10:43,799 --> 00:10:50,749
DGA is constructed so it's taking seeds

225
00:10:46,079 --> 00:10:53,399
it's taking the date time creating hash

226
00:10:50,749 --> 00:10:59,069
rearranging the alphabet but what you're

227
00:10:53,399 --> 00:11:03,779
gonna see is that q1 42 B 3 3 6 6 d8 8

228
00:10:59,069 --> 00:11:06,059
blah blah blah dot C C would anyone look

229
00:11:03,779 --> 00:11:07,799
at this and say hey that's probably not

230
00:11:06,059 --> 00:11:11,100
something someone's gonna be going to or

231
00:11:07,799 --> 00:11:14,220
should they be going to first indicator

232
00:11:11,100 --> 00:11:15,869
should be dot C see that's that there's

233
00:11:14,220 --> 00:11:18,889
certain things with regards to DNS that

234
00:11:15,869 --> 00:11:23,339
set off alarms it's usually the the free

235
00:11:18,889 --> 00:11:26,279
domain name but also the registrant or

236
00:11:23,339 --> 00:11:31,679
the registrar where it's hosted or where

237
00:11:26,279 --> 00:11:33,209
it was registered sorry the problem so

238
00:11:31,679 --> 00:11:35,850
if you say okay I'm only going to look

239
00:11:33,209 --> 00:11:39,388
at english-language domains or commonly

240
00:11:35,850 --> 00:11:41,850
formatted domains does anyone here have

241
00:11:39,389 --> 00:11:44,040
a marketing team that uses Marketo or do

242
00:11:41,850 --> 00:11:47,100
you ever see these Marketo links in your

243
00:11:44,040 --> 00:11:49,709
email you probably do if you've ever

244
00:11:47,100 --> 00:11:55,739
gone to a conference because you get

245
00:11:49,709 --> 00:12:03,018
these days after the fact like MK t o re

246
00:11:55,739 --> 00:12:05,399
st that's Marketo rest comm that is a DJ

247
00:12:03,019 --> 00:12:06,809
it's dynamically generated or at least

248
00:12:05,399 --> 00:12:09,749
appears do and then if you had the host

249
00:12:06,809 --> 00:12:12,118
portion also very sketchy you know that

250
00:12:09,749 --> 00:12:16,139
looks like a computer generated which it

251
00:12:12,119 --> 00:12:16,649
is the host portion of the domain is the

252
00:12:16,139 --> 00:12:23,069
DGA

253
00:12:16,649 --> 00:12:27,600
and then the Marketo rest part is just

254
00:12:23,069 --> 00:12:29,969
the easy-to-remember domain so yeah this

255
00:12:27,600 --> 00:12:32,730
this is totally legitimate well you know

256
00:12:29,970 --> 00:12:36,239
totally legitimate in the eye of the

257
00:12:32,730 --> 00:12:39,839
older right so now redirects like we

258
00:12:36,239 --> 00:12:44,309
were talking about this is probably the

259
00:12:39,839 --> 00:12:47,789
most common one of the most common

260
00:12:44,309 --> 00:12:50,520
exploit vectors that we see for drive by

261
00:12:47,789 --> 00:12:52,710
malware so you go

262
00:12:50,520 --> 00:12:56,310
to a legitimate website like cnn.com

263
00:12:52,710 --> 00:12:59,040
that's not gonna set off red flags well

264
00:12:56,310 --> 00:13:00,869
shouldn't I suppose is you're a fox fan

265
00:12:59,040 --> 00:13:03,290
it's that's a whole that's a different

266
00:13:00,870 --> 00:13:09,720
war altogether so you go to cnn.com

267
00:13:03,290 --> 00:13:12,630
we've seen a lot of advertising that's

268
00:13:09,720 --> 00:13:16,980
legitimate advertising redirecting

269
00:13:12,630 --> 00:13:19,350
people to fraudulent domains because

270
00:13:16,980 --> 00:13:21,360
it's easy this was called like years ago

271
00:13:19,350 --> 00:13:23,640
people said this is gonna happen

272
00:13:21,360 --> 00:13:25,590
Matt Johansson and Jeremiah Grossman I

273
00:13:23,640 --> 00:13:26,970
believe when they were both at white hat

274
00:13:25,590 --> 00:13:30,990
neither of which are at white hat now

275
00:13:26,970 --> 00:13:32,310
they did a presentation at blackhat that

276
00:13:30,990 --> 00:13:33,810
showed this like oh look at all the

277
00:13:32,310 --> 00:13:36,390
money we can make or look at all the

278
00:13:33,810 --> 00:13:37,770
computers we can infect so someone said

279
00:13:36,390 --> 00:13:39,090
hey you know what I could weaponize that

280
00:13:37,770 --> 00:13:40,170
that'd be great I can make a lot more

281
00:13:39,090 --> 00:13:42,170
money than what they're talking about

282
00:13:40,170 --> 00:13:44,459
and they did and this is still in use

283
00:13:42,170 --> 00:13:47,459
because of loosely structured ad

284
00:13:44,460 --> 00:13:51,330
networks so what happens is you go to

285
00:13:47,460 --> 00:13:55,770
CNN the ad redirects you somewhere so

286
00:13:51,330 --> 00:13:59,390
queries another domain that is sending

287
00:13:55,770 --> 00:14:02,340
you to a site to download something

288
00:13:59,390 --> 00:14:04,280
automatically downloads and then you

289
00:14:02,340 --> 00:14:09,300
execute it

290
00:14:04,280 --> 00:14:11,310
most times or off times it will exploit

291
00:14:09,300 --> 00:14:19,740
a known vulnerability may or may not

292
00:14:11,310 --> 00:14:21,930
rhyme with flash or or mud meadow B you

293
00:14:19,740 --> 00:14:24,210
know and then additional payload can be

294
00:14:21,930 --> 00:14:26,189
delivered because that vector has been

295
00:14:24,210 --> 00:14:28,140
exploited and they've got the football

296
00:14:26,190 --> 00:14:29,970
Dan the network so if you're just

297
00:14:28,140 --> 00:14:31,949
watching at the firewall saying you know

298
00:14:29,970 --> 00:14:33,840
oh yeah cnn.com we allow that or at the

299
00:14:31,950 --> 00:14:36,390
proxy wheel out of that the subsequent

300
00:14:33,840 --> 00:14:37,920
redirects this again stitches together

301
00:14:36,390 --> 00:14:45,240
the timeline of events that you can

302
00:14:37,920 --> 00:14:45,689
follow now the fun part maybe there we

303
00:14:45,240 --> 00:14:52,170
go

304
00:14:45,690 --> 00:14:54,450
so probably I'd say the first month two

305
00:14:52,170 --> 00:14:58,500
months when I was at Open DNS I started

306
00:14:54,450 --> 00:15:01,890
looking in the network of one of our

307
00:14:58,500 --> 00:15:03,810
customers who happened to be a fortune

308
00:15:01,890 --> 00:15:05,910
2000 oil and gas company

309
00:15:03,810 --> 00:15:10,770
I was actually starting I was trying to

310
00:15:05,910 --> 00:15:12,439
see SCADA and ICS devices to see if they

311
00:15:10,770 --> 00:15:14,970
had anything calling out to the Internet

312
00:15:12,440 --> 00:15:17,340
then they saw this domain Xerox

313
00:15:14,970 --> 00:15:19,470
discovery super node 3 comm I thought

314
00:15:17,340 --> 00:15:21,170
wait a minute that just doesn't look

315
00:15:19,470 --> 00:15:25,230
right

316
00:15:21,170 --> 00:15:28,890
all right is it malware fishing is it

317
00:15:25,230 --> 00:15:29,339
something legitimate so then I started

318
00:15:28,890 --> 00:15:31,410
looking

319
00:15:29,339 --> 00:15:33,380
hey the domains not even registered why

320
00:15:31,410 --> 00:15:37,110
would this exist

321
00:15:33,380 --> 00:15:38,570
Xerox discovery super node 3 com it's

322
00:15:37,110 --> 00:15:41,880
not registered okay so that's

323
00:15:38,570 --> 00:15:44,640
surprisingly fishy and because I am a

324
00:15:41,880 --> 00:15:47,790
very intelligent person as Rob

325
00:15:44,640 --> 00:15:52,010
introduced me I concluded that there was

326
00:15:47,790 --> 00:15:57,990
also xerox discovery super node 1 2 & 3

327
00:15:52,010 --> 00:15:59,610
no 4 5 6 whatever and just based on the

328
00:15:57,990 --> 00:16:02,400
traffic that was going just through the

329
00:15:59,610 --> 00:16:05,640
Open DNS Network of the entire customer

330
00:16:02,400 --> 00:16:07,020
base around 2000 queries per hour so

331
00:16:05,640 --> 00:16:10,860
that's a lot of queries to something

332
00:16:07,020 --> 00:16:14,130
that doesn't really exist so I kept

333
00:16:10,860 --> 00:16:17,089
digging further camera guys gonna kill

334
00:16:14,130 --> 00:16:17,089
me here because I keep pacing

335
00:16:17,450 --> 00:16:28,800
I'm spry alright so I googled the domain

336
00:16:25,320 --> 00:16:30,750
and I found that it was related to Xerox

337
00:16:28,800 --> 00:16:34,260
work center printer and not like a small

338
00:16:30,750 --> 00:16:37,710
printer I'm talking like a big huge

339
00:16:34,260 --> 00:16:40,350
expensive printer and within that

340
00:16:37,710 --> 00:16:41,820
printer there was a module made by

341
00:16:40,350 --> 00:16:46,320
McAfee and in your work for Mac fee

342
00:16:41,820 --> 00:16:48,450
slash Intel good you should write this

343
00:16:46,320 --> 00:16:52,860
down

344
00:16:48,450 --> 00:16:55,200
because no one responded to me so this

345
00:16:52,860 --> 00:16:59,490
policy Orchestrator security module

346
00:16:55,200 --> 00:17:00,930
allows McAfee to protect these work

347
00:16:59,490 --> 00:17:04,020
center printers which are essentially

348
00:17:00,930 --> 00:17:05,909
big-ass computers right very fully

349
00:17:04,020 --> 00:17:09,359
functional you're probably gonna want to

350
00:17:05,910 --> 00:17:10,679
patch them etc etc and like I said not

351
00:17:09,359 --> 00:17:12,178
inexpensive this is something you're

352
00:17:10,679 --> 00:17:15,990
gonna see at a Kinkos or you're gonna

353
00:17:12,179 --> 00:17:17,699
see at what a Kinkos turn into FedEx

354
00:17:15,990 --> 00:17:22,679
thank you Canadian

355
00:17:17,699 --> 00:17:24,600
yeah so not inexpensive and what was

356
00:17:22,679 --> 00:17:26,689
happening is that these printers were

357
00:17:24,599 --> 00:17:29,580
beaconing out to the internet because

358
00:17:26,689 --> 00:17:36,090
that's where they were told to find

359
00:17:29,580 --> 00:17:38,000
those servers for some reason isn't that

360
00:17:36,090 --> 00:17:41,549
great picture

361
00:17:38,000 --> 00:17:43,350
so I started mapping the information and

362
00:17:41,549 --> 00:17:44,940
these things were queering from all over

363
00:17:43,350 --> 00:17:48,740
the world

364
00:17:44,940 --> 00:17:52,350
apparently there's a big presence in

365
00:17:48,740 --> 00:17:56,370
where was it in Alaska yeah lots on the

366
00:17:52,350 --> 00:17:57,750
east coast south africa so here's the

367
00:17:56,370 --> 00:18:02,129
gist of what was happening and this is

368
00:17:57,750 --> 00:18:07,080
based solely on doing research based off

369
00:18:02,130 --> 00:18:08,880
this DNS query this domain lookup so

370
00:18:07,080 --> 00:18:12,990
Xerox printers they were querying out

371
00:18:08,880 --> 00:18:17,880
and in the documentation in the McAfee

372
00:18:12,990 --> 00:18:20,549
documentation I might add not the Xerox

373
00:18:17,880 --> 00:18:24,000
documentation it said that if you are

374
00:18:20,549 --> 00:18:26,250
going to have multiple locations you can

375
00:18:24,000 --> 00:18:29,910
designate one of your workstation

376
00:18:26,250 --> 00:18:31,710
printers to be a super node so that all

377
00:18:29,910 --> 00:18:33,630
of your other printers can receive their

378
00:18:31,710 --> 00:18:37,049
instructions from that printer so you

379
00:18:33,630 --> 00:18:39,299
push an update to that printer it holds

380
00:18:37,049 --> 00:18:41,340
the file on its web or FTP actually on

381
00:18:39,299 --> 00:18:43,400
its web server and that allows the other

382
00:18:41,340 --> 00:18:46,168
printers to connect to it and download

383
00:18:43,400 --> 00:18:49,020
saving bandwidth seems like a great idea

384
00:18:46,169 --> 00:18:53,520
now what they didn't tell you is that

385
00:18:49,020 --> 00:18:58,440
neither McAfee nor Xerox registered the

386
00:18:53,520 --> 00:19:00,510
domains in the documentation that says

387
00:18:58,440 --> 00:19:01,799
that you're supposed to register or

388
00:19:00,510 --> 00:19:03,539
you're supposed to take these domain

389
00:19:01,799 --> 00:19:06,600
and put them into your own internal DNS

390
00:19:03,539 --> 00:19:08,129
so that when your systems are trying to

391
00:19:06,600 --> 00:19:10,080
look up that domain it knows where to go

392
00:19:08,129 --> 00:19:14,939
to that internal non addressable

393
00:19:10,080 --> 00:19:25,678
non-routable IP so that's kind of cool

394
00:19:14,940 --> 00:19:29,669
so I registered the domains and what

395
00:19:25,679 --> 00:19:31,769
this did so I put it on a VPS server I

396
00:19:29,669 --> 00:19:35,070
was running on top I want to see just

397
00:19:31,769 --> 00:19:38,309
how much traffic was being generated

398
00:19:35,070 --> 00:19:40,889
because before I just knew that on the

399
00:19:38,309 --> 00:19:44,190
open DNS Network there were 2,000

400
00:19:40,889 --> 00:19:48,658
queries per minute so what did the world

401
00:19:44,190 --> 00:19:52,529
look like so you can see here this was

402
00:19:48,659 --> 00:19:59,989
just a 24 hour period we're looking at

403
00:19:52,529 --> 00:20:04,580
two point six five gig just of queries

404
00:19:59,989 --> 00:20:07,769
huh so that's and just so you know it's

405
00:20:04,580 --> 00:20:12,359
trying to make a connection to a web

406
00:20:07,769 --> 00:20:14,779
server to get orders I'm gonna be the

407
00:20:12,359 --> 00:20:14,779
Skynet

408
00:20:15,259 --> 00:20:22,440
so I sync hold them on the Open DNS side

409
00:20:18,869 --> 00:20:25,649
to protect our customers and anyone

410
00:20:22,440 --> 00:20:29,039
using it free protected from this I made

411
00:20:25,649 --> 00:20:31,229
a blog post and that you know I did a

412
00:20:29,039 --> 00:20:37,499
blog post pat myself on the back like

413
00:20:31,230 --> 00:20:45,059
everything's fixed we're cool now I went

414
00:20:37,499 --> 00:20:50,009
back this was roughly yeah so this was

415
00:20:45,059 --> 00:20:52,320
just later on another well let's say

416
00:20:50,009 --> 00:20:55,619
close to 24 hours we're already up to

417
00:20:52,320 --> 00:20:58,559
240 gigs of queries that's a lot of

418
00:20:55,619 --> 00:21:00,649
network traffic the VPS provider who

419
00:20:58,559 --> 00:21:03,799
said they were extremely tolerant of

420
00:21:00,649 --> 00:21:08,029
network connectivity and traffic rates

421
00:21:03,799 --> 00:21:11,240
said that this was kind of pushing that

422
00:21:08,029 --> 00:21:14,340
like okay I'll take it down so I just

423
00:21:11,240 --> 00:21:15,100
remapped the domains to point to the

424
00:21:14,340 --> 00:21:18,009
blog post

425
00:21:15,100 --> 00:21:19,988
in the hopes of someone who's responding

426
00:21:18,009 --> 00:21:21,669
to an incident or looking at this thing

427
00:21:19,989 --> 00:21:23,379
what the hell is this we'll go to the

428
00:21:21,669 --> 00:21:30,909
blog post say oh hey that makes sense

429
00:21:23,379 --> 00:21:32,639
now so we're the homestretch folks all

430
00:21:30,909 --> 00:21:35,739
right some tools I want to tell you that

431
00:21:32,639 --> 00:21:38,498
want to tell you about from a DNS

432
00:21:35,739 --> 00:21:41,320
perspective passive total if you're not

433
00:21:38,499 --> 00:21:46,139
using passive total you should be you

434
00:21:41,320 --> 00:21:48,759
know free for individuals up to a point

435
00:21:46,139 --> 00:21:51,219
recently acquired by risk IQ so there is

436
00:21:48,759 --> 00:21:53,379
an enterprise version but passive total

437
00:21:51,220 --> 00:21:57,879
gives you passive DNS information very

438
00:21:53,379 --> 00:22:02,889
very cool tool site 24/7 and DNS stuff

439
00:21:57,879 --> 00:22:05,139
you can generate really a DNS report for

440
00:22:02,889 --> 00:22:08,139
a domain or use a whole bunch of tools

441
00:22:05,139 --> 00:22:10,059
that are hosted on their site not on

442
00:22:08,139 --> 00:22:12,850
your site so if you're doing a

443
00:22:10,059 --> 00:22:14,139
nation-state type investigation or

444
00:22:12,850 --> 00:22:16,689
something where you don't want to let on

445
00:22:14,139 --> 00:22:18,959
that you're on to them do it from one of

446
00:22:16,690 --> 00:22:21,340
those instead of your corporate network

447
00:22:18,960 --> 00:22:26,470
Starbucks is also good we do a lot of

448
00:22:21,340 --> 00:22:30,850
malware testing from Starbucks I mean we

449
00:22:26,470 --> 00:22:34,570
did domain tools any when you're used

450
00:22:30,850 --> 00:22:38,678
domain tools very cool it can get a

451
00:22:34,570 --> 00:22:41,049
little pricey the free tools are just as

452
00:22:38,679 --> 00:22:45,070
valuable the you know the pay for tools

453
00:22:41,049 --> 00:22:47,980
you get who has who has ever owned this

454
00:22:45,070 --> 00:22:51,279
domain in the history of domains very

455
00:22:47,980 --> 00:22:52,749
powerful anyone using ELQ at all

456
00:22:51,279 --> 00:22:55,629
elasticsearch Kabana

457
00:22:52,749 --> 00:22:56,739
it's cool you know what you don't even

458
00:22:55,629 --> 00:22:59,350
have to know how to set it up anymore

459
00:22:56,739 --> 00:23:01,299
you can do a cloud instance you can

460
00:22:59,350 --> 00:23:03,189
download an OVA that has everything

461
00:23:01,299 --> 00:23:07,239
completely configured you know the bar

462
00:23:03,190 --> 00:23:09,970
is really low and my recommendation use

463
00:23:07,239 --> 00:23:11,590
ELQ just for your DNS queries because

464
00:23:09,970 --> 00:23:14,559
you want to be able to rapidly search

465
00:23:11,590 --> 00:23:16,830
you can compress everything it's going

466
00:23:14,559 --> 00:23:19,570
to be relatively easy to keep all this

467
00:23:16,830 --> 00:23:25,389
information which is very small for a

468
00:23:19,570 --> 00:23:28,060
very long time gray log also another the

469
00:23:25,389 --> 00:23:30,010
tag of open source log management that

470
00:23:28,060 --> 00:23:31,360
really works that always kills me I I

471
00:23:30,010 --> 00:23:33,910
come from the Similan management world

472
00:23:31,360 --> 00:23:37,810
so something that just kind of works is

473
00:23:33,910 --> 00:23:41,380
novel now some of the commercial tools

474
00:23:37,810 --> 00:23:43,600
again I said risk IQ that has the

475
00:23:41,380 --> 00:23:45,730
enterprise version of passive total

476
00:23:43,600 --> 00:23:48,280
domain tools again you can get the big

477
00:23:45,730 --> 00:23:51,670
reports OpenDNS investigate would let

478
00:23:48,280 --> 00:23:55,210
you do some of those initial pivots like

479
00:23:51,670 --> 00:24:02,890
I was doing to find the 0s discovery

480
00:23:55,210 --> 00:24:05,920
super node stuff so this is the end come

481
00:24:02,890 --> 00:24:08,050
on all right before you go I want to

482
00:24:05,920 --> 00:24:10,660
give you sort of it's just a six step

483
00:24:08,050 --> 00:24:13,090
workflow if you take anything away from

484
00:24:10,660 --> 00:24:17,710
this other than how much Rob thinks of

485
00:24:13,090 --> 00:24:20,590
me you can take away this slide so you

486
00:24:17,710 --> 00:24:23,050
collect the DMS query logs you observe

487
00:24:20,590 --> 00:24:25,929
network malware someone tells you

488
00:24:23,050 --> 00:24:28,030
something went wrong go back look at

489
00:24:25,930 --> 00:24:30,220
your DNS records first to get a sense of

490
00:24:28,030 --> 00:24:32,620
what's going on now if it's IP based

491
00:24:30,220 --> 00:24:36,100
only connectivity which most times

492
00:24:32,620 --> 00:24:37,449
malware it's going to use DNS because

493
00:24:36,100 --> 00:24:38,649
it's easier it's lightweight you can

494
00:24:37,450 --> 00:24:42,670
change the infrastructure on the back

495
00:24:38,650 --> 00:24:46,270
end very quickly reference your stored

496
00:24:42,670 --> 00:24:47,710
DNS to really define the scope then

497
00:24:46,270 --> 00:24:50,340
start going to those third-party tools

498
00:24:47,710 --> 00:24:52,510
to get additional information and enrich

499
00:24:50,340 --> 00:24:55,629
the information as to what you're seeing

500
00:24:52,510 --> 00:24:57,610
get rid of the irrelevant stuff I don't

501
00:24:55,630 --> 00:24:59,950
mean to like just delete it but you know

502
00:24:57,610 --> 00:25:02,860
remove it from your investigation and

503
00:24:59,950 --> 00:25:05,760
then isolate the queries and the time

504
00:25:02,860 --> 00:25:07,750
frames or establish the time frames

505
00:25:05,760 --> 00:25:12,640
based on the information that you're

506
00:25:07,750 --> 00:25:15,790
seeing hopefully that helps break this

507
00:25:12,640 --> 00:25:18,840
damn thing so DNS is one of the core

508
00:25:15,790 --> 00:25:21,780
protocols on the Internet

509
00:25:18,840 --> 00:25:24,909
how do you think you do network

510
00:25:21,780 --> 00:25:27,160
forensics on Internet connected devices

511
00:25:24,910 --> 00:25:28,510
IOT devices that are all SSL

512
00:25:27,160 --> 00:25:31,600
encapsulated without man in the middling

513
00:25:28,510 --> 00:25:33,850
them it's hard but a good start is

514
00:25:31,600 --> 00:25:36,250
looking at what their query you can find

515
00:25:33,850 --> 00:25:39,909
out that you're doing here of a Samsung

516
00:25:36,250 --> 00:25:40,900
Smart TV at home connected to the

517
00:25:39,910 --> 00:25:46,280
Internet

518
00:25:40,900 --> 00:25:47,840
you know it calls Korea right yeah

519
00:25:46,280 --> 00:25:52,970
South Korea no it's the good Korea we're

520
00:25:47,840 --> 00:25:57,110
fine you're still safe your security

521
00:25:52,970 --> 00:26:00,320
clearance is still all right well yeah

522
00:25:57,110 --> 00:26:02,570
DNS if someone brings something into the

523
00:26:00,320 --> 00:26:03,860
network you can very quickly find out if

524
00:26:02,570 --> 00:26:06,409
they're using a Western Digital hard

525
00:26:03,860 --> 00:26:08,149
drive off the shelf at Costco plugged it

526
00:26:06,410 --> 00:26:10,040
in hey I'm seeing all these queries what

527
00:26:08,150 --> 00:26:13,150
does that mean oh I recognize these

528
00:26:10,040 --> 00:26:17,840
domains these are Western Digital

529
00:26:13,150 --> 00:26:19,280
storage cloud servers that taking all of

530
00:26:17,840 --> 00:26:21,530
the data on their workstation and

531
00:26:19,280 --> 00:26:24,410
pushing it up to their safe to the pure

532
00:26:21,530 --> 00:26:24,950
cloud that I have no visibility into Oh

533
00:26:24,410 --> 00:26:29,330
awesome

534
00:26:24,950 --> 00:26:30,680
I'm gonna go talk to that person like I

535
00:26:29,330 --> 00:26:33,020
said before it can help you focus the

536
00:26:30,680 --> 00:26:35,960
investigation it's all about timelines

537
00:26:33,020 --> 00:26:37,400
setting your anchor of where to look so

538
00:26:35,960 --> 00:26:40,550
you're not working with a pallet of

539
00:26:37,400 --> 00:26:42,380
workstations and there's a wealth of

540
00:26:40,550 --> 00:26:44,270
tools available more are being developed

541
00:26:42,380 --> 00:26:48,580
every day I know a lot of tools were

542
00:26:44,270 --> 00:26:51,500
mentioned throughout today and yesterday

543
00:26:48,580 --> 00:26:54,679
take a look at them you don't like them

544
00:26:51,500 --> 00:26:55,400
change them they're open-source that

545
00:26:54,680 --> 00:26:56,960
doesn't mean you get to whine about

546
00:26:55,400 --> 00:26:59,630
someone else's tools means that you have

547
00:26:56,960 --> 00:27:03,140
the opportunity to fix them or make them

548
00:26:59,630 --> 00:27:08,150
better yeah unless you use Ruby because

549
00:27:03,140 --> 00:27:14,680
then everyone just makes fun of you so

550
00:27:08,150 --> 00:27:14,680
with that I will break this thing maybe

551
00:27:17,780 --> 00:27:57,950
there we go Hey so yeah email me or find

552
00:27:25,650 --> 00:28:01,010
me on Twitter yeah so I would say that

553
00:27:57,950 --> 00:28:04,290
following proper defense-in-depth

554
00:28:01,010 --> 00:28:06,870
mentality methodologies you should have

555
00:28:04,290 --> 00:28:10,040
an internal DNS server that acts as the

556
00:28:06,870 --> 00:28:12,870
first query point that will forward to

557
00:28:10,040 --> 00:28:15,960
something on your DMZ that will then

558
00:28:12,870 --> 00:28:19,860
perform the public lookups and that way

559
00:28:15,960 --> 00:28:23,550
you have things all along the way

560
00:28:19,860 --> 00:28:26,399
very easy to set up a DNS server for

561
00:28:23,550 --> 00:28:27,840
internal and on the DMZ not so simple to

562
00:28:26,400 --> 00:28:31,170
maintain because it's one of those

563
00:28:27,840 --> 00:28:31,919
things that just kind of gets its the

564
00:28:31,170 --> 00:28:36,390
Ron Popeil

565
00:28:31,920 --> 00:28:37,830
of server and applications you just set

566
00:28:36,390 --> 00:28:39,990
it and you forget about it not because

567
00:28:37,830 --> 00:28:43,590
you want to you just because it's DNS

568
00:28:39,990 --> 00:28:46,230
it'll just work but yeah I always advise

569
00:28:43,590 --> 00:28:49,020
going for that layered approach of

570
00:28:46,230 --> 00:28:52,350
having an internal DNS server forwarding

571
00:28:49,020 --> 00:28:55,680
to a less secure zone and then that less

572
00:28:52,350 --> 00:29:02,159
secure zone going into the Internet yes

573
00:28:55,680 --> 00:29:04,380
I have an hour and a half left Rob this

574
00:29:02,160 --> 00:29:06,360
isn't a question but I'm a penetration

575
00:29:04,380 --> 00:29:10,640
tester and I just was really excited to

576
00:29:06,360 --> 00:29:14,520
tell everyone to not use McAfee GP oh

577
00:29:10,640 --> 00:29:17,100
that's more of a statement right now the

578
00:29:14,520 --> 00:29:21,030
question APO is a great tool if deployed

579
00:29:17,100 --> 00:29:23,240
properly as many tools all right thanks

580
00:29:21,030 --> 00:29:23,240
everyone

