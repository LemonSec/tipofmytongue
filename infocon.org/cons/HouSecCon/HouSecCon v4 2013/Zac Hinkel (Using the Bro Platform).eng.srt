1
00:00:03,319 --> 00:00:05,790
alright so we get started how many

2
00:00:05,790 --> 00:00:08,790
people actually run bro anybody you

3
00:00:08,790 --> 00:00:12,120
might know what bro is Wow so throw new

4
00:00:12,120 --> 00:00:13,769
group that's fine that's great because

5
00:00:13,769 --> 00:00:16,170
we're to cover a lot of stuff I try not

6
00:00:16,170 --> 00:00:18,690
to speak too fast but I'm trying to

7
00:00:18,690 --> 00:00:20,369
shove as much down your throat as i can

8
00:00:20,369 --> 00:00:22,500
in the next 45 minutes we're gonna do a

9
00:00:22,500 --> 00:00:24,539
little bit coding at least look from the

10
00:00:24,539 --> 00:00:26,119
command line at some of the birth stuff

11
00:00:26,119 --> 00:00:30,720
so it that goes quick but just holler

12
00:00:30,720 --> 00:00:32,070
out if you have any questions stuff like

13
00:00:32,070 --> 00:00:33,540
that probably taking questions at the

14
00:00:33,540 --> 00:00:37,890
end if you want to talk to me I want you

15
00:00:37,890 --> 00:00:40,940
to look at that so you can find me on

16
00:00:40,940 --> 00:00:43,980
Twitter rc's usually easiest or you can

17
00:00:43,980 --> 00:00:46,020
you send me an email so my name is I

18
00:00:46,020 --> 00:00:48,090
hinkle this is my third you said Khan

19
00:00:48,090 --> 00:00:51,360
spoken at shook on and about all kinds

20
00:00:51,360 --> 00:00:53,640
of things to start off with mainly my

21
00:00:53,640 --> 00:00:55,440
first job was an airline pilot which

22
00:00:55,440 --> 00:00:58,079
currently still am an airline pilot but

23
00:00:58,079 --> 00:01:00,809
that's actually changing network

24
00:01:00,809 --> 00:01:02,579
security consultant I started off with

25
00:01:02,579 --> 00:01:05,850
computers whenever was IRC and patching

26
00:01:05,850 --> 00:01:08,130
into foam panels in the back of fields

27
00:01:08,130 --> 00:01:10,380
behind my house I ain't going to stick

28
00:01:10,380 --> 00:01:13,229
with that trying is what I do for my

29
00:01:13,229 --> 00:01:16,619
main career and then I did a bunch of

30
00:01:16,619 --> 00:01:19,409
red teaming theft stuff where I would go

31
00:01:19,409 --> 00:01:21,330
and do physical staff and like to break

32
00:01:21,330 --> 00:01:23,610
into places and then insurance kept

33
00:01:23,610 --> 00:01:25,110
going up and up and up and I was kind of

34
00:01:25,110 --> 00:01:26,640
doing it on the side so I didn't really

35
00:01:26,640 --> 00:01:29,700
have any but couldn't justify doing it

36
00:01:29,700 --> 00:01:31,110
anymore for the contracts I was getting

37
00:01:31,110 --> 00:01:33,540
so then we can kind of came in with drug

38
00:01:33,540 --> 00:01:35,640
development loved RC planes and I was a

39
00:01:35,640 --> 00:01:38,159
kid and so we kind of took these RC

40
00:01:38,159 --> 00:01:40,799
planes mixed with red teaming and we did

41
00:01:40,799 --> 00:01:42,390
all kinds of great things I had a DARPA

42
00:01:42,390 --> 00:01:45,030
team that we could do we have for doing

43
00:01:45,030 --> 00:01:47,070
DARPA projects I've done government

44
00:01:47,070 --> 00:01:48,360
projects I've done all kinds of stuff

45
00:01:48,360 --> 00:01:50,960
than that and now I've actually kind of

46
00:01:50,960 --> 00:01:54,090
dumped it all to the highway and I'm

47
00:01:54,090 --> 00:01:56,549
doing blue teaming now I so much that

48
00:01:56,549 --> 00:01:59,399
time to you about bro I'll talk today

49
00:01:59,399 --> 00:02:00,750
and it'll seem like I'm talking about

50
00:02:00,750 --> 00:02:02,399
some magical product it doesn't exist

51
00:02:02,399 --> 00:02:04,890
but for me it is Magic the way it does

52
00:02:04,890 --> 00:02:06,270
things the way handle things is the way

53
00:02:06,270 --> 00:02:09,780
all we want something to work for me

54
00:02:09,780 --> 00:02:12,150
because i'm lazy that was something easy

55
00:02:12,150 --> 00:02:13,319
a

56
00:02:13,319 --> 00:02:15,299
and I want to be able to see things at

57
00:02:15,299 --> 00:02:17,819
the level from that fifty thousand foot

58
00:02:17,819 --> 00:02:20,099
view all the way down so I can drill

59
00:02:20,099 --> 00:02:21,870
down those all the way down to a

60
00:02:21,870 --> 00:02:24,859
particular connection if you will so

61
00:02:24,859 --> 00:02:26,939
that's kind of the big thing I'm

62
00:02:26,939 --> 00:02:28,319
actually leaving the airline's I'm

63
00:02:28,319 --> 00:02:30,000
leaving the red teaming and I'm actually

64
00:02:30,000 --> 00:02:32,010
joined with a company called bro holla

65
00:02:32,010 --> 00:02:36,090
which is basically made up of the core

66
00:02:36,090 --> 00:02:39,299
developers of bro and it's basically to

67
00:02:39,299 --> 00:02:43,639
help to grow from what was typically a

68
00:02:43,639 --> 00:02:47,879
university application a large data

69
00:02:47,879 --> 00:02:51,739
center usage especially on

70
00:02:52,129 --> 00:02:55,109
supercomputing government installation

71
00:02:55,109 --> 00:02:56,790
stuff like that and bring it more into

72
00:02:56,790 --> 00:03:00,090
an enterprise usage environment and so

73
00:03:00,090 --> 00:03:02,430
what brawler does is try to bring that

74
00:03:02,430 --> 00:03:05,639
to the enterprise and just like it shows

75
00:03:05,639 --> 00:03:06,980
there they'll build the community

76
00:03:06,980 --> 00:03:09,449
strategic consult consulting and bro

77
00:03:09,449 --> 00:03:11,669
support for any enterprise that what's

78
00:03:11,669 --> 00:03:14,129
that so bro is definitely going to say

79
00:03:14,129 --> 00:03:15,750
that blood blood clots want to stay an

80
00:03:15,750 --> 00:03:18,989
open source we just have been adopted to

81
00:03:18,989 --> 00:03:23,790
enterprise usage so it is bro you follow

82
00:03:23,790 --> 00:03:25,169
you may have heard it before may not

83
00:03:25,169 --> 00:03:27,930
sell this presentation first off we'll

84
00:03:27,930 --> 00:03:29,639
take a look at the traditional tool set

85
00:03:29,639 --> 00:03:32,729
of trying to look at traffic coming into

86
00:03:32,729 --> 00:03:35,699
your network and so you're originally

87
00:03:35,699 --> 00:03:37,650
you know you have t CP Dubb Wireshark

88
00:03:37,650 --> 00:03:40,259
Argus snort and you're trying to paste

89
00:03:40,259 --> 00:03:42,180
all this stuff together with either

90
00:03:42,180 --> 00:03:44,970
pearl or Python to get them to talk

91
00:03:44,970 --> 00:03:46,439
together to get information from one

92
00:03:46,439 --> 00:03:47,939
side to the other and to pull

93
00:03:47,939 --> 00:03:50,280
information out that you want to see so

94
00:03:50,280 --> 00:03:53,519
the whole idea was to take a product if

95
00:03:53,519 --> 00:03:55,799
you will or an open source project i

96
00:03:55,799 --> 00:03:59,069
started by PacSun back in 95 so Rose

97
00:03:59,069 --> 00:04:01,650
been around since 95 when his first made

98
00:04:01,650 --> 00:04:03,750
in Berkeley and take all that and kind

99
00:04:03,750 --> 00:04:07,019
of cram it into one programming language

100
00:04:07,019 --> 00:04:10,139
so that we can manipulate data pull data

101
00:04:10,139 --> 00:04:13,459
out as easily as possible

102
00:04:13,520 --> 00:04:17,029
so bro is three things in a does three

103
00:04:17,029 --> 00:04:19,220
things so starting with what it is you

104
00:04:19,220 --> 00:04:21,079
have the boat platform which is the

105
00:04:21,079 --> 00:04:23,810
underlying utilities to manage the bro

106
00:04:23,810 --> 00:04:26,900
API the interfaces I have pretty much

107
00:04:26,900 --> 00:04:28,880
all the nits and gritty stuff that you

108
00:04:28,880 --> 00:04:30,080
don't want to have to deal with its

109
00:04:30,080 --> 00:04:32,120
working in the background to take things

110
00:04:32,120 --> 00:04:35,180
from the wire and bring it into what we

111
00:04:35,180 --> 00:04:38,240
call the programming language though

112
00:04:38,240 --> 00:04:40,150
programming languages turing-complete

113
00:04:40,150 --> 00:04:43,400
it's very pythonesque so if you can use

114
00:04:43,400 --> 00:04:45,470
Python you'll be able to sit down c-bro

115
00:04:45,470 --> 00:04:47,690
programming language and start using it

116
00:04:47,690 --> 00:04:49,850
right away with that bro programming

117
00:04:49,850 --> 00:04:52,910
language we make bro applications I have

118
00:04:52,910 --> 00:04:54,980
bro ids is probably what most people

119
00:04:54,980 --> 00:04:56,630
think about whenever they hear bro

120
00:04:56,630 --> 00:04:59,360
because that is the main right now when

121
00:04:59,360 --> 00:05:01,630
the main things that bro is used for

122
00:05:01,630 --> 00:05:04,700
these are though other things that you

123
00:05:04,700 --> 00:05:06,920
can do with the boro applications things

124
00:05:06,920 --> 00:05:08,780
have already developed and in the

125
00:05:08,780 --> 00:05:11,930
platform so the ideas vulnerability

126
00:05:11,930 --> 00:05:13,580
management you can actually not even

127
00:05:13,580 --> 00:05:15,380
look at things on the wire but you can

128
00:05:15,380 --> 00:05:17,000
do full follow analysis with things that

129
00:05:17,000 --> 00:05:19,340
are actually already on your computer so

130
00:05:19,340 --> 00:05:21,650
if you wanted to actually take and say

131
00:05:21,650 --> 00:05:23,300
hash every can file this on your

132
00:05:23,300 --> 00:05:24,740
computer you can do that with the

133
00:05:24,740 --> 00:05:27,140
profile analysis you can do that it

134
00:05:27,140 --> 00:05:28,970
lines speed also at the same time with

135
00:05:28,970 --> 00:05:31,430
anything coming through the network tap

136
00:05:31,430 --> 00:05:34,910
too bro when we're talking about bro and

137
00:05:34,910 --> 00:05:36,530
I'm talking about the whole thing we're

138
00:05:36,530 --> 00:05:38,810
not talking about you going out and

139
00:05:38,810 --> 00:05:41,840
spending fifteen thousand dollars on

140
00:05:41,840 --> 00:05:44,060
some powerhouse computer thats its air

141
00:05:44,060 --> 00:05:46,820
monitors 1 gig of data at traffic bro

142
00:05:46,820 --> 00:05:49,370
the way do you see it most of the time

143
00:05:49,370 --> 00:05:52,940
as you can actually put it behind the

144
00:05:52,940 --> 00:05:54,200
router and I'll get to that in just a

145
00:05:54,200 --> 00:05:56,900
minute but you can take Adele r720 which

146
00:05:56,900 --> 00:05:58,430
I think it's about four thousand dollars

147
00:05:58,430 --> 00:06:01,310
right now we can monitor up to almost 10

148
00:06:01,310 --> 00:06:02,990
gigabit per second just using that dell

149
00:06:02,990 --> 00:06:04,760
computer so it doesn't have to be some

150
00:06:04,760 --> 00:06:06,980
magical box that you're paying a lot of

151
00:06:06,980 --> 00:06:09,080
money for we're talking about bro being

152
00:06:09,080 --> 00:06:11,600
an open source community developed

153
00:06:11,600 --> 00:06:13,790
package that you download for free put

154
00:06:13,790 --> 00:06:15,080
on a server and just shove it right

155
00:06:15,080 --> 00:06:16,970
behind your firewall and watch the

156
00:06:16,970 --> 00:06:20,270
traffic you're in and out and so this is

157
00:06:20,270 --> 00:06:22,580
normally the use case right so we have

158
00:06:22,580 --> 00:06:25,550
our maybe our DMZ or local

159
00:06:25,550 --> 00:06:27,860
network traffic as far servers are

160
00:06:27,860 --> 00:06:29,630
concerned talking to all of our

161
00:06:29,630 --> 00:06:30,890
peripherals that are on our network

162
00:06:30,890 --> 00:06:33,830
whether there anything speaking tcp/ip

163
00:06:33,830 --> 00:06:37,700
so you got obviously your desktops even

164
00:06:37,700 --> 00:06:39,290
your tablets you got people running

165
00:06:39,290 --> 00:06:41,870
smartphones on your network everything

166
00:06:41,870 --> 00:06:43,190
that is speaking across network

167
00:06:43,190 --> 00:06:45,410
including your phone system we can read

168
00:06:45,410 --> 00:06:47,600
all of that just fine so what we do is

169
00:06:47,600 --> 00:06:49,370
before that goes the internet we usually

170
00:06:49,370 --> 00:06:51,410
at least for the very first bro that you

171
00:06:51,410 --> 00:06:53,120
might want to put on your network these

172
00:06:53,120 --> 00:06:54,680
put it just so you have a network tap

173
00:06:54,680 --> 00:06:56,750
that just pulls that traffic as it hits

174
00:06:56,750 --> 00:06:58,820
the router so what you want to do is

175
00:06:58,820 --> 00:07:00,260
pull the inside so you're getting all

176
00:07:00,260 --> 00:07:02,120
your private IP dresses so you can map

177
00:07:02,120 --> 00:07:03,440
stuff back whenever you're looking at

178
00:07:03,440 --> 00:07:05,360
malware or whenever you're investigating

179
00:07:05,360 --> 00:07:08,240
something and then just take it and put

180
00:07:08,240 --> 00:07:09,680
it through a network tap right before it

181
00:07:09,680 --> 00:07:11,690
leaves the network guess I said that

182
00:07:11,690 --> 00:07:14,090
like three times tonight so bro this

183
00:07:14,090 --> 00:07:16,490
three things and it does three things so

184
00:07:16,490 --> 00:07:17,600
the very first thing that we do is

185
00:07:17,600 --> 00:07:22,310
protocol lot so it's a precision like I

186
00:07:22,310 --> 00:07:23,720
said watches every connection going back

187
00:07:23,720 --> 00:07:27,290
and forth act it saucily sitting off a

188
00:07:27,290 --> 00:07:29,870
passive connection the bro understands

189
00:07:29,870 --> 00:07:31,220
how a protocol should work it

190
00:07:31,220 --> 00:07:33,380
understands the since acknowledge

191
00:07:33,380 --> 00:07:35,690
acknowledge it knows that it's a full

192
00:07:35,690 --> 00:07:38,330
state analyzer so we can see if

193
00:07:38,330 --> 00:07:40,190
connections drop halfway through if

194
00:07:40,190 --> 00:07:41,600
somebody's trying to brute force by

195
00:07:41,600 --> 00:07:43,160
sending connection stuff like that it'll

196
00:07:43,160 --> 00:07:46,190
show up in bro as big red flags so you

197
00:07:46,190 --> 00:07:47,930
can even do things like when we'll get

198
00:07:47,930 --> 00:07:50,090
to live a layer into actions well if you

199
00:07:50,090 --> 00:07:51,800
have a particular computer that you see

200
00:07:51,800 --> 00:07:54,800
start sending out in that scheme if you

201
00:07:54,800 --> 00:07:56,150
wanted to with bro actions you could

202
00:07:56,150 --> 00:07:57,620
actually just tell the switch to kill

203
00:07:57,620 --> 00:07:59,300
that switch port and keep it as soon as

204
00:07:59,300 --> 00:08:04,280
bro sees it will say the protocol logs

205
00:08:04,280 --> 00:08:07,100
are very unix II kind of nasty messes

206
00:08:07,100 --> 00:08:08,240
we're going to look at those in just a

207
00:08:08,240 --> 00:08:10,760
few minutes if you like sitting at the

208
00:08:10,760 --> 00:08:12,380
command line and just parsing data

209
00:08:12,380 --> 00:08:14,240
you're going to love it because that's

210
00:08:14,240 --> 00:08:16,790
all it is and this data is made so that

211
00:08:16,790 --> 00:08:19,490
you know you get alerts and out of bro

212
00:08:19,490 --> 00:08:21,590
you're going to feed these to something

213
00:08:21,590 --> 00:08:23,900
that may be like al some kind of lastic

214
00:08:23,900 --> 00:08:27,170
search or you know maybe two Splunk if

215
00:08:27,170 --> 00:08:28,010
you're running exploding at your

216
00:08:28,010 --> 00:08:30,080
organization you can feed it all back to

217
00:08:30,080 --> 00:08:32,090
their taking notices and alerts you

218
00:08:32,090 --> 00:08:33,919
certain things so when you see certain

219
00:08:33,919 --> 00:08:37,200
things then you automatically

220
00:08:37,200 --> 00:08:40,380
get notified of them so alerts like you

221
00:08:40,380 --> 00:08:42,630
said comes pre-configured with a variety

222
00:08:42,630 --> 00:08:45,570
cincture anomaly detection so you're bad

223
00:08:45,570 --> 00:08:50,820
SS cells your ssh failed logins windows

224
00:08:50,820 --> 00:08:53,820
reverse shells things like that it picks

225
00:08:53,820 --> 00:08:55,800
it up instantly it's all built into bro

226
00:08:55,800 --> 00:08:59,550
you can feed as much information and

227
00:08:59,550 --> 00:09:00,780
Intel into prose you can possibly

228
00:09:00,780 --> 00:09:02,760
imagine we're going to look at a couple

229
00:09:02,760 --> 00:09:04,740
of those we have people that use this it

230
00:09:04,740 --> 00:09:07,020
actually feed in of course they have

231
00:09:07,020 --> 00:09:08,370
access to it but like the full NSA

232
00:09:08,370 --> 00:09:11,760
database of bad things which is like a

233
00:09:11,760 --> 00:09:13,740
hundred thousand things we can use

234
00:09:13,740 --> 00:09:15,690
edinboro and broke into it at line speed

235
00:09:15,690 --> 00:09:17,940
and sit there and send up notifications

236
00:09:17,940 --> 00:09:20,280
and flags have full speed and let people

237
00:09:20,280 --> 00:09:21,930
know when something to another's the

238
00:09:21,930 --> 00:09:24,570
network um so alerts as far as the

239
00:09:24,570 --> 00:09:25,620
command line is going to be one of the

240
00:09:25,620 --> 00:09:27,090
main things we're going to look at today

241
00:09:27,090 --> 00:09:30,480
but then we got actions so think about

242
00:09:30,480 --> 00:09:32,760
your organization right now and the data

243
00:09:32,760 --> 00:09:34,230
that's coming through and how data is

244
00:09:34,230 --> 00:09:36,540
coming through and I bet hardly anybody

245
00:09:36,540 --> 00:09:38,940
if anybody in here can say every time

246
00:09:38,940 --> 00:09:41,070
there is an application that gets

247
00:09:41,070 --> 00:09:42,510
transferred through my firewall so we

248
00:09:42,510 --> 00:09:44,610
need time an application comes in

249
00:09:44,610 --> 00:09:46,800
whether it's Annie exceed its labeled a

250
00:09:46,800 --> 00:09:50,040
PDF or maybe the XE label an ASP it

251
00:09:50,040 --> 00:09:51,510
doesn't matter because we're not looking

252
00:09:51,510 --> 00:09:53,850
at the what your browser saying that the

253
00:09:53,850 --> 00:09:57,150
mime type is Bros actually got a an

254
00:09:57,150 --> 00:09:59,070
analyzer that's going to sit there and

255
00:09:59,070 --> 00:10:00,780
look at the mind type and figure out the

256
00:10:00,780 --> 00:10:03,150
mime type itself so then we can drop

257
00:10:03,150 --> 00:10:04,620
those and then like I say oh who can

258
00:10:04,620 --> 00:10:07,440
tell me that every executable sodaw sexy

259
00:10:07,440 --> 00:10:09,660
cuban mime type that comes in you just

260
00:10:09,660 --> 00:10:10,950
kept somewhere where they can look at it

261
00:10:10,950 --> 00:10:13,350
or at least analyzed on the cross their

262
00:10:13,350 --> 00:10:14,850
network and those are the kind of things

263
00:10:14,850 --> 00:10:17,130
that we can do it bro so we can say any

264
00:10:17,130 --> 00:10:19,920
time that an executable comes in let's

265
00:10:19,920 --> 00:10:22,140
just save it over here so let's take a

266
00:10:22,140 --> 00:10:24,090
look at it later well so we can send it

267
00:10:24,090 --> 00:10:26,130
straight to a cuckoo box cluster where

268
00:10:26,130 --> 00:10:28,080
we can take it apart or we can take it

269
00:10:28,080 --> 00:10:30,870
and send it to virustotal we could send

270
00:10:30,870 --> 00:10:33,960
it to team camry up there to talk those

271
00:10:33,960 --> 00:10:35,670
things are things that you'd want to do

272
00:10:35,670 --> 00:10:37,430
with any kind of file that's coming in

273
00:10:37,430 --> 00:10:39,840
and you'll see today we'll do a couple

274
00:10:39,840 --> 00:10:41,580
examples as long as my phone holds our

275
00:10:41,580 --> 00:10:44,010
internet okay where we'll pull some

276
00:10:44,010 --> 00:10:46,110
malware p caps and you'll see a bro

277
00:10:46,110 --> 00:10:47,730
automatically reach out to the team

278
00:10:47,730 --> 00:10:50,290
comer e database and tell me hey

279
00:10:50,290 --> 00:10:52,810
team gomery says that this isn't good at

280
00:10:52,810 --> 00:10:54,490
least thirty or forty percent of all the

281
00:10:54,490 --> 00:10:57,029
virus definitions out there hit on this

282
00:10:57,029 --> 00:10:59,620
and so there's all kinds of actions and

283
00:10:59,620 --> 00:11:00,820
these are completely configurable

284
00:11:00,820 --> 00:11:04,060
actions you can make these anybody that

285
00:11:04,060 --> 00:11:05,560
can do pro can do these in probably five

286
00:11:05,560 --> 00:11:06,790
or ten minutes and i'll show you if you

287
00:11:06,790 --> 00:11:09,069
in a minute where you can make do define

288
00:11:09,069 --> 00:11:10,690
your own actions so that whenever you

289
00:11:10,690 --> 00:11:13,899
see something that you want to hit upon

290
00:11:13,899 --> 00:11:15,370
later or you want to take further

291
00:11:15,370 --> 00:11:17,079
analysis up then it's going to set it

292
00:11:17,079 --> 00:11:20,110
aside so you can look at it and so let's

293
00:11:20,110 --> 00:11:22,000
take a look at a couple examples i have

294
00:11:22,000 --> 00:11:24,790
up here i just did three quick sorry I'm

295
00:11:24,790 --> 00:11:26,649
lose my voice I'm go smart so I did

296
00:11:26,649 --> 00:11:28,509
three quick malware samples that have be

297
00:11:28,509 --> 00:11:33,160
common ones that you'd see on your

298
00:11:33,160 --> 00:11:35,889
network how are we gonna take them apart

299
00:11:35,889 --> 00:11:38,440
with grow that look at session is still

300
00:11:38,440 --> 00:11:40,180
up we are still peeing and which believe

301
00:11:40,180 --> 00:11:43,899
that so so here's some malware examples

302
00:11:43,899 --> 00:11:49,540
um so let's just go in to whoops the

303
00:11:49,540 --> 00:11:53,290
first one this t-bot and we will run

304
00:11:53,290 --> 00:11:55,240
this through bro so all I'm doing these

305
00:11:55,240 --> 00:11:56,800
are just standard peak apps that have in

306
00:11:56,800 --> 00:11:58,269
there you can pull the pcap from

307
00:11:58,269 --> 00:11:59,740
anything you have currently in

308
00:11:59,740 --> 00:12:01,540
production even if you just wanted to

309
00:12:01,540 --> 00:12:04,029
run it through pro to analyze it so

310
00:12:04,029 --> 00:12:06,370
let's just take a look at the largest

311
00:12:06,370 --> 00:12:08,260
one which that makes it impossible to do

312
00:12:08,260 --> 00:12:11,800
doesn't it okay let's do this so we're

313
00:12:11,800 --> 00:12:13,480
going to read that's what the / r is

314
00:12:13,480 --> 00:12:15,579
read this into pro could have this peak

315
00:12:15,579 --> 00:12:17,860
em grab this bottom one and then I'm

316
00:12:17,860 --> 00:12:20,470
gonna pin local here the reason is is

317
00:12:20,470 --> 00:12:22,839
because I have a couple extra rolls in

318
00:12:22,839 --> 00:12:26,350
here that i use for mostly forensics

319
00:12:26,350 --> 00:12:29,649
it's going to go ahead and show me all

320
00:12:29,649 --> 00:12:31,690
the extra files that it transfers on

321
00:12:31,690 --> 00:12:35,260
this and so give it a second hopefully

322
00:12:35,260 --> 00:12:37,839
it won't die there ago so right now get

323
00:12:37,839 --> 00:12:39,459
this first morning saying no to site

324
00:12:39,459 --> 00:12:42,100
local Nets have been to fi bro pretty

325
00:12:42,100 --> 00:12:43,389
much runs straight off the bar or

326
00:12:43,389 --> 00:12:45,579
straight off the I guess the box are

327
00:12:45,579 --> 00:12:48,519
then packaging um it does have you set

328
00:12:48,519 --> 00:12:49,959
some local Nets if you will just to kind

329
00:12:49,959 --> 00:12:51,970
of help clarify what your local networks

330
00:12:51,970 --> 00:12:54,519
are if you have Wi-Fi networks bro can

331
00:12:54,519 --> 00:12:56,649
actually detect rogue access points so

332
00:12:56,649 --> 00:12:58,060
you can put in your Wi-Fi networks and

333
00:12:58,060 --> 00:12:59,769
instantly alerted to a rogue access

334
00:12:59,769 --> 00:13:02,510
points so this is what we get right here

335
00:13:02,510 --> 00:13:04,460
you can see it was just a bunch of log

336
00:13:04,460 --> 00:13:06,530
files and if week at this out we get

337
00:13:06,530 --> 00:13:09,770
beautiful things like that which does is

338
00:13:09,770 --> 00:13:12,470
hardly any good right um so it's kind of

339
00:13:12,470 --> 00:13:14,090
a mess to look at that we can do a

340
00:13:14,090 --> 00:13:16,670
couple of things to all I can show you

341
00:13:16,670 --> 00:13:19,880
here at the very top I'm on the screen

342
00:13:19,880 --> 00:13:21,020
of course it's a little bit smaller so

343
00:13:21,020 --> 00:13:24,530
it makes a little bit harder hang on the

344
00:13:24,530 --> 00:13:26,090
right there across the top you actually

345
00:13:26,090 --> 00:13:27,350
got the headers for every field

346
00:13:27,350 --> 00:13:29,120
obviously your screens use a little bit

347
00:13:29,120 --> 00:13:30,440
wider so it's going to look a lot better

348
00:13:30,440 --> 00:13:33,020
but you can see things like the time

349
00:13:33,020 --> 00:13:34,850
that happens but I was going to give it

350
00:13:34,850 --> 00:13:36,560
a UID for every event that comes through

351
00:13:36,560 --> 00:13:39,560
there the ID of the originating host

352
00:13:39,560 --> 00:13:42,920
originating port the responding host and

353
00:13:42,920 --> 00:13:45,200
port protocols and it goes across

354
00:13:45,200 --> 00:13:47,570
service things like that so if we take a

355
00:13:47,570 --> 00:13:51,620
look at this we can see in here things

356
00:13:51,620 --> 00:13:53,690
like the ssl log so if we cut it out the

357
00:13:53,690 --> 00:13:56,390
ssl log we'd see a whole lot of stuff in

358
00:13:56,390 --> 00:13:58,100
there and if you notice something right

359
00:13:58,100 --> 00:14:00,530
there as soon as i see that ssl log i

360
00:14:00,530 --> 00:14:03,770
noticed that we have got let me see if i

361
00:14:03,770 --> 00:14:05,360
can even take this apart for you guys

362
00:14:05,360 --> 00:14:10,430
are real quick since it looks so bad of

363
00:14:10,430 --> 00:14:13,190
course it's going to make it so it's

364
00:14:13,190 --> 00:14:15,940
hard to see on here

365
00:14:18,279 --> 00:14:20,630
okay so we got this stuff across the top

366
00:14:20,630 --> 00:14:21,980
and we want to look at some stuff so

367
00:14:21,980 --> 00:14:24,200
we're going to go ahead and cat that log

368
00:14:24,200 --> 00:14:25,820
out and then bro comes with a great

369
00:14:25,820 --> 00:14:28,010
utility called bro cut nice thing about

370
00:14:28,010 --> 00:14:29,630
broke head I just give it what I want to

371
00:14:29,630 --> 00:14:32,980
see so something that stands out is

372
00:14:32,980 --> 00:14:35,839
obviously this has a domain generation

373
00:14:35,839 --> 00:14:37,850
algorithm running so it's a probably a

374
00:14:37,850 --> 00:14:40,010
botnet and the reason i can see that is

375
00:14:40,010 --> 00:14:42,620
because of these server addresses well

376
00:14:42,620 --> 00:14:47,240
as soon as I server name sorry and then

377
00:14:47,240 --> 00:14:49,760
let's look at the subject off the ssl

378
00:14:49,760 --> 00:14:54,410
certificates so here we go so i can take

379
00:14:54,410 --> 00:14:57,380
a look right now and see that all of

380
00:14:57,380 --> 00:14:59,720
these servers that this person on our

381
00:14:59,720 --> 00:15:01,610
network is reaching out to you on the

382
00:15:01,610 --> 00:15:03,950
left i don't know about you guys but I

383
00:15:03,950 --> 00:15:05,630
don't have very many of these saved as

384
00:15:05,630 --> 00:15:08,240
my default sore my browser history of

385
00:15:08,240 --> 00:15:10,700
things that I go to very lately very

386
00:15:10,700 --> 00:15:12,320
often so these are things obviously go

387
00:15:12,320 --> 00:15:14,000
it stand out for you so you could pretty

388
00:15:14,000 --> 00:15:15,980
much look at this and be like okay well

389
00:15:15,980 --> 00:15:17,029
that's something I should investigate

390
00:15:17,029 --> 00:15:18,860
but you can see this person was pretty

391
00:15:18,860 --> 00:15:22,010
lazy too and the servers that they're

392
00:15:22,010 --> 00:15:24,110
connecting to are actually connecting an

393
00:15:24,110 --> 00:15:27,500
ssl but ssl certificate doesn't match

394
00:15:27,500 --> 00:15:29,210
the server they're going to so that's a

395
00:15:29,210 --> 00:15:30,260
very first thing that's one of the

396
00:15:30,260 --> 00:15:31,730
things are looking at right here the

397
00:15:31,730 --> 00:15:33,620
bros detecting that the search don't

398
00:15:33,620 --> 00:15:35,420
match and that's why we have that huge

399
00:15:35,420 --> 00:15:37,850
ssl log and if we even looked at the

400
00:15:37,850 --> 00:15:39,890
easiest ways the notice log so notice

401
00:15:39,890 --> 00:15:41,750
log is pretty much can be anything that

402
00:15:41,750 --> 00:15:44,990
you want to see for sure that's the

403
00:15:44,990 --> 00:15:46,190
exact same thing we just looked at

404
00:15:46,190 --> 00:15:48,350
invalid certain valid server

405
00:15:48,350 --> 00:15:50,330
certificates are showing up all over the

406
00:15:50,330 --> 00:15:53,240
place for validation failed I unable to

407
00:15:53,240 --> 00:15:55,280
get the certificate because it doesn't

408
00:15:55,280 --> 00:15:56,480
match up for the server's not there

409
00:15:56,480 --> 00:15:59,990
anymore some other things I mean if you

410
00:15:59,990 --> 00:16:02,030
think about dunno of any of you guys use

411
00:16:02,030 --> 00:16:04,370
the Microsoft is your service so they

412
00:16:04,370 --> 00:16:07,640
have their cloud-based easy to type of

413
00:16:07,640 --> 00:16:09,620
thing that Microsoft runs which died

414
00:16:09,620 --> 00:16:12,529
twice now I think twice in the last year

415
00:16:12,529 --> 00:16:14,630
two years now all free invalid service

416
00:16:14,630 --> 00:16:17,779
certifications and so it's all from ssl

417
00:16:17,779 --> 00:16:20,270
certs going expired they basically

418
00:16:20,270 --> 00:16:22,220
didn't catch the fact that some of the

419
00:16:22,220 --> 00:16:24,589
ssl certs were expiring so it's bro i

420
00:16:24,589 --> 00:16:27,290
can actually tell it if i have a bro if

421
00:16:27,290 --> 00:16:28,970
i have an ssl sister

422
00:16:28,970 --> 00:16:31,670
excusing if i have an ssl certificate

423
00:16:31,670 --> 00:16:33,050
that's going to expire in the next 30

424
00:16:33,050 --> 00:16:35,000
days i want you to write that out to the

425
00:16:35,000 --> 00:16:37,310
notice lock so then you can choose where

426
00:16:37,310 --> 00:16:38,779
the notice log goes how you're alerted

427
00:16:38,779 --> 00:16:40,399
those things you know that's for you to

428
00:16:40,399 --> 00:16:42,230
customize but it's a fact that bro is

429
00:16:42,230 --> 00:16:43,730
going to automatically look at every

430
00:16:43,730 --> 00:16:45,379
single ssl connection that comes through

431
00:16:45,379 --> 00:16:47,269
there and say hey you should these

432
00:16:47,269 --> 00:16:50,060
people be connecting to self-signed

433
00:16:50,060 --> 00:16:52,009
certificates should these people will be

434
00:16:52,009 --> 00:16:53,600
connecting to certificates that expired

435
00:16:53,600 --> 00:16:56,360
a year ago we can even go as far and say

436
00:16:56,360 --> 00:16:59,560
these certificates were issued by the

437
00:16:59,560 --> 00:17:02,420
certificate authority that we haven't

438
00:17:02,420 --> 00:17:04,520
known compromised too so remember when

439
00:17:04,520 --> 00:17:06,319
those guys are getting like did you know

440
00:17:06,319 --> 00:17:07,280
them and stuff like that we're getting

441
00:17:07,280 --> 00:17:09,380
hacked and their certificates we're

442
00:17:09,380 --> 00:17:11,569
being fraudulently generated you could

443
00:17:11,569 --> 00:17:13,069
just do something simple and bro and say

444
00:17:13,069 --> 00:17:15,199
every time something comes from a known

445
00:17:15,199 --> 00:17:16,640
certificate authority that I just got

446
00:17:16,640 --> 00:17:18,289
hacked I want to see that certificate

447
00:17:18,289 --> 00:17:20,089
and brochures going to spit out all the

448
00:17:20,089 --> 00:17:21,679
certificates that come in there through

449
00:17:21,679 --> 00:17:25,010
there for you and so let's see here

450
00:17:25,010 --> 00:17:30,830
let's go check out another one and this

451
00:17:30,830 --> 00:17:32,470
is going to be pretty much off the

452
00:17:32,470 --> 00:17:35,000
headers coming through so it is going to

453
00:17:35,000 --> 00:17:36,980
look into that ssl but we're not going

454
00:17:36,980 --> 00:17:39,289
to break the ssl connection so we're

455
00:17:39,289 --> 00:17:41,480
only looking at the certificate excel

456
00:17:41,480 --> 00:17:46,039
during the x.509 handshake so here's

457
00:17:46,039 --> 00:17:47,809
this one let's see I can't remember

458
00:17:47,809 --> 00:17:49,730
which one of these sorry I have a lot of

459
00:17:49,730 --> 00:17:52,100
malware so I can never remember which

460
00:17:52,100 --> 00:17:54,440
one has what I need on it so I want to

461
00:17:54,440 --> 00:17:56,980
show you guys same thing read this in

462
00:17:56,980 --> 00:18:01,039
locals same thing about the network and

463
00:18:01,039 --> 00:18:08,500
then um I can tell that this one

464
00:18:08,530 --> 00:18:18,170
so let's see here just shady evening

465
00:18:18,170 --> 00:18:22,520
maybe maybe looking through these and we

466
00:18:22,520 --> 00:18:25,810
can look at some of these things like

467
00:18:25,810 --> 00:18:27,620
here's all the files that got

468
00:18:27,620 --> 00:18:28,880
transferred through here most of these

469
00:18:28,880 --> 00:18:30,800
you'll notice our HTML but then of

470
00:18:30,800 --> 00:18:32,390
course I'll nothing see right there you

471
00:18:32,390 --> 00:18:36,710
got a contact exe some other things I

472
00:18:36,710 --> 00:18:39,650
wanted to show you guys if we can get

473
00:18:39,650 --> 00:18:43,550
turning it to work well do you see it's

474
00:18:43,550 --> 00:18:54,800
a little iffy this is not going to do it

475
00:18:54,800 --> 00:18:57,560
unfortunately today so what this would

476
00:18:57,560 --> 00:18:59,570
be normally we'd have a notice log here

477
00:18:59,570 --> 00:19:02,390
and so that notice log on this one is

478
00:19:02,390 --> 00:19:07,940
going to give me some errors for those

479
00:19:07,940 --> 00:19:09,440
files and what we're doing at these

480
00:19:09,440 --> 00:19:11,480
files if we just look at these files

481
00:19:11,480 --> 00:19:16,730
right quick is these long hashes that

482
00:19:16,730 --> 00:19:19,130
you see are actually md5 and sha-1

483
00:19:19,130 --> 00:19:22,160
hashes so we're running these hashes in

484
00:19:22,160 --> 00:19:25,340
there for every single file at least of

485
00:19:25,340 --> 00:19:27,260
mine and you can see that it's got it

486
00:19:27,260 --> 00:19:29,210
over here on the left hand side where

487
00:19:29,210 --> 00:19:32,570
since it's got a md5 and sha-1 for every

488
00:19:32,570 --> 00:19:33,830
kind of application that comes through

489
00:19:33,830 --> 00:19:35,510
here now we can see this was actually

490
00:19:35,510 --> 00:19:37,970
daus executable but there's really no

491
00:19:37,970 --> 00:19:39,350
way if you were looking at it I mean

492
00:19:39,350 --> 00:19:40,580
that might be fishy to see something

493
00:19:40,580 --> 00:19:42,800
called contact CHC but you don't really

494
00:19:42,800 --> 00:19:44,480
know if it is a virus or what the

495
00:19:44,480 --> 00:19:47,960
chances of it are so what's bro does and

496
00:19:47,960 --> 00:19:50,240
this is by default in the new 2.2 which

497
00:19:50,240 --> 00:19:52,550
is still in beta that's downloadable off

498
00:19:52,550 --> 00:19:55,220
the website is it reaches out in it well

499
00:19:55,220 --> 00:19:56,750
first off it hashes that with the md5

500
00:19:56,750 --> 00:19:58,640
and then it reaches out to that team

501
00:19:58,640 --> 00:20:00,530
call me database guys talking about and

502
00:20:00,530 --> 00:20:03,740
so what they do is they use virustotal

503
00:20:03,740 --> 00:20:05,720
and they have a whole database of known

504
00:20:05,720 --> 00:20:07,940
malware and what they do is they

505
00:20:07,940 --> 00:20:12,290
actually have a dns this says this hindi

506
00:20:12,290 --> 00:20:16,940
x dot team camry calm and whenever bro

507
00:20:16,940 --> 00:20:18,560
reaches out all it does is does a simple

508
00:20:18,560 --> 00:20:20,720
dns lookup on that hash

509
00:20:20,720 --> 00:20:22,669
when that has just returned the DNS

510
00:20:22,669 --> 00:20:24,200
lookup is returned it gives a

511
00:20:24,200 --> 00:20:26,450
probability and Danone statistics about

512
00:20:26,450 --> 00:20:30,110
it so we get things like this shows is

513
00:20:30,110 --> 00:20:32,480
known malware the malware shows up at

514
00:20:32,480 --> 00:20:35,299
least in forty percent of the analyzers

515
00:20:35,299 --> 00:20:37,640
on virustotal and this is what we know

516
00:20:37,640 --> 00:20:39,799
about it you can go to this URL and let

517
00:20:39,799 --> 00:20:42,289
this URL you can analyze it further so

518
00:20:42,289 --> 00:20:44,570
then that way whenever the notice log is

519
00:20:44,570 --> 00:20:46,610
written however you're getting you know

520
00:20:46,610 --> 00:20:48,289
logged in or however you're getting

521
00:20:48,289 --> 00:20:50,390
notified of things in the notice log you

522
00:20:50,390 --> 00:20:52,039
instantly get notification of something

523
00:20:52,039 --> 00:20:54,169
coming through the network keeping the

524
00:20:54,169 --> 00:20:57,620
team camry database and you getting a

525
00:20:57,620 --> 00:21:00,350
malware coming into the network and then

526
00:21:00,350 --> 00:21:01,580
you could even do things like kill

527
00:21:01,580 --> 00:21:04,010
switch access for that computer grab

528
00:21:04,010 --> 00:21:05,720
that executable keep it so that we

529
00:21:05,720 --> 00:21:07,490
always have a copy of it to see where

530
00:21:07,490 --> 00:21:09,380
it's going overthrow to our cuckoo box

531
00:21:09,380 --> 00:21:12,429
cluster so that we can look at it later

532
00:21:12,429 --> 00:21:14,870
so things like that make life a lot

533
00:21:14,870 --> 00:21:17,990
easier and we can look at signatures too

534
00:21:17,990 --> 00:21:19,190
and that's where i have this last one

535
00:21:19,190 --> 00:21:23,450
for us so if we go into this one read

536
00:21:23,450 --> 00:21:29,809
this in and local and on this one let's

537
00:21:29,809 --> 00:21:31,820
kind of work a little bit backwards so

538
00:21:31,820 --> 00:21:33,830
if we're working this one backward as

539
00:21:33,830 --> 00:21:35,240
you show up you see the notice log let's

540
00:21:35,240 --> 00:21:38,900
take a look at it and so we got a

541
00:21:38,900 --> 00:21:41,900
reverse shell and so you can see right

542
00:21:41,900 --> 00:21:45,020
here and we had a signature that said

543
00:21:45,020 --> 00:21:48,289
sensitive signature a tax response it's

544
00:21:48,289 --> 00:21:51,080
a reverse shell back it even tells us

545
00:21:51,080 --> 00:21:54,590
came from VBS info I'm sorry VBS / info

546
00:21:54,590 --> 00:21:57,380
to SP so if we want to look at a little

547
00:21:57,380 --> 00:21:59,110
bit more we can see that that's there

548
00:21:59,110 --> 00:22:01,400
this is the actual signature that hit

549
00:22:01,400 --> 00:22:03,320
right here we can take a look out of it

550
00:22:03,320 --> 00:22:07,250
looks like it's a JavaScript running

551
00:22:07,250 --> 00:22:09,169
through that info to ask you can see the

552
00:22:09,169 --> 00:22:11,659
control for it so you can see how it's

553
00:22:11,659 --> 00:22:12,799
keeping a connection alive and

554
00:22:12,799 --> 00:22:14,780
everything and if we want to figure out

555
00:22:14,780 --> 00:22:16,250
who that was we could actually take a

556
00:22:16,250 --> 00:22:18,409
look at it and say let's look at the

557
00:22:18,409 --> 00:22:21,070
connection log

558
00:22:21,290 --> 00:22:24,440
and we get something like that and let's

559
00:22:24,440 --> 00:22:30,490
say let's cut and look at protocol

560
00:22:30,490 --> 00:22:41,420
servants I'm port let's do this still

561
00:22:41,420 --> 00:22:42,500
kind of come up with some nastiness

562
00:22:42,500 --> 00:22:44,480
looks like that so then we can actually

563
00:22:44,480 --> 00:22:46,760
sort it we can actually let's say we

564
00:22:46,760 --> 00:22:49,030
want to look at niko and maybe the count

565
00:22:49,030 --> 00:22:51,800
so then you can see something else it's

566
00:22:51,800 --> 00:22:53,630
kind of odd right what's odd about that

567
00:22:53,630 --> 00:22:57,040
connection right there at the second one

568
00:22:57,250 --> 00:23:00,620
yeah this is an HTTPS because we'd have

569
00:23:00,620 --> 00:23:03,380
to https because we'd see that this is

570
00:23:03,380 --> 00:23:07,640
HTTP running on 443 so instantly I would

571
00:23:07,640 --> 00:23:08,900
be like that would clue me in to

572
00:23:08,900 --> 00:23:10,790
something's not right I could go and

573
00:23:10,790 --> 00:23:12,230
pull up the host this was coming from

574
00:23:12,230 --> 00:23:14,600
this one right here is an octet stream

575
00:23:14,600 --> 00:23:16,580
from that JavaScript that's running that

576
00:23:16,580 --> 00:23:18,710
reverse shell and of course DNS which is

577
00:23:18,710 --> 00:23:21,050
no big deal on that so you allows you to

578
00:23:21,050 --> 00:23:22,850
actually take a look at and see what's

579
00:23:22,850 --> 00:23:25,250
coming through network break it down so

580
00:23:25,250 --> 00:23:28,550
that you know how they were kind of

581
00:23:28,550 --> 00:23:29,840
diving in a little bit deeper and look

582
00:23:29,840 --> 00:23:31,370
at the pack is to figure out what's

583
00:23:31,370 --> 00:23:35,180
going on so I was making eyes laughing

584
00:23:35,180 --> 00:23:36,950
because I'll even show you to taste this

585
00:23:36,950 --> 00:23:38,810
because I brought up apt one earlier I'm

586
00:23:38,810 --> 00:23:40,970
so I don't know if vmas actually ever

587
00:23:40,970 --> 00:23:43,880
looked at the main dia apt one report so

588
00:23:43,880 --> 00:23:45,590
it was their big report match has some

589
00:23:45,590 --> 00:23:47,120
pretty funny videos of people logging in

590
00:23:47,120 --> 00:23:49,010
and setting up some command and control

591
00:23:49,010 --> 00:23:52,370
of command and control botnets that they

592
00:23:52,370 --> 00:23:54,470
actually had a remote view of their

593
00:23:54,470 --> 00:23:55,730
desktop while they're setting it up

594
00:23:55,730 --> 00:23:58,040
which is pretty entertaining to see so

595
00:23:58,040 --> 00:23:59,630
they send out this big report and the

596
00:23:59,630 --> 00:24:01,250
port had a lot of great information as

597
00:24:01,250 --> 00:24:04,600
far as domains that they know we're bad

598
00:24:04,600 --> 00:24:06,440
ssl-certificates that they know are bad

599
00:24:06,440 --> 00:24:09,140
and file hashes that are known bad but

600
00:24:09,140 --> 00:24:10,520
you get this you get this huge digital

601
00:24:10,520 --> 00:24:11,810
report and you're like well what do I do

602
00:24:11,810 --> 00:24:14,810
with this so one of our developers Seth

603
00:24:14,810 --> 00:24:18,380
that is on the pro core team basically

604
00:24:18,380 --> 00:24:22,640
made it all into made it so you can

605
00:24:22,640 --> 00:24:24,050
bring it into bro and take a look at it

606
00:24:24,050 --> 00:24:25,940
the best part is it's three easy things

607
00:24:25,940 --> 00:24:30,040
to do use go to your bro directory and

608
00:24:30,040 --> 00:24:33,760
then you get clone the apt

609
00:24:33,760 --> 00:24:36,790
Oh both of the ass and the load that

610
00:24:36,790 --> 00:24:38,680
into your local profile your local

611
00:24:38,680 --> 00:24:40,300
profile is kind of like your personal

612
00:24:40,300 --> 00:24:42,150
configuration file where you can load

613
00:24:42,150 --> 00:24:44,140
individual modules that you might

614
00:24:44,140 --> 00:24:45,790
download off the internet modules you

615
00:24:45,790 --> 00:24:47,650
might create intelligent run on your

616
00:24:47,650 --> 00:24:51,280
your bro double deployment so we can

617
00:24:51,280 --> 00:24:52,510
even take a look at this just so you

618
00:24:52,510 --> 00:24:56,380
guys can see how simple coding and bro

619
00:24:56,380 --> 00:24:59,020
is I look a little bit worse I'm here so

620
00:24:59,020 --> 00:25:03,610
here's a fight the capt one and this is

621
00:25:03,610 --> 00:25:06,340
the main broke so we got the data then

622
00:25:06,340 --> 00:25:08,140
the data is basically just the list of

623
00:25:08,140 --> 00:25:12,340
data from that ATP report so known bad

624
00:25:12,340 --> 00:25:13,840
websites not like kind of stuff and

625
00:25:13,840 --> 00:25:16,290
we're just gonna feed this into our bro

626
00:25:16,290 --> 00:25:20,230
script using our bro code which is Alice

627
00:25:20,230 --> 00:25:24,790
deal s so this is it pretty simple so

628
00:25:24,790 --> 00:25:26,020
the first thing is is we're going to

629
00:25:26,020 --> 00:25:27,940
lotus load the notice framework that

630
00:25:27,940 --> 00:25:29,830
allows me to send notices do myself and

631
00:25:29,830 --> 00:25:32,740
to print notices on the screen um we

632
00:25:32,740 --> 00:25:34,330
kind of classify everything that we're

633
00:25:34,330 --> 00:25:36,400
going to bring in the apt one domain hit

634
00:25:36,400 --> 00:25:39,520
certificate hit in the file md5 hit and

635
00:25:39,520 --> 00:25:42,100
then you can see down here pretty simple

636
00:25:42,100 --> 00:25:44,590
every time we see a 509 certificate and

637
00:25:44,590 --> 00:25:46,300
there's a connection we're going to take

638
00:25:46,300 --> 00:25:47,920
a look at it and we're going to compare

639
00:25:47,920 --> 00:25:50,440
it to the one to the apt I have 509

640
00:25:50,440 --> 00:25:53,140
serials the subjects line if that it

641
00:25:53,140 --> 00:25:54,760
hits done we're going to ride out to the

642
00:25:54,760 --> 00:25:57,940
notice log that there was a possible

643
00:25:57,940 --> 00:26:00,460
certificate from an apt apt one report

644
00:26:00,460 --> 00:26:04,630
scene same thing with DNS requests so I

645
00:26:04,630 --> 00:26:06,250
mean that's what one two three four five

646
00:26:06,250 --> 00:26:09,450
six seven eight nine ten lines one for

647
00:26:09,450 --> 00:26:14,320
DNS 14 x509 s and one for hashes so Bros

648
00:26:14,320 --> 00:26:16,000
automatically doing the hashing for you

649
00:26:16,000 --> 00:26:17,710
it's just comparing this off that file

650
00:26:17,710 --> 00:26:20,370
and the best part about this is not only

651
00:26:20,370 --> 00:26:22,180
can I do this with all the traffic

652
00:26:22,180 --> 00:26:24,580
that's coming in with bro i can reach

653
00:26:24,580 --> 00:26:26,620
back into the past and look at all the

654
00:26:26,620 --> 00:26:28,050
traffic that i already still have on my

655
00:26:28,050 --> 00:26:31,480
bro box so i can look back and say well

656
00:26:31,480 --> 00:26:33,370
maybe we're not seeing something now but

657
00:26:33,370 --> 00:26:36,730
how do we know computer wasn't you know

658
00:26:36,730 --> 00:26:38,770
exploited a week two weeks three months

659
00:26:38,770 --> 00:26:40,660
ago then this just allows you to going

660
00:26:40,660 --> 00:26:44,110
to run this and go back and see if you

661
00:26:44,110 --> 00:26:45,670
did have an issue that occurred that

662
00:26:45,670 --> 00:26:48,450
maybe you haven't even found yet

663
00:26:48,450 --> 00:26:50,830
okay so that's pretty much looking at

664
00:26:50,830 --> 00:26:54,040
bro as far as traffic at the actual

665
00:26:54,040 --> 00:26:57,370
blurb with the bro IDs and now we're

666
00:26:57,370 --> 00:26:58,660
kind of looking at a little bit of the

667
00:26:58,660 --> 00:27:04,900
ICS data embedded systems the first

668
00:27:04,900 --> 00:27:06,309
thing we take a look at is the case

669
00:27:06,309 --> 00:27:10,000
study so everybody here this morning or

670
00:27:10,000 --> 00:27:11,080
most people here this morning heard HD

671
00:27:11,080 --> 00:27:13,690
talk about what they called internet

672
00:27:13,690 --> 00:27:17,200
census of 2012 it started in May of last

673
00:27:17,200 --> 00:27:20,799
years of May 2012 into may I believe the

674
00:27:20,799 --> 00:27:22,830
30th was when the deployment occurred um

675
00:27:22,830 --> 00:27:26,919
it was picked up by ashish which is a

676
00:27:26,919 --> 00:27:29,020
that's a pretty graphic so he showed the

677
00:27:29,020 --> 00:27:31,030
u.s. section this is actually the world

678
00:27:31,030 --> 00:27:33,250
you can see china was actually when the

679
00:27:33,250 --> 00:27:36,130
hardest it was getting hit by the

680
00:27:36,130 --> 00:27:40,270
devices and so here's a sheesha big bro

681
00:27:40,270 --> 00:27:42,400
users actually over in berkeley at the

682
00:27:42,400 --> 00:27:45,790
lbl labs where they have a huge bro

683
00:27:45,790 --> 00:27:48,640
cluster of i think it's almost like nine

684
00:27:48,640 --> 00:27:51,910
or 10 racks full of machines just doing

685
00:27:51,910 --> 00:27:55,419
bro and so he actually found this in

686
00:27:55,419 --> 00:27:57,520
june so i believe was about a week or

687
00:27:57,520 --> 00:27:59,910
two weeks after the deployment occur

688
00:27:59,910 --> 00:28:02,080
obviously we got permission to talk

689
00:28:02,080 --> 00:28:03,760
about it i believe about two and a half

690
00:28:03,760 --> 00:28:06,490
weeks ago so this was a huge deal

691
00:28:06,490 --> 00:28:09,130
because what we are what she saw and

692
00:28:09,130 --> 00:28:11,260
going through the pro clusters was a

693
00:28:11,260 --> 00:28:13,540
bunch of webcams they were getting just

694
00:28:13,540 --> 00:28:15,730
own left and right and whenever we start

695
00:28:15,730 --> 00:28:17,260
tracking it back it goes all the way

696
00:28:17,260 --> 00:28:20,230
back to one particular manufacturer in

697
00:28:20,230 --> 00:28:22,720
china that these are all coming from the

698
00:28:22,720 --> 00:28:24,549
problem was as they were in OEM for

699
00:28:24,549 --> 00:28:26,650
about 100 companies at cell disease so

700
00:28:26,650 --> 00:28:28,150
these are just cameras that you see at

701
00:28:28,150 --> 00:28:31,990
walmart sam's club amazoncom things that

702
00:28:31,990 --> 00:28:34,780
people order for their businesses and so

703
00:28:34,780 --> 00:28:37,090
what it was is it how to exploit don't

704
00:28:37,090 --> 00:28:38,440
even really call it i mean it is

705
00:28:38,440 --> 00:28:40,660
basically turning on a service there are

706
00:28:40,660 --> 00:28:42,820
some other issues where if you went and

707
00:28:42,820 --> 00:28:44,100
changed your password on your web

708
00:28:44,100 --> 00:28:46,030
interface thinking that you were being

709
00:28:46,030 --> 00:28:48,580
very safe it wasn't changing the root

710
00:28:48,580 --> 00:28:50,770
password on the busy box that was

711
00:28:50,770 --> 00:28:53,049
running underneath so the embedded linux

712
00:28:53,049 --> 00:28:54,730
system underneath had the default

713
00:28:54,730 --> 00:28:57,549
password that never got updated and even

714
00:28:57,549 --> 00:29:00,610
whenever you change the password on the

715
00:29:00,610 --> 00:29:03,760
password on the actual web interface and

716
00:29:03,760 --> 00:29:05,020
a lot of people were just plugging these

717
00:29:05,020 --> 00:29:07,090
in forward facing the internet and they

718
00:29:07,090 --> 00:29:08,440
were monitoring all kinds of things you

719
00:29:08,440 --> 00:29:11,500
can see private offices building's lobby

720
00:29:11,500 --> 00:29:13,990
security cameras from different places

721
00:29:13,990 --> 00:29:15,940
and people have them at home plugged

722
00:29:15,940 --> 00:29:18,429
into the internet and so what was

723
00:29:18,429 --> 00:29:20,679
happening is this would be like pretty

724
00:29:20,679 --> 00:29:22,809
much your standard HTTP traffic going

725
00:29:22,809 --> 00:29:24,820
through so this is a standard outfit of

726
00:29:24,820 --> 00:29:26,440
what you should be seeing off the camera

727
00:29:26,440 --> 00:29:28,330
and what people were doing is going in

728
00:29:28,330 --> 00:29:31,600
there and dumped in a payload in via

729
00:29:31,600 --> 00:29:36,460
very crafted and HTTP code to turn on an

730
00:29:36,460 --> 00:29:38,950
ftp server which allowed them to put

731
00:29:38,950 --> 00:29:42,520
different things in there as far as busy

732
00:29:42,520 --> 00:29:44,740
box and upgrading it a little bit adding

733
00:29:44,740 --> 00:29:48,309
tools to it traceroute in map all kinds

734
00:29:48,309 --> 00:29:49,360
of things got actually put in there a

735
00:29:49,360 --> 00:29:51,010
little bit then part of this mapping

736
00:29:51,010 --> 00:29:53,770
internet so you can see even if you were

737
00:29:53,770 --> 00:29:55,720
just taking something simple like taking

738
00:29:55,720 --> 00:29:57,370
your network traffic and graphing it out

739
00:29:57,370 --> 00:29:59,740
with bro if you had something to look

740
00:29:59,740 --> 00:30:01,600
like that that suddenly change to that

741
00:30:01,600 --> 00:30:04,090
you should be exciting concerned well

742
00:30:04,090 --> 00:30:06,309
not only does bro sit there and let you

743
00:30:06,309 --> 00:30:08,169
look at all the packets coming in but

744
00:30:08,169 --> 00:30:10,090
it's also passively watching traffic

745
00:30:10,090 --> 00:30:12,250
going out and it can tell you things

746
00:30:12,250 --> 00:30:13,750
about that traffic as far as what

747
00:30:13,750 --> 00:30:16,150
services are running I have versions of

748
00:30:16,150 --> 00:30:17,799
those surfaces that are running so that

749
00:30:17,799 --> 00:30:19,120
you can kind of get the full picture

750
00:30:19,120 --> 00:30:22,270
what's going on in your network so here

751
00:30:22,270 --> 00:30:24,070
is another one where you can see the

752
00:30:24,070 --> 00:30:25,690
connection log and we're just looking at

753
00:30:25,690 --> 00:30:28,120
services running on that device where it

754
00:30:28,120 --> 00:30:31,360
went from 14 HTTP packets and all of a

755
00:30:31,360 --> 00:30:34,120
sudden you see a new service came in ftp

756
00:30:34,120 --> 00:30:36,460
and then we got this to ftp data being

757
00:30:36,460 --> 00:30:42,370
sent from the camera and same thing this

758
00:30:42,370 --> 00:30:44,440
is known services so if you have bro

759
00:30:44,440 --> 00:30:46,299
sitting there passively watch your

760
00:30:46,299 --> 00:30:48,160
network it constantly prints out all

761
00:30:48,160 --> 00:30:49,990
known services and allows you to compare

762
00:30:49,990 --> 00:30:53,049
that so that you can say you know today

763
00:30:53,049 --> 00:30:56,230
i got HTTP two tomorrow i got ftp server

764
00:30:56,230 --> 00:30:57,940
especially if you're sitting in your

765
00:30:57,940 --> 00:30:59,950
network at your office and you can watch

766
00:30:59,950 --> 00:31:01,990
services start up and shouldn't be

767
00:31:01,990 --> 00:31:03,970
starting up it allows you to quickly

768
00:31:03,970 --> 00:31:05,350
know that something's not right under

769
00:31:05,350 --> 00:31:09,040
network and so here's the commands of

770
00:31:09,040 --> 00:31:10,300
what they were doing so even if you

771
00:31:10,300 --> 00:31:12,460
wanted to die down really deep you can

772
00:31:12,460 --> 00:31:13,809
see the normal commands that should be

773
00:31:13,809 --> 00:31:14,509
coming out of the

774
00:31:14,509 --> 00:31:16,369
hammer unit and the commands that

775
00:31:16,369 --> 00:31:17,719
allowed you to go in and change the

776
00:31:17,719 --> 00:31:20,779
configuration the configure an ftp

777
00:31:20,779 --> 00:31:24,409
server and then redo that main cgil out

778
00:31:24,409 --> 00:31:26,899
basically a back-end services running on

779
00:31:26,899 --> 00:31:29,149
all those embedded devices so one thing

780
00:31:29,149 --> 00:31:30,649
you didn't talk much about is how far

781
00:31:30,649 --> 00:31:32,989
reaching us was I suggest anybody to

782
00:31:32,989 --> 00:31:34,849
read just Google that internet since is

783
00:31:34,849 --> 00:31:38,209
2012 about it because the guys the gems

784
00:31:38,209 --> 00:31:40,699
men running it i should say um playing

785
00:31:40,699 --> 00:31:43,039
on hitting um i believe was like a

786
00:31:43,039 --> 00:31:45,379
thousand to fifteen hundred units they

787
00:31:45,379 --> 00:31:46,969
end up deploying on four hundred and

788
00:31:46,969 --> 00:31:50,269
twenty thousand units worldwide which

789
00:31:50,269 --> 00:31:52,549
was insane so basically it was all these

790
00:31:52,549 --> 00:31:55,909
particular pretty much cameras from this

791
00:31:55,909 --> 00:31:59,449
one OEM that they modify or they built

792
00:31:59,449 --> 00:32:01,039
their own code for it compiled it and

793
00:32:01,039 --> 00:32:02,779
then just let it kind of unleash itself

794
00:32:02,779 --> 00:32:05,149
where it went ahead spread neat thing

795
00:32:05,149 --> 00:32:07,639
about is allowed them to give us a lot

796
00:32:07,639 --> 00:32:11,269
of data back um you know who it is make

797
00:32:11,269 --> 00:32:12,379
sure you don't say anything because i

798
00:32:12,379 --> 00:32:13,789
can tell you a lot of resources we

799
00:32:13,789 --> 00:32:15,619
didn't to find this person it was a big

800
00:32:15,619 --> 00:32:18,469
deal for a while government got really

801
00:32:18,469 --> 00:32:20,869
involved super computer lab time was

802
00:32:20,869 --> 00:32:23,179
devoted to this just trying to figure

803
00:32:23,179 --> 00:32:24,889
out what was going on because it was

804
00:32:24,889 --> 00:32:27,739
just blown slow these cameras were only

805
00:32:27,739 --> 00:32:30,949
skating like ten IP addresses over the

806
00:32:30,949 --> 00:32:34,009
course of all day time sometimes so very

807
00:32:34,009 --> 00:32:35,749
low very slow one or two packets here

808
00:32:35,749 --> 00:32:40,279
you didn't get much back and forth which

809
00:32:40,279 --> 00:32:42,739
made it extremely hard for them to track

810
00:32:42,739 --> 00:32:43,909
down and try to find the command and

811
00:32:43,909 --> 00:32:46,389
control structure of it reading the

812
00:32:46,389 --> 00:32:48,589
article afterwards that the guys put out

813
00:32:48,589 --> 00:32:50,869
is hilarious because he even put into

814
00:32:50,869 --> 00:32:52,669
read me on these devices and he made he

815
00:32:52,669 --> 00:32:54,769
was very safe every process he put on

816
00:32:54,769 --> 00:32:56,329
there was very low priority so would

817
00:32:56,329 --> 00:32:58,579
interfere with the camera a readme was

818
00:32:58,579 --> 00:33:00,499
there saying that hey your device is

819
00:33:00,499 --> 00:33:02,989
using default passwords we're not doing

820
00:33:02,989 --> 00:33:04,669
anything bad we're just trying to scan

821
00:33:04,669 --> 00:33:07,309
the entire internet and it already they

822
00:33:07,309 --> 00:33:08,989
return even though services won't be

823
00:33:08,989 --> 00:33:11,419
affected and so the report he put out

824
00:33:11,419 --> 00:33:12,829
that believe like HD says like nine

825
00:33:12,829 --> 00:33:14,869
terabytes of data it all came out from

826
00:33:14,869 --> 00:33:16,699
that report it's great to look at it's

827
00:33:16,699 --> 00:33:18,319
great for us to look at and look at all

828
00:33:18,319 --> 00:33:19,970
the information

829
00:33:19,970 --> 00:33:27,020
ash spell or ability yeah and so that

830
00:33:27,020 --> 00:33:28,430
was one of the funny things doing so he

831
00:33:28,430 --> 00:33:30,650
sends out this deployment and whenever

832
00:33:30,650 --> 00:33:31,940
they get to some of the cameras they

833
00:33:31,940 --> 00:33:33,380
realized that there's already a payload

834
00:33:33,380 --> 00:33:35,510
package there so somebody's already made

835
00:33:35,510 --> 00:33:37,220
malware based off of what they're

836
00:33:37,220 --> 00:33:39,590
looking at all so and so since they

837
00:33:39,590 --> 00:33:40,970
didn't want the malware to mess with

838
00:33:40,970 --> 00:33:42,350
what they were doing that I actually

839
00:33:42,350 --> 00:33:45,290
changed firewall rules and updated the

840
00:33:45,290 --> 00:33:47,690
patches and changed passwords so the dog

841
00:33:47,690 --> 00:33:49,460
malware would stop spreading so that

842
00:33:49,460 --> 00:33:51,560
they could continue with their scan so

843
00:33:51,560 --> 00:33:52,910
yeah it is a pretty interesting thing

844
00:33:52,910 --> 00:33:56,120
but it also shows two things what's

845
00:33:56,120 --> 00:33:57,820
running on your embedded devices at your

846
00:33:57,820 --> 00:34:01,790
at your enterprise level people don't

847
00:34:01,790 --> 00:34:03,260
think about anymore they get in brand

848
00:34:03,260 --> 00:34:05,360
new TVs and I plug him in the Smart TVs

849
00:34:05,360 --> 00:34:08,060
and I renfro at home and it always

850
00:34:08,060 --> 00:34:09,679
catches me off guard and I start seeing

851
00:34:09,679 --> 00:34:12,679
data from my network gentle out to

852
00:34:12,679 --> 00:34:15,860
Taiwan and China Korea and stuff like

853
00:34:15,860 --> 00:34:18,409
that and I got to the point where it was

854
00:34:18,409 --> 00:34:22,219
my damn TV I to samsung 60-inch TV that

855
00:34:22,219 --> 00:34:24,080
was going everywhere and so I was like

856
00:34:24,080 --> 00:34:26,540
wallah kill that I'll just deny dns

857
00:34:26,540 --> 00:34:28,699
service to it it would tunnel around it

858
00:34:28,699 --> 00:34:30,320
it would set up its own dns servers and

859
00:34:30,320 --> 00:34:32,360
find him bail for samsung would like to

860
00:34:32,360 --> 00:34:33,980
have their own in different places so we

861
00:34:33,980 --> 00:34:35,900
keep you from blocking it and that also

862
00:34:35,900 --> 00:34:39,110
gave us a great ideas I worked on

863
00:34:39,110 --> 00:34:40,670
several projects where we red team and

864
00:34:40,670 --> 00:34:42,560
that's exactly what we did capture all

865
00:34:42,560 --> 00:34:44,929
the data coming through and then we then

866
00:34:44,929 --> 00:34:46,270
that was the simplest thing we found

867
00:34:46,270 --> 00:34:49,280
packages of updates coming to these TVs

868
00:34:49,280 --> 00:34:51,460
coming to devices inside the network's

869
00:34:51,460 --> 00:34:53,570
projectors a lot of projectors now have

870
00:34:53,570 --> 00:34:55,730
Wi-Fi built in so that I can actually

871
00:34:55,730 --> 00:34:57,260
use my laptop connected projector with

872
00:34:57,260 --> 00:34:59,810
Wi-Fi and no cords are involved a lot of

873
00:34:59,810 --> 00:35:01,010
people are plugging those projectors

874
00:35:01,010 --> 00:35:02,240
into the network because it does great

875
00:35:02,240 --> 00:35:03,710
things like tells you when the bulbs

876
00:35:03,710 --> 00:35:05,360
going to run out how long you have until

877
00:35:05,360 --> 00:35:07,730
that bulbs running out and interacting

878
00:35:07,730 --> 00:35:09,550
with automation systems at corporations

879
00:35:09,550 --> 00:35:11,690
but the problem is is you can pivot

880
00:35:11,690 --> 00:35:13,010
through those a lot of times and that's

881
00:35:13,010 --> 00:35:15,260
what we were doing well with the TV the

882
00:35:15,260 --> 00:35:17,210
first thing I did is I saw that that

883
00:35:17,210 --> 00:35:18,760
firmware package come down and I said

884
00:35:18,760 --> 00:35:21,230
well I got a firmware package Nellie can

885
00:35:21,230 --> 00:35:23,120
I take it apart remain it through an

886
00:35:23,120 --> 00:35:25,160
unzip process I'm sure enough I pulled

887
00:35:25,160 --> 00:35:27,290
out the entire firmware update modified

888
00:35:27,290 --> 00:35:30,140
it sent it back to my TV when I sent it

889
00:35:30,140 --> 00:35:31,850
back to my TV there was no valid or no

890
00:35:31,850 --> 00:35:33,380
verification of

891
00:35:33,380 --> 00:35:36,180
any kind of like chef ivory md5 or

892
00:35:36,180 --> 00:35:37,680
anything to check in the authenticity of

893
00:35:37,680 --> 00:35:40,680
that update it just rain it so of course

894
00:35:40,680 --> 00:35:43,440
maybe me I to put busybox on it so I

895
00:35:43,440 --> 00:35:45,840
busybox running on my TV and so I could

896
00:35:45,840 --> 00:35:49,050
actually um tell it in an ssh into my TV

897
00:35:49,050 --> 00:35:50,880
and I had a little interpreter that I

898
00:35:50,880 --> 00:35:52,590
ended up building and so I could pivot

899
00:35:52,590 --> 00:35:54,090
through my TV and do scanning at the

900
00:35:54,090 --> 00:35:56,220
house and stuff just to demonstrate how

901
00:35:56,220 --> 00:36:00,300
easy it is this isn't some great master

902
00:36:00,300 --> 00:36:03,180
mind as I crap you with code I am a

903
00:36:03,180 --> 00:36:05,490
horrible I don't program and this is

904
00:36:05,490 --> 00:36:06,990
something that I did in the course of

905
00:36:06,990 --> 00:36:09,300
like four to six hours so is super

906
00:36:09,300 --> 00:36:10,950
simple for anybody to get in there do it

907
00:36:10,950 --> 00:36:13,080
and people forget that everything now is

908
00:36:13,080 --> 00:36:15,630
a linux box of some kind I mean you have

909
00:36:15,630 --> 00:36:17,490
so many embedded devices running that

910
00:36:17,490 --> 00:36:19,320
you would not believe how many of them

911
00:36:19,320 --> 00:36:20,580
are talking to the outside of your

912
00:36:20,580 --> 00:36:24,270
network sorry we got keep on going okay

913
00:36:24,270 --> 00:36:26,790
so we talked about embedded devices now

914
00:36:26,790 --> 00:36:29,280
we're going to go back to the SCADA ICS

915
00:36:29,280 --> 00:36:32,220
who was at that talk earlier few people

916
00:36:32,220 --> 00:36:34,860
lot of people deal with stated ICS show

917
00:36:34,860 --> 00:36:38,340
bro and so Rho not to be confused the

918
00:36:38,340 --> 00:36:40,380
pro all up bro as national science

919
00:36:40,380 --> 00:36:41,940
foundation we get grants and stuff like

920
00:36:41,940 --> 00:36:43,650
that one of the big ones we just got

921
00:36:43,650 --> 00:36:47,040
about a month ago um yeah September the

922
00:36:47,040 --> 00:36:50,100
first actually um was a big one to look

923
00:36:50,100 --> 00:36:53,070
at ICS and skated of Isis so we've taken

924
00:36:53,070 --> 00:36:54,630
those and we've brought them into bro

925
00:36:54,630 --> 00:36:56,100
and we're working on research on that

926
00:36:56,100 --> 00:36:59,250
the department and so bro automatically

927
00:36:59,250 --> 00:37:01,050
are I should sound like bro already

928
00:37:01,050 --> 00:37:04,020
speaks and understands Modbus and dl mp3

929
00:37:04,020 --> 00:37:08,570
so i can already take and put bro on a

930
00:37:08,570 --> 00:37:11,670
full skater network because okay the

931
00:37:11,670 --> 00:37:13,260
people that work with skater raise your

932
00:37:13,260 --> 00:37:17,460
hand nobody one really well most of your

933
00:37:17,460 --> 00:37:19,290
security teams if you were saved you're

934
00:37:19,290 --> 00:37:20,790
going to do a vulnerability assessment

935
00:37:20,790 --> 00:37:22,650
they wouldn't freak out too bad come in

936
00:37:22,650 --> 00:37:24,780
skin and our stuff like that you tell an

937
00:37:24,780 --> 00:37:26,400
ICS skater group that you're going to

938
00:37:26,400 --> 00:37:28,380
come to a vulnerability assessment it's

939
00:37:28,380 --> 00:37:33,090
like cold sweats and vomiting and it is

940
00:37:33,090 --> 00:37:34,560
scary I mean they will not let you touch

941
00:37:34,560 --> 00:37:36,780
it and the reason is a lot of seek women

942
00:37:36,780 --> 00:37:39,030
tis very old and then we did some things

943
00:37:39,030 --> 00:37:41,190
like we took some controllers and it

944
00:37:41,190 --> 00:37:43,590
only spoke cereal and they just made

945
00:37:43,590 --> 00:37:46,830
kind of a TCP at tcp/ip adapter and kind

946
00:37:46,830 --> 00:37:47,010
of

947
00:37:47,010 --> 00:37:49,410
literally bolted it on to it and they

948
00:37:49,410 --> 00:37:50,820
just plugged it into something and it

949
00:37:50,820 --> 00:37:52,290
worked and we don't touch it from there

950
00:37:52,290 --> 00:37:54,450
and a lot of times it's because there's

951
00:37:54,450 --> 00:37:56,160
these facilities that these are running

952
00:37:56,160 --> 00:37:58,620
in or things we can't take down right be

953
00:37:58,620 --> 00:38:00,090
there be a production plant whether it

954
00:38:00,090 --> 00:38:02,100
be pipeline whether it be water

955
00:38:02,100 --> 00:38:04,470
treatment sewage cept like that or

956
00:38:04,470 --> 00:38:05,670
things that people don't want to shut

957
00:38:05,670 --> 00:38:08,220
down half of it is because they don't

958
00:38:08,220 --> 00:38:09,600
know if this will come back up I

959
00:38:09,600 --> 00:38:11,460
mean this stuff's been running since the

960
00:38:11,460 --> 00:38:14,520
70s we just don't touch it and so that

961
00:38:14,520 --> 00:38:17,160
was that's pretty much the mind frame

962
00:38:17,160 --> 00:38:18,210
where were you go into these

963
00:38:18,210 --> 00:38:20,220
environments so when the nice thing to

964
00:38:20,220 --> 00:38:23,820
do is bring modbus and end up broke and

965
00:38:23,820 --> 00:38:26,460
Rob rotary the package love Brody sites

966
00:38:26,460 --> 00:38:28,560
to see what's going on and then talk

967
00:38:28,560 --> 00:38:30,210
about that stuff so here's a typical

968
00:38:30,210 --> 00:38:33,180
deployment and the best part about all

969
00:38:33,180 --> 00:38:34,710
this is why this all came up and i

970
00:38:34,710 --> 00:38:36,330
believe probably one of the main reasons

971
00:38:36,330 --> 00:38:39,060
we got this grant is because there's a

972
00:38:39,060 --> 00:38:40,770
lot of vulnerabilities out we talked

973
00:38:40,770 --> 00:38:42,900
about those in the talk earlier but

974
00:38:42,900 --> 00:38:44,130
there's a lot more that people don't

975
00:38:44,130 --> 00:38:46,860
even realize that are out there so we

976
00:38:46,860 --> 00:38:49,590
can take these devices and some of them

977
00:38:49,590 --> 00:38:51,450
even have IP tables and everything when

978
00:38:51,450 --> 00:38:54,120
I'm running busybox already get into

979
00:38:54,120 --> 00:38:56,190
there's rip and there's actually already

980
00:38:56,190 --> 00:38:57,960
and I'm sorry because I can't remember

981
00:38:57,960 --> 00:38:59,820
the name but there's a whole like

982
00:38:59,820 --> 00:39:03,300
metasploit just for these devices so you

983
00:39:03,300 --> 00:39:05,580
can automatically generate pivot

984
00:39:05,580 --> 00:39:06,900
sessions you can come in and change

985
00:39:06,900 --> 00:39:10,560
values you can build and create a whole

986
00:39:10,560 --> 00:39:13,920
binary package send it to it and then go

987
00:39:13,920 --> 00:39:16,020
ahead and give it through the network in

988
00:39:16,020 --> 00:39:18,860
the hack from the bottom up if you will

989
00:39:18,860 --> 00:39:21,870
and so pro takes of things and we love

990
00:39:21,870 --> 00:39:23,520
it and this is the thing about bro that

991
00:39:23,520 --> 00:39:25,410
I like the most so here's something on

992
00:39:25,410 --> 00:39:27,000
the network we're looking at something

993
00:39:27,000 --> 00:39:30,330
and so this is coming through and we

994
00:39:30,330 --> 00:39:33,240
notice that say 121 here is a Modbus

995
00:39:33,240 --> 00:39:35,820
slave and all of a sudden down here it's

996
00:39:35,820 --> 00:39:38,250
a mod best master is that right is that

997
00:39:38,250 --> 00:39:40,080
good should these things beat my best

998
00:39:40,080 --> 00:39:42,840
masters and i don't know i'm not an ICS

999
00:39:42,840 --> 00:39:44,580
kind of guy but the thing is is that we

1000
00:39:44,580 --> 00:39:46,740
can look into the protocol just fine and

1001
00:39:46,740 --> 00:39:48,570
then we can give that to the people that

1002
00:39:48,570 --> 00:39:49,890
should know so your engineers that

1003
00:39:49,890 --> 00:39:51,750
should know what is going on these

1004
00:39:51,750 --> 00:39:54,330
communication platforms if this is right

1005
00:39:54,330 --> 00:39:58,020
or wrong should we you know this is one

1006
00:39:58,020 --> 00:40:00,390
I like so here's a here's some equipment

1007
00:40:00,390 --> 00:40:00,810
talking

1008
00:40:00,810 --> 00:40:03,330
now we got the blue line here no we're

1009
00:40:03,330 --> 00:40:05,310
you lying in the red line what's normal

1010
00:40:05,310 --> 00:40:07,080
and and I don't know what's normal for

1011
00:40:07,080 --> 00:40:10,140
your environment so it allows you to

1012
00:40:10,140 --> 00:40:11,910
basically here's a way we take this

1013
00:40:11,910 --> 00:40:13,470
throw it into a graph and we can look at

1014
00:40:13,470 --> 00:40:15,660
things well should this be dipping down

1015
00:40:15,660 --> 00:40:16,860
below blue I don't know it's this

1016
00:40:16,860 --> 00:40:20,100
pressure of a pipeline is this impedance

1017
00:40:20,100 --> 00:40:23,910
of you know current going to some switch

1018
00:40:23,910 --> 00:40:26,220
things out I don't know but things that

1019
00:40:26,220 --> 00:40:28,470
we can go ahead and pump into bro thing

1020
00:40:28,470 --> 00:40:30,630
research that we can deep do we can do

1021
00:40:30,630 --> 00:40:32,940
so we can say this is normal this isn't

1022
00:40:32,940 --> 00:40:34,980
normal what do we need to know about the

1023
00:40:34,980 --> 00:40:36,750
events going on in my network so is the

1024
00:40:36,750 --> 00:40:39,450
river traffic on yeah that's exactly

1025
00:40:39,450 --> 00:40:42,960
right that's the continuous p so they

1026
00:40:42,960 --> 00:40:47,010
can shut down the power I know allows

1027
00:40:47,010 --> 00:40:49,680
you to read so here's registers changing

1028
00:40:49,680 --> 00:40:51,660
grows don't sit there monitor the wire

1029
00:40:51,660 --> 00:40:53,760
as things happened you can set it up so

1030
00:40:53,760 --> 00:40:55,020
you could have a likely set up for

1031
00:40:55,020 --> 00:40:58,020
alerts notifications you could even make

1032
00:40:58,020 --> 00:40:59,850
it so bells and whistles go off if you

1033
00:40:59,850 --> 00:41:01,530
want things that you would want to know

1034
00:41:01,530 --> 00:41:03,210
that could be occurring so that if

1035
00:41:03,210 --> 00:41:05,430
somebody came in there and said writes

1036
00:41:05,430 --> 00:41:07,620
all the registers do off all the

1037
00:41:07,620 --> 00:41:09,900
registers to on 01 whatever they need to

1038
00:41:09,900 --> 00:41:11,850
be things that we can be alerted about

1039
00:41:11,850 --> 00:41:13,790
these are happening on the Modbus

1040
00:41:13,790 --> 00:41:16,530
protocol and this is like I said this is

1041
00:41:16,530 --> 00:41:18,060
one that we just got funded so we are

1042
00:41:18,060 --> 00:41:19,950
diving into it more so if your

1043
00:41:19,950 --> 00:41:21,570
enterprise has industrial control

1044
00:41:21,570 --> 00:41:23,280
systems and stuff like that you might be

1045
00:41:23,280 --> 00:41:25,590
when it comes out to us and maybe we can

1046
00:41:25,590 --> 00:41:27,060
work something out we can actually come

1047
00:41:27,060 --> 00:41:29,130
in there look at what you have and work

1048
00:41:29,130 --> 00:41:30,480
back and forth to see if we can figure

1049
00:41:30,480 --> 00:41:32,940
out a way for us to be able to monitor

1050
00:41:32,940 --> 00:41:37,440
it more closely we talked about some of

1051
00:41:37,440 --> 00:41:39,240
the different apps that are here in the

1052
00:41:39,240 --> 00:41:43,140
pro app portfolio the nice thing about

1053
00:41:43,140 --> 00:41:45,210
no is it runs on some large large

1054
00:41:45,210 --> 00:41:48,120
networks we said the wrens at lbl on a /

1055
00:41:48,120 --> 00:41:50,670
8 it runs on a lot of universities and

1056
00:41:50,670 --> 00:41:52,710
stuff like that that's our core or both

1057
00:41:52,710 --> 00:41:56,460
started as the education university area

1058
00:41:56,460 --> 00:41:58,890
where you're pretty much working like an

1059
00:41:58,890 --> 00:42:00,900
ISP not only do you have to support

1060
00:42:00,900 --> 00:42:04,260
servers and get traffic from point A to

1061
00:42:04,260 --> 00:42:06,570
B but you guys have to provide an

1062
00:42:06,570 --> 00:42:07,830
internet service mostly for your

1063
00:42:07,830 --> 00:42:09,840
students to be able to use internet and

1064
00:42:09,840 --> 00:42:12,330
access different things so we had a bro

1065
00:42:12,330 --> 00:42:13,080
box below

1066
00:42:13,080 --> 00:42:15,330
in there and you can see one 24-hour

1067
00:42:15,330 --> 00:42:19,110
period we had 49,000 almost 50,000

1068
00:42:19,110 --> 00:42:20,580
unique applications that came through

1069
00:42:20,580 --> 00:42:22,830
there so different versions of Chrome

1070
00:42:22,830 --> 00:42:27,440
different versions of Firefox different

1071
00:42:27,440 --> 00:42:30,030
handsets and sup like that on there but

1072
00:42:30,030 --> 00:42:32,010
then you can take bro plug it in to

1073
00:42:32,010 --> 00:42:34,710
enterprise and we can passively look at

1074
00:42:34,710 --> 00:42:35,880
all the traffic going through and tell

1075
00:42:35,880 --> 00:42:37,920
you things like how many versions of

1076
00:42:37,920 --> 00:42:39,900
Java you have running right now how far

1077
00:42:39,900 --> 00:42:42,030
behind are you in Java how many versions

1078
00:42:42,030 --> 00:42:44,670
of PHP's are at PHP is your servers

1079
00:42:44,670 --> 00:42:47,340
running how far behind are you and your

1080
00:42:47,340 --> 00:42:50,070
patch cycle what if some Joe Blow and

1081
00:42:50,070 --> 00:42:51,890
I've worked on a project like this

1082
00:42:51,890 --> 00:42:54,840
decommission some box and put it in a

1083
00:42:54,840 --> 00:42:57,180
closet five years ago somebody else

1084
00:42:57,180 --> 00:42:58,470
decide use it for something else but

1085
00:42:58,470 --> 00:43:00,510
i'll point it into the network and then

1086
00:43:00,510 --> 00:43:02,670
opened access doing wire trades or

1087
00:43:02,670 --> 00:43:04,320
something like that these are things you

1088
00:43:04,320 --> 00:43:05,580
would want to know things that you can

1089
00:43:05,580 --> 00:43:08,370
alert yourself fun so here's some of the

1090
00:43:08,370 --> 00:43:09,630
things like you would see so here's just

1091
00:43:09,630 --> 00:43:13,500
android phones well there's a pad i have

1092
00:43:13,500 --> 00:43:15,270
touchpad tear running through the

1093
00:43:15,270 --> 00:43:16,830
network and you can see how far down

1094
00:43:16,830 --> 00:43:20,040
into that device we can see as far as

1095
00:43:20,040 --> 00:43:22,020
virgin information just passively

1096
00:43:22,020 --> 00:43:26,130
watching traffic and this is one we

1097
00:43:26,130 --> 00:43:29,850
plugged into a corporation that honey

1098
00:43:29,850 --> 00:43:31,200
know if I'm supposed to show this action

1099
00:43:31,200 --> 00:43:33,530
but this was literally a large

1100
00:43:33,530 --> 00:43:36,240
corporation running in the United States

1101
00:43:36,240 --> 00:43:38,940
with lots of lots of retail space and

1102
00:43:38,940 --> 00:43:40,800
this is how many versions of PHP they

1103
00:43:40,800 --> 00:43:43,620
had running through the network and then

1104
00:43:43,620 --> 00:43:45,660
we were like oh they're like is that bad

1105
00:43:45,660 --> 00:43:46,950
and we're like well let's just take one

1106
00:43:46,950 --> 00:43:48,900
we said we took five to three because it

1107
00:43:48,900 --> 00:43:50,580
was right in the middle and we pulled it

1108
00:43:50,580 --> 00:43:52,710
up then we said you know it could be

1109
00:43:52,710 --> 00:43:55,860
worse I guess but 25 code execution

1110
00:43:55,860 --> 00:43:58,140
exploits known for just that one version

1111
00:43:58,140 --> 00:44:00,950
I mean things like that and make it huge

1112
00:44:00,950 --> 00:44:03,060
that's a huge deal for a corporation

1113
00:44:03,060 --> 00:44:05,100
especially if these are going through

1114
00:44:05,100 --> 00:44:06,600
the firewall these are entering the

1115
00:44:06,600 --> 00:44:08,010
internet so these are publicly

1116
00:44:08,010 --> 00:44:12,900
accessible is very bad it honestly

1117
00:44:12,900 --> 00:44:14,490
depends on the corporation has very

1118
00:44:14,490 --> 00:44:16,620
average because people plug-in stuff

1119
00:44:16,620 --> 00:44:18,780
that they don't want to touch her told

1120
00:44:18,780 --> 00:44:20,370
not to touch where they forgot about

1121
00:44:20,370 --> 00:44:22,890
right and then just like we were talking

1122
00:44:22,890 --> 00:44:24,210
about earlier whenever they're talking

1123
00:44:24,210 --> 00:44:25,210
about I

1124
00:44:25,210 --> 00:44:27,550
skata stuff when update comes out the

1125
00:44:27,550 --> 00:44:29,380
vulnerability is known it's not patched

1126
00:44:29,380 --> 00:44:31,300
for six months and then it's usually

1127
00:44:31,300 --> 00:44:33,010
another six months before you get any

1128
00:44:33,010 --> 00:44:36,730
kind of a patch rolled out to you and

1129
00:44:36,730 --> 00:44:39,730
locally so this is pretty common depends

1130
00:44:39,730 --> 00:44:41,620
on how your sensors are picked it you

1131
00:44:41,620 --> 00:44:44,200
know is a place to pick up traffic this

1132
00:44:44,200 --> 00:44:47,640
is pretty common so we can catch Jason's

1133
00:44:47,640 --> 00:44:51,700
juice is malformed our um so they're

1134
00:44:51,700 --> 00:44:53,890
pretty much runs me all the time and if

1135
00:44:53,890 --> 00:44:55,540
you want to talk more if you want to

1136
00:44:55,540 --> 00:44:57,520
look at some of these files later you

1137
00:44:57,520 --> 00:44:59,890
can write down my github I'll go and put

1138
00:44:59,890 --> 00:45:02,770
all the malware up there I have if your

1139
00:45:02,770 --> 00:45:04,750
linux oh I'm sorry if your Apple person

1140
00:45:04,750 --> 00:45:06,580
there's a nightly version of bro that's

1141
00:45:06,580 --> 00:45:09,460
up to date I usually update once a week

1142
00:45:09,460 --> 00:45:13,600
or so um Twitter IRC there's a broad

1143
00:45:13,600 --> 00:45:15,430
channel on IRC there's lots of

1144
00:45:15,430 --> 00:45:16,900
developers always hanging out so if you

1145
00:45:16,900 --> 00:45:19,270
have questions use gill net channel and

1146
00:45:19,270 --> 00:45:20,970
ask your question somebody on either

1147
00:45:20,970 --> 00:45:24,310
tell you how to fix it how to run it or

1148
00:45:24,310 --> 00:45:26,170
they'll say that's a good idea chances

1149
00:45:26,170 --> 00:45:27,610
are somebody's gonna drop you something

1150
00:45:27,610 --> 00:45:30,460
30 minutes later how you can detect it

1151
00:45:30,460 --> 00:45:33,820
it's amazingly quick and then you can

1152
00:45:33,820 --> 00:45:40,020
email me if you like um yes what's that

1153
00:45:40,020 --> 00:45:44,560
bosque on that list I would have to so

1154
00:45:44,560 --> 00:45:46,720
basically we were scared he was getting

1155
00:45:46,720 --> 00:45:48,130
embedded because it came down to one

1156
00:45:48,130 --> 00:45:50,440
owing a manufacturer I would have to

1157
00:45:50,440 --> 00:45:52,030
look at the full list and I don't think

1158
00:45:52,030 --> 00:45:53,920
we have the full list of all the

1159
00:45:53,920 --> 00:45:56,080
different devices that they make but it

1160
00:45:56,080 --> 00:45:57,820
was pretty much your lower in cameras

1161
00:45:57,820 --> 00:45:59,410
there were some mids in there it was

1162
00:45:59,410 --> 00:46:01,750
your lower in cameras the DVRs they hook

1163
00:46:01,750 --> 00:46:04,000
up to those are also under the same

1164
00:46:04,000 --> 00:46:06,250
thing so yeah the DVRs had more

1165
00:46:06,250 --> 00:46:08,050
processing power so if you will read

1166
00:46:08,050 --> 00:46:10,000
that report and he talks about the main

1167
00:46:10,000 --> 00:46:12,370
notes those are usually mostly the DVR

1168
00:46:12,370 --> 00:46:14,170
actual units that were in there Zarah

1169
00:46:14,170 --> 00:46:17,670
made to handle more processing power

1170
00:46:18,020 --> 00:46:19,610
like say if you have any questions or

1171
00:46:19,610 --> 00:46:20,930
anything I'll be out there you can hit

1172
00:46:20,930 --> 00:46:24,790
me up and then I appreciate it guys

