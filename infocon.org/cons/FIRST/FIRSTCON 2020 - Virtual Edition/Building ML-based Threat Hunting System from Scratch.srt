1
00:00:00,000 --> 00:00:02,240
actual edition of the 32nd annual first

2
00:00:02,240 --> 00:00:03,439
conference

3
00:00:03,439 --> 00:00:07,440
uh glad to be here moderating um

4
00:00:07,759 --> 00:00:10,480
just a couple of reminders please be

5
00:00:10,480 --> 00:00:10,880
sure

6
00:00:10,880 --> 00:00:13,759
that you utilize the q a function at the

7
00:00:13,759 --> 00:00:15,360
bottom of the screen to submit any

8
00:00:15,360 --> 00:00:17,199
questions for our presenter

9
00:00:17,199 --> 00:00:19,600
along the way um outside of that you

10
00:00:19,600 --> 00:00:21,520
won't hear much from me

11
00:00:21,520 --> 00:00:24,080
and i'm going to go ahead and hand it

12
00:00:24,080 --> 00:00:25,760
over with that to ck

13
00:00:25,760 --> 00:00:28,720
who's joining us he's a senior

14
00:00:28,720 --> 00:00:30,080
researcher at scicraft

15
00:00:30,080 --> 00:00:32,238
and will be presenting to us today on

16
00:00:32,238 --> 00:00:33,600
developing a

17
00:00:33,600 --> 00:00:35,600
machine learning based threat hunting

18
00:00:35,600 --> 00:00:37,200
system from scratch

19
00:00:37,200 --> 00:00:40,559
ck over to you sir thank you

20
00:00:42,559 --> 00:00:44,879
yes hello everyone and thanks for mike's

21
00:00:44,879 --> 00:00:46,000
introduction

22
00:00:46,000 --> 00:00:49,120
and can you see my screen now we sure

23
00:00:49,120 --> 00:00:50,960
can yeah

24
00:00:50,960 --> 00:00:53,840
i think it's okay okay so today our our

25
00:00:53,840 --> 00:00:54,480
topic is

26
00:00:54,480 --> 00:00:56,879
building a ml best way hunting system

27
00:00:56,879 --> 00:00:58,239
from scratch am i

28
00:00:58,239 --> 00:01:02,078
ck chain you can just call me ck

29
00:01:02,960 --> 00:01:05,920
here i just quickly introduce myself uh

30
00:01:05,920 --> 00:01:06,640
just as

31
00:01:06,640 --> 00:01:08,880
mike introduced i'm a security

32
00:01:08,880 --> 00:01:09,680
researcher

33
00:01:09,680 --> 00:01:12,560
at scicrypt and i get my phd degree from

34
00:01:12,560 --> 00:01:14,400
national geological university

35
00:01:14,400 --> 00:01:16,640
and have published some of my research

36
00:01:16,640 --> 00:01:17,600
in

37
00:01:17,600 --> 00:01:21,439
many technical conferences like playhead

38
00:01:21,439 --> 00:01:25,200
hid and my retired ctf player

39
00:01:25,200 --> 00:01:28,479
and i have joined for devcon uh twice

40
00:01:28,479 --> 00:01:32,479
in 2016 and 2018 and i also lead our

41
00:01:32,479 --> 00:01:33,119
student

42
00:01:33,119 --> 00:01:35,520
into the bach bounty and discovered

43
00:01:35,520 --> 00:01:37,439
several vulnerabilities in

44
00:01:37,439 --> 00:01:40,880
synage and qnap which is a commercial

45
00:01:40,880 --> 00:01:44,479
nas device and i'm also an

46
00:01:44,479 --> 00:01:46,560
active member in taiwan's security

47
00:01:46,560 --> 00:01:47,759
community

48
00:01:47,759 --> 00:01:50,479
so i'm a member of hikam and in this

49
00:01:50,479 --> 00:01:52,479
year i'm chairman of hikong

50
00:01:52,479 --> 00:01:56,159
review board okay and

51
00:01:56,159 --> 00:01:58,640
i also quickly introduce our company the

52
00:01:58,640 --> 00:01:59,680
site correct

53
00:01:59,680 --> 00:02:02,479
we are the start our company which move

54
00:02:02,479 --> 00:02:04,079
on our third year

55
00:02:04,079 --> 00:02:06,479
and we use a lot of ai or machine

56
00:02:06,479 --> 00:02:08,000
learning to solve the security

57
00:02:08,000 --> 00:02:11,038
problem so currently we have three

58
00:02:11,038 --> 00:02:13,760
systems sensor is used for free hunting

59
00:02:13,760 --> 00:02:15,520
and cyberturtle is a three

60
00:02:15,520 --> 00:02:18,560
intelligence platform and the cycaria is

61
00:02:18,560 --> 00:02:20,160
a brand of our

62
00:02:20,160 --> 00:02:23,200
apt investigation and we use about

63
00:02:23,200 --> 00:02:25,520
um more than 15 machine learning model

64
00:02:25,520 --> 00:02:27,200
in this system

65
00:02:27,200 --> 00:02:30,640
so talk has a high relationship

66
00:02:30,640 --> 00:02:33,360
to this distance we borrow experience

67
00:02:33,360 --> 00:02:34,640
and design

68
00:02:34,640 --> 00:02:37,920
philosophy from this

69
00:02:38,720 --> 00:02:41,840
and we also joined the mitre attc k

70
00:02:41,840 --> 00:02:42,879
evaluation

71
00:02:42,879 --> 00:02:45,200
in the last year and we get a nice

72
00:02:45,200 --> 00:02:46,000
result

73
00:02:46,000 --> 00:02:49,120
if you're interested about that you can

74
00:02:49,120 --> 00:02:54,400
follow the article here in our blog

75
00:02:54,400 --> 00:02:57,599
yes and now come back to today's

76
00:02:57,599 --> 00:03:01,040
uh talk this is my online

77
00:03:01,040 --> 00:03:02,720
i will first introduce a machine

78
00:03:02,720 --> 00:03:04,959
learning and three hunting

79
00:03:04,959 --> 00:03:06,879
and then we will introduce each version

80
00:03:06,879 --> 00:03:08,800
of our system

81
00:03:08,800 --> 00:03:12,400
from version 0 to version 3.

82
00:03:12,400 --> 00:03:14,560
so i think what is most important is

83
00:03:14,560 --> 00:03:15,920
that we want to give a

84
00:03:15,920 --> 00:03:18,879
step-by-step approach our thought

85
00:03:18,879 --> 00:03:19,760
process

86
00:03:19,760 --> 00:03:23,040
and how can we gradually improve our

87
00:03:23,040 --> 00:03:25,519
system to have a more

88
00:03:25,519 --> 00:03:28,560
performance and we will also cover the

89
00:03:28,560 --> 00:03:29,120
tool

90
00:03:29,120 --> 00:03:31,680
the method and architecture that we use

91
00:03:31,680 --> 00:03:33,280
to build a system

92
00:03:33,280 --> 00:03:34,720
and of course we will give some

93
00:03:34,720 --> 00:03:38,080
evaluation in the end

94
00:03:42,239 --> 00:03:44,959
so the three hunting is a predictive and

95
00:03:44,959 --> 00:03:46,319
iteratively mining

96
00:03:46,319 --> 00:03:48,799
suspicious activities to discover the

97
00:03:48,799 --> 00:03:50,720
taker's storyline

98
00:03:50,720 --> 00:03:52,879
for here we want to highlight the

99
00:03:52,879 --> 00:03:54,799
taker's storyline

100
00:03:54,799 --> 00:03:57,360
because we believe a lot we are not only

101
00:03:57,360 --> 00:03:59,920
need to find a second point of attack

102
00:03:59,920 --> 00:04:00,400
but

103
00:04:00,400 --> 00:04:03,599
need to connect every point to identify

104
00:04:03,599 --> 00:04:05,760
the storyline

105
00:04:05,760 --> 00:04:07,840
and now everyone know that when we deal

106
00:04:07,840 --> 00:04:09,519
with a threat hunting

107
00:04:09,519 --> 00:04:11,040
problem there will be a lot of

108
00:04:11,040 --> 00:04:12,560
possibility

109
00:04:12,560 --> 00:04:14,720
and we want to use machine learning to

110
00:04:14,720 --> 00:04:15,840
remove this

111
00:04:15,840 --> 00:04:19,040
uh uh both positive

112
00:04:19,040 --> 00:04:21,040
and leave only the most several in

113
00:04:21,040 --> 00:04:22,720
incident uh

114
00:04:22,720 --> 00:04:27,600
so human analytics can do the analysis

115
00:04:27,600 --> 00:04:30,400
okay but however because this process is

116
00:04:30,400 --> 00:04:32,000
quite complicated

117
00:04:32,000 --> 00:04:34,000
so cannot be solved by one single

118
00:04:34,000 --> 00:04:35,440
machine learning component

119
00:04:35,440 --> 00:04:37,040
so we need to build a machine learning

120
00:04:37,040 --> 00:04:38,800
pipeline and use several

121
00:04:38,800 --> 00:04:40,840
learning components to solve this

122
00:04:40,840 --> 00:04:42,000
problem

123
00:04:42,000 --> 00:04:45,040
so here is one of our key uh

124
00:04:45,040 --> 00:04:47,120
idea to build this system but machine

125
00:04:47,120 --> 00:04:48,160
learning

126
00:04:48,160 --> 00:04:50,720
is not a magic and cannot do everything

127
00:04:50,720 --> 00:04:52,080
it's just a mapping of

128
00:04:52,080 --> 00:04:55,280
human's mind yeah so he just reflects

129
00:04:55,280 --> 00:04:58,479
how we can solve the problem

130
00:04:58,479 --> 00:05:00,720
so for this purpose we build a system

131
00:05:00,720 --> 00:05:02,880
called fujicoma

132
00:05:02,880 --> 00:05:05,720
and it's a poc system uh for the

133
00:05:05,720 --> 00:05:09,199
semi-automatic three hunting

134
00:05:09,199 --> 00:05:12,320
and the fujikuma is a character in uh

135
00:05:12,320 --> 00:05:13,120
japanese

136
00:05:13,120 --> 00:05:15,680
animation goes in the shield uh why

137
00:05:15,680 --> 00:05:17,360
we're using this name

138
00:05:17,360 --> 00:05:20,479
because uh

139
00:05:20,639 --> 00:05:23,360
this robot for tacoma he can work by

140
00:05:23,360 --> 00:05:24,320
himself

141
00:05:24,320 --> 00:05:27,039
but if a human can help him he can do

142
00:05:27,039 --> 00:05:27,600
much more

143
00:05:27,600 --> 00:05:30,160
better so this match our design

144
00:05:30,160 --> 00:05:31,199
philosophy

145
00:05:31,199 --> 00:05:34,560
that uh our system can work by himself

146
00:05:34,560 --> 00:05:37,840
but if we can have some not to help them

147
00:05:37,840 --> 00:05:38,880
they would

148
00:05:38,880 --> 00:05:42,639
do it better and as previous mentioned

149
00:05:42,639 --> 00:05:43,440
because

150
00:05:43,440 --> 00:05:47,120
we cannot cover every machine learning

151
00:05:47,120 --> 00:05:49,039
problem here and cannot build a too

152
00:05:49,039 --> 00:05:50,720
complicated system here

153
00:05:50,720 --> 00:05:53,199
so here we focus only on the process

154
00:05:53,199 --> 00:05:54,560
creation event

155
00:05:54,560 --> 00:05:57,120
with the command line to make the

156
00:05:57,120 --> 00:05:58,400
problem more

157
00:05:58,400 --> 00:06:02,880
simpler and can build this poc system

158
00:06:04,639 --> 00:06:07,600
and when we come to the machine learning

159
00:06:07,600 --> 00:06:08,400
problem

160
00:06:08,400 --> 00:06:12,560
one important is twice our data set

161
00:06:12,560 --> 00:06:15,440
so in order to prepare our data site we

162
00:06:15,440 --> 00:06:17,039
build a system called

163
00:06:17,039 --> 00:06:21,280
cui apt and this emulator can

164
00:06:21,280 --> 00:06:24,400
automate it to trying to add a system

165
00:06:24,400 --> 00:06:26,479
and do a little movement and do a

166
00:06:26,479 --> 00:06:27,919
previous escalation

167
00:06:27,919 --> 00:06:31,039
just like the hacker will do and the

168
00:06:31,039 --> 00:06:33,280
result will be fit into a fujcoma

169
00:06:33,280 --> 00:06:37,039
or analysis and in this emulation

170
00:06:37,039 --> 00:06:39,440
platform we use a two playbook

171
00:06:39,440 --> 00:06:42,880
the first playbook is apt3

172
00:06:42,880 --> 00:06:45,919
in this part we just follow the miter

173
00:06:45,919 --> 00:06:47,520
evaluation round one

174
00:06:47,520 --> 00:06:49,840
and use the empire to emulation this

175
00:06:49,840 --> 00:06:51,759
apt3 attack

176
00:06:51,759 --> 00:06:54,639
so i think it's a very also authority

177
00:06:54,639 --> 00:06:56,479
apd scenario

178
00:06:56,479 --> 00:06:59,840
and in this case we have about 6000

179
00:06:59,840 --> 00:07:02,960
process creation event and

180
00:07:02,960 --> 00:07:05,360
in the second playbook we call it the

181
00:07:05,360 --> 00:07:06,960
gaza mousekoi

182
00:07:06,960 --> 00:07:09,039
and in this part we use the messpoi to

183
00:07:09,039 --> 00:07:10,080
emulate the

184
00:07:10,080 --> 00:07:14,840
tech and we also borrow some techniques

185
00:07:14,840 --> 00:07:18,160
experience and the mower in our past

186
00:07:18,160 --> 00:07:21,840
apt cases and put into this environment

187
00:07:21,840 --> 00:07:24,639
so this case is a little larger we have

188
00:07:24,639 --> 00:07:25,759
about 60

189
00:07:25,759 --> 00:07:29,599
process creation bed and below is our

190
00:07:29,599 --> 00:07:30,000
system

191
00:07:30,000 --> 00:07:32,960
architecture for the emulation part we

192
00:07:32,960 --> 00:07:33,759
use

193
00:07:33,759 --> 00:07:36,720
the beats kibana and elasticsearch to

194
00:07:36,720 --> 00:07:38,000
build our infra

195
00:07:38,000 --> 00:07:41,039
and use the empire and the main

196
00:07:41,039 --> 00:07:44,400
mass poi to run the attack

197
00:07:44,400 --> 00:07:46,160
and in the right hand side is our

198
00:07:46,160 --> 00:07:49,280
fujicoma to use for the three hunting

199
00:07:49,280 --> 00:07:52,319
so the mainly we use the scaler and we

200
00:07:52,319 --> 00:07:52,960
also

201
00:07:52,960 --> 00:07:56,400
include a neo4j for grab analysis and

202
00:07:56,400 --> 00:07:59,599
we also use a an ltk in some cases we

203
00:07:59,599 --> 00:08:00,720
use some

204
00:08:00,720 --> 00:08:04,879
nlp technique in this system

205
00:08:06,720 --> 00:08:09,039
so in the very beginning we can think of

206
00:08:09,039 --> 00:08:09,840
very very

207
00:08:09,840 --> 00:08:14,080
trivial idea is like build a model

208
00:08:14,080 --> 00:08:17,599
here and give a lot of event to training

209
00:08:17,599 --> 00:08:19,680
and then we can give each event to the

210
00:08:19,680 --> 00:08:21,599
model and model can charge

211
00:08:21,599 --> 00:08:25,440
it is malicious or not

212
00:08:25,440 --> 00:08:27,199
if we can build this one it will be

213
00:08:27,199 --> 00:08:29,039
trivial to solve a problem

214
00:08:29,039 --> 00:08:32,240
uh but however we have quickly realized

215
00:08:32,240 --> 00:08:34,479
that this approach has some problem and

216
00:08:34,479 --> 00:08:36,000
cannot be implemented

217
00:08:36,000 --> 00:08:39,599
so we will continue to to to list

218
00:08:39,599 --> 00:08:42,640
some problems that will will be lit will

219
00:08:42,640 --> 00:08:43,039
be

220
00:08:43,039 --> 00:08:46,320
encountered in this problem

221
00:08:46,320 --> 00:08:48,399
so the first problem when we deal with

222
00:08:48,399 --> 00:08:49,839
this problem is that

223
00:08:49,839 --> 00:08:53,200
when we deal with threat hunting uh

224
00:08:53,200 --> 00:08:56,320
we have only the weak signal a

225
00:08:56,320 --> 00:08:59,680
event the information provided by a

226
00:08:59,680 --> 00:09:01,839
single event is very weak

227
00:09:01,839 --> 00:09:04,480
and tough and ambiguous to make a

228
00:09:04,480 --> 00:09:05,680
decision

229
00:09:05,680 --> 00:09:08,320
for example if we find a command called

230
00:09:08,320 --> 00:09:08,800
who am

231
00:09:08,800 --> 00:09:12,320
i or nested can we say it's malicious or

232
00:09:12,320 --> 00:09:13,519
not

233
00:09:13,519 --> 00:09:15,680
i think it cannot because ambiguous

234
00:09:15,680 --> 00:09:17,440
sometimes it may be good one

235
00:09:17,440 --> 00:09:20,080
but sometimes it will be a malicious one

236
00:09:20,080 --> 00:09:20,560
so

237
00:09:20,560 --> 00:09:22,320
it cannot be judged without more

238
00:09:22,320 --> 00:09:24,240
contextual information

239
00:09:24,240 --> 00:09:27,760
so this is our first problem

240
00:09:28,160 --> 00:09:29,920
and the second problem is the imbalance

241
00:09:29,920 --> 00:09:31,440
dataset

242
00:09:31,440 --> 00:09:34,720
so compared to the normal activities

243
00:09:34,720 --> 00:09:36,640
only a small amount of events are

244
00:09:36,640 --> 00:09:39,200
related to the tech

245
00:09:39,200 --> 00:09:41,839
so this kind of imbalanced data set will

246
00:09:41,839 --> 00:09:42,959
make a pure

247
00:09:42,959 --> 00:09:45,600
su supervised machine learning

248
00:09:45,600 --> 00:09:46,959
ineffective

249
00:09:46,959 --> 00:09:49,519
yeah just like a picture depict here we

250
00:09:49,519 --> 00:09:51,200
can see the normal event is

251
00:09:51,200 --> 00:09:56,160
very much larger than the malicious one

252
00:09:57,040 --> 00:09:59,600
and next the third problem that we want

253
00:09:59,600 --> 00:10:00,880
to solve is that

254
00:10:00,880 --> 00:10:04,720
a lack of high quality label yeah

255
00:10:04,720 --> 00:10:07,040
generating label is a time consuming and

256
00:10:07,040 --> 00:10:08,320
high level

257
00:10:08,320 --> 00:10:12,000
cost task and especially for the

258
00:10:12,000 --> 00:10:14,880
security field we need an expert to do a

259
00:10:14,880 --> 00:10:15,440
label

260
00:10:15,440 --> 00:10:17,519
and it will waste a lot of human

261
00:10:17,519 --> 00:10:19,839
resource

262
00:10:20,240 --> 00:10:24,160
and to make the things worse is that

263
00:10:24,160 --> 00:10:26,240
labor will not generate enough and

264
00:10:26,240 --> 00:10:29,040
cannot migrate to the other situation

265
00:10:29,040 --> 00:10:32,240
and environment for example before we

266
00:10:32,240 --> 00:10:32,959
identify

267
00:10:32,959 --> 00:10:36,160
a pssq in my environment and

268
00:10:36,160 --> 00:10:39,279
i don't use the pssq so this psa sq

269
00:10:39,279 --> 00:10:42,720
might be ambitious one but in this case

270
00:10:42,720 --> 00:10:45,200
in the other enterprise in other

271
00:10:45,200 --> 00:10:46,240
environment

272
00:10:46,240 --> 00:10:49,279
maybe a psq uh is legal

273
00:10:49,279 --> 00:10:51,760
it's used only used by the administrator

274
00:10:51,760 --> 00:10:53,440
so it's not malicious

275
00:10:53,440 --> 00:10:55,680
so that means this information is

276
00:10:55,680 --> 00:10:57,120
contextual related

277
00:10:57,120 --> 00:10:59,360
so the label cannot be migrated and

278
00:10:59,360 --> 00:11:02,640
reused in other cases

279
00:11:03,279 --> 00:11:05,680
the last one and my thing is quite

280
00:11:05,680 --> 00:11:06,800
important

281
00:11:06,800 --> 00:11:10,240
is to build storyline so within

282
00:11:10,240 --> 00:11:12,560
if we want to track into the root cause

283
00:11:12,560 --> 00:11:13,600
we not only

284
00:11:13,600 --> 00:11:16,160
need to find a single malicious attack

285
00:11:16,160 --> 00:11:17,760
but need to construct

286
00:11:17,760 --> 00:11:21,839
the whole storyline to investigation

287
00:11:21,839 --> 00:11:24,160
so just like the picture below if we can

288
00:11:24,160 --> 00:11:26,000
build this kind of storyline

289
00:11:26,000 --> 00:11:28,800
we can understand what a taker used for

290
00:11:28,800 --> 00:11:29,760
initial advice

291
00:11:29,760 --> 00:11:32,480
used for privileged escalation and cnc

292
00:11:32,480 --> 00:11:33,839
and dual recon

293
00:11:33,839 --> 00:11:36,320
so that will give more information for

294
00:11:36,320 --> 00:11:38,480
us

295
00:11:38,800 --> 00:11:40,959
so now we know that in this version we

296
00:11:40,959 --> 00:11:42,399
will have

297
00:11:42,399 --> 00:11:45,120
these four problems and then we continue

298
00:11:45,120 --> 00:11:46,079
to

299
00:11:46,079 --> 00:11:48,240
move to version one we're trying to

300
00:11:48,240 --> 00:11:50,000
solve some problem

301
00:11:50,000 --> 00:11:52,560
so for our version one we're trying to

302
00:11:52,560 --> 00:11:54,839
solve the problem lies there is too few

303
00:11:54,839 --> 00:11:58,880
information in a single event

304
00:11:59,120 --> 00:12:01,760
so our idea is like if we can connecting

305
00:12:01,760 --> 00:12:02,720
the information

306
00:12:02,720 --> 00:12:06,560
from a several events and to make a

307
00:12:06,560 --> 00:12:10,079
analysis unit then we can cover more

308
00:12:10,079 --> 00:12:12,959
contextual information and have more

309
00:12:12,959 --> 00:12:16,240
information to make the judgment

310
00:12:16,240 --> 00:12:19,040
so our future coma in version one will

311
00:12:19,040 --> 00:12:19,440
first

312
00:12:19,440 --> 00:12:22,639
cluster similar uh well first aggregate

313
00:12:22,639 --> 00:12:23,920
information

314
00:12:23,920 --> 00:12:27,200
for an event and to make an analysis

315
00:12:27,200 --> 00:12:28,480
unit

316
00:12:28,480 --> 00:12:32,639
yeah and then try to cluster similar

317
00:12:32,639 --> 00:12:33,680
analysis

318
00:12:33,680 --> 00:12:37,040
unit and this our clustering is try to

319
00:12:37,040 --> 00:12:38,560
solve the problem three

320
00:12:38,560 --> 00:12:41,040
hard to retrieve label data because in

321
00:12:41,040 --> 00:12:42,240
this case

322
00:12:42,240 --> 00:12:44,560
we use a clustering to identify similar

323
00:12:44,560 --> 00:12:45,360
event

324
00:12:45,360 --> 00:12:48,639
also uh the investigator

325
00:12:48,639 --> 00:12:51,279
they do not need to label each event but

326
00:12:51,279 --> 00:12:51,680
only

327
00:12:51,680 --> 00:12:54,560
need to label on every cluster so it

328
00:12:54,560 --> 00:12:57,920
will save much more time

329
00:13:00,800 --> 00:13:03,519
so to build the analysis unit we come

330
00:13:03,519 --> 00:13:05,760
back to think what our human expert

331
00:13:05,760 --> 00:13:08,480
will handle this kind of problem when we

332
00:13:08,480 --> 00:13:09,519
encounter

333
00:13:09,519 --> 00:13:12,560
a suspicious process what will we do

334
00:13:12,560 --> 00:13:15,040
so maybe we will first to forward

335
00:13:15,040 --> 00:13:17,279
tracking the process creation behavior

336
00:13:17,279 --> 00:13:20,160
and finding all the process created by

337
00:13:20,160 --> 00:13:22,240
this suspicious process

338
00:13:22,240 --> 00:13:25,519
and second we may try to bail tracking

339
00:13:25,519 --> 00:13:28,399
to try to locate the root cause and find

340
00:13:28,399 --> 00:13:30,320
a parent process

341
00:13:30,320 --> 00:13:32,880
so based on this experience with trying

342
00:13:32,880 --> 00:13:34,240
to uh

343
00:13:34,240 --> 00:13:37,680
build analysis unit

344
00:13:38,160 --> 00:13:41,920
so so we build analysis unit like this

345
00:13:41,920 --> 00:13:44,800
so currently we are trying to analyze

346
00:13:44,800 --> 00:13:45,920
the coming one

347
00:13:45,920 --> 00:13:48,399
so we follow his trial process and we

348
00:13:48,399 --> 00:13:49,120
also

349
00:13:49,120 --> 00:13:50,959
collect the information in his parent

350
00:13:50,959 --> 00:13:53,760
process and put each command here

351
00:13:53,760 --> 00:13:56,880
and in this format command 0 command 1

352
00:13:56,880 --> 00:13:58,399
command 2 command 3

353
00:13:58,399 --> 00:14:01,279
and phone the document like a lot so

354
00:14:01,279 --> 00:14:03,600
compared to the single

355
00:14:03,600 --> 00:14:07,040
uh single command in this case

356
00:14:07,040 --> 00:14:11,199
we have more uh context more document

357
00:14:11,199 --> 00:14:15,040
more information to make a judgment

358
00:14:15,040 --> 00:14:16,880
and after we have this information we

359
00:14:16,880 --> 00:14:18,399
use a tf idea

360
00:14:18,399 --> 00:14:21,839
to do the factorization

361
00:14:21,839 --> 00:14:24,800
yeah and after vectorization we use a

362
00:14:24,800 --> 00:14:25,600
k-mean

363
00:14:25,600 --> 00:14:29,279
to cluster to grouping a similar

364
00:14:29,279 --> 00:14:32,639
analysis unit together

365
00:14:33,360 --> 00:14:36,720
so here we can see the group t9

366
00:14:36,720 --> 00:14:39,760
and here is some benign group that are

367
00:14:39,760 --> 00:14:40,160
doing

368
00:14:40,160 --> 00:14:43,279
similar things and for hacker coming

369
00:14:43,279 --> 00:14:44,320
into your system

370
00:14:44,320 --> 00:14:46,240
they are also possible like they use the

371
00:14:46,240 --> 00:14:47,519
same tool

372
00:14:47,519 --> 00:14:51,440
to do the attack behavior

373
00:14:51,440 --> 00:14:53,680
okay

374
00:14:54,480 --> 00:14:57,040
so here is our version one so we have a

375
00:14:57,040 --> 00:14:58,240
lot of event

376
00:14:58,240 --> 00:15:00,639
and we build a process tree and build a

377
00:15:00,639 --> 00:15:01,600
unique builder

378
00:15:01,600 --> 00:15:04,560
to build a unit and then we use the tf

379
00:15:04,560 --> 00:15:05,519
idf to turn

380
00:15:05,519 --> 00:15:09,040
into a document and then we use the

381
00:15:09,040 --> 00:15:12,160
k-means for the clustering and in

382
00:15:12,160 --> 00:15:14,959
this part the investigator can involve

383
00:15:14,959 --> 00:15:16,480
to label each cluster

384
00:15:16,480 --> 00:15:19,920
with its malicious or not so

385
00:15:19,920 --> 00:15:22,639
the result we can identify malicious

386
00:15:22,639 --> 00:15:24,959
event

387
00:15:25,440 --> 00:15:27,600
so here is our version one it solves

388
00:15:27,600 --> 00:15:28,480
some problem

389
00:15:28,480 --> 00:15:31,360
but we still have other proper remains

390
00:15:31,360 --> 00:15:32,720
for example the problem to

391
00:15:32,720 --> 00:15:35,839
embellish data set and caming yeah it's

392
00:15:35,839 --> 00:15:37,279
not good at a lot

393
00:15:37,279 --> 00:15:39,680
and the problem three it's hard to

394
00:15:39,680 --> 00:15:41,680
retrieve the label data

395
00:15:41,680 --> 00:15:44,000
we have better than version zero but we

396
00:15:44,000 --> 00:15:45,199
still have

397
00:15:45,199 --> 00:15:47,680
many clusters that need to manual

398
00:15:47,680 --> 00:15:48,959
analysis

399
00:15:48,959 --> 00:15:52,839
so we are trying to improve the version

400
00:15:52,839 --> 00:15:54,399
one

401
00:15:54,399 --> 00:15:58,000
so now we move to the second version of

402
00:15:58,000 --> 00:16:01,759
our fujicoma so in version two we try to

403
00:16:01,759 --> 00:16:04,000
introduce the anomaly detection in this

404
00:16:04,000 --> 00:16:06,240
system

405
00:16:06,240 --> 00:16:08,720
yeah and because anomaly detection is

406
00:16:08,720 --> 00:16:09,680
very

407
00:16:09,680 --> 00:16:13,040
uh very

408
00:16:13,040 --> 00:16:16,639
uh very easy to handle this

409
00:16:16,639 --> 00:16:19,839
kind of imbalanced data set and we can

410
00:16:19,839 --> 00:16:20,399
also

411
00:16:20,399 --> 00:16:22,880
make an assumption that the malicious

412
00:16:22,880 --> 00:16:24,000
activities

413
00:16:24,000 --> 00:16:27,759
will be the abnormal one but however

414
00:16:27,759 --> 00:16:29,759
just like every anomaly detection

415
00:16:29,759 --> 00:16:32,000
mechanism

416
00:16:32,000 --> 00:16:34,000
we have we still have a limitation like

417
00:16:34,000 --> 00:16:35,759
the malicious activities

418
00:16:35,759 --> 00:16:40,160
or the novelty activities we cannot

419
00:16:40,160 --> 00:16:43,519
distinguish these two activities

420
00:16:43,519 --> 00:16:46,160
so there still will have some false

421
00:16:46,160 --> 00:16:48,839
alert will happen

422
00:16:48,839 --> 00:16:51,360
yeah so here we

423
00:16:51,360 --> 00:16:54,480
uh try to use a nomination to

424
00:16:54,480 --> 00:16:57,279
further filter the event for the menu

425
00:16:57,279 --> 00:16:59,839
analysis

426
00:17:01,440 --> 00:17:04,400
so here we use a different algorithm in

427
00:17:04,400 --> 00:17:06,400
another detection

428
00:17:06,400 --> 00:17:09,839
for example isolated forest scan

429
00:17:09,839 --> 00:17:13,760
and lof and in this case we focus on db

430
00:17:13,760 --> 00:17:14,640
scale because

431
00:17:14,640 --> 00:17:17,199
in the final we find deep scan gives us

432
00:17:17,199 --> 00:17:18,480
a better

433
00:17:18,480 --> 00:17:21,520
performance yeah so in db scan

434
00:17:21,520 --> 00:17:24,559
you need to define the distance x

435
00:17:24,559 --> 00:17:27,839
and every node within a data will be

436
00:17:27,839 --> 00:17:28,720
regarded

437
00:17:28,720 --> 00:17:31,919
as a cluster so like a picture depict

438
00:17:31,919 --> 00:17:32,640
here

439
00:17:32,640 --> 00:17:36,240
the point b a and c will be grouped into

440
00:17:36,240 --> 00:17:39,600
the same cluster because b has a

441
00:17:39,600 --> 00:17:42,400
the neighborhood within the epsilon and

442
00:17:42,400 --> 00:17:44,320
within epsilon within the axon so

443
00:17:44,320 --> 00:17:46,080
they will be grouped together to a

444
00:17:46,080 --> 00:17:48,000
cluster envelope

445
00:17:48,000 --> 00:17:51,360
not on and this node do not have

446
00:17:51,360 --> 00:17:55,520
any neighborhood within a distant axon

447
00:17:55,520 --> 00:17:59,039
so it will be a cluster by

448
00:17:59,039 --> 00:18:02,080
himself so in this case this point will

449
00:18:02,080 --> 00:18:02,720
be

450
00:18:02,720 --> 00:18:06,080
regarded as anomaly point

451
00:18:06,080 --> 00:18:09,120
so this is how dbs can work

452
00:18:09,120 --> 00:18:12,160
and below is some result in our system

453
00:18:12,160 --> 00:18:12,720
we

454
00:18:12,720 --> 00:18:15,440
can either entail upgrade and this one

455
00:18:15,440 --> 00:18:15,760
is

456
00:18:15,760 --> 00:18:21,200
in fact our beta pro

457
00:18:24,880 --> 00:18:28,240
so now we have our second version so in

458
00:18:28,240 --> 00:18:29,520
this version

459
00:18:29,520 --> 00:18:31,760
we first use the unit build and just

460
00:18:31,760 --> 00:18:33,760
like the first one we will also do a

461
00:18:33,760 --> 00:18:37,120
cluster and so we have three group

462
00:18:37,120 --> 00:18:39,520
and then we will also move to unit to

463
00:18:39,520 --> 00:18:40,960
dock and

464
00:18:40,960 --> 00:18:43,039
the difference from version one is that

465
00:18:43,039 --> 00:18:45,120
we use a three detection

466
00:18:45,120 --> 00:18:47,280
and the number division will find the

467
00:18:47,280 --> 00:18:48,640
number point

468
00:18:48,640 --> 00:18:51,840
just like the red point here so in this

469
00:18:51,840 --> 00:18:53,520
case our investigator

470
00:18:53,520 --> 00:18:57,200
only need to analyze the group 2

471
00:18:57,200 --> 00:19:00,080
and group 3 which have an anomaly point

472
00:19:00,080 --> 00:19:01,280
inside

473
00:19:01,280 --> 00:19:04,160
so this can help investigators to do to

474
00:19:04,160 --> 00:19:04,960
handle the

475
00:19:04,960 --> 00:19:10,720
analysis more efficient

476
00:19:10,720 --> 00:19:14,640
okay so here we quickly to uh

477
00:19:14,640 --> 00:19:17,520
to see some evaluation of our fujikoma

478
00:19:17,520 --> 00:19:19,440
version

479
00:19:19,440 --> 00:19:22,799
okay it's amazing like if

480
00:19:22,799 --> 00:19:26,320
we just use this uh very simple

481
00:19:26,320 --> 00:19:29,760
uh algorithm and we can achieve a nice

482
00:19:29,760 --> 00:19:30,480
result

483
00:19:30,480 --> 00:19:34,400
for example aof have a triple f1 score

484
00:19:34,400 --> 00:19:38,080
about 82 and the db scan has a

485
00:19:38,080 --> 00:19:41,679
best performance it gets a true positive

486
00:19:41,679 --> 00:19:42,400
rate about

487
00:19:42,400 --> 00:19:45,679
86 and true negative rate is 85

488
00:19:45,679 --> 00:19:49,520
the f1 scope is also 86

489
00:19:49,520 --> 00:19:52,799
so this already could be a set

490
00:19:52,799 --> 00:19:54,960
uh

491
00:19:55,919 --> 00:19:58,480
and we move to the other playbook the

492
00:19:58,480 --> 00:19:59,679
gaza mess

493
00:19:59,679 --> 00:20:02,400
play playbook achieve a very good

494
00:20:02,400 --> 00:20:05,440
performance it's nearly 100

495
00:20:05,440 --> 00:20:08,559
yeah so the perfect in version 2 our

496
00:20:08,559 --> 00:20:10,320
performance is quite well

497
00:20:10,320 --> 00:20:12,799
but we still want to solve the other two

498
00:20:12,799 --> 00:20:13,679
problem

499
00:20:13,679 --> 00:20:17,280
so problem 3 how to retrieve label data

500
00:20:17,280 --> 00:20:20,320
and most important the pro

501
00:20:20,320 --> 00:20:23,280
uh we lack of a storyline hope we can

502
00:20:23,280 --> 00:20:25,039
build a storyline

503
00:20:25,039 --> 00:20:27,919
so next we move to our version three we

504
00:20:27,919 --> 00:20:29,840
want to construct storyline

505
00:20:29,840 --> 00:20:33,918
by the community community detection

506
00:20:35,200 --> 00:20:38,159
and because cluster clustering can

507
00:20:38,159 --> 00:20:39,840
identify a similar event

508
00:20:39,840 --> 00:20:42,480
but cannot identify the relationship

509
00:20:42,480 --> 00:20:43,600
between the event

510
00:20:43,600 --> 00:20:46,400
lies a causality so in this part we want

511
00:20:46,400 --> 00:20:48,000
to use a grave analysis

512
00:20:48,000 --> 00:20:51,600
to do this part and this can help us

513
00:20:51,600 --> 00:20:54,400
to solve the problem for a lack of

514
00:20:54,400 --> 00:20:57,120
storyline

515
00:20:58,640 --> 00:21:01,440
so our idea is like when the attacker

516
00:21:01,440 --> 00:21:03,360
first come into your step

517
00:21:03,360 --> 00:21:05,679
uh they can only control a very few

518
00:21:05,679 --> 00:21:06,880
controllable process

519
00:21:06,880 --> 00:21:10,159
maybe only can control one process and

520
00:21:10,159 --> 00:21:13,679
he need to finish every of his job

521
00:21:13,679 --> 00:21:16,480
by this process so they may create a lot

522
00:21:16,480 --> 00:21:18,080
of process to

523
00:21:18,080 --> 00:21:21,440
accomplish their intent so the result

524
00:21:21,440 --> 00:21:22,320
will make

525
00:21:22,320 --> 00:21:25,360
the highly density graph community

526
00:21:25,360 --> 00:21:28,080
just like the process tree depict here

527
00:21:28,080 --> 00:21:29,200
in the

528
00:21:29,200 --> 00:21:33,200
uh this part in the red cycle

529
00:21:33,200 --> 00:21:34,880
is a malicious one so we can see the

530
00:21:34,880 --> 00:21:38,080
connection here is more density

531
00:21:38,080 --> 00:21:39,840
so we would like to use a community

532
00:21:39,840 --> 00:21:42,240
detection to make something

533
00:21:42,240 --> 00:21:45,200
and communication community detection

534
00:21:45,200 --> 00:21:45,520
can

535
00:21:45,520 --> 00:21:48,720
group the high density part uh

536
00:21:48,720 --> 00:21:51,600
separate heightens part from the grid

537
00:21:51,600 --> 00:21:54,880
and here we use the logan algorithm

538
00:21:54,880 --> 00:21:58,480
from the neo4j

539
00:21:58,480 --> 00:22:01,600
and it also shows the uh

540
00:22:01,600 --> 00:22:04,880
idea that i want to merge the different

541
00:22:04,880 --> 00:22:07,039
dimension

542
00:22:07,039 --> 00:22:08,880
in the previous version we use a

543
00:22:08,880 --> 00:22:11,039
similarity as our main

544
00:22:11,039 --> 00:22:13,440
analyze type dimension yeah that

545
00:22:13,440 --> 00:22:16,080
contains similarity or difference

546
00:22:16,080 --> 00:22:19,760
it can identify abnormal so in this

547
00:22:19,760 --> 00:22:22,880
version we uh introduce the other

548
00:22:22,880 --> 00:22:25,120
dimension like the connectivity in a

549
00:22:25,120 --> 00:22:27,039
graph which can

550
00:22:27,039 --> 00:22:31,440
depict the relationship of the process

551
00:22:31,919 --> 00:22:34,960
so here is our version three so what we

552
00:22:34,960 --> 00:22:35,520
change

553
00:22:35,520 --> 00:22:39,120
is this part original we use a cluster

554
00:22:39,120 --> 00:22:42,320
oh hey so sorry this part

555
00:22:42,320 --> 00:22:45,440
yes uh and we change our cluster into a

556
00:22:45,440 --> 00:22:47,840
community detection

557
00:22:47,840 --> 00:22:50,799
yeah and after finish the community

558
00:22:50,799 --> 00:22:51,520
detection

559
00:22:51,520 --> 00:22:53,600
we use a type of typing model to

560
00:22:53,600 --> 00:22:55,280
identify a keyword

561
00:22:55,280 --> 00:22:58,480
of a community and last

562
00:22:58,480 --> 00:23:02,240
we do a very simple label property to

563
00:23:02,240 --> 00:23:04,320
identify a malicious part

564
00:23:04,320 --> 00:23:07,200
and then we investigator can involve in

565
00:23:07,200 --> 00:23:08,559
state to mark

566
00:23:08,559 --> 00:23:11,760
each group is malicious or not

567
00:23:11,760 --> 00:23:14,799
and different from a previous part of

568
00:23:14,799 --> 00:23:15,840
the community

569
00:23:15,840 --> 00:23:18,960
in this part every node in the

570
00:23:18,960 --> 00:23:21,520
same community has some relationship

571
00:23:21,520 --> 00:23:22,720
maybe they are parent

572
00:23:22,720 --> 00:23:26,240
and child process like a lot so he can

573
00:23:26,240 --> 00:23:27,760
give us more information

574
00:23:27,760 --> 00:23:31,520
to depict the whole storyline

575
00:23:31,600 --> 00:23:35,039
okay so here we see some evaluation

576
00:23:35,039 --> 00:23:39,679
yeah uh okay

577
00:23:39,679 --> 00:23:43,200
uh introduce a community detection

578
00:23:43,200 --> 00:23:46,720
uh in this version we uh we say if a

579
00:23:46,720 --> 00:23:47,919
community have one

580
00:23:47,919 --> 00:23:50,640
abnormal point we will say a lot is a

581
00:23:50,640 --> 00:23:52,640
malicious part and you can say our true

582
00:23:52,640 --> 00:23:53,679
negative rate

583
00:23:53,679 --> 00:23:56,240
is drop a lot so we're trying to improve

584
00:23:56,240 --> 00:23:57,760
this part

585
00:23:57,760 --> 00:24:01,360
yeah so we change our label propagation

586
00:24:01,360 --> 00:24:04,720
policy from abnormal analysis unit

587
00:24:04,720 --> 00:24:08,240
and make all community as malicious

588
00:24:08,240 --> 00:24:11,840
to uh if we have a more than health

589
00:24:11,840 --> 00:24:13,520
abnormal analysis unit

590
00:24:13,520 --> 00:24:16,640
and then we mark the whole community

591
00:24:16,640 --> 00:24:19,200
as malicious and in this case our

592
00:24:19,200 --> 00:24:20,080
performance

593
00:24:20,080 --> 00:24:24,400
rise again and compare to 98 1988

594
00:24:24,400 --> 00:24:27,679
and 91 capacity

595
00:24:27,679 --> 00:24:29,360
so even so in this version the

596
00:24:29,360 --> 00:24:31,200
performance is a little

597
00:24:31,200 --> 00:24:33,520
lower than the previous one but i think

598
00:24:33,520 --> 00:24:36,159
this version is still better because

599
00:24:36,159 --> 00:24:38,080
it can give us more contextual

600
00:24:38,080 --> 00:24:39,520
information

601
00:24:39,520 --> 00:24:42,240
for example in this one this is a one

602
00:24:42,240 --> 00:24:43,679
malicious

603
00:24:43,679 --> 00:24:47,200
community and we can follow

604
00:24:47,200 --> 00:24:49,520
because they are all have a parent

605
00:24:49,520 --> 00:24:51,840
process relationship

606
00:24:51,840 --> 00:24:54,480
so we can have more information to judge

607
00:24:54,480 --> 00:24:55,600
if this cluster

608
00:24:55,600 --> 00:25:00,159
is malicious or not

609
00:25:00,159 --> 00:25:02,159
so it can give us more information in

610
00:25:02,159 --> 00:25:04,960
the storyline

611
00:25:05,039 --> 00:25:08,559
and the overall performance is list here

612
00:25:08,559 --> 00:25:11,919
so even though we still have about 600

613
00:25:11,919 --> 00:25:15,039
a false positive sample but uh

614
00:25:15,039 --> 00:25:17,039
this first positive sample will be

615
00:25:17,039 --> 00:25:19,200
separated into a different

616
00:25:19,200 --> 00:25:22,960
community so because we use a community

617
00:25:22,960 --> 00:25:24,000
detection so

618
00:25:24,000 --> 00:25:25,600
our process will cross the creation

619
00:25:25,600 --> 00:25:27,200
event will submerge

620
00:25:27,200 --> 00:25:31,600
into a community and only 176

621
00:25:31,600 --> 00:25:34,080
community has more than health abnormal

622
00:25:34,080 --> 00:25:35,520
event

623
00:25:35,520 --> 00:25:38,400
so for analysis you only need to check

624
00:25:38,400 --> 00:25:40,720
this 176 community

625
00:25:40,720 --> 00:25:43,840
and to analyze it and the performance

626
00:25:43,840 --> 00:25:46,400
metric is list here

627
00:25:46,400 --> 00:25:50,000
as is similar for for our uh

628
00:25:50,000 --> 00:25:53,440
the other uh playbook yeah

629
00:25:53,440 --> 00:25:57,120
a performance is list here is a

630
00:25:57,120 --> 00:26:00,159
nice result and also

631
00:26:00,159 --> 00:26:04,159
we put the community at each community

632
00:26:04,159 --> 00:26:08,000
this is a community 93 and we can

633
00:26:08,000 --> 00:26:09,919
look at this process and understand what

634
00:26:09,919 --> 00:26:12,640
a taker i'm trying to doing

635
00:26:12,640 --> 00:26:14,799
and for example this is the other

636
00:26:14,799 --> 00:26:16,880
community which is used for the lateral

637
00:26:16,880 --> 00:26:17,360
move

638
00:26:17,360 --> 00:26:20,480
movement so we can set wmic ps

639
00:26:20,480 --> 00:26:24,240
here so this information can give

640
00:26:24,240 --> 00:26:27,039
us more clue of what a taker is trying

641
00:26:27,039 --> 00:26:29,440
to doing

642
00:26:29,919 --> 00:26:32,240
so here we introduce our three version

643
00:26:32,240 --> 00:26:33,360
and

644
00:26:33,360 --> 00:26:35,919
we can solve our problem four problems

645
00:26:35,919 --> 00:26:36,480
that we

646
00:26:36,480 --> 00:26:40,240
mentioned in the preview you know first

647
00:26:40,640 --> 00:26:44,159
and the in the end there is my summary

648
00:26:44,159 --> 00:26:46,159
so the machine learning can assist three

649
00:26:46,159 --> 00:26:47,360
hunting and reduce

650
00:26:47,360 --> 00:26:49,840
effort of investigator so this system

651
00:26:49,840 --> 00:26:51,039
can be easily be

652
00:26:51,039 --> 00:26:53,279
constructed by some open source tool

653
00:26:53,279 --> 00:26:55,200
even so you still need many time to

654
00:26:55,200 --> 00:26:55,919
tuning

655
00:26:55,919 --> 00:26:59,360
and to add more data source and we

656
00:26:59,360 --> 00:27:01,679
demo fujacoma a machine learning

657
00:27:01,679 --> 00:27:03,679
bathroom hunting system

658
00:27:03,679 --> 00:27:06,159
and we demo how we trying to solve the

659
00:27:06,159 --> 00:27:07,360
problem and improve

660
00:27:07,360 --> 00:27:11,600
by each version and we also evaluation

661
00:27:11,600 --> 00:27:13,520
and show love for coma could achieve

662
00:27:13,520 --> 00:27:14,720
high performance

663
00:27:14,720 --> 00:27:17,360
and can help us to identify malicious

664
00:27:17,360 --> 00:27:18,960
commands

665
00:27:18,960 --> 00:27:22,399
okay yeah because i think i have

666
00:27:22,399 --> 00:27:24,960
a little off time and i have a lot of

667
00:27:24,960 --> 00:27:26,880
material to present

668
00:27:26,880 --> 00:27:29,840
uh so if we don't have a chance to ask

669
00:27:29,840 --> 00:27:31,679
me questions it will come to at my

670
00:27:31,679 --> 00:27:32,399
twitter

671
00:27:32,399 --> 00:27:35,919
and send the question to my email

672
00:27:35,919 --> 00:27:37,840
and thank you everyone and this is my

673
00:27:37,840 --> 00:27:40,320
presentation and thank you again

674
00:27:40,320 --> 00:27:42,960
thank you very much ck for the insights

675
00:27:42,960 --> 00:27:44,799
we don't have any open questions

676
00:27:44,799 --> 00:27:48,399
in the q and a function currently so

677
00:27:48,399 --> 00:27:51,520
again please feel free uh ck provided

678
00:27:51,520 --> 00:27:53,360
his email address and his twitter handle

679
00:27:53,360 --> 00:27:55,039
there if you want to reach out with any

680
00:27:55,039 --> 00:27:56,240
questions after this

681
00:27:56,240 --> 00:27:59,200
uh we do have a fairly tight turnaround

682
00:27:59,200 --> 00:28:02,000
time to get into the next session here

683
00:28:02,000 --> 00:28:05,120
so thank you ck and again he'll be more

684
00:28:05,120 --> 00:28:06,559
than happy to respond to

685
00:28:06,559 --> 00:28:10,000
questions directly

