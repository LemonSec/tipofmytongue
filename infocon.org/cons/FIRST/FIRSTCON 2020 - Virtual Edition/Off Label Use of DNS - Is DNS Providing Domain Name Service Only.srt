1
00:00:00,000 --> 00:00:02,800
um just one item before we get started

2
00:00:02,800 --> 00:00:04,799
we ask you to submit your questions for

3
00:00:04,799 --> 00:00:05,200
q

4
00:00:05,200 --> 00:00:08,639
a in the q a section of zoom questions

5
00:00:08,639 --> 00:00:11,440
will be queued in the order received and

6
00:00:11,440 --> 00:00:13,120
with that let's get go ahead and get

7
00:00:13,120 --> 00:00:14,160
started

8
00:00:14,160 --> 00:00:16,239
everyone uses dns these days and i'm

9
00:00:16,239 --> 00:00:17,199
really excited

10
00:00:17,199 --> 00:00:20,000
to introduce our next speakers fatima

11
00:00:20,000 --> 00:00:22,240
security engineer at the university of

12
00:00:22,240 --> 00:00:23,119
delaware

13
00:00:23,119 --> 00:00:25,519
responsible for but not limited to

14
00:00:25,519 --> 00:00:27,039
network traffic monitoring

15
00:00:27,039 --> 00:00:29,279
instant response threat hunting and

16
00:00:29,279 --> 00:00:30,640
managing the theme

17
00:00:30,640 --> 00:00:33,120
she will be joined by chase also from

18
00:00:33,120 --> 00:00:34,800
the university of delaware

19
00:00:34,800 --> 00:00:37,040
who has been involved in research and

20
00:00:37,040 --> 00:00:38,239
implementing

21
00:00:38,239 --> 00:00:40,480
of various things around network

22
00:00:40,480 --> 00:00:42,800
packages for more than 30 years

23
00:00:42,800 --> 00:00:44,480
please join me in welcoming them to

24
00:00:44,480 --> 00:00:46,160
share their findings in dns

25
00:00:46,160 --> 00:00:48,559
that might help every one of you to find

26
00:00:48,559 --> 00:00:51,680
more things in there

27
00:00:51,920 --> 00:00:53,840
thank you so much alex for the kind

28
00:00:53,840 --> 00:00:55,520
introduction um

29
00:00:55,520 --> 00:00:58,000
so hi everyone i'm farmer and i'm not

30
00:00:58,000 --> 00:00:59,039
going to waste

31
00:00:59,039 --> 00:01:00,800
too much of time to get into the

32
00:01:00,800 --> 00:01:02,480
introduction again but just quick note

33
00:01:02,480 --> 00:01:04,799
that i recently joined um es net as a

34
00:01:04,799 --> 00:01:06,000
security engineer

35
00:01:06,000 --> 00:01:09,520
in in berkeley live in uh in berkeley

36
00:01:09,520 --> 00:01:12,240
so uh it's been eight months now so that

37
00:01:12,240 --> 00:01:14,000
was a little bit of change when

38
00:01:14,000 --> 00:01:16,400
i first submitted my introduction to

39
00:01:16,400 --> 00:01:17,759
first conference

40
00:01:17,759 --> 00:01:21,439
so jumping right into the talk

41
00:01:21,439 --> 00:01:24,240
okay so before i actually uh go into the

42
00:01:24,240 --> 00:01:25,360
research and what we did with the

43
00:01:25,360 --> 00:01:27,119
traffic i would like to introduce you

44
00:01:27,119 --> 00:01:28,799
to the basic concept of where exactly

45
00:01:28,799 --> 00:01:30,479
we're getting the traffic so that

46
00:01:30,479 --> 00:01:32,159
in the mind you you know that what are

47
00:01:32,159 --> 00:01:33,680
the end points that we are tapping or we

48
00:01:33,680 --> 00:01:35,280
are monitoring and when i say

49
00:01:35,280 --> 00:01:37,520
that we have these logs you should kind

50
00:01:37,520 --> 00:01:38,880
of like know a little bit of background

51
00:01:38,880 --> 00:01:40,479
of whatever network traffic

52
00:01:40,479 --> 00:01:41,840
profile looks like at university of

53
00:01:41,840 --> 00:01:43,920
delaware so this is a very uh raw

54
00:01:43,920 --> 00:01:47,280
and very um high level diagram view of

55
00:01:47,280 --> 00:01:49,920
uh what the uh what the bordering co

56
00:01:49,920 --> 00:01:51,759
routers look like in universal diver

57
00:01:51,759 --> 00:01:53,119
and where exactly we are getting the

58
00:01:53,119 --> 00:01:55,119
traffic for our monitoring

59
00:01:55,119 --> 00:01:57,040
so we have 10 gig links uh uplinks that

60
00:01:57,040 --> 00:01:58,320
connect over water routers and that

61
00:01:58,320 --> 00:01:59,040
directly

62
00:01:59,040 --> 00:02:02,159
over the internet we have two core

63
00:02:02,159 --> 00:02:03,360
routers that are

64
00:02:03,360 --> 00:02:06,719
the uh backbone of all the uh indeed

65
00:02:06,719 --> 00:02:08,239
all the remaining core routers are

66
00:02:08,239 --> 00:02:09,679
underneath them and that's why we are

67
00:02:09,679 --> 00:02:10,479
getting

68
00:02:10,479 --> 00:02:12,640
the uh mirrors traffic from both the

69
00:02:12,640 --> 00:02:13,599
routers uh

70
00:02:13,599 --> 00:02:15,840
to our network load balancer and then

71
00:02:15,840 --> 00:02:17,599
that network load balancer balances out

72
00:02:17,599 --> 00:02:18,959
the traffic to our

73
00:02:18,959 --> 00:02:20,879
monitoring clusters and one of our

74
00:02:20,879 --> 00:02:22,160
monitoring clusters that university of

75
00:02:22,160 --> 00:02:24,160
delaware is a zeke cluster

76
00:02:24,160 --> 00:02:26,400
so we have four nodes and each node gets

77
00:02:26,400 --> 00:02:28,560
like roughly 25 percent

78
00:02:28,560 --> 00:02:31,920
of load balance traffic our peaks are

79
00:02:31,920 --> 00:02:34,959
around 8 gbps in a very um busy day but

80
00:02:34,959 --> 00:02:36,800
kind of like the average out with the uh

81
00:02:36,800 --> 00:02:37,760
5 gbps

82
00:02:37,760 --> 00:02:41,519
uh link fluctuation and each sensors i

83
00:02:41,519 --> 00:02:43,519
was getting the uh pps rate which is

84
00:02:43,519 --> 00:02:44,879
packets per second

85
00:02:44,879 --> 00:02:47,280
so each sensor roughly gets 300 to 300

86
00:02:47,280 --> 00:02:49,040
000 packets per second which is not a

87
00:02:49,040 --> 00:02:49,519
lot

88
00:02:49,519 --> 00:02:51,680
uh but that's kind of like whatever

89
00:02:51,680 --> 00:02:53,280
network traffic looks like

90
00:02:53,280 --> 00:02:55,440
and as you can see in the in the diagram

91
00:02:55,440 --> 00:02:56,720
that the z cluster

92
00:02:56,720 --> 00:02:59,599
is primarily there for monitoring the

93
00:02:59,599 --> 00:03:00,480
eastward of

94
00:03:00,480 --> 00:03:02,239
minding the knots out traffic which is

95
00:03:02,239 --> 00:03:04,080
the traffic that going that is going

96
00:03:04,080 --> 00:03:06,400
back and forth from the internet to our

97
00:03:06,400 --> 00:03:08,480
uh in universities internal network

98
00:03:08,480 --> 00:03:10,239
so that's what our primarily uh

99
00:03:10,239 --> 00:03:11,840
monitoring system looks like that it

100
00:03:11,840 --> 00:03:13,920
just monitors the north south traffic

101
00:03:13,920 --> 00:03:17,120
i that means the traffic that is uh

102
00:03:17,120 --> 00:03:18,640
coming into the university and then the

103
00:03:18,640 --> 00:03:19,680
traffic that is going out of the

104
00:03:19,680 --> 00:03:20,400
university

105
00:03:20,400 --> 00:03:22,879
subnets

106
00:03:24,239 --> 00:03:26,879
okay so our research problem so

107
00:03:26,879 --> 00:03:28,159
everything started with

108
00:03:28,159 --> 00:03:30,239
me analyzing the logs so i like thread

109
00:03:30,239 --> 00:03:32,000
hunting and i like doing the analysis

110
00:03:32,000 --> 00:03:33,920
and investigation in the logs and i just

111
00:03:33,920 --> 00:03:35,440
keep uh

112
00:03:35,440 --> 00:03:37,280
looking into the logs to see if there is

113
00:03:37,280 --> 00:03:38,959
something interesting there

114
00:03:38,959 --> 00:03:40,959
so what we found uh last year when i was

115
00:03:40,959 --> 00:03:42,239
doing the research uh

116
00:03:42,239 --> 00:03:44,560
i was mainly looking at the dns.log file

117
00:03:44,560 --> 00:03:46,319
that zeke generates that one of the log

118
00:03:46,319 --> 00:03:47,200
files

119
00:03:47,200 --> 00:03:49,200
that is very interesting and very

120
00:03:49,200 --> 00:03:50,640
heavily generated

121
00:03:50,640 --> 00:03:52,720
so we found out that there are some

122
00:03:52,720 --> 00:03:53,840
unique uh

123
00:03:53,840 --> 00:03:55,840
trends and activities that are going in

124
00:03:55,840 --> 00:03:57,439
our dns.log file and we want to

125
00:03:57,439 --> 00:03:59,840
investigate them further that what is

126
00:03:59,840 --> 00:04:01,599
going on and why these hosts are doing

127
00:04:01,599 --> 00:04:03,360
these kind of weird queries

128
00:04:03,360 --> 00:04:05,439
so uh we came up with uh when we

129
00:04:05,439 --> 00:04:07,599
investigated couple of the um

130
00:04:07,599 --> 00:04:09,599
ip addresses that were doing some kind

131
00:04:09,599 --> 00:04:10,879
of like unique activity

132
00:04:10,879 --> 00:04:12,959
we came up with a realization that in

133
00:04:12,959 --> 00:04:14,080
our network that

134
00:04:14,080 --> 00:04:17,279
that there are a lot of hosts and ips

135
00:04:17,279 --> 00:04:19,880
that are doing something um

136
00:04:19,880 --> 00:04:22,320
unconventional with dns i mean it was

137
00:04:22,320 --> 00:04:23,360
not malicious

138
00:04:23,360 --> 00:04:24,880
but it was definitely something that is

139
00:04:24,880 --> 00:04:26,880
that was worth looking at so we kind of

140
00:04:26,880 --> 00:04:28,639
like came up with the two classification

141
00:04:28,639 --> 00:04:30,720
techniques of how we can find out those

142
00:04:30,720 --> 00:04:31,280
hosts

143
00:04:31,280 --> 00:04:33,280
that are using dns for unconventional

144
00:04:33,280 --> 00:04:35,759
purposes not malicious but at least to

145
00:04:35,759 --> 00:04:37,840
know what exactly is going on

146
00:04:37,840 --> 00:04:40,560
so uh we coined the term of label use

147
00:04:40,560 --> 00:04:41,600
because

148
00:04:41,600 --> 00:04:44,080
that those dns queries were completely

149
00:04:44,080 --> 00:04:44,720
fine you

150
00:04:44,720 --> 00:04:46,400
you should not block them but we just

151
00:04:46,400 --> 00:04:48,400
thought that those are looking unique so

152
00:04:48,400 --> 00:04:50,160
we came up with a term called off label

153
00:04:50,160 --> 00:04:50,720
use

154
00:04:50,720 --> 00:04:53,440
for the services and applications that

155
00:04:53,440 --> 00:04:56,000
use dns for unconventional purposes

156
00:04:56,000 --> 00:04:57,280
and when i say unconventional purposes

157
00:04:57,280 --> 00:04:59,680
that means um not the conventional use

158
00:04:59,680 --> 00:05:01,120
of like when we go on the browser and

159
00:05:01,120 --> 00:05:04,000
type www.google.com it resolves to an ip

160
00:05:04,000 --> 00:05:05,039
and then our

161
00:05:05,039 --> 00:05:07,280
uh host tries to connect to that ip

162
00:05:07,280 --> 00:05:09,120
that's like very conventional use of dns

163
00:05:09,120 --> 00:05:10,160
and that is what

164
00:05:10,160 --> 00:05:13,680
primarily dns was uh discovered to use

165
00:05:13,680 --> 00:05:15,520
for as a directorial service

166
00:05:15,520 --> 00:05:17,280
so the two classification techniques to

167
00:05:17,280 --> 00:05:19,120
find out all the hosts that were doing

168
00:05:19,120 --> 00:05:20,720
something unique with dns uh

169
00:05:20,720 --> 00:05:23,520
were these so the first one was we

170
00:05:23,520 --> 00:05:24,880
wanted to find out all the

171
00:05:24,880 --> 00:05:27,039
hosts uh who never utilized the dns

172
00:05:27,039 --> 00:05:29,280
resolution like if my machine is just

173
00:05:29,280 --> 00:05:31,039
my if my machine is taking an effort to

174
00:05:31,039 --> 00:05:32,400
resolve a domain

175
00:05:32,400 --> 00:05:34,320
to get an ip but it is not doing

176
00:05:34,320 --> 00:05:35,840
anything with that ip then that is a

177
00:05:35,840 --> 00:05:37,680
waste cycle right like why

178
00:05:37,680 --> 00:05:39,759
am i machine doing that so we wanted to

179
00:05:39,759 --> 00:05:41,440
investigate all the hosts um

180
00:05:41,440 --> 00:05:43,600
corresponding to that kind of activity

181
00:05:43,600 --> 00:05:45,199
and for that uh we will go into the

182
00:05:45,199 --> 00:05:45,840
detail

183
00:05:45,840 --> 00:05:48,320
of each and every technique of each and

184
00:05:48,320 --> 00:05:49,680
every technique that we have right now

185
00:05:49,680 --> 00:05:51,360
the the two techniques but

186
00:05:51,360 --> 00:05:54,240
just a um just a one liner here that for

187
00:05:54,240 --> 00:05:56,080
uh analyzing that

188
00:05:56,080 --> 00:05:58,479
kind of activity we just chose dns

189
00:05:58,479 --> 00:06:00,240
versus tcp connections and it is very

190
00:06:00,240 --> 00:06:01,440
coarse screen

191
00:06:01,440 --> 00:06:03,280
finding it is not very fine-grained

192
00:06:03,280 --> 00:06:04,639
thing that we map each and every

193
00:06:04,639 --> 00:06:06,080
connection but it's very coarse green so

194
00:06:06,080 --> 00:06:07,440
that's why in overall

195
00:06:07,440 --> 00:06:10,720
we wanted to look into the statistics of

196
00:06:10,720 --> 00:06:13,520
how our dns connections uh look like

197
00:06:13,520 --> 00:06:15,280
versus tcp connections

198
00:06:15,280 --> 00:06:16,479
and then the second classification

199
00:06:16,479 --> 00:06:18,400
technique that we came up with came up

200
00:06:18,400 --> 00:06:20,319
with was uh

201
00:06:20,319 --> 00:06:22,720
we saw and we observed that a lot of ips

202
00:06:22,720 --> 00:06:23,520
that were

203
00:06:23,520 --> 00:06:26,960
our host ips were client types

204
00:06:26,960 --> 00:06:29,600
were using multiple dns resolvers um and

205
00:06:29,600 --> 00:06:31,120
internal as well as external so i wanted

206
00:06:31,120 --> 00:06:32,000
to like

207
00:06:32,000 --> 00:06:34,080
um i want to explain what internal and

208
00:06:34,080 --> 00:06:35,199
external is

209
00:06:35,199 --> 00:06:38,400
so when a host is set up right

210
00:06:38,400 --> 00:06:40,319
and when a host comes up online there

211
00:06:40,319 --> 00:06:42,160
are two ways it can get an ip one is the

212
00:06:42,160 --> 00:06:43,600
static assignment and then the second

213
00:06:43,600 --> 00:06:44,800
one is the dynamic

214
00:06:44,800 --> 00:06:46,720
and in our university network a lot of

215
00:06:46,720 --> 00:06:48,639
clients and majority of the clients we

216
00:06:48,639 --> 00:06:50,400
are trying to move away from the static

217
00:06:50,400 --> 00:06:51,280
assignment

218
00:06:51,280 --> 00:06:53,199
and we are trying to have hosts get all

219
00:06:53,199 --> 00:06:55,440
the settings of subnet

220
00:06:55,440 --> 00:06:57,919
gateway dns servers from our dhcp

221
00:06:57,919 --> 00:06:58,639
servers

222
00:06:58,639 --> 00:07:01,360
so we know that majority of our clients

223
00:07:01,360 --> 00:07:03,199
should be using the dhcp settings that

224
00:07:03,199 --> 00:07:04,400
are sent to them

225
00:07:04,400 --> 00:07:06,639
for connecting to the uh gateway and for

226
00:07:06,639 --> 00:07:07,440
connecting to the

227
00:07:07,440 --> 00:07:09,919
internal dns servers so it was very

228
00:07:09,919 --> 00:07:11,520
interesting to see that

229
00:07:11,520 --> 00:07:13,280
some of our clients were connecting to

230
00:07:13,280 --> 00:07:15,440
our internal dns servers that were the

231
00:07:15,440 --> 00:07:18,080
dna servers that uni has set up for uh

232
00:07:18,080 --> 00:07:19,759
resolving the outside domains

233
00:07:19,759 --> 00:07:21,759
as well as at the same time those

234
00:07:21,759 --> 00:07:23,680
clients were connecting to the

235
00:07:23,680 --> 00:07:26,800
google dns server like 8.8.8

236
00:07:26,800 --> 00:07:29,120
so you were like that if somebody has

237
00:07:29,120 --> 00:07:30,720
set it as a static

238
00:07:30,720 --> 00:07:32,319
then why they would set it like that

239
00:07:32,319 --> 00:07:34,240
that okay four servers are like random

240
00:07:34,240 --> 00:07:35,840
public servers and then the two two

241
00:07:35,840 --> 00:07:37,599
servers remaining are the

242
00:07:37,599 --> 00:07:39,440
ud's internal server so you wanted to

243
00:07:39,440 --> 00:07:41,199
investigate that case as well so these

244
00:07:41,199 --> 00:07:43,120
were the two basic classification

245
00:07:43,120 --> 00:07:44,639
technique we wanted to investigate more

246
00:07:44,639 --> 00:07:46,800
to find out what's going on in our dns

247
00:07:46,800 --> 00:07:49,199
traffic

248
00:07:49,599 --> 00:07:51,759
okay so going to the details of the

249
00:07:51,759 --> 00:07:52,960
first one which is

250
00:07:52,960 --> 00:07:54,800
the host that never utilized the dns

251
00:07:54,800 --> 00:07:56,319
resolutions

252
00:07:56,319 --> 00:07:58,000
it was very interesting though so we

253
00:07:58,000 --> 00:07:59,520
just we were just curious to know what

254
00:07:59,520 --> 00:08:00,960
exactly are the hosts and why they are

255
00:08:00,960 --> 00:08:01,840
doing that

256
00:08:01,840 --> 00:08:04,639
so this is a basic workflow uh to let

257
00:08:04,639 --> 00:08:06,319
you guys know that what we did to find

258
00:08:06,319 --> 00:08:07,440
out those eyepiece

259
00:08:07,440 --> 00:08:10,240
again it's a very coarse coarse grain so

260
00:08:10,240 --> 00:08:10,960
um

261
00:08:10,960 --> 00:08:14,639
just a brief introduction of what we did

262
00:08:14,639 --> 00:08:18,560
so first of all we um we used our zig

263
00:08:18,560 --> 00:08:19,840
data

264
00:08:19,840 --> 00:08:22,240
and uh we there were two sources of data

265
00:08:22,240 --> 00:08:24,080
right so one was a receipt data for

266
00:08:24,080 --> 00:08:25,199
finding out all the

267
00:08:25,199 --> 00:08:27,919
outbound tcp connections because

268
00:08:27,919 --> 00:08:28,720
remember i should

269
00:08:28,720 --> 00:08:30,000
diagram that where exactly they're

270
00:08:30,000 --> 00:08:31,599
tapping or monitoring the traffic it was

271
00:08:31,599 --> 00:08:32,799
like not so

272
00:08:32,799 --> 00:08:34,799
and then the second the the green uh the

273
00:08:34,799 --> 00:08:36,240
green uh

274
00:08:36,240 --> 00:08:37,919
box there which says internal dns

275
00:08:37,919 --> 00:08:40,958
request those were captured by our dna

276
00:08:40,958 --> 00:08:42,399
servers so we were collecting all the

277
00:08:42,399 --> 00:08:43,760
data into one of the same solutions that

278
00:08:43,760 --> 00:08:44,640
we have

279
00:08:44,640 --> 00:08:46,560
so those were the two data primary data

280
00:08:46,560 --> 00:08:48,640
sources for this poc

281
00:08:48,640 --> 00:08:50,720
so we collected and we get a lot of tons

282
00:08:50,720 --> 00:08:52,880
of data so we collected just one hour

283
00:08:52,880 --> 00:08:54,480
worth of statistics

284
00:08:54,480 --> 00:08:56,880
so collect all the tcp connections for

285
00:08:56,880 --> 00:08:58,480
one hour and put them

286
00:08:58,480 --> 00:09:01,680
into this tcp file with just the ips

287
00:09:01,680 --> 00:09:03,200
that are making outbound connections so

288
00:09:03,200 --> 00:09:04,480
all the unique ips

289
00:09:04,480 --> 00:09:06,160
for one hour period of time that we're

290
00:09:06,160 --> 00:09:08,240
making outbound tcp connections

291
00:09:08,240 --> 00:09:11,200
that was our one bucket the second ip5

292
00:09:11,200 --> 00:09:12,399
that we uh

293
00:09:12,399 --> 00:09:14,720
collected was from our internal dns

294
00:09:14,720 --> 00:09:17,279
servers uh log file the queries file

295
00:09:17,279 --> 00:09:19,120
so collect all the ips that were making

296
00:09:19,120 --> 00:09:21,120
the internal that were making the dns

297
00:09:21,120 --> 00:09:23,200
request over internal dns server

298
00:09:23,200 --> 00:09:25,360
and put them in the dns ips file and

299
00:09:25,360 --> 00:09:27,360
then compare those ips for one hour that

300
00:09:27,360 --> 00:09:28,240
do you find

301
00:09:28,240 --> 00:09:30,800
anything in common so they can be three

302
00:09:30,800 --> 00:09:32,240
scenarios right like the first one will

303
00:09:32,240 --> 00:09:34,240
be you will find a lot of ips common

304
00:09:34,240 --> 00:09:36,800
so that is a normal behavior that one ip

305
00:09:36,800 --> 00:09:37,839
resolve the domain

306
00:09:37,839 --> 00:09:40,800
you saw the dns request and then that ip

307
00:09:40,800 --> 00:09:41,600
initiated

308
00:09:41,600 --> 00:09:43,839
initiated a tcp connection to whatever

309
00:09:43,839 --> 00:09:44,880
ip it

310
00:09:44,880 --> 00:09:48,000
it found uh it got from the dns servers

311
00:09:48,000 --> 00:09:49,920
the second one was the ips that were

312
00:09:49,920 --> 00:09:51,680
only in tcp ips

313
00:09:51,680 --> 00:09:53,519
well that it could be that uh they are

314
00:09:53,519 --> 00:09:55,200
not using your internal dns servers

315
00:09:55,200 --> 00:09:58,080
they are using either uh static external

316
00:09:58,080 --> 00:10:00,959
dns servers or they are either using doh

317
00:10:00,959 --> 00:10:02,480
in which case it will not result in any

318
00:10:02,480 --> 00:10:04,560
kind of dns uh query that we can see

319
00:10:04,560 --> 00:10:05,839
because it will be encrypted

320
00:10:05,839 --> 00:10:07,440
and then the last one that is one of the

321
00:10:07,440 --> 00:10:09,920
uh interesting one that

322
00:10:09,920 --> 00:10:12,240
we were looking for was ips that were

323
00:10:12,240 --> 00:10:14,079
only seen in dns ips file

324
00:10:14,079 --> 00:10:16,839
that means the ips are creating our dns

325
00:10:16,839 --> 00:10:18,079
servers

326
00:10:18,079 --> 00:10:20,240
and resolving the domains but they're

327
00:10:20,240 --> 00:10:22,399
not using those resolutions so

328
00:10:22,399 --> 00:10:24,320
we wanted to analyze that bucket to see

329
00:10:24,320 --> 00:10:26,720
what's going on and fight this unusual

330
00:10:26,720 --> 00:10:27,760
behavior

331
00:10:27,760 --> 00:10:30,000
and we want and we tag that as like

332
00:10:30,000 --> 00:10:31,680
these ips are doing something off label

333
00:10:31,680 --> 00:10:32,399
use

334
00:10:32,399 --> 00:10:35,040
of dns

335
00:10:36,079 --> 00:10:39,040
okay so just a statistical scenario

336
00:10:39,040 --> 00:10:41,279
everything was done on our

337
00:10:41,279 --> 00:10:44,399
network traffic so all the uh statistics

338
00:10:44,399 --> 00:10:45,839
are pretty real it's not any kind of

339
00:10:45,839 --> 00:10:47,279
stub data

340
00:10:47,279 --> 00:10:50,000
so as you can see that the first the

341
00:10:50,000 --> 00:10:52,880
first two bars the tcp ips and dns ips

342
00:10:52,880 --> 00:10:56,240
they are pretty uh normal that around 53

343
00:10:56,240 --> 00:10:56,880
000

344
00:10:56,880 --> 00:10:59,600
ips were found in our tcp outbound

345
00:10:59,600 --> 00:11:00,800
connections

346
00:11:00,800 --> 00:11:03,279
uh around 49 000 were found in our dns

347
00:11:03,279 --> 00:11:04,480
uh internal logs

348
00:11:04,480 --> 00:11:06,640
the unique ips when we compared them

349
00:11:06,640 --> 00:11:08,399
majority of them like almost 90

350
00:11:08,399 --> 00:11:10,399
of them matched so they were common

351
00:11:10,399 --> 00:11:11,519
eyepiece which was good

352
00:11:11,519 --> 00:11:13,600
that normal activity 90 percent of the

353
00:11:13,600 --> 00:11:15,760
time there were some ips that were only

354
00:11:15,760 --> 00:11:16,640
doing tcp

355
00:11:16,640 --> 00:11:19,279
uh connections we didn't see any uh dns

356
00:11:19,279 --> 00:11:20,959
connections for those ips

357
00:11:20,959 --> 00:11:23,040
we tagged it as maybe they are using

358
00:11:23,040 --> 00:11:24,720
external dns or doh

359
00:11:24,720 --> 00:11:27,760
for uh resolution of their tcp

360
00:11:27,760 --> 00:11:28,800
connections and

361
00:11:28,800 --> 00:11:31,120
domains for the tcp connections the the

362
00:11:31,120 --> 00:11:33,440
last bar however the uh

363
00:11:33,440 --> 00:11:36,079
the dns only bar this was interesting it

364
00:11:36,079 --> 00:11:37,600
was almost uh

365
00:11:37,600 --> 00:11:40,560
five thousand six thousand ips and that

366
00:11:40,560 --> 00:11:41,519
it's

367
00:11:41,519 --> 00:11:44,399
that list of ips were only in our dns ib

368
00:11:44,399 --> 00:11:46,079
spell that means that were the only ips

369
00:11:46,079 --> 00:11:47,839
that were making only dns requests and

370
00:11:47,839 --> 00:11:49,440
we didn't see any kind of tcp

371
00:11:49,440 --> 00:11:52,800
connection from those ips

372
00:11:53,279 --> 00:11:57,839
okay so when we uh analyzed that ip5

373
00:11:57,839 --> 00:11:59,920
uh on in which we only had ips that were

374
00:11:59,920 --> 00:12:01,680
doing dns resolution

375
00:12:01,680 --> 00:12:04,480
we found out that the majority of i so i

376
00:12:04,480 --> 00:12:05,519
started looking into

377
00:12:05,519 --> 00:12:07,279
what these dns queries are like why

378
00:12:07,279 --> 00:12:09,120
these dns queries are not getting

379
00:12:09,120 --> 00:12:12,240
used so for some ips i found that

380
00:12:12,240 --> 00:12:15,519
like the first couple of a couple of um

381
00:12:15,519 --> 00:12:18,720
tens of ip we found that they were using

382
00:12:18,720 --> 00:12:20,959
hola vpn and how did we find that there

383
00:12:20,959 --> 00:12:22,839
were a lot of danish queries for

384
00:12:22,839 --> 00:12:24,560
dnstest1.hola.org

385
00:12:24,560 --> 00:12:27,200
smtp testcola.org and those were

386
00:12:27,200 --> 00:12:28,959
resolving to some kind of random static

387
00:12:28,959 --> 00:12:29,360
ip

388
00:12:29,360 --> 00:12:32,000
and that eyepiece weren't used by the

389
00:12:32,000 --> 00:12:33,920
host to connect to anything

390
00:12:33,920 --> 00:12:35,440
so i was like that's interesting so i

391
00:12:35,440 --> 00:12:36,800
did a little bit of research of what

392
00:12:36,800 --> 00:12:38,320
this hola vpn is

393
00:12:38,320 --> 00:12:40,320
it turns out that if you guys don't know

394
00:12:40,320 --> 00:12:42,480
hola vpn is a third-party

395
00:12:42,480 --> 00:12:45,920
free vpn service and the reason it is

396
00:12:45,920 --> 00:12:47,760
free is because it is pretty intrusive

397
00:12:47,760 --> 00:12:49,519
there are a lot of articles um

398
00:12:49,519 --> 00:12:51,680
available online that you can look up

399
00:12:51,680 --> 00:12:53,360
that tells you that there are a lot of

400
00:12:53,360 --> 00:12:55,440
concerns of security and privacy

401
00:12:55,440 --> 00:12:57,200
with hola vpn and they are pretty

402
00:12:57,200 --> 00:12:59,920
intrusive what that means is a client

403
00:12:59,920 --> 00:13:00,399
who is

404
00:13:00,399 --> 00:13:03,680
downloading hola will become a vp uh

405
00:13:03,680 --> 00:13:07,279
endpoint and people on the network they

406
00:13:07,279 --> 00:13:09,519
people on that vpn network can actually

407
00:13:09,519 --> 00:13:11,360
exit their traffic and proxy their

408
00:13:11,360 --> 00:13:12,800
traffic through that end point

409
00:13:12,800 --> 00:13:15,120
and that's what makes its vpn free

410
00:13:15,120 --> 00:13:16,320
because they are not using their own

411
00:13:16,320 --> 00:13:18,320
bandwidth they are using the

412
00:13:18,320 --> 00:13:20,959
customers or the enterprise bandwidth

413
00:13:20,959 --> 00:13:22,560
and we saw a lot of clients who are

414
00:13:22,560 --> 00:13:25,040
using hola and without even knowing that

415
00:13:25,040 --> 00:13:26,320
they're pretty intrusive and everything

416
00:13:26,320 --> 00:13:28,000
is in clear text all the traffic is in

417
00:13:28,000 --> 00:13:28,560
clear

418
00:13:28,560 --> 00:13:31,839
x so what are the implications so

419
00:13:31,839 --> 00:13:34,880
in in general if somebody's attacking

420
00:13:34,880 --> 00:13:37,600
and if that traffic accidentally um

421
00:13:37,600 --> 00:13:39,360
egresses or exits from

422
00:13:39,360 --> 00:13:42,079
a client who is on your network then

423
00:13:42,079 --> 00:13:42,639
that would

424
00:13:42,639 --> 00:13:45,199
that would uh make it look like that

425
00:13:45,199 --> 00:13:47,600
that traffic is coming from your network

426
00:13:47,600 --> 00:13:49,279
and it will kind of like hide the actual

427
00:13:49,279 --> 00:13:51,440
attacker and a lot of times enterprises

428
00:13:51,440 --> 00:13:52,880
have the firewall policies that are

429
00:13:52,880 --> 00:13:54,880
pretty lenient to their internal clients

430
00:13:54,880 --> 00:13:56,800
versus the external ap address

431
00:13:56,800 --> 00:13:59,760
so we found it pretty concerning and uh

432
00:13:59,760 --> 00:14:00,160
what

433
00:14:00,160 --> 00:14:02,560
more interesting was out of those 50

434
00:14:02,560 --> 00:14:03,600
systems

435
00:14:03,600 --> 00:14:06,160
a couple of dozen systems were spamming

436
00:14:06,160 --> 00:14:06,720
so i was

437
00:14:06,720 --> 00:14:08,639
i said that okay now i got that why it

438
00:14:08,639 --> 00:14:10,720
is dns test because hola is consistently

439
00:14:10,720 --> 00:14:11,920
testing your

440
00:14:11,920 --> 00:14:13,360
their clients internal network

441
00:14:13,360 --> 00:14:14,720
connection that how good the network

442
00:14:14,720 --> 00:14:17,040
connection is so that they can use that

443
00:14:17,040 --> 00:14:19,920
endpoint as an exit node so i understand

444
00:14:19,920 --> 00:14:20,240
that

445
00:14:20,240 --> 00:14:22,959
okay they are using dns test to see if

446
00:14:22,959 --> 00:14:24,959
the client can connect to the dns

447
00:14:24,959 --> 00:14:27,120
but i was interested to know and i was

448
00:14:27,120 --> 00:14:28,399
curious that why it is

449
00:14:28,399 --> 00:14:31,440
connecting and testing smtp

450
00:14:31,440 --> 00:14:33,600
so i started looking through the smtp

451
00:14:33,600 --> 00:14:35,360
smtp.log file from zeek

452
00:14:35,360 --> 00:14:37,199
and i found that those ips were actively

453
00:14:37,199 --> 00:14:38,480
spamming

454
00:14:38,480 --> 00:14:41,680
like more than 50 or 60 um

455
00:14:41,680 --> 00:14:45,120
clients like hotmail.com google.com

456
00:14:45,120 --> 00:14:48,240
random random people and they were

457
00:14:48,240 --> 00:14:50,240
actively getting blocked by spam house

458
00:14:50,240 --> 00:14:51,920
so if you haven't taken a look into the

459
00:14:51,920 --> 00:14:53,920
smtp.log file and if you run zeek

460
00:14:53,920 --> 00:14:55,600
please take a look at it because if you

461
00:14:55,600 --> 00:14:58,480
just search for the workspam house or

462
00:14:58,480 --> 00:15:00,800
blog you will see that if your ips

463
00:15:00,800 --> 00:15:01,920
internal libraries are doing something

464
00:15:01,920 --> 00:15:02,560
bad

465
00:15:02,560 --> 00:15:05,199
so that was the bad thing that out of 50

466
00:15:05,199 --> 00:15:05,839
systems

467
00:15:05,839 --> 00:15:07,839
a dozen were spamming actively our

468
00:15:07,839 --> 00:15:09,600
internal network as well as

469
00:15:09,600 --> 00:15:11,600
the the clients that are outside and

470
00:15:11,600 --> 00:15:13,199
unfortunately unfortunately they were

471
00:15:13,199 --> 00:15:14,800
getting blocked by spam house

472
00:15:14,800 --> 00:15:16,639
and there were no notification to us

473
00:15:16,639 --> 00:15:18,000
that hey by the way

474
00:15:18,000 --> 00:15:20,160
we saw these clients who are spamming

475
00:15:20,160 --> 00:15:21,600
you should do something about it

476
00:15:21,600 --> 00:15:23,040
so we investigated that and then we

477
00:15:23,040 --> 00:15:25,760
created a policy saying that

478
00:15:25,760 --> 00:15:28,000
we will not allow this third-party vpn

479
00:15:28,000 --> 00:15:28,880
service on

480
00:15:28,880 --> 00:15:30,720
our network and the clients who are

481
00:15:30,720 --> 00:15:33,839
using it for just the free purpose

482
00:15:33,839 --> 00:15:35,920
should not use it on the

483
00:15:35,920 --> 00:15:37,360
university-owned computers and if you're

484
00:15:37,360 --> 00:15:38,399
on the university network

485
00:15:38,399 --> 00:15:40,079
you should not be using that and we

486
00:15:40,079 --> 00:15:42,240
actually applied that policy and we got

487
00:15:42,240 --> 00:15:44,720
rid of hola in like

488
00:15:44,720 --> 00:15:46,399
it's a long process it took like a month

489
00:15:46,399 --> 00:15:48,079
or two because you have to convince the

490
00:15:48,079 --> 00:15:49,759
client and you don't want to annoy

491
00:15:49,759 --> 00:15:50,240
people

492
00:15:50,240 --> 00:15:52,399
that okay you cannot use this free vpn

493
00:15:52,399 --> 00:15:53,519
service anymore

494
00:15:53,519 --> 00:15:55,680
so we can so that was a good part of it

495
00:15:55,680 --> 00:15:56,880
that after doing this research

496
00:15:56,880 --> 00:16:00,000
we came up with a governance policy to

497
00:16:00,000 --> 00:16:00,800
not uh

498
00:16:00,800 --> 00:16:03,440
allow any user on the network to run

499
00:16:03,440 --> 00:16:05,839
hola vpn

500
00:16:05,839 --> 00:16:07,600
so this is just a quick slide of how we

501
00:16:07,600 --> 00:16:09,759
found on how we detected the uh

502
00:16:09,759 --> 00:16:12,800
ip addresses that were using hola

503
00:16:12,800 --> 00:16:14,959
so the four the first four are the uh

504
00:16:14,959 --> 00:16:17,199
domain names and then

505
00:16:17,199 --> 00:16:20,560
the remaining two are the http uh ioc so

506
00:16:20,560 --> 00:16:21,360
if you want to

507
00:16:21,360 --> 00:16:23,519
check out in your traffic then you can

508
00:16:23,519 --> 00:16:26,399
look for these iocs

509
00:16:26,399 --> 00:16:28,079
the second use case is the antivirus

510
00:16:28,079 --> 00:16:30,399
software so majority of the people would

511
00:16:30,399 --> 00:16:31,600
already know that antivirus are very

512
00:16:31,600 --> 00:16:33,839
noisy and they use

513
00:16:33,839 --> 00:16:37,040
dns for a lot of interesting purposes

514
00:16:37,040 --> 00:16:39,600
i would like to mention specifically um

515
00:16:39,600 --> 00:16:40,800
smackify

516
00:16:40,800 --> 00:16:42,560
they use something called global thread

517
00:16:42,560 --> 00:16:44,959
intel and it is an online database for

518
00:16:44,959 --> 00:16:46,560
their premium users

519
00:16:46,560 --> 00:16:49,199
so they so that they can connect to the

520
00:16:49,199 --> 00:16:50,480
real uh

521
00:16:50,480 --> 00:16:52,560
malware detection or manual analysis

522
00:16:52,560 --> 00:16:54,399
database to find out in the real time

523
00:16:54,399 --> 00:16:56,000
whether a file that they have open is

524
00:16:56,000 --> 00:16:57,040
malicious or not

525
00:16:57,040 --> 00:17:00,000
the same thing is with sofos um so force

526
00:17:00,000 --> 00:17:02,399
uses dns for surface extensible list and

527
00:17:02,399 --> 00:17:04,000
it provides similar kind of real-time

528
00:17:04,000 --> 00:17:07,760
protection to their premium clients

529
00:17:07,760 --> 00:17:10,880
so in mcafee we found that uh a lot of

530
00:17:10,880 --> 00:17:12,480
queries to mcafee.com

531
00:17:12,480 --> 00:17:14,799
were looking very random and weird and i

532
00:17:14,799 --> 00:17:15,520
was like why

533
00:17:15,520 --> 00:17:17,760
these random weird queries and what

534
00:17:17,760 --> 00:17:19,439
sense you can make out of it

535
00:17:19,439 --> 00:17:23,039
so it turns out that uh for having a

536
00:17:23,039 --> 00:17:24,720
quick conversation like if i have a

537
00:17:24,720 --> 00:17:26,400
question that hey this file is bad

538
00:17:26,400 --> 00:17:28,240
you just need to answer it in a black

539
00:17:28,240 --> 00:17:29,919
and white scenario yes or no right

540
00:17:29,919 --> 00:17:32,320
and what is the best protocol to do that

541
00:17:32,320 --> 00:17:33,600
which is like fast

542
00:17:33,600 --> 00:17:36,000
and um it will provide i'm not a

543
00:17:36,000 --> 00:17:38,000
reliable service because it is dns

544
00:17:38,000 --> 00:17:40,400
and udp but it is it is fast right so

545
00:17:40,400 --> 00:17:41,760
they chose dns

546
00:17:41,760 --> 00:17:44,559
and what it does is in gti that if you

547
00:17:44,559 --> 00:17:46,799
open a file which is a local file or if

548
00:17:46,799 --> 00:17:49,440
there is a local file resetting on the

549
00:17:49,440 --> 00:17:52,000
client system if it is bad and there is

550
00:17:52,000 --> 00:17:53,120
no signature

551
00:17:53,120 --> 00:17:55,679
in the in the local database that ships

552
00:17:55,679 --> 00:17:56,799
with mcafee

553
00:17:56,799 --> 00:17:58,720
the client can query it real time to gti

554
00:17:58,720 --> 00:18:00,240
database and then the gta

555
00:18:00,240 --> 00:18:02,480
gt can provide an answer that yeah it's

556
00:18:02,480 --> 00:18:04,400
suspicious then quarantine it and no

557
00:18:04,400 --> 00:18:06,240
it's not suspicious let it run

558
00:18:06,240 --> 00:18:08,400
so they use dns for that and then what

559
00:18:08,400 --> 00:18:09,840
information is shared

560
00:18:09,840 --> 00:18:12,080
it's an encoded query and that encoded

561
00:18:12,080 --> 00:18:14,559
query the first label in the in the dns

562
00:18:14,559 --> 00:18:15,120
domain

563
00:18:15,120 --> 00:18:18,240
is like the uh it has encoded

564
00:18:18,240 --> 00:18:20,880
uh version and product information the

565
00:18:20,880 --> 00:18:22,320
file hash and then some

566
00:18:22,320 --> 00:18:24,000
information about operating system or

567
00:18:24,000 --> 00:18:26,240
the environment where that file was open

568
00:18:26,240 --> 00:18:27,679
we are still not sure what is this is

569
00:18:27,679 --> 00:18:30,000
what mcafee says that they share various

570
00:18:30,000 --> 00:18:31,679
we are still not sure what exactly

571
00:18:31,679 --> 00:18:34,080
are the information shared so this is

572
00:18:34,080 --> 00:18:34,880
just from the

573
00:18:34,880 --> 00:18:38,080
gti's uh website so um

574
00:18:38,080 --> 00:18:39,679
a quick look the mcafee query looks like

575
00:18:39,679 --> 00:18:41,360
that so the first label you can see it's

576
00:18:41,360 --> 00:18:42,480
encoded

577
00:18:42,480 --> 00:18:44,240
and that contains the information like

578
00:18:44,240 --> 00:18:45,919
the file hash and the fingerprint of the

579
00:18:45,919 --> 00:18:46,559
system

580
00:18:46,559 --> 00:18:48,799
that is sent to the gta database uh with

581
00:18:48,799 --> 00:18:50,400
mcafee.com

582
00:18:50,400 --> 00:18:52,320
the only two responses that we saw from

583
00:18:52,320 --> 00:18:54,080
the from mcafee's

584
00:18:54,080 --> 00:18:55,919
dns servers for those kind of queries

585
00:18:55,919 --> 00:18:57,520
where no error in nx domain

586
00:18:57,520 --> 00:19:00,880
our hypothesis is uh that when a client

587
00:19:00,880 --> 00:19:02,480
queries that kind of query

588
00:19:02,480 --> 00:19:04,320
and when the no error comes back it

589
00:19:04,320 --> 00:19:05,520
means that the hash

590
00:19:05,520 --> 00:19:08,080
was found in the database and it is like

591
00:19:08,080 --> 00:19:08,559
a yes

592
00:19:08,559 --> 00:19:10,640
in mcafee's term that yes we have found

593
00:19:10,640 --> 00:19:12,000
this file as bad

594
00:19:12,000 --> 00:19:14,720
the nx domain is uh returned when there

595
00:19:14,720 --> 00:19:16,080
is no match for that

596
00:19:16,080 --> 00:19:18,559
fingerprint or for the file hash that

597
00:19:18,559 --> 00:19:20,080
the host has queried so it's

598
00:19:20,080 --> 00:19:22,559
no answer from the mcafee so those were

599
00:19:22,559 --> 00:19:24,400
the only two responses but that we saw

600
00:19:24,400 --> 00:19:25,840
for those queries

601
00:19:25,840 --> 00:19:27,919
so now what we can do about it right

602
00:19:27,919 --> 00:19:29,679
like we know that this activity is going

603
00:19:29,679 --> 00:19:31,840
on we are we are not able to decode

604
00:19:31,840 --> 00:19:35,200
what is sent to the gta database

605
00:19:35,200 --> 00:19:37,440
like we tried to plot it and we started

606
00:19:37,440 --> 00:19:38,799
plotting it and then

607
00:19:38,799 --> 00:19:41,039
what you can see is like a malware trend

608
00:19:41,039 --> 00:19:42,880
uh that means uh

609
00:19:42,880 --> 00:19:44,400
if there is something new kind of

610
00:19:44,400 --> 00:19:46,160
suspicious files comes around

611
00:19:46,160 --> 00:19:47,919
and if you start seeing an uptick in

612
00:19:47,919 --> 00:19:49,520
that file uh

613
00:19:49,520 --> 00:19:52,160
from your clients that you then it can

614
00:19:52,160 --> 00:19:54,000
show you something that oh something bad

615
00:19:54,000 --> 00:19:55,039
is going on or

616
00:19:55,039 --> 00:19:57,200
there is an outbreak of an attack uh

617
00:19:57,200 --> 00:19:59,280
which has compromised a lot of systems

618
00:19:59,280 --> 00:20:02,960
uh which does not have any uh local

619
00:20:02,960 --> 00:20:05,840
entry in the debt or it does not

620
00:20:05,840 --> 00:20:07,039
signature yet yet

621
00:20:07,039 --> 00:20:08,799
so it's kind of like an unknown attack

622
00:20:08,799 --> 00:20:11,280
so this is the trend of all the uh

623
00:20:11,280 --> 00:20:13,440
files that we saw going uh back and

624
00:20:13,440 --> 00:20:14,880
forth from

625
00:20:14,880 --> 00:20:18,480
our clients to mcafee's dns okay coming

626
00:20:18,480 --> 00:20:19,760
to the classification technique too

627
00:20:19,760 --> 00:20:20,799
quickly

628
00:20:20,799 --> 00:20:24,480
so it is pretty pretty basic like uh

629
00:20:24,480 --> 00:20:26,159
we are assuming that our clients should

630
00:20:26,159 --> 00:20:28,000
be using dhcp and contacting only our

631
00:20:28,000 --> 00:20:28,640
international

632
00:20:28,640 --> 00:20:30,799
dna servers but there can be some ips

633
00:20:30,799 --> 00:20:33,360
that can contact external dns servers

634
00:20:33,360 --> 00:20:35,360
but there were some ips who were

635
00:20:35,360 --> 00:20:37,280
contacting both the internal as well as

636
00:20:37,280 --> 00:20:38,720
external and those were the ips that we

637
00:20:38,720 --> 00:20:39,440
wanted to

638
00:20:39,440 --> 00:20:41,280
look into more so that that's a quick

639
00:20:41,280 --> 00:20:43,760
workflow of hourly construction

640
00:20:43,760 --> 00:20:46,480
dns external ips are the ips that we got

641
00:20:46,480 --> 00:20:48,000
from z clock

642
00:20:48,000 --> 00:20:50,320
dns internal ips are the ips that we got

643
00:20:50,320 --> 00:20:51,440
from our

644
00:20:51,440 --> 00:20:54,640
internal dns um queries log we compared

645
00:20:54,640 --> 00:20:55,280
them

646
00:20:55,280 --> 00:20:57,679
common ips unusual behavior eyepieces

647
00:20:57,679 --> 00:20:59,120
that are only in external

648
00:20:59,120 --> 00:21:00,880
are okay because they had they are they

649
00:21:00,880 --> 00:21:02,320
might be using static uh

650
00:21:02,320 --> 00:21:04,080
assignment and the ips that are in the

651
00:21:04,080 --> 00:21:05,520
dns internal life piece

652
00:21:05,520 --> 00:21:08,400
are are the ips that are using our own

653
00:21:08,400 --> 00:21:09,840
internal dns servers which should be

654
00:21:09,840 --> 00:21:11,600
normal

655
00:21:11,600 --> 00:21:14,240
results uh as you can see the majority

656
00:21:14,240 --> 00:21:16,159
of the ips

657
00:21:16,159 --> 00:21:18,000
found in both the files but the internal

658
00:21:18,000 --> 00:21:20,480
only the external only was very small

659
00:21:20,480 --> 00:21:21,280
percentage

660
00:21:21,280 --> 00:21:22,559
so we were like okay there are still

661
00:21:22,559 --> 00:21:24,320
some clients that are using static

662
00:21:24,320 --> 00:21:26,960
assignment and then there was a bar of

663
00:21:26,960 --> 00:21:29,919
almost 800 900 ips that were using both

664
00:21:29,919 --> 00:21:30,720
so that's the

665
00:21:30,720 --> 00:21:34,559
that's the case we investigated further

666
00:21:35,039 --> 00:21:38,080
turns out that baleena os is uh

667
00:21:38,080 --> 00:21:40,559
an operating system that was running on

668
00:21:40,559 --> 00:21:42,000
most of the clients

669
00:21:42,000 --> 00:21:44,080
uh who were doing both the internal as

670
00:21:44,080 --> 00:21:45,200
well as external

671
00:21:45,200 --> 00:21:48,080
so quickly belina os operating system uh

672
00:21:48,080 --> 00:21:48,480
that

673
00:21:48,480 --> 00:21:51,280
is used for orchestrating and managing

674
00:21:51,280 --> 00:21:52,480
the fleets of ioc

675
00:21:52,480 --> 00:21:55,600
uh iot devices that you have it it it

676
00:21:55,600 --> 00:21:57,280
makes it easier for the

677
00:21:57,280 --> 00:22:01,039
for the managers of those iot devices

678
00:22:01,039 --> 00:22:03,600
to manage them all at the same time

679
00:22:03,600 --> 00:22:05,280
there is another there's another a

680
00:22:05,280 --> 00:22:06,080
setting

681
00:22:06,080 --> 00:22:08,480
in bellina os orchestration platform

682
00:22:08,480 --> 00:22:10,159
that is called dns mask

683
00:22:10,159 --> 00:22:11,840
that settings exclusively used for

684
00:22:11,840 --> 00:22:13,919
bypassing the internal dns server

685
00:22:13,919 --> 00:22:14,640
setting for

686
00:22:14,640 --> 00:22:17,600
for all the uh for all the iot devices

687
00:22:17,600 --> 00:22:20,000
and that was the reason

688
00:22:20,000 --> 00:22:22,320
the clients the pos the point of sale

689
00:22:22,320 --> 00:22:23,120
devices

690
00:22:23,120 --> 00:22:26,000
were actually contacting the google dns

691
00:22:26,000 --> 00:22:28,240
server versus our internal dns servers

692
00:22:28,240 --> 00:22:28,960
for

693
00:22:28,960 --> 00:22:31,039
some of the queries that they were doing

694
00:22:31,039 --> 00:22:33,120
and uh

695
00:22:33,120 --> 00:22:36,240
and the result was that they are

696
00:22:36,240 --> 00:22:36,960
bypassing

697
00:22:36,960 --> 00:22:40,080
so iot devices are pretty naive devices

698
00:22:40,080 --> 00:22:41,120
they don't have been

699
00:22:41,120 --> 00:22:43,600
built in security already you don't want

700
00:22:43,600 --> 00:22:45,280
them to bypass your internal dns

701
00:22:45,280 --> 00:22:46,159
firewall because

702
00:22:46,159 --> 00:22:48,159
that is the minimum layer of protection

703
00:22:48,159 --> 00:22:50,400
that you can provide to your iot devices

704
00:22:50,400 --> 00:22:52,240
and if they are doing that you will get

705
00:22:52,240 --> 00:22:53,679
annoyed right that why they are doing

706
00:22:53,679 --> 00:22:54,320
that and

707
00:22:54,320 --> 00:22:56,320
those are not trivial iot devices those

708
00:22:56,320 --> 00:22:57,919
were the point of sale devices

709
00:22:57,919 --> 00:23:00,000
there are small um kiosks that

710
00:23:00,000 --> 00:23:01,840
university has set up for different kind

711
00:23:01,840 --> 00:23:04,480
of events so that people can go and

712
00:23:04,480 --> 00:23:07,600
buy tickets it is using our like

713
00:23:07,600 --> 00:23:09,360
they should be pci compliant right it is

714
00:23:09,360 --> 00:23:10,799
using credit card information

715
00:23:10,799 --> 00:23:12,960
so a little hack and if they're

716
00:23:12,960 --> 00:23:14,960
bypassing the dns firewall we would not

717
00:23:14,960 --> 00:23:17,120
be able to uh

718
00:23:17,120 --> 00:23:21,039
uh protect them so the result is uh

719
00:23:21,039 --> 00:23:23,919
we checked for the apr.balenacloud.com

720
00:23:23,919 --> 00:23:25,520
and they all were doing the uh

721
00:23:25,520 --> 00:23:28,400
api call for that cloud and we uh found

722
00:23:28,400 --> 00:23:30,720
those poc device pos devices point of

723
00:23:30,720 --> 00:23:31,520
sale devices

724
00:23:31,520 --> 00:23:34,240
we talked to the person who manages them

725
00:23:34,240 --> 00:23:35,919
and then we asked them to turn that

726
00:23:35,919 --> 00:23:38,000
setting off so by default it is on so if

727
00:23:38,000 --> 00:23:40,880
you guys are using bolina os

728
00:23:40,880 --> 00:23:42,559
make sure that that setting is off so

729
00:23:42,559 --> 00:23:44,880
that your iot devices do not bypass your

730
00:23:44,880 --> 00:23:46,000
firewall

731
00:23:46,000 --> 00:23:48,080
and the second again is evast the

732
00:23:48,080 --> 00:23:49,919
remaining ips we're doing the queries

733
00:23:49,919 --> 00:23:50,320
both

734
00:23:50,320 --> 00:23:52,400
the internal as well as external dns

735
00:23:52,400 --> 00:23:54,400
servers avest has something called real

736
00:23:54,400 --> 00:23:55,679
site protection

737
00:23:55,679 --> 00:23:57,520
which kind of like builds an encrypted

738
00:23:57,520 --> 00:23:59,279
connection from the uh

739
00:23:59,279 --> 00:24:01,200
client's host to the dns servers that

740
00:24:01,200 --> 00:24:02,480
avast hosts

741
00:24:02,480 --> 00:24:04,240
and the reason for doing that is they

742
00:24:04,240 --> 00:24:05,679
say that they protect the clients from

743
00:24:05,679 --> 00:24:07,279
the dns hijacking

744
00:24:07,279 --> 00:24:09,679
and but the thing is that all the web

745
00:24:09,679 --> 00:24:11,679
browsing traffic goes to their goes to

746
00:24:11,679 --> 00:24:12,320
their dns

747
00:24:12,320 --> 00:24:13,919
observers but all the remaining

748
00:24:13,919 --> 00:24:16,240
application level os uh

749
00:24:16,240 --> 00:24:18,480
os level dns queries and responses still

750
00:24:18,480 --> 00:24:19,919
go through the internal dns server so

751
00:24:19,919 --> 00:24:21,120
that was the reason

752
00:24:21,120 --> 00:24:22,720
why we were seeing both internal as well

753
00:24:22,720 --> 00:24:24,640
as external dns queries from the clients

754
00:24:24,640 --> 00:24:26,480
who were running avast

755
00:24:26,480 --> 00:24:28,720
um fatima we have about four minutes

756
00:24:28,720 --> 00:24:29,760
left

757
00:24:29,760 --> 00:24:32,960
okay sounds good we are almost done so

758
00:24:32,960 --> 00:24:35,039
and the result was uh we wrote up a

759
00:24:35,039 --> 00:24:37,520
script that detects the at least five

760
00:24:37,520 --> 00:24:39,360
kinds of um

761
00:24:39,360 --> 00:24:41,520
anti-awareness solutions because

762
00:24:41,520 --> 00:24:43,440
anti-viruses are very noisy and you can

763
00:24:43,440 --> 00:24:45,279
easily pick them up from your dns.log

764
00:24:45,279 --> 00:24:46,799
file or any other log file that

765
00:24:46,799 --> 00:24:48,880
they appear in it so i just created a

766
00:24:48,880 --> 00:24:50,559
script and we are we kind of like keep

767
00:24:50,559 --> 00:24:51,919
running it constantly constantly and

768
00:24:51,919 --> 00:24:53,919
whenever we see some somebody using

769
00:24:53,919 --> 00:24:55,679
a different antivirus that is not

770
00:24:55,679 --> 00:24:57,039
recommended by the institution

771
00:24:57,039 --> 00:24:58,880
we just give them a heads up that hey we

772
00:24:58,880 --> 00:25:01,520
pay for this enterprise level

773
00:25:01,520 --> 00:25:03,600
anywhere else you might want to use that

774
00:25:03,600 --> 00:25:06,959
but of course you cannot force them

775
00:25:09,679 --> 00:25:12,960
okay so in conclusion

776
00:25:13,440 --> 00:25:14,559
there is a lot of interesting activity

777
00:25:14,559 --> 00:25:16,000
that you can find by just looking at the

778
00:25:16,000 --> 00:25:17,760
dna.log file

779
00:25:17,760 --> 00:25:20,799
and just the the main take away from

780
00:25:20,799 --> 00:25:22,000
this uh discussion

781
00:25:22,000 --> 00:25:24,640
is that not only the malware that uses

782
00:25:24,640 --> 00:25:26,720
dns for the unconventional purposes but

783
00:25:26,720 --> 00:25:28,640
also there are legit applications

784
00:25:28,640 --> 00:25:30,480
that unknowingly well that knowingly

785
00:25:30,480 --> 00:25:31,840
uses dns for

786
00:25:31,840 --> 00:25:34,080
off-label use but you might not know

787
00:25:34,080 --> 00:25:35,600
about them and if there are some

788
00:25:35,600 --> 00:25:37,279
applications that are bypassing your

789
00:25:37,279 --> 00:25:39,200
firewall just like ballina os then you

790
00:25:39,200 --> 00:25:40,559
should know about them because

791
00:25:40,559 --> 00:25:41,760
there are these default settings that

792
00:25:41,760 --> 00:25:43,120
are automatically enabled and you need

793
00:25:43,120 --> 00:25:44,480
to disable them if you

794
00:25:44,480 --> 00:25:46,240
if you really want them to be protected

795
00:25:46,240 --> 00:25:47,760
by your enterprise level

796
00:25:47,760 --> 00:25:50,880
dns firewall so that was an interesting

797
00:25:50,880 --> 00:25:54,080
um use case that we investigated with

798
00:25:54,080 --> 00:25:56,640
dns.log file and that

799
00:25:56,640 --> 00:25:59,200
i think i have just a minute or two to

800
00:25:59,200 --> 00:26:01,440
see if there are any questions

801
00:26:01,440 --> 00:26:03,760
yeah thank you very much fatima um

802
00:26:03,760 --> 00:26:05,520
there's one question

803
00:26:05,520 --> 00:26:08,400
um for seek notes for analyzing eight

804
00:26:08,400 --> 00:26:09,440
gigabits

805
00:26:09,440 --> 00:26:12,000
per second at peak um that's a lot of

806
00:26:12,000 --> 00:26:13,120
hardware

807
00:26:13,120 --> 00:26:16,080
is the seek rules used very cpu

808
00:26:16,080 --> 00:26:17,679
intensive

809
00:26:17,679 --> 00:26:20,720
it depends uh our hardware is pretty um

810
00:26:20,720 --> 00:26:24,240
rugged so i said 300 000 pps

811
00:26:24,240 --> 00:26:26,000
we have designed our hardware that each

812
00:26:26,000 --> 00:26:27,840
box is capable of doing 1 million 1

813
00:26:27,840 --> 00:26:29,440
million pbs per second

814
00:26:29,440 --> 00:26:32,640
a 1 million pps rate so they are pretty

815
00:26:32,640 --> 00:26:35,120
strong hardware that we use we do have a

816
00:26:35,120 --> 00:26:36,880
lot of custom scripts but again

817
00:26:36,880 --> 00:26:38,720
every script that you turn on in zeek

818
00:26:38,720 --> 00:26:41,039
comes with a penalty of performance

819
00:26:41,039 --> 00:26:43,279
so make sure that there is balance and

820
00:26:43,279 --> 00:26:44,799
if you can upgrade up with your hardware

821
00:26:44,799 --> 00:26:45,520
to support

822
00:26:45,520 --> 00:26:48,320
latest and greatest custom scripts of

823
00:26:48,320 --> 00:26:50,799
that you can run

824
00:26:50,799 --> 00:26:54,080
cool thank you um then james asked um

825
00:26:54,080 --> 00:26:56,400
so if everything is going to be dns over

826
00:26:56,400 --> 00:26:57,600
https

827
00:26:57,600 --> 00:26:59,760
and it's not visible what can we do

828
00:26:59,760 --> 00:27:02,720
about that please

829
00:27:02,720 --> 00:27:06,080
so this everything so what we have dns

830
00:27:06,080 --> 00:27:08,000
for https again is coming it encrypted

831
00:27:08,000 --> 00:27:09,200
we cannot do anything about it and

832
00:27:09,200 --> 00:27:10,400
that's one of the reasons right to

833
00:27:10,400 --> 00:27:11,679
protect the confidentiality of the

834
00:27:11,679 --> 00:27:12,799
client

835
00:27:12,799 --> 00:27:15,360
again if the browser there are

836
00:27:15,360 --> 00:27:17,600
applications that are doing such kind of

837
00:27:17,600 --> 00:27:19,679
videos behavior so it might be a while

838
00:27:19,679 --> 00:27:22,159
for them to switch from using dns to dns

839
00:27:22,159 --> 00:27:23,360
or https

840
00:27:23,360 --> 00:27:25,440
because the reason these applications

841
00:27:25,440 --> 00:27:27,279
legit applications are using dns is for

842
00:27:27,279 --> 00:27:29,200
its fast performance

843
00:27:29,200 --> 00:27:31,360
so it might be a while i'm not sure

844
00:27:31,360 --> 00:27:32,559
whether they are going to

845
00:27:32,559 --> 00:27:35,520
do it do a complete switch but yeah

846
00:27:35,520 --> 00:27:36,960
that's a that's a good point we cannot

847
00:27:36,960 --> 00:27:38,000
do anything about it

848
00:27:38,000 --> 00:27:39,279
but it would be interesting to see if

849
00:27:39,279 --> 00:27:41,039
these applications also move

850
00:27:41,039 --> 00:27:42,080
simultaneously with

851
00:27:42,080 --> 00:27:43,840
using dns over udp for its fast

852
00:27:43,840 --> 00:27:46,480
performance or to dns or https which

853
00:27:46,480 --> 00:27:48,080
might be a little slower

854
00:27:48,080 --> 00:27:49,919
and most importantly browser-based

855
00:27:49,919 --> 00:27:52,399
activity like client typing in into the

856
00:27:52,399 --> 00:27:54,399
browser that activity might be

857
00:27:54,399 --> 00:27:56,960
more dns or https but not like legit

858
00:27:56,960 --> 00:27:58,559
application like mcafield because

859
00:27:58,559 --> 00:28:00,320
these infractions are browser less right

860
00:28:00,320 --> 00:28:01,679
mcafee ballina os

861
00:28:01,679 --> 00:28:03,760
they internally do it there is no

862
00:28:03,760 --> 00:28:05,600
induced interaction so

863
00:28:05,600 --> 00:28:07,919
so maybe there's a there's some time

864
00:28:07,919 --> 00:28:09,919
that these applications might take

865
00:28:09,919 --> 00:28:12,399
to move away from that model to use dns

866
00:28:12,399 --> 00:28:13,919
or https and how they're going to do

867
00:28:13,919 --> 00:28:15,279
that

868
00:28:15,279 --> 00:28:17,679
so until then we have happy hunting with

869
00:28:17,679 --> 00:28:20,640
our unencrypted dns

870
00:28:20,640 --> 00:28:23,760
cool um we have one one last question i

871
00:28:23,760 --> 00:28:25,520
think we can squeeze that in

872
00:28:25,520 --> 00:28:27,919
um omar commented that interesting

873
00:28:27,919 --> 00:28:28,559
research

874
00:28:28,559 --> 00:28:30,559
um did you use any specific tool to

875
00:28:30,559 --> 00:28:33,600
gather or analyze these information

876
00:28:33,600 --> 00:28:36,559
no make sure that you have data sources

877
00:28:36,559 --> 00:28:37,039
it's no

878
00:28:37,039 --> 00:28:39,440
special tool again i said that we

879
00:28:39,440 --> 00:28:40,720
converged everything collected

880
00:28:40,720 --> 00:28:41,679
everything in a seam

881
00:28:41,679 --> 00:28:43,279
but even if you don't have the same

882
00:28:43,279 --> 00:28:46,320
doesn't matter if you have your dns

883
00:28:46,320 --> 00:28:48,399
log file from if you're running z get

884
00:28:48,399 --> 00:28:50,000
that dns data and if you're running

885
00:28:50,000 --> 00:28:51,360
internal dns servers of course you will

886
00:28:51,360 --> 00:28:53,039
have that data you just have to ask for

887
00:28:53,039 --> 00:28:53,520
it

888
00:28:53,520 --> 00:28:56,559
so no special tool um just used zeke for

889
00:28:56,559 --> 00:28:58,080
collecting our north south traffic and

890
00:28:58,080 --> 00:29:00,000
use internal dns logs

891
00:29:00,000 --> 00:29:02,399
cool so with that thank you very much

892
00:29:02,399 --> 00:29:03,200
fatima

893
00:29:03,200 --> 00:29:05,039
carton for for giving this presentation

894
00:29:05,039 --> 00:29:06,480
i think it's a great example of

895
00:29:06,480 --> 00:29:08,159
sharing research with the with the

896
00:29:08,159 --> 00:29:09,679
incident response communities thank you

897
00:29:09,679 --> 00:29:10,799
for that

898
00:29:10,799 --> 00:29:12,320
and i think with that handing back to

899
00:29:12,320 --> 00:29:14,240
josh thanks

900
00:29:14,240 --> 00:29:17,600
thanks everyone

