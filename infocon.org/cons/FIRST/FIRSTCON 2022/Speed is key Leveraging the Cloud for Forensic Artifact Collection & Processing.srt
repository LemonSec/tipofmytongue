1
00:00:07,120 --> 00:00:09,600
welcome

2
00:00:11,360 --> 00:00:13,920
my name is leonel ferret i'm working for

3
00:00:13,920 --> 00:00:16,560
the cyber security center in belgium and

4
00:00:16,560 --> 00:00:20,400
i'm your session chair for this morning

5
00:00:20,560 --> 00:00:23,840
in this presentation we have chris and

6
00:00:23,840 --> 00:00:24,960
lucas

7
00:00:24,960 --> 00:00:27,519
from sap who are going to tell you how

8
00:00:27,519 --> 00:00:29,760
to leverage the cloud for forensic

9
00:00:29,760 --> 00:00:32,079
artifact collection and processing

10
00:00:32,079 --> 00:00:33,680
so but i'm not going to read their

11
00:00:33,680 --> 00:00:35,980
slides for them

12
00:00:35,980 --> 00:00:37,280
[Music]

13
00:00:37,280 --> 00:00:39,840
four questions uh

14
00:00:39,840 --> 00:00:42,800
we have two mics one in the aisle and

15
00:00:42,800 --> 00:00:45,360
one on the other side so please use them

16
00:00:45,360 --> 00:00:47,760
at the end of the session for

17
00:00:47,760 --> 00:00:49,600
four questions we will have five minutes

18
00:00:49,600 --> 00:00:50,960
for question

19
00:00:50,960 --> 00:00:53,760
also please remember to write the

20
00:00:53,760 --> 00:00:57,120
presentation in the app

21
00:00:57,600 --> 00:00:58,480
and

22
00:00:58,480 --> 00:01:00,800
without further ado i will leave the

23
00:01:00,800 --> 00:01:02,879
floor to chris and lucas

24
00:01:02,879 --> 00:01:04,720
hi

25
00:01:04,720 --> 00:01:05,840
hi

26
00:01:05,840 --> 00:01:07,600
um first of all we would briefly

27
00:01:07,600 --> 00:01:08,880
introduce us

28
00:01:08,880 --> 00:01:11,439
a bit here and what we do in sap and we

29
00:01:11,439 --> 00:01:13,119
are pretty much the stock with incident

30
00:01:13,119 --> 00:01:16,000
response capabilities in sap but we only

31
00:01:16,000 --> 00:01:18,320
operate for internal stakeholders

32
00:01:18,320 --> 00:01:20,159
so when you have a sap product you kind

33
00:01:20,159 --> 00:01:22,320
of buy us with that product

34
00:01:22,320 --> 00:01:24,159
but likely we'll never reach out to you

35
00:01:24,159 --> 00:01:25,520
directly

36
00:01:25,520 --> 00:01:28,080
and we have four centers that run like

37
00:01:28,080 --> 00:01:30,159
this to kind of yeah in a kind of follow

38
00:01:30,159 --> 00:01:32,400
the sun approach use east coast west

39
00:01:32,400 --> 00:01:34,880
coast and europe which is

40
00:01:34,880 --> 00:01:37,439
in our headquarters in waldorf

41
00:01:37,439 --> 00:01:40,320
and asia which is a team located in

42
00:01:40,320 --> 00:01:42,560
singapore with some satellite teams in

43
00:01:42,560 --> 00:01:45,600
india and malaysia as well

44
00:01:45,600 --> 00:01:47,119
yeah i'm chris i'm

45
00:01:47,119 --> 00:01:49,280
the head of the european

46
00:01:49,280 --> 00:01:50,399
hub here

47
00:01:50,399 --> 00:01:51,759
of those three

48
00:01:51,759 --> 00:01:52,880
three different

49
00:01:52,880 --> 00:01:54,479
teams that we have

50
00:01:54,479 --> 00:01:56,880
and i've i've been working in this

51
00:01:56,880 --> 00:01:58,719
incident response capability for like

52
00:01:58,719 --> 00:02:00,960
seven plus eight-ish years something

53
00:02:00,960 --> 00:02:02,079
like that

54
00:02:02,079 --> 00:02:03,840
already yep

55
00:02:03,840 --> 00:02:06,719
yeah so uh i'm lucas i'm working in

56
00:02:06,719 --> 00:02:08,560
chris team so

57
00:02:08,560 --> 00:02:10,160
i did my masters in security and cloud

58
00:02:10,160 --> 00:02:12,640
computing and two years ago i've been

59
00:02:12,640 --> 00:02:14,879
joining the incident response team of

60
00:02:14,879 --> 00:02:17,040
sap yeah and one guy that we have to

61
00:02:17,040 --> 00:02:18,239
mention because he contribute

62
00:02:18,239 --> 00:02:21,360
contributed contributed to that

63
00:02:21,360 --> 00:02:23,280
work significantly is jason he's our

64
00:02:23,280 --> 00:02:26,000
forensic guy in the emea region in the

65
00:02:26,000 --> 00:02:28,000
european region but he couldn't attend

66
00:02:28,000 --> 00:02:31,040
this talk unfortunately

67
00:02:31,760 --> 00:02:34,480
so first of all um yeah as you all know

68
00:02:34,480 --> 00:02:36,640
we just summarize it quickly attackers

69
00:02:36,640 --> 00:02:38,480
today move really fast we've seen

70
00:02:38,480 --> 00:02:39,840
attacks and

71
00:02:39,840 --> 00:02:42,400
you know the the the yeah the speed in

72
00:02:42,400 --> 00:02:44,480
which they kind of um jump from one host

73
00:02:44,480 --> 00:02:46,720
to the other was significant sometimes

74
00:02:46,720 --> 00:02:48,879
it was ours that we saw

75
00:02:48,879 --> 00:02:51,120
and we also kind of to stop them we also

76
00:02:51,120 --> 00:02:53,760
need insights into actionable actual

77
00:02:53,760 --> 00:02:56,400
um yeah iocs that we can

78
00:02:56,400 --> 00:02:58,239
do something with right it's not cool

79
00:02:58,239 --> 00:03:00,080
enough to have a inside the response

80
00:03:00,080 --> 00:03:02,800
report with listing you 200 iocs and you

81
00:03:02,800 --> 00:03:04,159
don't know what to do if you block them

82
00:03:04,159 --> 00:03:05,680
all you are doomed your whole

83
00:03:05,680 --> 00:03:08,080
environment stands so we need actionable

84
00:03:08,080 --> 00:03:09,920
iocs fast

85
00:03:09,920 --> 00:03:12,239
and to get to that point we need triage

86
00:03:12,239 --> 00:03:13,680
artifacts

87
00:03:13,680 --> 00:03:15,440
to answer at least these kind of

88
00:03:15,440 --> 00:03:17,840
questions in a fast manner because

89
00:03:17,840 --> 00:03:19,040
everything that you do with full

90
00:03:19,040 --> 00:03:21,599
forensic images just takes time right i

91
00:03:21,599 --> 00:03:23,200
mean if you have a full very expensive

92
00:03:23,200 --> 00:03:26,159
images yeah it takes days to process it

93
00:03:26,159 --> 00:03:27,680
to kind of look for for all the

94
00:03:27,680 --> 00:03:30,319
different yeah things in there so most

95
00:03:30,319 --> 00:03:32,480
of the time we are fine with triage

96
00:03:32,480 --> 00:03:34,239
artifacts

97
00:03:34,239 --> 00:03:37,040
and for us especially in sap we also

98
00:03:37,040 --> 00:03:38,879
struggle with the complexity of our

99
00:03:38,879 --> 00:03:40,239
environments

100
00:03:40,239 --> 00:03:41,920
so we have a lot of environments out

101
00:03:41,920 --> 00:03:43,760
there and a lot of yeah every cloud you

102
00:03:43,760 --> 00:03:46,720
can think of we use it somewhere in sap

103
00:03:46,720 --> 00:03:48,319
every technology you can think of is

104
00:03:48,319 --> 00:03:49,599
used somewhere

105
00:03:49,599 --> 00:03:52,400
so that's why also why this enterprise

106
00:03:52,400 --> 00:03:54,000
tools these big

107
00:03:54,000 --> 00:03:55,920
big ones they've kind of always had

108
00:03:55,920 --> 00:03:58,640
significant gaps for us

109
00:03:58,640 --> 00:04:01,599
and also really pain point the manual

110
00:04:01,599 --> 00:04:04,000
processes and the human dependencies

111
00:04:04,000 --> 00:04:05,519
in response so

112
00:04:05,519 --> 00:04:07,280
that was actually our problem like

113
00:04:07,280 --> 00:04:08,879
everybody knows i guess everybody feels

114
00:04:08,879 --> 00:04:11,200
the same right we need some files that

115
00:04:11,200 --> 00:04:14,480
are yeah not easy to kind of get from

116
00:04:14,480 --> 00:04:16,560
remotely by us we need the user to do

117
00:04:16,560 --> 00:04:19,120
something is it a clicking a script to

118
00:04:19,120 --> 00:04:20,959
transfer the file or

119
00:04:20,959 --> 00:04:23,680
ask allowing us to rdp in something

120
00:04:23,680 --> 00:04:26,240
needs to be done often by the user

121
00:04:26,240 --> 00:04:27,919
and the problem that is also new to me

122
00:04:27,919 --> 00:04:29,840
when i joined smp is like it's it's a

123
00:04:29,840 --> 00:04:32,240
truly global company we have to deal

124
00:04:32,240 --> 00:04:34,479
with people in latin america in buenos

125
00:04:34,479 --> 00:04:37,120
aires we have people in sydney with

126
00:04:37,120 --> 00:04:38,160
people in

127
00:04:38,160 --> 00:04:39,600
in cape town

128
00:04:39,600 --> 00:04:41,759
and there's always a pto somewhere or

129
00:04:41,759 --> 00:04:44,080
there's always a public holiday

130
00:04:44,080 --> 00:04:45,759
the working hours are completely messed

131
00:04:45,759 --> 00:04:48,560
up because yeah it's a mess and it's a

132
00:04:48,560 --> 00:04:50,800
big delay unfortunately

133
00:04:50,800 --> 00:04:52,000
so

134
00:04:52,000 --> 00:04:53,759
we kind of thought about what we can do

135
00:04:53,759 --> 00:04:55,040
with stuff

136
00:04:55,040 --> 00:04:57,440
and how to make it fast and also how how

137
00:04:57,440 --> 00:04:58,880
to kind of do it without annoying the

138
00:04:58,880 --> 00:05:02,320
users because imagine talking to hr lady

139
00:05:02,320 --> 00:05:03,759
and trying to get her to execute a

140
00:05:03,759 --> 00:05:05,600
powershell that was yeah

141
00:05:05,600 --> 00:05:07,280
it needs a phone call and that doesn't

142
00:05:07,280 --> 00:05:09,280
scale well

143
00:05:09,280 --> 00:05:11,199
so we kind of one thing that we have in

144
00:05:11,199 --> 00:05:14,880
common in sap is we are a big windows

145
00:05:14,880 --> 00:05:17,520
shop as well especially for these all

146
00:05:17,520 --> 00:05:18,720
non-techie

147
00:05:18,720 --> 00:05:19,680
teams

148
00:05:19,680 --> 00:05:20,960
out there

149
00:05:20,960 --> 00:05:23,039
so edr is actually the way to go there

150
00:05:23,039 --> 00:05:26,080
for us and we we heavily rely on

151
00:05:26,080 --> 00:05:29,520
on windows defender there

152
00:05:30,479 --> 00:05:31,759
so

153
00:05:31,759 --> 00:05:33,520
it's your part

154
00:05:33,520 --> 00:05:35,600
yeah so now that uh christian for trader

155
00:05:35,600 --> 00:05:36,479
vision

156
00:05:36,479 --> 00:05:38,080
the first questions we all have is of

157
00:05:38,080 --> 00:05:40,160
course how do we get the uh the

158
00:05:40,160 --> 00:05:42,560
artifacts from the compromised host

159
00:05:42,560 --> 00:05:43,360
so

160
00:05:43,360 --> 00:05:45,680
let's have a deeper look at that

161
00:05:45,680 --> 00:05:48,000
so to collect the artifacts from

162
00:05:48,000 --> 00:05:50,639
compromised hosts rewrote two powershell

163
00:05:50,639 --> 00:05:51,600
scripts

164
00:05:51,600 --> 00:05:53,600
that are called invoke an arc collection

165
00:05:53,600 --> 00:05:55,520
life response collection and invoke

166
00:05:55,520 --> 00:05:57,280
triage collection

167
00:05:57,280 --> 00:05:59,280
the first script the invoke lr

168
00:05:59,280 --> 00:06:01,840
collection script basically is a stager

169
00:06:01,840 --> 00:06:04,479
so it just downloads the invoke triage

170
00:06:04,479 --> 00:06:05,919
collection script and all its

171
00:06:05,919 --> 00:06:07,440
dependencies and

172
00:06:07,440 --> 00:06:09,840
validates the integrity of these files

173
00:06:09,840 --> 00:06:12,400
the reason we decided to to do the

174
00:06:12,400 --> 00:06:14,479
staged approach is because it allows us

175
00:06:14,479 --> 00:06:16,960
to circumvent the maximum file size

176
00:06:16,960 --> 00:06:19,600
limits of microsoft defender

177
00:06:19,600 --> 00:06:22,720
and uh exactly so um if we look at the

178
00:06:22,720 --> 00:06:25,280
invoke triage collection.ps1 script

179
00:06:25,280 --> 00:06:26,720
which does

180
00:06:26,720 --> 00:06:28,000
the magic

181
00:06:28,000 --> 00:06:30,880
then um we can see that it has several

182
00:06:30,880 --> 00:06:32,080
tasks

183
00:06:32,080 --> 00:06:33,600
the script

184
00:06:33,600 --> 00:06:37,600
first of all collects the artifacts by

185
00:06:37,600 --> 00:06:40,080
order of volatility so you can see it

186
00:06:40,080 --> 00:06:41,840
first collects the memory

187
00:06:41,840 --> 00:06:44,400
then it collects the triage artifacts

188
00:06:44,400 --> 00:06:46,160
after this is done

189
00:06:46,160 --> 00:06:49,280
these two these two things are encrypted

190
00:06:49,280 --> 00:06:52,080
and uploaded to our cloud processing

191
00:06:52,080 --> 00:06:55,120
environment but you can see here that we

192
00:06:55,120 --> 00:06:57,440
did change the order so we first

193
00:06:57,440 --> 00:06:59,199
collected memory then we collected three

194
00:06:59,199 --> 00:07:00,560
art artifacts

195
00:07:00,560 --> 00:07:02,240
but we first upload encrypt and upload

196
00:07:02,240 --> 00:07:03,840
the triage artifacts and then we encrypt

197
00:07:03,840 --> 00:07:05,599
and upload the memory the reason for

198
00:07:05,599 --> 00:07:08,080
this design choice was that

199
00:07:08,080 --> 00:07:09,919
usually the triage artifacts are smaller

200
00:07:09,919 --> 00:07:12,639
in size and this allows us if we upload

201
00:07:12,639 --> 00:07:15,120
them first it allows us to get insights

202
00:07:15,120 --> 00:07:16,720
quicker it reduces the latency until we

203
00:07:16,720 --> 00:07:18,400
get the first results

204
00:07:18,400 --> 00:07:20,720
so and this is why we swap them it's

205
00:07:20,720 --> 00:07:22,560
also important to note

206
00:07:22,560 --> 00:07:23,520
that

207
00:07:23,520 --> 00:07:26,000
the invoke triage collection of ps1 can

208
00:07:26,000 --> 00:07:28,639
be executed by the r by the edr which is

209
00:07:28,639 --> 00:07:30,400
running on the compromised host but it

210
00:07:30,400 --> 00:07:33,599
doesn't have to so we can we can take

211
00:07:33,599 --> 00:07:35,759
this invoke triage collection of ps1 put

212
00:07:35,759 --> 00:07:38,479
it on a fully isolated host but then we

213
00:07:38,479 --> 00:07:40,160
of course rely on the manual processes

214
00:07:40,160 --> 00:07:41,520
again so sometimes if you have fully

215
00:07:41,520 --> 00:07:44,080
isolated hosts if you have hosts that

216
00:07:44,080 --> 00:07:46,160
that belong to contractors something

217
00:07:46,160 --> 00:07:48,000
like that where you don't have

218
00:07:48,000 --> 00:07:50,400
full full access on the system we can

219
00:07:50,400 --> 00:07:52,000
still run the tool and use the pipeline

220
00:07:52,000 --> 00:07:54,160
behind it but we cannot of course

221
00:07:54,160 --> 00:07:55,680
trigger it via ddr which is the main

222
00:07:55,680 --> 00:07:58,879
point of this talk um

223
00:07:58,879 --> 00:08:01,199
yeah so

224
00:08:01,199 --> 00:08:03,680
our script uses a lot of

225
00:08:03,680 --> 00:08:05,599
well-known tools so

226
00:08:05,599 --> 00:08:08,400
we use mainly for dependencies we

227
00:08:08,400 --> 00:08:10,400
use volaxity

228
00:08:10,400 --> 00:08:11,919
the search collect tool for the memory

229
00:08:11,919 --> 00:08:13,360
collection

230
00:08:13,360 --> 00:08:14,240
and

231
00:08:14,240 --> 00:08:15,840
we use cape

232
00:08:15,840 --> 00:08:18,080
as a tool for the triage artifact

233
00:08:18,080 --> 00:08:19,360
collection

234
00:08:19,360 --> 00:08:23,360
we use 7-zip to compress and encrypt

235
00:08:23,360 --> 00:08:26,160
the memory image anti-triage artifacts

236
00:08:26,160 --> 00:08:28,879
and we use the aws tools powershell

237
00:08:28,879 --> 00:08:31,599
library to upload everything to our s3

238
00:08:31,599 --> 00:08:33,120
bucket

239
00:08:33,120 --> 00:08:35,919
we wrote a script in a modular fashion

240
00:08:35,919 --> 00:08:37,919
which means it's easy to replace certain

241
00:08:37,919 --> 00:08:39,360
tools so if you feel like you don't want

242
00:08:39,360 --> 00:08:41,839
to use search collect you can just um

243
00:08:41,839 --> 00:08:43,599
adjust two lines of code and then you

244
00:08:43,599 --> 00:08:45,440
can use another tool

245
00:08:45,440 --> 00:08:49,680
and so this this is very dynamic

246
00:08:49,680 --> 00:08:53,440
so as some of you might oops

247
00:08:53,440 --> 00:08:56,080
as some of you don't know might not know

248
00:08:56,080 --> 00:08:57,120
cape

249
00:08:57,120 --> 00:08:59,839
cabe is a tool that allows collecting

250
00:08:59,839 --> 00:09:02,399
artifacts from the endpoints and

251
00:09:02,399 --> 00:09:05,120
it does so based on so-called dot tk

252
00:09:05,120 --> 00:09:06,399
config files

253
00:09:06,399 --> 00:09:09,440
and we brought one of us uh one of these

254
00:09:09,440 --> 00:09:11,680
with us and you can uh you can see it on

255
00:09:11,680 --> 00:09:12,640
the slide

256
00:09:12,640 --> 00:09:14,320
it's um

257
00:09:14,320 --> 00:09:16,720
it um it's a pretty simple format to

258
00:09:16,720 --> 00:09:19,440
understand we have this target section

259
00:09:19,440 --> 00:09:21,040
where you specify the artifacts you want

260
00:09:21,040 --> 00:09:23,920
to collect we have the

261
00:09:23,920 --> 00:09:25,279
you usually give the artifact you want

262
00:09:25,279 --> 00:09:26,640
to collect the name

263
00:09:26,640 --> 00:09:28,160
a category

264
00:09:28,160 --> 00:09:30,000
a path and

265
00:09:30,000 --> 00:09:32,160
aware of where the artifact is located

266
00:09:32,160 --> 00:09:34,839
and a file mask and you can of course

267
00:09:34,839 --> 00:09:38,480
use uh wild cards here so you um yeah

268
00:09:38,480 --> 00:09:39,440
exactly

269
00:09:39,440 --> 00:09:40,880
and

270
00:09:40,880 --> 00:09:42,720
as you can see

271
00:09:42,720 --> 00:09:45,040
this rule was created by mike carey it

272
00:09:45,040 --> 00:09:46,640
wasn't created by us

273
00:09:46,640 --> 00:09:48,640
another benefit that comes with cape is

274
00:09:48,640 --> 00:09:51,360
that cape on their public github has a

275
00:09:51,360 --> 00:09:53,200
lot of already pre-made rules that are

276
00:09:53,200 --> 00:09:55,519
ready to use so you don't need to make

277
00:09:55,519 --> 00:09:57,200
everything you're on your own you can

278
00:09:57,200 --> 00:09:59,040
select which artifacts you you need you

279
00:09:59,040 --> 00:10:00,959
can make your custom rules for your own

280
00:10:00,959 --> 00:10:02,560
product something like that and then you

281
00:10:02,560 --> 00:10:05,600
can make a compound config file um to

282
00:10:05,600 --> 00:10:07,040
collect the artifacts that you want to

283
00:10:07,040 --> 00:10:08,000
collect

284
00:10:08,000 --> 00:10:09,839
so we highly recommend that you check

285
00:10:09,839 --> 00:10:12,560
out that that github repository and we

286
00:10:12,560 --> 00:10:14,480
decided to use cape because it's because

287
00:10:14,480 --> 00:10:15,920
of exactly that reason it's easy to

288
00:10:15,920 --> 00:10:18,000
adjust to everyone's needs and it's free

289
00:10:18,000 --> 00:10:20,399
of charge

290
00:10:20,399 --> 00:10:22,880
so earlier i said that we are encrypting

291
00:10:22,880 --> 00:10:24,320
the memory image and the triage

292
00:10:24,320 --> 00:10:26,640
artifacts before uploading them to our

293
00:10:26,640 --> 00:10:28,800
cloud processing environment

294
00:10:28,800 --> 00:10:30,959
sometimes for example for fully isolated

295
00:10:30,959 --> 00:10:33,040
systems you have to rely on a third

296
00:10:33,040 --> 00:10:35,040
party to transfer the file

297
00:10:35,040 --> 00:10:37,120
and with encryption we can make sure

298
00:10:37,120 --> 00:10:38,560
that no one modifies or views the

299
00:10:38,560 --> 00:10:41,360
collected files during transit

300
00:10:41,360 --> 00:10:43,600
for this purpose we use a classic

301
00:10:43,600 --> 00:10:45,440
envelope encryption scheme

302
00:10:45,440 --> 00:10:47,920
so in the first step we do generate a

303
00:10:47,920 --> 00:10:49,680
random symmetric key

304
00:10:49,680 --> 00:10:51,600
that random symmetric key is used to

305
00:10:51,600 --> 00:10:52,880
encrypt the

306
00:10:52,880 --> 00:10:54,320
the

307
00:10:54,320 --> 00:10:56,399
forensic the triage artifacts and the

308
00:10:56,399 --> 00:10:57,839
memory image

309
00:10:57,839 --> 00:10:59,120
and

310
00:10:59,120 --> 00:11:01,680
yeah but the thing is if you if you uh

311
00:11:01,680 --> 00:11:03,760
want to use uh process these these raw

312
00:11:03,760 --> 00:11:05,760
artifacts in the cloud environment later

313
00:11:05,760 --> 00:11:07,600
you need this this symmetric key right

314
00:11:07,600 --> 00:11:09,040
you cannot just use the encrypted

315
00:11:09,040 --> 00:11:10,160
artifacts and you cannot work with them

316
00:11:10,160 --> 00:11:12,720
directly so um but it's also not a good

317
00:11:12,720 --> 00:11:15,040
idea to to store the the symmetric key

318
00:11:15,040 --> 00:11:17,200
right next to the to the encrypted file

319
00:11:17,200 --> 00:11:18,640
because then what security guarantees do

320
00:11:18,640 --> 00:11:21,600
you get so the solution for this is that

321
00:11:21,600 --> 00:11:23,680
we use asymmetric cryptography and

322
00:11:23,680 --> 00:11:25,440
combine it with the symmetric

323
00:11:25,440 --> 00:11:29,360
cryptography and what we basically do is

324
00:11:29,360 --> 00:11:32,079
we bundle our collection script with a

325
00:11:32,079 --> 00:11:33,680
public key

326
00:11:33,680 --> 00:11:35,839
and that public key we use to encrypt

327
00:11:35,839 --> 00:11:37,839
the random symmetric key

328
00:11:37,839 --> 00:11:39,760
and the private key to reverse this

329
00:11:39,760 --> 00:11:41,680
encryption is only located in our cloud

330
00:11:41,680 --> 00:11:43,920
processing environment so on the file

331
00:11:43,920 --> 00:11:46,000
system itself you can you don't have any

332
00:11:46,000 --> 00:11:47,360
artifacts anymore that allow you to

333
00:11:47,360 --> 00:11:50,399
decrypt the the package and we basically

334
00:11:50,399 --> 00:11:52,480
this leaves us with basically two files

335
00:11:52,480 --> 00:11:53,760
on the file system on the compromised

336
00:11:53,760 --> 00:11:55,279
host

337
00:11:55,279 --> 00:11:58,079
first of all the artifacts that are

338
00:11:58,079 --> 00:11:59,920
encrypted with the random symmetric key

339
00:11:59,920 --> 00:12:01,600
and the symmetric key that has been

340
00:12:01,600 --> 00:12:03,519
encrypted with the public key and these

341
00:12:03,519 --> 00:12:05,519
two artifacts you can safely transmit

342
00:12:05,519 --> 00:12:07,440
into the

343
00:12:07,440 --> 00:12:10,959
processing environment in the cloud

344
00:12:10,959 --> 00:12:14,399
yeah and now we've got the little files

345
00:12:14,399 --> 00:12:16,240
as you can see like cape only collects

346
00:12:16,240 --> 00:12:17,600
you the files so when you tell him to

347
00:12:17,600 --> 00:12:19,120
fetch that file he will fetch that file

348
00:12:19,120 --> 00:12:20,480
we'll zip it we will encrypt it we'll

349
00:12:20,480 --> 00:12:22,000
upload it and there you go with your

350
00:12:22,000 --> 00:12:23,279
binary plot

351
00:12:23,279 --> 00:12:25,680
that's not entirely usable if you're a

352
00:12:25,680 --> 00:12:27,839
human being so of course it needs to be

353
00:12:27,839 --> 00:12:30,160
a step further right you basically what

354
00:12:30,160 --> 00:12:32,480
we do here in the processing environment

355
00:12:32,480 --> 00:12:33,920
is we kind of

356
00:12:33,920 --> 00:12:36,240
convert that stuff in a general manner

357
00:12:36,240 --> 00:12:38,639
into csvs and human readable stuff that

358
00:12:38,639 --> 00:12:40,399
we consume later on

359
00:12:40,399 --> 00:12:42,000
so first of all we have this staging

360
00:12:42,000 --> 00:12:43,040
bucket that

361
00:12:43,040 --> 00:12:44,880
so we call it is a three bucket that

362
00:12:44,880 --> 00:12:47,680
actually is only available to write

363
00:12:47,680 --> 00:12:48,480
from

364
00:12:48,480 --> 00:12:50,480
the affected

365
00:12:50,480 --> 00:12:52,639
endpoints that you just saw right anyone

366
00:12:52,639 --> 00:12:54,320
can kind of with the right key you can

367
00:12:54,320 --> 00:12:56,639
write new artifacts to that to that a

368
00:12:56,639 --> 00:12:58,480
bucket but there is no read there is no

369
00:12:58,480 --> 00:13:00,959
append so once you vote it it's done

370
00:13:00,959 --> 00:13:02,320
there's nothing you can do about it

371
00:13:02,320 --> 00:13:03,600
anymore

372
00:13:03,600 --> 00:13:06,959
and since it's encrypted um yeah

373
00:13:06,959 --> 00:13:08,639
it's also fine for our workers council

374
00:13:08,639 --> 00:13:10,000
the way you saw it with this double

375
00:13:10,000 --> 00:13:11,600
encryption means like that we need to

376
00:13:11,600 --> 00:13:13,440
have this session key as well and our

377
00:13:13,440 --> 00:13:15,600
workers console and all our data privacy

378
00:13:15,600 --> 00:13:17,760
lawyers are happy with that because

379
00:13:17,760 --> 00:13:19,680
the normal key it's not enough to get

380
00:13:19,680 --> 00:13:20,480
you

381
00:13:20,480 --> 00:13:22,800
all the information from these endpoints

382
00:13:22,800 --> 00:13:25,040
we do have a replication that triggers

383
00:13:25,040 --> 00:13:27,120
automatically with lambda when you

384
00:13:27,120 --> 00:13:29,279
upload something that's our cold storage

385
00:13:29,279 --> 00:13:30,880
that's important whenever we because

386
00:13:30,880 --> 00:13:32,480
when you process stuff right you change

387
00:13:32,480 --> 00:13:33,200
it

388
00:13:33,200 --> 00:13:34,959
so you also want to have the originals

389
00:13:34,959 --> 00:13:36,720
available for you if you want to dig

390
00:13:36,720 --> 00:13:39,839
deeper for any reason later on

391
00:13:39,839 --> 00:13:41,920
but that's the interesting part right um

392
00:13:41,920 --> 00:13:43,839
we have the automation in place there as

393
00:13:43,839 --> 00:13:45,360
well so once

394
00:13:45,360 --> 00:13:47,440
the upload is triggered it kind of goes

395
00:13:47,440 --> 00:13:48,880
to the gold storage that's the easy part

396
00:13:48,880 --> 00:13:50,399
just as it is

397
00:13:50,399 --> 00:13:51,839
and we also have the processing part

398
00:13:51,839 --> 00:13:54,160
where we download decrypt stuff and

399
00:13:54,160 --> 00:13:57,279
process the war at defects

400
00:13:57,279 --> 00:13:59,279
and what happens later on is we pretty

401
00:13:59,279 --> 00:14:00,000
much

402
00:14:00,000 --> 00:14:01,839
do the same drill again and we upload

403
00:14:01,839 --> 00:14:04,480
the csvs and human readable files

404
00:14:04,480 --> 00:14:08,079
um as well to a new bucket again that is

405
00:14:08,079 --> 00:14:11,519
now available for our um frenzy guys

406
00:14:11,519 --> 00:14:13,920
and what do we do with this process

407
00:14:13,920 --> 00:14:15,519
processing it's pretty simple right i

408
00:14:15,519 --> 00:14:17,440
mean you all know the eric zimmerman

409
00:14:17,440 --> 00:14:19,440
tools for example that kind of gets you

410
00:14:19,440 --> 00:14:21,519
csv's out of regular keys and event

411
00:14:21,519 --> 00:14:24,320
blocks the blend ideas are a bit more

412
00:14:24,320 --> 00:14:26,160
because we want to kind of see network

413
00:14:26,160 --> 00:14:28,880
artifacts being embedded right away when

414
00:14:28,880 --> 00:14:30,720
i see there's a host connecting to some

415
00:14:30,720 --> 00:14:32,480
other sapos i want to see who's the

416
00:14:32,480 --> 00:14:34,399
owner of that host and where does it

417
00:14:34,399 --> 00:14:35,199
live

418
00:14:35,199 --> 00:14:37,120
and is that normal or is it not normal

419
00:14:37,120 --> 00:14:38,480
that's really easy to guess when you

420
00:14:38,480 --> 00:14:40,720
kind of see these connections like that

421
00:14:40,720 --> 00:14:42,320
guy isn't supposed to kind of connect to

422
00:14:42,320 --> 00:14:45,040
that cloud environment because that's

423
00:14:45,040 --> 00:14:47,040
a hr computer but that one is used for

424
00:14:47,040 --> 00:14:48,959
coding so that's something that should

425
00:14:48,959 --> 00:14:50,399
kind of you know pop your

426
00:14:50,399 --> 00:14:51,839
eye right away

427
00:14:51,839 --> 00:14:53,680
and we also want to have an idea of for

428
00:14:53,680 --> 00:14:55,600
example browser browser artifacts right

429
00:14:55,600 --> 00:14:57,360
we also want to have an idea which of

430
00:14:57,360 --> 00:14:59,519
those domains in this browser s3 are

431
00:14:59,519 --> 00:15:01,600
ours and which are not

432
00:15:01,600 --> 00:15:04,000
that kind of shrinks down the size of

433
00:15:04,000 --> 00:15:06,240
things for the analytic investigator to

434
00:15:06,240 --> 00:15:08,880
kind of you know look at

435
00:15:08,880 --> 00:15:11,040
and also as you know white golden images

436
00:15:11,040 --> 00:15:12,959
is also a big point when you see hashes

437
00:15:12,959 --> 00:15:14,800
you want to kind of pull all of them out

438
00:15:14,800 --> 00:15:16,320
that are part of your golden image or at

439
00:15:16,320 --> 00:15:18,959
least mark them so you see yeah that's

440
00:15:18,959 --> 00:15:21,120
probably an unaltered file not super

441
00:15:21,120 --> 00:15:22,639
interesting for that

442
00:15:22,639 --> 00:15:26,959
for that triage analytic phase

443
00:15:26,959 --> 00:15:29,279
yeah as you can see um we kind of plug

444
00:15:29,279 --> 00:15:31,839
in everything like both the cold storage

445
00:15:31,839 --> 00:15:34,320
there and this process storage to our um

446
00:15:34,320 --> 00:15:36,079
forensic workstations

447
00:15:36,079 --> 00:15:37,839
that's really helpful because yes you

448
00:15:37,839 --> 00:15:40,079
have a kind of you know a pipeline but

449
00:15:40,079 --> 00:15:41,680
very often you have to go deeper right

450
00:15:41,680 --> 00:15:43,440
you need this one file and you need it

451
00:15:43,440 --> 00:15:44,720
in more because there's always like a

452
00:15:44,720 --> 00:15:47,120
data loss when you kind of transfer

453
00:15:47,120 --> 00:15:49,839
when you kind of transfer any uh trans

454
00:15:49,839 --> 00:15:52,079
form anything to csv for example there's

455
00:15:52,079 --> 00:15:53,440
a certain flag that you want to see but

456
00:15:53,440 --> 00:15:55,199
that's not part of the csv

457
00:15:55,199 --> 00:15:56,560
in that case it doesn't matter because

458
00:15:56,560 --> 00:15:57,920
you have the original files right next

459
00:15:57,920 --> 00:15:59,759
to you you can't alter them anymore it's

460
00:15:59,759 --> 00:16:01,199
still there but you can download them

461
00:16:01,199 --> 00:16:04,959
and play with them on your own if needed

462
00:16:05,440 --> 00:16:08,240
right now unfortunately we kind of still

463
00:16:08,240 --> 00:16:10,000
liked

464
00:16:10,000 --> 00:16:12,160
the happy ever after solution so we

465
00:16:12,160 --> 00:16:14,240
still rely on ec2 instances for this

466
00:16:14,240 --> 00:16:16,800
pre-processing that's a bit unfortunate

467
00:16:16,800 --> 00:16:17,920
because it's

468
00:16:17,920 --> 00:16:20,160
it's like it's expensive right and we

469
00:16:20,160 --> 00:16:22,240
want to kind of move to lambda but

470
00:16:22,240 --> 00:16:24,320
that's a bit harsh because yeah it's a

471
00:16:24,320 --> 00:16:26,560
lot of work to move all these uh all

472
00:16:26,560 --> 00:16:29,360
these property code tools there

473
00:16:29,360 --> 00:16:31,839
and make them run in lambda i mean it's

474
00:16:31,839 --> 00:16:33,920
doable we know that you can run windows

475
00:16:33,920 --> 00:16:35,600
binaries in there but it's like it's

476
00:16:35,600 --> 00:16:37,440
it's some work so

477
00:16:37,440 --> 00:16:39,519
but yeah that's one of our things that

478
00:16:39,519 --> 00:16:40,639
you want to do

479
00:16:40,639 --> 00:16:42,399
still

480
00:16:42,399 --> 00:16:44,399
and what is really cool in the actual

481
00:16:44,399 --> 00:16:46,160
also the thing that kind of really kind

482
00:16:46,160 --> 00:16:46,880
of

483
00:16:46,880 --> 00:16:50,000
made our minds uh yeah blue is the

484
00:16:50,000 --> 00:16:51,519
ability of triggering that whole thing

485
00:16:51,519 --> 00:16:54,320
with an api without anything but just a

486
00:16:54,320 --> 00:16:57,199
little nice hdp call yeah we all love

487
00:16:57,199 --> 00:16:59,440
that right it's simple

488
00:16:59,440 --> 00:17:01,839
and this is how it looks like um

489
00:17:01,839 --> 00:17:04,559
you can see it's pretty yeah pretty easy

490
00:17:04,559 --> 00:17:05,760
to read right

491
00:17:05,760 --> 00:17:07,839
and we have this one script command

492
00:17:07,839 --> 00:17:09,839
it gets a bit tricky because we again we

493
00:17:09,839 --> 00:17:12,319
have with german company gdpr we have as

494
00:17:12,319 --> 00:17:14,640
many data privacy lawyers in our company

495
00:17:14,640 --> 00:17:16,400
as investigators

496
00:17:16,400 --> 00:17:18,480
so we have to be super compliant so we

497
00:17:18,480 --> 00:17:20,559
have to have this flex in there and you

498
00:17:20,559 --> 00:17:21,919
know sometimes we are allowed to kind of

499
00:17:21,919 --> 00:17:23,520
get the browser history sometimes we are

500
00:17:23,520 --> 00:17:25,039
not sometimes we are allowed to get the

501
00:17:25,039 --> 00:17:27,119
memory sometimes we are not

502
00:17:27,119 --> 00:17:29,520
it's doable with arguments in here right

503
00:17:29,520 --> 00:17:31,039
as you can see in that case we have this

504
00:17:31,039 --> 00:17:32,799
case number that's also super important

505
00:17:32,799 --> 00:17:35,280
for us everything that we do needs to be

506
00:17:35,280 --> 00:17:38,160
trackable and auditable and yeah

507
00:17:38,160 --> 00:17:40,400
the workers council and the data lawyers

508
00:17:40,400 --> 00:17:42,000
and the auditors they need to jump they

509
00:17:42,000 --> 00:17:43,600
need to be able to jump in at any time

510
00:17:43,600 --> 00:17:45,039
and tell them and i have to tell them

511
00:17:45,039 --> 00:17:46,960
look why did you get that forensic

512
00:17:46,960 --> 00:17:48,799
sample from that hose naked look that's

513
00:17:48,799 --> 00:17:50,880
the number let's open the ticket let's

514
00:17:50,880 --> 00:17:53,679
open the incident and we can tell you

515
00:17:53,679 --> 00:17:55,919
that's pretty brilliant for us

516
00:17:55,919 --> 00:17:58,080
this is why we made it mandatory to kind

517
00:17:58,080 --> 00:18:01,120
of have these kind of uh parameters

518
00:18:01,120 --> 00:18:02,960
one thing that you should be aware of

519
00:18:02,960 --> 00:18:05,600
yes it's yeah it's so already all right

520
00:18:05,600 --> 00:18:08,240
it's a http call so you can put it into

521
00:18:08,240 --> 00:18:10,080
any sorry you have

522
00:18:10,080 --> 00:18:11,679
you it's audit ready if you take your

523
00:18:11,679 --> 00:18:13,200
certain numbers and kind of do you you

524
00:18:13,200 --> 00:18:16,400
know you drop the right things in there

525
00:18:16,400 --> 00:18:17,840
and one thing that you have to be aware

526
00:18:17,840 --> 00:18:20,960
of is the 10-minute timeout of

527
00:18:20,960 --> 00:18:24,400
this whole thing however you saw that we

528
00:18:24,400 --> 00:18:26,559
had this nearly malware like second

529
00:18:26,559 --> 00:18:29,200
stage thing that's why

530
00:18:29,200 --> 00:18:30,640
because if you open the subtask the

531
00:18:30,640 --> 00:18:32,080
timeout can kill the parent house you

532
00:18:32,080 --> 00:18:34,640
don't care the subtest keeps on running

533
00:18:34,640 --> 00:18:36,559
which is what we want to have

534
00:18:36,559 --> 00:18:38,400
so that's a nice little thing but you

535
00:18:38,400 --> 00:18:39,840
have to be aware of that so you will see

536
00:18:39,840 --> 00:18:41,679
a timeout in the logs right it will tell

537
00:18:41,679 --> 00:18:43,200
yeah we tried to execute that script but

538
00:18:43,200 --> 00:18:44,480
man there was a time out of the 10

539
00:18:44,480 --> 00:18:45,679
minutes and you can

540
00:18:45,679 --> 00:18:47,039
i don't care

541
00:18:47,039 --> 00:18:50,480
it's a sub process yeah

542
00:18:50,559 --> 00:18:53,120
one thing that's also actually making

543
00:18:53,120 --> 00:18:56,480
our lives so so much easier is this get

544
00:18:56,480 --> 00:18:58,240
file command

545
00:18:58,240 --> 00:19:00,240
so imagine you have seen this little

546
00:19:00,240 --> 00:19:02,880
word document stored on the desktop of

547
00:19:02,880 --> 00:19:04,400
that person

548
00:19:04,400 --> 00:19:06,480
and now you're trying to get it

549
00:19:06,480 --> 00:19:08,320
with these api endpoints you're actually

550
00:19:08,320 --> 00:19:10,880
able to so this is how it works same

551
00:19:10,880 --> 00:19:13,200
thing there's a there's a call

552
00:19:13,200 --> 00:19:15,360
and you yeah you have to name the

553
00:19:15,360 --> 00:19:17,600
precise path of this

554
00:19:17,600 --> 00:19:19,760
file with this double slashes backlashes

555
00:19:19,760 --> 00:19:21,840
it's a bit ugly but yeah you get it done

556
00:19:21,840 --> 00:19:22,720
i guess

557
00:19:22,720 --> 00:19:24,799
and then you kind of wait a bit there's

558
00:19:24,799 --> 00:19:26,240
also an end point where you can look at

559
00:19:26,240 --> 00:19:28,320
the status of that job

560
00:19:28,320 --> 00:19:30,400
and after a while it will be available

561
00:19:30,400 --> 00:19:32,160
for you to download

562
00:19:32,160 --> 00:19:34,640
important here is to always do that

563
00:19:34,640 --> 00:19:36,400
before you run the forensic triage

564
00:19:36,400 --> 00:19:38,720
imaging script because that would yeah

565
00:19:38,720 --> 00:19:40,240
it will trigger the timeout and every

566
00:19:40,240 --> 00:19:42,640
command afterwards won't be executed so

567
00:19:42,640 --> 00:19:44,080
how we do it is usually we have a

568
00:19:44,080 --> 00:19:46,880
dedicated api call that we do to get the

569
00:19:46,880 --> 00:19:48,799
script and then after a few minutes we

570
00:19:48,799 --> 00:19:49,600
get

571
00:19:49,600 --> 00:19:51,360
triage collection because then it safely

572
00:19:51,360 --> 00:19:52,640
runs

573
00:19:52,640 --> 00:19:53,600
um

574
00:19:53,600 --> 00:19:55,600
yeah

575
00:19:55,600 --> 00:19:58,000
exactly

576
00:19:58,000 --> 00:20:00,559
and we have a little demo prepared

577
00:20:00,559 --> 00:20:02,240
where you can see the magic happening as

578
00:20:02,240 --> 00:20:03,520
well

579
00:20:03,520 --> 00:20:07,639
i hope where's my mouse

580
00:20:09,930 --> 00:20:13,229
[Music]

581
00:20:15,520 --> 00:20:18,918
does it work

582
00:20:20,000 --> 00:20:22,320
oh here it works yeah now you see us

583
00:20:22,320 --> 00:20:23,919
doing it oh you want to kind of take

584
00:20:23,919 --> 00:20:26,640
over sorry yeah so um here we decided to

585
00:20:26,640 --> 00:20:29,039
not use the the api we wanted to show

586
00:20:29,039 --> 00:20:30,400
you how it looks like in the in the

587
00:20:30,400 --> 00:20:32,240
microsoft defender console and you can

588
00:20:32,240 --> 00:20:34,400
see that we first browse to a system

589
00:20:34,400 --> 00:20:38,159
that we called for first 2022 demo

590
00:20:38,159 --> 00:20:39,840
and you can see that we initiate a live

591
00:20:39,840 --> 00:20:41,919
response session so this is basically

592
00:20:41,919 --> 00:20:44,640
the the the the live response that you

593
00:20:44,640 --> 00:20:46,080
use to the console that you use to

594
00:20:46,080 --> 00:20:48,480
execute the script and first you see us

595
00:20:48,480 --> 00:20:50,480
executing this this

596
00:20:50,480 --> 00:20:52,320
this stager script

597
00:20:52,320 --> 00:20:54,480
and you see it's the invoke lr

598
00:20:54,480 --> 00:20:57,440
collection ps1 script

599
00:20:57,440 --> 00:21:00,440
so

600
00:21:04,000 --> 00:21:06,240
the

601
00:21:07,440 --> 00:21:09,200
what you can see here is how you run

602
00:21:09,200 --> 00:21:10,880
live response scripts in the defender

603
00:21:10,880 --> 00:21:13,120
console you uh need to use the run

604
00:21:13,120 --> 00:21:15,440
command and you cannot just attach the

605
00:21:15,440 --> 00:21:17,440
parameters like minus case number you

606
00:21:17,440 --> 00:21:20,320
have to use the parameters parameter to

607
00:21:20,320 --> 00:21:21,520
add

608
00:21:21,520 --> 00:21:23,440
any parameters to your script and be

609
00:21:23,440 --> 00:21:25,600
careful it's ill-documented so you have

610
00:21:25,600 --> 00:21:27,440
to play around with it a bit until it

611
00:21:27,440 --> 00:21:30,720
works so better use the api

612
00:21:30,720 --> 00:21:32,320
so this is how it looks if you just run

613
00:21:32,320 --> 00:21:34,400
the run the script from the from the

614
00:21:34,400 --> 00:21:35,679
console

615
00:21:35,679 --> 00:21:38,400
and now you're gonna see how we um how

616
00:21:38,400 --> 00:21:41,919
it looks on the endpoint and um usually

617
00:21:41,919 --> 00:21:43,679
we run this this in involved triage

618
00:21:43,679 --> 00:21:44,720
collection script in the in the

619
00:21:44,720 --> 00:21:46,400
background but we wanted you to see the

620
00:21:46,400 --> 00:21:48,240
output of the script so we manually

621
00:21:48,240 --> 00:21:49,520
triggered it and this is what you would

622
00:21:49,520 --> 00:21:51,200
see if you if you transfer the invoke

623
00:21:51,200 --> 00:21:52,720
live live

624
00:21:52,720 --> 00:21:55,039
invoke triage collection.ps1 to

625
00:21:55,039 --> 00:21:59,320
a host manually and execute it

626
00:21:59,760 --> 00:22:01,760
so the first thing you see is that the

627
00:22:01,760 --> 00:22:05,600
memory is being connected by a search

628
00:22:05,600 --> 00:22:07,840
have a look at the time so we're at 4 15

629
00:22:07,840 --> 00:22:11,000
right now

630
00:22:12,080 --> 00:22:15,039
so memory collection is done the next

631
00:22:15,039 --> 00:22:17,520
step is the cape triage collection so we

632
00:22:17,520 --> 00:22:19,600
first as a refresher we first collect

633
00:22:19,600 --> 00:22:21,600
the artifacts raw artifacts and after

634
00:22:21,600 --> 00:22:23,440
that we encrypt them

635
00:22:23,440 --> 00:22:26,640
so this is cape

636
00:22:26,640 --> 00:22:28,960
and note the error so you we also try to

637
00:22:28,960 --> 00:22:31,039
kind of collect every artifact so even

638
00:22:31,039 --> 00:22:33,280
if it's a windows 10 host we still try

639
00:22:33,280 --> 00:22:35,200
to collect old artifacts that we know of

640
00:22:35,200 --> 00:22:36,799
and if it's not there you will see these

641
00:22:36,799 --> 00:22:38,799
error messages but that's fine

642
00:22:38,799 --> 00:22:39,679
yeah

643
00:22:39,679 --> 00:22:41,760
now you can see that the encryption part

644
00:22:41,760 --> 00:22:44,480
uh started

645
00:22:44,480 --> 00:22:47,120
and now the the loading bar on top this

646
00:22:47,120 --> 00:22:49,280
is the the upload to aws

647
00:22:49,280 --> 00:22:51,760
and so the live response

648
00:22:51,760 --> 00:22:53,360
that the triage artifacts have now been

649
00:22:53,360 --> 00:22:56,320
uploaded and you can see it's 424 so 10

650
00:22:56,320 --> 00:22:58,320
minutes after we triggered the

651
00:22:58,320 --> 00:23:00,159
the

652
00:23:00,159 --> 00:23:02,480
artifact collection we already got the

653
00:23:02,480 --> 00:23:05,440
raw artifacts in the cloud

654
00:23:05,440 --> 00:23:07,039
now the second the same thing happens

655
00:23:07,039 --> 00:23:08,720
for the memory basically so it's first

656
00:23:08,720 --> 00:23:11,600
being encrypted

657
00:23:14,400 --> 00:23:17,360
and it's being uploaded

658
00:23:21,600 --> 00:23:23,919
and you can see 25 minutes later we also

659
00:23:23,919 --> 00:23:26,240
have the the memory in the cloud

660
00:23:26,240 --> 00:23:27,679
processing environment

661
00:23:27,679 --> 00:23:29,360
so how does this look like in the live

662
00:23:29,360 --> 00:23:32,080
response session

663
00:23:34,080 --> 00:23:36,400
not very interesting

664
00:23:36,400 --> 00:23:38,159
and we told you about

665
00:23:38,159 --> 00:23:40,960
the timeout that happens and that's the

666
00:23:40,960 --> 00:23:42,000
reason because we use this staged

667
00:23:42,000 --> 00:23:43,840
approach so we don't we don't get the

668
00:23:43,840 --> 00:23:46,159
output of the script itself um we just

669
00:23:46,159 --> 00:23:47,760
see the see the timeout occurring but

670
00:23:47,760 --> 00:23:49,440
the script continues running even if the

671
00:23:49,440 --> 00:23:51,360
timeout occurs as you see the defender

672
00:23:51,360 --> 00:23:53,039
events also you see that you know it's

673
00:23:53,039 --> 00:23:54,960
7-zip is starting all of that kudu that

674
00:23:54,960 --> 00:23:57,600
happens there so don't worry and you can

675
00:23:57,600 --> 00:24:00,640
also extract the output of the script um

676
00:24:00,640 --> 00:24:01,840
so so

677
00:24:01,840 --> 00:24:04,159
microsoft live response different live

678
00:24:04,159 --> 00:24:05,760
response also has the

679
00:24:05,760 --> 00:24:08,400
some transcript records so basically um

680
00:24:08,400 --> 00:24:09,919
if you execute a script you can just

681
00:24:09,919 --> 00:24:11,520
look at the output later on it's just

682
00:24:11,520 --> 00:24:13,600
being dumped on the file system

683
00:24:13,600 --> 00:24:14,960
and yeah

684
00:24:14,960 --> 00:24:18,080
so um

685
00:24:18,080 --> 00:24:20,320
oops

686
00:24:20,320 --> 00:24:23,679
yeah so now we can summarize what we've

687
00:24:23,679 --> 00:24:25,520
been showing you today

688
00:24:25,520 --> 00:24:28,240
so uh what we showed you today is that

689
00:24:28,240 --> 00:24:29,600
how you can build up a reference

690
00:24:29,600 --> 00:24:31,039
architecture

691
00:24:31,039 --> 00:24:33,919
and how to how you can trigger

692
00:24:33,919 --> 00:24:36,640
the forensic artifact collection via saw

693
00:24:36,640 --> 00:24:39,360
via a api basically

694
00:24:39,360 --> 00:24:40,799
and we also showed you that there is

695
00:24:40,799 --> 00:24:42,799
backup solutions if you don't if you

696
00:24:42,799 --> 00:24:45,520
cannot use the api collection

697
00:24:45,520 --> 00:24:47,200
and we can we've shown you that it just

698
00:24:47,200 --> 00:24:48,640
takes a few minutes to get the first

699
00:24:48,640 --> 00:24:51,279
insights rather than days what it or

700
00:24:51,279 --> 00:24:53,919
hours what it usually takes

701
00:24:53,919 --> 00:24:55,440
then we have a repeatable collection

702
00:24:55,440 --> 00:24:56,720
because we can just execute the same

703
00:24:56,720 --> 00:24:58,240
script again it uses it it collects the

704
00:24:58,240 --> 00:25:00,159
same artifacts again and that's all the

705
00:25:00,159 --> 00:25:02,320
benefit of having cape here where we

706
00:25:02,320 --> 00:25:03,760
define the conflicts of what we want to

707
00:25:03,760 --> 00:25:05,120
collect

708
00:25:05,120 --> 00:25:06,960
we mostly use three tools fitting each

709
00:25:06,960 --> 00:25:09,200
budget cape is free so

710
00:25:09,200 --> 00:25:10,960
that's really good internal exactly if

711
00:25:10,960 --> 00:25:12,240
you use it internally don't use it

712
00:25:12,240 --> 00:25:13,520
externally

713
00:25:13,520 --> 00:25:15,520
service you're going to have to buy a

714
00:25:15,520 --> 00:25:17,679
license yeah exactly

715
00:25:17,679 --> 00:25:18,559
um

716
00:25:18,559 --> 00:25:21,039
and yeah we also showed you that

717
00:25:21,039 --> 00:25:22,400
we can

718
00:25:22,400 --> 00:25:24,000
add the

719
00:25:24,000 --> 00:25:25,919
we can have automatic cloud processing

720
00:25:25,919 --> 00:25:27,360
at scale so we can just add additional

721
00:25:27,360 --> 00:25:30,080
ec2 instances with with other scripts

722
00:25:30,080 --> 00:25:31,840
that are processing the raw artifacts

723
00:25:31,840 --> 00:25:33,279
and one thing that we have to mention

724
00:25:33,279 --> 00:25:34,880
here as well is like the dependencies

725
00:25:34,880 --> 00:25:37,120
are coming with that thing as well so

726
00:25:37,120 --> 00:25:39,440
imagine we had this in the keynote where

727
00:25:39,440 --> 00:25:42,159
contract.net notebook was affected right

728
00:25:42,159 --> 00:25:44,400
so if you use our initial powershell

729
00:25:44,400 --> 00:25:46,320
script yes it's it's there is still the

730
00:25:46,320 --> 00:25:47,760
stupid manual set that i need this

731
00:25:47,760 --> 00:25:49,760
contractor's admin to execute it but

732
00:25:49,760 --> 00:25:51,200
after that it will run into standard

733
00:25:51,200 --> 00:25:52,960
flows from our site which is really

734
00:25:52,960 --> 00:25:54,240
handy

735
00:25:54,240 --> 00:25:55,120
yeah

736
00:25:55,120 --> 00:25:57,919
and of course we're not done yet

737
00:25:57,919 --> 00:26:00,400
we have some future work um one of them

738
00:26:00,400 --> 00:26:02,480
is the open sourcing we wanted to get it

739
00:26:02,480 --> 00:26:04,159
done into the conference unfortunately

740
00:26:04,159 --> 00:26:06,159
we didn't make it through the process

741
00:26:06,159 --> 00:26:08,559
yet but we're working on it

742
00:26:08,559 --> 00:26:09,679
um

743
00:26:09,679 --> 00:26:11,760
the um the other thing is infrastructure

744
00:26:11,760 --> 00:26:14,159
as code um currently um it's manual

745
00:26:14,159 --> 00:26:16,559
setup in the in the in the cloud but um

746
00:26:16,559 --> 00:26:17,919
if we use tools like terraform or

747
00:26:17,919 --> 00:26:19,679
something like that it would make the

748
00:26:19,679 --> 00:26:21,279
deployment much easier you could just

749
00:26:21,279 --> 00:26:22,880
run a terraform script and then you have

750
00:26:22,880 --> 00:26:25,840
the entire aws backend set up for you so

751
00:26:25,840 --> 00:26:27,600
that's something we want to look into

752
00:26:27,600 --> 00:26:29,200
then as we already said

753
00:26:29,200 --> 00:26:31,360
additional processing capabilities

754
00:26:31,360 --> 00:26:33,360
rather than just running eric zimmerman

755
00:26:33,360 --> 00:26:35,440
tools we could also run plazo perhaps we

756
00:26:35,440 --> 00:26:36,960
can put it directly into a time sketch

757
00:26:36,960 --> 00:26:39,360
instance so you can you can already look

758
00:26:39,360 --> 00:26:41,919
at the logs uh without even needing to

759
00:26:41,919 --> 00:26:43,760
look at the um

760
00:26:43,760 --> 00:26:46,159
the processed artifacts itself

761
00:26:46,159 --> 00:26:48,480
and uh yeah then there is yeah in the

762
00:26:48,480 --> 00:26:50,159
api there is also a live response

763
00:26:50,159 --> 00:26:51,760
library api you remember this upload

764
00:26:51,760 --> 00:26:53,120
thing that you saw

765
00:26:53,120 --> 00:26:55,440
that's also triggerable by api and like

766
00:26:55,440 --> 00:26:57,440
the dream of every data privacy lawyer

767
00:26:57,440 --> 00:26:59,360
and everybody out there kind of working

768
00:26:59,360 --> 00:27:00,880
in compliances

769
00:27:00,880 --> 00:27:02,799
now that we know it could kind of

770
00:27:02,799 --> 00:27:04,480
establish a knowledge about like that's

771
00:27:04,480 --> 00:27:07,120
a colombian user and colombian law

772
00:27:07,120 --> 00:27:09,200
doesn't allow us to collect the browser

773
00:27:09,200 --> 00:27:11,679
history so let's not even kind of ship

774
00:27:11,679 --> 00:27:14,640
that part of the code let's create a new

775
00:27:14,640 --> 00:27:16,559
powershell script for that purpose for

776
00:27:16,559 --> 00:27:17,679
that host

777
00:27:17,679 --> 00:27:19,840
ship it archive it into the ticket

778
00:27:19,840 --> 00:27:21,440
because yeah we are compliant and

779
00:27:21,440 --> 00:27:23,520
everything is happy and then afterwards

780
00:27:23,520 --> 00:27:24,799
after that thing is done we just delete

781
00:27:24,799 --> 00:27:26,799
it out of the library again so we like

782
00:27:26,799 --> 00:27:28,159
something like that is also possible

783
00:27:28,159 --> 00:27:29,520
with that thing without having the

784
00:27:29,520 --> 00:27:31,200
analysts to think about it right it's uh

785
00:27:31,200 --> 00:27:33,600
like you establish this country that

786
00:27:33,600 --> 00:27:36,000
legislation that data privacy law we

787
00:27:36,000 --> 00:27:37,440
allow to do this

788
00:27:37,440 --> 00:27:38,960
you don't have to think about it you can

789
00:27:38,960 --> 00:27:42,080
completely automate that

790
00:27:42,080 --> 00:27:46,678
yeah that's basically it from our side

791
00:27:47,900 --> 00:27:56,240
[Applause]

792
00:27:56,240 --> 00:27:58,000
thank you very much for the presentation

793
00:27:58,000 --> 00:28:00,399
chris and lucas

794
00:28:00,399 --> 00:28:02,720
reminder there are two mics four

795
00:28:02,720 --> 00:28:04,720
questions on the left and on the right

796
00:28:04,720 --> 00:28:07,200
so please use these

797
00:28:07,200 --> 00:28:08,240
hello

798
00:28:08,240 --> 00:28:09,279
hi

799
00:28:09,279 --> 00:28:10,880
thanks for the thanks for the

800
00:28:10,880 --> 00:28:13,440
presentation also my side i wanted to

801
00:28:13,440 --> 00:28:15,520
ask a couple of questions actually

802
00:28:15,520 --> 00:28:17,440
um especially if you can elaborate a

803
00:28:17,440 --> 00:28:19,360
little bit more on the

804
00:28:19,360 --> 00:28:21,440
gdpr part so

805
00:28:21,440 --> 00:28:24,080
maybe what you can and cannot do

806
00:28:24,080 --> 00:28:25,679
in the cloud

807
00:28:25,679 --> 00:28:26,559
and

808
00:28:26,559 --> 00:28:29,679
um and i think i had in mind as a second

809
00:28:29,679 --> 00:28:32,640
follow-up question is like okay you were

810
00:28:32,640 --> 00:28:34,640
aiming at it actually at the end of your

811
00:28:34,640 --> 00:28:36,880
presentation so you're a worldwide

812
00:28:36,880 --> 00:28:38,720
company and then you have security teams

813
00:28:38,720 --> 00:28:42,880
maybe in europe and us etc so what does

814
00:28:42,880 --> 00:28:46,480
it change in the process because of this

815
00:28:46,480 --> 00:28:49,039
distribu geographical distribution and

816
00:28:49,039 --> 00:28:51,120
so i guess

817
00:28:51,120 --> 00:28:53,919
gdpr doesn't apply to all the things but

818
00:28:53,919 --> 00:28:56,480
then you have to have like a custom way

819
00:28:56,480 --> 00:28:58,799
to to do the processing and do the

820
00:28:58,799 --> 00:29:01,360
overall incident response for every kind

821
00:29:01,360 --> 00:29:04,960
of situations thanks

822
00:29:04,960 --> 00:29:07,520
yeah that's a tough one so yes um what

823
00:29:07,520 --> 00:29:10,960
actually happens in sap we get a little

824
00:29:10,960 --> 00:29:13,039
sister team consisting of lawyers

825
00:29:13,039 --> 00:29:14,080
actually in

826
00:29:14,080 --> 00:29:15,600
being responsible different parts of the

827
00:29:15,600 --> 00:29:17,760
world that's kind of special because you

828
00:29:17,760 --> 00:29:20,320
also have this customer data within our

829
00:29:20,320 --> 00:29:22,000
data centers and clouds and all of that

830
00:29:22,000 --> 00:29:24,159
so you really like we as a company

831
00:29:24,159 --> 00:29:25,679
really need to understand the data

832
00:29:25,679 --> 00:29:27,760
privacy law even in a little country

833
00:29:27,760 --> 00:29:29,520
where we have one customer we need to be

834
00:29:29,520 --> 00:29:30,720
compliant

835
00:29:30,720 --> 00:29:32,880
so those are working actually with us

836
00:29:32,880 --> 00:29:34,399
and there is ability to kind of loop

837
00:29:34,399 --> 00:29:36,640
them into any incident that we have

838
00:29:36,640 --> 00:29:38,640
instantly they pretty much kind of copy

839
00:29:38,640 --> 00:29:40,880
our workflow they have their own queue

840
00:29:40,880 --> 00:29:42,799
and we can kind of tell them look we've

841
00:29:42,799 --> 00:29:45,120
seen that thing i guess that's a big

842
00:29:45,120 --> 00:29:46,960
deal for you guys right but let's come

843
00:29:46,960 --> 00:29:48,640
in and kind of do your assessment and do

844
00:29:48,640 --> 00:29:50,880
the needful and there's a way to to kind

845
00:29:50,880 --> 00:29:52,080
of do that

846
00:29:52,080 --> 00:29:54,640
so it's like it's always in sap that's a

847
00:29:54,640 --> 00:29:56,480
special thing about sap we always have

848
00:29:56,480 --> 00:29:58,799
to have this gdpr and data privacy in

849
00:29:58,799 --> 00:30:00,080
general

850
00:30:00,080 --> 00:30:02,720
in our endpoints that's a cool thing the

851
00:30:02,720 --> 00:30:05,600
cloud environments are um yes if there

852
00:30:05,600 --> 00:30:07,840
are customers on it it's uh yeah the

853
00:30:07,840 --> 00:30:08,640
same

854
00:30:08,640 --> 00:30:10,640
but if it's a deaf environment there's

855
00:30:10,640 --> 00:30:12,320
no personal data so they are completely

856
00:30:12,320 --> 00:30:14,960
left out of these incidents because

857
00:30:14,960 --> 00:30:16,559
if somebody uploaded something of course

858
00:30:16,559 --> 00:30:18,000
we'll loop them in but that's rarely the

859
00:30:18,000 --> 00:30:19,279
case

860
00:30:19,279 --> 00:30:21,200
so basically we also

861
00:30:21,200 --> 00:30:24,159
after consulting with that team we we

862
00:30:24,159 --> 00:30:26,240
figured out that um it's okay for them

863
00:30:26,240 --> 00:30:27,919
if we collect

864
00:30:27,919 --> 00:30:29,840
the artifact set that we want except the

865
00:30:29,840 --> 00:30:31,200
browser history

866
00:30:31,200 --> 00:30:33,120
all the time without even consulting

867
00:30:33,120 --> 00:30:35,440
them so so we came up with a set that

868
00:30:35,440 --> 00:30:36,799
works

869
00:30:36,799 --> 00:30:38,880
on all machines and if you want

870
00:30:38,880 --> 00:30:40,240
something in addition we usually add a

871
00:30:40,240 --> 00:30:42,640
switch to the script and uh for for

872
00:30:42,640 --> 00:30:44,320
these cases where we need it we just

873
00:30:44,320 --> 00:30:45,840
consult with them ask them is it okay if

874
00:30:45,840 --> 00:30:47,840
we collect it here and then they say

875
00:30:47,840 --> 00:30:49,520
they usually approve it and then we can

876
00:30:49,520 --> 00:30:50,399
look at these

877
00:30:50,399 --> 00:30:51,760
artifacts as well

878
00:30:51,760 --> 00:30:53,840
okay so then if i understand it

879
00:30:53,840 --> 00:30:56,240
correctly there are cases or there might

880
00:30:56,240 --> 00:30:58,799
be cases in which you can actually also

881
00:30:58,799 --> 00:31:01,120
download the browsing history because

882
00:31:01,120 --> 00:31:03,200
gdpr doesn't apply and so on and so

883
00:31:03,200 --> 00:31:04,799
forth okay so

884
00:31:04,799 --> 00:31:07,519
in those cases you are

885
00:31:07,519 --> 00:31:10,000
collecting more information we have a

886
00:31:10,000 --> 00:31:12,080
standard set so to say of these

887
00:31:12,080 --> 00:31:14,000
investigations

888
00:31:14,000 --> 00:31:16,320
i'm sorry that you have to kind that you

889
00:31:16,320 --> 00:31:17,679
that we always want and we need

890
00:31:17,679 --> 00:31:19,039
something additional there's always a

891
00:31:19,039 --> 00:31:21,360
possibility in germany even you know if

892
00:31:21,360 --> 00:31:23,440
there's five fatsukas it meant like if

893
00:31:23,440 --> 00:31:25,440
if there's a real serious danger and you

894
00:31:25,440 --> 00:31:26,640
don't have the time to kind of talk

895
00:31:26,640 --> 00:31:28,480
about it and you need a decision you

896
00:31:28,480 --> 00:31:30,159
need it now there's always the

897
00:31:30,159 --> 00:31:32,080
possibility like technically there's

898
00:31:32,080 --> 00:31:34,320
always a possibility to do it anyway

899
00:31:34,320 --> 00:31:36,480
and that's also according to law right

900
00:31:36,480 --> 00:31:38,399
if like if you need to know because

901
00:31:38,399 --> 00:31:40,640
browser was involved for example

902
00:31:40,640 --> 00:31:41,919
of course you will get it but you need

903
00:31:41,919 --> 00:31:43,360
to have the recent documented right when

904
00:31:43,360 --> 00:31:44,799
somebody comes and asks you why did you

905
00:31:44,799 --> 00:31:48,159
do that you need to have an answer yeah

906
00:31:48,159 --> 00:31:50,480
thanks

907
00:31:54,640 --> 00:31:56,720
no one else well i'm

908
00:31:56,720 --> 00:31:59,440
i do have one small questions my

909
00:31:59,440 --> 00:32:01,279
understanding is that you're working

910
00:32:01,279 --> 00:32:04,880
essentially on aws aren't you

911
00:32:04,880 --> 00:32:07,279
yeah for that part of the of the

912
00:32:07,279 --> 00:32:09,519
yeah just because we it's easier for us

913
00:32:09,519 --> 00:32:11,120
we are kind of you know

914
00:32:11,120 --> 00:32:13,120
you get what you yeah you stick to what

915
00:32:13,120 --> 00:32:15,200
you know but it could also work in azure

916
00:32:15,200 --> 00:32:17,279
of course and google cloud

917
00:32:17,279 --> 00:32:19,440
and the question is do you plan to do

918
00:32:19,440 --> 00:32:20,480
that

919
00:32:20,480 --> 00:32:22,399
actually it's also on our to-do list but

920
00:32:22,399 --> 00:32:25,039
for when we have time

921
00:32:25,039 --> 00:32:26,559
so we have to evaluate actually

922
00:32:26,559 --> 00:32:28,080
especially with this terraform stuff

923
00:32:28,080 --> 00:32:29,919
like maybe we can make it happen in

924
00:32:29,919 --> 00:32:32,399
cloud in google and maybe it's cheaper

925
00:32:32,399 --> 00:32:34,240
so that would be a reason

926
00:32:34,240 --> 00:32:36,640
to move because it's so generic it you

927
00:32:36,640 --> 00:32:39,120
know just replace the hdb calls it

928
00:32:39,120 --> 00:32:43,000
doesn't have to be s3 buckets

929
00:32:44,960 --> 00:32:47,039
any other questions

930
00:32:47,039 --> 00:32:48,320
okay

931
00:32:48,320 --> 00:32:50,720
please remember to fill in the survey

932
00:32:50,720 --> 00:32:52,320
questions

933
00:32:52,320 --> 00:32:53,679
and

934
00:32:53,679 --> 00:32:57,160
thanks one last time to chris and lucas

935
00:32:57,160 --> 00:33:04,400
[Applause]

