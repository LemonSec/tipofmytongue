1
00:00:07,990 --> 00:00:09,860
[Music]

2
00:00:09,860 --> 00:00:13,320
okay let us start

3
00:00:13,320 --> 00:00:18,779
hi I'm rusuke masoka as us

4
00:00:18,779 --> 00:00:22,140
research principle or with Vegeta system

5
00:00:22,140 --> 00:00:25,140
integration levels Laboratories and I'm

6
00:00:25,140 --> 00:00:27,439
sharing this session

7
00:00:27,439 --> 00:00:31,260
this is talk this talk is TLP white

8
00:00:31,260 --> 00:00:33,559
right and

9
00:00:33,559 --> 00:00:38,579
please mute your phone and queue and a

10
00:00:38,579 --> 00:00:42,379
session is after the talk when please

11
00:00:42,379 --> 00:00:46,739
use those standing map over there and

12
00:00:46,739 --> 00:00:48,140
over there

13
00:00:48,140 --> 00:00:51,840
uh so uh the speaker

14
00:00:51,840 --> 00:00:53,640
Eric

15
00:00:53,640 --> 00:00:59,640
gel nice gel mavic okay is a incident

16
00:00:59,640 --> 00:01:02,640
responder and software developer who has

17
00:01:02,640 --> 00:01:04,920
spent most of his career

18
00:01:04,920 --> 00:01:07,619
analyzing Network traffic from malware

19
00:01:07,619 --> 00:01:09,740
and intrusions

20
00:01:09,740 --> 00:01:12,659
he started analyzing a network traffic

21
00:01:12,659 --> 00:01:15,720
from a security perspective while

22
00:01:15,720 --> 00:01:18,420
working at the r and the department

23
00:01:18,420 --> 00:01:22,020
Department of major Energy company

24
00:01:22,020 --> 00:01:27,119
where he focused on scada and Industrial

25
00:01:27,119 --> 00:01:29,280
control system security

26
00:01:29,280 --> 00:01:32,520
Alec has also worked as an incident

27
00:01:32,520 --> 00:01:35,579
responder at the Swedish Armed Forces

28
00:01:35,579 --> 00:01:38,880
third where he got he got he got the

29
00:01:38,880 --> 00:01:42,060
chance to focus even more on network

30
00:01:42,060 --> 00:01:45,240
forensics and network security

31
00:01:45,240 --> 00:01:47,000
monitoring

32
00:01:47,000 --> 00:01:50,540
nowadays Eric runs the company

33
00:01:50,540 --> 00:01:53,939
netrosec where he developed software

34
00:01:53,939 --> 00:01:58,079
such as Network Miner and polar proxy

35
00:01:58,079 --> 00:02:00,719
for Doing Network forensics

36
00:02:00,719 --> 00:02:04,619
and that he's going to talk about the

37
00:02:04,619 --> 00:02:07,979
solar wind supply chain compromise now

38
00:02:07,979 --> 00:02:11,280
the floor is yours Eric

39
00:02:11,280 --> 00:02:14,239
thank you you

40
00:02:14,340 --> 00:02:16,160
thank you

41
00:02:16,160 --> 00:02:20,099
first off buy a show of hands how many

42
00:02:20,099 --> 00:02:22,800
in this room work for a product vendor

43
00:02:22,800 --> 00:02:25,379
company could be software vendor or

44
00:02:25,379 --> 00:02:27,599
Hardware vendor

45
00:02:27,599 --> 00:02:30,679
okay thank you very much

46
00:02:31,760 --> 00:02:36,599
as Ryu said my name is Eric yelnik I run

47
00:02:36,599 --> 00:02:38,280
a company called naturosec where I

48
00:02:38,280 --> 00:02:40,980
develop and sell software to help

49
00:02:40,980 --> 00:02:43,620
internet responders analyze Network

50
00:02:43,620 --> 00:02:46,200
traffic from intrusion and malware

51
00:02:46,200 --> 00:02:48,780
uh some you might be familiar with

52
00:02:48,780 --> 00:02:51,000
network Miner I also developed less

53
00:02:51,000 --> 00:02:52,920
known tools like caploader and polar

54
00:02:52,920 --> 00:02:53,940
proxy

55
00:02:53,940 --> 00:02:56,700
you can find me on Twitter where I tweet

56
00:02:56,700 --> 00:02:58,500
as Network

57
00:02:58,500 --> 00:03:01,379
which is also my company name

58
00:03:01,379 --> 00:03:04,980
but before I start let's play a game

59
00:03:04,980 --> 00:03:07,379
imagine yourself being back at the

60
00:03:07,379 --> 00:03:08,879
office

61
00:03:08,879 --> 00:03:12,480
on Monday morning next week so first

62
00:03:12,480 --> 00:03:13,980
conference is over you're back at your

63
00:03:13,980 --> 00:03:15,720
office

64
00:03:15,720 --> 00:03:17,819
when looking at this picture

65
00:03:17,819 --> 00:03:20,940
I understand if sometimes you say sure

66
00:03:20,940 --> 00:03:23,220
but that's not what my office looks like

67
00:03:23,220 --> 00:03:25,440
uh at least that's what I think when I

68
00:03:25,440 --> 00:03:27,540
see this picture

69
00:03:27,540 --> 00:03:30,060
um so I therefore prepared this

70
00:03:30,060 --> 00:03:32,159
alternative picture to help us messy

71
00:03:32,159 --> 00:03:34,379
people uh imagine ourselves being back

72
00:03:34,379 --> 00:03:35,819
at the office as well

73
00:03:35,819 --> 00:03:38,840
so this is not a picture of my office

74
00:03:38,840 --> 00:03:42,060
but I have to admit I do recognize the

75
00:03:42,060 --> 00:03:44,159
situation where your desk is so crammed

76
00:03:44,159 --> 00:03:45,900
with stuff so like if you're gonna move

77
00:03:45,900 --> 00:03:47,519
your mouth from one side to the other

78
00:03:47,519 --> 00:03:48,959
you have to like stick your hand in

79
00:03:48,959 --> 00:03:50,280
there and like

80
00:03:50,280 --> 00:03:53,939
and eventually you get to where you want

81
00:03:53,939 --> 00:03:56,280
um and anyway sorry about that it's it's

82
00:03:56,280 --> 00:03:58,439
it's Monday morning first conference is

83
00:03:58,439 --> 00:04:01,140
over you're back at your office

84
00:04:01,140 --> 00:04:04,980
and the DNS query for this domain if9

85
00:04:04,980 --> 00:04:07,680
something something gets sent from your

86
00:04:07,680 --> 00:04:09,900
company Network

87
00:04:09,900 --> 00:04:11,760
as you can see it's a randomly looking

88
00:04:11,760 --> 00:04:13,799
domain name

89
00:04:13,799 --> 00:04:16,680
um or it's a random looking sub domain

90
00:04:16,680 --> 00:04:20,940
of the ABS vmcloud.com domain

91
00:04:20,940 --> 00:04:23,400
and my question to you is

92
00:04:23,400 --> 00:04:26,820
will this DNS query trigger any alert or

93
00:04:26,820 --> 00:04:28,680
incident response action in your

94
00:04:28,680 --> 00:04:30,900
organization

95
00:04:30,900 --> 00:04:34,500
well that depends you might answer maybe

96
00:04:34,500 --> 00:04:37,380
it depends on which IP address it this

97
00:04:37,380 --> 00:04:39,600
domain name points to right

98
00:04:39,600 --> 00:04:41,419
so

99
00:04:41,419 --> 00:04:45,320
the query domain name the if91

100
00:04:45,320 --> 00:04:49,139
points to an IP address owned by Amazon

101
00:04:49,139 --> 00:04:52,979
you see this 8.18 IP address

102
00:04:52,979 --> 00:04:55,080
so would it would this have caused an

103
00:04:55,080 --> 00:04:57,360
incident response action

104
00:04:57,360 --> 00:05:00,900
well that depends he might answer again

105
00:05:00,900 --> 00:05:03,180
this time maybe it depends on what the

106
00:05:03,180 --> 00:05:05,460
web traffic looks like to this IP

107
00:05:05,460 --> 00:05:08,880
address after it was resolved right

108
00:05:08,880 --> 00:05:12,000
and to your surprise my answer is that

109
00:05:12,000 --> 00:05:14,940
there is no network traffic at all to

110
00:05:14,940 --> 00:05:16,860
that Amazon IP

111
00:05:16,860 --> 00:05:19,740
all that happened was that the DNS query

112
00:05:19,740 --> 00:05:24,120
is getting sent and a dnsa record is

113
00:05:24,120 --> 00:05:27,479
being received in a responsible and then

114
00:05:27,479 --> 00:05:30,060
nothing more happens that's it

115
00:05:30,060 --> 00:05:31,380
so with this of course an instrument

116
00:05:31,380 --> 00:05:32,759
response action

117
00:05:32,759 --> 00:05:35,520
probably not

118
00:05:35,520 --> 00:05:38,039
um and the query domain name

119
00:05:38,039 --> 00:05:40,680
even looks like something from Amazon's

120
00:05:40,680 --> 00:05:42,960
Cloud hosting

121
00:05:42,960 --> 00:05:45,560
and this slide we have two different

122
00:05:45,560 --> 00:05:48,780
domain names the domain name on your

123
00:05:48,780 --> 00:05:49,680
left

124
00:05:49,680 --> 00:05:51,479
is the one from the previous slide you

125
00:05:51,479 --> 00:05:53,580
see the if9

126
00:05:53,580 --> 00:05:56,940
the the domain name on your right is

127
00:05:56,940 --> 00:06:00,240
used by a legitimate service hosted on

128
00:06:00,240 --> 00:06:01,860
Amazon

129
00:06:01,860 --> 00:06:04,560
both the name names start with a random

130
00:06:04,560 --> 00:06:05,780
looking string

131
00:06:05,780 --> 00:06:10,560
followed by appsync API EU West one and

132
00:06:10,560 --> 00:06:14,039
then either Amazon aws.com or

133
00:06:14,039 --> 00:06:16,800
avsvmcloud.com

134
00:06:16,800 --> 00:06:18,840
so as you can see the domains are

135
00:06:18,840 --> 00:06:22,440
similar but they're not the same

136
00:06:22,440 --> 00:06:25,319
okay but what if two queries get sent so

137
00:06:25,319 --> 00:06:26,940
the first query here is the previous one

138
00:06:26,940 --> 00:06:28,319
the if9

139
00:06:28,319 --> 00:06:31,199
and the second query is for different

140
00:06:31,199 --> 00:06:34,380
random looking subdomain of the abs-v

141
00:06:34,380 --> 00:06:35,880
and Cloud domain

142
00:06:35,880 --> 00:06:38,280
and you can see the IP address in

143
00:06:38,280 --> 00:06:41,039
response for the second query also

144
00:06:41,039 --> 00:06:43,440
points to an IP address at Amazon but a

145
00:06:43,440 --> 00:06:45,780
slightly different IP address

146
00:06:45,780 --> 00:06:47,580
it's not strange to see domain names

147
00:06:47,580 --> 00:06:50,340
pointing to different IPS at Amazon in

148
00:06:50,340 --> 00:06:51,900
fact it's natural for cloud hosting

149
00:06:51,900 --> 00:06:54,599
services to move around or use round

150
00:06:54,599 --> 00:06:57,000
robin DNS to achieve load balancing for

151
00:06:57,000 --> 00:06:59,240
example

152
00:07:00,539 --> 00:07:03,360
and the following three days one query

153
00:07:03,360 --> 00:07:07,740
gets sent per day until July 7. after

154
00:07:07,740 --> 00:07:10,440
which no much no more such queries get

155
00:07:10,440 --> 00:07:11,220
set

156
00:07:11,220 --> 00:07:14,280
note that the last DNS response at the

157
00:07:14,280 --> 00:07:16,740
bottom here 6 e i something

158
00:07:16,740 --> 00:07:19,919
this the response for that one is not an

159
00:07:19,919 --> 00:07:22,680
Amazon IP it's an IP owned by Microsoft

160
00:07:22,680 --> 00:07:23,780
which is

161
00:07:23,780 --> 00:07:26,460
20.140 IP address

162
00:07:26,460 --> 00:07:29,520
that's slightly odd but not alarming

163
00:07:29,520 --> 00:07:31,440
right

164
00:07:31,440 --> 00:07:32,280
um

165
00:07:32,280 --> 00:07:34,560
as you might have guessed by now and

166
00:07:34,560 --> 00:07:38,599
these abs VM Cloud domain names are

167
00:07:38,599 --> 00:07:40,919
related to the backdoor version of

168
00:07:40,919 --> 00:07:43,440
solarwinds Orion that was released two

169
00:07:43,440 --> 00:07:44,520
years ago

170
00:07:44,520 --> 00:07:48,900
uh in fact this exact DNS queries shown

171
00:07:48,900 --> 00:07:51,060
on the slide were actually sent by one

172
00:07:51,060 --> 00:07:53,460
of the victims who had installed the

173
00:07:53,460 --> 00:07:54,960
backdoor software update of

174
00:07:54,960 --> 00:07:56,460
solarwindsorion

175
00:07:56,460 --> 00:07:59,220
so the DNS queries were sent in July

176
00:07:59,220 --> 00:08:03,240
2020 on these dates but in 2020 so not

177
00:08:03,240 --> 00:08:04,620
this year

178
00:08:04,620 --> 00:08:07,560
and after this victim received this DNS

179
00:08:07,560 --> 00:08:10,319
a pointer pointed in Microsoft

180
00:08:10,319 --> 00:08:13,259
and the back door would come become

181
00:08:13,259 --> 00:08:16,160
completely disabled

182
00:08:18,000 --> 00:08:20,639
uh some people claim that this AVS VM

183
00:08:20,639 --> 00:08:23,940
Cloud DNS traffic was the result of a

184
00:08:23,940 --> 00:08:26,940
DGA a domain generation algorithm that's

185
00:08:26,940 --> 00:08:30,780
not correct in fact it was this DNS

186
00:08:30,780 --> 00:08:32,580
traffic was actually used for command

187
00:08:32,580 --> 00:08:35,880
and control over DNS by these threat

188
00:08:35,880 --> 00:08:39,360
actors behind the solar windsack the DNS

189
00:08:39,360 --> 00:08:42,599
C2 domain was active for eight months in

190
00:08:42,599 --> 00:08:44,339
2020 you can see here from February

191
00:08:44,339 --> 00:08:46,800
until October

192
00:08:46,800 --> 00:08:49,320
and during this time backward updates of

193
00:08:49,320 --> 00:08:51,959
solarwindsorion were served to thousands

194
00:08:51,959 --> 00:08:55,140
of victims and I use air quotes around

195
00:08:55,140 --> 00:08:58,140
victims because most of them were not

196
00:08:58,140 --> 00:08:59,580
targeted

197
00:08:59,580 --> 00:09:02,459
all that happened was that they sent a

198
00:09:02,459 --> 00:09:04,500
couple of DNS queries just like in the

199
00:09:04,500 --> 00:09:06,060
example I showed earlier

200
00:09:06,060 --> 00:09:08,399
after that the backdoor typically got

201
00:09:08,399 --> 00:09:09,839
disabled

202
00:09:09,839 --> 00:09:13,019
this AVS VM Cloud DNS queries that I

203
00:09:13,019 --> 00:09:16,320
showed and they in this example they

204
00:09:16,320 --> 00:09:18,240
were transmitted in during four days in

205
00:09:18,240 --> 00:09:20,160
July I tried to mark that on the

206
00:09:20,160 --> 00:09:22,160
timeline using the green box

207
00:09:22,160 --> 00:09:25,440
uh in July that's when this victim was

208
00:09:25,440 --> 00:09:29,120
sending its DNS queries

209
00:09:29,279 --> 00:09:32,760
and after the AVS film cloud

210
00:09:32,760 --> 00:09:34,680
lioness query stopped for this victim

211
00:09:34,680 --> 00:09:37,019
you can see it stopped long before the

212
00:09:37,019 --> 00:09:38,040
command and control domain was

213
00:09:38,040 --> 00:09:40,579
deactivated

214
00:09:40,740 --> 00:09:42,660
the reason it stopped beginning to the

215
00:09:42,660 --> 00:09:44,519
command control domain was because the

216
00:09:44,519 --> 00:09:47,399
attackers chose to disable the back door

217
00:09:47,399 --> 00:09:51,080
they made an active decision

218
00:09:52,380 --> 00:09:56,220
in fact something like 99 of the victims

219
00:09:56,220 --> 00:09:59,519
got their back door disabled by the

220
00:09:59,519 --> 00:10:01,079
attackers so only one percent were

221
00:10:01,079 --> 00:10:03,720
targeted with a second stage backdoor

222
00:10:03,720 --> 00:10:05,220
and more on that later

223
00:10:05,220 --> 00:10:09,060
anyway uh eventually in December 2020 so

224
00:10:09,060 --> 00:10:10,680
that's two months after the command

225
00:10:10,680 --> 00:10:13,079
control domain was deactivated mandiant

226
00:10:13,079 --> 00:10:15,740
or fire as they were called at the time

227
00:10:15,740 --> 00:10:17,880
announced that they had been hacked

228
00:10:17,880 --> 00:10:20,100
through a supply chain attack

229
00:10:20,100 --> 00:10:22,740
and this means that they were one of the

230
00:10:22,740 --> 00:10:25,200
few victims who actually were targeted

231
00:10:25,200 --> 00:10:27,720
and thereby got follow-on activity after

232
00:10:27,720 --> 00:10:30,000
having installed this trojanized version

233
00:10:30,000 --> 00:10:33,240
of the solarwinds update

234
00:10:33,240 --> 00:10:35,459
and mandiant is one of the best

235
00:10:35,459 --> 00:10:37,019
instrument response companies in the

236
00:10:37,019 --> 00:10:37,860
world

237
00:10:37,860 --> 00:10:39,660
uh The Chronic control domain had

238
00:10:39,660 --> 00:10:41,399
already been closed down when they

239
00:10:41,399 --> 00:10:43,500
discovered intuition but they still

240
00:10:43,500 --> 00:10:45,620
somehow managed to trace the infection

241
00:10:45,620 --> 00:10:48,240
and back to solar wind since Orion

242
00:10:48,240 --> 00:10:50,760
installation and figure out that it had

243
00:10:50,760 --> 00:10:54,560
installed a trojanized software update

244
00:10:55,320 --> 00:10:57,480
so here's a philosophical question for

245
00:10:57,480 --> 00:10:59,100
you

246
00:10:59,100 --> 00:11:02,459
had Manion not been targeted

247
00:11:02,459 --> 00:11:04,860
would we even know about the solarwinds

248
00:11:04,860 --> 00:11:06,839
back door

249
00:11:06,839 --> 00:11:10,399
my guess is probably not

250
00:11:12,120 --> 00:11:13,800
after the solarwind breach was

251
00:11:13,800 --> 00:11:16,800
discovered in December 2020 I spent way

252
00:11:16,800 --> 00:11:18,480
too much time trying to reverse engineer

253
00:11:18,480 --> 00:11:19,920
the code in the malicious software

254
00:11:19,920 --> 00:11:20,820
update

255
00:11:20,820 --> 00:11:22,920
in particular I looked at the code code

256
00:11:22,920 --> 00:11:25,260
that caused this these strange DNS

257
00:11:25,260 --> 00:11:27,720
queries so that's I focused on just that

258
00:11:27,720 --> 00:11:28,980
little part

259
00:11:28,980 --> 00:11:31,860
and that's the Reversed this DNS command

260
00:11:31,860 --> 00:11:34,500
control protocol I also built a tool

261
00:11:34,500 --> 00:11:37,800
called Sunburst domain decoder which

262
00:11:37,800 --> 00:11:40,220
decodes the DNS queries

263
00:11:40,220 --> 00:11:42,920
as I I will explain soon

264
00:11:42,920 --> 00:11:46,200
this code my decoder is available for

265
00:11:46,200 --> 00:11:47,880
download if you just

266
00:11:47,880 --> 00:11:50,760
through this QR link you can get both

267
00:11:50,760 --> 00:11:52,440
the source code and the compile version

268
00:11:52,440 --> 00:11:54,300
of it

269
00:11:54,300 --> 00:11:57,240
so let me just walk through in this

270
00:11:57,240 --> 00:11:59,339
example is if9 domain name how it's

271
00:11:59,339 --> 00:12:01,019
decoded

272
00:12:01,019 --> 00:12:03,420
um actually it's only the orange part

273
00:12:03,420 --> 00:12:05,880
that's of Interest so the the rest of

274
00:12:05,880 --> 00:12:07,320
the domain name is there's no

275
00:12:07,320 --> 00:12:09,180
information contained in there so we

276
00:12:09,180 --> 00:12:11,279
only need to parse the orange part and I

277
00:12:11,279 --> 00:12:13,200
split it into different sections so the

278
00:12:13,200 --> 00:12:17,839
first section here decodes into

279
00:12:17,839 --> 00:12:20,579
this first part of that string is an xor

280
00:12:20,579 --> 00:12:22,680
key so it's a one byte xrp that's used

281
00:12:22,680 --> 00:12:24,720
to X or encrypt the rest of this message

282
00:12:24,720 --> 00:12:27,720
and then a victim ID which is unique for

283
00:12:27,720 --> 00:12:30,120
each installation of this backdoor so

284
00:12:30,120 --> 00:12:32,639
that the attackers could see where these

285
00:12:32,639 --> 00:12:34,079
queries are coming from

286
00:12:34,079 --> 00:12:36,660
and then there's a w which in this case

287
00:12:36,660 --> 00:12:40,019
the codes into segment number zero which

288
00:12:40,019 --> 00:12:41,820
means that this is the first message

289
00:12:41,820 --> 00:12:45,480
from this particular victim

290
00:12:45,480 --> 00:12:49,139
and then comes two hrs26

291
00:12:49,139 --> 00:12:51,899
which decodes into o something something

292
00:12:51,899 --> 00:12:55,320
and mask that and then finally od12 eu1

293
00:12:55,320 --> 00:12:58,019
which decodes into dot local and this

294
00:12:58,019 --> 00:12:59,760
owes something something not local

295
00:12:59,760 --> 00:13:02,639
that's the internal actor active

296
00:13:02,639 --> 00:13:05,100
directory domain name of this victim so

297
00:13:05,100 --> 00:13:07,320
the ad domain of this victim is being

298
00:13:07,320 --> 00:13:08,700
said so some companies use the Republic

299
00:13:08,700 --> 00:13:11,399
DNS like something.com as the active

300
00:13:11,399 --> 00:13:14,220
directory domain name some use.local so

301
00:13:14,220 --> 00:13:17,579
but typically these domain names

302
00:13:17,579 --> 00:13:19,980
um can you know have the company name in

303
00:13:19,980 --> 00:13:21,540
them somehow

304
00:13:21,540 --> 00:13:23,100
so

305
00:13:23,100 --> 00:13:25,500
uh yeah and I censored after the active

306
00:13:25,500 --> 00:13:27,600
director name here for that reason so

307
00:13:27,600 --> 00:13:29,579
that we shouldn't be able to identify

308
00:13:29,579 --> 00:13:31,860
the victim here but if of course if you

309
00:13:31,860 --> 00:13:34,380
run this domain name through my software

310
00:13:34,380 --> 00:13:36,540
or through my tool you'll actually get

311
00:13:36,540 --> 00:13:38,279
the full internal active directory

312
00:13:38,279 --> 00:13:40,199
domain name for this victim

313
00:13:40,199 --> 00:13:42,420
this meant that it was not possible to

314
00:13:42,420 --> 00:13:45,720
identify who had installed the malicious

315
00:13:45,720 --> 00:13:48,480
solarwinds Orion update just by looking

316
00:13:48,480 --> 00:13:50,220
at DNS queries

317
00:13:50,220 --> 00:13:53,220
for this AVS VM Cloud domain so we

318
00:13:53,220 --> 00:13:55,500
didn't have to see which IP address this

319
00:13:55,500 --> 00:13:58,560
queries come from because we had the the

320
00:13:58,560 --> 00:14:00,180
internal active directory domain name

321
00:14:00,180 --> 00:14:04,160
like in the DNS query itself

322
00:14:05,040 --> 00:14:07,620
I also discovered that this was a full

323
00:14:07,620 --> 00:14:09,600
two-way communication command and

324
00:14:09,600 --> 00:14:11,940
control protocol so it was not just a

325
00:14:11,940 --> 00:14:14,519
victim that exfiltrated data to the

326
00:14:14,519 --> 00:14:18,180
attackers the DNS responses that's the

327
00:14:18,180 --> 00:14:21,060
IP address in this case controlled what

328
00:14:21,060 --> 00:14:23,279
the victims should do next

329
00:14:23,279 --> 00:14:25,680
uh most victims were up on the left

330
00:14:25,680 --> 00:14:28,680
there that says send DNS beacons

331
00:14:28,680 --> 00:14:31,019
so they were sending DNS beacons getting

332
00:14:31,019 --> 00:14:33,600
one of these blue replies in this case

333
00:14:33,600 --> 00:14:36,899
the victim got this 8.18 Amazon reply

334
00:14:36,899 --> 00:14:39,480
which means continue beaconing

335
00:14:39,480 --> 00:14:40,980
and the victim must continue beginning

336
00:14:40,980 --> 00:14:43,079
for a while until eventually it's really

337
00:14:43,079 --> 00:14:45,240
one of these Reds responses which means

338
00:14:45,240 --> 00:14:47,639
stop and the victim in this case was the

339
00:14:47,639 --> 00:14:50,160
first one the 2140 which is a Microsoft

340
00:14:50,160 --> 00:14:51,120
IP

341
00:14:51,120 --> 00:14:53,519
and this is what happened to 99 of the

342
00:14:53,519 --> 00:14:54,899
victims we're spinning around a few

343
00:14:54,899 --> 00:14:56,519
times and sending Dina speakers and

344
00:14:56,519 --> 00:14:59,220
eventually stopping

345
00:14:59,220 --> 00:15:01,800
uh and these were stopped because the

346
00:15:01,800 --> 00:15:03,660
attackers choose that they decided that

347
00:15:03,660 --> 00:15:05,880
we're not interested in this victim so

348
00:15:05,880 --> 00:15:07,079
we're just going to disable our back

349
00:15:07,079 --> 00:15:09,300
door our foothold that we have in that

350
00:15:09,300 --> 00:15:11,779
organization

351
00:15:12,000 --> 00:15:12,959
um

352
00:15:12,959 --> 00:15:14,880
and only something like one percent of

353
00:15:14,880 --> 00:15:17,639
the victims receive the DNS response

354
00:15:17,639 --> 00:15:20,040
with an IP address in one of these green

355
00:15:20,040 --> 00:15:22,980
light ranges which means Target so they

356
00:15:22,980 --> 00:15:25,380
want to Target that victim and after

357
00:15:25,380 --> 00:15:28,500
that the victim or the back door ended

358
00:15:28,500 --> 00:15:30,899
up in a different state where you know

359
00:15:30,899 --> 00:15:33,300
down here that says receive command

360
00:15:33,300 --> 00:15:35,880
control domain in cname so at this point

361
00:15:35,880 --> 00:15:38,519
the back door was a was open to

362
00:15:38,519 --> 00:15:40,139
receiving not an IP address as a

363
00:15:40,139 --> 00:15:42,480
response but the C name in the DNS

364
00:15:42,480 --> 00:15:45,720
response and with the new I a new domain

365
00:15:45,720 --> 00:15:48,660
name if if the victim was in that state

366
00:15:48,660 --> 00:15:52,620
received a new cname record it would

367
00:15:52,620 --> 00:15:54,420
actually connect to that to a new domain

368
00:15:54,420 --> 00:15:57,660
using https with a much more advanced

369
00:15:57,660 --> 00:15:59,699
backdoor that could do a lot of more

370
00:15:59,699 --> 00:16:01,920
evil stuff than this DNS backdoor could

371
00:16:01,920 --> 00:16:02,639
do

372
00:16:02,639 --> 00:16:05,220
however in my analysis I primarily focus

373
00:16:05,220 --> 00:16:08,660
on the DNS part of the back door

374
00:16:09,240 --> 00:16:11,639
so let's code these five DNS command

375
00:16:11,639 --> 00:16:13,440
control messages from this victim in our

376
00:16:13,440 --> 00:16:16,199
example this victim so notice that this

377
00:16:16,199 --> 00:16:17,820
victim was left in a continued state for

378
00:16:17,820 --> 00:16:19,279
a couple of days

379
00:16:19,279 --> 00:16:22,259
so let's see here when it started with

380
00:16:22,259 --> 00:16:25,320
this if9 domain name which decodes into

381
00:16:25,320 --> 00:16:27,839
actor director domain or something from

382
00:16:27,839 --> 00:16:30,060
something that local the command control

383
00:16:30,060 --> 00:16:32,699
server which which was the authority of

384
00:16:32,699 --> 00:16:34,880
DNS server in this case responded with

385
00:16:34,880 --> 00:16:38,820
this Amazon IP but you can see the last

386
00:16:38,820 --> 00:16:42,060
octet there 139 that actually decodes

387
00:16:42,060 --> 00:16:45,120
into sleep timer so I told the victim go

388
00:16:45,120 --> 00:16:47,579
sleep for one hour then continue

389
00:16:47,579 --> 00:16:50,100
beginning so the victim slept for on one

390
00:16:50,100 --> 00:16:52,019
hour then continue beginning with the

391
00:16:52,019 --> 00:16:54,500
second H requester

392
00:16:54,500 --> 00:16:57,480
which says by the way I'm running the

393
00:16:57,480 --> 00:16:59,399
these are in the installed antivirus

394
00:16:59,399 --> 00:17:01,019
products I'm using so it says I'm

395
00:17:01,019 --> 00:17:03,480
running carbon black and it sends the

396
00:17:03,480 --> 00:17:07,260
current time as well with the timestamp

397
00:17:07,260 --> 00:17:09,480
um this time the the command control

398
00:17:09,480 --> 00:17:11,819
server says now you sleep for one day

399
00:17:11,819 --> 00:17:14,699
but continue beginning so the victim

400
00:17:14,699 --> 00:17:17,099
would continue beginning but after one

401
00:17:17,099 --> 00:17:19,020
day it had already said this is what the

402
00:17:19,020 --> 00:17:21,000
only thing the DNS backdoor could do he

403
00:17:21,000 --> 00:17:23,880
could send domain name and install

404
00:17:23,880 --> 00:17:26,579
antivirus products that's it so it had

405
00:17:26,579 --> 00:17:28,919
already sent everything it had so by now

406
00:17:28,919 --> 00:17:30,780
we're just sending what I call a pain

407
00:17:30,780 --> 00:17:33,179
command and the Ping command all it

408
00:17:33,179 --> 00:17:34,919
contained was a timestamp so it says

409
00:17:34,919 --> 00:17:36,660
here's the current time

410
00:17:36,660 --> 00:17:38,160
I don't know why it's sent the times

411
00:17:38,160 --> 00:17:40,919
there but it did

412
00:17:40,919 --> 00:17:42,000
um

413
00:17:42,000 --> 00:17:44,400
and then it continued so for a couple of

414
00:17:44,400 --> 00:17:47,600
days until eventually it sends this 6e1

415
00:17:47,600 --> 00:17:50,280
and query which was also a ping command

416
00:17:50,280 --> 00:17:52,679
but at this time the attackers see that

417
00:17:52,679 --> 00:17:54,240
oh we're not interested in this company

418
00:17:54,240 --> 00:17:56,640
called oh something some something who

419
00:17:56,640 --> 00:17:58,140
are running carbon black so we'll just

420
00:17:58,140 --> 00:17:59,880
disable our back door we have in that

421
00:17:59,880 --> 00:18:01,500
organization and respond with this

422
00:18:01,500 --> 00:18:05,299
Microsoft IP and that's it

423
00:18:05,720 --> 00:18:09,140
so notice

424
00:18:09,360 --> 00:18:11,580
um this victim sent these so-called ping

425
00:18:11,580 --> 00:18:13,200
packets which for some reason contained

426
00:18:13,200 --> 00:18:15,539
a time stamp so maybe the timestamp was

427
00:18:15,539 --> 00:18:17,880
there to protect against replay attacks

428
00:18:17,880 --> 00:18:19,799
in the command and control protocol or

429
00:18:19,799 --> 00:18:21,360
maybe something else I actually don't

430
00:18:21,360 --> 00:18:22,679
know

431
00:18:22,679 --> 00:18:24,900
as I mentioned before the DNS queries

432
00:18:24,900 --> 00:18:26,820
could be used to identify which

433
00:18:26,820 --> 00:18:29,400
companies or organizations who had

434
00:18:29,400 --> 00:18:31,500
installed the trojanized solarwinds

435
00:18:31,500 --> 00:18:34,280
Orion updates

436
00:18:35,160 --> 00:18:37,200
it turned out that there were several

437
00:18:37,200 --> 00:18:39,059
people who had access to passive DNS

438
00:18:39,059 --> 00:18:40,740
queries that have been sent to This

439
00:18:40,740 --> 00:18:44,640
abs-vm Cloud domain these persons helped

440
00:18:44,640 --> 00:18:46,440
share such DNS queries so that victim

441
00:18:46,440 --> 00:18:49,200
organizations could be identified and

442
00:18:49,200 --> 00:18:52,380
notified so I would like to thank Joe

443
00:18:52,380 --> 00:18:56,280
John Paul Danko Rohit and someone called

444
00:18:56,280 --> 00:19:01,200
kiratul Ado whoever you are the

445
00:19:01,500 --> 00:19:04,260
so the DNS queries could be used to tell

446
00:19:04,260 --> 00:19:06,480
who had installed the backward software

447
00:19:06,480 --> 00:19:09,240
updates and the DNS responses the IP

448
00:19:09,240 --> 00:19:10,940
addresses

449
00:19:10,940 --> 00:19:13,919
could be used to tell who had been

450
00:19:13,919 --> 00:19:17,580
targeted right but the passive DNS data

451
00:19:17,580 --> 00:19:19,620
shared by these persons primarily

452
00:19:19,620 --> 00:19:22,679
included the DNS queries not the

453
00:19:22,679 --> 00:19:23,880
responses

454
00:19:23,880 --> 00:19:25,799
so how could we determine which

455
00:19:25,799 --> 00:19:27,660
organizations had been targeted so that

456
00:19:27,660 --> 00:19:30,440
they could be notified

457
00:19:30,780 --> 00:19:33,299
after digging even deeper into the DNS

458
00:19:33,299 --> 00:19:35,220
command control protocol I discovered

459
00:19:35,220 --> 00:19:38,480
there was a single one bit flag

460
00:19:38,480 --> 00:19:41,760
encoded into the DNS pin queries you

461
00:19:41,760 --> 00:19:43,740
know the ones with just a timestamp

462
00:19:43,740 --> 00:19:46,380
uh so this is what these pink queries

463
00:19:46,380 --> 00:19:47,880
looks like first is there is there's

464
00:19:47,880 --> 00:19:50,100
this eight or this eight bits or one

465
00:19:50,100 --> 00:19:52,679
byte xrp then there's the victim ID

466
00:19:52,679 --> 00:19:55,500
telling the attackers who they are

467
00:19:55,500 --> 00:19:57,480
and then there are four bytes which are

468
00:19:57,480 --> 00:19:59,100
typically always in at least in a

469
00:19:59,100 --> 00:20:01,620
traffic I observes zero zero one and

470
00:20:01,620 --> 00:20:04,980
then finally there's a 19 bit time stamp

471
00:20:04,980 --> 00:20:06,140
field

472
00:20:06,140 --> 00:20:09,000
and by the end there there's a single

473
00:20:09,000 --> 00:20:10,740
bit that I didn't first understand what

474
00:20:10,740 --> 00:20:12,840
it was it took me a time some time then

475
00:20:12,840 --> 00:20:15,419
finally I realized that's a flag it's

476
00:20:15,419 --> 00:20:17,880
get set when it makes them receives one

477
00:20:17,880 --> 00:20:20,460
of these Target IP address it sets this

478
00:20:20,460 --> 00:20:23,400
flag uh in the in the subsequent ping

479
00:20:23,400 --> 00:20:24,299
packets

480
00:20:24,299 --> 00:20:26,820
uh and so that's a way for the victim to

481
00:20:26,820 --> 00:20:28,740
say I am not tell the command controls

482
00:20:28,740 --> 00:20:30,659
are I am now ready to receive a c name

483
00:20:30,659 --> 00:20:32,280
as a pointer instead of just an IP

484
00:20:32,280 --> 00:20:36,120
address to move on with HTTP traffic

485
00:20:36,120 --> 00:20:38,820
um so with this knowledge I was now able

486
00:20:38,820 --> 00:20:41,039
to decode which victims who had been

487
00:20:41,039 --> 00:20:43,620
targeted by the threat actors only by

488
00:20:43,620 --> 00:20:46,260
looking at the DNS queries I didn't need

489
00:20:46,260 --> 00:20:48,720
the responses

490
00:20:48,720 --> 00:20:50,159
um

491
00:20:50,159 --> 00:20:51,960
so one thing I noticed what does the

492
00:20:51,960 --> 00:20:54,960
backward update had been installed by

493
00:20:54,960 --> 00:20:56,960
lots of big corporations

494
00:20:56,960 --> 00:20:59,460
Banks all around the world

495
00:20:59,460 --> 00:21:01,140
but the threat factors seem to be

496
00:21:01,140 --> 00:21:03,059
interested primarily in American Tech

497
00:21:03,059 --> 00:21:05,900
and telecom companies

498
00:21:05,900 --> 00:21:09,299
U.S government agencies and European

499
00:21:09,299 --> 00:21:12,440
Union agencies

500
00:21:12,900 --> 00:21:14,640
this also seems to be in line with what

501
00:21:14,640 --> 00:21:16,320
Microsoft reported about this threat

502
00:21:16,320 --> 00:21:19,220
actor they refer to them as snowbellium

503
00:21:19,220 --> 00:21:24,840
other know them as apt-29 or Cozy Bear

504
00:21:24,840 --> 00:21:27,600
also a bonus find which I haven't

505
00:21:27,600 --> 00:21:29,460
actually mentioned before and you see

506
00:21:29,460 --> 00:21:32,460
the 19-bit timestamp field here

507
00:21:32,460 --> 00:21:33,360
um

508
00:21:33,360 --> 00:21:36,500
the code used to generate that timestamp

509
00:21:36,500 --> 00:21:38,460
looks like this

510
00:21:38,460 --> 00:21:41,820
this is C Sharp code what it does is it

511
00:21:41,820 --> 00:21:44,640
converts the current time into a number

512
00:21:44,640 --> 00:21:46,559
and the number is the number of 13

513
00:21:46,559 --> 00:21:49,320
minutes intervals that I've passed since

514
00:21:49,320 --> 00:21:53,280
January 1st 2010.

515
00:21:53,400 --> 00:21:56,100
one thing so that means that the timer

516
00:21:56,100 --> 00:21:58,559
solution is 30 minutes the minimum time

517
00:21:58,559 --> 00:22:01,020
step that will be transmitted is January

518
00:22:01,020 --> 00:22:03,600
1st 2010 of course and the maximum

519
00:22:03,600 --> 00:22:05,700
timestamp since it's a 19-bit field

520
00:22:05,700 --> 00:22:08,360
would be December 4

521
00:22:08,360 --> 00:22:11,700
2039 so it's like way ahead into the

522
00:22:11,700 --> 00:22:12,600
future

523
00:22:12,600 --> 00:22:14,220
and one thing that bugged me is that the

524
00:22:14,220 --> 00:22:16,280
DNS common control to this AVS VM Cloud

525
00:22:16,280 --> 00:22:19,559
was only active for eight months during

526
00:22:19,559 --> 00:22:21,059
2020.

527
00:22:21,059 --> 00:22:23,760
why didn't they start the time span from

528
00:22:23,760 --> 00:22:26,520
2020 or maybe 2019.

529
00:22:26,520 --> 00:22:28,860
if they wanted a round number they could

530
00:22:28,860 --> 00:22:31,080
have started from 2000 it would still be

531
00:22:31,080 --> 00:22:32,340
enough

532
00:22:32,340 --> 00:22:35,280
so this is actually bugging me a bit so

533
00:22:35,280 --> 00:22:38,640
maybe maybe the protocol has been used

534
00:22:38,640 --> 00:22:40,500
before

535
00:22:40,500 --> 00:22:42,419
maybe the solar winds weren't the first

536
00:22:42,419 --> 00:22:44,400
victim to have their software backdoor

537
00:22:44,400 --> 00:22:46,200
by this threat actor

538
00:22:46,200 --> 00:22:49,200
I don't know that of course but it's a

539
00:22:49,200 --> 00:22:50,640
it's an interesting thought

540
00:22:50,640 --> 00:22:53,100
and if this DNS clinical control

541
00:22:53,100 --> 00:22:55,380
protocol actually has been used before

542
00:22:55,380 --> 00:22:58,919
then I would guess that one reason that

543
00:22:58,919 --> 00:23:01,559
they weren't detected back then is

544
00:23:01,559 --> 00:23:03,000
probably because they didn't choose to

545
00:23:03,000 --> 00:23:05,700
Target manual in that campaign

546
00:23:05,700 --> 00:23:08,100
but this time they did and they were

547
00:23:08,100 --> 00:23:10,639
discovered

548
00:23:12,780 --> 00:23:14,700
it's very difficult to defend against

549
00:23:14,700 --> 00:23:17,280
supply chain attacks so I have no silver

550
00:23:17,280 --> 00:23:19,860
bullets for Defenders

551
00:23:19,860 --> 00:23:22,440
so sorry about that uh like the first

552
00:23:22,440 --> 00:23:24,600
bullet here uh

553
00:23:24,600 --> 00:23:26,400
since you know you've got that covered

554
00:23:26,400 --> 00:23:27,840
because your members of first so you

555
00:23:27,840 --> 00:23:30,600
probably have a cert or cert or sock

556
00:23:30,600 --> 00:23:34,320
right so good so apart from that like

557
00:23:34,320 --> 00:23:36,659
do the old same old boring stuff as

558
00:23:36,659 --> 00:23:38,100
you're already doing right you're

559
00:23:38,100 --> 00:23:40,799
probably on a good on a on a good path

560
00:23:40,799 --> 00:23:44,580
but generally I'd say fewer systems and

561
00:23:44,580 --> 00:23:47,840
Trust keyword systems just fewer vendors

562
00:23:47,840 --> 00:23:50,340
and I also want to stress this final

563
00:23:50,340 --> 00:23:51,440
point

564
00:23:51,440 --> 00:23:56,100
monitor so and this hack was revealed in

565
00:23:56,100 --> 00:23:58,260
December 2020

566
00:23:58,260 --> 00:24:00,720
and that was several months after this

567
00:24:00,720 --> 00:24:01,980
command control domain had been

568
00:24:01,980 --> 00:24:04,740
deactivated and very few organizations

569
00:24:04,740 --> 00:24:07,200
were actually able to tell if they had

570
00:24:07,200 --> 00:24:09,480
sent DNS queries for this avsd and Cloud

571
00:24:09,480 --> 00:24:10,980
domain

572
00:24:10,980 --> 00:24:13,320
in this case just a passive simple

573
00:24:13,320 --> 00:24:15,779
passive DNS log of outgoing queries

574
00:24:15,779 --> 00:24:18,000
would be enough to tell if they had

575
00:24:18,000 --> 00:24:19,919
installed the trojanized solarwinds

576
00:24:19,919 --> 00:24:20,880
update

577
00:24:20,880 --> 00:24:22,919
but also to tell if they had been

578
00:24:22,919 --> 00:24:25,460
targeted

579
00:24:25,799 --> 00:24:28,640
and to vendors all your vendors are

580
00:24:28,640 --> 00:24:31,740
reached up to Iran in the beginning my

581
00:24:31,740 --> 00:24:35,659
advice to you is don't get hacked

582
00:24:35,659 --> 00:24:38,400
it really sucks when vendors get hacked

583
00:24:38,400 --> 00:24:41,159
and attackers get free back doors inside

584
00:24:41,159 --> 00:24:44,700
the networks uh of the customers of that

585
00:24:44,700 --> 00:24:45,900
vendor

586
00:24:45,900 --> 00:24:48,900
and for vendors to not get hacked just

587
00:24:48,900 --> 00:24:51,299
do the same old boring stuff as on the

588
00:24:51,299 --> 00:24:53,520
previous slide

589
00:24:53,520 --> 00:24:54,419
um

590
00:24:54,419 --> 00:24:56,039
but I've actually got more advice to

591
00:24:56,039 --> 00:24:57,779
vendors and I'm a vendor company myself

592
00:24:57,779 --> 00:24:59,580
I'm running a vendor company so this is

593
00:24:59,580 --> 00:25:02,400
for me as well and what happens to solar

594
00:25:02,400 --> 00:25:03,260
wind

595
00:25:03,260 --> 00:25:05,760
that this thing can happen to any

596
00:25:05,760 --> 00:25:07,799
software company

597
00:25:07,799 --> 00:25:09,960
so my second advice to vendors is eat

598
00:25:09,960 --> 00:25:12,659
your own dog food which basically means

599
00:25:12,659 --> 00:25:14,580
that vendors should use their own

600
00:25:14,580 --> 00:25:15,720
products

601
00:25:15,720 --> 00:25:18,480
and dog fooding as it's called it's a

602
00:25:18,480 --> 00:25:20,460
great way to improve product quality in

603
00:25:20,460 --> 00:25:22,500
security since it's puts the vendor into

604
00:25:22,500 --> 00:25:25,640
the shoes of the customer

605
00:25:25,740 --> 00:25:28,200
and my third advice is here delivered by

606
00:25:28,200 --> 00:25:32,039
Vanilla Ice it's to stop building

607
00:25:32,039 --> 00:25:34,860
complex solutions that require admin or

608
00:25:34,860 --> 00:25:37,020
root privileges or unconstrained

609
00:25:37,020 --> 00:25:39,840
internet access instead collaborate with

610
00:25:39,840 --> 00:25:42,720
your customers and let them know how

611
00:25:42,720 --> 00:25:44,400
your product can be integrated into

612
00:25:44,400 --> 00:25:48,120
their CM or EDR or and what internet

613
00:25:48,120 --> 00:25:50,760
resources your product needs to access

614
00:25:50,760 --> 00:25:53,100
so that they can limit like outbound

615
00:25:53,100 --> 00:25:54,419
traffic

616
00:25:54,419 --> 00:25:57,000
and finally listen to your customer

617
00:25:57,000 --> 00:25:58,140
requests

618
00:25:58,140 --> 00:26:00,000
your customers probably know more than

619
00:26:00,000 --> 00:26:02,340
you about how to deploy your products in

620
00:26:02,340 --> 00:26:04,080
their environments in a secure Manner

621
00:26:04,080 --> 00:26:06,600
and the end goal here is to enable

622
00:26:06,600 --> 00:26:08,940
customers to verify that your product

623
00:26:08,940 --> 00:26:11,940
has not been back toward and to minimize

624
00:26:11,940 --> 00:26:14,640
the consequences if it would ever get

625
00:26:14,640 --> 00:26:17,240
back toward

626
00:26:18,720 --> 00:26:20,880
I was originally planning to present my

627
00:26:20,880 --> 00:26:23,340
vendor advice like this but I realized

628
00:26:23,340 --> 00:26:25,200
that all these texts would probably just

629
00:26:25,200 --> 00:26:27,059
make you fall asleep since this is the

630
00:26:27,059 --> 00:26:28,559
last talk for today

631
00:26:28,559 --> 00:26:30,960
so let's just pretend you never saw the

632
00:26:30,960 --> 00:26:33,419
slide and instead let's move on to the

633
00:26:33,419 --> 00:26:36,020
summary so in summary

634
00:26:36,020 --> 00:26:39,360
the solar windsorion back door was a

635
00:26:39,360 --> 00:26:40,980
it's used dns-based command control

636
00:26:40,980 --> 00:26:42,120
protocol

637
00:26:42,120 --> 00:26:44,460
the DNS traffic was designed to blend in

638
00:26:44,460 --> 00:26:46,500
with normal traffic

639
00:26:46,500 --> 00:26:49,080
and the threat actor had picked targets

640
00:26:49,080 --> 00:26:51,679
from a huge pool of victims

641
00:26:51,679 --> 00:26:54,720
and the ones they didn't hand pick were

642
00:26:54,720 --> 00:26:57,380
disabled so that you know to

643
00:26:57,380 --> 00:27:00,960
decrease the likelihood of them becoming

644
00:27:00,960 --> 00:27:02,460
detected of course

645
00:27:02,460 --> 00:27:04,980
and these victims and Target victims

646
00:27:04,980 --> 00:27:06,960
could be identified just using passive

647
00:27:06,960 --> 00:27:08,880
DNS

648
00:27:08,880 --> 00:27:11,940
and vendors please don't get hacked eat

649
00:27:11,940 --> 00:27:14,760
your own dog food and stop collaborate

650
00:27:14,760 --> 00:27:17,659
and listen to your customers

651
00:27:17,659 --> 00:27:19,559
and finally

652
00:27:19,559 --> 00:27:21,120
um by the way I

653
00:27:21,120 --> 00:27:22,799
I have so much more technical

654
00:27:22,799 --> 00:27:24,960
information I would like to share but

655
00:27:24,960 --> 00:27:27,600
this is not the right medium so but I've

656
00:27:27,600 --> 00:27:30,360
written a lot of technical blog posts on

657
00:27:30,360 --> 00:27:33,179
this topic so on this link on the right

658
00:27:33,179 --> 00:27:36,779
here you can find all my blog posts on

659
00:27:36,779 --> 00:27:39,120
this topic as I actually wrote this

660
00:27:39,120 --> 00:27:40,980
decoder and I was really into the

661
00:27:40,980 --> 00:27:42,899
protocol now I've sort of this is a year

662
00:27:42,899 --> 00:27:44,520
and a half ago so I've probably

663
00:27:44,520 --> 00:27:46,860
forgotten most of the details that in

664
00:27:46,860 --> 00:27:49,399
the blog post

665
00:27:49,559 --> 00:27:52,260
um yeah that's it so um I'll be happy to

666
00:27:52,260 --> 00:27:55,460
take any questions you might have

667
00:27:57,840 --> 00:27:59,159
wow

668
00:27:59,159 --> 00:28:01,740
I have heard a lot about the solar winds

669
00:28:01,740 --> 00:28:05,039
thing but I never got this deep dive

670
00:28:05,039 --> 00:28:06,720
thank you

671
00:28:06,720 --> 00:28:10,940
um any questions or you are ready

672
00:28:11,059 --> 00:28:14,700
soon uh on the uh

673
00:28:14,700 --> 00:28:20,100
the uh this I would say victim type bit

674
00:28:20,100 --> 00:28:22,559
that you described there

675
00:28:22,559 --> 00:28:25,980
targeted yeah what they're targeted bit

676
00:28:25,980 --> 00:28:29,039
yeah I mean if you go back in the in the

677
00:28:29,039 --> 00:28:32,640
slides you had this uh go go go go in

678
00:28:32,640 --> 00:28:34,980
the uh

679
00:28:34,980 --> 00:28:37,440
here oh okay okay

680
00:28:37,440 --> 00:28:38,700
so

681
00:28:38,700 --> 00:28:41,820
how did that

682
00:28:41,820 --> 00:28:44,880
targeted flag be set

683
00:28:44,880 --> 00:28:48,299
so this was yes okay one moment if I'll

684
00:28:48,299 --> 00:28:50,279
skip back

685
00:28:50,279 --> 00:28:53,220
until here when the victim received one

686
00:28:53,220 --> 00:28:54,720
of these green replies that says

687
00:28:54,720 --> 00:28:57,480
targeted and the victim receives the

688
00:28:57,480 --> 00:28:59,820
proceeds down to the States the second

689
00:28:59,820 --> 00:29:01,200
stage here so it started out in

690
00:29:01,200 --> 00:29:03,059
ascending as Beacon State and then

691
00:29:03,059 --> 00:29:05,039
transceed into this receive command

692
00:29:05,039 --> 00:29:07,440
control domain State when it was in this

693
00:29:07,440 --> 00:29:09,659
state every time it sent a ping command

694
00:29:09,659 --> 00:29:13,140
it will have this flag set

695
00:29:13,140 --> 00:29:15,240
Urban query that's when this flag was

696
00:29:15,240 --> 00:29:18,179
set and that means and I am now ready to

697
00:29:18,179 --> 00:29:20,760
receive a cname as a response and that

698
00:29:20,760 --> 00:29:23,039
was said by the attacker during this

699
00:29:23,039 --> 00:29:25,200
ping process the attacker said it by

700
00:29:25,200 --> 00:29:27,480
just sending a dnsa record in any of

701
00:29:27,480 --> 00:29:29,720
these green sending any of these green

702
00:29:29,720 --> 00:29:32,880
one of these is uh government one of

703
00:29:32,880 --> 00:29:37,140
this is no I have no idea maybe but it

704
00:29:37,140 --> 00:29:38,820
doesn't have to be they could reply with

705
00:29:38,820 --> 00:29:40,799
any of these the the flag would be set

706
00:29:40,799 --> 00:29:42,419
regardless of which

707
00:29:42,419 --> 00:29:44,840
okay

708
00:29:46,440 --> 00:29:50,700
uh hi Martin Island from mnemonic I have

709
00:29:50,700 --> 00:29:52,799
I was also kind of fascinated by this

710
00:29:52,799 --> 00:29:56,460
January 1st 2010 start of the timestamp

711
00:29:56,460 --> 00:29:58,620
have you tried digging into historical

712
00:29:58,620 --> 00:30:00,679
pdms sorry

713
00:30:00,679 --> 00:30:04,580
have you tried uh analyzing historical

714
00:30:04,580 --> 00:30:07,679
perianus records to see if you can

715
00:30:07,679 --> 00:30:13,380
identify any prior use of that protocol

716
00:30:13,380 --> 00:30:17,760
so far I haven't seen that but but of

717
00:30:17,760 --> 00:30:19,440
course no no I haven't done that I

718
00:30:19,440 --> 00:30:21,000
actually the thought has crossed my mind

719
00:30:21,000 --> 00:30:23,700
too I realized and then we need to look

720
00:30:23,700 --> 00:30:25,440
for this protocol but probably for other

721
00:30:25,440 --> 00:30:27,779
domain names right other main domains so

722
00:30:27,779 --> 00:30:30,360
uh that would be an interesting way

723
00:30:30,360 --> 00:30:33,779
thing to do so um but I haven't done

724
00:30:33,779 --> 00:30:35,580
that and they might have used a

725
00:30:35,580 --> 00:30:37,860
different like store key as well but as

726
00:30:37,860 --> 00:30:40,020
a first pass if you only look at the

727
00:30:40,020 --> 00:30:44,100
first part of the subdomain yeah and you

728
00:30:44,100 --> 00:30:47,100
try with the xor key that you observed

729
00:30:47,100 --> 00:30:49,320
from Soul ruins

730
00:30:49,320 --> 00:30:51,720
it yeah it would be possible actually to

731
00:30:51,720 --> 00:30:54,120
just give it a bunch of domain names see

732
00:30:54,120 --> 00:30:56,279
which ones are possible to decode with

733
00:30:56,279 --> 00:30:58,320
this decoder you would get some false

734
00:30:58,320 --> 00:31:00,600
positives of course but what if you end

735
00:31:00,600 --> 00:31:02,580
up with one domain where like we get

736
00:31:02,580 --> 00:31:04,559
lots of domains which actually are able

737
00:31:04,559 --> 00:31:06,779
to we're able to parse then that would

738
00:31:06,779 --> 00:31:08,460
mean that we would have found a previous

739
00:31:08,460 --> 00:31:13,200
domain name so I exact same idea is what

740
00:31:13,200 --> 00:31:15,360
I've had I haven't done that so if

741
00:31:15,360 --> 00:31:18,000
anyone is interested uh my source code

742
00:31:18,000 --> 00:31:20,760
for my decoder is there feel free to use

743
00:31:20,760 --> 00:31:22,679
it if you have any questions please ask

744
00:31:22,679 --> 00:31:24,840
me but you have to have a lot of passive

745
00:31:24,840 --> 00:31:27,299
DNS I don't have a lot of passive DNS so

746
00:31:27,299 --> 00:31:29,399
that's my issue I can write a code but I

747
00:31:29,399 --> 00:31:32,600
don't have you have the data

748
00:31:32,700 --> 00:31:35,659
cool let's talk

749
00:31:35,659 --> 00:31:38,840
thank you

750
00:31:40,620 --> 00:31:43,969
[Applause]

751
00:31:44,340 --> 00:31:47,100
and the group of people that you got the

752
00:31:47,100 --> 00:31:50,039
passively in the state has a truckload

753
00:31:50,039 --> 00:31:52,140
of passive DNS data

754
00:31:52,140 --> 00:31:55,200
so just send send a bit of advice to

755
00:31:55,200 --> 00:31:58,500
them they might do some runs yeah thank

756
00:31:58,500 --> 00:32:01,039
you good advice

757
00:32:02,940 --> 00:32:08,120
hey any other questions oh yeah

758
00:32:09,059 --> 00:32:11,640
hello hello

759
00:32:11,640 --> 00:32:14,580
um so I'm just what do you think

760
00:32:14,580 --> 00:32:16,559
um because you you say that if they

761
00:32:16,559 --> 00:32:18,840
hadn't targeted or

762
00:32:18,840 --> 00:32:23,519
targeted mandiant but would man yet have

763
00:32:23,519 --> 00:32:26,700
seen this if the attackers hadn't gotten

764
00:32:26,700 --> 00:32:29,880
greedy and started stealing tools

765
00:32:29,880 --> 00:32:33,179
I don't know I actually don't I I have

766
00:32:33,179 --> 00:32:36,240
no inside information from Aliens of how

767
00:32:36,240 --> 00:32:38,519
what part of the attack actually caused

768
00:32:38,519 --> 00:32:40,860
them to detect us or like how they

769
00:32:40,860 --> 00:32:43,500
detected it in the first place so a good

770
00:32:43,500 --> 00:32:45,720
interesting question I mean if you mean

771
00:32:45,720 --> 00:32:47,039
if maybe they could have targeted them

772
00:32:47,039 --> 00:32:50,100
but do it a bit more like not as

773
00:32:50,100 --> 00:32:52,019
aggressive because maybe the attackers

774
00:32:52,019 --> 00:32:53,700
got more aggressive over time and

775
00:32:53,700 --> 00:32:55,140
eventually they were detected so maybe

776
00:32:55,140 --> 00:32:57,480
they were overconfident or maybe they

777
00:32:57,480 --> 00:32:58,919
didn't care that they were detected

778
00:32:58,919 --> 00:33:01,080
that's like they already had enough

779
00:33:01,080 --> 00:33:03,059
systems or the information they needed

780
00:33:03,059 --> 00:33:06,299
and maybe like they didn't need to stay

781
00:33:06,299 --> 00:33:08,399
quiet anymore I don't know and just

782
00:33:08,399 --> 00:33:10,980
theories on so I actually don't know

783
00:33:10,980 --> 00:33:13,019
more than you guys do but good question

784
00:33:13,019 --> 00:33:15,980
Margo thank you

785
00:33:16,980 --> 00:33:17,580
um

786
00:33:17,580 --> 00:33:19,980
any other question

787
00:33:19,980 --> 00:33:23,940
okay uh let us thank the speaker again

788
00:33:23,940 --> 00:33:26,940
[Applause]

789
00:33:26,940 --> 00:33:30,299
uh please take your time to fill the

790
00:33:30,299 --> 00:33:33,779
survey and submit it in your mobile app

791
00:33:33,779 --> 00:33:40,080
and this is the last uh talk today so um

792
00:33:40,080 --> 00:33:44,399
good day good night bye

793
00:33:44,399 --> 00:33:48,320
Captain stickers come here

794
00:33:49,260 --> 00:33:53,120
thank you thank you

