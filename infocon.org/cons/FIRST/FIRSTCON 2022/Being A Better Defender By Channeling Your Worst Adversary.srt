1
00:00:05,870 --> 00:00:07,839
[Music]

2
00:00:07,839 --> 00:00:10,480
good afternoon once again

3
00:00:10,480 --> 00:00:13,200
welcome to the second afternoon session

4
00:00:13,200 --> 00:00:16,480
and welcome to john stoner from cisco

5
00:00:16,480 --> 00:00:17,760
who will

6
00:00:17,760 --> 00:00:19,840
tell us about how we can be better

7
00:00:19,840 --> 00:00:22,080
defenders by channeling our worst

8
00:00:22,080 --> 00:00:23,519
adversary

9
00:00:23,519 --> 00:00:25,920
adversary

10
00:00:25,920 --> 00:00:27,519
you can pronounce it

11
00:00:27,519 --> 00:00:29,760
thanks

12
00:00:29,760 --> 00:00:31,199
all right good afternoon thanks for

13
00:00:31,199 --> 00:00:32,238
coming

14
00:00:32,238 --> 00:00:34,399
uh

15
00:00:34,399 --> 00:00:36,239
here's me happy to talk about any of

16
00:00:36,239 --> 00:00:37,920
these topics afterwards including the

17
00:00:37,920 --> 00:00:40,640
one at the very very bottom so um

18
00:00:40,640 --> 00:00:42,480
happy to have those conversations i'm

19
00:00:42,480 --> 00:00:43,760
gonna dive straight into this because

20
00:00:43,760 --> 00:00:45,200
obviously we have

21
00:00:45,200 --> 00:00:48,000
you know 35 minutes give or take

22
00:00:48,000 --> 00:00:49,760
so in those next 35 minutes we're going

23
00:00:49,760 --> 00:00:51,120
to talk about a couple different things

24
00:00:51,120 --> 00:00:52,320
we're going to talk about why we want to

25
00:00:52,320 --> 00:00:54,160
emulate the adversary going to kind of

26
00:00:54,160 --> 00:00:55,760
share some of the process that i've kind

27
00:00:55,760 --> 00:00:57,760
of gone through as i've evolved this and

28
00:00:57,760 --> 00:00:59,520
then provide the lessons learned talk

29
00:00:59,520 --> 00:01:00,879
about some of the scars that we've had

30
00:01:00,879 --> 00:01:02,640
some of the successes we've had and so

31
00:01:02,640 --> 00:01:03,760
forth

32
00:01:03,760 --> 00:01:05,119
now

33
00:01:05,119 --> 00:01:06,880
as we're talking about adversary

34
00:01:06,880 --> 00:01:08,640
emulation there's a number of different

35
00:01:08,640 --> 00:01:10,479
ways that you can do this and there's a

36
00:01:10,479 --> 00:01:11,439
number of different things that you

37
00:01:11,439 --> 00:01:13,200
might want to accomplish depending upon

38
00:01:13,200 --> 00:01:15,600
your focus i'm going to kind of set the

39
00:01:15,600 --> 00:01:17,759
scene here that the thing that we were

40
00:01:17,759 --> 00:01:20,400
trying to focus on was detection

41
00:01:20,400 --> 00:01:22,000
right you could do

42
00:01:22,000 --> 00:01:24,159
emulation prevention response forensics

43
00:01:24,159 --> 00:01:25,680
in fact we did a little bit of that in

44
00:01:25,680 --> 00:01:28,000
here and there over multiple years but

45
00:01:28,000 --> 00:01:29,360
the premise of this is going to be

46
00:01:29,360 --> 00:01:31,040
really around detection and you may be

47
00:01:31,040 --> 00:01:33,759
wondering why

48
00:01:33,759 --> 00:01:35,759
from our perspective

49
00:01:35,759 --> 00:01:37,280
what we were focused on was we were

50
00:01:37,280 --> 00:01:40,159
focusing on identifying the blind spots

51
00:01:40,159 --> 00:01:43,119
that you might have in your enterprise

52
00:01:43,119 --> 00:01:44,079
right

53
00:01:44,079 --> 00:01:46,479
if i can eliminate those blind spots

54
00:01:46,479 --> 00:01:49,520
right i could hunt for those things if i

55
00:01:49,520 --> 00:01:51,360
can hunt for those things hopefully i

56
00:01:51,360 --> 00:01:53,920
can evolve those things into detections

57
00:01:53,920 --> 00:01:55,200
that my

58
00:01:55,200 --> 00:01:58,159
operations teams my socks my sims can go

59
00:01:58,159 --> 00:02:00,079
ahead and detect on

60
00:02:00,079 --> 00:02:01,520
that's kind of the premise around what

61
00:02:01,520 --> 00:02:03,119
we're working on for those who were in

62
00:02:03,119 --> 00:02:05,520
joe's threat hunting talk the day before

63
00:02:05,520 --> 00:02:07,119
we talked about not wanting to hunt over

64
00:02:07,119 --> 00:02:09,038
and over and over for the same things we

65
00:02:09,038 --> 00:02:10,318
want to be able to go ahead and build a

66
00:02:10,318 --> 00:02:13,920
repeatable process where possible

67
00:02:14,080 --> 00:02:15,520
the other part of this i want to kind of

68
00:02:15,520 --> 00:02:17,040
set the stage around was the adversary

69
00:02:17,040 --> 00:02:19,120
development piece now

70
00:02:19,120 --> 00:02:21,280
number of different ways that you can

71
00:02:21,280 --> 00:02:23,200
emulate the adversary

72
00:02:23,200 --> 00:02:24,480
number of different personas that you

73
00:02:24,480 --> 00:02:26,319
can go ahead and work with inside our

74
00:02:26,319 --> 00:02:28,239
nation state cyber crime choose your

75
00:02:28,239 --> 00:02:30,239
favor the focus that i'm going to take

76
00:02:30,239 --> 00:02:32,319
with this is talking about nation state

77
00:02:32,319 --> 00:02:33,599
and that was kind of where this is

78
00:02:33,599 --> 00:02:35,280
coming from now again

79
00:02:35,280 --> 00:02:36,640
if that's not the threat model that

80
00:02:36,640 --> 00:02:38,560
you're focused on utilize some of these

81
00:02:38,560 --> 00:02:41,680
different other personas no problem

82
00:02:41,680 --> 00:02:44,959
so where do we start well

83
00:02:44,959 --> 00:02:47,040
we started off with a nation state that

84
00:02:47,040 --> 00:02:49,680
will remain unnamed but we focused on a

85
00:02:49,680 --> 00:02:51,599
couple of basic ttps we talked about

86
00:02:51,599 --> 00:02:53,120
spear fishing as being a good place to

87
00:02:53,120 --> 00:02:54,480
start as we were kind of getting our

88
00:02:54,480 --> 00:02:56,239
feet wet with this

89
00:02:56,239 --> 00:02:59,440
powershell empire was a tool that we saw

90
00:02:59,440 --> 00:03:01,599
and had noted that this adversary had

91
00:03:01,599 --> 00:03:03,519
been utilizing and we thought that would

92
00:03:03,519 --> 00:03:05,200
be a good thing to go ahead and utilize

93
00:03:05,200 --> 00:03:07,280
and go ahead and practice on and utilize

94
00:03:07,280 --> 00:03:08,800
the modules that were in powershell

95
00:03:08,800 --> 00:03:10,239
empire

96
00:03:10,239 --> 00:03:12,000
as we gained a little bit more maturity

97
00:03:12,000 --> 00:03:14,319
on this we said well that's great we've

98
00:03:14,319 --> 00:03:16,319
got window systems out there they're

99
00:03:16,319 --> 00:03:18,720
logging to sysmon but there's also linux

100
00:03:18,720 --> 00:03:20,879
servers out there right

101
00:03:20,879 --> 00:03:23,200
there's struts vulnerabilities out there

102
00:03:23,200 --> 00:03:25,599
how do we monitor for

103
00:03:25,599 --> 00:03:29,280
uh linux visibility how about osquery

104
00:03:29,280 --> 00:03:30,799
so we went ahead and started pulling in

105
00:03:30,799 --> 00:03:32,879
os query data and we went ahead and

106
00:03:32,879 --> 00:03:34,959
started pulling those pieces together

107
00:03:34,959 --> 00:03:37,040
and start creating visibility into our

108
00:03:37,040 --> 00:03:38,959
windows information our linux

109
00:03:38,959 --> 00:03:41,920
information and so forth now

110
00:03:41,920 --> 00:03:44,640
about that same time we had users that

111
00:03:44,640 --> 00:03:46,560
were moving more stuff to

112
00:03:46,560 --> 00:03:49,360
the cloud that's my cloud there

113
00:03:49,360 --> 00:03:50,879
the uh

114
00:03:50,879 --> 00:03:52,640
the clouds we focused on we focused on

115
00:03:52,640 --> 00:03:54,239
amazon initially we focused on azure

116
00:03:54,239 --> 00:03:57,040
initially we moved into gcp over time

117
00:03:57,040 --> 00:03:58,480
and we started looking at the different

118
00:03:58,480 --> 00:04:01,519
products that were out there

119
00:04:01,519 --> 00:04:03,200
the products that we started focusing on

120
00:04:03,200 --> 00:04:04,560
were the things that people were moving

121
00:04:04,560 --> 00:04:06,000
their workloads to initially right

122
00:04:06,000 --> 00:04:08,480
compute and storage

123
00:04:08,480 --> 00:04:09,760
so we wanted to start ahead and start

124
00:04:09,760 --> 00:04:11,360
dipping our toes into those things what

125
00:04:11,360 --> 00:04:13,599
else do we look at well we also started

126
00:04:13,599 --> 00:04:16,639
having folks moving to 365

127
00:04:16,639 --> 00:04:18,000
right and they started moving their

128
00:04:18,000 --> 00:04:19,519
sharepoint there and they started moving

129
00:04:19,519 --> 00:04:21,519
their exchange there and so we started

130
00:04:21,519 --> 00:04:22,960
kind of saying well what can we see from

131
00:04:22,960 --> 00:04:24,800
those different spots

132
00:04:24,800 --> 00:04:26,080
um

133
00:04:26,080 --> 00:04:28,320
two days ago a met was talking about

134
00:04:28,320 --> 00:04:30,080
cloud ir and talked about the need to be

135
00:04:30,080 --> 00:04:31,199
able to see

136
00:04:31,199 --> 00:04:33,199
uh and get visibility into those cloud

137
00:04:33,199 --> 00:04:35,360
instance this is an opportunity that we

138
00:04:35,360 --> 00:04:36,639
use to go ahead and start kind of

139
00:04:36,639 --> 00:04:38,160
getting visibility into what kind of

140
00:04:38,160 --> 00:04:39,919
logging fidelity do i have in these

141
00:04:39,919 --> 00:04:42,160
clouds by emulating our adversary going

142
00:04:42,160 --> 00:04:45,600
ahead and attacking those clouds

143
00:04:46,240 --> 00:04:48,560
now as we move forward we spent a couple

144
00:04:48,560 --> 00:04:50,400
years doing this specific nation state

145
00:04:50,400 --> 00:04:52,160
adversary and we decided it was time to

146
00:04:52,160 --> 00:04:53,600
go ahead and try a new one and i kind of

147
00:04:53,600 --> 00:04:54,960
took this on as

148
00:04:54,960 --> 00:04:56,720
a kind of a wider responsibility and so

149
00:04:56,720 --> 00:04:58,320
i sat down and i started kind of racking

150
00:04:58,320 --> 00:05:00,240
my brain and said okay i've got a nation

151
00:05:00,240 --> 00:05:02,800
state adversary in mind

152
00:05:02,800 --> 00:05:04,160
but what can i come up with what would

153
00:05:04,160 --> 00:05:05,440
be some interesting things what would be

154
00:05:05,440 --> 00:05:06,720
some different things that we could kind

155
00:05:06,720 --> 00:05:07,919
of talk about

156
00:05:07,919 --> 00:05:09,360
so i started sitting down and i broke

157
00:05:09,360 --> 00:05:11,039
out my thread intel reports and i came

158
00:05:11,039 --> 00:05:12,560
across a mandiant report it was quite

159
00:05:12,560 --> 00:05:15,039
good um i moved over to a microsoft

160
00:05:15,039 --> 00:05:16,639
report and microsoft was kind enough to

161
00:05:16,639 --> 00:05:17,680
put this

162
00:05:17,680 --> 00:05:20,479
uh specific uh picture in that threat

163
00:05:20,479 --> 00:05:22,560
report and so i started looking at it

164
00:05:22,560 --> 00:05:25,120
i'm like okay we got this email and we

165
00:05:25,120 --> 00:05:28,320
got this uh link file and we open the

166
00:05:28,320 --> 00:05:30,880
link file and the actual pdf opens but

167
00:05:30,880 --> 00:05:32,720
then we also go ahead and spawn off some

168
00:05:32,720 --> 00:05:34,880
powershell and we download some cobalt

169
00:05:34,880 --> 00:05:37,199
strike and good times ensue and it was

170
00:05:37,199 --> 00:05:39,280
kind of like ah this would be an

171
00:05:39,280 --> 00:05:42,000
interesting one to go ahead and take on

172
00:05:42,000 --> 00:05:44,639
so we sat down kind of started forming

173
00:05:44,639 --> 00:05:47,440
this out started building and uh and

174
00:05:47,440 --> 00:05:48,960
started working through this uh

175
00:05:48,960 --> 00:05:50,400
emulation and and building this

176
00:05:50,400 --> 00:05:52,240
emulation

177
00:05:52,240 --> 00:05:53,600
i'm not going to spend much time on this

178
00:05:53,600 --> 00:05:55,600
everybody's heard attack this week but

179
00:05:55,600 --> 00:05:56,960
one of the things that we saw at the

180
00:05:56,960 --> 00:05:58,639
same time is obviously attack is getting

181
00:05:58,639 --> 00:06:00,880
more and more of a ground swell so i

182
00:06:00,880 --> 00:06:02,479
started kind of utilizing that as kind

183
00:06:02,479 --> 00:06:03,520
of the palette that we were going to

184
00:06:03,520 --> 00:06:05,520
work with

185
00:06:05,520 --> 00:06:06,800
the reason i did that was to be able

186
00:06:06,800 --> 00:06:09,199
that taxonomy the taxonomy of the common

187
00:06:09,199 --> 00:06:10,240
um

188
00:06:10,240 --> 00:06:11,360
common

189
00:06:11,360 --> 00:06:12,319
uh

190
00:06:12,319 --> 00:06:13,600
way that different people within

191
00:06:13,600 --> 00:06:15,840
threaded threat and ir security ops

192
00:06:15,840 --> 00:06:18,080
threat intelligence can speak

193
00:06:18,080 --> 00:06:20,000
so what i did with this was took the

194
00:06:20,000 --> 00:06:21,280
adversary that we had it was kind of a

195
00:06:21,280 --> 00:06:23,280
combined adversary from the nation state

196
00:06:23,280 --> 00:06:24,880
and put this together and this was my

197
00:06:24,880 --> 00:06:26,560
palette okay and this is a little bit

198
00:06:26,560 --> 00:06:28,080
older obviously because this has gotten

199
00:06:28,080 --> 00:06:29,600
expanded and there's some techniques out

200
00:06:29,600 --> 00:06:31,759
there as well but the idea here was this

201
00:06:31,759 --> 00:06:33,520
was kind of my starting point and i said

202
00:06:33,520 --> 00:06:34,400
okay

203
00:06:34,400 --> 00:06:35,600
these are the kinds of things that if

204
00:06:35,600 --> 00:06:36,960
i'm going to build my emulation i want

205
00:06:36,960 --> 00:06:39,520
to go ahead and start utilizing these

206
00:06:39,520 --> 00:06:40,560
now

207
00:06:40,560 --> 00:06:42,160
the other thing i want to do is i want

208
00:06:42,160 --> 00:06:43,680
to go ahead and build something like a

209
00:06:43,680 --> 00:06:44,800
diamond model and again i'm not going to

210
00:06:44,800 --> 00:06:46,800
talk about what the diamond model is but

211
00:06:46,800 --> 00:06:48,400
it was very very helpful

212
00:06:48,400 --> 00:06:50,000
particularly when we got to the part of

213
00:06:50,000 --> 00:06:52,639
point of delivery of this to our analyst

214
00:06:52,639 --> 00:06:54,000
to give them something like a diamond

215
00:06:54,000 --> 00:06:55,680
model to give them context around the

216
00:06:55,680 --> 00:06:57,280
things that we were going to talk about

217
00:06:57,280 --> 00:07:00,080
the danger sometimes is if you provide a

218
00:07:00,080 --> 00:07:01,199
very very high level piece of

219
00:07:01,199 --> 00:07:03,039
information to the analyst and say go at

220
00:07:03,039 --> 00:07:04,160
it they don't necessarily have the

221
00:07:04,160 --> 00:07:05,440
additional context so we found the

222
00:07:05,440 --> 00:07:06,560
diamond model was a good way to

223
00:07:06,560 --> 00:07:08,240
contextualize that what did we

224
00:07:08,240 --> 00:07:10,240
contextualize that with well

225
00:07:10,240 --> 00:07:11,599
first thing we did was go ahead and

226
00:07:11,599 --> 00:07:13,440
identify goals everybody's got to have

227
00:07:13,440 --> 00:07:16,479
goals right so the goals in my

228
00:07:16,479 --> 00:07:18,400
estimation are kind of like if i do

229
00:07:18,400 --> 00:07:20,560
nothing else in this emulation if i

230
00:07:20,560 --> 00:07:21,840
can't see anything else in this

231
00:07:21,840 --> 00:07:23,840
emulation here are the five things that

232
00:07:23,840 --> 00:07:26,000
i want to be able to exercise

233
00:07:26,000 --> 00:07:27,840
right so i wanted to exercise that spear

234
00:07:27,840 --> 00:07:29,199
phishing link

235
00:07:29,199 --> 00:07:31,759
i wanted to do domain fronting

236
00:07:31,759 --> 00:07:33,440
accessibility features

237
00:07:33,440 --> 00:07:34,960
pass the ticket with some golden ticket

238
00:07:34,960 --> 00:07:37,919
and my objective is the ntds.dit file

239
00:07:37,919 --> 00:07:38,720
okay

240
00:07:38,720 --> 00:07:40,720
with domain fronting in terms of reading

241
00:07:40,720 --> 00:07:42,840
some of the miter attack techniques

242
00:07:42,840 --> 00:07:45,520
um things in there we're talking about

243
00:07:45,520 --> 00:07:48,800
using a meek a tor meek plug-in to go

244
00:07:48,800 --> 00:07:50,319
ahead and with the tour exit node and

245
00:07:50,319 --> 00:07:53,199
i'm like wow that's really really cool

246
00:07:53,199 --> 00:07:54,560
but

247
00:07:54,560 --> 00:07:57,039
let's maybe expose our blue teamers to

248
00:07:57,039 --> 00:07:59,039
something else to kind of you know dip

249
00:07:59,039 --> 00:08:00,319
their feet into this let's go ahead and

250
00:08:00,319 --> 00:08:02,160
just do some domain fronting maybe our

251
00:08:02,160 --> 00:08:04,240
adversary isn't quite that elite and

252
00:08:04,240 --> 00:08:05,680
they're going to go ahead and do domain

253
00:08:05,680 --> 00:08:07,440
fronting so that's kind of new and

254
00:08:07,440 --> 00:08:09,360
introduce that concept but maybe not go

255
00:08:09,360 --> 00:08:12,000
down the tour exit road uh exit node

256
00:08:12,000 --> 00:08:14,639
route okay so again we'll come back to

257
00:08:14,639 --> 00:08:16,240
that talking about calibrating a little

258
00:08:16,240 --> 00:08:17,599
bit there as you go

259
00:08:17,599 --> 00:08:19,599
pixel accessibility features pass the

260
00:08:19,599 --> 00:08:21,919
ticket okay

261
00:08:21,919 --> 00:08:23,520
now first thing i did was i ran into

262
00:08:23,520 --> 00:08:26,879
some challenges at that point in time

263
00:08:26,879 --> 00:08:29,280
cobalt strike was not available for sale

264
00:08:29,280 --> 00:08:30,720
to me

265
00:08:30,720 --> 00:08:32,479
or my team

266
00:08:32,479 --> 00:08:33,839
we weren't going to use the cracked

267
00:08:33,839 --> 00:08:35,519
version that seemed like a really bad

268
00:08:35,519 --> 00:08:37,839
idea

269
00:08:37,839 --> 00:08:40,159
and we had just spent the past two years

270
00:08:40,159 --> 00:08:42,159
using powershell empire and exercising

271
00:08:42,159 --> 00:08:43,919
that so i'm not going to go back to that

272
00:08:43,919 --> 00:08:45,519
same well right i want to continue to

273
00:08:45,519 --> 00:08:47,440
evolve continue to expose folks to new

274
00:08:47,440 --> 00:08:48,399
things

275
00:08:48,399 --> 00:08:50,399
so we end up using metasploit we really

276
00:08:50,399 --> 00:08:51,760
weren't focusing on the metasploit

277
00:08:51,760 --> 00:08:53,440
modules but we were going ahead and

278
00:08:53,440 --> 00:08:55,920
utilizing that you know i've got the c2

279
00:08:55,920 --> 00:08:57,519
there i've got the interpreter good

280
00:08:57,519 --> 00:08:58,560
enough

281
00:08:58,560 --> 00:09:01,360
um as we see more people moving to the

282
00:09:01,360 --> 00:09:02,959
cloud right

283
00:09:02,959 --> 00:09:05,600
azure ad was starting to take more hold

284
00:09:05,600 --> 00:09:07,360
there so going ahead and building an

285
00:09:07,360 --> 00:09:09,440
integration where somebody had an ad on

286
00:09:09,440 --> 00:09:12,399
site they had an azure ad in the cloud

287
00:09:12,399 --> 00:09:13,680
and they had some sort of

288
00:09:13,680 --> 00:09:15,360
synchronization because not everybody

289
00:09:15,360 --> 00:09:17,760
just takes their ad shuts it off moves

290
00:09:17,760 --> 00:09:19,440
it to the cloud and says yep we're good

291
00:09:19,440 --> 00:09:20,320
right

292
00:09:20,320 --> 00:09:21,200
right

293
00:09:21,200 --> 00:09:22,640
i know you guys had a long lunch and

294
00:09:22,640 --> 00:09:24,080
everything but right

295
00:09:24,080 --> 00:09:25,360
um

296
00:09:25,360 --> 00:09:27,680
the idea here is that we added active

297
00:09:27,680 --> 00:09:29,120
directory sync kind of in that

298
00:09:29,120 --> 00:09:31,760
transition mode okay and also to raise

299
00:09:31,760 --> 00:09:33,519
the bar a little bit morely for more for

300
00:09:33,519 --> 00:09:36,320
the attackers but also to kind of take a

301
00:09:36,320 --> 00:09:38,399
little bit of the oh yeah windows 7 box

302
00:09:38,399 --> 00:09:40,160
everybody can crack a windows 7 box we

303
00:09:40,160 --> 00:09:41,920
moved everybody to windows 10 right just

304
00:09:41,920 --> 00:09:44,000
kind of up level that the teaching point

305
00:09:44,000 --> 00:09:45,680
that i take away from windows 7 versus

306
00:09:45,680 --> 00:09:47,279
windows 10 is is if you wanted to use

307
00:09:47,279 --> 00:09:48,480
windows 7

308
00:09:48,480 --> 00:09:51,279
that's fine it's important to utilize

309
00:09:51,279 --> 00:09:53,040
that and kind of help people understand

310
00:09:53,040 --> 00:09:54,399
that they need to put more tripwires

311
00:09:54,399 --> 00:09:56,480
more focus on those more vulnerable

312
00:09:56,480 --> 00:09:57,920
systems and it can be anything besides

313
00:09:57,920 --> 00:09:59,920
windows 7 but you get the idea in this

314
00:09:59,920 --> 00:10:01,279
case we kind of upleveled everything to

315
00:10:01,279 --> 00:10:04,240
windows 10 at the time

316
00:10:04,240 --> 00:10:06,000
all right so

317
00:10:06,000 --> 00:10:07,600
we defined our goals

318
00:10:07,600 --> 00:10:09,519
we didn't eliminate our challenges but

319
00:10:09,519 --> 00:10:10,800
we established workarounds to those

320
00:10:10,800 --> 00:10:13,360
things so what i did at this point was

321
00:10:13,360 --> 00:10:15,279
we started kind of working through and

322
00:10:15,279 --> 00:10:17,920
building out what this would look like

323
00:10:17,920 --> 00:10:19,120
and so

324
00:10:19,120 --> 00:10:20,880
if you're building

325
00:10:20,880 --> 00:10:22,399
an emulation

326
00:10:22,399 --> 00:10:23,680
there's a couple of different things you

327
00:10:23,680 --> 00:10:25,600
can do at the very least

328
00:10:25,600 --> 00:10:27,519
the one on the top there is kind of the

329
00:10:27,519 --> 00:10:29,839
bullet point method okay i want to get

330
00:10:29,839 --> 00:10:31,440
to this spot i want to do x i want to do

331
00:10:31,440 --> 00:10:32,800
y i want to do z

332
00:10:32,800 --> 00:10:35,040
and that's perfectly fine and in fact

333
00:10:35,040 --> 00:10:36,160
um

334
00:10:36,160 --> 00:10:37,440
when it came to the cloud part of the

335
00:10:37,440 --> 00:10:39,360
attack and i had written this narrative

336
00:10:39,360 --> 00:10:41,040
um i kind of got to that point i'm just

337
00:10:41,040 --> 00:10:42,720
like oh let me just do these five things

338
00:10:42,720 --> 00:10:43,920
and i'm done

339
00:10:43,920 --> 00:10:45,360
okay so

340
00:10:45,360 --> 00:10:47,360
but that that's that's kind of the the

341
00:10:47,360 --> 00:10:49,839
basics if you will the one below it was

342
00:10:49,839 --> 00:10:50,959
a little bit more of a narrative in

343
00:10:50,959 --> 00:10:52,480
terms of the description as to here's

344
00:10:52,480 --> 00:10:53,920
what we're going to do

345
00:10:53,920 --> 00:10:56,000
here's what the miter attack techniques

346
00:10:56,000 --> 00:10:57,360
and this is at that time because you can

347
00:10:57,360 --> 00:10:58,839
see some of these techniques have been

348
00:10:58,839 --> 00:11:01,200
um you know shut down turned off

349
00:11:01,200 --> 00:11:04,079
modified enhanced um

350
00:11:04,079 --> 00:11:05,600
these are the techniques and i'll tell

351
00:11:05,600 --> 00:11:06,640
you why that's important because we're

352
00:11:06,640 --> 00:11:08,079
going to come back to that in a bit and

353
00:11:08,079 --> 00:11:09,920
then the commands associated with it and

354
00:11:09,920 --> 00:11:11,360
then the one on the right starts getting

355
00:11:11,360 --> 00:11:13,200
a little bit more verbose where we

356
00:11:13,200 --> 00:11:14,640
actually added the sub techniques in

357
00:11:14,640 --> 00:11:16,399
there we started adding the command

358
00:11:16,399 --> 00:11:18,000
lines in there with the exact command

359
00:11:18,000 --> 00:11:19,440
lines with some of it blurred out so you

360
00:11:19,440 --> 00:11:21,360
know i'm not going to give away my

361
00:11:21,360 --> 00:11:23,519
give away some of my indicators there um

362
00:11:23,519 --> 00:11:26,160
and then also the time stamps okay now

363
00:11:26,160 --> 00:11:27,600
the time stamps are the things that we

364
00:11:27,600 --> 00:11:30,079
added in after the fact generally you do

365
00:11:30,079 --> 00:11:31,440
a validation

366
00:11:31,440 --> 00:11:33,760
um so you run your emulation do some

367
00:11:33,760 --> 00:11:35,440
validation did i get what i was

368
00:11:35,440 --> 00:11:36,959
expecting to get

369
00:11:36,959 --> 00:11:37,760
okay

370
00:11:37,760 --> 00:11:38,720
um

371
00:11:38,720 --> 00:11:40,320
we've had instances where we've gone

372
00:11:40,320 --> 00:11:42,240
ahead and run something i run a red uh

373
00:11:42,240 --> 00:11:44,399
registry uh

374
00:11:44,399 --> 00:11:46,880
registry key you know put a run key in

375
00:11:46,880 --> 00:11:49,200
right run a task scheduler go back in

376
00:11:49,200 --> 00:11:51,200
and look and say oh wait a second we

377
00:11:51,200 --> 00:11:52,560
don't have that event

378
00:11:52,560 --> 00:11:54,320
why don't we have that event

379
00:11:54,320 --> 00:11:56,240
do we have a misconfiguration on the

380
00:11:56,240 --> 00:11:57,920
network that we're running this on we've

381
00:11:57,920 --> 00:12:00,320
had that happen as well okay those kinds

382
00:12:00,320 --> 00:12:01,600
of things are going to happen you want

383
00:12:01,600 --> 00:12:02,880
to have those in there the other nice

384
00:12:02,880 --> 00:12:04,320
thing is is when you go back to these

385
00:12:04,320 --> 00:12:06,000
emulation scripts and these emulation

386
00:12:06,000 --> 00:12:08,000
narratives and you start trying to build

387
00:12:08,000 --> 00:12:09,279
whatever you're building whether that's

388
00:12:09,279 --> 00:12:11,839
competition whether that's training

389
00:12:11,839 --> 00:12:14,320
whether that's you know just just

390
00:12:14,320 --> 00:12:15,839
providing a data set to somebody to say

391
00:12:15,839 --> 00:12:17,920
hey go hunt this being able to know

392
00:12:17,920 --> 00:12:19,440
where those things are it can be very

393
00:12:19,440 --> 00:12:22,000
very helpful and impactful okay so

394
00:12:22,000 --> 00:12:23,680
having those kind of waypoints along the

395
00:12:23,680 --> 00:12:25,600
road can be can be good again you don't

396
00:12:25,600 --> 00:12:27,040
have to do all those things but i found

397
00:12:27,040 --> 00:12:28,480
it being helpful to go from the bullet

398
00:12:28,480 --> 00:12:31,040
point to the narrative with the commands

399
00:12:31,040 --> 00:12:33,600
mapping to mitre adding the time stamps

400
00:12:33,600 --> 00:12:35,040
to it and having the command line all

401
00:12:35,040 --> 00:12:37,200
there together so it's right there

402
00:12:37,200 --> 00:12:38,240
because also if you think about it from

403
00:12:38,240 --> 00:12:39,519
an adversary perspective they're

404
00:12:39,519 --> 00:12:41,440
probably running on an op script as well

405
00:12:41,440 --> 00:12:42,880
maybe not to the same level but they're

406
00:12:42,880 --> 00:12:44,399
going to be going okay i log in and i'm

407
00:12:44,399 --> 00:12:46,240
going to go who am i first then i'm

408
00:12:46,240 --> 00:12:47,440
going to go ahead and ping and then i'm

409
00:12:47,440 --> 00:12:48,959
going to do this and this or whatever

410
00:12:48,959 --> 00:12:51,600
those things are

411
00:12:51,600 --> 00:12:52,959
so

412
00:12:52,959 --> 00:12:54,720
we got to the end of this

413
00:12:54,720 --> 00:12:56,160
the ones in yellow were the palette that

414
00:12:56,160 --> 00:12:58,000
i was starting to work with right the

415
00:12:58,000 --> 00:12:59,360
ones in orange are the ones we hit the

416
00:12:59,360 --> 00:13:01,600
first time through the ones in red were

417
00:13:01,600 --> 00:13:03,200
things that were not called out by in

418
00:13:03,200 --> 00:13:04,959
this adversary group but were things

419
00:13:04,959 --> 00:13:06,160
that i kind of sprinkled in there to

420
00:13:06,160 --> 00:13:07,279
kind of help me get from point a to

421
00:13:07,279 --> 00:13:08,720
point b to point c

422
00:13:08,720 --> 00:13:10,399
and then the blues are the ones that

423
00:13:10,399 --> 00:13:12,000
were were some of the cloud pieces

424
00:13:12,000 --> 00:13:14,079
because cloud really wasn't in scope of

425
00:13:14,079 --> 00:13:16,240
of that adversary at that point in time

426
00:13:16,240 --> 00:13:18,639
um but we're like okay yeah good so i

427
00:13:18,639 --> 00:13:20,240
kind of look at this and i go okay i

428
00:13:20,240 --> 00:13:21,600
think we did a pretty good job hitting

429
00:13:21,600 --> 00:13:22,880
the different tactics along the way in

430
00:13:22,880 --> 00:13:24,639
the different mile posts do we have that

431
00:13:24,639 --> 00:13:27,440
data in the log set that we've created

432
00:13:27,440 --> 00:13:29,279
that's a separate question right but you

433
00:13:29,279 --> 00:13:30,880
know that's the way we go with this so

434
00:13:30,880 --> 00:13:32,000
there's some more things that i can do

435
00:13:32,000 --> 00:13:35,839
with this adversary to exercise this

436
00:13:36,959 --> 00:13:38,560
kind of fast forward a year right we all

437
00:13:38,560 --> 00:13:39,839
move to zoom

438
00:13:39,839 --> 00:13:42,240
right we're all working out of the house

439
00:13:42,240 --> 00:13:44,000
that's important because that also

440
00:13:44,000 --> 00:13:45,600
potentially changes the emulation that

441
00:13:45,600 --> 00:13:47,920
we're doing and it changes the landscape

442
00:13:47,920 --> 00:13:49,680
of the victim organization which i'll

443
00:13:49,680 --> 00:13:51,519
talk about in a bit but you think about

444
00:13:51,519 --> 00:13:53,040
it from that perspective if i had built

445
00:13:53,040 --> 00:13:55,920
lateral movement as a primary ttp for an

446
00:13:55,920 --> 00:13:57,680
adversary and it goes workstation to

447
00:13:57,680 --> 00:13:59,440
work station that kind of flies by the

448
00:13:59,440 --> 00:14:01,600
wayside when we're in this state

449
00:14:01,600 --> 00:14:03,760
right so we have to modify our emulation

450
00:14:03,760 --> 00:14:06,639
for the environment that we work in

451
00:14:06,639 --> 00:14:09,120
so came back to this said okay great my

452
00:14:09,120 --> 00:14:10,880
exploit was lovely

453
00:14:10,880 --> 00:14:12,639
that was my stopgap for the year but

454
00:14:12,639 --> 00:14:15,279
what could i utilize otherwise right

455
00:14:15,279 --> 00:14:16,720
uh

456
00:14:16,720 --> 00:14:18,000
i'm not going to ask everyone who who

457
00:14:18,000 --> 00:14:19,199
always used covenant what have you

458
00:14:19,199 --> 00:14:20,399
before but if you haven't got a chance

459
00:14:20,399 --> 00:14:22,240
to take a look at covenant take a look

460
00:14:22,240 --> 00:14:24,880
at it it's a very good c2 um

461
00:14:24,880 --> 00:14:26,560
we utilized that

462
00:14:26,560 --> 00:14:29,440
actually the past two years

463
00:14:29,440 --> 00:14:30,800
as i was taking a look at this and

464
00:14:30,800 --> 00:14:32,160
trying to figure out what else i wanted

465
00:14:32,160 --> 00:14:33,760
to do

466
00:14:33,760 --> 00:14:35,040
we had talked to some thread intel

467
00:14:35,040 --> 00:14:37,360
analysts at a couple of of the of the

468
00:14:37,360 --> 00:14:39,120
larger organizations some of the

469
00:14:39,120 --> 00:14:40,800
feedback we got about this adversary

470
00:14:40,800 --> 00:14:42,160
group was that there was a lot more

471
00:14:42,160 --> 00:14:45,279
movement to the cloud a lot movement

472
00:14:45,279 --> 00:14:47,600
away from custom malware and a lot of

473
00:14:47,600 --> 00:14:49,360
movement towards you know more living

474
00:14:49,360 --> 00:14:51,839
off the land if you will so i have my

475
00:14:51,839 --> 00:14:54,240
little uh tripod there with my uh

476
00:14:54,240 --> 00:14:56,320
campfire and my kettle and we're gonna

477
00:14:56,320 --> 00:14:59,680
live off the land there

478
00:14:59,680 --> 00:15:01,360
powershell powershell continued to be

479
00:15:01,360 --> 00:15:03,760
out there at the same time we tried to

480
00:15:03,760 --> 00:15:06,240
up level for the

481
00:15:06,240 --> 00:15:08,480
defenders by turning on script block

482
00:15:08,480 --> 00:15:11,040
logging right so we wanted to go ahead

483
00:15:11,040 --> 00:15:12,959
and say okay we're going to go ahead and

484
00:15:12,959 --> 00:15:14,240
we're going to still continue doing

485
00:15:14,240 --> 00:15:15,440
powershell attacks but we're going to go

486
00:15:15,440 --> 00:15:17,040
ahead and up level from the defense

487
00:15:17,040 --> 00:15:18,880
perspective too

488
00:15:18,880 --> 00:15:22,240
we moved azure from adsync to adconnect

489
00:15:22,240 --> 00:15:24,079
that was the preferred microsoft manner

490
00:15:24,079 --> 00:15:25,680
so we went ahead with another

491
00:15:25,680 --> 00:15:27,199
synchronization or another uh

492
00:15:27,199 --> 00:15:29,199
integration method there with more of

493
00:15:29,199 --> 00:15:31,759
our workloads already up in azure

494
00:15:31,759 --> 00:15:34,560
and then from a sql azure perspective

495
00:15:34,560 --> 00:15:36,800
my first job out of school was a dba and

496
00:15:36,800 --> 00:15:38,639
so i've got a special place in my heart

497
00:15:38,639 --> 00:15:41,120
for microsoft sql dba

498
00:15:41,120 --> 00:15:43,040
that package and i was like okay let's

499
00:15:43,040 --> 00:15:44,800
see what this looks like so we took a

500
00:15:44,800 --> 00:15:46,880
customer database we moved that customer

501
00:15:46,880 --> 00:15:48,399
database to the cloud and when i say

502
00:15:48,399 --> 00:15:49,920
customer is something we created but

503
00:15:49,920 --> 00:15:51,440
customer database to the cloud and then

504
00:15:51,440 --> 00:15:53,040
started turning on the sql auditing and

505
00:15:53,040 --> 00:15:55,040
says what kind of visibility do we have

506
00:15:55,040 --> 00:15:56,800
around sql what kinds of things do we

507
00:15:56,800 --> 00:15:58,399
see the creates do we see the drops do

508
00:15:58,399 --> 00:16:00,000
we see the bcps what does that

509
00:16:00,000 --> 00:16:01,920
visibility look like in that cloud and

510
00:16:01,920 --> 00:16:03,839
progress through that attack

511
00:16:03,839 --> 00:16:05,600
right so again changing the landscape to

512
00:16:05,600 --> 00:16:07,680
go ahead and accommodate these new new

513
00:16:07,680 --> 00:16:10,240
realities

514
00:16:10,240 --> 00:16:11,600
fast forward

515
00:16:11,600 --> 00:16:13,120
we have had this little thing in the

516
00:16:13,120 --> 00:16:16,399
news called solarigate right

517
00:16:16,399 --> 00:16:18,000
we had the supply chain piece of this we

518
00:16:18,000 --> 00:16:20,320
had these other things as i was doing my

519
00:16:20,320 --> 00:16:21,920
research again there we started coming

520
00:16:21,920 --> 00:16:22,880
across

521
00:16:22,880 --> 00:16:25,519
adfs active directory federation

522
00:16:25,519 --> 00:16:28,399
services right adfs is yet another way

523
00:16:28,399 --> 00:16:30,399
to go ahead and utilize that active

524
00:16:30,399 --> 00:16:32,240
directory on premise that active

525
00:16:32,240 --> 00:16:34,000
directory in azure and that

526
00:16:34,000 --> 00:16:35,839
synchronization so i can go ahead and

527
00:16:35,839 --> 00:16:37,839
log in and be able to get to those

528
00:16:37,839 --> 00:16:39,600
assets we heard about things called

529
00:16:39,600 --> 00:16:41,120
golden saml and it's like wow this

530
00:16:41,120 --> 00:16:44,000
sounds really really bad this is really

531
00:16:44,000 --> 00:16:45,279
interesting though

532
00:16:45,279 --> 00:16:47,040
what can we do to see this because there

533
00:16:47,040 --> 00:16:49,040
was also these con these conversations

534
00:16:49,040 --> 00:16:51,040
about bypassing multi-factor

535
00:16:51,040 --> 00:16:53,120
authentication getting into the graph

536
00:16:53,120 --> 00:16:56,000
api and doing stuff there and so it was

537
00:16:56,000 --> 00:16:57,680
like okay let's go ahead and start kind

538
00:16:57,680 --> 00:16:59,600
of building our emulation around these

539
00:16:59,600 --> 00:17:01,519
things there's more work to c sharp we

540
00:17:01,519 --> 00:17:03,199
still kept powershell around but but

541
00:17:03,199 --> 00:17:04,880
utilizing some more of the c-sharp

542
00:17:04,880 --> 00:17:06,319
tooling that was out there as well

543
00:17:06,319 --> 00:17:07,679
because we're seeing more of that from

544
00:17:07,679 --> 00:17:10,160
an adversary perspective

545
00:17:10,160 --> 00:17:11,119
so

546
00:17:11,119 --> 00:17:12,480
as we're just talking about this for a

547
00:17:12,480 --> 00:17:13,919
couple minutes you notice all of the

548
00:17:13,919 --> 00:17:15,919
different frameworks

549
00:17:15,919 --> 00:17:17,760
software tools and i even talk about all

550
00:17:17,760 --> 00:17:18,880
these different pieces but all of a

551
00:17:18,880 --> 00:17:20,480
sudden what you can kind of see with

552
00:17:20,480 --> 00:17:22,000
this talking about these different

553
00:17:22,000 --> 00:17:24,319
scenarios around these adversaries is

554
00:17:24,319 --> 00:17:25,919
we're building up a nice corpus of

555
00:17:25,919 --> 00:17:28,240
understanding around what these tools do

556
00:17:28,240 --> 00:17:30,160
what these tools log what the visibility

557
00:17:30,160 --> 00:17:31,919
of them looks like to be able to go

558
00:17:31,919 --> 00:17:34,480
ahead and say okay if i can go ahead and

559
00:17:34,480 --> 00:17:35,840
find this i can hunt for this i can

560
00:17:35,840 --> 00:17:38,000
detect this and and so forth

561
00:17:38,000 --> 00:17:39,919
okay

562
00:17:39,919 --> 00:17:41,600
now

563
00:17:41,600 --> 00:17:43,440
sometimes

564
00:17:43,440 --> 00:17:44,960
when you when you sign up to go ahead

565
00:17:44,960 --> 00:17:46,799
and and present somewhere right you're

566
00:17:46,799 --> 00:17:48,640
going ahead and building your decks um

567
00:17:48,640 --> 00:17:50,080
and i've had this happen this is at

568
00:17:50,080 --> 00:17:51,840
least the second time this happened uh

569
00:17:51,840 --> 00:17:54,559
whether it's the twitter ferry or the uh

570
00:17:54,559 --> 00:17:57,360
or or or the uh the thread intel report

571
00:17:57,360 --> 00:17:59,120
ferry drops something on you as you're

572
00:17:59,120 --> 00:18:00,880
preparing to talk about something and so

573
00:18:00,880 --> 00:18:03,520
uh this came out from mandiant

574
00:18:03,520 --> 00:18:05,679
literally i think six weeks ago which

575
00:18:05,679 --> 00:18:09,120
was their analysis of the unc 2452

576
00:18:09,120 --> 00:18:12,400
merging into apt-29 and i was like oh

577
00:18:12,400 --> 00:18:14,160
well that's interesting that kind of

578
00:18:14,160 --> 00:18:15,520
dovetails with what we've just been

579
00:18:15,520 --> 00:18:17,520
talking about for the past 10 minutes so

580
00:18:17,520 --> 00:18:19,600
i crack it open start flipping through

581
00:18:19,600 --> 00:18:20,880
and they had the high some high level

582
00:18:20,880 --> 00:18:23,360
commentary there around this and so this

583
00:18:23,360 --> 00:18:24,400
is kind of where i started looking at

584
00:18:24,400 --> 00:18:26,880
this going okay am i am i creating this

585
00:18:26,880 --> 00:18:28,480
is this is this aligning and they talked

586
00:18:28,480 --> 00:18:30,320
about varying intrusion vectors well the

587
00:18:30,320 --> 00:18:32,080
picture on the side is their intrusion

588
00:18:32,080 --> 00:18:35,039
vectors uh four of those six

589
00:18:35,039 --> 00:18:36,720
uh we've touched on some of them as

590
00:18:36,720 --> 00:18:38,240
straight up initial access some of them

591
00:18:38,240 --> 00:18:39,840
as being initial access and then a pivot

592
00:18:39,840 --> 00:18:41,840
to a cloud after having more information

593
00:18:41,840 --> 00:18:42,960
so i was like okay yeah we're doing

594
00:18:42,960 --> 00:18:45,360
pretty good heightened opsec yeah we

595
00:18:45,360 --> 00:18:46,559
really don't cover that because one of

596
00:18:46,559 --> 00:18:47,840
the things about heightened opsex is

597
00:18:47,840 --> 00:18:50,400
like getting on and turning off the logs

598
00:18:50,400 --> 00:18:51,600
that kind of would defeat the whole

599
00:18:51,600 --> 00:18:53,039
detection point of this that we're

600
00:18:53,039 --> 00:18:55,919
trying to solve or address but obviously

601
00:18:55,919 --> 00:18:57,919
turning on and monitoring for logging

602
00:18:57,919 --> 00:18:59,520
being turned off or disabled is

603
00:18:59,520 --> 00:19:00,640
something that would be very important

604
00:19:00,640 --> 00:19:02,880
to you know take care of that

605
00:19:02,880 --> 00:19:04,880
from a sophistication perspective they

606
00:19:04,880 --> 00:19:07,520
cited on-prem to cloud movement yeah we

607
00:19:07,520 --> 00:19:08,640
walked through that and we did that a

608
00:19:08,640 --> 00:19:10,799
couple of different ways bypassing mfa

609
00:19:10,799 --> 00:19:12,559
with gold and saml on the graph api you

610
00:19:12,559 --> 00:19:14,080
absolutely did that i'm hoping at some

611
00:19:14,080 --> 00:19:16,000
point here i can write it or do another

612
00:19:16,000 --> 00:19:17,919
thing around talking about how all that

613
00:19:17,919 --> 00:19:20,000
worked the maintaining a light footprint

614
00:19:20,000 --> 00:19:21,360
remember i talked about we had talked to

615
00:19:21,360 --> 00:19:22,960
some different threat intel analysts and

616
00:19:22,960 --> 00:19:24,799
they were not mandiant by the way that

617
00:19:24,799 --> 00:19:26,480
had talked about moving away from custom

618
00:19:26,480 --> 00:19:28,000
tooling and moving more living off the

619
00:19:28,000 --> 00:19:30,320
land these are some quotes directly from

620
00:19:30,320 --> 00:19:32,880
the mandiant team talking about the

621
00:19:32,880 --> 00:19:35,840
native microsoft feature abuse

622
00:19:35,840 --> 00:19:37,520
a lot less custom tooling there and

623
00:19:37,520 --> 00:19:38,799
everything else so i was like great this

624
00:19:38,799 --> 00:19:40,080
is really kind of validating the things

625
00:19:40,080 --> 00:19:41,520
that we were kind of observing and kind

626
00:19:41,520 --> 00:19:43,360
of emulating as we went

627
00:19:43,360 --> 00:19:44,720
they talked about them moving with speed

628
00:19:44,720 --> 00:19:46,640
and agility we don't move with speed and

629
00:19:46,640 --> 00:19:48,000
agility we're doing these things for

630
00:19:48,000 --> 00:19:50,400
fixed finite pieces and again we're not

631
00:19:50,400 --> 00:19:52,240
adversaries as a professional uh

632
00:19:52,240 --> 00:19:53,919
capability okay we're blue teamers

633
00:19:53,919 --> 00:19:55,679
trying to do do some of this to make

634
00:19:55,679 --> 00:19:57,360
everybody a little bit better

635
00:19:57,360 --> 00:19:58,640
and then the last part they talked about

636
00:19:58,640 --> 00:20:00,400
following the data that was mainly

637
00:20:00,400 --> 00:20:02,400
around exchange

638
00:20:02,400 --> 00:20:04,559
we didn't do a lot with exchange mainly

639
00:20:04,559 --> 00:20:06,559
because one time we went ahead and tried

640
00:20:06,559 --> 00:20:08,720
to go ahead and capture a large corpus

641
00:20:08,720 --> 00:20:10,559
of mail we realized we're going to

642
00:20:10,559 --> 00:20:12,159
potentially run into privacy issues

643
00:20:12,159 --> 00:20:14,559
around the addresses that were in that

644
00:20:14,559 --> 00:20:16,799
mail even though so much of it was spam

645
00:20:16,799 --> 00:20:18,720
there was still some weirdness there

646
00:20:18,720 --> 00:20:20,240
that we just decided not to get into

647
00:20:20,240 --> 00:20:23,200
that we did monkey with the um

648
00:20:23,200 --> 00:20:25,280
exchange rules a little bit right go

649
00:20:25,280 --> 00:20:28,240
ahead and and take a

650
00:20:28,240 --> 00:20:30,159
email coming into the ceo and send it to

651
00:20:30,159 --> 00:20:31,919
somebody else's email address as well

652
00:20:31,919 --> 00:20:33,280
just to see what you could do and what

653
00:20:33,280 --> 00:20:34,799
kind of fidelity of logging you could

654
00:20:34,799 --> 00:20:36,320
have but those are the kinds of things

655
00:20:36,320 --> 00:20:37,679
that that we kind of focused on

656
00:20:37,679 --> 00:20:39,520
following the data from our perspective

657
00:20:39,520 --> 00:20:40,720
wasn't as critical because obviously

658
00:20:40,720 --> 00:20:42,159
we're not trying to steal the male ware

659
00:20:42,159 --> 00:20:44,159
but we did stage and exfiltrate that

660
00:20:44,159 --> 00:20:46,080
data as well

661
00:20:46,080 --> 00:20:48,880
all right this is an eye chart

662
00:20:48,880 --> 00:20:50,720
it actually yeah it definitely is an eye

663
00:20:50,720 --> 00:20:52,880
chart even up on there um

664
00:20:52,880 --> 00:20:54,559
this is kind of the assessment as to how

665
00:20:54,559 --> 00:20:56,400
we did with this adversary so the white

666
00:20:56,400 --> 00:20:57,840
the white is

667
00:20:57,840 --> 00:21:00,000
um the miter techniques that did not

668
00:21:00,000 --> 00:21:02,320
apply to the adversary the lightest of

669
00:21:02,320 --> 00:21:03,760
the light blue

670
00:21:03,760 --> 00:21:06,000
are the techniques that we didn't touch

671
00:21:06,000 --> 00:21:08,000
the darker and darker and darker blues

672
00:21:08,000 --> 00:21:09,600
are the more times that we iterated and

673
00:21:09,600 --> 00:21:11,679
utilized that tooling

674
00:21:11,679 --> 00:21:13,440
the good news looking at this overall

675
00:21:13,440 --> 00:21:15,120
again is is that we were able to hit a

676
00:21:15,120 --> 00:21:16,559
lot of techniques and sub techniques

677
00:21:16,559 --> 00:21:20,720
across many many steps across this um so

678
00:21:20,720 --> 00:21:22,240
you know i i felt like we were kind of

679
00:21:22,240 --> 00:21:24,159
squeezing the juice out of the out of uh

680
00:21:24,159 --> 00:21:26,080
out of the um the techniques and sub

681
00:21:26,080 --> 00:21:27,760
techniques that this adversary was using

682
00:21:27,760 --> 00:21:30,960
so i felt pretty good about that as well

683
00:21:30,960 --> 00:21:32,640
so let's talk about some lessons learned

684
00:21:32,640 --> 00:21:34,080
here

685
00:21:34,080 --> 00:21:35,520
uh the first thing to talk about is

686
00:21:35,520 --> 00:21:37,039
keeping this real keeping it real when

687
00:21:37,039 --> 00:21:38,480
you're building an emulation is always a

688
00:21:38,480 --> 00:21:40,000
concern right you want to you want this

689
00:21:40,000 --> 00:21:42,240
to pass the oh no no there's no way that

690
00:21:42,240 --> 00:21:44,480
this would ever happen the answer is yes

691
00:21:44,480 --> 00:21:46,080
it would probably happen right you have

692
00:21:46,080 --> 00:21:47,120
to keep it

693
00:21:47,120 --> 00:21:49,200
you know it doesn't have to be perfect

694
00:21:49,200 --> 00:21:50,960
right but it does have to be realistic

695
00:21:50,960 --> 00:21:52,400
if anybody was in the cloud talk this

696
00:21:52,400 --> 00:21:54,720
morning about um

697
00:21:54,720 --> 00:21:57,760
about workloads is it workloads um the

698
00:21:57,760 --> 00:22:00,080
folks were talking about a secure

699
00:22:00,080 --> 00:22:01,760
default configuration does not equal a

700
00:22:01,760 --> 00:22:03,280
secure configuration when it comes to

701
00:22:03,280 --> 00:22:05,280
cloud and that's absolutely the case

702
00:22:05,280 --> 00:22:07,919
right and if i'm trying to learn gcp i'm

703
00:22:07,919 --> 00:22:08,960
trying to learn azure i'm trying to

704
00:22:08,960 --> 00:22:10,960
learn aws i'm probably going to take a

705
00:22:10,960 --> 00:22:12,480
lot of defaults along the way just to

706
00:22:12,480 --> 00:22:13,600
get started because i don't know any

707
00:22:13,600 --> 00:22:15,360
better or i don't have the time so

708
00:22:15,360 --> 00:22:16,000
you're going to have those

709
00:22:16,000 --> 00:22:18,480
misconfigurations happen av and edr

710
00:22:18,480 --> 00:22:20,000
bypasses are out there and they happen

711
00:22:20,000 --> 00:22:21,840
all the time admins don't necessarily

712
00:22:21,840 --> 00:22:23,679
follow their own policies

713
00:22:23,679 --> 00:22:26,480
right yes you know who you are um

714
00:22:26,480 --> 00:22:27,919
but the idea there is is that these

715
00:22:27,919 --> 00:22:29,280
things are going to happen so don't

716
00:22:29,280 --> 00:22:31,280
stress too much about keeping it real

717
00:22:31,280 --> 00:22:32,880
those things are going to happen as you

718
00:22:32,880 --> 00:22:35,120
start building things out like this

719
00:22:35,120 --> 00:22:36,880
current events are fabulous i find that

720
00:22:36,880 --> 00:22:38,480
that works best to go ahead and generate

721
00:22:38,480 --> 00:22:40,320
some of these ideas also keeps it kind

722
00:22:40,320 --> 00:22:41,520
of in keeps it real from that

723
00:22:41,520 --> 00:22:42,640
perspective

724
00:22:42,640 --> 00:22:44,240
but it's important to figure out who is

725
00:22:44,240 --> 00:22:45,440
the adversary that you're going to

726
00:22:45,440 --> 00:22:46,400
target

727
00:22:46,400 --> 00:22:48,559
now

728
00:22:48,559 --> 00:22:50,640
targeting the adversary and focusing on

729
00:22:50,640 --> 00:22:52,880
that people sometimes get fixated on it

730
00:22:52,880 --> 00:22:55,280
has to be a perfect copy it doesn't have

731
00:22:55,280 --> 00:22:57,440
to be a perfect copy okay and the

732
00:22:57,440 --> 00:22:59,120
example i like to use here is shadow

733
00:22:59,120 --> 00:23:01,360
copies i talked about nteds.dit right to

734
00:23:01,360 --> 00:23:02,960
be able to get to ntds.did i'm going to

735
00:23:02,960 --> 00:23:04,400
get to a volume shadow copy as an

736
00:23:04,400 --> 00:23:06,640
example what i want to be focused on is

737
00:23:06,640 --> 00:23:08,159
how

738
00:23:08,159 --> 00:23:09,520
can i detect somebody getting to a

739
00:23:09,520 --> 00:23:10,960
volume shadow copy there's a bunch of

740
00:23:10,960 --> 00:23:12,720
different ways to get to it right but

741
00:23:12,720 --> 00:23:13,919
think about it from an outcome

742
00:23:13,919 --> 00:23:15,919
perspective and again from really if i'm

743
00:23:15,919 --> 00:23:17,360
trying to defend if i'm trying to expose

744
00:23:17,360 --> 00:23:19,200
this information to hunters i want to be

745
00:23:19,200 --> 00:23:20,880
able to think about how are the five

746
00:23:20,880 --> 00:23:22,000
different ways 10 different ways that

747
00:23:22,000 --> 00:23:23,360
somebody could get to this thing and

748
00:23:23,360 --> 00:23:25,200
then i could go ahead and identify those

749
00:23:25,200 --> 00:23:27,360
different things doing vss admin every

750
00:23:27,360 --> 00:23:28,880
single time isn't going to be beneficial

751
00:23:28,880 --> 00:23:30,240
to the blue team

752
00:23:30,240 --> 00:23:31,600
then of course monitor at the endpoint

753
00:23:31,600 --> 00:23:32,960
monitor at the network try to get as

754
00:23:32,960 --> 00:23:37,200
much visibility as you have out there

755
00:23:37,200 --> 00:23:39,120
this is a tough one so benefit and

756
00:23:39,120 --> 00:23:41,039
burden this does take time right this

757
00:23:41,039 --> 00:23:42,799
takes time away from the core activities

758
00:23:42,799 --> 00:23:45,039
the core missions of the teams right so

759
00:23:45,039 --> 00:23:46,159
this is where you kind of have to

760
00:23:46,159 --> 00:23:48,000
balance you know what resources do i

761
00:23:48,000 --> 00:23:49,520
have what time do i have and what kind

762
00:23:49,520 --> 00:23:51,279
of benefit can i get

763
00:23:51,279 --> 00:23:52,880
there's only so many additional initial

764
00:23:52,880 --> 00:23:54,960
access capabilities or ways to get at it

765
00:23:54,960 --> 00:23:57,200
right link file spearfishing macro you

766
00:23:57,200 --> 00:23:58,400
know there's like eight of them out

767
00:23:58,400 --> 00:24:00,000
there

768
00:24:00,000 --> 00:24:02,400
is it crucial to focus on that

769
00:24:02,400 --> 00:24:04,480
woot did a talk yesterday about spear

770
00:24:04,480 --> 00:24:06,159
phishing both on the kind of a blue team

771
00:24:06,159 --> 00:24:08,240
red team perspective um if you want to

772
00:24:08,240 --> 00:24:10,159
focus on initial access some of the

773
00:24:10,159 --> 00:24:11,760
things that he was doing there could be

774
00:24:11,760 --> 00:24:13,679
very very valuable to be thinking about

775
00:24:13,679 --> 00:24:15,360
from my perspective i've kind of gotten

776
00:24:15,360 --> 00:24:17,840
to the point of let's kind of assume

777
00:24:17,840 --> 00:24:19,279
initial access because again we're

778
00:24:19,279 --> 00:24:20,880
talking about detection we're talking a

779
00:24:20,880 --> 00:24:22,159
little bit about post breach we're going

780
00:24:22,159 --> 00:24:24,159
to assume you know the barbarians are

781
00:24:24,159 --> 00:24:26,400
inside the gates already what can we go

782
00:24:26,400 --> 00:24:28,000
ahead and detect and how can we mitigate

783
00:24:28,000 --> 00:24:30,320
that from there right if your focus is

784
00:24:30,320 --> 00:24:31,919
outside on the initial access that's

785
00:24:31,919 --> 00:24:33,039
perfectly fine you just have to

786
00:24:33,039 --> 00:24:34,559
recalibrate that and be thinking about

787
00:24:34,559 --> 00:24:36,640
it from that perspective

788
00:24:36,640 --> 00:24:38,880
from a from an end-to-end perspective

789
00:24:38,880 --> 00:24:40,159
end-to-end

790
00:24:40,159 --> 00:24:41,919
full-on

791
00:24:41,919 --> 00:24:43,760
apt things are a lot of fun and they are

792
00:24:43,760 --> 00:24:45,600
really really stressful right because

793
00:24:45,600 --> 00:24:46,559
you're building these things you're

794
00:24:46,559 --> 00:24:47,520
concerned about maintaining the

795
00:24:47,520 --> 00:24:49,360
footholds we're also having to do this

796
00:24:49,360 --> 00:24:50,720
compressed so we're not doing this over

797
00:24:50,720 --> 00:24:52,720
56 days or 90 days of dwell time or

798
00:24:52,720 --> 00:24:54,320
things like that but you can go ahead

799
00:24:54,320 --> 00:24:56,159
and do those kinds of things but on the

800
00:24:56,159 --> 00:24:57,760
other hand if you're going ahead to use

801
00:24:57,760 --> 00:24:59,840
this as an education or a tester or

802
00:24:59,840 --> 00:25:01,760
something else like that maybe focus on

803
00:25:01,760 --> 00:25:04,240
a subset of tactics right maybe you

804
00:25:04,240 --> 00:25:05,679
assume initial access has already

805
00:25:05,679 --> 00:25:07,600
happened you're in an execution phase

806
00:25:07,600 --> 00:25:08,559
you're going to go ahead and move a

807
00:25:08,559 --> 00:25:10,640
lateral movement and you're going to go

808
00:25:10,640 --> 00:25:13,360
ahead and you know maybe make another

809
00:25:13,360 --> 00:25:14,640
lateral movement and that's it you're

810
00:25:14,640 --> 00:25:16,080
going to bound it or maybe you're going

811
00:25:16,080 --> 00:25:18,320
to do data collection staging

812
00:25:18,320 --> 00:25:21,279
exfiltration and bounded right making it

813
00:25:21,279 --> 00:25:22,799
chewable makes it a little bit easier to

814
00:25:22,799 --> 00:25:24,320
go ahead and do that and and it doesn't

815
00:25:24,320 --> 00:25:25,520
create as much stress on the

816
00:25:25,520 --> 00:25:27,600
organization and then of course keeping

817
00:25:27,600 --> 00:25:30,400
in focus what things matter to you

818
00:25:30,400 --> 00:25:32,080
that's really the most important thing

819
00:25:32,080 --> 00:25:33,360
if it doesn't matter to you it doesn't

820
00:25:33,360 --> 00:25:34,880
matter to your organization why are you

821
00:25:34,880 --> 00:25:36,320
emulating it

822
00:25:36,320 --> 00:25:38,559
okay

823
00:25:38,559 --> 00:25:41,440
test test test unit testing is fantastic

824
00:25:41,440 --> 00:25:43,520
practice practice practice end to end is

825
00:25:43,520 --> 00:25:45,840
important something will break these

826
00:25:45,840 --> 00:25:47,760
four things broke okay i talked about

827
00:25:47,760 --> 00:25:49,279
five different adversary emulations i

828
00:25:49,279 --> 00:25:51,919
had one a year almost okay

829
00:25:51,919 --> 00:25:53,440
pivoting from windows to linux that was

830
00:25:53,440 --> 00:25:55,200
fabulous um

831
00:25:55,200 --> 00:25:57,039
the uh the gentleman who was doing the

832
00:25:57,039 --> 00:25:58,880
linux piece did his piece he lives in

833
00:25:58,880 --> 00:26:01,760
texas i did my piece i live in virginia

834
00:26:01,760 --> 00:26:04,000
we got together in san jose sit down the

835
00:26:04,000 --> 00:26:05,520
night before to go ahead and just make

836
00:26:05,520 --> 00:26:06,720
sure we had everything together and we

837
00:26:06,720 --> 00:26:09,840
realized we didn't have that pivot in

838
00:26:09,840 --> 00:26:11,679
guess what we did that evening

839
00:26:11,679 --> 00:26:13,440
okay those kinds of things happen the

840
00:26:13,440 --> 00:26:15,679
rdp through a firewall because of some

841
00:26:15,679 --> 00:26:17,679
weird infrastructure pieces ended up

842
00:26:17,679 --> 00:26:19,760
being this pivot through interpreter to

843
00:26:19,760 --> 00:26:22,159
be able to get to rdp from the attacker

844
00:26:22,159 --> 00:26:23,520
because i did not have a direct link to

845
00:26:23,520 --> 00:26:24,799
the adversary

846
00:26:24,799 --> 00:26:26,320
those kinds of things happen you need to

847
00:26:26,320 --> 00:26:27,520
be thinking about those things you need

848
00:26:27,520 --> 00:26:28,880
to be prepared to go ahead and have

849
00:26:28,880 --> 00:26:30,240
those happen and you know what some of

850
00:26:30,240 --> 00:26:32,159
this stuff is good the exfiltration

851
00:26:32,159 --> 00:26:34,159
through a firewall real quick uh we were

852
00:26:34,159 --> 00:26:36,720
doing ftp exfiltration we actually had a

853
00:26:36,720 --> 00:26:39,279
prevention kick in and block it we ended

854
00:26:39,279 --> 00:26:40,640
up building on the fly a dns

855
00:26:40,640 --> 00:26:42,000
exfiltration

856
00:26:42,000 --> 00:26:43,919
we kicked that in that's sort of getting

857
00:26:43,919 --> 00:26:45,440
blocked but it was good because those

858
00:26:45,440 --> 00:26:46,880
things popped up in the log stream as

859
00:26:46,880 --> 00:26:48,799
well to be able to see what are yours

860
00:26:48,799 --> 00:26:50,960
what are your tooling showing in there

861
00:26:50,960 --> 00:26:52,400
as well as things that are happening

862
00:26:52,400 --> 00:26:54,159
right adversaries make mistakes we

863
00:26:54,159 --> 00:26:55,600
utilize that to capitalize on those

864
00:26:55,600 --> 00:26:58,000
kinds of things as well

865
00:26:58,000 --> 00:26:59,679
provide some curveballs to your blue

866
00:26:59,679 --> 00:27:01,600
team right this is for their benefit but

867
00:27:01,600 --> 00:27:03,919
if you keep spoon feeding a mimikats.exe

868
00:27:03,919 --> 00:27:05,279
every single time it's not going to help

869
00:27:05,279 --> 00:27:07,279
them right

870
00:27:07,279 --> 00:27:10,080
the one year i took mimikats we used

871
00:27:10,080 --> 00:27:13,360
kiwi right for metasploit we used

872
00:27:13,360 --> 00:27:16,400
encoded powershell

873
00:27:16,400 --> 00:27:18,240
serving up mimikats and we used good

874
00:27:18,240 --> 00:27:19,760
old-fashioned mimikats to command line

875
00:27:19,760 --> 00:27:22,159
but it was obfuscated recompiled right

876
00:27:22,159 --> 00:27:23,840
get them focusing on the behaviors but

877
00:27:23,840 --> 00:27:25,679
if you have to up level people go ahead

878
00:27:25,679 --> 00:27:27,279
and give them the softballs the easier

879
00:27:27,279 --> 00:27:29,120
pieces of it but then keep tweaking it a

880
00:27:29,120 --> 00:27:30,640
little bit more to give make it a little

881
00:27:30,640 --> 00:27:32,080
bit harder you have those data sets

882
00:27:32,080 --> 00:27:33,440
hopefully if you're doing this you're

883
00:27:33,440 --> 00:27:34,720
storing those data sets you can always

884
00:27:34,720 --> 00:27:37,360
replay them later for them

885
00:27:37,360 --> 00:27:39,440
to recon or not recon i don't care about

886
00:27:39,440 --> 00:27:40,960
recon unless i want to highlight sloppy

887
00:27:40,960 --> 00:27:42,640
trade craft again that depends on your

888
00:27:42,640 --> 00:27:44,799
organization but i do care about recon

889
00:27:44,799 --> 00:27:47,360
once i get a foothold because chances

890
00:27:47,360 --> 00:27:48,960
are when they get a foothold they don't

891
00:27:48,960 --> 00:27:50,080
necessarily know where they're at i

892
00:27:50,080 --> 00:27:51,520
think that was a theme i heard earlier

893
00:27:51,520 --> 00:27:52,640
this week as well the first thing you're

894
00:27:52,640 --> 00:27:54,320
going to do is start poking around

895
00:27:54,320 --> 00:27:55,679
that's the place to go ahead and start

896
00:27:55,679 --> 00:27:57,520
focusing on the recon pieces of it again

897
00:27:57,520 --> 00:27:58,720
that's a good way to shave a little bit

898
00:27:58,720 --> 00:28:03,039
of time and energy off of this

899
00:28:03,039 --> 00:28:05,120
virtual physical or cloud where do i

900
00:28:05,120 --> 00:28:07,039
build my infrastructure

901
00:28:07,039 --> 00:28:08,559
the answer

902
00:28:08,559 --> 00:28:10,799
after multiple years of doing this is i

903
00:28:10,799 --> 00:28:12,320
don't care

904
00:28:12,320 --> 00:28:14,399
okay do it where it is cost effective

905
00:28:14,399 --> 00:28:17,120
for you and it is easy for you back to

906
00:28:17,120 --> 00:28:20,320
that struggle with keeping it real

907
00:28:20,320 --> 00:28:21,919
for a while there i was concerned about

908
00:28:21,919 --> 00:28:24,159
man it says vmware in my in my network

909
00:28:24,159 --> 00:28:26,159
stack man it says aws in my network

910
00:28:26,159 --> 00:28:27,919
stack it says google on my network stack

911
00:28:27,919 --> 00:28:30,240
what am i going to do

912
00:28:30,240 --> 00:28:32,240
don't worry about that okay that's part

913
00:28:32,240 --> 00:28:33,760
of the okay look we're going to accept

914
00:28:33,760 --> 00:28:35,520
that those pieces are in place but what

915
00:28:35,520 --> 00:28:37,279
we're trying to do is provide an always

916
00:28:37,279 --> 00:28:38,960
on always available environment that's

917
00:28:38,960 --> 00:28:41,520
going to just work right

918
00:28:41,520 --> 00:28:43,679
i ran a hybrid environment that adfs

919
00:28:43,679 --> 00:28:45,200
environment had active directory with

920
00:28:45,200 --> 00:28:47,760
azure connecting to aed azure ad and

921
00:28:47,760 --> 00:28:49,440
that worked much better than me running

922
00:28:49,440 --> 00:28:51,360
it on my laptop

923
00:28:51,360 --> 00:28:53,200
in a virtual machine and having the sock

924
00:28:53,200 --> 00:28:54,880
call me and saying what exactly are you

925
00:28:54,880 --> 00:28:56,720
doing on your virtual machine on this

926
00:28:56,720 --> 00:28:58,640
laptop because boy it sure looks a

927
00:28:58,640 --> 00:28:59,840
little bit odd

928
00:28:59,840 --> 00:29:01,919
right take the burden off the sock take

929
00:29:01,919 --> 00:29:03,600
the burden off for yourself and if you

930
00:29:03,600 --> 00:29:04,880
put in the cloud that's fine if you put

931
00:29:04,880 --> 00:29:06,640
it on your extra machines or some vms

932
00:29:06,640 --> 00:29:09,039
that's fine too just do whatever feels

933
00:29:09,039 --> 00:29:11,360
right there

934
00:29:11,360 --> 00:29:13,120
now we talked a lot about the adversary

935
00:29:13,120 --> 00:29:14,880
side of this let's talk really briefly

936
00:29:14,880 --> 00:29:16,320
about the character development on the

937
00:29:16,320 --> 00:29:18,240
other side of this okay when you're

938
00:29:18,240 --> 00:29:20,240
building your victim organization and

939
00:29:20,240 --> 00:29:21,520
you could potentially launch these

940
00:29:21,520 --> 00:29:22,720
things obviously against your own

941
00:29:22,720 --> 00:29:25,200
organization that seems pretty bold but

942
00:29:25,200 --> 00:29:27,120
you could do that

943
00:29:27,120 --> 00:29:29,520
we stood up a fictional organization

944
00:29:29,520 --> 00:29:30,799
but the thing that's important to know

945
00:29:30,799 --> 00:29:32,720
about this is the goal is not to shame

946
00:29:32,720 --> 00:29:34,640
the organization and the goal is not to

947
00:29:34,640 --> 00:29:36,559
shame the individual okay there are

948
00:29:36,559 --> 00:29:38,799
people's roles who have to open things

949
00:29:38,799 --> 00:29:40,159
that are coming off the internet and

950
00:29:40,159 --> 00:29:42,399
things sometimes bad will happen

951
00:29:42,399 --> 00:29:43,919
right we want to use representative

952
00:29:43,919 --> 00:29:45,360
personas everybody has a finance

953
00:29:45,360 --> 00:29:47,440
organization accounting organization

954
00:29:47,440 --> 00:29:50,080
marketing organization i t r d

955
00:29:50,080 --> 00:29:51,679
representative personas was kind of the

956
00:29:51,679 --> 00:29:53,360
way we went through this and that worked

957
00:29:53,360 --> 00:29:54,960
very very well and also it kind of

958
00:29:54,960 --> 00:29:56,720
helped keep our

959
00:29:56,720 --> 00:29:59,200
scenarios relatively tight rather than

960
00:29:59,200 --> 00:30:00,720
worrying about a hundred or a thousand

961
00:30:00,720 --> 00:30:01,760
or ten thousand people those

962
00:30:01,760 --> 00:30:04,720
representative personas can can be that

963
00:30:04,720 --> 00:30:06,399
those uh force multipliers for those

964
00:30:06,399 --> 00:30:07,600
different people

965
00:30:07,600 --> 00:30:09,360
and then when things change over time

966
00:30:09,360 --> 00:30:10,880
you're going to have continuity checks

967
00:30:10,880 --> 00:30:12,799
when we went to remote right we had to

968
00:30:12,799 --> 00:30:16,320
worry about that when we went to um

969
00:30:16,320 --> 00:30:18,480
we decided to look at kubernetes okay

970
00:30:18,480 --> 00:30:20,159
again going into some more of the cloud

971
00:30:20,159 --> 00:30:22,399
technologies we put a developer into our

972
00:30:22,399 --> 00:30:23,679
storyline so they were going to work on

973
00:30:23,679 --> 00:30:25,120
spinning up a kubernetes environment and

974
00:30:25,120 --> 00:30:28,000
of course default versus secure right so

975
00:30:28,000 --> 00:30:29,120
those are the kinds of things that you

976
00:30:29,120 --> 00:30:30,399
can do with this from a character

977
00:30:30,399 --> 00:30:32,320
perspective as well

978
00:30:32,320 --> 00:30:33,840
so

979
00:30:33,840 --> 00:30:36,080
a couple last thoughts here you're not

980
00:30:36,080 --> 00:30:38,080
going to attain perfection okay for

981
00:30:38,080 --> 00:30:39,200
starters you probably won't have the

982
00:30:39,200 --> 00:30:40,399
custom malware if you're trying to go

983
00:30:40,399 --> 00:30:42,640
ahead and go after that

984
00:30:42,640 --> 00:30:44,320
you may not have every tool available to

985
00:30:44,320 --> 00:30:45,840
you just find the workarounds that's

986
00:30:45,840 --> 00:30:46,880
okay

987
00:30:46,880 --> 00:30:49,200
stay focused on those goals again even

988
00:30:49,200 --> 00:30:50,399
if i don't build out the whole narrative

989
00:30:50,399 --> 00:30:51,600
what are the goals what are the things i

990
00:30:51,600 --> 00:30:53,039
want to achieve

991
00:30:53,039 --> 00:30:55,120
focus on defensive side visibility and

992
00:30:55,120 --> 00:30:57,120
then the risk of diminishing returns is

993
00:30:57,120 --> 00:31:00,559
real okay i built at least two

994
00:31:00,559 --> 00:31:02,399
applications that were customer

995
00:31:02,399 --> 00:31:05,360
databases and and what would be the

996
00:31:05,360 --> 00:31:09,200
solarigate compromised application

997
00:31:09,200 --> 00:31:10,799
right basically a trigger point the

998
00:31:10,799 --> 00:31:12,320
amount of time i put into those

999
00:31:12,320 --> 00:31:14,080
applications for the amount of logging

1000
00:31:14,080 --> 00:31:16,559
and visibility i got back out of it was

1001
00:31:16,559 --> 00:31:19,120
teeny tiny we didn't do ci cd but i just

1002
00:31:19,120 --> 00:31:20,559
didn't get as much out of that as i did

1003
00:31:20,559 --> 00:31:22,559
so just be careful as to where am i

1004
00:31:22,559 --> 00:31:24,159
going to start my scenario where do i

1005
00:31:24,159 --> 00:31:25,919
end it what am i trying to achieve and

1006
00:31:25,919 --> 00:31:28,080
then calibrate that part of it because

1007
00:31:28,080 --> 00:31:29,600
again this can become a tremendous

1008
00:31:29,600 --> 00:31:32,080
amount of time if you don't do it right

1009
00:31:32,080 --> 00:31:33,919
last thoughts

1010
00:31:33,919 --> 00:31:35,679
focus on the goals the techniques will

1011
00:31:35,679 --> 00:31:37,360
come along whether they're attack varus

1012
00:31:37,360 --> 00:31:38,960
whatever leverage your threat

1013
00:31:38,960 --> 00:31:40,320
intelligence if you don't have threat

1014
00:31:40,320 --> 00:31:41,840
intelligence open source is better than

1015
00:31:41,840 --> 00:31:44,240
nothing but make sure the adversary fits

1016
00:31:44,240 --> 00:31:46,480
you and your organization

1017
00:31:46,480 --> 00:31:48,159
individual techniques are great but if

1018
00:31:48,159 --> 00:31:49,600
you can go ahead and put them together

1019
00:31:49,600 --> 00:31:51,360
and put sequences of them together hey

1020
00:31:51,360 --> 00:31:52,960
first this happens then this happens and

1021
00:31:52,960 --> 00:31:54,880
this happens that up levels that that

1022
00:31:54,880 --> 00:31:56,480
blue team to understand those pieces

1023
00:31:56,480 --> 00:31:58,399
fitting together and then most

1024
00:31:58,399 --> 00:31:59,840
importantly

1025
00:31:59,840 --> 00:32:01,440
identify those gaps in the data if

1026
00:32:01,440 --> 00:32:02,720
you're doing something and you go wait a

1027
00:32:02,720 --> 00:32:04,159
second i see this i see this and i'm

1028
00:32:04,159 --> 00:32:05,440
missing this

1029
00:32:05,440 --> 00:32:06,720
you need to go ahead and improve your

1030
00:32:06,720 --> 00:32:08,320
logging to create that visibility so i

1031
00:32:08,320 --> 00:32:10,159
can hunt so i can detect

1032
00:32:10,159 --> 00:32:12,159
focus on that upper end of the pyramid

1033
00:32:12,159 --> 00:32:14,080
right for adversary emulation the lower

1034
00:32:14,080 --> 00:32:16,080
half i can change very very easily the

1035
00:32:16,080 --> 00:32:17,600
ttps are tough to change for the

1036
00:32:17,600 --> 00:32:18,960
adversary they're tough for you to

1037
00:32:18,960 --> 00:32:20,880
detect but you can go ahead and overcome

1038
00:32:20,880 --> 00:32:21,919
that

1039
00:32:21,919 --> 00:32:23,840
with that i think i have a few minutes

1040
00:32:23,840 --> 00:32:26,720
left for questions um thank you for

1041
00:32:26,720 --> 00:32:28,320
having me here and hopefully this was

1042
00:32:28,320 --> 00:32:29,400
helpful

1043
00:32:29,400 --> 00:32:36,799
[Applause]

1044
00:32:36,799 --> 00:32:40,480
yes thank you john

1045
00:32:40,640 --> 00:32:42,399
we have a few minutes for

1046
00:32:42,399 --> 00:32:45,360
questions questions or comments please

1047
00:32:45,360 --> 00:32:48,480
approach the microphones we have

1048
00:32:48,480 --> 00:32:50,480
i think four in the

1049
00:32:50,480 --> 00:32:54,480
in the room so if you have anything

1050
00:32:57,200 --> 00:32:59,519
go ahead hey really good talk really

1051
00:32:59,519 --> 00:33:01,679
really good talk um i don't know if the

1052
00:33:01,679 --> 00:33:04,000
question is such but um maybe i can just

1053
00:33:04,000 --> 00:33:05,519
give you a quick overview i lead a

1054
00:33:05,519 --> 00:33:07,360
security response team sees oxy

1055
00:33:07,360 --> 00:33:08,640
architectural engineering there's

1056
00:33:08,640 --> 00:33:10,640
obviously conflict between detections

1057
00:33:10,640 --> 00:33:12,480
being onboarded people

1058
00:33:12,480 --> 00:33:14,000
creating detections kind of following

1059
00:33:14,000 --> 00:33:16,000
some of the methodology you outlined not

1060
00:33:16,000 --> 00:33:18,000
really eating drawn dog food and you

1061
00:33:18,000 --> 00:33:19,600
don't necessarily understand whether the

1062
00:33:19,600 --> 00:33:21,120
new detections are analytically

1063
00:33:21,120 --> 00:33:23,039
tractable there's all these kind of

1064
00:33:23,039 --> 00:33:26,320
conflicts right incentive conflicts and

1065
00:33:26,320 --> 00:33:27,760
we're struggling with how to do that

1066
00:33:27,760 --> 00:33:29,600
right whether the detection would make

1067
00:33:29,600 --> 00:33:31,840
sense there's a risk

1068
00:33:31,840 --> 00:33:33,600
and it should have human eyes and you

1069
00:33:33,600 --> 00:33:34,880
know how do you treat that with a first

1070
00:33:34,880 --> 00:33:36,559
in first out cue do you just keep

1071
00:33:36,559 --> 00:33:38,080
passing them in and just hope someone

1072
00:33:38,080 --> 00:33:40,080
gets there eventually do you have strict

1073
00:33:40,080 --> 00:33:42,159
guidelines around a lot of fidelity do

1074
00:33:42,159 --> 00:33:43,600
you have different cues some that are

1075
00:33:43,600 --> 00:33:45,760
best effort whereas others are you know

1076
00:33:45,760 --> 00:33:48,159
sla driven so i'm kind of ranting here

1077
00:33:48,159 --> 00:33:50,080
small bit but i just wanna dump some of

1078
00:33:50,080 --> 00:33:51,360
that on you and just kind of get your

1079
00:33:51,360 --> 00:33:53,200
thoughts on how you see that working

1080
00:33:53,200 --> 00:33:54,399
well

1081
00:33:54,399 --> 00:33:56,080
yeah that's

1082
00:33:56,080 --> 00:33:57,679
yeah that's a that's a tougher one in a

1083
00:33:57,679 --> 00:34:01,519
larger conversation i think um

1084
00:34:02,799 --> 00:34:05,799
there's

1085
00:34:06,559 --> 00:34:08,320
if you feel like it's something i was

1086
00:34:08,320 --> 00:34:10,079
going to say i mean the the the dumping

1087
00:34:10,079 --> 00:34:11,839
it in and saying best effort

1088
00:34:11,839 --> 00:34:13,440
you know rather than just getting rid of

1089
00:34:13,440 --> 00:34:15,280
it that's certainly not

1090
00:34:15,280 --> 00:34:16,480
you know that's certainly valid that's

1091
00:34:16,480 --> 00:34:17,679
certainly okay

1092
00:34:17,679 --> 00:34:19,520
um from that perspective i guess the

1093
00:34:19,520 --> 00:34:21,918
question i'd have is is that if you have

1094
00:34:21,918 --> 00:34:23,359
that many things that are creating that

1095
00:34:23,359 --> 00:34:25,040
many false positives and that noise that

1096
00:34:25,040 --> 00:34:26,879
much noise then then clearly the

1097
00:34:26,879 --> 00:34:30,159
fidelity isn't there right um

1098
00:34:30,159 --> 00:34:31,760
if it's something that you can go ahead

1099
00:34:31,760 --> 00:34:34,000
and use and maybe qualify as hunting

1100
00:34:34,000 --> 00:34:35,199
queries for lack of a better way to

1101
00:34:35,199 --> 00:34:37,040
describe it you need to say okay we're

1102
00:34:37,040 --> 00:34:39,679
going to go ahead and use these as being

1103
00:34:39,679 --> 00:34:41,359
you know these are not these are not the

1104
00:34:41,359 --> 00:34:42,800
best of the best alerts these are not

1105
00:34:42,800 --> 00:34:44,320
the ones that i can give to my tier ones

1106
00:34:44,320 --> 00:34:45,359
but these are things that i could go

1107
00:34:45,359 --> 00:34:47,520
ahead and say hey

1108
00:34:47,520 --> 00:34:48,879
we're going to save these don't do it

1109
00:34:48,879 --> 00:34:50,480
friday afternoon right but you know

1110
00:34:50,480 --> 00:34:52,239
wednesday afternoon we're going to go

1111
00:34:52,239 --> 00:34:54,320
ahead and kind of focus on these and and

1112
00:34:54,320 --> 00:34:56,560
work through this with the objective of

1113
00:34:56,560 --> 00:34:57,920
saying okay

1114
00:34:57,920 --> 00:34:59,760
you know 50 of these were false

1115
00:34:59,760 --> 00:35:01,680
positives why were they false positives

1116
00:35:01,680 --> 00:35:04,480
right um you know 50 of them were were

1117
00:35:04,480 --> 00:35:06,000
good and interesting why were they

1118
00:35:06,000 --> 00:35:07,520
interesting and then utilize that to

1119
00:35:07,520 --> 00:35:08,800
refine those

1120
00:35:08,800 --> 00:35:09,599
um

1121
00:35:09,599 --> 00:35:10,560
you're going to have some things that

1122
00:35:10,560 --> 00:35:12,240
are going to be hunting queries for sure

1123
00:35:12,240 --> 00:35:13,520
that's just kind of like

1124
00:35:13,520 --> 00:35:15,839
these are not going to be these are not

1125
00:35:15,839 --> 00:35:16,800
going to be winners they're not going to

1126
00:35:16,800 --> 00:35:18,560
hit it ahead of hit it out every single

1127
00:35:18,560 --> 00:35:19,520
time but

1128
00:35:19,520 --> 00:35:20,800
you know on occasion i'll go ahead and

1129
00:35:20,800 --> 00:35:22,560
get something if you use it like that

1130
00:35:22,560 --> 00:35:24,400
that might be a good way to do it that

1131
00:35:24,400 --> 00:35:26,400
also then gets into

1132
00:35:26,400 --> 00:35:28,079
what

1133
00:35:28,079 --> 00:35:29,760
how those alerts and how are being

1134
00:35:29,760 --> 00:35:32,000
tagged so that are they ending up at a

1135
00:35:32,000 --> 00:35:33,760
tier if they're ending a tier one queue

1136
00:35:33,760 --> 00:35:35,280
that's problematic right so the first

1137
00:35:35,280 --> 00:35:36,720
thing to do is you've got to figure out

1138
00:35:36,720 --> 00:35:38,560
a way to get out of those from a tech

1139
00:35:38,560 --> 00:35:40,480
perspective that depends as to what tech

1140
00:35:40,480 --> 00:35:42,480
you're running to be able to do that um

1141
00:35:42,480 --> 00:35:44,320
but maybe that's some to me that might

1142
00:35:44,320 --> 00:35:45,680
be something where i'd go ahead and just

1143
00:35:45,680 --> 00:35:47,040
say you know what we're going to define

1144
00:35:47,040 --> 00:35:48,560
these as hunting queries we're going to

1145
00:35:48,560 --> 00:35:50,160
work through them we're going to try to

1146
00:35:50,160 --> 00:35:51,760
determine why they're hunting queries if

1147
00:35:51,760 --> 00:35:53,280
they actually even are at that point and

1148
00:35:53,280 --> 00:35:55,040
then if they're not retiring if they are

1149
00:35:55,040 --> 00:35:57,040
we're going to tag them as such and then

1150
00:35:57,040 --> 00:35:59,119
you know we'll figure out a

1151
00:35:59,119 --> 00:36:01,200
method and a timing to run those and to

1152
00:36:01,200 --> 00:36:03,359
look at those from there so that's

1153
00:36:03,359 --> 00:36:06,960
my two cents awesome thank you

1154
00:36:07,760 --> 00:36:08,880
thank you

1155
00:36:08,880 --> 00:36:09,680
well

1156
00:36:09,680 --> 00:36:11,280
time is up but

1157
00:36:11,280 --> 00:36:12,880
anyone else

1158
00:36:12,880 --> 00:36:16,079
wants a final question or comment no

1159
00:36:16,079 --> 00:36:17,680
and i'll be sticking around here so if

1160
00:36:17,680 --> 00:36:18,880
anybody has any other questions wants to

1161
00:36:18,880 --> 00:36:20,640
talk offline particularly about the sad

1162
00:36:20,640 --> 00:36:22,480
timing music happy to do that as well

1163
00:36:22,480 --> 00:36:23,599
thanks

1164
00:36:23,599 --> 00:36:25,840
thank you very much

1165
00:36:25,840 --> 00:36:30,489
[Applause]

