1
00:00:00,090 --> 00:00:01,310
[Applause]

2
00:00:01,310 --> 00:00:04,560
okay thanks for coming in here my talk

3
00:00:04,560 --> 00:00:07,740
so it's a start a company my

4
00:00:07,740 --> 00:00:09,300
presentation is not about my company but

5
00:00:09,300 --> 00:00:10,920
if you want to read more about you could

6
00:00:10,920 --> 00:00:13,849
go here still a bit in stealth mode but

7
00:00:13,849 --> 00:00:16,109
keep a sign up for my mailing lists

8
00:00:16,109 --> 00:00:18,060
there tell me more about it going on if

9
00:00:18,060 --> 00:00:19,949
you need to contact me you can also drop

10
00:00:19,949 --> 00:00:22,410
me an email at C HC 2017 at sandfly

11
00:00:22,410 --> 00:00:24,060
security as well I'll answer you or

12
00:00:24,060 --> 00:00:26,039
obviously I'll be here all weekend just

13
00:00:26,039 --> 00:00:27,090
come up and grab me it's not a problem

14
00:00:27,090 --> 00:00:28,470
at all

15
00:00:28,470 --> 00:00:30,599
as convention my background is really an

16
00:00:30,599 --> 00:00:32,250
intrusion detection systems and choose

17
00:00:32,250 --> 00:00:34,079
your prevention systems I got started at

18
00:00:34,079 --> 00:00:36,270
a small company in San Antonio Texas

19
00:00:36,270 --> 00:00:38,610
called wheel group corporation it was

20
00:00:38,610 --> 00:00:39,930
started by a bunch of guides of the air

21
00:00:39,930 --> 00:00:42,120
force information warfare Center we

22
00:00:42,120 --> 00:00:44,160
produced probably the first commercially

23
00:00:44,160 --> 00:00:45,719
successful intrusion detection system

24
00:00:45,719 --> 00:00:47,760
called net ranger we also wrote a

25
00:00:47,760 --> 00:00:49,350
security scanning product called net

26
00:00:49,350 --> 00:00:51,329
sonar I wrote the network attack

27
00:00:51,329 --> 00:00:52,829
libraries that were used in that product

28
00:00:52,829 --> 00:00:55,320
and we were bought by Cisco Systems we

29
00:00:55,320 --> 00:00:57,149
ended up moving up to Austin Texas when

30
00:00:57,149 --> 00:00:58,710
I started another company called sciatic

31
00:00:58,710 --> 00:01:02,430
software that did a real-time incident

32
00:01:02,430 --> 00:01:04,349
response system so when intrusion

33
00:01:04,349 --> 00:01:06,180
detection system sees an alarm our

34
00:01:06,180 --> 00:01:07,470
system would then connect to the hosts

35
00:01:07,470 --> 00:01:08,850
to see whether or not it was compromised

36
00:01:08,850 --> 00:01:10,140
and then it would tell you well if not

37
00:01:10,140 --> 00:01:11,729
the alarm was good or bad based on that

38
00:01:11,729 --> 00:01:13,860
information and finally I also did work

39
00:01:13,860 --> 00:01:15,240
for another company called tipping point

40
00:01:15,240 --> 00:01:16,920
technologies we produce a multi gigabit

41
00:01:16,920 --> 00:01:19,140
speed in line intrusion prevention

42
00:01:19,140 --> 00:01:21,030
system so that's kind of my background

43
00:01:21,030 --> 00:01:23,159
I've always grabbed it to growl to you

44
00:01:23,159 --> 00:01:25,229
towards the white hat side of things and

45
00:01:25,229 --> 00:01:26,670
then the process of working on this

46
00:01:26,670 --> 00:01:29,640
latest company here I discovered that

47
00:01:29,640 --> 00:01:31,799
there's a lot of basic things you can do

48
00:01:31,799 --> 00:01:34,740
to detect attacks on linux systems and a

49
00:01:34,740 --> 00:01:36,299
lot of people really get confused about

50
00:01:36,299 --> 00:01:37,979
what your priorities are and today this

51
00:01:37,979 --> 00:01:39,990
presentation is really about having you

52
00:01:39,990 --> 00:01:41,790
focus priorities on the basics of

53
00:01:41,790 --> 00:01:44,790
looking at your hosts in terms of what

54
00:01:44,790 --> 00:01:46,200
kind of stands out without really

55
00:01:46,200 --> 00:01:48,030
relying on all the marketing fluff

56
00:01:48,030 --> 00:01:50,100
around advanced persistent attacks and

57
00:01:50,100 --> 00:01:51,270
things like that so what you're gonna

58
00:01:51,270 --> 00:01:53,040
learn today is checking Linux systems

59
00:01:53,040 --> 00:01:55,020
for suspicious activity using basic

60
00:01:55,020 --> 00:01:57,149
tools and I mean basic I mean stuff

61
00:01:57,149 --> 00:01:58,920
that's already loaded on the box I'm

62
00:01:58,920 --> 00:02:00,030
gonna talk about a specially designed

63
00:02:00,030 --> 00:02:01,560
forensics kit or anything like I just

64
00:02:01,560 --> 00:02:03,630
talked about basic commands we're not

65
00:02:03,630 --> 00:02:04,710
gonna learn anything about zero-day

66
00:02:04,710 --> 00:02:06,390
exploits of ants persistent threats or

67
00:02:06,390 --> 00:02:07,710
any sort of stuff that the marketers

68
00:02:07,710 --> 00:02:09,389
you're trying to sell you because by and

69
00:02:09,389 --> 00:02:11,459
large I find if you can't find the basic

70
00:02:11,459 --> 00:02:12,180
stuff

71
00:02:12,180 --> 00:02:14,459
looking out for the creams are doing the

72
00:02:14,459 --> 00:02:15,629
first thing we're in the stars of what I

73
00:02:15,629 --> 00:02:18,150
call the thousand one rule what this is

74
00:02:18,150 --> 00:02:20,879
as we all know in the computer security

75
00:02:20,879 --> 00:02:22,290
world that defenders II know thousands

76
00:02:22,290 --> 00:02:25,049
ways to prevent people from getting on

77
00:02:25,049 --> 00:02:26,519
the host but attackers only need to know

78
00:02:26,519 --> 00:02:29,010
one way to get in okay thousand one so

79
00:02:29,010 --> 00:02:30,480
it's really really stacked against you

80
00:02:30,480 --> 00:02:32,250
in terms of doing defense that's why

81
00:02:32,250 --> 00:02:34,799
hackers have such good success rates cuz

82
00:02:34,799 --> 00:02:36,390
they need to just find one way to get in

83
00:02:36,390 --> 00:02:37,769
but what a lot of people don't realize

84
00:02:37,769 --> 00:02:41,370
is the flip side of this which is once

85
00:02:41,370 --> 00:02:43,890
the person gets into the host they need

86
00:02:43,890 --> 00:02:45,599
to know about thousands ways to cover

87
00:02:45,599 --> 00:02:48,120
their tracks and we need to spot them

88
00:02:48,120 --> 00:02:50,220
once and that's what a lot of people

89
00:02:50,220 --> 00:02:51,900
don't really recognize in terms of

90
00:02:51,900 --> 00:02:53,700
spotting attackers out of compromise the

91
00:02:53,700 --> 00:02:56,340
system it's very very very hard to get

92
00:02:56,340 --> 00:02:58,950
on to a host and not leave signs that

93
00:02:58,950 --> 00:03:00,840
you were there even if you got on with

94
00:03:00,840 --> 00:03:03,150
the most elite attack available you paid

95
00:03:03,150 --> 00:03:04,530
millions of dollars for off the black

96
00:03:04,530 --> 00:03:07,079
market once you get onto the host you're

97
00:03:07,079 --> 00:03:08,939
in my world you're in your world if

98
00:03:08,939 --> 00:03:10,319
you're the admin you know this systems

99
00:03:10,319 --> 00:03:12,150
better than the attackers do so that's

100
00:03:12,150 --> 00:03:15,170
what we're gonna be covering today

101
00:03:15,319 --> 00:03:17,940
firstly I want you to think about simple

102
00:03:17,940 --> 00:03:19,410
first and this was a saying that a

103
00:03:19,410 --> 00:03:21,569
general surgeon said that common

104
00:03:21,569 --> 00:03:23,310
problems are surprisingly common and

105
00:03:23,310 --> 00:03:25,019
this is kind of in a response to people

106
00:03:25,019 --> 00:03:27,659
who they feel like some upset chest and

107
00:03:27,659 --> 00:03:29,250
they go into Google and a half hour

108
00:03:29,250 --> 00:03:31,470
later they diagnose themselves as having

109
00:03:31,470 --> 00:03:33,690
Stage four pancreatic cancer but really

110
00:03:33,690 --> 00:03:35,280
they just say beer pizza they have

111
00:03:35,280 --> 00:03:38,400
indigestion right so always look at the

112
00:03:38,400 --> 00:03:39,930
comment first it's kind of like Occam's

113
00:03:39,930 --> 00:03:41,400
razor right let's not jump to

114
00:03:41,400 --> 00:03:43,379
conclusions so don't worry about

115
00:03:43,379 --> 00:03:45,180
advanced persistent threats I want you

116
00:03:45,180 --> 00:03:46,979
to worry about this is my acronym for

117
00:03:46,979 --> 00:03:50,010
day commonly run attacks preferred or

118
00:03:50,010 --> 00:03:54,419
crap okay don't worry about advanced

119
00:03:54,419 --> 00:03:56,280
stuff because if you can't spot the

120
00:03:56,280 --> 00:03:58,109
common things why are you worrying about

121
00:03:58,109 --> 00:03:59,849
all these other advanced things going on

122
00:03:59,849 --> 00:04:01,590
okay so that's gonna be the general

123
00:04:01,590 --> 00:04:05,459
theme were running with here now just to

124
00:04:05,459 --> 00:04:07,560
beat this dead horse one more time about

125
00:04:07,560 --> 00:04:10,290
zero day attacks what about right again

126
00:04:10,290 --> 00:04:11,849
mark any marketing marketing they push

127
00:04:11,849 --> 00:04:13,379
the stuff down your throat zero day

128
00:04:13,379 --> 00:04:15,629
attacks are relatively rare and really

129
00:04:15,629 --> 00:04:17,220
expensive I haven't looked at the market

130
00:04:17,220 --> 00:04:18,738
in awhile but last I checked I think

131
00:04:18,738 --> 00:04:22,169
Iowa zero-day attack that was really

132
00:04:22,169 --> 00:04:23,940
effective to compromise the host was it

133
00:04:23,940 --> 00:04:25,070
something like a half million new

134
00:04:25,070 --> 00:04:26,180
million dollars something like that I

135
00:04:26,180 --> 00:04:27,530
forgot what it is it's a really high

136
00:04:27,530 --> 00:04:29,440
number you know so talked about bugcrowd

137
00:04:29,440 --> 00:04:32,000
right if you could sell these types of

138
00:04:32,000 --> 00:04:33,800
attacks to various agencies you can make

139
00:04:33,800 --> 00:04:36,380
a lot of money so they're not common the

140
00:04:36,380 --> 00:04:38,030
common attacks that are out there they

141
00:04:38,030 --> 00:04:40,640
work and in terms of let's say nation

142
00:04:40,640 --> 00:04:42,080
state actor they've total deniability

143
00:04:42,080 --> 00:04:44,990
right anyone could run all over the

144
00:04:44,990 --> 00:04:47,690
place okay the other thing with these

145
00:04:47,690 --> 00:04:49,700
advanced attacks is that they're usually

146
00:04:49,700 --> 00:04:52,640
very particular about how and where they

147
00:04:52,640 --> 00:04:54,230
work right they're gonna be very

148
00:04:54,230 --> 00:04:55,760
specific version of a kernel operating

149
00:04:55,760 --> 00:04:58,880
system there me very specific versions

150
00:04:58,880 --> 00:05:00,680
of a software that you have loaded on

151
00:05:00,680 --> 00:05:02,780
the box and a lot of times if it's

152
00:05:02,780 --> 00:05:04,490
things aren't exactly the stars are in

153
00:05:04,490 --> 00:05:06,890
perfect alignment you can wreck the box

154
00:05:06,890 --> 00:05:08,840
or break the box so that's why in

155
00:05:08,840 --> 00:05:10,190
today's presentation I'm not really

156
00:05:10,190 --> 00:05:11,540
gonna be covering stealth rootkits

157
00:05:11,540 --> 00:05:12,920
because a lot of times they kind of fall

158
00:05:12,920 --> 00:05:14,300
into this category where they look

159
00:05:14,300 --> 00:05:17,420
really cool but once you run them and

160
00:05:17,420 --> 00:05:18,650
you try to install them you're gonna run

161
00:05:18,650 --> 00:05:20,000
into these problems of wrecking the

162
00:05:20,000 --> 00:05:21,740
system breaking the box causing these

163
00:05:21,740 --> 00:05:23,870
all these things going on and again gets

164
00:05:23,870 --> 00:05:25,490
back down to about a call a thousand one

165
00:05:25,490 --> 00:05:27,650
rule that even if they get on the box of

166
00:05:27,650 --> 00:05:29,690
that really advanced attack they still

167
00:05:29,690 --> 00:05:30,830
got to bring all their goodies along

168
00:05:30,830 --> 00:05:32,150
with them and they got to hide the fact

169
00:05:32,150 --> 00:05:33,350
that they were there and that's really

170
00:05:33,350 --> 00:05:36,710
really hard so the basic concepts are

171
00:05:36,710 --> 00:05:39,020
gonna work with number one computers are

172
00:05:39,020 --> 00:05:41,240
not spontaneous if it was working fine

173
00:05:41,240 --> 00:05:44,120
and then all of a sudden at 3 a.m. it's

174
00:05:44,120 --> 00:05:46,370
not working fine we should take a look

175
00:05:46,370 --> 00:05:48,800
which leads to the second point we're

176
00:05:48,800 --> 00:05:50,690
gonna focus first and what got our

177
00:05:50,690 --> 00:05:51,260
attention

178
00:05:51,260 --> 00:05:53,330
if the web servers crashed it's never

179
00:05:53,330 --> 00:05:56,000
crashed before or the print server crash

180
00:05:56,000 --> 00:05:58,400
never crashed before that's probably

181
00:05:58,400 --> 00:06:01,280
where the action is gonna be now when

182
00:06:01,280 --> 00:06:03,530
talking in terms of the actual ways

183
00:06:03,530 --> 00:06:05,060
hackers are gonna get on the system and

184
00:06:05,060 --> 00:06:07,160
remain there we're gonna they're all

185
00:06:07,160 --> 00:06:09,200
trying to do three things one they're

186
00:06:09,200 --> 00:06:11,090
gonna set up a directory usually to hide

187
00:06:11,090 --> 00:06:15,590
the goodies two to

188
00:06:15,590 --> 00:06:18,110
they're gonna have suspicious files you

189
00:06:18,110 --> 00:06:20,210
guys every files that they modified or

190
00:06:20,210 --> 00:06:21,710
files that they brought along with their

191
00:06:21,710 --> 00:06:23,450
kid in order to spread laterally through

192
00:06:23,450 --> 00:06:26,870
the network and finally they might start

193
00:06:26,870 --> 00:06:28,460
with some suspicious processes on there

194
00:06:28,460 --> 00:06:30,230
for botnets and things like that these

195
00:06:30,230 --> 00:06:31,580
are really the three things we're gonna

196
00:06:31,580 --> 00:06:32,990
focus all of our effort looking into

197
00:06:32,990 --> 00:06:35,060
directories files of processes using

198
00:06:35,060 --> 00:06:38,320
common tactics okay any questions so far

199
00:06:38,320 --> 00:06:43,520
no all right pretty straightforward so

200
00:06:43,520 --> 00:06:44,840
the basic commands are gonna run through

201
00:06:44,840 --> 00:06:46,400
again these are virtually loaded on

202
00:06:46,400 --> 00:06:47,990
every Linux operating system you're

203
00:06:47,990 --> 00:06:49,430
gonna find out there you'll notice that

204
00:06:49,430 --> 00:06:52,070
for reasons in this talk we're not gonna

205
00:06:52,070 --> 00:06:53,690
do anything special unique this is

206
00:06:53,690 --> 00:06:55,910
really made for the kind of thing where

207
00:06:55,910 --> 00:06:57,590
you're called to look into a host and

208
00:06:57,590 --> 00:06:59,540
you want to quickly take a gander around

209
00:06:59,540 --> 00:07:00,979
to see if there's something more that

210
00:07:00,979 --> 00:07:03,050
needs to be taken advantage of kind of

211
00:07:03,050 --> 00:07:06,770
like fast forensics type deal first

212
00:07:06,770 --> 00:07:09,229
thing here is always a suspicious

213
00:07:09,229 --> 00:07:12,080
directories when I'm looking at various

214
00:07:12,080 --> 00:07:14,000
products and rootkits and exploits other

215
00:07:14,000 --> 00:07:16,639
things going on a general trend you will

216
00:07:16,639 --> 00:07:17,990
see over and over and over again

217
00:07:17,990 --> 00:07:20,210
these tools tend to target various

218
00:07:20,210 --> 00:07:21,890
directories of a common system the temp

219
00:07:21,890 --> 00:07:24,430
directories dab Devi's SH M which is a

220
00:07:24,430 --> 00:07:27,260
shared memory volatile directory there

221
00:07:27,260 --> 00:07:28,940
tend to throw things and bit in the bin

222
00:07:28,940 --> 00:07:30,740
directories the Lib directory it's also

223
00:07:30,740 --> 00:07:33,140
important and finally a couple things

224
00:07:33,140 --> 00:07:35,210
here var log they're almost always gonna

225
00:07:35,210 --> 00:07:36,380
go in there it's like a moth to flame

226
00:07:36,380 --> 00:07:38,060
they got to go message the blogs and

227
00:07:38,060 --> 00:07:39,890
finally web server directories

228
00:07:39,890 --> 00:07:41,210
privileged directories stuff like that

229
00:07:41,210 --> 00:07:43,010
tend to be lower on the list but I find

230
00:07:43,010 --> 00:07:45,020
the default rootkits the default

231
00:07:45,020 --> 00:07:47,180
compromise tactics the default automated

232
00:07:47,180 --> 00:07:49,280
attack scripts are trying to hit these

233
00:07:49,280 --> 00:07:51,169
standard system directories first so

234
00:07:51,169 --> 00:07:53,060
when you're starting to take a look on a

235
00:07:53,060 --> 00:07:55,130
system to see if there's a problem kind

236
00:07:55,130 --> 00:07:56,570
of start in these areas that's probably

237
00:07:56,570 --> 00:07:58,160
really gonna find the most situations

238
00:07:58,160 --> 00:08:03,919
that are gonna stand out suspicious

239
00:08:03,919 --> 00:08:06,260
directories they take pretty basic forms

240
00:08:06,260 --> 00:08:08,000
again this isn't rocket science here

241
00:08:08,000 --> 00:08:09,889
they're gonna try to look like an

242
00:08:09,889 --> 00:08:11,870
ordinary system directory that can be

243
00:08:11,870 --> 00:08:14,990
scattered in a directory that that's a

244
00:08:14,990 --> 00:08:16,220
system area that's always going to be

245
00:08:16,220 --> 00:08:18,320
present in it on every host so for

246
00:08:18,320 --> 00:08:19,639
instance if you're writing automated

247
00:08:19,639 --> 00:08:20,870
attack script you don't have to

248
00:08:20,870 --> 00:08:22,639
customize it all the time you're only

249
00:08:22,639 --> 00:08:24,140
gonna use directories that you know are

250
00:08:24,140 --> 00:08:25,700
gonna be present on every version of

251
00:08:25,700 --> 00:08:27,110
Linux that you're going to possibly be

252
00:08:27,110 --> 00:08:27,919
on

253
00:08:27,919 --> 00:08:29,689
okay and a lot of times these scripts if

254
00:08:29,689 --> 00:08:31,520
you ever watch on a honey pot they're

255
00:08:31,520 --> 00:08:33,110
being run by people alright that

256
00:08:33,110 --> 00:08:35,089
technically savvy sometimes you know you

257
00:08:35,089 --> 00:08:36,469
see making a lot of mistakes and they're

258
00:08:36,469 --> 00:08:37,880
typing and things like that so they want

259
00:08:37,880 --> 00:08:39,589
stuff that's very easy to run and it's

260
00:08:39,589 --> 00:08:41,240
gonna be something that it's gonna run

261
00:08:41,240 --> 00:08:42,769
reliably and the only way they can do

262
00:08:42,769 --> 00:08:44,600
that is use standard system directories

263
00:08:44,600 --> 00:08:46,250
you're gonna see a lot of weird

264
00:08:46,250 --> 00:08:48,019
permissions attributes and creation

265
00:08:48,019 --> 00:08:51,380
times one thing here too is it's not

266
00:08:51,380 --> 00:08:53,329
gonna match with a duplicate virtual OS

267
00:08:53,329 --> 00:08:55,399
image shows and I'm not gonna talk too

268
00:08:55,399 --> 00:08:57,050
much about that right now but one of the

269
00:08:57,050 --> 00:08:59,660
benefits we get to today is if you're

270
00:08:59,660 --> 00:09:02,300
looking on to a sent all seven box run

271
00:09:02,300 --> 00:09:04,070
an image on your local machine if you

272
00:09:04,070 --> 00:09:06,019
ever have a question just look at the

273
00:09:06,019 --> 00:09:07,940
virtual image and you know immediately

274
00:09:07,940 --> 00:09:09,980
that there's a problem so it's a very

275
00:09:09,980 --> 00:09:11,720
handy tool to keep virtual box loaded

276
00:09:11,720 --> 00:09:13,220
around with the basic installs there

277
00:09:13,220 --> 00:09:15,140
it's it's way easier than you think

278
00:09:15,140 --> 00:09:16,640
about ten years ago I mean you had to

279
00:09:16,640 --> 00:09:18,800
have you know a full image set off you'd

280
00:09:18,800 --> 00:09:20,060
have to boot the machine all this stuff

281
00:09:20,060 --> 00:09:21,529
it was a real hassle today it's very

282
00:09:21,529 --> 00:09:23,899
very easy to have a virtual image of the

283
00:09:23,899 --> 00:09:25,370
operating system right next to you you

284
00:09:25,370 --> 00:09:27,019
can always go back to and refer if you

285
00:09:27,019 --> 00:09:29,240
think that there's a problem and finally

286
00:09:29,240 --> 00:09:30,320
these directories are always going to

287
00:09:30,320 --> 00:09:31,880
find suspicious files and data which

288
00:09:31,880 --> 00:09:34,880
we're going to touch on so here's an

289
00:09:34,880 --> 00:09:36,589
example of a system that has some

290
00:09:36,589 --> 00:09:38,810
problems in the linux host you're

291
00:09:38,810 --> 00:09:40,760
typically gonna get dot and dot dot at

292
00:09:40,760 --> 00:09:42,050
the top of the directory but you see

293
00:09:42,050 --> 00:09:44,269
here this one has a whole bunch of

294
00:09:44,269 --> 00:09:46,519
problems as something here dot another

295
00:09:46,519 --> 00:09:48,829
one dot another one dot dot space dot

296
00:09:48,829 --> 00:09:50,959
dot dot another one would take dot dot

297
00:09:50,959 --> 00:09:53,660
dot dot dot dot thought question a dot

298
00:09:53,660 --> 00:09:55,130
dot with a special character on it I'm

299
00:09:55,130 --> 00:09:55,610
wrong

300
00:09:55,610 --> 00:09:57,440
very very common you're gonna see

301
00:09:57,440 --> 00:09:59,269
directories like this with a lot of the

302
00:09:59,269 --> 00:10:00,709
prepackaged rootkits a lot of

303
00:10:00,709 --> 00:10:03,140
prepackaged install scripts for various

304
00:10:03,140 --> 00:10:05,839
tools that are out there one quick way

305
00:10:05,839 --> 00:10:08,240
in order to make more sense of this is

306
00:10:08,240 --> 00:10:11,630
instead of using LS - al you can just

307
00:10:11,630 --> 00:10:14,390
throw a p on the end so LS that's a LP

308
00:10:14,390 --> 00:10:17,120
it will throw a handy slash behind a

309
00:10:17,120 --> 00:10:19,519
space or white space characters in the

310
00:10:19,519 --> 00:10:20,839
directory listing so now you get a

311
00:10:20,839 --> 00:10:22,130
better idea what's going on

312
00:10:22,130 --> 00:10:23,990
so this directory at the top is just

313
00:10:23,990 --> 00:10:27,110
called space here's one called space dot

314
00:10:27,110 --> 00:10:30,500
dot space dot dot space here's one dot

315
00:10:30,500 --> 00:10:32,449
dot dot try and look legit on and on and

316
00:10:32,449 --> 00:10:35,180
on but if you're not careful this is why

317
00:10:35,180 --> 00:10:37,699
I saying careful attention to detail if

318
00:10:37,699 --> 00:10:39,769
you did a directory listing you can have

319
00:10:39,769 --> 00:10:42,130
dot space it just fly right up

320
00:10:42,130 --> 00:10:43,690
and typically because a lot of these

321
00:10:43,690 --> 00:10:44,980
rootkits are about trying to hide the

322
00:10:44,980 --> 00:10:47,260
directories by doing kernel-level off

323
00:10:47,260 --> 00:10:50,500
you station it's something that you

324
00:10:50,500 --> 00:10:51,730
might miss if you're not being careful

325
00:10:51,730 --> 00:10:53,530
but it's something that if you know what

326
00:10:53,530 --> 00:10:55,300
to look for if you always look at the

327
00:10:55,300 --> 00:10:56,770
top of that directory see anything at

328
00:10:56,770 --> 00:10:58,360
the top that's standing out looks kind

329
00:10:58,360 --> 00:10:59,890
of weird this is a really good place you

330
00:10:59,890 --> 00:11:02,080
know - this is a really good command you

331
00:11:02,080 --> 00:11:03,160
can use to start kind of looking into

332
00:11:03,160 --> 00:11:06,370
what's going on other things that you're

333
00:11:06,370 --> 00:11:07,750
gonna find let's say you did find some

334
00:11:07,750 --> 00:11:09,370
suspicious directories in a particular

335
00:11:09,370 --> 00:11:11,170
area one of the next things you're gonna

336
00:11:11,170 --> 00:11:13,210
find are some of the kits that are out

337
00:11:13,210 --> 00:11:14,560
there especially some of the worms I'll

338
00:11:14,560 --> 00:11:16,150
start and use immutable Flags

339
00:11:16,150 --> 00:11:17,980
in order to maintain persistence on a

340
00:11:17,980 --> 00:11:20,320
host the immutable flag is set what that

341
00:11:20,320 --> 00:11:21,910
means is essentially you cannot delete

342
00:11:21,910 --> 00:11:23,860
that file with normal system commands

343
00:11:23,860 --> 00:11:25,750
it's what's called an extended

344
00:11:25,750 --> 00:11:27,760
filesystem attribute so you actually

345
00:11:27,760 --> 00:11:29,350
have to remove the immutable flag from

346
00:11:29,350 --> 00:11:31,570
the file and then run RM on it but this

347
00:11:31,570 --> 00:11:33,280
is a way that some of these worms are

348
00:11:33,280 --> 00:11:34,480
going around and maintaining their

349
00:11:34,480 --> 00:11:36,310
ability to stay on that system even

350
00:11:36,310 --> 00:11:38,410
between reboots you can use these a

351
00:11:38,410 --> 00:11:40,480
command on Linux called LS adder and

352
00:11:40,480 --> 00:11:42,820
this is basically the LS command but

353
00:11:42,820 --> 00:11:44,170
show me all the attributes extended

354
00:11:44,170 --> 00:11:46,030
attributes anything with an immutable

355
00:11:46,030 --> 00:11:48,000
flag it'll just show up isn't a like

356
00:11:48,000 --> 00:11:50,740
okay so here we have a mutable flag set

357
00:11:50,740 --> 00:11:53,020
on the directory called dot dot I would

358
00:11:53,020 --> 00:11:54,220
definitely want to look at that an

359
00:11:54,220 --> 00:11:56,650
immutable flag down here on bin dot

360
00:11:56,650 --> 00:11:59,200
fubar again anything like that is really

361
00:11:59,200 --> 00:12:01,270
odd it's not typical of Linux cuz

362
00:12:01,270 --> 00:12:02,830
setting immutable flags on things like

363
00:12:02,830 --> 00:12:04,990
this so again if you're looking at these

364
00:12:04,990 --> 00:12:06,880
system level directories you're starting

365
00:12:06,880 --> 00:12:08,230
to see a mutable flag set you're

366
00:12:08,230 --> 00:12:09,670
starting to see weird file attributes

367
00:12:09,670 --> 00:12:10,810
even some of these other attributes

368
00:12:10,810 --> 00:12:12,160
could be suspicious depending on the

369
00:12:12,160 --> 00:12:14,410
situation probably want to take a look

370
00:12:14,410 --> 00:12:16,709
at it

371
00:12:21,000 --> 00:12:23,519
okay next up usually when you start

372
00:12:23,519 --> 00:12:24,810
finding these directories you're gonna

373
00:12:24,810 --> 00:12:26,490
start finding suspicious files to go

374
00:12:26,490 --> 00:12:28,170
along with them and what do I mean

375
00:12:28,170 --> 00:12:29,970
suspicious files well it could be a lot

376
00:12:29,970 --> 00:12:31,500
of things usually it's gonna be missing

377
00:12:31,500 --> 00:12:33,959
or tampering audit log files it's a very

378
00:12:33,959 --> 00:12:36,329
common files that are not the type that

379
00:12:36,329 --> 00:12:38,069
they purport to be I'll tell you what I

380
00:12:38,069 --> 00:12:39,810
mean about that and finally you're gonna

381
00:12:39,810 --> 00:12:41,610
find binaries that are modified or in

382
00:12:41,610 --> 00:12:43,769
strange locations and this isn't a

383
00:12:43,769 --> 00:12:45,779
reverse engineering course so I will

384
00:12:45,779 --> 00:12:47,519
show you some basics behind some of that

385
00:12:47,519 --> 00:12:49,139
but we're not really gonna get into

386
00:12:49,139 --> 00:12:50,759
reverse engineering it but the main

387
00:12:50,759 --> 00:12:51,810
things you're gonna want to see is

388
00:12:51,810 --> 00:12:53,399
you're gonna see these top two things

389
00:12:53,399 --> 00:12:55,199
pretty commonly and systems that get

390
00:12:55,199 --> 00:12:57,269
broken into just in terms of people

391
00:12:57,269 --> 00:12:58,829
trying to cover their tracks and then

392
00:12:58,829 --> 00:13:00,389
again trying to hide what they're doing

393
00:13:00,389 --> 00:13:05,009
once they're on the system the audit

394
00:13:05,009 --> 00:13:08,129
logs are an extremely high-value target

395
00:13:08,129 --> 00:13:09,750
and you'd like you thinking yeah this is

396
00:13:09,750 --> 00:13:13,500
obvious right and it is obvious but it's

397
00:13:13,500 --> 00:13:14,699
also something a lot of people don't

398
00:13:14,699 --> 00:13:16,439
really pay attention to as a system

399
00:13:16,439 --> 00:13:18,709
admin it might not be a bad idea just

400
00:13:18,709 --> 00:13:21,360
casually if you log into a host just

401
00:13:21,360 --> 00:13:22,709
take a look in the bar log directory

402
00:13:22,709 --> 00:13:24,509
just really quickly just make sure it's

403
00:13:24,509 --> 00:13:27,000
everything looks right right even if you

404
00:13:27,000 --> 00:13:27,870
don't think there's anything wrong with

405
00:13:27,870 --> 00:13:29,850
the system just take a peek it's just

406
00:13:29,850 --> 00:13:32,009
the kind of a good habit to get into

407
00:13:32,009 --> 00:13:33,240
it's almost just like checking your car

408
00:13:33,240 --> 00:13:34,559
you checking the oil on your car every

409
00:13:34,559 --> 00:13:35,610
now and then to make sure it's not

410
00:13:35,610 --> 00:13:36,360
getting low

411
00:13:36,360 --> 00:13:38,790
this directories hit so often and so

412
00:13:38,790 --> 00:13:41,040
sloppily that a lot of compromised

413
00:13:41,040 --> 00:13:43,019
systems are found just by taking a quick

414
00:13:43,019 --> 00:13:44,910
look through here the big files are

415
00:13:44,910 --> 00:13:46,500
gonna be the W temp this is gonna show

416
00:13:46,500 --> 00:13:49,680
all your valid past logins last log this

417
00:13:49,680 --> 00:13:51,300
is a special file that's gonna show the

418
00:13:51,300 --> 00:13:53,879
last login for that for all the users on

419
00:13:53,879 --> 00:13:56,069
the host B temp which is something a lot

420
00:13:56,069 --> 00:13:57,540
of people don't necessarily know about

421
00:13:57,540 --> 00:13:59,269
this shows all the bad login attempts

422
00:13:59,269 --> 00:14:01,589
you temperatures all the current logins

423
00:14:01,589 --> 00:14:03,569
and of course various logs under the log

424
00:14:03,569 --> 00:14:05,339
directory these are all very very hot

425
00:14:05,339 --> 00:14:07,709
items for an attacker to want to get

426
00:14:07,709 --> 00:14:11,910
into in this case here I ran a log

427
00:14:11,910 --> 00:14:15,660
cleaner to remove a string an IP string

428
00:14:15,660 --> 00:14:17,699
for my logs and some of these tools are

429
00:14:17,699 --> 00:14:20,160
not very well written this one did such

430
00:14:20,160 --> 00:14:21,930
a good job cleaning my logs and it made

431
00:14:21,930 --> 00:14:25,709
all them zeros long okay again very

432
00:14:25,709 --> 00:14:26,970
common in fact some of them are quite

433
00:14:26,970 --> 00:14:28,170
delivered about it some of the worms

434
00:14:28,170 --> 00:14:30,720
that went out just will simply touch all

435
00:14:30,720 --> 00:14:32,089
out just

436
00:14:32,089 --> 00:14:33,319
we touch all the logs make them zero

437
00:14:33,319 --> 00:14:35,180
bytes and that's it they don't make any

438
00:14:35,180 --> 00:14:37,160
temp whatsoever to clean the logs

439
00:14:37,160 --> 00:14:39,350
because they know a lot of admins don't

440
00:14:39,350 --> 00:14:41,870
look but here's some perfect example of

441
00:14:41,870 --> 00:14:44,660
a syslog of a log cleaner gone bad you

442
00:14:44,660 --> 00:14:46,519
know zero byte audit logs always

443
00:14:46,519 --> 00:14:48,980
suspicious here's a beat temp file shows

444
00:14:48,980 --> 00:14:50,809
no bad log ends I don't know if you're

445
00:14:50,809 --> 00:14:52,779
on the internet you know many bad logins

446
00:14:52,779 --> 00:14:55,309
something's wrong right you're probably

447
00:14:55,309 --> 00:14:56,809
adding something no kernel messages

448
00:14:56,809 --> 00:14:58,910
again kernel logs empty right you don't

449
00:14:58,910 --> 00:15:00,529
reboot the system you never had a kernel

450
00:15:00,529 --> 00:15:03,699
error it's very odd here's log rotate it

451
00:15:03,699 --> 00:15:07,009
rotated to zero byte file and again this

452
00:15:07,009 --> 00:15:08,660
is an example of showing everything that

453
00:15:08,660 --> 00:15:09,980
could go wrong but any one of these

454
00:15:09,980 --> 00:15:11,720
things by itself to me could show a

455
00:15:11,720 --> 00:15:14,600
particular problem and finally here the

456
00:15:14,600 --> 00:15:16,519
date and the time are all identical

457
00:15:16,519 --> 00:15:19,939
right October 25th at 0 0 55 that would

458
00:15:19,939 --> 00:15:22,040
be a really good time to look on your

459
00:15:22,040 --> 00:15:24,860
system right just to see if someone's

460
00:15:24,860 --> 00:15:26,749
been around in about 55 minutes after

461
00:15:26,749 --> 00:15:28,100
midnight that's a really good time to

462
00:15:28,100 --> 00:15:30,470
start looking but this is an example

463
00:15:30,470 --> 00:15:32,300
again of just one log cleaner that's

464
00:15:32,300 --> 00:15:34,939
screwed off but any one of these things

465
00:15:34,939 --> 00:15:38,300
I've seen various mixes iterations that

466
00:15:38,300 --> 00:15:40,699
show this same type of situation going

467
00:15:40,699 --> 00:15:42,410
on here very poor log clean and we're

468
00:15:42,410 --> 00:15:43,759
making no attempt at all to clean things

469
00:15:43,759 --> 00:15:46,129
up but this is a surefire indicator that

470
00:15:46,129 --> 00:15:47,509
there's something going on with this box

471
00:15:47,509 --> 00:15:54,470
I can read up look into now after I find

472
00:15:54,470 --> 00:15:56,569
for instance that maybe a logged rail

473
00:15:56,569 --> 00:15:58,790
directory looks a little odd one of the

474
00:15:58,790 --> 00:16:00,199
next things I like doing is just taking

475
00:16:00,199 --> 00:16:02,149
a quick look at the temp directory the

476
00:16:02,149 --> 00:16:03,679
temp directory because again it's on

477
00:16:03,679 --> 00:16:06,019
every Linux host on the planet it's very

478
00:16:06,019 --> 00:16:08,870
often used as a scratch pad for a lot of

479
00:16:08,870 --> 00:16:10,790
these attack tools the right temporary

480
00:16:10,790 --> 00:16:12,649
files in there to move things around

481
00:16:12,649 --> 00:16:14,269
they might keep dropping data in there

482
00:16:14,269 --> 00:16:17,269
on and on but also sometimes these tools

483
00:16:17,269 --> 00:16:19,519
fail again people bring food they bring

484
00:16:19,519 --> 00:16:21,980
the files over maybe precompiled or they

485
00:16:21,980 --> 00:16:23,899
could pile them on the box but not quite

486
00:16:23,899 --> 00:16:24,379
right

487
00:16:24,379 --> 00:16:26,329
something happens in this case here I

488
00:16:26,329 --> 00:16:28,249
look in the temp directory and I see a

489
00:16:28,249 --> 00:16:32,839
file called you temp dot back it's odd

490
00:16:32,839 --> 00:16:34,999
right you know this is pretty

491
00:16:34,999 --> 00:16:36,829
straightforward stuff but I've seen log

492
00:16:36,829 --> 00:16:38,149
cleaners leave things behind

493
00:16:38,149 --> 00:16:40,160
I seen system binaries left in here that

494
00:16:40,160 --> 00:16:41,660
have been renamed for instance a shell

495
00:16:41,660 --> 00:16:45,170
name dot s or dot T or dot whatever I

496
00:16:45,170 --> 00:16:45,529
mean

497
00:16:45,529 --> 00:16:48,019
did someone have a shell wiser Sean the

498
00:16:48,019 --> 00:16:49,670
temp directory why is there any command

499
00:16:49,670 --> 00:16:52,069
in a temp directory for that matter so

500
00:16:52,069 --> 00:16:53,540
you'll see this kind of thing a lot so

501
00:16:53,540 --> 00:16:55,790
this file was left by poorly written log

502
00:16:55,790 --> 00:16:58,249
cleaner that crashed at this point I now

503
00:16:58,249 --> 00:17:00,709
can say again maybe I have a good time

504
00:17:00,709 --> 00:17:03,139
to start September 5th 12 minutes after

505
00:17:03,139 --> 00:17:04,640
midnight would be a good time to start

506
00:17:04,640 --> 00:17:06,049
looking around on this system for any

507
00:17:06,049 --> 00:17:07,730
other particular files that might have

508
00:17:07,730 --> 00:17:12,439
shown up the other thing here now I've

509
00:17:12,439 --> 00:17:15,289
seen that you temp file I said ok well

510
00:17:15,289 --> 00:17:16,849
it's probably game on someone's probably

511
00:17:16,849 --> 00:17:18,589
run a log cleaner on my system what can

512
00:17:18,589 --> 00:17:20,900
I do with common system tools to start

513
00:17:20,900 --> 00:17:22,159
seeing if there's any other problems

514
00:17:22,159 --> 00:17:24,470
there's a really good one of Linux you

515
00:17:24,470 --> 00:17:27,439
temp dump you TMP dump what's cool about

516
00:17:27,439 --> 00:17:29,510
this utility is it just gives you a raw

517
00:17:29,510 --> 00:17:33,380
line-by-line dump of the W temp B temp

518
00:17:33,380 --> 00:17:36,260
and u temp files where if you run a

519
00:17:36,260 --> 00:17:40,100
command like last or W or who or

520
00:17:40,100 --> 00:17:42,230
whatever they try to format at the lake

521
00:17:42,230 --> 00:17:44,000
it make it look pretty and if

522
00:17:44,000 --> 00:17:46,039
something's been null doubt they just

523
00:17:46,039 --> 00:17:48,230
won't show it to you right so if you're

524
00:17:48,230 --> 00:17:50,390
running some of the older log cleaners

525
00:17:50,390 --> 00:17:51,710
we'll just take an entry and just

526
00:17:51,710 --> 00:17:53,840
overwrite it with zeros it's very common

527
00:17:53,840 --> 00:17:56,360
about half the log cleaners do this the

528
00:17:56,360 --> 00:17:58,039
better ones will actually delete the

529
00:17:58,039 --> 00:17:59,750
entry and then patched a file back

530
00:17:59,750 --> 00:18:01,280
together correctly but a lot of them

531
00:18:01,280 --> 00:18:03,830
dull so again an attacker they they go

532
00:18:03,830 --> 00:18:06,049
to whatever site it is they download log

533
00:18:06,049 --> 00:18:08,690
cleaner haic a PI out and work great and

534
00:18:08,690 --> 00:18:10,549
they run it on the host well if you just

535
00:18:10,549 --> 00:18:12,860
run w you're not gonna be able to see

536
00:18:12,860 --> 00:18:14,299
some things but whether you tempt up I

537
00:18:14,299 --> 00:18:15,770
can start seeing some interesting things

538
00:18:15,770 --> 00:18:18,169
here first of all this first column is

539
00:18:18,169 --> 00:18:21,230
showing the type of entry it is so for

540
00:18:21,230 --> 00:18:23,059
instance type 2 is a reboot this is a

541
00:18:23,059 --> 00:18:23,750
restart

542
00:18:23,750 --> 00:18:26,080
here are some logins type 6 and sevens

543
00:18:26,080 --> 00:18:28,549
sevens another log and type 8 is like a

544
00:18:28,549 --> 00:18:30,320
logout if I remember but then I get a

545
00:18:30,320 --> 00:18:34,480
type 0 type 0 is invalid and then it's

546
00:18:34,480 --> 00:18:36,620
again for the process ID it's all zeros

547
00:18:36,620 --> 00:18:38,480
these are all blank blank blank blank

548
00:18:38,480 --> 00:18:42,440
blank 0 0 0 another date all blank cuz

549
00:18:42,440 --> 00:18:44,419
someone overrode it and again this is

550
00:18:44,419 --> 00:18:45,320
the type of thing that wouldn't

551
00:18:45,320 --> 00:18:47,240
necessarily show up with the standard

552
00:18:47,240 --> 00:18:48,620
tools but you tempt up is more than

553
00:18:48,620 --> 00:18:50,630
happy to show that someone has come in

554
00:18:50,630 --> 00:18:52,580
here and over wrote that entry a bunch

555
00:18:52,580 --> 00:18:53,770
of nulls

556
00:18:53,770 --> 00:18:56,120
kind of taking it one step further using

557
00:18:56,120 --> 00:18:58,250
the same command against the B temp file

558
00:18:58,250 --> 00:19:00,860
I talked earlier how be temp is used for

559
00:19:00,860 --> 00:19:02,750
showing bad login attempts these are the

560
00:19:02,750 --> 00:19:04,370
attempts that should not have worked and

561
00:19:04,370 --> 00:19:05,660
your dad you're gonna get these all the

562
00:19:05,660 --> 00:19:08,300
time you could see CBM logged in all

563
00:19:08,300 --> 00:19:09,470
these scripts I mean if you're on the

564
00:19:09,470 --> 00:19:10,850
internet for two seconds you're gonna

565
00:19:10,850 --> 00:19:12,830
get hit with this type of stuff but then

566
00:19:12,830 --> 00:19:14,330
all of a sudden I start getting a bunch

567
00:19:14,330 --> 00:19:17,240
of this this this so someone went

568
00:19:17,240 --> 00:19:19,700
through and what that tells me is they

569
00:19:19,700 --> 00:19:21,530
picked a username they didn't want me to

570
00:19:21,530 --> 00:19:23,390
see that they logged in with whatever it

571
00:19:23,390 --> 00:19:25,670
was maybe some default user here wasn't

572
00:19:25,670 --> 00:19:27,140
CBM but it was something else

573
00:19:27,140 --> 00:19:28,400
and they decided to write over

574
00:19:28,400 --> 00:19:31,220
everything so the you temp dump command

575
00:19:31,220 --> 00:19:34,160
again shows this and the other commands

576
00:19:34,160 --> 00:19:36,290
on the system may or maybe not it might

577
00:19:36,290 --> 00:19:37,880
depend on the version but you typed up

578
00:19:37,880 --> 00:19:41,390
works on the WM B tab and you temp files

579
00:19:41,390 --> 00:19:42,860
to kind of show some these things going

580
00:19:42,860 --> 00:19:47,930
on it kind of showed comparison there's

581
00:19:47,930 --> 00:19:49,610
a command called last which shows last

582
00:19:49,610 --> 00:19:52,340
log and the last logins of all the users

583
00:19:52,340 --> 00:19:53,600
there's also the last B which shows all

584
00:19:53,600 --> 00:19:55,430
the bad log and so this is the same file

585
00:19:55,430 --> 00:19:57,410
here and in this case here this one

586
00:19:57,410 --> 00:19:58,880
actually did show a couple entries that

587
00:19:58,880 --> 00:20:01,040
are suspicious but maybe not quite as

588
00:20:01,040 --> 00:20:03,950
much detail as before I see January 1st

589
00:20:03,950 --> 00:20:05,900
years easy Rosie's here again someone

590
00:20:05,900 --> 00:20:07,130
blasted it you can kind of see the

591
00:20:07,130 --> 00:20:09,170
difference of what it shows this is what

592
00:20:09,170 --> 00:20:10,730
you temp dump which show you could see

593
00:20:10,730 --> 00:20:12,350
it's trying to show me IP address all

594
00:20:12,350 --> 00:20:17,150
these things the last beat command just

595
00:20:17,150 --> 00:20:19,370
misses some things there so it kind of

596
00:20:19,370 --> 00:20:20,630
shows the same thing but again you need

597
00:20:20,630 --> 00:20:22,010
to really be paying attention to make

598
00:20:22,010 --> 00:20:23,600
sure you're gonna notice it if you

599
00:20:23,600 --> 00:20:26,740
actually need to run this command

600
00:20:30,780 --> 00:20:32,940
other things to look into just

601
00:20:32,940 --> 00:20:35,130
generically to find suspicious files on

602
00:20:35,130 --> 00:20:37,860
Linux with the Red Hat and Debian

603
00:20:37,860 --> 00:20:39,809
variants it's very easy to find files

604
00:20:39,809 --> 00:20:41,429
that have been modified away from the

605
00:20:41,429 --> 00:20:43,679
base configuration on Red Hat there's a

606
00:20:43,679 --> 00:20:46,470
simple RPM command - OVA you grep it

607
00:20:46,470 --> 00:20:47,940
through this here it's gonna show you

608
00:20:47,940 --> 00:20:50,549
all the all the system files that were

609
00:20:50,549 --> 00:20:52,650
modified from the basic ones and here in

610
00:20:52,650 --> 00:20:55,409
this case SSH and a Bachelor are XI or

611
00:20:55,409 --> 00:20:57,960
bash RC have been changed from standard

612
00:20:57,960 --> 00:20:59,309
install I would probably want to go

613
00:20:59,309 --> 00:21:01,590
inspect those make sure something wasn't

614
00:21:01,590 --> 00:21:03,240
maliciously done especially when you see

615
00:21:03,240 --> 00:21:06,030
any type of shell Morgan's and things

616
00:21:06,030 --> 00:21:07,559
like show login scripts and stuff you

617
00:21:07,559 --> 00:21:08,460
want to make sure is looking in their

618
00:21:08,460 --> 00:21:10,620
malicious under Debian they have a

619
00:21:10,620 --> 00:21:12,630
command called Deb Psalms which is often

620
00:21:12,630 --> 00:21:14,730
not loaded by default but I recommend

621
00:21:14,730 --> 00:21:16,230
you do load it on your systems it's

622
00:21:16,230 --> 00:21:18,360
about 500k it's really really pretty

623
00:21:18,360 --> 00:21:20,610
small and here you can run it with a - C

624
00:21:20,610 --> 00:21:22,289
command and it'll show again all this is

625
00:21:22,289 --> 00:21:24,360
the binaries that are different from the

626
00:21:24,360 --> 00:21:26,669
system install time in this case here on

627
00:21:26,669 --> 00:21:30,600
this system use your S Pen note login is

628
00:21:30,600 --> 00:21:32,520
altered does anyone know why that might

629
00:21:32,520 --> 00:21:38,750
be important anyone come on speak up

630
00:21:38,750 --> 00:21:41,520
that's right what happened here is

631
00:21:41,520 --> 00:21:44,970
someone this was replaced with a bash

632
00:21:44,970 --> 00:21:47,340
login shell so when you look at their

633
00:21:47,340 --> 00:21:48,600
Etsy password it looks like they can't

634
00:21:48,600 --> 00:21:51,750
login but they can so just kind of you

635
00:21:51,750 --> 00:21:53,400
know again simple things just an

636
00:21:53,400 --> 00:21:54,539
attention to detail

637
00:21:54,539 --> 00:21:56,100
this can help you spot a lot of

638
00:21:56,100 --> 00:21:59,750
potential problems on the system

639
00:22:03,950 --> 00:22:06,410
okay any questions so far I know rolling

640
00:22:06,410 --> 00:22:08,090
through fast and this could be the kind

641
00:22:08,090 --> 00:22:09,320
of thing where I can make it a full day

642
00:22:09,320 --> 00:22:11,810
training anyone have any particular

643
00:22:11,810 --> 00:22:16,149
questions or anything mid break yes

644
00:22:21,430 --> 00:22:24,050
that's a good question I don't know I'd

645
00:22:24,050 --> 00:22:26,210
hide up and run it to see I'd have to

646
00:22:26,210 --> 00:22:28,070
run it to see what it would do

647
00:22:28,070 --> 00:22:30,020
there's too many variants you know it's

648
00:22:30,020 --> 00:22:32,960
one of these things where each package

649
00:22:32,960 --> 00:22:36,590
installer it should be right it should

650
00:22:36,590 --> 00:22:43,689
look okay but I don't know yes

651
00:22:46,230 --> 00:22:48,830
yeah

652
00:22:52,520 --> 00:22:55,620
yeah they can you know and somewhat log

653
00:22:55,620 --> 00:22:57,750
files are kind of in a weird format so

654
00:22:57,750 --> 00:22:59,730
like the last log files a sparse file

655
00:22:59,730 --> 00:23:02,430
format which is you know they it looks a

656
00:23:02,430 --> 00:23:12,120
little weird yeah it could be somewhere

657
00:23:12,120 --> 00:23:13,710
binary files now there's still a lot of

658
00:23:13,710 --> 00:23:17,010
text based on Linux almost always I'll

659
00:23:17,010 --> 00:23:18,810
find that there'll be enough text there

660
00:23:18,810 --> 00:23:20,700
that they shouldn't be missing at a

661
00:23:20,700 --> 00:23:22,950
minimum right zero byte stuff like that

662
00:23:22,950 --> 00:23:24,600
I'm gonna want to take a close look at

663
00:23:24,600 --> 00:23:29,750
the layout I'm sorry

664
00:23:34,370 --> 00:23:38,240
are they yep are they okay yeah I don't

665
00:23:38,240 --> 00:23:39,800
have enough experience here to tell you

666
00:23:39,800 --> 00:23:41,210
one way or another

667
00:23:41,210 --> 00:23:43,400
mostly most of my experience is just

668
00:23:43,400 --> 00:23:46,930
standard Linux to see what's going on

669
00:23:46,930 --> 00:23:50,900
yeah in terms of just in terms of yeah

670
00:23:50,900 --> 00:23:53,540
in terms of the there are some log files

671
00:23:53,540 --> 00:23:54,740
you're definitely gonna need some type

672
00:23:54,740 --> 00:23:56,330
of file utilities I was writing some

673
00:23:56,330 --> 00:23:58,340
libraries to go through to do a lot of

674
00:23:58,340 --> 00:24:00,140
system auditing I'd write a custom lot I

675
00:24:00,140 --> 00:24:01,880
had to write a lot of custom files to

676
00:24:01,880 --> 00:24:03,920
parse out some of the system log files

677
00:24:03,920 --> 00:24:05,600
and stuff to pull information out like

678
00:24:05,600 --> 00:24:11,420
you said for that reason okay last thing

679
00:24:11,420 --> 00:24:12,830
here they're gonna probably try to run

680
00:24:12,830 --> 00:24:15,650
some type of suspicious process on the

681
00:24:15,650 --> 00:24:19,760
host and what I see here it just depends

682
00:24:19,760 --> 00:24:21,980
on what the attackers trying to do a lot

683
00:24:21,980 --> 00:24:23,450
of the automated scripts are trying to

684
00:24:23,450 --> 00:24:25,580
set up botnets they're trying to set up

685
00:24:25,580 --> 00:24:27,380
ways to get back on the host through

686
00:24:27,380 --> 00:24:29,780
buying shells and other backdoors might

687
00:24:29,780 --> 00:24:31,190
be trying to set up some type of file

688
00:24:31,190 --> 00:24:32,750
server as well

689
00:24:32,750 --> 00:24:35,990
your GC usually our processes that are

690
00:24:35,990 --> 00:24:37,730
trying to look legitimate there can be

691
00:24:37,730 --> 00:24:40,100
open ports you don't recognize or then

692
00:24:40,100 --> 00:24:41,150
you're gonna get the really bad stuff

693
00:24:41,150 --> 00:24:43,910
like deleted processes or deleted

694
00:24:43,910 --> 00:24:45,860
processes with net open network ports

695
00:24:45,860 --> 00:24:47,570
these are almost always an indicator

696
00:24:47,570 --> 00:24:49,250
that there's gonna be a problem the

697
00:24:49,250 --> 00:24:50,990
problem is the wave linux is set up by

698
00:24:50,990 --> 00:24:52,730
default it might not be immediately

699
00:24:52,730 --> 00:24:54,559
obvious it is a deleted process still

700
00:24:54,559 --> 00:24:56,210
running I want to show you in a second

701
00:24:56,210 --> 00:24:58,429
here what you can do to spot it but to

702
00:24:58,429 --> 00:25:00,950
give me an example of a suspicious

703
00:25:00,950 --> 00:25:03,290
process just writing a simple netstat

704
00:25:03,290 --> 00:25:05,780
command with the na LP this will give

705
00:25:05,780 --> 00:25:08,240
you a full listing of all the ports that

706
00:25:08,240 --> 00:25:10,580
are open the local address is listening

707
00:25:10,580 --> 00:25:12,410
on and it's also going to show you the

708
00:25:12,410 --> 00:25:14,809
PID and what the process is calling

709
00:25:14,809 --> 00:25:17,420
itself here I have something called

710
00:25:17,420 --> 00:25:20,420
Apache which Apache doesn't call itself

711
00:25:20,420 --> 00:25:23,420
Apache running to port 22 22 and it's

712
00:25:23,420 --> 00:25:25,700
doing a couple really odd things first

713
00:25:25,700 --> 00:25:28,100
of all it's got this TCP port open which

714
00:25:28,100 --> 00:25:30,980
you're like okay well that's odd but

715
00:25:30,980 --> 00:25:34,429
then it's got a raw socket open and here

716
00:25:34,429 --> 00:25:36,110
I could see here I won't get into too

717
00:25:36,110 --> 00:25:37,880
much details I could see its ICMP

718
00:25:37,880 --> 00:25:40,460
protocol again I can see the Apache

719
00:25:40,460 --> 00:25:44,480
process is running not only a raw socket

720
00:25:44,480 --> 00:25:47,630
but a TCP socket I wrote an older two

721
00:25:47,630 --> 00:25:49,850
for Linux systems years ago called ports

722
00:25:49,850 --> 00:25:51,770
entry which used raw sockets to do

723
00:25:51,770 --> 00:25:53,570
network security monitoring for packets

724
00:25:53,570 --> 00:25:57,610
but it's very unusual for most system

725
00:25:57,610 --> 00:25:59,930
processes to want to open a raw socket

726
00:25:59,930 --> 00:26:01,580
it's usually someone running a password

727
00:26:01,580 --> 00:26:03,530
sniffer network sniffer or some type of

728
00:26:03,530 --> 00:26:06,080
grabby raw packets in but here it's

729
00:26:06,080 --> 00:26:08,660
really strange because this process had

730
00:26:08,660 --> 00:26:11,630
both it had a raw socket and TCP open

731
00:26:11,630 --> 00:26:14,420
and this is kind of interesting because

732
00:26:14,420 --> 00:26:16,430
what this might actually be is an ICMP

733
00:26:16,430 --> 00:26:19,280
port knock backdoor and what that is

734
00:26:19,280 --> 00:26:22,550
it's a special bind shell backdoor where

735
00:26:22,550 --> 00:26:25,340
it just listens on a raw socket for ICMP

736
00:26:25,340 --> 00:26:28,070
packets to come in when a special packet

737
00:26:28,070 --> 00:26:30,380
comes in with certain header value set

738
00:26:30,380 --> 00:26:33,770
it will then open up a TCP port that you

739
00:26:33,770 --> 00:26:35,600
tell it to in that ICMP packet so it's

740
00:26:35,600 --> 00:26:37,430
kind of a stealth backdoor so that's why

741
00:26:37,430 --> 00:26:39,620
I ended up seeing two of these things

742
00:26:39,620 --> 00:26:40,310
here at once

743
00:26:40,310 --> 00:26:43,310
someone ran the sniffer it's on an open

744
00:26:43,310 --> 00:26:45,620
socket raw socket and then they send it

745
00:26:45,620 --> 00:26:48,470
a packet later to say open up on port 22

746
00:26:48,470 --> 00:26:50,540
22 and pipe your bind shell there so

747
00:26:50,540 --> 00:26:51,710
that's why you might see something like

748
00:26:51,710 --> 00:26:55,370
it but even then even ignoring the TCP

749
00:26:55,370 --> 00:26:56,960
if you see anything with a raw socket

750
00:26:56,960 --> 00:27:00,350
open on the box I'd be a little bit wary

751
00:27:00,350 --> 00:27:01,820
of what it is unless you know

752
00:27:01,820 --> 00:27:03,710
specifically with some tourist-type of

753
00:27:03,710 --> 00:27:05,750
security monitoring software or some

754
00:27:05,750 --> 00:27:07,340
type of network monitoring software that

755
00:27:07,340 --> 00:27:09,040
you know should be running on that box

756
00:27:09,040 --> 00:27:14,830
otherwise pretty odd thing I would say

757
00:27:14,920 --> 00:27:17,180
now we're gonna dig into a little bit

758
00:27:17,180 --> 00:27:19,280
more here so we see this apache process

759
00:27:19,280 --> 00:27:20,720
okay well let's find out a little bit

760
00:27:20,720 --> 00:27:24,170
more standard PS command PS aux WF this

761
00:27:24,170 --> 00:27:26,150
is gonna give us a wide format it's also

762
00:27:26,150 --> 00:27:27,920
gonna do this neat kind of threaded

763
00:27:27,920 --> 00:27:30,800
thing here so we can kind of see what

764
00:27:30,800 --> 00:27:32,870
process child processes are associated

765
00:27:32,870 --> 00:27:33,980
with it it's also going to give us a

766
00:27:33,980 --> 00:27:37,490
full path to that process and we're

767
00:27:37,490 --> 00:27:38,870
gonna see a couple things here that are

768
00:27:38,870 --> 00:27:42,310
gonna stand out one a high process ID

769
00:27:42,310 --> 00:27:45,950
this is really odd for any system demon

770
00:27:45,950 --> 00:27:48,200
that you expect the startup when the

771
00:27:48,200 --> 00:27:50,540
system starts okay you can see I left

772
00:27:50,540 --> 00:27:53,120
some of these here before I you know

773
00:27:53,120 --> 00:27:54,740
concatenated this a bit but you can see

774
00:27:54,740 --> 00:27:56,630
two three four five seven six sixty

775
00:27:56,630 --> 00:27:58,220
seventy seven hundred these are things

776
00:27:58,220 --> 00:27:59,910
we start pretty early in the prom

777
00:27:59,910 --> 00:28:03,210
yes 22-250 one that started really

778
00:28:03,210 --> 00:28:05,100
really late so someone started that

779
00:28:05,100 --> 00:28:07,080
process well after the system it started

780
00:28:07,080 --> 00:28:08,940
this doesn't work on every OS like open

781
00:28:08,940 --> 00:28:10,590
BSD the process IDs are completely

782
00:28:10,590 --> 00:28:13,380
randomized Linux doesn't do that okay

783
00:28:13,380 --> 00:28:15,390
the other second thing here that I would

784
00:28:15,390 --> 00:28:17,040
say is very very I remember how I said

785
00:28:17,040 --> 00:28:18,360
there's certain directories that the

786
00:28:18,360 --> 00:28:20,250
attackers tend to go after and dev is

787
00:28:20,250 --> 00:28:21,900
one of them it's pretty high up

788
00:28:21,900 --> 00:28:25,230
well this is running out of dev this

789
00:28:25,230 --> 00:28:28,680
particular process that's really strange

790
00:28:28,680 --> 00:28:30,750
really strange you know if you don't get

791
00:28:30,750 --> 00:28:32,040
a system demon that's running out of

792
00:28:32,040 --> 00:28:34,530
like it typically the home directory of

793
00:28:34,530 --> 00:28:36,360
the user its associated with or things

794
00:28:36,360 --> 00:28:36,960
like that

795
00:28:36,960 --> 00:28:39,000
it's pretty odd you should look into it

796
00:28:39,000 --> 00:28:40,350
you know so again you see anything

797
00:28:40,350 --> 00:28:41,910
running a dev anything running out of

798
00:28:41,910 --> 00:28:44,340
temp anything running out of a root

799
00:28:44,340 --> 00:28:45,660
directory even with the root home

800
00:28:45,660 --> 00:28:46,890
directory I'd say me right now there

801
00:28:46,890 --> 00:28:48,480
would be pretty suspicious these are

802
00:28:48,480 --> 00:28:49,710
kind of things that you want to look for

803
00:28:49,710 --> 00:28:51,810
and again it's all about just kind of

804
00:28:51,810 --> 00:28:53,730
paying attention to what looks a little

805
00:28:53,730 --> 00:28:55,410
bit out of place so I know this process

806
00:28:55,410 --> 00:28:57,900
already has a ton of problems with it

807
00:28:57,900 --> 00:29:01,290
going back one slide here it's got two

808
00:29:01,290 --> 00:29:03,930
ports open one a TCP port which is a

809
00:29:03,930 --> 00:29:06,840
very bizarre 22:22 know what is that

810
00:29:06,840 --> 00:29:08,370
doesn't mean anything it's got a raw

811
00:29:08,370 --> 00:29:11,190
socket open its call myself Apache which

812
00:29:11,190 --> 00:29:13,380
is strange because Apache doesn't call

813
00:29:13,380 --> 00:29:16,140
itself that and then going further I see

814
00:29:16,140 --> 00:29:18,720
the hi PID again and it's running out of

815
00:29:18,720 --> 00:29:22,860
dev so let's take one final look at this

816
00:29:22,860 --> 00:29:26,580
particular process ID there is a special

817
00:29:26,580 --> 00:29:28,830
directory on our Linux called proc this

818
00:29:28,830 --> 00:29:31,500
is basically contains all the process

819
00:29:31,500 --> 00:29:33,360
information that the Linux kernel uses

820
00:29:33,360 --> 00:29:34,890
in order to show you need information

821
00:29:34,890 --> 00:29:36,990
such as the ports are open file

822
00:29:36,990 --> 00:29:38,700
descriptors that's using executable

823
00:29:38,700 --> 00:29:40,620
location know that it's huge you should

824
00:29:40,620 --> 00:29:42,360
take a look at at one time but what's

825
00:29:42,360 --> 00:29:44,340
really neat about this directory is it's

826
00:29:44,340 --> 00:29:45,450
really not something I can be easily

827
00:29:45,450 --> 00:29:47,400
modified even as a route if you go in

828
00:29:47,400 --> 00:29:49,620
here to this directory and you try to

829
00:29:49,620 --> 00:29:51,450
make directories you try to add files to

830
00:29:51,450 --> 00:29:52,560
it or things like that usually you're

831
00:29:52,560 --> 00:29:53,850
not gonna be allowed it's not gonna let

832
00:29:53,850 --> 00:29:55,320
you do it even it's rude there are ways

833
00:29:55,320 --> 00:29:56,430
you could do it I've seen some people

834
00:29:56,430 --> 00:29:58,050
have some techniques to kind of bypass

835
00:29:58,050 --> 00:30:00,090
it but you stand a chance of breaking

836
00:30:00,090 --> 00:30:02,160
the box but what's interesting about the

837
00:30:02,160 --> 00:30:05,640
proc directory is like new LS - al proc

838
00:30:05,640 --> 00:30:08,490
and then this process ID and it's going

839
00:30:08,490 --> 00:30:09,810
to show me a huge range of things that

840
00:30:09,810 --> 00:30:11,250
it knows about the colonel knows about

841
00:30:11,250 --> 00:30:13,140
this process and the most interesting

842
00:30:13,140 --> 00:30:13,560
one

843
00:30:13,560 --> 00:30:16,500
the Exe path and this is says Deb Apache

844
00:30:16,500 --> 00:30:19,860
which I know and then it says deleted

845
00:30:19,860 --> 00:30:22,080
Linux is very nice because it tells you

846
00:30:22,080 --> 00:30:23,880
when something's been deleted off the

847
00:30:23,880 --> 00:30:25,980
disk and that's what's happened here

848
00:30:25,980 --> 00:30:27,690
again this isn't something PS would show

849
00:30:27,690 --> 00:30:29,010
you this is something that you would

850
00:30:29,010 --> 00:30:30,810
have to kind of trace back through the

851
00:30:30,810 --> 00:30:32,220
system there might be a PS fly I don't

852
00:30:32,220 --> 00:30:35,220
remember ever seen one but um at this

853
00:30:35,220 --> 00:30:37,080
point here this process is everything we

854
00:30:37,080 --> 00:30:38,850
don't want to see and something running

855
00:30:38,850 --> 00:30:40,890
on a box it's got a weird name

856
00:30:40,890 --> 00:30:42,870
it's got ports open it's got a high

857
00:30:42,870 --> 00:30:44,760
process ID it's running from the dead

858
00:30:44,760 --> 00:30:47,370
directory and oh by the way they deleted

859
00:30:47,370 --> 00:30:48,810
it from the dead directory after they

860
00:30:48,810 --> 00:30:50,730
started it this is all the classic signs

861
00:30:50,730 --> 00:30:53,250
of a worm malware or some type of

862
00:30:53,250 --> 00:30:55,110
automated attack script and the reason

863
00:30:55,110 --> 00:30:56,640
why they deleted is really quite simple

864
00:30:56,640 --> 00:30:59,790
first of all it works right now I can't

865
00:30:59,790 --> 00:31:02,670
go find this binary quickly to reverse

866
00:31:02,670 --> 00:31:04,470
engineer and see what's going on great

867
00:31:04,470 --> 00:31:05,820
I'd have to do something to get it out

868
00:31:05,820 --> 00:31:07,140
of memory with some type of memory

869
00:31:07,140 --> 00:31:09,360
imaging or something like that second of

870
00:31:09,360 --> 00:31:10,770
all if you're running any type of change

871
00:31:10,770 --> 00:31:13,980
monitoring or you know hash change

872
00:31:13,980 --> 00:31:16,560
detection on the system it's not on the

873
00:31:16,560 --> 00:31:16,950
file

874
00:31:16,950 --> 00:31:19,380
sound on the disk anymore so you running

875
00:31:19,380 --> 00:31:21,390
this thing once a day it's not going to

876
00:31:21,390 --> 00:31:23,010
see that there is a new file added the

877
00:31:23,010 --> 00:31:25,890
dev because it's not there so it's

878
00:31:25,890 --> 00:31:27,480
simple but it works that's why they do

879
00:31:27,480 --> 00:31:29,600
it

880
00:31:32,910 --> 00:31:35,100
now the last thing I'll talk about a bit

881
00:31:35,100 --> 00:31:39,240
is to really get into the suspicious

882
00:31:39,240 --> 00:31:41,100
processes if they haven't deleted from

883
00:31:41,100 --> 00:31:43,740
the disk really basically you don't need

884
00:31:43,740 --> 00:31:45,780
to be reverse engineer to take a look at

885
00:31:45,780 --> 00:31:47,310
something that's on a distant looks on

886
00:31:47,310 --> 00:31:49,860
and I would just say use the strings

887
00:31:49,860 --> 00:31:51,510
command strings command is basically

888
00:31:51,510 --> 00:31:53,130
like the cat command but it doesn't show

889
00:31:53,130 --> 00:31:55,500
you any binary characters in this case

890
00:31:55,500 --> 00:31:57,390
here I run the strings command on

891
00:31:57,390 --> 00:31:59,700
suspicious binary and I could see

892
00:31:59,700 --> 00:32:01,260
certain things here I call it the Holy

893
00:32:01,260 --> 00:32:02,730
Trinity of bind shells

894
00:32:02,730 --> 00:32:04,560
listen bind except I see these system

895
00:32:04,560 --> 00:32:06,900
calls sitting here this almost says that

896
00:32:06,900 --> 00:32:09,000
there's something that's a network

897
00:32:09,000 --> 00:32:10,560
server of some type and then I could see

898
00:32:10,560 --> 00:32:12,690
at the bottom it's calling out the bin

899
00:32:12,690 --> 00:32:15,450
shell which is pretty much the death

900
00:32:15,450 --> 00:32:16,890
knell for this thing that it's up to no

901
00:32:16,890 --> 00:32:18,990
good and you can use this for other

902
00:32:18,990 --> 00:32:20,580
things as well even it's not a network

903
00:32:20,580 --> 00:32:23,730
server you can run this command on other

904
00:32:23,730 --> 00:32:25,650
malicious binaries that our friends is

905
00:32:25,650 --> 00:32:27,630
trying to hide these hidden directories

906
00:32:27,630 --> 00:32:29,040
or things like that so I've used this on

907
00:32:29,040 --> 00:32:31,530
one binary that I saw as part of a

908
00:32:31,530 --> 00:32:32,910
stealth rootkit and it immediately

909
00:32:32,910 --> 00:32:35,130
showed me the hidden directory it was

910
00:32:35,130 --> 00:32:36,510
using to store all its goodies in

911
00:32:36,510 --> 00:32:38,040
because it showed up something weird you

912
00:32:38,040 --> 00:32:40,800
know /dev dot random character string

913
00:32:40,800 --> 00:32:43,620
well why is the binary have that

914
00:32:43,620 --> 00:32:45,720
embedded in it so this is kind of a

915
00:32:45,720 --> 00:32:46,830
quick way even if you're not a very

916
00:32:46,830 --> 00:32:48,510
technical person just to quickly look

917
00:32:48,510 --> 00:32:50,190
through and see what's going on you

918
00:32:50,190 --> 00:32:51,510
might also find other strings in there

919
00:32:51,510 --> 00:32:53,280
that could be passwords strings that

920
00:32:53,280 --> 00:32:55,290
could be IP addresses that's connecting

921
00:32:55,290 --> 00:32:56,760
back out to which could be really

922
00:32:56,760 --> 00:32:58,440
helpful if you need to detect that type

923
00:32:58,440 --> 00:33:00,240
of traffic on your network going forward

924
00:33:00,240 --> 00:33:02,340
and it might also show you other files

925
00:33:02,340 --> 00:33:03,930
and it might be trying to read or get

926
00:33:03,930 --> 00:33:06,090
access to even if they're not on your

927
00:33:06,090 --> 00:33:07,950
system again if it's an automated script

928
00:33:07,950 --> 00:33:09,000
that could kind of show you what the

929
00:33:09,000 --> 00:33:10,530
game plan is gonna be what that thing's

930
00:33:10,530 --> 00:33:13,410
looking for down there and I kind of

931
00:33:13,410 --> 00:33:17,610
have here warning of not to run a trace

932
00:33:17,610 --> 00:33:20,580
on suspicious binaries and s trace is

933
00:33:20,580 --> 00:33:23,670
basically a debugging tool that will run

934
00:33:23,670 --> 00:33:25,620
through the process and show you

935
00:33:25,620 --> 00:33:28,050
everything that it's doing and so does

936
00:33:28,050 --> 00:33:29,280
anyone know why you might not want to

937
00:33:29,280 --> 00:33:32,130
run s trace on a binary on a production

938
00:33:32,130 --> 00:33:35,880
system sorry

939
00:33:35,880 --> 00:33:39,630
it's executing it that's right so I mean

940
00:33:39,630 --> 00:33:41,160
it would be fine if you copy this over

941
00:33:41,160 --> 00:33:42,390
to a system you don't care about a

942
00:33:42,390 --> 00:33:43,740
virtual image somewhere in the cloud

943
00:33:43,740 --> 00:33:45,240
that you're not connected to but if you

944
00:33:45,240 --> 00:33:46,380
right if you go into the temp directory

945
00:33:46,380 --> 00:33:48,030
and you're like huh what's this weird

946
00:33:48,030 --> 00:33:49,650
file I'm just gonna run that trace on it

947
00:33:49,650 --> 00:33:52,020
boom you don't know what it's gonna do

948
00:33:52,020 --> 00:33:54,410
in fact I thought it might be funny

949
00:33:54,410 --> 00:33:56,700
specifically to make a program that

950
00:33:56,700 --> 00:33:59,250
detects s trace or debugger being used

951
00:33:59,250 --> 00:34:01,169
and just throw it on the system and let

952
00:34:01,169 --> 00:34:03,000
it wait for someone to run s trace

953
00:34:03,000 --> 00:34:04,890
against it and then use that person's

954
00:34:04,890 --> 00:34:06,299
credentials to start plundering things

955
00:34:06,299 --> 00:34:08,070
kind of like a baby I think that would

956
00:34:08,070 --> 00:34:11,219
work pretty well but yeah so in general

957
00:34:11,219 --> 00:34:13,050
while there's a lot of good advice on

958
00:34:13,050 --> 00:34:14,159
the internet about reverse engineering

959
00:34:14,159 --> 00:34:16,409
with debuggers and things like that I

960
00:34:16,409 --> 00:34:18,929
recommend you looking into that always

961
00:34:18,929 --> 00:34:21,210
keep in mind to never ever do that stuff

962
00:34:21,210 --> 00:34:23,129
on a live system because you could run

963
00:34:23,129 --> 00:34:25,050
that binary by mistake and then you're

964
00:34:25,050 --> 00:34:26,850
really going to be hating light because

965
00:34:26,850 --> 00:34:31,679
you don't know what it's gonna do okay

966
00:34:31,679 --> 00:34:34,379
so I spoke really fast but I want to

967
00:34:34,379 --> 00:34:36,090
leave plenty of time for questions here

968
00:34:36,090 --> 00:34:37,980
but just to kind of review everything

969
00:34:37,980 --> 00:34:40,469
where we've been to focus on the simple

970
00:34:40,469 --> 00:34:43,350
first always remember that it's not

971
00:34:43,350 --> 00:34:44,909
always so dire right we get in this

972
00:34:44,909 --> 00:34:46,469
situation a little bit pessimistic about

973
00:34:46,469 --> 00:34:48,540
oh there's so many ways our network can

974
00:34:48,540 --> 00:34:49,949
get broken into we have no way to defend

975
00:34:49,949 --> 00:34:52,109
ourselves but you always he remember as

976
00:34:52,109 --> 00:34:54,780
a white hat once they get in there on

977
00:34:54,780 --> 00:34:56,668
our territory and they're gonna make a

978
00:34:56,668 --> 00:34:58,920
mistake and a lot of these things that I

979
00:34:58,920 --> 00:35:00,690
showed you in the slide today you know

980
00:35:00,690 --> 00:35:02,250
you might think this is simple or can't

981
00:35:02,250 --> 00:35:04,380
possibly work and Yaron and I'm telling

982
00:35:04,380 --> 00:35:05,970
you if you look for these simple things

983
00:35:05,970 --> 00:35:08,130
you're gonna be able to find a lot of

984
00:35:08,130 --> 00:35:10,380
people who are on your systems that you

985
00:35:10,380 --> 00:35:11,940
thought that they'd be a lot stealthier

986
00:35:11,940 --> 00:35:14,310
than they actually are again they'll be

987
00:35:14,310 --> 00:35:15,869
kind of the three things suspicious

988
00:35:15,869 --> 00:35:17,550
directories files and processes they're

989
00:35:17,550 --> 00:35:19,200
almost always going to be one of those

990
00:35:19,200 --> 00:35:20,550
three categories you're gonna find

991
00:35:20,550 --> 00:35:21,840
something on these box that these guys

992
00:35:21,840 --> 00:35:24,060
have tried to do and again simple tools

993
00:35:24,060 --> 00:35:25,710
and careful attention is going to get

994
00:35:25,710 --> 00:35:30,180
the job done okay so I can go to

995
00:35:30,180 --> 00:35:31,770
questions now back and forth if you have

996
00:35:31,770 --> 00:35:34,850
questions on anything in particular

997
00:35:36,990 --> 00:35:39,990
yes

998
00:35:59,360 --> 00:36:01,700
yeah so his question is for the video

999
00:36:01,700 --> 00:36:03,260
whether or not there could be some type

1000
00:36:03,260 --> 00:36:04,730
of a white hat club where you could spin

1001
00:36:04,730 --> 00:36:07,430
up suspicious activity and have people

1002
00:36:07,430 --> 00:36:09,530
go look for it you know there probably

1003
00:36:09,530 --> 00:36:11,330
are I mean they're online pentest

1004
00:36:11,330 --> 00:36:12,830
academies and stuff like that where you

1005
00:36:12,830 --> 00:36:14,660
could test breaking into things usually

1006
00:36:14,660 --> 00:36:16,160
what I'm doing is I'm setting up hosts

1007
00:36:16,160 --> 00:36:18,590
at digitalocean and just turn into total

1008
00:36:18,590 --> 00:36:20,330
punching bags right I mean don't get

1009
00:36:20,330 --> 00:36:23,360
banned right by these guys but you know

1010
00:36:23,360 --> 00:36:25,430
if if you have the ability to look at

1011
00:36:25,430 --> 00:36:27,680
the code ahead of time to make sure it's

1012
00:36:27,680 --> 00:36:28,820
not doing something really bad like

1013
00:36:28,820 --> 00:36:30,710
setting up a botnet or DDoS or something

1014
00:36:30,710 --> 00:36:32,690
you know don't run that stuff but what I

1015
00:36:32,690 --> 00:36:34,160
usually would do a lot I will have a

1016
00:36:34,160 --> 00:36:36,050
target of saying well what is this one

1017
00:36:36,050 --> 00:36:38,330
rootkit doing what is this one doing and

1018
00:36:38,330 --> 00:36:39,890
there are other utilities inside of

1019
00:36:39,890 --> 00:36:42,140
Linux where you can actually track you

1020
00:36:42,140 --> 00:36:44,000
can enable I think I know to fire some

1021
00:36:44,000 --> 00:36:45,200
other ones I honey look into them again

1022
00:36:45,200 --> 00:36:47,390
but you could actually see what is this

1023
00:36:47,390 --> 00:36:49,340
process what files is seem touching as

1024
00:36:49,340 --> 00:36:51,680
its as its running on the hose so there

1025
00:36:51,680 --> 00:36:53,090
ways to do it I don't think it's a

1026
00:36:53,090 --> 00:36:54,470
formal lab I think it's definitely

1027
00:36:54,470 --> 00:36:57,440
something more like you sit down and do

1028
00:36:57,440 --> 00:36:58,670
it there could be allowed I don't know I

1029
00:36:58,670 --> 00:37:00,500
haven't looked but generally my approach

1030
00:37:00,500 --> 00:37:02,480
is I'm gonna look at the source code and

1031
00:37:02,480 --> 00:37:03,860
run it myself and see what's going on

1032
00:37:03,860 --> 00:37:05,440
you know in that and that's what I did

1033
00:37:05,440 --> 00:37:08,120
over the past year when the equation

1034
00:37:08,120 --> 00:37:09,740
group leaks were happening and also the

1035
00:37:09,740 --> 00:37:11,270
stuff going on man I just downloaded the

1036
00:37:11,270 --> 00:37:12,320
source code and I just looked at what

1037
00:37:12,320 --> 00:37:15,800
these guys did and that's really an easy

1038
00:37:15,800 --> 00:37:17,330
way to do things a lot even having to

1039
00:37:17,330 --> 00:37:18,860
run any their code at all and that's

1040
00:37:18,860 --> 00:37:20,180
kind of where I started noticing just

1041
00:37:20,180 --> 00:37:23,990
how how common techniques can even spot

1042
00:37:23,990 --> 00:37:25,850
these elite level hackers yeah sure they

1043
00:37:25,850 --> 00:37:28,190
had cool stuff they had like true

1044
00:37:28,190 --> 00:37:29,930
zero-day type stuff that could work in a

1045
00:37:29,930 --> 00:37:31,850
lot of systems but if you look at the

1046
00:37:31,850 --> 00:37:34,370
operational aspect of once they get onto

1047
00:37:34,370 --> 00:37:37,160
the system that's where you say it's all

1048
00:37:37,160 --> 00:37:40,070
these very common things that can get

1049
00:37:40,070 --> 00:37:41,750
spotted you know they'd have things in

1050
00:37:41,750 --> 00:37:43,370
there I remember they were using on one

1051
00:37:43,370 --> 00:37:46,070
particular attack they were using like

1052
00:37:46,070 --> 00:37:48,770
an X 11 file under temp to mark that

1053
00:37:48,770 --> 00:37:50,150
they were there blah blah blah blah well

1054
00:37:50,150 --> 00:37:52,070
a lot of systems don't load x11 right

1055
00:37:52,070 --> 00:37:53,870
it's things like that it's just like you

1056
00:37:53,870 --> 00:37:56,030
know why am i why do I have certain

1057
00:37:56,030 --> 00:37:57,830
programs showing like oh they're loaded

1058
00:37:57,830 --> 00:37:59,210
on the system we're clearly I don't run

1059
00:37:59,210 --> 00:38:01,250
these types of things but they even you

1060
00:38:01,250 --> 00:38:03,860
see these elite level attackers they're

1061
00:38:03,860 --> 00:38:05,630
gonna be doing common stuff so I would

1062
00:38:05,630 --> 00:38:08,120
say just go out look at the rootkit so

1063
00:38:08,120 --> 00:38:09,980
maybe just find some digitalocean boxes

1064
00:38:09,980 --> 00:38:11,420
five bucks a month man you can't go

1065
00:38:11,420 --> 00:38:12,980
wrong and just go out there and beat up

1066
00:38:12,980 --> 00:38:20,109
on the things anyone else questions yes

1067
00:38:38,520 --> 00:38:41,610
okay so his question is paraphrasing is

1068
00:38:41,610 --> 00:38:43,740
we're looking at compromised systems but

1069
00:38:43,740 --> 00:38:45,330
what are the common things people are

1070
00:38:45,330 --> 00:38:47,850
doing to get compromised okay

1071
00:38:47,850 --> 00:38:49,590
oh man that's why we have this

1072
00:38:49,590 --> 00:38:51,390
conference right I mean that's why

1073
00:38:51,390 --> 00:38:53,040
there's a zero percent unemployment rate

1074
00:38:53,040 --> 00:38:54,900
in information security right it's an

1075
00:38:54,900 --> 00:38:57,150
endless stream of the same stuff over

1076
00:38:57,150 --> 00:38:59,490
and over and over again so I usually

1077
00:38:59,490 --> 00:39:00,750
don't even focus so much on what

1078
00:39:00,750 --> 00:39:02,490
vulnerability got someone onto a host

1079
00:39:02,490 --> 00:39:05,250
and the reason I don't is I just I don't

1080
00:39:05,250 --> 00:39:09,119
know if I really care in terms of it

1081
00:39:09,119 --> 00:39:12,150
changes so much right so to answer your

1082
00:39:12,150 --> 00:39:13,830
question I don't think there's one

1083
00:39:13,830 --> 00:39:16,650
specific thing you know but I could talk

1084
00:39:16,650 --> 00:39:17,970
about some I could talk about some

1085
00:39:17,970 --> 00:39:20,670
trends that we see today so for instance

1086
00:39:20,670 --> 00:39:22,650
you start to see I think a lot more use

1087
00:39:22,650 --> 00:39:24,510
of encryption with some of these tools

1088
00:39:24,510 --> 00:39:26,580
being built in so a lot of network-based

1089
00:39:26,580 --> 00:39:28,260
intrusion detection systems are becoming

1090
00:39:28,260 --> 00:39:31,350
blind even though some of them may say

1091
00:39:31,350 --> 00:39:32,520
oh we're gonna you can load a

1092
00:39:32,520 --> 00:39:33,840
certificate and we're gonna do a

1093
00:39:33,840 --> 00:39:35,490
man-in-the-middle inspection stuff you

1094
00:39:35,490 --> 00:39:36,630
might get people who are tunneling

1095
00:39:36,630 --> 00:39:38,220
encryption inside the encryption and

1096
00:39:38,220 --> 00:39:40,200
things like that so I start gonna think

1097
00:39:40,200 --> 00:39:41,960
you start seeing more of that going on

1098
00:39:41,960 --> 00:39:44,070
stolen credentials are always a big

1099
00:39:44,070 --> 00:39:46,230
thing you know and it's one of these

1100
00:39:46,230 --> 00:39:48,690
things to where some of the attackers

1101
00:39:48,690 --> 00:39:50,490
can try to get like almost too tricky

1102
00:39:50,490 --> 00:39:52,470
trying to hide and they make the

1103
00:39:52,470 --> 00:39:54,210
situation for themselves much worse like

1104
00:39:54,210 --> 00:39:55,850
a lot of some of these stealth rootkits

1105
00:39:55,850 --> 00:39:58,080
you know they they'll do things that

1106
00:39:58,080 --> 00:39:59,430
make it very very obvious there's a

1107
00:39:59,430 --> 00:40:01,020
problem once you see what's going on

1108
00:40:01,020 --> 00:40:02,850
like something's just a little off and

1109
00:40:02,850 --> 00:40:04,320
then you look you like Oh Calvin yeah

1110
00:40:04,320 --> 00:40:06,119
this is this was a lot an accident right

1111
00:40:06,119 --> 00:40:08,220
someone did this on purpose that was to

1112
00:40:08,220 --> 00:40:11,760
how they got in I don't know I guess my

1113
00:40:11,760 --> 00:40:13,470
whole point of this presentation is just

1114
00:40:13,470 --> 00:40:14,850
be on the lookout for it because once

1115
00:40:14,850 --> 00:40:16,740
they get on that box you're probably

1116
00:40:16,740 --> 00:40:18,390
gonna be able to find him a lot faster

1117
00:40:18,390 --> 00:40:19,440
you might not know how they got in

1118
00:40:19,440 --> 00:40:21,480
initially but at least you could start

1119
00:40:21,480 --> 00:40:22,800
looking to see how they got into the

1120
00:40:22,800 --> 00:40:28,010
system another yes sir

1121
00:40:30,460 --> 00:40:35,630
what a coincidence oh yeah I mean the

1122
00:40:35,630 --> 00:40:37,220
product I'm working on does a lot of a

1123
00:40:37,220 --> 00:40:38,690
lot of things that help with this it's a

1124
00:40:38,690 --> 00:40:41,150
threat hunter so it looks for signs of

1125
00:40:41,150 --> 00:40:42,980
compromised post fact there are some

1126
00:40:42,980 --> 00:40:44,539
older tools out there check rootkit

1127
00:40:44,539 --> 00:40:46,789
rootkit hunter but mmm you know that

1128
00:40:46,789 --> 00:40:48,890
they might not catch a lot of different

1129
00:40:48,890 --> 00:40:51,049
things like this you know they're pretty

1130
00:40:51,049 --> 00:40:53,599
particular there's nothing overtly like

1131
00:40:53,599 --> 00:40:56,390
it right now but you know it's something

1132
00:40:56,390 --> 00:40:57,950
that I see have had a burning interest

1133
00:40:57,950 --> 00:40:59,839
in the past year so I've been looking at

1134
00:40:59,839 --> 00:41:01,640
a lot of this stuff so yeah you can't do

1135
00:41:01,640 --> 00:41:04,369
it an automated way you know and again

1136
00:41:04,369 --> 00:41:05,779
I'm not here for a product plug because

1137
00:41:05,779 --> 00:41:06,950
I haven't really announced my product

1138
00:41:06,950 --> 00:41:08,599
yet but you can go take check that out

1139
00:41:08,599 --> 00:41:10,430
there might be some other intrusion

1140
00:41:10,430 --> 00:41:11,660
detection tools that are out there that

1141
00:41:11,660 --> 00:41:13,940
might feel a similar gap but I'm not

1142
00:41:13,940 --> 00:41:17,210
quite sure how capable they are or how

1143
00:41:17,210 --> 00:41:18,650
far they're gonna take take the feature

1144
00:41:18,650 --> 00:41:26,410
set anyone else yes sir

1145
00:41:32,720 --> 00:41:35,150
yeah the comment it was can use selinux

1146
00:41:35,150 --> 00:41:36,770
and I assume a parm or stuff like that

1147
00:41:36,770 --> 00:41:40,010
maybe to to limit some of this yeah sure

1148
00:41:40,010 --> 00:41:43,250
but you know how many people disable

1149
00:41:43,250 --> 00:41:44,780
SELinux is one of the first things they

1150
00:41:44,780 --> 00:41:47,839
do in CentOS yeah it's a problem I wish

1151
00:41:47,839 --> 00:41:50,960
they wouldn't but you know they do so I

1152
00:41:50,960 --> 00:41:52,910
think SELinux could prevent a lot of

1153
00:41:52,910 --> 00:41:54,980
this stuff obviously you know getting

1154
00:41:54,980 --> 00:41:56,630
because you have that extra level of

1155
00:41:56,630 --> 00:41:58,940
checks in terms of user roles and group

1156
00:41:58,940 --> 00:42:00,200
roles and things like that but

1157
00:42:00,200 --> 00:42:01,700
unfortunately lot of people disable

1158
00:42:01,700 --> 00:42:05,060
those things so you know I mean if they

1159
00:42:05,060 --> 00:42:08,319
didn't then a lot of stuff wouldn't work

1160
00:42:08,319 --> 00:42:11,470
yes sir

1161
00:42:15,660 --> 00:42:18,780
well I mean a a bare minimum you're

1162
00:42:18,780 --> 00:42:21,090
taking the system down and reimaging it

1163
00:42:21,090 --> 00:42:23,520
it's the minimum you know it depends on

1164
00:42:23,520 --> 00:42:24,600
what your policy is into your

1165
00:42:24,600 --> 00:42:26,970
corporation I mean if you know you might

1166
00:42:26,970 --> 00:42:29,070
have certain forensics requirements that

1167
00:42:29,070 --> 00:42:31,140
your industry requires you're obviously

1168
00:42:31,140 --> 00:42:32,940
gonna want to try to figure out how they

1169
00:42:32,940 --> 00:42:34,590
got on the box so it doesn't get

1170
00:42:34,590 --> 00:42:36,450
repeated you know so I wouldn't

1171
00:42:36,450 --> 00:42:38,130
necessarily say blow the system away

1172
00:42:38,130 --> 00:42:39,870
immediately but you probably don't want

1173
00:42:39,870 --> 00:42:42,630
to take it off the network and then get

1174
00:42:42,630 --> 00:42:44,970
some forensic offline forensic tools to

1175
00:42:44,970 --> 00:42:46,170
get in there maybe you're gonna want to

1176
00:42:46,170 --> 00:42:48,780
image to image the RAM image to disk try

1177
00:42:48,780 --> 00:42:50,220
to find out how they got onto the system

1178
00:42:50,220 --> 00:42:51,840
and this is one the problem you run into

1179
00:42:51,840 --> 00:42:54,690
a lot with with the vendors and patches

1180
00:42:54,690 --> 00:42:56,460
and things like that you know no Red Hat

1181
00:42:56,460 --> 00:42:58,890
these companies they can only patch what

1182
00:42:58,890 --> 00:43:01,530
they know about and unfortunately as

1183
00:43:01,530 --> 00:43:02,670
soon as you load that system you're

1184
00:43:02,670 --> 00:43:04,380
gonna put all your custom software on it

1185
00:43:04,380 --> 00:43:06,570
and at that point they can't really do

1186
00:43:06,570 --> 00:43:07,710
much I can't really tell you how they

1187
00:43:07,710 --> 00:43:09,180
got on you might not really know there

1188
00:43:09,180 --> 00:43:10,680
could be yeah obviously there could be a

1189
00:43:10,680 --> 00:43:12,750
hole in a commonly available package but

1190
00:43:12,750 --> 00:43:14,430
a lot of times I think what you might

1191
00:43:14,430 --> 00:43:15,990
find is it could be custom web apps

1192
00:43:15,990 --> 00:43:17,820
things like that developers make errors

1193
00:43:17,820 --> 00:43:20,640
you know SSH keys are stolen stuff like

1194
00:43:20,640 --> 00:43:22,470
that that's gonna get someone on the Box

1195
00:43:22,470 --> 00:43:24,690
so getting back to your question you

1196
00:43:24,690 --> 00:43:25,950
know what would I do personally I'd

1197
00:43:25,950 --> 00:43:27,120
probably want to take that system

1198
00:43:27,120 --> 00:43:28,950
offline do a forensic analysis and find

1199
00:43:28,950 --> 00:43:30,480
out how they got in the system just to

1200
00:43:30,480 --> 00:43:31,710
make sure they didn't go anywhere else

1201
00:43:31,710 --> 00:43:37,530
and it causes some more trouble anyone

1202
00:43:37,530 --> 00:43:42,720
else no okay I'll post this presentation

1203
00:43:42,720 --> 00:43:44,910
online on my website as well if you want

1204
00:43:44,910 --> 00:43:46,080
to grab it later and obviously again

1205
00:43:46,080 --> 00:43:48,300
I'll be you're on a weekend thank you

1206
00:43:48,300 --> 00:43:49,290
and enjoy the show

1207
00:43:49,290 --> 00:43:50,800
appreciate it

1208
00:43:50,800 --> 00:43:55,539
[Applause]

