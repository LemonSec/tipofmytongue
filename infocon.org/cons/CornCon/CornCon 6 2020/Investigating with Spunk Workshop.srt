1
00:00:42,079 --> 00:00:45,200
and so just to give a little bit of an

2
00:00:43,520 --> 00:00:47,840
extra hint

3
00:00:45,200 --> 00:00:49,760
you can really start off with this broad

4
00:00:47,840 --> 00:00:51,600
of a net i mean really at this point the

5
00:00:49,760 --> 00:00:54,399
only thing you know

6
00:00:51,600 --> 00:00:54,960
is that i'm really not batman was the

7
00:00:54,399 --> 00:00:57,680
target

8
00:00:54,960 --> 00:00:59,120
of this attack and you can start there

9
00:00:57,680 --> 00:01:00,079
um you can start with i'm really not

10
00:00:59,120 --> 00:01:02,160
batman.com

11
00:01:00,079 --> 00:01:03,440
as your base search and then start

12
00:01:02,160 --> 00:01:05,280
looking at well

13
00:01:03,440 --> 00:01:06,640
where do i have data regarding i'm

14
00:01:05,280 --> 00:01:08,479
really not batman you've got some

15
00:01:06,640 --> 00:01:11,200
ciracata you've got some

16
00:01:08,479 --> 00:01:27,840
packet capture some interesting data

17
00:01:11,200 --> 00:01:27,840
sources that may contain your answer

18
00:01:34,960 --> 00:01:38,320
and andy i see that your hand is up does

19
00:01:36,960 --> 00:01:41,839
that mean you found the uh

20
00:01:38,320 --> 00:01:41,839
the ip address already

21
00:01:49,600 --> 00:01:55,839
hey hey awesome way to go june

22
00:02:13,520 --> 00:02:17,920
just putting the hints back up on here

23
00:02:15,680 --> 00:02:17,920
so

24
00:02:18,640 --> 00:02:24,000
those of you less familiar with splunk

25
00:02:20,319 --> 00:02:28,079
when you get that first search done

26
00:02:24,000 --> 00:02:31,440
most of the fields that will be

27
00:02:28,080 --> 00:02:32,000
that will pertain to what you're looking

28
00:02:31,440 --> 00:02:34,319
for

29
00:02:32,000 --> 00:02:36,800
are going to be there on the left side

30
00:02:34,319 --> 00:02:40,000
under those interesting fields

31
00:02:36,800 --> 00:02:41,760
so just simply looking through what's

32
00:02:40,000 --> 00:02:42,480
available to you in the interesting

33
00:02:41,760 --> 00:02:45,040
fields

34
00:02:42,480 --> 00:02:45,760
and taking a look at some of the results

35
00:02:45,040 --> 00:02:47,280
in those

36
00:02:45,760 --> 00:02:49,040
interesting fields which you can do by

37
00:02:47,280 --> 00:02:51,840
clicking on them

38
00:02:49,040 --> 00:02:53,760
will uh will lead you very quickly to

39
00:02:51,840 --> 00:02:55,920
the answer

40
00:02:53,760 --> 00:02:58,399
uh oh june you have a question yeah go

41
00:02:55,920 --> 00:02:58,399
right ahead

42
00:03:01,440 --> 00:03:05,120
and you know you guys feel free if you

43
00:03:03,200 --> 00:03:06,480
want to either

44
00:03:05,120 --> 00:03:08,879
if you want to just talk to me you can

45
00:03:06,480 --> 00:03:09,518
do it in the just to the the panelists

46
00:03:08,879 --> 00:03:11,840
um

47
00:03:09,519 --> 00:03:13,440
which i think you did june um or you can

48
00:03:11,840 --> 00:03:14,800
do it to all attendees

49
00:03:13,440 --> 00:03:16,560
and you can make comments to all

50
00:03:14,800 --> 00:03:19,840
attendees as well but go

51
00:03:16,560 --> 00:03:22,959
go for it june what's up

52
00:03:19,840 --> 00:03:25,120
oh okay cool

53
00:03:22,959 --> 00:03:26,480
i'm so good i didn't even have to answer

54
00:03:25,120 --> 00:03:29,840
your questions just

55
00:03:26,480 --> 00:03:29,840
mentally transmitted it to you

56
00:03:30,239 --> 00:03:33,840
anybody else think they have the answer

57
00:03:41,360 --> 00:03:44,239
all right well i'm going to give one

58
00:03:42,480 --> 00:03:45,280
more minute just in case some of you

59
00:03:44,239 --> 00:03:47,599
bloodhounds are

60
00:03:45,280 --> 00:03:49,200
hot on the trail and then i'm going to

61
00:03:47,599 --> 00:03:51,119
walk you through the first answer

62
00:03:49,200 --> 00:03:52,560
and as i walk you through the first one

63
00:03:51,120 --> 00:03:54,480
you're going to it's going to give you a

64
00:03:52,560 --> 00:03:55,040
pretty good feel for the methodology

65
00:03:54,480 --> 00:03:56,720
here

66
00:03:55,040 --> 00:04:00,798
and the following questions are going to

67
00:03:56,720 --> 00:04:04,159
become much easier for you to find so

68
00:04:00,799 --> 00:04:06,400
just another more minute actually

69
00:04:04,159 --> 00:04:08,319
if anyone needs another minute please

70
00:04:06,400 --> 00:04:09,280
put it in the chat otherwise i'm going

71
00:04:08,319 --> 00:04:10,958
to go ahead

72
00:04:09,280 --> 00:04:15,519
and walk through our first solution

73
00:04:10,959 --> 00:04:16,959
how's that

74
00:04:15,519 --> 00:04:18,720
all right doesn't look like anybody

75
00:04:16,959 --> 00:04:20,720
needs any extra time

76
00:04:18,720 --> 00:04:22,400
let's take a look at how we would find

77
00:04:20,720 --> 00:04:24,639
this answer so

78
00:04:22,400 --> 00:04:25,919
i told you to cast your net wide so we

79
00:04:24,639 --> 00:04:27,360
can start with the one bit of

80
00:04:25,919 --> 00:04:30,880
information we know for sure

81
00:04:27,360 --> 00:04:32,639
which is i'm really not batman.com

82
00:04:30,880 --> 00:04:33,919
and when we look take a look we do see

83
00:04:32,639 --> 00:04:37,040
that there's quite a bit

84
00:04:33,919 --> 00:04:40,159
of data um in this case logs uh

85
00:04:37,040 --> 00:04:41,040
regarding i'm really not batman.com in

86
00:04:40,160 --> 00:04:44,320
our ids

87
00:04:41,040 --> 00:04:46,080
in our packet capture

88
00:04:44,320 --> 00:04:48,240
and some other data sources here as well

89
00:04:46,080 --> 00:04:49,280
that's great that we'll probably find

90
00:04:48,240 --> 00:04:52,960
what we're looking for

91
00:04:49,280 --> 00:04:55,280
in there uh if we scroll down i told you

92
00:04:52,960 --> 00:04:57,520
that the src field source field

93
00:04:55,280 --> 00:04:59,679
is going to contain your answer and if

94
00:04:57,520 --> 00:05:00,400
we scroll down in these interesting

95
00:04:59,680 --> 00:05:03,360
fields

96
00:05:00,400 --> 00:05:03,840
we're going to find the field called src

97
00:05:03,360 --> 00:05:07,199
oh

98
00:05:03,840 --> 00:05:07,198
can you guys not see my screen

99
00:05:09,680 --> 00:05:16,240
i i am showing it uh can can everybody

100
00:05:13,039 --> 00:05:16,240
can you see my screen

101
00:05:19,440 --> 00:05:25,600
the rest of the class anybody you can

102
00:05:20,960 --> 00:05:28,000
see it bob can see it okay

103
00:05:25,600 --> 00:05:28,720
you see finding source addresses right

104
00:05:28,000 --> 00:05:33,360
yeah okay

105
00:05:28,720 --> 00:05:36,560
yep um so tammy i'm not sure

106
00:05:33,360 --> 00:05:37,120
uh it's so this screen is in through the

107
00:05:36,560 --> 00:05:40,320
zoom

108
00:05:37,120 --> 00:05:41,199
so if you're maybe uh maybe when you

109
00:05:40,320 --> 00:05:44,560
started in your

110
00:05:41,199 --> 00:05:53,280
browser it sunk to the back or something

111
00:05:44,560 --> 00:05:57,440
um have you found it tammy

112
00:05:53,280 --> 00:05:59,758
okay cool all right so um

113
00:05:57,440 --> 00:06:01,600
so uh we're uh if we take a look at the

114
00:05:59,759 --> 00:06:02,000
source field and we just simply click on

115
00:06:01,600 --> 00:06:03,919
it

116
00:06:02,000 --> 00:06:06,319
we're gonna get this box here that pops

117
00:06:03,919 --> 00:06:09,440
up that shows us

118
00:06:06,319 --> 00:06:10,319
the the top values essentially of uh of

119
00:06:09,440 --> 00:06:13,680
this field

120
00:06:10,319 --> 00:06:16,720
and we see a couple of uh addresses here

121
00:06:13,680 --> 00:06:19,680
um both internal and external

122
00:06:16,720 --> 00:06:21,600
uh i really hope 192.168 was not vuln

123
00:06:19,680 --> 00:06:24,720
scanning our web server unless it's

124
00:06:21,600 --> 00:06:27,759
actually one of our own volt scanners

125
00:06:24,720 --> 00:06:30,720
and then some external ip addresses

126
00:06:27,759 --> 00:06:32,400
and this top address 40 that's probably

127
00:06:30,720 --> 00:06:34,800
our prime suspect here right

128
00:06:32,400 --> 00:06:36,638
von scanning is a noisy business right

129
00:06:34,800 --> 00:06:39,680
it's uh it's going to create a lot

130
00:06:36,639 --> 00:06:41,520
of um traffic

131
00:06:39,680 --> 00:06:43,680
uh to our web server so there's a good

132
00:06:41,520 --> 00:06:46,960
chance that 40 is our suspect

133
00:06:43,680 --> 00:06:49,280
um 23 here as well potentially but

134
00:06:46,960 --> 00:06:50,880
40 is where i'd be putting my bet that's

135
00:06:49,280 --> 00:06:52,880
not proof though right we need to

136
00:06:50,880 --> 00:06:55,039
actually validate our hypothesis but at

137
00:06:52,880 --> 00:06:56,960
least we're building a hypothesis

138
00:06:55,039 --> 00:06:59,199
now when um when you've got a bone scan

139
00:06:56,960 --> 00:06:59,680
going on that's going to come over the

140
00:06:59,199 --> 00:07:01,520
wire

141
00:06:59,680 --> 00:07:03,280
and we are fortunate enough to have

142
00:07:01,520 --> 00:07:05,280
capture here so

143
00:07:03,280 --> 00:07:06,719
uh we might want to check literally in

144
00:07:05,280 --> 00:07:08,638
the wire

145
00:07:06,720 --> 00:07:10,240
the wire feed the packet capture so

146
00:07:08,639 --> 00:07:12,080
stream http

147
00:07:10,240 --> 00:07:13,759
and by the way you didn't have to type

148
00:07:12,080 --> 00:07:16,240
this back here

149
00:07:13,759 --> 00:07:18,319
when we were looking at the source types

150
00:07:16,240 --> 00:07:21,440
we can literally just click on that

151
00:07:18,319 --> 00:07:22,560
and add it up into our search but here

152
00:07:21,440 --> 00:07:24,960
it is in our search

153
00:07:22,560 --> 00:07:26,479
and if we take a look at source again we

154
00:07:24,960 --> 00:07:27,440
see that that narrows things down

155
00:07:26,479 --> 00:07:29,680
considerably

156
00:07:27,440 --> 00:07:31,520
only 40 and 23 were talking to i'm

157
00:07:29,680 --> 00:07:34,960
really not batman.com

158
00:07:31,520 --> 00:07:37,280
over uh over http uh in this particular

159
00:07:34,960 --> 00:07:40,080
data set

160
00:07:37,280 --> 00:07:42,080
so 40 is still my suspect but i want to

161
00:07:40,080 --> 00:07:45,359
fully validate my hypothesis

162
00:07:42,080 --> 00:07:47,680
so i'm going to switch source types now

163
00:07:45,360 --> 00:07:48,720
to circada to our intrusion detection

164
00:07:47,680 --> 00:07:50,639
because

165
00:07:48,720 --> 00:07:52,080
intrusion detection stuff would know

166
00:07:50,639 --> 00:07:55,199
about stuff like that right

167
00:07:52,080 --> 00:07:57,198
avon scan usually sends packets

168
00:07:55,199 --> 00:07:59,039
very similar to the exploit if not

169
00:07:57,199 --> 00:08:00,319
exactly like the exploit it just doesn't

170
00:07:59,039 --> 00:08:03,759
complete the attack

171
00:08:00,319 --> 00:08:05,759
in most cases so i i know that 40

172
00:08:03,759 --> 00:08:08,319
is my suspect here so i'll add that up

173
00:08:05,759 --> 00:08:09,919
into the um

174
00:08:08,319 --> 00:08:11,759
into the search and again i can do that

175
00:08:09,919 --> 00:08:14,639
simply by clicking 40

176
00:08:11,759 --> 00:08:17,440
when i was looking at source ips i can

177
00:08:14,639 --> 00:08:20,879
switch my source type circada

178
00:08:17,440 --> 00:08:22,319
and when i do that i'm going to

179
00:08:20,879 --> 00:08:24,000
want to scroll all the way down because

180
00:08:22,319 --> 00:08:26,479
what we want from circada

181
00:08:24,000 --> 00:08:27,440
is the signatures and signatures isn't

182
00:08:26,479 --> 00:08:29,520
showing up here

183
00:08:27,440 --> 00:08:30,800
in the most common fields so we're going

184
00:08:29,520 --> 00:08:32,399
to take a look at

185
00:08:30,800 --> 00:08:34,080
the remaining fields that we couldn't

186
00:08:32,399 --> 00:08:36,479
display on the left

187
00:08:34,080 --> 00:08:37,279
so if you click on 19 more fields and

188
00:08:36,479 --> 00:08:39,440
then

189
00:08:37,279 --> 00:08:40,399
within the search box in the dialogue

190
00:08:39,440 --> 00:08:42,479
that comes up

191
00:08:40,399 --> 00:08:43,839
type in sig and by the time you get done

192
00:08:42,479 --> 00:08:44,959
with g you're going to have something

193
00:08:43,839 --> 00:08:48,000
that looks like this

194
00:08:44,959 --> 00:08:51,680
and there's our signatures if we expand

195
00:08:48,000 --> 00:08:54,640
the signature field out what do we see

196
00:08:51,680 --> 00:08:55,359
yeah 103 possible cross-site scripting

197
00:08:54,640 --> 00:08:57,600
attempts

198
00:08:55,360 --> 00:08:59,120
uh 48 likely cross-fight scripting

199
00:08:57,600 --> 00:09:02,240
attempts um

200
00:08:59,120 --> 00:09:05,120
some uh some sql injection yeah

201
00:09:02,240 --> 00:09:06,640
does this look like a bone scan if

202
00:09:05,120 --> 00:09:08,560
you've ever worked in a sock

203
00:09:06,640 --> 00:09:10,480
yeah this pretty much does look like a

204
00:09:08,560 --> 00:09:14,079
vuln scan at this point

205
00:09:10,480 --> 00:09:16,399
i can say we've validated our hypothesis

206
00:09:14,080 --> 00:09:17,920
if we were actually competing we'd go to

207
00:09:16,399 --> 00:09:20,959
our scoring server we'd pop

208
00:09:17,920 --> 00:09:23,360
40 into the uh into the

209
00:09:20,959 --> 00:09:24,079
answer uh in the scoring server as our

210
00:09:23,360 --> 00:09:27,440
answer

211
00:09:24,080 --> 00:09:30,720
and then we would uh also paste um

212
00:09:27,440 --> 00:09:33,440
our search if we wanted bonus points so

213
00:09:30,720 --> 00:09:34,959
uh good job team corncon you guys just

214
00:09:33,440 --> 00:09:38,560
scored 100 points

215
00:09:34,959 --> 00:09:40,560
um in the uh in the example search here

216
00:09:38,560 --> 00:09:42,000
where uh we're getting a little fancy

217
00:09:40,560 --> 00:09:42,640
and we're doing it for a couple reasons

218
00:09:42,000 --> 00:09:44,880
one

219
00:09:42,640 --> 00:09:45,760
to teach you about other commands that

220
00:09:44,880 --> 00:09:48,640
you may use

221
00:09:45,760 --> 00:09:49,519
later on in this class but also to show

222
00:09:48,640 --> 00:09:51,120
you a way that

223
00:09:49,519 --> 00:09:53,360
you can take your results and put it

224
00:09:51,120 --> 00:09:55,600
into tables that might be helpful if

225
00:09:53,360 --> 00:09:58,000
you're building a report

226
00:09:55,600 --> 00:10:00,240
uh so in this particular case we've uh

227
00:09:58,000 --> 00:10:02,480
we've taken what we were looking for

228
00:10:00,240 --> 00:10:03,279
and then we threw it into a special kind

229
00:10:02,480 --> 00:10:05,760
of table

230
00:10:03,279 --> 00:10:06,880
it's called stats stats lets you do

231
00:10:05,760 --> 00:10:08,880
multiple things like

232
00:10:06,880 --> 00:10:10,399
count and when you want to count things

233
00:10:08,880 --> 00:10:12,880
you tell it what you want to count

234
00:10:10,399 --> 00:10:13,680
by so in this particular case we're

235
00:10:12,880 --> 00:10:16,160
counting up

236
00:10:13,680 --> 00:10:18,160
the source ips and then we're sorting it

237
00:10:16,160 --> 00:10:22,959
in reverse order so that the

238
00:10:18,160 --> 00:10:26,480
top value comes to the top of the table

239
00:10:22,959 --> 00:10:29,599
so we're also because we are awesome

240
00:10:26,480 --> 00:10:32,800
junior investigators we're going to map

241
00:10:29,600 --> 00:10:34,720
uh this to our kill chain as well so

242
00:10:32,800 --> 00:10:37,279
attacker is obviously doing some recon

243
00:10:34,720 --> 00:10:38,640
here and the ip address for that recon

244
00:10:37,279 --> 00:10:41,920
was 40.

245
00:10:38,640 --> 00:10:45,199
another great documentation

246
00:10:41,920 --> 00:10:47,279
format is a basically an attack diagram

247
00:10:45,200 --> 00:10:49,680
so if we start taking we start building

248
00:10:47,279 --> 00:10:53,279
out essentially a vizio

249
00:10:49,680 --> 00:10:55,120
of what was going on here we we've got

250
00:10:53,279 --> 00:10:56,399
40 doing a vault scan against i'm really

251
00:10:55,120 --> 00:10:58,480
not batman.com

252
00:10:56,399 --> 00:11:00,480
as this fleshes out you'll see that this

253
00:10:58,480 --> 00:11:02,959
is a fairly useful tool

254
00:11:00,480 --> 00:11:03,920
um for documenting attacks it's really

255
00:11:02,959 --> 00:11:05,920
great

256
00:11:03,920 --> 00:11:07,040
if you're doing a follow the sun or you

257
00:11:05,920 --> 00:11:08,880
have tiered

258
00:11:07,040 --> 00:11:10,399
sock where tier one might escalate to

259
00:11:08,880 --> 00:11:12,160
tier two and tier three

260
00:11:10,399 --> 00:11:14,000
a picture like this and as it fleshes

261
00:11:12,160 --> 00:11:14,880
out you'll see is really helpful for

262
00:11:14,000 --> 00:11:17,920
visualizing

263
00:11:14,880 --> 00:11:21,040
the attack so

264
00:11:17,920 --> 00:11:23,439
uh on to our next uh

265
00:11:21,040 --> 00:11:24,800
challenge it's gonna build off of what

266
00:11:23,440 --> 00:11:28,399
you already learned

267
00:11:24,800 --> 00:11:31,920
um so we know how to find data

268
00:11:28,399 --> 00:11:33,920
that contains this vuln scan

269
00:11:31,920 --> 00:11:35,839
we want to know what volt scanner poison

270
00:11:33,920 --> 00:11:37,120
ivy used

271
00:11:35,839 --> 00:11:39,200
and we might want to know that for

272
00:11:37,120 --> 00:11:40,560
multiple things this can help us build

273
00:11:39,200 --> 00:11:43,120
our own internal

274
00:11:40,560 --> 00:11:44,640
threat feed and fingerprint of our

275
00:11:43,120 --> 00:11:47,040
attackers

276
00:11:44,640 --> 00:11:48,640
so that we can do at least a little bit

277
00:11:47,040 --> 00:11:51,760
of attribution or at least

278
00:11:48,640 --> 00:11:55,199
try to identify our attackers

279
00:11:51,760 --> 00:11:56,560
ttps for those of you less familiar with

280
00:11:55,200 --> 00:11:58,880
phone scanners

281
00:11:56,560 --> 00:12:00,079
um all phone scanners pretty much out

282
00:11:58,880 --> 00:12:02,560
there announce

283
00:12:00,079 --> 00:12:04,399
what they are now an attacker can change

284
00:12:02,560 --> 00:12:05,920
that right but by default

285
00:12:04,399 --> 00:12:08,240
they're going to tell you what they are

286
00:12:05,920 --> 00:12:08,959
because if they're being used by our own

287
00:12:08,240 --> 00:12:10,880
people

288
00:12:08,959 --> 00:12:13,279
you know we want it to be easily

289
00:12:10,880 --> 00:12:15,519
identified that announcement

290
00:12:13,279 --> 00:12:17,439
is going to show up in various places

291
00:12:15,519 --> 00:12:20,079
it's going to show up in packet headers

292
00:12:17,440 --> 00:12:22,560
it's going to show up in places like

293
00:12:20,079 --> 00:12:25,599
user agent strings

294
00:12:22,560 --> 00:12:27,439
so you'll actually be able to find the

295
00:12:25,600 --> 00:12:28,800
von scanner's name because it's going to

296
00:12:27,440 --> 00:12:32,959
say this

297
00:12:28,800 --> 00:12:35,040
is scanner um in those data sets

298
00:12:32,959 --> 00:12:37,439
uh and and that will be the answer to

299
00:12:35,040 --> 00:12:38,240
your question if you see a word that you

300
00:12:37,440 --> 00:12:40,320
think might be a

301
00:12:38,240 --> 00:12:41,440
scanner but you're not familiar who's

302
00:12:40,320 --> 00:12:42,720
everybody's uh

303
00:12:41,440 --> 00:12:44,959
you know what's every investigator's

304
00:12:42,720 --> 00:12:47,279
best friend google

305
00:12:44,959 --> 00:12:53,839
so i'll give you like two minutes and

306
00:12:47,279 --> 00:12:55,680
then we'll walk through the answer

307
00:12:53,839 --> 00:12:58,000
by the way while you're going through

308
00:12:55,680 --> 00:13:01,199
that for those of you that are doing

309
00:12:58,000 --> 00:13:01,680
the um following through on the app i'm

310
00:13:01,200 --> 00:13:04,720
going to

311
00:13:01,680 --> 00:13:06,560
switch over to the app and show you how

312
00:13:04,720 --> 00:13:09,200
we would have gotten to that answer

313
00:13:06,560 --> 00:13:11,199
the previous answer in the um in the app

314
00:13:09,200 --> 00:13:13,200
itself so if we had gone to the apt

315
00:13:11,200 --> 00:13:16,480
scenario

316
00:13:13,200 --> 00:13:17,040
uh and then said went to finding the ip

317
00:13:16,480 --> 00:13:20,240
address

318
00:13:17,040 --> 00:13:23,439
that was scanning a web server

319
00:13:20,240 --> 00:13:24,880
the very first search here is going to

320
00:13:23,440 --> 00:13:26,639
do exactly what we showed you in the

321
00:13:24,880 --> 00:13:28,720
slides which is look for

322
00:13:26,639 --> 00:13:30,240
anything involving i'm really not

323
00:13:28,720 --> 00:13:32,320
batman.com

324
00:13:30,240 --> 00:13:34,399
and then if we just like in the slides

325
00:13:32,320 --> 00:13:38,320
if we scroll down until we find

326
00:13:34,399 --> 00:13:41,600
the source field there it is

327
00:13:38,320 --> 00:13:43,600
there's our results there's our suspect

328
00:13:41,600 --> 00:13:45,360
but we have to further validate right so

329
00:13:43,600 --> 00:13:48,880
if we wanted further validate

330
00:13:45,360 --> 00:13:51,120
we could do things like literally adding

331
00:13:48,880 --> 00:13:52,720
40 up into our search

332
00:13:51,120 --> 00:13:54,240
so we're now we're refining things and

333
00:13:52,720 --> 00:13:58,240
then maybe change the source

334
00:13:54,240 --> 00:14:01,600
type to ciracotta like i had showed you

335
00:13:58,240 --> 00:14:03,519
then within cerakata results

336
00:14:01,600 --> 00:14:05,199
we can actually take a look for at the

337
00:14:03,519 --> 00:14:07,680
signific signature fields

338
00:14:05,199 --> 00:14:09,199
and there's that the evidence of that

339
00:14:07,680 --> 00:14:11,920
bone scan right there

340
00:14:09,199 --> 00:14:13,839
um uh so that's the way you can use the

341
00:14:11,920 --> 00:14:17,040
app to give yourself a hint

342
00:14:13,839 --> 00:14:17,839
um and then further refine or if you're

343
00:14:17,040 --> 00:14:20,000
still not sure

344
00:14:17,839 --> 00:14:21,760
after running that first search you can

345
00:14:20,000 --> 00:14:23,839
run the next search

346
00:14:21,760 --> 00:14:25,360
which is you know taking a look at the

347
00:14:23,839 --> 00:14:27,360
stream data

348
00:14:25,360 --> 00:14:29,839
which would then allow us to look at the

349
00:14:27,360 --> 00:14:32,079
source field

350
00:14:29,839 --> 00:14:33,600
and see who's in there right 40 is the

351
00:14:32,079 --> 00:14:35,120
only one there now the search isn't done

352
00:14:33,600 --> 00:14:38,160
running um

353
00:14:35,120 --> 00:14:40,320
but it's in there uh and

354
00:14:38,160 --> 00:14:42,079
and in this case uh we not only had to

355
00:14:40,320 --> 00:14:44,720
find it but we had to validate it

356
00:14:42,079 --> 00:14:47,359
so this was one of those two parters and

357
00:14:44,720 --> 00:14:50,079
here are more searches and more searches

358
00:14:47,360 --> 00:14:51,120
um slowly bringing us closer and closer

359
00:14:50,079 --> 00:14:54,560
to the answer

360
00:14:51,120 --> 00:14:57,120
um of our question and if you're

361
00:14:54,560 --> 00:14:58,959
following along the next challenge is

362
00:14:57,120 --> 00:14:59,600
identifying the name of the webvold

363
00:14:58,959 --> 00:15:01,359
scanner

364
00:14:59,600 --> 00:15:04,000
so you could literally click here next

365
00:15:01,360 --> 00:15:05,440
and continue following along in the app

366
00:15:04,000 --> 00:15:07,360
those of you doing it from the search

367
00:15:05,440 --> 00:15:08,720
bar you know what you're doing

368
00:15:07,360 --> 00:15:13,839
and you would just start entering your

369
00:15:08,720 --> 00:15:13,839
search in here

370
00:15:18,720 --> 00:15:24,800
oh daniel yes um you can

371
00:15:21,760 --> 00:15:26,560
get access to the system here are you

372
00:15:24,800 --> 00:15:27,760
still here daniel i i didn't see you

373
00:15:26,560 --> 00:15:31,359
until you

374
00:15:27,760 --> 00:15:33,519
put that in the q a but

375
00:15:31,360 --> 00:15:34,959
cool all right so i'm going to get you a

376
00:15:33,519 --> 00:15:41,839
set of credentials here

377
00:15:34,959 --> 00:15:41,839
hold on just a minute

378
00:15:53,279 --> 00:15:58,160
so daniel in the chat

379
00:15:58,639 --> 00:16:01,920
actually i can probably do it for you in

380
00:16:00,160 --> 00:16:04,240
the q a

381
00:16:01,920 --> 00:16:04,240
um

382
00:16:05,600 --> 00:16:09,600
go to that google doc that i just pasted

383
00:16:08,560 --> 00:16:12,160
in

384
00:16:09,600 --> 00:16:12,880
in the q a that'll bring you to this

385
00:16:12,160 --> 00:16:15,519
document

386
00:16:12,880 --> 00:16:17,680
here when you get to this document you

387
00:16:15,519 --> 00:16:20,399
can claim a set of credentials

388
00:16:17,680 --> 00:16:21,439
for your own just by putting your name

389
00:16:20,399 --> 00:16:23,839
in there then

390
00:16:21,440 --> 00:16:25,279
go to that go to the link of whichever

391
00:16:23,839 --> 00:16:28,320
one you claim

392
00:16:25,279 --> 00:16:28,720
use that set of credentials and you will

393
00:16:28,320 --> 00:16:32,639
be

394
00:16:28,720 --> 00:16:32,639
in your lab environment

395
00:16:34,240 --> 00:16:39,279
let me know if you have any trouble

396
00:16:35,680 --> 00:16:39,279
getting to it you bet

397
00:16:49,600 --> 00:16:54,079
and uh danny once you're in let me know

398
00:16:52,399 --> 00:16:54,800
and i'll show you how to navigate to

399
00:16:54,079 --> 00:16:57,680
that app

400
00:16:54,800 --> 00:16:59,519
that i was just uh telling everybody is

401
00:16:57,680 --> 00:17:01,839
a um

402
00:16:59,519 --> 00:17:01,839
uh

403
00:17:02,639 --> 00:17:19,839
is a companion to this class bob i'm not

404
00:17:05,760 --> 00:17:19,839
sure what you mean

405
00:17:20,959 --> 00:17:27,679
oh yes good job

406
00:17:24,319 --> 00:17:28,960
um so

407
00:17:27,679 --> 00:17:33,840
daniel let me know when you're all

408
00:17:28,960 --> 00:17:33,840
logged in

409
00:17:44,840 --> 00:17:50,240
uh

410
00:17:46,960 --> 00:17:52,320
you can't okay um i'm gonna put it in

411
00:17:50,240 --> 00:17:53,520
the chat so switch over to the chat

412
00:17:52,320 --> 00:17:55,760
daniel

413
00:17:53,520 --> 00:17:58,879
um and i'll put it in there and see if

414
00:17:55,760 --> 00:18:01,840
you can copy it from there

415
00:17:58,880 --> 00:18:01,840
try that

416
00:18:06,799 --> 00:18:15,840
in fact you should be able to just click

417
00:18:08,559 --> 00:18:15,840
on it there

418
00:18:17,840 --> 00:18:21,280
by the way happy almost halloween

419
00:18:19,600 --> 00:18:22,879
everybody you can see that my

420
00:18:21,280 --> 00:18:24,080
wife oh well you could see when i had my

421
00:18:22,880 --> 00:18:26,000
camera on that my wife had already

422
00:18:24,080 --> 00:18:29,840
started with the

423
00:18:26,000 --> 00:18:29,840
the um the decorations

424
00:18:30,000 --> 00:18:33,919
cool daniel you're in so what you want

425
00:18:32,480 --> 00:18:36,960
to do

426
00:18:33,919 --> 00:18:40,000
is you're going to be

427
00:18:36,960 --> 00:18:41,760
somewhere that looks like this

428
00:18:40,000 --> 00:18:43,120
if you're used to splunk you can do your

429
00:18:41,760 --> 00:18:46,080
searches from here

430
00:18:43,120 --> 00:18:47,678
if you need help with your searches you

431
00:18:46,080 --> 00:18:49,918
want to get like little hints

432
00:18:47,679 --> 00:18:51,120
we have this app here so if you click on

433
00:18:49,919 --> 00:18:54,320
this and then

434
00:18:51,120 --> 00:18:56,639
right click on opening

435
00:18:54,320 --> 00:18:58,399
and opening a new tab you're going to

436
00:18:56,640 --> 00:19:01,760
get

437
00:18:58,400 --> 00:19:03,840
let's start at the base you're going to

438
00:19:01,760 --> 00:19:06,240
get a

439
00:19:03,840 --> 00:19:08,959
an app that looks like this and then to

440
00:19:06,240 --> 00:19:11,919
navigate to where we are in the class

441
00:19:08,960 --> 00:19:12,480
at any time take a look at what i have

442
00:19:11,919 --> 00:19:14,400
up here

443
00:19:12,480 --> 00:19:15,840
on the slides so it tells you we're in

444
00:19:14,400 --> 00:19:18,720
the recon phase

445
00:19:15,840 --> 00:19:19,520
and the question is identifying the vuln

446
00:19:18,720 --> 00:19:22,799
scanner

447
00:19:19,520 --> 00:19:25,760
from here you can go

448
00:19:22,799 --> 00:19:28,160
recon which matches up with my slide

449
00:19:25,760 --> 00:19:31,840
identifying the webvold scanner

450
00:19:28,160 --> 00:19:35,039
and this app will provide you with

451
00:19:31,840 --> 00:19:37,600
searches that get you closer and closer

452
00:19:35,039 --> 00:19:39,840
to the answer without giving away right

453
00:19:37,600 --> 00:19:39,840
away

454
00:19:39,919 --> 00:19:46,160
so the reason why we're looking at 40 uh

455
00:19:43,440 --> 00:19:47,039
in our search is because we found out

456
00:19:46,160 --> 00:19:49,280
that it was

457
00:19:47,039 --> 00:19:50,160
doing the vuln scanning in the last

458
00:19:49,280 --> 00:19:53,440
question

459
00:19:50,160 --> 00:19:57,039
so our current question is see if we can

460
00:19:53,440 --> 00:19:57,039
figure out who

461
00:19:57,280 --> 00:20:00,639
uh which volt scanner was actually in

462
00:19:59,360 --> 00:20:03,840
use um

463
00:20:00,640 --> 00:20:05,280
so uh that should catch you up um

464
00:20:03,840 --> 00:20:07,039
most of the classes probably had enough

465
00:20:05,280 --> 00:20:08,720
time to find the answer so i'm going to

466
00:20:07,039 --> 00:20:10,158
walk you through the answer for this one

467
00:20:08,720 --> 00:20:12,000
so just watch as we go through the

468
00:20:10,159 --> 00:20:13,280
answer and that should help you figure

469
00:20:12,000 --> 00:20:15,760
out how to carry on

470
00:20:13,280 --> 00:20:18,000
through the rest of the class um are

471
00:20:15,760 --> 00:20:21,039
there any other questions

472
00:20:18,000 --> 00:20:24,320
no um good good

473
00:20:21,039 --> 00:20:24,320
all right let's go through the answer

474
00:20:24,400 --> 00:20:28,320
so i gave you a couple hints user agent

475
00:20:27,200 --> 00:20:30,400
strings and

476
00:20:28,320 --> 00:20:32,240
packets themselves may contain the

477
00:20:30,400 --> 00:20:34,720
information that you're looking for

478
00:20:32,240 --> 00:20:35,520
for this challenge so let's take a look

479
00:20:34,720 --> 00:20:38,240
at that um

480
00:20:35,520 --> 00:20:38,799
we know that 40 was our attacker the one

481
00:20:38,240 --> 00:20:41,520
that do

482
00:20:38,799 --> 00:20:43,360
was doing the bone scan so we can narrow

483
00:20:41,520 --> 00:20:46,960
down our search really fast that way

484
00:20:43,360 --> 00:20:48,559
right we also know that headers is one

485
00:20:46,960 --> 00:20:49,919
of the places we might want to look

486
00:20:48,559 --> 00:20:51,520
and headers are going to be where

487
00:20:49,919 --> 00:20:54,159
they're going to be in packet captures

488
00:20:51,520 --> 00:20:57,600
so if we add the stream http

489
00:20:54,159 --> 00:21:00,960
um which is our stream is

490
00:20:57,600 --> 00:21:03,280
our packet capture and the particular

491
00:21:00,960 --> 00:21:04,240
protocol is going to be http so we'll go

492
00:21:03,280 --> 00:21:07,200
with that

493
00:21:04,240 --> 00:21:09,440
index for stream and if we do that

494
00:21:07,200 --> 00:21:11,760
scroll all the way down until we find

495
00:21:09,440 --> 00:21:13,120
something that tells us about headers oh

496
00:21:11,760 --> 00:21:15,039
look there's a field called

497
00:21:13,120 --> 00:21:16,719
source headers that's probably a good

498
00:21:15,039 --> 00:21:18,799
place to go looking

499
00:21:16,720 --> 00:21:20,080
and if we just simply click on that

500
00:21:18,799 --> 00:21:21,918
field over here

501
00:21:20,080 --> 00:21:23,918
some stuff is going to pop up right away

502
00:21:21,919 --> 00:21:24,960
as you know as far as the most common

503
00:21:23,919 --> 00:21:26,320
values go

504
00:21:24,960 --> 00:21:28,240
you might even be able to see it here

505
00:21:26,320 --> 00:21:31,039
but let me zoom in

506
00:21:28,240 --> 00:21:32,000
right there in the values itself

507
00:21:31,039 --> 00:21:34,879
acunetix

508
00:21:32,000 --> 00:21:35,280
web phone scanner free edition yep

509
00:21:34,880 --> 00:21:37,840
that's

510
00:21:35,280 --> 00:21:38,480
it um i mean it's it's shouting it out

511
00:21:37,840 --> 00:21:42,000
pretty much

512
00:21:38,480 --> 00:21:43,039
in in plain sight there um i also gave

513
00:21:42,000 --> 00:21:44,799
you a

514
00:21:43,039 --> 00:21:46,240
another hint that user agent strings

515
00:21:44,799 --> 00:21:50,158
might be a place to look

516
00:21:46,240 --> 00:21:52,000
so if we switch over to finding field

517
00:21:50,159 --> 00:21:53,440
that references something about user

518
00:21:52,000 --> 00:21:57,760
agent strings we find

519
00:21:53,440 --> 00:22:00,000
http underscore user underscore agent

520
00:21:57,760 --> 00:22:00,799
and clicking on that clicking on that

521
00:22:00,000 --> 00:22:05,039
field

522
00:22:00,799 --> 00:22:08,320
uh we see some reference to acunetix wvs

523
00:22:05,039 --> 00:22:09,760
security test uh yeah but that looks

524
00:22:08,320 --> 00:22:11,439
like what we're looking for but you know

525
00:22:09,760 --> 00:22:12,158
it's not as blatant as the other stuff

526
00:22:11,440 --> 00:22:14,960
we saw

527
00:22:12,159 --> 00:22:15,760
um if we didn't know for sure we might

528
00:22:14,960 --> 00:22:19,200
google

529
00:22:15,760 --> 00:22:20,158
that word acunetix and yep it's a phone

530
00:22:19,200 --> 00:22:23,280
scanner

531
00:22:20,159 --> 00:22:26,400
awesome pop that into our scoring server

532
00:22:23,280 --> 00:22:28,480
uh team corncon just covered another 100

533
00:22:26,400 --> 00:22:30,640
points you guys are rocking it

534
00:22:28,480 --> 00:22:31,600
we're going to document our work so

535
00:22:30,640 --> 00:22:34,960
we're going to throw that

536
00:22:31,600 --> 00:22:36,719
into the uh into our lockheed martin

537
00:22:34,960 --> 00:22:39,600
kill chain

538
00:22:36,720 --> 00:22:40,799
view uh still at the reconnaissance

539
00:22:39,600 --> 00:22:41,678
phase here we're going to throw that

540
00:22:40,799 --> 00:22:46,559
into

541
00:22:41,679 --> 00:22:49,600
our uh our attack picture as well

542
00:22:46,559 --> 00:22:51,360
uh and move on to our next challenge so

543
00:22:49,600 --> 00:22:52,959
um it'd be also helpful to know what

544
00:22:51,360 --> 00:22:54,879
content management system

545
00:22:52,960 --> 00:22:56,159
is running i'm on i'm really not

546
00:22:54,880 --> 00:22:58,720
batman.com

547
00:22:56,159 --> 00:23:00,799
not that content management systems ever

548
00:22:58,720 --> 00:23:04,080
have vulnerabilities or anything

549
00:23:00,799 --> 00:23:04,799
wordpress um it is not wordpress in this

550
00:23:04,080 --> 00:23:07,520
case

551
00:23:04,799 --> 00:23:08,559
uh but they are uh often wrought with

552
00:23:07,520 --> 00:23:11,120
some bones

553
00:23:08,559 --> 00:23:12,879
so it'd be good to know whether or not

554
00:23:11,120 --> 00:23:16,559
we're running a vulnerable version

555
00:23:12,880 --> 00:23:19,679
of uh of a content management system

556
00:23:16,559 --> 00:23:20,320
so go ahead and try to find what cms it

557
00:23:19,679 --> 00:23:22,640
is

558
00:23:20,320 --> 00:23:23,439
remember that content management systems

559
00:23:22,640 --> 00:23:25,039
are

560
00:23:23,440 --> 00:23:27,120
essentially creating directory

561
00:23:25,039 --> 00:23:29,520
structures and directory structures

562
00:23:27,120 --> 00:23:32,559
correspond with uris

563
00:23:29,520 --> 00:23:36,320
and every software can better software

564
00:23:32,559 --> 00:23:38,720
try by default typically we'll set

565
00:23:36,320 --> 00:23:40,799
the root directory of whatever it's

566
00:23:38,720 --> 00:23:43,120
installing to to its own name

567
00:23:40,799 --> 00:23:44,080
right so you know when you install

568
00:23:43,120 --> 00:23:46,399
windows

569
00:23:44,080 --> 00:23:48,320
what's the the the the base directory

570
00:23:46,400 --> 00:23:51,120
that windows installs in it's

571
00:23:48,320 --> 00:23:52,399
something windows right so other

572
00:23:51,120 --> 00:23:53,918
software does that as well

573
00:23:52,400 --> 00:23:55,840
so you might find references and then

574
00:23:53,919 --> 00:23:59,520
uris

575
00:23:55,840 --> 00:24:03,039
might find that in server logs

576
00:23:59,520 --> 00:24:03,760
all sorts of places so go ahead and dig

577
00:24:03,039 --> 00:24:07,120
into it

578
00:24:03,760 --> 00:24:09,440
some of you may have even spotted it um

579
00:24:07,120 --> 00:24:10,399
when uh when we were going through the

580
00:24:09,440 --> 00:24:12,400
last answer

581
00:24:10,400 --> 00:24:15,120
um if you're familiar with some of the

582
00:24:12,400 --> 00:24:16,559
cms

583
00:24:15,120 --> 00:24:20,559
kind of management systems that are out

584
00:24:16,559 --> 00:24:20,559
there you might have spotted the name

585
00:24:30,840 --> 00:24:33,840
previously

586
00:24:37,120 --> 00:24:40,959
i'll give you just another minute or two

587
00:24:39,840 --> 00:24:47,840
to

588
00:24:40,960 --> 00:24:47,840
uh work through this question

589
00:24:55,600 --> 00:25:00,240
who thinks they've found it already give

590
00:24:57,279 --> 00:25:03,279
me a raised hand in the participants uh

591
00:25:00,240 --> 00:25:05,520
list uh so you can see how you're doing

592
00:25:03,279 --> 00:25:08,080
sweet got a couple people already bob

593
00:25:05,520 --> 00:25:15,840
somehow i knew you'd get that one

594
00:25:08,080 --> 00:25:15,840
brandon good job man

595
00:25:26,880 --> 00:25:43,840
i'll give folks just another minute and

596
00:25:29,520 --> 00:25:43,840
then we'll work through the answer

597
00:25:54,840 --> 00:25:57,840
foreign

598
00:26:33,440 --> 00:26:36,720
okay that should be a good amount of

599
00:26:35,440 --> 00:26:40,080
time for you guys

600
00:26:36,720 --> 00:26:42,640
let's see what we can find so um if you

601
00:26:40,080 --> 00:26:44,480
didn't know what cms was of course you

602
00:26:42,640 --> 00:26:48,240
might have to google that first but i

603
00:26:44,480 --> 00:26:49,919
i gave you some good guidance there

604
00:26:48,240 --> 00:26:51,279
we might also ask ourselves well do we

605
00:26:49,919 --> 00:26:53,840
have the ip address of

606
00:26:51,279 --> 00:26:55,760
that web server if we don't can we

607
00:26:53,840 --> 00:26:57,439
figure that one out

608
00:26:55,760 --> 00:26:59,279
so based on our previous findings

609
00:26:57,440 --> 00:27:02,080
absolutely so if we just

610
00:26:59,279 --> 00:27:03,039
take uh some stuff we already know which

611
00:27:02,080 --> 00:27:06,158
is

612
00:27:03,039 --> 00:27:09,279
40 was going after our server um

613
00:27:06,159 --> 00:27:11,360
and it was coming over the wire and we

614
00:27:09,279 --> 00:27:13,360
dropped down just using that search and

615
00:27:11,360 --> 00:27:16,158
look for the destination field

616
00:27:13,360 --> 00:27:17,760
we see two destinations and if this was

617
00:27:16,159 --> 00:27:20,159
the stuff coming over the wire

618
00:27:17,760 --> 00:27:22,080
dot 70 is almost definitely our web

619
00:27:20,159 --> 00:27:22,720
server right so now we know the ip

620
00:27:22,080 --> 00:27:24,960
address

621
00:27:22,720 --> 00:27:26,960
of our web server uh good information to

622
00:27:24,960 --> 00:27:27,840
have in a large environment would it be

623
00:27:26,960 --> 00:27:29,200
that easy

624
00:27:27,840 --> 00:27:31,439
probably not you might have to do some

625
00:27:29,200 --> 00:27:33,760
more digging just to confirm that that

626
00:27:31,440 --> 00:27:36,880
was i'm really not batman.com

627
00:27:33,760 --> 00:27:38,960
server i p address

628
00:27:36,880 --> 00:27:40,320
but we can leverage that now for our

629
00:27:38,960 --> 00:27:43,039
search so if we

630
00:27:40,320 --> 00:27:44,158
change our search to reflect that we

631
00:27:43,039 --> 00:27:46,960
want to know about

632
00:27:44,159 --> 00:27:47,679
traffic coming to our web server so dot

633
00:27:46,960 --> 00:27:50,000
70

634
00:27:47,679 --> 00:27:52,640
over the wire and then take a look at

635
00:27:50,000 --> 00:27:54,320
the uri field which is one of your hints

636
00:27:52,640 --> 00:27:56,799
so we'd scroll down after running the

637
00:27:54,320 --> 00:27:59,840
search we would scroll down

638
00:27:56,799 --> 00:28:01,600
find uh find things referencing the uris

639
00:27:59,840 --> 00:28:03,199
and like i said we've got a bunch of

640
00:28:01,600 --> 00:28:05,918
directory structure here

641
00:28:03,200 --> 00:28:07,039
and the root of a lot of this is joomla

642
00:28:05,919 --> 00:28:10,159
right

643
00:28:07,039 --> 00:28:11,279
is joomla a content management system i

644
00:28:10,159 --> 00:28:14,080
have no idea

645
00:28:11,279 --> 00:28:15,200
let's go google it what is joomla yeah

646
00:28:14,080 --> 00:28:18,158
what is the joomla

647
00:28:15,200 --> 00:28:18,960
comes back with joomla is a cms that's

648
00:28:18,159 --> 00:28:22,320
definitely

649
00:28:18,960 --> 00:28:23,120
our um uh our cms there can we further

650
00:28:22,320 --> 00:28:24,960
validate it

651
00:28:23,120 --> 00:28:26,959
sure we can do uh we can get a little

652
00:28:24,960 --> 00:28:30,159
fancy here we can actually

653
00:28:26,960 --> 00:28:32,480
change our search so that we're only

654
00:28:30,159 --> 00:28:34,159
sho so we're looking for actual

655
00:28:32,480 --> 00:28:35,600
successful page loads by adding the

656
00:28:34,159 --> 00:28:38,080
status of 200.

657
00:28:35,600 --> 00:28:39,360
uh we throw that into a stats table

658
00:28:38,080 --> 00:28:42,799
which would let us count

659
00:28:39,360 --> 00:28:46,240
by the uri and show the results in

660
00:28:42,799 --> 00:28:48,799
descending order so doing that we get uh

661
00:28:46,240 --> 00:28:51,120
lots and lots of successful page loads

662
00:28:48,799 --> 00:28:52,879
so not only is this the cms on the

663
00:28:51,120 --> 00:28:54,719
server but it's the active one

664
00:28:52,880 --> 00:28:56,399
you know it's always possible that you

665
00:28:54,720 --> 00:28:59,520
may have more than uh

666
00:28:56,399 --> 00:29:01,520
one cms on a server uh

667
00:28:59,520 --> 00:29:02,879
but not all of them are active just

668
00:29:01,520 --> 00:29:06,080
because nobody

669
00:29:02,880 --> 00:29:07,440
refreshed the machine right uh we could

670
00:29:06,080 --> 00:29:10,080
also find the answer

671
00:29:07,440 --> 00:29:11,200
in our um our server logs as well our

672
00:29:10,080 --> 00:29:13,360
web server logs

673
00:29:11,200 --> 00:29:14,240
so if we change our search a little bit

674
00:29:13,360 --> 00:29:17,840
uh

675
00:29:14,240 --> 00:29:19,360
the is calls a successful page load it

676
00:29:17,840 --> 00:29:22,720
puts it in a different field

677
00:29:19,360 --> 00:29:24,320
uh sc underscore status and if we wanted

678
00:29:22,720 --> 00:29:26,320
to show

679
00:29:24,320 --> 00:29:28,720
the actual directory structure we could

680
00:29:26,320 --> 00:29:31,039
call out the values of a field called cs

681
00:29:28,720 --> 00:29:34,480
underscore uri underscore stem

682
00:29:31,039 --> 00:29:36,158
that gives us a uh

683
00:29:34,480 --> 00:29:38,320
result similar to what we saw from the

684
00:29:36,159 --> 00:29:40,240
uris with joomla

685
00:29:38,320 --> 00:29:42,559
at the root of all of this directory

686
00:29:40,240 --> 00:29:45,760
structure right so is it joomla

687
00:29:42,559 --> 00:29:49,600
yeah um if we add that to our

688
00:29:45,760 --> 00:29:53,360
kill chain we can add that to our

689
00:29:49,600 --> 00:29:56,000
attack picture as well and we are ready

690
00:29:53,360 --> 00:29:57,360
to start uh on our next challenge good

691
00:29:56,000 --> 00:30:01,120
job guys

692
00:29:57,360 --> 00:30:01,918
so um changing our uh focus a little bit

693
00:30:01,120 --> 00:30:05,120
here

694
00:30:01,919 --> 00:30:06,559
uh we suspect that uh poison ivy our

695
00:30:05,120 --> 00:30:08,000
attacker

696
00:30:06,559 --> 00:30:11,678
attempted some sort of brute force

697
00:30:08,000 --> 00:30:15,360
attack against the web server itself

698
00:30:11,679 --> 00:30:17,760
so literally they're trying to guess the

699
00:30:15,360 --> 00:30:19,279
user id and password you need to find

700
00:30:17,760 --> 00:30:22,480
out which ip address was

701
00:30:19,279 --> 00:30:24,159
actually running that brute force attack

702
00:30:22,480 --> 00:30:25,679
now a couple of things that will be

703
00:30:24,159 --> 00:30:28,559
helpful in your search

704
00:30:25,679 --> 00:30:29,120
um if you want in the post somebody tell

705
00:30:28,559 --> 00:30:32,000
me

706
00:30:29,120 --> 00:30:33,600
what web method will be the most likely

707
00:30:32,000 --> 00:30:36,799
web method used when you're

708
00:30:33,600 --> 00:30:38,799
sending a name and password to a web

709
00:30:36,799 --> 00:30:40,240
server

710
00:30:38,799 --> 00:30:44,080
anybody know i know you guys know this

711
00:30:40,240 --> 00:30:44,080
one somebody drop it in the in the chat

712
00:30:44,960 --> 00:30:49,440
ah come on yeah there we go thanks bob

713
00:30:47,279 --> 00:30:51,039
yes post absolutely

714
00:30:49,440 --> 00:30:52,480
so when you're when you're passing

715
00:30:51,039 --> 00:30:54,480
information to a web server

716
00:30:52,480 --> 00:30:55,919
post is almost always going to be that

717
00:30:54,480 --> 00:30:59,360
method

718
00:30:55,919 --> 00:31:02,480
um uh that form

719
00:30:59,360 --> 00:31:05,678
that you input that data in is typically

720
00:31:02,480 --> 00:31:06,880
a field called form data and what you're

721
00:31:05,679 --> 00:31:10,080
looking for is not

722
00:31:06,880 --> 00:31:13,120
just stuff that where form data exists

723
00:31:10,080 --> 00:31:14,559
but stuff where form data exists and in

724
00:31:13,120 --> 00:31:18,080
that form data

725
00:31:14,559 --> 00:31:18,879
are things referencing user names and

726
00:31:18,080 --> 00:31:21,519
passwords

727
00:31:18,880 --> 00:31:23,360
now sometimes form data shortens your

728
00:31:21,519 --> 00:31:25,039
password may not be fully spelled out it

729
00:31:23,360 --> 00:31:27,279
could be an abbreviation

730
00:31:25,039 --> 00:31:28,799
of the word password but you're looking

731
00:31:27,279 --> 00:31:31,440
for results

732
00:31:28,799 --> 00:31:33,600
that actually contain things like

733
00:31:31,440 --> 00:31:36,320
username and password in it

734
00:31:33,600 --> 00:31:37,760
which by the way hopefully some of you

735
00:31:36,320 --> 00:31:40,080
uh have your spicy sense

736
00:31:37,760 --> 00:31:41,440
tingling now right because the first

737
00:31:40,080 --> 00:31:43,360
thing we should be asking you for is

738
00:31:41,440 --> 00:31:44,480
what the hell did the freaking admin do

739
00:31:43,360 --> 00:31:46,719
they're allowing user names and

740
00:31:44,480 --> 00:31:49,840
passwords in the clear that's terrible

741
00:31:46,720 --> 00:31:52,159
yeah that happens so um

742
00:31:49,840 --> 00:31:53,279
so we've got usernames and passwords in

743
00:31:52,159 --> 00:31:55,120
the clear

744
00:31:53,279 --> 00:31:57,120
going to our web server and we're

745
00:31:55,120 --> 00:31:58,239
looking for the ip address that did a

746
00:31:57,120 --> 00:32:01,678
lot of it

747
00:31:58,240 --> 00:32:04,159
we want the culprit that sent many many

748
00:32:01,679 --> 00:32:04,880
uh usernames and passwords to our web

749
00:32:04,159 --> 00:32:08,960
server

750
00:32:04,880 --> 00:32:08,960
in the form data in a post

751
00:32:10,080 --> 00:32:15,840
and with that i'll give you guys a

752
00:32:11,200 --> 00:32:15,840
couple minutes

753
00:32:36,080 --> 00:32:40,240
i'm gonna go grab a cup of coffee while

754
00:32:39,039 --> 00:32:42,158
you guys are

755
00:32:40,240 --> 00:32:57,840
digging through the data i'll be back in

756
00:32:42,159 --> 00:32:57,840
30 seconds

757
00:34:18,560 --> 00:34:22,000
all right class how we doing has anybody

758
00:34:20,560 --> 00:34:22,960
uh does anybody think they found the

759
00:34:22,000 --> 00:34:25,199
answer

760
00:34:22,960 --> 00:34:26,960
if you have go ahead and drop me a hands

761
00:34:25,199 --> 00:34:30,000
raised hands in the um

762
00:34:26,960 --> 00:34:35,839
in the attendees uh

763
00:34:30,000 --> 00:34:35,839
list good job wow awesome good job guys

764
00:34:38,639 --> 00:34:45,119
does anybody want another minute before

765
00:34:40,879 --> 00:34:45,118
i go ahead and walk through the solution

766
00:34:46,560 --> 00:34:50,719
if you do hit me in the chat

767
00:34:56,159 --> 00:35:06,240
nope all right let's take a look

768
00:35:03,119 --> 00:35:09,680
uh that for for some odd reason

769
00:35:06,240 --> 00:35:14,000
our evil attackers did not um

770
00:35:09,680 --> 00:35:17,040
uh uh adhere to the uh uh

771
00:35:14,000 --> 00:35:18,000
rights of use uh for the uh for the

772
00:35:17,040 --> 00:35:19,359
software itself

773
00:35:18,000 --> 00:35:22,560
right you know on the third party

774
00:35:19,359 --> 00:35:22,560
agreement so uh

775
00:35:24,079 --> 00:35:28,960
uh let's take a look june um close but

776
00:35:27,599 --> 00:35:31,200
i'll show you uh

777
00:35:28,960 --> 00:35:32,640
i'll show you how we yeah i can see why

778
00:35:31,200 --> 00:35:34,720
you went with that one but let's take a

779
00:35:32,640 --> 00:35:36,960
look at the data

780
00:35:34,720 --> 00:35:36,959
so

781
00:35:38,560 --> 00:35:42,160
our brute force attack is going to come

782
00:35:39,920 --> 00:35:44,720
over the wire again of course so we can

783
00:35:42,160 --> 00:35:45,598
start looking there and if we just take

784
00:35:44,720 --> 00:35:48,160
a look at

785
00:35:45,599 --> 00:35:51,040
all the stuff coming over the wire we'll

786
00:35:48,160 --> 00:35:54,240
see a whole bunch of ip addresses here

787
00:35:51,040 --> 00:35:56,240
um some of them are internal

788
00:35:54,240 --> 00:35:57,520
i hope that they are not brute forcing

789
00:35:56,240 --> 00:36:02,078
our web server

790
00:35:57,520 --> 00:36:04,000
uh and um and our friend over there 40

791
00:36:02,079 --> 00:36:06,160
certainly is generating a heck of a lot

792
00:36:04,000 --> 00:36:09,040
of traffic they'd definitely be

793
00:36:06,160 --> 00:36:12,319
suspect here because uh brute force

794
00:36:09,040 --> 00:36:14,720
definitely a noisy attack

795
00:36:12,320 --> 00:36:16,560
but let's validate uh see if we can

796
00:36:14,720 --> 00:36:20,000
validate our hypothesis

797
00:36:16,560 --> 00:36:20,799
and and narrow our list of uh suspects

798
00:36:20,000 --> 00:36:23,040
here as well

799
00:36:20,800 --> 00:36:25,040
and this is just like csi right no

800
00:36:23,040 --> 00:36:28,079
smelly dead bodies thank god

801
00:36:25,040 --> 00:36:30,640
in infosec usually but um

802
00:36:28,079 --> 00:36:31,440
but the methodology is the same we see

803
00:36:30,640 --> 00:36:34,799
clues

804
00:36:31,440 --> 00:36:38,240
we cast a hypothesis we narrow down

805
00:36:34,800 --> 00:36:42,320
um our hypothesis uh and and try to

806
00:36:38,240 --> 00:36:44,879
find the truth so we know that 70

807
00:36:42,320 --> 00:36:46,000
is our web server so if we add that up

808
00:36:44,880 --> 00:36:49,040
into

809
00:36:46,000 --> 00:36:52,079
our search to narrow our field

810
00:36:49,040 --> 00:36:53,040
we see that only a handful of ip

811
00:36:52,079 --> 00:36:55,280
addresses

812
00:36:53,040 --> 00:36:57,279
we're actually talking to our web server

813
00:36:55,280 --> 00:37:00,000
over http

814
00:36:57,280 --> 00:37:02,079
and again i hope 192.168 wasn't the one

815
00:37:00,000 --> 00:37:05,200
doing the brute forcing

816
00:37:02,079 --> 00:37:07,760
uh going in further

817
00:37:05,200 --> 00:37:08,319
we we gave you a hint that the http

818
00:37:07,760 --> 00:37:11,359
method

819
00:37:08,320 --> 00:37:13,119
might be would be post so if we

820
00:37:11,359 --> 00:37:15,119
uh just using the same search but

821
00:37:13,119 --> 00:37:16,000
switching to a different field here and

822
00:37:15,119 --> 00:37:19,040
clicking on

823
00:37:16,000 --> 00:37:21,760
http method further down in this

824
00:37:19,040 --> 00:37:23,520
in the screenshot we're going to see a

825
00:37:21,760 --> 00:37:26,960
lot of posts going on

826
00:37:23,520 --> 00:37:28,640
um in fact a lot of posts right

827
00:37:26,960 --> 00:37:30,800
i would i would expect this to be

828
00:37:28,640 --> 00:37:33,839
flipped um in most cases

829
00:37:30,800 --> 00:37:36,160
uh a web server typically should be

830
00:37:33,839 --> 00:37:39,520
responding with more gets than posts as

831
00:37:36,160 --> 00:37:39,520
far as the method goes right

832
00:37:39,680 --> 00:37:44,000
so let's add post up to here to our

833
00:37:41,680 --> 00:37:47,359
search and see who's been posting

834
00:37:44,000 --> 00:37:50,160
directly to our web server and now

835
00:37:47,359 --> 00:37:52,240
our field of suspects has gone way down

836
00:37:50,160 --> 00:37:53,920
23 and 40

837
00:37:52,240 --> 00:37:55,439
are the only two ip addresses that have

838
00:37:53,920 --> 00:37:58,800
been posting to

839
00:37:55,440 --> 00:38:00,400
our web server and 40 is looking really

840
00:37:58,800 --> 00:38:03,200
good for our suspect now right

841
00:38:00,400 --> 00:38:04,560
lots of stuff coming from 40 but we need

842
00:38:03,200 --> 00:38:08,160
to validate this

843
00:38:04,560 --> 00:38:11,520
so i told you that we want to find

844
00:38:08,160 --> 00:38:13,040
uh events where the form data actually

845
00:38:11,520 --> 00:38:14,960
contains

846
00:38:13,040 --> 00:38:16,240
username and password or something like

847
00:38:14,960 --> 00:38:17,839
it now if you didn't know it was

848
00:38:16,240 --> 00:38:19,520
abbreviated like this

849
00:38:17,839 --> 00:38:21,680
if you just took a look at form data

850
00:38:19,520 --> 00:38:23,359
equal to anything you could look and see

851
00:38:21,680 --> 00:38:25,919
well well they're right in the data form

852
00:38:23,359 --> 00:38:28,160
data looks like it abbreviates it

853
00:38:25,920 --> 00:38:28,960
by password so you can take that

854
00:38:28,160 --> 00:38:31,359
knowledge

855
00:38:28,960 --> 00:38:33,200
and then create a search that looks like

856
00:38:31,359 --> 00:38:36,000
this where what we're saying is

857
00:38:33,200 --> 00:38:37,520
we want anything coming over the wire

858
00:38:36,000 --> 00:38:41,839
going to our web server

859
00:38:37,520 --> 00:38:44,960
dot 70 um that's actually a post

860
00:38:41,839 --> 00:38:47,359
where the form data field has

861
00:38:44,960 --> 00:38:48,640
anything followed by username followed

862
00:38:47,359 --> 00:38:50,480
by anything followed by password

863
00:38:48,640 --> 00:38:54,078
followed by anything

864
00:38:50,480 --> 00:38:55,040
we do that and uh we can throw it into a

865
00:38:54,079 --> 00:38:56,560
table

866
00:38:55,040 --> 00:38:58,880
um and if we go in a table we're gonna

867
00:38:56,560 --> 00:39:01,200
get something like this now

868
00:38:58,880 --> 00:39:01,920
we're we're we're getting close we're on

869
00:39:01,200 --> 00:39:04,799
the hunt

870
00:39:01,920 --> 00:39:05,520
uh this table shows us that there's a

871
00:39:04,800 --> 00:39:08,160
lot

872
00:39:05,520 --> 00:39:08,960
of user ip user names and passwords

873
00:39:08,160 --> 00:39:11,920
being passed

874
00:39:08,960 --> 00:39:12,720
to our server we need to figure out who

875
00:39:11,920 --> 00:39:15,760
did

876
00:39:12,720 --> 00:39:17,439
the most so this is table

877
00:39:15,760 --> 00:39:18,880
right the table command which i told you

878
00:39:17,440 --> 00:39:20,800
puts things in a table

879
00:39:18,880 --> 00:39:22,640
the command that lets you put things in

880
00:39:20,800 --> 00:39:25,680
a table and count them

881
00:39:22,640 --> 00:39:26,480
is stats so let's flip that let's put

882
00:39:25,680 --> 00:39:29,200
that into

883
00:39:26,480 --> 00:39:29,680
stats count by the field we're looking

884
00:39:29,200 --> 00:39:32,720
for

885
00:39:29,680 --> 00:39:33,440
source um so that we can see which ip

886
00:39:32,720 --> 00:39:35,359
address was

887
00:39:33,440 --> 00:39:37,839
doing all of this username and password

888
00:39:35,359 --> 00:39:41,040
stuff and what happens to our table here

889
00:39:37,839 --> 00:39:43,759
yeah it flips right 40 only did one

890
00:39:41,040 --> 00:39:47,200
attempt at a username and password

891
00:39:43,760 --> 00:39:49,520
23 did 411.

892
00:39:47,200 --> 00:39:52,000
is that is that does that look more

893
00:39:49,520 --> 00:39:55,280
likely to be a brute force attack

894
00:39:52,000 --> 00:39:56,400
yeah yeah so uh so we tried to mislead

895
00:39:55,280 --> 00:39:59,920
you a little bit um

896
00:39:56,400 --> 00:40:03,119
by you know with the noise uh but um

897
00:39:59,920 --> 00:40:05,599
but uh if we if we uh further narrow

898
00:40:03,119 --> 00:40:06,480
down um our suspects just by using some

899
00:40:05,599 --> 00:40:09,119
logical

900
00:40:06,480 --> 00:40:10,079
approach we can see that 23 was the one

901
00:40:09,119 --> 00:40:12,119
actually

902
00:40:10,079 --> 00:40:13,520
sending lots of usernames and passwords

903
00:40:12,119 --> 00:40:15,839
411

904
00:40:13,520 --> 00:40:16,880
combinations so we throw that into our

905
00:40:15,839 --> 00:40:18,960
scoring server

906
00:40:16,880 --> 00:40:20,960
we can see that our attackers jumped

907
00:40:18,960 --> 00:40:23,599
ahead um and is trying uh

908
00:40:20,960 --> 00:40:25,200
now uh exploitation phase of the kill

909
00:40:23,599 --> 00:40:27,680
chain

910
00:40:25,200 --> 00:40:28,399
we also are getting a really good idea

911
00:40:27,680 --> 00:40:31,680
of um

912
00:40:28,400 --> 00:40:35,119
of this attack visually uh we now see

913
00:40:31,680 --> 00:40:38,078
uh that the uh our attacker has

914
00:40:35,119 --> 00:40:38,480
multiple systems in its infrastructure

915
00:40:38,079 --> 00:40:41,359
uh

916
00:40:38,480 --> 00:40:42,480
and is possibly staging portions of the

917
00:40:41,359 --> 00:40:44,799
attack

918
00:40:42,480 --> 00:40:46,000
by the way we are doing this particular

919
00:40:44,800 --> 00:40:48,240
workshop mapping to

920
00:40:46,000 --> 00:40:49,440
um lockheed martin kill chain but the

921
00:40:48,240 --> 00:40:51,839
minor tag framework

922
00:40:49,440 --> 00:40:53,599
is another really good framework for

923
00:40:51,839 --> 00:40:55,599
mapping out your attacks

924
00:40:53,599 --> 00:40:57,280
we highly recommend it and we've been

925
00:40:55,599 --> 00:41:00,480
using miter attack

926
00:40:57,280 --> 00:41:01,599
to great effect within splunk as well as

927
00:41:00,480 --> 00:41:04,800
far as how we

928
00:41:01,599 --> 00:41:08,000
start establishing risk and use

929
00:41:04,800 --> 00:41:12,480
risk-based alerting uh rather than just

930
00:41:08,000 --> 00:41:15,760
one-to-one alerting based on you know

931
00:41:12,480 --> 00:41:20,720
correlation to to alert

932
00:41:15,760 --> 00:41:23,200
um okay so our next challenge um

933
00:41:20,720 --> 00:41:25,118
uh is going to be really just a little

934
00:41:23,200 --> 00:41:27,680
bit of spin on what you just did

935
00:41:25,119 --> 00:41:29,680
so we want to find which brute force

936
00:41:27,680 --> 00:41:32,160
password was used which one

937
00:41:29,680 --> 00:41:33,759
so when that attacker launched that

938
00:41:32,160 --> 00:41:35,200
brute force tool

939
00:41:33,760 --> 00:41:36,880
which i'm assuming what they did i don't

940
00:41:35,200 --> 00:41:40,640
think they typed in each one

941
00:41:36,880 --> 00:41:41,760
um what was the first password used

942
00:41:40,640 --> 00:41:44,000
now would you do this in your

943
00:41:41,760 --> 00:41:46,079
investigation probably not

944
00:41:44,000 --> 00:41:48,160
but i'm teaching you some skills here so

945
00:41:46,079 --> 00:41:51,520
this skill happens to be about

946
00:41:48,160 --> 00:41:54,560
time and how to use time

947
00:41:51,520 --> 00:41:57,200
as your investigation every event

948
00:41:54,560 --> 00:41:58,560
within splunk has a field called

949
00:41:57,200 --> 00:41:59,919
underscore time

950
00:41:58,560 --> 00:42:01,839
and that's where your timestamp is going

951
00:41:59,920 --> 00:42:04,560
to go

952
00:42:01,839 --> 00:42:06,078
and obviously to find the first brute

953
00:42:04,560 --> 00:42:07,680
force password used

954
00:42:06,079 --> 00:42:09,200
you're going to use a search that you

955
00:42:07,680 --> 00:42:11,359
just ran

956
00:42:09,200 --> 00:42:12,879
more or less but you're going to expose

957
00:42:11,359 --> 00:42:15,440
the time field and you're going to look

958
00:42:12,880 --> 00:42:19,119
for the oldest time stamp

959
00:42:15,440 --> 00:42:21,280
so using just what you did before

960
00:42:19,119 --> 00:42:22,240
but um so i showed you how to create

961
00:42:21,280 --> 00:42:24,560
tables

962
00:42:22,240 --> 00:42:25,759
you're going to want essentially a table

963
00:42:24,560 --> 00:42:28,240
that shows you

964
00:42:25,760 --> 00:42:29,040
the stuff you were just searching for

965
00:42:28,240 --> 00:42:32,959
but also

966
00:42:29,040 --> 00:42:34,720
the time field so the table command

967
00:42:32,960 --> 00:42:36,160
essentially is you know you take

968
00:42:34,720 --> 00:42:39,279
whatever you're searching for

969
00:42:36,160 --> 00:42:42,160
pipe it into table uh

970
00:42:39,280 --> 00:42:42,640
and then you say table and then you say

971
00:42:42,160 --> 00:42:44,480
uh

972
00:42:42,640 --> 00:42:45,680
the fields you want so it's going to be

973
00:42:44,480 --> 00:42:49,440
pipe table

974
00:42:45,680 --> 00:42:51,680
underscore time underscore form data

975
00:42:49,440 --> 00:42:53,200
you know just for confirmation you could

976
00:42:51,680 --> 00:42:53,839
building on your last search just due

977
00:42:53,200 --> 00:42:55,520
time

978
00:42:53,839 --> 00:42:57,680
but it's always nice to have visually

979
00:42:55,520 --> 00:42:59,680
there the fact that you have results

980
00:42:57,680 --> 00:43:01,598
with username and password in it so

981
00:42:59,680 --> 00:43:02,879
you'd want that form data exposed as

982
00:43:01,599 --> 00:43:05,440
well

983
00:43:02,880 --> 00:43:06,880
i'm going to give you a few minutes and

984
00:43:05,440 --> 00:43:10,319
you're going to try and find

985
00:43:06,880 --> 00:43:13,839
the first password that was sent by our

986
00:43:10,319 --> 00:43:13,839
attacker's brute forcing tool

987
00:46:06,480 --> 00:46:12,000
all right um does anybody want any more

988
00:46:09,280 --> 00:46:15,359
time before i go ahead and

989
00:46:12,000 --> 00:46:16,400
show you the answer you can just pop me

990
00:46:15,359 --> 00:46:20,720
a note in the

991
00:46:16,400 --> 00:46:20,720
chat if you want just another minute

992
00:46:21,040 --> 00:46:25,119
and and and if you do remember everybody

993
00:46:23,440 --> 00:46:27,520
understands right if you are like so

994
00:46:25,119 --> 00:46:29,839
close to the freaking answer you just oh

995
00:46:27,520 --> 00:46:32,079
we're always everybody's always happy to

996
00:46:29,839 --> 00:46:32,799
give fellow students another minute or

997
00:46:32,079 --> 00:46:34,079
so

998
00:46:32,800 --> 00:46:36,000
but it doesn't look like anybody's

999
00:46:34,079 --> 00:46:39,839
asking for any more time

1000
00:46:36,000 --> 00:46:44,160
so let's

1001
00:46:39,839 --> 00:46:45,520
here we go i i changed uh my display

1002
00:46:44,160 --> 00:46:48,960
around a little bit you guys can still

1003
00:46:45,520 --> 00:46:48,960
see my uh screen right

1004
00:46:51,920 --> 00:46:56,720
yeah cool thank you um so uh so from

1005
00:46:55,359 --> 00:46:59,359
here

1006
00:46:56,720 --> 00:46:59,919
um building right on what we just did

1007
00:46:59,359 --> 00:47:02,960
right

1008
00:46:59,920 --> 00:47:03,520
we we just want to find out um events

1009
00:47:02,960 --> 00:47:05,359
that have

1010
00:47:03,520 --> 00:47:06,560
username and password in them where it

1011
00:47:05,359 --> 00:47:08,319
actually exists

1012
00:47:06,560 --> 00:47:10,078
so there's going to be stuff in there we

1013
00:47:08,319 --> 00:47:12,240
can then pass that

1014
00:47:10,079 --> 00:47:13,520
into the table command and then just

1015
00:47:12,240 --> 00:47:16,879
expose

1016
00:47:13,520 --> 00:47:19,200
two uh fields underscore time and

1017
00:47:16,880 --> 00:47:20,480
form data and form data is really just

1018
00:47:19,200 --> 00:47:23,520
for confirmation

1019
00:47:20,480 --> 00:47:26,640
now um by default

1020
00:47:23,520 --> 00:47:27,759
splunk always gives you the most recent

1021
00:47:26,640 --> 00:47:30,879
event first

1022
00:47:27,760 --> 00:47:31,920
so by default this uh this time list is

1023
00:47:30,880 --> 00:47:35,599
going to be

1024
00:47:31,920 --> 00:47:36,880
in um uh what decent descending order

1025
00:47:35,599 --> 00:47:40,400
right so uh the

1026
00:47:36,880 --> 00:47:41,680
the newest first and then the oldest is

1027
00:47:40,400 --> 00:47:44,319
going to be further down and we can see

1028
00:47:41,680 --> 00:47:46,078
we have many many pages of results here

1029
00:47:44,319 --> 00:47:48,000
now for those of you familiar splunk

1030
00:47:46,079 --> 00:47:49,839
anytime you have a table like this

1031
00:47:48,000 --> 00:47:51,440
the easy peasy way and the way i would

1032
00:47:49,839 --> 00:47:53,279
do it if i was competing

1033
00:47:51,440 --> 00:47:55,119
is you can just click on the ascending

1034
00:47:53,280 --> 00:47:58,160
descending arrows

1035
00:47:55,119 --> 00:47:59,280
to uh to switch the sort order so that'd

1036
00:47:58,160 --> 00:48:01,759
be the down and dirty way

1037
00:47:59,280 --> 00:48:03,440
that's the way i would do it but we want

1038
00:48:01,760 --> 00:48:05,040
to teach you some stuff here too

1039
00:48:03,440 --> 00:48:07,040
especially if you want to save this

1040
00:48:05,040 --> 00:48:08,319
search if you wanted to save the search

1041
00:48:07,040 --> 00:48:10,720
and send it to someone else

1042
00:48:08,319 --> 00:48:11,759
sorted in the correct order you'd have

1043
00:48:10,720 --> 00:48:14,160
to add a command

1044
00:48:11,760 --> 00:48:15,119
to do that and for tables the command is

1045
00:48:14,160 --> 00:48:16,879
reverse

1046
00:48:15,119 --> 00:48:18,319
so if we take all of those results and

1047
00:48:16,880 --> 00:48:19,119
then send it to a new command called

1048
00:48:18,319 --> 00:48:20,880
reverse

1049
00:48:19,119 --> 00:48:22,559
we're going to the oldest time stamp

1050
00:48:20,880 --> 00:48:24,160
here right at the top

1051
00:48:22,559 --> 00:48:25,760
we could actually save the search if we

1052
00:48:24,160 --> 00:48:28,960
wanted to then uh

1053
00:48:25,760 --> 00:48:31,280
and here in our results the password

1054
00:48:28,960 --> 00:48:32,720
yeah every executive's favorite password

1055
00:48:31,280 --> 00:48:37,599
one two three four five six

1056
00:48:32,720 --> 00:48:41,520
seven eight so uh so there's our results

1057
00:48:37,599 --> 00:48:43,280
oh wait uh you you just see

1058
00:48:41,520 --> 00:48:44,880
you're just seeing my powerpoint right

1059
00:48:43,280 --> 00:48:48,000
that's what i want you to see

1060
00:48:44,880 --> 00:48:50,880
um is it is it advancing to the

1061
00:48:48,000 --> 00:48:50,880
what i'm talking about

1062
00:48:52,559 --> 00:48:57,119
you guys can see the the results of that

1063
00:48:54,559 --> 00:48:57,119
search right

1064
00:48:58,720 --> 00:49:02,480
with one two three four five six seven

1065
00:49:00,240 --> 00:49:06,399
eight on it

1066
00:49:02,480 --> 00:49:08,559
oh yeah no okay no no ah holy crap hold

1067
00:49:06,400 --> 00:49:08,559
on

1068
00:49:08,960 --> 00:49:13,280
god i hate zoom sometimes um stop the

1069
00:49:12,079 --> 00:49:17,760
share

1070
00:49:13,280 --> 00:49:23,680
start this share move it to

1071
00:49:17,760 --> 00:49:23,680
powerpoint what do you guys see now

1072
00:49:26,000 --> 00:49:30,160
you should see a screen that says uh

1073
00:49:28,559 --> 00:49:35,680
oldest first uh

1074
00:49:30,160 --> 00:49:38,480
up at the top yeah okay good

1075
00:49:35,680 --> 00:49:40,000
yep all right cool beans so yes so if we

1076
00:49:38,480 --> 00:49:42,559
reverse the order of this

1077
00:49:40,000 --> 00:49:44,000
search um so that we get the oldest

1078
00:49:42,559 --> 00:49:45,839
timestamp first

1079
00:49:44,000 --> 00:49:49,119
there is one two three four five six

1080
00:49:45,839 --> 00:49:51,520
seven eight there in the in the results

1081
00:49:49,119 --> 00:49:53,119
um and uh and that's going to be the

1082
00:49:51,520 --> 00:49:56,319
answer to our question

1083
00:49:53,119 --> 00:49:58,880
uh and i'm gonna also give you guys uh a

1084
00:49:56,319 --> 00:50:00,000
a more advanced search here because

1085
00:49:58,880 --> 00:50:03,119
we're going to use this

1086
00:50:00,000 --> 00:50:05,359
in the next challenge so if we wanted

1087
00:50:03,119 --> 00:50:06,640
what just the the password itself

1088
00:50:05,359 --> 00:50:09,040
extracted

1089
00:50:06,640 --> 00:50:11,118
from this string here from this whole

1090
00:50:09,040 --> 00:50:14,400
string

1091
00:50:11,119 --> 00:50:16,960
we can use regex to pull it out now

1092
00:50:14,400 --> 00:50:17,599
raise the hands who here loves regex i

1093
00:50:16,960 --> 00:50:20,880
mean just

1094
00:50:17,599 --> 00:50:24,400
loves regex give me a yeah awesome

1095
00:50:20,880 --> 00:50:27,200
okay um if you ever if you meet anyone

1096
00:50:24,400 --> 00:50:28,800
in your life that absolutely loves regex

1097
00:50:27,200 --> 00:50:30,640
buy them lots of beer

1098
00:50:28,800 --> 00:50:32,240
because they should really be your best

1099
00:50:30,640 --> 00:50:34,240
friend um

1100
00:50:32,240 --> 00:50:36,399
because uh you know regex is awesome and

1101
00:50:34,240 --> 00:50:38,240
it's powerful not everybody loves it

1102
00:50:36,400 --> 00:50:38,720
though not everybody's just awesome at

1103
00:50:38,240 --> 00:50:42,078
it

1104
00:50:38,720 --> 00:50:44,799
um so if you've got awesome regexers

1105
00:50:42,079 --> 00:50:45,760
in your crew yeah treat them well

1106
00:50:44,800 --> 00:50:48,160
because

1107
00:50:45,760 --> 00:50:49,040
this stuff is awesome so what we're

1108
00:50:48,160 --> 00:50:52,160
doing here

1109
00:50:49,040 --> 00:50:54,558
is we're using regex to pull the actual

1110
00:50:52,160 --> 00:50:56,640
password portion of the string out

1111
00:50:54,559 --> 00:50:58,000
and we're assigning it to a new variable

1112
00:50:56,640 --> 00:50:59,759
called user password

1113
00:50:58,000 --> 00:51:01,920
essentially a new field called user

1114
00:50:59,760 --> 00:51:04,000
password then we're saying

1115
00:51:01,920 --> 00:51:05,440
hey give us back results where user

1116
00:51:04,000 --> 00:51:08,720
password actually

1117
00:51:05,440 --> 00:51:10,720
has something in it it's not null um

1118
00:51:08,720 --> 00:51:12,799
i'm going to reverse the order again i'm

1119
00:51:10,720 --> 00:51:14,160
going to use head which works a lot like

1120
00:51:12,800 --> 00:51:16,720
head and tail do

1121
00:51:14,160 --> 00:51:18,480
from from the command line until ahead

1122
00:51:16,720 --> 00:51:20,799
just give me the first result

1123
00:51:18,480 --> 00:51:23,119
throw it into a table and there is my

1124
00:51:20,800 --> 00:51:25,280
password i can copy and paste that into

1125
00:51:23,119 --> 00:51:28,240
my scoring server if i like

1126
00:51:25,280 --> 00:51:28,960
and we're going to use this regex in our

1127
00:51:28,240 --> 00:51:32,000
next

1128
00:51:28,960 --> 00:51:35,040
search now that's a lot to type

1129
00:51:32,000 --> 00:51:37,599
if i were you i'd go to find the um

1130
00:51:35,040 --> 00:51:38,558
the place in the app where this search

1131
00:51:37,599 --> 00:51:41,280
exists

1132
00:51:38,559 --> 00:51:43,119
and at least copy and paste it um it'll

1133
00:51:41,280 --> 00:51:48,079
be much easier

1134
00:51:43,119 --> 00:51:48,079
but that uh oh yes so um uh

1135
00:51:48,240 --> 00:51:52,479
so that that's brings us to our next

1136
00:51:49,920 --> 00:51:55,200
question so

1137
00:51:52,480 --> 00:51:56,480
this is a bit of a logic challenge here

1138
00:51:55,200 --> 00:51:59,439
we know how to find

1139
00:51:56,480 --> 00:52:01,359
a list of passwords that were used by

1140
00:51:59,440 --> 00:52:03,760
the brute forcing tool

1141
00:52:01,359 --> 00:52:05,119
one of those usernames and password

1142
00:52:03,760 --> 00:52:07,920
combinations

1143
00:52:05,119 --> 00:52:08,319
actually worked so the brute forcing

1144
00:52:07,920 --> 00:52:10,880
tool

1145
00:52:08,319 --> 00:52:11,839
did its job it found a set of

1146
00:52:10,880 --> 00:52:14,960
credentials that

1147
00:52:11,839 --> 00:52:17,759
actually allowed access we want to know

1148
00:52:14,960 --> 00:52:19,280
which was the correct password um so

1149
00:52:17,760 --> 00:52:20,559
you'll find results that have a username

1150
00:52:19,280 --> 00:52:22,640
and password that were used

1151
00:52:20,559 --> 00:52:24,720
you want to find the password that

1152
00:52:22,640 --> 00:52:26,000
actually allowed access to our content

1153
00:52:24,720 --> 00:52:28,799
management system

1154
00:52:26,000 --> 00:52:30,240
running on i'm really not batman.com um

1155
00:52:28,800 --> 00:52:33,599
and as a bonus

1156
00:52:30,240 --> 00:52:35,919
find the ip address uh that was used

1157
00:52:33,599 --> 00:52:36,640
now i said this was a logic challenge

1158
00:52:35,920 --> 00:52:39,839
right

1159
00:52:36,640 --> 00:52:43,118
so let's think about this if you are

1160
00:52:39,839 --> 00:52:45,440
trying user names and passwords either

1161
00:52:43,119 --> 00:52:48,480
manually or through a tool

1162
00:52:45,440 --> 00:52:49,280
um how many times are you going to use a

1163
00:52:48,480 --> 00:52:51,680
unique

1164
00:52:49,280 --> 00:52:53,440
combination of username and password so

1165
00:52:51,680 --> 00:52:55,520
like if your first attempt is

1166
00:52:53,440 --> 00:52:57,280
admin one two three four five six seven

1167
00:52:55,520 --> 00:52:58,839
eight how many times are you gonna try

1168
00:52:57,280 --> 00:53:00,480
that combination that particular

1169
00:52:58,839 --> 00:53:03,599
combination

1170
00:53:00,480 --> 00:53:03,599
anybody can throw it in the chat

1171
00:53:04,160 --> 00:53:08,000
and especially how many times is a brute

1172
00:53:05,920 --> 00:53:08,960
forcing tool gonna try the combination

1173
00:53:08,000 --> 00:53:10,400
of admin

1174
00:53:08,960 --> 00:53:12,880
and one two three four five six seven

1175
00:53:10,400 --> 00:53:15,440
eight it's only gonna do it

1176
00:53:12,880 --> 00:53:16,480
once right no reversing tool is going to

1177
00:53:15,440 --> 00:53:18,880
waste time

1178
00:53:16,480 --> 00:53:20,240
trying the same username and password

1179
00:53:18,880 --> 00:53:22,079
five times

1180
00:53:20,240 --> 00:53:24,558
it's only gonna use it once so what

1181
00:53:22,079 --> 00:53:27,599
you're really looking for here

1182
00:53:24,559 --> 00:53:30,960
is which password got used

1183
00:53:27,599 --> 00:53:32,960
twice or more than once let's say

1184
00:53:30,960 --> 00:53:34,079
so if you can find the username and

1185
00:53:32,960 --> 00:53:36,880
password that was used

1186
00:53:34,079 --> 00:53:37,200
more than once that will tell you which

1187
00:53:36,880 --> 00:53:42,480
one

1188
00:53:37,200 --> 00:53:44,558
actually worked in this case

1189
00:53:42,480 --> 00:53:46,559
and you can extract the string of

1190
00:53:44,559 --> 00:53:49,200
passwords out into a table using that

1191
00:53:46,559 --> 00:53:53,680
regex and throwing it into table

1192
00:53:49,200 --> 00:53:57,200
but of course table won't let you count

1193
00:53:53,680 --> 00:54:00,319
and this is a counting solution as well

1194
00:53:57,200 --> 00:54:02,879
right we have to figure out the count

1195
00:54:00,319 --> 00:54:04,400
of of the passwords that were used so

1196
00:54:02,880 --> 00:54:05,119
that whichever one was used more than

1197
00:54:04,400 --> 00:54:08,400
once

1198
00:54:05,119 --> 00:54:10,160
i mean you could actually sort i suppose

1199
00:54:08,400 --> 00:54:11,440
and scroll through the list until you

1200
00:54:10,160 --> 00:54:13,520
see a password

1201
00:54:11,440 --> 00:54:15,040
that got used twice if you're sorting by

1202
00:54:13,520 --> 00:54:17,359
the password field

1203
00:54:15,040 --> 00:54:18,640
that would get you there as well um and

1204
00:54:17,359 --> 00:54:21,040
if you're faster at

1205
00:54:18,640 --> 00:54:25,839
just scrolling through lots of text yeah

1206
00:54:21,040 --> 00:54:25,839
you could go that way as well

1207
00:54:26,240 --> 00:54:30,479
i'll give you guys just another minute

1208
00:54:28,319 --> 00:54:31,920
or so to see if you can find the actual

1209
00:54:30,480 --> 00:54:35,760
password

1210
00:54:31,920 --> 00:54:38,240
in the in the results again

1211
00:54:35,760 --> 00:54:39,200
if you want use the companion app to get

1212
00:54:38,240 --> 00:54:42,078
you

1213
00:54:39,200 --> 00:54:44,000
uh partway there and see if you can like

1214
00:54:42,079 --> 00:54:45,760
tweak that search a little bit to get

1215
00:54:44,000 --> 00:54:47,520
the uh

1216
00:54:45,760 --> 00:54:53,839
the search that gives you the results

1217
00:54:47,520 --> 00:54:53,839
we're looking for

1218
00:55:04,839 --> 00:55:07,839
oh

1219
00:55:39,920 --> 00:55:44,240
does anyone think they found it already

1220
00:55:46,640 --> 00:55:49,839
awesome good job

1221
00:55:56,640 --> 00:56:03,839
all right does anyone want another

1222
00:55:58,079 --> 00:56:03,839
minute before i show the answer

1223
00:56:04,559 --> 00:56:11,599
okay cool let's see if we can go find it

1224
00:56:08,000 --> 00:56:14,480
all right so uh

1225
00:56:11,599 --> 00:56:16,319
again using that regex that we learned

1226
00:56:14,480 --> 00:56:17,839
about in the previous question

1227
00:56:16,319 --> 00:56:20,000
we're going to extract the string of

1228
00:56:17,839 --> 00:56:22,000
passwords out then we're going to throw

1229
00:56:20,000 --> 00:56:22,559
that into a stats command which will let

1230
00:56:22,000 --> 00:56:25,599
us count

1231
00:56:22,559 --> 00:56:27,520
by that very field that we just created

1232
00:56:25,599 --> 00:56:30,000
that user password field

1233
00:56:27,520 --> 00:56:31,359
if we put that into this table that

1234
00:56:30,000 --> 00:56:34,160
allows us to count

1235
00:56:31,359 --> 00:56:35,200
by password um and then again sort in

1236
00:56:34,160 --> 00:56:38,078
reverse order

1237
00:56:35,200 --> 00:56:39,680
or skip that part and just hit the up

1238
00:56:38,079 --> 00:56:40,559
down arrows until we get sorted in

1239
00:56:39,680 --> 00:56:42,960
correct order

1240
00:56:40,559 --> 00:56:45,119
only one password was used more than

1241
00:56:42,960 --> 00:56:47,440
once and that was batman

1242
00:56:45,119 --> 00:56:50,400
so you know bruce is doing really good

1243
00:56:47,440 --> 00:56:53,440
on his password policies here

1244
00:56:50,400 --> 00:56:54,880
but batman was used twice and then there

1245
00:56:53,440 --> 00:56:57,520
was a bonus to this question

1246
00:56:54,880 --> 00:56:58,319
as well we asked also if you could

1247
00:56:57,520 --> 00:57:01,920
figure out

1248
00:56:58,319 --> 00:57:02,960
which ip address actually used it to

1249
00:57:01,920 --> 00:57:04,480
gain access

1250
00:57:02,960 --> 00:57:06,480
so we've got one you know we've got a

1251
00:57:04,480 --> 00:57:08,720
system out there brute forcing

1252
00:57:06,480 --> 00:57:10,480
um it may have been the one that

1253
00:57:08,720 --> 00:57:11,200
actually then accessed but let's take a

1254
00:57:10,480 --> 00:57:13,440
look

1255
00:57:11,200 --> 00:57:14,879
if we change our stats command here a

1256
00:57:13,440 --> 00:57:17,040
bit

1257
00:57:14,880 --> 00:57:18,480
so that we're adding not only not only

1258
00:57:17,040 --> 00:57:21,119
looking at user password

1259
00:57:18,480 --> 00:57:22,640
but we're also counting by the value of

1260
00:57:21,119 --> 00:57:25,200
the source ip

1261
00:57:22,640 --> 00:57:26,240
so that source ip gets exposed in our

1262
00:57:25,200 --> 00:57:29,118
table here

1263
00:57:26,240 --> 00:57:30,640
we'll see that our row here has a count

1264
00:57:29,119 --> 00:57:34,319
of two for batman

1265
00:57:30,640 --> 00:57:36,799
and two ip addresses show up here which

1266
00:57:34,319 --> 00:57:37,359
means that each one used it once right

1267
00:57:36,799 --> 00:57:40,160
so

1268
00:57:37,359 --> 00:57:42,000
so if 23 from our previous question was

1269
00:57:40,160 --> 00:57:45,040
our brute forcer

1270
00:57:42,000 --> 00:57:47,200
40 is actually the one that took

1271
00:57:45,040 --> 00:57:48,079
that you know set of results that were

1272
00:57:47,200 --> 00:57:50,799
found a

1273
00:57:48,079 --> 00:57:51,680
successful brute force attempt and then

1274
00:57:50,799 --> 00:57:56,480
used it

1275
00:57:51,680 --> 00:57:58,399
to actually log in to our web server

1276
00:57:56,480 --> 00:58:00,559
so batman's the answer to our question

1277
00:57:58,400 --> 00:58:03,920
with the bonus question of 40.

1278
00:58:00,559 --> 00:58:06,079
um throw it into a fancy little uh

1279
00:58:03,920 --> 00:58:08,319
table here as well for you just in case

1280
00:58:06,079 --> 00:58:11,760
you wanted to create reports on it

1281
00:58:08,319 --> 00:58:12,480
um and uh and yep not only did batman

1282
00:58:11,760 --> 00:58:15,680
work but it

1283
00:58:12,480 --> 00:58:17,200
looks like they logged in to essentially

1284
00:58:15,680 --> 00:58:20,000
an administrator account too

1285
00:58:17,200 --> 00:58:22,640
right that's administrator for joomla

1286
00:58:20,000 --> 00:58:25,680
here on our content management system so

1287
00:58:22,640 --> 00:58:27,839
yeah not good thanks uh thanks admins

1288
00:58:25,680 --> 00:58:29,919
for setting up such a secure server

1289
00:58:27,839 --> 00:58:31,759
uh we're gonna throw this into our

1290
00:58:29,920 --> 00:58:33,760
attack uh kill chain

1291
00:58:31,760 --> 00:58:34,799
uh documentation um that we're

1292
00:58:33,760 --> 00:58:37,280
documenting out

1293
00:58:34,799 --> 00:58:38,240
so good job there throw this into our

1294
00:58:37,280 --> 00:58:39,839
attack picture

1295
00:58:38,240 --> 00:58:41,839
look at this awesome attack picture you

1296
00:58:39,839 --> 00:58:44,400
guys are filling out i swear to god

1297
00:58:41,839 --> 00:58:46,240
uh you're gonna get promoted to uh sock

1298
00:58:44,400 --> 00:58:50,400
tier two by the end of the week

1299
00:58:46,240 --> 00:58:54,160
such awesome documentation here

1300
00:58:50,400 --> 00:58:55,920
all right so uh another time question

1301
00:58:54,160 --> 00:58:58,078
um and this one you know so we're going

1302
00:58:55,920 --> 00:59:01,280
to try and figure out how many seconds

1303
00:58:58,079 --> 00:59:04,400
elapsed between when the brute force

1304
00:59:01,280 --> 00:59:07,520
attack found the correct password

1305
00:59:04,400 --> 00:59:10,160
and when our other uh attacker actually

1306
00:59:07,520 --> 00:59:12,400
used it to log in

1307
00:59:10,160 --> 00:59:13,839
again we're teaching a little bit about

1308
00:59:12,400 --> 00:59:16,000
commands here

1309
00:59:13,839 --> 00:59:17,200
but we're also this would be also

1310
00:59:16,000 --> 00:59:20,559
interesting to know

1311
00:59:17,200 --> 00:59:23,279
because the time delta between found

1312
00:59:20,559 --> 00:59:24,880
password and used password can tell us a

1313
00:59:23,280 --> 00:59:26,960
bit about our attacker right

1314
00:59:24,880 --> 00:59:28,319
are they scripting this are they doing

1315
00:59:26,960 --> 00:59:30,880
it manually

1316
00:59:28,319 --> 00:59:33,520
maybe they're using cobalt strike to

1317
00:59:30,880 --> 00:59:37,599
automate their uh their attack

1318
00:59:33,520 --> 00:59:40,480
um but the the time delta can speak to

1319
00:59:37,599 --> 00:59:42,000
um give us an indication at least on

1320
00:59:40,480 --> 00:59:44,640
whether or not our attacker

1321
00:59:42,000 --> 00:59:46,720
is automating their attack which could

1322
00:59:44,640 --> 00:59:48,960
show them to be a bit more sophisticated

1323
00:59:46,720 --> 00:59:49,839
or if they're literally taking the

1324
00:59:48,960 --> 00:59:51,520
results and

1325
00:59:49,839 --> 00:59:52,880
you know copying and pasting it from one

1326
00:59:51,520 --> 00:59:55,119
system to another

1327
00:59:52,880 --> 00:59:56,480
or emailing it from one person to

1328
00:59:55,119 --> 01:00:00,079
another

1329
00:59:56,480 --> 01:00:03,440
the the time delta can be a helpful

1330
01:00:00,079 --> 01:00:06,079
indicator on on your attacker's tactics

1331
01:00:03,440 --> 01:00:07,760
so let's see if we can find out this you

1332
01:00:06,079 --> 01:00:08,799
can do this just by finding the

1333
01:00:07,760 --> 01:00:11,040
timestamps

1334
01:00:08,799 --> 01:00:12,640
and then using a calculator to subtract

1335
01:00:11,040 --> 01:00:14,160
one from the other

1336
01:00:12,640 --> 01:00:15,839
but we're also teaching a little bit

1337
01:00:14,160 --> 01:00:17,118
about the transaction command

1338
01:00:15,839 --> 01:00:19,440
so for those of you that want to get a

1339
01:00:17,119 --> 01:00:20,880
little more advanced or want to try the

1340
01:00:19,440 --> 01:00:23,520
transaction command you can use it

1341
01:00:20,880 --> 01:00:25,839
through the app itself

1342
01:00:23,520 --> 01:00:26,960
the transaction command is pretty cool

1343
01:00:25,839 --> 01:00:29,599
it's a lot like

1344
01:00:26,960 --> 01:00:31,040
if you've ever used um wireshark um or

1345
01:00:29,599 --> 01:00:34,079
for those of you that have been

1346
01:00:31,040 --> 01:00:37,279
you know real old school ethereal

1347
01:00:34,079 --> 01:00:38,319
um uh you know that um there's a

1348
01:00:37,280 --> 01:00:40,799
function called

1349
01:00:38,319 --> 01:00:42,319
follow http conversation so if you've

1350
01:00:40,799 --> 01:00:45,200
got a bunch of http

1351
01:00:42,319 --> 01:00:48,319
logs packets captured in wireshark you

1352
01:00:45,200 --> 01:00:51,040
can say follow the http conversation

1353
01:00:48,319 --> 01:00:52,000
and it will show you the http

1354
01:00:51,040 --> 01:00:53,759
transactions

1355
01:00:52,000 --> 01:00:56,079
in a conversational way just kind of

1356
01:00:53,760 --> 01:00:59,440
like chat does

1357
01:00:56,079 --> 01:01:01,440
a transaction will follow a conversation

1358
01:00:59,440 --> 01:01:04,559
or a transaction as well

1359
01:01:01,440 --> 01:01:05,680
and you can tell it to mark its start

1360
01:01:04,559 --> 01:01:08,960
and stop

1361
01:01:05,680 --> 01:01:10,000
by any unique field within the data that

1362
01:01:08,960 --> 01:01:11,680
you're looking at

1363
01:01:10,000 --> 01:01:13,040
so for this one you can literally say

1364
01:01:11,680 --> 01:01:15,759
hey transaction

1365
01:01:13,040 --> 01:01:18,000
the first time you see a password is the

1366
01:01:15,760 --> 01:01:20,319
start of a transaction and the last time

1367
01:01:18,000 --> 01:01:22,480
you see that same password

1368
01:01:20,319 --> 01:01:24,000
is the end of that transaction and if

1369
01:01:22,480 --> 01:01:27,040
there are multiple passwords it

1370
01:01:24,000 --> 01:01:28,160
will track multiple conversations which

1371
01:01:27,040 --> 01:01:29,279
is really cool

1372
01:01:28,160 --> 01:01:31,200
if you want to learn how to use a

1373
01:01:29,280 --> 01:01:33,520
transaction command you can literally

1374
01:01:31,200 --> 01:01:34,640
the best way to do it is google splunk

1375
01:01:33,520 --> 01:01:38,480
transaction command

1376
01:01:34,640 --> 01:01:40,879
and that'll give you all the syntax um

1377
01:01:38,480 --> 01:01:41,760
we use the transaction command all the

1378
01:01:40,880 --> 01:01:44,880
time

1379
01:01:41,760 --> 01:01:46,880
to look for web-based fraud the

1380
01:01:44,880 --> 01:01:48,720
transaction command can extract these

1381
01:01:46,880 --> 01:01:50,799
conversations out

1382
01:01:48,720 --> 01:01:51,759
and those conversations then if you run

1383
01:01:50,799 --> 01:01:53,200
it through

1384
01:01:51,760 --> 01:01:54,960
something like our machine learning

1385
01:01:53,200 --> 01:01:57,598
toolkit can look for

1386
01:01:54,960 --> 01:01:58,880
outliers and guess what fraudulent

1387
01:01:57,599 --> 01:02:02,000
transactions

1388
01:01:58,880 --> 01:02:05,039
almost always end up as outliers

1389
01:02:02,000 --> 01:02:06,240
when you're looking at web based

1390
01:02:05,039 --> 01:02:09,680
transactions

1391
01:02:06,240 --> 01:02:11,359
so very very cool way to find fraud

1392
01:02:09,680 --> 01:02:12,799
if your company deals with fraud

1393
01:02:11,359 --> 01:02:16,160
especially like i said

1394
01:02:12,799 --> 01:02:17,680
in things like web transactions

1395
01:02:16,160 --> 01:02:20,160
so i'm going to give you guys just

1396
01:02:17,680 --> 01:02:22,960
another minute or two to see if you can

1397
01:02:20,160 --> 01:02:23,680
figure out those the seconds transpired

1398
01:02:22,960 --> 01:02:26,880
between

1399
01:02:23,680 --> 01:02:35,839
brute force attack and actual compromise

1400
01:02:26,880 --> 01:02:35,839
by the second system

1401
01:02:46,839 --> 01:02:49,839
uh

1402
01:03:04,319 --> 01:03:07,759
by the way how's the pace for you guys

1403
01:03:06,160 --> 01:03:11,200
am i going at a good

1404
01:03:07,760 --> 01:03:12,319
speed too fast too slow feel free to

1405
01:03:11,200 --> 01:03:14,319
just uh

1406
01:03:12,319 --> 01:03:16,160
you know if you if you go to panelists

1407
01:03:14,319 --> 01:03:18,319
that's i'm the only panelist here

1408
01:03:16,160 --> 01:03:20,720
so you can uh you can give me feedback

1409
01:03:18,319 --> 01:03:21,359
um privately just to the panelists if

1410
01:03:20,720 --> 01:03:23,839
you want

1411
01:03:21,359 --> 01:03:25,680
or you can put it in to everybody but

1412
01:03:23,839 --> 01:03:28,319
just give me an idea if i'm

1413
01:03:25,680 --> 01:03:30,000
going too fast too slow or just right

1414
01:03:28,319 --> 01:03:32,960
hopefully i've hit the goldilocks

1415
01:03:30,000 --> 01:03:32,960
speed here for you

1416
01:03:37,920 --> 01:03:41,200
awesome thank you for the feedback tammy

1417
01:03:39,599 --> 01:03:43,680
i definitely appreciate it

1418
01:03:41,200 --> 01:03:45,118
in fact it really helps me to get

1419
01:03:43,680 --> 01:03:47,359
feedback in general

1420
01:03:45,119 --> 01:03:49,520
so um all of you that have been giving

1421
01:03:47,359 --> 01:03:51,680
me feedback thank you so much

1422
01:03:49,520 --> 01:03:54,160
um otherwise i just end up feeling like

1423
01:03:51,680 --> 01:03:56,319
a crazy person talking to themselves

1424
01:03:54,160 --> 01:03:57,680
so uh it's all especially since you guys

1425
01:03:56,319 --> 01:04:00,000
can't turn on your mics

1426
01:03:57,680 --> 01:04:00,799
in this environment it's just really

1427
01:04:00,000 --> 01:04:04,799
great to

1428
01:04:00,799 --> 01:04:04,799
hear you out there so thank you so much

1429
01:04:07,680 --> 01:04:14,640
by the way if you like this workshop

1430
01:04:10,799 --> 01:04:18,559
this workshop is free um to

1431
01:04:14,640 --> 01:04:19,920
customers or groups so

1432
01:04:18,559 --> 01:04:21,760
you know i can't do it free for like

1433
01:04:19,920 --> 01:04:24,880
just one person but

1434
01:04:21,760 --> 01:04:27,119
if your organization would like this

1435
01:04:24,880 --> 01:04:29,119
internally for your whole team i can do

1436
01:04:27,119 --> 01:04:31,839
this for free for your team

1437
01:04:29,119 --> 01:04:32,720
um or if you've got like you know a

1438
01:04:31,839 --> 01:04:35,920
hacker group

1439
01:04:32,720 --> 01:04:38,480
or or even you and just a bunch of your

1440
01:04:35,920 --> 01:04:40,079
friends in the infosec community

1441
01:04:38,480 --> 01:04:42,079
you guys want to all get together and

1442
01:04:40,079 --> 01:04:45,280
have another session

1443
01:04:42,079 --> 01:04:45,920
of this i can totally set that up for

1444
01:04:45,280 --> 01:04:49,200
you guys

1445
01:04:45,920 --> 01:04:52,400
uh so um uh

1446
01:04:49,200 --> 01:04:55,439
the easiest way to um

1447
01:04:52,400 --> 01:04:57,839
uh request it is if if you are

1448
01:04:55,440 --> 01:04:58,559
if you have a relationship with a splunk

1449
01:04:57,839 --> 01:05:00,160
team

1450
01:04:58,559 --> 01:05:01,680
um you can request it through them and

1451
01:05:00,160 --> 01:05:03,839
just tell them you want me

1452
01:05:01,680 --> 01:05:05,118
um if you don't have any relationships

1453
01:05:03,839 --> 01:05:08,400
with any splunk

1454
01:05:05,119 --> 01:05:09,760
uh field people you can always uh hit me

1455
01:05:08,400 --> 01:05:13,440
up directly

1456
01:05:09,760 --> 01:05:15,599
i will be sharing out my email address

1457
01:05:13,440 --> 01:05:17,280
at the end of class so you guys can hit

1458
01:05:15,599 --> 01:05:20,559
me up there as well

1459
01:05:17,280 --> 01:05:23,599
in fact just in case folks have to leave

1460
01:05:20,559 --> 01:05:26,799
um early oh man you're doing dot com

1461
01:05:23,599 --> 01:05:28,640
that's awesome so um tammy the uh

1462
01:05:26,799 --> 01:05:29,839
the boss of the sock competition will be

1463
01:05:28,640 --> 01:05:31,759
brand new this year

1464
01:05:29,839 --> 01:05:33,680
we do a new set of challenges and a new

1465
01:05:31,760 --> 01:05:36,079
set of questions so if you've got time

1466
01:05:33,680 --> 01:05:38,799
to do the boss of the stock competition

1467
01:05:36,079 --> 01:05:39,839
this is a great primer for it this will

1468
01:05:38,799 --> 01:05:41,839
you're learning

1469
01:05:39,839 --> 01:05:43,038
all the skills that you'll need to

1470
01:05:41,839 --> 01:05:44,720
compete um

1471
01:05:43,039 --> 01:05:47,920
yeah you always want to put together a

1472
01:05:44,720 --> 01:05:49,680
team um so we allow teams up to four

1473
01:05:47,920 --> 01:05:51,359
um and you're going to want a team

1474
01:05:49,680 --> 01:05:51,839
because you're going to be competing

1475
01:05:51,359 --> 01:05:53,598
against

1476
01:05:51,839 --> 01:05:55,200
teams and it's just really helpful to

1477
01:05:53,599 --> 01:05:56,960
have someone who's really good with

1478
01:05:55,200 --> 01:05:57,839
windows data and someone who's really

1479
01:05:56,960 --> 01:06:00,799
good

1480
01:05:57,839 --> 01:06:02,319
with regex and all this kind of stuff so

1481
01:06:00,799 --> 01:06:05,280
if you can pull a team together

1482
01:06:02,319 --> 01:06:06,640
go for it we did have a guy really good

1483
01:06:05,280 --> 01:06:09,440
at splunk

1484
01:06:06,640 --> 01:06:10,400
he competed we had a uh an all canada

1485
01:06:09,440 --> 01:06:13,440
boss with a sock

1486
01:06:10,400 --> 01:06:17,440
last week and this guy was so good

1487
01:06:13,440 --> 01:06:20,160
that he came in third place by himself

1488
01:06:17,440 --> 01:06:21,920
against teams of four guy was just

1489
01:06:20,160 --> 01:06:24,240
amazing

1490
01:06:21,920 --> 01:06:25,520
um you know i'm going to put um just for

1491
01:06:24,240 --> 01:06:26,959
those of you that you know

1492
01:06:25,520 --> 01:06:29,038
might not be able to stick around to the

1493
01:06:26,960 --> 01:06:31,280
n2 i'll put my email address here in the

1494
01:06:29,039 --> 01:06:31,280
chat

1495
01:06:31,599 --> 01:06:35,119
and that way not only can you hit me up

1496
01:06:33,599 --> 01:06:37,839
there if you want to do a class

1497
01:06:35,119 --> 01:06:39,280
but some of you had requested the slides

1498
01:06:37,839 --> 01:06:41,520
by the way you really don't need the

1499
01:06:39,280 --> 01:06:43,760
slides this this companion app

1500
01:06:41,520 --> 01:06:45,359
um that comes with it i'm going to

1501
01:06:43,760 --> 01:06:47,839
switch back over that

1502
01:06:45,359 --> 01:06:47,839
um

1503
01:06:53,760 --> 01:06:57,599
where is my browser there we go this

1504
01:06:56,319 --> 01:07:00,480
companion app

1505
01:06:57,599 --> 01:07:02,400
has all of the challenges um you know

1506
01:07:00,480 --> 01:07:05,039
scenario by scenario

1507
01:07:02,400 --> 01:07:06,000
with full explanation of what each

1508
01:07:05,039 --> 01:07:09,440
challenge is

1509
01:07:06,000 --> 01:07:12,000
so um and it's free to download um

1510
01:07:09,440 --> 01:07:13,359
so these servers this the server that

1511
01:07:12,000 --> 01:07:15,760
you guys are working on right now

1512
01:07:13,359 --> 01:07:17,200
this is up for 24 hours so you can play

1513
01:07:15,760 --> 01:07:20,559
with it to your heart's content

1514
01:07:17,200 --> 01:07:21,520
until sometime tomorrow but if you want

1515
01:07:20,559 --> 01:07:24,559
the app itself

1516
01:07:21,520 --> 01:07:27,280
here's what you do so um it's it's open

1517
01:07:24,559 --> 01:07:29,200
source it's up at splunk base

1518
01:07:27,280 --> 01:07:31,440
so i'm gonna pull it up here so what you

1519
01:07:29,200 --> 01:07:33,839
would do is you go to splunk base and

1520
01:07:31,440 --> 01:07:34,799
uh we're looking for boss with a sock

1521
01:07:33,839 --> 01:07:37,839
there we go

1522
01:07:34,799 --> 01:07:39,759
so come on here we go so

1523
01:07:37,839 --> 01:07:42,240
boss of the sock investigation workshop

1524
01:07:39,760 --> 01:07:45,200
for splunk that's the app

1525
01:07:42,240 --> 01:07:46,959
and somewhere in the notes here it's

1526
01:07:45,200 --> 01:07:50,000
going to tell you where the data set

1527
01:07:46,960 --> 01:07:51,680
is so the data set is off our github

1528
01:07:50,000 --> 01:07:52,960
yep there you go so here's what you

1529
01:07:51,680 --> 01:07:53,919
would do if you wanted to do this on

1530
01:07:52,960 --> 01:07:56,799
your own

1531
01:07:53,920 --> 01:07:58,240
you download the free version of splunk

1532
01:07:56,799 --> 01:08:01,280
you download

1533
01:07:58,240 --> 01:08:04,000
this app and then you download this

1534
01:08:01,280 --> 01:08:05,039
data set you import the data set you

1535
01:08:04,000 --> 01:08:08,240
install the app

1536
01:08:05,039 --> 01:08:10,400
on top of splunk um and uh

1537
01:08:08,240 --> 01:08:12,479
and then you are good to go and if

1538
01:08:10,400 --> 01:08:14,559
you're not sure how to do all of that

1539
01:08:12,480 --> 01:08:15,599
we have another free thing for you so

1540
01:08:14,559 --> 01:08:19,600
it's um

1541
01:08:15,599 --> 01:08:23,120
splunk fundamentals one

1542
01:08:19,600 --> 01:08:24,719
is a free online class that teaches you

1543
01:08:23,120 --> 01:08:27,040
the basics of

1544
01:08:24,719 --> 01:08:28,000
getting splunk set up how to start

1545
01:08:27,040 --> 01:08:31,278
searching

1546
01:08:28,000 --> 01:08:33,759
all that kind of stuff so um yeah

1547
01:08:31,279 --> 01:08:34,880
how to how to get stats dashboards

1548
01:08:33,759 --> 01:08:36,560
lookups

1549
01:08:34,880 --> 01:08:38,960
that's a really good class and it is

1550
01:08:36,560 --> 01:08:41,279
totally free um

1551
01:08:38,960 --> 01:08:42,960
if there and and these things are free

1552
01:08:41,279 --> 01:08:46,400
for returning you can

1553
01:08:42,960 --> 01:08:49,759
there's no time limit on it if you

1554
01:08:46,399 --> 01:08:52,799
are a vet or you know a vet we offer

1555
01:08:49,759 --> 01:08:55,120
even more free classes for

1556
01:08:52,799 --> 01:08:55,920
vets in honor of their service so if you

1557
01:08:55,120 --> 01:08:58,799
know someone

1558
01:08:55,920 --> 01:09:01,040
if you know a vet that needs to new

1559
01:08:58,799 --> 01:09:04,399
skills or needs to get a new job

1560
01:09:01,040 --> 01:09:06,719
they can learn quite a bit about splunk

1561
01:09:04,399 --> 01:09:08,559
and let me tell you there are people

1562
01:09:06,719 --> 01:09:11,839
hurting right now for splunk

1563
01:09:08,560 --> 01:09:14,960
uh people in organizations so it is a

1564
01:09:11,839 --> 01:09:18,000
fast track to a good job um for for

1565
01:09:14,960 --> 01:09:18,000
folks that are looking

1566
01:09:18,158 --> 01:09:26,318
um i'm gonna switch back over to

1567
01:09:21,359 --> 01:09:26,319
our slides here

1568
01:09:26,560 --> 01:09:30,480
everybody can still see my slides yeah

1569
01:09:33,439 --> 01:09:37,278
just want to make sure okay cool thanks

1570
01:09:35,520 --> 01:09:39,759
june um

1571
01:09:37,279 --> 01:09:41,520
so let's see what we can do with this

1572
01:09:39,759 --> 01:09:44,560
challenge here on the times uh

1573
01:09:41,520 --> 01:09:47,440
time elapsed again

1574
01:09:44,560 --> 01:09:48,080
you already know what data you're

1575
01:09:47,439 --> 01:09:49,519
looking for

1576
01:09:48,080 --> 01:09:51,759
right you're looking based on our

1577
01:09:49,520 --> 01:09:53,679
previous searches we want to now

1578
01:09:51,759 --> 01:09:55,600
figure out how much time elapsed from

1579
01:09:53,679 --> 01:09:58,400
when batman was found to be

1580
01:09:55,600 --> 01:09:59,199
legit to use to actually exploit our

1581
01:09:58,400 --> 01:10:02,480
server

1582
01:09:59,199 --> 01:10:04,719
so we can use that password as uh

1583
01:10:02,480 --> 01:10:05,599
as part of our filter so we're gonna

1584
01:10:04,719 --> 01:10:07,440
regex out

1585
01:10:05,600 --> 01:10:09,040
all the passwords but then we're gonna

1586
01:10:07,440 --> 01:10:10,080
pass that we're gonna pass that back

1587
01:10:09,040 --> 01:10:12,719
into search and say

1588
01:10:10,080 --> 01:10:13,199
hey only come back with results where

1589
01:10:12,719 --> 01:10:15,520
that

1590
01:10:13,199 --> 01:10:16,239
field that we created user password

1591
01:10:15,520 --> 01:10:19,280
actually

1592
01:10:16,239 --> 01:10:20,799
equals batman and then we're going to

1593
01:10:19,280 --> 01:10:22,159
throw that in the table

1594
01:10:20,800 --> 01:10:24,640
just like we've done with some other

1595
01:10:22,159 --> 01:10:26,080
things exposing the timestamp

1596
01:10:24,640 --> 01:10:27,679
and then have the other fields there

1597
01:10:26,080 --> 01:10:30,239
again just for validation

1598
01:10:27,679 --> 01:10:32,000
visual validation so we know that the

1599
01:10:30,239 --> 01:10:32,879
time that we're getting is the time that

1600
01:10:32,000 --> 01:10:34,719
we want

1601
01:10:32,880 --> 01:10:35,920
and we get these two time stamps you

1602
01:10:34,719 --> 01:10:37,760
know 23

1603
01:10:35,920 --> 01:10:38,960
uh was the one that found it and that's

1604
01:10:37,760 --> 01:10:41,600
the oldest time stamp

1605
01:10:38,960 --> 01:10:43,120
40 actually used it we could just bust

1606
01:10:41,600 --> 01:10:46,159
open calc right now

1607
01:10:43,120 --> 01:10:47,040
um and which usually gets used for

1608
01:10:46,159 --> 01:10:50,159
exploit demos

1609
01:10:47,040 --> 01:10:51,679
but um we can subtract one for the other

1610
01:10:50,159 --> 01:10:54,320
and we would have the second

1611
01:10:51,679 --> 01:10:55,760
now in this particular one they we they

1612
01:10:54,320 --> 01:10:57,280
made a mistake this was the

1613
01:10:55,760 --> 01:10:59,520
these questions come from the first year

1614
01:10:57,280 --> 01:11:00,559
we did this competition and they forgot

1615
01:10:59,520 --> 01:11:02,719
to ask

1616
01:11:00,560 --> 01:11:04,239
uh how many decimal points because they

1617
01:11:02,719 --> 01:11:05,679
assumed everybody would use the

1618
01:11:04,239 --> 01:11:08,480
transaction command

1619
01:11:05,679 --> 01:11:09,679
um so if you used calculator you might

1620
01:11:08,480 --> 01:11:10,320
not get the right answer if you didn't

1621
01:11:09,679 --> 01:11:12,239
know how many

1622
01:11:10,320 --> 01:11:14,159
decimal points but i'm going to show you

1623
01:11:12,239 --> 01:11:17,440
how to use the transaction command now

1624
01:11:14,159 --> 01:11:19,519
so we're going to take that search

1625
01:11:17,440 --> 01:11:20,799
and instead of putting in a table um

1626
01:11:19,520 --> 01:11:22,480
we're going to take the results of

1627
01:11:20,800 --> 01:11:24,080
anything where the user password

1628
01:11:22,480 --> 01:11:25,280
actually is batman

1629
01:11:24,080 --> 01:11:27,199
and we're going to pass it to the

1630
01:11:25,280 --> 01:11:28,159
command transaction we'll say hey

1631
01:11:27,199 --> 01:11:30,960
transaction

1632
01:11:28,159 --> 01:11:31,679
your start and stop marker is user

1633
01:11:30,960 --> 01:11:34,640
password

1634
01:11:31,679 --> 01:11:36,320
anytime you see a unique user password

1635
01:11:34,640 --> 01:11:38,320
start that transaction

1636
01:11:36,320 --> 01:11:39,440
and the last time you see it will be the

1637
01:11:38,320 --> 01:11:40,880
end of the transaction

1638
01:11:39,440 --> 01:11:43,199
and the la first and last will be

1639
01:11:40,880 --> 01:11:46,480
defined by the scope of your time

1640
01:11:43,199 --> 01:11:49,440
right your time um sets the

1641
01:11:46,480 --> 01:11:51,120
the the limits for what the first and

1642
01:11:49,440 --> 01:11:54,159
last can be it doesn't go on

1643
01:11:51,120 --> 01:11:56,239
to uh you know perpetuity

1644
01:11:54,159 --> 01:11:57,759
it's going to stop at some point because

1645
01:11:56,239 --> 01:11:59,199
either there's going to be no more data

1646
01:11:57,760 --> 01:12:01,120
or you're going to hit the end of your

1647
01:11:59,199 --> 01:12:02,320
time window

1648
01:12:01,120 --> 01:12:04,320
so we're going to pass that into

1649
01:12:02,320 --> 01:12:07,840
transaction and by default

1650
01:12:04,320 --> 01:12:10,239
transaction calculates the duration

1651
01:12:07,840 --> 01:12:11,520
of that transaction so this is a

1652
01:12:10,239 --> 01:12:14,320
duration is a field

1653
01:12:11,520 --> 01:12:16,000
automatically generated by what

1654
01:12:14,320 --> 01:12:17,759
transaction is doing

1655
01:12:16,000 --> 01:12:20,000
and to see it we're just going to expose

1656
01:12:17,760 --> 01:12:21,920
it in a table so it's going to look like

1657
01:12:20,000 --> 01:12:24,560
this

1658
01:12:21,920 --> 01:12:25,920
so what we've got here is hey anything

1659
01:12:24,560 --> 01:12:28,080
coming over the wire

1660
01:12:25,920 --> 01:12:29,600
i want to pull out any data that

1661
01:12:28,080 --> 01:12:31,360
contains user passwords

1662
01:12:29,600 --> 01:12:33,760
i want to pull that password out as a

1663
01:12:31,360 --> 01:12:36,480
string call it user password

1664
01:12:33,760 --> 01:12:37,760
i'm going to then reduce my all that

1665
01:12:36,480 --> 01:12:39,519
stuff that came through to

1666
01:12:37,760 --> 01:12:40,880
just the ones where the user password

1667
01:12:39,520 --> 01:12:42,560
actually equals batman

1668
01:12:40,880 --> 01:12:44,080
because that was the one that was used

1669
01:12:42,560 --> 01:12:46,880
i'm going to tell transaction

1670
01:12:44,080 --> 01:12:47,600
to track that by the user password and

1671
01:12:46,880 --> 01:12:49,440
calculate

1672
01:12:47,600 --> 01:12:51,760
the duration and expose that duration

1673
01:12:49,440 --> 01:12:55,280
for me in a table

1674
01:12:51,760 --> 01:12:56,560
giving me the results of 92.169.084

1675
01:12:55,280 --> 01:13:00,800
seconds

1676
01:12:56,560 --> 01:13:00,800
and that's how we get to that challenge

1677
01:13:01,600 --> 01:13:05,440
ah all right we're we're gonna change

1678
01:13:03,679 --> 01:13:05,760
gears a lot we've been looking a lot of

1679
01:13:05,440 --> 01:13:08,480
uh

1680
01:13:05,760 --> 01:13:09,440
stuff off the wire let's change our

1681
01:13:08,480 --> 01:13:12,000
focus uh

1682
01:13:09,440 --> 01:13:13,440
uh well this will still be a little bit

1683
01:13:12,000 --> 01:13:14,719
this would be a little bit of wire data

1684
01:13:13,440 --> 01:13:15,199
this will be a little bit other data as

1685
01:13:14,719 --> 01:13:19,199
well

1686
01:13:15,199 --> 01:13:20,960
um but poison ivy attacked our server

1687
01:13:19,199 --> 01:13:24,239
they brute force their way in

1688
01:13:20,960 --> 01:13:28,239
they uh of course uh as good hackers

1689
01:13:24,239 --> 01:13:30,159
start uploading their own tools so

1690
01:13:28,239 --> 01:13:32,639
we want to find the name of the

1691
01:13:30,159 --> 01:13:35,120
executable the poison ivy uploaded

1692
01:13:32,640 --> 01:13:35,840
as a bonus what was the source address

1693
01:13:35,120 --> 01:13:38,640
of the

1694
01:13:35,840 --> 01:13:40,320
executable that was uploaded now this is

1695
01:13:38,640 --> 01:13:42,000
a windows server

1696
01:13:40,320 --> 01:13:45,120
we're going to keep it simple there are

1697
01:13:42,000 --> 01:13:47,440
plenty of extensions that are executable

1698
01:13:45,120 --> 01:13:48,800
we all know the most common extension

1699
01:13:47,440 --> 01:13:51,599
for an executable right

1700
01:13:48,800 --> 01:13:52,800
yeah it's dot exe and you can use that

1701
01:13:51,600 --> 01:13:55,280
to your advantage

1702
01:13:52,800 --> 01:13:57,199
um in this particular challenge uh

1703
01:13:55,280 --> 01:13:58,159
having a whole list of executable

1704
01:13:57,199 --> 01:14:01,199
extensions

1705
01:13:58,159 --> 01:14:01,839
would be handy um and i just happen to

1706
01:14:01,199 --> 01:14:03,360
have one

1707
01:14:01,840 --> 01:14:05,360
and if you come to my talk at two

1708
01:14:03,360 --> 01:14:09,360
o'clock i'll show you that list

1709
01:14:05,360 --> 01:14:12,400
um so uh oh by the way so

1710
01:14:09,360 --> 01:14:13,120
john johnson uh one of the the the

1711
01:14:12,400 --> 01:14:16,239
primary

1712
01:14:13,120 --> 01:14:18,480
organizer here for corncon um had

1713
01:14:16,239 --> 01:14:19,599
announced uh yesterday that he was he

1714
01:14:18,480 --> 01:14:22,799
had a couple slots

1715
01:14:19,600 --> 01:14:24,239
um uh that aren't full in in one case

1716
01:14:22,800 --> 01:14:25,679
it's literally because

1717
01:14:24,239 --> 01:14:28,239
one of the presenters one of our own

1718
01:14:25,679 --> 01:14:29,920
people has contracted covid

1719
01:14:28,239 --> 01:14:31,759
um i don't know their state i don't know

1720
01:14:29,920 --> 01:14:34,480
if it's serious i just know they were

1721
01:14:31,760 --> 01:14:37,600
not able to make the con today

1722
01:14:34,480 --> 01:14:40,480
and so he had slots he needed to fill

1723
01:14:37,600 --> 01:14:41,760
i told him i would be happy to do the

1724
01:14:40,480 --> 01:14:44,080
two o'clock slot

1725
01:14:41,760 --> 01:14:45,600
so this class we're going to end a

1726
01:14:44,080 --> 01:14:47,040
little bit early we're not going to end

1727
01:14:45,600 --> 01:14:50,400
it right at 2 we're going to end it

1728
01:14:47,040 --> 01:14:53,440
like 10 to 2 um

1729
01:14:50,400 --> 01:14:56,480
and then i'll be doing um uh

1730
01:14:53,440 --> 01:14:58,639
well andy you've seen this one already

1731
01:14:56,480 --> 01:15:00,080
uh you know it was last minute so i told

1732
01:14:58,640 --> 01:15:01,440
him you know i can i could do my tips

1733
01:15:00,080 --> 01:15:04,000
and tricks uh

1734
01:15:01,440 --> 01:15:04,639
talk so i've got to talk all about the

1735
01:15:04,000 --> 01:15:06,560
free

1736
01:15:04,640 --> 01:15:07,840
and cheap things i've learned as a

1737
01:15:06,560 --> 01:15:10,239
security practitioner

1738
01:15:07,840 --> 01:15:11,520
can kind of help fill security gaps when

1739
01:15:10,239 --> 01:15:14,559
you don't have budget

1740
01:15:11,520 --> 01:15:15,679
um it's also a good good cure for shiny

1741
01:15:14,560 --> 01:15:17,679
object syndrome

1742
01:15:15,679 --> 01:15:19,040
and remind people that you don't have to

1743
01:15:17,679 --> 01:15:19,840
buy something every time you have a

1744
01:15:19,040 --> 01:15:21,360
problem

1745
01:15:19,840 --> 01:15:22,960
uh so if you want to come to that one

1746
01:15:21,360 --> 01:15:24,880
that's a two it'll be in this

1747
01:15:22,960 --> 01:15:26,480
same room so you don't even have to

1748
01:15:24,880 --> 01:15:29,920
leave if you don't want to

1749
01:15:26,480 --> 01:15:31,199
um for the question you're trying to

1750
01:15:29,920 --> 01:15:33,920
answer now

1751
01:15:31,199 --> 01:15:36,239
think again about what http method would

1752
01:15:33,920 --> 01:15:38,000
be used when you're uploading a file to

1753
01:15:36,239 --> 01:15:41,120
a server

1754
01:15:38,000 --> 01:15:43,280
post again yes

1755
01:15:41,120 --> 01:15:46,239
and and think about what source types

1756
01:15:43,280 --> 01:15:47,440
might actually see those files

1757
01:15:46,239 --> 01:15:48,879
and i'll give you just another minute

1758
01:15:47,440 --> 01:15:50,400
because i've been babbling along and you

1759
01:15:48,880 --> 01:15:53,840
guys have probably been working hard on

1760
01:15:50,400 --> 01:15:53,839
the challenge

1761
01:16:32,800 --> 01:16:37,040
okay does anyone need any more time on

1762
01:16:35,360 --> 01:16:38,880
this one

1763
01:16:37,040 --> 01:16:41,840
if you do just pop me in the chat and

1764
01:16:38,880 --> 01:16:41,840
i'll give you another minute

1765
01:16:43,199 --> 01:16:47,120
cool all right let's see what we can

1766
01:16:45,120 --> 01:16:50,719
find

1767
01:16:47,120 --> 01:16:51,920
all right so i told you you can use exe

1768
01:16:50,719 --> 01:16:54,560
literally as part of your search

1769
01:16:51,920 --> 01:16:56,800
parameters so we can throw that up

1770
01:16:54,560 --> 01:16:57,760
there into our search uh obviously it's

1771
01:16:56,800 --> 01:16:59,440
go it went

1772
01:16:57,760 --> 01:17:00,960
on to our server so we can limit our

1773
01:16:59,440 --> 01:17:03,199
search by our server as well

1774
01:17:00,960 --> 01:17:05,280
so dot 70 is part of our parameters in

1775
01:17:03,199 --> 01:17:07,759
our search here as well

1776
01:17:05,280 --> 01:17:08,800
and over coming over the wire might be a

1777
01:17:07,760 --> 01:17:11,520
good place to look

1778
01:17:08,800 --> 01:17:13,840
so if we just take a look at that and

1779
01:17:11,520 --> 01:17:15,520
look through our interesting fields

1780
01:17:13,840 --> 01:17:17,199
depending on how well you know a data

1781
01:17:15,520 --> 01:17:18,320
source sometimes you may just have to

1782
01:17:17,199 --> 01:17:21,599
look like things that are

1783
01:17:18,320 --> 01:17:22,639
likely as you get to know various data

1784
01:17:21,600 --> 01:17:25,280
sources better

1785
01:17:22,640 --> 01:17:27,600
it'll become almost intuitive but in

1786
01:17:25,280 --> 01:17:30,159
this particular data source

1787
01:17:27,600 --> 01:17:31,760
stream we do have a field called part

1788
01:17:30,159 --> 01:17:33,759
underscore file name

1789
01:17:31,760 --> 01:17:36,000
file names might be a good place to find

1790
01:17:33,760 --> 01:17:36,960
something referenced by.exe so let's

1791
01:17:36,000 --> 01:17:39,040
take a look

1792
01:17:36,960 --> 01:17:40,159
we scroll down find that field and click

1793
01:17:39,040 --> 01:17:42,840
on it uh

1794
01:17:40,159 --> 01:17:44,159
we'll see um two results coming back

1795
01:17:42,840 --> 01:17:48,000
3791

1796
01:17:44,159 --> 01:17:49,839
uh.exe and agent.php this looks

1797
01:17:48,000 --> 01:17:51,040
like our suspect let's see if we

1798
01:17:49,840 --> 01:17:54,560
invalidate that

1799
01:17:51,040 --> 01:17:55,199
hypothesis so intrusion detection

1800
01:17:54,560 --> 01:17:58,320
systems

1801
01:17:55,199 --> 01:18:01,440
also know a lot about files

1802
01:17:58,320 --> 01:18:02,239
they're looking for malicious files and

1803
01:18:01,440 --> 01:18:04,559
they're going to

1804
01:18:02,239 --> 01:18:06,400
tell you about them if they find them

1805
01:18:04,560 --> 01:18:09,040
they may just log every file

1806
01:18:06,400 --> 01:18:10,080
depending on how it's configured so if

1807
01:18:09,040 --> 01:18:11,600
we take a look at this

1808
01:18:10,080 --> 01:18:14,480
circada data set with the same

1809
01:18:11,600 --> 01:18:16,800
parameters here uh we see

1810
01:18:14,480 --> 01:18:17,839
two executables this is you know this is

1811
01:18:16,800 --> 01:18:20,560
just a standard

1812
01:18:17,840 --> 01:18:21,440
uh windows executable and if we find if

1813
01:18:20,560 --> 01:18:23,040
we take a look

1814
01:18:21,440 --> 01:18:24,559
we'll find it came from the inside not

1815
01:18:23,040 --> 01:18:25,199
the outside if we were to drill down on

1816
01:18:24,560 --> 01:18:28,560
that one

1817
01:18:25,199 --> 01:18:32,639
37.91 though popping up here again um

1818
01:18:28,560 --> 01:18:36,400
definitely definitely suspect here um

1819
01:18:32,640 --> 01:18:38,480
quick note about host names versus ips

1820
01:18:36,400 --> 01:18:40,239
you know not all fields going to have

1821
01:18:38,480 --> 01:18:41,919
the same values depending on where the

1822
01:18:40,239 --> 01:18:43,040
logs are coming from and how those logs

1823
01:18:41,920 --> 01:18:46,080
are configured

1824
01:18:43,040 --> 01:18:47,840
so if you have to search multiple values

1825
01:18:46,080 --> 01:18:51,199
for the same thing

1826
01:18:47,840 --> 01:18:54,400
you can use uh the or in

1827
01:18:51,199 --> 01:18:54,960
in between things along with brackets um

1828
01:18:54,400 --> 01:18:57,120
so

1829
01:18:54,960 --> 01:18:58,239
boolean basic boolean logic here right

1830
01:18:57,120 --> 01:19:01,120
but if you had

1831
01:18:58,239 --> 01:19:02,799
potentially a desk field or a deskt

1832
01:19:01,120 --> 01:19:06,080
underscore ip field

1833
01:19:02,800 --> 01:19:07,760
you could uh define both of those

1834
01:19:06,080 --> 01:19:09,519
just by putting them in brackets with an

1835
01:19:07,760 --> 01:19:11,760
or in between them

1836
01:19:09,520 --> 01:19:14,000
um it doesn't have to be just ip

1837
01:19:11,760 --> 01:19:17,280
addresses you could say

1838
01:19:14,000 --> 01:19:20,719
the desk is the uh the server

1839
01:19:17,280 --> 01:19:22,000
name or as well as uh the desk could be

1840
01:19:20,719 --> 01:19:23,440
the ip address

1841
01:19:22,000 --> 01:19:25,600
and if we do that and take a look at

1842
01:19:23,440 --> 01:19:28,159
some of the values um there's i'm really

1843
01:19:25,600 --> 01:19:30,280
not batman.com showing up as desk

1844
01:19:28,159 --> 01:19:32,639
file info.file name still showing up at

1845
01:19:30,280 --> 01:19:35,040
37.91

1846
01:19:32,640 --> 01:19:36,000
well you can see in here we also added

1847
01:19:35,040 --> 01:19:38,880
the http

1848
01:19:36,000 --> 01:19:40,640
method of post as part of our search to

1849
01:19:38,880 --> 01:19:43,920
narrow things down

1850
01:19:40,640 --> 01:19:44,719
uh if we actually then wanted to find

1851
01:19:43,920 --> 01:19:47,760
out which ip

1852
01:19:44,719 --> 01:19:50,000
dress sent 3791 we could

1853
01:19:47,760 --> 01:19:51,040
add literally clicking on that we could

1854
01:19:50,000 --> 01:19:52,719
add that parameter

1855
01:19:51,040 --> 01:19:54,159
up into our search and now we're

1856
01:19:52,719 --> 01:19:56,960
searching for

1857
01:19:54,159 --> 01:19:58,400
anything uh that cerakata saw where the

1858
01:19:56,960 --> 01:20:01,120
destination was either

1859
01:19:58,400 --> 01:20:02,000
that url or that ip address the method

1860
01:20:01,120 --> 01:20:04,320
was post

1861
01:20:02,000 --> 01:20:06,000
it wasn't executable and the executables

1862
01:20:04,320 --> 01:20:08,960
name happened to be this

1863
01:20:06,000 --> 01:20:09,840
and guess who it came from yeah no

1864
01:20:08,960 --> 01:20:12,080
surprise there

1865
01:20:09,840 --> 01:20:13,040
40 which was the ip address that logged

1866
01:20:12,080 --> 01:20:15,840
in with that

1867
01:20:13,040 --> 01:20:18,080
legit set of credentials right so not

1868
01:20:15,840 --> 01:20:20,480
really surprised at that

1869
01:20:18,080 --> 01:20:21,199
but it is the second part of the

1870
01:20:20,480 --> 01:20:22,559
challenge

1871
01:20:21,199 --> 01:20:25,440
so we're going to drop that into our

1872
01:20:22,560 --> 01:20:28,239
scoring server 3791 is the answer

1873
01:20:25,440 --> 01:20:29,599
with a bonus of 40 being the source of

1874
01:20:28,239 --> 01:20:31,519
the executable

1875
01:20:29,600 --> 01:20:32,800
and we're going to throw that into our

1876
01:20:31,520 --> 01:20:34,480
documentation

1877
01:20:32,800 --> 01:20:36,400
really good attack picture we're

1878
01:20:34,480 --> 01:20:40,239
building out here all right

1879
01:20:36,400 --> 01:20:41,920
so we know the name of that executable

1880
01:20:40,239 --> 01:20:43,599
let's see if we can figure out the md5

1881
01:20:41,920 --> 01:20:45,760
hash of it now

1882
01:20:43,600 --> 01:20:47,199
if we had a copy of the file this would

1883
01:20:45,760 --> 01:20:48,880
be super easy right

1884
01:20:47,199 --> 01:20:51,199
just drop down the command line and hash

1885
01:20:48,880 --> 01:20:53,040
that puppy or throw it up into a

1886
01:20:51,199 --> 01:20:54,799
one of the many web tools out there that

1887
01:20:53,040 --> 01:20:59,120
will hash things for you

1888
01:20:54,800 --> 01:21:02,639
but we don't we have the name of it

1889
01:20:59,120 --> 01:21:05,360
but file hashes can be found in

1890
01:21:02,639 --> 01:21:07,280
certain data sources uh so if you know

1891
01:21:05,360 --> 01:21:10,880
which ones to look in

1892
01:21:07,280 --> 01:21:12,840
um you'll find it and let me see and i'm

1893
01:21:10,880 --> 01:21:16,480
gonna give you i'm gonna give you a hint

1894
01:21:12,840 --> 01:21:18,880
um so um

1895
01:21:16,480 --> 01:21:20,959
uh one of the log sources that we're

1896
01:21:18,880 --> 01:21:24,239
going to see actually hashes

1897
01:21:20,960 --> 01:21:26,960
uh executables at process execution

1898
01:21:24,239 --> 01:21:28,159
um and what we want is the md5 at

1899
01:21:26,960 --> 01:21:30,000
process launch

1900
01:21:28,159 --> 01:21:31,360
that's that's the md5 that we're looking

1901
01:21:30,000 --> 01:21:33,440
for um

1902
01:21:31,360 --> 01:21:35,120
so the source type that we're working

1903
01:21:33,440 --> 01:21:37,120
with now we're switching gears

1904
01:21:35,120 --> 01:21:39,519
uh we're heading over to the endpoint

1905
01:21:37,120 --> 01:21:41,360
now and we're going to get this out of

1906
01:21:39,520 --> 01:21:44,400
cismod

1907
01:21:41,360 --> 01:21:48,000
uh many of you may know sushman uh and

1908
01:21:44,400 --> 01:21:51,040
and what logs it logs a lot

1909
01:21:48,000 --> 01:21:52,719
um in fact uh i saw a presentation by

1910
01:21:51,040 --> 01:21:54,800
dave kennedy last year

1911
01:21:52,719 --> 01:21:56,719
where he he said they've been using

1912
01:21:54,800 --> 01:21:58,239
sysmon so much that he actually turned

1913
01:21:56,719 --> 01:22:00,080
to his team and said hey

1914
01:21:58,239 --> 01:22:01,360
if we were running an investigation and

1915
01:22:00,080 --> 01:22:04,000
all we had was

1916
01:22:01,360 --> 01:22:04,639
sysmon logs could we figure out what

1917
01:22:04,000 --> 01:22:06,480
happened

1918
01:22:04,639 --> 01:22:08,239
i mean obviously you wouldn't have all

1919
01:22:06,480 --> 01:22:10,000
the evidence that you wanted

1920
01:22:08,239 --> 01:22:11,919
to to take it to court and stuff like

1921
01:22:10,000 --> 01:22:14,000
that i think but could you

1922
01:22:11,920 --> 01:22:15,520
or maybe you would i mean it depends on

1923
01:22:14,000 --> 01:22:17,040
how robust it is

1924
01:22:15,520 --> 01:22:19,280
but you wouldn't have things like

1925
01:22:17,040 --> 01:22:20,080
forensic images of things you'd have to

1926
01:22:19,280 --> 01:22:21,679
create those

1927
01:22:20,080 --> 01:22:23,120
but if all you had in cismon could you

1928
01:22:21,679 --> 01:22:24,560
figure out the incident

1929
01:22:23,120 --> 01:22:26,159
and they could not think of a single

1930
01:22:24,560 --> 01:22:26,960
instance within you know the windows

1931
01:22:26,159 --> 01:22:30,400
world

1932
01:22:26,960 --> 01:22:33,120
uh where if all you had was system on

1933
01:22:30,400 --> 01:22:35,599
you could figure out the attack and

1934
01:22:33,120 --> 01:22:37,760
that's pretty amazing i mean

1935
01:22:35,600 --> 01:22:39,120
i started to wonder could teams actually

1936
01:22:37,760 --> 01:22:41,199
do that like

1937
01:22:39,120 --> 01:22:42,719
dump all the rest of your logs as far as

1938
01:22:41,199 --> 01:22:43,678
security goes get rid of the freaking

1939
01:22:42,719 --> 01:22:46,560
windows

1940
01:22:43,679 --> 01:22:46,880
get rid of av all that stuff and just

1941
01:22:46,560 --> 01:22:50,080
log

1942
01:22:46,880 --> 01:22:50,800
sysmon meaning you only have one log

1943
01:22:50,080 --> 01:22:54,239
source

1944
01:22:50,800 --> 01:22:56,080
to tend to to ensure that it's

1945
01:22:54,239 --> 01:22:57,678
you're getting a you're getting those

1946
01:22:56,080 --> 01:23:01,199
logs and then

1947
01:22:57,679 --> 01:23:02,880
only one data source to fully understand

1948
01:23:01,199 --> 01:23:04,960
i don't know if i'd want to rely just on

1949
01:23:02,880 --> 01:23:06,080
sysmon because this month's got its

1950
01:23:04,960 --> 01:23:08,239
issues too

1951
01:23:06,080 --> 01:23:10,880
but boy that would be a really powerful

1952
01:23:08,239 --> 01:23:14,638
place to start

1953
01:23:10,880 --> 01:23:18,000
um so sysmon does all sorts of things

1954
01:23:14,639 --> 01:23:22,000
like logging process creation

1955
01:23:18,000 --> 01:23:24,320
which is really good for malware um uh

1956
01:23:22,000 --> 01:23:26,400
investigations network connections

1957
01:23:24,320 --> 01:23:28,320
awesome drivers that are loaded file

1958
01:23:26,400 --> 01:23:32,159
creations registry events

1959
01:23:28,320 --> 01:23:35,120
the list keeps going um so

1960
01:23:32,159 --> 01:23:37,280
uh if you if you don't know infosec

1961
01:23:35,120 --> 01:23:39,920
taylor swift by now and you should

1962
01:23:37,280 --> 01:23:40,320
um swift on security has a great blog

1963
01:23:39,920 --> 01:23:43,600
and

1964
01:23:40,320 --> 01:23:47,759
script on uh helping you configure

1965
01:23:43,600 --> 01:23:50,800
uh sysmon for uh for

1966
01:23:47,760 --> 01:23:53,600
particularly focused on malware but

1967
01:23:50,800 --> 01:23:55,360
on security and it's a great resource

1968
01:23:53,600 --> 01:23:58,639
another good resource

1969
01:23:55,360 --> 01:24:02,320
for endpoint logging

1970
01:23:58,639 --> 01:24:04,320
is a website called malware archaeology

1971
01:24:02,320 --> 01:24:06,559
they have cheat sheets for all operating

1972
01:24:04,320 --> 01:24:08,480
systems and what you'd want to log

1973
01:24:06,560 --> 01:24:11,600
specifically focused on

1974
01:24:08,480 --> 01:24:13,519
malware and malware detection which is

1975
01:24:11,600 --> 01:24:15,199
great because windows is noisy as hell

1976
01:24:13,520 --> 01:24:18,800
you don't want to log

1977
01:24:15,199 --> 01:24:20,159
everything that windows logs

1978
01:24:18,800 --> 01:24:22,320
you don't want to pull that all into

1979
01:24:20,159 --> 01:24:22,960
your index there's a lot of noise out

1980
01:24:22,320 --> 01:24:24,320
there

1981
01:24:22,960 --> 01:24:27,120
you want to stick with just what's

1982
01:24:24,320 --> 01:24:31,840
relevant those are two great resources

1983
01:24:27,120 --> 01:24:31,840
to figure out just what's relevant

1984
01:24:57,840 --> 01:24:59,920
you

1985
01:26:21,760 --> 01:26:23,840
you

1986
01:26:51,520 --> 01:26:56,480
okay hopefully that was enough time for

1987
01:26:53,440 --> 01:26:59,759
you guys to find that hash

1988
01:26:56,480 --> 01:27:01,599
um i'm gonna change

1989
01:26:59,760 --> 01:27:05,360
my display a little bit here tell me if

1990
01:27:01,600 --> 01:27:08,400
you'll lose my uh presentation

1991
01:27:05,360 --> 01:27:08,400
um i'm just gonna

1992
01:27:10,480 --> 01:27:19,839
yeah yeah hold on i'll reshare it out

1993
01:27:25,280 --> 01:27:33,840
come on

1994
01:27:39,360 --> 01:27:43,120
all right hopefully you guys can see

1995
01:27:42,159 --> 01:27:44,960
that if you don't

1996
01:27:43,120 --> 01:27:46,559
hit me in the text otherwise i'll assume

1997
01:27:44,960 --> 01:27:49,920
we're good

1998
01:27:46,560 --> 01:27:53,600
and so looking for

1999
01:27:49,920 --> 01:27:57,040
hashes um sysmon was definitely the clue

2000
01:27:53,600 --> 01:28:00,320
and we also know which uh executable

2001
01:27:57,040 --> 01:28:02,239
that we need to hone down on right 3791

2002
01:28:00,320 --> 01:28:03,360
is what we need to find the hash of so

2003
01:28:02,239 --> 01:28:05,599
it can be part of your search

2004
01:28:03,360 --> 01:28:06,960
it's the information you know and we

2005
01:28:05,600 --> 01:28:08,800
know that um

2006
01:28:06,960 --> 01:28:10,080
sysmon is going to be the place where

2007
01:28:08,800 --> 01:28:13,600
we're going to go looking

2008
01:28:10,080 --> 01:28:14,960
so just doing that if we take a look at

2009
01:28:13,600 --> 01:28:16,400
event description

2010
01:28:14,960 --> 01:28:18,080
um which is going to be the windows

2011
01:28:16,400 --> 01:28:20,320
event since this month's picking up

2012
01:28:18,080 --> 01:28:22,559
uh with that syspawn is picking up we're

2013
01:28:20,320 --> 01:28:23,920
seeing uh some great stuff here so image

2014
01:28:22,560 --> 01:28:25,600
load process create

2015
01:28:23,920 --> 01:28:28,960
network connect yeah we're on the right

2016
01:28:25,600 --> 01:28:31,040
track and if we scroll all the way down

2017
01:28:28,960 --> 01:28:32,159
uh we'll see uh in the interesting

2018
01:28:31,040 --> 01:28:36,159
fields we'll see

2019
01:28:32,159 --> 01:28:39,519
the uh the hashes um and uh

2020
01:28:36,159 --> 01:28:40,879
and uh those actually it's just not just

2021
01:28:39,520 --> 01:28:46,000
md5 right we see

2022
01:28:40,880 --> 01:28:46,000
sean sha-1 sha-256 so on and so forth

2023
01:28:46,960 --> 01:28:53,600
so uh so narrowing that down um

2024
01:28:50,400 --> 01:28:55,839
we're we're going to focus on

2025
01:28:53,600 --> 01:28:56,960
the command line because what we want is

2026
01:28:55,840 --> 01:29:00,480
the hash

2027
01:28:56,960 --> 01:29:02,639
that sysmon created as part when they

2028
01:29:00,480 --> 01:29:03,599
when our malicious executable actually

2029
01:29:02,639 --> 01:29:06,080
executed

2030
01:29:03,600 --> 01:29:06,880
so we do have command line in here

2031
01:29:06,080 --> 01:29:09,040
that's awesome

2032
01:29:06,880 --> 01:29:10,960
as well as parent command line this is

2033
01:29:09,040 --> 01:29:14,239
great because now you can actually see

2034
01:29:10,960 --> 01:29:16,080
execution chains if you have you know

2035
01:29:14,239 --> 01:29:17,599
trojans or so trojan downloaders or

2036
01:29:16,080 --> 01:29:19,840
something like that um

2037
01:29:17,600 --> 01:29:21,360
that one thing kicks off another thing

2038
01:29:19,840 --> 01:29:22,960
which then kicks off another thing which

2039
01:29:21,360 --> 01:29:23,519
kicks off an embedded process in

2040
01:29:22,960 --> 01:29:25,520
something

2041
01:29:23,520 --> 01:29:26,719
this uh this is a great way to follow

2042
01:29:25,520 --> 01:29:28,800
execution chains

2043
01:29:26,719 --> 01:29:30,320
just by throwing command line and

2044
01:29:28,800 --> 01:29:31,280
apparent command line results into a

2045
01:29:30,320 --> 01:29:35,080
table

2046
01:29:31,280 --> 01:29:36,239
um but if we uh we just take a look at

2047
01:29:35,080 --> 01:29:39,040
3791

2048
01:29:36,239 --> 01:29:40,239
then uh where we're taking a look at

2049
01:29:39,040 --> 01:29:42,960
this this month's stuff

2050
01:29:40,239 --> 01:29:44,718
and now you kind of have to know this

2051
01:29:42,960 --> 01:29:47,600
right so knowing your data source

2052
01:29:44,719 --> 01:29:49,440
event code equal one is that execution

2053
01:29:47,600 --> 01:29:49,840
so we're looking for the event code

2054
01:29:49,440 --> 01:29:53,599
equal

2055
01:29:49,840 --> 01:29:55,840
one to get the correct hash um

2056
01:29:53,600 --> 01:29:58,159
and if we take a look at the md5 values

2057
01:29:55,840 --> 01:29:58,960
uh we're seeing uh that we definitely

2058
01:29:58,159 --> 01:30:00,960
have them

2059
01:29:58,960 --> 01:30:03,600
um we see that there's a couple things

2060
01:30:00,960 --> 01:30:06,400
uh for the results of command line here

2061
01:30:03,600 --> 01:30:07,280
um including cmd.exe which should be

2062
01:30:06,400 --> 01:30:10,879
expected

2063
01:30:07,280 --> 01:30:11,759
um but with um with just this search in

2064
01:30:10,880 --> 01:30:15,040
place

2065
01:30:11,760 --> 01:30:17,120
if we scroll down a bit and then

2066
01:30:15,040 --> 01:30:19,040
take a look in one of the events right

2067
01:30:17,120 --> 01:30:21,840
here we'll see

2068
01:30:19,040 --> 01:30:23,280
the the event where 3791 what is what

2069
01:30:21,840 --> 01:30:24,719
was run from the command line we also

2070
01:30:23,280 --> 01:30:28,320
see it right up here in the

2071
01:30:24,719 --> 01:30:30,639
in the raw logs and the hash

2072
01:30:28,320 --> 01:30:31,679
for that command line execution so that

2073
01:30:30,639 --> 01:30:34,080
hash right there

2074
01:30:31,679 --> 01:30:36,080
that's the hash we're looking for again

2075
01:30:34,080 --> 01:30:38,080
we see some other ones as well

2076
01:30:36,080 --> 01:30:40,400
but it was the md5 that was part of the

2077
01:30:38,080 --> 01:30:42,400
challenge

2078
01:30:40,400 --> 01:30:44,559
so and we can even if we need to extract

2079
01:30:42,400 --> 01:30:47,040
that out we can throw that in the stats

2080
01:30:44,560 --> 01:30:48,080
and have it give us the values of that

2081
01:30:47,040 --> 01:30:50,560
field

2082
01:30:48,080 --> 01:30:52,080
that might make it easier to copy and

2083
01:30:50,560 --> 01:30:53,520
paste

2084
01:30:52,080 --> 01:30:54,960
but we throw that into our scoring

2085
01:30:53,520 --> 01:30:56,159
server we throw that into our

2086
01:30:54,960 --> 01:30:59,040
documentation

2087
01:30:56,159 --> 01:31:01,599
and we throw that into our very awesome

2088
01:30:59,040 --> 01:31:04,239
attack picture that we're building out

2089
01:31:01,600 --> 01:31:06,159
so great job again you guys are rocking

2090
01:31:04,239 --> 01:31:10,718
it

2091
01:31:06,159 --> 01:31:14,320
um so uh once uh once our attacker

2092
01:31:10,719 --> 01:31:16,159
got in uploaded their tools

2093
01:31:14,320 --> 01:31:17,840
we know that the end result of this

2094
01:31:16,159 --> 01:31:19,440
attack was that they defaced i'm really

2095
01:31:17,840 --> 01:31:22,480
not batman.com

2096
01:31:19,440 --> 01:31:25,440
um when an attacker uh

2097
01:31:22,480 --> 01:31:27,199
defaces a website do they bother putting

2098
01:31:25,440 --> 01:31:28,879
in a whole content management system

2099
01:31:27,199 --> 01:31:32,719
with a whole bunch of css

2100
01:31:28,880 --> 01:31:35,840
and no they don't they basically just

2101
01:31:32,719 --> 01:31:39,920
put an image up that's gonna be

2102
01:31:35,840 --> 01:31:42,239
uh at the root of uh of that server

2103
01:31:39,920 --> 01:31:43,600
um as the first thing that people see

2104
01:31:42,239 --> 01:31:46,000
when they go to i'm really not

2105
01:31:43,600 --> 01:31:48,239
batman.com right

2106
01:31:46,000 --> 01:31:50,000
so uh so we want the name of the file

2107
01:31:48,239 --> 01:31:52,320
that was used for the defacement

2108
01:31:50,000 --> 01:31:53,360
it's going to be an image file of some

2109
01:31:52,320 --> 01:31:56,960
sort

2110
01:31:53,360 --> 01:32:00,559
um if you have a hard time finding it

2111
01:31:56,960 --> 01:32:04,000
it may be because now the

2112
01:32:00,560 --> 01:32:08,080
direction of activity may be reversed

2113
01:32:04,000 --> 01:32:10,080
right so when is a server not a server

2114
01:32:08,080 --> 01:32:12,000
just because you call a server a server

2115
01:32:10,080 --> 01:32:15,199
doesn't mean it's always acting like a

2116
01:32:12,000 --> 01:32:17,760
server right sometimes servers act like

2117
01:32:15,199 --> 01:32:19,678
clients especially when people do stupid

2118
01:32:17,760 --> 01:32:20,800
things on them or malicious things on

2119
01:32:19,679 --> 01:32:24,000
them

2120
01:32:20,800 --> 01:32:25,199
so remember uh directionality and how

2121
01:32:24,000 --> 01:32:29,040
directionality

2122
01:32:25,199 --> 01:32:32,000
affects post versus gets

2123
01:32:29,040 --> 01:32:33,600
and that if you get stuck that should

2124
01:32:32,000 --> 01:32:37,090
help you

2125
01:32:33,600 --> 01:32:38,840
find what you're looking for

2126
01:32:37,090 --> 01:32:41,120
[Music]

2127
01:32:38,840 --> 01:32:43,360
so

2128
01:32:41,120 --> 01:32:44,719
you're looking basically for the file

2129
01:32:43,360 --> 01:32:47,599
that was transferred to i'm really not

2130
01:32:44,719 --> 01:32:47,600
batman.com

2131
01:32:48,239 --> 01:32:54,480
knowing where it came from will help you

2132
01:32:50,639 --> 01:32:56,159
you know where it came from

2133
01:32:54,480 --> 01:32:58,638
or you know one of the places it might

2134
01:32:56,159 --> 01:32:58,638
have come from

2135
01:32:59,840 --> 01:33:09,840
i'll give you just a minute or so

2136
01:33:03,280 --> 01:33:09,840
to get to the answer

2137
01:34:31,120 --> 01:34:34,480
all right guys if anybody needs another

2138
01:34:32,800 --> 01:34:37,760
minute let me know in the chat otherwise

2139
01:34:34,480 --> 01:34:37,759
we'll dig through our answer here

2140
01:34:39,520 --> 01:34:43,119
cool all right let's dig into it

2141
01:34:43,520 --> 01:34:47,760
uh so we can uh we can start uh our

2142
01:34:46,239 --> 01:34:50,159
search

2143
01:34:47,760 --> 01:34:50,800
looking you know if we if we presume

2144
01:34:50,159 --> 01:34:53,280
that uh

2145
01:34:50,800 --> 01:34:54,480
the activity may look similar to other

2146
01:34:53,280 --> 01:34:56,320
stuff that we've seen

2147
01:34:54,480 --> 01:34:58,320
uh we could take a look at um you know

2148
01:34:56,320 --> 01:35:01,759
what was heading over to our server

2149
01:34:58,320 --> 01:35:04,880
uh in the sir catalogs um

2150
01:35:01,760 --> 01:35:07,840
but where um uh

2151
01:35:04,880 --> 01:35:09,360
70 is the source versus 70 is the

2152
01:35:07,840 --> 01:35:12,960
destination

2153
01:35:09,360 --> 01:35:16,400
yeah not seen a whole lot

2154
01:35:12,960 --> 01:35:18,480
here um we can take a look at the

2155
01:35:16,400 --> 01:35:20,559
destination ip

2156
01:35:18,480 --> 01:35:22,559
um and for some of you that have been

2157
01:35:20,560 --> 01:35:24,239
doing this a while

2158
01:35:22,560 --> 01:35:26,080
again your spicy scent should be

2159
01:35:24,239 --> 01:35:26,879
tingling right now this is not the

2160
01:35:26,080 --> 01:35:30,239
results

2161
01:35:26,880 --> 01:35:33,360
i would expect for destination ip

2162
01:35:30,239 --> 01:35:33,360
with this search

2163
01:35:33,440 --> 01:35:40,638
um we can take a look into

2164
01:35:36,960 --> 01:35:42,239
we pivot into destination ip addresses

2165
01:35:40,639 --> 01:35:43,679
and take a look at the urls that they

2166
01:35:42,239 --> 01:35:47,440
were hitting so

2167
01:35:43,679 --> 01:35:50,480
23 definitely one of our suspects here

2168
01:35:47,440 --> 01:35:53,599
and uh and if we take a look at it

2169
01:35:50,480 --> 01:35:56,638
um yeah wow

2170
01:35:53,600 --> 01:35:57,360
what do we have here really we have some

2171
01:35:56,639 --> 01:36:00,320
very

2172
01:35:57,360 --> 01:36:02,239
bizarre well certainly should be against

2173
01:36:00,320 --> 01:36:04,000
policy traffic

2174
01:36:02,239 --> 01:36:06,320
so we break this traffic down a little

2175
01:36:04,000 --> 01:36:09,199
bit right um

2176
01:36:06,320 --> 01:36:11,360
if uh if we have a client talking to our

2177
01:36:09,199 --> 01:36:14,000
server it's usually going to do a get

2178
01:36:11,360 --> 01:36:14,960
right now we saw it do posts with the

2179
01:36:14,000 --> 01:36:17,679
passwords

2180
01:36:14,960 --> 01:36:18,239
and we saw it do a post when it pushed a

2181
01:36:17,679 --> 01:36:20,719
file

2182
01:36:18,239 --> 01:36:23,678
up to i'm really not batman.com but

2183
01:36:20,719 --> 01:36:27,040
that's not what actually happened here

2184
01:36:23,679 --> 01:36:30,560
what happened here instead is

2185
01:36:27,040 --> 01:36:34,320
our web server talked

2186
01:36:30,560 --> 01:36:37,600
to that 23 address

2187
01:36:34,320 --> 01:36:39,119
how often should web servers start a

2188
01:36:37,600 --> 01:36:42,320
conversation

2189
01:36:39,119 --> 01:36:43,679
yeah this is bad in fact creating an

2190
01:36:42,320 --> 01:36:46,799
alert

2191
01:36:43,679 --> 01:36:49,760
literally just for this for

2192
01:36:46,800 --> 01:36:52,320
anytime our server is the source of a

2193
01:36:49,760 --> 01:36:55,199
conversation

2194
01:36:52,320 --> 01:36:56,080
to the outside now sometimes based on

2195
01:36:55,199 --> 01:36:58,080
travel patterns

2196
01:36:56,080 --> 01:37:00,880
weird things could possibly generate

2197
01:36:58,080 --> 01:37:02,239
this it's not very common

2198
01:37:00,880 --> 01:37:04,800
and i would definitely want to be

2199
01:37:02,239 --> 01:37:06,718
alerting on any time a web server

2200
01:37:04,800 --> 01:37:09,440
is initiating a conversation to the

2201
01:37:06,719 --> 01:37:11,679
outside world now

2202
01:37:09,440 --> 01:37:12,719
more often than not it's probably just

2203
01:37:11,679 --> 01:37:15,679
an admin

2204
01:37:12,719 --> 01:37:16,719
not adhering to policy and downloading a

2205
01:37:15,679 --> 01:37:18,960
patch or a

2206
01:37:16,719 --> 01:37:20,239
library or something like that but right

2207
01:37:18,960 --> 01:37:23,280
andy patrick thank you

2208
01:37:20,239 --> 01:37:27,199
never never never never never um

2209
01:37:23,280 --> 01:37:29,679
so um yeah this this shouldn't happen

2210
01:37:27,199 --> 01:37:31,919
um and and this can be a bit of logic

2211
01:37:29,679 --> 01:37:35,360
that it would be make for a great

2212
01:37:31,920 --> 01:37:38,560
um alert that you would set up um

2213
01:37:35,360 --> 01:37:39,440
so we take a look at uh cerakata versus

2214
01:37:38,560 --> 01:37:41,760
stream

2215
01:37:39,440 --> 01:37:44,638
uh we see cerakadas picking up on some

2216
01:37:41,760 --> 01:37:46,560
similar stuff there too

2217
01:37:44,639 --> 01:37:48,480
one of the things that we see coming

2218
01:37:46,560 --> 01:37:52,239
across the wire is

2219
01:37:48,480 --> 01:37:56,400
when when our server is the source of

2220
01:37:52,239 --> 01:37:58,959
http traffic is some xml and a jpeg

2221
01:37:56,400 --> 01:38:00,320
uh so poison ivy and a jpeg that's

2222
01:37:58,960 --> 01:38:02,080
conveniently named with a very

2223
01:38:00,320 --> 01:38:04,239
suspicious name uh

2224
01:38:02,080 --> 01:38:05,280
so that should jump out at you right

2225
01:38:04,239 --> 01:38:08,638
away

2226
01:38:05,280 --> 01:38:10,400
as uh as our probable malicious

2227
01:38:08,639 --> 01:38:12,560
file let's take a look at some other

2228
01:38:10,400 --> 01:38:14,559
things too so what about our firewall

2229
01:38:12,560 --> 01:38:17,679
data what does it show as far as

2230
01:38:14,560 --> 01:38:20,000
uh this traffic goes if we pop our dot

2231
01:38:17,679 --> 01:38:23,679
70 address up into there

2232
01:38:20,000 --> 01:38:27,040
and take a look at uh the source

2233
01:38:23,679 --> 01:38:29,600
results we see our external servers

2234
01:38:27,040 --> 01:38:31,679
talking to our server but we also see

2235
01:38:29,600 --> 01:38:33,440
some of the reser reverse we see our

2236
01:38:31,679 --> 01:38:36,000
server talking to

2237
01:38:33,440 --> 01:38:37,678
several external ip addresses including

2238
01:38:36,000 --> 01:38:41,040
23 out there

2239
01:38:37,679 --> 01:38:44,080
um if we were doing a

2240
01:38:41,040 --> 01:38:45,920
a summation of inbound traffic versus

2241
01:38:44,080 --> 01:38:47,119
outbound traffic uh we could do

2242
01:38:45,920 --> 01:38:49,600
something like this and

2243
01:38:47,119 --> 01:38:50,159
and this outbound traffic with only nine

2244
01:38:49,600 --> 01:38:52,239
events

2245
01:38:50,159 --> 01:38:53,519
would certainly be far more suspicious

2246
01:38:52,239 --> 01:38:57,199
to me um

2247
01:38:53,520 --> 01:39:00,639
than these uh 14 000 events where

2248
01:38:57,199 --> 01:39:03,199
our server was the destination of some

2249
01:39:00,639 --> 01:39:06,800
traffic not the source of some traffic

2250
01:39:03,199 --> 01:39:10,360
on the firewall and oh hey wow

2251
01:39:06,800 --> 01:39:12,880
our our awesome next-gen firewall also

2252
01:39:10,360 --> 01:39:14,719
categorized some of that traffic as

2253
01:39:12,880 --> 01:39:17,440
malicious websites

2254
01:39:14,719 --> 01:39:19,520
now i'm guessing we had it in observe

2255
01:39:17,440 --> 01:39:21,839
only mode and not block mode

2256
01:39:19,520 --> 01:39:23,600
otherwise our attacker would not have

2257
01:39:21,840 --> 01:39:24,639
been able to reach out and grab that

2258
01:39:23,600 --> 01:39:28,320
jpeg

2259
01:39:24,639 --> 01:39:29,119
um so the the next gen firewall knew

2260
01:39:28,320 --> 01:39:31,280
about

2261
01:39:29,119 --> 01:39:33,839
this stuff being malicious but doesn't

2262
01:39:31,280 --> 01:39:36,239
look like it got blocked

2263
01:39:33,840 --> 01:39:37,840
and if we leverage that category and

2264
01:39:36,239 --> 01:39:38,239
actually take a look then in the logs

2265
01:39:37,840 --> 01:39:42,080
where

2266
01:39:38,239 --> 01:39:42,559
hey tell us about anything involving.70

2267
01:39:42,080 --> 01:39:45,199
on the

2268
01:39:42,560 --> 01:39:46,800
you know next-gen firewall where 70 was

2269
01:39:45,199 --> 01:39:49,599
not the destination

2270
01:39:46,800 --> 01:39:51,360
and the category was most just websites

2271
01:39:49,600 --> 01:39:53,679
and we take a look at the files then

2272
01:39:51,360 --> 01:39:54,799
there's some fields with files in them

2273
01:39:53,679 --> 01:39:57,520
um

2274
01:39:54,800 --> 01:39:58,600
this file underscore path has poison ivs

2275
01:39:57,520 --> 01:40:01,760
coming for you

2276
01:39:58,600 --> 01:40:03,679
batman.jpg as well yeah i think we've

2277
01:40:01,760 --> 01:40:05,440
proved you know five ways to sunday that

2278
01:40:03,679 --> 01:40:07,280
that's our malicious file we're gonna

2279
01:40:05,440 --> 01:40:09,678
drop that into our scoring server

2280
01:40:07,280 --> 01:40:11,280
into our documentation oh my god look at

2281
01:40:09,679 --> 01:40:12,239
look at how good this is all looking you

2282
01:40:11,280 --> 01:40:14,480
guys are going to get

2283
01:40:12,239 --> 01:40:16,879
medals for how good your documentation

2284
01:40:14,480 --> 01:40:16,879
is here

2285
01:40:16,960 --> 01:40:22,880
so um

2286
01:40:20,400 --> 01:40:24,638
cool so um so this next one uh we're

2287
01:40:22,880 --> 01:40:25,520
switching gears again and taking a look

2288
01:40:24,639 --> 01:40:29,119
at some dns

2289
01:40:25,520 --> 01:40:30,639
stuff dns is usually a great data source

2290
01:40:29,119 --> 01:40:33,199
to go hunting for evil

2291
01:40:30,639 --> 01:40:34,320
in general attackers tend to leave their

2292
01:40:33,199 --> 01:40:36,879
fingerprints

2293
01:40:34,320 --> 01:40:37,679
in dns quite often and they like to use

2294
01:40:36,880 --> 01:40:39,199
dns

2295
01:40:37,679 --> 01:40:41,440
for lots of things for command and

2296
01:40:39,199 --> 01:40:45,199
control for data x fill

2297
01:40:41,440 --> 01:40:48,559
because it's usually wide open and often

2298
01:40:45,199 --> 01:40:51,519
more often than not uh logged

2299
01:40:48,560 --> 01:40:52,159
at least not the actual traffic itself i

2300
01:40:51,520 --> 01:40:55,440
mean the

2301
01:40:52,159 --> 01:40:58,638
dns servers may have some logging um

2302
01:40:55,440 --> 01:41:00,960
by the way if you don't know this um

2303
01:40:58,639 --> 01:41:02,159
for an investigation you always want

2304
01:41:00,960 --> 01:41:05,600
both the query

2305
01:41:02,159 --> 01:41:09,040
and the response for dns queries

2306
01:41:05,600 --> 01:41:12,239
by default windows dns servers

2307
01:41:09,040 --> 01:41:15,440
um if you're logging them at all

2308
01:41:12,239 --> 01:41:18,080
will only log the request not the answer

2309
01:41:15,440 --> 01:41:18,638
and to get the answer you have to put

2310
01:41:18,080 --> 01:41:22,320
them

2311
01:41:18,639 --> 01:41:23,840
in debug mode which is absolutely

2312
01:41:22,320 --> 01:41:25,519
horrible you don't

2313
01:41:23,840 --> 01:41:26,960
if you uh if you want to capture dns

2314
01:41:25,520 --> 01:41:27,600
traffic i don't think you want to put

2315
01:41:26,960 --> 01:41:30,000
your

2316
01:41:27,600 --> 01:41:31,280
windows domain servers or whoever's

2317
01:41:30,000 --> 01:41:35,119
serving up dns

2318
01:41:31,280 --> 01:41:36,080
in debug mode so easiest way to capture

2319
01:41:35,119 --> 01:41:38,320
this stuff again

2320
01:41:36,080 --> 01:41:40,320
is right off the stream just throw a tap

2321
01:41:38,320 --> 01:41:43,119
right in front of your name servers

2322
01:41:40,320 --> 01:41:44,480
um put something that's just capturing

2323
01:41:43,119 --> 01:41:47,040
what's relevant

2324
01:41:44,480 --> 01:41:48,159
to what you need so protocol dns maybe

2325
01:41:47,040 --> 01:41:50,400
just the q record

2326
01:41:48,159 --> 01:41:51,599
you know the a records and the responses

2327
01:41:50,400 --> 01:41:54,719
or something like that

2328
01:41:51,600 --> 01:41:55,199
um but uh over this one we're trying to

2329
01:41:54,719 --> 01:41:58,239
find

2330
01:41:55,199 --> 01:42:02,239
the fully qualified domain name um

2331
01:41:58,239 --> 01:42:04,080
that was used uh for uh

2332
01:42:02,239 --> 01:42:05,440
that basically the previous attack that

2333
01:42:04,080 --> 01:42:07,440
the malicious ip

2334
01:42:05,440 --> 01:42:08,799
uh basically that where that file came

2335
01:42:07,440 --> 01:42:10,799
from so what you're looking for

2336
01:42:08,800 --> 01:42:13,520
is the answer to this you're you know

2337
01:42:10,800 --> 01:42:17,280
i'm poisonous coming from batman.com

2338
01:42:13,520 --> 01:42:18,639
was pulled onto our server so they

2339
01:42:17,280 --> 01:42:20,400
they've got control of our server

2340
01:42:18,639 --> 01:42:21,040
they're now surfing the web with our

2341
01:42:20,400 --> 01:42:24,080
server

2342
01:42:21,040 --> 01:42:24,800
they surfed to their own um you know

2343
01:42:24,080 --> 01:42:28,000
stuff to

2344
01:42:24,800 --> 01:42:30,719
get that file and pull it down uh

2345
01:42:28,000 --> 01:42:32,080
the ip address was 23 dot we want to

2346
01:42:30,719 --> 01:42:35,360
know what the fqdn

2347
01:42:32,080 --> 01:42:38,880
of that 23 address where that

2348
01:42:35,360 --> 01:42:39,839
jpeg came from is so this one should be

2349
01:42:38,880 --> 01:42:41,040
easy for you guys

2350
01:42:39,840 --> 01:42:57,840
so i'll give you a minute or two and

2351
01:42:41,040 --> 01:42:57,840
then we'll go into the answer

2352
01:44:10,480 --> 01:44:13,759
okay hopefully that was enough time for

2353
01:44:12,639 --> 01:44:15,280
you guys to

2354
01:44:13,760 --> 01:44:17,600
get the answer you should have been able

2355
01:44:15,280 --> 01:44:18,239
to use uh some of the results you found

2356
01:44:17,600 --> 01:44:20,239
from

2357
01:44:18,239 --> 01:44:22,959
our previous couple searches there so

2358
01:44:20,239 --> 01:44:26,638
let's take a look

2359
01:44:22,960 --> 01:44:29,679
um so yeah using literally

2360
01:44:26,639 --> 01:44:32,239
the res the same results you just found

2361
01:44:29,679 --> 01:44:34,719
um from our previous search if you had

2362
01:44:32,239 --> 01:44:37,519
gone into uh some of the events

2363
01:44:34,719 --> 01:44:39,800
themselves into the raw events

2364
01:44:37,520 --> 01:44:42,000
looking for poison ivy is coming for you

2365
01:44:39,800 --> 01:44:44,000
batman.jpg as the file

2366
01:44:42,000 --> 01:44:45,119
in that same event you're going to see

2367
01:44:44,000 --> 01:44:48,719
the url

2368
01:44:45,119 --> 01:44:53,519
for the 23 address so um looks like

2369
01:44:48,719 --> 01:44:57,199
prank glassine bracket.jumpingcrab.com

2370
01:44:53,520 --> 01:45:00,719
um with an awesome port to connect to

2371
01:44:57,199 --> 01:45:04,000
because they're so freaking late and

2372
01:45:00,719 --> 01:45:05,920
that jpeg there um so

2373
01:45:04,000 --> 01:45:08,719
uh just confirming this a little bit so

2374
01:45:05,920 --> 01:45:11,679
what data sets actually saw this file

2375
01:45:08,719 --> 01:45:13,280
if we actually put that string in the

2376
01:45:11,679 --> 01:45:13,760
string that represents that file name in

2377
01:45:13,280 --> 01:45:15,360
there

2378
01:45:13,760 --> 01:45:17,760
and any results are coming back from it

2379
01:45:15,360 --> 01:45:20,320
with quotes around it just to make sure

2380
01:45:17,760 --> 01:45:20,960
um and that destination and and our

2381
01:45:20,320 --> 01:45:23,280
source

2382
01:45:20,960 --> 01:45:24,560
of our server will see that it was seen

2383
01:45:23,280 --> 01:45:30,000
both in stream

2384
01:45:24,560 --> 01:45:34,159
and in fortigate um firewall itself

2385
01:45:30,000 --> 01:45:36,239
we can then limit uh by the source type

2386
01:45:34,159 --> 01:45:37,599
and take a look at our http traffic

2387
01:45:36,239 --> 01:45:40,480
where that exists

2388
01:45:37,600 --> 01:45:41,920
and if we scroll down and we find the

2389
01:45:40,480 --> 01:45:44,159
urls

2390
01:45:41,920 --> 01:45:45,280
there it is right in the url showing up

2391
01:45:44,159 --> 01:45:47,920
again

2392
01:45:45,280 --> 01:45:48,480
um if you didn't have the file name

2393
01:45:47,920 --> 01:45:51,679
itself

2394
01:45:48,480 --> 01:45:54,239
but wanted to to actually see if you

2395
01:45:51,679 --> 01:45:57,280
figure out the the url of your attacker

2396
01:45:54,239 --> 01:45:59,839
you could also i told you that

2397
01:45:57,280 --> 01:46:01,679
stream breaks down uh the packet

2398
01:45:59,840 --> 01:46:04,480
captures into different indexes

2399
01:46:01,679 --> 01:46:05,920
there's a separate index for dns and we

2400
01:46:04,480 --> 01:46:09,199
can leverage

2401
01:46:05,920 --> 01:46:10,159
that as our source type and then just

2402
01:46:09,199 --> 01:46:12,638
exposing

2403
01:46:10,159 --> 01:46:13,360
the values of the name basically the

2404
01:46:12,639 --> 01:46:16,880
name

2405
01:46:13,360 --> 01:46:21,360
that's being resolved um we'll find uh

2406
01:46:16,880 --> 01:46:21,360
that uh 23 address

2407
01:46:21,920 --> 01:46:25,040
so we can throw that into our scoring

2408
01:46:23,440 --> 01:46:28,159
server um

2409
01:46:25,040 --> 01:46:30,080
and uh detecting dynamic dns

2410
01:46:28,159 --> 01:46:32,159
uh is something we've blogged about

2411
01:46:30,080 --> 01:46:34,960
before um

2412
01:46:32,159 --> 01:46:35,839
it can be really helpful uh and we lay

2413
01:46:34,960 --> 01:46:39,199
it out

2414
01:46:35,840 --> 01:46:43,840
uh in detail in uh in in our blog posts

2415
01:46:39,199 --> 01:46:46,480
so um read when you've got a chance

2416
01:46:43,840 --> 01:46:48,080
uh but we're gonna add that to um our

2417
01:46:46,480 --> 01:46:51,440
tagger they're obviously

2418
01:46:48,080 --> 01:46:53,360
now able to move on their actions on

2419
01:46:51,440 --> 01:46:54,000
objectives which was to deface our web

2420
01:46:53,360 --> 01:46:56,960
server

2421
01:46:54,000 --> 01:47:00,239
which they now have successfully done by

2422
01:46:56,960 --> 01:47:00,239
loading up that jpeg

2423
01:47:00,400 --> 01:47:08,000
add that into our attack picture as well

2424
01:47:04,400 --> 01:47:10,960
uh okay so um we're going to start

2425
01:47:08,000 --> 01:47:12,400
trying to fingerprint our attacker as

2426
01:47:10,960 --> 01:47:14,960
well

2427
01:47:12,400 --> 01:47:16,960
and we're going to move to some open

2428
01:47:14,960 --> 01:47:18,159
source tools right not not everything

2429
01:47:16,960 --> 01:47:19,119
that you need to know about your

2430
01:47:18,159 --> 01:47:21,839
attacker

2431
01:47:19,119 --> 01:47:24,080
is going to be in splunk but you sure

2432
01:47:21,840 --> 01:47:26,719
can use what you learned in splunk

2433
01:47:24,080 --> 01:47:28,000
to start identifying your attacker's

2434
01:47:26,719 --> 01:47:32,239
infrastructure to start

2435
01:47:28,000 --> 01:47:35,199
figuring out what else they have staged

2436
01:47:32,239 --> 01:47:38,080
as part of their attack so i want you to

2437
01:47:35,199 --> 01:47:41,040
find what ip addresses poison ivy

2438
01:47:38,080 --> 01:47:43,119
uh tied to domains that are pre-staged

2439
01:47:41,040 --> 01:47:46,800
to attack wayne enterprises

2440
01:47:43,119 --> 01:47:49,759
um and what additional domains were tied

2441
01:47:46,800 --> 01:47:51,119
to that ip address so you're going to

2442
01:47:49,760 --> 01:47:54,159
leverage things like

2443
01:47:51,119 --> 01:47:55,119
virustotal and threat crowd to start

2444
01:47:54,159 --> 01:47:59,199
taking a look

2445
01:47:55,119 --> 01:48:00,400
at the domain to ip address associations

2446
01:47:59,199 --> 01:48:03,280
that are out there

2447
01:48:00,400 --> 01:48:04,239
based on what you already know about our

2448
01:48:03,280 --> 01:48:06,960
attacker

2449
01:48:04,239 --> 01:48:08,239
so you're gonna surf out to firestone

2450
01:48:06,960 --> 01:48:11,679
threat crowd

2451
01:48:08,239 --> 01:48:12,480
use what you know right you got that 23

2452
01:48:11,679 --> 01:48:16,719
address

2453
01:48:12,480 --> 01:48:20,000
you've got that domain name um

2454
01:48:16,719 --> 01:48:25,280
this uh this pranking

2455
01:48:20,000 --> 01:48:27,840
glass scene bracket.jumpingcrab.com

2456
01:48:25,280 --> 01:48:30,000
um we've got that going for you that's

2457
01:48:27,840 --> 01:48:32,719
bits of information that you can use

2458
01:48:30,000 --> 01:48:47,840
to fingerprint your attacker using

2459
01:48:32,719 --> 01:48:47,840
things like virustotal and threat crowd

2460
01:50:18,080 --> 01:50:21,760
all right hopefully you guys were able

2461
01:50:20,159 --> 01:50:24,719
to find some domains and

2462
01:50:21,760 --> 01:50:26,159
i p addresses um all related to

2463
01:50:24,719 --> 01:50:28,639
pre-stage infrastructure

2464
01:50:26,159 --> 01:50:30,400
for this attack using threat crowd

2465
01:50:28,639 --> 01:50:32,800
virustotal or maybe your own

2466
01:50:30,400 --> 01:50:34,080
favorite open source tools let's look

2467
01:50:32,800 --> 01:50:36,400
what we will find

2468
01:50:34,080 --> 01:50:37,920
so we go over to threatcrowd first and

2469
01:50:36,400 --> 01:50:40,000
we drop uh

2470
01:50:37,920 --> 01:50:41,440
the domain of the prank glass i'm not

2471
01:50:40,000 --> 01:50:44,800
gonna say it all um

2472
01:50:41,440 --> 01:50:48,080
into there just take a look at it um

2473
01:50:44,800 --> 01:50:50,080
it's showing up as malicious uh so

2474
01:50:48,080 --> 01:50:52,080
yeah having that and we see some

2475
01:50:50,080 --> 01:50:55,599
relationships here

2476
01:50:52,080 --> 01:50:57,599
between multiple domains some external

2477
01:50:55,599 --> 01:51:00,880
ones our own domain

2478
01:50:57,599 --> 01:51:00,880
some of our own domains as well

2479
01:51:01,280 --> 01:51:05,119
if we do a pivot to ip address and take

2480
01:51:04,239 --> 01:51:07,519
a look at

2481
01:51:05,119 --> 01:51:08,880
our suspect ip address and what's spun

2482
01:51:07,520 --> 01:51:11,199
off off of that

2483
01:51:08,880 --> 01:51:12,320
oh wow look at that we're seeing

2484
01:51:11,199 --> 01:51:15,678
possible

2485
01:51:12,320 --> 01:51:18,639
uh typo squatting here

2486
01:51:15,679 --> 01:51:19,599
in the hopes of either catching people

2487
01:51:18,639 --> 01:51:23,360
off typos

2488
01:51:19,599 --> 01:51:24,719
or um to you know use similar name

2489
01:51:23,360 --> 01:51:26,559
spoofing maybe

2490
01:51:24,719 --> 01:51:27,920
uh to trick people into clicking on

2491
01:51:26,560 --> 01:51:29,360
links or something like that if they're

2492
01:51:27,920 --> 01:51:30,719
not paying attention

2493
01:51:29,360 --> 01:51:32,719
so some some very interesting

2494
01:51:30,719 --> 01:51:33,440
infrastructure that they've been staging

2495
01:51:32,719 --> 01:51:35,679
here

2496
01:51:33,440 --> 01:51:38,239
we can hop over to virustotal and take a

2497
01:51:35,679 --> 01:51:41,440
look at that

2498
01:51:38,239 --> 01:51:44,879
url as well seeing that it's mapping

2499
01:51:41,440 --> 01:51:47,280
back to our 23 address

2500
01:51:44,880 --> 01:51:48,080
using that 23 address again to take a

2501
01:51:47,280 --> 01:51:50,080
look at

2502
01:51:48,080 --> 01:51:51,760
domain names and we've got a couple

2503
01:51:50,080 --> 01:51:52,639
there looks like they're staging

2504
01:51:51,760 --> 01:51:56,480
themselves out

2505
01:51:52,639 --> 01:51:56,480
in amazon aws as well

2506
01:51:57,679 --> 01:52:01,679
you can definitely drop those list of

2507
01:51:59,360 --> 01:52:02,239
things into our question and our bonus

2508
01:52:01,679 --> 01:52:05,280
question

2509
01:52:02,239 --> 01:52:06,400
so 23 is definitely tied to those

2510
01:52:05,280 --> 01:52:10,960
domains

2511
01:52:06,400 --> 01:52:12,879
and those domains are all of these here

2512
01:52:10,960 --> 01:52:14,320
going to add that into our attack

2513
01:52:12,880 --> 01:52:16,960
picture so

2514
01:52:14,320 --> 01:52:19,119
we see that they prepared some stuff way

2515
01:52:16,960 --> 01:52:20,400
back in the weaponization stage before

2516
01:52:19,119 --> 01:52:22,960
probably even before they started

2517
01:52:20,400 --> 01:52:26,799
attacking us

2518
01:52:22,960 --> 01:52:26,800
add that to our attack picture as well

2519
01:52:27,360 --> 01:52:32,000
and um we're gonna use some additional

2520
01:52:31,280 --> 01:52:35,519
oceans

2521
01:52:32,000 --> 01:52:37,679
so we want to identify us so

2522
01:52:35,520 --> 01:52:38,960
malware is also associated with our

2523
01:52:37,679 --> 01:52:42,400
attacker right

2524
01:52:38,960 --> 01:52:44,080
so um gotham city police department

2525
01:52:42,400 --> 01:52:47,679
they're so awesome uh

2526
01:52:44,080 --> 01:52:51,199
reported some ttps for poison ivy

2527
01:52:47,679 --> 01:52:52,719
um that if they fail uh to

2528
01:52:51,199 --> 01:52:54,400
their initial compromise they're gonna

2529
01:52:52,719 --> 01:52:57,440
fall back to some spear fishing

2530
01:52:54,400 --> 01:53:02,080
with some custom malware attached

2531
01:52:57,440 --> 01:53:04,480
so we want to find out um the sha-256

2532
01:53:02,080 --> 01:53:06,000
of some malware they have pre-staged as

2533
01:53:04,480 --> 01:53:09,678
their fallback

2534
01:53:06,000 --> 01:53:10,560
uh and as in addition the the name of

2535
01:53:09,679 --> 01:53:15,679
the file

2536
01:53:10,560 --> 01:53:15,679
that matches that shot 256 hash

2537
01:53:17,199 --> 01:53:22,480
so the email wasn't ever sent so we're

2538
01:53:20,080 --> 01:53:27,040
not going to find it in our logs

2539
01:53:22,480 --> 01:53:28,799
um we do have an a a bunch of indicators

2540
01:53:27,040 --> 01:53:31,840
that we've already collected so we can

2541
01:53:28,800 --> 01:53:35,280
use that as we go to our

2542
01:53:31,840 --> 01:53:37,440
osint tools so threat minor virus total

2543
01:53:35,280 --> 01:53:40,159
hybrid analysis all good places

2544
01:53:37,440 --> 01:53:42,559
to go looking for the answer to this

2545
01:53:40,159 --> 01:53:42,559
question

2546
01:53:50,400 --> 01:53:53,519
when you go to those websites you can

2547
01:53:52,560 --> 01:53:56,000
use

2548
01:53:53,520 --> 01:53:57,920
things like the ip addresses that you've

2549
01:53:56,000 --> 01:54:01,199
been keeping copious notes on

2550
01:53:57,920 --> 01:54:09,840
by now or that list of domains that we

2551
01:54:01,199 --> 01:54:09,839
just uncovered

2552
01:55:55,520 --> 01:56:00,000
all right team corncon does anybody need

2553
01:55:57,920 --> 01:56:02,639
another minute before we dig down into

2554
01:56:00,000 --> 01:56:02,639
this answer

2555
01:56:04,480 --> 01:56:10,959
cool all right let's take a look

2556
01:56:07,679 --> 01:56:13,199
oh there we go all right so we go to

2557
01:56:10,960 --> 01:56:16,400
threatminer

2558
01:56:13,199 --> 01:56:19,839
liner can give us uh an md5

2559
01:56:16,400 --> 01:56:22,480
of the samples uh from our 23 address

2560
01:56:19,840 --> 01:56:24,239
but now the shot 256. but that's okay we

2561
01:56:22,480 --> 01:56:28,080
can leverage that information

2562
01:56:24,239 --> 01:56:31,598
um we can uh

2563
01:56:28,080 --> 01:56:34,719
uh actually take a a look at the actual

2564
01:56:31,599 --> 01:56:37,520
um sample itself by selecting

2565
01:56:34,719 --> 01:56:38,880
the md5 hash uh and when we dig down

2566
01:56:37,520 --> 01:56:42,639
into those results

2567
01:56:38,880 --> 01:56:45,920
we'll find further information uh so um

2568
01:56:42,639 --> 01:56:49,679
we can we can grab that 256 here

2569
01:56:45,920 --> 01:56:50,800
we may also want to grab the name of

2570
01:56:49,679 --> 01:56:55,119
this executable

2571
01:56:50,800 --> 01:56:58,400
as well um for future reference

2572
01:56:55,119 --> 01:57:01,040
so we've got the 256 um

2573
01:56:58,400 --> 01:57:02,320
but we probably want to corroborate this

2574
01:57:01,040 --> 01:57:05,119
with other data

2575
01:57:02,320 --> 01:57:06,080
open source tools as well so if we go

2576
01:57:05,119 --> 01:57:09,759
over

2577
01:57:06,080 --> 01:57:13,199
to um the to virustotal

2578
01:57:09,760 --> 01:57:14,560
and drop that 256 hash in uh we can take

2579
01:57:13,199 --> 01:57:17,759
a look at

2580
01:57:14,560 --> 01:57:19,119
the results there um also validating

2581
01:57:17,760 --> 01:57:22,320
that it's uh they've been calling it

2582
01:57:19,119 --> 01:57:26,320
miranda tate screensaver as well

2583
01:57:22,320 --> 01:57:28,320
um we could actually just dump that hash

2584
01:57:26,320 --> 01:57:30,400
into google if we wanted to and we'd get

2585
01:57:28,320 --> 01:57:34,080
some results back as well

2586
01:57:30,400 --> 01:57:36,400
um and uh oh

2587
01:57:34,080 --> 01:57:37,519
yep and yeah so yeah that's our

2588
01:57:36,400 --> 01:57:40,000
corroboration

2589
01:57:37,520 --> 01:57:42,480
so our answer to the first question is

2590
01:57:40,000 --> 01:57:45,599
that 256 hash that we found

2591
01:57:42,480 --> 01:57:48,799
um and and corroborated

2592
01:57:45,599 --> 01:57:50,719
bonus question uh would have been uh

2593
01:57:48,800 --> 01:57:54,320
the actual name of the file which was

2594
01:57:50,719 --> 01:57:58,000
miranda tate screensaver.scr.exe

2595
01:57:54,320 --> 01:58:01,199
so good job post that up into

2596
01:57:58,000 --> 01:58:03,679
our um uh our our uh

2597
01:58:01,199 --> 01:58:05,040
notes as well for the kill chain as well

2598
01:58:03,679 --> 01:58:07,119
as the attack picture

2599
01:58:05,040 --> 01:58:08,560
oh my god you guys have documented this

2600
01:58:07,119 --> 01:58:10,480
so well i swear to god you're going to

2601
01:58:08,560 --> 01:58:13,199
make csu by the end of the month it's

2602
01:58:10,480 --> 01:58:16,799
just awesome

2603
01:58:13,199 --> 01:58:19,119
so that is our first scenario

2604
01:58:16,800 --> 01:58:20,320
um these are all the things that we were

2605
01:58:19,119 --> 01:58:23,119
able to do

2606
01:58:20,320 --> 01:58:24,639
um and discover um so while we didn't

2607
01:58:23,119 --> 01:58:27,519
necessarily spell out

2608
01:58:24,639 --> 01:58:28,960
uh that that the executable was uploaded

2609
01:58:27,520 --> 01:58:29,679
was a web shell i think was pretty

2610
01:58:28,960 --> 01:58:31,040
obvious

2611
01:58:29,679 --> 01:58:32,840
as we were digging through their

2612
01:58:31,040 --> 01:58:34,320
activity once that executable got

2613
01:58:32,840 --> 01:58:37,520
uploaded um

2614
01:58:34,320 --> 01:58:38,320
tried to move around um defaced our

2615
01:58:37,520 --> 01:58:41,440
website

2616
01:58:38,320 --> 01:58:45,040
um and uh and so on um

2617
01:58:41,440 --> 01:58:48,000
so uh that's our complete

2618
01:58:45,040 --> 01:58:49,040
attack kill chain and our complete

2619
01:58:48,000 --> 01:58:52,159
attack

2620
01:58:49,040 --> 01:58:55,440
diagram um we've got

2621
01:58:52,159 --> 01:58:58,559
a quick break uh in here

2622
01:58:55,440 --> 01:59:01,598
um i wouldn't mind taking five minutes

2623
01:58:58,560 --> 01:59:02,400
but does any when we can take 15 minutes

2624
01:59:01,599 --> 01:59:05,280
too

2625
01:59:02,400 --> 01:59:07,360
it's up to you guys just in the chat

2626
01:59:05,280 --> 01:59:08,960
tell me if you prefer 5 or 15

2627
01:59:07,360 --> 01:59:17,839
and we'll go with whichever gets the

2628
01:59:08,960 --> 01:59:17,840
most votes

2629
01:59:18,320 --> 01:59:21,440
15 5

2630
01:59:21,840 --> 01:59:27,760
all right bob you

2631
01:59:25,280 --> 01:59:27,759
bastard

2632
01:59:28,800 --> 01:59:34,080
15 we've got two fifteen um fifteen

2633
01:59:34,719 --> 01:59:38,159
all right uh unless i see some more

2634
01:59:37,520 --> 01:59:41,520
fives there

2635
01:59:38,159 --> 01:59:44,960
15 seems to be the consensus

2636
01:59:41,520 --> 01:59:48,320
it's fine um all right uh so

2637
01:59:44,960 --> 01:59:50,719
15-minute break um let's be here back at

2638
01:59:48,320 --> 01:59:52,639
the top of the hour one o'clock central

2639
01:59:50,719 --> 01:59:59,840
um and we'll get going thanks guys i'll

2640
01:59:52,639 --> 01:59:59,840
see you in a bit

2641
02:00:02,880 --> 02:00:04,960
you

