1
00:00:03,360 --> 00:00:07,279
hello cactus khan

2
00:00:07,279 --> 00:00:09,519
welcome welcome welcome

3
00:00:09,519 --> 00:00:12,080
thank you for coming to my talk

4
00:00:12,080 --> 00:00:15,440
and thank you to the organizers for

5
00:00:15,440 --> 00:00:18,080
running this awesome conference and

6
00:00:18,080 --> 00:00:19,920
having me back

7
00:00:19,920 --> 00:00:22,800
it's actually a second time i present at

8
00:00:22,800 --> 00:00:25,760
cactus con so excited to be here i must

9
00:00:25,760 --> 00:00:27,840
have done something slightly right last

10
00:00:27,840 --> 00:00:28,640
time

11
00:00:28,640 --> 00:00:33,520
um and just happy to always be sharing

12
00:00:33,520 --> 00:00:35,040
what we've learned

13
00:00:35,040 --> 00:00:37,760
and giving it back to the community so

14
00:00:37,760 --> 00:00:40,640
welcome again my name is george ortiz

15
00:00:40,640 --> 00:00:45,039
and this talk is called operationalized

16
00:00:45,039 --> 00:00:46,719
purple teaming

17
00:00:46,719 --> 00:00:51,039
now this talk does pick up where we left

18
00:00:51,039 --> 00:00:51,920
off

19
00:00:51,920 --> 00:00:53,600
last time

20
00:00:53,600 --> 00:00:57,680
and if you missed it at cactus con 9

21
00:00:57,680 --> 00:01:00,879
i gave a talk with bryson bour called

22
00:01:00,879 --> 00:01:03,680
the full purple juice not the watered

23
00:01:03,680 --> 00:01:04,959
down stuff

24
00:01:04,959 --> 00:01:08,400
and this covered how to run purple team

25
00:01:08,400 --> 00:01:10,720
exercises now you may have heard of

26
00:01:10,720 --> 00:01:12,880
purple teaming you may have done an

27
00:01:12,880 --> 00:01:15,360
exercise already or maybe not if you

28
00:01:15,360 --> 00:01:18,159
haven't don't worry we'll use the first

29
00:01:18,159 --> 00:01:21,600
intro slides here to level up and make

30
00:01:21,600 --> 00:01:24,840
sure that we're all talking the same

31
00:01:24,840 --> 00:01:27,600
language and then from there we'll get

32
00:01:27,600 --> 00:01:31,200
right into operationalized purple tv

33
00:01:31,200 --> 00:01:33,520
for that we uh we'll get a little bit

34
00:01:33,520 --> 00:01:35,520
technical as well

35
00:01:35,520 --> 00:01:39,759
we are using a live and real use case on

36
00:01:39,759 --> 00:01:42,320
leveraging cyber threat intelligence

37
00:01:42,320 --> 00:01:43,119
to

38
00:01:43,119 --> 00:01:45,759
emulate an attack and then be able to

39
00:01:45,759 --> 00:01:48,240
detect and respond to it so

40
00:01:48,240 --> 00:01:50,560
hopefully you're all excited or as

41
00:01:50,560 --> 00:01:53,040
excited as i am i love purple teaming i

42
00:01:53,040 --> 00:01:55,360
think it brings a lot of value

43
00:01:55,360 --> 00:01:57,200
and uh

44
00:01:57,200 --> 00:01:58,479
let's do this

45
00:01:58,479 --> 00:01:59,520
so

46
00:01:59,520 --> 00:02:02,799
the whole concept of purple teaming was

47
00:02:02,799 --> 00:02:04,240
when

48
00:02:04,240 --> 00:02:07,840
i looked back probably around 2014 2015

49
00:02:07,840 --> 00:02:11,200
worked at a large financial organization

50
00:02:11,200 --> 00:02:13,120
uh i had a big team

51
00:02:13,120 --> 00:02:16,160
i ran a uh the offensive security team

52
00:02:16,160 --> 00:02:18,959
there was everything from vulnerability

53
00:02:18,959 --> 00:02:21,360
scanning vulnerability assessment pen

54
00:02:21,360 --> 00:02:23,760
testing red team etc

55
00:02:23,760 --> 00:02:25,840
and of course we had a very big blue

56
00:02:25,840 --> 00:02:28,959
team that did security operations center

57
00:02:28,959 --> 00:02:30,160
and uh

58
00:02:30,160 --> 00:02:31,840
threat hunting

59
00:02:31,840 --> 00:02:33,120
etc

60
00:02:33,120 --> 00:02:35,760
we also had a cyber threat intel team

61
00:02:35,760 --> 00:02:37,680
and what occurred is that all these

62
00:02:37,680 --> 00:02:40,560
teams worked in silos

63
00:02:40,560 --> 00:02:42,160
and this is what we're seeing in a lot

64
00:02:42,160 --> 00:02:44,480
of organizations today you have your

65
00:02:44,480 --> 00:02:46,560
blue team defending over there the red

66
00:02:46,560 --> 00:02:50,400
team attacking uh on the other side kind

67
00:02:50,400 --> 00:02:52,879
of adversarial there uh as far as

68
00:02:52,879 --> 00:02:55,040
relationships and culture and then the

69
00:02:55,040 --> 00:02:56,720
cyber threat intel team trying to

70
00:02:56,720 --> 00:02:59,360
provide actionable threat intelligence

71
00:02:59,360 --> 00:03:03,360
um so here you see them depicted as the

72
00:03:03,360 --> 00:03:06,400
unicorns if you haven't seen these uh

73
00:03:06,400 --> 00:03:08,959
unicorns these are our mascot over at

74
00:03:08,959 --> 00:03:11,040
scythe where i'm the chief technology

75
00:03:11,040 --> 00:03:13,680
officer and uh they make awesome

76
00:03:13,680 --> 00:03:16,879
stickers so i'll uh i'll post uh some

77
00:03:16,879 --> 00:03:19,680
info here see if you can get some swag

78
00:03:19,680 --> 00:03:22,319
but the whole point of this was these

79
00:03:22,319 --> 00:03:24,640
teams are working together are working

80
00:03:24,640 --> 00:03:25,920
separately

81
00:03:25,920 --> 00:03:28,720
in silos how can we bring them together

82
00:03:28,720 --> 00:03:30,959
so that they work together and that is

83
00:03:30,959 --> 00:03:33,120
the concept of purple teaming bring them

84
00:03:33,120 --> 00:03:34,799
all together

85
00:03:34,799 --> 00:03:37,280
not every day but bring them together so

86
00:03:37,280 --> 00:03:40,720
that they collaborate and work together

87
00:03:40,720 --> 00:03:41,519
so

88
00:03:41,519 --> 00:03:43,519
again if you've never heard of purple

89
00:03:43,519 --> 00:03:45,599
teaming let me give you a very quick

90
00:03:45,599 --> 00:03:49,599
intro on that a purple team is a virtual

91
00:03:49,599 --> 00:03:54,080
team where multiple roles work together

92
00:03:54,080 --> 00:03:56,400
the roles are cyber threat intelligence

93
00:03:56,400 --> 00:03:58,480
it's a team that does research on a

94
00:03:58,480 --> 00:04:01,040
particular adversary understands the

95
00:04:01,040 --> 00:04:03,040
adversary that is likely to attack the

96
00:04:03,040 --> 00:04:04,319
organization

97
00:04:04,319 --> 00:04:07,360
and grabs threat into what attacks have

98
00:04:07,360 --> 00:04:09,920
uh these threat actors done what are

99
00:04:09,920 --> 00:04:12,080
their behaviors

100
00:04:12,080 --> 00:04:14,560
the red team is the offensive team

101
00:04:14,560 --> 00:04:17,120
that's in charge of emulating those

102
00:04:17,120 --> 00:04:18,880
adversaries in the organization

103
00:04:18,880 --> 00:04:21,358
essentially testing the people the

104
00:04:21,358 --> 00:04:24,720
process and the technology to see if

105
00:04:24,720 --> 00:04:26,880
they can detect and respond

106
00:04:26,880 --> 00:04:29,360
to that attack before

107
00:04:29,360 --> 00:04:32,479
boom right before impact you always want

108
00:04:32,479 --> 00:04:35,360
to be left of boom

109
00:04:35,360 --> 00:04:38,080
and the blue team is a catch-all phrase

110
00:04:38,080 --> 00:04:40,320
for the defenders

111
00:04:40,320 --> 00:04:41,840
in your organization might be the

112
00:04:41,840 --> 00:04:43,759
security operations center it might be a

113
00:04:43,759 --> 00:04:45,919
managed security service provider you

114
00:04:45,919 --> 00:04:48,000
might have a hunt team you have might

115
00:04:48,000 --> 00:04:49,520
have a deferred team that stands for

116
00:04:49,520 --> 00:04:52,320
digital forensics and incident response

117
00:04:52,320 --> 00:04:54,639
and like i said purple team brings

118
00:04:54,639 --> 00:04:56,400
everyone together so

119
00:04:56,400 --> 00:04:59,199
we wrote a free resource here called the

120
00:04:59,199 --> 00:05:02,560
purple team exercise framework and that

121
00:05:02,560 --> 00:05:04,320
covers leveraging cyber threat

122
00:05:04,320 --> 00:05:06,720
intelligence preparation

123
00:05:06,720 --> 00:05:09,680
exercise execution and lessons learned

124
00:05:09,680 --> 00:05:12,639
so you can continually improve so again

125
00:05:12,639 --> 00:05:14,560
we presented this last year at cactus

126
00:05:14,560 --> 00:05:16,400
con i'm gonna give you a little bit more

127
00:05:16,400 --> 00:05:18,800
info on this and then we're gonna get to

128
00:05:18,800 --> 00:05:21,479
the net new stuff which is how do we

129
00:05:21,479 --> 00:05:24,800
operationalize this so from the cyber

130
00:05:24,800 --> 00:05:27,199
threat intelligence phase

131
00:05:27,199 --> 00:05:29,199
this was taken from katie nichols and

132
00:05:29,199 --> 00:05:33,759
cody thomas sans summit talk uh a while

133
00:05:33,759 --> 00:05:37,039
back and really loved this uh really

134
00:05:37,039 --> 00:05:38,400
implemented this a number of

135
00:05:38,400 --> 00:05:41,360
organizations um so essentially it's if

136
00:05:41,360 --> 00:05:43,520
you are in cyber threat intelligence

137
00:05:43,520 --> 00:05:45,199
your first thing is to understand the

138
00:05:45,199 --> 00:05:48,479
organization understand um

139
00:05:48,479 --> 00:05:50,400
the threat model

140
00:05:50,400 --> 00:05:52,800
and identify adversaries are likely to

141
00:05:52,800 --> 00:05:55,360
attack that organization an adversary

142
00:05:55,360 --> 00:05:58,160
must have an opportunity an intent and a

143
00:05:58,160 --> 00:06:00,880
capability to attack

144
00:06:00,880 --> 00:06:03,840
once you pick a particular threat actor

145
00:06:03,840 --> 00:06:06,160
an adversary that's likely to attack

146
00:06:06,160 --> 00:06:08,720
then you gather threat intelligence and

147
00:06:08,720 --> 00:06:09,840
the thing with gathering threat

148
00:06:09,840 --> 00:06:11,759
intelligence is that there's a lot of

149
00:06:11,759 --> 00:06:15,039
different types of threat intel nowadays

150
00:06:15,039 --> 00:06:17,759
right you've seen most of these i'm sure

151
00:06:17,759 --> 00:06:19,600
you've seen the

152
00:06:19,600 --> 00:06:22,080
david bianco pyramid of pain that shows

153
00:06:22,080 --> 00:06:25,199
different types of indicators

154
00:06:25,199 --> 00:06:27,600
something like a hash value an ip

155
00:06:27,600 --> 00:06:30,560
address a domain

156
00:06:30,560 --> 00:06:31,680
those

157
00:06:31,680 --> 00:06:34,720
while technically some threat intel

158
00:06:34,720 --> 00:06:36,720
we're not really interested in that

159
00:06:36,720 --> 00:06:39,120
we're interested in the adversary

160
00:06:39,120 --> 00:06:41,680
behaviors in the pyramid of pain it's

161
00:06:41,680 --> 00:06:44,639
called ttps tactics techniques and

162
00:06:44,639 --> 00:06:46,639
procedures and this is what the threat

163
00:06:46,639 --> 00:06:50,479
actor does their behaviors so

164
00:06:50,479 --> 00:06:52,639
cyber threat intel needs to extract

165
00:06:52,639 --> 00:06:54,880
those ttps

166
00:06:54,880 --> 00:06:57,840
and then map them to mitre attack

167
00:06:57,840 --> 00:07:00,479
miter attack is of course the common

168
00:07:00,479 --> 00:07:03,520
knowledge that we use uh used to have to

169
00:07:03,520 --> 00:07:05,440
explain this but i think by now everyone

170
00:07:05,440 --> 00:07:07,199
understands attack right it stands for

171
00:07:07,199 --> 00:07:09,280
adversaries tactics techniques and

172
00:07:09,280 --> 00:07:11,440
common knowledge really a common

173
00:07:11,440 --> 00:07:13,919
language between these teams are going

174
00:07:13,919 --> 00:07:15,440
to work together between cyber threat

175
00:07:15,440 --> 00:07:18,400
intelligence red team and blue team

176
00:07:18,400 --> 00:07:20,639
so then we analyze and organize those

177
00:07:20,639 --> 00:07:21,840
see because the cyber threat

178
00:07:21,840 --> 00:07:24,000
intelligence is gonna come from what

179
00:07:24,000 --> 00:07:27,120
they saw in an attack and how you see an

180
00:07:27,120 --> 00:07:29,039
attack is not necessarily how you

181
00:07:29,039 --> 00:07:32,160
perform an attack so we have to do some

182
00:07:32,160 --> 00:07:34,720
work there and create an adversary

183
00:07:34,720 --> 00:07:36,800
emulation plan

184
00:07:36,800 --> 00:07:39,840
this essentially tells our sponsors and

185
00:07:39,840 --> 00:07:42,080
our senior management this is what we're

186
00:07:42,080 --> 00:07:44,479
going to do these are our goals these

187
00:07:44,479 --> 00:07:46,639
are the objectives of the adversary this

188
00:07:46,639 --> 00:07:49,680
is what we're going to test and see if

189
00:07:49,680 --> 00:07:51,840
we are susceptible if we would

190
00:07:51,840 --> 00:07:54,400
fall for this uh if we'd be impacted by

191
00:07:54,400 --> 00:07:56,840
this adversary then we emulate the

192
00:07:56,840 --> 00:07:59,520
adversary now that does require some

193
00:07:59,520 --> 00:08:01,039
preparation

194
00:08:01,039 --> 00:08:03,599
purple team exercises the prep phase

195
00:08:03,599 --> 00:08:06,160
generally is longer than the actual

196
00:08:06,160 --> 00:08:08,400
exercise that is true for red team

197
00:08:08,400 --> 00:08:10,560
exercises as well if you've ever done a

198
00:08:10,560 --> 00:08:13,120
red team engagement you spend a lot of

199
00:08:13,120 --> 00:08:15,440
time on prep lots of people don't talk

200
00:08:15,440 --> 00:08:17,599
about that right most people talk about

201
00:08:17,599 --> 00:08:20,639
uh some new cool way of uh doing it some

202
00:08:20,639 --> 00:08:23,199
trade craft but there's a lot of prep

203
00:08:23,199 --> 00:08:25,520
that goes into this so

204
00:08:25,520 --> 00:08:27,120
again all this is covered in the purple

205
00:08:27,120 --> 00:08:28,879
team exercise framework which you can

206
00:08:28,879 --> 00:08:32,159
download it uh on github it's totally

207
00:08:32,159 --> 00:08:34,640
free um and i'm just

208
00:08:34,640 --> 00:08:36,640
summarizing this for you here very quick

209
00:08:36,640 --> 00:08:39,599
so we get to the operationalized purpose

210
00:08:39,599 --> 00:08:42,080
in preparation we have to pitch a purple

211
00:08:42,080 --> 00:08:44,640
team exercise to a sponsor show them the

212
00:08:44,640 --> 00:08:47,360
value that is gonna come out of doing

213
00:08:47,360 --> 00:08:49,839
these uh exercises we're gonna have a

214
00:08:49,839 --> 00:08:53,600
number of preparation meetings as we

215
00:08:53,600 --> 00:08:55,360
bring in the people that are going to be

216
00:08:55,360 --> 00:08:57,360
part of the exercise we set up the

217
00:08:57,360 --> 00:08:59,680
target systems

218
00:08:59,680 --> 00:09:02,160
we normally do this in production

219
00:09:02,160 --> 00:09:03,839
because that is where you have your

220
00:09:03,839 --> 00:09:06,320
actual people process and technology you

221
00:09:06,320 --> 00:09:08,880
can do this in a lab you can do this in

222
00:09:08,880 --> 00:09:10,240
non-production

223
00:09:10,240 --> 00:09:12,160
but if you want to test

224
00:09:12,160 --> 00:09:14,880
uh and have actual real and timely

225
00:09:14,880 --> 00:09:17,040
results productions can be the place to

226
00:09:17,040 --> 00:09:19,760
go so if you do this on target systems

227
00:09:19,760 --> 00:09:20,959
you need to ensure that all your

228
00:09:20,959 --> 00:09:23,200
security tools are on there that you

229
00:09:23,200 --> 00:09:25,279
have accounts that you're going to be

230
00:09:25,279 --> 00:09:26,399
leveraging

231
00:09:26,399 --> 00:09:27,519
and

232
00:09:27,519 --> 00:09:29,760
of course the red team has to set up

233
00:09:29,760 --> 00:09:32,080
attack infrastructure which is a whole

234
00:09:32,080 --> 00:09:33,760
nother uh

235
00:09:33,760 --> 00:09:36,959
talk but again covered there

236
00:09:36,959 --> 00:09:39,440
the metrics metrics are important and

237
00:09:39,440 --> 00:09:41,279
really in purple teaming and adversary

238
00:09:41,279 --> 00:09:43,920
emulation as a whole we have changed the

239
00:09:43,920 --> 00:09:47,200
metrics that we're used to right

240
00:09:47,200 --> 00:09:49,680
if you think of a vulnerability we have

241
00:09:49,680 --> 00:09:52,880
a cve a common vulnerability exposure id

242
00:09:52,880 --> 00:09:56,720
it has a cvss score it has a priority

243
00:09:56,720 --> 00:09:58,320
and

244
00:09:58,320 --> 00:10:00,480
that vulnerability is either open or

245
00:10:00,480 --> 00:10:03,360
closed right it's there or it's not

246
00:10:03,360 --> 00:10:04,959
there it might be exploitable not

247
00:10:04,959 --> 00:10:06,560
exploitable

248
00:10:06,560 --> 00:10:08,800
when we talk about

249
00:10:08,800 --> 00:10:11,440
purple teaming and emulating adversaries

250
00:10:11,440 --> 00:10:14,880
and ttps a lot of these ttps you can't

251
00:10:14,880 --> 00:10:17,120
just prevent it's not going to be closed

252
00:10:17,120 --> 00:10:19,440
ttb you're going to be able to detect

253
00:10:19,440 --> 00:10:21,519
that so we have to talk about data

254
00:10:21,519 --> 00:10:25,279
sources did we have visibility

255
00:10:25,279 --> 00:10:27,120
was there an alert

256
00:10:27,120 --> 00:10:29,760
did our team see the alert was there a

257
00:10:29,760 --> 00:10:32,640
response and then we get to a point

258
00:10:32,640 --> 00:10:34,959
where we're actually tracking time

259
00:10:34,959 --> 00:10:38,079
metrics you read one of those uh defer

260
00:10:38,079 --> 00:10:40,800
reports or um

261
00:10:40,800 --> 00:10:41,839
you see

262
00:10:41,839 --> 00:10:43,760
a lot of time based metrics right mean

263
00:10:43,760 --> 00:10:46,560
time to detection and these actors got

264
00:10:46,560 --> 00:10:48,240
in there and they were idle for this

265
00:10:48,240 --> 00:10:51,680
long so we want to measure them

266
00:10:51,680 --> 00:10:53,519
and then it comes time for the exercise

267
00:10:53,519 --> 00:10:55,760
we bring everyone together it's an

268
00:10:55,760 --> 00:10:58,079
exciting time you have your blue team

269
00:10:58,079 --> 00:11:00,079
talking to your red team to your cti

270
00:11:00,079 --> 00:11:02,720
team some stakeholders some observers

271
00:11:02,720 --> 00:11:03,760
and

272
00:11:03,760 --> 00:11:05,839
the exercise coordinator goes in

273
00:11:05,839 --> 00:11:07,680
presents the adversary says today we're

274
00:11:07,680 --> 00:11:09,920
going to emulate this adversary these

275
00:11:09,920 --> 00:11:11,920
are the behaviors that were observed

276
00:11:11,920 --> 00:11:14,399
these are some technical details then

277
00:11:14,399 --> 00:11:17,040
you have a tabletop discussion what do

278
00:11:17,040 --> 00:11:20,399
you expect to occur when this particular

279
00:11:20,399 --> 00:11:23,120
ttp is executed and you document that

280
00:11:23,120 --> 00:11:25,519
it's interesting to see the expectations

281
00:11:25,519 --> 00:11:27,120
from the different teams

282
00:11:27,120 --> 00:11:29,519
then the red team is going to emulate

283
00:11:29,519 --> 00:11:32,480
that adversary or that particular ttp

284
00:11:32,480 --> 00:11:35,200
sharing the screen allowing for the

285
00:11:35,200 --> 00:11:37,040
other teams to learn and see how an

286
00:11:37,040 --> 00:11:38,320
attack works

287
00:11:38,320 --> 00:11:41,760
and then we swap the blue team then

288
00:11:41,760 --> 00:11:44,880
shares their screen they show

289
00:11:44,880 --> 00:11:47,120
what is going on how they detect

290
00:11:47,120 --> 00:11:49,200
something if there was an alert if there

291
00:11:49,200 --> 00:11:52,079
was a log maybe they go threat hunting

292
00:11:52,079 --> 00:11:53,200
because

293
00:11:53,200 --> 00:11:55,760
it's a full knowledge exercise

294
00:11:55,760 --> 00:11:56,639
if

295
00:11:56,639 --> 00:11:57,600
something

296
00:11:57,600 --> 00:12:00,320
didn't meet expectation or you determine

297
00:12:00,320 --> 00:12:02,399
that you should probably have visibility

298
00:12:02,399 --> 00:12:04,320
about this particular behavior then you

299
00:12:04,320 --> 00:12:06,240
do detection engineering which again

300
00:12:06,240 --> 00:12:08,839
it's a process of understanding an

301
00:12:08,839 --> 00:12:11,839
attack understanding the data sources

302
00:12:11,839 --> 00:12:14,720
and turning those on and then this loops

303
00:12:14,720 --> 00:12:17,680
you go through and do multiple ttps

304
00:12:17,680 --> 00:12:19,600
of course the whole point of this is

305
00:12:19,600 --> 00:12:23,040
value uh here we have a screenshot from

306
00:12:23,040 --> 00:12:26,560
plex track it's a great platform for uh

307
00:12:26,560 --> 00:12:28,560
managing not just vulnerability

308
00:12:28,560 --> 00:12:30,880
management but also red team and purple

309
00:12:30,880 --> 00:12:32,720
team exercises it's really cool shout

310
00:12:32,720 --> 00:12:34,160
out to our friends over there plexus

311
00:12:34,160 --> 00:12:36,160
track and over here on the left you see

312
00:12:36,160 --> 00:12:38,800
the first time we ran this emulation did

313
00:12:38,800 --> 00:12:41,760
about 20 some ttps and there were no

314
00:12:41,760 --> 00:12:43,120
alerts

315
00:12:43,120 --> 00:12:45,440
no alerts means there's no response

316
00:12:45,440 --> 00:12:46,720
right unless you have your threat

317
00:12:46,720 --> 00:12:49,040
hunting team that found something as we

318
00:12:49,040 --> 00:12:50,959
did the purple team exercise we were

319
00:12:50,959 --> 00:12:52,639
able to trigger

320
00:12:52,639 --> 00:12:55,680
13 alerts which

321
00:12:55,680 --> 00:12:58,800
then allowed us to train our team our

322
00:12:58,800 --> 00:13:01,120
team saw the alert they followed their

323
00:13:01,120 --> 00:13:04,000
process and they were able to respond to

324
00:13:04,000 --> 00:13:05,760
that um

325
00:13:05,760 --> 00:13:07,120
to that threat

326
00:13:07,120 --> 00:13:08,639
so that

327
00:13:08,639 --> 00:13:11,680
very quickly is a purple team exercise

328
00:13:11,680 --> 00:13:14,560
again if you saw our previous cactus con

329
00:13:14,560 --> 00:13:15,600
talk

330
00:13:15,600 --> 00:13:16,399
uh

331
00:13:16,399 --> 00:13:19,040
you you this is definitely just a

332
00:13:19,040 --> 00:13:20,480
reminder

333
00:13:20,480 --> 00:13:22,000
so

334
00:13:22,000 --> 00:13:24,880
we left off we had this awesome purple

335
00:13:24,880 --> 00:13:26,639
team exercise

336
00:13:26,639 --> 00:13:27,760
and

337
00:13:27,760 --> 00:13:30,160
everything went great but what happens

338
00:13:30,160 --> 00:13:31,760
next

339
00:13:31,760 --> 00:13:33,920
well you can continue to do purple team

340
00:13:33,920 --> 00:13:36,639
exercises maybe in a monthly basis or on

341
00:13:36,639 --> 00:13:38,720
a quarterly basis right where you bring

342
00:13:38,720 --> 00:13:40,880
these separate teams together you do an

343
00:13:40,880 --> 00:13:43,680
adversary emulation these exercises can

344
00:13:43,680 --> 00:13:46,160
be a week long could be a day could be

345
00:13:46,160 --> 00:13:49,600
two hours but what we started

346
00:13:49,600 --> 00:13:52,240
implementing in organizations that were

347
00:13:52,240 --> 00:13:54,399
maturing past these first couple of

348
00:13:54,399 --> 00:13:57,440
exercises was an operationalized purple

349
00:13:57,440 --> 00:13:59,040
team and that's what we're going to talk

350
00:13:59,040 --> 00:14:00,639
about here something that we've

351
00:14:00,639 --> 00:14:02,800
implemented and seen something that you

352
00:14:02,800 --> 00:14:06,160
can take home and do yourself

353
00:14:06,160 --> 00:14:08,079
so what's an operationalized purple team

354
00:14:08,079 --> 00:14:10,399
that's dedicated internal teams doing

355
00:14:10,399 --> 00:14:13,360
cyber threat intel red team blue team

356
00:14:13,360 --> 00:14:16,639
and then working together when that

357
00:14:16,639 --> 00:14:19,279
cyber threat intel comes in new threat

358
00:14:19,279 --> 00:14:20,880
is out there we hear something on the

359
00:14:20,880 --> 00:14:23,519
news let's do that as a new ttp is

360
00:14:23,519 --> 00:14:26,399
discovered it's analyzed and if it's net

361
00:14:26,399 --> 00:14:28,880
new it's tested

362
00:14:28,880 --> 00:14:30,560
and then we are starting to see some

363
00:14:30,560 --> 00:14:33,040
dedicated purple teams uh in some

364
00:14:33,040 --> 00:14:35,279
organizations mostly in the financial

365
00:14:35,279 --> 00:14:37,360
sector that of course is not a

366
00:14:37,360 --> 00:14:39,760
requirement but we did put something out

367
00:14:39,760 --> 00:14:41,839
called the purple team maturity model

368
00:14:41,839 --> 00:14:44,320
because now you have this process that

369
00:14:44,320 --> 00:14:46,399
your people are following called purple

370
00:14:46,399 --> 00:14:48,639
teaming and you want to track and see

371
00:14:48,639 --> 00:14:51,440
how it matures and how it's improving

372
00:14:51,440 --> 00:14:52,959
so that's what we're going to cover

373
00:14:52,959 --> 00:14:56,880
today so let's focus on operationalized

374
00:14:56,880 --> 00:15:00,079
purple what does that look like

375
00:15:00,079 --> 00:15:03,199
new cyber threat intelligence comes in a

376
00:15:03,199 --> 00:15:06,560
new report was just released microsoft

377
00:15:06,560 --> 00:15:10,399
just released something or mandy or um

378
00:15:10,399 --> 00:15:13,519
fireeye or sophos or whoever released

379
00:15:13,519 --> 00:15:15,279
this new cyber threat until they have

380
00:15:15,279 --> 00:15:19,920
observed an attack out in the wild

381
00:15:19,920 --> 00:15:20,959
we

382
00:15:20,959 --> 00:15:24,240
look at that and we essentially spawn

383
00:15:24,240 --> 00:15:27,760
our team we get and assign someone from

384
00:15:27,760 --> 00:15:30,079
cyber throne intel someone from the red

385
00:15:30,079 --> 00:15:32,240
team someone from the blue team to work

386
00:15:32,240 --> 00:15:33,360
together

387
00:15:33,360 --> 00:15:35,920
they then go and they analyze this

388
00:15:35,920 --> 00:15:37,759
threat intel they're gonna read through

389
00:15:37,759 --> 00:15:40,399
it they're going to extract those ttps

390
00:15:40,399 --> 00:15:42,880
map them to attack if it wasn't already

391
00:15:42,880 --> 00:15:46,480
done by the cyber threat intel provider

392
00:15:46,480 --> 00:15:48,560
and we are going to correlate this with

393
00:15:48,560 --> 00:15:50,880
previous tests let's see

394
00:15:50,880 --> 00:15:54,399
if this anything here is net new if it's

395
00:15:54,399 --> 00:15:57,120
net new we definitely have to test it

396
00:15:57,120 --> 00:15:58,160
then

397
00:15:58,160 --> 00:16:00,720
we do our tabletop discussion

398
00:16:00,720 --> 00:16:03,199
what are the expected detections and

399
00:16:03,199 --> 00:16:06,959
response to these ttps

400
00:16:06,959 --> 00:16:08,639
you document those

401
00:16:08,639 --> 00:16:10,079
and then the red team goes and they

402
00:16:10,079 --> 00:16:12,800
emulate the attack they show how to do

403
00:16:12,800 --> 00:16:14,560
the attack of course this requires a bit

404
00:16:14,560 --> 00:16:17,040
of work from the red team understanding

405
00:16:17,040 --> 00:16:19,839
how that threat uh perform those attacks

406
00:16:19,839 --> 00:16:22,720
those procedures and then

407
00:16:22,720 --> 00:16:24,399
we have our blue team doing detection

408
00:16:24,399 --> 00:16:27,199
engineering now that they saw the attack

409
00:16:27,199 --> 00:16:29,519
they can enable uh

410
00:16:29,519 --> 00:16:32,240
the logs and create alerts and then

411
00:16:32,240 --> 00:16:33,839
train their team

412
00:16:33,839 --> 00:16:37,120
to be able to see this now the original

413
00:16:37,120 --> 00:16:39,920
purple team exercise framework did not

414
00:16:39,920 --> 00:16:42,000
cover that so

415
00:16:42,000 --> 00:16:44,639
about a month ago we released version

416
00:16:44,639 --> 00:16:46,079
two of the purple team exercise

417
00:16:46,079 --> 00:16:48,880
framework that's open for comment we

418
00:16:48,880 --> 00:16:51,279
actually put it out on github make it

419
00:16:51,279 --> 00:16:53,600
easy for anyone to read it but also

420
00:16:53,600 --> 00:16:56,720
contribute to it so these steps are all

421
00:16:56,720 --> 00:16:59,199
outlined in this free framework that you

422
00:16:59,199 --> 00:17:02,560
can download um on github

423
00:17:02,560 --> 00:17:04,559
so let's do a

424
00:17:04,559 --> 00:17:08,000
use case here like i said i like doing

425
00:17:08,000 --> 00:17:10,720
uh actual real life things so

426
00:17:10,720 --> 00:17:13,919
step one new cyber threat intelligence

427
00:17:13,919 --> 00:17:17,280
comes in one of my favorites is the

428
00:17:17,280 --> 00:17:20,720
deferr report the default report is free

429
00:17:20,720 --> 00:17:22,720
you can sponsor them and i actually

430
00:17:22,720 --> 00:17:24,319
recommend that you do if you start

431
00:17:24,319 --> 00:17:26,640
leveraging the information that they

432
00:17:26,640 --> 00:17:28,079
have

433
00:17:28,079 --> 00:17:30,120
so the deferred report you go to the

434
00:17:30,120 --> 00:17:32,240
deferredreport.com they released these

435
00:17:32,240 --> 00:17:35,440
reports of real intrusions by real

436
00:17:35,440 --> 00:17:38,400
attackers and you read that right there

437
00:17:38,400 --> 00:17:40,160
on the headline right the truth behind

438
00:17:40,160 --> 00:17:41,440
the intrusion

439
00:17:41,440 --> 00:17:43,840
and i love them because they provide

440
00:17:43,840 --> 00:17:47,039
lots and lots of detail so

441
00:17:47,039 --> 00:17:50,160
it's december 13th

442
00:17:50,160 --> 00:17:52,880
the fur report comes out

443
00:17:52,880 --> 00:17:54,880
we now can

444
00:17:54,880 --> 00:17:58,840
begin our operationalized purple team

445
00:17:58,840 --> 00:18:01,360
process now threat intel doesn't just

446
00:18:01,360 --> 00:18:03,360
have to come from free and open source

447
00:18:03,360 --> 00:18:06,480
resources right uh it could come from

448
00:18:06,480 --> 00:18:08,320
the internal cyber threat intelligence

449
00:18:08,320 --> 00:18:11,919
team from internal vendors from red team

450
00:18:11,919 --> 00:18:14,799
maybe the red team found something new

451
00:18:14,799 --> 00:18:17,679
a new method of doing something

452
00:18:17,679 --> 00:18:20,320
cool that's what the red team does right

453
00:18:20,320 --> 00:18:22,000
so it could come from them or it could

454
00:18:22,000 --> 00:18:24,000
come from the blue team maybe the blue

455
00:18:24,000 --> 00:18:26,960
team observed a new attack

456
00:18:26,960 --> 00:18:27,760
that

457
00:18:27,760 --> 00:18:29,760
isn't on mitre attack

458
00:18:29,760 --> 00:18:31,679
right that happens

459
00:18:31,679 --> 00:18:35,280
actually to be added as a technique

460
00:18:35,280 --> 00:18:37,360
in mitre attack

461
00:18:37,360 --> 00:18:40,000
it must have been seen in the wild

462
00:18:40,000 --> 00:18:41,919
so we have a little bit of a chicken and

463
00:18:41,919 --> 00:18:43,760
egg problem where maybe the red team

464
00:18:43,760 --> 00:18:46,320
found something new maybe the blue team

465
00:18:46,320 --> 00:18:49,600
observed a real attacker doing something

466
00:18:49,600 --> 00:18:50,400
new

467
00:18:50,400 --> 00:18:52,160
you can still work with that it doesn't

468
00:18:52,160 --> 00:18:54,720
actually have to be on attack tech is a

469
00:18:54,720 --> 00:18:56,960
great way to start

470
00:18:56,960 --> 00:18:59,360
now if you do see something new do

471
00:18:59,360 --> 00:19:02,320
contribute it to attack attack has a

472
00:19:02,320 --> 00:19:04,799
sightings so you can actually let them

473
00:19:04,799 --> 00:19:05,600
know

474
00:19:05,600 --> 00:19:08,559
and uh they'll get added to the next

475
00:19:08,559 --> 00:19:10,720
version of mitre attack

476
00:19:10,720 --> 00:19:12,720
so regardless of where the cti comes

477
00:19:12,720 --> 00:19:13,919
from

478
00:19:13,919 --> 00:19:17,840
it has now triggered our process our

479
00:19:17,840 --> 00:19:20,799
operationalized purple team process so

480
00:19:20,799 --> 00:19:23,440
we notify the purple team you can do

481
00:19:23,440 --> 00:19:25,600
this and through a ticketing system you

482
00:19:25,600 --> 00:19:27,520
can do it through a tracker there's

483
00:19:27,520 --> 00:19:29,520
multiple ways of actually implementing

484
00:19:29,520 --> 00:19:32,320
this right uh from project management

485
00:19:32,320 --> 00:19:34,720
tools to um

486
00:19:34,720 --> 00:19:36,880
to even your vulnerability management

487
00:19:36,880 --> 00:19:38,960
solution that you currently have

488
00:19:38,960 --> 00:19:41,440
to any ticketing system right so however

489
00:19:41,440 --> 00:19:45,200
you want to integrate it you notify

490
00:19:45,200 --> 00:19:46,880
everyone that's considered part of the

491
00:19:46,880 --> 00:19:49,120
purple team that a new

492
00:19:49,120 --> 00:19:52,960
uh new cti has come in then

493
00:19:52,960 --> 00:19:56,000
you can either self-assign this so i'm

494
00:19:56,000 --> 00:19:57,760
looking i see oh look something new came

495
00:19:57,760 --> 00:20:00,320
in oh i like the default report let me

496
00:20:00,320 --> 00:20:02,640
assign this to myself or of course a

497
00:20:02,640 --> 00:20:05,360
manager can assign this to you

498
00:20:05,360 --> 00:20:08,080
essentially you need cyber threat intel

499
00:20:08,080 --> 00:20:12,159
red team and uh blue team together so

500
00:20:12,159 --> 00:20:16,240
new cti comes in we initiate the purple

501
00:20:16,240 --> 00:20:19,240
team

502
00:20:38,320 --> 00:20:39,840
all right

503
00:20:39,840 --> 00:20:42,159
so we have initiated

504
00:20:42,159 --> 00:20:45,039
the purple team

505
00:20:45,039 --> 00:20:47,520
that was uh the power rangers if you

506
00:20:47,520 --> 00:20:49,679
have no idea what what you just saw it's

507
00:20:49,679 --> 00:20:53,120
okay it's how i insert comic relief and

508
00:20:53,120 --> 00:20:54,240
a

509
00:20:54,240 --> 00:20:56,720
chance to to have a sip of water while

510
00:20:56,720 --> 00:21:00,480
uh well you all watch a quick video

511
00:21:00,480 --> 00:21:01,520
so

512
00:21:01,520 --> 00:21:04,240
we have brought the red uh the red blue

513
00:21:04,240 --> 00:21:06,720
and cti teams together

514
00:21:06,720 --> 00:21:09,280
our next step here is to analyze and

515
00:21:09,280 --> 00:21:11,520
organize the ttps

516
00:21:11,520 --> 00:21:14,000
and in that step we need to extract the

517
00:21:14,000 --> 00:21:16,159
tactics techniques and procedures the

518
00:21:16,159 --> 00:21:21,760
behaviors and map them to mitre attack

519
00:21:27,360 --> 00:21:29,760
so one of the reasons i like the d4

520
00:21:29,760 --> 00:21:30,720
report

521
00:21:30,720 --> 00:21:34,000
is that they do some attack mapping for

522
00:21:34,000 --> 00:21:36,000
you over here on the right you actually

523
00:21:36,000 --> 00:21:37,039
can see

524
00:21:37,039 --> 00:21:38,960
this is the bottom of that rapport and

525
00:21:38,960 --> 00:21:41,440
i'm gonna demo it here shortly

526
00:21:41,440 --> 00:21:43,919
and there's already some miter attack

527
00:21:43,919 --> 00:21:44,960
mapping

528
00:21:44,960 --> 00:21:47,520
now the thing with miter attack is that

529
00:21:47,520 --> 00:21:48,559
these are

530
00:21:48,559 --> 00:21:50,480
techniques

531
00:21:50,480 --> 00:21:53,520
not procedures right ttps are actually

532
00:21:53,520 --> 00:21:55,039
three different things

533
00:21:55,039 --> 00:21:57,120
tactics which are the goal of the

534
00:21:57,120 --> 00:22:00,480
attacker to gain initial access

535
00:22:00,480 --> 00:22:02,000
a technique

536
00:22:02,000 --> 00:22:04,480
spearfishing with a link

537
00:22:04,480 --> 00:22:08,240
and an actual procedure of how did they

538
00:22:08,240 --> 00:22:11,440
do that spear phishing email right

539
00:22:11,440 --> 00:22:12,559
so

540
00:22:12,559 --> 00:22:16,080
while mapping to miter attack is great

541
00:22:16,080 --> 00:22:17,760
in purple teaming and adversary

542
00:22:17,760 --> 00:22:20,559
emulation we actually need procedure

543
00:22:20,559 --> 00:22:22,559
level details

544
00:22:22,559 --> 00:22:25,679
and the d4 report is great at providing

545
00:22:25,679 --> 00:22:27,280
those procedures

546
00:22:27,280 --> 00:22:28,080
but

547
00:22:28,080 --> 00:22:30,919
they're not provided in a

548
00:22:30,919 --> 00:22:32,960
consumable way

549
00:22:32,960 --> 00:22:34,640
we have to consume them and go through

550
00:22:34,640 --> 00:22:36,159
our process which i'm going to show you

551
00:22:36,159 --> 00:22:38,240
here so let's just read a little bit

552
00:22:38,240 --> 00:22:41,280
from the top here the malware bazaar

553
00:22:41,280 --> 00:22:44,000
loader was delivered to an endpoint via

554
00:22:44,000 --> 00:22:47,200
email which included a link to onedrive

555
00:22:47,200 --> 00:22:49,520
the onedrive link directed the user to

556
00:22:49,520 --> 00:22:52,000
download a file that was a sip which

557
00:22:52,000 --> 00:22:54,400
included an iso inside

558
00:22:54,400 --> 00:22:56,559
once open mounted

559
00:22:56,559 --> 00:22:59,200
on the user system it was determined the

560
00:22:59,200 --> 00:23:04,159
iso contained a link file and a dll

561
00:23:04,159 --> 00:23:08,080
the link file masqueraded as a document

562
00:23:08,080 --> 00:23:12,159
enticing the user to click and open it

563
00:23:12,159 --> 00:23:14,880
once the user executed the link file the

564
00:23:14,880 --> 00:23:18,400
bizarre loader infection was initiated

565
00:23:18,400 --> 00:23:21,280
that's a great paragraph it tells us a

566
00:23:21,280 --> 00:23:22,640
lot

567
00:23:22,640 --> 00:23:24,640
were you able to pick out

568
00:23:24,640 --> 00:23:25,679
all the

569
00:23:25,679 --> 00:23:28,720
ttps from there

570
00:23:29,440 --> 00:23:32,320
spear phishing link right with a one

571
00:23:32,320 --> 00:23:33,520
drive

572
00:23:33,520 --> 00:23:36,960
there was an iso file there was a sip

573
00:23:36,960 --> 00:23:38,960
file those are defensive asian

574
00:23:38,960 --> 00:23:40,159
techniques

575
00:23:40,159 --> 00:23:42,400
there was a link file which required

576
00:23:42,400 --> 00:23:45,840
user execution that's another technique

577
00:23:45,840 --> 00:23:48,240
and there was a dll

578
00:23:48,240 --> 00:23:51,360
so quite a bit of ttps there

579
00:23:51,360 --> 00:23:55,200
um just uh in that one

580
00:23:55,200 --> 00:23:56,400
paragraph

581
00:23:56,400 --> 00:23:57,360
so let's

582
00:23:57,360 --> 00:23:59,679
take a look at some more graphical views

583
00:23:59,679 --> 00:24:01,679
so the default report also provides a

584
00:24:01,679 --> 00:24:04,240
timeline we can see here the original

585
00:24:04,240 --> 00:24:08,000
execution was from a downloaded bazaar

586
00:24:08,000 --> 00:24:11,279
loader sip from one drive that had a iso

587
00:24:11,279 --> 00:24:12,320
mounted

588
00:24:12,320 --> 00:24:17,120
has a dllx executed and it had c2

589
00:24:17,120 --> 00:24:20,240
command and control to some ip on port

590
00:24:20,240 --> 00:24:22,159
443

591
00:24:22,159 --> 00:24:24,480
oh c2 as well

592
00:24:24,480 --> 00:24:26,159
and down on the bottom we also have

593
00:24:26,159 --> 00:24:29,039
another image that this iso file had a

594
00:24:29,039 --> 00:24:30,799
dll

595
00:24:30,799 --> 00:24:34,320
and a documents dot link that documents

596
00:24:34,320 --> 00:24:37,520
dot link rand run dll32.exe

597
00:24:37,520 --> 00:24:40,120
with a dll called

598
00:24:40,120 --> 00:24:43,120
sharedfiles.dll and an entry point of

599
00:24:43,120 --> 00:24:45,760
basic score

600
00:24:45,760 --> 00:24:46,640
okay

601
00:24:46,640 --> 00:24:49,279
so let's analyze this for real now we

602
00:24:49,279 --> 00:24:51,279
read through this and let's break it

603
00:24:51,279 --> 00:24:53,440
down over on the right we have our

604
00:24:53,440 --> 00:24:56,640
actual procedures so tactics the goal

605
00:24:56,640 --> 00:24:59,600
initial access that was through

606
00:24:59,600 --> 00:25:02,000
a spear phishing link and the procedure

607
00:25:02,000 --> 00:25:04,080
was the malware was delivered to an

608
00:25:04,080 --> 00:25:06,480
endpoint via email which included a link

609
00:25:06,480 --> 00:25:08,799
to onedrive

610
00:25:08,799 --> 00:25:10,159
then

611
00:25:10,159 --> 00:25:12,000
there was an iso

612
00:25:12,000 --> 00:25:13,919
an iso

613
00:25:13,919 --> 00:25:14,720
is

614
00:25:14,720 --> 00:25:15,600
a

615
00:25:15,600 --> 00:25:19,120
defense evasion technique

616
00:25:19,120 --> 00:25:20,720
and

617
00:25:20,720 --> 00:25:22,960
we know this because i've actually done

618
00:25:22,960 --> 00:25:24,960
some work on that one before

619
00:25:24,960 --> 00:25:27,520
uh so the ttp for that is actually one

620
00:25:27,520 --> 00:25:29,440
five five three zero zero five which is

621
00:25:29,440 --> 00:25:32,080
subvert trust controls mark of the web

622
00:25:32,080 --> 00:25:33,200
bypass

623
00:25:33,200 --> 00:25:35,279
mark of the web we'll talk about this in

624
00:25:35,279 --> 00:25:36,720
a little bit

625
00:25:36,720 --> 00:25:37,520
then

626
00:25:37,520 --> 00:25:39,600
there was a that link

627
00:25:39,600 --> 00:25:43,200
uh ran or run dll dll32

628
00:25:43,200 --> 00:25:45,760
there's user execution right the user

629
00:25:45,760 --> 00:25:47,919
actually has to double click

630
00:25:47,919 --> 00:25:50,640
that uh link so we have user execution

631
00:25:50,640 --> 00:25:54,880
there and then c2 was set up over 443 so

632
00:25:54,880 --> 00:25:57,200
command and control is the tactic and

633
00:25:57,200 --> 00:25:58,799
the technique is application layer

634
00:25:58,799 --> 00:26:02,320
protocol over web protocols https

635
00:26:02,320 --> 00:26:03,760
and then

636
00:26:03,760 --> 00:26:06,080
buzzer loader was observed executing the

637
00:26:06,080 --> 00:26:08,240
well-known uh

638
00:26:08,240 --> 00:26:10,559
windows discovery commands 10 minutes

639
00:26:10,559 --> 00:26:12,320
after execution

640
00:26:12,320 --> 00:26:13,200
so

641
00:26:13,200 --> 00:26:14,799
let's take a look at this let's jump

642
00:26:14,799 --> 00:26:16,960
into our first demo here

643
00:26:16,960 --> 00:26:19,919
and uh again shout out to the default

644
00:26:19,919 --> 00:26:21,279
report

645
00:26:21,279 --> 00:26:24,640
we uh read this first paragraph here

646
00:26:24,640 --> 00:26:28,400
and extracted a number of ttps right at

647
00:26:28,400 --> 00:26:31,120
the procedure level but we can continue

648
00:26:31,120 --> 00:26:33,520
to read the case summary and as we go

649
00:26:33,520 --> 00:26:35,679
down there's a timeline which is

650
00:26:35,679 --> 00:26:37,120
fantastic

651
00:26:37,120 --> 00:26:39,360
right covers three days of this

652
00:26:39,360 --> 00:26:40,880
particular attack

653
00:26:40,880 --> 00:26:43,279
and then it's broken down by

654
00:26:43,279 --> 00:26:46,799
technique uh tactic initial access via

655
00:26:46,799 --> 00:26:48,720
one drive link we get more information

656
00:26:48,720 --> 00:26:50,480
about that

657
00:26:50,480 --> 00:26:53,120
when uh the link is downloaded it's a

658
00:26:53,120 --> 00:26:54,880
dot sip and actually here we see the

659
00:26:54,880 --> 00:26:58,120
name of the sip new dash documents dash

660
00:26:58,120 --> 00:26:59,679
2005

661
00:26:59,679 --> 00:27:01,200
thousand five that doesn't sound like

662
00:27:01,200 --> 00:27:03,039
new documents but okay

663
00:27:03,039 --> 00:27:04,960
uh i guess it worked in this particular

664
00:27:04,960 --> 00:27:06,880
instance

665
00:27:06,880 --> 00:27:10,559
and then that brings down an iso

666
00:27:10,559 --> 00:27:13,600
then we have execution another tactic

667
00:27:13,600 --> 00:27:16,799
how did that happen we see run dll and

668
00:27:16,799 --> 00:27:18,720
look here we actually see the shortcut

669
00:27:18,720 --> 00:27:21,760
it's a documents is the name

670
00:27:21,760 --> 00:27:22,880
and

671
00:27:22,880 --> 00:27:25,440
it has a little documents icon but the

672
00:27:25,440 --> 00:27:28,640
target actually runs run dll32

673
00:27:28,640 --> 00:27:29,840
with

674
00:27:29,840 --> 00:27:32,480
uh pulling in that shared dll and the

675
00:27:32,480 --> 00:27:34,640
entry point of basic score this is all

676
00:27:34,640 --> 00:27:37,039
going to be important for emulation

677
00:27:37,039 --> 00:27:39,279
and here we have that image i showed

678
00:27:39,279 --> 00:27:40,640
and

679
00:27:40,640 --> 00:27:43,279
two of the c2ips are the ips important

680
00:27:43,279 --> 00:27:44,240
to us

681
00:27:44,240 --> 00:27:46,559
no right we're not going to use those

682
00:27:46,559 --> 00:27:49,360
ips in our attack we're not simulating

683
00:27:49,360 --> 00:27:51,440
we're emulating

684
00:27:51,440 --> 00:27:52,960
and so there's a bit of that there's

685
00:27:52,960 --> 00:27:54,320
persistence

686
00:27:54,320 --> 00:27:56,720
and actually it isn't all the way until

687
00:27:56,720 --> 00:27:59,760
we get to discovery

688
00:27:59,760 --> 00:28:01,760
that we actually find the next set of

689
00:28:01,760 --> 00:28:05,520
steps see the attacker did discovery 10

690
00:28:05,520 --> 00:28:06,880
minutes in

691
00:28:06,880 --> 00:28:09,039
but in this threat intel report we

692
00:28:09,039 --> 00:28:12,000
actually had to scroll down quite a bit

693
00:28:12,000 --> 00:28:15,120
to find that that is when they did that

694
00:28:15,120 --> 00:28:18,399
right and here we have some discovery

695
00:28:18,399 --> 00:28:21,279
then they executed cobalt strike

696
00:28:21,279 --> 00:28:23,120
surprise surprise it's a ransomware

697
00:28:23,120 --> 00:28:26,000
attack of course they used cobalt strike

698
00:28:26,000 --> 00:28:29,440
and then they ran some other procedures

699
00:28:29,440 --> 00:28:31,600
and then on the second day they did more

700
00:28:31,600 --> 00:28:34,880
discovery so while the differ report

701
00:28:34,880 --> 00:28:38,000
breaks us up in mitre attack tactics

702
00:28:38,000 --> 00:28:40,480
we still need to analyze and organize

703
00:28:40,480 --> 00:28:41,360
these

704
00:28:41,360 --> 00:28:44,559
in uh our method so just so you see how

705
00:28:44,559 --> 00:28:47,200
i go through these i break them down by

706
00:28:47,200 --> 00:28:49,919
tactic technique and procedure and build

707
00:28:49,919 --> 00:28:54,240
them out in a time method so very this

708
00:28:54,240 --> 00:28:57,120
is the table i showed earlier

709
00:28:57,120 --> 00:28:59,760
we wrapped up with the bazaar loader

710
00:28:59,760 --> 00:29:02,640
observed executing 10 minutes later that

711
00:29:02,640 --> 00:29:05,919
is a time-based evasion then discovery

712
00:29:05,919 --> 00:29:09,200
multiple commands ran some with typos

713
00:29:09,200 --> 00:29:10,799
um

714
00:29:10,799 --> 00:29:14,480
and then they executed run dll32 again

715
00:29:14,480 --> 00:29:16,880
then they did process injection then

716
00:29:16,880 --> 00:29:20,640
they did discovery again etc so as we go

717
00:29:20,640 --> 00:29:22,480
through this this is what i mean by

718
00:29:22,480 --> 00:29:25,600
analyze and organize

719
00:29:25,600 --> 00:29:26,399
so

720
00:29:26,399 --> 00:29:27,600
that is

721
00:29:27,600 --> 00:29:29,679
um a little quick demo there on the

722
00:29:29,679 --> 00:29:31,279
threat intel part

723
00:29:31,279 --> 00:29:34,559
we have built this uh

724
00:29:34,559 --> 00:29:35,760
essentially

725
00:29:35,760 --> 00:29:37,840
spreadsheet because that's the number

726
00:29:37,840 --> 00:29:41,520
one infosec tool used the top tool ever

727
00:29:41,520 --> 00:29:44,399
used by any infosight professional is uh

728
00:29:44,399 --> 00:29:46,960
is a spreadsheet right so we've built

729
00:29:46,960 --> 00:29:50,399
that out and now the question is

730
00:29:50,399 --> 00:29:53,039
is there anything net new here well they

731
00:29:53,039 --> 00:29:55,039
use cobalt strike we've tested that

732
00:29:55,039 --> 00:29:56,880
right until our heart's content

733
00:29:56,880 --> 00:29:59,120
hopefully everyone can detect some

734
00:29:59,120 --> 00:30:01,520
cobalt strike in their environment but

735
00:30:01,520 --> 00:30:02,960
really

736
00:30:02,960 --> 00:30:05,520
spear phishing we've done that

737
00:30:05,520 --> 00:30:09,200
uh run dll32 you should have definitely

738
00:30:09,200 --> 00:30:11,039
tested that one already have some

739
00:30:11,039 --> 00:30:13,039
detections in place because

740
00:30:13,039 --> 00:30:16,880
lots of ransomware uses run dll32 really

741
00:30:16,880 --> 00:30:19,520
the the one that stood out here

742
00:30:19,520 --> 00:30:23,360
was that they used an iso image

743
00:30:23,360 --> 00:30:25,440
what is an iso image

744
00:30:25,440 --> 00:30:28,159
how does an iso image work

745
00:30:28,159 --> 00:30:31,200
that an iso image was like to burn cds

746
00:30:31,200 --> 00:30:33,679
back in the day for those young folks

747
00:30:33,679 --> 00:30:36,720
out there before streaming we had cds

748
00:30:36,720 --> 00:30:38,640
and we used to burn them it was a lot of

749
00:30:38,640 --> 00:30:41,440
fun and not burn with fire burning is uh

750
00:30:41,440 --> 00:30:43,279
building a cra i'm getting too much into

751
00:30:43,279 --> 00:30:45,279
that hopefully everyone knows what a cd

752
00:30:45,279 --> 00:30:47,840
is and we use iso images for that right

753
00:30:47,840 --> 00:30:49,679
to this day you can download an iso

754
00:30:49,679 --> 00:30:52,480
image for say installing the latest

755
00:30:52,480 --> 00:30:54,000
version of windows nowadays you would

756
00:30:54,000 --> 00:30:56,559
put down a usb put your machine up you

757
00:30:56,559 --> 00:30:59,279
install from that iso image

758
00:30:59,279 --> 00:31:01,919
now the interesting part of an iso image

759
00:31:01,919 --> 00:31:02,720
is

760
00:31:02,720 --> 00:31:07,279
that it is not formatted in ntfs

761
00:31:07,279 --> 00:31:10,559
ntfs is the file system structure that

762
00:31:10,559 --> 00:31:13,279
was introduced with windows nt that

763
00:31:13,279 --> 00:31:15,840
stands for new technology came out

764
00:31:15,840 --> 00:31:16,880
around

765
00:31:16,880 --> 00:31:18,720
2000

766
00:31:18,720 --> 00:31:21,760
uh yeah poor naming convention but

767
00:31:21,760 --> 00:31:24,799
we still use it today

768
00:31:24,799 --> 00:31:27,360
the ntfs file system

769
00:31:27,360 --> 00:31:29,919
allows for alternate data streams

770
00:31:29,919 --> 00:31:32,000
alternate data streams means that you

771
00:31:32,000 --> 00:31:34,880
can put different streams into what

772
00:31:34,880 --> 00:31:36,799
appears to be a single file

773
00:31:36,799 --> 00:31:39,519
and that is how mark of the web works so

774
00:31:39,519 --> 00:31:41,120
when you download something from the

775
00:31:41,120 --> 00:31:43,039
internet and you try to run it on

776
00:31:43,039 --> 00:31:45,360
windows you generally get a message

777
00:31:45,360 --> 00:31:48,399
right it's called smart screen pops up

778
00:31:48,399 --> 00:31:50,399
and says hey you downloaded this from

779
00:31:50,399 --> 00:31:52,320
the internet are you sure you want to

780
00:31:52,320 --> 00:31:54,240
open that and of course everyone clicks

781
00:31:54,240 --> 00:31:56,880
yeah open it anyway but it's a defensive

782
00:31:56,880 --> 00:31:58,480
mechanism right

783
00:31:58,480 --> 00:32:00,559
you might download a document you open

784
00:32:00,559 --> 00:32:02,799
that document it says we're not enabling

785
00:32:02,799 --> 00:32:04,720
editing here because you downloaded this

786
00:32:04,720 --> 00:32:06,000
from the internet

787
00:32:06,000 --> 00:32:08,960
that is done through mark of the web

788
00:32:08,960 --> 00:32:11,440
now an iso file

789
00:32:11,440 --> 00:32:14,960
is not formatted in ntfs and therefore

790
00:32:14,960 --> 00:32:17,440
it cannot use alternate data streams

791
00:32:17,440 --> 00:32:20,399
which means the file cannot be marked as

792
00:32:20,399 --> 00:32:22,799
being downloaded from the internet

793
00:32:22,799 --> 00:32:24,559
whoa cool

794
00:32:24,559 --> 00:32:28,000
so attackers are putting their malware

795
00:32:28,000 --> 00:32:30,080
in iso images

796
00:32:30,080 --> 00:32:31,840
so that

797
00:32:31,840 --> 00:32:33,760
they get around this control

798
00:32:33,760 --> 00:32:38,600
and that is technique 1553.005

799
00:32:38,640 --> 00:32:41,039
subverts trust controls with mark of the

800
00:32:41,039 --> 00:32:44,080
web bypass so essentially you create an

801
00:32:44,080 --> 00:32:45,360
iso

802
00:32:45,360 --> 00:32:47,600
you put in a shortcut

803
00:32:47,600 --> 00:32:49,360
you put in a dll

804
00:32:49,360 --> 00:32:52,240
the shortcut executes run dll32

805
00:32:52,240 --> 00:32:55,360
you then sip the iso and you upload it

806
00:32:55,360 --> 00:32:57,440
to a public onedrive

807
00:32:57,440 --> 00:32:58,720
onedrive

808
00:32:58,720 --> 00:33:00,880
you've probably tested this you either

809
00:33:00,880 --> 00:33:03,279
allow access to onedrive or you don't

810
00:33:03,279 --> 00:33:05,120
allow access to onedrive you may be

811
00:33:05,120 --> 00:33:08,080
monitoring onedrive if you are bless you

812
00:33:08,080 --> 00:33:10,720
uh because there's a lot of stuff on one

813
00:33:10,720 --> 00:33:11,840
drive right

814
00:33:11,840 --> 00:33:12,720
so

815
00:33:12,720 --> 00:33:14,559
we look and we see have we tested this

816
00:33:14,559 --> 00:33:17,039
before now if you haven't tested this

817
00:33:17,039 --> 00:33:18,320
before

818
00:33:18,320 --> 00:33:21,279
where would you look to find a test

819
00:33:21,279 --> 00:33:22,799
atomic red team

820
00:33:22,799 --> 00:33:26,080
atomic red team is a free project uh

821
00:33:26,080 --> 00:33:28,880
sponsored and uh ran by red canary

822
00:33:28,880 --> 00:33:31,519
actually shout out to adam mashinshi uh

823
00:33:31,519 --> 00:33:33,760
who's one of the the folks over at red

824
00:33:33,760 --> 00:33:35,360
canary

825
00:33:35,360 --> 00:33:36,840
um

826
00:33:36,840 --> 00:33:40,320
uh and

827
00:33:40,320 --> 00:33:42,320
they have a bunch of

828
00:33:42,320 --> 00:33:44,080
simple tests

829
00:33:44,080 --> 00:33:46,880
an atomic test one test

830
00:33:46,880 --> 00:33:49,120
that allows you to emulate so you go to

831
00:33:49,120 --> 00:33:52,120
atomic red team look up this ttp

832
00:33:52,120 --> 00:33:53,919
t1553.005 and

833
00:33:53,919 --> 00:33:55,519
it's not there

834
00:33:55,519 --> 00:33:57,519
all right guess we got to build it

835
00:33:57,519 --> 00:33:59,120
ourselves

836
00:33:59,120 --> 00:34:01,360
so we move on to step three

837
00:34:01,360 --> 00:34:03,279
step three

838
00:34:03,279 --> 00:34:04,080
we

839
00:34:04,080 --> 00:34:06,480
have a tabletop discussion you say look

840
00:34:06,480 --> 00:34:08,960
what's net new here

841
00:34:08,960 --> 00:34:11,679
iso files adversaries are using iso

842
00:34:11,679 --> 00:34:14,399
files now so what's our visibility there

843
00:34:14,399 --> 00:34:16,480
how can an iso file get into our

844
00:34:16,480 --> 00:34:18,480
organization well

845
00:34:18,480 --> 00:34:20,320
you can click on a link and download an

846
00:34:20,320 --> 00:34:22,719
iso from the internet you can click and

847
00:34:22,719 --> 00:34:25,199
download a sip from the internet

848
00:34:25,199 --> 00:34:29,760
or maybe from an internal site

849
00:34:29,760 --> 00:34:33,040
what about an iso attached to an email

850
00:34:33,040 --> 00:34:36,000
hmm do we have detections there where

851
00:34:36,000 --> 00:34:38,000
would we have those detections well

852
00:34:38,000 --> 00:34:40,320
maybe our external security provider can

853
00:34:40,320 --> 00:34:43,119
block iso files from coming in because

854
00:34:43,119 --> 00:34:45,520
why would an iso file come in right or

855
00:34:45,520 --> 00:34:47,520
maybe it is used do we have any

856
00:34:47,520 --> 00:34:50,159
detections okay and you

857
00:34:50,159 --> 00:34:52,079
brainstorm these

858
00:34:52,079 --> 00:34:55,599
once the iso is in though

859
00:34:55,599 --> 00:34:57,760
all it takes is a user double clicking

860
00:34:57,760 --> 00:35:01,200
and that mounts the iso

861
00:35:01,200 --> 00:35:04,000
any detections there

862
00:35:04,000 --> 00:35:06,160
what about executing something from an

863
00:35:06,160 --> 00:35:08,720
iso

864
00:35:09,040 --> 00:35:11,680
and unmounting the iso and you have this

865
00:35:11,680 --> 00:35:14,079
tabletop discussion with

866
00:35:14,079 --> 00:35:16,800
the team with the purple team

867
00:35:16,800 --> 00:35:19,760
then step four you emulate the attack

868
00:35:19,760 --> 00:35:22,400
right this is would be the red team

869
00:35:22,400 --> 00:35:24,880
has to figure out how to create an iso

870
00:35:24,880 --> 00:35:26,320
right so

871
00:35:26,320 --> 00:35:27,839
if you go do a little bit of googling

872
00:35:27,839 --> 00:35:30,240
you find some stuff uh twitter is one of

873
00:35:30,240 --> 00:35:32,880
my favorite places so shout out to uh

874
00:35:32,880 --> 00:35:36,079
matt grabber at manifestation who posted

875
00:35:36,079 --> 00:35:38,160
uh some stuff on this

876
00:35:38,160 --> 00:35:40,240
um outflank also talked a little about

877
00:35:40,240 --> 00:35:42,720
mark of the web i wrote a blog post on

878
00:35:42,720 --> 00:35:44,640
scythe about mark of the web but we

879
00:35:44,640 --> 00:35:47,599
actually hadn't done it through iso

880
00:35:47,599 --> 00:35:49,440
so did a little bit of work there to

881
00:35:49,440 --> 00:35:51,359
figure that one out

882
00:35:51,359 --> 00:35:54,880
and what about creating a link file

883
00:35:54,880 --> 00:35:56,160
most people know how to create a

884
00:35:56,160 --> 00:35:59,520
shortcut well my friend john may sean

885
00:35:59,520 --> 00:36:00,640
francois

886
00:36:00,640 --> 00:36:01,760
um

887
00:36:01,760 --> 00:36:04,640
over at trusted second a sans instructor

888
00:36:04,640 --> 00:36:06,320
for the purple team

889
00:36:06,320 --> 00:36:09,599
uh curriculum teaches security 699

890
00:36:09,599 --> 00:36:11,280
advanced purple teaming

891
00:36:11,280 --> 00:36:13,440
wrote a little tool

892
00:36:13,440 --> 00:36:15,119
on

893
00:36:15,119 --> 00:36:16,880
generating links

894
00:36:16,880 --> 00:36:19,680
generating little uh dot link files

895
00:36:19,680 --> 00:36:21,920
so we do some work we see some folks

896
00:36:21,920 --> 00:36:24,160
have done some of this and we put it all

897
00:36:24,160 --> 00:36:26,640
together that's what i've done here

898
00:36:26,640 --> 00:36:28,079
essentially

899
00:36:28,079 --> 00:36:30,560
wrote a step by step of how to emulate

900
00:36:30,560 --> 00:36:32,720
this you set up command and control

901
00:36:32,720 --> 00:36:36,079
using https on 443 and

902
00:36:36,079 --> 00:36:39,119
through your c2 you generate a dll

903
00:36:39,119 --> 00:36:40,400
payload

904
00:36:40,400 --> 00:36:41,680
if you don't know how to do that you

905
00:36:41,680 --> 00:36:44,000
need to go watch uh or look up the c2

906
00:36:44,000 --> 00:36:47,760
matrix we show that in multiple c2s not

907
00:36:47,760 --> 00:36:49,440
the scope here right

908
00:36:49,440 --> 00:36:50,560
then

909
00:36:50,560 --> 00:36:54,320
i actually created a folder and a github

910
00:36:54,320 --> 00:36:55,920
uh repo

911
00:36:55,920 --> 00:36:57,680
where you can download and do this very

912
00:36:57,680 --> 00:37:00,480
easily it uses a project called folder

913
00:37:00,480 --> 00:37:03,520
to iso so shout out to that essentially

914
00:37:03,520 --> 00:37:05,040
it's gonna grab everything that's in a

915
00:37:05,040 --> 00:37:07,200
folder and convert it into an iso

916
00:37:07,200 --> 00:37:09,680
so you're going to put your dll into

917
00:37:09,680 --> 00:37:10,960
that folder

918
00:37:10,960 --> 00:37:12,800
you're going to create a short call

919
00:37:12,800 --> 00:37:15,359
shortcut called documents

920
00:37:15,359 --> 00:37:17,119
you're going to set the target

921
00:37:17,119 --> 00:37:20,640
then you're going to run folder to iso

922
00:37:20,640 --> 00:37:23,119
it's going to create this iso you then

923
00:37:23,119 --> 00:37:24,720
sip it

924
00:37:24,720 --> 00:37:27,839
you then upload it to onedrive and get a

925
00:37:27,839 --> 00:37:30,640
public link to it

926
00:37:30,640 --> 00:37:31,440
you

927
00:37:31,440 --> 00:37:33,280
put that link in at a spear phishing

928
00:37:33,280 --> 00:37:36,079
email you send it across someone opens

929
00:37:36,079 --> 00:37:38,320
that email they click on the link it

930
00:37:38,320 --> 00:37:40,880
will download a sip they unzip the

931
00:37:40,880 --> 00:37:43,280
document they double click the iso to

932
00:37:43,280 --> 00:37:46,320
mount it and then they double click

933
00:37:46,320 --> 00:37:49,200
the shortcut to execute yeah lots of

934
00:37:49,200 --> 00:37:51,119
user awareness training would go a long

935
00:37:51,119 --> 00:37:53,760
way in this attack but it's a long chain

936
00:37:53,760 --> 00:37:58,000
so let's do that one here real quick

937
00:37:58,000 --> 00:38:00,240
all right i've actually already created

938
00:38:00,240 --> 00:38:02,400
the sharedfiles.dll

939
00:38:02,400 --> 00:38:04,640
with the entry point uh that we

940
00:38:04,640 --> 00:38:05,680
mentioned

941
00:38:05,680 --> 00:38:08,079
we are going to move this

942
00:38:08,079 --> 00:38:11,680
over to the source directory that uh a

943
00:38:11,680 --> 00:38:13,359
folder to iso

944
00:38:13,359 --> 00:38:15,760
so we put the dll there

945
00:38:15,760 --> 00:38:18,160
here is our documents link here's the

946
00:38:18,160 --> 00:38:20,320
properties of it we can see here

947
00:38:20,320 --> 00:38:22,920
executes run dll32 with

948
00:38:22,920 --> 00:38:26,079
sharedfiles.dll and the entry point of

949
00:38:26,079 --> 00:38:27,520
basic score

950
00:38:27,520 --> 00:38:28,960
so

951
00:38:28,960 --> 00:38:32,320
we're going to want to

952
00:38:32,320 --> 00:38:34,960
go into this directory on a command

953
00:38:34,960 --> 00:38:37,359
prompt

954
00:38:41,760 --> 00:38:44,560
okay we're in that directory

955
00:38:44,560 --> 00:38:47,119
and now we're going to

956
00:38:47,119 --> 00:38:49,680
copy that so

957
00:38:49,680 --> 00:38:52,320
copy and paste again this is all

958
00:38:52,320 --> 00:38:56,000
provided for you here it is run dll32

959
00:38:56,000 --> 00:38:59,800
here's the one liner

960
00:39:04,640 --> 00:39:06,400
here we see it run

961
00:39:06,400 --> 00:39:09,200
and it would have created an iso

962
00:39:09,200 --> 00:39:11,680
right here in our

963
00:39:11,680 --> 00:39:14,400
um downloads folder so

964
00:39:14,400 --> 00:39:16,800
we now need to sip this

965
00:39:16,800 --> 00:39:18,079
so

966
00:39:18,079 --> 00:39:20,560
you can just do send to compress zip

967
00:39:20,560 --> 00:39:22,000
folder

968
00:39:22,000 --> 00:39:23,839
and there you go

969
00:39:23,839 --> 00:39:26,000
now we take this

970
00:39:26,000 --> 00:39:28,560
upload it to one uh onedrive get a

971
00:39:28,560 --> 00:39:29,920
public link

972
00:39:29,920 --> 00:39:31,680
send as a phishing email we're gonna

973
00:39:31,680 --> 00:39:34,079
skip that step again

974
00:39:34,079 --> 00:39:35,040
you

975
00:39:35,040 --> 00:39:40,320
for fishing uh let's move this out to

976
00:39:40,320 --> 00:39:41,440
here

977
00:39:41,440 --> 00:39:43,040
all right so this is one machine called

978
00:39:43,040 --> 00:39:44,320
helios

979
00:39:44,320 --> 00:39:46,079
i have

980
00:39:46,079 --> 00:39:47,119
um

981
00:39:47,119 --> 00:39:49,280
a c2 running over here

982
00:39:49,280 --> 00:39:51,440
this is sky

983
00:39:51,440 --> 00:39:54,839
this is a machine that is our

984
00:39:54,839 --> 00:39:57,839
victim we have placed this over in our

985
00:39:57,839 --> 00:39:59,760
desktop

986
00:39:59,760 --> 00:40:01,920
as if we download it we double click the

987
00:40:01,920 --> 00:40:03,119
zip file

988
00:40:03,119 --> 00:40:06,880
it has an iso we double click the iso it

989
00:40:06,880 --> 00:40:09,200
mounts it as a drive

990
00:40:09,200 --> 00:40:12,720
and if the user double clicks documents

991
00:40:12,720 --> 00:40:14,319
nothing happens

992
00:40:14,319 --> 00:40:16,160
right

993
00:40:16,160 --> 00:40:17,920
um of course we know something's

994
00:40:17,920 --> 00:40:20,480
happening in the background but the user

995
00:40:20,480 --> 00:40:22,800
can actually close all that

996
00:40:22,800 --> 00:40:23,839
and

997
00:40:23,839 --> 00:40:26,079
they have no idea what's going on

998
00:40:26,079 --> 00:40:28,480
if we go over to our c2

999
00:40:28,480 --> 00:40:30,800
we actually have a new

1000
00:40:30,800 --> 00:40:31,920
system

1001
00:40:31,920 --> 00:40:34,319
uh sky just ran in

1002
00:40:34,319 --> 00:40:36,800
process id 30366

1003
00:40:36,800 --> 00:40:38,640
and then we have a shell and of course

1004
00:40:38,640 --> 00:40:41,040
we do everything else right but

1005
00:40:41,040 --> 00:40:42,880
everything else is not in scope of this

1006
00:40:42,880 --> 00:40:44,560
particular attack

1007
00:40:44,560 --> 00:40:48,079
we just did the net new part right

1008
00:40:48,079 --> 00:40:53,040
so we show this attack off um to

1009
00:40:53,040 --> 00:40:56,079
our blue team and our last step here is

1010
00:40:56,079 --> 00:40:58,480
detection engineering so in detection

1011
00:40:58,480 --> 00:41:00,960
engineering again it's a process um

1012
00:41:00,960 --> 00:41:02,960
there's a great detection engineering

1013
00:41:02,960 --> 00:41:06,160
workshop uh by chris peacock he's at

1014
00:41:06,160 --> 00:41:09,680
secure peacock um he's actually running

1015
00:41:09,680 --> 00:41:12,240
runs every month on how to do detection

1016
00:41:12,240 --> 00:41:13,920
engineering again kind of out of scope

1017
00:41:13,920 --> 00:41:15,920
of this but it's another process that

1018
00:41:15,920 --> 00:41:17,920
the blue team follows they come up with

1019
00:41:17,920 --> 00:41:20,800
a hypothesis for example an iso file

1020
00:41:20,800 --> 00:41:23,520
downloaded from the internet by a non-it

1021
00:41:23,520 --> 00:41:25,680
user is suspicious

1022
00:41:25,680 --> 00:41:29,359
an iso file sent via email is suspicious

1023
00:41:29,359 --> 00:41:33,119
and iso mounted uh by a non-it user

1024
00:41:33,119 --> 00:41:35,599
suspicious right and shout out also to

1025
00:41:35,599 --> 00:41:37,599
cyber monk on twitter

1026
00:41:37,599 --> 00:41:40,160
a great person to follow as well uh we

1027
00:41:40,160 --> 00:41:42,560
do a lot of back and forth and uh

1028
00:41:42,560 --> 00:41:45,520
twitter based purple teaming so i was

1029
00:41:45,520 --> 00:41:48,480
working with chris and i said hey chris

1030
00:41:48,480 --> 00:41:50,800
you got a sigma roll for this

1031
00:41:50,800 --> 00:41:54,000
and of course uh being a contributor to

1032
00:41:54,000 --> 00:41:58,079
sigma chris uh peacock from my team has

1033
00:41:58,079 --> 00:42:00,079
a lot of knowledge on this and found

1034
00:42:00,079 --> 00:42:01,680
this one quite quick

1035
00:42:01,680 --> 00:42:02,640
so

1036
00:42:02,640 --> 00:42:04,240
it's a sigma rule if you've never used

1037
00:42:04,240 --> 00:42:07,359
sigma it's great it allows us to build

1038
00:42:07,359 --> 00:42:10,800
these rule sets that you can import into

1039
00:42:10,800 --> 00:42:12,720
basically any

1040
00:42:12,720 --> 00:42:16,319
control you have any sim you have right

1041
00:42:16,319 --> 00:42:18,880
you can try you could put it as elastic

1042
00:42:18,880 --> 00:42:21,119
as splunk wherever you want

1043
00:42:21,119 --> 00:42:23,280
but as you read through this it's not

1044
00:42:23,280 --> 00:42:25,200
exactly what we're looking for this

1045
00:42:25,200 --> 00:42:28,000
detects the amount of an iso image on an

1046
00:42:28,000 --> 00:42:30,640
endpoint and it tells you the log source

1047
00:42:30,640 --> 00:42:32,480
you need which isn't

1048
00:42:32,480 --> 00:42:35,280
important for detection engineering

1049
00:42:35,280 --> 00:42:36,319
so

1050
00:42:36,319 --> 00:42:38,319
when we do detection engineering we need

1051
00:42:38,319 --> 00:42:40,079
to make sure that we're actually logging

1052
00:42:40,079 --> 00:42:42,160
what we need to do we have that data

1053
00:42:42,160 --> 00:42:43,040
source

1054
00:42:43,040 --> 00:42:45,920
is it logged locally

1055
00:42:45,920 --> 00:42:48,000
and of course you might have different

1056
00:42:48,000 --> 00:42:50,880
log sources here right one is the

1057
00:42:50,880 --> 00:42:53,040
mounting of an iso but what about the

1058
00:42:53,040 --> 00:42:55,280
downloading of an iso that would be in

1059
00:42:55,280 --> 00:42:57,520
your proxy

1060
00:42:57,520 --> 00:42:59,440
an email

1061
00:42:59,440 --> 00:43:01,200
with an iso attachment that would be in

1062
00:43:01,200 --> 00:43:02,640
your email

1063
00:43:02,640 --> 00:43:05,280
antivirus no antivirus isn't going to

1064
00:43:05,280 --> 00:43:07,040
catch anything is it

1065
00:43:07,040 --> 00:43:08,800
your edr

1066
00:43:08,800 --> 00:43:11,440
does your edr detect this

1067
00:43:11,440 --> 00:43:12,960
it should

1068
00:43:12,960 --> 00:43:16,000
it might have the capability to but have

1069
00:43:16,000 --> 00:43:18,960
you turned it on right

1070
00:43:18,960 --> 00:43:21,520
biggest problem with ddr is that it's

1071
00:43:21,520 --> 00:43:24,240
not something you just plug in right

1072
00:43:24,240 --> 00:43:26,640
it takes people in process to turn

1073
00:43:26,640 --> 00:43:27,920
things on

1074
00:43:27,920 --> 00:43:30,319
tune them for your environment

1075
00:43:30,319 --> 00:43:33,359
or sysmon sysmon logs right

1076
00:43:33,359 --> 00:43:36,560
then if you log locally is it logged

1077
00:43:36,560 --> 00:43:38,720
centrally

1078
00:43:38,720 --> 00:43:41,440
is it sent somewhere so that you can do

1079
00:43:41,440 --> 00:43:44,079
threat hunting at scale

1080
00:43:44,079 --> 00:43:47,359
and then can you build alerts that are

1081
00:43:47,359 --> 00:43:49,680
fine-tuned and do not create a lot of

1082
00:43:49,680 --> 00:43:52,160
noise well over here on the right randy

1083
00:43:52,160 --> 00:43:55,200
pragman uh who works over at binary

1084
00:43:55,200 --> 00:43:58,400
defense actually again twitter purple

1085
00:43:58,400 --> 00:44:00,319
teaming uh

1086
00:44:00,319 --> 00:44:02,560
posted this and showed me how they were

1087
00:44:02,560 --> 00:44:04,160
detecting this

1088
00:44:04,160 --> 00:44:07,520
and getting alerts uh at their manage

1089
00:44:07,520 --> 00:44:10,800
detection response solution um it's a

1090
00:44:10,800 --> 00:44:14,400
mssp of uh detection response they

1091
00:44:14,400 --> 00:44:16,240
showed the alert and then now that you

1092
00:44:16,240 --> 00:44:20,000
have an alert you repeat this so that

1093
00:44:20,000 --> 00:44:20,800
your

1094
00:44:20,800 --> 00:44:23,839
team when they see this alert they know

1095
00:44:23,839 --> 00:44:27,200
how to respond to it right so again

1096
00:44:27,200 --> 00:44:29,920
shout out to randy

1097
00:44:29,920 --> 00:44:31,280
lastly

1098
00:44:31,280 --> 00:44:33,200
we just built something new

1099
00:44:33,200 --> 00:44:35,040
let's contribute back

1100
00:44:35,040 --> 00:44:37,680
right you did all this work

1101
00:44:37,680 --> 00:44:40,000
why not put it out there i mentioned

1102
00:44:40,000 --> 00:44:42,160
earlier i looked in atomic red team it

1103
00:44:42,160 --> 00:44:45,520
wasn't there so i did the work and then

1104
00:44:45,520 --> 00:44:47,359
i worked um

1105
00:44:47,359 --> 00:44:50,079
with carrie and adam so shout out to

1106
00:44:50,079 --> 00:44:54,400
both of them at red canary uh carrie um

1107
00:44:54,400 --> 00:44:56,240
is one of the main maintainers of atomic

1108
00:44:56,240 --> 00:44:58,880
red team so shout out to her very very

1109
00:44:58,880 --> 00:45:01,119
helpful if you want to contribute to

1110
00:45:01,119 --> 00:45:03,599
atomic red team it's a free resource

1111
00:45:03,599 --> 00:45:05,680
least you can do is contribute right

1112
00:45:05,680 --> 00:45:08,240
if you use it so we put that out there

1113
00:45:08,240 --> 00:45:12,240
and now anyone can run and do this

1114
00:45:12,720 --> 00:45:15,599
so once you start opera operationalizing

1115
00:45:15,599 --> 00:45:18,160
your purple team you can start tracking

1116
00:45:18,160 --> 00:45:19,920
the maturity level

1117
00:45:19,920 --> 00:45:22,480
all right this is again process show

1118
00:45:22,480 --> 00:45:24,240
to your stakeholders that your their

1119
00:45:24,240 --> 00:45:25,920
investment in purple teaming is paying

1120
00:45:25,920 --> 00:45:28,560
off apart from having better detection

1121
00:45:28,560 --> 00:45:31,680
times and uh not getting impacted how is

1122
00:45:31,680 --> 00:45:33,680
the team actually doing this something

1123
00:45:33,680 --> 00:45:35,760
that we built internally

1124
00:45:35,760 --> 00:45:36,800
uh the

1125
00:45:36,800 --> 00:45:38,560
purple team maturity model was built by

1126
00:45:38,560 --> 00:45:40,960
tim schultz who works with me at site

1127
00:45:40,960 --> 00:45:43,200
and a lot of the work here as you saw

1128
00:45:43,200 --> 00:45:45,520
wasn't just me cyber threat intel with

1129
00:45:45,520 --> 00:45:48,000
uh natalie cano from my team

1130
00:45:48,000 --> 00:45:50,240
uh detection engineering from chris

1131
00:45:50,240 --> 00:45:53,040
peacock and we evaluate ourselves on how

1132
00:45:53,040 --> 00:45:54,480
we're improving

1133
00:45:54,480 --> 00:45:56,480
so to wrap up

1134
00:45:56,480 --> 00:45:58,800
purple team can be applied a bunch of

1135
00:45:58,800 --> 00:46:01,119
ways most organizations start with the

1136
00:46:01,119 --> 00:46:03,280
purple team exercise

1137
00:46:03,280 --> 00:46:05,520
they do a couple of these you can do

1138
00:46:05,520 --> 00:46:08,480
larger exercises smaller exercises and

1139
00:46:08,480 --> 00:46:10,480
then you can operationalize the purple

1140
00:46:10,480 --> 00:46:12,560
team now that that collaboration has

1141
00:46:12,560 --> 00:46:14,960
been built you can

1142
00:46:14,960 --> 00:46:17,920
trigger it when new ttps come out

1143
00:46:17,920 --> 00:46:20,720
following our process of analyzing and

1144
00:46:20,720 --> 00:46:23,119
organizing it table topping it emulating

1145
00:46:23,119 --> 00:46:26,000
and detection engineer and you

1146
00:46:26,000 --> 00:46:26,960
uh

1147
00:46:26,960 --> 00:46:28,800
rate yourself and improve through the

1148
00:46:28,800 --> 00:46:30,160
maturity mod

1149
00:46:30,160 --> 00:46:32,079
now if you like this stuff there's more

1150
00:46:32,079 --> 00:46:34,000
content available on threat thursday

1151
00:46:34,000 --> 00:46:36,720
this is a free community resource

1152
00:46:36,720 --> 00:46:39,119
uh essentially it's a blog series along

1153
00:46:39,119 --> 00:46:41,359
with adversary emulation plans we

1154
00:46:41,359 --> 00:46:43,839
introduce an adversary consume the cyber

1155
00:46:43,839 --> 00:46:45,280
threat intel

1156
00:46:45,280 --> 00:46:47,200
map it to mitre attack

1157
00:46:47,200 --> 00:46:49,440
present an adversary emulation plan

1158
00:46:49,440 --> 00:46:51,680
share the adversary emulation plan with

1159
00:46:51,680 --> 00:46:54,560
you on our community threats github it

1160
00:46:54,560 --> 00:46:57,680
is the largest public repository of

1161
00:46:57,680 --> 00:47:00,079
adversary emulation plans available for

1162
00:47:00,079 --> 00:47:01,280
you right there

1163
00:47:01,280 --> 00:47:03,440
then we emulate the adversary we covered

1164
00:47:03,440 --> 00:47:06,240
detection and response and

1165
00:47:06,240 --> 00:47:09,200
of course all free to the community so

1166
00:47:09,200 --> 00:47:11,839
all that is done because we love giving

1167
00:47:11,839 --> 00:47:13,760
back

1168
00:47:13,760 --> 00:47:15,200
if you want to learn more about purple

1169
00:47:15,200 --> 00:47:18,720
team uh and do some formal training we

1170
00:47:18,720 --> 00:47:21,920
have a free purple team workshop it runs

1171
00:47:21,920 --> 00:47:25,200
um at least once or twice a month so

1172
00:47:25,200 --> 00:47:27,599
head over to site dot io slash purple

1173
00:47:27,599 --> 00:47:30,559
dash team dash workshops completely free

1174
00:47:30,559 --> 00:47:32,960
it's about three hours you get your own

1175
00:47:32,960 --> 00:47:35,040
lab environment you don't have to pay

1176
00:47:35,040 --> 00:47:37,280
cloud fees because site pays them for

1177
00:47:37,280 --> 00:47:39,040
you so again just community

1178
00:47:39,040 --> 00:47:41,200
contributions that we love uh tim

1179
00:47:41,200 --> 00:47:45,280
schultz has an operation purple course

1180
00:47:45,280 --> 00:47:48,240
uh available uh and then of course sans

1181
00:47:48,240 --> 00:47:52,079
has two purple team courses security 599

1182
00:47:52,079 --> 00:47:54,240
defeating advance adversaries purple

1183
00:47:54,240 --> 00:47:56,480
team tactics and kill chain defenses

1184
00:47:56,480 --> 00:47:59,200
that one's more around preventing

1185
00:47:59,200 --> 00:48:03,119
and then sec 699 purple team tactics

1186
00:48:03,119 --> 00:48:04,880
adversary emulation for breach

1187
00:48:04,880 --> 00:48:08,160
prevention detection that one's 50 red

1188
00:48:08,160 --> 00:48:11,200
50 blue and the blue part is all

1189
00:48:11,200 --> 00:48:12,559
detection

1190
00:48:12,559 --> 00:48:15,440
no talk of prevention because you can

1191
00:48:15,440 --> 00:48:17,599
only prevent so much it's inevitable

1192
00:48:17,599 --> 00:48:19,359
that someone's going to get in

1193
00:48:19,359 --> 00:48:22,240
the our goal is to detect and respond to

1194
00:48:22,240 --> 00:48:22,960
them

1195
00:48:22,960 --> 00:48:26,000
faster than their impact

1196
00:48:26,000 --> 00:48:28,319
i always put references i did not do any

1197
00:48:28,319 --> 00:48:30,400
of this alone purple team exercise

1198
00:48:30,400 --> 00:48:31,839
framework is free

1199
00:48:31,839 --> 00:48:34,000
uh shout out to the deferred report for

1200
00:48:34,000 --> 00:48:37,760
providing the cti here um on site we put

1201
00:48:37,760 --> 00:48:41,440
this community threat out so not just

1202
00:48:41,440 --> 00:48:43,440
that particular initial access but

1203
00:48:43,440 --> 00:48:45,040
everything from the deferred reports

1204
00:48:45,040 --> 00:48:47,200
available there shout out to everyone on

1205
00:48:47,200 --> 00:48:50,480
twitter um that's helped out red canary

1206
00:48:50,480 --> 00:48:53,520
uh jean mays cyber monk uh the sigma

1207
00:48:53,520 --> 00:48:56,400
project chris peacock tim schultz thank

1208
00:48:56,400 --> 00:48:57,839
you all

1209
00:48:57,839 --> 00:49:01,040
and i put my uh about me page at the end

1210
00:49:01,040 --> 00:49:03,200
because if you're still here you still

1211
00:49:03,200 --> 00:49:05,680
care i appreciate you thank you for your

1212
00:49:05,680 --> 00:49:07,760
time um george ortiz the chief

1213
00:49:07,760 --> 00:49:10,720
technology officer at site um an author

1214
00:49:10,720 --> 00:49:12,960
and co-creator of the purple team

1215
00:49:12,960 --> 00:49:15,760
exercise framework the c2 matrix uh the

1216
00:49:15,760 --> 00:49:18,000
sans red team course i contribute to

1217
00:49:18,000 --> 00:49:20,720
mitre attack atomic red team cvss

1218
00:49:20,720 --> 00:49:23,839
version 3 and 3.1 uh the global

1219
00:49:23,839 --> 00:49:25,920
financial markets association thread led

1220
00:49:25,920 --> 00:49:28,640
pen test framework and i'm a fellow at

1221
00:49:28,640 --> 00:49:31,359
issa and a technologist fellow at the

1222
00:49:31,359 --> 00:49:33,680
national security institute thank you

1223
00:49:33,680 --> 00:49:35,280
again for your time i will take your

1224
00:49:35,280 --> 00:49:37,839
questions on discord and

1225
00:49:37,839 --> 00:49:40,000
have a wonderful day thank you cactus

1226
00:49:40,000 --> 00:49:42,240
khan you all rock

1227
00:49:42,240 --> 00:49:44,880
uh really appreciate you putting this

1228
00:49:44,880 --> 00:49:46,240
together

1229
00:49:46,240 --> 00:49:49,440
and uh we'll talk on discord have a good

1230
00:49:49,440 --> 00:49:52,440
one

1231
00:50:03,040 --> 00:50:05,119
you

