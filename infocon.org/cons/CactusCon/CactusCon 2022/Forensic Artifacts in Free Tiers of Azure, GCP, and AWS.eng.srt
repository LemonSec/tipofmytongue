1
00:00:11,759 --> 00:00:15,440
hey everyone my name is uh kyle norby

2
00:00:15,440 --> 00:00:17,039
before i get started too i just wanted

3
00:00:17,039 --> 00:00:19,199
to uh double up on what uh

4
00:00:19,199 --> 00:00:20,640
charles schreier said in his uh

5
00:00:20,640 --> 00:00:22,080
presentation

6
00:00:22,080 --> 00:00:24,640
it's the passion that you find for

7
00:00:24,640 --> 00:00:26,320
something it might come a little bit

8
00:00:26,320 --> 00:00:27,519
later than other people because you'll

9
00:00:27,519 --> 00:00:29,199
always see those things about like and

10
00:00:29,199 --> 00:00:30,640
it's fantastic

11
00:00:30,640 --> 00:00:32,320
when you have like somebody who's like

12
00:00:32,320 --> 00:00:34,559
16 17 18 like finding their first

13
00:00:34,559 --> 00:00:36,559
vulnerability and stuff too

14
00:00:36,559 --> 00:00:38,640
i wasn't like that it's i decided to get

15
00:00:38,640 --> 00:00:40,480
into security at 27

16
00:00:40,480 --> 00:00:41,600
um

17
00:00:41,600 --> 00:00:44,960
i'm 32 now i'm just now getting into

18
00:00:44,960 --> 00:00:46,640
my real field of passion which i believe

19
00:00:46,640 --> 00:00:49,280
is a dfir too but it's never too late to

20
00:00:49,280 --> 00:00:50,719
find that kind of stuff too so i really

21
00:00:50,719 --> 00:00:54,090
just wanted to hit on that

22
00:00:54,090 --> 00:00:58,719
[Applause]

23
00:00:58,719 --> 00:01:00,640
so here's the best slide in the

24
00:01:00,640 --> 00:01:03,280
presentation

25
00:01:03,600 --> 00:01:06,640
this is uh lena and jupiter jupiter is

26
00:01:06,640 --> 00:01:08,560
the more photogenic one

27
00:01:08,560 --> 00:01:10,880
and uh these are also not answers to any

28
00:01:10,880 --> 00:01:12,400
of my security questions

29
00:01:12,400 --> 00:01:15,360
i have had um one of my banks actually

30
00:01:15,360 --> 00:01:17,360
call me asking why i was trying to give

31
00:01:17,360 --> 00:01:19,280
my cats as a security question then they

32
00:01:19,280 --> 00:01:20,799
realized it wasn't me

33
00:01:20,799 --> 00:01:23,040
so just fyi if you have something you're

34
00:01:23,040 --> 00:01:24,799
proud of really like that never use

35
00:01:24,799 --> 00:01:28,320
those for security questions it's

36
00:01:29,759 --> 00:01:30,799
so

37
00:01:30,799 --> 00:01:33,840
who i am is um i spent a few years over

38
00:01:33,840 --> 00:01:36,240
at uh walmart both in the data loss

39
00:01:36,240 --> 00:01:38,320
prevention team and then i moved over to

40
00:01:38,320 --> 00:01:40,560
the sock after about a year or so

41
00:01:40,560 --> 00:01:42,880
it is a fantastic organization to work

42
00:01:42,880 --> 00:01:45,680
with they're also the ones that uh

43
00:01:45,680 --> 00:01:47,520
really helped me like they saw the

44
00:01:47,520 --> 00:01:49,439
passion that i had for this subject and

45
00:01:49,439 --> 00:01:51,600
they invested into me

46
00:01:51,600 --> 00:01:53,439
which is why i have all those really

47
00:01:53,439 --> 00:01:55,680
expensive certs

48
00:01:55,680 --> 00:01:56,560
um

49
00:01:56,560 --> 00:01:58,240
that being said

50
00:01:58,240 --> 00:02:00,479
if you have to choose any one of those

51
00:02:00,479 --> 00:02:03,520
my personal favorite is the gcia

52
00:02:03,520 --> 00:02:05,360
i failed it two times before passing it

53
00:02:05,360 --> 00:02:07,360
on the third time by and large my

54
00:02:07,360 --> 00:02:10,160
favorite certification and exam that i

55
00:02:10,160 --> 00:02:12,560
went through

56
00:02:14,400 --> 00:02:17,760
currently i work over at uh arista part

57
00:02:17,760 --> 00:02:20,160
of oak security i'm moving over into the

58
00:02:20,160 --> 00:02:22,720
incident response role as an analyst

59
00:02:22,720 --> 00:02:24,959
there and i'm helping out with their

60
00:02:24,959 --> 00:02:27,280
mndr team right now as well too

61
00:02:27,280 --> 00:02:29,920
and i'm also doing a

62
00:02:29,920 --> 00:02:33,760
master's degree through sans as well too

63
00:02:33,760 --> 00:02:36,800
so why i did this presentation um the

64
00:02:36,800 --> 00:02:39,200
first part is because i got social

65
00:02:39,200 --> 00:02:40,959
engineered by my girlfriend who is like

66
00:02:40,959 --> 00:02:43,680
oh i can only expense this if there's

67
00:02:43,680 --> 00:02:45,680
some cloud talks that are at this

68
00:02:45,680 --> 00:02:48,400
conference and so i went okay well i was

69
00:02:48,400 --> 00:02:49,680
going to submit something else but this

70
00:02:49,680 --> 00:02:52,480
seems like a really good subject too

71
00:02:52,480 --> 00:02:55,680
then the second reason is um

72
00:02:55,680 --> 00:02:57,840
everyone who's worked at corporate and

73
00:02:57,840 --> 00:02:59,519
even if you don't like you see stories

74
00:02:59,519 --> 00:03:01,280
about this too security is an

75
00:03:01,280 --> 00:03:03,440
afterthought and sometimes it's the last

76
00:03:03,440 --> 00:03:05,280
thing that they want to think about too

77
00:03:05,280 --> 00:03:08,159
everything goes into the cloud and

78
00:03:08,159 --> 00:03:10,159
security is just something that gets in

79
00:03:10,159 --> 00:03:11,840
the way of uh

80
00:03:11,840 --> 00:03:14,319
doing any sort of business demoing a

81
00:03:14,319 --> 00:03:15,440
project

82
00:03:15,440 --> 00:03:17,440
and it's a real attack vector that i've

83
00:03:17,440 --> 00:03:19,280
seen used in the wild

84
00:03:19,280 --> 00:03:21,760
and these are things that i've seen used

85
00:03:21,760 --> 00:03:23,360
in the cloud

86
00:03:23,360 --> 00:03:25,040
not necessarily

87
00:03:25,040 --> 00:03:27,120
in a corporate environment just for

88
00:03:27,120 --> 00:03:29,680
liability reasons but also just like

89
00:03:29,680 --> 00:03:32,319
helping others out with pro bono ir

90
00:03:32,319 --> 00:03:34,798
stuff too

91
00:03:35,120 --> 00:03:36,319
and

92
00:03:36,319 --> 00:03:39,599
um i don't see any real good aggregate

93
00:03:39,599 --> 00:03:41,280
resources out there for this too i

94
00:03:41,280 --> 00:03:44,080
actually realized that um early last

95
00:03:44,080 --> 00:03:45,440
week too

96
00:03:45,440 --> 00:03:47,920
i had about like i still have like 40 or

97
00:03:47,920 --> 00:03:49,599
50 bookmarks of like just different

98
00:03:49,599 --> 00:03:51,360
things that i was reading and things

99
00:03:51,360 --> 00:03:53,519
that i might want to use later on too

100
00:03:53,519 --> 00:03:55,760
there's no real good aggregate resource

101
00:03:55,760 --> 00:03:56,480
for

102
00:03:56,480 --> 00:03:58,159
trying to figure out these types of

103
00:03:58,159 --> 00:03:59,840
things too it's you can get really

104
00:03:59,840 --> 00:04:02,400
in-depth onto like

105
00:04:02,400 --> 00:04:05,760
a specific part like um cloudwatch over

106
00:04:05,760 --> 00:04:07,680
in aws there's some really good guides

107
00:04:07,680 --> 00:04:09,680
that go super in-depth into it but

108
00:04:09,680 --> 00:04:11,200
actually doing an incident response a

109
00:04:11,200 --> 00:04:12,480
lot of that stuff that i'm finding is

110
00:04:12,480 --> 00:04:14,159
like preparation work that you're going

111
00:04:14,159 --> 00:04:16,880
into it not post incident

112
00:04:16,880 --> 00:04:18,798
and i ended up spending even though it

113
00:04:18,798 --> 00:04:19,918
says free

114
00:04:19,918 --> 00:04:23,120
i'm at about 250 right now and the

115
00:04:23,120 --> 00:04:25,040
coverage gaps that i'm going to identify

116
00:04:25,040 --> 00:04:26,240
are because i really didn't want to

117
00:04:26,240 --> 00:04:28,320
spend more money trying to figure out

118
00:04:28,320 --> 00:04:30,560
like what the pay for solutions were too

119
00:04:30,560 --> 00:04:31,840
so that's something that i really want

120
00:04:31,840 --> 00:04:34,160
to try to explore more or if someone

121
00:04:34,160 --> 00:04:35,600
else has experience in it too that would

122
00:04:35,600 --> 00:04:38,400
be fantastic to hear about

123
00:04:38,400 --> 00:04:42,160
so this week i missed yesterday i spent

124
00:04:42,160 --> 00:04:44,880
the entire week about four days um

125
00:04:44,880 --> 00:04:47,120
completely redoing the presentation

126
00:04:47,120 --> 00:04:49,600
because i just had that idea as like oh

127
00:04:49,600 --> 00:04:51,840
what if i did this and this and this

128
00:04:51,840 --> 00:04:53,600
and so then it was back to the drawing

129
00:04:53,600 --> 00:04:55,280
board and

130
00:04:55,280 --> 00:04:57,759
the fourth time i realized that um i'd

131
00:04:57,759 --> 00:04:59,520
really gotten more proficient in this

132
00:04:59,520 --> 00:05:00,320
too

133
00:05:00,320 --> 00:05:01,280
so

134
00:05:01,280 --> 00:05:02,960
it was a really good experience overall

135
00:05:02,960 --> 00:05:05,039
and i highly recommend anyone that wants

136
00:05:05,039 --> 00:05:07,840
to uh explore any of these ideas like

137
00:05:07,840 --> 00:05:09,280
even if you're doing the same thing over

138
00:05:09,280 --> 00:05:10,560
and over again

139
00:05:10,560 --> 00:05:13,520
very very beneficial and just a good

140
00:05:13,520 --> 00:05:15,039
learning experience too because all of a

141
00:05:15,039 --> 00:05:17,360
sudden it stopped being i'm going to

142
00:05:17,360 --> 00:05:19,120
this article for this it's why is this

143
00:05:19,120 --> 00:05:20,720
article missing this piece of

144
00:05:20,720 --> 00:05:22,800
information too it's you get that very

145
00:05:22,800 --> 00:05:25,199
slow aggregation of information on there

146
00:05:25,199 --> 00:05:26,880
i feel pretty comfortable triaging

147
00:05:26,880 --> 00:05:29,360
endpoints doing ir on endpoints but as

148
00:05:29,360 --> 00:05:31,600
soon as you get into the cloud aspects i

149
00:05:31,600 --> 00:05:33,919
was dead in water i still feel like i am

150
00:05:33,919 --> 00:05:35,840
too even though i've been working with

151
00:05:35,840 --> 00:05:38,560
this now

152
00:05:38,560 --> 00:05:41,440
so for the scope on this here we're

153
00:05:41,440 --> 00:05:43,360
looking to see what we can find with a

154
00:05:43,360 --> 00:05:45,919
crappily setup cloud instance my whole

155
00:05:45,919 --> 00:05:47,520
goal into this

156
00:05:47,520 --> 00:05:50,800
is to try to just do bare bones whatever

157
00:05:50,800 --> 00:05:52,400
is available for the check boxes and

158
00:05:52,400 --> 00:05:54,320
whatever i don't have to initially spend

159
00:05:54,320 --> 00:05:55,520
money on

160
00:05:55,520 --> 00:05:59,199
when building this i have two vms

161
00:05:59,199 --> 00:06:01,440
one is a linux box one is a windows box

162
00:06:01,440 --> 00:06:03,600
if i was able to afford it for the azure

163
00:06:03,600 --> 00:06:05,120
one that was a little out of my price

164
00:06:05,120 --> 00:06:08,240
range and then i have a database set up

165
00:06:08,240 --> 00:06:10,240
just with the easiest one that looked

166
00:06:10,240 --> 00:06:11,919
like for the recommended when i was

167
00:06:11,919 --> 00:06:13,919
going through their process there

168
00:06:13,919 --> 00:06:15,280
and the questions that we really want to

169
00:06:15,280 --> 00:06:17,600
try to answer are what cloud-based logs

170
00:06:17,600 --> 00:06:19,280
are available we can do the endpoint

171
00:06:19,280 --> 00:06:21,440
triage we can go through all of that but

172
00:06:21,440 --> 00:06:23,680
we want to see like what happens if all

173
00:06:23,680 --> 00:06:24,880
we have are just like the cloud

174
00:06:24,880 --> 00:06:27,919
resources what can the cloud tell us

175
00:06:27,919 --> 00:06:29,759
and then we want to try to see if we can

176
00:06:29,759 --> 00:06:31,120
find out what the initial point of

177
00:06:31,120 --> 00:06:32,479
access was

178
00:06:32,479 --> 00:06:34,400
what credentials were compromised if we

179
00:06:34,400 --> 00:06:36,080
could identify anything from those cloud

180
00:06:36,080 --> 00:06:37,120
logs

181
00:06:37,120 --> 00:06:38,960
could we figure out if the data was

182
00:06:38,960 --> 00:06:41,039
x-filled and what and then is there a

183
00:06:41,039 --> 00:06:43,120
threat to the organization currently

184
00:06:43,120 --> 00:06:44,720
like is there something in there that we

185
00:06:44,720 --> 00:06:46,960
saw it's like oh this is commun

186
00:06:46,960 --> 00:06:48,400
communicating back with the home network

187
00:06:48,400 --> 00:06:51,919
or something else that might be a threat

188
00:06:52,000 --> 00:06:54,160
so the concept we have here is we set up

189
00:06:54,160 --> 00:06:56,720
a database and two vms into each cloud

190
00:06:56,720 --> 00:06:59,039
instance we go for cheap we're trying to

191
00:06:59,039 --> 00:07:01,199
go under the company radar

192
00:07:01,199 --> 00:07:02,560
we're trying to spend as little money as

193
00:07:02,560 --> 00:07:04,160
possible because we don't want the

194
00:07:04,160 --> 00:07:06,560
organization to know like oh

195
00:07:06,560 --> 00:07:08,479
we spun up a cloud instance to demo this

196
00:07:08,479 --> 00:07:09,840
project

197
00:07:09,840 --> 00:07:11,919
and then we go for default settings and

198
00:07:11,919 --> 00:07:12,639
so

199
00:07:12,639 --> 00:07:14,639
the idea is that we get all of this set

200
00:07:14,639 --> 00:07:16,960
up we get live data out on there

201
00:07:16,960 --> 00:07:19,360
and then as soon as we're ready to start

202
00:07:19,360 --> 00:07:22,000
handing over um some access apis and

203
00:07:22,000 --> 00:07:24,000
everything over to the vendors

204
00:07:24,000 --> 00:07:25,680
uh oh it looks like something got

205
00:07:25,680 --> 00:07:27,360
compromised we're seeing stuff we didn't

206
00:07:27,360 --> 00:07:29,360
have in there and so that's the point

207
00:07:29,360 --> 00:07:32,080
when security gets involved

208
00:07:32,080 --> 00:07:33,199
so

209
00:07:33,199 --> 00:07:36,000
current status we're told that there's

210
00:07:36,000 --> 00:07:37,840
an unapproved instance of a cloud

211
00:07:37,840 --> 00:07:40,000
provider that's out there hey

212
00:07:40,000 --> 00:07:42,080
we didn't use the company one we just

213
00:07:42,080 --> 00:07:44,400
made our own and also we had live data

214
00:07:44,400 --> 00:07:46,879
in there and we don't even recognize one

215
00:07:46,879 --> 00:07:50,240
of those vms like we didn't set that up

216
00:07:50,240 --> 00:07:52,319
and so we want to invest we do an

217
00:07:52,319 --> 00:07:55,199
initial investigation and we figure out

218
00:07:55,199 --> 00:07:56,319
that um

219
00:07:56,319 --> 00:07:58,319
very likely just based on some onset and

220
00:07:58,319 --> 00:07:59,199
everything

221
00:07:59,199 --> 00:08:01,120
this was very likely just something that

222
00:08:01,120 --> 00:08:02,960
was uh on github because they were

223
00:08:02,960 --> 00:08:04,560
trying to prep it for the vendors or

224
00:08:04,560 --> 00:08:07,120
something and it's pretty clear that

225
00:08:07,120 --> 00:08:08,639
there's a malicious actor that has

226
00:08:08,639 --> 00:08:10,840
abused it just on first initial

227
00:08:10,840 --> 00:08:14,000
looks so here is a

228
00:08:14,000 --> 00:08:15,840
student repo that i found too but this

229
00:08:15,840 --> 00:08:18,560
is a perfect example where you can just

230
00:08:18,560 --> 00:08:19,440
like

231
00:08:19,440 --> 00:08:21,520
search username and password in the

232
00:08:21,520 --> 00:08:23,360
github search bar don't even have to

233
00:08:23,360 --> 00:08:25,440
like do any advanced dorks or anything

234
00:08:25,440 --> 00:08:26,720
you just start getting stuff like this

235
00:08:26,720 --> 00:08:29,039
popping up too it's a very real attack

236
00:08:29,039 --> 00:08:30,879
vector and if your organization is not

237
00:08:30,879 --> 00:08:35,360
monitoring this you are very far behind

238
00:08:35,599 --> 00:08:38,080
and so as the threat actor

239
00:08:38,080 --> 00:08:40,399
we want to set up persistent access we

240
00:08:40,399 --> 00:08:41,839
want to get

241
00:08:41,839 --> 00:08:44,320
uh access via our vps so that way we

242
00:08:44,320 --> 00:08:45,920
have a single ip that we can start

243
00:08:45,920 --> 00:08:47,440
tracking stuff from

244
00:08:47,440 --> 00:08:49,440
we want to set up a coin miner we want

245
00:08:49,440 --> 00:08:51,519
to infect at least one of the hosts and

246
00:08:51,519 --> 00:08:53,200
then we want to try to exfil that data

247
00:08:53,200 --> 00:08:55,839
when we see it

248
00:08:56,080 --> 00:08:59,600
so as a precautionary note it is

249
00:08:59,600 --> 00:09:01,760
probably illegal and very much against

250
00:09:01,760 --> 00:09:03,760
the terms of service to actually run any

251
00:09:03,760 --> 00:09:05,839
sort of

252
00:09:05,839 --> 00:09:08,080
bots or malware or anything like that so

253
00:09:08,080 --> 00:09:10,000
these were emulated by hand where

254
00:09:10,000 --> 00:09:12,320
basically i just went through like the

255
00:09:12,320 --> 00:09:14,560
indicators of compromise and went

256
00:09:14,560 --> 00:09:16,880
through it's like okay so if i ran this

257
00:09:16,880 --> 00:09:18,959
then this user account would get set up

258
00:09:18,959 --> 00:09:21,680
and i would do these sets of queries in

259
00:09:21,680 --> 00:09:23,360
powershell or i would do these sets of

260
00:09:23,360 --> 00:09:25,120
queries in

261
00:09:25,120 --> 00:09:26,240
a vm

262
00:09:26,240 --> 00:09:29,760
and try to figure it out that way

263
00:09:30,080 --> 00:09:32,560
so the coin miner i've seen these setup

264
00:09:32,560 --> 00:09:35,040
in the cloud sometimes the only

265
00:09:35,040 --> 00:09:37,360
indicator and the only reason it gets

266
00:09:37,360 --> 00:09:39,760
across to security is because they see

267
00:09:39,760 --> 00:09:40,800
like oh

268
00:09:40,800 --> 00:09:43,279
the resource utilization is super high

269
00:09:43,279 --> 00:09:44,240
on this

270
00:09:44,240 --> 00:09:47,279
and uh we noticed after that that it was

271
00:09:47,279 --> 00:09:49,440
very very weird like this wasn't

272
00:09:49,440 --> 00:09:51,040
something that we did so then security

273
00:09:51,040 --> 00:09:52,320
gets involved

274
00:09:52,320 --> 00:09:54,399
and then um i tried to emulate uh

275
00:09:54,399 --> 00:09:57,440
quackbot on uh windows and then i tried

276
00:09:57,440 --> 00:09:59,680
to do uh conrad on

277
00:09:59,680 --> 00:10:01,360
linux just to see if i could flag

278
00:10:01,360 --> 00:10:02,560
anything too

279
00:10:02,560 --> 00:10:05,600
and for conrad all three different um

280
00:10:05,600 --> 00:10:07,440
cloud providers that i tested

281
00:10:07,440 --> 00:10:08,959
nothing had flagged on even when i

282
00:10:08,959 --> 00:10:10,000
turned on some of the additional

283
00:10:10,000 --> 00:10:12,880
security too it's something that you

284
00:10:12,880 --> 00:10:14,480
need to go and manually hunt out you're

285
00:10:14,480 --> 00:10:16,720
not going to see that unless you have

286
00:10:16,720 --> 00:10:19,600
logging already enabled for those uh

287
00:10:19,600 --> 00:10:24,000
web-based iocs or like beacons back

288
00:10:24,640 --> 00:10:27,760
so for setting up the uh

289
00:10:27,760 --> 00:10:29,440
aws instance

290
00:10:29,440 --> 00:10:32,240
we just did the default t2 micro server

291
00:10:32,240 --> 00:10:34,959
we did the database on port 1433 it was

292
00:10:34,959 --> 00:10:36,640
recommended

293
00:10:36,640 --> 00:10:40,000
we had a very basic windows vm setup too

294
00:10:40,000 --> 00:10:41,519
just a little bit of information about

295
00:10:41,519 --> 00:10:42,880
it

296
00:10:42,880 --> 00:10:45,600
we made sure that

297
00:10:45,600 --> 00:10:47,040
everything that we were doing was just

298
00:10:47,040 --> 00:10:48,959
like recommendeds

299
00:10:48,959 --> 00:10:51,040
and just trying to make sure that it was

300
00:10:51,040 --> 00:10:52,480
all default settings and we were also

301
00:10:52,480 --> 00:10:53,920
logging everything that we were getting

302
00:10:53,920 --> 00:10:55,519
here

303
00:10:55,519 --> 00:10:57,040
for gcp

304
00:10:57,040 --> 00:10:59,440
um it was really nice because they had a

305
00:10:59,440 --> 00:11:01,440
very easy to use tracker on like how

306
00:11:01,440 --> 00:11:03,120
much money i was going to be going into

307
00:11:03,120 --> 00:11:04,560
that 300

308
00:11:04,560 --> 00:11:07,519
credit that they give you for a month

309
00:11:07,519 --> 00:11:10,079
turns out that if you don't pay for it

310
00:11:10,079 --> 00:11:11,920
you can't actually set up a windows

311
00:11:11,920 --> 00:11:13,600
server instance on there too you have to

312
00:11:13,600 --> 00:11:16,160
do a little bit of extra pay stuff

313
00:11:16,160 --> 00:11:18,480
but we were able to get uh my sequel

314
00:11:18,480 --> 00:11:20,560
running up on there too

315
00:11:20,560 --> 00:11:23,040
and uh just chose default settings and

316
00:11:23,040 --> 00:11:24,240
everything

317
00:11:24,240 --> 00:11:26,160
tried to choose as close to the username

318
00:11:26,160 --> 00:11:27,680
as possible just so i could uniquely

319
00:11:27,680 --> 00:11:30,240
find it if there were any logs on it

320
00:11:30,240 --> 00:11:33,120
and then setting up a very default linux

321
00:11:33,120 --> 00:11:35,519
instance

322
00:11:37,200 --> 00:11:38,079
so

323
00:11:38,079 --> 00:11:39,839
for azure

324
00:11:39,839 --> 00:11:42,240
this was the biggest pain as far as like

325
00:11:42,240 --> 00:11:43,600
trying to figure out ways to do this

326
00:11:43,600 --> 00:11:46,160
without going into the pay model

327
00:11:46,160 --> 00:11:47,920
and that's because they have this really

328
00:11:47,920 --> 00:11:49,680
cool thing where it's like you can try

329
00:11:49,680 --> 00:11:52,560
azure get a 200 free credit but after

330
00:11:52,560 --> 00:11:55,279
the second or third time that i use the

331
00:11:55,279 --> 00:11:59,200
exact same credit card to authenticate

332
00:11:59,200 --> 00:12:00,880
you're not really eligible anymore it's

333
00:12:00,880 --> 00:12:02,639
they start saying it's like no you need

334
00:12:02,639 --> 00:12:04,079
you need to pay

335
00:12:04,079 --> 00:12:07,120
so i made a new subscription here

336
00:12:07,120 --> 00:12:08,839
this week

337
00:12:08,839 --> 00:12:11,120
and started going through like all the

338
00:12:11,120 --> 00:12:13,839
default settings uh one thing to note is

339
00:12:13,839 --> 00:12:17,360
they have a free trial option for atp

340
00:12:17,360 --> 00:12:19,600
but since we're trying to save money and

341
00:12:19,600 --> 00:12:22,560
i'm trying to save money um i opted out

342
00:12:22,560 --> 00:12:24,399
of that initially just because i wanted

343
00:12:24,399 --> 00:12:25,680
to see if there was anything else that

344
00:12:25,680 --> 00:12:27,680
i'd be able to find

345
00:12:27,680 --> 00:12:29,200
and

346
00:12:29,200 --> 00:12:31,600
let's see

347
00:12:32,399 --> 00:12:34,959
so this option also seemed really good i

348
00:12:34,959 --> 00:12:37,279
had to check this box but it seemed like

349
00:12:37,279 --> 00:12:38,480
something that i was going to get some

350
00:12:38,480 --> 00:12:40,160
better iocs from and just with my

351
00:12:40,160 --> 00:12:41,680
experience of having redone this a few

352
00:12:41,680 --> 00:12:43,120
times i wanted to see if this was going

353
00:12:43,120 --> 00:12:44,480
to initially catch anything this week

354
00:12:44,480 --> 00:12:47,839
because i just noticed that too

355
00:12:48,160 --> 00:12:49,760
so

356
00:12:49,760 --> 00:12:51,279
all of the networking settings i tried

357
00:12:51,279 --> 00:12:54,480
to go either default or i enabled public

358
00:12:54,480 --> 00:12:56,639
access after a certain point of time if

359
00:12:56,639 --> 00:12:59,200
i couldn't get access to anything

360
00:12:59,200 --> 00:13:02,800
and with azure in particular

361
00:13:02,800 --> 00:13:04,320
you get these really cool little prompts

362
00:13:04,320 --> 00:13:06,399
at the bottom there too and

363
00:13:06,399 --> 00:13:08,079
at the very least they let you know like

364
00:13:08,079 --> 00:13:08,880
hey

365
00:13:08,880 --> 00:13:10,399
we're not watching this we're not

366
00:13:10,399 --> 00:13:12,160
logging anything we're not auditing

367
00:13:12,160 --> 00:13:14,959
anything uh defender isn't working

368
00:13:14,959 --> 00:13:17,600
and it's very true

369
00:13:17,600 --> 00:13:19,920
so for the database setup i did a very

370
00:13:19,920 --> 00:13:22,560
very basic and easy just

371
00:13:22,560 --> 00:13:24,560
set up a customer tape or set up a

372
00:13:24,560 --> 00:13:26,880
customer database set up a customer data

373
00:13:26,880 --> 00:13:28,959
table and then just add in some

374
00:13:28,959 --> 00:13:30,720
information in there i tried to make it

375
00:13:30,720 --> 00:13:32,240
look like an actual credit card number

376
00:13:32,240 --> 00:13:33,680
in the big end maybe something would

377
00:13:33,680 --> 00:13:35,680
catch in there too and unfortunately it

378
00:13:35,680 --> 00:13:38,160
did not on any of those

379
00:13:38,160 --> 00:13:41,440
and um one of the things too is i was

380
00:13:41,440 --> 00:13:43,120
really every single time it's i would

381
00:13:43,120 --> 00:13:44,560
find something new it's like this is

382
00:13:44,560 --> 00:13:46,480
what's going to give me a whole lot more

383
00:13:46,480 --> 00:13:48,160
in terms of logging and everything too

384
00:13:48,160 --> 00:13:51,120
so that way if i need to do this again

385
00:13:51,120 --> 00:13:53,600
for a client when i'm doing consulting

386
00:13:53,600 --> 00:13:55,440
i'll be able to go right here and try to

387
00:13:55,440 --> 00:13:57,120
figure this stuff out that's not the

388
00:13:57,120 --> 00:14:00,120
case

389
00:14:02,000 --> 00:14:03,839
and

390
00:14:03,839 --> 00:14:06,079
one of my favorite quotes too is from

391
00:14:06,079 --> 00:14:08,720
jake the dog and it's dude sucking at

392
00:14:08,720 --> 00:14:10,560
something is the first step to being

393
00:14:10,560 --> 00:14:13,439
sort of good at something

394
00:14:14,880 --> 00:14:17,760
so for aws as we start trying to like

395
00:14:17,760 --> 00:14:19,920
peel through the logs and everything too

396
00:14:19,920 --> 00:14:21,839
um i started just taking screenshots of

397
00:14:21,839 --> 00:14:22,959
like all the different menus that were

398
00:14:22,959 --> 00:14:24,639
available maybe there's something hiding

399
00:14:24,639 --> 00:14:26,880
in here that i can find and usually the

400
00:14:26,880 --> 00:14:29,519
answer was no so events if you don't

401
00:14:29,519 --> 00:14:31,279
have an event handler setup you're not

402
00:14:31,279 --> 00:14:32,800
going to get anything in there even if

403
00:14:32,800 --> 00:14:35,199
you're blatantly just like

404
00:14:35,199 --> 00:14:37,120
running uh malware i don't think this is

405
00:14:37,120 --> 00:14:39,040
going to flag anything i can't confirm

406
00:14:39,040 --> 00:14:40,480
that because i can't run malware in

407
00:14:40,480 --> 00:14:42,320
there but

408
00:14:42,320 --> 00:14:43,680
everything else that i was doing kind of

409
00:14:43,680 --> 00:14:45,600
led towards that

410
00:14:45,600 --> 00:14:47,440
uh detailed monitoring if you go into

411
00:14:47,440 --> 00:14:48,880
that box there that's what it's going to

412
00:14:48,880 --> 00:14:49,920
tell you

413
00:14:49,920 --> 00:14:51,680
uh you can enable it

414
00:14:51,680 --> 00:14:53,760
and after enabling it and looking at the

415
00:14:53,760 --> 00:14:56,160
different resources and everything

416
00:14:56,160 --> 00:14:58,320
it didn't seem to like go back

417
00:14:58,320 --> 00:15:00,079
historically much more than a few

418
00:15:00,079 --> 00:15:03,279
minutes for data so basically if it

419
00:15:03,279 --> 00:15:05,120
wasn't happening right that instant

420
00:15:05,120 --> 00:15:06,399
enabling that isn't going to give you

421
00:15:06,399 --> 00:15:07,920
insight to even like a day back or

422
00:15:07,920 --> 00:15:09,600
something it's just going to be grabbing

423
00:15:09,600 --> 00:15:11,360
like the last couple minutes

424
00:15:11,360 --> 00:15:13,440
and then your sol going forward unless

425
00:15:13,440 --> 00:15:16,880
the threat actor is still there

426
00:15:16,880 --> 00:15:20,240
um for the event logs everything

427
00:15:20,240 --> 00:15:22,320
was basically centered around just

428
00:15:22,320 --> 00:15:24,320
maintenance of the database and database

429
00:15:24,320 --> 00:15:26,240
events like the database got backed up

430
00:15:26,240 --> 00:15:27,360
automatically because that's

431
00:15:27,360 --> 00:15:29,120
pre-configured in there

432
00:15:29,120 --> 00:15:30,480
any other events

433
00:15:30,480 --> 00:15:31,440
nothing

434
00:15:31,440 --> 00:15:32,480
and

435
00:15:32,480 --> 00:15:34,800
if i had access to the panel and this

436
00:15:34,800 --> 00:15:37,199
was through my vps

437
00:15:37,199 --> 00:15:39,360
i didn't have to confirm anything it was

438
00:15:39,360 --> 00:15:41,680
all single factor authentication and if

439
00:15:41,680 --> 00:15:43,440
i delete that database instance which i

440
00:15:43,440 --> 00:15:44,880
tested out

441
00:15:44,880 --> 00:15:46,880
all those logs are gone all of that data

442
00:15:46,880 --> 00:15:50,000
is gone i can't triage anything unless

443
00:15:50,000 --> 00:15:51,759
something there that you can pay for

444
00:15:51,759 --> 00:15:52,839
that uh

445
00:15:52,839 --> 00:15:56,160
aws gcp or azure has

446
00:15:56,160 --> 00:15:58,240
that you can like recover that data it

447
00:15:58,240 --> 00:16:00,320
is effectively gone if the threat actor

448
00:16:00,320 --> 00:16:01,759
wants to be uh

449
00:16:01,759 --> 00:16:04,399
destructive

450
00:16:04,959 --> 00:16:08,160
so looking at some of the analytics here

451
00:16:08,160 --> 00:16:10,000
if there is something like a coin miner

452
00:16:10,000 --> 00:16:12,800
which i do see a little bit frequently

453
00:16:12,800 --> 00:16:14,880
from what i've read in postmortems that

454
00:16:14,880 --> 00:16:16,880
other people posted online this is

455
00:16:16,880 --> 00:16:18,480
actually a really good menu to look on

456
00:16:18,480 --> 00:16:19,199
too

457
00:16:19,199 --> 00:16:21,440
and each one of the services has it but

458
00:16:21,440 --> 00:16:23,360
you want to kind of see like oh

459
00:16:23,360 --> 00:16:25,120
it looks like that there's a lot of

460
00:16:25,120 --> 00:16:27,360
utilization from uh this here like this

461
00:16:27,360 --> 00:16:30,000
is using up 70 of the billing

462
00:16:30,000 --> 00:16:32,160
for the free tier there too that's a

463
00:16:32,160 --> 00:16:33,519
really good first place to start because

464
00:16:33,519 --> 00:16:34,720
it means that there might be something

465
00:16:34,720 --> 00:16:38,000
running on one of those machines

466
00:16:38,000 --> 00:16:40,399
and if you take a look at the default

467
00:16:40,399 --> 00:16:42,399
settings too they could be accessing it

468
00:16:42,399 --> 00:16:44,720
from any single one of those countries

469
00:16:44,720 --> 00:16:46,000
it's every single one of those is

470
00:16:46,000 --> 00:16:48,720
enabled by default and only those top

471
00:16:48,720 --> 00:16:50,959
five like they can't actually access

472
00:16:50,959 --> 00:16:53,600
your instance from if they uh

473
00:16:53,600 --> 00:16:56,240
try to do it from those regions

474
00:16:56,240 --> 00:16:58,000
so here's a cool little screenshot that

475
00:16:58,000 --> 00:17:00,160
i took in my uh

476
00:17:00,160 --> 00:17:02,000
instance there where

477
00:17:02,000 --> 00:17:04,720
here is my vps connection

478
00:17:04,720 --> 00:17:07,359
here is my connection logging into it if

479
00:17:07,359 --> 00:17:09,439
you have access to the host that is

480
00:17:09,439 --> 00:17:11,839
fantastic every single one of these i

481
00:17:11,839 --> 00:17:13,520
was able to get detailed logs out of

482
00:17:13,520 --> 00:17:15,359
windows as far as like the ip that was

483
00:17:15,359 --> 00:17:16,720
connecting

484
00:17:16,720 --> 00:17:18,799
um what was run on there too as long as

485
00:17:18,799 --> 00:17:20,400
those event logs are fresh you're going

486
00:17:20,400 --> 00:17:21,839
to have some really good forensic trails

487
00:17:21,839 --> 00:17:24,079
to work on

488
00:17:24,079 --> 00:17:24,959
and

489
00:17:24,959 --> 00:17:27,039
you can even see stuff like uh this is

490
00:17:27,039 --> 00:17:28,720
one of those accounts that i'd set up

491
00:17:28,720 --> 00:17:31,520
i'd uh run a little uh

492
00:17:31,520 --> 00:17:33,679
emulated some attackers on there too

493
00:17:33,679 --> 00:17:35,919
that was my persistence on there windows

494
00:17:35,919 --> 00:17:39,520
logs fantastic aws did not detect

495
00:17:39,520 --> 00:17:41,440
anything even after i'd installed that

496
00:17:41,440 --> 00:17:42,799
uh

497
00:17:42,799 --> 00:17:44,480
little add-on that you can get for there

498
00:17:44,480 --> 00:17:46,720
too and it's the same with gcp and it's

499
00:17:46,720 --> 00:17:48,799
with

500
00:17:48,799 --> 00:17:51,520
azure as well too

501
00:17:51,520 --> 00:17:52,960
one thing i wasn't able to test with

502
00:17:52,960 --> 00:17:57,280
azure though as a side note is um the

503
00:17:57,280 --> 00:17:59,280
more advanced threat detections and

504
00:17:59,280 --> 00:18:00,400
everything from

505
00:18:00,400 --> 00:18:03,600
outside of that free trial of atp

506
00:18:03,600 --> 00:18:05,039
i know from personal experience that

507
00:18:05,039 --> 00:18:08,640
that's a lot better as far as

508
00:18:08,640 --> 00:18:10,080
logging and detection goes because you

509
00:18:10,080 --> 00:18:11,679
can get a lot of really detailed events

510
00:18:11,679 --> 00:18:13,440
and it basically exports like all of the

511
00:18:13,440 --> 00:18:15,600
event logs out of there too

512
00:18:15,600 --> 00:18:17,440
but from what i was seeing on the free

513
00:18:17,440 --> 00:18:20,000
tiers it didn't really historically go

514
00:18:20,000 --> 00:18:21,919
back or take a look at anything after

515
00:18:21,919 --> 00:18:23,919
i'd enabled that after the supposed

516
00:18:23,919 --> 00:18:27,640
threat actor was on there

517
00:18:28,960 --> 00:18:31,280
and then um i even did a little bit of a

518
00:18:31,280 --> 00:18:34,000
beaconing back to uh my own website just

519
00:18:34,000 --> 00:18:35,840
because it's really easy to parse for on

520
00:18:35,840 --> 00:18:37,840
all three of them too so i'm only

521
00:18:37,840 --> 00:18:39,520
showing this for the aws one but i did

522
00:18:39,520 --> 00:18:41,520
this on all three different um

523
00:18:41,520 --> 00:18:43,840
vendors and just tried to figure out

524
00:18:43,840 --> 00:18:44,640
like

525
00:18:44,640 --> 00:18:46,559
what can i even possibly detect or what

526
00:18:46,559 --> 00:18:48,480
can i detect after the fact like even an

527
00:18:48,480 --> 00:18:51,600
hour after infection and nothing was

528
00:18:51,600 --> 00:18:53,520
flagging as far as like uh these

529
00:18:53,520 --> 00:18:57,039
different malware things go

530
00:18:57,039 --> 00:18:59,039
for the database

531
00:18:59,039 --> 00:19:01,840
i just set up basic username admin

532
00:19:01,840 --> 00:19:04,799
oh actually

533
00:19:06,480 --> 00:19:09,840
fun fact on this too before i move on

534
00:19:09,840 --> 00:19:12,080
you see these audit failures i had set

535
00:19:12,080 --> 00:19:14,160
this up really quickly just to grab this

536
00:19:14,160 --> 00:19:16,400
screenshot for that purpose but if you

537
00:19:16,400 --> 00:19:18,720
have your server exposed out like just

538
00:19:18,720 --> 00:19:22,080
with default settings in any of these

539
00:19:22,080 --> 00:19:23,200
you're going to start getting a lot of

540
00:19:23,200 --> 00:19:24,799
audit failures and a lot of fun

541
00:19:24,799 --> 00:19:26,480
different uh little usernames that

542
00:19:26,480 --> 00:19:27,919
people are just like automatically

543
00:19:27,919 --> 00:19:29,840
trying to log in with too it's this

544
00:19:29,840 --> 00:19:32,160
event log was basically like already

545
00:19:32,160 --> 00:19:34,320
full it's yeah

546
00:19:34,320 --> 00:19:38,400
34 500 or 758 new events were in the

547
00:19:38,400 --> 00:19:40,240
security log almost all of those were

548
00:19:40,240 --> 00:19:41,760
audit failures just because i had

549
00:19:41,760 --> 00:19:43,120
enabled that really quick just to get

550
00:19:43,120 --> 00:19:45,200
the screenshot so this is like a 15

551
00:19:45,200 --> 00:19:46,480
minute period

552
00:19:46,480 --> 00:19:48,320
30 000 different automated attempts to

553
00:19:48,320 --> 00:19:51,799
try to log in

554
00:19:55,280 --> 00:19:57,280
so here's another screenshot too i did

555
00:19:57,280 --> 00:19:58,880
this on all three machines but basically

556
00:19:58,880 --> 00:20:01,280
when i connected over to the windows box

557
00:20:01,280 --> 00:20:03,200
um i would

558
00:20:03,200 --> 00:20:04,559
just try to make it like blatantly

559
00:20:04,559 --> 00:20:06,400
obvious on what i was doing here too

560
00:20:06,400 --> 00:20:11,200
it's i saved a csv out of the uh

561
00:20:11,200 --> 00:20:13,760
there named it muahaha

562
00:20:13,760 --> 00:20:16,799
csv and then uh just exported it out to

563
00:20:16,799 --> 00:20:20,320
uh my vps

564
00:20:20,320 --> 00:20:23,760
and if you look into

565
00:20:23,760 --> 00:20:25,840
what the terms of service are for all of

566
00:20:25,840 --> 00:20:27,600
these the text is a little bit small but

567
00:20:27,600 --> 00:20:29,520
basically it says

568
00:20:29,520 --> 00:20:32,240
we as in the cloud providers are going

569
00:20:32,240 --> 00:20:34,799
to protect our infrastructure

570
00:20:34,799 --> 00:20:37,520
but the cloud space that you're leasing

571
00:20:37,520 --> 00:20:39,600
is entirely your responsibility for

572
00:20:39,600 --> 00:20:41,200
securing so

573
00:20:41,200 --> 00:20:44,000
by design all three of these are not

574
00:20:44,000 --> 00:20:45,520
meant to be like something that you can

575
00:20:45,520 --> 00:20:48,880
just go in audit and triage

576
00:20:48,880 --> 00:20:51,200
so what do you do if you run into

577
00:20:51,200 --> 00:20:52,559
something like this on any of the

578
00:20:52,559 --> 00:20:53,679
providers

579
00:20:53,679 --> 00:20:55,760
you want to make sure to try to get

580
00:20:55,760 --> 00:20:57,039
snapshots

581
00:20:57,039 --> 00:20:58,880
as quick as possible i found that that

582
00:20:58,880 --> 00:21:01,440
was the easiest way for me to when i was

583
00:21:01,440 --> 00:21:02,799
doing that post-mortem triage and

584
00:21:02,799 --> 00:21:04,880
everything on the endpoints that was the

585
00:21:04,880 --> 00:21:06,720
easiest way for me to like get relevant

586
00:21:06,720 --> 00:21:08,720
information because i may be doing one

587
00:21:08,720 --> 00:21:10,159
thing another thing but grabbing that

588
00:21:10,159 --> 00:21:12,720
memory forensics getting a full-on

589
00:21:12,720 --> 00:21:14,880
image of those vms that was very easy

590
00:21:14,880 --> 00:21:16,799
for me to identify it's like oh here's

591
00:21:16,799 --> 00:21:19,520
my coin miner process or oh here's

592
00:21:19,520 --> 00:21:22,639
um that uh

593
00:21:22,720 --> 00:21:24,159
that new linux one that i've already

594
00:21:24,159 --> 00:21:25,600
forgotten the name of

595
00:21:25,600 --> 00:21:27,440
and you'd be able to see those processes

596
00:21:27,440 --> 00:21:28,720
just hanging out in the background and

597
00:21:28,720 --> 00:21:32,240
everything too but if the vpns or the

598
00:21:32,240 --> 00:21:34,080
vms are shut off at all

599
00:21:34,080 --> 00:21:35,919
if the machines have been rebooted and

600
00:21:35,919 --> 00:21:37,919
it wasn't persistent you just kind of

601
00:21:37,919 --> 00:21:39,760
lose that information so snapshots are

602
00:21:39,760 --> 00:21:42,000
super important and always recommend

603
00:21:42,000 --> 00:21:43,360
that's like one of the first things you

604
00:21:43,360 --> 00:21:45,600
try to do is just get those secured

605
00:21:45,600 --> 00:21:47,280
snapshots

606
00:21:47,280 --> 00:21:49,840
and uh yeah just there it's even in the

607
00:21:49,840 --> 00:21:51,760
free tiers it was very easy to do that

608
00:21:51,760 --> 00:21:53,200
for all three of the providers so that's

609
00:21:53,200 --> 00:21:55,200
something that was very beneficial every

610
00:21:55,200 --> 00:21:57,520
single time i did this

611
00:21:57,520 --> 00:22:00,000
so some final notes for aws

612
00:22:00,000 --> 00:22:02,240
um

613
00:22:02,400 --> 00:22:05,679
there's multiple different levels of vms

614
00:22:05,679 --> 00:22:07,520
that you can have

615
00:22:07,520 --> 00:22:08,960
you could have something that's not

616
00:22:08,960 --> 00:22:10,640
really supported by aws but you can just

617
00:22:10,640 --> 00:22:12,400
have it hosted on there you could have

618
00:22:12,400 --> 00:22:15,120
an add-on that is installed

619
00:22:15,120 --> 00:22:16,720
after you go to some of the more paid

620
00:22:16,720 --> 00:22:17,919
tiers

621
00:22:17,919 --> 00:22:20,799
and then you'll get some log aggregation

622
00:22:20,799 --> 00:22:22,960
and ingestion into like a cloud watch

623
00:22:22,960 --> 00:22:24,960
and things like that

624
00:22:24,960 --> 00:22:27,039
but it really just depends on what

625
00:22:27,039 --> 00:22:28,480
machine you're spinning up every single

626
00:22:28,480 --> 00:22:30,080
time i did this i tried it a little bit

627
00:22:30,080 --> 00:22:31,360
differently and i would just get

628
00:22:31,360 --> 00:22:32,880
different information

629
00:22:32,880 --> 00:22:35,280
um there was no logs that i could find

630
00:22:35,280 --> 00:22:38,240
and any instance for the free tiers on

631
00:22:38,240 --> 00:22:41,120
my vps connection uh any of the ip

632
00:22:41,120 --> 00:22:42,880
connections that i made

633
00:22:42,880 --> 00:22:45,120
the coin miner even after installing the

634
00:22:45,120 --> 00:22:46,640
uh

635
00:22:46,640 --> 00:22:50,000
automatic uh logger and everything too

636
00:22:50,000 --> 00:22:51,039
i thought that there might be some

637
00:22:51,039 --> 00:22:52,320
security or something in there too it's

638
00:22:52,320 --> 00:22:53,919
like hey this is making some weird

639
00:22:53,919 --> 00:22:56,240
connections out online too because

640
00:22:56,240 --> 00:22:58,159
i ran a coin miner for like five minutes

641
00:22:58,159 --> 00:23:01,120
or something and then just shut it off

642
00:23:01,120 --> 00:23:03,280
and then there's some really good papers

643
00:23:03,280 --> 00:23:05,520
that are pre-set up

644
00:23:05,520 --> 00:23:08,480
or are before the incident occurs

645
00:23:08,480 --> 00:23:09,679
there's some really good stuff that you

646
00:23:09,679 --> 00:23:11,760
can do to

647
00:23:11,760 --> 00:23:13,360
oh there's some really good stuff that

648
00:23:13,360 --> 00:23:15,520
you can do to prepare for when these

649
00:23:15,520 --> 00:23:17,919
types of things occur

650
00:23:17,919 --> 00:23:19,280
so

651
00:23:19,280 --> 00:23:21,120
cloud-based logs

652
00:23:21,120 --> 00:23:24,559
not much if you can get aws

653
00:23:24,559 --> 00:23:28,158
cloud watch and things like that set up

654
00:23:28,320 --> 00:23:32,158
you can definitely really

655
00:23:33,760 --> 00:23:36,480
or cloudtrail 2 is the other one

656
00:23:36,480 --> 00:23:37,840
if you get like a cloud watch or

657
00:23:37,840 --> 00:23:39,520
cloudtrail or any of those set up there

658
00:23:39,520 --> 00:23:41,760
too and it's still a persistent act you

659
00:23:41,760 --> 00:23:43,039
can start getting some really good logs

660
00:23:43,039 --> 00:23:44,320
and start piecing together information

661
00:23:44,320 --> 00:23:45,679
but it requires doing a little bit of

662
00:23:45,679 --> 00:23:47,520
initial investment

663
00:23:47,520 --> 00:23:49,440
initial point of access

664
00:23:49,440 --> 00:23:51,520
when doing the endpoint triages we

665
00:23:51,520 --> 00:23:53,039
determined those like the logs from the

666
00:23:53,039 --> 00:23:55,120
windows machine were the first one

667
00:23:55,120 --> 00:23:58,159
and then uh utilizing the

668
00:23:58,159 --> 00:24:00,720
uh logs from the cloud after paying for

669
00:24:00,720 --> 00:24:02,240
like a cloud watch and things like that

670
00:24:02,240 --> 00:24:04,080
too we can see it's like okay they went

671
00:24:04,080 --> 00:24:06,480
here that looks like they were making

672
00:24:06,480 --> 00:24:08,400
connections over to the database and

673
00:24:08,400 --> 00:24:09,360
everything

674
00:24:09,360 --> 00:24:11,520
we were able to determine that like oh

675
00:24:11,520 --> 00:24:14,960
the credentials were cached on the

676
00:24:14,960 --> 00:24:16,320
windows machine

677
00:24:16,320 --> 00:24:18,640
for the database access so those were

678
00:24:18,640 --> 00:24:20,480
all compromised and they even made a new

679
00:24:20,480 --> 00:24:21,440
user

680
00:24:21,440 --> 00:24:23,200
so that was pretty easy to figure out

681
00:24:23,200 --> 00:24:24,799
but it relied on those endpoint

682
00:24:24,799 --> 00:24:27,919
artifacts and then was the data x filled

683
00:24:27,919 --> 00:24:29,760
looking at the sql logs we could see

684
00:24:29,760 --> 00:24:31,760
that they ran a select star from star

685
00:24:31,760 --> 00:24:33,360
queries basically

686
00:24:33,360 --> 00:24:35,279
and there wasn't really a threat to the

687
00:24:35,279 --> 00:24:37,039
organization because i wasn't really

688
00:24:37,039 --> 00:24:38,960
able to see anything that was beaconing

689
00:24:38,960 --> 00:24:42,400
back to my fake company

690
00:24:42,400 --> 00:24:45,679
so for the gcp logs i have to say

691
00:24:45,679 --> 00:24:46,880
overall

692
00:24:46,880 --> 00:24:49,120
very impressed with uh the default

693
00:24:49,120 --> 00:24:50,880
options for there i actually had to go

694
00:24:50,880 --> 00:24:53,679
out of my way to enable some accesses so

695
00:24:53,679 --> 00:24:55,200
that way i could continue on this i'm

696
00:24:55,200 --> 00:24:56,880
not a red teamer i'm not very good at

697
00:24:56,880 --> 00:24:58,720
that kind of stuff i had to go in and

698
00:24:58,720 --> 00:25:00,720
like kind of enable a couple things and

699
00:25:00,720 --> 00:25:03,039
take liberties like oh what if i already

700
00:25:03,039 --> 00:25:05,039
had access to this machine too so on

701
00:25:05,039 --> 00:25:06,400
that note like

702
00:25:06,400 --> 00:25:08,240
gcp is definitely the way to go as far

703
00:25:08,240 --> 00:25:11,760
as like default security options

704
00:25:11,760 --> 00:25:13,440
so in here

705
00:25:13,440 --> 00:25:15,919
i had a gcp debian and then just poor

706
00:25:15,919 --> 00:25:18,000
configuration example and i had to

707
00:25:18,000 --> 00:25:20,240
literally just whitelist my vps so that

708
00:25:20,240 --> 00:25:21,919
way i could keep doing this i didn't

709
00:25:21,919 --> 00:25:23,760
want to expose it to the internet it's a

710
00:25:23,760 --> 00:25:27,039
bad idea so i just pretend exposed it by

711
00:25:27,039 --> 00:25:30,320
allowing access to my bps

712
00:25:30,320 --> 00:25:32,880
same thing in here too it's uh set up a

713
00:25:32,880 --> 00:25:34,320
test instance

714
00:25:34,320 --> 00:25:36,400
and then just off the bat

715
00:25:36,400 --> 00:25:37,760
i really liked

716
00:25:37,760 --> 00:25:39,919
that it had more logging at least as far

717
00:25:39,919 --> 00:25:41,520
as like actions and maintenance that was

718
00:25:41,520 --> 00:25:44,480
done on the system it felt a lot easier

719
00:25:44,480 --> 00:25:46,159
to browse and just

720
00:25:46,159 --> 00:25:47,360
work through

721
00:25:47,360 --> 00:25:48,159
and

722
00:25:48,159 --> 00:25:51,039
even so far as without even paying yet

723
00:25:51,039 --> 00:25:53,760
that data down there is uh the requester

724
00:25:53,760 --> 00:25:57,279
metadata i had my vps id i had the

725
00:25:57,279 --> 00:25:59,200
request string so i could see each one

726
00:25:59,200 --> 00:26:00,559
of those unique request strings that i

727
00:26:00,559 --> 00:26:02,559
did and it was the same thing for like

728
00:26:02,559 --> 00:26:04,559
uh doing other beacons back to another

729
00:26:04,559 --> 00:26:06,080
machine that i had set up too so that

730
00:26:06,080 --> 00:26:08,480
was fantastic just out of the box

731
00:26:08,480 --> 00:26:11,279
if you let the logging and enable or

732
00:26:11,279 --> 00:26:14,320
the default enabled logging options

733
00:26:14,320 --> 00:26:17,120
right away just started to uh populate

734
00:26:17,120 --> 00:26:18,559
some data so i could immediately see

735
00:26:18,559 --> 00:26:20,480
like this is not a good connection this

736
00:26:20,480 --> 00:26:22,240
is not a good connection it was very

737
00:26:22,240 --> 00:26:23,600
easy for me to start piecing that

738
00:26:23,600 --> 00:26:25,520
together

739
00:26:25,520 --> 00:26:26,480
and

740
00:26:26,480 --> 00:26:28,559
there's even some options too for like

741
00:26:28,559 --> 00:26:30,400
the ops agent and then you can enable

742
00:26:30,400 --> 00:26:33,039
the vm manager and stuff like that

743
00:26:33,039 --> 00:26:34,640
and it will

744
00:26:34,640 --> 00:26:37,039
provide you a lot more detailed access

745
00:26:37,039 --> 00:26:39,279
that being said though

746
00:26:39,279 --> 00:26:41,039
if you go into the security panel in

747
00:26:41,039 --> 00:26:42,640
there almost every single one of those

748
00:26:42,640 --> 00:26:44,400
options is just going to say

749
00:26:44,400 --> 00:26:45,360
hey

750
00:26:45,360 --> 00:26:47,120
you need to be a part of an organization

751
00:26:47,120 --> 00:26:48,799
or you need to have such and such

752
00:26:48,799 --> 00:26:50,880
enabled first so there's really not much

753
00:26:50,880 --> 00:26:52,559
out of the bat that you can like kind of

754
00:26:52,559 --> 00:26:54,320
run to triage without starting to enable

755
00:26:54,320 --> 00:26:55,679
features or linking it to an

756
00:26:55,679 --> 00:26:58,080
organization

757
00:26:58,080 --> 00:27:00,559
um another thing and this was the same

758
00:27:00,559 --> 00:27:02,720
across all three but i really like the

759
00:27:02,720 --> 00:27:06,000
way that uh gcp did the uh

760
00:27:06,000 --> 00:27:08,080
console logs and everything too it's

761
00:27:08,080 --> 00:27:09,360
every single one of those connections

762
00:27:09,360 --> 00:27:12,240
that i made i had just a raw output

763
00:27:12,240 --> 00:27:14,480
of what the uh

764
00:27:14,480 --> 00:27:15,919
everything was done on the command line

765
00:27:15,919 --> 00:27:18,399
basically it was really really easy for

766
00:27:18,399 --> 00:27:21,520
me to detect and figure out like oh

767
00:27:21,520 --> 00:27:23,840
this is what the malicious actor myself

768
00:27:23,840 --> 00:27:25,039
was doing

769
00:27:25,039 --> 00:27:26,880
that being said if you delete the

770
00:27:26,880 --> 00:27:29,520
instance there's no way to recover that

771
00:27:29,520 --> 00:27:30,960
it doesn't cache it or anything even

772
00:27:30,960 --> 00:27:34,480
after loading it

773
00:27:34,480 --> 00:27:36,480
so i really liked how security was

774
00:27:36,480 --> 00:27:38,320
ingrained in this

775
00:27:38,320 --> 00:27:39,919
um

776
00:27:39,919 --> 00:27:42,159
go out of my way again just to get that

777
00:27:42,159 --> 00:27:43,279
low hanging fruit and everything in

778
00:27:43,279 --> 00:27:44,720
there i'm sure there's other ways to

779
00:27:44,720 --> 00:27:46,000
exploit it but it was just kind of

780
00:27:46,000 --> 00:27:48,320
outside of my skill set so this one was

781
00:27:48,320 --> 00:27:49,919
the hardest for me to just like try to

782
00:27:49,919 --> 00:27:50,880
figure out like where is the

783
00:27:50,880 --> 00:27:52,559
vulnerability in there

784
00:27:52,559 --> 00:27:54,399
and then um for the logs that are

785
00:27:54,399 --> 00:27:56,480
available all of those logs like showing

786
00:27:56,480 --> 00:27:59,039
that connection from uh my vps and

787
00:27:59,039 --> 00:28:01,679
everything that was in there for 30 days

788
00:28:01,679 --> 00:28:03,440
you can have those logs in there for a

789
00:28:03,440 --> 00:28:04,960
good amount of time so as long as it's a

790
00:28:04,960 --> 00:28:07,039
recent compromise you can pretty quickly

791
00:28:07,039 --> 00:28:09,520
figure out what's going on in there

792
00:28:09,520 --> 00:28:12,000
that said you still need to have them

793
00:28:12,000 --> 00:28:13,279
join a

794
00:28:13,279 --> 00:28:15,360
company or an organization

795
00:28:15,360 --> 00:28:16,960
and then you need to like manually

796
00:28:16,960 --> 00:28:18,399
enable a lot of those other different

797
00:28:18,399 --> 00:28:19,600
features in order to get that more

798
00:28:19,600 --> 00:28:22,639
comprehensive logging

799
00:28:22,720 --> 00:28:25,120
the coin miner i was able to identify as

800
00:28:25,120 --> 00:28:26,720
a startup process

801
00:28:26,720 --> 00:28:28,720
on gcp alone

802
00:28:28,720 --> 00:28:30,240
but that was only because it was

803
00:28:30,240 --> 00:28:32,880
populating in from that uh vps

804
00:28:32,880 --> 00:28:34,799
um all the different startup processes

805
00:28:34,799 --> 00:28:36,480
just in one of those menus so i thought

806
00:28:36,480 --> 00:28:37,760
that was a really nice feature but i

807
00:28:37,760 --> 00:28:38,960
still had to go out of my way to find it

808
00:28:38,960 --> 00:28:40,799
it wasn't like it popped up and alerted

809
00:28:40,799 --> 00:28:42,159
it to me

810
00:28:42,159 --> 00:28:44,559
and then um here's one of my favorite

811
00:28:44,559 --> 00:28:45,919
articles that i found through this whole

812
00:28:45,919 --> 00:28:48,640
thing too um eric evans wrote something

813
00:28:48,640 --> 00:28:51,120
on doing detection and response in uh

814
00:28:51,120 --> 00:28:52,880
gcp

815
00:28:52,880 --> 00:28:53,919
and

816
00:28:53,919 --> 00:28:56,159
i really adhered to a lot of the

817
00:28:56,159 --> 00:28:57,440
different things that uh he had

818
00:28:57,440 --> 00:28:58,880
mentioned in there too so i just wanted

819
00:28:58,880 --> 00:29:01,039
to shout that out

820
00:29:01,039 --> 00:29:03,120
so what was the initial point of access

821
00:29:03,120 --> 00:29:05,039
we can see that the gcp logs showed the

822
00:29:05,039 --> 00:29:07,600
user's main account may have been abused

823
00:29:07,600 --> 00:29:09,600
to access the database it was pretty

824
00:29:09,600 --> 00:29:11,039
detailed in everything that was getting

825
00:29:11,039 --> 00:29:12,720
ingested in there

826
00:29:12,720 --> 00:29:15,679
um we could identify that all of the sql

827
00:29:15,679 --> 00:29:18,080
users had their passwords reset after

828
00:29:18,080 --> 00:29:19,919
the access those logs were just right

829
00:29:19,919 --> 00:29:21,440
there so it's we could see that the new

830
00:29:21,440 --> 00:29:24,320
user account sql editor that i made

831
00:29:24,320 --> 00:29:26,480
maliciously was added in there and then

832
00:29:26,480 --> 00:29:27,840
we could see the passwords were changed

833
00:29:27,840 --> 00:29:30,000
for the other uh sql accounts too so

834
00:29:30,000 --> 00:29:31,600
that was really nice and we were able to

835
00:29:31,600 --> 00:29:33,360
just very quickly it's we need to reset

836
00:29:33,360 --> 00:29:34,720
these

837
00:29:34,720 --> 00:29:37,200
um was the data x filled same thing as

838
00:29:37,200 --> 00:29:38,399
aws

839
00:29:38,399 --> 00:29:41,360
we can see that the uh

840
00:29:41,360 --> 00:29:43,200
queries were done and everything but

841
00:29:43,200 --> 00:29:45,520
again that supposes that they didn't do

842
00:29:45,520 --> 00:29:48,320
a destructive uh thing on any of those

843
00:29:48,320 --> 00:29:50,320
so like deleting the database doing a

844
00:29:50,320 --> 00:29:52,480
drop table stuff like that you might

845
00:29:52,480 --> 00:29:53,919
start losing some of that logging if it

846
00:29:53,919 --> 00:29:55,600
rolls off

847
00:29:55,600 --> 00:29:56,880
and then was there any threat to the

848
00:29:56,880 --> 00:29:58,480
organization

849
00:29:58,480 --> 00:30:00,320
i didn't see any in there either too i

850
00:30:00,320 --> 00:30:02,320
couldn't see the communications back to

851
00:30:02,320 --> 00:30:03,520
the

852
00:30:03,520 --> 00:30:04,720
original

853
00:30:04,720 --> 00:30:06,880
vendor and that was or the original site

854
00:30:06,880 --> 00:30:08,320
that i had set up and that was just

855
00:30:08,320 --> 00:30:09,760
because um

856
00:30:09,760 --> 00:30:11,919
those hadn't happened since so i didn't

857
00:30:11,919 --> 00:30:13,360
see those initial connections back to

858
00:30:13,360 --> 00:30:14,799
the original company transferring that

859
00:30:14,799 --> 00:30:16,720
data over

860
00:30:16,720 --> 00:30:19,760
for the azure logging again it's it

861
00:30:19,760 --> 00:30:21,520
tells you right there at the very least

862
00:30:21,520 --> 00:30:23,840
it's like hey auditing isn't configured

863
00:30:23,840 --> 00:30:26,080
security not configured you got to pay

864
00:30:26,080 --> 00:30:27,440
for that

865
00:30:27,440 --> 00:30:30,000
um it's very pricey and was trying to

866
00:30:30,000 --> 00:30:31,039
charge me

867
00:30:31,039 --> 00:30:32,880
a lot of money for enabling that too

868
00:30:32,880 --> 00:30:35,520
each single uh instance

869
00:30:35,520 --> 00:30:38,320
of uh azure atp that it wanted to run

870
00:30:38,320 --> 00:30:40,000
for the database and then each of the

871
00:30:40,000 --> 00:30:42,399
servers that's 15

872
00:30:42,399 --> 00:30:43,840
a month for each of those and it was

873
00:30:43,840 --> 00:30:45,600
like up front so it was starting to get

874
00:30:45,600 --> 00:30:47,200
a little pricey just for me as an

875
00:30:47,200 --> 00:30:49,279
individual to like try to figure that

876
00:30:49,279 --> 00:30:51,760
out

877
00:30:51,760 --> 00:30:53,279
that being said

878
00:30:53,279 --> 00:30:54,320
um

879
00:30:54,320 --> 00:30:56,720
by default you could see all of the

880
00:30:56,720 --> 00:30:58,000
accesses

881
00:30:58,000 --> 00:31:00,480
and in there i have boxed

882
00:31:00,480 --> 00:31:02,880
on the very left there is the exact time

883
00:31:02,880 --> 00:31:05,200
it was accessed you can see the ipo is

884
00:31:05,200 --> 00:31:08,320
accessed from you can see the location

885
00:31:08,320 --> 00:31:10,240
uh based on ip that it was accessed from

886
00:31:10,240 --> 00:31:11,840
and you can even see like was it

887
00:31:11,840 --> 00:31:13,279
multi-factored or single factored

888
00:31:13,279 --> 00:31:15,039
authentication and in this case i just

889
00:31:15,039 --> 00:31:18,799
abused the single factor authentication

890
00:31:18,799 --> 00:31:19,519
so

891
00:31:19,519 --> 00:31:22,720
my overall thoughts on that is atp

892
00:31:22,720 --> 00:31:24,399
for its logs as soon as you start

893
00:31:24,399 --> 00:31:26,159
enabling them they're really good

894
00:31:26,159 --> 00:31:27,840
actually they were even going into

895
00:31:27,840 --> 00:31:29,840
windows and pulling like older events

896
00:31:29,840 --> 00:31:31,679
that were still cached in there and

897
00:31:31,679 --> 00:31:33,519
started telling me things like oh this

898
00:31:33,519 --> 00:31:36,000
user account was actually created

899
00:31:36,000 --> 00:31:37,039
but

900
00:31:37,039 --> 00:31:39,039
you have to pay for that and you have to

901
00:31:39,039 --> 00:31:40,480
hope that those logs are still there if

902
00:31:40,480 --> 00:31:41,840
this is something that's been exposed

903
00:31:41,840 --> 00:31:43,360
out for like two years those logs might

904
00:31:43,360 --> 00:31:45,519
have already rolled over

905
00:31:45,519 --> 00:31:47,120
it also allows for the ability of custom

906
00:31:47,120 --> 00:31:48,320
detections

907
00:31:48,320 --> 00:31:49,760
one of my favorite things at a previous

908
00:31:49,760 --> 00:31:51,600
organization was we could just write

909
00:31:51,600 --> 00:31:53,039
custom queries based on what we were

910
00:31:53,039 --> 00:31:55,279
looking for oh we want to find this ioc

911
00:31:55,279 --> 00:31:56,720
you could run it against every single

912
00:31:56,720 --> 00:31:59,039
endpoint that had atp enabled

913
00:31:59,039 --> 00:32:00,720
and then as long as the logs exist on

914
00:32:00,720 --> 00:32:02,640
the machine you can kind of do that

915
00:32:02,640 --> 00:32:04,480
historical back look so if the machines

916
00:32:04,480 --> 00:32:06,000
are still there and those logs haven't

917
00:32:06,000 --> 00:32:08,080
rolled over you can ingest those in and

918
00:32:08,080 --> 00:32:10,159
then just from the cloud do all of that

919
00:32:10,159 --> 00:32:13,720
triage right there

920
00:32:14,320 --> 00:32:15,679
so

921
00:32:15,679 --> 00:32:17,840
yeah for this it was uh getting health

922
00:32:17,840 --> 00:32:19,440
and performance in there i'd also

923
00:32:19,440 --> 00:32:20,880
explored around this in there and i just

924
00:32:20,880 --> 00:32:24,559
wanted to make a note of that too it was

925
00:32:24,559 --> 00:32:26,720
nothing really in there that i was able

926
00:32:26,720 --> 00:32:29,360
to like use as far as an ir goes like

927
00:32:29,360 --> 00:32:30,960
maybe if we were still monitoring an

928
00:32:30,960 --> 00:32:33,279
active threat or anything

929
00:32:33,279 --> 00:32:34,720
um that might have been useful but

930
00:32:34,720 --> 00:32:35,919
otherwise no

931
00:32:35,919 --> 00:32:38,159
and so for the azure final notes

932
00:32:38,159 --> 00:32:41,519
but it's pricey but you're paying what

933
00:32:41,519 --> 00:32:44,159
you uh get for there it's quality event

934
00:32:44,159 --> 00:32:46,320
and logs and everything i really enjoyed

935
00:32:46,320 --> 00:32:48,000
cruising through those it was very easy

936
00:32:48,000 --> 00:32:49,840
to do the triage on there

937
00:32:49,840 --> 00:32:51,279
the initial point of access was the

938
00:32:51,279 --> 00:32:53,120
single thinner single factor

939
00:32:53,120 --> 00:32:58,159
authentication into um the user's uh

940
00:32:58,159 --> 00:32:59,760
uh cloud instance in there too since

941
00:32:59,760 --> 00:33:01,519
they had spun up their own all they did

942
00:33:01,519 --> 00:33:03,360
was set up a username and password and i

943
00:33:03,360 --> 00:33:04,880
was able to see like oh this is when

944
00:33:04,880 --> 00:33:06,559
that actor logged in this doesn't match

945
00:33:06,559 --> 00:33:08,000
up with the rest of the ips that logged

946
00:33:08,000 --> 00:33:09,919
in so it's very easy to get a very

947
00:33:09,919 --> 00:33:11,120
succinct

948
00:33:11,120 --> 00:33:13,039
point of entry in there

949
00:33:13,039 --> 00:33:14,960
what credentials were compromised as

950
00:33:14,960 --> 00:33:16,880
soon as we started ingesting the logs we

951
00:33:16,880 --> 00:33:18,159
were able to see all the different

952
00:33:18,159 --> 00:33:19,440
accounts and actions that they were

953
00:33:19,440 --> 00:33:21,039
taking in there too all the different

954
00:33:21,039 --> 00:33:23,120
things that were filtered but without

955
00:33:23,120 --> 00:33:25,519
that um

956
00:33:25,519 --> 00:33:27,039
there's really no validations or

957
00:33:27,039 --> 00:33:28,960
anything that it checks on too like if

958
00:33:28,960 --> 00:33:31,279
you're signing in from russia into your

959
00:33:31,279 --> 00:33:33,360
um account or anything it's gonna start

960
00:33:33,360 --> 00:33:34,640
throwing some flags like hey you need to

961
00:33:34,640 --> 00:33:36,399
validate who you are but if it doesn't

962
00:33:36,399 --> 00:33:38,080
detect that you're like proxying through

963
00:33:38,080 --> 00:33:39,840
something it's just going to let you in

964
00:33:39,840 --> 00:33:42,399
if it thinks that it's you

965
00:33:42,399 --> 00:33:44,240
what data was xfilled

966
00:33:44,240 --> 00:33:46,159
again assuming no harm to the database

967
00:33:46,159 --> 00:33:49,039
logs we can determine that the

968
00:33:49,039 --> 00:33:50,399
all of the queries that the actor had

969
00:33:50,399 --> 00:33:52,399
done too as long as um

970
00:33:52,399 --> 00:33:54,159
you're using something like mysql which

971
00:33:54,159 --> 00:33:56,399
ingests really easily into azure

972
00:33:56,399 --> 00:33:57,840
you can see all the different commands

973
00:33:57,840 --> 00:33:59,360
and everything that was output from that

974
00:33:59,360 --> 00:34:00,720
too

975
00:34:00,720 --> 00:34:03,360
and then is there a threat to our org

976
00:34:03,360 --> 00:34:05,840
as long as the

977
00:34:05,840 --> 00:34:08,399
event logs from the initial connection

978
00:34:08,399 --> 00:34:10,320
haven't rolled over

979
00:34:10,320 --> 00:34:12,560
you could actually see in there too it's

980
00:34:12,560 --> 00:34:13,679
like oh

981
00:34:13,679 --> 00:34:15,520
this person actually connected back from

982
00:34:15,520 --> 00:34:17,520
our setup organization into the

983
00:34:17,520 --> 00:34:20,079
environment but you had to uh make sure

984
00:34:20,079 --> 00:34:21,520
that those logs hadn't rolled over yet

985
00:34:21,520 --> 00:34:24,800
on those window systems

986
00:34:25,199 --> 00:34:27,280
so as a quick summary what can be done

987
00:34:27,280 --> 00:34:28,480
now

988
00:34:28,480 --> 00:34:30,320
if you're running across this

989
00:34:30,320 --> 00:34:33,040
immediately take snapshots

990
00:34:33,040 --> 00:34:34,320
of everything that's available

991
00:34:34,320 --> 00:34:36,239
immediately back up what you can

992
00:34:36,239 --> 00:34:38,399
immediately and if the threat actor is

993
00:34:38,399 --> 00:34:39,839
still active

994
00:34:39,839 --> 00:34:42,719
um consider additionally enabling

995
00:34:42,719 --> 00:34:44,800
additional protective measures such as

996
00:34:44,800 --> 00:34:47,199
like a cloud watch or the gcp logging or

997
00:34:47,199 --> 00:34:48,480
the azure logging

998
00:34:48,480 --> 00:34:49,918
you might start getting some good data

999
00:34:49,918 --> 00:34:51,440
out of there that you can use to pivot

1000
00:34:51,440 --> 00:34:52,960
around in there

1001
00:34:52,960 --> 00:34:54,239
and then what can be done to prevent

1002
00:34:54,239 --> 00:34:56,159
this

1003
00:34:56,159 --> 00:34:59,359
make sure that your business has a plan

1004
00:34:59,359 --> 00:35:00,640
set up where even if they're doing

1005
00:35:00,640 --> 00:35:03,040
testing everyone is encouraged to do

1006
00:35:03,040 --> 00:35:05,040
subscriptions under there too it's going

1007
00:35:05,040 --> 00:35:06,560
to cost the business a little bit of

1008
00:35:06,560 --> 00:35:09,040
money but those default security options

1009
00:35:09,040 --> 00:35:11,200
that you can force enable

1010
00:35:11,200 --> 00:35:13,119
on all of like the tenants under your

1011
00:35:13,119 --> 00:35:15,119
azure subscription or anything that's

1012
00:35:15,119 --> 00:35:16,960
happening under aws

1013
00:35:16,960 --> 00:35:18,160
those are going to be your bread and

1014
00:35:18,160 --> 00:35:19,280
butter and making sure that your

1015
00:35:19,280 --> 00:35:21,280
organization is secure

1016
00:35:21,280 --> 00:35:22,400
and then

1017
00:35:22,400 --> 00:35:24,720
every single platform

1018
00:35:24,720 --> 00:35:25,520
has

1019
00:35:25,520 --> 00:35:27,839
amazing security measures

1020
00:35:27,839 --> 00:35:29,359
they have to be enabled if they're not

1021
00:35:29,359 --> 00:35:31,359
enabled you're basically going in blind

1022
00:35:31,359 --> 00:35:32,960
and hoping that like there wasn't

1023
00:35:32,960 --> 00:35:34,480
anything destructive happening because

1024
00:35:34,480 --> 00:35:36,160
the responsibility is ultimately on the

1025
00:35:36,160 --> 00:35:37,920
user when they set up these instances

1026
00:35:37,920 --> 00:35:39,920
and everything

1027
00:35:39,920 --> 00:35:43,200
um further exploration so things that i

1028
00:35:43,200 --> 00:35:46,320
want to do more of is i want to and i

1029
00:35:46,320 --> 00:35:48,160
had said this a little bit earlier but i

1030
00:35:48,160 --> 00:35:49,920
want to make a central repository of

1031
00:35:49,920 --> 00:35:51,040
like all the different things that you

1032
00:35:51,040 --> 00:35:54,320
can be able to check in these because

1033
00:35:54,320 --> 00:35:56,240
constantly constantly and this was uh

1034
00:35:56,240 --> 00:35:58,079
something that like uh i can call back

1035
00:35:58,079 --> 00:35:59,599
to a joe's presentation a little bit

1036
00:35:59,599 --> 00:36:00,800
earlier too

1037
00:36:00,800 --> 00:36:02,560
do any of you remember like all the

1038
00:36:02,560 --> 00:36:03,760
different points that you could load

1039
00:36:03,760 --> 00:36:05,920
that dll from because i don't and that

1040
00:36:05,920 --> 00:36:08,079
presentation was this morning there's no

1041
00:36:08,079 --> 00:36:10,400
way when you're doing like consulting or

1042
00:36:10,400 --> 00:36:11,440
triage on this that you're going to

1043
00:36:11,440 --> 00:36:12,960
remember every single little place that

1044
00:36:12,960 --> 00:36:14,800
you might be able to check

1045
00:36:14,800 --> 00:36:15,520
so

1046
00:36:15,520 --> 00:36:17,280
having an aggregate resource of being

1047
00:36:17,280 --> 00:36:18,960
able to look around in these things i

1048
00:36:18,960 --> 00:36:20,400
think is very important and something

1049
00:36:20,400 --> 00:36:22,720
that i'm going to continue working on

1050
00:36:22,720 --> 00:36:23,920
additionally

1051
00:36:23,920 --> 00:36:25,440
um exploring the different types of

1052
00:36:25,440 --> 00:36:27,280
things in there too i only touched on

1053
00:36:27,280 --> 00:36:28,800
the database

1054
00:36:28,800 --> 00:36:30,960
one windows machine and one linux

1055
00:36:30,960 --> 00:36:32,240
machine i didn't set up anything

1056
00:36:32,240 --> 00:36:34,240
complicated i didn't set up a vendor app

1057
00:36:34,240 --> 00:36:36,800
i didn't enable apis out or anything i

1058
00:36:36,800 --> 00:36:39,040
didn't set up big data there's so many

1059
00:36:39,040 --> 00:36:40,240
different things that we might have been

1060
00:36:40,240 --> 00:36:41,599
able to get logging on if those were

1061
00:36:41,599 --> 00:36:43,760
enabled and the attacker accessed it

1062
00:36:43,760 --> 00:36:45,119
it's just

1063
00:36:45,119 --> 00:36:47,280
completely unexplored if you don't have

1064
00:36:47,280 --> 00:36:49,200
that paid account

1065
00:36:49,200 --> 00:36:52,000
and then um what can be paid for is i

1066
00:36:52,000 --> 00:36:53,680
was kind of running myself a little thin

1067
00:36:53,680 --> 00:36:55,520
on paying so i had to

1068
00:36:55,520 --> 00:36:57,200
kind of make some assumptions on

1069
00:36:57,200 --> 00:36:58,560
especially like the microsoft side of

1070
00:36:58,560 --> 00:37:00,720
things too it's at a certain point it's

1071
00:37:00,720 --> 00:37:02,480
just myself as an individual i'm not

1072
00:37:02,480 --> 00:37:03,520
going to pay

1073
00:37:03,520 --> 00:37:05,359
a couple hundred dollars to figure out

1074
00:37:05,359 --> 00:37:06,960
if i'm getting good quality logging over

1075
00:37:06,960 --> 00:37:10,000
the next 15 to 30 minutes too it's just

1076
00:37:10,000 --> 00:37:12,320
not reasonable

1077
00:37:12,320 --> 00:37:14,400
and then um it's just expensive as an

1078
00:37:14,400 --> 00:37:16,079
individual

1079
00:37:16,079 --> 00:37:17,040
so

1080
00:37:17,040 --> 00:37:19,440
the very last thing and this is also

1081
00:37:19,440 --> 00:37:20,400
something

1082
00:37:20,400 --> 00:37:22,000
calling back to uh joe's presentation as

1083
00:37:22,000 --> 00:37:23,200
well too

1084
00:37:23,200 --> 00:37:25,520
automation of these different things

1085
00:37:25,520 --> 00:37:27,760
is something that would be very key and

1086
00:37:27,760 --> 00:37:29,040
something that i was having difficulty

1087
00:37:29,040 --> 00:37:30,720
find almost everybody that had

1088
00:37:30,720 --> 00:37:32,800
automation of collecting

1089
00:37:32,800 --> 00:37:34,400
on all of these different things like

1090
00:37:34,400 --> 00:37:36,320
figuring out what happened and getting

1091
00:37:36,320 --> 00:37:38,079
control of that every single one of them

1092
00:37:38,079 --> 00:37:39,760
was a business you had to pay another

1093
00:37:39,760 --> 00:37:42,320
organization to come in set up their

1094
00:37:42,320 --> 00:37:43,680
stuff that like linkedin with uh

1095
00:37:43,680 --> 00:37:44,800
cloudwatch

1096
00:37:44,800 --> 00:37:46,560
and then they would ingest that data and

1097
00:37:46,560 --> 00:37:48,079
calculate it for you there's no real

1098
00:37:48,079 --> 00:37:50,240
free tools that just automatically check

1099
00:37:50,240 --> 00:37:51,440
all these different places for you so i

1100
00:37:51,440 --> 00:37:52,560
think that's something that could really

1101
00:37:52,560 --> 00:37:54,960
be expanded upon

1102
00:37:54,960 --> 00:37:56,560
and with that that is the end of my

1103
00:37:56,560 --> 00:37:59,920
presentation are there any questions

1104
00:38:00,880 --> 00:38:02,560
where did my

1105
00:38:02,560 --> 00:38:05,599
little throw throwbox go

1106
00:38:05,599 --> 00:38:06,960
oh okay

1107
00:38:06,960 --> 00:38:10,320
uh that gentleman there had a question

1108
00:38:14,560 --> 00:38:15,920
thank you

1109
00:38:15,920 --> 00:38:19,440
so on the aws um as far the the future

1110
00:38:19,440 --> 00:38:20,800
things that you're going to look at is

1111
00:38:20,800 --> 00:38:22,240
it possible that you'll consider looking

1112
00:38:22,240 --> 00:38:24,160
into the free tier for cloudtrail and

1113
00:38:24,160 --> 00:38:25,920
cloudwatch

1114
00:38:25,920 --> 00:38:28,640
i try doing that um if you

1115
00:38:28,640 --> 00:38:30,320
and i maybe didn't emphasize this

1116
00:38:30,320 --> 00:38:32,640
properly and i apologize if you have

1117
00:38:32,640 --> 00:38:34,560
those events start happening going

1118
00:38:34,560 --> 00:38:36,560
forward after you enable it you start

1119
00:38:36,560 --> 00:38:37,839
getting some really good quality logging

1120
00:38:37,839 --> 00:38:39,200
that's the same for all three of them

1121
00:38:39,200 --> 00:38:40,400
but as far as like any sort of

1122
00:38:40,400 --> 00:38:43,040
historical data or anything goes to

1123
00:38:43,040 --> 00:38:45,520
after like 15 minutes or so like that

1124
00:38:45,520 --> 00:38:47,040
data is basically just out into the

1125
00:38:47,040 --> 00:38:49,200
ether you can't see it anymore so if

1126
00:38:49,200 --> 00:38:50,560
that machine got compromised that

1127
00:38:50,560 --> 00:38:52,560
morning and you investigated it that

1128
00:38:52,560 --> 00:38:54,160
afternoon you would not see any of the

1129
00:38:54,160 --> 00:38:55,280
stuff that happened that morning if it

1130
00:38:55,280 --> 00:38:57,200
wasn't already enabled

1131
00:38:57,200 --> 00:38:59,040
so you're just talking about innately

1132
00:38:59,040 --> 00:39:01,119
without it being enabled first and then

1133
00:39:01,119 --> 00:39:03,359
turning it on afterwards yeah just

1134
00:39:03,359 --> 00:39:05,200
turning it on afterwards it wasn't

1135
00:39:05,200 --> 00:39:06,640
something that was recommended be turned

1136
00:39:06,640 --> 00:39:08,880
on by default and so i was just trying

1137
00:39:08,880 --> 00:39:10,160
to like go through it as quickly as

1138
00:39:10,160 --> 00:39:12,160
possible to set something up

1139
00:39:12,160 --> 00:39:13,920
because i wanted to emulate basically

1140
00:39:13,920 --> 00:39:15,839
what an end user would do who doesn't

1141
00:39:15,839 --> 00:39:17,520
really have a mind for security it's

1142
00:39:17,520 --> 00:39:18,960
they're going to click next next next

1143
00:39:18,960 --> 00:39:20,079
next next

1144
00:39:20,079 --> 00:39:22,160
and then go to the end product there too

1145
00:39:22,160 --> 00:39:23,040
and

1146
00:39:23,040 --> 00:39:24,640
if it was already pre-checked and

1147
00:39:24,640 --> 00:39:26,560
everything i would leave it enabled

1148
00:39:26,560 --> 00:39:28,640
unless it costs extra money like the uh

1149
00:39:28,640 --> 00:39:30,079
azure one where it was like going to

1150
00:39:30,079 --> 00:39:32,320
charge me 15 per machine for enabling

1151
00:39:32,320 --> 00:39:34,000
atp

1152
00:39:34,000 --> 00:39:35,760
well back to my my prior question would

1153
00:39:35,760 --> 00:39:37,680
it be possible to look into that because

1154
00:39:37,680 --> 00:39:39,280
i think there's a lot of benefit looking

1155
00:39:39,280 --> 00:39:40,079
at

1156
00:39:40,079 --> 00:39:42,480
if you start identifying you know your

1157
00:39:42,480 --> 00:39:44,160
critical assets the critical things that

1158
00:39:44,160 --> 00:39:45,680
you want yeah if you enable it and

1159
00:39:45,680 --> 00:39:47,280
everything too that's another really big

1160
00:39:47,280 --> 00:39:49,359
piece is like enable this on everything

1161
00:39:49,359 --> 00:39:50,720
you can start finding some amazing

1162
00:39:50,720 --> 00:39:52,800
artifacts and everything too but if it's

1163
00:39:52,800 --> 00:39:54,640
not already enabled like if you're going

1164
00:39:54,640 --> 00:39:56,160
in blind to like just somebody's

1165
00:39:56,160 --> 00:39:57,440
instance they set up

1166
00:39:57,440 --> 00:39:58,720
it's not really enabled by default

1167
00:39:58,720 --> 00:40:00,160
you're not going to find anything so

1168
00:40:00,160 --> 00:40:01,520
that that was the point that i was

1169
00:40:01,520 --> 00:40:03,599
trying to investigate there because

1170
00:40:03,599 --> 00:40:05,200
like at most businesses you have like

1171
00:40:05,200 --> 00:40:06,960
that overarching umbrella you have those

1172
00:40:06,960 --> 00:40:08,319
default policies that are going to be

1173
00:40:08,319 --> 00:40:10,319
force enabled for security on all the

1174
00:40:10,319 --> 00:40:12,000
different things cloud watch different

1175
00:40:12,000 --> 00:40:14,800
ip connecting and everything but what if

1176
00:40:14,800 --> 00:40:16,960
your sales department just went and set

1177
00:40:16,960 --> 00:40:18,880
up something off the network just to get

1178
00:40:18,880 --> 00:40:20,480
it set up really quick

1179
00:40:20,480 --> 00:40:22,240
and then try to demo a product with a

1180
00:40:22,240 --> 00:40:24,000
vendor like that that was the idea that

1181
00:40:24,000 --> 00:40:26,079
i was trying to explore there thank you

1182
00:40:26,079 --> 00:40:27,200
yeah no problem

1183
00:40:27,200 --> 00:40:30,240
are there any other questions

1184
00:40:34,000 --> 00:40:35,119
um

1185
00:40:35,119 --> 00:40:36,960
so can't you just mitigate that kind of

1186
00:40:36,960 --> 00:40:39,359
problems with using services like lambda

1187
00:40:39,359 --> 00:40:41,119
which is basically much basically

1188
00:40:41,119 --> 00:40:42,400
serverless

1189
00:40:42,400 --> 00:40:43,920
so you can avoid the security side

1190
00:40:43,920 --> 00:40:45,119
because then

1191
00:40:45,119 --> 00:40:46,319
for the

1192
00:40:46,319 --> 00:40:47,760
um

1193
00:40:47,760 --> 00:40:49,599
for the agreement between you and aws if

1194
00:40:49,599 --> 00:40:51,359
you use lambda they're pretty much

1195
00:40:51,359 --> 00:40:53,040
they're the one responsible for security

1196
00:40:53,040 --> 00:40:54,000
and everything and you just have to

1197
00:40:54,000 --> 00:40:56,880
worry about your product yeah so if you

1198
00:40:56,880 --> 00:40:59,119
go from like just the uh

1199
00:40:59,119 --> 00:41:01,359
cloud host as a service and you start

1200
00:41:01,359 --> 00:41:02,720
going down to like basically they

1201
00:41:02,720 --> 00:41:03,839
provide everything and you're just

1202
00:41:03,839 --> 00:41:05,440
providing the data you can start getting

1203
00:41:05,440 --> 00:41:06,560
a lot better security logs and

1204
00:41:06,560 --> 00:41:08,000
everything in there too

1205
00:41:08,000 --> 00:41:09,920
um the one thing that i was just really

1206
00:41:09,920 --> 00:41:11,520
annoyed by and then i got kind of the

1207
00:41:11,520 --> 00:41:13,280
question on too is like if you don't

1208
00:41:13,280 --> 00:41:15,200
have adblock installed you start seeing

1209
00:41:15,200 --> 00:41:18,000
those things like oh try gcp3 for month

1210
00:41:18,000 --> 00:41:21,359
or try aws free for a month or that kind

1211
00:41:21,359 --> 00:41:22,880
of stuff too so i was like

1212
00:41:22,880 --> 00:41:24,720
well that's what the end user is going

1213
00:41:24,720 --> 00:41:26,720
to see so that's what i was trying to

1214
00:41:26,720 --> 00:41:28,160
explore there too just that very

1215
00:41:28,160 --> 00:41:30,640
specific divot there got you

1216
00:41:30,640 --> 00:41:32,319
thank you yeah any other questions from

1217
00:41:32,319 --> 00:41:33,440
the audience

1218
00:41:33,440 --> 00:41:35,119
yeah

1219
00:41:35,119 --> 00:41:36,880
you can toss that thing too it's made

1220
00:41:36,880 --> 00:41:39,520
fluffy so you can catch it

1221
00:41:39,520 --> 00:41:41,760
all right i'll toss it when i'm done um

1222
00:41:41,760 --> 00:41:44,160
so i'm thinking about the ir pathway

1223
00:41:44,160 --> 00:41:47,520
yeah you've immediately made a

1224
00:41:47,520 --> 00:41:49,920
copy of the vm right so that nothing

1225
00:41:49,920 --> 00:41:52,319
gets overwritten yeah but then you want

1226
00:41:52,319 --> 00:41:53,359
to keep it

1227
00:41:53,359 --> 00:41:55,359
uh maybe not pay for it on the cloud you

1228
00:41:55,359 --> 00:41:57,760
want to download that image right did

1229
00:41:57,760 --> 00:42:00,079
you try that on all three tiers i didn't

1230
00:42:00,079 --> 00:42:01,839
try to download it on all the tiers

1231
00:42:01,839 --> 00:42:02,880
that'd be something else i'd have to

1232
00:42:02,880 --> 00:42:05,680
explore i do know

1233
00:42:05,680 --> 00:42:07,200
i think

1234
00:42:07,200 --> 00:42:08,800
one of the cloud providers i basically

1235
00:42:08,800 --> 00:42:10,720
had to upgrade the storage model and i

1236
00:42:10,720 --> 00:42:12,640
was able to download it but it was

1237
00:42:12,640 --> 00:42:15,200
fairly economical so i would assume the

1238
00:42:15,200 --> 00:42:17,680
same for all three providers but just on

1239
00:42:17,680 --> 00:42:18,960
the free tier if you don't want to spend

1240
00:42:18,960 --> 00:42:20,880
any money i don't think that's an option

1241
00:42:20,880 --> 00:42:23,280
okay thanks

1242
00:42:23,280 --> 00:42:25,599
any other questions from the audience

1243
00:42:25,599 --> 00:42:27,680
oh i want to throw this thing

1244
00:42:27,680 --> 00:42:31,399
you can throw back to me

1245
00:42:37,760 --> 00:42:39,760
any questions from discord yeah well

1246
00:42:39,760 --> 00:42:42,000
there was a comment on discord yeah

1247
00:42:42,000 --> 00:42:43,760
thanks kyle for the presentation

1248
00:42:43,760 --> 00:42:46,000
automation is pertinent as these threats

1249
00:42:46,000 --> 00:42:47,760
increase with communication to cloud

1250
00:42:47,760 --> 00:42:49,839
systems using powershell

1251
00:42:49,839 --> 00:42:51,760
other scripting forms

1252
00:42:51,760 --> 00:42:54,160
were you able to find anything on github

1253
00:42:54,160 --> 00:42:56,839
to automate logging and is that

1254
00:42:56,839 --> 00:42:59,760
possible there is a lot of different

1255
00:42:59,760 --> 00:43:02,240
github projects articles and everything

1256
00:43:02,240 --> 00:43:04,640
else on there too there's no humanly

1257
00:43:04,640 --> 00:43:06,880
possible way for me to have read all of

1258
00:43:06,880 --> 00:43:08,800
them i didn't find anything that was

1259
00:43:08,800 --> 00:43:10,640
super pertinent but there were a couple

1260
00:43:10,640 --> 00:43:12,240
different like just random repos that

1261
00:43:12,240 --> 00:43:14,000
would be like yeah download all of your

1262
00:43:14,000 --> 00:43:16,319
logs from this specific type of database

1263
00:43:16,319 --> 00:43:18,319
or whatever that you have hosted on uh

1264
00:43:18,319 --> 00:43:20,160
gcp or something like that

1265
00:43:20,160 --> 00:43:22,560
so there are opportunities

1266
00:43:22,560 --> 00:43:25,359
um to kind of grow that and that's the

1267
00:43:25,359 --> 00:43:27,200
other what i really want to do is try to

1268
00:43:27,200 --> 00:43:29,280
like aggregate those resources into like

1269
00:43:29,280 --> 00:43:30,720
a single point because it's something

1270
00:43:30,720 --> 00:43:32,160
that's a

1271
00:43:32,160 --> 00:43:34,240
very big coverage gap and it's the same

1272
00:43:34,240 --> 00:43:35,920
thing as like the uh

1273
00:43:35,920 --> 00:43:38,400
mondo dp uh when that was very popular

1274
00:43:38,400 --> 00:43:39,920
to get exploited because people are just

1275
00:43:39,920 --> 00:43:41,680
spinning up instances and having them

1276
00:43:41,680 --> 00:43:44,560
default enabled to the cloud

1277
00:43:44,560 --> 00:43:46,960
it's just going to be a loss of data and

1278
00:43:46,960 --> 00:43:48,800
it's not going to be able to determine

1279
00:43:48,800 --> 00:43:49,920
if you can

1280
00:43:49,920 --> 00:43:51,520
even triage it figure out what was

1281
00:43:51,520 --> 00:43:53,200
exposed or not to just because those

1282
00:43:53,200 --> 00:43:56,560
options aren't enabled by default

1283
00:44:01,760 --> 00:44:03,920
all right and then if there's any other

1284
00:44:03,920 --> 00:44:06,000
questions or comments that you think of

1285
00:44:06,000 --> 00:44:08,560
later too i am in the cactus con 10 and

1286
00:44:08,560 --> 00:44:11,040
regular cactus con discord please try to

1287
00:44:11,040 --> 00:44:13,520
uh at me in there if you uh think of

1288
00:44:13,520 --> 00:44:15,200
anything so that way i remember to check

1289
00:44:15,200 --> 00:44:17,760
it later because i probably am not gonna

1290
00:44:17,760 --> 00:44:19,680
look at it until uh tomorrow and i'm

1291
00:44:19,680 --> 00:44:20,839
gonna forget

1292
00:44:20,839 --> 00:44:26,119
so with that thank you so much everybody

1293
00:44:49,760 --> 00:44:51,839
you

