1
00:00:05,440 --> 00:00:08,639
hey

2
00:00:06,080 --> 00:00:10,400
all right hey again cactus khan ryan

3
00:00:08,639 --> 00:00:11,120
once more with you from the cactus con

4
00:00:10,400 --> 00:00:13,679
crew

5
00:00:11,120 --> 00:00:15,518
and i am here with nick and edmund who

6
00:00:13,679 --> 00:00:17,600
just gave a great talk

7
00:00:15,519 --> 00:00:19,119
and i think it's fantastic we were able

8
00:00:17,600 --> 00:00:20,160
to kind of end out the day with like a

9
00:00:19,119 --> 00:00:22,800
block of malware

10
00:00:20,160 --> 00:00:24,160
analysis talks uh me being a hardcore

11
00:00:22,800 --> 00:00:25,439
malware nerd

12
00:00:24,160 --> 00:00:27,279
i don't know if that was by design on

13
00:00:25,439 --> 00:00:30,480
our overall team's part or what but i

14
00:00:27,279 --> 00:00:31,599
i loved it so first off thank both of

15
00:00:30,480 --> 00:00:33,760
you for your talk

16
00:00:31,599 --> 00:00:36,480
really really appreciate it uh and thank

17
00:00:33,760 --> 00:00:37,519
you for being here doing a q a with us

18
00:00:36,480 --> 00:00:40,000
yeah thanks for having us thanks for

19
00:00:37,520 --> 00:00:41,600
having us really appreciate it heck yeah

20
00:00:40,000 --> 00:00:43,040
before we get into it we don't have a

21
00:00:41,600 --> 00:00:44,239
ton of time for our q a because we're

22
00:00:43,040 --> 00:00:45,839
coming up against the hour

23
00:00:44,239 --> 00:00:47,760
i'm gonna go ahead and uh finish our

24
00:00:45,840 --> 00:00:50,239
giveaway for the infosec

25
00:00:47,760 --> 00:00:51,839
the signed infosec rockstar book so i'm

26
00:00:50,239 --> 00:00:54,480
just gonna do that now

27
00:00:51,840 --> 00:00:56,399
and we will then get into it so we're

28
00:00:54,480 --> 00:00:59,038
gonna give away two of these bad boys

29
00:00:56,399 --> 00:01:00,559
let's go over here and that guy and we

30
00:00:59,039 --> 00:01:04,239
go with this guy and boom

31
00:01:00,559 --> 00:01:06,960
and our winners are stranger and robin

32
00:01:04,239 --> 00:01:08,560
have been selected by the i'll take it

33
00:01:06,960 --> 00:01:11,199
probably pseudo random

34
00:01:08,560 --> 00:01:12,640
hack tar bot so we will get in touch and

35
00:01:11,200 --> 00:01:14,080
we will make sure that these books get

36
00:01:12,640 --> 00:01:15,840
shipped out to you

37
00:01:14,080 --> 00:01:17,439
for anyone who's been following along if

38
00:01:15,840 --> 00:01:17,920
you have won something throughout the

39
00:01:17,439 --> 00:01:20,399
day

40
00:01:17,920 --> 00:01:22,080
we will be in touch essentially so i'll

41
00:01:20,400 --> 00:01:23,840
be shipping a lot of those myself so i

42
00:01:22,080 --> 00:01:24,798
need to know your address so be prepared

43
00:01:23,840 --> 00:01:28,000
for that

44
00:01:24,799 --> 00:01:28,640
all right fellas the talk is was

45
00:01:28,000 --> 00:01:31,600
absolutely

46
00:01:28,640 --> 00:01:32,079
awesome i love the whole discussion

47
00:01:31,600 --> 00:01:34,479
about

48
00:01:32,079 --> 00:01:35,199
general invasion you know um sandbox

49
00:01:34,479 --> 00:01:37,679
evasion or

50
00:01:35,200 --> 00:01:39,280
vm evasion and i think that we all

51
00:01:37,680 --> 00:01:42,079
especially in the malware community

52
00:01:39,280 --> 00:01:43,600
right we all remember when any type of

53
00:01:42,079 --> 00:01:45,520
virtualized environment

54
00:01:43,600 --> 00:01:47,039
most malware samples were being written

55
00:01:45,520 --> 00:01:49,280
such that it'd be like no

56
00:01:47,040 --> 00:01:50,880
i don't i'm not running there right and

57
00:01:49,280 --> 00:01:52,000
then now and someone even mentioned in

58
00:01:50,880 --> 00:01:53,759
the chat it's like

59
00:01:52,000 --> 00:01:55,520
do we have non-virtualized environments

60
00:01:53,759 --> 00:01:57,439
at this point like really

61
00:01:55,520 --> 00:01:58,640
especially in a server-based environment

62
00:01:57,439 --> 00:02:01,039
you know uh you

63
00:01:58,640 --> 00:02:02,560
move laterally over to a dc you're like

64
00:02:01,040 --> 00:02:03,840
that's probably gonna be virtualized at

65
00:02:02,560 --> 00:02:06,240
this point

66
00:02:03,840 --> 00:02:08,160
so we had a couple of great things one

67
00:02:06,240 --> 00:02:10,399
thing i wanted to bring up was api

68
00:02:08,160 --> 00:02:12,079
obfuscation do either of you have a

69
00:02:10,399 --> 00:02:14,319
favorite that you've ever seen

70
00:02:12,080 --> 00:02:15,440
for api calls being obfuscated you know

71
00:02:14,319 --> 00:02:17,040
you talked about that

72
00:02:15,440 --> 00:02:18,800
hashing methodology which you see a lot

73
00:02:17,040 --> 00:02:20,239
in malware these days so anything

74
00:02:18,800 --> 00:02:22,560
that just like just stands out in your

75
00:02:20,239 --> 00:02:25,120
head like that was awesome

76
00:02:22,560 --> 00:02:26,720
i remember uh gazdem which was a banking

77
00:02:25,120 --> 00:02:28,239
trojan that we did some analysis on a

78
00:02:26,720 --> 00:02:28,959
few years ago they had a pretty

79
00:02:28,239 --> 00:02:30,480
interesting

80
00:02:28,959 --> 00:02:32,640
um hashing algorithm that they were

81
00:02:30,480 --> 00:02:34,560
using and if i recall correctly they

82
00:02:32,640 --> 00:02:36,399
actually had multiple stages of

83
00:02:34,560 --> 00:02:38,560
de-obfuscation that had to be performed

84
00:02:36,400 --> 00:02:39,760
in order to uh to get to the actual api

85
00:02:38,560 --> 00:02:41,519
that was being called before you could

86
00:02:39,760 --> 00:02:45,760
figure out what the malware was doing

87
00:02:41,519 --> 00:02:45,760
it's pretty interesting that sounds fun

88
00:02:46,000 --> 00:02:50,000
yeah i think a lot of it no go ahead

89
00:02:48,239 --> 00:02:51,680
edmond now go ahead

90
00:02:50,000 --> 00:02:53,200
no i was just gonna say for me just the

91
00:02:51,680 --> 00:02:54,959
stuff that we talked about is just

92
00:02:53,200 --> 00:02:56,879
it you know there's so much out there

93
00:02:54,959 --> 00:02:58,959
the stuff's just the classics are always

94
00:02:56,879 --> 00:03:02,480
going to be great

95
00:02:58,959 --> 00:03:04,400
yeah i agree i agree we had

96
00:03:02,480 --> 00:03:06,799
a you know the general question that

97
00:03:04,400 --> 00:03:08,400
started off was basically if malware is

98
00:03:06,800 --> 00:03:10,480
checking to see if it's in a vm

99
00:03:08,400 --> 00:03:11,920
you know it won't run but wouldn't it be

100
00:03:10,480 --> 00:03:12,560
smart to just run your production

101
00:03:11,920 --> 00:03:15,599
systems

102
00:03:12,560 --> 00:03:18,480
in vms so are you still

103
00:03:15,599 --> 00:03:20,079
seeing um like what percentage i guess i

104
00:03:18,480 --> 00:03:21,760
should say of the malware samples you're

105
00:03:20,080 --> 00:03:24,640
farting around with are you seeing

106
00:03:21,760 --> 00:03:25,840
are just outright going like that's a vm

107
00:03:24,640 --> 00:03:29,279
i want out

108
00:03:25,840 --> 00:03:31,440
versus this is potentially a sandbox

109
00:03:29,280 --> 00:03:33,280
i i think some of it depends on the type

110
00:03:31,440 --> 00:03:34,400
of threat more than than anything else

111
00:03:33,280 --> 00:03:36,319
right you've got threats that are

112
00:03:34,400 --> 00:03:38,640
specifically designed to

113
00:03:36,319 --> 00:03:39,599
attack uh you know consumers or end

114
00:03:38,640 --> 00:03:40,879
users like the

115
00:03:39,599 --> 00:03:42,560
you know the banking trojans that we

116
00:03:40,879 --> 00:03:44,079
refer to right they're specifically

117
00:03:42,560 --> 00:03:46,319
designed to execute on

118
00:03:44,080 --> 00:03:47,840
systems that users use to check their

119
00:03:46,319 --> 00:03:49,839
bank accounts for instance so

120
00:03:47,840 --> 00:03:51,040
you know they're going to be you know

121
00:03:49,840 --> 00:03:53,439
more willing to

122
00:03:51,040 --> 00:03:54,480
run on physical systems versus virtual

123
00:03:53,439 --> 00:03:55,519
systems but then you've got other

124
00:03:54,480 --> 00:03:56,879
threats that

125
00:03:55,519 --> 00:03:59,040
don't really care like let's say

126
00:03:56,879 --> 00:04:00,399
ransomware that um you know

127
00:03:59,040 --> 00:04:01,840
doesn't care if it's a vm or not it

128
00:04:00,400 --> 00:04:03,280
wants to encrypt all the things because

129
00:04:01,840 --> 00:04:04,000
that's how they generate revenue so a

130
00:04:03,280 --> 00:04:06,319
lot of it is

131
00:04:04,000 --> 00:04:09,760
threat centric as opposed to you know

132
00:04:06,319 --> 00:04:09,760
thinking about it as like a whole

133
00:04:11,760 --> 00:04:14,720
yeah well fred

134
00:04:17,358 --> 00:04:20,478
uh one of the things about sandbox

135
00:04:19,358 --> 00:04:23,039
detection you know

136
00:04:20,478 --> 00:04:23,680
and we mentioned this in one of the

137
00:04:23,040 --> 00:04:25,840
malware

138
00:04:23,680 --> 00:04:28,080
courses that i'm affiliated with for

139
00:04:25,840 --> 00:04:29,440
example cuckoo by default its host name

140
00:04:28,080 --> 00:04:31,758
is cuckoo dash pc

141
00:04:29,440 --> 00:04:33,040
and you're like okay well that's that's

142
00:04:31,759 --> 00:04:35,199
cuckoo

143
00:04:33,040 --> 00:04:36,800
um have you what's the most creative

144
00:04:35,199 --> 00:04:38,639
thing you've ever seen i remember the

145
00:04:36,800 --> 00:04:40,960
first time that i used a

146
00:04:38,639 --> 00:04:42,000
uh a mass of fire eye mask which is now

147
00:04:40,960 --> 00:04:44,719
the uh with the ax

148
00:04:42,000 --> 00:04:45,520
right the analysis engine uh the mouse

149
00:04:44,720 --> 00:04:47,440
started moving

150
00:04:45,520 --> 00:04:49,198
left and right they open v and c and you

151
00:04:47,440 --> 00:04:50,800
can actually vnc in and watch it

152
00:04:49,199 --> 00:04:52,800
detonate the malware and i was like why

153
00:04:50,800 --> 00:04:54,639
the hell is the mouse moving and then

154
00:04:52,800 --> 00:04:56,800
realize like oh that's why

155
00:04:54,639 --> 00:04:57,680
is there anything extremely creative

156
00:04:56,800 --> 00:05:00,560
that you've seen

157
00:04:57,680 --> 00:05:01,039
that a sandbox or type of system has

158
00:05:00,560 --> 00:05:04,960
done

159
00:05:01,039 --> 00:05:06,800
to potentially thwart you know detection

160
00:05:04,960 --> 00:05:08,638
i've always liked mouse movements been

161
00:05:06,800 --> 00:05:10,479
one of my favorites so you know writing

162
00:05:08,639 --> 00:05:13,440
a script to do that

163
00:05:10,479 --> 00:05:13,840
yeah or um writing a script to uh to

164
00:05:13,440 --> 00:05:15,759
change

165
00:05:13,840 --> 00:05:17,359
active window state uh because a lot of

166
00:05:15,759 --> 00:05:19,280
malware will check and it won't do

167
00:05:17,360 --> 00:05:20,800
anything until it it sees that you know

168
00:05:19,280 --> 00:05:22,719
the active window state the active

169
00:05:20,800 --> 00:05:23,440
window has changed from one program to

170
00:05:22,720 --> 00:05:24,720
the next

171
00:05:23,440 --> 00:05:26,960
you know to make sure that a user is

172
00:05:24,720 --> 00:05:27,919
physically at the keyboard um so so

173
00:05:26,960 --> 00:05:29,440
things like that are

174
00:05:27,919 --> 00:05:32,159
always interesting to implement to try

175
00:05:29,440 --> 00:05:33,919
to fool the the anti-vm

176
00:05:32,160 --> 00:05:35,520
yeah i always like for like sandbox

177
00:05:33,919 --> 00:05:37,520
stuff when you even simple stuff like

178
00:05:35,520 --> 00:05:38,960
making the macros only execute on exit

179
00:05:37,520 --> 00:05:40,799
right most sandboxes aren't going to

180
00:05:38,960 --> 00:05:42,960
exit word so that was a great

181
00:05:40,800 --> 00:05:44,720
super simple evasion that worked really

182
00:05:42,960 --> 00:05:46,719
really well

183
00:05:44,720 --> 00:05:48,639
yeah that's that's a door i actually

184
00:05:46,720 --> 00:05:50,800
really like that one that's a cool idea

185
00:05:48,639 --> 00:05:52,160
all right i have i'm a malware guy i

186
00:05:50,800 --> 00:05:53,600
have so many questions i want to ask

187
00:05:52,160 --> 00:05:55,199
both of you right now and get into it

188
00:05:53,600 --> 00:05:57,360
time wise we got it we got to kick it

189
00:05:55,199 --> 00:06:00,080
off so uh we're done

190
00:05:57,360 --> 00:06:01,759
with giveaways for the day um i wanted

191
00:06:00,080 --> 00:06:03,680
to also reference the fact that zip

192
00:06:01,759 --> 00:06:05,440
files are now natively just opened by

193
00:06:03,680 --> 00:06:06,639
windows but it leaves a forensic

194
00:06:05,440 --> 00:06:08,639
artifact of the temp

195
00:06:06,639 --> 00:06:10,080
and the underscore with the zip name and

196
00:06:08,639 --> 00:06:10,720
all these fun things to look at and you

197
00:06:10,080 --> 00:06:12,560
can just run

198
00:06:10,720 --> 00:06:14,880
jscript or javascript in windows like

199
00:06:12,560 --> 00:06:15,759
that's cool so a lot of things that you

200
00:06:14,880 --> 00:06:18,080
really hit on

201
00:06:15,759 --> 00:06:19,120
that uh just absolutely you know are

202
00:06:18,080 --> 00:06:20,960
very important to

203
00:06:19,120 --> 00:06:22,639
the analysis that we all do in the

204
00:06:20,960 --> 00:06:23,680
malware world so thank you both very

205
00:06:22,639 --> 00:06:25,840
very much for your talk

206
00:06:23,680 --> 00:06:27,039
really really appreciate it thanks for

207
00:06:25,840 --> 00:06:28,239
having us appreciate it

208
00:06:27,039 --> 00:06:30,479
yeah thanks for having us it's a good

209
00:06:28,240 --> 00:06:35,840
time yeah awesome all right

210
00:06:30,479 --> 00:06:35,840
see you guys

