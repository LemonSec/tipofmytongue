1
00:00:02,800 --> 00:00:06,399
hey everyone alex here again

2
00:00:04,640 --> 00:00:08,639
our next cactus contact is the full

3
00:00:06,399 --> 00:00:10,719
purple juice not the watered down stuff

4
00:00:08,639 --> 00:00:12,639
which is brought to us by george ortiz

5
00:00:10,719 --> 00:00:14,239
who's the cto of scythe

6
00:00:12,639 --> 00:00:16,560
and bryson bort who's the founder of

7
00:00:14,240 --> 00:00:18,080
scythe after the talk stick around for a

8
00:00:16,560 --> 00:00:19,759
live q a with george

9
00:00:18,080 --> 00:00:21,198
and bryson just go ahead and click the

10
00:00:19,760 --> 00:00:23,920
link that pops up on your screen

11
00:00:21,199 --> 00:00:23,920
enjoy the talk

12
00:00:26,960 --> 00:00:33,120
all right hello cactus con

13
00:00:30,000 --> 00:00:36,399
welcome to uh what we call motorhead so

14
00:00:33,120 --> 00:00:38,239
uh we always like to uh use little uh

15
00:00:36,399 --> 00:00:39,840
double 07 names for our different

16
00:00:38,239 --> 00:00:43,120
projects for our

17
00:00:39,840 --> 00:00:45,440
customer privacy and in this case the

18
00:00:43,120 --> 00:00:47,038
client actually let us share not only

19
00:00:45,440 --> 00:00:48,399
who they are so thank you to the

20
00:00:47,039 --> 00:00:49,600
national motor freight traffic

21
00:00:48,399 --> 00:00:52,719
association

22
00:00:49,600 --> 00:00:54,719
um but they were willing to let

23
00:00:52,719 --> 00:00:56,879
us go out and share the technical

24
00:00:54,719 --> 00:00:59,680
details of a full

25
00:00:56,879 --> 00:01:01,120
purple team engagement now i'm sure some

26
00:00:59,680 --> 00:01:03,280
of you have heard about purple team

27
00:01:01,120 --> 00:01:05,039
some of you might have done purple teams

28
00:01:03,280 --> 00:01:08,080
uh but

29
00:01:05,040 --> 00:01:09,840
this was a six week on the ground

30
00:01:08,080 --> 00:01:12,240
engagement for a purple team i've never

31
00:01:09,840 --> 00:01:13,920
actually heard or seen one this big so

32
00:01:12,240 --> 00:01:15,520
it's we're really lucky to be able to

33
00:01:13,920 --> 00:01:18,000
share this

34
00:01:15,520 --> 00:01:19,119
yep very happy to be here of course

35
00:01:18,000 --> 00:01:21,759
we're not gonna

36
00:01:19,119 --> 00:01:22,400
make this a sales presentation uh we're

37
00:01:21,759 --> 00:01:25,600
gonna talk

38
00:01:22,400 --> 00:01:26,159
mostly all technical uh data and again

39
00:01:25,600 --> 00:01:28,960
shout out

40
00:01:26,159 --> 00:01:29,840
to the folks that let us talk about this

41
00:01:28,960 --> 00:01:31,600
because

42
00:01:29,840 --> 00:01:34,000
most of the time we have to show fake

43
00:01:31,600 --> 00:01:34,640
data and this time we get to show real

44
00:01:34,000 --> 00:01:37,520
data

45
00:01:34,640 --> 00:01:38,720
and uh as usual we hope that what you

46
00:01:37,520 --> 00:01:43,439
learn here today

47
00:01:38,720 --> 00:01:43,439
can be used immediately uh at work

48
00:01:44,240 --> 00:01:47,520
all right so hi i'm the unicorn bryson

49
00:01:47,119 --> 00:01:50,640
um

50
00:01:47,520 --> 00:01:52,479
i founded scythe which was a spin out of

51
00:01:50,640 --> 00:01:53,680
the consultancy i founded uh eight years

52
00:01:52,479 --> 00:01:55,600
ago called graham

53
00:01:53,680 --> 00:01:58,159
and then i'm the co-founder of the ics

54
00:01:55,600 --> 00:02:00,559
village non-profit

55
00:01:58,159 --> 00:02:02,719
and i am george ortiz i'm the chief

56
00:02:00,560 --> 00:02:05,600
technology officer here at scythe

57
00:02:02,719 --> 00:02:06,719
i've uh done some industry contributions

58
00:02:05,600 --> 00:02:09,598
like the purple team

59
00:02:06,719 --> 00:02:10,639
exercise framework and the c2 matrix

60
00:02:09,598 --> 00:02:13,599
prior to scythe

61
00:02:10,639 --> 00:02:14,319
i ran the offensive team at city for 10

62
00:02:13,599 --> 00:02:16,959
years

63
00:02:14,319 --> 00:02:18,720
and i also teach for sans and am an

64
00:02:16,959 --> 00:02:20,840
author of the red team exercise and

65
00:02:18,720 --> 00:02:23,680
adversary emulation

66
00:02:20,840 --> 00:02:27,440
course so

67
00:02:23,680 --> 00:02:30,319
today we have an agenda as usual um

68
00:02:27,440 --> 00:02:31,680
real quick executive summary so you see

69
00:02:30,319 --> 00:02:33,679
what we did

70
00:02:31,680 --> 00:02:36,000
and hopefully find that valuable and

71
00:02:33,680 --> 00:02:38,879
don't drop off and go to another track

72
00:02:36,000 --> 00:02:39,519
um and then we'll go through uh the

73
00:02:38,879 --> 00:02:42,799
purple team

74
00:02:39,519 --> 00:02:44,720
exercise it was six week long exercise

75
00:02:42,800 --> 00:02:46,000
every week was a different adversary

76
00:02:44,720 --> 00:02:49,120
that we emulated

77
00:02:46,000 --> 00:02:52,800
and then also did detection engineering

78
00:02:49,120 --> 00:02:56,560
to figure out how to detect and respond

79
00:02:52,800 --> 00:02:56,560
against that threat actor

80
00:02:59,680 --> 00:03:04,400
so six week long exercise we did do a

81
00:03:02,959 --> 00:03:07,920
zoom breach scenario

82
00:03:04,400 --> 00:03:10,720
assume breach means that we know and our

83
00:03:07,920 --> 00:03:12,480
client knows that they are going to be

84
00:03:10,720 --> 00:03:15,120
compromised which means that we

85
00:03:12,480 --> 00:03:16,319
started with initial access we did not

86
00:03:15,120 --> 00:03:19,680
focus on things like

87
00:03:16,319 --> 00:03:21,518
fishing or exploiting some uh

88
00:03:19,680 --> 00:03:22,879
vulnerability on their perimeter or

89
00:03:21,519 --> 00:03:24,959
anything like that

90
00:03:22,879 --> 00:03:26,079
we started inside which brings a lot of

91
00:03:24,959 --> 00:03:27,760
value um

92
00:03:26,080 --> 00:03:29,519
if you've not heard of assume breach

93
00:03:27,760 --> 00:03:30,798
before definitely check it out it's

94
00:03:29,519 --> 00:03:33,920
definitely high value

95
00:03:30,799 --> 00:03:36,080
in the offensive space as well and we

96
00:03:33,920 --> 00:03:38,159
did this as a purple team exercise

97
00:03:36,080 --> 00:03:39,840
that is multiple teams working together

98
00:03:38,159 --> 00:03:40,480
lots of people think it's just red and

99
00:03:39,840 --> 00:03:43,280
blue

100
00:03:40,480 --> 00:03:45,280
that's also all it also includes the

101
00:03:43,280 --> 00:03:47,040
cyber threat intelligence team

102
00:03:45,280 --> 00:03:49,040
which provides information about

103
00:03:47,040 --> 00:03:50,159
adversaries are likely to target the

104
00:03:49,040 --> 00:03:52,400
organization

105
00:03:50,159 --> 00:03:53,519
the red team is the offensive team and

106
00:03:52,400 --> 00:03:56,799
then the blue team

107
00:03:53,519 --> 00:03:57,920
are the defenders we came into this

108
00:03:56,799 --> 00:03:59,680
organization

109
00:03:57,920 --> 00:04:01,359
and they asked us to actually perform

110
00:03:59,680 --> 00:04:03,040
all three roles

111
00:04:01,360 --> 00:04:04,640
and to pretty much improve their

112
00:04:03,040 --> 00:04:08,400
security with

113
00:04:04,640 --> 00:04:11,279
zero dollar technology spend

114
00:04:08,400 --> 00:04:12,319
only work with the tools we had

115
00:04:11,280 --> 00:04:14,879
available

116
00:04:12,319 --> 00:04:16,639
so this was a really unique opportunity

117
00:04:14,879 --> 00:04:19,918
and we're very happy that that they're

118
00:04:16,639 --> 00:04:22,479
allowing us to share it here

119
00:04:19,918 --> 00:04:23,120
so what did we emulate well week one we

120
00:04:22,479 --> 00:04:24,880
went in there

121
00:04:23,120 --> 00:04:27,120
new environment for us we wanted a

122
00:04:24,880 --> 00:04:29,680
baseline really understand

123
00:04:27,120 --> 00:04:30,880
what controls they had how far an

124
00:04:29,680 --> 00:04:33,600
attacker would get

125
00:04:30,880 --> 00:04:34,880
like can we even set up a c2 channel out

126
00:04:33,600 --> 00:04:37,600
to the internet

127
00:04:34,880 --> 00:04:38,080
and if so what visibility do they have

128
00:04:37,600 --> 00:04:40,160
so

129
00:04:38,080 --> 00:04:42,159
week one was pretty much baselining and

130
00:04:40,160 --> 00:04:43,759
getting a sense of all the detective

131
00:04:42,160 --> 00:04:44,160
controls that they had and kind of see

132
00:04:43,759 --> 00:04:47,120
where we

133
00:04:44,160 --> 00:04:49,759
were then we started upping the

134
00:04:47,120 --> 00:04:50,639
sophistication level week two we did apt

135
00:04:49,759 --> 00:04:54,000
19

136
00:04:50,639 --> 00:04:54,960
week three we did bud trap week four apt

137
00:04:54,000 --> 00:04:58,560
33

138
00:04:54,960 --> 00:04:59,120
and week 5 apt three then on the last

139
00:04:58,560 --> 00:05:01,520
week

140
00:04:59,120 --> 00:05:02,720
we took everything we learned and any

141
00:05:01,520 --> 00:05:05,120
gaps that we saw

142
00:05:02,720 --> 00:05:08,479
that we hadn't tested and we tried those

143
00:05:05,120 --> 00:05:08,479
out in what we call free play

144
00:05:09,680 --> 00:05:15,199
so threat detection is hard

145
00:05:13,120 --> 00:05:17,360
all right first let's uh i want to give

146
00:05:15,199 --> 00:05:19,360
a shout out to anton chevoken

147
00:05:17,360 --> 00:05:21,520
um link down there at the bottom uh

148
00:05:19,360 --> 00:05:22,960
first thing to note with our slides and

149
00:05:21,520 --> 00:05:24,880
the way that everything we do

150
00:05:22,960 --> 00:05:26,638
we are going to give credit to everybody

151
00:05:24,880 --> 00:05:28,800
that we are

152
00:05:26,639 --> 00:05:29,840
working with um we want to make sure

153
00:05:28,800 --> 00:05:31,919
that they first of all

154
00:05:29,840 --> 00:05:33,280
give credit to your sources second this

155
00:05:31,919 --> 00:05:34,000
is going to help you the audience to

156
00:05:33,280 --> 00:05:35,679
deep dive

157
00:05:34,000 --> 00:05:37,280
50 minutes goes by really quickly with

158
00:05:35,680 --> 00:05:38,720
the amount of information that we have

159
00:05:37,280 --> 00:05:41,119
and so we have to gloss over a lot of

160
00:05:38,720 --> 00:05:43,199
things and so we want our

161
00:05:41,120 --> 00:05:45,120
presentation to be available afterward

162
00:05:43,199 --> 00:05:47,120
to give you lots of ability to go

163
00:05:45,120 --> 00:05:49,199
run down the rabbit hole so first

164
00:05:47,120 --> 00:05:52,240
problem is why detection is hard

165
00:05:49,199 --> 00:05:55,199
is that attackers are always changing

166
00:05:52,240 --> 00:05:57,280
right uh and in some cases that's at the

167
00:05:55,199 --> 00:05:59,039
payload level where payloads are going

168
00:05:57,280 --> 00:06:00,159
to be polymorphic and are going to be

169
00:05:59,039 --> 00:06:03,039
changing on their own

170
00:06:00,160 --> 00:06:05,120
um they're also going to be continually

171
00:06:03,039 --> 00:06:06,960
changing their c2 capabilities

172
00:06:05,120 --> 00:06:08,880
uh and that can be anything from the

173
00:06:06,960 --> 00:06:09,758
ability to swap out protocols to make it

174
00:06:08,880 --> 00:06:12,159
more difficult

175
00:06:09,759 --> 00:06:13,759
to changing how they're uh calling out

176
00:06:12,160 --> 00:06:16,880
so that that's always different

177
00:06:13,759 --> 00:06:18,560
uh the other element is they're always

178
00:06:16,880 --> 00:06:20,159
going to be changing their tactics

179
00:06:18,560 --> 00:06:22,880
techniques and procedures

180
00:06:20,160 --> 00:06:24,400
what works before will stop working and

181
00:06:22,880 --> 00:06:26,479
so they're always going to just take the

182
00:06:24,400 --> 00:06:26,880
little pieces and keep evolving that to

183
00:06:26,479 --> 00:06:30,400
stay

184
00:06:26,880 --> 00:06:32,880
just ahead the key

185
00:06:30,400 --> 00:06:34,000
is of course we want to improve the

186
00:06:32,880 --> 00:06:37,600
detection via

187
00:06:34,000 --> 00:06:38,880
via alerting um step one is logging can

188
00:06:37,600 --> 00:06:41,680
i see it step two

189
00:06:38,880 --> 00:06:42,479
is that log being given context to say

190
00:06:41,680 --> 00:06:44,400
hey

191
00:06:42,479 --> 00:06:46,880
this needs attention to for human

192
00:06:44,400 --> 00:06:48,880
intervention so this is where we take

193
00:06:46,880 --> 00:06:51,280
can a tool see something to when can it

194
00:06:48,880 --> 00:06:54,560
bring our security staff to be able

195
00:06:51,280 --> 00:06:57,280
to identify respond and remediate

196
00:06:54,560 --> 00:06:59,440
the challenges part of what makes this

197
00:06:57,280 --> 00:07:00,559
so difficult is putting these things in

198
00:06:59,440 --> 00:07:03,919
context

199
00:07:00,560 --> 00:07:05,039
when is a screenshot benign versus when

200
00:07:03,919 --> 00:07:08,400
is a screenshot

201
00:07:05,039 --> 00:07:09,120
malicious on one hand a screenshot is

202
00:07:08,400 --> 00:07:10,880
what we all do

203
00:07:09,120 --> 00:07:12,720
almost every single day on our computers

204
00:07:10,880 --> 00:07:14,800
for various reasons

205
00:07:12,720 --> 00:07:17,039
the second is an attacker trying to

206
00:07:14,800 --> 00:07:17,919
steal credentials how do you put that in

207
00:07:17,039 --> 00:07:20,880
context

208
00:07:17,919 --> 00:07:21,359
so that that log becomes an alert to do

209
00:07:20,880 --> 00:07:23,599
it

210
00:07:21,360 --> 00:07:25,039
um it's worth noting that in the top 10

211
00:07:23,599 --> 00:07:26,880
osp is

212
00:07:25,039 --> 00:07:28,880
insufficient logging and monitoring is

213
00:07:26,880 --> 00:07:31,360
one of the top 10 vulnerabilities

214
00:07:28,880 --> 00:07:32,719
so this entire purple team exercise is

215
00:07:31,360 --> 00:07:35,039
great because it's

216
00:07:32,720 --> 00:07:35,759
a collaborative milestone-driven

217
00:07:35,039 --> 00:07:37,520
approach

218
00:07:35,759 --> 00:07:40,080
where we're taking specific attacker

219
00:07:37,520 --> 00:07:41,440
ttps and we're walking them through the

220
00:07:40,080 --> 00:07:44,318
entire security stack

221
00:07:41,440 --> 00:07:46,080
of people process and technology to make

222
00:07:44,319 --> 00:07:47,520
sure that we have context to be able to

223
00:07:46,080 --> 00:07:49,039
respond to all of this

224
00:07:47,520 --> 00:07:50,560
the final shout out i want to give out

225
00:07:49,039 --> 00:07:51,919
is to um

226
00:07:50,560 --> 00:07:53,919
somebody who i i call one of the

227
00:07:51,919 --> 00:07:57,280
smartest people in cyber and that

228
00:07:53,919 --> 00:07:59,280
is uh sunil yu so he created this

229
00:07:57,280 --> 00:08:00,799
concept a few years ago called the cider

230
00:07:59,280 --> 00:08:02,080
defense matrix and that's what we're

231
00:08:00,800 --> 00:08:04,960
seeing here on the screen

232
00:08:02,080 --> 00:08:06,479
on the right the cyber defense matrix is

233
00:08:04,960 --> 00:08:09,359
this ability to

234
00:08:06,479 --> 00:08:10,639
look at my assets and users in my

235
00:08:09,360 --> 00:08:13,840
organization

236
00:08:10,639 --> 00:08:14,720
through the phases of defense my ability

237
00:08:13,840 --> 00:08:17,359
to identify

238
00:08:14,720 --> 00:08:19,199
threat protect my things i mean excuse

239
00:08:17,360 --> 00:08:19,919
me not identify threat identify my

240
00:08:19,199 --> 00:08:22,319
assets

241
00:08:19,919 --> 00:08:23,758
um and then where this really comes into

242
00:08:22,319 --> 00:08:26,319
what we're doing the purple team is

243
00:08:23,759 --> 00:08:27,120
protection detection response and some

244
00:08:26,319 --> 00:08:29,759
amount of

245
00:08:27,120 --> 00:08:32,318
recover is the scope of what we're going

246
00:08:29,759 --> 00:08:32,318
to be doing

247
00:08:33,760 --> 00:08:40,718
so former army officer everything

248
00:08:37,679 --> 00:08:42,000
has to be simple i break down all the

249
00:08:40,719 --> 00:08:45,120
phases of an attack

250
00:08:42,000 --> 00:08:48,320
into three reconnaissance

251
00:08:45,120 --> 00:08:49,519
access and post access

252
00:08:48,320 --> 00:08:51,120
they're casing me in getting

253
00:08:49,519 --> 00:08:53,120
intelligence to build a mission package

254
00:08:51,120 --> 00:08:55,120
to attack me

255
00:08:53,120 --> 00:08:56,560
access they're trying to jimmy the locks

256
00:08:55,120 --> 00:08:58,800
and get into the house

257
00:08:56,560 --> 00:09:00,319
post access this is where they're in the

258
00:08:58,800 --> 00:09:00,719
house that are doing something so this

259
00:09:00,320 --> 00:09:02,800
is an

260
00:09:00,720 --> 00:09:05,120
area where we get a lot of confusion in

261
00:09:02,800 --> 00:09:08,000
terminology and offensive assessments

262
00:09:05,120 --> 00:09:10,000
uh penetration testing is an access

263
00:09:08,000 --> 00:09:10,720
component right penetration testing is

264
00:09:10,000 --> 00:09:12,959
looking at

265
00:09:10,720 --> 00:09:14,080
system hardening configuration errors

266
00:09:12,959 --> 00:09:17,599
what's my ability

267
00:09:14,080 --> 00:09:18,160
to get shell post access is what happens

268
00:09:17,600 --> 00:09:21,440
next

269
00:09:18,160 --> 00:09:22,240
because you don't pop shell drop mic and

270
00:09:21,440 --> 00:09:24,640
walk out

271
00:09:22,240 --> 00:09:26,640
you pop shell and start thinking what do

272
00:09:24,640 --> 00:09:29,040
i do now to accomplish my goals

273
00:09:26,640 --> 00:09:31,600
what code can i put down after however i

274
00:09:29,040 --> 00:09:31,599
got shell

275
00:09:31,920 --> 00:09:36,000
to accomplish my goals right and the

276
00:09:34,399 --> 00:09:38,000
other thing is i'm not always where

277
00:09:36,000 --> 00:09:39,760
i want to be in fact most of the time an

278
00:09:38,000 --> 00:09:40,560
attacker isn't sure where they're

279
00:09:39,760 --> 00:09:42,880
starting

280
00:09:40,560 --> 00:09:44,719
attackers don't don't know everything

281
00:09:42,880 --> 00:09:47,279
right i don't know i didn't land here

282
00:09:44,720 --> 00:09:50,000
got shelled immediately know the entire

283
00:09:47,279 --> 00:09:51,519
network i have to start figuring out

284
00:09:50,000 --> 00:09:53,360
where am i compared to where i want to

285
00:09:51,519 --> 00:09:55,040
go and what do i want to accomplish

286
00:09:53,360 --> 00:09:56,560
uh the other thing i'd like to point out

287
00:09:55,040 --> 00:09:57,839
so i was having a conversation just a

288
00:09:56,560 --> 00:09:58,640
few days ago with somebody and they were

289
00:09:57,839 --> 00:10:01,680
like yeah

290
00:09:58,640 --> 00:10:02,480
we kind of did a purple team once um and

291
00:10:01,680 --> 00:10:04,880
what we did

292
00:10:02,480 --> 00:10:06,880
is and what it was was essentially a

293
00:10:04,880 --> 00:10:08,480
very limited penetration test

294
00:10:06,880 --> 00:10:09,920
but it was done in a collaborative

295
00:10:08,480 --> 00:10:12,399
approach you

296
00:10:09,920 --> 00:10:13,519
can do a purple team at any one of these

297
00:10:12,399 --> 00:10:15,600
phases

298
00:10:13,519 --> 00:10:17,760
the key part here and this is why we add

299
00:10:15,600 --> 00:10:18,640
the blue graph showing the increase in

300
00:10:17,760 --> 00:10:21,200
business value

301
00:10:18,640 --> 00:10:22,079
is that there is the greatest business

302
00:10:21,200 --> 00:10:23,519
value of course

303
00:10:22,079 --> 00:10:25,279
in understanding what happens in the

304
00:10:23,519 --> 00:10:27,040
post access environment

305
00:10:25,279 --> 00:10:28,880
that's the part where i can steal

306
00:10:27,040 --> 00:10:31,199
something i can break something

307
00:10:28,880 --> 00:10:32,000
i can change things this is what we

308
00:10:31,200 --> 00:10:33,760
really care about

309
00:10:32,000 --> 00:10:35,760
from a business perspective that doesn't

310
00:10:33,760 --> 00:10:36,560
mean the other phases don't have value

311
00:10:35,760 --> 00:10:38,560
too

312
00:10:36,560 --> 00:10:39,760
so the assumed breach model is just

313
00:10:38,560 --> 00:10:41,599
saying hey

314
00:10:39,760 --> 00:10:43,839
this is the greatest business value

315
00:10:41,600 --> 00:10:45,839
component it doesn't necessarily mean

316
00:10:43,839 --> 00:10:47,360
that the others don't have value so just

317
00:10:45,839 --> 00:10:49,760
from a priority perspective

318
00:10:47,360 --> 00:10:51,200
that's what we recommend but the others

319
00:10:49,760 --> 00:10:52,800
do have value and it's worth putting

320
00:10:51,200 --> 00:10:53,760
those in context to what your priorities

321
00:10:52,800 --> 00:10:55,920
are

322
00:10:53,760 --> 00:10:58,079
the second point is that you can do a

323
00:10:55,920 --> 00:11:01,839
purple team on any one of these phases

324
00:10:58,079 --> 00:11:01,839
assume breach is just our recommendation

325
00:11:03,279 --> 00:11:07,360
since it's 2021 we can't talk about

326
00:11:05,519 --> 00:11:08,079
assume breach without mentioning solar

327
00:11:07,360 --> 00:11:11,279
winds

328
00:11:08,079 --> 00:11:12,839
right so solar winds is the greatest

329
00:11:11,279 --> 00:11:15,360
example of why

330
00:11:12,839 --> 00:11:16,720
well there'll be another one maybe in

331
00:11:15,360 --> 00:11:17,839
the next week by the time this actually

332
00:11:16,720 --> 00:11:20,399
gets published but

333
00:11:17,839 --> 00:11:22,000
for now solarwinds is yet again another

334
00:11:20,399 --> 00:11:22,720
reminder as if we needed another

335
00:11:22,000 --> 00:11:25,760
reminder

336
00:11:22,720 --> 00:11:29,440
that a determined adversary will

337
00:11:25,760 --> 00:11:31,600
get in you will be hacked

338
00:11:29,440 --> 00:11:33,120
the old adage is there's only two kinds

339
00:11:31,600 --> 00:11:33,839
of companies those have been hacked and

340
00:11:33,120 --> 00:11:34,959
they know it

341
00:11:33,839 --> 00:11:37,440
those have been hacked and they don't

342
00:11:34,959 --> 00:11:39,439
know it the point is that

343
00:11:37,440 --> 00:11:41,200
the the concept of the perimeter and

344
00:11:39,440 --> 00:11:45,040
particularly with increased adoption

345
00:11:41,200 --> 00:11:47,680
of cloud in the 2020

346
00:11:45,040 --> 00:11:49,199
shift to most of us working remotely uh

347
00:11:47,680 --> 00:11:52,239
as enterprises

348
00:11:49,200 --> 00:11:53,920
is that the adversary will get in again

349
00:11:52,240 --> 00:11:54,399
this ties to why the assumed breach

350
00:11:53,920 --> 00:11:57,519
model

351
00:11:54,399 --> 00:11:59,600
is has value is we know

352
00:11:57,519 --> 00:12:01,279
it will happen and so being able to

353
00:11:59,600 --> 00:12:02,560
focus on the elements that we can

354
00:12:01,279 --> 00:12:06,480
control

355
00:12:02,560 --> 00:12:06,479
gives yet again more value to that

356
00:12:08,399 --> 00:12:12,320
so as far as executive summary here we

357
00:12:11,600 --> 00:12:16,240
had

358
00:12:12,320 --> 00:12:19,040
systems that were the same baseline

359
00:12:16,240 --> 00:12:21,760
throughout the entire six weeks we did

360
00:12:19,040 --> 00:12:25,360
all our original baseline testing there

361
00:12:21,760 --> 00:12:27,439
and from all these adversaries 94

362
00:12:25,360 --> 00:12:28,959
of those ttps of those adversary

363
00:12:27,440 --> 00:12:31,839
behaviors were not

364
00:12:28,959 --> 00:12:33,279
detected at all and i even logged on the

365
00:12:31,839 --> 00:12:35,519
local endpoint

366
00:12:33,279 --> 00:12:36,639
three test cases were detected by the

367
00:12:35,519 --> 00:12:39,680
current controls

368
00:12:36,639 --> 00:12:42,480
and one test case was blocked

369
00:12:39,680 --> 00:12:43,519
so the result was that any of these

370
00:12:42,480 --> 00:12:46,399
threat actors

371
00:12:43,519 --> 00:12:47,839
would have been successful attacking

372
00:12:46,399 --> 00:12:49,680
this organization

373
00:12:47,839 --> 00:12:51,120
from the assumed breach perspective

374
00:12:49,680 --> 00:12:54,560
gained their objectives

375
00:12:51,120 --> 00:12:56,720
without being detected

376
00:12:54,560 --> 00:12:59,199
now we did a little bit of work and that

377
00:12:56,720 --> 00:13:02,320
work was with sysmon

378
00:12:59,200 --> 00:13:05,440
so cisvan is a free driver

379
00:13:02,320 --> 00:13:06,560
that microsoft publishes and you can see

380
00:13:05,440 --> 00:13:08,240
here on the date

381
00:13:06,560 --> 00:13:10,160
they're actively maintaining it and

382
00:13:08,240 --> 00:13:11,839
updating it uh the latest version adds

383
00:13:10,160 --> 00:13:15,040
an additional event id

384
00:13:11,839 --> 00:13:16,079
that allows uh logging of uh process

385
00:13:15,040 --> 00:13:18,880
tampering

386
00:13:16,079 --> 00:13:20,160
uh actually i believe we give out a

387
00:13:18,880 --> 00:13:21,839
couple of shouts to him because he's

388
00:13:20,160 --> 00:13:22,160
also one of the smartest folks in cyber

389
00:13:21,839 --> 00:13:25,680
but

390
00:13:22,160 --> 00:13:26,079
uh olaf hartong um does a lot of great

391
00:13:25,680 --> 00:13:28,479
work

392
00:13:26,079 --> 00:13:30,479
on uh sysmon um he publishes uh

393
00:13:28,480 --> 00:13:32,800
automated you know uh

394
00:13:30,480 --> 00:13:34,959
configuration called sysmon modular

395
00:13:32,800 --> 00:13:37,839
highly recommend check that out

396
00:13:34,959 --> 00:13:39,920
but the key here is again starting with

397
00:13:37,839 --> 00:13:42,720
visibility and logging

398
00:13:39,920 --> 00:13:43,519
sysmon is this ability for me to for

399
00:13:42,720 --> 00:13:45,920
free

400
00:13:43,519 --> 00:13:47,440
push additional capabilities into

401
00:13:45,920 --> 00:13:48,079
windows event logs that's going to be

402
00:13:47,440 --> 00:13:49,680
able to track

403
00:13:48,079 --> 00:13:51,120
all sorts of different things from

404
00:13:49,680 --> 00:13:53,599
process creation network

405
00:13:51,120 --> 00:13:55,440
uh connections changes to the things

406
00:13:53,600 --> 00:13:58,000
like i said i think there's like 25

407
00:13:55,440 --> 00:13:59,760
24 or 25 because i get mixed up between

408
00:13:58,000 --> 00:14:03,040
system on 12 and 13.

409
00:13:59,760 --> 00:14:05,920
um different event ids

410
00:14:03,040 --> 00:14:07,279
that allow a level of granularity and

411
00:14:05,920 --> 00:14:08,399
then where it starts to get really cool

412
00:14:07,279 --> 00:14:09,120
which is what we're going to be showing

413
00:14:08,399 --> 00:14:12,399
you here

414
00:14:09,120 --> 00:14:14,720
is taking the very limited detection

415
00:14:12,399 --> 00:14:16,880
of what cis spine can give me at a

416
00:14:14,720 --> 00:14:18,880
granular level and then starting to put

417
00:14:16,880 --> 00:14:21,439
context around it and then it gets a lot

418
00:14:18,880 --> 00:14:24,000
of fun when you're able to identify ttps

419
00:14:21,440 --> 00:14:24,720
by marrying different cismod event ids

420
00:14:24,000 --> 00:14:26,959
together

421
00:14:24,720 --> 00:14:28,320
because that's indicative when we're

422
00:14:26,959 --> 00:14:30,109
able to see that of

423
00:14:28,320 --> 00:14:31,680
an attack in progress

424
00:14:30,110 --> 00:14:34,160
[Music]

425
00:14:31,680 --> 00:14:36,000
so at the end state again just stone

426
00:14:34,160 --> 00:14:36,800
executive summary just hopefully you're

427
00:14:36,000 --> 00:14:39,519
still with us

428
00:14:36,800 --> 00:14:40,639
with zero dollar technology spend we

429
00:14:39,519 --> 00:14:44,959
were able to achieve

430
00:14:40,639 --> 00:14:47,600
64 detection rate of those same ttps

431
00:14:44,959 --> 00:14:49,839
and we did that by enabling telemetry

432
00:14:47,600 --> 00:14:53,279
with sysmon as bryson just mentioned

433
00:14:49,839 --> 00:14:56,160
as well as sending those event logs

434
00:14:53,279 --> 00:14:57,199
to a central log aggregator and creating

435
00:14:56,160 --> 00:14:59,439
logic

436
00:14:57,199 --> 00:15:00,560
to then create alerts and trigger

437
00:14:59,440 --> 00:15:02,480
responses

438
00:15:00,560 --> 00:15:04,079
with a tool that they already had and

439
00:15:02,480 --> 00:15:07,440
they use it's a sim

440
00:15:04,079 --> 00:15:08,479
called event sentry so thankfully that

441
00:15:07,440 --> 00:15:10,959
was already

442
00:15:08,480 --> 00:15:12,399
deployed our work was mostly around

443
00:15:10,959 --> 00:15:14,880
detection engineering

444
00:15:12,399 --> 00:15:15,680
enabling the telemetry and creating that

445
00:15:14,880 --> 00:15:18,000
logic

446
00:15:15,680 --> 00:15:19,359
so at the end you can see obviously we

447
00:15:18,000 --> 00:15:21,519
didn't get to 100 and

448
00:15:19,360 --> 00:15:23,760
rarely will you ever get to 100 there

449
00:15:21,519 --> 00:15:27,760
there's no such thing in security

450
00:15:23,760 --> 00:15:31,600
but we did see significant improvement

451
00:15:27,760 --> 00:15:34,240
from our baseline and all of these known

452
00:15:31,600 --> 00:15:36,399
threats and these known behaviors would

453
00:15:34,240 --> 00:15:39,440
have been caught at some point

454
00:15:36,399 --> 00:15:44,000
and responded to before

455
00:15:39,440 --> 00:15:47,120
the adversary achieved their objective

456
00:15:44,000 --> 00:15:49,199
so hopefully you're with us still um

457
00:15:47,120 --> 00:15:51,360
we're gonna go through a ton of slides

458
00:15:49,199 --> 00:15:54,000
again all of these have references

459
00:15:51,360 --> 00:15:55,040
and they are going to be posted so you

460
00:15:54,000 --> 00:15:57,680
can read through this

461
00:15:55,040 --> 00:15:58,880
but pretty much nmfta came to us and

462
00:15:57,680 --> 00:16:01,120
said look we do

463
00:15:58,880 --> 00:16:02,720
our yearly pen test and we do

464
00:16:01,120 --> 00:16:04,079
vulnerability scanning and we have some

465
00:16:02,720 --> 00:16:06,720
good patch management

466
00:16:04,079 --> 00:16:07,279
but we want to test actual adversaries

467
00:16:06,720 --> 00:16:09,279
that

468
00:16:07,279 --> 00:16:10,399
are likely to attack us and see what

469
00:16:09,279 --> 00:16:11,920
they can do

470
00:16:10,399 --> 00:16:13,519
so we leveraged cyber threat

471
00:16:11,920 --> 00:16:16,959
intelligence understood

472
00:16:13,519 --> 00:16:18,639
their um organization what threat actors

473
00:16:16,959 --> 00:16:21,199
are likely to attack them

474
00:16:18,639 --> 00:16:23,759
propose those threat actors and created

475
00:16:21,199 --> 00:16:25,839
adversary emulation plans

476
00:16:23,759 --> 00:16:27,680
and then we did all of this in the

477
00:16:25,839 --> 00:16:29,600
production environment

478
00:16:27,680 --> 00:16:31,920
because the production environment is

479
00:16:29,600 --> 00:16:33,759
where all of their security tools and

480
00:16:31,920 --> 00:16:36,240
responses were

481
00:16:33,759 --> 00:16:38,160
and of course zero dollar increase in

482
00:16:36,240 --> 00:16:40,320
technology and then tools

483
00:16:38,160 --> 00:16:41,839
was the the most fun thing to work with

484
00:16:40,320 --> 00:16:44,800
there so

485
00:16:41,839 --> 00:16:45,759
uh shout out to uh katie nichols and

486
00:16:44,800 --> 00:16:49,040
cody

487
00:16:45,759 --> 00:16:51,759
um they presented this

488
00:16:49,040 --> 00:16:53,199
uh this process for leveraging cyber

489
00:16:51,759 --> 00:16:55,519
threat intelligence

490
00:16:53,199 --> 00:16:57,120
doing adversary emulation plans at sans

491
00:16:55,519 --> 00:16:59,199
summit in 2018

492
00:16:57,120 --> 00:17:00,160
i don't know where the url went i did

493
00:16:59,199 --> 00:17:03,120
have it up there

494
00:17:00,160 --> 00:17:04,480
um but pretty much they mentioned that

495
00:17:03,120 --> 00:17:07,039
you need to first understand

496
00:17:04,480 --> 00:17:08,480
the target organization then identify

497
00:17:07,039 --> 00:17:10,240
the adversaries

498
00:17:08,480 --> 00:17:13,520
gather threat intelligence on that

499
00:17:10,240 --> 00:17:15,039
adversary extract the behaviors the

500
00:17:13,520 --> 00:17:17,679
ttd's

501
00:17:15,039 --> 00:17:20,400
analyze and organize those and then

502
00:17:17,679 --> 00:17:23,520
create an adversary emulation plan

503
00:17:20,400 --> 00:17:25,360
so that's exactly what we did um

504
00:17:23,520 --> 00:17:27,439
for the purple team exercise pretty much

505
00:17:25,359 --> 00:17:29,678
every week we would

506
00:17:27,439 --> 00:17:30,480
uh present the adversary we were going

507
00:17:29,679 --> 00:17:32,720
to emulate

508
00:17:30,480 --> 00:17:34,640
along with the ttps of that adversary

509
00:17:32,720 --> 00:17:37,840
and all the technical details

510
00:17:34,640 --> 00:17:40,000
we would then discuss and a tabletop

511
00:17:37,840 --> 00:17:41,280
with some of the stakeholders and

512
00:17:40,000 --> 00:17:44,160
attendees from

513
00:17:41,280 --> 00:17:46,399
the target organization just to

514
00:17:44,160 --> 00:17:47,919
understand what their expectations were

515
00:17:46,400 --> 00:17:49,760
what they thought would be caught and

516
00:17:47,919 --> 00:17:53,520
what they didn't think would become

517
00:17:49,760 --> 00:17:55,520
then we emulate the various ttps

518
00:17:53,520 --> 00:17:56,559
we would then perform the blue team

519
00:17:55,520 --> 00:17:58,320
function of

520
00:17:56,559 --> 00:18:00,960
actually seeing if there was any

521
00:17:58,320 --> 00:18:02,240
detection and if there was any response

522
00:18:00,960 --> 00:18:04,080
and throughout this you'll see that

523
00:18:02,240 --> 00:18:06,000
there were times that i'd get a text

524
00:18:04,080 --> 00:18:06,639
message saying hey i see you i see what

525
00:18:06,000 --> 00:18:09,280
you're doing

526
00:18:06,640 --> 00:18:11,039
which is great but other times we would

527
00:18:09,280 --> 00:18:13,918
not get any logs

528
00:18:11,039 --> 00:18:16,559
so we would go through that each week

529
00:18:13,919 --> 00:18:19,200
different set of adversary ttps

530
00:18:16,559 --> 00:18:19,918
all chained together and really the the

531
00:18:19,200 --> 00:18:22,960
work was

532
00:18:19,919 --> 00:18:24,559
around tuning the security controls

533
00:18:22,960 --> 00:18:27,280
enabling that telemetry

534
00:18:24,559 --> 00:18:28,240
enabling the sysmon configurations that

535
00:18:27,280 --> 00:18:31,360
would catch

536
00:18:28,240 --> 00:18:32,880
those adversary ttps ensure that those

537
00:18:31,360 --> 00:18:36,159
logs were being sent

538
00:18:32,880 --> 00:18:40,400
to event century and then ensuring that

539
00:18:36,160 --> 00:18:40,400
there were alerts and an actual response

540
00:18:40,720 --> 00:18:46,160
so what are ttps and shout out to david

541
00:18:44,080 --> 00:18:49,280
bianco and the pyramid of pain

542
00:18:46,160 --> 00:18:52,000
ttps are that top of the paraben

543
00:18:49,280 --> 00:18:52,720
the toughest thing to detect everything

544
00:18:52,000 --> 00:18:54,480
under there

545
00:18:52,720 --> 00:18:56,000
it's a little easier starting all the

546
00:18:54,480 --> 00:18:58,400
way with hash values ip

547
00:18:56,000 --> 00:19:00,400
addresses and domain names pretty simple

548
00:18:58,400 --> 00:19:02,799
things that most organizations can

549
00:19:00,400 --> 00:19:04,480
quickly detect and leverage as

550
00:19:02,799 --> 00:19:06,240
indicators of compromise

551
00:19:04,480 --> 00:19:07,600
but really when we get to adversary

552
00:19:06,240 --> 00:19:09,840
behavior part

553
00:19:07,600 --> 00:19:11,760
that's the tougher part to actually

554
00:19:09,840 --> 00:19:14,159
catch and that's where we wanted to

555
00:19:11,760 --> 00:19:17,200
focus on

556
00:19:14,160 --> 00:19:18,480
so why is detection hard again shout out

557
00:19:17,200 --> 00:19:21,520
to anton

558
00:19:18,480 --> 00:19:23,200
and uh this blog post that really

559
00:19:21,520 --> 00:19:26,720
specifies that detection

560
00:19:23,200 --> 00:19:27,120
is difficult uh it needs people and it

561
00:19:26,720 --> 00:19:30,400
needs

562
00:19:27,120 --> 00:19:33,760
data and it needs context right so

563
00:19:30,400 --> 00:19:36,320
just uh as bryson mentioned a screenshot

564
00:19:33,760 --> 00:19:37,440
is not necessarily bad right we all take

565
00:19:36,320 --> 00:19:39,760
screenshots but

566
00:19:37,440 --> 00:19:42,720
a screenshot when it's coupled with a

567
00:19:39,760 --> 00:19:45,919
few other adversary behaviors altogether

568
00:19:42,720 --> 00:19:48,320
should probably be correlated detected

569
00:19:45,919 --> 00:19:51,039
alerted and responded to

570
00:19:48,320 --> 00:19:51,439
and that last point here is detection is

571
00:19:51,039 --> 00:19:55,520
about

572
00:19:51,440 --> 00:19:57,679
intent that is the toughest part to know

573
00:19:55,520 --> 00:19:59,440
what was the intent because of course

574
00:19:57,679 --> 00:20:01,600
you have malicious insiders as well

575
00:19:59,440 --> 00:20:01,600
right

576
00:20:03,840 --> 00:20:08,399
so detect i want to give a shout out

577
00:20:06,640 --> 00:20:11,120
here to marcus baker

578
00:20:08,400 --> 00:20:11,840
um he created this concept and i really

579
00:20:11,120 --> 00:20:14,158
liked uh

580
00:20:11,840 --> 00:20:15,840
detect because it does a couple of

581
00:20:14,159 --> 00:20:16,240
things first of all the visualization

582
00:20:15,840 --> 00:20:19,678
here

583
00:20:16,240 --> 00:20:20,000
where we're marrying intelligence and

584
00:20:19,679 --> 00:20:23,520
blue

585
00:20:20,000 --> 00:20:25,120
team with a uh you know the node graph

586
00:20:23,520 --> 00:20:26,639
here of how things come together but

587
00:20:25,120 --> 00:20:29,520
fundamentally what we're looking at

588
00:20:26,640 --> 00:20:30,960
is in the blue team perspective what are

589
00:20:29,520 --> 00:20:32,559
our data sources

590
00:20:30,960 --> 00:20:34,000
what visibility does that give us and

591
00:20:32,559 --> 00:20:37,360
then tying it to what am i

592
00:20:34,000 --> 00:20:40,000
able to see uh which of course

593
00:20:37,360 --> 00:20:41,439
fits across what we're building out with

594
00:20:40,000 --> 00:20:42,559
the purple team with this collaborative

595
00:20:41,440 --> 00:20:45,120
milestone approach

596
00:20:42,559 --> 00:20:45,760
of generating what i call functional

597
00:20:45,120 --> 00:20:48,799
signal

598
00:20:45,760 --> 00:20:50,799
aka an attacker against all of these

599
00:20:48,799 --> 00:20:52,580
blue team sources and the process and

600
00:20:50,799 --> 00:20:55,710
people of them

601
00:20:52,580 --> 00:20:55,710
[Music]

602
00:20:56,400 --> 00:21:01,520
so as mentioned scythe came in to play

603
00:21:00,000 --> 00:21:03,760
all three roles of cyber threat

604
00:21:01,520 --> 00:21:06,240
intelligence red team operator

605
00:21:03,760 --> 00:21:07,840
and the blue team for doing everything

606
00:21:06,240 --> 00:21:10,720
from detection engineering

607
00:21:07,840 --> 00:21:11,520
to ensuring that there was a response

608
00:21:10,720 --> 00:21:13,679
process

609
00:21:11,520 --> 00:21:14,960
i acted as the exercise coordinator

610
00:21:13,679 --> 00:21:16,960
which if you do run purple team

611
00:21:14,960 --> 00:21:18,480
engagements i highly recommend you have

612
00:21:16,960 --> 00:21:20,480
an exercise coordinator with some

613
00:21:18,480 --> 00:21:23,039
experience in project management

614
00:21:20,480 --> 00:21:24,880
um if you're just getting started then

615
00:21:23,039 --> 00:21:25,440
yeah you're gonna have to do multiple

616
00:21:24,880 --> 00:21:27,360
roles

617
00:21:25,440 --> 00:21:30,000
and that's totally fine and then of

618
00:21:27,360 --> 00:21:33,039
course internal operations

619
00:21:30,000 --> 00:21:34,720
we had our sponsor and attendees there

620
00:21:33,039 --> 00:21:36,480
watching what we were doing which was a

621
00:21:34,720 --> 00:21:37,039
great learning experience for them as

622
00:21:36,480 --> 00:21:39,679
well

623
00:21:37,039 --> 00:21:40,480
because they built a process once we

624
00:21:39,679 --> 00:21:43,039
leave

625
00:21:40,480 --> 00:21:43,520
they can continually test a lot of these

626
00:21:43,039 --> 00:21:46,480
uh

627
00:21:43,520 --> 00:21:47,039
behaviors and continue to evolve as new

628
00:21:46,480 --> 00:21:48,880
threats

629
00:21:47,039 --> 00:21:50,480
are released and new adversary emulation

630
00:21:48,880 --> 00:21:51,760
plans are released they can test for

631
00:21:50,480 --> 00:21:54,400
those

632
00:21:51,760 --> 00:21:55,360
so from a planning perspective we did

633
00:21:54,400 --> 00:21:56,880
use scythe

634
00:21:55,360 --> 00:21:58,399
don't want to talk too much about the

635
00:21:56,880 --> 00:22:00,799
platform but it is an

636
00:21:58,400 --> 00:22:01,600
enterprise grade command and control

637
00:22:00,799 --> 00:22:05,200
framework

638
00:22:01,600 --> 00:22:06,000
that allows us to automate those attack

639
00:22:05,200 --> 00:22:08,720
chains

640
00:22:06,000 --> 00:22:10,400
so we can create adversary emulation

641
00:22:08,720 --> 00:22:14,000
plans and share those plans

642
00:22:10,400 --> 00:22:15,760
uh with the community of actual attack

643
00:22:14,000 --> 00:22:16,240
chains that have been seen in the wild

644
00:22:15,760 --> 00:22:20,320
by

645
00:22:16,240 --> 00:22:23,600
our other uh teams that do

646
00:22:20,320 --> 00:22:24,158
instant response then target systems we

647
00:22:23,600 --> 00:22:26,639
all did

648
00:22:24,159 --> 00:22:28,000
all of this in production and yes i am a

649
00:22:26,640 --> 00:22:28,799
big believer we should do this in

650
00:22:28,000 --> 00:22:30,720
production

651
00:22:28,799 --> 00:22:32,639
uh i was able to convince a large

652
00:22:30,720 --> 00:22:33,440
financial that we can do all this

653
00:22:32,640 --> 00:22:35,360
testing

654
00:22:33,440 --> 00:22:37,039
in production and they move trillions of

655
00:22:35,360 --> 00:22:39,760
dollars in a day so

656
00:22:37,039 --> 00:22:41,360
if uh i was able to convince them i

657
00:22:39,760 --> 00:22:43,679
think you can convince

658
00:22:41,360 --> 00:22:44,479
other organizations to do the same it's

659
00:22:43,679 --> 00:22:46,559
all about

660
00:22:44,480 --> 00:22:48,559
building reputation and not bringing

661
00:22:46,559 --> 00:22:49,360
down their systems right availability is

662
00:22:48,559 --> 00:22:51,120
important

663
00:22:49,360 --> 00:22:52,959
uh this one of the reasons why we like

664
00:22:51,120 --> 00:22:55,840
using enterprise products

665
00:22:52,960 --> 00:22:58,080
um so we asked for multiple systems um

666
00:22:55,840 --> 00:22:59,918
their endpoints were all windows 10

667
00:22:58,080 --> 00:23:01,840
and their servers were all on one

668
00:22:59,919 --> 00:23:04,480
version believe it or not

669
00:23:01,840 --> 00:23:05,678
um so going into this we're like wow

670
00:23:04,480 --> 00:23:08,880
they're they're actually

671
00:23:05,679 --> 00:23:11,440
pretty up to date they have uh good uh

672
00:23:08,880 --> 00:23:12,960
and the latest operating systems they uh

673
00:23:11,440 --> 00:23:14,400
we knew a little bit about some of their

674
00:23:12,960 --> 00:23:15,919
pen test reports and

675
00:23:14,400 --> 00:23:17,600
seeing that that they were pretty good

676
00:23:15,919 --> 00:23:20,640
so we got

677
00:23:17,600 --> 00:23:23,360
uh a standard user um we got

678
00:23:20,640 --> 00:23:24,960
which was also a jump point for us uh vp

679
00:23:23,360 --> 00:23:28,559
ending on all that fun stuff as

680
00:23:24,960 --> 00:23:30,400
uh we do baseline uh assume breach

681
00:23:28,559 --> 00:23:32,000
then a standard user for testing the

682
00:23:30,400 --> 00:23:34,400
baseline and then

683
00:23:32,000 --> 00:23:35,600
a system where we were local admin and

684
00:23:34,400 --> 00:23:38,159
that was because

685
00:23:35,600 --> 00:23:39,678
of sysmon and enabling configs we want

686
00:23:38,159 --> 00:23:42,400
to be agile there

687
00:23:39,679 --> 00:23:43,440
um and then a standard system on on the

688
00:23:42,400 --> 00:23:46,480
server

689
00:23:43,440 --> 00:23:48,320
we also got yep oh sorry

690
00:23:46,480 --> 00:23:50,320
i'll you finish this part then i'll add

691
00:23:48,320 --> 00:23:52,480
on the production environment sorry

692
00:23:50,320 --> 00:23:54,559
perfect um then we created production

693
00:23:52,480 --> 00:23:56,240
accounts in active directory with email

694
00:23:54,559 --> 00:23:58,240
access and all that fun stuff

695
00:23:56,240 --> 00:24:00,640
and we made sure that all these systems

696
00:23:58,240 --> 00:24:01,840
had the standard security controls right

697
00:24:00,640 --> 00:24:03,919
in this case we're not going to call

698
00:24:01,840 --> 00:24:05,600
those out but they had their standard

699
00:24:03,919 --> 00:24:08,320
antivirus firewalls

700
00:24:05,600 --> 00:24:09,760
sim with event sentry and uh lots of

701
00:24:08,320 --> 00:24:11,039
email security actually pretty

702
00:24:09,760 --> 00:24:13,039
impressive

703
00:24:11,039 --> 00:24:14,960
go ahead bryce yeah too much coffee with

704
00:24:13,039 --> 00:24:17,200
an excited unicorn so

705
00:24:14,960 --> 00:24:18,159
um the production environment piece

706
00:24:17,200 --> 00:24:20,720
production versus

707
00:24:18,159 --> 00:24:22,080
lab so of course doing it in production

708
00:24:20,720 --> 00:24:23,440
has risk

709
00:24:22,080 --> 00:24:25,279
and it's important to understand

710
00:24:23,440 --> 00:24:27,360
configurations and to test things

711
00:24:25,279 --> 00:24:28,400
in a lab environment before pushing to

712
00:24:27,360 --> 00:24:31,520
production

713
00:24:28,400 --> 00:24:33,760
but the fear of affecting production

714
00:24:31,520 --> 00:24:36,000
costs you a lot of what you're going to

715
00:24:33,760 --> 00:24:37,120
get from the efficacy of running one of

716
00:24:36,000 --> 00:24:39,440
these assessments

717
00:24:37,120 --> 00:24:41,199
the first point about your defensive

718
00:24:39,440 --> 00:24:43,679
controls

719
00:24:41,200 --> 00:24:44,640
are tuned for a production environment

720
00:24:43,679 --> 00:24:46,559
edr's

721
00:24:44,640 --> 00:24:48,320
will catch everything in a lab because

722
00:24:46,559 --> 00:24:50,000
it's an artificial environment

723
00:24:48,320 --> 00:24:51,678
turns out that we've seen this time and

724
00:24:50,000 --> 00:24:54,960
time again in security

725
00:24:51,679 --> 00:24:57,279
that does not work in production

726
00:24:54,960 --> 00:24:58,000
because if you get in a user's way

727
00:24:57,279 --> 00:25:00,159
you're going to turn

728
00:24:58,000 --> 00:25:01,120
the user the employee into the greatest

729
00:25:00,159 --> 00:25:02,640
hacker ever

730
00:25:01,120 --> 00:25:04,639
they will do anything they can to

731
00:25:02,640 --> 00:25:05,039
circumvent a control that gets in the

732
00:25:04,640 --> 00:25:08,240
way

733
00:25:05,039 --> 00:25:09,600
of them doing their job so

734
00:25:08,240 --> 00:25:11,360
things are tuned for the production

735
00:25:09,600 --> 00:25:12,080
environment the other thing you get out

736
00:25:11,360 --> 00:25:14,000
of a production

737
00:25:12,080 --> 00:25:16,559
environment is you're bringing people

738
00:25:14,000 --> 00:25:18,640
and process into the loop

739
00:25:16,559 --> 00:25:20,559
in a lab you're solely going to be

740
00:25:18,640 --> 00:25:22,640
looking at almost a checklist of

741
00:25:20,559 --> 00:25:26,320
technical controls and understanding

742
00:25:22,640 --> 00:25:29,120
you're missing the dynamic surface risk

743
00:25:26,320 --> 00:25:30,080
of what your employees do you're missing

744
00:25:29,120 --> 00:25:31,918
an understanding

745
00:25:30,080 --> 00:25:33,520
of how policy and people work with the

746
00:25:31,919 --> 00:25:35,279
tools with your i.t security

747
00:25:33,520 --> 00:25:37,200
organization and then of course

748
00:25:35,279 --> 00:25:38,640
you're missing what really is happening

749
00:25:37,200 --> 00:25:39,919
in the real world with how those

750
00:25:38,640 --> 00:25:43,840
defensive controls

751
00:25:39,919 --> 00:25:43,840
work with production

752
00:25:44,720 --> 00:25:48,240
yep so the first week as i mentioned was

753
00:25:47,360 --> 00:25:50,080
baseline

754
00:25:48,240 --> 00:25:51,760
since we were playing both the blue team

755
00:25:50,080 --> 00:25:54,320
and the red team we needed

756
00:25:51,760 --> 00:25:56,158
uh some situational awareness so from

757
00:25:54,320 --> 00:25:57,039
the red team side the first week we

758
00:25:56,159 --> 00:26:00,159
created

759
00:25:57,039 --> 00:26:02,960
a campaign we executed it through user

760
00:26:00,159 --> 00:26:04,640
execution and run dll32 which are

761
00:26:02,960 --> 00:26:06,720
the two most common ways that things are

762
00:26:04,640 --> 00:26:08,960
getting executed nowadays

763
00:26:06,720 --> 00:26:10,640
um then we establish command and control

764
00:26:08,960 --> 00:26:13,120
over https

765
00:26:10,640 --> 00:26:13,760
also the most common communication

766
00:26:13,120 --> 00:26:16,320
channel

767
00:26:13,760 --> 00:26:18,720
and then we random who am i right very

768
00:26:16,320 --> 00:26:21,760
very basic for uh

769
00:26:18,720 --> 00:26:23,200
baseline but this should have spawned

770
00:26:21,760 --> 00:26:26,320
some sort of

771
00:26:23,200 --> 00:26:28,159
uh logs some sort of alerts right

772
00:26:26,320 --> 00:26:30,080
and that's what we wanted to see we want

773
00:26:28,159 --> 00:26:31,919
to ensure that there was visibility that

774
00:26:30,080 --> 00:26:33,918
the security controls were there

775
00:26:31,919 --> 00:26:36,159
that there was local logging remote

776
00:26:33,919 --> 00:26:39,360
logging etc

777
00:26:36,159 --> 00:26:42,000
so um this was in our planning phase

778
00:26:39,360 --> 00:26:43,760
this is a screenshot from vector so um

779
00:26:42,000 --> 00:26:45,440
psych integrates with vector quite well

780
00:26:43,760 --> 00:26:48,320
it's actually two clicks to

781
00:26:45,440 --> 00:26:49,120
import this and have this view um so you

782
00:26:48,320 --> 00:26:52,639
can see there

783
00:26:49,120 --> 00:26:53,760
five different ttps run dll32 c2 with

784
00:26:52,640 --> 00:26:56,720
https

785
00:26:53,760 --> 00:26:57,919
running who am i and windows command

786
00:26:56,720 --> 00:27:01,360
shell

787
00:26:57,919 --> 00:27:02,720
so after um that run we took a look at

788
00:27:01,360 --> 00:27:06,158
the detective controls

789
00:27:02,720 --> 00:27:08,640
and nothing was logged on the endpoint

790
00:27:06,159 --> 00:27:10,320
or the network uh sure there was an

791
00:27:08,640 --> 00:27:12,799
outbound network connection but

792
00:27:10,320 --> 00:27:14,080
no uh indication that that was command

793
00:27:12,799 --> 00:27:17,600
and control

794
00:27:14,080 --> 00:27:20,559
so time to get to work because we are

795
00:27:17,600 --> 00:27:21,840
at zero percent detection rate so we

796
00:27:20,559 --> 00:27:24,320
implemented controls

797
00:27:21,840 --> 00:27:24,959
we installed sysmon that bryson already

798
00:27:24,320 --> 00:27:27,918
covered

799
00:27:24,960 --> 00:27:29,200
and we enabled event id one which was

800
00:27:27,919 --> 00:27:31,360
process creation

801
00:27:29,200 --> 00:27:34,000
when any executable is run and in

802
00:27:31,360 --> 00:27:36,959
particular we wanted to see run dll32

803
00:27:34,000 --> 00:27:37,360
command.exe and who am i all things that

804
00:27:36,960 --> 00:27:40,240
run

805
00:27:37,360 --> 00:27:41,199
in a normal environment at any given

806
00:27:40,240 --> 00:27:44,559
time right

807
00:27:41,200 --> 00:27:46,080
so the next step was to send that sysmon

808
00:27:44,559 --> 00:27:48,399
log to the sim

809
00:27:46,080 --> 00:27:49,279
which was event sentry and then

810
00:27:48,399 --> 00:27:52,879
configure

811
00:27:49,279 --> 00:27:56,080
logic on the event sentry to only alert

812
00:27:52,880 --> 00:27:59,440
when these particular uh chains

813
00:27:56,080 --> 00:28:01,918
were ran right if you saw it run dll32

814
00:27:59,440 --> 00:28:03,039
followed by a command.ixe or followed by

815
00:28:01,919 --> 00:28:05,279
who am i

816
00:28:03,039 --> 00:28:06,399
then uh let's take a look at that

817
00:28:05,279 --> 00:28:09,360
because those

818
00:28:06,399 --> 00:28:10,479
things happening with in succession in

819
00:28:09,360 --> 00:28:12,479
you know within a

820
00:28:10,480 --> 00:28:13,600
number of minutes of each other is kind

821
00:28:12,480 --> 00:28:15,760
of strange

822
00:28:13,600 --> 00:28:17,918
and we set up email alerts to the

823
00:28:15,760 --> 00:28:21,520
operations team this was their current

824
00:28:17,919 --> 00:28:22,960
uh alerting infrastructure so um this is

825
00:28:21,520 --> 00:28:26,080
what a

826
00:28:22,960 --> 00:28:27,279
id one looks like in sysmon um in this

827
00:28:26,080 --> 00:28:30,000
case you can see

828
00:28:27,279 --> 00:28:31,919
uh who am i there about six lines down

829
00:28:30,000 --> 00:28:33,840
you can see the user that ran it this

830
00:28:31,919 --> 00:28:37,200
was our scythe user

831
00:28:33,840 --> 00:28:40,158
and uh the hashes and and whatnot

832
00:28:37,200 --> 00:28:41,520
and yeah and then the last thing is you

833
00:28:40,159 --> 00:28:44,799
can see the parent image

834
00:28:41,520 --> 00:28:48,399
so we're actually seeing run dll32.edu

835
00:28:44,799 --> 00:28:51,679
spawning who am i dot exe how often

836
00:28:48,399 --> 00:28:54,080
is that so run dll32

837
00:28:51,679 --> 00:28:55,679
is another great example of context and

838
00:28:54,080 --> 00:28:58,399
it's another good baseline to

839
00:28:55,679 --> 00:29:00,000
to use because it's part of lobas right

840
00:28:58,399 --> 00:29:01,279
this is things that would naturally be

841
00:29:00,000 --> 00:29:01,840
running in an environment which of

842
00:29:01,279 --> 00:29:04,480
course

843
00:29:01,840 --> 00:29:05,039
as an attacker i want to take advantage

844
00:29:04,480 --> 00:29:07,440
of

845
00:29:05,039 --> 00:29:08,158
organic assets because that helps me

846
00:29:07,440 --> 00:29:10,399
blend it

847
00:29:08,159 --> 00:29:13,600
in and so this this is why we chose this

848
00:29:10,399 --> 00:29:16,080
as a good starting point

849
00:29:13,600 --> 00:29:17,199
yep and we leveraged event sentry so

850
00:29:16,080 --> 00:29:19,520
shout out to them

851
00:29:17,200 --> 00:29:21,279
um it's not a free product so sorry we

852
00:29:19,520 --> 00:29:23,440
did mention vector which is free

853
00:29:21,279 --> 00:29:24,840
uh this one this is what they were using

854
00:29:23,440 --> 00:29:28,000
um and

855
00:29:24,840 --> 00:29:28,959
thankfully it already had native sysmon

856
00:29:28,000 --> 00:29:30,880
integration

857
00:29:28,960 --> 00:29:32,720
um they had already set up log

858
00:29:30,880 --> 00:29:35,279
forwarding which was great

859
00:29:32,720 --> 00:29:37,360
we just had to enable certain things it

860
00:29:35,279 --> 00:29:40,399
also had active directory monitoring

861
00:29:37,360 --> 00:29:44,158
which we will um cover

862
00:29:40,399 --> 00:29:46,399
in a bit so we then set up the alerts

863
00:29:44,159 --> 00:29:47,360
again they used emails for alerts so we

864
00:29:46,399 --> 00:29:50,879
set that up

865
00:29:47,360 --> 00:29:51,840
and whenever run dll32 was ran also with

866
00:29:50,880 --> 00:29:54,960
a who am i

867
00:29:51,840 --> 00:29:57,600
there would be an alert very

868
00:29:54,960 --> 00:29:58,480
quick and easy and really getting that

869
00:29:57,600 --> 00:30:02,399
process in

870
00:29:58,480 --> 00:30:04,320
of emulate some bad stuff

871
00:30:02,399 --> 00:30:05,760
figure out how to detect it and then

872
00:30:04,320 --> 00:30:08,000
turn on the alert and

873
00:30:05,760 --> 00:30:10,640
at the end of that first week we had

874
00:30:08,000 --> 00:30:14,000
detected four of the five ttbs

875
00:30:10,640 --> 00:30:15,840
so a lot prettier uh pie chart here

876
00:30:14,000 --> 00:30:17,279
something that you can probably show off

877
00:30:15,840 --> 00:30:20,158
that you're up to 80

878
00:30:17,279 --> 00:30:21,360
detection in the first week was a great

879
00:30:20,159 --> 00:30:24,159
start

880
00:30:21,360 --> 00:30:25,120
the second week we took a look at apt

881
00:30:24,159 --> 00:30:27,600
19.

882
00:30:25,120 --> 00:30:29,360
this is a low sophistication

883
00:30:27,600 --> 00:30:30,240
chinese-based threat group that has

884
00:30:29,360 --> 00:30:33,600
targeted

885
00:30:30,240 --> 00:30:36,480
everyone they generally focus

886
00:30:33,600 --> 00:30:37,600
on enumeration and maintaining command

887
00:30:36,480 --> 00:30:40,559
and control

888
00:30:37,600 --> 00:30:42,158
so we go through and we do this on

889
00:30:40,559 --> 00:30:45,120
thread thursdays as well

890
00:30:42,159 --> 00:30:46,480
where we analyze these thread actors and

891
00:30:45,120 --> 00:30:48,320
we create these

892
00:30:46,480 --> 00:30:51,200
attack chains so you can see here

893
00:30:48,320 --> 00:30:52,399
there's a few more uh ttps that we

894
00:30:51,200 --> 00:30:54,559
tested

895
00:30:52,399 --> 00:30:55,439
and of course seeing it in the table is

896
00:30:54,559 --> 00:30:58,799
easy but

897
00:30:55,440 --> 00:30:59,919
seeing it all nicely in a vector diagram

898
00:30:58,799 --> 00:31:03,039
that we imported

899
00:30:59,919 --> 00:31:06,559
uh looks even better so you can see here

900
00:31:03,039 --> 00:31:08,480
c2 via https which we had already tested

901
00:31:06,559 --> 00:31:11,039
and then a lot of discovery right

902
00:31:08,480 --> 00:31:13,279
generally once a threat actor gets in

903
00:31:11,039 --> 00:31:15,440
their next step is situational awareness

904
00:31:13,279 --> 00:31:17,760
so we went after discovery next

905
00:31:15,440 --> 00:31:19,120
and a lot of low basses right i love

906
00:31:17,760 --> 00:31:22,000
living off the land

907
00:31:19,120 --> 00:31:22,399
with things like ipconfig and net and

908
00:31:22,000 --> 00:31:25,519
arp

909
00:31:22,399 --> 00:31:27,918
and wmic says info reg

910
00:31:25,519 --> 00:31:29,360
and a little bit of collection as well

911
00:31:27,919 --> 00:31:32,799
so going back to our

912
00:31:29,360 --> 00:31:33,760
original baseline zero percent detection

913
00:31:32,799 --> 00:31:36,000
again

914
00:31:33,760 --> 00:31:36,799
in this case we wanted to enable a few

915
00:31:36,000 --> 00:31:38,960
other things

916
00:31:36,799 --> 00:31:40,240
so with that system event id one of

917
00:31:38,960 --> 00:31:41,760
process creation

918
00:31:40,240 --> 00:31:43,679
we can turn on other things like

919
00:31:41,760 --> 00:31:46,799
ipconfig netstat

920
00:31:43,679 --> 00:31:50,000
directory listings shares net views

921
00:31:46,799 --> 00:31:53,120
we also turned on sysmon event id

922
00:31:50,000 --> 00:31:54,880
3 which is network connections now this

923
00:31:53,120 --> 00:31:56,719
is a very valuable one because it shows

924
00:31:54,880 --> 00:31:58,640
all outbound connections or really all

925
00:31:56,720 --> 00:32:00,559
network connections being established

926
00:31:58,640 --> 00:32:02,399
and you can use that with other

927
00:32:00,559 --> 00:32:03,440
indicators of compromise to know if

928
00:32:02,399 --> 00:32:05,360
something bad

929
00:32:03,440 --> 00:32:06,640
uh has occurred or someone has

930
00:32:05,360 --> 00:32:10,320
communicated with

931
00:32:06,640 --> 00:32:13,600
a known bad id we also enabled

932
00:32:10,320 --> 00:32:16,799
file create that's event id 11 on sysmon

933
00:32:13,600 --> 00:32:18,080
so this uses endpoint detection tools to

934
00:32:16,799 --> 00:32:20,320
help identify

935
00:32:18,080 --> 00:32:21,360
any known malicious droppers or

936
00:32:20,320 --> 00:32:24,480
executables

937
00:32:21,360 --> 00:32:28,399
that were created on the system

938
00:32:24,480 --> 00:32:30,480
and then we got powershell and uh bryson

939
00:32:28,399 --> 00:32:32,479
gave a very good quote there and

940
00:32:30,480 --> 00:32:33,519
i'm going to modify it a little bit that

941
00:32:32,480 --> 00:32:36,320
there's two

942
00:32:33,519 --> 00:32:38,320
types of people those that know that

943
00:32:36,320 --> 00:32:39,760
there is powershell in their environment

944
00:32:38,320 --> 00:32:41,120
and those that don't know

945
00:32:39,760 --> 00:32:43,360
that there is powershell in their

946
00:32:41,120 --> 00:32:44,639
environment and that's exactly what

947
00:32:43,360 --> 00:32:46,639
happened here

948
00:32:44,640 --> 00:32:48,640
uh you know we tabletop everything at

949
00:32:46,640 --> 00:32:51,039
the beginning and we say hey

950
00:32:48,640 --> 00:32:52,880
we're going to use fireshell.exe do you

951
00:32:51,039 --> 00:32:55,240
use powershell.exe

952
00:32:52,880 --> 00:32:56,640
and they said no we do not use

953
00:32:55,240 --> 00:32:58,559
powershell.exe for

954
00:32:56,640 --> 00:32:59,679
anything no one should be using that we

955
00:32:58,559 --> 00:33:02,480
said okay

956
00:32:59,679 --> 00:33:04,159
we'll turn on system sysmon event id one

957
00:33:02,480 --> 00:33:07,440
for powershell.exe

958
00:33:04,159 --> 00:33:09,919
and we got hundreds of alerts almost

959
00:33:07,440 --> 00:33:12,240
immediately see they didn't realize that

960
00:33:09,919 --> 00:33:16,000
they do use powershell.exe and this

961
00:33:12,240 --> 00:33:19,039
happens i would say 99.9 of the time

962
00:33:16,000 --> 00:33:20,799
um very rarely does someone really not

963
00:33:19,039 --> 00:33:24,158
use powershell.exe

964
00:33:20,799 --> 00:33:27,600
so we have to find out what actually use

965
00:33:24,159 --> 00:33:30,159
that and then tune that alert only alert

966
00:33:27,600 --> 00:33:30,959
when there is powershell.exe but it's

967
00:33:30,159 --> 00:33:34,240
not these

968
00:33:30,960 --> 00:33:36,000
known processes that are part of

969
00:33:34,240 --> 00:33:38,159
the infrastructure and then this

970
00:33:36,000 --> 00:33:40,159
required us to test quite a bit because

971
00:33:38,159 --> 00:33:42,000
first we had to enable the log locally

972
00:33:40,159 --> 00:33:44,159
then send it to

973
00:33:42,000 --> 00:33:45,519
event sentry then turn on the alerts

974
00:33:44,159 --> 00:33:48,159
then tune the alerts

975
00:33:45,519 --> 00:33:49,200
and here's what it looks like we created

976
00:33:48,159 --> 00:33:51,360
a little quick

977
00:33:49,200 --> 00:33:53,440
threat there that just runs powershell

978
00:33:51,360 --> 00:33:55,840
who am i and runs powershell with

979
00:33:53,440 --> 00:33:57,840
um encoding again that's who am i you

980
00:33:55,840 --> 00:34:01,519
don't have to decode that in your head

981
00:33:57,840 --> 00:34:02,158
very easy but very simple to repeatably

982
00:34:01,519 --> 00:34:04,320
test

983
00:34:02,159 --> 00:34:05,440
and you can see here how many times we

984
00:34:04,320 --> 00:34:09,440
tested for that

985
00:34:05,440 --> 00:34:11,760
very very simple uh powershell.exe

986
00:34:09,440 --> 00:34:15,520
so at the end of the second week we're

987
00:34:11,760 --> 00:34:18,960
up to 73 percent detection

988
00:34:15,520 --> 00:34:21,839
week three we did bot trap this is a

989
00:34:18,960 --> 00:34:22,560
medium sophisticated russian uh threat

990
00:34:21,839 --> 00:34:24,879
group

991
00:34:22,560 --> 00:34:26,000
that did a little bit more than just

992
00:34:24,879 --> 00:34:28,480
discovery

993
00:34:26,000 --> 00:34:31,119
uh did things like persistence and

994
00:34:28,480 --> 00:34:31,760
defense evasion and execution of other

995
00:34:31,119 --> 00:34:35,119
things

996
00:34:31,760 --> 00:34:37,839
they also did c2 over dns

997
00:34:35,119 --> 00:34:40,079
and rdp remember up until now we've only

998
00:34:37,839 --> 00:34:41,679
tested https

999
00:34:40,079 --> 00:34:45,200
so this is what it looks like in the

1000
00:34:41,679 --> 00:34:46,399
planning phase c2 via dns via https and

1001
00:34:45,199 --> 00:34:48,960
vrdp

1002
00:34:46,399 --> 00:34:50,319
some discovery and then lots of new

1003
00:34:48,960 --> 00:34:52,480
things in the collection

1004
00:34:50,320 --> 00:34:54,480
side right stealing from clipboard t

1005
00:34:52,480 --> 00:34:56,879
loggers etc

1006
00:34:54,480 --> 00:34:59,440
so while most adversaries operate over

1007
00:34:56,879 --> 00:35:02,160
http and https

1008
00:34:59,440 --> 00:35:04,320
uh adversaries sometimes use dns it's

1009
00:35:02,160 --> 00:35:05,279
not the quickest right but it's good for

1010
00:35:04,320 --> 00:35:07,440
long haul

1011
00:35:05,280 --> 00:35:08,720
and lately of course we're seeing rdp as

1012
00:35:07,440 --> 00:35:11,920
well um

1013
00:35:08,720 --> 00:35:15,200
and we also have a module

1014
00:35:11,920 --> 00:35:17,599
that leverages uh rob fuller's or mubic

1015
00:35:15,200 --> 00:35:19,919
is let me out of your net which is great

1016
00:35:17,599 --> 00:35:23,359
for testing multiple egress points from

1017
00:35:19,920 --> 00:35:23,760
inside your network so we took a look at

1018
00:35:23,359 --> 00:35:26,240
this

1019
00:35:23,760 --> 00:35:26,880
and it actually was blocking dns

1020
00:35:26,240 --> 00:35:29,118
outbound

1021
00:35:26,880 --> 00:35:30,640
we thought that was fantastic we gave

1022
00:35:29,119 --> 00:35:34,000
each other half fives

1023
00:35:30,640 --> 00:35:36,240
and we let them know that they blocked

1024
00:35:34,000 --> 00:35:37,599
a particular c2 method this is great

1025
00:35:36,240 --> 00:35:40,720
it's important to share

1026
00:35:37,599 --> 00:35:42,800
the wins and to understand why they are

1027
00:35:40,720 --> 00:35:43,680
there do root cause analysis and see how

1028
00:35:42,800 --> 00:35:47,359
you can apply

1029
00:35:43,680 --> 00:35:50,480
those wins to other things so

1030
00:35:47,359 --> 00:35:52,240
we did find remote desktop outbound and

1031
00:35:50,480 --> 00:35:54,800
that should not have been there

1032
00:35:52,240 --> 00:35:56,000
when they saw that they immediately

1033
00:35:54,800 --> 00:35:59,440
looked at each other and said

1034
00:35:56,000 --> 00:36:01,440
no way no no and and they went off

1035
00:35:59,440 --> 00:36:02,720
they didn't share their screen but

1036
00:36:01,440 --> 00:36:04,400
within a few minutes

1037
00:36:02,720 --> 00:36:06,000
they actually came back and said test

1038
00:36:04,400 --> 00:36:08,640
that rdp outbound again

1039
00:36:06,000 --> 00:36:09,440
and we did and it was fixed it was

1040
00:36:08,640 --> 00:36:12,799
fantastic

1041
00:36:09,440 --> 00:36:16,000
it was a configuration that was modified

1042
00:36:12,800 --> 00:36:18,079
um it's it was a done on the fly

1043
00:36:16,000 --> 00:36:19,520
and was forgotten about until we

1044
00:36:18,079 --> 00:36:21,680
actually tested it

1045
00:36:19,520 --> 00:36:23,759
so for detecting command and control

1046
00:36:21,680 --> 00:36:25,040
again sysmon event id3 for network

1047
00:36:23,760 --> 00:36:28,079
connections

1048
00:36:25,040 --> 00:36:31,119
and monitoring that outbound connection

1049
00:36:28,079 --> 00:36:31,920
now there was an area where we didn't do

1050
00:36:31,119 --> 00:36:34,480
too well in

1051
00:36:31,920 --> 00:36:35,119
and that was monitoring windows api

1052
00:36:34,480 --> 00:36:37,280
calls

1053
00:36:35,119 --> 00:36:38,800
things like key logging and clipboard

1054
00:36:37,280 --> 00:36:40,880
access and screen prints

1055
00:36:38,800 --> 00:36:43,359
and now before you tell me that yes

1056
00:36:40,880 --> 00:36:46,240
sysmon now catches clipboard

1057
00:36:43,359 --> 00:36:48,240
which is true that update came out

1058
00:36:46,240 --> 00:36:50,399
towards the end of this assessment

1059
00:36:48,240 --> 00:36:52,399
and we were not did not have the time to

1060
00:36:50,400 --> 00:36:55,520
go back and enable those

1061
00:36:52,400 --> 00:36:56,960
live uh for uh this particular

1062
00:36:55,520 --> 00:36:59,440
assessment

1063
00:36:56,960 --> 00:37:00,640
so um what did detection look like at

1064
00:36:59,440 --> 00:37:04,160
the end 60

1065
00:37:00,640 --> 00:37:07,118
detected still had that block on dns

1066
00:37:04,160 --> 00:37:08,799
and rdp as well as something's not

1067
00:37:07,119 --> 00:37:11,839
getting detected

1068
00:37:08,800 --> 00:37:14,880
then week four apt-33 this

1069
00:37:11,839 --> 00:37:17,359
an iranian threat actor this one

1070
00:37:14,880 --> 00:37:19,200
uh or pretty much any iranian threat

1071
00:37:17,359 --> 00:37:22,640
actors became pretty popular

1072
00:37:19,200 --> 00:37:23,839
in early 2020 uh after the assassination

1073
00:37:22,640 --> 00:37:27,359
of solomoni

1074
00:37:23,839 --> 00:37:31,200
we were in heightened alert of iranian

1075
00:37:27,359 --> 00:37:34,078
retaliation through um cyber

1076
00:37:31,200 --> 00:37:36,160
so this planning you can see this threat

1077
00:37:34,079 --> 00:37:39,280
actors a little bit more sophisticated

1078
00:37:36,160 --> 00:37:41,440
does a lot more ttps there are going to

1079
00:37:39,280 --> 00:37:43,200
be some repeat ttps but again that's

1080
00:37:41,440 --> 00:37:45,200
totally fine actors

1081
00:37:43,200 --> 00:37:47,118
will repeat things but you can see

1082
00:37:45,200 --> 00:37:49,279
things they're like running scheduled

1083
00:37:47,119 --> 00:37:51,920
tasks and creating schedule tasks

1084
00:37:49,280 --> 00:37:53,920
it's a great way for persistence we did

1085
00:37:51,920 --> 00:37:56,480
the test and guess what

1086
00:37:53,920 --> 00:37:58,160
there was detection for scheduled tasks

1087
00:37:56,480 --> 00:38:00,720
when we created them

1088
00:37:58,160 --> 00:38:01,759
immediately uh one of the attendees

1089
00:38:00,720 --> 00:38:03,359
received an alert

1090
00:38:01,760 --> 00:38:05,760
on their email that there was a brand

1091
00:38:03,359 --> 00:38:07,920
new scheduled test created on a system

1092
00:38:05,760 --> 00:38:10,240
we again gave each other high fives and

1093
00:38:07,920 --> 00:38:14,000
said that is awesome

1094
00:38:10,240 --> 00:38:16,799
but 88 was not detected so

1095
00:38:14,000 --> 00:38:18,000
here looked up some more powershell more

1096
00:38:16,800 --> 00:38:20,320
command prompts

1097
00:38:18,000 --> 00:38:22,240
and then enabled some other event ids

1098
00:38:20,320 --> 00:38:25,599
like file creation

1099
00:38:22,240 --> 00:38:27,598
and registry modifications so registry

1100
00:38:25,599 --> 00:38:30,720
modifications are tough

1101
00:38:27,599 --> 00:38:31,760
because the registry is touched all day

1102
00:38:30,720 --> 00:38:34,319
long by pretty much

1103
00:38:31,760 --> 00:38:35,040
everything that's going on so the tuning

1104
00:38:34,320 --> 00:38:37,359
for it

1105
00:38:35,040 --> 00:38:38,880
becomes quite difficult there's actually

1106
00:38:37,359 --> 00:38:42,240
three different event ids

1107
00:38:38,880 --> 00:38:43,920
id 12 13 and 14 for various registry

1108
00:38:42,240 --> 00:38:46,078
modifications

1109
00:38:43,920 --> 00:38:48,079
and we had to look into those and tune

1110
00:38:46,079 --> 00:38:51,520
those to only alert on

1111
00:38:48,079 --> 00:38:53,839
certain modifications so

1112
00:38:51,520 --> 00:38:55,359
which ones did we want to monitor things

1113
00:38:53,839 --> 00:38:58,400
like startup activity

1114
00:38:55,359 --> 00:39:00,000
and stored credentials and accessibility

1115
00:38:58,400 --> 00:39:02,000
features for things like

1116
00:39:00,000 --> 00:39:04,240
input and image capture right we

1117
00:39:02,000 --> 00:39:07,200
couldn't enable everything because

1118
00:39:04,240 --> 00:39:07,439
there was a lot of noise so at the end

1119
00:39:07,200 --> 00:39:11,160
of

1120
00:39:07,440 --> 00:39:12,960
uh that week we were at 58 detection for

1121
00:39:11,160 --> 00:39:15,759
apt-33

1122
00:39:12,960 --> 00:39:17,680
then we did apt-3 this was a pretty

1123
00:39:15,760 --> 00:39:21,920
well-known chinese cyber

1124
00:39:17,680 --> 00:39:25,200
threat actor again uh lots of execution

1125
00:39:21,920 --> 00:39:27,040
collection some exfiltration no

1126
00:39:25,200 --> 00:39:28,319
detection going toward back to our

1127
00:39:27,040 --> 00:39:31,040
baseline

1128
00:39:28,320 --> 00:39:33,280
and then enabling other things right

1129
00:39:31,040 --> 00:39:34,000
still having those issues with the api

1130
00:39:33,280 --> 00:39:37,359
calls

1131
00:39:34,000 --> 00:39:39,839
but we were able to detect exfiltration

1132
00:39:37,359 --> 00:39:40,640
with event id 18 for creating remote

1133
00:39:39,839 --> 00:39:43,359
threads

1134
00:39:40,640 --> 00:39:44,560
as well as file creation and network

1135
00:39:43,359 --> 00:39:47,279
connections

1136
00:39:44,560 --> 00:39:48,880
so few two a bit of tuning there and

1137
00:39:47,280 --> 00:39:52,400
back up to 71

1138
00:39:48,880 --> 00:39:55,440
detection and then on the final week

1139
00:39:52,400 --> 00:39:56,000
we had what's called free play free play

1140
00:39:55,440 --> 00:39:58,480
is that

1141
00:39:56,000 --> 00:40:00,800
based on the previous five weeks of work

1142
00:39:58,480 --> 00:40:01,359
what areas do we think we need to focus

1143
00:40:00,800 --> 00:40:04,560
on

1144
00:40:01,359 --> 00:40:05,200
well two critical vulnerabilities had

1145
00:40:04,560 --> 00:40:07,680
come out

1146
00:40:05,200 --> 00:40:09,040
you might remember these uh feel so long

1147
00:40:07,680 --> 00:40:11,520
ago but this was probably

1148
00:40:09,040 --> 00:40:12,560
less than six months ago um there was

1149
00:40:11,520 --> 00:40:15,040
zero logging

1150
00:40:12,560 --> 00:40:17,279
on windows domain controllers and

1151
00:40:15,040 --> 00:40:19,200
microsoft exchange had a vulnerability

1152
00:40:17,280 --> 00:40:20,960
and we really didn't spend too much time

1153
00:40:19,200 --> 00:40:23,279
looking at the domain itself

1154
00:40:20,960 --> 00:40:24,960
or doing lateral movement so we came up

1155
00:40:23,280 --> 00:40:26,960
with a plan for that

1156
00:40:24,960 --> 00:40:28,720
one of the things we ran was bloodhound

1157
00:40:26,960 --> 00:40:31,920
and shout out to the uh

1158
00:40:28,720 --> 00:40:34,560
to the developers of bloodhound and

1159
00:40:31,920 --> 00:40:36,880
um what it does is it queries your

1160
00:40:34,560 --> 00:40:39,920
domain controller as well as

1161
00:40:36,880 --> 00:40:43,040
machines in your environment to discover

1162
00:40:39,920 --> 00:40:45,200
users groups machines acls etc

1163
00:40:43,040 --> 00:40:47,599
you then take that information offline

1164
00:40:45,200 --> 00:40:48,240
and has this beautiful visualization

1165
00:40:47,599 --> 00:40:51,280
platform

1166
00:40:48,240 --> 00:40:52,240
that allows you to see who's connected

1167
00:40:51,280 --> 00:40:54,640
to where

1168
00:40:52,240 --> 00:40:55,919
and you can do queries like what's the

1169
00:40:54,640 --> 00:40:59,040
quickest way

1170
00:40:55,920 --> 00:41:02,160
to domain admin and

1171
00:40:59,040 --> 00:41:04,960
as we ran this we there was no detection

1172
00:41:02,160 --> 00:41:06,720
for the actual queries but it's really

1173
00:41:04,960 --> 00:41:10,160
more information gathering

1174
00:41:06,720 --> 00:41:11,759
but we still worked on detections and we

1175
00:41:10,160 --> 00:41:12,399
found that there were some standard

1176
00:41:11,760 --> 00:41:15,200
users

1177
00:41:12,400 --> 00:41:16,560
in the enterprise admin group this is

1178
00:41:15,200 --> 00:41:19,118
generally not good

1179
00:41:16,560 --> 00:41:20,000
we notified the stakeholders immediately

1180
00:41:19,119 --> 00:41:22,079
for this one

1181
00:41:20,000 --> 00:41:24,000
they weren't watching um as we were

1182
00:41:22,079 --> 00:41:25,359
doing it so we called them up

1183
00:41:24,000 --> 00:41:28,480
and this was another one that was

1184
00:41:25,359 --> 00:41:30,078
resolved within minutes

1185
00:41:28,480 --> 00:41:31,839
then we took a look at some of the

1186
00:41:30,079 --> 00:41:32,240
vulnerabilities that had recently come

1187
00:41:31,839 --> 00:41:33,680
out

1188
00:41:32,240 --> 00:41:35,680
they said they had a good patch

1189
00:41:33,680 --> 00:41:38,640
management policy and process

1190
00:41:35,680 --> 00:41:39,598
so we tested it we wanted to see if they

1191
00:41:38,640 --> 00:41:41,118
did indeed

1192
00:41:39,599 --> 00:41:42,720
um patch for these critical

1193
00:41:41,119 --> 00:41:45,119
vulnerabilities and

1194
00:41:42,720 --> 00:41:46,399
they had which was great it was great to

1195
00:41:45,119 --> 00:41:49,119
verify that again

1196
00:41:46,400 --> 00:41:50,240
high fives all around then we attempted

1197
00:41:49,119 --> 00:41:52,960
lateral movement

1198
00:41:50,240 --> 00:41:54,720
they had invested significantly in

1199
00:41:52,960 --> 00:41:56,960
network segmentation

1200
00:41:54,720 --> 00:41:59,359
so we tried doing some lateral movement

1201
00:41:56,960 --> 00:42:01,760
through a number of different ways

1202
00:41:59,359 --> 00:42:03,200
and a lot of those were blocked uh up to

1203
00:42:01,760 --> 00:42:06,160
the extent that we tested

1204
00:42:03,200 --> 00:42:08,399
which was good and uh we were able to

1205
00:42:06,160 --> 00:42:10,078
share that good news with them as well

1206
00:42:08,400 --> 00:42:12,640
then we did some kerber roasting

1207
00:42:10,079 --> 00:42:16,400
kerberosing is and was discovered by tim

1208
00:42:12,640 --> 00:42:19,118
medine of red siege so shout out to tim

1209
00:42:16,400 --> 00:42:19,920
it's the ability to request service

1210
00:42:19,119 --> 00:42:23,920
tickets

1211
00:42:19,920 --> 00:42:25,680
for services that may have existed at

1212
00:42:23,920 --> 00:42:26,960
any time or currently exist in active

1213
00:42:25,680 --> 00:42:28,640
directory

1214
00:42:26,960 --> 00:42:30,480
the way that works is you work you

1215
00:42:28,640 --> 00:42:32,400
contact the domain controller it's how

1216
00:42:30,480 --> 00:42:34,880
kerberos authentication works which

1217
00:42:32,400 --> 00:42:37,280
i'm not going to go into um but pretty

1218
00:42:34,880 --> 00:42:40,079
much you ask that domain controller

1219
00:42:37,280 --> 00:42:41,280
for a a service ticket it provides you

1220
00:42:40,079 --> 00:42:43,680
that service ticket

1221
00:42:41,280 --> 00:42:45,599
um hashed you can then grab that ticket

1222
00:42:43,680 --> 00:42:48,720
and crack it offline

1223
00:42:45,599 --> 00:42:52,240
and we did find a particular account

1224
00:42:48,720 --> 00:42:54,799
and that was kerber roastable uh i think

1225
00:42:52,240 --> 00:42:56,000
oh no didn't cover on the other side um

1226
00:42:54,800 --> 00:42:58,319
we don't mention

1227
00:42:56,000 --> 00:42:59,359
what what uh account that was but

1228
00:42:58,319 --> 00:43:02,400
ironically

1229
00:42:59,359 --> 00:43:06,400
it was a security

1230
00:43:02,400 --> 00:43:09,040
tool uh account and that that was uh

1231
00:43:06,400 --> 00:43:11,200
an interesting one to to see fixed we

1232
00:43:09,040 --> 00:43:13,920
did other things internally like

1233
00:43:11,200 --> 00:43:15,839
port scanning which is quite basic but i

1234
00:43:13,920 --> 00:43:19,280
only highlight this one because

1235
00:43:15,839 --> 00:43:21,920
we scanned a honeypot and this is when

1236
00:43:19,280 --> 00:43:23,119
i got an immediate text saying hey how's

1237
00:43:21,920 --> 00:43:26,560
your free play going

1238
00:43:23,119 --> 00:43:30,240
i see you i'm like oh cool good job um

1239
00:43:26,560 --> 00:43:32,799
so we um we documented as a win

1240
00:43:30,240 --> 00:43:33,839
we then did some exfiltration we created

1241
00:43:32,800 --> 00:43:36,640
a fake 2gig

1242
00:43:33,839 --> 00:43:38,160
file and exfiltrated it there were no

1243
00:43:36,640 --> 00:43:41,118
alerts triggered

1244
00:43:38,160 --> 00:43:42,240
i love the network visibility um on the

1245
00:43:41,119 --> 00:43:44,560
network side

1246
00:43:42,240 --> 00:43:46,479
uh was lagging here because there was no

1247
00:43:44,560 --> 00:43:48,480
net flow to analyze the data

1248
00:43:46,480 --> 00:43:51,200
now event sentry does have a module for

1249
00:43:48,480 --> 00:43:53,200
that but they had not purchased it yet

1250
00:43:51,200 --> 00:43:54,879
so this was one of the recommendations

1251
00:43:53,200 --> 00:43:57,839
however we did not enable it

1252
00:43:54,880 --> 00:44:00,000
keeping true to not spending any money

1253
00:43:57,839 --> 00:44:02,000
on this assessment

1254
00:44:00,000 --> 00:44:04,800
so at the end state as i mentioned

1255
00:44:02,000 --> 00:44:08,160
earlier zero dollar technology spend

1256
00:44:04,800 --> 00:44:11,680
purely process and people uh

1257
00:44:08,160 --> 00:44:14,879
we enabled telemetry we enabled logic we

1258
00:44:11,680 --> 00:44:18,399
created response plans and uh

1259
00:44:14,880 --> 00:44:20,640
64 detection rate uh for these

1260
00:44:18,400 --> 00:44:22,800
known adversary behaviors uh that we

1261
00:44:20,640 --> 00:44:24,960
tested but more importantly what we

1262
00:44:22,800 --> 00:44:26,560
built was a purple team program

1263
00:44:24,960 --> 00:44:29,040
that they will now be able to

1264
00:44:26,560 --> 00:44:31,839
continually test for

1265
00:44:29,040 --> 00:44:33,279
um using vector we get uh nice

1266
00:44:31,839 --> 00:44:35,200
historical trending

1267
00:44:33,280 --> 00:44:37,040
uh the reason it goes down every week is

1268
00:44:35,200 --> 00:44:37,680
because we go back to the baseline every

1269
00:44:37,040 --> 00:44:40,079
week

1270
00:44:37,680 --> 00:44:40,960
uh but you can see here towards the end

1271
00:44:40,079 --> 00:44:44,000
um

1272
00:44:40,960 --> 00:44:47,200
we're definitely up to a a rate that

1273
00:44:44,000 --> 00:44:51,119
um that they liked and that they

1274
00:44:47,200 --> 00:44:53,359
can improve on our recommendations here

1275
00:44:51,119 --> 00:44:55,920
were to continue testing make sure that

1276
00:44:53,359 --> 00:44:56,720
things don't change right uh we actually

1277
00:44:55,920 --> 00:44:58,319
detected

1278
00:44:56,720 --> 00:45:00,399
that rdp that shouldn't have been

1279
00:44:58,319 --> 00:45:01,759
allowed outbound and they were able to

1280
00:45:00,400 --> 00:45:04,640
fix quickly

1281
00:45:01,760 --> 00:45:06,160
well they should consider network level

1282
00:45:04,640 --> 00:45:08,799
detection

1283
00:45:06,160 --> 00:45:10,799
particularly around netflow uh which is

1284
00:45:08,800 --> 00:45:13,440
probably the best bang for your buck

1285
00:45:10,800 --> 00:45:15,359
um and then as new threats come out take

1286
00:45:13,440 --> 00:45:18,000
the adversary emulation plans and

1287
00:45:15,359 --> 00:45:19,680
test them against yourself we actually

1288
00:45:18,000 --> 00:45:21,440
publish all of these for free to a

1289
00:45:19,680 --> 00:45:23,680
community it's the largest public

1290
00:45:21,440 --> 00:45:26,319
library of adversary emulation plans

1291
00:45:23,680 --> 00:45:26,960
um this is an old screenshot uh we

1292
00:45:26,319 --> 00:45:29,359
update

1293
00:45:26,960 --> 00:45:30,400
uh things quite frequently the latest

1294
00:45:29,359 --> 00:45:32,240
one is a gregor

1295
00:45:30,400 --> 00:45:34,319
which is a brand new threat actor has

1296
00:45:32,240 --> 00:45:35,919
been around only a couple months

1297
00:45:34,319 --> 00:45:37,839
so if you're interested in the latest

1298
00:45:35,920 --> 00:45:41,440
and greatest by all means

1299
00:45:37,839 --> 00:45:42,960
uh check it out and if you're a threat

1300
00:45:41,440 --> 00:45:45,680
television store offense

1301
00:45:42,960 --> 00:45:46,319
we love collaborating on doing those and

1302
00:45:45,680 --> 00:45:49,839
helping

1303
00:45:46,319 --> 00:45:51,040
present them use attack and detect as a

1304
00:45:49,839 --> 00:45:53,040
guide

1305
00:45:51,040 --> 00:45:55,040
i cannot emphasize enough that while

1306
00:45:53,040 --> 00:45:56,079
it's easy to get caught up because in

1307
00:45:55,040 --> 00:45:58,240
security

1308
00:45:56,079 --> 00:46:00,800
we don't get to have quantitative

1309
00:45:58,240 --> 00:46:02,240
metrics very often and folks love to

1310
00:46:00,800 --> 00:46:05,440
look at attack and go

1311
00:46:02,240 --> 00:46:06,879
well that's my bingo card to just

1312
00:46:05,440 --> 00:46:08,800
cover as many of them as possible and

1313
00:46:06,880 --> 00:46:10,800
look what i've done um

1314
00:46:08,800 --> 00:46:12,640
the same thing on looking at that

1315
00:46:10,800 --> 00:46:14,800
detection graph

1316
00:46:12,640 --> 00:46:16,400
where we see it trending you're not

1317
00:46:14,800 --> 00:46:18,480
going to get to 100

1318
00:46:16,400 --> 00:46:20,240
it's not possible to get to 100 and if

1319
00:46:18,480 --> 00:46:22,640
you ever somehow achieved that

1320
00:46:20,240 --> 00:46:23,359
uh you've either got an environment that

1321
00:46:22,640 --> 00:46:25,279
is so

1322
00:46:23,359 --> 00:46:26,480
over engineered or you've spent way too

1323
00:46:25,280 --> 00:46:28,960
much time on it

1324
00:46:26,480 --> 00:46:29,599
the key thing here is finding your

1325
00:46:28,960 --> 00:46:32,720
detection

1326
00:46:29,599 --> 00:46:34,880
average what is that natural percentage

1327
00:46:32,720 --> 00:46:36,480
that makes sense in your organization

1328
00:46:34,880 --> 00:46:38,400
and nobody can give this to you

1329
00:46:36,480 --> 00:46:40,319
you have to go through this process to

1330
00:46:38,400 --> 00:46:42,560
find what that is

1331
00:46:40,319 --> 00:46:43,839
and over time you'll get there and

1332
00:46:42,560 --> 00:46:46,160
you'll be able then

1333
00:46:43,839 --> 00:46:47,359
to react as things change in your

1334
00:46:46,160 --> 00:46:49,279
environment so the ability to

1335
00:46:47,359 --> 00:46:51,759
continually assess that percentage

1336
00:46:49,280 --> 00:46:53,599
which um there are tools to help you do

1337
00:46:51,760 --> 00:46:56,240
that

1338
00:46:53,599 --> 00:46:57,119
will give you a natural feel for how

1339
00:46:56,240 --> 00:46:58,479
it's going

1340
00:46:57,119 --> 00:47:00,480
the other thing i want to talk about

1341
00:46:58,480 --> 00:47:02,240
here is that this was

1342
00:47:00,480 --> 00:47:03,680
uh as long as much as this was like

1343
00:47:02,240 --> 00:47:04,720
overall a two two and a half month

1344
00:47:03,680 --> 00:47:07,759
engagement with

1345
00:47:04,720 --> 00:47:08,480
six weeks of focused on the ground we

1346
00:47:07,760 --> 00:47:12,240
really

1347
00:47:08,480 --> 00:47:14,000
only got as far as building out a strong

1348
00:47:12,240 --> 00:47:16,560
i mean effectively using detect as a

1349
00:47:14,000 --> 00:47:19,599
guide that data sources detection

1350
00:47:16,560 --> 00:47:21,920
and visibility the next step which

1351
00:47:19,599 --> 00:47:23,680
credit to dimitrio perovich is what's

1352
00:47:21,920 --> 00:47:25,839
called his 1060 rule

1353
00:47:23,680 --> 00:47:27,440
and what we're looking at here is taking

1354
00:47:25,839 --> 00:47:28,960
it even further to understanding

1355
00:47:27,440 --> 00:47:31,119
response times because

1356
00:47:28,960 --> 00:47:32,960
what he was getting at is when you look

1357
00:47:31,119 --> 00:47:34,720
at being able to contain

1358
00:47:32,960 --> 00:47:36,319
what's called the breakout time of an

1359
00:47:34,720 --> 00:47:38,000
adversary that's

1360
00:47:36,319 --> 00:47:40,319
you know once they got shell and start

1361
00:47:38,000 --> 00:47:42,319
doing something the clock begins to tick

1362
00:47:40,319 --> 00:47:44,000
the more time that they are there the

1363
00:47:42,319 --> 00:47:45,520
more damage and the further they can get

1364
00:47:44,000 --> 00:47:45,839
and so what you want to be able to do

1365
00:47:45,520 --> 00:47:48,160
here

1366
00:47:45,839 --> 00:47:49,839
is now taking all of these things we've

1367
00:47:48,160 --> 00:47:51,040
put in place in a mature environment and

1368
00:47:49,839 --> 00:47:53,839
starting to go okay

1369
00:47:51,040 --> 00:47:55,599
when did my tools see something when did

1370
00:47:53,839 --> 00:47:56,720
my team see it and be able to respond to

1371
00:47:55,599 --> 00:47:58,480
it that's that difference between

1372
00:47:56,720 --> 00:48:00,720
logging and alerting

1373
00:47:58,480 --> 00:48:02,319
how long did it take them to respond and

1374
00:48:00,720 --> 00:48:04,720
fully understand

1375
00:48:02,319 --> 00:48:05,440
what the attack is is doing and what's

1376
00:48:04,720 --> 00:48:07,040
the scope

1377
00:48:05,440 --> 00:48:08,640
and then finally how long does it take

1378
00:48:07,040 --> 00:48:11,920
to control and remediate

1379
00:48:08,640 --> 00:48:14,960
and so the 11060 was a guideline

1380
00:48:11,920 --> 00:48:16,400
for this is um what you the vision of

1381
00:48:14,960 --> 00:48:20,240
what you want to achieve

1382
00:48:16,400 --> 00:48:24,319
uh again results may vary uh but

1383
00:48:20,240 --> 00:48:24,319
very much the next step

1384
00:48:27,680 --> 00:48:32,319
so um we really believe in sharing

1385
00:48:30,240 --> 00:48:35,680
things with the community

1386
00:48:32,319 --> 00:48:37,839
it's in our dna um so

1387
00:48:35,680 --> 00:48:39,839
you know even though we use scythe and

1388
00:48:37,839 --> 00:48:40,799
we didn't don't want this to be a sales

1389
00:48:39,839 --> 00:48:43,359
presentation

1390
00:48:40,800 --> 00:48:44,079
uh we do have a lot of free resources

1391
00:48:43,359 --> 00:48:46,400
for you

1392
00:48:44,079 --> 00:48:47,119
um one is the purple team exercise

1393
00:48:46,400 --> 00:48:49,520
framework

1394
00:48:47,119 --> 00:48:51,680
it's free and available at ptf um the

1395
00:48:49,520 --> 00:48:53,119
other thing is our workshops that we

1396
00:48:51,680 --> 00:48:54,879
uh host all the time we're going to be

1397
00:48:53,119 --> 00:48:57,520
hosting it

1398
00:48:54,880 --> 00:49:00,000
right after this in about an hour after

1399
00:48:57,520 --> 00:49:03,200
you watch this if you watch this live

1400
00:49:00,000 --> 00:49:04,240
so come on out to that it's hands-on uh

1401
00:49:03,200 --> 00:49:05,919
it's free

1402
00:49:04,240 --> 00:49:07,759
we have an environment for you where you

1403
00:49:05,920 --> 00:49:10,800
get to play cti

1404
00:49:07,760 --> 00:49:12,880
uh bread and blue we also provide

1405
00:49:10,800 --> 00:49:15,040
all the adversary emulation plans we

1406
00:49:12,880 --> 00:49:17,680
create with community help

1407
00:49:15,040 --> 00:49:20,160
i mentioned mcgregor working with sean

1408
00:49:17,680 --> 00:49:22,879
gallagher from sophos on that one

1409
00:49:20,160 --> 00:49:24,640
on our community threats github again

1410
00:49:22,880 --> 00:49:26,480
those are all free you can

1411
00:49:24,640 --> 00:49:27,759
take a look at those we provide them in

1412
00:49:26,480 --> 00:49:32,240
json

1413
00:49:27,760 --> 00:49:34,480
format and also in attack navigator json

1414
00:49:32,240 --> 00:49:35,439
um the sysmon configurations are free

1415
00:49:34,480 --> 00:49:38,559
shout out to

1416
00:49:35,440 --> 00:49:41,040
olaf and sysmond modular and

1417
00:49:38,559 --> 00:49:41,680
if you do use event sentry they will be

1418
00:49:41,040 --> 00:49:44,240
providing

1419
00:49:41,680 --> 00:49:45,118
all of that alert and logic we created

1420
00:49:44,240 --> 00:49:47,680
as well

1421
00:49:45,119 --> 00:49:48,240
in a blog series that they're pointing

1422
00:49:47,680 --> 00:49:52,240
um

1423
00:49:48,240 --> 00:49:54,959
so again um thanks to nmfta

1424
00:49:52,240 --> 00:49:56,720
for allowing us to share this use case

1425
00:49:54,960 --> 00:49:58,319
hopefully you found this valuable and

1426
00:49:56,720 --> 00:50:01,439
it's something that you can do

1427
00:49:58,319 --> 00:50:04,640
um and of course we try to keep it

1428
00:50:01,440 --> 00:50:07,359
at as least salesy as possible

1429
00:50:04,640 --> 00:50:08,720
um really focusing on on the technology

1430
00:50:07,359 --> 00:50:10,799
and on the process

1431
00:50:08,720 --> 00:50:12,160
that you need to create with your people

1432
00:50:10,800 --> 00:50:14,880
um to

1433
00:50:12,160 --> 00:50:16,558
continue and and be able to defend and

1434
00:50:14,880 --> 00:50:18,240
detect and respond to these evolving

1435
00:50:16,559 --> 00:50:20,319
threats

1436
00:50:18,240 --> 00:50:22,640
uh the purple team exercise framework is

1437
00:50:20,319 --> 00:50:24,558
a living document we already have plans

1438
00:50:22,640 --> 00:50:26,799
in the works to

1439
00:50:24,559 --> 00:50:28,720
bring in additional community partners

1440
00:50:26,800 --> 00:50:30,400
and update what we've learned from it

1441
00:50:28,720 --> 00:50:32,078
from a process perspective

1442
00:50:30,400 --> 00:50:33,340
and continue to share that out for free

1443
00:50:32,079 --> 00:50:36,469
for everybody as a resource

1444
00:50:33,340 --> 00:50:36,469
[Music]

1445
00:50:37,839 --> 00:50:43,920
that's it thank you very much we will

1446
00:50:40,480 --> 00:50:43,920
take questions on discord

1447
00:50:47,119 --> 00:50:49,599
all right

1448
00:50:50,319 --> 00:50:55,839
stop recording

1449
00:51:03,280 --> 00:51:05,359
you

