1
00:00:00,659 --> 00:00:03,380
why

2
00:00:08,519 --> 00:00:10,320
now we have Kristen who is going to be

3
00:00:10,320 --> 00:00:13,019
talking about diving into macmo analysis

4
00:00:13,019 --> 00:00:15,240
for the first time uh Kristen is a

5
00:00:15,240 --> 00:00:18,800
world-renowned keynote speaker

6
00:00:18,859 --> 00:00:21,180
and so let's give a round of applause

7
00:00:21,180 --> 00:00:24,020
for Kristen

8
00:00:28,080 --> 00:00:29,760
hey uh nice to be here not

9
00:00:29,760 --> 00:00:31,320
world-renowned keynote speaker but thank

10
00:00:31,320 --> 00:00:32,759
you Patrick

11
00:00:32,759 --> 00:00:35,280
um so the idea for this talk today was

12
00:00:35,280 --> 00:00:37,559
essentially let me be a guinea pig who

13
00:00:37,559 --> 00:00:38,820
knows absolutely nothing about Mac

14
00:00:38,820 --> 00:00:41,280
malware and record my experience trying

15
00:00:41,280 --> 00:00:43,379
to dive into it and like how do you

16
00:00:43,379 --> 00:00:45,120
reverse it understand it analyze it what

17
00:00:45,120 --> 00:00:46,559
do you get out of it

18
00:00:46,559 --> 00:00:49,260
um and I know having you know only kind

19
00:00:49,260 --> 00:00:50,520
of been technical for the last like five

20
00:00:50,520 --> 00:00:52,500
six years that if you don't know what

21
00:00:52,500 --> 00:00:54,239
you don't even know about something it

22
00:00:54,239 --> 00:00:55,920
can be a little bit intimidating trying

23
00:00:55,920 --> 00:00:58,800
to understand like where do you start

24
00:00:58,800 --> 00:01:00,239
um and so I had never looked at Mac

25
00:01:00,239 --> 00:01:02,039
malware specifically I have history with

26
00:01:02,039 --> 00:01:03,780
some malware analysis but this was new

27
00:01:03,780 --> 00:01:06,119
so I was like okay let's just you know

28
00:01:06,119 --> 00:01:07,920
see what mistakes I make what resources

29
00:01:07,920 --> 00:01:09,600
we can use the time commitments

30
00:01:09,600 --> 00:01:11,100
everything

31
00:01:11,100 --> 00:01:12,720
um and kind of what I want to dive in on

32
00:01:12,720 --> 00:01:15,180
all this is you can work smart not hard

33
00:01:15,180 --> 00:01:17,520
and still get a lot of high level like a

34
00:01:17,520 --> 00:01:19,020
lot of good information from like very

35
00:01:19,020 --> 00:01:21,600
high level surface investigations

36
00:01:21,600 --> 00:01:23,400
um and we have 25 minutes you're not

37
00:01:23,400 --> 00:01:24,900
going to be like a top reverse engineer

38
00:01:24,900 --> 00:01:27,119
in 25 minutes after this but I'm hoping

39
00:01:27,119 --> 00:01:28,920
that I can get enough information across

40
00:01:28,920 --> 00:01:31,020
where it's useful for a range of people

41
00:01:31,020 --> 00:01:33,360
from like sales Engineers to instant

42
00:01:33,360 --> 00:01:34,920
responders to if you're researchers

43
00:01:34,920 --> 00:01:36,659
threat analysts who go a bit more in the

44
00:01:36,659 --> 00:01:37,740
weeds

45
00:01:37,740 --> 00:01:39,119
um there's not there's a lot you can

46
00:01:39,119 --> 00:01:40,799
learn from this

47
00:01:40,799 --> 00:01:43,619
so a little bit about me like I said

48
00:01:43,619 --> 00:01:45,479
um I don't have mac malware history but

49
00:01:45,479 --> 00:01:47,159
I used to work at Lookout so I did focus

50
00:01:47,159 --> 00:01:49,020
on Android surveillance where Android

51
00:01:49,020 --> 00:01:50,759
malware analysis and I was on the threat

52
00:01:50,759 --> 00:01:52,140
intelligence team so tracking those

53
00:01:52,140 --> 00:01:54,299
actors and now I work at sofos and

54
00:01:54,299 --> 00:01:55,799
product for incident response and threat

55
00:01:55,799 --> 00:01:57,600
intelligence but how we're going to

56
00:01:57,600 --> 00:01:59,579
structure this talk I want to just go

57
00:01:59,579 --> 00:02:01,140
into some key concepts for malware

58
00:02:01,140 --> 00:02:03,000
analysis in general

59
00:02:03,000 --> 00:02:04,439
um you know not just Mac related some

60
00:02:04,439 --> 00:02:06,000
common questions that you'll run into

61
00:02:06,000 --> 00:02:07,799
when you're analyzing things and it's

62
00:02:07,799 --> 00:02:09,239
kind of like a running mental checklist

63
00:02:09,239 --> 00:02:10,500
to keep in your head when you're looking

64
00:02:10,500 --> 00:02:12,060
at malware to just structure your

65
00:02:12,060 --> 00:02:13,680
investigation

66
00:02:13,680 --> 00:02:15,120
um and then say taking those base

67
00:02:15,120 --> 00:02:16,920
Concepts in the basic analysis methods

68
00:02:16,920 --> 00:02:18,660
and how you find those and applying it

69
00:02:18,660 --> 00:02:20,220
to Mac so like what does Mac malware

70
00:02:20,220 --> 00:02:21,959
look like how do you dive in what are

71
00:02:21,959 --> 00:02:23,160
some challenges you might come across

72
00:02:23,160 --> 00:02:24,959
and then at the end just general

73
00:02:24,959 --> 00:02:27,480
resources tooling like time commitments

74
00:02:27,480 --> 00:02:29,520
we're all busy full-time jobs students

75
00:02:29,520 --> 00:02:30,720
whatever you know how much time does it

76
00:02:30,720 --> 00:02:31,920
actually take to kind of learn this

77
00:02:31,920 --> 00:02:33,660
skill set

78
00:02:33,660 --> 00:02:36,420
so key Concepts if you're trying to

79
00:02:36,420 --> 00:02:38,280
analyze malware or any type of malware

80
00:02:38,280 --> 00:02:39,959
in general what are some things you have

81
00:02:39,959 --> 00:02:41,940
to know and it can get a little

82
00:02:41,940 --> 00:02:43,140
frustrating because you have all these

83
00:02:43,140 --> 00:02:44,760
available tutorials that say like you

84
00:02:44,760 --> 00:02:46,500
know go just dive in

85
00:02:46,500 --> 00:02:47,940
um you're analyzing you're doing X Y and

86
00:02:47,940 --> 00:02:49,200
Z all these things but unless you

87
00:02:49,200 --> 00:02:50,459
actually know what you're trying to get

88
00:02:50,459 --> 00:02:52,680
out of it you can end up down all these

89
00:02:52,680 --> 00:02:54,000
different rabbit holes that make things

90
00:02:54,000 --> 00:02:55,620
way too complex maybe you're looking at

91
00:02:55,620 --> 00:02:57,420
code that is frustrating you and

92
00:02:57,420 --> 00:02:59,160
actually and has nothing to do with what

93
00:02:59,160 --> 00:03:01,019
you actually wanted to know

94
00:03:01,019 --> 00:03:02,700
um or like the resources you're reading

95
00:03:02,700 --> 00:03:04,260
like you're like yes I get you know

96
00:03:04,260 --> 00:03:06,000
conceptually what you're saying but I'm

97
00:03:06,000 --> 00:03:07,739
not sure how to apply it

98
00:03:07,739 --> 00:03:09,180
um so make sure you know your angles are

99
00:03:09,180 --> 00:03:11,099
there like are you working an incident

100
00:03:11,099 --> 00:03:13,379
response and maybe you have uh you know

101
00:03:13,379 --> 00:03:14,760
indicators saying that there's this one

102
00:03:14,760 --> 00:03:16,680
file that's the cause of this issue and

103
00:03:16,680 --> 00:03:18,300
you just want to know quickly like what

104
00:03:18,300 --> 00:03:19,980
is it did it spread how do I get it off

105
00:03:19,980 --> 00:03:22,620
like that's something or maybe you're on

106
00:03:22,620 --> 00:03:23,940
threat intelligence where you're going

107
00:03:23,940 --> 00:03:25,319
to die of maybe a little more into the

108
00:03:25,319 --> 00:03:27,120
code but you're trying to figure out not

109
00:03:27,120 --> 00:03:29,040
only what it can do but you know what

110
00:03:29,040 --> 00:03:30,959
infrastructure is it talking to like do

111
00:03:30,959 --> 00:03:32,459
we know anything about it can we Trace

112
00:03:32,459 --> 00:03:33,959
that infrastructure to a specific big

113
00:03:33,959 --> 00:03:35,159
threat actor or like you know a

114
00:03:35,159 --> 00:03:36,900
different adversary or have we been

115
00:03:36,900 --> 00:03:38,519
following this code for a while and you

116
00:03:38,519 --> 00:03:39,780
know we've seen how it's evolving over

117
00:03:39,780 --> 00:03:41,040
the years and they're implementing new

118
00:03:41,040 --> 00:03:42,780
functionalities they they know people

119
00:03:42,780 --> 00:03:44,099
are analyzing the code they're trying to

120
00:03:44,099 --> 00:03:45,420
like hide the new functionalities or

121
00:03:45,420 --> 00:03:47,340
change up their infrastructure

122
00:03:47,340 --> 00:03:49,440
um so from the start I think you should

123
00:03:49,440 --> 00:03:51,000
Define like what you're trying to get

124
00:03:51,000 --> 00:03:52,080
out of it like are you going to be in

125
00:03:52,080 --> 00:03:53,580
the weeds and doing this big technical

126
00:03:53,580 --> 00:03:55,319
write-up or you just want to know bad

127
00:03:55,319 --> 00:03:57,420
get it off this is what we're doing

128
00:03:57,420 --> 00:03:59,220
um and so that said to Define your goals

129
00:03:59,220 --> 00:04:00,360
these are just some of the common

130
00:04:00,360 --> 00:04:01,739
questions that I think you should keep

131
00:04:01,739 --> 00:04:02,700
in mind

132
00:04:02,700 --> 00:04:04,560
um you know infection Vector how did it

133
00:04:04,560 --> 00:04:05,819
get on there in the first place are

134
00:04:05,819 --> 00:04:07,200
there going to be any indicators in the

135
00:04:07,200 --> 00:04:09,120
malware that you know a user willingly

136
00:04:09,120 --> 00:04:11,159
downloaded it was it in an app store was

137
00:04:11,159 --> 00:04:12,540
it you know do you need physical device

138
00:04:12,540 --> 00:04:14,459
access and someone has to plug a USB in

139
00:04:14,459 --> 00:04:16,320
to install this malware

140
00:04:16,320 --> 00:04:18,238
um capabilities like what is it doing is

141
00:04:18,238 --> 00:04:20,220
it you know financially motivated is it

142
00:04:20,220 --> 00:04:22,380
surveillance where is it good at it you

143
00:04:22,380 --> 00:04:23,759
know is it trying to hide like is it

144
00:04:23,759 --> 00:04:25,919
looking for antivirus before it installs

145
00:04:25,919 --> 00:04:28,080
um you know how smart is it and then

146
00:04:28,080 --> 00:04:30,360
also persistence you know it might be on

147
00:04:30,360 --> 00:04:32,220
there but it's you know is it going to

148
00:04:32,220 --> 00:04:34,380
run every time a user logs in is it you

149
00:04:34,380 --> 00:04:35,759
know does it have a remote delete switch

150
00:04:35,759 --> 00:04:37,139
is someone going to delete it eventually

151
00:04:37,139 --> 00:04:38,520
so no one can be discovered how well

152
00:04:38,520 --> 00:04:40,500
does it persist and then you know

153
00:04:40,500 --> 00:04:42,660
infrastructure and attribution so if

154
00:04:42,660 --> 00:04:44,460
it's exfil trading data or if it's

155
00:04:44,460 --> 00:04:46,080
looking for a second stage or looking

156
00:04:46,080 --> 00:04:47,759
for a download you know what is that and

157
00:04:47,759 --> 00:04:48,720
then can you also tie that

158
00:04:48,720 --> 00:04:50,639
infrastructure to any particular threat

159
00:04:50,639 --> 00:04:51,840
actor or Persona that you might be

160
00:04:51,840 --> 00:04:54,240
following so that's how I tend to look

161
00:04:54,240 --> 00:04:55,440
at things from a threat intelligence

162
00:04:55,440 --> 00:04:56,639
side of things and you know to each

163
00:04:56,639 --> 00:04:57,780
their own and what they're trying to do

164
00:04:57,780 --> 00:04:59,759
out of this but that's kind of how I

165
00:04:59,759 --> 00:05:01,560
will make the questions I keep in the

166
00:05:01,560 --> 00:05:02,639
back of my head when I'm going through

167
00:05:02,639 --> 00:05:04,620
it and then when you're doing analysis

168
00:05:04,620 --> 00:05:06,360
you have two different methods you have

169
00:05:06,360 --> 00:05:09,060
static and dynamic analysis so static

170
00:05:09,060 --> 00:05:10,919
analysis it's really just you know

171
00:05:10,919 --> 00:05:12,300
you're not running the file you're just

172
00:05:12,300 --> 00:05:14,040
looking at it and this can be really

173
00:05:14,040 --> 00:05:16,800
high level you know I can read some

174
00:05:16,800 --> 00:05:18,000
scripts that they have installed you

175
00:05:18,000 --> 00:05:19,320
know I can access it through the command

176
00:05:19,320 --> 00:05:21,360
line or you can take the binary and look

177
00:05:21,360 --> 00:05:22,740
at it in a disassembler you're getting

178
00:05:22,740 --> 00:05:24,720
into assembly code or you can have

179
00:05:24,720 --> 00:05:26,520
Dynamic analysis where you set up a

180
00:05:26,520 --> 00:05:28,919
proper analysis environment you know and

181
00:05:28,919 --> 00:05:30,360
you're actively running the malware

182
00:05:30,360 --> 00:05:32,280
either you have a burner device or you

183
00:05:32,280 --> 00:05:34,080
know you're on an emulator running it

184
00:05:34,080 --> 00:05:35,520
but you can capture you know the network

185
00:05:35,520 --> 00:05:37,440
traffic what's it talking to you can see

186
00:05:37,440 --> 00:05:39,419
live what it's doing

187
00:05:39,419 --> 00:05:41,400
um but again in 25 minutes how do you

188
00:05:41,400 --> 00:05:42,840
like get the most out of this we're not

189
00:05:42,840 --> 00:05:44,460
going to do Dynamic analysis really or

190
00:05:44,460 --> 00:05:46,259
like in the binary stuff but just

191
00:05:46,259 --> 00:05:48,539
working smarter like how can you get at

192
00:05:48,539 --> 00:05:50,220
an entry level good information out of

193
00:05:50,220 --> 00:05:53,160
malware so if we've defined our goal we

194
00:05:53,160 --> 00:05:55,320
can theoretically do that so in terms of

195
00:05:55,320 --> 00:05:57,000
setting up your environment

196
00:05:57,000 --> 00:05:59,039
I was debating how much time to spend on

197
00:05:59,039 --> 00:06:00,660
this but I actually have run into more

198
00:06:00,660 --> 00:06:01,740
people who actually ran into the

199
00:06:01,740 --> 00:06:03,060
problems I did as well so I don't feel

200
00:06:03,060 --> 00:06:05,280
as stupid about this but setting up an

201
00:06:05,280 --> 00:06:07,560
analysis environment you know you set up

202
00:06:07,560 --> 00:06:09,060
a VM everyone's like great fine and

203
00:06:09,060 --> 00:06:10,919
dandy but one of the problems I ran into

204
00:06:10,919 --> 00:06:13,440
is I have now an M1 Mac I used to have

205
00:06:13,440 --> 00:06:15,180
an x86 Mac and so I was trying to

206
00:06:15,180 --> 00:06:17,820
install a VM for an M1 and that just it

207
00:06:17,820 --> 00:06:19,259
took me like eight hours to figure this

208
00:06:19,259 --> 00:06:21,000
out and I won't say that so no one else

209
00:06:21,000 --> 00:06:22,259
feels silly if they're trying to set up

210
00:06:22,259 --> 00:06:24,479
an environment but um so what was

211
00:06:24,479 --> 00:06:25,979
happening you know there's VMware

212
00:06:25,979 --> 00:06:27,720
virtualbox parallels

213
00:06:27,720 --> 00:06:30,300
yay parallels we love parallels

214
00:06:30,300 --> 00:06:31,979
um but what happened was I was trying to

215
00:06:31,979 --> 00:06:34,080
set it up and I you know I'd use VMware

216
00:06:34,080 --> 00:06:35,639
before so I was like let's try and do

217
00:06:35,639 --> 00:06:37,500
that there's Forum talk of like they can

218
00:06:37,500 --> 00:06:39,840
run it on an M1 I was trying

219
00:06:39,840 --> 00:06:41,520
um I couldn't pull the ISO from my

220
00:06:41,520 --> 00:06:42,960
application folder which is supposedly

221
00:06:42,960 --> 00:06:44,819
where you could so I was like all right

222
00:06:44,819 --> 00:06:46,560
let's you know convert the Monterey

223
00:06:46,560 --> 00:06:49,199
installer into an ISO file and then try

224
00:06:49,199 --> 00:06:51,240
and then set it up but apparently VMware

225
00:06:51,240 --> 00:06:53,160
only goes up to like v11 and Monterey is

226
00:06:53,160 --> 00:06:55,979
a 12. so next step okay what could I do

227
00:06:55,979 --> 00:06:57,479
since that didn't work I was like well

228
00:06:57,479 --> 00:06:59,880
let me try and get an older version of

229
00:06:59,880 --> 00:07:01,860
Mac because then I could set up a VM

230
00:07:01,860 --> 00:07:04,560
that way and that led me to find out a

231
00:07:04,560 --> 00:07:06,600
bit about like the invisible guide rails

232
00:07:06,600 --> 00:07:08,160
that Matt kind of has in place for user

233
00:07:08,160 --> 00:07:10,800
security like on the new m1s like I have

234
00:07:10,800 --> 00:07:13,919
a 2020 and a 2021 Pro and mac and

235
00:07:13,919 --> 00:07:16,139
MacBook Air and I wasn't able to

236
00:07:16,139 --> 00:07:18,060
download any of the older versions

237
00:07:18,060 --> 00:07:19,800
whereas my co-worker who had an old Mac

238
00:07:19,800 --> 00:07:21,240
was like I can download These Fine from

239
00:07:21,240 --> 00:07:23,699
the Apple Store so because my next

240
00:07:23,699 --> 00:07:24,720
option there would have been like to

241
00:07:24,720 --> 00:07:27,120
create an older VM but that got me

242
00:07:27,120 --> 00:07:29,099
thinking about just kind of basic

243
00:07:29,099 --> 00:07:31,319
security controls and mac and apple have

244
00:07:31,319 --> 00:07:33,240
really set up a system which I call like

245
00:07:33,240 --> 00:07:35,160
they Define it they want explicit user

246
00:07:35,160 --> 00:07:36,599
interaction like there's a reason

247
00:07:36,599 --> 00:07:37,919
they're upgrading things they don't want

248
00:07:37,919 --> 00:07:39,539
you downgrading to an older system they

249
00:07:39,539 --> 00:07:40,919
found bugs they found security issues

250
00:07:40,919 --> 00:07:42,479
they're patching they're fixing it so

251
00:07:42,479 --> 00:07:43,860
they would naturally make it very hard

252
00:07:43,860 --> 00:07:46,080
for you to install older versions that

253
00:07:46,080 --> 00:07:48,599
have problems which is good but also in

254
00:07:48,599 --> 00:07:49,979
this like research perspective it was

255
00:07:49,979 --> 00:07:52,020
getting a little bit frustrating

256
00:07:52,020 --> 00:07:54,300
um so but I think that's important to

257
00:07:54,300 --> 00:07:56,580
note because you have these invisible

258
00:07:56,580 --> 00:07:58,500
guard rails where you know file

259
00:07:58,500 --> 00:08:00,419
quarantine will tell a user like you

260
00:08:00,419 --> 00:08:01,919
have to specifically say you downloaded

261
00:08:01,919 --> 00:08:03,599
this from the internet like do you want

262
00:08:03,599 --> 00:08:05,699
to open this or gatekeeper will check

263
00:08:05,699 --> 00:08:07,500
code signing information and if there's

264
00:08:07,500 --> 00:08:09,479
not a valid ID like it won't run it they

265
00:08:09,479 --> 00:08:10,860
have a lot of malware mitigation like

266
00:08:10,860 --> 00:08:12,900
built in which is very useful compared

267
00:08:12,900 --> 00:08:13,979
to like you know when I used to do

268
00:08:13,979 --> 00:08:15,419
Android stuff there's a billion

269
00:08:15,419 --> 00:08:17,340
third-party app stores you know you can

270
00:08:17,340 --> 00:08:19,259
have falsified signers like there's it's

271
00:08:19,259 --> 00:08:21,360
a lot harder to control

272
00:08:21,360 --> 00:08:22,560
um but so I think that's something to

273
00:08:22,560 --> 00:08:23,699
keep in mind because when you're looking

274
00:08:23,699 --> 00:08:25,680
at math malware if you flip it on its

275
00:08:25,680 --> 00:08:27,539
head of how an adversary is going to

276
00:08:27,539 --> 00:08:28,979
think about creating this malware they

277
00:08:28,979 --> 00:08:30,660
have to deal with this ecosystem of

278
00:08:30,660 --> 00:08:32,458
getting a user to either click and

279
00:08:32,458 --> 00:08:34,260
accept and give permissions or to how do

280
00:08:34,260 --> 00:08:36,240
they get it to download what you know

281
00:08:36,240 --> 00:08:37,740
infection Vector can they go through if

282
00:08:37,740 --> 00:08:38,820
it's not going to make it into the

283
00:08:38,820 --> 00:08:40,380
official Apple store which rarely

284
00:08:40,380 --> 00:08:42,120
sometimes they will but like it's a lot

285
00:08:42,120 --> 00:08:43,919
harder so just kind of thinking on it

286
00:08:43,919 --> 00:08:45,660
that way that was good to know

287
00:08:45,660 --> 00:08:47,640
but then check number two after like

288
00:08:47,640 --> 00:08:50,160
hour 10 my friend goes try parallels and

289
00:08:50,160 --> 00:08:52,140
I highly highly recommend parallels VM

290
00:08:52,140 --> 00:08:54,360
because it truly was like two clicks VM

291
00:08:54,360 --> 00:08:56,580
up and running in like two minutes so if

292
00:08:56,580 --> 00:08:57,660
you have an M1 or if you're just looking

293
00:08:57,660 --> 00:08:59,880
for something easier I'm not pitching

294
00:08:59,880 --> 00:09:01,200
them but like it worked they have a 14

295
00:09:01,200 --> 00:09:02,519
day free trial and then it's like 100

296
00:09:02,519 --> 00:09:03,720
bucks

297
00:09:03,720 --> 00:09:05,820
so uh what does Mac malware actually

298
00:09:05,820 --> 00:09:07,440
look like

299
00:09:07,440 --> 00:09:09,480
when you open it up

300
00:09:09,480 --> 00:09:10,860
um you have some basic folders that

301
00:09:10,860 --> 00:09:12,720
you'll typically inside of it so in the

302
00:09:12,720 --> 00:09:14,459
contents folder you have your code

303
00:09:14,459 --> 00:09:17,640
signature your info.plist your resources

304
00:09:17,640 --> 00:09:21,060
and a Mac OS folder and I kind of divide

305
00:09:21,060 --> 00:09:23,940
these files into two types so you have

306
00:09:23,940 --> 00:09:26,160
like binary and non-binary files and I

307
00:09:26,160 --> 00:09:27,480
know everything technically is like a

308
00:09:27,480 --> 00:09:30,000
binary file but by binary file in Mac OS

309
00:09:30,000 --> 00:09:31,440
I mean like stuff that's not easily

310
00:09:31,440 --> 00:09:33,180
human readable like it's an assembly

311
00:09:33,180 --> 00:09:35,100
you're going to put it in either ghidra

312
00:09:35,100 --> 00:09:36,240
something with that to deal with it

313
00:09:36,240 --> 00:09:39,540
versus the top three they're very easily

314
00:09:39,540 --> 00:09:41,339
read they're like scripts you can read

315
00:09:41,339 --> 00:09:42,480
them in the command line in a text

316
00:09:42,480 --> 00:09:45,060
editor something like that and so code

317
00:09:45,060 --> 00:09:47,220
signature if this file is there it means

318
00:09:47,220 --> 00:09:49,560
it was signed by a developer so it's

319
00:09:49,560 --> 00:09:50,940
always interesting to look into you can

320
00:09:50,940 --> 00:09:52,740
see who made it maybe it's a Persona of

321
00:09:52,740 --> 00:09:53,580
someone you're going to be tracking

322
00:09:53,580 --> 00:09:55,019
maybe you can then use that to Pivot off

323
00:09:55,019 --> 00:09:56,580
of to see who else is like tied to this

324
00:09:56,580 --> 00:09:57,600
malware

325
00:09:57,600 --> 00:09:58,800
um you can create detection rules around

326
00:09:58,800 --> 00:10:01,820
information in there you have info.plist

327
00:10:01,820 --> 00:10:04,860
plist is a property list and so it's

328
00:10:04,860 --> 00:10:06,060
very important because when you launch

329
00:10:06,060 --> 00:10:07,920
Mac malware it has all metadata about

330
00:10:07,920 --> 00:10:10,620
apps stored in key value pairs so it's

331
00:10:10,620 --> 00:10:12,360
best if you it specifies different

332
00:10:12,360 --> 00:10:15,000
attributes of the app that you know can

333
00:10:15,000 --> 00:10:16,019
talk about the application's

334
00:10:16,019 --> 00:10:17,640
capabilities like what it can do another

335
00:10:17,640 --> 00:10:19,980
thing we're looking for and a lot of

336
00:10:19,980 --> 00:10:21,420
times malware authors will also Target

337
00:10:21,420 --> 00:10:23,880
p-list and info p list because if they

338
00:10:23,880 --> 00:10:25,980
modify the key value pairs they can

339
00:10:25,980 --> 00:10:28,200
influence system behaviors so pay

340
00:10:28,200 --> 00:10:30,000
attention to this if anything odd stands

341
00:10:30,000 --> 00:10:31,320
out in there as we'll get into in a bit

342
00:10:31,320 --> 00:10:33,720
like that's a good place to start and

343
00:10:33,720 --> 00:10:35,279
then the resources folder this is really

344
00:10:35,279 --> 00:10:37,019
just kind of like anything else that is

345
00:10:37,019 --> 00:10:38,220
in there so it could be scripts

346
00:10:38,220 --> 00:10:41,220
executables other files whatnot and then

347
00:10:41,220 --> 00:10:43,740
the Mac OS file and I've never said this

348
00:10:43,740 --> 00:10:45,420
out loud I think it's pronounced Mako

349
00:10:45,420 --> 00:10:49,260
Maco the form of the file format mac o

350
00:10:49,260 --> 00:10:51,180
um so that's also where the malware will

351
00:10:51,180 --> 00:10:52,380
be but I've only read it and never

352
00:10:52,380 --> 00:10:54,959
actually said it until now

353
00:10:54,959 --> 00:10:57,720
but so looking at just like an example

354
00:10:57,720 --> 00:10:59,160
of a file that I downloaded I got this

355
00:10:59,160 --> 00:11:00,720
hash you can download it from writers

356
00:11:00,720 --> 00:11:02,700
total it's on the objective-c website it

357
00:11:02,700 --> 00:11:04,019
was a recommended file to look at for

358
00:11:04,019 --> 00:11:05,940
analysis on a sentinel one tutorial for

359
00:11:05,940 --> 00:11:08,399
like looking into Mac malware

360
00:11:08,399 --> 00:11:09,899
um and so you can see in there you have

361
00:11:09,899 --> 00:11:11,459
if you break down you have your contents

362
00:11:11,459 --> 00:11:14,700
folder code signature Mac OS with the

363
00:11:14,700 --> 00:11:17,459
unpack NW which is the malware and then

364
00:11:17,459 --> 00:11:19,380
you know you in your resources folder

365
00:11:19,380 --> 00:11:21,660
you have unpack.txt and package

366
00:11:21,660 --> 00:11:24,300
information and a p list so going

367
00:11:24,300 --> 00:11:26,040
through at a higher level just like

368
00:11:26,040 --> 00:11:28,440
useful information starting again before

369
00:11:28,440 --> 00:11:30,300
you open Ida or anything what can you

370
00:11:30,300 --> 00:11:31,620
get out of the stuff that you have in

371
00:11:31,620 --> 00:11:33,140
front of you so for signing information

372
00:11:33,140 --> 00:11:35,220
and on the side I'm going to leave in

373
00:11:35,220 --> 00:11:37,380
some tips about just different command

374
00:11:37,380 --> 00:11:38,820
line tools that you can use when you're

375
00:11:38,820 --> 00:11:41,300
analyzing these things but so code sign

376
00:11:41,300 --> 00:11:43,620
you instantly get information off the

377
00:11:43,620 --> 00:11:45,959
bat of you know bundle identifier team

378
00:11:45,959 --> 00:11:47,640
identifier you can use those to create

379
00:11:47,640 --> 00:11:49,440
detection rules you might see something

380
00:11:49,440 --> 00:11:51,480
up there like developer application

381
00:11:51,480 --> 00:11:53,519
techyutil software if you're doing an

382
00:11:53,519 --> 00:11:55,320
ocean investigation maybe start digging

383
00:11:55,320 --> 00:11:57,839
in find out who's behind that there and

384
00:11:57,839 --> 00:11:59,640
then you also have something called

385
00:11:59,640 --> 00:12:02,760
sbctl where if you put it in you can see

386
00:12:02,760 --> 00:12:04,200
if the certificate from the signer was

387
00:12:04,200 --> 00:12:06,180
revoked or not and so we mentioned you

388
00:12:06,180 --> 00:12:07,680
know gatekeeper is going to be checking

389
00:12:07,680 --> 00:12:09,839
if there is signing information it will

390
00:12:09,839 --> 00:12:11,339
try and you know block applications that

391
00:12:11,339 --> 00:12:12,839
don't have a valid ID or if something's

392
00:12:12,839 --> 00:12:14,579
been revoked it's not going to run so

393
00:12:14,579 --> 00:12:16,260
it's better vote so either it's not

394
00:12:16,260 --> 00:12:18,120
going to run or maybe the malware author

395
00:12:18,120 --> 00:12:19,560
has like a workaround to try and get

396
00:12:19,560 --> 00:12:21,480
this going

397
00:12:21,480 --> 00:12:23,640
then you have your P list

398
00:12:23,640 --> 00:12:25,200
um so your property list with like key

399
00:12:25,200 --> 00:12:26,940
value pairs here

400
00:12:26,940 --> 00:12:28,260
um it'll highlight a lot of different

401
00:12:28,260 --> 00:12:29,100
things

402
00:12:29,100 --> 00:12:30,360
um maybe like the minimum software

403
00:12:30,360 --> 00:12:31,800
version that the malware is going to run

404
00:12:31,800 --> 00:12:33,600
on which can also be good for actor

405
00:12:33,600 --> 00:12:35,700
tracking of you know you know maybe what

406
00:12:35,700 --> 00:12:37,920
type of devices they're going after

407
00:12:37,920 --> 00:12:39,180
um but it also has settings as to how

408
00:12:39,180 --> 00:12:41,339
the malware itself is going to run so

409
00:12:41,339 --> 00:12:43,079
the one at the bottom that I highlighted

410
00:12:43,079 --> 00:12:45,779
lsui element this is an interesting

411
00:12:45,779 --> 00:12:47,519
thing to look at because if it's set to

412
00:12:47,519 --> 00:12:49,320
one that means the application is going

413
00:12:49,320 --> 00:12:50,880
to hide itself in the dock which

414
00:12:50,880 --> 00:12:52,079
instantly is like a little bit

415
00:12:52,079 --> 00:12:53,760
suspicious if I'm a valid you know

416
00:12:53,760 --> 00:12:55,200
application why do I need to hide myself

417
00:12:55,200 --> 00:12:57,300
and so in terms of kind of like

418
00:12:57,300 --> 00:12:58,680
checklist of things that you're looking

419
00:12:58,680 --> 00:13:00,839
for same with Android malware if I was

420
00:13:00,839 --> 00:13:02,399
focusing on surveillance where I'm

421
00:13:02,399 --> 00:13:03,839
interested in things that you know read

422
00:13:03,839 --> 00:13:05,700
your text activate your camera your

423
00:13:05,700 --> 00:13:08,279
geolocation hides its icon so same for

424
00:13:08,279 --> 00:13:10,680
malware you know I'll instantly add this

425
00:13:10,680 --> 00:13:12,180
to like my checklist of like if this

426
00:13:12,180 --> 00:13:13,980
element is set to one that's a red flag

427
00:13:13,980 --> 00:13:15,120
and maybe I should keep digging because

428
00:13:15,120 --> 00:13:17,220
it's hiding itself

429
00:13:17,220 --> 00:13:18,959
um and also they can alter this file to

430
00:13:18,959 --> 00:13:20,579
improve their persistence and we'll get

431
00:13:20,579 --> 00:13:22,740
into some specific examples later but

432
00:13:22,740 --> 00:13:23,880
basically some different types of

433
00:13:23,880 --> 00:13:25,920
malware will add key value pairs to the

434
00:13:25,920 --> 00:13:28,440
list um to you know restart every time a

435
00:13:28,440 --> 00:13:29,880
user logs in

436
00:13:29,880 --> 00:13:31,920
um and so definitely if you see a p list

437
00:13:31,920 --> 00:13:34,260
like look at it in malware or in Mac

438
00:13:34,260 --> 00:13:36,480
malware analysis

439
00:13:36,480 --> 00:13:38,880
and then for resources this is going to

440
00:13:38,880 --> 00:13:40,920
vary depending on whatever malware that

441
00:13:40,920 --> 00:13:42,240
you're looking at this sample in

442
00:13:42,240 --> 00:13:44,760
particular had a few things in it I like

443
00:13:44,760 --> 00:13:47,700
to start with lsla any hidden files if

444
00:13:47,700 --> 00:13:49,380
something is like a DOT whatever hidden

445
00:13:49,380 --> 00:13:50,459
sometimes people hide it that way

446
00:13:50,459 --> 00:13:52,680
that'll show it but it has something in

447
00:13:52,680 --> 00:13:56,100
there called unpack.txt and it instantly

448
00:13:56,100 --> 00:13:57,480
stands out because it's supposedly a

449
00:13:57,480 --> 00:13:58,920
text file but it has executable

450
00:13:58,920 --> 00:14:01,019
permissions so that doesn't really make

451
00:14:01,019 --> 00:14:03,839
sense and if you use a text editor or

452
00:14:03,839 --> 00:14:06,240
cat it'll show up as just like this big

453
00:14:06,240 --> 00:14:09,180
jumbled encrypted file basically another

454
00:14:09,180 --> 00:14:11,579
indicator that you know if it's this

455
00:14:11,579 --> 00:14:13,380
jumbled encrypted file that says it's a

456
00:14:13,380 --> 00:14:15,180
text file but has executable permissions

457
00:14:15,180 --> 00:14:17,040
maybe it's worth looking into later so

458
00:14:17,040 --> 00:14:18,480
when you do eventually open up the Macco

459
00:14:18,480 --> 00:14:21,660
file inside you know Ida or whatnot you

460
00:14:21,660 --> 00:14:23,579
can see I would look for is something

461
00:14:23,579 --> 00:14:26,399
referencing this unpack.txt is something

462
00:14:26,399 --> 00:14:28,560
going to decrypt something at some point

463
00:14:28,560 --> 00:14:30,420
because I know it's encrypted so you can

464
00:14:30,420 --> 00:14:31,980
kind of already without knowing exactly

465
00:14:31,980 --> 00:14:33,600
what it's doing you can start placing

466
00:14:33,600 --> 00:14:35,040
together the pieces that are going to be

467
00:14:35,040 --> 00:14:37,079
relevant

468
00:14:37,079 --> 00:14:39,300
um and then now on to what was in the

469
00:14:39,300 --> 00:14:43,380
Mac OS folder so the macro file so Macos

470
00:14:43,380 --> 00:14:45,060
um they're like an executable but for

471
00:14:45,060 --> 00:14:47,760
mac and so it has you know three

472
00:14:47,760 --> 00:14:49,740
different pieces a header commands and

473
00:14:49,740 --> 00:14:51,480
data and it comes in different

474
00:14:51,480 --> 00:14:53,880
architectures there's Universal and

475
00:14:53,880 --> 00:14:55,740
single and Universal is also called fat

476
00:14:55,740 --> 00:14:56,880
and I just thought this was funny

477
00:14:56,880 --> 00:14:58,199
because the tool you can use to figure

478
00:14:58,199 --> 00:14:59,699
out what architectures are inside of it

479
00:14:59,699 --> 00:15:01,620
is called lipo and so someone was like

480
00:15:01,620 --> 00:15:03,480
having fun naming this you can lipo the

481
00:15:03,480 --> 00:15:06,300
fat file and you can see what's in it

482
00:15:06,300 --> 00:15:08,699
um but so then you have your sequential

483
00:15:08,699 --> 00:15:10,079
parts of like what it's made up out of

484
00:15:10,079 --> 00:15:12,240
so your header tells you you know what

485
00:15:12,240 --> 00:15:15,420
it is and then you have your commands so

486
00:15:15,420 --> 00:15:18,360
when it's dynamically loaded into memory

487
00:15:18,360 --> 00:15:20,519
a good thing to keep in mind here is all

488
00:15:20,519 --> 00:15:21,899
these different commands like it'll be

489
00:15:21,899 --> 00:15:24,899
LC underscore and then whatever LC main

490
00:15:24,899 --> 00:15:26,279
is a good place to start because if you

491
00:15:26,279 --> 00:15:28,139
dump it into like Ida you'll be like

492
00:15:28,139 --> 00:15:29,699
where do I start like right there is

493
00:15:29,699 --> 00:15:30,660
usually where you can begin your

494
00:15:30,660 --> 00:15:32,220
analysis

495
00:15:32,220 --> 00:15:33,779
um and then it's also broken in the data

496
00:15:33,779 --> 00:15:35,940
piece broken down into underscore text

497
00:15:35,940 --> 00:15:37,980
and underscore data and so I'll give an

498
00:15:37,980 --> 00:15:39,360
example of what that looks like because

499
00:15:39,360 --> 00:15:40,980
again before you even have to get into

500
00:15:40,980 --> 00:15:42,720
assembly you can still get a lot of high

501
00:15:42,720 --> 00:15:44,399
level information just from these files

502
00:15:44,399 --> 00:15:46,380
like in the terminal

503
00:15:46,380 --> 00:15:50,339
so the data section or the so the data

504
00:15:50,339 --> 00:15:51,959
section and we're in underscore text

505
00:15:51,959 --> 00:15:55,019
this has all of the executable functions

506
00:15:55,019 --> 00:15:57,300
and methods inside the malware and a lot

507
00:15:57,300 --> 00:15:59,040
of the times actors are sloppy and don't

508
00:15:59,040 --> 00:16:00,839
change the names of what the commands

509
00:16:00,839 --> 00:16:03,600
can actually do you know it'll if it's

510
00:16:03,600 --> 00:16:05,820
saying right there that it says silently

511
00:16:05,820 --> 00:16:08,519
fire URL or encrypt decrypt string like

512
00:16:08,519 --> 00:16:09,660
they haven't changed these names like

513
00:16:09,660 --> 00:16:11,220
you're not like that annoying author

514
00:16:11,220 --> 00:16:13,199
who's labeled everything a b c d e so

515
00:16:13,199 --> 00:16:14,279
you have no idea what's in it until you

516
00:16:14,279 --> 00:16:15,480
go through it

517
00:16:15,480 --> 00:16:16,920
um so just off the bat this gives you

518
00:16:16,920 --> 00:16:18,959
like some good strings to look into some

519
00:16:18,959 --> 00:16:20,760
capabilities that you think might exist

520
00:16:20,760 --> 00:16:22,560
without you know actually fully diving

521
00:16:22,560 --> 00:16:23,880
in yet

522
00:16:23,880 --> 00:16:26,160
um and that brings me to my next tip of

523
00:16:26,160 --> 00:16:28,440
like strings analysis

524
00:16:28,440 --> 00:16:30,600
so you can view all the strings in

525
00:16:30,600 --> 00:16:32,279
malware by just like running strings in

526
00:16:32,279 --> 00:16:34,019
your terminal or you can use floss which

527
00:16:34,019 --> 00:16:35,880
is the tool on GitHub and it

528
00:16:35,880 --> 00:16:37,920
de-obfuscates strings so that makes it a

529
00:16:37,920 --> 00:16:39,120
lot easier too because sometimes with

530
00:16:39,120 --> 00:16:40,740
strings you'll just get like a jumbled

531
00:16:40,740 --> 00:16:43,259
list of strings if the author has like

532
00:16:43,259 --> 00:16:45,120
you know put in any obfuscation attempts

533
00:16:45,120 --> 00:16:48,240
but basically there's also some strings

534
00:16:48,240 --> 00:16:50,100
you can think of that might be good

535
00:16:50,100 --> 00:16:51,480
hunting points again if you're talking

536
00:16:51,480 --> 00:16:53,399
about like capabilities and like

537
00:16:53,399 --> 00:16:54,959
malicious capabilities like what it

538
00:16:54,959 --> 00:16:56,279
might do

539
00:16:56,279 --> 00:16:58,019
um so the black on the right those are

540
00:16:58,019 --> 00:16:59,399
just some examples of like what strings

541
00:16:59,399 --> 00:17:01,019
look like and I think of it in two

542
00:17:01,019 --> 00:17:03,000
different ways from strings for

543
00:17:03,000 --> 00:17:05,640
capability uncovery as well as strings

544
00:17:05,640 --> 00:17:08,819
for uh coverage creation or you know

545
00:17:08,819 --> 00:17:10,740
better understanding of if other samples

546
00:17:10,740 --> 00:17:12,900
exist and who it might be tied to so for

547
00:17:12,900 --> 00:17:14,459
example from one of these strings I just

548
00:17:14,459 --> 00:17:16,740
put it into virus total and I found that

549
00:17:16,740 --> 00:17:18,119
from the one sample I was looking at

550
00:17:18,119 --> 00:17:19,500
there were three other samples that had

551
00:17:19,500 --> 00:17:21,059
this exact same really weird unique

552
00:17:21,059 --> 00:17:22,980
string so very likely done by the same

553
00:17:22,980 --> 00:17:24,480
developer and then where you can

554
00:17:24,480 --> 00:17:26,579
continue pivoting and expanding is if

555
00:17:26,579 --> 00:17:28,980
those other two new samples also had

556
00:17:28,980 --> 00:17:30,419
different signers then you now not only

557
00:17:30,419 --> 00:17:32,040
have one hash and one signer but you

558
00:17:32,040 --> 00:17:33,179
have two other hashes with two different

559
00:17:33,179 --> 00:17:35,400
signers that you can all tie into being

560
00:17:35,400 --> 00:17:37,020
connected to like the same author so if

561
00:17:37,020 --> 00:17:38,160
you're tracking this person you can see

562
00:17:38,160 --> 00:17:39,720
what they're doing you know and then if

563
00:17:39,720 --> 00:17:41,700
you see what they're masquerading as is

564
00:17:41,700 --> 00:17:43,559
it masquerading as a word download is it

565
00:17:43,559 --> 00:17:44,880
masquerading as like a books download

566
00:17:44,880 --> 00:17:47,160
you can see and get a better idea of

567
00:17:47,160 --> 00:17:48,539
like who they're potentially targeting

568
00:17:48,539 --> 00:17:49,620
how they're trying to get people to

569
00:17:49,620 --> 00:17:52,440
install them is it Adobe whatever so

570
00:17:52,440 --> 00:17:54,240
that's one way to look at strings

571
00:17:54,240 --> 00:17:55,500
but then the other way to look at

572
00:17:55,500 --> 00:17:56,700
strings

573
00:17:56,700 --> 00:17:58,620
um there's a few that stand out as like

574
00:17:58,620 --> 00:18:00,120
potentially being malicious or

575
00:18:00,120 --> 00:18:03,539
indicating suspicious activity so the

576
00:18:03,539 --> 00:18:06,000
file exists at is it checking if there's

577
00:18:06,000 --> 00:18:07,860
an antivirus in play you know malware is

578
00:18:07,860 --> 00:18:10,860
known to use the string for this API to

579
00:18:10,860 --> 00:18:12,059
essentially say

580
00:18:12,059 --> 00:18:14,940
it'll use this to check if x antivirus

581
00:18:14,940 --> 00:18:16,320
is on this device and if it is they

582
00:18:16,320 --> 00:18:17,480
don't want to run

583
00:18:17,480 --> 00:18:20,280
and then you also have authorization

584
00:18:20,280 --> 00:18:22,919
execute with privileges

585
00:18:22,919 --> 00:18:24,360
um and so we talked again about Apple

586
00:18:24,360 --> 00:18:26,280
having these very user-driven

587
00:18:26,280 --> 00:18:27,840
interactions where every time you

588
00:18:27,840 --> 00:18:29,460
download something if it hasn't accessed

589
00:18:29,460 --> 00:18:31,799
it before it'll be like X wants access

590
00:18:31,799 --> 00:18:34,080
to your desktop x1's asked and you like

591
00:18:34,080 --> 00:18:35,640
accept accept or like you put in your

592
00:18:35,640 --> 00:18:37,200
password how many times if Apple pops

593
00:18:37,200 --> 00:18:38,220
something up

594
00:18:38,220 --> 00:18:40,860
um this will raise that so if a user is

595
00:18:40,860 --> 00:18:42,419
kind of like not paying attention or fed

596
00:18:42,419 --> 00:18:44,039
up with all the Apple security pop-ups

597
00:18:44,039 --> 00:18:45,960
they might inadvertently like give the

598
00:18:45,960 --> 00:18:47,400
malware permissions and type in their

599
00:18:47,400 --> 00:18:49,080
password and you know username to give

600
00:18:49,080 --> 00:18:50,760
the right permissions so it can escalate

601
00:18:50,760 --> 00:18:52,200
through that

602
00:18:52,200 --> 00:18:53,880
um and then these last two you know LS

603
00:18:53,880 --> 00:18:55,799
shared file list create and file list

604
00:18:55,799 --> 00:18:57,840
insert item they can be used to add

605
00:18:57,840 --> 00:19:00,720
login items so another way for malware

606
00:19:00,720 --> 00:19:02,340
to gain persistence and ensure that the

607
00:19:02,340 --> 00:19:03,840
application will be restarted every time

608
00:19:03,840 --> 00:19:06,480
the user logs in and so again you can

609
00:19:06,480 --> 00:19:08,400
get all of this before even figuring out

610
00:19:08,400 --> 00:19:10,140
where it is in the assembly code if so I

611
00:19:10,140 --> 00:19:11,400
would just say like maybe look for these

612
00:19:11,400 --> 00:19:13,020
things and if they exist then you start

613
00:19:13,020 --> 00:19:14,580
trying to dive down these rabbit holes

614
00:19:14,580 --> 00:19:15,960
because you know what might be behind

615
00:19:15,960 --> 00:19:17,520
them

616
00:19:17,520 --> 00:19:19,919
and then the last one again with the p

617
00:19:19,919 --> 00:19:22,559
list login items login and logout hook

618
00:19:22,559 --> 00:19:24,960
you can only have one hook at a time so

619
00:19:24,960 --> 00:19:27,059
sometimes people will add additional

620
00:19:27,059 --> 00:19:28,799
commands to an existing login hook or

621
00:19:28,799 --> 00:19:31,320
alter them so you know I would just say

622
00:19:31,320 --> 00:19:33,059
be aware of like what the hooks are in a

623
00:19:33,059 --> 00:19:34,559
p list because it's a common place where

624
00:19:34,559 --> 00:19:35,880
people might try and change it to gain

625
00:19:35,880 --> 00:19:38,480
persistence

626
00:19:38,520 --> 00:19:40,919
and then you have your other tools so

627
00:19:40,919 --> 00:19:42,360
that was very high level and here's just

628
00:19:42,360 --> 00:19:43,500
some information on like pricing and

629
00:19:43,500 --> 00:19:44,880
free trials if you wanted to dig into

630
00:19:44,880 --> 00:19:47,220
them but you know you can do a binary

631
00:19:47,220 --> 00:19:48,960
analysis you can do dynamically running

632
00:19:48,960 --> 00:19:50,940
things network analysis um you know you

633
00:19:50,940 --> 00:19:51,840
have your command line you have some

634
00:19:51,840 --> 00:19:53,400
tools with guise

635
00:19:53,400 --> 00:19:55,860
um the top the right hand side you know

636
00:19:55,860 --> 00:19:57,720
you have your disassemblers I've used

637
00:19:57,720 --> 00:20:00,360
idra and Ida before Hopper seems to be

638
00:20:00,360 --> 00:20:02,039
popular with like analyzing Mac malware

639
00:20:02,039 --> 00:20:03,299
cutter hadn't really heard of it much

640
00:20:03,299 --> 00:20:04,559
but it was also out there as like a

641
00:20:04,559 --> 00:20:07,080
recommended you know you can start with

642
00:20:07,080 --> 00:20:09,660
ghidra it's free I got lucky having Ida

643
00:20:09,660 --> 00:20:11,100
at my old job it's very expensive but

644
00:20:11,100 --> 00:20:12,360
you don't need an extensive tool to like

645
00:20:12,360 --> 00:20:14,039
dive into this

646
00:20:14,039 --> 00:20:16,020
um and then for network monitoring you

647
00:20:16,020 --> 00:20:17,340
know you have Wireshark you have

648
00:20:17,340 --> 00:20:19,200
netiquette which Patrick built um it's

649
00:20:19,200 --> 00:20:21,240
built for Mac it's kind of like a you

650
00:20:21,240 --> 00:20:23,460
know a wire tracker for Mac so if you're

651
00:20:23,460 --> 00:20:25,440
running something dynamically it kind of

652
00:20:25,440 --> 00:20:27,000
helps save a lot of time again if

653
00:20:27,000 --> 00:20:28,440
something is like obfuscated and you

654
00:20:28,440 --> 00:20:30,059
don't want to decrypt you know what the

655
00:20:30,059 --> 00:20:32,400
C2 is you can just run it and see what

656
00:20:32,400 --> 00:20:34,200
it's talking to or maybe run it and see

657
00:20:34,200 --> 00:20:36,240
if it's downloading X-File or X update

658
00:20:36,240 --> 00:20:38,640
and then command line tools again build

659
00:20:38,640 --> 00:20:40,380
by Objective C and Patrick you have

660
00:20:40,380 --> 00:20:42,840
process Monitor and file Monitor and

661
00:20:42,840 --> 00:20:44,640
again it watches for the creation of new

662
00:20:44,640 --> 00:20:46,679
processes and the creation of new files

663
00:20:46,679 --> 00:20:48,360
which is important because you can see

664
00:20:48,360 --> 00:20:49,799
what's running and then also sometimes

665
00:20:49,799 --> 00:20:51,840
if malware's Expo trading data we might

666
00:20:51,840 --> 00:20:53,820
make a new file move stuff to it zip it

667
00:20:53,820 --> 00:20:55,679
X fill it so just a good idea to

668
00:20:55,679 --> 00:20:57,179
understand if it's like adding or

669
00:20:57,179 --> 00:20:59,700
deleting files on your system

670
00:20:59,700 --> 00:21:01,860
and then another tool that is fairly

671
00:21:01,860 --> 00:21:03,720
useful if I first see something and I

672
00:21:03,720 --> 00:21:05,039
just want to overview I'll typically

673
00:21:05,039 --> 00:21:06,539
just type in like file in the command

674
00:21:06,539 --> 00:21:07,860
line to get a basic understanding of

675
00:21:07,860 --> 00:21:10,020
what it is but Patrick also made this

676
00:21:10,020 --> 00:21:12,120
where you can get an objective-c it

677
00:21:12,120 --> 00:21:14,220
shows you not only the file type in a

678
00:21:14,220 --> 00:21:16,140
higher degree of certainty because

679
00:21:16,140 --> 00:21:18,120
sometimes file description isn't always

680
00:21:18,120 --> 00:21:20,039
right from the command line but it also

681
00:21:20,039 --> 00:21:22,020
shows you signer information so you can

682
00:21:22,020 --> 00:21:23,520
just install it and then on anything

683
00:21:23,520 --> 00:21:26,160
right click view signing info and it

684
00:21:26,160 --> 00:21:27,960
gives you this nice little GUI pop-up so

685
00:21:27,960 --> 00:21:29,280
again if you're maybe not comfortable

686
00:21:29,280 --> 00:21:30,780
with the command line or if you wanted

687
00:21:30,780 --> 00:21:32,340
to enable people who are in a more

688
00:21:32,340 --> 00:21:33,900
salesy environment like have an

689
00:21:33,900 --> 00:21:35,580
understanding of what things can do you

690
00:21:35,580 --> 00:21:37,740
can just say use this tool and it's a

691
00:21:37,740 --> 00:21:40,320
nice visualization there

692
00:21:40,320 --> 00:21:43,140
so analysis challenges we're not going

693
00:21:43,140 --> 00:21:45,000
to get too in depth but obviously if

694
00:21:45,000 --> 00:21:46,320
you're a malware author you don't want

695
00:21:46,320 --> 00:21:47,460
people figuring out what you're doing

696
00:21:47,460 --> 00:21:48,780
and you want to hinder them because you

697
00:21:48,780 --> 00:21:49,799
want to make money or you want to steal

698
00:21:49,799 --> 00:21:51,720
data whatever it might be so they will

699
00:21:51,720 --> 00:21:54,360
try and hinder your analysis efforts and

700
00:21:54,360 --> 00:21:56,400
it can really be anything from string

701
00:21:56,400 --> 00:21:59,280
encryption or encoding base64 if you see

702
00:21:59,280 --> 00:22:00,900
it fantastic it's really easy you just

703
00:22:00,900 --> 00:22:02,640
like put it in an online decoder and you

704
00:22:02,640 --> 00:22:04,500
can figure it out but you know they

705
00:22:04,500 --> 00:22:07,020
might also break up their strings so

706
00:22:07,020 --> 00:22:08,880
that it doesn't show properly in a

707
00:22:08,880 --> 00:22:10,799
disassembler there's also different

708
00:22:10,799 --> 00:22:12,360
Packers they can use that really just

709
00:22:12,360 --> 00:22:14,820
kind of jumble the contents and Packers

710
00:22:14,820 --> 00:22:16,620
are interesting because there is a valid

711
00:22:16,620 --> 00:22:18,419
business use to use them sometimes like

712
00:22:18,419 --> 00:22:19,860
if you're developing a software and you

713
00:22:19,860 --> 00:22:21,840
don't want anyone reversing it and like

714
00:22:21,840 --> 00:22:24,000
making their own profit off of it or you

715
00:22:24,000 --> 00:22:25,679
know reversing it for their own gain you

716
00:22:25,679 --> 00:22:27,179
pack it to like hinder that analysis

717
00:22:27,179 --> 00:22:29,340
effort malware authors will also do the

718
00:22:29,340 --> 00:22:31,799
same thing and so Mac specifically the

719
00:22:31,799 --> 00:22:34,020
ones that I've found so far ipac muncho

720
00:22:34,020 --> 00:22:36,600
and 1K pack so those are some examples

721
00:22:36,600 --> 00:22:38,400
there

722
00:22:38,400 --> 00:22:40,860
and then just like resources and time

723
00:22:40,860 --> 00:22:43,080
commitments there's a lot more than I've

724
00:22:43,080 --> 00:22:44,880
listed here but these are the ones that

725
00:22:44,880 --> 00:22:46,740
I went through and it's like easily a

726
00:22:46,740 --> 00:22:48,059
thousand pages of reading and I read

727
00:22:48,059 --> 00:22:50,100
Patrick's book like three times but very

728
00:22:50,100 --> 00:22:51,360
good insights if you're trying to dive

729
00:22:51,360 --> 00:22:53,220
in but again like we all have lives and

730
00:22:53,220 --> 00:22:55,200
it can be you know where do I start what

731
00:22:55,200 --> 00:22:57,000
do I look at first if you already have a

732
00:22:57,000 --> 00:22:58,260
section that you're interested in go to

733
00:22:58,260 --> 00:22:59,820
the table of contents and find it but

734
00:22:59,820 --> 00:23:01,559
otherwise the way that I thought worked

735
00:23:01,559 --> 00:23:03,419
best for me was you know I broke the

736
00:23:03,419 --> 00:23:04,679
first book down it's in three different

737
00:23:04,679 --> 00:23:06,600
parts broken into four days because it

738
00:23:06,600 --> 00:23:07,860
gets a little more technical at the end

739
00:23:07,860 --> 00:23:09,480
then I spent a few days trying to

740
00:23:09,480 --> 00:23:10,799
implement what I learned then I went

741
00:23:10,799 --> 00:23:12,360
through all the footnotes and then I you

742
00:23:12,360 --> 00:23:14,460
know reread it going through it but if

743
00:23:14,460 --> 00:23:15,720
you're looking to just start you know

744
00:23:15,720 --> 00:23:18,360
the Sentinel one is really good small 39

745
00:23:18,360 --> 00:23:19,980
Pages you can break it into one or two

746
00:23:19,980 --> 00:23:22,320
days it's a good read lots of other

747
00:23:22,320 --> 00:23:23,640
resources out there and then if you want

748
00:23:23,640 --> 00:23:25,020
to truly keep getting like more and more

749
00:23:25,020 --> 00:23:27,000
technical there's you know intros to arm

750
00:23:27,000 --> 00:23:30,000
there's intros to assembly so you can

751
00:23:30,000 --> 00:23:32,520
just dive in that way but this overall

752
00:23:32,520 --> 00:23:34,260
was like I don't think it was as hard as

753
00:23:34,260 --> 00:23:35,460
I thought it would be

754
00:23:35,460 --> 00:23:36,780
um and I just don't want people to think

755
00:23:36,780 --> 00:23:37,679
that just because you don't know

756
00:23:37,679 --> 00:23:39,179
assembly well you can't get something

757
00:23:39,179 --> 00:23:40,980
out of analyzing Mac malware despite

758
00:23:40,980 --> 00:23:42,360
that you know being where you will do

759
00:23:42,360 --> 00:23:44,280
like the full analysis you can still get

760
00:23:44,280 --> 00:23:46,620
a lot just from a high level overview of

761
00:23:46,620 --> 00:23:48,120
like what's in it as soon as you unzip

762
00:23:48,120 --> 00:23:50,640
the file so um I don't know how much

763
00:23:50,640 --> 00:23:52,020
time we have left but I can take

764
00:23:52,020 --> 00:23:53,880
questions or that's really kind of my

765
00:23:53,880 --> 00:23:55,870
experience

766
00:23:55,870 --> 00:24:06,659
[Applause]

767
00:24:06,659 --> 00:24:08,340
sweet

768
00:24:08,340 --> 00:24:11,360
oh hey

769
00:24:21,179 --> 00:24:22,980
you need to sort of fail to make it

770
00:24:22,980 --> 00:24:25,140
easier for our new colors yeah so when I

771
00:24:25,140 --> 00:24:27,179
started I knew you could code and I

772
00:24:27,179 --> 00:24:28,500
didn't know where it went I was like

773
00:24:28,500 --> 00:24:30,179
what's a text editor like truly like to

774
00:24:30,179 --> 00:24:31,500
that level of like where does the code

775
00:24:31,500 --> 00:24:32,700
go

776
00:24:32,700 --> 00:24:35,580
um but I think you can

777
00:24:35,580 --> 00:24:37,380
there's two different gaps you need a

778
00:24:37,380 --> 00:24:38,520
bridge there there's Bridging the Gap

779
00:24:38,520 --> 00:24:40,080
between a basic understanding of like

780
00:24:40,080 --> 00:24:41,340
these are all the tools you should

781
00:24:41,340 --> 00:24:42,960
basically install in your system to

782
00:24:42,960 --> 00:24:45,900
understand what will get done like Vim

783
00:24:45,900 --> 00:24:47,820
or you know just Sublime Text something

784
00:24:47,820 --> 00:24:51,059
like that and then I think also then

785
00:24:51,059 --> 00:24:53,100
breaking it down mostly into

786
00:24:53,100 --> 00:24:55,260
if you know it exists we'll just do a

787
00:24:55,260 --> 00:24:56,940
high level there but then I think really

788
00:24:56,940 --> 00:24:58,200
taking the time I feel like a lot of

789
00:24:58,200 --> 00:25:00,000
times people just don't put in the

790
00:25:00,000 --> 00:25:02,280
effort to say like I've made all these

791
00:25:02,280 --> 00:25:03,299
mistakes like they'll put out great

792
00:25:03,299 --> 00:25:05,039
tutorials and you know they are easy to

793
00:25:05,039 --> 00:25:07,140
follow along but like I've been in

794
00:25:07,140 --> 00:25:09,179
security for six years and I will I'll

795
00:25:09,179 --> 00:25:11,039
say it took me like 10 hours to set up a

796
00:25:11,039 --> 00:25:12,960
VM on an M1 and like that's fine but no

797
00:25:12,960 --> 00:25:14,820
one wants to say that out loud so I

798
00:25:14,820 --> 00:25:17,039
think just kind of you know Bridging the

799
00:25:17,039 --> 00:25:19,020
Gap of like there should be a way to say

800
00:25:19,020 --> 00:25:21,419
here's what we work in here's what we

801
00:25:21,419 --> 00:25:23,039
work with and here's what we're working

802
00:25:23,039 --> 00:25:25,620
towards you could split it up that way

803
00:25:25,620 --> 00:25:26,580
um but there's a lot of good free

804
00:25:26,580 --> 00:25:28,620
tutorials where I think if you go to the

805
00:25:28,620 --> 00:25:30,059
authors of them they will take the time

806
00:25:30,059 --> 00:25:31,980
to like help you understand what you're

807
00:25:31,980 --> 00:25:33,419
missing there but just people being

808
00:25:33,419 --> 00:25:38,179
honest about you know where to start

809
00:25:40,640 --> 00:25:43,440
super helpful for introductory stuff so

810
00:25:43,440 --> 00:25:45,299
imagine you know someone's gone through

811
00:25:45,299 --> 00:25:47,340
this now they're have a pretty good

812
00:25:47,340 --> 00:25:49,500
foothold where would you tell them to go

813
00:25:49,500 --> 00:25:52,320
next and and how to do that is that

814
00:25:52,320 --> 00:25:54,480
um writing their own

815
00:25:54,480 --> 00:25:56,460
diving into specific topics and if it's

816
00:25:56,460 --> 00:25:58,679
that what topics kind of just yeah you

817
00:25:58,679 --> 00:26:00,120
give this talk tomorrow and it was like

818
00:26:00,120 --> 00:26:01,860
part two just give people a sense of

819
00:26:01,860 --> 00:26:03,299
what you would recommend it's like again

820
00:26:03,299 --> 00:26:04,860
like what are you doing are you

821
00:26:04,860 --> 00:26:06,779
responding to an incident where you want

822
00:26:06,779 --> 00:26:08,520
us to know how bad this malware was or

823
00:26:08,520 --> 00:26:10,140
what it do did it spread that's one

824
00:26:10,140 --> 00:26:12,360
level versus I missed my old job which I

825
00:26:12,360 --> 00:26:13,559
consider just like the pure joy of

826
00:26:13,559 --> 00:26:15,059
academic research and getting nosy and

827
00:26:15,059 --> 00:26:16,799
digging into infrastructure and like you

828
00:26:16,799 --> 00:26:18,299
accidentally left your LinkedIn profile

829
00:26:18,299 --> 00:26:19,620
up and I found out who you were and like

830
00:26:19,620 --> 00:26:21,659
pivoting to the full extent of malware

831
00:26:21,659 --> 00:26:23,460
capabilities to ownership and authorship

832
00:26:23,460 --> 00:26:25,380
and who the doctor was

833
00:26:25,380 --> 00:26:25,980
um

834
00:26:25,980 --> 00:26:27,840
do what if you're not doing it for work

835
00:26:27,840 --> 00:26:29,520
like what areas interest you the most

836
00:26:29,520 --> 00:26:31,620
like again I like being nosy and I'm

837
00:26:31,620 --> 00:26:33,000
more interested in like the ocean side

838
00:26:33,000 --> 00:26:34,440
of things so I want to know what the

839
00:26:34,440 --> 00:26:35,760
malware can do but then I'm more

840
00:26:35,760 --> 00:26:37,620
interested in like did you leave behind

841
00:26:37,620 --> 00:26:39,480
comments that you you know or did you

842
00:26:39,480 --> 00:26:40,679
comment something out in the code that

843
00:26:40,679 --> 00:26:42,659
made it through that could tell me who

844
00:26:42,659 --> 00:26:45,059
you were or is your infrastructure like

845
00:26:45,059 --> 00:26:46,860
your personal blog webpage and you can

846
00:26:46,860 --> 00:26:49,200
figure that out so again I think it just

847
00:26:49,200 --> 00:26:52,740
all depends what you're trying to do but

848
00:26:52,740 --> 00:26:54,960
um yeah just keep digging in like learn

849
00:26:54,960 --> 00:26:57,240
assembly I hate it it's I'm not good at

850
00:26:57,240 --> 00:26:59,220
it but like I'll say that too it's a

851
00:26:59,220 --> 00:27:01,080
pain but there's a lot of good tutorials

852
00:27:01,080 --> 00:27:02,880
um Amanda Russo went through one once

853
00:27:02,880 --> 00:27:04,740
and I felt like I learned it after she

854
00:27:04,740 --> 00:27:06,299
gave it then I forgot it a week later so

855
00:27:06,299 --> 00:27:07,919
like it's possible there's tutorials out

856
00:27:07,919 --> 00:27:10,100
there

857
00:27:12,960 --> 00:27:15,679
to do it like a

858
00:27:16,020 --> 00:27:18,200
name

859
00:27:25,860 --> 00:27:28,260
okay let's use it as a crutch for me not

860
00:27:28,260 --> 00:27:29,700
wanting to go into a disassembler

861
00:27:29,700 --> 00:27:31,260
because I'm like oh I can find out so

862
00:27:31,260 --> 00:27:33,659
much stuff without having to do that

863
00:27:33,659 --> 00:27:36,299
um again in terms of biases yes I tend

864
00:27:36,299 --> 00:27:38,279
to want to see like surveillance where

865
00:27:38,279 --> 00:27:40,020
wherever it is there but it's not always

866
00:27:40,020 --> 00:27:42,600
I think looking at adware is boring I

867
00:27:42,600 --> 00:27:44,039
don't really care about you know crypto

868
00:27:44,039 --> 00:27:45,600
stuff is interesting it's you know

869
00:27:45,600 --> 00:27:47,220
ransomware that's interesting but like I

870
00:27:47,220 --> 00:27:48,480
personally find a surveillance piece

871
00:27:48,480 --> 00:27:49,860
more interesting

872
00:27:49,860 --> 00:27:51,299
um so to each their own I guess but I

873
00:27:51,299 --> 00:27:53,700
would say yeah maybe

874
00:27:53,700 --> 00:27:56,159
again this was a cursory investigation

875
00:27:56,159 --> 00:27:57,659
and spent only a few months kind of like

876
00:27:57,659 --> 00:27:59,100
digging into this so maybe as I do it

877
00:27:59,100 --> 00:28:01,140
more I could give you a better answer to

878
00:28:01,140 --> 00:28:03,299
what I think I'm avoiding but for now

879
00:28:03,299 --> 00:28:05,340
maybe it's just I wouldn't want to look

880
00:28:05,340 --> 00:28:07,740
at malware that only was like pop-up ads

881
00:28:07,740 --> 00:28:09,840
like that doesn't interest me so maybe

882
00:28:09,840 --> 00:28:12,139
that

883
00:28:28,200 --> 00:28:30,480
yeah

884
00:28:30,480 --> 00:28:32,220
um I think identifying what I want to

885
00:28:32,220 --> 00:28:34,140
find I've looked through enough stuff

886
00:28:34,140 --> 00:28:35,580
and gone through enough thread until

887
00:28:35,580 --> 00:28:37,559
that I know what needs to be interesting

888
00:28:37,559 --> 00:28:38,880
and if I were to talk to someone who had

889
00:28:38,880 --> 00:28:40,020
a different mindset I said well if

890
00:28:40,020 --> 00:28:41,760
you're interested in you know learning

891
00:28:41,760 --> 00:28:43,320
more about financial gains about where I

892
00:28:43,320 --> 00:28:44,580
can still identify like these are the

893
00:28:44,580 --> 00:28:46,200
key components that might be of interest

894
00:28:46,200 --> 00:28:48,539
to dig into so yes I might be more

895
00:28:48,539 --> 00:28:50,279
interested in the Espionage side and I

896
00:28:50,279 --> 00:28:52,140
can break down you know this is what I

897
00:28:52,140 --> 00:28:54,299
want to find I think that ability to

898
00:28:54,299 --> 00:28:55,919
like understand what your problem is and

899
00:28:55,919 --> 00:28:58,080
what the broader categories are to solve

900
00:28:58,080 --> 00:29:00,240
it are and then weaknesses would still

901
00:29:00,240 --> 00:29:03,120
be learning in Mac specifically what

902
00:29:03,120 --> 00:29:05,460
strings or what apis do I look into to

903
00:29:05,460 --> 00:29:07,799
potentially find X capability I'm still

904
00:29:07,799 --> 00:29:10,320
very new to it so again I think the

905
00:29:10,320 --> 00:29:12,480
biggest thing is at the outset if you

906
00:29:12,480 --> 00:29:14,640
are able to Define what you're trying to

907
00:29:14,640 --> 00:29:16,860
get out of this is it making a report is

908
00:29:16,860 --> 00:29:19,200
it just a quick answer that's very

909
00:29:19,200 --> 00:29:21,559
useful

