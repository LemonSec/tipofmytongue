1
00:00:00,719 --> 00:00:03,540
so I'm going to talk about a bit about

2
00:00:03,540 --> 00:00:06,480
my journey to find different type of Mac

3
00:00:06,480 --> 00:00:08,460
OS vulnerabilities

4
00:00:08,460 --> 00:00:13,019
uh and especially this time about one

5
00:00:13,019 --> 00:00:15,000
specific one which is related to the

6
00:00:15,000 --> 00:00:18,360
Apple calendar

7
00:00:19,820 --> 00:00:23,160
if you read the description originally

8
00:00:23,160 --> 00:00:25,740
like two weeks ago there was a little

9
00:00:25,740 --> 00:00:28,500
bit more also in that description but

10
00:00:28,500 --> 00:00:29,720
unfortunately

11
00:00:29,720 --> 00:00:32,640
I have a more concentrating to the first

12
00:00:32,640 --> 00:00:35,460
part of that vulnerability chain that is

13
00:00:35,460 --> 00:00:38,719
because not all of the things are

14
00:00:38,719 --> 00:00:42,780
those are not yet fixed fully so I will

15
00:00:42,780 --> 00:00:44,579
concentrate to the things which are

16
00:00:44,579 --> 00:00:46,559
actually fixed and talk about a little

17
00:00:46,559 --> 00:00:50,520
bit about the background related to that

18
00:00:50,520 --> 00:00:53,640
so my name is Mikko kentala I'm one of

19
00:00:53,640 --> 00:00:56,760
the founders and CEO sensorflu I've been

20
00:00:56,760 --> 00:01:01,160
doing hacking uh in State High School

21
00:01:01,160 --> 00:01:03,840
hacking and breaking different kind of

22
00:01:03,840 --> 00:01:04,640
stuff

23
00:01:04,640 --> 00:01:07,799
in sensorflow we built cyber security

24
00:01:07,799 --> 00:01:10,140
products that's a different story but

25
00:01:10,140 --> 00:01:12,119
this is more about my happy hacking

26
00:01:12,119 --> 00:01:15,060
process what I do when I have a little

27
00:01:15,060 --> 00:01:18,299
bit free time as a hobby so I really

28
00:01:18,299 --> 00:01:21,600
like to hack different type of softwares

29
00:01:21,600 --> 00:01:24,600
and devices and so on only if I have a

30
00:01:24,600 --> 00:01:27,060
time though but I tend to concentrate

31
00:01:27,060 --> 00:01:30,119
the things what I'm using myself for

32
00:01:30,119 --> 00:01:33,240
some of the well to my personal use so

33
00:01:33,240 --> 00:01:35,040
as you can see I'm using Mac so it's

34
00:01:35,040 --> 00:01:38,520
kind of kind of convenient that I do

35
00:01:38,520 --> 00:01:40,439
research also related to some of the

36
00:01:40,439 --> 00:01:42,420
things in the Mac OS

37
00:01:42,420 --> 00:01:44,040
uh

38
00:01:44,040 --> 00:01:47,700
uh previously uh I've have had a

39
00:01:47,700 --> 00:01:51,180
publicly disclosed and wrote a blog post

40
00:01:51,180 --> 00:01:55,020
about the uh other vulnerabilities you

41
00:01:55,020 --> 00:01:57,439
can find those out as uh

42
00:01:57,439 --> 00:02:00,060
zero click vulnerability related to the

43
00:02:00,060 --> 00:02:04,020
Mac OS mail where you basically uh as an

44
00:02:04,020 --> 00:02:06,360
attacker you are able to send and

45
00:02:06,360 --> 00:02:10,080
specifically crafted email to the victim

46
00:02:10,080 --> 00:02:13,379
and it will automatically trigger in a

47
00:02:13,379 --> 00:02:17,520
way that after that email all the emails

48
00:02:17,520 --> 00:02:19,980
will be forwarded also to the attacker

49
00:02:19,980 --> 00:02:22,800
so there was a way to manipulate the

50
00:02:22,800 --> 00:02:24,860
configuration of the

51
00:02:24,860 --> 00:02:27,959
victims email client and there's a blog

52
00:02:27,959 --> 00:02:30,180
post about that

53
00:02:30,180 --> 00:02:33,360
uh I've been giving a couple of

54
00:02:33,360 --> 00:02:37,080
presentation about the another one also

55
00:02:37,080 --> 00:02:39,780
that was related to the or that was like

56
00:02:39,780 --> 00:02:42,599
a full vulnerability chain related to

57
00:02:42,599 --> 00:02:46,560
the Mac OS It All Started from the point

58
00:02:46,560 --> 00:02:49,019
of view where the user decides to click

59
00:02:49,019 --> 00:02:52,040
download button button for certain file

60
00:02:52,040 --> 00:02:55,019
and the div file will will be downloaded

61
00:02:55,019 --> 00:02:58,620
it will be automatically extracted uh

62
00:02:58,620 --> 00:03:00,599
because that's what Mac OS and software

63
00:03:00,599 --> 00:03:03,239
do it will be automatically extracted

64
00:03:03,239 --> 00:03:06,560
and that includes specific kind of

65
00:03:06,560 --> 00:03:12,180
application which will include Mac OS

66
00:03:12,180 --> 00:03:15,840
Alias file which will then launch an

67
00:03:15,840 --> 00:03:18,840
Samba Mount and after that there's a

68
00:03:18,840 --> 00:03:21,360
little bit trickery to get that some

69
00:03:21,360 --> 00:03:25,500
amount to to arbitrary Mount point to

70
00:03:25,500 --> 00:03:28,400
actually cause and completely different

71
00:03:28,400 --> 00:03:31,800
uh when you launch terminal the terminal

72
00:03:31,800 --> 00:03:34,260
will down start using the configuration

73
00:03:34,260 --> 00:03:37,920
of the uh from that Samba Mount and that

74
00:03:37,920 --> 00:03:42,180
will lead to the command execution and

75
00:03:42,180 --> 00:03:45,120
after that there's also Evasion for the

76
00:03:45,120 --> 00:03:47,280
sum of the security mechanics which are

77
00:03:47,280 --> 00:03:49,799
basically restricting the access to the

78
00:03:49,799 --> 00:03:52,200
sensitive data in your Mac OS system so

79
00:03:52,200 --> 00:03:55,440
that was quite a long chain of different

80
00:03:55,440 --> 00:03:58,319
type of vulnerabilities changed together

81
00:03:58,319 --> 00:04:00,599
you can find the presentation from

82
00:04:00,599 --> 00:04:03,239
YouTube so just Google with my name or

83
00:04:03,239 --> 00:04:05,400
or I think with that you will find

84
00:04:05,400 --> 00:04:06,840
actually a couple of different

85
00:04:06,840 --> 00:04:10,019
presentations about that

86
00:04:10,019 --> 00:04:12,920
so the original plan was to actually

87
00:04:12,920 --> 00:04:16,339
introduce another this type of chain

88
00:04:16,339 --> 00:04:18,959
but the in this case we need to

89
00:04:18,959 --> 00:04:21,478
concentrate more on the first part of it

90
00:04:21,478 --> 00:04:24,300
so I will give you an idea a little bit

91
00:04:24,300 --> 00:04:27,120
and about about background how I do the

92
00:04:27,120 --> 00:04:30,199
actual vulnerability research manually

93
00:04:30,199 --> 00:04:33,300
and how I operate so how these things

94
00:04:33,300 --> 00:04:38,040
are fine found and then we move into the

95
00:04:38,040 --> 00:04:41,400
actual calendar application and how that

96
00:04:41,400 --> 00:04:44,400
exactly work and what exactly was the

97
00:04:44,400 --> 00:04:47,060
vulnerability

98
00:04:47,940 --> 00:04:51,300
all right so this is the this is

99
00:04:51,300 --> 00:04:54,660
question what I have got quite often

100
00:04:54,660 --> 00:04:56,759
after my presentation that how exactly

101
00:04:56,759 --> 00:04:58,979
and how easy it is to actually find

102
00:04:58,979 --> 00:05:00,419
those bugs and

103
00:05:00,419 --> 00:05:02,639
for me it's hard to say how easy it is

104
00:05:02,639 --> 00:05:06,300
because I have a background of doing uh

105
00:05:06,300 --> 00:05:10,500
technical security audits uh like a like

106
00:05:10,500 --> 00:05:12,479
we did it together with my colleague

107
00:05:12,479 --> 00:05:15,479
with it uh five days technical security

108
00:05:15,479 --> 00:05:18,600
out it's like five years until five

109
00:05:18,600 --> 00:05:21,419
years ago or six years ago so quite long

110
00:05:21,419 --> 00:05:22,699
time

111
00:05:22,699 --> 00:05:25,919
and the during that time there was a

112
00:05:25,919 --> 00:05:28,139
certain pattern with what we were like

113
00:05:28,139 --> 00:05:29,940
repeating and most of the time we found

114
00:05:29,940 --> 00:05:32,160
some vulnerabilities

115
00:05:32,160 --> 00:05:34,860
so we've been following uh back then

116
00:05:34,860 --> 00:05:37,680
this type of methodology which is rather

117
00:05:37,680 --> 00:05:39,300
straightforward and I think it is

118
00:05:39,300 --> 00:05:41,940
nothing new for those who have been in

119
00:05:41,940 --> 00:05:44,340
the business for quite a long time and

120
00:05:44,340 --> 00:05:46,440
this is as you can see there's nothing

121
00:05:46,440 --> 00:05:48,780
like a specific technology what I'm

122
00:05:48,780 --> 00:05:50,400
using or something like that it's more

123
00:05:50,400 --> 00:05:53,580
like a fundamental idea so the Step One

124
00:05:53,580 --> 00:05:56,039
Is to learn as much as possible from the

125
00:05:56,039 --> 00:05:58,139
system so you might want to check out

126
00:05:58,139 --> 00:06:00,600
the documentation do some reverse

127
00:06:00,600 --> 00:06:03,180
engineering that is bullet in this case

128
00:06:03,180 --> 00:06:05,400
because I like to I'm many times

129
00:06:05,400 --> 00:06:07,380
constantly concentrating into that and

130
00:06:07,380 --> 00:06:09,120
when I find something interesting I read

131
00:06:09,120 --> 00:06:11,300
more the documentation side

132
00:06:11,300 --> 00:06:14,759
and uh to call basically the ultimate

133
00:06:14,759 --> 00:06:18,419
goal is to actually know uh exactly what

134
00:06:18,419 --> 00:06:20,280
is happening behind the scenes when you

135
00:06:20,280 --> 00:06:22,139
are using some application or what when

136
00:06:22,139 --> 00:06:26,819
you are using some some uh Service uh at

137
00:06:26,819 --> 00:06:28,220
the internet

138
00:06:28,220 --> 00:06:31,800
then the goal is to try to find out some

139
00:06:31,800 --> 00:06:34,139
sort of anomaly so then you have a base

140
00:06:34,139 --> 00:06:37,259
understanding that okay this is how it

141
00:06:37,259 --> 00:06:41,340
should work so when I'm doing this uh

142
00:06:41,340 --> 00:06:43,440
this is the path what should happen

143
00:06:43,440 --> 00:06:46,080
after that when I do this thing for if

144
00:06:46,080 --> 00:06:49,880
you send an email you except that the

145
00:06:49,880 --> 00:06:52,680
the receiver will get the email or

146
00:06:52,680 --> 00:06:54,360
something like that and then check it

147
00:06:54,360 --> 00:06:55,979
from the technical point of view and try

148
00:06:55,979 --> 00:06:58,819
to find if you can cause some anomaly

149
00:06:58,819 --> 00:07:02,100
related to the process what is going on

150
00:07:02,100 --> 00:07:06,000
over there so can you manipulate the sum

151
00:07:06,000 --> 00:07:08,580
of the processes or the application or

152
00:07:08,580 --> 00:07:11,400
the services what you are actually using

153
00:07:11,400 --> 00:07:14,120
that is the goal

154
00:07:14,120 --> 00:07:17,520
uh if you have some room over there try

155
00:07:17,520 --> 00:07:19,500
to find out can you change somehow the

156
00:07:19,500 --> 00:07:22,800
environment in a way that it will like

157
00:07:22,800 --> 00:07:26,220
cause some surprising things related to

158
00:07:26,220 --> 00:07:27,599
that application it's a little bit

159
00:07:27,599 --> 00:07:31,800
abstract but the that is because uh in

160
00:07:31,800 --> 00:07:33,840
different cases this may might mean

161
00:07:33,840 --> 00:07:36,539
different things so you may have like a

162
00:07:36,539 --> 00:07:39,539
in practice this may vary a lot what it

163
00:07:39,539 --> 00:07:41,340
it means in practice but this is

164
00:07:41,340 --> 00:07:45,720
basically the goal in that second step

165
00:07:45,720 --> 00:07:48,900
then if you find out some error or some

166
00:07:48,900 --> 00:07:51,199
malfunction of the software when you're

167
00:07:51,199 --> 00:07:54,360
putting some your own some of your own

168
00:07:54,360 --> 00:07:57,240
input to the software and this software

169
00:07:57,240 --> 00:07:59,520
will crash or do something which is a

170
00:07:59,520 --> 00:08:02,340
little bit surprising try to look the

171
00:08:02,340 --> 00:08:05,759
ways to get more privileges with the

172
00:08:05,759 --> 00:08:07,860
existing function so if you are using

173
00:08:07,860 --> 00:08:10,500
some specific thing think about it that

174
00:08:10,500 --> 00:08:12,720
okay this is designed for this usage

175
00:08:12,720 --> 00:08:14,880
most likely or that try to figure that

176
00:08:14,880 --> 00:08:19,440
out and then later on try to figure out

177
00:08:19,440 --> 00:08:21,360
that can you do actually something else

178
00:08:21,360 --> 00:08:23,879
but what may be something what the

179
00:08:23,879 --> 00:08:26,460
original designer or coder has not been

180
00:08:26,460 --> 00:08:28,680
thinking of and that is exactly the

181
00:08:28,680 --> 00:08:30,840
place where you most likely can do the

182
00:08:30,840 --> 00:08:33,120
exploitation later on

183
00:08:33,120 --> 00:08:34,440
uh

184
00:08:34,440 --> 00:08:37,799
many times nowadays because we have a in

185
00:08:37,799 --> 00:08:39,020
cyber security

186
00:08:39,020 --> 00:08:41,640
software side we have a quite a good

187
00:08:41,640 --> 00:08:44,459
medications in place or plenty of those

188
00:08:44,459 --> 00:08:46,980
mitigations it might mean that you

189
00:08:46,980 --> 00:08:51,779
cannot directly cause some exploitation

190
00:08:51,779 --> 00:08:54,660
to that specific vulnerability it may be

191
00:08:54,660 --> 00:08:57,660
that you have you just have some really

192
00:08:57,660 --> 00:09:00,300
tiny capability and you need to figure

193
00:09:00,300 --> 00:09:03,540
out how maybe some other software can

194
00:09:03,540 --> 00:09:05,820
you can cause some troubles to some

195
00:09:05,820 --> 00:09:07,860
completely different software or

196
00:09:07,860 --> 00:09:10,560
completely different function in in that

197
00:09:10,560 --> 00:09:12,000
field

198
00:09:12,000 --> 00:09:14,279
and

199
00:09:14,279 --> 00:09:18,240
in Mac OS case there's also these

200
00:09:18,240 --> 00:09:21,500
mitigations are basically

201
00:09:21,500 --> 00:09:24,420
there's a three or four different type

202
00:09:24,420 --> 00:09:26,399
of common mitigations what you need to

203
00:09:26,399 --> 00:09:28,500
worry about if you want to get access to

204
00:09:28,500 --> 00:09:31,380
all the data in the system or the or the

205
00:09:31,380 --> 00:09:33,839
sensitive data in the system so

206
00:09:33,839 --> 00:09:36,240
obviously you need to exploit the

207
00:09:36,240 --> 00:09:39,480
initial vulnerability uh in the software

208
00:09:39,480 --> 00:09:42,800
but then you are most likely in sandbox

209
00:09:42,800 --> 00:09:46,080
if you want to run some third-party

210
00:09:46,080 --> 00:09:48,779
application or bring in new code if you

211
00:09:48,779 --> 00:09:51,839
need to somehow fold the GateKeeper

212
00:09:51,839 --> 00:09:53,880
gatekeeper as a software which is

213
00:09:53,880 --> 00:09:56,220
designed for doing exactly that that if

214
00:09:56,220 --> 00:09:57,899
you have some code which is coming from

215
00:09:57,899 --> 00:10:01,140
outside you need to specifically unload

216
00:10:01,140 --> 00:10:04,140
that software to be around so as if you

217
00:10:04,140 --> 00:10:05,880
want to exploit without the user

218
00:10:05,880 --> 00:10:08,459
interaction you need to figure out how

219
00:10:08,459 --> 00:10:11,580
to evade that then if you want to access

220
00:10:11,580 --> 00:10:15,720
to some of the sensitive data you need

221
00:10:15,720 --> 00:10:18,300
to get rid of the controls related to

222
00:10:18,300 --> 00:10:21,260
the TCC which is basically protecting

223
00:10:21,260 --> 00:10:25,200
all the data files in your at your

224
00:10:25,200 --> 00:10:29,700
desktop photos location web camera

225
00:10:29,700 --> 00:10:33,660
access so on so that is the exact piece

226
00:10:33,660 --> 00:10:37,580
of technology which is trying to put

227
00:10:37,580 --> 00:10:41,279
good controls for the user for for the

228
00:10:41,279 --> 00:10:43,560
all the sensitive data so that's another

229
00:10:43,560 --> 00:10:47,300
obstacle and many times is to actually

230
00:10:47,300 --> 00:10:51,860
fool these other security measures uh

231
00:10:51,860 --> 00:10:54,899
you may need to evade the system

232
00:10:54,899 --> 00:10:57,660
Integrity protection which is basically

233
00:10:57,660 --> 00:11:00,480
protecting all the different part of the

234
00:11:00,480 --> 00:11:03,180
actual operating system including those

235
00:11:03,180 --> 00:11:06,839
TCC and gatekeeper so you cannot like

236
00:11:06,839 --> 00:11:10,079
uh even if you have a permissions from

237
00:11:10,079 --> 00:11:12,360
the Unix point of view that you are as a

238
00:11:12,360 --> 00:11:15,000
user you should be able to manipulate

239
00:11:15,000 --> 00:11:17,279
some of the files in the file system sip

240
00:11:17,279 --> 00:11:20,040
may be protecting those files so these

241
00:11:20,040 --> 00:11:23,040
kind of things I have uh you can check

242
00:11:23,040 --> 00:11:25,260
out the YouTube video about my previous

243
00:11:25,260 --> 00:11:28,079
presentation it's I go more deeply into

244
00:11:28,079 --> 00:11:31,079
this topic and there's also examples how

245
00:11:31,079 --> 00:11:34,800
I have done it before so today we are

246
00:11:34,800 --> 00:11:38,100
not going to go fully into that

247
00:11:38,100 --> 00:11:39,480
but

248
00:11:39,480 --> 00:11:42,480
today we are going to talk about the

249
00:11:42,480 --> 00:11:46,220
zero click invite

250
00:11:46,800 --> 00:11:51,180
how many of you need to use some sort of

251
00:11:51,180 --> 00:11:53,399
calendar as a daily basis when you're

252
00:11:53,399 --> 00:11:55,380
doing business or working or in the

253
00:11:55,380 --> 00:11:57,500
family

254
00:11:57,540 --> 00:11:59,760
yeah most of you

255
00:11:59,760 --> 00:12:02,399
there's a story why I dived into this

256
00:12:02,399 --> 00:12:04,440
topic and that was that like I said

257
00:12:04,440 --> 00:12:07,500
before I've done technical security

258
00:12:07,500 --> 00:12:11,459
audits for customers for uh already 10

259
00:12:11,459 --> 00:12:14,519
years ago or so and around 10 years ago

260
00:12:14,519 --> 00:12:17,459
we one of the objective was to check out

261
00:12:17,459 --> 00:12:20,040
one specific calendar system for the

262
00:12:20,040 --> 00:12:23,160
customer or a client and I did a deep

263
00:12:23,160 --> 00:12:25,459
dive to the calendar system 10 years ago

264
00:12:25,459 --> 00:12:28,440
and we found some vulnerabilities and

265
00:12:28,440 --> 00:12:30,600
back then I decided that I'm not going

266
00:12:30,600 --> 00:12:33,720
to use calendar like a two months in the

267
00:12:33,720 --> 00:12:36,360
future because it so Troublesome in many

268
00:12:36,360 --> 00:12:38,459
ways the specification

269
00:12:38,459 --> 00:12:43,800
all those things like causing an uh you

270
00:12:43,800 --> 00:12:47,000
can send an event which includes certain

271
00:12:47,000 --> 00:12:50,880
alert which can point to the specific

272
00:12:50,880 --> 00:12:53,160
application which will launch on that

273
00:12:53,160 --> 00:12:56,579
event of alert and so on so most of

274
00:12:56,579 --> 00:12:58,680
these have been fixed fixed over the

275
00:12:58,680 --> 00:13:01,440
years in the clients however the like

276
00:13:01,440 --> 00:13:04,260
idea how it fundamentally Works was a

277
00:13:04,260 --> 00:13:07,500
little bit troubling for me and so I

278
00:13:07,500 --> 00:13:09,839
basically started to use just like a web

279
00:13:09,839 --> 00:13:11,880
calendar web application calendar like a

280
00:13:11,880 --> 00:13:14,579
Google Calendar or so on however all of

281
00:13:14,579 --> 00:13:16,079
these chains when we found that the

282
00:13:16,079 --> 00:13:18,360
company and we basically figured out

283
00:13:18,360 --> 00:13:20,760
that if you want to have a meeting with

284
00:13:20,760 --> 00:13:22,800
the customer you need to use the

285
00:13:22,800 --> 00:13:24,300
calendar and you need to use the

286
00:13:24,300 --> 00:13:26,220
calendar invitation because otherwise

287
00:13:26,220 --> 00:13:28,680
like 70 percent of the time you are

288
00:13:28,680 --> 00:13:30,660
sitting in the alone in your meeting

289
00:13:30,660 --> 00:13:32,700
room waiting that the customer will join

290
00:13:32,700 --> 00:13:34,440
in but they don't because they didn't

291
00:13:34,440 --> 00:13:37,440
receive the calendar invitation so I

292
00:13:37,440 --> 00:13:39,300
started to use more disk but that was

293
00:13:39,300 --> 00:13:41,700
troubling in the sense that I needed to

294
00:13:41,700 --> 00:13:44,459
also to go and check that how well those

295
00:13:44,459 --> 00:13:46,740
the calendar actually work so this has

296
00:13:46,740 --> 00:13:48,540
been on my to-do list for quite a long

297
00:13:48,540 --> 00:13:50,880
time however I haven't had too much time

298
00:13:50,880 --> 00:13:52,680
to actually dive in so I did it quite

299
00:13:52,680 --> 00:13:53,820
recently

300
00:13:53,820 --> 00:13:58,200
so Apple calendar is uh like like many

301
00:13:58,200 --> 00:14:00,180
other calendar application really

302
00:14:00,180 --> 00:14:02,279
straightforward in the sense you can

303
00:14:02,279 --> 00:14:04,260
imagine what you can do with it it

304
00:14:04,260 --> 00:14:07,440
supports iCloud Google Calendar uh

305
00:14:07,440 --> 00:14:10,079
exchange and like external called up

306
00:14:10,079 --> 00:14:12,660
servers so it's quite handy and works

307
00:14:12,660 --> 00:14:14,160
well with that

308
00:14:14,160 --> 00:14:17,579
there's some specific things related to

309
00:14:17,579 --> 00:14:19,800
the Apple calendar that if you are using

310
00:14:19,800 --> 00:14:21,200
the iCloud

311
00:14:21,200 --> 00:14:24,420
for example with the Apple calendar you

312
00:14:24,420 --> 00:14:27,480
can basically do invitations for your

313
00:14:27,480 --> 00:14:29,519
other friends who are using also the

314
00:14:29,519 --> 00:14:31,740
iCloud and it will be fluent because

315
00:14:31,740 --> 00:14:34,440
there's no email required and so on so

316
00:14:34,440 --> 00:14:37,700
it's quite quite handy in that sense

317
00:14:37,700 --> 00:14:41,940
uh sometimes uh if you're Apple user Mac

318
00:14:41,940 --> 00:14:44,100
User you will find out that when you

319
00:14:44,100 --> 00:14:46,079
receive an email which includes some

320
00:14:46,079 --> 00:14:48,540
event calendar event that will that may

321
00:14:48,540 --> 00:14:50,279
be automatically added to your calendar

322
00:14:50,279 --> 00:14:53,399
and actually Siri does it too so when

323
00:14:53,399 --> 00:14:56,639
you receive an airplane ticket or

324
00:14:56,639 --> 00:14:58,500
something like that Siri will figure out

325
00:14:58,500 --> 00:15:00,360
that okay you will have a flight so

326
00:15:00,360 --> 00:15:02,220
let's add that to you to your calendar

327
00:15:02,220 --> 00:15:05,940
right and it is super handy I actually

328
00:15:05,940 --> 00:15:09,360
love that function however from the

329
00:15:09,360 --> 00:15:12,120
security point of view that like uh ring

330
00:15:12,120 --> 00:15:14,639
some bells to me that this is also a

331
00:15:14,639 --> 00:15:16,320
little bit troubling that if I just

332
00:15:16,320 --> 00:15:18,420
receive an email I have some events

333
00:15:18,420 --> 00:15:20,399
popping to my calendar so it may be

334
00:15:20,399 --> 00:15:23,240
maybe risky

335
00:15:23,240 --> 00:15:26,220
uh the format what is used is eye

336
00:15:26,220 --> 00:15:29,459
calendar format it's rather old but

337
00:15:29,459 --> 00:15:32,220
there's nothing wrong to being old so in

338
00:15:32,220 --> 00:15:33,120
that sense so it's really

339
00:15:33,120 --> 00:15:34,800
straightforward protocol so it looks

340
00:15:34,800 --> 00:15:37,079
like this if you open some of your

341
00:15:37,079 --> 00:15:39,839
invitations you will see something like

342
00:15:39,839 --> 00:15:43,260
that uh that that that kind of data in

343
00:15:43,260 --> 00:15:45,420
the calendar event it is originally

344
00:15:45,420 --> 00:15:49,019
introduced in 98 and it is basically

345
00:15:49,019 --> 00:15:54,060
plain text file format so that is also

346
00:15:54,060 --> 00:15:57,240
good for testing purposes because it's

347
00:15:57,240 --> 00:15:59,459
not hard to manipulate that that type of

348
00:15:59,459 --> 00:16:02,839
data and play around with it

349
00:16:03,360 --> 00:16:07,440
so but later on there was a support for

350
00:16:07,440 --> 00:16:09,899
syncing the calendars and there there

351
00:16:09,899 --> 00:16:12,839
was call DAV was introduced based on

352
00:16:12,839 --> 00:16:15,779
Wikipedia it was introduced in 2007 so

353
00:16:15,779 --> 00:16:18,240
much later however the technology behind

354
00:16:18,240 --> 00:16:20,459
it is based on web dub which has been

355
00:16:20,459 --> 00:16:24,120
introduced in 96. uh the fundamental

356
00:16:24,120 --> 00:16:26,399
idea is rather straightforward Colorado

357
00:16:26,399 --> 00:16:30,600
server is HTTP based service which

358
00:16:30,600 --> 00:16:35,639
basically receives and provides those

359
00:16:35,639 --> 00:16:39,180
ICS files to the email clients there is

360
00:16:39,180 --> 00:16:43,560
some part of uh there's a specific

361
00:16:43,560 --> 00:16:45,839
things in the protocol for notifying the

362
00:16:45,839 --> 00:16:47,220
use of that okay there's new event

363
00:16:47,220 --> 00:16:50,399
coming and so on that but basically that

364
00:16:50,399 --> 00:16:53,279
called up is is like it's syncing those

365
00:16:53,279 --> 00:16:56,160
ICS files to the server and from the

366
00:16:56,160 --> 00:16:58,380
server to see all the clients rather

367
00:16:58,380 --> 00:17:00,899
straightforward and once again it's good

368
00:17:00,899 --> 00:17:04,819
for testing purposes also

369
00:17:04,819 --> 00:17:06,599
or

370
00:17:06,599 --> 00:17:08,880
not that good thing is that if you want

371
00:17:08,880 --> 00:17:11,699
to host your own calendar server and

372
00:17:11,699 --> 00:17:13,619
there's no good options anymore

373
00:17:13,619 --> 00:17:16,260
available all of the things are seems to

374
00:17:16,260 --> 00:17:20,880
be mostly Legacy stuff and I'm guessing

375
00:17:20,880 --> 00:17:22,980
that same thing might apply to the

376
00:17:22,980 --> 00:17:25,199
Apple's iCloud side and any other

377
00:17:25,199 --> 00:17:28,319
provider who is out there so most likely

378
00:17:28,319 --> 00:17:30,600
there will be some Java and something

379
00:17:30,600 --> 00:17:32,640
like that behind the scenes I'm not sure

380
00:17:32,640 --> 00:17:35,220
but I'm just guessing

381
00:17:35,220 --> 00:17:38,760
but then there's a invitation which is

382
00:17:38,760 --> 00:17:40,980
the exact thing which is so important in

383
00:17:40,980 --> 00:17:42,720
the when you're in daily basis of doing

384
00:17:42,720 --> 00:17:43,679
business

385
00:17:43,679 --> 00:17:46,380
how that invitation actually works

386
00:17:46,380 --> 00:17:48,720
so it's once again rather

387
00:17:48,720 --> 00:17:52,340
straightforward you can even manually

388
00:17:52,340 --> 00:17:56,340
attendee to the ICS file and put the

389
00:17:56,340 --> 00:17:59,280
contact name over their email address

390
00:17:59,280 --> 00:18:01,860
and so on and you just push that

391
00:18:01,860 --> 00:18:04,799
information to your Caldwell server and

392
00:18:04,799 --> 00:18:07,620
the uh the user will receive the

393
00:18:07,620 --> 00:18:10,919
invitation automatically especially if

394
00:18:10,919 --> 00:18:14,100
he or she is using the same service

395
00:18:14,100 --> 00:18:16,799
if if you want to send it to someone who

396
00:18:16,799 --> 00:18:19,559
is outside you may be add this file to

397
00:18:19,559 --> 00:18:21,720
the email attachment or something like

398
00:18:21,720 --> 00:18:24,059
that and that way they will get the

399
00:18:24,059 --> 00:18:27,419
invitation but once again from the

400
00:18:27,419 --> 00:18:30,179
protocol point of view it is really

401
00:18:30,179 --> 00:18:32,840
straightforward

402
00:18:34,620 --> 00:18:37,679
and then there's a feature related to

403
00:18:37,679 --> 00:18:39,059
the attachment

404
00:18:39,059 --> 00:18:41,640
so this was some I was playing around

405
00:18:41,640 --> 00:18:44,400
with the calendar figuring out that what

406
00:18:44,400 --> 00:18:47,280
I can do with it what are the all the

407
00:18:47,280 --> 00:18:49,380
functions which which are available over

408
00:18:49,380 --> 00:18:51,360
there and one of the things

409
00:18:51,360 --> 00:18:53,580
from the attacker point of view which

410
00:18:53,580 --> 00:18:55,260
was interesting to me it was the

411
00:18:55,260 --> 00:18:56,539
attachment

412
00:18:56,539 --> 00:18:59,520
attachment once again works really it's

413
00:18:59,520 --> 00:19:02,280
really simple how it works you just add

414
00:19:02,280 --> 00:19:05,400
the file name then you add specific

415
00:19:05,400 --> 00:19:09,539
entries and you may add to URL to over

416
00:19:09,539 --> 00:19:12,539
there which in Apple calendar case if

417
00:19:12,539 --> 00:19:14,400
it's up it will be automatically

418
00:19:14,400 --> 00:19:16,320
uploaded to the iCloud and can be

419
00:19:16,320 --> 00:19:19,320
automatically downloaded from there so

420
00:19:19,320 --> 00:19:21,380
quite straightforward

421
00:19:21,380 --> 00:19:24,360
old way of doing things is also that you

422
00:19:24,360 --> 00:19:27,179
can add the attachments directly as in

423
00:19:27,179 --> 00:19:31,559
base64 encoded data so if you have a

424
00:19:31,559 --> 00:19:34,200
small files like txts or something like

425
00:19:34,200 --> 00:19:36,419
that it may be handy handy way to

426
00:19:36,419 --> 00:19:38,220
actually share the attachment and it

427
00:19:38,220 --> 00:19:40,940
will be part of the calendar event

428
00:19:40,940 --> 00:19:45,539
what also the invitees will actually

429
00:19:45,539 --> 00:19:48,780
receive so that's something what was

430
00:19:48,780 --> 00:19:51,780
worrying me and every time when you get

431
00:19:51,780 --> 00:19:54,600
that kind of event to calendar and this

432
00:19:54,600 --> 00:19:57,660
is Mac OS not on iPhone calendar

433
00:19:57,660 --> 00:19:59,940
application will store that attachment

434
00:19:59,940 --> 00:20:02,460
to the calendar library calendars then

435
00:20:02,460 --> 00:20:05,280
you have a calendar ID and then you have

436
00:20:05,280 --> 00:20:07,080
attachments over there and then this

437
00:20:07,080 --> 00:20:09,960
event ID and the file is stored over

438
00:20:09,960 --> 00:20:12,600
there so it's in your file system you

439
00:20:12,600 --> 00:20:14,160
once again you don't need to do anything

440
00:20:14,160 --> 00:20:19,100
it will just appear magically over there

441
00:20:19,679 --> 00:20:24,360
so uh if I want to invite user I want to

442
00:20:24,360 --> 00:20:27,419
some file to be on on the system what

443
00:20:27,419 --> 00:20:29,880
they are using I can add an attachment

444
00:20:29,880 --> 00:20:32,160
and send it to everyone or whoever I

445
00:20:32,160 --> 00:20:34,500
want especially if they are using iCloud

446
00:20:34,500 --> 00:20:36,780
it will be just automatically pop up to

447
00:20:36,780 --> 00:20:39,000
the calendar including that file that

448
00:20:39,000 --> 00:20:41,220
file will be downloaded or extracted to

449
00:20:41,220 --> 00:20:42,360
this specific

450
00:20:42,360 --> 00:20:44,820
place in the file system

451
00:20:44,820 --> 00:20:46,440
so

452
00:20:46,440 --> 00:20:50,600
do you think that this may be risky

453
00:20:51,539 --> 00:20:55,100
it can be yes so

454
00:20:55,100 --> 00:20:57,660
I started to play around obviously with

455
00:20:57,660 --> 00:20:59,700
this because this is a great way to get

456
00:20:59,700 --> 00:21:01,880
files to victims

457
00:21:01,880 --> 00:21:04,280
system

458
00:21:04,280 --> 00:21:07,500
and there was a arbitrary file right

459
00:21:07,500 --> 00:21:08,940
vulnerability

460
00:21:08,940 --> 00:21:11,700
how many of you can guess that what

461
00:21:11,700 --> 00:21:14,220
might be the way to get arbitrary file

462
00:21:14,220 --> 00:21:15,320
provide

463
00:21:15,320 --> 00:21:19,580
uh with that technology

464
00:21:23,100 --> 00:21:25,080
yeah that's a good good answer and I

465
00:21:25,080 --> 00:21:27,179
think they just

466
00:21:27,179 --> 00:21:30,419
just doing this so you just set the file

467
00:21:30,419 --> 00:21:32,659
name

468
00:21:33,780 --> 00:21:36,419
so this was it

469
00:21:36,419 --> 00:21:38,940
so I don't know

470
00:21:38,940 --> 00:21:40,640
this was

471
00:21:40,640 --> 00:21:43,440
related to the attachment I think this

472
00:21:43,440 --> 00:21:46,500
is the on the playbooks of red team as

473
00:21:46,500 --> 00:21:49,440
on the like page one to test these kind

474
00:21:49,440 --> 00:21:50,700
of things

475
00:21:50,700 --> 00:21:55,559
so what will happen uh if I put instead

476
00:21:55,559 --> 00:21:58,260
of putting a specific file name I put a

477
00:21:58,260 --> 00:22:00,659
relative name for the file so it's

478
00:22:00,659 --> 00:22:03,600
pointing like uh dot dot slash dot dot

479
00:22:03,600 --> 00:22:05,760
slash dot dot slash and POC it means

480
00:22:05,760 --> 00:22:08,940
that it will be stored to the some some

481
00:22:08,940 --> 00:22:11,159
completely different directory than what

482
00:22:11,159 --> 00:22:15,980
it should be stored so uh

483
00:22:15,980 --> 00:22:18,840
we in over 10 years ago when we did

484
00:22:18,840 --> 00:22:20,520
those technical security artists this

485
00:22:20,520 --> 00:22:22,500
this kind of things was exactly what we

486
00:22:22,500 --> 00:22:23,880
were founding of

487
00:22:23,880 --> 00:22:26,880
so uh but it's not I think I've been

488
00:22:26,880 --> 00:22:28,200
thinking of this because I've found

489
00:22:28,200 --> 00:22:32,340
multiple this type of cases uh also in

490
00:22:32,340 --> 00:22:34,919
Mac OS but also in other systems that I

491
00:22:34,919 --> 00:22:36,419
feel that the

492
00:22:36,419 --> 00:22:37,740
there's

493
00:22:37,740 --> 00:22:40,200
it may be that all of us who were doing

494
00:22:40,200 --> 00:22:42,299
technical security out is 10 years ago

495
00:22:42,299 --> 00:22:44,460
is now doing something else because it

496
00:22:44,460 --> 00:22:46,280
this has been over there quite long time

497
00:22:46,280 --> 00:22:49,440
and it's rather simple to find out if

498
00:22:49,440 --> 00:22:52,679
you know what to test but the it's been

499
00:22:52,679 --> 00:22:54,960
over there quite a long time

500
00:22:54,960 --> 00:22:56,280
and

501
00:22:56,280 --> 00:22:57,600
yeah

502
00:22:57,600 --> 00:22:59,760
but then there's also arbitrary file

503
00:22:59,760 --> 00:23:02,100
delete and this is kind of logic error

504
00:23:02,100 --> 00:23:04,700
in the calendar application

505
00:23:04,700 --> 00:23:08,159
so if I set the name like a calendar

506
00:23:08,159 --> 00:23:10,320
cache is one of the files which is

507
00:23:10,320 --> 00:23:13,559
existing in the library calendar folder

508
00:23:13,559 --> 00:23:16,620
so if I put the name file name to that

509
00:23:16,620 --> 00:23:19,919
it won't overwrite the existing file

510
00:23:19,919 --> 00:23:23,220
instead it will add an additional file

511
00:23:23,220 --> 00:23:27,299
with -1 or -2 if there's already that

512
00:23:27,299 --> 00:23:31,020
and so on it really iterate however if I

513
00:23:31,020 --> 00:23:33,419
as an attacker if I delete the

514
00:23:33,419 --> 00:23:36,299
attachment afterwards and the client

515
00:23:36,299 --> 00:23:38,400
will receive the update that okay this

516
00:23:38,400 --> 00:23:40,740
file is now removed it will remove the

517
00:23:40,740 --> 00:23:43,140
original file in the file system so you

518
00:23:43,140 --> 00:23:46,500
can basically put any any file in the

519
00:23:46,500 --> 00:23:50,159
file system in that sandbox though and

520
00:23:50,159 --> 00:23:53,220
and it it will be removed so this

521
00:23:53,220 --> 00:23:55,740
specific case will cause the Apple

522
00:23:55,740 --> 00:23:58,559
calendar to crash because it's using

523
00:23:58,559 --> 00:24:00,360
that cache all the time and all of a

524
00:24:00,360 --> 00:24:03,059
sudden it's not in use anymore so it

525
00:24:03,059 --> 00:24:05,340
will eventually crash and it will take

526
00:24:05,340 --> 00:24:08,460
couple of times to actually restart to

527
00:24:08,460 --> 00:24:11,400
try to restart the application to make

528
00:24:11,400 --> 00:24:12,240
it

529
00:24:12,240 --> 00:24:14,580
trick or some kind of fail safe and it

530
00:24:14,580 --> 00:24:17,220
will kind of rebuild the cache again and

531
00:24:17,220 --> 00:24:19,980
it restores or so this was one of the

532
00:24:19,980 --> 00:24:23,280
things where I also wrote to the report

533
00:24:23,280 --> 00:24:27,780
there was some limitations so

534
00:24:27,780 --> 00:24:29,580
calendar application is running in the

535
00:24:29,580 --> 00:24:32,039
sandbox so because of that and that is

536
00:24:32,039 --> 00:24:34,740
really good thing you are able to only

537
00:24:34,740 --> 00:24:37,860
write the specific directories so

538
00:24:37,860 --> 00:24:40,080
calendar then there's a container system

539
00:24:40,080 --> 00:24:42,059
related to the calendar account which is

540
00:24:42,059 --> 00:24:43,919
running on the background that folder

541
00:24:43,919 --> 00:24:46,620
you can write or delete files then

542
00:24:46,620 --> 00:24:48,600
address book

543
00:24:48,600 --> 00:24:51,179
I guess the address book is used because

544
00:24:51,179 --> 00:24:53,400
when you are inviting someone to your

545
00:24:53,400 --> 00:24:56,280
your event you will have the list of the

546
00:24:56,280 --> 00:24:58,500
or if you try to invite and you will get

547
00:24:58,500 --> 00:25:00,480
the contacts from your address book so

548
00:25:00,480 --> 00:25:02,340
it's needed and this maybe for that

549
00:25:02,340 --> 00:25:04,620
reason that that is a load then there's

550
00:25:04,620 --> 00:25:06,840
the zinc service which is allowed to

551
00:25:06,840 --> 00:25:09,240
write and read however I think

552
00:25:09,240 --> 00:25:11,820
that is actually deprecated service so

553
00:25:11,820 --> 00:25:13,679
it shouldn't be over there but I just

554
00:25:13,679 --> 00:25:16,260
found out looking the sus calls that

555
00:25:16,260 --> 00:25:18,600
what what is checked when you launch the

556
00:25:18,600 --> 00:25:20,820
calendar application that was one of the

557
00:25:20,820 --> 00:25:23,120
things what was checked so I tried to

558
00:25:23,120 --> 00:25:26,880
write over there and it worked

559
00:25:26,880 --> 00:25:30,360
so what you can do as an attack attacker

560
00:25:30,360 --> 00:25:32,120
you can infect

561
00:25:32,120 --> 00:25:36,419
the uh victim with sending a calendar

562
00:25:36,419 --> 00:25:40,020
invites it will nicely pop up on

563
00:25:40,020 --> 00:25:43,200
victim's calendar automatically

564
00:25:43,200 --> 00:25:46,440
it will include the payload it will be

565
00:25:46,440 --> 00:25:48,299
written to the file system and something

566
00:25:48,299 --> 00:25:51,600
else might happen that afterwards

567
00:25:51,600 --> 00:25:55,260
I did that something else also but that

568
00:25:55,260 --> 00:25:59,700
is that is maybe more for the future so

569
00:25:59,700 --> 00:26:01,140
uh

570
00:26:01,140 --> 00:26:03,779
in after the summer I found the original

571
00:26:03,779 --> 00:26:07,020
vulnerability I sent the report to the

572
00:26:07,020 --> 00:26:07,820
Apple

573
00:26:07,820 --> 00:26:11,220
it was fixed fairly quickly so two

574
00:26:11,220 --> 00:26:14,940
months or so a bit over there was no CV

575
00:26:14,940 --> 00:26:17,480
for that I'm not sure why

576
00:26:17,480 --> 00:26:23,400
uh uh it was when when 13 was actually

577
00:26:23,400 --> 00:26:25,380
Michael was 13 was introduced it was

578
00:26:25,380 --> 00:26:27,539
already fixed over there I was actually

579
00:26:27,539 --> 00:26:29,279
in the middle of I found the

580
00:26:29,279 --> 00:26:31,559
vulnerability I was still on the Ventura

581
00:26:31,559 --> 00:26:33,900
beta tree so I was like okay it looks

582
00:26:33,900 --> 00:26:37,440
like it is working and then I was

583
00:26:37,440 --> 00:26:39,000
writing the report and found out oh

584
00:26:39,000 --> 00:26:40,919
there's new beta version available I

585
00:26:40,919 --> 00:26:44,159
updated to the beta 4 and it was fixed

586
00:26:44,159 --> 00:26:46,740
in beta 4. so I was surprised at all

587
00:26:46,740 --> 00:26:48,480
right maybe someone else found it or

588
00:26:48,480 --> 00:26:50,159
maybe they are doing changes to the new

589
00:26:50,159 --> 00:26:53,039
calendar and maybe that fixed it it

590
00:26:53,039 --> 00:26:56,059
might be it because there was design

591
00:26:56,059 --> 00:26:58,980
changes inventor that how calendar work

592
00:26:58,980 --> 00:27:01,080
it's more moving more to the direction

593
00:27:01,080 --> 00:27:03,120
of how your iPhone calendar is working

594
00:27:03,120 --> 00:27:06,299
and that is good it is much permissions

595
00:27:06,299 --> 00:27:09,179
are distinct more carefully and and so

596
00:27:09,179 --> 00:27:10,740
on so it is going to the better

597
00:27:10,740 --> 00:27:12,299
Direction anyway

598
00:27:12,299 --> 00:27:14,760
uh then again I later on followed up

599
00:27:14,760 --> 00:27:16,380
with the proof of concept that how to

600
00:27:16,380 --> 00:27:18,120
Leverage The vulnerability to get

601
00:27:18,120 --> 00:27:20,520
arbitrary code execution and a little

602
00:27:20,520 --> 00:27:22,679
bit later of that I followed up that how

603
00:27:22,679 --> 00:27:24,659
do you can get actually sensitive data

604
00:27:24,659 --> 00:27:26,880
actually out of it with leverage in that

605
00:27:26,880 --> 00:27:29,460
vulnerability however

606
00:27:29,460 --> 00:27:32,520
the story will continue on uh later on I

607
00:27:32,520 --> 00:27:35,159
was hoping to get the this to introduced

608
00:27:35,159 --> 00:27:38,520
for you already over here but we need to

609
00:27:38,520 --> 00:27:39,900
wait out that all the things are

610
00:27:39,900 --> 00:27:41,760
completely fixed and everything is in

611
00:27:41,760 --> 00:27:44,760
good shape before disclosing these so in

612
00:27:44,760 --> 00:27:46,200
next episode

613
00:27:46,200 --> 00:27:49,080
uh you will hear that how you can

614
00:27:49,080 --> 00:27:51,960
leverage the code that vulnerability to

615
00:27:51,960 --> 00:27:53,820
get the code execution from the sun

616
00:27:53,820 --> 00:27:56,220
escape from the sandbox and gaining the

617
00:27:56,220 --> 00:27:58,919
access to the sensitive date

618
00:27:58,919 --> 00:28:02,640
all right thank you and if you have any

619
00:28:02,640 --> 00:28:05,039
comments or questions feel free to ask

620
00:28:05,039 --> 00:28:08,000
thank you

621
00:28:27,900 --> 00:28:29,159
yeah

622
00:28:29,159 --> 00:28:31,980
yeah that's good point next cloud is one

623
00:28:31,980 --> 00:28:34,860
of the systems which is providing do you

624
00:28:34,860 --> 00:28:37,860
know is it like a fully written again or

625
00:28:37,860 --> 00:28:39,480
are they using some existing old

626
00:28:39,480 --> 00:28:42,020
technology

627
00:28:50,100 --> 00:28:51,720
yeah

628
00:28:51,720 --> 00:28:54,120
so and that that might be something what

629
00:28:54,120 --> 00:28:56,220
you want to try out because all of the

630
00:28:56,220 --> 00:28:58,500
culinary systems and those are full of

631
00:28:58,500 --> 00:29:00,480
these kind of features I haven't tested

632
00:29:00,480 --> 00:29:01,980
any other because I'm not using any

633
00:29:01,980 --> 00:29:05,400
others I'm using mainly Apple products

634
00:29:05,400 --> 00:29:08,820
for daily basis so that's why I've

635
00:29:08,820 --> 00:29:11,640
tested that so if your exchange user go

636
00:29:11,640 --> 00:29:13,260
ahead and test it or if you're using

637
00:29:13,260 --> 00:29:16,260
some other system I recommend to try out

638
00:29:16,260 --> 00:29:18,480
I know that 10 years ago there has been

639
00:29:18,480 --> 00:29:21,059
more uh vulnerabilities like this in

640
00:29:21,059 --> 00:29:23,460
those also in servers server side so

641
00:29:23,460 --> 00:29:26,840
that might be something to check out

642
00:29:27,240 --> 00:29:31,220
any other questions or comments

643
00:29:31,380 --> 00:29:33,240
all right looks good

644
00:29:33,240 --> 00:29:37,520
thank you everyone and see you next time

