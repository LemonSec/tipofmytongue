1
00:00:00,000 --> 00:00:22,830
is he going to do

2
00:00:22,830 --> 00:00:30,929
ready madness are out he learned to
worry about hazards in the same

3
00:00:32,729 --> 00:00:42,510
whoo all right but also a bunch last
minute of folks coming in but thanks

4
00:00:42,510 --> 00:00:48,239
guys for coming today uh spending your
post launch coma with me a yeah I will

5
00:00:48,239 --> 00:00:52,260
no doubt exceed the expectations of
letting you sleep through for the next

6
00:00:52,260 --> 00:00:56,910
hour arm but thanks for coming out to
converge right this is 34 converge at

7
00:00:56,910 --> 00:01:00,569
six year for be sized Detroit are

8
00:01:00,570 --> 00:01:03,870
this is Detroit premier security
conference in case you haven't heard

9
00:01:03,870 --> 00:01:09,539
that repeated over and over but if you
see Kay toward & Falk a walk in coral

10
00:01:09,540 --> 00:01:10,140
leg

11
00:01:10,140 --> 00:01:14,310
Ryan harp anybody wearing a red shirt be
sure to give them a great big hug

12
00:01:14,310 --> 00:01:17,850
make it awkward let them know that you
appreciate the hard work they put in

13
00:01:17,850 --> 00:01:20,970
because it really wouldn't have been
possible without all the help

14
00:01:20,970 --> 00:01:24,658
before we get started talking about how
I stop worrying and expecting pentester

15
00:01:24,659 --> 00:01:31,560
mistakes me ask a couple questions the
audience who here is a blue team member

16
00:01:31,560 --> 00:01:34,530
who in the audience gets paid to defend
corporate networks

17
00:01:34,530 --> 00:01:38,070
there's dozens of us all right

18
00:01:38,070 --> 00:01:43,770
dozens and where are my red team dies
and who's getting it pay to to attack my

19
00:01:43,770 --> 00:01:45,149
networks

20
00:01:45,150 --> 00:01:48,750
ok good so go tell the the majority of
the last time you gave this presentation

21
00:01:48,750 --> 00:01:53,700
there's a entire platoon of folks and
they might want to go watch somewhere

22
00:01:53,700 --> 00:01:58,320
else we're gonna make fun of red team
folks a little bit last question

23
00:01:58,320 --> 00:02:01,800
who here has heard the adage that pen
testers you're sorry defenders have to

24
00:02:01,800 --> 00:02:03,450
be right a hundred percent of the time

25
00:02:03,450 --> 00:02:08,190
attackers only happy right once it's
pretty common we keep hearing this over

26
00:02:08,190 --> 00:02:13,770
and over and today I'm going to share
with you the teepees and the IOC's say

27
00:02:13,770 --> 00:02:17,400
you can expect and detect those pen test
the mistakes that way you can win how

28
00:02:17,400 --> 00:02:18,780
these engagements

29
00:02:18,780 --> 00:02:23,790
before we get into all that Who am I
some of you in the audience know me and

30
00:02:23,790 --> 00:02:26,790
for that i apologize you guys a sufferer

31
00:02:27,540 --> 00:02:32,579
those are you don't on the other lovable
Jeremy nielsen a long time I sec member

32
00:02:32,580 --> 00:02:35,670
i have been coming to my second meeting
since 2012

33
00:02:36,450 --> 00:02:41,280
I guess that makes me an old hat around
here are a lot of you may know me best

34
00:02:41,280 --> 00:02:46,709
for my trolling on Twitter and an IRC
but I love security operations i love

35
00:02:46,709 --> 00:02:50,700
digging into the packets i love watching
tcp down by love

36
00:02:50,700 --> 00:02:54,600
watch my ideas to learn to my sim alerts
a lot of stuff going on there's a lot of

37
00:02:54,600 --> 00:02:55,739
great information

38
00:02:55,739 --> 00:02:59,060
I really love to be digging into it and
inevitably

39
00:02:59,060 --> 00:03:03,200
i'm looking at a screen like this
somebody's gotta walk make the comment

40
00:03:03,200 --> 00:03:07,250
that looks a lot like the matrix right
and I don't even see the code anymore i

41
00:03:07,250 --> 00:03:11,390
I just see blonde brunette redhead apt1
shine up

42
00:03:12,050 --> 00:03:18,260
Russia going to go through and doing my
threat hunting and I'm digging through

43
00:03:18,260 --> 00:03:21,079
the ids alert kind of here what's going
on my network

44
00:03:21,080 --> 00:03:24,680
I tend to feel like this guy right now
is cool hunting for his prey

45
00:03:24,680 --> 00:03:27,590
I feel like a real badass hey I'm
digging in there i'm doing what's going

46
00:03:27,590 --> 00:03:30,170
on i'm chasing those people are breaking
the policies

47
00:03:30,170 --> 00:03:35,600
that's really kind of cool yeah it's
exciting

48
00:03:36,350 --> 00:03:40,430
my teams may tell you I'm a little bit
more like this guy right the Gordon

49
00:03:40,430 --> 00:03:44,090
Ramsey of security operations and
yelling at him for you know messing up

50
00:03:44,090 --> 00:03:49,130
how they're responding to malware or
something is not going right now

51
00:03:49,130 --> 00:03:55,310
I don't know that I deserve this but it
did make a guy cry once I don't see him

52
00:03:55,310 --> 00:03:58,220
in the audience who just won this one
guy cry

53
00:03:58,220 --> 00:04:03,980
I asked them to come in and stop circle
facebook so much but the view of blue

54
00:04:03,980 --> 00:04:04,488
team

55
00:04:04,489 --> 00:04:09,500
the review of security operations that I
hate the most is the view of a when a

56
00:04:09,500 --> 00:04:13,370
red team guy comes in and says yeah I
spent five minutes on your network i pop

57
00:04:13,370 --> 00:04:17,000
domain admin drops the 50-page report my
crops and walks out right

58
00:04:17,000 --> 00:04:20,180
it gives the view that the blue team
guys were just standing there like

59
00:04:20,180 --> 00:04:22,910
Walmart greeters saying hi welcome to
our network

60
00:04:22,910 --> 00:04:26,660
please don't steal anything you know
those Walmart greeters right here i was

61
00:04:26,660 --> 00:04:31,520
trying to leave and they want to look
what's inside your packets so I hate

62
00:04:31,520 --> 00:04:32,570
that view

63
00:04:32,570 --> 00:04:36,440
but the entire impetus for this
presentation all started with a phone

64
00:04:36,440 --> 00:04:39,469
call that our security outer that our
service desk received on a monday

65
00:04:39,470 --> 00:04:40,130
morning

66
00:04:40,130 --> 00:04:45,409
I executives admin assistant called up
the service that said hey my phone's not

67
00:04:45,410 --> 00:04:46,130
working

68
00:04:46,130 --> 00:04:49,130
would you guys mind coming up and seeing
what's going on

69
00:04:49,130 --> 00:04:53,030
and anybody that's worked in any size of
an organization knows you do whatever

70
00:04:53,030 --> 00:04:55,429
you can for the executive admin is right

71
00:04:55,430 --> 00:04:58,550
they've got the ear of the people that
matter they know what's going on I know

72
00:04:58,550 --> 00:04:59,460
who's

73
00:04:59,460 --> 00:05:02,758
who's doing the right thing so of course
the service desk monkey goes running on

74
00:05:02,759 --> 00:05:05,759
up there was darkness brownie points

75
00:05:05,759 --> 00:05:09,690
he gets digging around under the
admissions desk and Edmonds heavies

76
00:05:09,690 --> 00:05:16,020
these huge phone systems they have these
multi-line consoles they have these

77
00:05:16,020 --> 00:05:19,349
additional biol pads and there's cables
going everywhere right

78
00:05:19,889 --> 00:05:23,250
service desk guys looking around under
the dads and kind of weeding through the

79
00:05:23,250 --> 00:05:25,259
cables and try to figure out what's
going on

80
00:05:25,259 --> 00:05:28,979
you can't make heads or tails of it but
some of them looks unplug and if the

81
00:05:28,979 --> 00:05:32,758
cable is unplugged that's a network team
job right now our cables never guys so

82
00:05:32,759 --> 00:05:35,849
now we're guy goes up there to plug in
the cable

83
00:05:35,849 --> 00:05:39,960
he's rooting around after a couple of
minutes calls up the security operations

84
00:05:39,960 --> 00:05:43,380
center comes with the sock and says hey
guys on this this phone issue

85
00:05:43,919 --> 00:05:48,930
yeah there's there's a device that looks
like it's plugged into the network and

86
00:05:48,930 --> 00:05:51,210
it's not one of ours

87
00:05:51,210 --> 00:05:56,638
so our incident response plan looks a
little something like this

88
00:05:58,229 --> 00:06:09,030
it's a little slow i apologize for that
but everybody's running around with her

89
00:06:09,030 --> 00:06:13,349
hair on fire and oh my gosh what's going
on is this an incident is it a pen test

90
00:06:13,349 --> 00:06:16,979
what's going on oh my gosh we got to
know what's going on everybody is lit up

91
00:06:17,729 --> 00:06:21,449
so we send a security operations guy up
there to take a look

92
00:06:21,449 --> 00:06:24,599
and in his best wisdom unplug the device

93
00:06:24,599 --> 00:06:27,599
unplug it from the network and brings it
back down

94
00:06:27,599 --> 00:06:31,800
probably shouldn't have done that but it
is what it is right so we're looking at

95
00:06:31,800 --> 00:06:33,180
thing over

96
00:06:33,180 --> 00:06:37,680
we're not quite sure what it is this is
exactly what the the device look like

97
00:06:37,680 --> 00:06:41,250
we're looking at over to try to figure
out what the heck it is we're looking

98
00:06:41,250 --> 00:06:44,849
for some sort of asset ID trying to make
sure if it's one of ours

99
00:06:44,849 --> 00:06:47,190
looking for some sort of stickers are
thinking that there might be one of

100
00:06:47,190 --> 00:06:50,880
these or are looking for a logo and let
us know what the Pony Express maybe a

101
00:06:50,880 --> 00:06:54,960
fresh sticker but we're not seeing
anything right

102
00:06:54,960 --> 00:06:59,460
it turns out as we dig into this it's an
intel knock some new unit of computing

103
00:06:59,460 --> 00:07:04,620
and it is micro form factor pc he had
some laptop memory

104
00:07:05,250 --> 00:07:09,419
you had a hard drive had a couple of
dongles traditional network adapters and

105
00:07:09,419 --> 00:07:10,680
gsm modem

106
00:07:10,680 --> 00:07:15,030
right but as we're going through the
same were like well it's kind of hard

107
00:07:15,030 --> 00:07:17,099
drive

108
00:07:17,100 --> 00:07:20,280
what's on the hard drive what's in the
box what's in the box

109
00:07:21,509 --> 00:07:26,490
so are one of our stock analysts used to
be a service desk monkey

110
00:07:27,539 --> 00:07:30,840
he had a few adapters managed to get one
of those we can mount the drives got a

111
00:07:30,840 --> 00:07:34,289
fun kid after a month of driving we find
out

112
00:07:34,289 --> 00:07:38,969
sure enough it's not encrypted if you
drop a box behind enemy lines and you

113
00:07:38,970 --> 00:07:41,550
don't encrypt the data

114
00:07:41,550 --> 00:07:47,789
okay fine so we're gonna get through
this thing and right away we find

115
00:07:47,789 --> 00:07:50,789
identifying information all over this
thing we love it we let us know that

116
00:07:50,789 --> 00:07:52,469
this was the pen testers box

117
00:07:52,470 --> 00:07:56,370
we recognize the name of the company was
somebody that we were expecting business

118
00:07:56,370 --> 00:08:00,810
with I and so that lower the threat
level right away okay we know this is

119
00:08:00,810 --> 00:08:04,380
not an incident this is just a pen test
of some sort of threat level reduced

120
00:08:04,380 --> 00:08:07,139
we're digging around

121
00:08:07,139 --> 00:08:10,979
we've got all their tools we've got
access to all the cords that their use

122
00:08:10,979 --> 00:08:14,550
it which is great for us because then
that gives us a platform to play with

123
00:08:14,550 --> 00:08:19,740
later but we've also got their logs
we've got bash history

124
00:08:19,740 --> 00:08:22,620
so we're digging through the bastard
file and seeing all the commands that

125
00:08:22,620 --> 00:08:26,669
they're running through and we managed
to see that they're trying to

126
00:08:26,669 --> 00:08:28,409
troubleshoot the network connection

127
00:08:28,409 --> 00:08:34,950
okay to run an act bypass scripts and
some running some mac tools they

128
00:08:34,950 --> 00:08:39,240
obviously did not get onto our network
we see in the long as you see in the

129
00:08:39,240 --> 00:08:42,450
past history there trying to figure out
what's going on around 3am they gave up

130
00:08:42,450 --> 00:08:47,459
and then of course the next morning the
executive admin finds her phone's not

131
00:08:47,459 --> 00:08:52,020
working because they're plugged into one
of the dial pad is that it actually into

132
00:08:52,020 --> 00:08:54,939
the network

133
00:08:54,940 --> 00:08:59,350
as we get through the logs in bash
history

134
00:08:59,350 --> 00:09:02,410
we also noticed that they were
communicating back to a command control

135
00:09:02,410 --> 00:09:05,319
host and they were clever

136
00:09:05,320 --> 00:09:09,340
they weren't using passwords right they
were using ssh keys that they managed to

137
00:09:09,340 --> 00:09:11,260
leave on the box

138
00:09:11,260 --> 00:09:16,660
now what happens next is a bit
contentious we're not entirely sure what

139
00:09:16,660 --> 00:09:23,469
happened but somewhere of the next
morning the guy who sets up our pen test

140
00:09:23,470 --> 00:09:27,970
engagements get some secure text
messages from the pen testers say in

141
00:09:27,970 --> 00:09:33,190
their command-and-control host which is
also the mail server was completely

142
00:09:33,190 --> 00:09:34,060
bombed

143
00:09:34,060 --> 00:09:38,680
you have no idea what happened they're
not able to get the thing but-- they

144
00:09:38,680 --> 00:09:43,209
have no IP addresses they have no
information at all but something went

145
00:09:43,210 --> 00:09:46,210
wrong and it's obviously our fall right

146
00:09:47,980 --> 00:09:56,770
I love this adapter through

147
00:09:57,670 --> 00:10:02,170
I love it

148
00:10:16,000 --> 00:10:19,000
premier security conference

149
00:10:21,880 --> 00:10:23,370
alright so offended

150
00:10:23,370 --> 00:10:27,810
you're pissed right and i'm going to say
that I can't blame them right i mean

151
00:10:27,810 --> 00:10:30,300
they're there to test our security

152
00:10:30,300 --> 00:10:33,510
good they're there to pawn off they're
not there to be the models of security

153
00:10:34,110 --> 00:10:41,490
I mean he was absolutely ticked off

154
00:10:41,490 --> 00:10:45,960
they they they just couldn't wrap their
mind around the fact that they had been

155
00:10:45,960 --> 00:10:49,200
owned that they have totally lost
control of the engagement and so they

156
00:10:49,200 --> 00:10:52,980
ended up storming off storming off the
engagement a rage quit they're like

157
00:10:52,980 --> 00:10:53,760
we're out here

158
00:10:53,760 --> 00:11:00,180
we're done League I was we had enough
that it was unrecoverable right so I I

159
00:11:00,180 --> 00:11:06,569
can't say that I blame them you know
they lost unencrypted sensitive data

160
00:11:06,570 --> 00:11:11,100
behind enemy lines that in segments are
trusted an untrusted networks that are

161
00:11:11,100 --> 00:11:15,600
communicating with a box is part of the
production network they had allegedly

162
00:11:15,600 --> 00:11:18,420
had their credential stolen and used
against them

163
00:11:18,420 --> 00:11:21,750
you know they had no detection for an
incident occurring on their network they

164
00:11:21,750 --> 00:11:26,550
had no incident response capabilities of
their own and their box stop working and

165
00:11:26,550 --> 00:11:29,849
they they were unable to proceed with
their pen test right so

166
00:11:29,850 --> 00:11:35,339
ah I don't blame them for being pissed
off you know it in the end nobody ended

167
00:11:35,339 --> 00:11:38,279
up messing up to own in the pen testers

168
00:11:38,279 --> 00:11:42,209
they had no logs the IP address nothing
to show what happened

169
00:11:42,209 --> 00:11:45,599
so last time I gave this presentation

170
00:11:46,800 --> 00:11:50,250
the platoon of pen testers in the back
like oh no you did it

171
00:11:50,250 --> 00:11:56,130
how dare you and in fact there is a
comment on the YouTube video on iron

172
00:11:56,130 --> 00:12:00,959
geek site you know where you know
company be unlawfully hex legit

173
00:12:00,959 --> 00:12:05,219
companies be company as machines you
know of course they walked off the pen

174
00:12:05,220 --> 00:12:10,620
test the well that's not the point of
this right and while this is this entire

175
00:12:10,620 --> 00:12:15,839
presentation is a vehicle for me to be
able to share this story and really make

176
00:12:15,839 --> 00:12:20,520
fun of these pen testers the real point
that I'm trying to drive across is that

177
00:12:20,520 --> 00:12:23,870
I my first pen test engagement

178
00:12:23,870 --> 00:12:29,600
I learned that we don't have to be right
a hundred percent of times and the

179
00:12:29,600 --> 00:12:32,630
pentek don't have to write once they
have to be right a lot as well

180
00:12:32,630 --> 00:12:36,740
they're going to make mistakes and we
can expect them we can detect them and

181
00:12:36,740 --> 00:12:39,230
then we can win on these engagements
right and that's the point

182
00:12:39,230 --> 00:12:42,470
it's not about the reverse hacking it's
about detecting the pen testers and you

183
00:12:42,470 --> 00:12:46,850
guys coming out as a blue team members
with a positive light after the

184
00:12:46,850 --> 00:12:54,080
engagement so i'm going to share for
simple use cases with you guys so you

185
00:12:54,080 --> 00:12:57,710
guys can help detect pen testers on your
network first going to talk about

186
00:12:57,710 --> 00:13:00,230
detecting the common tool to pen testers
use it

187
00:13:00,230 --> 00:13:03,080
this is actually really great there's
gonna be a lot of IOC's in there they

188
00:13:03,080 --> 00:13:07,100
can use their talk briefly about
detecting road machines on your network

189
00:13:07,670 --> 00:13:10,910
we're going to talk about detecting pass
the hash attacks

190
00:13:10,910 --> 00:13:15,050
I'm not just because pen testers use
those but it's a common lateral movement

191
00:13:15,050 --> 00:13:17,120
from any type of attacker

192
00:13:17,120 --> 00:13:20,750
well talk briefly about detecting brute
force attacks because it's rather boring

193
00:13:21,260 --> 00:13:24,290
we're going to wrap up with talking
about what do you do once you find pen

194
00:13:24,290 --> 00:13:27,020
testers on your network how do you do
incident response there

195
00:13:27,020 --> 00:13:33,350
so for each one of those you know and
Stimpy I have a song right what roles

196
00:13:33,350 --> 00:13:37,310
downstairs alone or in pairs was over
the neighborhood neighbor's dog his logs

197
00:13:37,310 --> 00:13:42,439
right arm every use cases going to
divide a different job depends on what

198
00:13:42,440 --> 00:13:44,029
we call these are dependencies

199
00:13:44,029 --> 00:13:47,330
you've got a lot of great information on
your network if you're not pulling logs

200
00:13:47,330 --> 00:13:50,690
and looking at them regularly you're
missing out on a treasure trove of data

201
00:13:50,690 --> 00:13:55,339
is going to help you better defend your
networks and of course it's really hard

202
00:13:55,339 --> 00:13:59,900
to use all those terabytes along unless
you've got some sort of sim right hole

203
00:13:59,900 --> 00:14:03,980
and have a log aggregator pulling those
logs into a centralized system have a

204
00:14:03,980 --> 00:14:08,930
tool that allows you to write simple
alerts so when these things pop up you

205
00:14:08,930 --> 00:14:12,500
can get alerted rather immediately
rather than having to find out when you

206
00:14:12,500 --> 00:14:15,050
get a pen test to record a week later

207
00:14:15,050 --> 00:14:19,219
I'm a little partial arcsight it

208
00:14:19,910 --> 00:14:24,319
it is that you need a a whopper class
machine in order to run it but once

209
00:14:24,320 --> 00:14:26,810
you've got it up and running is
fantastic so everybody wants to talk our

210
00:14:26,810 --> 00:14:28,819
site with me afterwards can find me

211
00:14:28,820 --> 00:14:35,000
I love that tool but i think the big
takeaway from this isn't just taken away

212
00:14:35,000 --> 00:14:38,390
the IOC's that i have here because
eventually going to get to a pen test

213
00:14:38,390 --> 00:14:41,899
where these these are techniques are no
longer valid

214
00:14:42,649 --> 00:14:48,290
the IOC's are no longer valid to keep up
with red team presentations on iron

215
00:14:48,290 --> 00:14:52,730
geeks aight i'll look at the tools and
techniques that are being developed

216
00:14:52,730 --> 00:14:55,100
figure out how they work

217
00:14:55,100 --> 00:14:58,610
figure out how you can use them on your
network practice with them look at the

218
00:14:58,610 --> 00:15:01,820
red team reports that are being
delivered to you and ask the red team

219
00:15:01,820 --> 00:15:02,779
members

220
00:15:02,779 --> 00:15:05,600
don't make fun of them and don't do it
after you hacked back of the machines

221
00:15:05,600 --> 00:15:10,970
but work with them to understand how the
attack works and how you can recreate

222
00:15:10,970 --> 00:15:13,579
that attack that they used on your
network

223
00:15:13,579 --> 00:15:17,810
look at the logs look what Jack gets
generated of what you can learn on later

224
00:15:17,810 --> 00:15:21,589
on because this will get you so far as a
lot of gimmicky stuff in here and it's

225
00:15:21,589 --> 00:15:27,140
only gonna get you so far so I continue
to learn continue to hunt for new ways

226
00:15:27,140 --> 00:15:31,819
that you're going to be exploited and
then my slides are not actually going to

227
00:15:31,820 --> 00:15:35,810
be online and i actually forgot to bring
the handouts with me so i will post the

228
00:15:35,810 --> 00:15:39,680
actual IOC's you guys don't need a
furiously right all this information

229
00:15:39,680 --> 00:15:45,290
down but we will post the slides for the
the IOC's that you want to use online

230
00:15:45,290 --> 00:15:48,980
some place so we might as well get right
into it right

231
00:15:49,550 --> 00:15:54,709
pen testers love their tools they really
love their tools

232
00:15:54,709 --> 00:15:57,859
it makes for a repeatable process right

233
00:15:57,860 --> 00:16:02,329
they can go from client to client they
can reuse a lot of the same code

234
00:16:02,329 --> 00:16:06,920
a lot of the same techniques and this
also gets pivoted because more of the

235
00:16:06,920 --> 00:16:11,180
unscrupulous companies can become
pentest puppy mills

236
00:16:11,180 --> 00:16:16,040
we never secure our networks were all
vulnerable to msoe no 67 or whatever the

237
00:16:16,040 --> 00:16:16,939
the

238
00:16:16,940 --> 00:16:21,170
the harbinger of the day is you want to
offend our networks adequate we don't

239
00:16:21,170 --> 00:16:25,400
patch those vulnerabilities and so they
sure enough have the right tools to

240
00:16:25,400 --> 00:16:30,350
exploit that and then they can script
for a junior pentester send them out

241
00:16:30,350 --> 00:16:35,330
drop the 20 page report and they are
done making built boatloads of money for

242
00:16:35,330 --> 00:16:39,170
this use case you're going to want to
have proxy logs proxy logs are

243
00:16:39,170 --> 00:16:43,579
invaluable just normally if your proxy
doesn't provide security relevant

244
00:16:43,580 --> 00:16:50,090
categorization letting you know about
malicious outbound sources or hacking

245
00:16:50,090 --> 00:16:56,870
computer security categories you can use
those to build rules around with the

246
00:16:56,870 --> 00:16:58,640
categories being popped in there

247
00:16:58,640 --> 00:17:02,810
we got to have some sort of proxy locks
if you don't have any type of proxy log

248
00:17:02,810 --> 00:17:03,739
shame on you

249
00:17:03,740 --> 00:17:08,750
i recommend blue coat but you can at
least pull dns logs and if you're not

250
00:17:08,750 --> 00:17:13,520
getting papac's logs have to do is log
sorry if you got windows dns servers are

251
00:17:13,520 --> 00:17:16,819
your admins are going to complain that
it's a resource hog and chewing up

252
00:17:16,819 --> 00:17:17,990
resources

253
00:17:17,990 --> 00:17:21,770
turn on the bug pull those in your sim
you got to do it there's a lot of great

254
00:17:21,770 --> 00:17:22,790
information there

255
00:17:22,790 --> 00:17:28,188
so probably the the tool that pen
testers are used most I think every pen

256
00:17:28,189 --> 00:17:33,710
tester is going to touch cali backtrack
at some point in time it's universal

257
00:17:33,710 --> 00:17:37,340
right the tools already pre-installed
they work out of the box i don't have to

258
00:17:37,340 --> 00:17:40,129
to mess with it there's no muss no fuss

259
00:17:40,130 --> 00:17:47,360
so it's not surprising you're going to
find this on your network and Kelly's

260
00:17:47,360 --> 00:17:51,260
got the slogan right the quieter you
become the more you're able to hear

261
00:17:51,770 --> 00:17:56,870
I find this really funny because kali
linux by itself is actually very noisy

262
00:17:57,380 --> 00:18:03,500
so Kelly linux is really a noisy during
installation so when you're installing

263
00:18:03,500 --> 00:18:06,440
this in a vm hear a song that's on a
hard drive

264
00:18:06,440 --> 00:18:10,370
it's making all sorts of calls out after
the first boot

265
00:18:10,370 --> 00:18:16,699
it's making calls out to to check for
updates anytime you install a new tool

266
00:18:16,700 --> 00:18:18,720
anytime you do apt-get update

267
00:18:18,720 --> 00:18:24,419
it's making calls all right let's not
forget that Kelly too . no implemented

268
00:18:24,419 --> 00:18:26,669
automatic updates on a weekly basis

269
00:18:26,669 --> 00:18:30,330
it's going to be calling out and looking
for updates now it's worth noting at

270
00:18:30,330 --> 00:18:34,678
this point the live CD doesn't appear to
actually check for updates so if your

271
00:18:34,679 --> 00:18:37,559
pen testers are going live

272
00:18:37,559 --> 00:18:40,620
it's less likely going to find them
through these methods

273
00:18:40,620 --> 00:18:46,139
there's other ways but not this way so
needless to say if your pen testers are

274
00:18:46,140 --> 00:18:50,159
seeing this on their machine and they're
on my network I've detected them right

275
00:18:50,159 --> 00:18:56,490
dns and HTTP logs proxy logs and EMS
lost so what we're looking for are just

276
00:18:56,490 --> 00:18:58,140
three IOC's here right

277
00:18:58,140 --> 00:19:02,460
you're looking for calls out to http
that Kelly door security that Kelly that

278
00:19:02,460 --> 00:19:06,870
org and archive is some number i usually
see archive dashboard and Kelly that org

279
00:19:06,870 --> 00:19:12,658
you may see a number between one and
nine so look for calls out to this

280
00:19:12,659 --> 00:19:17,220
somebody can go to www.healthcare.gov
not trigger your rule but any app get

281
00:19:17,220 --> 00:19:20,309
any installation

282
00:19:20,309 --> 00:19:23,309
anything that gets updated holes
directly from these repositories

283
00:19:24,030 --> 00:19:27,120
so look for calls out to those that's
going to be your harbinger of death

284
00:19:27,120 --> 00:19:35,489
now i also found that during the
installation of cali it ask you to

285
00:19:35,490 --> 00:19:39,750
select the time zone once it's like what
time zone you're in me to call out to be

286
00:19:39,750 --> 00:19:45,390
in that pool that ntp door now we've got
a lot of d behind a network that might

287
00:19:45,390 --> 00:19:47,070
be a big false positive

288
00:19:47,070 --> 00:19:50,340
but you've got about primarily windows
network keep an eye out for that

289
00:19:50,340 --> 00:19:51,629
shouldn't be there

290
00:19:51,630 --> 00:19:54,929
one thing that shouldn't be there unless
you're running on unless you're building

291
00:19:54,929 --> 00:19:55,830
network cards

292
00:19:55,830 --> 00:19:59,580
there's a weekly update after the first
boot about a half an hour after the

293
00:19:59,580 --> 00:20:05,250
first boot and then weekly after that
there's some app that gets the mac

294
00:20:05,250 --> 00:20:09,570
oh you I database so you can identify
probably through air crack or something

295
00:20:10,260 --> 00:20:13,210
what the network card is that you're
dealing with

296
00:20:13,210 --> 00:20:17,770
so it downloads this like 40 Meg file of
all the macro you is from standards that

297
00:20:17,770 --> 00:20:20,139
i triple e door

298
00:20:20,140 --> 00:20:24,880
that's going to be rare on your network
look for that happens regularly pen

299
00:20:24,880 --> 00:20:26,799
testers don't turn that stuff off

300
00:20:26,799 --> 00:20:29,740
we're going to come on your network
they're going to think I've got a

301
00:20:29,740 --> 00:20:30,909
pre-installed

302
00:20:30,909 --> 00:20:35,110
but then middle of the week is going to
update the macro you I database and

303
00:20:35,110 --> 00:20:35,979
you're going to find them

304
00:20:35,980 --> 00:20:42,909
now some Panthers use metasploit a lot
of a more junior pen testers use

305
00:20:42,909 --> 00:20:44,679
metasploit some of the older ones

306
00:20:44,679 --> 00:20:48,580
that's our script kiddies right but at
some point I think we all use metasploit

307
00:20:48,580 --> 00:20:50,289
on the network

308
00:20:50,289 --> 00:20:55,720
perhaps somebody's breaking violating
some sort of policy may be trying to use

309
00:20:55,720 --> 00:21:01,840
metasploit - boy doesn't update when you
run it but every guide that i look at

310
00:21:01,840 --> 00:21:04,059
from a pencil securities - boy guide

311
00:21:04,059 --> 00:21:07,720
I all the way to the hacker playbook
always says before you run msf

312
00:21:07,720 --> 00:21:10,419
council-run msf update

313
00:21:10,419 --> 00:21:14,080
who's going to avoid guidance like
they're right so in kali linux when you

314
00:21:14,080 --> 00:21:18,580
update metasploit it pulls from the
repository HT to http that Kelly that or

315
00:21:18,580 --> 00:21:22,809
there's a sub you are I that specific
matters boy whom look that up but if

316
00:21:22,809 --> 00:21:25,990
you're just looking for HTTP that Kelly
that org going to be fine

317
00:21:25,990 --> 00:21:32,049
other versions I think like samurai WTF
and other installations actually pulled

318
00:21:32,049 --> 00:21:35,350
directly from updates that matters . com
so take a look at both of those and

319
00:21:35,350 --> 00:21:37,330
you'll find those guys when they pop on
your network

320
00:21:37,330 --> 00:21:41,439
now I love web application assessments

321
00:21:41,440 --> 00:21:45,460
I love digging into how a web
application works and get a toy around

322
00:21:45,460 --> 00:21:49,510
with the actual request that are going
in there when you open up

323
00:21:50,080 --> 00:21:54,760
burp suite on cali for the first time
even if you tell it don't send amount of

324
00:21:54,760 --> 00:21:56,049
its usage statistics

325
00:21:56,049 --> 00:22:00,129
it makes connections out to perfect it
upward swing . net and pro that part

326
00:22:00,130 --> 00:22:04,210
figured on that every time that you open
it up afterwards thinking calls out to

327
00:22:04,210 --> 00:22:07,610
ports figured out net and I see this IP
address on there

328
00:22:07,610 --> 00:22:13,699
during my testing it didn't actually
make a dns call before i started going

329
00:22:13,700 --> 00:22:17,330
to that IP address and may be hard-coded
in there

330
00:22:17,330 --> 00:22:20,510
or maybe I just screwed something up
with my dns cache

331
00:22:20,510 --> 00:22:25,160
either way that may change in the future
but it might be a good indicator there

332
00:22:25,160 --> 00:22:30,200
are hosting at amazon AWS just keep an
eye out for it but somebody is loading

333
00:22:30,200 --> 00:22:31,340
up burp suite

334
00:22:31,340 --> 00:22:36,470
it's checking for updates and in their
developer forums pen testers have asked

335
00:22:36,470 --> 00:22:36,860
him

336
00:22:36,860 --> 00:22:40,280
we need the ability to turn this off and
developers are like okay thanks bye

337
00:22:41,030 --> 00:22:44,660
they're not going to do anything about
it so look for because that's never

338
00:22:44,660 --> 00:22:45,410
going to change

339
00:22:45,410 --> 00:22:50,419
look for ports figure that out on your
network now since we're doing talking

340
00:22:50,419 --> 00:22:53,299
about web application of 7th also like
Nick donate or give me some basic

341
00:22:53,299 --> 00:22:58,040
information about the web servers that
I'm looking at it doesn't update

342
00:22:58,040 --> 00:23:01,340
automatically you have to force it oh
who doesn't right

343
00:23:01,340 --> 00:23:05,870
you might as well look for WWE not
certain that now when you look at that

344
00:23:05,870 --> 00:23:07,040
in your logs

345
00:23:07,040 --> 00:23:10,399
my first inclination is that some sort
of computer incident response team

346
00:23:11,179 --> 00:23:17,480
maybe us serve carnegie mellon sir right
maybe just a lame but take a look at it

347
00:23:17,480 --> 00:23:17,960
right

348
00:23:17,960 --> 00:23:22,250
if you see calls out to that it probably
shouldn't be there and since you're

349
00:23:22,250 --> 00:23:23,690
looking for Nick go anyway

350
00:23:23,690 --> 00:23:29,510
look for user agent string that contain
the word make oh now you're not to be

351
00:23:29,510 --> 00:23:32,570
able to do anything when somebody's
attacking your external website and

352
00:23:32,570 --> 00:23:35,178
you're seeing that in there but if you
see this stuff sourced internally

353
00:23:35,179 --> 00:23:38,390
somebody's doing something that they
showed it right so just keep an eye out

354
00:23:38,390 --> 00:23:43,280
for it but actually you're more likely
to see a nap antacids melty go

355
00:23:43,820 --> 00:23:47,629
LT goes gray right gives me a the
ability or gives the pen test is the

356
00:23:47,630 --> 00:23:52,370
ability to gather OS sent to pull
together a lot of information on an

357
00:23:52,370 --> 00:23:57,080
organization to display it to be able to
use that to to help and aid in their

358
00:23:57,080 --> 00:23:59,540
exploitation

359
00:23:59,540 --> 00:24:02,540
so in kali linux when you open up

360
00:24:03,890 --> 00:24:07,100
melty go for the first time

361
00:24:07,100 --> 00:24:12,020
you get the standard hi welcome to melt
egos mean when you get to this screen

362
00:24:12,020 --> 00:24:15,679
you have already transmitted 1500
packets to perturb that , my network

363
00:24:16,190 --> 00:24:20,990
by the time you get to the end of the
setup screen you can communicate 30,000

364
00:24:20,990 --> 00:24:23,240
packets to perturb on my network

365
00:24:23,240 --> 00:24:26,990
there's a lot of great stuff in there
that you can use to detect them if

366
00:24:26,990 --> 00:24:30,559
somebody's use a melty go on your
network and then after one of my

367
00:24:30,559 --> 00:24:31,639
presentation

368
00:24:31,640 --> 00:24:34,580
somebody asked about core impact I've
never seen core impact use but i

369
00:24:34,580 --> 00:24:38,449
understand there are some teams that
will use this for doing vulnerability

370
00:24:38,450 --> 00:24:44,059
assessments so just in case one of those
companies make a local Detroit company

371
00:24:44,059 --> 00:24:49,970
is using core security on your network
just look for update coming from impact

372
00:24:49,970 --> 00:24:52,970
of course security com

373
00:24:54,919 --> 00:25:01,610
so I'm giving me a lot of gimmicky basic
tools that pen testers are used in many

374
00:25:01,610 --> 00:25:05,539
ways to detect that but think a little
bit broader think about the tools the

375
00:25:05,539 --> 00:25:08,900
pen testers need to do their jobs penosa
just like the rest of us they need food

376
00:25:08,900 --> 00:25:11,240
they need water they need hugs

377
00:25:11,240 --> 00:25:17,059
they also have to file their TPS reports
they have to file their timesheets they

378
00:25:17,059 --> 00:25:20,450
need to check mail and understand what's
going on at back at the office

379
00:25:21,020 --> 00:25:24,950
you need to get yelled at by the boss
right so they probably got to connect to

380
00:25:24,950 --> 00:25:30,530
the VPN someplace they probably got to
connect a webmail owa got some mail that

381
00:25:30,530 --> 00:25:35,059
something that they're checking into so
if you know what company or pen testers

382
00:25:35,059 --> 00:25:39,740
I come from if you know what company
your boss is going to be outsourcing to

383
00:25:39,740 --> 00:25:45,260
whether its rapid seven or whoever it is
do a little bit of reconnaissance on

384
00:25:45,260 --> 00:25:47,539
them before the engagement instead of
pools

385
00:25:47,539 --> 00:25:53,360
look for their mail for example rapid7
not to call them out without an

386
00:25:53,360 --> 00:25:54,439
engagement their meal

387
00:25:54,440 --> 00:25:59,270
are there are VPN servers or mario and
luigi to grab at seven calm and they've

388
00:25:59,270 --> 00:26:02,740
got some script that run that was
running on a network

389
00:26:02,740 --> 00:26:13,720
look for for weird things going back to
weird rapid 7.com sites right all right

390
00:26:13,720 --> 00:26:15,370
let's talk

391
00:26:15,370 --> 00:26:18,489
out detecting road machines on network

392
00:26:18,490 --> 00:26:21,850
you're going you got contestants that
are an engagement

393
00:26:21,850 --> 00:26:25,990
they're coming in and dropping off boxes
like they were trying to do it and at

394
00:26:25,990 --> 00:26:27,850
their engagement with us

395
00:26:27,850 --> 00:26:32,639
you're going

396
00:26:32,640 --> 00:26:35,520
scary boxes dropped off on your network
that you don't know about and they're

397
00:26:35,520 --> 00:26:36,510
trying to hide

398
00:26:36,510 --> 00:26:39,660
you're going to want to detect those as
early as possible so during another pen

399
00:26:39,660 --> 00:26:44,670
test engagement we had folks that were
sitting on our network we detected them

400
00:26:44,670 --> 00:26:48,600
early on because we detected metasploit
and Kelly be calling out we were right

401
00:26:48,600 --> 00:26:51,540
on the first day we detect these guys
are only out we knew it was pen testers

402
00:26:51,540 --> 00:26:54,690
we knew it was going on we ignore the
alerts are being generated we just let

403
00:26:54,690 --> 00:26:56,070
them do what they wanted

404
00:26:56,070 --> 00:26:58,620
because we wanted to work with them
right we want to understand what are

405
00:26:58,620 --> 00:27:02,340
vulnerabilities are so we just let them
run and have fun and being the exciting

406
00:27:02,340 --> 00:27:06,090
and exhilarating guy that I am I spent
my Saturday's threat hunting i go

407
00:27:06,090 --> 00:27:09,179
digging through the same i looked for
active channels in dark side and see

408
00:27:09,180 --> 00:27:12,210
what's going on and that weekend I
wanted to see you

409
00:27:12,210 --> 00:27:15,450
we have been keeping track these pen
testers what what were they doing on the

410
00:27:15,450 --> 00:27:20,340
network and we had some alerts we had
some IP addresses but it looked like

411
00:27:20,340 --> 00:27:24,030
they were changing their IP addresses
how do you keep track of pen testers are

412
00:27:24,030 --> 00:27:27,330
changing their IP addresses so after a
little bit of thought it became obvious

413
00:27:27,330 --> 00:27:31,350
there's likely they're changing their IP
addresses but not their mac address

414
00:27:31,350 --> 00:27:32,129
right

415
00:27:32,130 --> 00:27:37,290
so for this use case you want to pull
your dhcp logs and you don't point your

416
00:27:37,290 --> 00:27:42,629
dns logs gonna get the host names out of
the dns log they're making requests and

417
00:27:42,630 --> 00:27:46,410
you want to get the the host things out
of dhcp logs as well as the mac

418
00:27:46,410 --> 00:27:50,070
addresses can be a bit of pain in the
butt but this is this is kind of an easy

419
00:27:50,070 --> 00:27:56,310
win your guys now as a bigger through
are trying to find the pen testers i

420
00:27:56,310 --> 00:27:59,490
started with an own IP address
management see these guys were used in

421
00:27:59,490 --> 00:28:02,700
vmware and when I started digging
through some of the other IP addresses

422
00:28:02,700 --> 00:28:03,810
that are being used

423
00:28:03,810 --> 00:28:09,060
ah i saw another mac address sure enough
I pull up a list of of virtualized

424
00:28:09,060 --> 00:28:13,470
virtualization mac addresses online so i
created a rule for that went through and

425
00:28:13,470 --> 00:28:16,980
start digging through the older to
manage to see all the times that they

426
00:28:16,980 --> 00:28:20,160
were changing their IP addresses not
only I had a trail that i can go from

427
00:28:20,160 --> 00:28:24,690
there hostname and IP address when they
change the hostname not a big deal when

428
00:28:24,690 --> 00:28:26,070
they changed their IP address

429
00:28:26,070 --> 00:28:28,230
not a big deal now have a trail to go
with

430
00:28:28,230 --> 00:28:33,840
because i was looking for the mac
addresses now it's easy enough to to get

431
00:28:33,840 --> 00:28:39,389
a new address right eh client eth0 on
linux right ipconfig / release renew our

432
00:28:39,390 --> 00:28:40,320
windows

433
00:28:40,320 --> 00:28:44,189
it's pretty easy to change the mac
address in vmware you just go into the

434
00:28:44,190 --> 00:28:47,460
options right put pen testers don't seem
to do this

435
00:28:47,460 --> 00:28:51,720
and since you're looking for mac
addresses you might as well look for a

436
00:28:51,720 --> 00:28:58,140
joker as well so what I ended up finding
as I was to get through the mac

437
00:28:58,140 --> 00:29:02,070
addresses was actually we had one guy
that was using vmware we have the other

438
00:29:02,070 --> 00:29:06,990
guy that was using virtual host or
virtual box and add some isn't going

439
00:29:06,990 --> 00:29:09,600
through and and diagramming out where
they were going on what they were

440
00:29:09,600 --> 00:29:12,540
hitting it became obvious this was two
separate people

441
00:29:12,540 --> 00:29:17,340
I think it was the older guy that was
used in virtualbox but as I'm explaining

442
00:29:17,340 --> 00:29:18,899
this to the rest of the team

443
00:29:18,900 --> 00:29:21,840
it became easier just to refer to these
guys thing one and thing two right so

444
00:29:21,840 --> 00:29:25,470
attributions sucks when you're trying to
figure out whether it's China or Russia

445
00:29:25,470 --> 00:29:29,220
is pretty useless but at least for
understanding what's going on on the

446
00:29:29,220 --> 00:29:31,919
inside of your network attributions
actually pretty reasonable things that

447
00:29:31,919 --> 00:29:36,870
can identify and separate out different
actors on your network do it

448
00:29:36,870 --> 00:29:42,629
and so there are you looking at mac
addresses and got a list of host names

449
00:29:42,630 --> 00:29:45,150
when I think it one step further right

450
00:29:45,150 --> 00:29:48,990
monitor all the mac addresses on your
network look for new things that are

451
00:29:48,990 --> 00:29:50,190
popping up

452
00:29:50,190 --> 00:29:54,000
look for new host that shouldn't be
there now we all work in large

453
00:29:54,000 --> 00:29:58,470
organizations everybody comes in every
day you've got 1,500 knew I you know

454
00:29:58,470 --> 00:30:03,900
discover and request and you know you
you've got all sorts of dhcp logs are

455
00:30:03,900 --> 00:30:04,679
coming in

456
00:30:04,679 --> 00:30:10,230
you're gonna think it's impossible to do
start with your net standard naming

457
00:30:10,230 --> 00:30:13,410
conventions start with the things that
you know are good right when you're not

458
00:30:13,410 --> 00:30:18,210
being attack when things are low start
looking at what supposed to be there

459
00:30:18,210 --> 00:30:20,309
will commonly shows up right

460
00:30:20,309 --> 00:30:23,370
look at your standard naming convention
look at the things that follow whatever

461
00:30:23,370 --> 00:30:26,939
it is that you use all of our companies
use standard naming conventions because

462
00:30:26,940 --> 00:30:30,540
it makes it easier for service desk
folks but it makes it easy for us to

463
00:30:32,039 --> 00:30:36,600
so if you see things that stand out
right if you see iphone if you see

464
00:30:36,600 --> 00:30:39,988
Android see some weird printer address
in there right

465
00:30:39,989 --> 00:30:44,279
you see some vendor KPMG's on your
networker file . on your network and her

466
00:30:44,279 --> 00:30:46,710
showing up as vile . com

467
00:30:46,710 --> 00:30:51,239
and then maybe okay fine that somebody's
got Kelly that local domain because they

468
00:30:51,239 --> 00:30:52,289
didn't change

469
00:30:52,289 --> 00:30:59,158
VMware's dhcp settings the set of
different hosting and if you've got a

470
00:30:59,159 --> 00:31:03,359
box that you're not quite sure about it
looks like it means to name any standard

471
00:31:03,359 --> 00:31:05,728
but maybe it's a little bit different

472
00:31:05,729 --> 00:31:09,659
usps log in right you can of course go
into active directory losers computers

473
00:31:09,659 --> 00:31:13,259
and try and find the computer name and
you're gonna stumble around searching

474
00:31:13,259 --> 00:31:14,369
for this thing

475
00:31:14,369 --> 00:31:18,928
no just from your computer reach out PS
login to whack whack whatever the

476
00:31:18,929 --> 00:31:25,080
computer name is and even your standard
non privileged user credential should be

477
00:31:25,080 --> 00:31:27,809
able to query SMB on the box

478
00:31:27,809 --> 00:31:31,109
if you don't see your user ID reflected
back to you

479
00:31:31,679 --> 00:31:35,429
probably not part of your domain if it's
not part of your domain what you doing

480
00:31:35,429 --> 00:31:39,119
there is your way to investigate let you
know something is valid and out

481
00:31:39,119 --> 00:31:42,299
now after the last time i get this
presentation a red team guy that made

482
00:31:42,299 --> 00:31:47,519
the suggestion that if it's potentially
harmful if it's potentially malicious

483
00:31:47,519 --> 00:31:51,179
you want to send your credentials to
this box

484
00:31:51,179 --> 00:31:54,330
maybe not right so you're going to try
this

485
00:31:54,929 --> 00:31:59,309
be careful do it when it's not in the
middle of an incident do it when it's

486
00:31:59,309 --> 00:32:04,289
not the likelihood of having somebody
have a potentially bad box here and in

487
00:32:04,289 --> 00:32:08,070
any case have a canary account right
have a token account that you can set up

488
00:32:08,070 --> 00:32:11,700
that you've got an alert on elsewhere
that this thing shouldn't be used very

489
00:32:11,700 --> 00:32:14,549
often and when it does it let you guys
know

490
00:32:14,549 --> 00:32:18,269
so if somebody's capture that credential
some is capturing that ntlm handshake

491
00:32:18,269 --> 00:32:20,940
and cracking the password and we're
using throughout the past

492
00:32:20,940 --> 00:32:25,049
throughout the network you can detect
that so be careful but there's ways

493
00:32:25,049 --> 00:32:28,049
around it

494
00:32:29,840 --> 00:32:33,379
let's talk about it

495
00:32:33,380 --> 00:32:37,040
pass the hash attacks passion has
attacks are pretty common there's a

496
00:32:37,040 --> 00:32:38,840
variety of potential attacks right

497
00:32:38,840 --> 00:32:42,709
Active Directory attacks we got past the
ticket we got golden tickets overtaking

498
00:32:42,710 --> 00:32:44,270
we've got kerberos right

499
00:32:44,270 --> 00:32:47,780
contestants love using many cats and
windows credential editor and there's a

500
00:32:47,780 --> 00:32:51,950
lot of good credential attacks out there
you can read up on but I think past the

501
00:32:51,950 --> 00:32:57,170
hashtag is common enough and something
that you can actually detect and spend

502
00:32:57,170 --> 00:33:02,360
some time preventing you just turn off
until and we never turn off any alarm so

503
00:33:02,360 --> 00:33:06,590
i better that we can detect these
attacks when they attempted or

504
00:33:06,590 --> 00:33:11,629
successful and the way this works is I
mean penthouse has got a basic foothold

505
00:33:11,630 --> 00:33:13,910
in your network

506
00:33:13,910 --> 00:33:18,750
I see hinge back there I learned

507
00:33:18,750 --> 00:33:23,220
this from him from a couple years ago
when they get the basic foothold in the

508
00:33:23,220 --> 00:33:24,090
network

509
00:33:24,090 --> 00:33:26,760
they're going to look around dumping
credentials hoping that somebody is log

510
00:33:26,760 --> 00:33:30,600
into a box with domain admin credentials
or some sort of elevated privileges that

511
00:33:30,600 --> 00:33:33,389
they can then use to put it elsewhere in
the network or maybe get into your

512
00:33:33,390 --> 00:33:36,540
domain controller to start taking
control of more stuff

513
00:33:36,540 --> 00:33:42,060
the dependencies here you want to gather
windows security locks from as many

514
00:33:42,060 --> 00:33:43,830
machines you possibly can

515
00:33:43,830 --> 00:33:48,570
I'm not an advocate for log all the
things i think that the ways the time I

516
00:33:48,570 --> 00:33:50,159
think that's a waste of space

517
00:33:50,160 --> 00:33:53,790
I'll but windows security logs going to
want to get as many of these as possible

518
00:33:53,790 --> 00:33:58,230
and if you have limited space if you
have limited eps on your sim at least

519
00:33:58,230 --> 00:34:02,160
get a representative sample at least
focus on your critical machines but

520
00:34:02,160 --> 00:34:07,560
pulling those windows security logs now
pass the hash is an easy attack these

521
00:34:07,560 --> 00:34:09,960
guys to rock out to get access to a
machine

522
00:34:09,960 --> 00:34:14,220
they dumped the Sam to get a hash and
they can replay that hash

523
00:34:14,219 --> 00:34:18,480
I using something like PS exactly
there's tools in madison . they're going

524
00:34:18,480 --> 00:34:21,270
to use that hash and bounced from server
to server

525
00:34:21,270 --> 00:34:26,940
I've seen it used where on one of the
pen tests they were remotely starting

526
00:34:26,940 --> 00:34:31,770
power shell with a base64 encoded
payload that was launching a reverse

527
00:34:31,770 --> 00:34:34,918
shell connecting back so they're going
around the network rather than than

528
00:34:34,918 --> 00:34:38,580
pivoting around an hour here just pop in
box after box and have a connect back to

529
00:34:38,580 --> 00:34:40,980
the central management so that they can
use at a later time

530
00:34:40,980 --> 00:34:45,859
now if you

531
00:34:45,859 --> 00:34:49,940
oh how pass the hash works are several
guys out there that talk about handling

532
00:34:49,940 --> 00:34:52,190
and attacking pass the hash

533
00:34:52,190 --> 00:34:55,970
so if you need some background I start
with Microsoft's guide on mitigating

534
00:34:55,969 --> 00:35:01,759
pass the hash pretty good guide and gets
a little technical I was very limited

535
00:35:01,759 --> 00:35:05,660
the NSA also has a guide and reducing
the effectiveness of pass the hash

536
00:35:05,660 --> 00:35:10,940
attacks again it's it's okay well i
really like I think every pen test every

537
00:35:10,940 --> 00:35:14,690
blue team should have a copy of this
printed out distributed around your

538
00:35:14,690 --> 00:35:18,259
network have it on your bedside table
have it in the toilet wherever you go i

539
00:35:18,259 --> 00:35:22,190
love this guide spot in the adversary
with Windows Event log monitoring not

540
00:35:22,190 --> 00:35:24,140
just focusing on pass the hash attacks

541
00:35:24,140 --> 00:35:27,470
look at all sorts of credential attacks
and other attacks going on Windows

542
00:35:27,470 --> 00:35:31,759
domain and how you can detect those and
things that you can set up a very

543
00:35:31,759 --> 00:35:37,160
vendor-neutral so it's just showing you
from the windows log point of view

544
00:35:37,160 --> 00:35:43,759
what's going to trigger when certain
attacks along again and see people take

545
00:35:43,759 --> 00:35:44,989
a note so I'm leaving now

546
00:35:44,989 --> 00:35:51,170
leave it up there for a moment now
specifically for pass the hash attacks

547
00:35:51,170 --> 00:35:54,440
you're going to be looking for events
like this

548
00:35:54,440 --> 00:35:57,470
- now I know this is an eye chart you
guys aren't able to see this will blow

549
00:35:57,470 --> 00:36:02,390
us up here in a moment but every attack
because we don't turn off and tell em I

550
00:36:02,390 --> 00:36:07,670
every pass the hash attack starts off
this event ID to want 4624 4644 are

551
00:36:07,670 --> 00:36:09,170
successful login

552
00:36:09,170 --> 00:36:13,520
you can also look for - 6:25 to my case
a lot of false positives for that for

553
00:36:13,520 --> 00:36:19,579
some reason for some legacy apps you can
look for 4624 4625 these things are

554
00:36:19,579 --> 00:36:23,630
network login is right there not
interactive their network basis all SMB

555
00:36:23,630 --> 00:36:25,309
and he like multiplication

556
00:36:25,309 --> 00:36:29,150
we're going to look at the logon type 3
you're going to look for the account

557
00:36:29,150 --> 00:36:31,069
name being not at all

558
00:36:31,069 --> 00:36:39,020
now its twenty sixteen since as far back
as the year 2000 everybody's told been

559
00:36:39,020 --> 00:36:42,920
told to turn off all sessions and the
windows domains

560
00:36:42,920 --> 00:36:49,430
some people do some people don't you're
likely to see if you haven't turned off

561
00:36:49,430 --> 00:36:53,480
in all sessions a lot of ntlm no session
is going on in a network you can read

562
00:36:53,480 --> 00:36:54,230
those out

563
00:36:54,230 --> 00:36:58,069
we can turn it off at least when you're
detective or pass the hash the account

564
00:36:58,069 --> 00:37:01,069
name is that going to be empty so look
for something that's a their factories

565
00:37:01,069 --> 00:37:04,730
some of the attacks that I've seen in my
logging system the account name is

566
00:37:04,730 --> 00:37:11,630
actually been really weird that it's not
actual ah it was like random letters as

567
00:37:11,630 --> 00:37:15,380
well as popping up it may have just been
our site screwed something up but and

568
00:37:15,380 --> 00:37:18,650
then lastly you look for authentication
package and he liked the alternative

569
00:37:18,650 --> 00:37:21,680
here's curve rose and it's not a
kerberos attack is an anti-islam attack

570
00:37:22,309 --> 00:37:25,970
we can just mitigate this if we all
turned off ntlm and we know that

571
00:37:25,970 --> 00:37:29,750
executives don't want to bring down the
network and everybody there's that guy

572
00:37:29,750 --> 00:37:33,440
who sits in the corner and you can turn
off until I because it might it might

573
00:37:33,440 --> 00:37:35,990
break something we did we get to someone
to do that right

574
00:37:35,990 --> 00:37:40,040
turn off that Hill I never breaks
everything so if you're building a role

575
00:37:40,040 --> 00:37:40,970
in our site

576
00:37:40,970 --> 00:37:45,290
that's just what the rule looks like a
pretty simple pretty straightforward and

577
00:37:45,290 --> 00:37:48,319
once you got the rule set up the pen
testers start popping on the network if

578
00:37:48,319 --> 00:37:50,119
you get a lot of a particular device

579
00:37:50,119 --> 00:37:53,089
this is going to light up like a
Christmas tree gonna get a whole lot of

580
00:37:53,089 --> 00:38:04,450
alerts you to find out where these guys
are at and chase them down this

581
00:38:04,450 --> 00:38:09,040
flea about detecting the brute force
attacks the common headache on networks

582
00:38:09,040 --> 00:38:15,400
a lot of sim tools come with
pre-installed rules

583
00:38:16,150 --> 00:38:20,380
inevitably one of them is some you know
port scale attack on my external

584
00:38:20,380 --> 00:38:21,550
interface

585
00:38:21,550 --> 00:38:27,190
I i was speaking with a gentleman and an
auto supplier there

586
00:38:27,190 --> 00:38:31,599
mssp for sending them critical alerts
and you showed me a bunch of the

587
00:38:31,599 --> 00:38:35,079
critical alerts and one of the critical
alerts was you know an external ports

588
00:38:35,079 --> 00:38:37,990
can you know critical alert deal with
this now

589
00:38:37,990 --> 00:38:41,169
you can't do anything with that it was a
waste of freaking time

590
00:38:41,170 --> 00:38:44,349
so everybody with a reasonable amount of
of sense

591
00:38:44,349 --> 00:38:47,650
turn that off right they turned off the
rules report scans it there's nothing

592
00:38:47,650 --> 00:38:51,130
that they could do about it

593
00:38:51,130 --> 00:38:52,600
there are

594
00:38:52,600 --> 00:38:56,140
things that you can do with this the
dependencies for this use case are going

595
00:38:56,140 --> 00:38:59,620
to be firewall logs you are pulling all
your part of all along anyway right

596
00:39:00,190 --> 00:39:04,540
pull your firewall logs . windows
security logs going to show you the user

597
00:39:04,540 --> 00:39:09,279
logins and pulling your linux this long
as you let you know about the user is

598
00:39:09,280 --> 00:39:12,040
trying to log into your system as well
pull in from as many devices as you

599
00:39:12,040 --> 00:39:13,360
possibly can manage

600
00:39:13,360 --> 00:39:19,000
so I break this down into there's four
basic types of brute force attacks

601
00:39:19,000 --> 00:39:21,970
now I mean your break is out of the
subcategories and in the end he probably

602
00:39:21,970 --> 00:39:27,069
end up like 30 or 40 of these but I
break it out into four basic brute force

603
00:39:27,070 --> 00:39:28,180
use cases

604
00:39:28,180 --> 00:39:32,589
the first is used in casting right we've
got the same source trying different

605
00:39:32,590 --> 00:39:35,590
usernames that probably using the same
password right

606
00:39:36,310 --> 00:39:42,279
this searching for a foot hole you're
going to

607
00:39:42,840 --> 00:39:46,830
to the user names that are being gassed
these things legitimate did they

608
00:39:46,830 --> 00:39:51,150
actually exist on your network are they
just going through am San and Santos and

609
00:39:51,150 --> 00:39:57,420
tom l smith m smith and smith and they
using , wonder are they just casted

610
00:39:57,420 --> 00:40:02,610
they're probably looking with easy
passwords i worked at a large pizza

611
00:40:02,610 --> 00:40:06,270
company where pizza 1 2 3 was not
uncommon to find as a default password

612
00:40:06,270 --> 00:40:10,080
but your organization probably isn't too
different right

613
00:40:10,080 --> 00:40:13,170
we're no longer in spring people
probably change your passwords or

614
00:40:13,170 --> 00:40:19,980
service that is giving new password as
summer 2016 and maybe there's a list out

615
00:40:19,980 --> 00:40:24,840
there that somebody's riding through
with compromised credentials so there's

616
00:40:24,840 --> 00:40:28,560
a lot of good information that can be
seen from an alert like this arm and a

617
00:40:28,560 --> 00:40:31,830
lot of organizations you're gonna get
over ran with a lot of brute force

618
00:40:31,830 --> 00:40:36,180
attacks but someone is going through
different usernames from the same source

619
00:40:36,900 --> 00:40:43,080
that's a bit odd right take a look at
that point a bit more common and quite a

620
00:40:43,080 --> 00:40:46,890
bit more false positives come from
somebody from the same source

621
00:40:46,890 --> 00:40:51,390
the same username right , type of brute
force attack but this is also a lot of

622
00:40:51,390 --> 00:40:55,560
your stupid users and i'm going to call
the user stupid but you got the guy who

623
00:40:55,560 --> 00:40:59,520
can't remember his password three days
later comes back from vacation and needs

624
00:40:59,520 --> 00:41:02,610
to have his password reset right so he's
going to be the one that's popping these

625
00:41:02,610 --> 00:41:06,660
alerts most of the time but keep an eye
out for it anyway because it's going to

626
00:41:06,660 --> 00:41:08,520
be the pen test was trying to get in

627
00:41:08,520 --> 00:41:13,500
ah oui

628
00:41:13,500 --> 00:41:18,030
being in with all the other stupid uses
now how people that disagree with me

629
00:41:18,030 --> 00:41:21,480
that port scan isn't really a brute
force attack

630
00:41:21,480 --> 00:41:26,100
we can argue about that later i can do
that over beers tonight or whatever but

631
00:41:26,100 --> 00:41:30,150
when you think about it its most basic
level you're going through port by poor

632
00:41:30,150 --> 00:41:32,250
to see what's open what's closed

633
00:41:32,250 --> 00:41:36,600
you're going to host by host to see
what's what's available where where you

634
00:41:36,600 --> 00:41:37,950
can move to next right

635
00:41:37,950 --> 00:41:42,089
your brute forcing going through every
sixty five thousand words on the machine

636
00:41:42,090 --> 00:41:47,130
to see what's there now as I said
earlier people turn off this rule

637
00:41:47,130 --> 00:41:50,790
because they're getting bombarded with
the external scans that they can't do

638
00:41:50,790 --> 00:41:56,310
anything about it was somebody's inside
your network and port scanning probably

639
00:41:56,310 --> 00:41:57,570
shouldn't right

640
00:41:57,570 --> 00:42:01,650
we don't have a network game that does
this and that's common you know you can

641
00:42:01,650 --> 00:42:06,090
follow up with them i would not exclude
the network team but follow up with

642
00:42:06,090 --> 00:42:08,880
these things they shouldn't be happening
daily they shouldn't even be happening

643
00:42:08,880 --> 00:42:12,150
weekly so turn it on

644
00:42:12,150 --> 00:42:16,200
look for the internals you've got
critical machines definitely be looking

645
00:42:16,200 --> 00:42:17,430
for those right

646
00:42:17,430 --> 00:42:21,089
I work for again large pizza company
that had a lot of pci data

647
00:42:21,090 --> 00:42:25,230
it makes sense if someone is going to
try and numerate in your your pc I range

648
00:42:25,230 --> 00:42:27,480
your segment pci zones

649
00:42:27,480 --> 00:42:30,390
that's a bit creepy so if you've got
critical servers and get things that

650
00:42:30,390 --> 00:42:35,580
you're sensitive about at least look
they're right and then a bit different

651
00:42:35,580 --> 00:42:37,710
from a port scan is an address can

652
00:42:37,710 --> 00:42:42,720
this is where somebody's got a
particular port they're looking for poor

653
00:42:42,720 --> 00:42:47,520
137 and looking for the vulnerability
there are para running an exploit to

654
00:42:47,520 --> 00:42:54,450
take advantage of SMB or their port 1904
something with ssdp but they're blowing

655
00:42:54,450 --> 00:42:57,960
through every IP address that got that
that vulnerability lined up there just

656
00:42:57,960 --> 00:43:00,870
looking for the right target to pop that
thing on

657
00:43:00,870 --> 00:43:03,569
and so we're going to go address by
address looking for what's vulnerable

658
00:43:03,570 --> 00:43:04,320
for it

659
00:43:04,320 --> 00:43:08,700
your pork skins likely not going to
detect this right because it's looking

660
00:43:08,700 --> 00:43:13,109
for on a single IP address 10 or more
hits in 60 seconds or whatever it is

661
00:43:13,680 --> 00:43:16,710
this is a bit different look for
different IP addresses on a single IP

662
00:43:16,710 --> 00:43:18,880
address

663
00:43:18,880 --> 00:43:23,049
well we're going to talk about that
briefly i know i was incredibly boring

664
00:43:24,519 --> 00:43:27,848
once you've found pen testers on your
network right whether it's that you take

665
00:43:27,849 --> 00:43:31,329
to the tool on the system you found the
road machine

666
00:43:31,329 --> 00:43:37,690
maybe you just figured out that the guys
are there what do you do next right now

667
00:43:37,690 --> 00:43:39,519
before we get any further

668
00:43:39,519 --> 00:43:43,629
typical disclaimer is usually comes at
the beginning of the talk more relevant

669
00:43:43,630 --> 00:43:44,470
here

670
00:43:44,470 --> 00:43:50,200
I'm not your manager right I'm not going
to be able to say do this

671
00:43:50,200 --> 00:43:53,769
and thou shalt not have any consequences
right I'm not your mother i'm not going

672
00:43:53,769 --> 00:43:54,910
to wipe out after yeah

673
00:43:54,910 --> 00:43:58,299
so some of the things here may be
illegal depending on the states that

674
00:43:58,299 --> 00:43:59,680
folks come from

675
00:43:59,680 --> 00:44:07,640
I'll so you see they put your job in
jeopardy usual

676
00:44:07,640 --> 00:44:17,920
judgment so let me start with a story
one day sake

677
00:44:17,920 --> 00:44:21,190
this sitting there watching the console
and he gets one of the largest detects

678
00:44:21,190 --> 00:44:24,040
the tool is a Kelly outbound hit right

679
00:44:24,040 --> 00:44:28,240
he sees it go out of the few of those
and wow what's going on right so it goes

680
00:44:28,240 --> 00:44:33,279
to the guy who sets up the the pen test
engagement goes you know we'll call him

681
00:44:33,280 --> 00:44:39,549
Ron Ron hey is it is this you is this
you doing stuff around being the shady

682
00:44:39,549 --> 00:44:43,299
kind of guy that he is like maybe
because that little smirk right so the

683
00:44:43,299 --> 00:44:47,410
sake let's take that as a yes and closes
out the alert doesn't document anything

684
00:44:47,410 --> 00:44:51,430
goes about his day until about an hour
later when more alerts get generated

685
00:44:51,430 --> 00:44:54,520
goes back to Ron and mom

686
00:44:54,520 --> 00:44:58,210
see more of these alerts is everything
all right everyone everything good

687
00:44:58,210 --> 00:45:01,210
oh yeah don't worry about not going to
just close out right

688
00:45:01,210 --> 00:45:06,130
so a little while later he sees a
printer may get a call out to cali that

689
00:45:06,130 --> 00:45:08,799
Oregon that's that's a little bit weird
he calls me over

690
00:45:08,799 --> 00:45:11,500
you know let me know hey I've been
seeing these things going on of course I

691
00:45:11,500 --> 00:45:13,569
get a little irate

692
00:45:13,569 --> 00:45:18,009
why why we documented this why didn't
you let me know sooner if Ron is doing

693
00:45:18,010 --> 00:45:21,549
this show we know what they're doing
should we be tracking this

694
00:45:22,119 --> 00:45:27,069
the answer is yes so we dig into it a
little bit further mean he adds a little

695
00:45:27,069 --> 00:45:30,160
weird that a printer is making a call
out to cali . heart

696
00:45:30,160 --> 00:45:34,328
so we go chase down every guy hey what's
this IP address Matt back to you

697
00:45:34,329 --> 00:45:37,839
ok maps back to this IP or this mac
address I mac addresses on the sport

698
00:45:38,380 --> 00:45:43,720
what do you want to do we're looking
around like shot it down

699
00:45:44,349 --> 00:45:48,010
sure why not right we are doing weird
stuff whatever they're doing isn't

700
00:45:48,010 --> 00:45:51,369
supposed to be there so if Ron is doing
some weird stuff

701
00:45:51,369 --> 00:45:56,410
I'll shut it down five minutes later I
get called into a conference room where

702
00:45:56,410 --> 00:46:00,069
of course we got to turn the port back
on and and they let me know about the

703
00:46:00,069 --> 00:46:05,200
pen test going on and got to the port
back on as soon as we turn the power

704
00:46:05,200 --> 00:46:08,790
back on five minutes there's another
cali hit going out like okay that

705
00:46:08,790 --> 00:46:15,180
can't keep a straight face on this one
that gives up but in that story we had a

706
00:46:15,180 --> 00:46:16,740
quite a few screw-ups

707
00:46:16,740 --> 00:46:20,279
just four more security operation side
right now they're not even talking about

708
00:46:20,280 --> 00:46:23,910
the penetration testers are tools that
kept going out and calling out and

709
00:46:23,910 --> 00:46:27,960
trigger in our alerts so I want to talk
about the good the bad and the ugly ways

710
00:46:27,960 --> 00:46:32,190
of dealing with the pen testers or
anybody else once you find them on your

711
00:46:32,190 --> 00:46:32,910
network

712
00:46:32,910 --> 00:46:37,259
now these are the good things right

713
00:46:37,260 --> 00:46:40,530
these are the things that you should
always be doing right

714
00:46:40,530 --> 00:46:43,590
use your incident response plan

715
00:46:43,590 --> 00:46:47,370
that's what it's there for you got an
incident the red team members are called

716
00:46:47,370 --> 00:46:50,940
and probably to test your incident
response plan not just to find all the

717
00:46:50,940 --> 00:46:55,260
cool vulnerabilities on a network but
use the incident response plan that's

718
00:46:55,260 --> 00:46:59,130
there and then once you've engaged that
and you've let whoever know your boss

719
00:46:59,130 --> 00:47:02,400
their boss whatever you're into the
response plan says to do

720
00:47:02,400 --> 00:47:06,540
stop the clock go to the person who sets
up the pen test and say I found these

721
00:47:06,540 --> 00:47:13,950
guys because now that change that
conversation from how is the sock doing

722
00:47:13,950 --> 00:47:18,899
two more of a conversation around how
can the red team help us get better at

723
00:47:18,900 --> 00:47:23,070
detecting a war are responding to events
later on right so it's no longer testing

724
00:47:23,070 --> 00:47:23,820
you

725
00:47:23,820 --> 00:47:30,720
no longer testing your your sock is
testing the network now as part of your

726
00:47:30,720 --> 00:47:32,189
is a response plan

727
00:47:32,190 --> 00:47:37,200
I don't call this out up here you really
got to have a few key things right

728
00:47:37,200 --> 00:47:41,370
have it tested i had a time haven't
defined ahead of time the worst time to

729
00:47:41,370 --> 00:47:42,720
be looking for

730
00:47:42,720 --> 00:47:46,200
how do you respond to this stuff is in
the middle of a crisis because you got

731
00:47:46,200 --> 00:47:49,620
30 things going on you got a whole bunch
of alerts you want to investigate the

732
00:47:49,620 --> 00:47:52,950
last thing you want to do is oh my gosh
what do i do - I turn off the port way

733
00:47:52,950 --> 00:47:58,140
now turn off your food white owl right
so have a tabletop exercises ahead of

734
00:47:58,140 --> 00:47:59,279
time if you've got it

735
00:47:59,280 --> 00:48:02,820
if you don't have an incident response
plan and you haven't run through a

736
00:48:02,820 --> 00:48:05,670
tabletop exercise you should not be
doing

737
00:48:05,670 --> 00:48:08,910
anonymous or on unannounced red team
exercise

738
00:48:08,910 --> 00:48:12,810
I mean just point blank right but it
happens and it happens all over the

739
00:48:12,810 --> 00:48:15,810
place where people bring in the red team
penetration testers

740
00:48:16,600 --> 00:48:21,490
have somebody that's a defined incident
responder was recording the notes write

741
00:48:21,490 --> 00:48:24,490
all their job is is were defined

742
00:48:24,490 --> 00:48:27,910
I keep track of everything that was
found all the systems that were touched

743
00:48:27,910 --> 00:48:31,089
everything that you collect all the
artifacts

744
00:48:31,090 --> 00:48:34,630
I keep track of the information have
somebody else who's assigned as the

745
00:48:34,630 --> 00:48:36,040
incident manager

746
00:48:36,040 --> 00:48:38,890
it doesn't have to be the sock manager
it doesn't have to be the vp of

747
00:48:38,890 --> 00:48:44,319
information security have somebody who's
going to coordinate and distribute tasks

748
00:48:44,320 --> 00:48:46,750
because last thing you want because
everybody's hair is going to be a

749
00:48:46,750 --> 00:48:48,430
firearm is running around

750
00:48:48,430 --> 00:48:52,180
oh my gosh what's going on it's an
incident last thing you want is 50

751
00:48:52,180 --> 00:48:54,009
different people telling your stock
analyst

752
00:48:54,010 --> 00:48:57,220
hey check this out and he did you think
about looking over there know all that

753
00:48:57,220 --> 00:48:59,859
should come through a single chain of
command right

754
00:48:59,860 --> 00:49:03,310
that should be the incident manager so
have all the stuff to find ahead of time

755
00:49:03,310 --> 00:49:04,000
right

756
00:49:04,000 --> 00:49:06,970
as part of your incident response plan
should be tracking down all the machines

757
00:49:06,970 --> 00:49:07,959
that were touched

758
00:49:07,960 --> 00:49:14,680
you've got the logs hopefully you've got
all the logs peasant hopping through the

759
00:49:14,680 --> 00:49:18,339
network for pivoting they're getting
credentials track all that stuff down

760
00:49:18,340 --> 00:49:19,150
right

761
00:49:19,150 --> 00:49:22,780
collect all the logs you may not have
all the logs right

762
00:49:22,780 --> 00:49:25,840
they're going to be touching machines
end . we don't get a large man . maybe

763
00:49:25,840 --> 00:49:30,950
use carbon black maybe you don't
collected

764
00:49:30,950 --> 00:49:35,779
large as you can for everything else is
hard on access layer switches but if you

765
00:49:35,780 --> 00:49:38,780
can get a span port and you can put a
sniff around there

766
00:49:39,470 --> 00:49:42,290
nothing is going to be better than
seeing the actual packets that are going

767
00:49:42,290 --> 00:49:45,560
across the network letting you know
exactly where they went

768
00:49:45,560 --> 00:49:51,828
and what they did now going back to the
story

769
00:49:51,829 --> 00:49:55,190
one of the bad things that we did was
shutting that poured down early

770
00:49:55,190 --> 00:50:01,010
we look like a printer printer should be
making calls out and that's right anyway

771
00:50:01,010 --> 00:50:03,589
right so it's no big deal

772
00:50:03,589 --> 00:50:08,869
so shut down the fort except that during
an engagement pen testers can pick up

773
00:50:08,869 --> 00:50:14,030
there more laptops walk out the door and
nobody knows where they were

774
00:50:14,030 --> 00:50:18,200
whatever do it they can go back tomorrow
and try again and we've lost all

775
00:50:18,200 --> 00:50:21,319
opportunity to attract them for our
network so don't shut down the port

776
00:50:21,320 --> 00:50:24,050
before it's necessary to do so right

777
00:50:24,050 --> 00:50:29,780
don't unplug devices 15 years ago when I
was going through training for this

778
00:50:29,780 --> 00:50:36,950
it was told isolated keep this from are
extending past where they've already got

779
00:50:36,950 --> 00:50:41,270
into right now we're as soon as never
gets on a box shut that thing down right

780
00:50:41,270 --> 00:50:45,050
the wisdom now is we can get memory cap
or memory dumps

781
00:50:45,050 --> 00:50:48,380
we can take four and six image of these
things that we don't want to tip our

782
00:50:48,380 --> 00:50:52,040
hand to an attacker where they change
their their their tactics because we've

783
00:50:52,040 --> 00:50:55,099
detected them and they know that we've
detected that right so don't unplug

784
00:50:55,099 --> 00:50:59,750
devices you can lose a lot of valuable
data and then during that same pen test

785
00:50:59,750 --> 00:51:04,250
on protesters are pivoting through the
network they were using metasploit the

786
00:51:04,250 --> 00:51:08,420
other shells they managed to tap in to
the microphones and cameras so that they

787
00:51:08,420 --> 00:51:12,290
can see what different people are doing
and one of my stock analyst are that

788
00:51:12,290 --> 00:51:14,119
they were doing that on his machine

789
00:51:14,119 --> 00:51:18,560
he got really ticked off and so at the
end of the day it's like six o'clock

790
00:51:18,560 --> 00:51:21,290
he's going around trying to figure out
where on the third floor that they were

791
00:51:21,290 --> 00:51:25,550
at trying to figure out what happens
from there in he was really upset about

792
00:51:25,550 --> 00:51:29,060
this thing I you want to use talking
about like / in the tire

793
00:51:29,060 --> 00:51:32,270
leaving some president for these guys at
the conference room so I mean I gotta

794
00:51:32,270 --> 00:51:33,509
warn ya

795
00:51:33,509 --> 00:51:37,380
no matter what don't come from the pen
testers is not going to lead to anything

796
00:51:37,380 --> 00:51:42,419
positive nothing good is going to come
out of this but maybe

797
00:51:43,169 --> 00:51:48,899
why not plug them right if they're going
to listen in through meterpreter to your

798
00:51:48,899 --> 00:51:51,328
conversations if you're going to hack
your email

799
00:51:51,329 --> 00:51:55,649
if they're going to listen in to your
phone calls by hacking voice system or

800
00:51:55,649 --> 00:51:57,569
just packing capturing the VoIP system

801
00:51:57,569 --> 00:52:00,899
why not listen to what they're doing put
a little bug in the conference room

802
00:52:00,899 --> 00:52:03,899
where there and figure out where they're
at the start listening in to them

803
00:52:06,299 --> 00:52:10,919
port scan their machine right on our
networks we have free rein around

804
00:52:10,919 --> 00:52:14,939
vulnerability of vulnerability scans
that should include the user subnets

805
00:52:14,939 --> 00:52:18,058
right so scan their machine and see
what's open

806
00:52:18,839 --> 00:52:21,839
Callie is a little bit lock down these
days

807
00:52:22,799 --> 00:52:27,329
use their own credentials against them

808
00:52:27,329 --> 00:52:30,869
why not right they're going to use your
credentials against you

809
00:52:30,869 --> 00:52:33,599
we're going to use your credentials
across the network how funny would it be

810
00:52:33,599 --> 00:52:38,159
to log into their email system and so
their boss an email saying hey this this

811
00:52:38,159 --> 00:52:39,959
this place sucks i'm quitting

812
00:52:39,959 --> 00:52:44,549
I'm out of here I'm gone or maybe mimic
thousands of homes across the network to

813
00:52:44,549 --> 00:52:47,549
ports poofy make it harder for them to
do their job right

814
00:52:48,209 --> 00:52:52,649
so be creative and be careful right when
I got to this point of the kind of the

815
00:52:52,649 --> 00:52:56,279
presentation before I must have
triggered the platoon of of a red

816
00:52:56,279 --> 00:53:01,319
teamers you know they were they were
antsy the feedback they basically gave

817
00:53:01,319 --> 00:53:05,009
me was why don't work with the pen
testers might not work with them on the

818
00:53:05,009 --> 00:53:08,039
engagement and I mean a typical pentest
engagement

819
00:53:08,039 --> 00:53:10,859
these guys are adversarial there
listening in to you they're there

820
00:53:10,859 --> 00:53:14,999
hacking your machines right there
leaving middleware make an adversarial

821
00:53:14,999 --> 00:53:20,279
back right so just a recap and all these
things are kind of gimmicky but we talk

822
00:53:20,279 --> 00:53:22,709
about detecting the pen testers tools

823
00:53:22,709 --> 00:53:26,698
I'll keep an eye out for cali door
secured a dark alley door

824
00:53:26,699 --> 00:53:32,069
we talked about detective road machines
on the network for dhcp logs we talk

825
00:53:32,069 --> 00:53:33,989
about printing off this guy right

826
00:53:33,989 --> 00:53:39,719
look for 4624 4625 events to detect ntlm
pass the hash tax

827
00:53:40,800 --> 00:53:45,090
we talked briefly about brute force
attacks and detecting those and we

828
00:53:45,090 --> 00:53:47,790
talked a little bit about in a response
to what you do

829
00:53:47,790 --> 00:53:51,930
the good the bad the ugly ways once you
find them on your network

830
00:53:51,930 --> 00:53:55,379
so with two minutes left

831
00:53:55,380 --> 00:53:58,380
any questions yes sir

832
00:54:01,350 --> 00:54:16,950
in my experience I have not so yeah
possibly yeah i mean it

833
00:54:17,790 --> 00:54:23,730
I don't know anybody that's going to
agree that shirt now you've got the get

834
00:54:23,730 --> 00:54:26,730
out of jail card just as they do right
yeah that's a good idea

835
00:54:27,570 --> 00:54:31,530
fair enough there was a box on your
network though

836
00:54:32,790 --> 00:54:35,940
yep

837
00:54:35,940 --> 00:54:39,630
but yeah exactly so the question was how
do you know that it's really a pen

838
00:54:39,630 --> 00:54:44,730
tester as opposed to a real attacker or
just the zombie machine right arm that

839
00:54:44,730 --> 00:54:47,100
mail server that was being used for
command and control

840
00:54:47,100 --> 00:54:52,589
I mean we knew about it because I while
you belong to the pen testing firm that

841
00:54:52,590 --> 00:54:56,670
we knew was contracted so in that case
we get away with it but yeah how do you

842
00:54:56,670 --> 00:55:00,000
know it's not a zombie machine how do
you hack back or counter-attack

843
00:55:00,000 --> 00:55:03,240
I guess the machine that could be a
zombie as part of something else you can

844
00:55:03,240 --> 00:55:06,240
be careful in that area but you have to
question this hurt

845
00:55:07,110 --> 00:55:19,500
sure we wanted to do that

846
00:55:20,010 --> 00:55:23,070
I at the previous organization we have
that where I'm at now

847
00:55:23,700 --> 00:55:28,410
so a lot of those engagements tend to be
a bit more hours Bob you know the more

848
00:55:28,410 --> 00:55:32,040
you know type of slide where these guys
are the ones testing the tools and

849
00:55:32,040 --> 00:55:35,580
seeing how the tax work and then working
with us to figure out how we could

850
00:55:35,580 --> 00:55:38,790
attack what rules we could write so
there's a better relationship there then

851
00:55:38,790 --> 00:55:39,150
and

852
00:55:39,150 --> 00:55:43,860
it's a good idea to have adversarial in
that kind of a situation as well

853
00:55:44,460 --> 00:55:48,780
they're going to do their things and
announced and i'll be detected and what

854
00:55:48,780 --> 00:55:50,970
do we do once we detected right so yeah
it was

855
00:55:50,970 --> 00:55:53,189
there's a lot more variety you can do
that when you've got a good team

856
00:55:53,190 --> 00:55:56,430
internally

857
00:55:56,430 --> 00:56:06,450
yeah absolutely

858
00:56:07,110 --> 00:56:10,110
and there's a lot of great benefit that
can be had from having internal energy

859
00:56:10,110 --> 00:56:13,500
use and i don't mean this to be
disparaging too much to the red teamers

860
00:56:13,500 --> 00:56:17,520
because the external penetration testing
is very positive in a very important

861
00:56:17,520 --> 00:56:20,790
thing to have on your network but don't
I get tired of the presentations where

862
00:56:20,790 --> 00:56:24,360
I've totally pulling the blue team and
all my gosh these guys are are are

863
00:56:24,360 --> 00:56:27,480
stupid they're idiots they don't know
what they're doing and whatever else it

864
00:56:27,480 --> 00:56:30,570
is right because we've got a lot going
on

865
00:56:30,570 --> 00:56:34,770
we've got a lot of logs to dig through
and we don't have to be right a hundred

866
00:56:34,770 --> 00:56:37,800
percent of time we can detect these guys
being foolish as well

867
00:56:37,800 --> 00:56:41,340
so with that I think I'll clear the
stage for the next guy

868
00:56:41,340 --> 00:56:41,700
thank you very much

