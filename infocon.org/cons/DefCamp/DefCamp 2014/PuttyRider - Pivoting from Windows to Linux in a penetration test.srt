1
00:00:00,000 --> 00:00:05,940
yeah<font color="#CCCCCC"> thank you</font><font color="#E5E5E5"> thank you for your</font>

2
00:00:01,770 --> 00:00:08,639
patience<font color="#CCCCCC"> I love linux but when it comes</font>

3
00:00:05,940 --> 00:00:11,219
to<font color="#E5E5E5"> connecting two projectors</font><font color="#CCCCCC"> it always</font>

4
00:00:08,639 --> 00:00:15,239
has some problems

5
00:00:11,219 --> 00:00:18,119
hello all you truckers out there and all

6
00:00:15,240 --> 00:00:21,539
you want to be hers<font color="#E5E5E5"> and all you don't</font>

7
00:00:18,119 --> 00:00:24,509
want to be<font color="#E5E5E5"> hackers my name is</font><font color="#CCCCCC"> Adrian</font>

8
00:00:21,539 --> 00:00:29,099
<font color="#CCCCCC">fortuna i'm</font><font color="#E5E5E5"> going to talk to you today</font>

9
00:00:24,510 --> 00:00:33,000
about a tool that<font color="#CCCCCC"> i wrote</font><font color="#E5E5E5"> and the</font>

10
00:00:29,099 --> 00:00:34,980
technique of people thing from<font color="#E5E5E5"> Windows</font>

11
00:00:33,000 --> 00:00:40,980
to<font color="#E5E5E5"> Linux or UNIX machines in a</font>

12
00:00:34,980 --> 00:00:44,309
penetration<font color="#CCCCCC"> test</font><font color="#E5E5E5"> so we are going to see</font>

13
00:00:40,980 --> 00:00:47,879
where the idea came from<font color="#CCCCCC"> we which are</font>

14
00:00:44,309 --> 00:00:50,519
<font color="#CCCCCC">they use it use it</font><font color="#E5E5E5"> your scenarios</font><font color="#CCCCCC"> the</font>

15
00:00:47,879 --> 00:00:53,070
features of put the<font color="#CCCCCC"> rider</font><font color="#E5E5E5"> technical</font>

16
00:00:50,520 --> 00:00:56,820
details and<font color="#CCCCCC"> the demonstration for which</font>

17
00:00:53,070 --> 00:01:00,180
<font color="#E5E5E5">I needed this exact laptop</font><font color="#CCCCCC"> a little bit</font>

18
00:00:56,820 --> 00:01:03,629
about myself<font color="#E5E5E5"> i am a technical manager at</font>

19
00:01:00,180 --> 00:01:07,560
<font color="#CCCCCC">kpmg romania I lead the penetration</font>

20
00:01:03,629 --> 00:01:11,310
testers team and I think we do a pretty

21
00:01:07,560 --> 00:01:15,689
good job at<font color="#E5E5E5"> hangar local companies banks</font>

22
00:01:11,310 --> 00:01:17,640
and other high-profile targets<font color="#CCCCCC"> I have</font>

23
00:01:15,689 --> 00:01:24,059
some certifications and also<font color="#CCCCCC"> did some</font>

24
00:01:17,640 --> 00:01:26,610
talks at some conferences<font color="#E5E5E5"> we are also</font>

25
00:01:24,060 --> 00:01:28,920
hiring<font color="#CCCCCC"> so we are looking for to</font>

26
00:01:26,610 --> 00:01:31,020
penetration<font color="#E5E5E5"> testers</font><font color="#CCCCCC"> if anyone is</font>

27
00:01:28,920 --> 00:01:37,890
interested<font color="#E5E5E5"> just let us know</font>

28
00:01:31,020 --> 00:01:39,899
<font color="#CCCCCC">ok</font><font color="#E5E5E5"> so how come this idea</font><font color="#CCCCCC"> this started</font>

29
00:01:37,890 --> 00:01:42,180
from an<font color="#CCCCCC"> intern from an internal</font>

30
00:01:39,900 --> 00:01:46,799
penetration<font color="#CCCCCC"> test that we did at the</font>

31
00:01:42,180 --> 00:01:48,390
company in<font color="#CCCCCC"> Romania of</font><font color="#E5E5E5"> for those of you</font>

32
00:01:46,799 --> 00:01:52,049
who don't know internal internal

33
00:01:48,390 --> 00:01:55,680
penetration testing means that you as a

34
00:01:52,049 --> 00:01:59,880
as a penetration tester<font color="#E5E5E5"> act as an</font>

35
00:01:55,680 --> 00:02:02,430
internal attacker and you have access to

36
00:01:59,880 --> 00:02:04,170
a network<font color="#E5E5E5"> port of the internal company</font>

37
00:02:02,430 --> 00:02:08,250
of<font color="#E5E5E5"> the internal network of the company</font>

38
00:02:04,170 --> 00:02:12,670
and you have some targets for instance

39
00:02:08,250 --> 00:02:15,819
the decline company asks you if

40
00:02:12,670 --> 00:02:19,630
for<font color="#CCCCCC"> you as an attacker</font><font color="#E5E5E5"> are able to gain</font>

41
00:02:15,819 --> 00:02:22,569
access to the database of its most

42
00:02:19,630 --> 00:02:28,180
important client<font color="#E5E5E5"> just starting from a</font>

43
00:02:22,569 --> 00:02:33,280
network port and we usually reached

44
00:02:28,180 --> 00:02:37,150
these targets and from<font color="#E5E5E5"> my personal</font>

45
00:02:33,280 --> 00:02:39,730
opinion it was easier on<font color="#CCCCCC"> Windows</font>

46
00:02:37,150 --> 00:02:43,690
<font color="#CCCCCC">environment</font><font color="#E5E5E5"> then in</font><font color="#CCCCCC"> Linux environments</font>

47
00:02:39,730 --> 00:02:46,869
this is mainly because of the trust

48
00:02:43,690 --> 00:02:51,790
relationship between machines that are

49
00:02:46,870 --> 00:02:56,319
embedded in the<font color="#CCCCCC"> windows environment</font><font color="#E5E5E5"> and</font>

50
00:02:51,790 --> 00:02:59,410
<font color="#CCCCCC">yeah</font><font color="#E5E5E5"> gaining domain administrator it</font>

51
00:02:56,319 --> 00:03:04,000
<font color="#E5E5E5">usually was pretty straightforward</font>

52
00:02:59,410 --> 00:03:07,239
we did it<font color="#E5E5E5"> but in this case the target</font>

53
00:03:04,000 --> 00:03:10,810
was actually<font color="#E5E5E5"> was actually a linux server</font>

54
00:03:07,239 --> 00:03:14,290
which did not have any obvious

55
00:03:10,810 --> 00:03:17,109
<font color="#E5E5E5">vulnerabilities and we did not find a</font>

56
00:03:14,290 --> 00:03:19,030
way to directly attack it<font color="#E5E5E5"> even though we</font>

57
00:03:17,109 --> 00:03:21,519
had<font color="#CCCCCC"> dominant domain administrator</font>

58
00:03:19,030 --> 00:03:25,870
account<font color="#CCCCCC"> we could</font><font color="#E5E5E5"> not use it to log into</font>

59
00:03:21,519 --> 00:03:27,280
that<font color="#E5E5E5"> target server where the</font><font color="#CCCCCC"> important</font>

60
00:03:25,870 --> 00:03:31,780
data was located

61
00:03:27,280 --> 00:03:37,120
ok so how to gain access to the data and

62
00:03:31,780 --> 00:03:40,060
reach the target the answer that we came

63
00:03:37,120 --> 00:03:42,940
was to target the system administrators

64
00:03:40,060 --> 00:03:45,070
<font color="#E5E5E5">we know that these are the persons who</font>

65
00:03:42,940 --> 00:03:46,989
have the keys to the kingdom

66
00:03:45,070 --> 00:03:51,250
<font color="#CCCCCC">yea</font><font color="#E5E5E5"> they have all the passwords they</font>

67
00:03:46,989 --> 00:03:56,079
have all the access and<font color="#CCCCCC"> he if you have</font>

68
00:03:51,250 --> 00:03:59,890
their rights<font color="#CCCCCC"> you</font><font color="#E5E5E5"> actually can go to any</font>

69
00:03:56,079 --> 00:04:04,420
server you<font color="#E5E5E5"> like so having domain</font>

70
00:03:59,890 --> 00:04:06,970
administrator account<font color="#CCCCCC"> we used it to log</font>

71
00:04:04,420 --> 00:04:11,768
into one of the system<font color="#E5E5E5"> of entry</font>

72
00:04:06,970 --> 00:04:15,430
administrators in the local network and

73
00:04:11,769 --> 00:04:18,760
we did the screenshot<font color="#E5E5E5"> use you can you</font>

74
00:04:15,430 --> 00:04:21,190
<font color="#CCCCCC">now probably</font><font color="#E5E5E5"> that with metasploit</font><font color="#CCCCCC"> again</font>

75
00:04:18,760 --> 00:04:24,219
meterpreter shell<font color="#E5E5E5"> and you have the</font>

76
00:04:21,190 --> 00:04:26,170
possibility to do<font color="#CCCCCC"> PS</font><font color="#E5E5E5"> to see the list of</font>

77
00:04:24,220 --> 00:04:28,720
processes and you also can

78
00:04:26,170 --> 00:04:32,260
<font color="#E5E5E5">to</font><font color="#CCCCCC"> a screenshot</font><font color="#E5E5E5"> to see what the user is</font>

79
00:04:28,720 --> 00:04:35,080
actually doing at that moment<font color="#E5E5E5"> and we saw</font>

80
00:04:32,260 --> 00:04:43,060
that that system administrator had the

81
00:04:35,080 --> 00:04:48,190
<font color="#E5E5E5">booty</font><font color="#CCCCCC"> console open and that IP addresses</font>

82
00:04:43,060 --> 00:04:50,830
was one of our target<font color="#E5E5E5"> servers so at this</font>

83
00:04:48,190 --> 00:04:55,780
point we<font color="#CCCCCC"> considered</font><font color="#E5E5E5"> ourselves ourselves</font>

84
00:04:50,830 --> 00:05:01,990
to be<font color="#E5E5E5"> closer to our target but we could</font>

85
00:04:55,780 --> 00:05:06,309
not actually reach it up

86
00:05:01,990 --> 00:05:10,720
let<font color="#E5E5E5"> me ask you first how would you do it</font>

87
00:05:06,310 --> 00:05:16,330
<font color="#CCCCCC">I mean if you if you had remote access</font>

88
00:05:10,720 --> 00:05:20,350
to<font color="#CCCCCC"> workstation</font><font color="#E5E5E5"> of a user who may be</font>

89
00:05:16,330 --> 00:05:23,469
locked<font color="#E5E5E5"> on</font><font color="#CCCCCC"> on his</font><font color="#E5E5E5"> workstation at</font><font color="#CCCCCC"> that</font>

90
00:05:20,350 --> 00:05:27,910
moment<font color="#CCCCCC"> you can access it remotely</font><font color="#E5E5E5"> and</font>

91
00:05:23,470 --> 00:05:30,880
<font color="#E5E5E5">how would you do</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> to take advantage of</font>

92
00:05:27,910 --> 00:05:36,310
the fact that that machine has already

93
00:05:30,880 --> 00:05:42,070
<font color="#E5E5E5">our connection open</font><font color="#CCCCCC"> to to your target or</font>

94
00:05:36,310 --> 00:05:44,200
targets<font color="#E5E5E5"> room session what kind of</font>

95
00:05:42,070 --> 00:05:59,169
session hijacking<font color="#CCCCCC"> which</font><font color="#E5E5E5"> which session</font>

96
00:05:44,200 --> 00:06:02,498
<font color="#CCCCCC">dunno how to do that</font>

97
00:05:59,169 --> 00:06:06,279
if you're referring to<font color="#E5E5E5"> section</font>

98
00:06:02,499 --> 00:06:09,999
authentication information that is not

99
00:06:06,279 --> 00:06:13,300
always<font color="#CCCCCC"> thought on the machine i mean the</font>

100
00:06:09,999 --> 00:06:14,560
the admin can enter password manually<font color="#CCCCCC"> so</font>

101
00:06:13,300 --> 00:06:21,550
you<font color="#CCCCCC"> don't have identification</font>

102
00:06:14,560 --> 00:06:24,520
information

103
00:06:21,550 --> 00:06:25,539
<font color="#E5E5E5">yeah</font><font color="#CCCCCC"> yeah yeah that's a good that's a</font>

104
00:06:24,520 --> 00:06:27,789
good one

105
00:06:25,539 --> 00:06:30,818
they said that you could install a

106
00:06:27,789 --> 00:06:33,520
keylogger and<font color="#CCCCCC"> killed</font><font color="#E5E5E5"> the position and</font>

107
00:06:30,819 --> 00:06:36,279
make the administrator login again

108
00:06:33,520 --> 00:06:39,669
<font color="#E5E5E5">that's a volatile valid point but it's</font>

109
00:06:36,279 --> 00:06:40,389
pretty destructive and we do not like to

110
00:06:39,669 --> 00:06:44,799
do that

111
00:06:40,389 --> 00:06:48,669
and furthermore we we found situations

112
00:06:44,800 --> 00:06:51,490
where there were<font color="#E5E5E5"> two sessions open on</font>

113
00:06:48,669 --> 00:06:56,378
the machine<font color="#CCCCCC"> for days or</font><font color="#E5E5E5"> for a week</font>

114
00:06:51,490 --> 00:06:59,050
<font color="#E5E5E5">because the administrator wants to</font>

115
00:06:56,379 --> 00:07:01,270
instantly have access to<font color="#E5E5E5"> its server when</font>

116
00:06:59,050 --> 00:07:03,099
something happens and the day they<font color="#E5E5E5"> leave</font>

117
00:07:01,270 --> 00:07:10,508
<font color="#E5E5E5">positions open</font>

118
00:07:03,099 --> 00:07:12,639
yes that was the situation that<font color="#E5E5E5"> that we</font>

119
00:07:10,509 --> 00:07:14,229
actually used in this case because i did

120
00:07:12,639 --> 00:07:18,939
not have put<font color="#CCCCCC"> the writer at at the moment</font>

121
00:07:14,229 --> 00:07:21,008
the<font color="#CCCCCC"> the particular</font><font color="#E5E5E5"> administrator used a</font>

122
00:07:18,939 --> 00:07:24,189
pair of<font color="#CCCCCC"> public private</font><font color="#E5E5E5"> keys to</font>

123
00:07:21,009 --> 00:07:26,860
authenticate the server<font color="#E5E5E5"> and we found the</font>

124
00:07:24,189 --> 00:07:28,449
files containing<font color="#CCCCCC"> the</font><font color="#E5E5E5"> those keys and we</font>

125
00:07:26,860 --> 00:07:30,399
copied them from that machine to our

126
00:07:28,449 --> 00:07:39,969
machine and authenticated to the server

127
00:07:30,399 --> 00:07:48,369
<font color="#E5E5E5">but we were lucky</font>

128
00:07:39,969 --> 00:08:01,779
yeah but you actually cannot type

129
00:07:48,369 --> 00:08:04,149
<font color="#E5E5E5">yourself in that console</font><font color="#CCCCCC"> not necessarily</font>

130
00:08:01,779 --> 00:08:07,360
<font color="#E5E5E5">because it has the keepalive mechanism</font>

131
00:08:04,149 --> 00:08:08,049
<font color="#CCCCCC">it depends how its configured but not</font>

132
00:08:07,360 --> 00:08:12,459
always

133
00:08:08,049 --> 00:08:14,799
<font color="#CCCCCC">ok</font><font color="#E5E5E5"> yeah so</font><font color="#CCCCCC"> I had in this</font><font color="#E5E5E5"> particular case</font>

134
00:08:12,459 --> 00:08:18,429
we<font color="#E5E5E5"> we managed to gain access by copying</font>

135
00:08:14,799 --> 00:08:22,299
the<font color="#CCCCCC"> public/private key</font><font color="#E5E5E5"> and gain access</font>

136
00:08:18,429 --> 00:08:24,849
to the<font color="#CCCCCC"> to the linux server</font><font color="#E5E5E5"> but we we</font>

137
00:08:22,299 --> 00:08:28,748
noticed that something was missing

138
00:08:24,849 --> 00:08:31,509
yeah<font color="#E5E5E5"> so the actual the actual picture is</font>

139
00:08:28,749 --> 00:08:33,879
this is the attacker was me

140
00:08:31,509 --> 00:08:36,969
<font color="#E5E5E5">we</font><font color="#CCCCCC"> are connected with metasploit</font><font color="#E5E5E5"> to a</font>

141
00:08:33,879 --> 00:08:40,449
process on the system means machines

142
00:08:36,969 --> 00:08:42,430
<font color="#CCCCCC">this</font><font color="#E5E5E5"> means machine and from that machine</font>

143
00:08:40,448 --> 00:08:44,228
there was another process which was

144
00:08:42,429 --> 00:08:49,479
connected to the target server

145
00:08:44,229 --> 00:08:56,199
<font color="#CCCCCC">ok introducing</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> rider do you know</font>

146
00:08:49,480 --> 00:09:00,160
where the picture comes from<font color="#E5E5E5"> there was a</font>

147
00:08:56,199 --> 00:09:07,059
movie<font color="#CCCCCC"> Ghost Rider</font><font color="#E5E5E5"> at the</font><font color="#CCCCCC"> point</font>

148
00:09:00,160 --> 00:09:10,240
yeah it had some some cooler<font color="#CCCCCC"> special</font>

149
00:09:07,059 --> 00:09:10,990
<font color="#CCCCCC">effects and I like the picture the</font>

150
00:09:10,240 --> 00:09:13,540
picture

151
00:09:10,990 --> 00:09:17,350
yeah so this<font color="#E5E5E5"> put a</font><font color="#CCCCCC"> rather</font><font color="#E5E5E5"> tool actually</font>

152
00:09:13,540 --> 00:09:20,680
uses<font color="#E5E5E5"> takes advantage of the existing put</font>

153
00:09:17,350 --> 00:09:22,660
the connection in order to first of all

154
00:09:20,680 --> 00:09:25,269
sniff for communication between the

155
00:09:22,660 --> 00:09:28,689
administrator and the server<font color="#E5E5E5"> if there is</font>

156
00:09:25,269 --> 00:09:32,709
some communication happening<font color="#E5E5E5"> passwords</font>

157
00:09:28,689 --> 00:09:37,029
included also also<font color="#E5E5E5"> you can inject</font>

158
00:09:32,709 --> 00:09:40,000
commands in the existing<font color="#CCCCCC"> possession and</font>

159
00:09:37,029 --> 00:09:43,209
be transparent to the victim user<font color="#E5E5E5"> so we</font>

160
00:09:40,000 --> 00:09:47,259
do not want the victim to see that we we

161
00:09:43,209 --> 00:09:53,250
<font color="#CCCCCC">are there</font><font color="#E5E5E5"> and also I</font><font color="#CCCCCC"> i would like it to</font>

162
00:09:47,259 --> 00:09:57,330
be interactive<font color="#CCCCCC"> VRE Marshall yeah and the</font>

163
00:09:53,250 --> 00:09:59,520
because we<font color="#E5E5E5"> we take advantage of</font><font color="#CCCCCC"> booty we</font>

164
00:09:57,330 --> 00:10:03,450
know that put the can connect<font color="#E5E5E5"> with</font>

165
00:09:59,520 --> 00:10:09,780
multiple protocols<font color="#E5E5E5"> ssh telnet</font><font color="#CCCCCC"> our login</font>

166
00:10:03,450 --> 00:10:16,050
so this tool<font color="#E5E5E5"> actually works for all</font>

167
00:10:09,780 --> 00:10:18,810
these particles<font color="#CCCCCC"> yeah</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> what</font><font color="#E5E5E5"> the writer</font>

168
00:10:16,050 --> 00:10:21,569
will sit in the middle<font color="#E5E5E5"> so it will make</font>

169
00:10:18,810 --> 00:10:23,550
the connection between the attacker<font color="#CCCCCC"> this</font>

170
00:10:21,570 --> 00:10:25,170
<font color="#E5E5E5">is via this is</font><font color="#CCCCCC"> that mean to the to the</font>

171
00:10:23,550 --> 00:10:28,560
target server

172
00:10:25,170 --> 00:10:29,760
<font color="#CCCCCC">ok</font><font color="#E5E5E5"> remember</font><font color="#CCCCCC"> please the the</font><font color="#E5E5E5"> colors so the</font>

173
00:10:28,560 --> 00:10:32,369
attacker is white

174
00:10:29,760 --> 00:10:36,210
this is<font color="#E5E5E5"> a</font><font color="#CCCCCC"> min</font><font color="#E5E5E5"> is blue</font><font color="#CCCCCC"> yeah</font><font color="#E5E5E5"> we will have</font>

175
00:10:32,370 --> 00:10:38,250
some more details afterwards and when

176
00:10:36,210 --> 00:10:40,350
you see white<font color="#E5E5E5"> we refer to the attacker</font>

177
00:10:38,250 --> 00:10:45,600
machine when you see blue<font color="#E5E5E5"> we refer to</font>

178
00:10:40,350 --> 00:10:47,700
the<font color="#E5E5E5"> submarines machine</font><font color="#CCCCCC"> so what it can do</font>

179
00:10:45,600 --> 00:10:50,940
it can list the existing processes

180
00:10:47,700 --> 00:10:53,940
<font color="#CCCCCC">injects a dll into a certain</font><font color="#E5E5E5"> put the</font>

181
00:10:50,940 --> 00:10:57,090
process waiting background for<font color="#CCCCCC"> new put</font>

182
00:10:53,940 --> 00:10:58,800
the processes to appear<font color="#E5E5E5"> it can</font>

183
00:10:57,090 --> 00:11:04,080
automatically<font color="#CCCCCC"> execute the show command</font>

184
00:10:58,800 --> 00:11:06,510
after injection<font color="#CCCCCC"> eject and maybe you're</font>

185
00:11:04,080 --> 00:11:08,940
wondering how will you extract the

186
00:11:06,510 --> 00:11:13,680
actual data because<font color="#CCCCCC"> the rider will run</font>

187
00:11:08,940 --> 00:11:17,040
on the administrators machine<font color="#E5E5E5"> it can</font><font color="#CCCCCC"> it</font>

188
00:11:13,680 --> 00:11:19,170
has<font color="#CCCCCC"> two output modes it can write all</font>

189
00:11:17,040 --> 00:11:21,930
the conversation to a local file on the

190
00:11:19,170 --> 00:11:24,300
administrators<font color="#E5E5E5"> machine and another</font>

191
00:11:21,930 --> 00:11:26,880
output mode it to initiate the reverse

192
00:11:24,300 --> 00:11:29,760
connection to the attackers<font color="#E5E5E5"> machine and</font>

193
00:11:26,880 --> 00:11:37,620
start an interactive session via the

194
00:11:29,760 --> 00:11:41,040
existing putting<font color="#E5E5E5"> connection</font><font color="#CCCCCC"> i tried</font>

195
00:11:37,620 --> 00:11:45,120
first<font color="#CCCCCC"> two to search to see if there is</font>

196
00:11:41,040 --> 00:11:48,900
actually existing such a tool<font color="#E5E5E5"> because</font><font color="#CCCCCC"> i</font>

197
00:11:45,120 --> 00:11:51,240
wanted<font color="#E5E5E5"> to use it at that moment</font><font color="#CCCCCC"> I found</font>

198
00:11:48,900 --> 00:11:54,390
just<font color="#E5E5E5"> this proof-of-concept it's called</font>

199
00:11:51,240 --> 00:11:58,920
<font color="#CCCCCC">put</font><font color="#E5E5E5"> hijack</font><font color="#CCCCCC"> it was written</font><font color="#E5E5E5"> by a guy named</font>

200
00:11:54,390 --> 00:12:02,250
man named<font color="#CCCCCC"> brett more in 2008</font><font color="#E5E5E5"> and as the</font>

201
00:11:58,920 --> 00:12:06,849
author says it's just a proof of concept

202
00:12:02,250 --> 00:12:12,220
and it works only for<font color="#E5E5E5"> booty version</font>

203
00:12:06,850 --> 00:12:16,209
<font color="#E5E5E5">zero . 60 which was released in $MONTH</font>

204
00:12:12,220 --> 00:12:17,889
2007<font color="#E5E5E5"> and if you try to run it on other</font>

205
00:12:16,209 --> 00:12:22,420
<font color="#E5E5E5">party versions it just crashes the</font>

206
00:12:17,889 --> 00:12:24,190
<font color="#CCCCCC">process the</font><font color="#E5E5E5"> process and it has several</font>

207
00:12:22,420 --> 00:12:27,639
drawbacks

208
00:12:24,190 --> 00:12:31,269
so<font color="#CCCCCC"> I thought why wouldn't I start from</font>

209
00:12:27,639 --> 00:12:34,209
this<font color="#E5E5E5"> this</font><font color="#CCCCCC"> proof-of-concept</font><font color="#E5E5E5"> and build</font>

210
00:12:31,269 --> 00:12:38,230
<font color="#E5E5E5">reliable tool that can be actually used</font>

211
00:12:34,209 --> 00:12:41,050
in<font color="#E5E5E5"> real life penetration testing so this</font>

212
00:12:38,230 --> 00:12:45,190
<font color="#E5E5E5">is the way</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> rider came out</font><font color="#CCCCCC"> it's</font>

213
00:12:41,050 --> 00:12:50,229
<font color="#E5E5E5">written on</font><font color="#CCCCCC"> see on windows and uses win32</font>

214
00:12:45,190 --> 00:12:52,509
<font color="#CCCCCC">api and actually works on all the recent</font>

215
00:12:50,230 --> 00:12:54,550
versions of<font color="#CCCCCC"> of party</font><font color="#E5E5E5"> and furthermore</font>

216
00:12:52,509 --> 00:12:59,079
does not require<font color="#E5E5E5"> administrative</font>

217
00:12:54,550 --> 00:13:01,719
privileges<font color="#E5E5E5"> so if you gain access to an</font>

218
00:12:59,079 --> 00:13:04,359
<font color="#CCCCCC">administrators machine with his own</font>

219
00:13:01,720 --> 00:13:07,000
credentials and<font color="#E5E5E5"> he is not local</font>

220
00:13:04,360 --> 00:13:12,069
administrator with the writers<font color="#CCCCCC"> to works</font>

221
00:13:07,000 --> 00:13:17,199
because he<font color="#CCCCCC"> it injects into a process</font>

222
00:13:12,069 --> 00:13:22,120
started by the same user this is the

223
00:13:17,199 --> 00:13:25,839
architecture of<font color="#E5E5E5"> of the tool</font>

224
00:13:22,120 --> 00:13:28,779
<font color="#CCCCCC">ok so white</font><font color="#E5E5E5"> attacker</font><font color="#CCCCCC"> blusas</font><font color="#E5E5E5"> that mean</font>

225
00:13:25,839 --> 00:13:31,389
<font color="#CCCCCC">the flow is the following the attacker</font>

226
00:13:28,779 --> 00:13:34,630
using the remote shell on this machine

227
00:13:31,389 --> 00:13:37,899
starts the<font color="#E5E5E5"> party</font><font color="#CCCCCC"> rider dot exe this is</font>

228
00:13:34,630 --> 00:13:41,769
the injector and this injector

229
00:13:37,899 --> 00:13:45,069
<font color="#E5E5E5">executable actually inject the dll into</font>

230
00:13:41,769 --> 00:13:53,920
the memory of<font color="#CCCCCC"> booty dot</font><font color="#E5E5E5"> exe process</font>

231
00:13:45,069 --> 00:13:59,259
<font color="#CCCCCC">ok and after injection it installs</font><font color="#E5E5E5"> hooks</font>

232
00:13:53,920 --> 00:14:01,899
onto functions from the inside the<font color="#CCCCCC"> pussy</font>

233
00:13:59,259 --> 00:14:04,089
<font color="#CCCCCC">lot XD memory is called the eldest and</font>

234
00:14:01,899 --> 00:14:10,180
<font color="#E5E5E5">term paper we will see what are those</font>

235
00:14:04,089 --> 00:14:13,870
<font color="#E5E5E5">and the communication</font><font color="#CCCCCC"> so put the rider</font>

236
00:14:10,180 --> 00:14:17,620
<font color="#CCCCCC">dll after it installed successfully on</font>

237
00:14:13,870 --> 00:14:19,670
the<font color="#E5E5E5"> party .</font><font color="#CCCCCC"> exe memory it to communicate</font>

238
00:14:17,620 --> 00:14:21,770
with<font color="#CCCCCC"> a VR</font><font color="#E5E5E5"> pipe</font>

239
00:14:19,670 --> 00:14:26,270
<font color="#CCCCCC">we've put it right</font><font color="#E5E5E5"> there .</font><font color="#CCCCCC"> exe which</font>

240
00:14:21,770 --> 00:14:29,600
transmits back<font color="#CCCCCC"> data to the remote social</font>

241
00:14:26,270 --> 00:14:31,970
<font color="#E5E5E5">this is</font><font color="#CCCCCC"> 11 way</font><font color="#E5E5E5"> of communication but</font>

242
00:14:29,600 --> 00:14:34,940
actually put<font color="#E5E5E5"> the writer does not</font>

243
00:14:31,970 --> 00:14:39,920
necessarily have to be here but<font color="#CCCCCC"> us see</font>

244
00:14:34,940 --> 00:14:43,010
<font color="#E5E5E5">this can be used only to inject the</font><font color="#CCCCCC"> dll</font>

245
00:14:39,920 --> 00:14:46,910
<font color="#CCCCCC">then to</font><font color="#E5E5E5"> exit and then the system in will</font>

246
00:14:43,010 --> 00:14:49,790
not see anything if he tries to do a

247
00:14:46,910 --> 00:14:52,850
process list because there is actually

248
00:14:49,790 --> 00:15:00,469
only the<font color="#E5E5E5"> dll in the memory of</font><font color="#CCCCCC"> put it .</font>

249
00:14:52,850 --> 00:15:03,920
<font color="#CCCCCC">exe so there</font><font color="#E5E5E5"> is no no other process and</font>

250
00:15:00,470 --> 00:15:05,930
the<font color="#CCCCCC"> booty rider</font><font color="#E5E5E5"> dll actually can</font>

251
00:15:03,920 --> 00:15:08,780
initiate this reverse connection to the

252
00:15:05,930 --> 00:15:11,660
attackers machine and the attacker must

253
00:15:08,780 --> 00:15:14,930
listen with<font color="#CCCCCC"> knit cap and at this moment</font>

254
00:15:11,660 --> 00:15:20,569
<font color="#E5E5E5">to receive the the traffic</font>

255
00:15:14,930 --> 00:15:24,739
<font color="#CCCCCC">ok I told you about those those</font>

256
00:15:20,570 --> 00:15:29,180
functions<font color="#E5E5E5"> so the main thing of</font><font color="#CCCCCC"> the</font>

257
00:15:24,740 --> 00:15:31,820
writer is that<font color="#E5E5E5"> it installs hooks on</font>

258
00:15:29,180 --> 00:15:36,020
these two functions in order to hijack

259
00:15:31,820 --> 00:15:41,240
<font color="#E5E5E5">them these two functions are</font><font color="#CCCCCC"> L discs and</font>

260
00:15:36,020 --> 00:15:44,540
<font color="#E5E5E5">term data</font><font color="#CCCCCC"> these are functions from the</font>

261
00:15:41,240 --> 00:15:50,510
source code of<font color="#CCCCCC"> duty and</font><font color="#E5E5E5"> the first one</font>

262
00:15:44,540 --> 00:15:52,640
handles the input received from the from

263
00:15:50,510 --> 00:15:55,069
the user<font color="#CCCCCC"> so when you when you type at</font>

264
00:15:52,640 --> 00:15:57,920
the keyboard<font color="#CCCCCC"> the characters that you</font>

265
00:15:55,070 --> 00:16:00,560
type will pass through this function and

266
00:15:57,920 --> 00:16:03,650
then will be sent to the<font color="#CCCCCC"> backend</font><font color="#E5E5E5"> and</font>

267
00:16:00,560 --> 00:16:06,140
when the answer comes back from the

268
00:16:03,650 --> 00:16:08,300
server it will come through the second

269
00:16:06,140 --> 00:16:10,730
function<font color="#E5E5E5"> term data which will display</font>

270
00:16:08,300 --> 00:16:16,579
the output in the terminal

271
00:16:10,730 --> 00:16:20,360
<font color="#CCCCCC">ok</font><font color="#E5E5E5"> and if you see the definitions of</font>

272
00:16:16,580 --> 00:16:21,470
this if<font color="#CCCCCC"> dysfunctions you</font><font color="#E5E5E5"> can see two</font>

273
00:16:20,360 --> 00:16:23,840
parameters

274
00:16:21,470 --> 00:16:26,390
it's a buffer in the length and also a

275
00:16:23,840 --> 00:16:28,730
data in the length<font color="#CCCCCC"> this this is actually</font>

276
00:16:26,390 --> 00:16:31,660
the<font color="#E5E5E5"> our data that that were interested</font>

277
00:16:28,730 --> 00:16:38,740
in

278
00:16:31,660 --> 00:16:43,569
one challenge for writing this tool was

279
00:16:38,740 --> 00:16:46,000
how to find the address of these

280
00:16:43,570 --> 00:16:51,190
functions<font color="#E5E5E5"> these two functions in the</font>

281
00:16:46,000 --> 00:16:53,200
<font color="#CCCCCC">city memory</font><font color="#E5E5E5"> because</font><font color="#CCCCCC"> put a dot exe does</font>

282
00:16:51,190 --> 00:16:55,930
not export any function and we cannot

283
00:16:53,200 --> 00:16:59,530
use<font color="#CCCCCC"> the</font><font color="#E5E5E5"> library and get the process</font>

284
00:16:55,930 --> 00:17:02,949
<font color="#E5E5E5">address</font><font color="#CCCCCC"> to to actually get the address</font>

285
00:16:59,530 --> 00:17:07,960
of the function<font color="#E5E5E5"> the solution that</font><font color="#CCCCCC"> I came</font>

286
00:17:02,950 --> 00:17:12,760
up<font color="#E5E5E5"> with was to download all the binaries</font>

287
00:17:07,960 --> 00:17:16,720
<font color="#E5E5E5">of existing</font><font color="#CCCCCC"> party versions and then I</font>

288
00:17:12,760 --> 00:17:20,470
managed to create<font color="#E5E5E5"> signatures binary</font>

289
00:17:16,720 --> 00:17:23,470
signatures for the two functions for the

290
00:17:20,470 --> 00:17:27,460
beginning of the two functions so<font color="#CCCCCC"> 4l</font>

291
00:17:23,470 --> 00:17:29,680
<font color="#CCCCCC">disc sent I found 21</font><font color="#E5E5E5"> bites and if I</font>

292
00:17:27,460 --> 00:17:33,310
<font color="#CCCCCC">search the memory of putting dot</font><font color="#E5E5E5"> exe for</font>

293
00:17:29,680 --> 00:17:35,200
these 21<font color="#E5E5E5"> bites i find uniquely</font>

294
00:17:33,310 --> 00:17:39,550
<font color="#E5E5E5">dysfunction</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> beginning of this</font>

295
00:17:35,200 --> 00:17:44,020
function then<font color="#CCCCCC"> for</font><font color="#E5E5E5"> term data</font><font color="#CCCCCC"> i found</font>

296
00:17:39,550 --> 00:17:50,470
<font color="#CCCCCC">signal</font><font color="#E5E5E5"> three signatures for of 18</font><font color="#CCCCCC"> bites</font>

297
00:17:44,020 --> 00:17:53,770
<font color="#E5E5E5">which cover</font><font color="#CCCCCC"> put</font><font color="#E5E5E5"> is from 0-60</font><font color="#CCCCCC"> 54 20</font><font color="#E5E5E5"> 63</font>

298
00:17:50,470 --> 00:17:56,230
which is the latest version<font color="#CCCCCC"> so</font><font color="#E5E5E5"> actually</font>

299
00:17:53,770 --> 00:17:58,240
by searching the memory of<font color="#CCCCCC"> put the</font><font color="#E5E5E5"> dot</font>

300
00:17:56,230 --> 00:18:01,000
<font color="#E5E5E5">exe for these signatures</font><font color="#CCCCCC"> i managed to</font>

301
00:17:58,240 --> 00:18:04,150
find the the beginning of this for all

302
00:18:01,000 --> 00:18:07,690
<font color="#E5E5E5">these functions then</font><font color="#CCCCCC"> i have to do</font>

303
00:18:04,150 --> 00:18:11,680
<font color="#E5E5E5">function hooking in order to hijack the</font>

304
00:18:07,690 --> 00:18:17,290
<font color="#E5E5E5">functions function hooking happens as</font>

305
00:18:11,680 --> 00:18:20,380
following<font color="#E5E5E5"> here is the</font><font color="#CCCCCC"> dll main function</font>

306
00:18:17,290 --> 00:18:24,580
which is called when the<font color="#CCCCCC"> dl is loaded</font>

307
00:18:20,380 --> 00:18:27,580
into the memory of<font color="#E5E5E5"> our process and we</font>

308
00:18:24,580 --> 00:18:31,000
have this switch when they'll process

309
00:18:27,580 --> 00:18:33,790
attached<font color="#E5E5E5"> i call a start function which</font>

310
00:18:31,000 --> 00:18:37,660
does the following<font color="#CCCCCC"> locate</font><font color="#E5E5E5"> the addresses</font>

311
00:18:33,790 --> 00:18:41,500
of<font color="#CCCCCC"> all disks and internal</font><font color="#E5E5E5"> data as a as</font>

312
00:18:37,660 --> 00:18:43,000
we saw previously<font color="#E5E5E5"> we also define</font><font color="#CCCCCC"> two</font>

313
00:18:41,500 --> 00:18:46,690
other functions

314
00:18:43,000 --> 00:18:50,140
the handlers<font color="#E5E5E5"> my eldest</font><font color="#CCCCCC"> end my turn data</font>

315
00:18:46,690 --> 00:18:53,560
<font color="#E5E5E5">and</font><font color="#CCCCCC"> I actually</font><font color="#E5E5E5"> over right into the</font>

316
00:18:50,140 --> 00:18:58,510
memory of<font color="#E5E5E5"> it .</font><font color="#CCCCCC"> exe</font><font color="#E5E5E5"> at the beginning of</font>

317
00:18:53,560 --> 00:19:02,800
the legitimate function<font color="#CCCCCC"> l discs</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> our</font>

318
00:18:58,510 --> 00:19:09,430
<font color="#CCCCCC">op codes for the instruction jump to the</font>

319
00:19:02,800 --> 00:19:12,129
address of my<font color="#E5E5E5"> handler functions so i</font>

320
00:19:09,430 --> 00:19:16,420
have<font color="#E5E5E5"> defined</font><font color="#CCCCCC"> a separate function that</font>

321
00:19:12,130 --> 00:19:20,020
the<font color="#E5E5E5"> handle is actually the data of one</font>

322
00:19:16,420 --> 00:19:21,610
of<font color="#CCCCCC"> awful descent let's say and</font><font color="#E5E5E5"> I</font>

323
00:19:20,020 --> 00:19:24,700
override the beginning of the legitimate

324
00:19:21,610 --> 00:19:28,270
function<font color="#CCCCCC"> with a jump instruction to my</font>

325
00:19:24,700 --> 00:19:30,520
handler function<font color="#E5E5E5"> so when</font><font color="#CCCCCC"> put a</font><font color="#E5E5E5"> dot exe</font>

326
00:19:28,270 --> 00:19:33,790
<font color="#CCCCCC">will try to execute its legitimate</font>

327
00:19:30,520 --> 00:19:35,200
function<font color="#E5E5E5"> the execution will actually</font>

328
00:19:33,790 --> 00:19:46,899
<font color="#E5E5E5">jump to my function</font>

329
00:19:35,200 --> 00:19:49,030
<font color="#CCCCCC">ok and here is how it happens in the in</font>

330
00:19:46,900 --> 00:19:51,520
the first column it's a piece of memory

331
00:19:49,030 --> 00:19:55,660
of<font color="#CCCCCC"> booty the THC</font><font color="#E5E5E5"> and in the second</font>

332
00:19:51,520 --> 00:19:58,990
column is the<font color="#CCCCCC"> dll load it into the same</font>

333
00:19:55,660 --> 00:20:02,740
address space of putting<font color="#CCCCCC"> dot</font><font color="#E5E5E5"> exe</font><font color="#CCCCCC"> this is</font>

334
00:19:58,990 --> 00:20:06,070
the piece of legitimate function

335
00:20:02,740 --> 00:20:08,380
terminal data and with<font color="#E5E5E5"> red</font><font color="#CCCCCC"> it's the</font>

336
00:20:06,070 --> 00:20:12,220
attackers<font color="#CCCCCC"> code I</font><font color="#E5E5E5"> I mean</font><font color="#CCCCCC"> my</font><font color="#E5E5E5"> my code</font>

337
00:20:08,380 --> 00:20:14,620
injected into that process<font color="#CCCCCC"> so this is</font>

338
00:20:12,220 --> 00:20:17,410
with the red here is actually the jump

339
00:20:14,620 --> 00:20:21,729
that<font color="#E5E5E5"> I told you previously</font><font color="#CCCCCC"> so the party</font>

340
00:20:17,410 --> 00:20:25,120
code comes here then because of the jump

341
00:20:21,730 --> 00:20:31,150
<font color="#E5E5E5">it will jump to my function my handler</font>

342
00:20:25,120 --> 00:20:35,199
<font color="#CCCCCC">ok then</font><font color="#E5E5E5"> my handler will restore the</font>

343
00:20:31,150 --> 00:20:37,240
legitimate function code will modify the

344
00:20:35,200 --> 00:20:40,090
return address of the legitimate

345
00:20:37,240 --> 00:20:42,610
function and<font color="#E5E5E5"> will</font><font color="#CCCCCC"> end with will do</font>

346
00:20:40,090 --> 00:20:44,770
<font color="#E5E5E5">something with the data actually the</font>

347
00:20:42,610 --> 00:20:46,719
data<font color="#E5E5E5"> will send it to the attacker or put</font>

348
00:20:44,770 --> 00:20:51,520
it in<font color="#CCCCCC"> a file or do something with</font><font color="#E5E5E5"> it</font>

349
00:20:46,720 --> 00:20:54,940
<font color="#E5E5E5">ok and then</font><font color="#CCCCCC"> called</font><font color="#E5E5E5"> the original function</font>

350
00:20:51,520 --> 00:20:56,120
again to do<font color="#CCCCCC"> its</font><font color="#E5E5E5"> think so in order to</font><font color="#CCCCCC"> for</font>

351
00:20:54,940 --> 00:21:00,800
these are not<font color="#CCCCCC"> too</font>

352
00:20:56,120 --> 00:21:03,889
not to say anything<font color="#E5E5E5"> and then after the</font>

353
00:21:00,800 --> 00:21:06,320
original function finishes<font color="#CCCCCC"> because of</font>

354
00:21:03,890 --> 00:21:09,170
the modified<font color="#CCCCCC"> jump address it will also</font>

355
00:21:06,320 --> 00:21:12,350
jump into another piece of my code which

356
00:21:09,170 --> 00:21:16,580
<font color="#CCCCCC">we insert</font><font color="#E5E5E5"> the hook</font><font color="#CCCCCC"> at the</font><font color="#E5E5E5"> beginning of</font>

357
00:21:12,350 --> 00:21:19,280
<font color="#CCCCCC">term data and after that the code</font>

358
00:21:16,580 --> 00:21:28,820
continuous with the legitimate<font color="#E5E5E5"> pretty</font>

359
00:21:19,280 --> 00:21:32,720
<font color="#E5E5E5">coat okay</font><font color="#CCCCCC"> I think I talked too much and</font>

360
00:21:28,820 --> 00:21:34,850
we<font color="#E5E5E5"> will see how it works</font><font color="#CCCCCC"> you know</font><font color="#E5E5E5"> how</font>

361
00:21:32,720 --> 00:21:37,700
<font color="#E5E5E5">they say when you do a live demo you</font>

362
00:21:34,850 --> 00:21:41,899
always have to pray that the demo gods

363
00:21:37,700 --> 00:21:58,490
are with you so<font color="#E5E5E5"> let's</font><font color="#CCCCCC"> great</font>

364
00:21:41,900 --> 00:22:01,520
<font color="#CCCCCC">ok so we have we have this scenario</font><font color="#E5E5E5"> so</font>

365
00:21:58,490 --> 00:22:03,260
the attacker<font color="#CCCCCC"> the attacker is white</font>

366
00:22:01,520 --> 00:22:15,560
this<font color="#E5E5E5"> is something is blue and the target</font>

367
00:22:03,260 --> 00:22:20,150
server is<font color="#CCCCCC"> dark and yeah okay so this is</font>

368
00:22:15,560 --> 00:22:27,950
the attacker<font color="#E5E5E5"> this is the blue one should</font>

369
00:22:20,150 --> 00:22:33,040
be<font color="#E5E5E5"> yeah and the victim should be here</font>

370
00:22:27,950 --> 00:22:41,560
it's a<font color="#E5E5E5"> linux machine</font>

371
00:22:33,040 --> 00:22:49,060
this is the IP address of the target<font color="#CCCCCC"> so</font>

372
00:22:41,560 --> 00:22:51,730
we want actually to reach here<font color="#E5E5E5"> and this</font>

373
00:22:49,060 --> 00:23:04,480
is<font color="#E5E5E5"> the system administrator which runs</font>

374
00:22:51,730 --> 00:23:06,970
<font color="#CCCCCC">40 which should open here it</font><font color="#E5E5E5"> is so let's</font>

375
00:23:04,480 --> 00:23:09,490
<font color="#E5E5E5">say that the system administrator wants</font>

376
00:23:06,970 --> 00:23:14,050
to log into one of the production

377
00:23:09,490 --> 00:23:15,010
servers called<font color="#E5E5E5"> by bank- broad</font><font color="#CCCCCC"> this is</font>

378
00:23:14,050 --> 00:23:16,419
the IP address

379
00:23:15,010 --> 00:23:29,670
<font color="#CCCCCC">it's actually</font><font color="#E5E5E5"> that</font><font color="#CCCCCC"> return the</font><font color="#E5E5E5"> other</font>

380
00:23:16,420 --> 00:23:34,560
<font color="#E5E5E5">video machine</font>

381
00:23:29,670 --> 00:23:38,070
<font color="#CCCCCC">ok so now let's say the system</font>

382
00:23:34,560 --> 00:23:41,610
administrator is here and he has this

383
00:23:38,070 --> 00:23:47,429
<font color="#CCCCCC">despotic connection open we will leave</font>

384
00:23:41,610 --> 00:23:52,169
it<font color="#CCCCCC"> always</font><font color="#E5E5E5"> on top in order to see what</font>

385
00:23:47,430 --> 00:24:07,360
happens now<font color="#CCCCCC"> me as an attacker i will run</font>

386
00:23:52,170 --> 00:24:11,380
<font color="#CCCCCC">metasploit</font>

387
00:24:07,360 --> 00:24:15,879
<font color="#CCCCCC">ok you should let to start</font><font color="#E5E5E5"> for a few</font>

388
00:24:11,380 --> 00:24:19,690
seconds<font color="#CCCCCC"> I opened</font><font color="#E5E5E5"> the second terminal and</font>

389
00:24:15,880 --> 00:24:23,410
in order to simulate my access rights I

390
00:24:19,690 --> 00:24:25,990
said that I in my scenario i<font color="#CCCCCC"> gained</font>

391
00:24:23,410 --> 00:24:30,040
<font color="#E5E5E5">dominate</font><font color="#CCCCCC"> dominate mean account in this</font>

392
00:24:25,990 --> 00:24:32,290
actually in this scenario<font color="#CCCCCC"> I I suppose</font>

393
00:24:30,040 --> 00:24:34,480
<font color="#E5E5E5">that</font><font color="#CCCCCC"> I have the ashes of the</font>

394
00:24:32,290 --> 00:24:37,480
administrator account of the<font color="#E5E5E5"> machine</font>

395
00:24:34,480 --> 00:24:40,540
<font color="#E5E5E5">yeah</font><font color="#CCCCCC"> i also found the lot of times in</font>

396
00:24:37,480 --> 00:24:43,360
practice<font color="#E5E5E5"> where</font><font color="#CCCCCC"> internal companies</font><font color="#E5E5E5"> so</font>

397
00:24:40,540 --> 00:24:47,950
companies on their internal network use

398
00:24:43,360 --> 00:24:50,110
the same password for a single

399
00:24:47,950 --> 00:24:52,090
administrative account for all<font color="#E5E5E5"> of the</font>

400
00:24:50,110 --> 00:24:54,399
machines<font color="#E5E5E5"> local account</font>

401
00:24:52,090 --> 00:24:56,830
<font color="#E5E5E5">yeah</font><font color="#CCCCCC"> so if you</font><font color="#E5E5E5"> managed to gain access to</font>

402
00:24:54,400 --> 00:24:58,690
one machine<font color="#E5E5E5"> extract the hashes of that</font>

403
00:24:56,830 --> 00:25:01,178
administrative account<font color="#E5E5E5"> then you can use</font>

404
00:24:58,690 --> 00:25:01,900
the<font color="#E5E5E5"> hashes to gain access to other</font>

405
00:25:01,179 --> 00:25:04,510
<font color="#CCCCCC">machines</font>

406
00:25:01,900 --> 00:25:08,260
this is actually a realistic scenario

407
00:25:04,510 --> 00:25:12,610
<font color="#E5E5E5">this</font><font color="#CCCCCC"> store</font>

408
00:25:08,260 --> 00:25:19,870
<font color="#CCCCCC">ok so this is the hash of the</font>

409
00:25:12,610 --> 00:25:32,080
administrator

410
00:25:19,870 --> 00:25:36,520
we will use the<font color="#E5E5E5"> pc exact model</font><font color="#CCCCCC"> show</font>

411
00:25:32,080 --> 00:25:42,429
<font color="#E5E5E5">options and first of all we'll have to</font>

412
00:25:36,520 --> 00:25:50,290
set the remote host which we can find it

413
00:25:42,430 --> 00:26:06,700
in other ways but this is easier<font color="#CCCCCC"> so it's</font>

414
00:25:50,290 --> 00:26:12,970
<font color="#CCCCCC">12 internet</font>

415
00:26:06,700 --> 00:26:22,360
ok we have a share<font color="#CCCCCC"> in the share in this</font>

416
00:26:12,970 --> 00:26:35,710
particular case<font color="#CCCCCC"> schools should they load</font>

417
00:26:22,360 --> 00:26:40,270
<font color="#CCCCCC">those</font><font color="#E5E5E5"> interpreter</font><font color="#CCCCCC"> reverse tcp show</font>

418
00:26:35,710 --> 00:26:42,850
options set<font color="#CCCCCC"> they'll</font><font color="#E5E5E5"> host this is the</font>

419
00:26:40,270 --> 00:26:48,670
<font color="#CCCCCC">localhost</font><font color="#E5E5E5"> well we will receive the</font>

420
00:26:42,850 --> 00:26:51,610
interpreter connection<font color="#CCCCCC"> nine that one</font><font color="#E5E5E5"> and</font>

421
00:26:48,670 --> 00:27:05,340
<font color="#CCCCCC">I</font><font color="#E5E5E5"> we have to tell the</font><font color="#CCCCCC"> SMB user and</font>

422
00:26:51,610 --> 00:27:16,209
password

423
00:27:05,340 --> 00:27:20,889
<font color="#CCCCCC">k</font><font color="#E5E5E5"> and this should work</font>

424
00:27:16,210 --> 00:27:23,230
<font color="#E5E5E5">ok so</font><font color="#CCCCCC"> i guess i gained access to the</font>

425
00:27:20,890 --> 00:27:28,720
administrators machine with<font color="#CCCCCC"> matter</font>

426
00:27:23,230 --> 00:27:32,290
better<font color="#E5E5E5"> right now</font><font color="#CCCCCC"> we're system but</font><font color="#E5E5E5"> we're</font>

427
00:27:28,720 --> 00:27:35,290
not interested in this<font color="#E5E5E5"> in this role</font><font color="#CCCCCC"> we</font>

428
00:27:32,290 --> 00:27:38,409
we want to migrate into a process

429
00:27:35,290 --> 00:27:47,830
started by the same user as<font color="#CCCCCC"> putting dot</font>

430
00:27:38,410 --> 00:27:54,130
<font color="#E5E5E5">exe</font><font color="#CCCCCC"> so I'm looking for explorer.exe this</font>

431
00:27:47,830 --> 00:28:03,970
is the process ID and we<font color="#CCCCCC"> migrated into</font>

432
00:27:54,130 --> 00:28:08,590
<font color="#E5E5E5">this process I be</font><font color="#CCCCCC"> okay</font>

433
00:28:03,970 --> 00:28:09,340
my particular<font color="#E5E5E5"> local user is called</font>

434
00:28:08,590 --> 00:28:13,240
systems

435
00:28:09,340 --> 00:28:14,740
yeah<font color="#E5E5E5"> so</font><font color="#CCCCCC"> I am running code with his</font>

436
00:28:13,240 --> 00:28:20,890
privileges right now

437
00:28:14,740 --> 00:28:28,420
<font color="#CCCCCC">ok so let's go back to put the writer</font><font color="#E5E5E5"> so</font>

438
00:28:20,890 --> 00:28:31,540
<font color="#E5E5E5">me as an attacker</font><font color="#CCCCCC"> i have I need these</font>

439
00:28:28,420 --> 00:28:33,940
two files<font color="#CCCCCC"> the divider dot exe</font><font color="#E5E5E5"> and put it</font>

440
00:28:31,540 --> 00:28:36,820
<font color="#E5E5E5">right there</font><font color="#CCCCCC"> . dll</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> first of all I</font>

441
00:28:33,940 --> 00:28:39,670
need to upload these two files to the

442
00:28:36,820 --> 00:28:45,220
remote machine and then<font color="#E5E5E5"> execute them</font>

443
00:28:39,670 --> 00:28:50,830
<font color="#CCCCCC">actually i did some</font><font color="#E5E5E5"> tests previously and</font>

444
00:28:45,220 --> 00:28:56,410
<font color="#CCCCCC">i think yeah</font><font color="#E5E5E5"> I think they're already</font>

445
00:28:50,830 --> 00:28:59,110
uploaded so we are running in<font color="#CCCCCC"> ceaseless</font>

446
00:28:56,410 --> 00:28:59,860
<font color="#CCCCCC">Templars party rider on the under remote</font>

447
00:28:59,110 --> 00:29:07,840
machine

448
00:28:59,860 --> 00:29:10,719
<font color="#E5E5E5">ok and the right now we need to show and</font>

449
00:29:07,840 --> 00:29:14,399
right now we're executing commands on

450
00:29:10,720 --> 00:29:17,580
the remote machine right good

451
00:29:14,400 --> 00:29:30,300
so let's<font color="#E5E5E5"> see</font>

452
00:29:17,580 --> 00:29:33,149
<font color="#CCCCCC">22</font><font color="#E5E5E5"> either</font><font color="#CCCCCC"> so we have a help menu</font><font color="#E5E5E5"> and</font>

453
00:29:30,300 --> 00:29:36,840
this is the<font color="#E5E5E5"> disorderly operation modes</font>

454
00:29:33,150 --> 00:29:41,130
<font color="#CCCCCC">least</font><font color="#E5E5E5"> injecting and</font><font color="#CCCCCC"> waiting background</font>

455
00:29:36,840 --> 00:29:48,939
<font color="#E5E5E5">use a certain</font><font color="#CCCCCC"> Pete</font><font color="#E5E5E5"> accept commands and</font>

456
00:29:41,130 --> 00:29:56,890
output modes<font color="#CCCCCC"> ok for the beginning</font>

457
00:29:48,940 --> 00:30:01,540
<font color="#E5E5E5">minus sell this is injected because</font>

458
00:29:56,890 --> 00:30:06,340
because i forgot provided the<font color="#E5E5E5"> writer</font>

459
00:30:01,540 --> 00:30:15,070
running<font color="#E5E5E5"> i guess the</font><font color="#CCCCCC"> skills</font>

460
00:30:06,340 --> 00:30:34,850
yes<font color="#E5E5E5"> I should kill it in order to start</font>

461
00:30:15,070 --> 00:30:39,560
to start<font color="#E5E5E5"> fresh ok</font><font color="#CCCCCC"> this killed</font>

462
00:30:34,850 --> 00:30:43,699
it doesn't<font color="#E5E5E5"> work yeah</font><font color="#CCCCCC"> so this</font><font color="#E5E5E5"> is the</font>

463
00:30:39,560 --> 00:30:48,710
situation<font color="#E5E5E5"> yeah and the administrator has</font>

464
00:30:43,700 --> 00:30:52,760
the<font color="#CCCCCC"> put the rider</font><font color="#E5E5E5"> console open and with-</font>

465
00:30:48,710 --> 00:30:57,110
<font color="#CCCCCC">cell we can see that there is a pretty</font>

466
00:30:52,760 --> 00:30:59,660
open and the connection is between our

467
00:30:57,110 --> 00:31:03,860
IP address and remote IP address<font color="#E5E5E5"> and</font>

468
00:30:59,660 --> 00:31:08,480
<font color="#E5E5E5">it's not injected with</font><font color="#CCCCCC"> the rider yet</font><font color="#E5E5E5"> and</font>

469
00:31:03,860 --> 00:31:10,520
we want to inject it<font color="#E5E5E5"> and at the moment</font>

470
00:31:08,480 --> 00:31:18,050
in this directory there are only<font color="#E5E5E5"> these</font>

471
00:31:10,520 --> 00:31:21,230
two files and put right the minus p0

472
00:31:18,050 --> 00:31:24,889
<font color="#CCCCCC">this means inject in the first put the</font>

473
00:31:21,230 --> 00:31:30,440
process that you find and minus<font color="#E5E5E5"> f means</font>

474
00:31:24,890 --> 00:31:34,730
that log all the session information in

475
00:31:30,440 --> 00:31:37,790
the in the local<font color="#CCCCCC"> five</font>

476
00:31:34,730 --> 00:31:39,950
<font color="#CCCCCC">ok so what it does searching for a party</font>

477
00:31:37,790 --> 00:31:43,490
process it found the party with process

478
00:31:39,950 --> 00:31:45,230
ID<font color="#E5E5E5"> and when you see these messages with</font>

479
00:31:43,490 --> 00:31:51,350
the process ID<font color="#E5E5E5"> these are received from</font>

480
00:31:45,230 --> 00:31:54,500
the<font color="#CCCCCC"> DL and</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> DLLs once</font><font color="#E5E5E5"> first to find</font>

481
00:31:51,350 --> 00:31:58,520
the addresses of<font color="#E5E5E5"> discontent and term</font>

482
00:31:54,500 --> 00:32:03,230
data by searching the address space of

483
00:31:58,520 --> 00:32:09,379
<font color="#CCCCCC">duty . exe respectively the</font><font color="#E5E5E5"> text section</font>

484
00:32:03,230 --> 00:32:12,320
<font color="#CCCCCC">ok and it found the target functions</font><font color="#E5E5E5"> it</font>

485
00:32:09,380 --> 00:32:17,240
installed the hooks and it created the

486
00:32:12,320 --> 00:32:23,810
log file at this location and then the

487
00:32:17,240 --> 00:32:27,230
injector<font color="#E5E5E5"> exits and if we do do we see</font>

488
00:32:23,810 --> 00:32:31,970
that the log file is created here but it

489
00:32:27,230 --> 00:32:35,240
has<font color="#CCCCCC"> zero</font><font color="#E5E5E5"> bytes and now let's say that</font>

490
00:32:31,970 --> 00:32:43,820
the administrator wants to do something

491
00:32:35,240 --> 00:32:49,820
maybe wants to change his password

492
00:32:43,820 --> 00:32:52,159
to something

493
00:32:49,820 --> 00:32:57,139
<font color="#CCCCCC">ok so these</font><font color="#E5E5E5"> are actions performed by the</font>

494
00:32:52,160 --> 00:33:00,710
<font color="#E5E5E5">by demonstrator right now the pretty log</font>

495
00:32:57,140 --> 00:33:03,440
is still<font color="#CCCCCC"> zero because</font><font color="#E5E5E5"> it uses our out</font>

496
00:33:00,710 --> 00:33:06,890
<font color="#CCCCCC">the buffering</font><font color="#E5E5E5"> and in order to actually</font>

497
00:33:03,440 --> 00:33:15,879
get the<font color="#E5E5E5"> output we have to extract</font><font color="#CCCCCC"> pretty</font>

498
00:33:06,890 --> 00:33:19,269
<font color="#CCCCCC">rider</font>

499
00:33:15,879 --> 00:33:27,369
so<font color="#E5E5E5"> it's minus</font><font color="#CCCCCC"> 6</font><font color="#E5E5E5"> you actually extract the</font>

500
00:33:19,269 --> 00:33:30,309
<font color="#CCCCCC">dll from the boot</font><font color="#E5E5E5"> process and now it</font><font color="#CCCCCC"> is</font>

501
00:33:27,369 --> 00:33:37,839
flush the buffer and it wrote the file

502
00:33:30,309 --> 00:33:41,589
<font color="#E5E5E5">and if we look inside</font>

503
00:33:37,839 --> 00:33:43,928
what<font color="#E5E5E5"> you see so it</font><font color="#CCCCCC"> starts from here</font>

504
00:33:41,589 --> 00:33:47,139
<font color="#E5E5E5">it sees the local and</font><font color="#CCCCCC"> point the remote</font>

505
00:33:43,929 --> 00:33:49,329
<font color="#CCCCCC">end point of</font><font color="#E5E5E5"> the connection and you can</font>

506
00:33:47,139 --> 00:33:53,319
actually see what the administrator

507
00:33:49,329 --> 00:33:55,209
typed included including the clear text

508
00:33:53,319 --> 00:33:59,199
passwords

509
00:33:55,209 --> 00:34:02,229
<font color="#CCCCCC">ok so this this was the the first</font>

510
00:33:59,199 --> 00:34:05,019
scenario where they put the connection

511
00:34:02,229 --> 00:34:10,509
was already open

512
00:34:05,019 --> 00:34:14,139
let's close it and right now we're

513
00:34:10,509 --> 00:34:18,039
supposing that we<font color="#E5E5E5"> gain access to an</font>

514
00:34:14,139 --> 00:34:20,740
<font color="#CCCCCC">administrators machine</font><font color="#E5E5E5"> and he doesn't</font>

515
00:34:18,039 --> 00:34:23,919
have<font color="#CCCCCC"> put the open but we know that he</font>

516
00:34:20,739 --> 00:34:27,339
will open it at<font color="#E5E5E5"> some time because he's</font>

517
00:34:23,918 --> 00:34:29,168
the administrator and we want to live

518
00:34:27,339 --> 00:34:31,389
<font color="#CCCCCC">with the right</font><font color="#E5E5E5"> there running in</font>

519
00:34:29,168 --> 00:34:40,868
background in order to listen for

520
00:34:31,389 --> 00:34:46,329
opening<font color="#E5E5E5"> party .</font><font color="#CCCCCC"> exe for</font><font color="#E5E5E5"> this we use the</font>

521
00:34:40,869 --> 00:34:50,289
minus<font color="#CCCCCC"> wait option</font><font color="#E5E5E5"> and furthermore when</font>

522
00:34:46,329 --> 00:34:53,109
the<font color="#CCCCCC"> party</font><font color="#E5E5E5"> will open position will open</font>

523
00:34:50,289 --> 00:34:55,240
we want the<font color="#E5E5E5"> dll to initiate reverse</font>

524
00:34:53,109 --> 00:35:02,558
connection to our machine<font color="#E5E5E5"> and for this</font>

525
00:34:55,239 --> 00:35:05,558
we use this argument<font color="#CCCCCC"> 6809 that one</font>

526
00:35:02,559 --> 00:35:11,790
let's say in port 8080<font color="#E5E5E5"> and we have to</font>

527
00:35:05,559 --> 00:35:22,710
open the sport

528
00:35:11,790 --> 00:35:25,800
we do it<font color="#CCCCCC"> with netcat so</font><font color="#E5E5E5"> not get is</font>

529
00:35:22,710 --> 00:35:28,440
listening<font color="#E5E5E5"> and when the administrator</font>

530
00:35:25,800 --> 00:35:32,790
will open the position we also receive

531
00:35:28,440 --> 00:35:37,200
here on a connection from the dealer

532
00:35:32,790 --> 00:35:41,070
<font color="#CCCCCC">ok we start</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> t rider it's</font><font color="#E5E5E5"> running in</font>

533
00:35:37,200 --> 00:35:43,259
background now<font color="#E5E5E5"> the drawback here is that</font>

534
00:35:41,070 --> 00:35:46,530
the administrator could see it in the

535
00:35:43,260 --> 00:35:49,920
list of processes<font color="#CCCCCC"> but you can rename it</font>

536
00:35:46,530 --> 00:35:54,570
with a different name<font color="#CCCCCC"> update dot exe or</font>

537
00:35:49,920 --> 00:35:56,280
something and the right now let's

538
00:35:54,570 --> 00:35:59,670
suppose

539
00:35:56,280 --> 00:36:10,930
let's suppose the administrator opens

540
00:35:59,670 --> 00:36:15,220
<font color="#E5E5E5">new session not that on</font>

541
00:36:10,930 --> 00:36:18,399
so right now

542
00:36:15,220 --> 00:36:31,379
<font color="#CCCCCC">well</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> dl has connected to our</font>

543
00:36:18,400 --> 00:36:37,109
listener and

544
00:36:31,380 --> 00:36:41,369
<font color="#CCCCCC">okay so everything</font>

545
00:36:37,109 --> 00:36:50,038
<font color="#CCCCCC">thank you</font>

546
00:36:41,369 --> 00:36:53,339
everything administrator rights here it

547
00:36:50,039 --> 00:36:56,730
appears<font color="#E5E5E5"> on our on our machine</font><font color="#CCCCCC"> but</font><font color="#E5E5E5"> there</font>

548
00:36:53,339 --> 00:37:01,019
<font color="#E5E5E5">is more we can actually inject commands</font>

549
00:36:56,730 --> 00:37:04,950
in order<font color="#E5E5E5"> to do that we moved to this tub</font>

550
00:37:01,019 --> 00:37:09,000
so if we try to to send something

551
00:37:04,950 --> 00:37:11,009
it tells<font color="#CCCCCC"> us that it tells us that you</font>

552
00:37:09,000 --> 00:37:13,769
must first disconnect the<font color="#CCCCCC"> party window</font>

553
00:37:11,009 --> 00:37:15,930
<font color="#CCCCCC">because otherwise</font><font color="#E5E5E5"> anything that you</font><font color="#CCCCCC"> will</font>

554
00:37:13,769 --> 00:37:18,240
<font color="#CCCCCC">write here we Lobby you will appear to</font>

555
00:37:15,930 --> 00:37:21,720
the administrators window and we don't

556
00:37:18,240 --> 00:37:29,669
want to do that<font color="#CCCCCC"> and we have also</font><font color="#E5E5E5"> menu</font>

557
00:37:21,720 --> 00:37:31,980
here and we can see the status so the

558
00:37:29,670 --> 00:37:34,140
<font color="#E5E5E5">put the window is connected and it</font>

559
00:37:31,980 --> 00:37:39,630
receives user input in order for us to

560
00:37:34,140 --> 00:37:42,450
step inside we have<font color="#E5E5E5"> two discs on</font><font color="#CCCCCC"> what</font>

561
00:37:39,630 --> 00:37:48,539
the window disconnected<font color="#E5E5E5"> and right now</font>

562
00:37:42,450 --> 00:37:52,019
you see the administrator doesn't see

563
00:37:48,539 --> 00:38:02,910
anything but furthermore it cannot also

564
00:37:52,019 --> 00:38:08,368
<font color="#E5E5E5">it cannot type anything so we can do</font>

565
00:38:02,910 --> 00:38:11,848
yeah and the the<font color="#CCCCCC"> amine</font><font color="#E5E5E5"> cannot see</font>

566
00:38:08,369 --> 00:38:17,970
anything in the interface and when we

567
00:38:11,849 --> 00:38:25,619
<font color="#E5E5E5">are over with it we can do recon</font>

568
00:38:17,970 --> 00:38:29,640
<font color="#CCCCCC">reconnect</font><font color="#E5E5E5"> and right now</font><font color="#CCCCCC"> the amine can do</font>

569
00:38:25,619 --> 00:38:35,940
<font color="#E5E5E5">it stuff</font>

570
00:38:29,640 --> 00:38:40,950
<font color="#E5E5E5">yeah and</font><font color="#CCCCCC"> the if if this session closed</font>

571
00:38:35,940 --> 00:38:46,319
this<font color="#CCCCCC"> we can see</font><font color="#E5E5E5"> that our connection is</font>

572
00:38:40,950 --> 00:38:52,770
closed and when<font color="#E5E5E5"> getting straighter opens</font>

573
00:38:46,319 --> 00:39:07,970
again we can see again<font color="#CCCCCC"> when</font><font color="#E5E5E5"> connected</font>

574
00:38:52,770 --> 00:39:10,820
with another process ID<font color="#CCCCCC"> yeah</font><font color="#E5E5E5"> so</font>

575
00:39:07,970 --> 00:39:12,709
<font color="#E5E5E5">but</font><font color="#CCCCCC"> rather</font><font color="#E5E5E5"> will be available for</font>

576
00:39:10,820 --> 00:39:17,570
download in a few<font color="#E5E5E5"> days on guitar because</font>

577
00:39:12,710 --> 00:39:22,670
the latest changes<font color="#CCCCCC"> i did them last night</font>

578
00:39:17,570 --> 00:39:24,770
but<font color="#E5E5E5"> I promise you in a few days it will</font>

579
00:39:22,670 --> 00:39:27,710
be available for download freely and to

580
00:39:24,770 --> 00:39:29,750
be used for your purposes

581
00:39:27,710 --> 00:39:34,869
thank you and if you have other

582
00:39:29,750 --> 00:39:34,869
questions

