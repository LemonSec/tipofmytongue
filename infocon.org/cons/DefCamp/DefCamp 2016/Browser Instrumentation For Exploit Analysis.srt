1
00:00:00,000 --> 00:00:10,019
<font color="#E5E5E5">hi guys i am</font><font color="#CCCCCC"> mission</font><font color="#E5E5E5"> also</font><font color="#CCCCCC"> behind yahoo</font>

2
00:00:06,089 --> 00:00:15,570
<font color="#E5E5E5">i'm doing</font><font color="#CCCCCC"> expert research at</font><font color="#E5E5E5"> the</font>

3
00:00:10,019 --> 00:00:20,189
defender in the past<font color="#CCCCCC"> have done</font><font color="#E5E5E5"> a</font>

4
00:00:15,570 --> 00:00:23,220
cloud-based<font color="#CCCCCC"> antivirus scanner i was</font>

5
00:00:20,189 --> 00:00:28,349
doing the client the client component

6
00:00:23,220 --> 00:00:32,549
that would scan the computer for viruses

7
00:00:28,349 --> 00:00:36,239
and would cooperate with the cloud to

8
00:00:32,549 --> 00:00:41,309
make a decision about the<font color="#E5E5E5"> infection or</font>

9
00:00:36,239 --> 00:00:42,180
not<font color="#E5E5E5"> of those files</font><font color="#CCCCCC"> also</font><font color="#E5E5E5"> done data</font>

10
00:00:41,309 --> 00:00:43,890
encryption

11
00:00:42,180 --> 00:00:48,690
<font color="#E5E5E5">I mean reverse engineering data</font>

12
00:00:43,890 --> 00:00:54,239
encryption and general general<font color="#E5E5E5"> resource</font>

13
00:00:48,690 --> 00:00:56,640
<font color="#E5E5E5">engineering</font><font color="#CCCCCC"> whatever whatever has</font>

14
00:00:54,239 --> 00:01:03,358
<font color="#CCCCCC">reverse</font><font color="#E5E5E5"> engineering</font><font color="#CCCCCC"> i'm very interested</font>

15
00:00:56,640 --> 00:01:08,670
and<font color="#E5E5E5"> yeah that's my passion today</font><font color="#CCCCCC"> I'm</font>

16
00:01:03,359 --> 00:01:15,000
<font color="#E5E5E5">going to talk about expert kids and</font>

17
00:01:08,670 --> 00:01:19,920
method of instrumenting<font color="#CCCCCC"> the browser so</font>

18
00:01:15,000 --> 00:01:21,780
that we can see deeper inside<font color="#E5E5E5"> how the</font>

19
00:01:19,920 --> 00:01:23,369
exploitation is taking place

20
00:01:21,780 --> 00:01:26,189
first of all<font color="#CCCCCC"> i'm going to talk about</font>

21
00:01:23,369 --> 00:01:31,049
<font color="#E5E5E5">exploit</font><font color="#CCCCCC"> keeps in general and how they</font>

22
00:01:26,189 --> 00:01:36,750
work<font color="#CCCCCC"> then we will see a demo with the</font>

23
00:01:31,049 --> 00:01:39,640
<font color="#CCCCCC">pair of</font><font color="#E5E5E5"> expert and payload then we will</font>

24
00:01:36,750 --> 00:01:42,400
see the problem<font color="#CCCCCC"> at all</font>

25
00:01:39,640 --> 00:01:45,370
<font color="#E5E5E5">appears there and how we can solve it</font>

26
00:01:42,400 --> 00:01:47,800
through browser<font color="#E5E5E5"> instrumentation then we</font>

27
00:01:45,370 --> 00:01:51,460
will see another demo with the<font color="#E5E5E5"> browser</font>

28
00:01:47,800 --> 00:02:00,970
<font color="#E5E5E5">instrumentation turned on and later</font><font color="#CCCCCC"> i</font>

29
00:01:51,460 --> 00:02:06,039
will tell you a bit of<font color="#CCCCCC"> advices love</font><font color="#E5E5E5"> them</font>

30
00:02:00,970 --> 00:02:11,230
<font color="#CCCCCC">ok can</font><font color="#E5E5E5"> you</font><font color="#CCCCCC"> hear me now is it is it</font>

31
00:02:06,040 --> 00:02:18,340
better<font color="#CCCCCC"> or ok so expert kids are</font>

32
00:02:11,230 --> 00:02:22,120
<font color="#E5E5E5">exploited delivery service</font><font color="#CCCCCC"> the red guy</font>

33
00:02:18,340 --> 00:02:26,470
there is a bad actor<font color="#CCCCCC"> he's</font><font color="#E5E5E5"> paying the</font>

34
00:02:22,120 --> 00:02:29,260
exploit<font color="#E5E5E5"> keep service in order to</font><font color="#CCCCCC"> deliver</font>

35
00:02:26,470 --> 00:02:32,620
through<font color="#E5E5E5"> an exploit</font><font color="#CCCCCC"> the marware</font><font color="#E5E5E5"> to the</font>

36
00:02:29,260 --> 00:02:36,190
victims<font color="#E5E5E5"> also the same actor is doing</font>

37
00:02:32,620 --> 00:02:39,130
<font color="#E5E5E5">compromise on legitimate websites so</font>

38
00:02:36,190 --> 00:02:41,800
that it would redirect traffic to the

39
00:02:39,130 --> 00:02:43,570
exploit and then<font color="#CCCCCC"> exploit keep</font><font color="#E5E5E5"> the taste</font>

40
00:02:41,800 --> 00:02:51,010
that takes care of the rest

41
00:02:43,570 --> 00:02:54,609
now what's interesting is that this is a

42
00:02:51,010 --> 00:02:58,390
business people are making money<font color="#CCCCCC"> the</font>

43
00:02:54,610 --> 00:03:02,590
maps<font color="#E5E5E5"> that they are paying the expected</font>

44
00:02:58,390 --> 00:03:06,339
service and they they benefit from

45
00:03:02,590 --> 00:03:07,840
<font color="#CCCCCC">Instagram somewhere or</font><font color="#E5E5E5"> stealing bank</font>

46
00:03:06,340 --> 00:03:13,600
details from the victim

47
00:03:07,840 --> 00:03:23,350
what<font color="#CCCCCC"> I'm interested</font><font color="#E5E5E5"> in this scenario is</font>

48
00:03:13,600 --> 00:03:25,420
if we have an exploitation<font color="#E5E5E5"> scenario</font><font color="#CCCCCC"> i</font>

49
00:03:23,350 --> 00:03:28,359
want to know what<font color="#CCCCCC"> the exploit in that</font>

50
00:03:25,420 --> 00:03:31,988
case was the exploit<font color="#CCCCCC"> so was the</font>

51
00:03:28,360 --> 00:03:40,750
vulnerability that is exploited and was

52
00:03:31,989 --> 00:04:11,680
the<font color="#CCCCCC"> modeler i will start with a and M</font>

53
00:03:40,750 --> 00:04:34,409
all

54
00:04:11,680 --> 00:04:37,679
<font color="#E5E5E5">let's see if this is working</font><font color="#CCCCCC"> ok do</font><font color="#E5E5E5"> this</font>

55
00:04:34,409 --> 00:04:42,959
<font color="#CCCCCC">okay</font><font color="#E5E5E5"> in my right hand side</font><font color="#CCCCCC"> I have</font>

56
00:04:37,679 --> 00:04:45,089
<font color="#E5E5E5">process monitor which shows what files</font>

57
00:04:42,959 --> 00:04:49,169
are being accessed<font color="#CCCCCC"> I</font><font color="#E5E5E5"> am filtering out</font>

58
00:04:45,089 --> 00:04:51,449
<font color="#CCCCCC">all the</font><font color="#E5E5E5"> right file and process create</font>

59
00:04:49,169 --> 00:04:54,719
events because that's what<font color="#CCCCCC"> I'm</font>

60
00:04:51,449 --> 00:04:59,550
interested in<font color="#E5E5E5"> and on the left side i</font>

61
00:04:54,719 --> 00:05:03,839
have<font color="#CCCCCC"> fiedler</font><font color="#E5E5E5"> that's</font><font color="#CCCCCC"> Leslie fer</font><font color="#E5E5E5"> it will</font>

62
00:04:59,550 --> 00:05:09,929
show me the HTTP requests as they are

63
00:05:03,839 --> 00:05:17,490
<font color="#CCCCCC">head</font><font color="#E5E5E5"> now here is a compromise site and</font>

64
00:05:09,929 --> 00:05:19,318
the series goes there

65
00:05:17,490 --> 00:05:27,310
<font color="#E5E5E5">we can see that a lot of things are</font>

66
00:05:19,319 --> 00:05:30,760
happening

67
00:05:27,310 --> 00:05:33,580
<font color="#E5E5E5">these errors</font><font color="#CCCCCC"> is errors are normal</font>

68
00:05:30,760 --> 00:05:38,170
<font color="#E5E5E5">I mean</font><font color="#CCCCCC"> are expected in this scenario</font>

69
00:05:33,580 --> 00:05:42,430
because the<font color="#CCCCCC"> expert</font><font color="#E5E5E5"> keep has delivered</font>

70
00:05:38,170 --> 00:05:45,310
multiple<font color="#E5E5E5"> exploits and one of them was</font>

71
00:05:42,430 --> 00:05:50,530
not working and<font color="#E5E5E5"> crashed</font><font color="#CCCCCC"> internet</font>

72
00:05:45,310 --> 00:05:54,010
<font color="#CCCCCC">explorer</font><font color="#E5E5E5"> now what we can see here we can</font>

73
00:05:50,530 --> 00:05:59,169
have a look on<font color="#E5E5E5"> traffic</font>

74
00:05:54,010 --> 00:06:03,039
I don't know if anything is visible

75
00:05:59,170 --> 00:06:07,690
there<font color="#E5E5E5"> perhaps like this</font><font color="#CCCCCC"> hilarious</font>

76
00:06:03,040 --> 00:06:12,160
yeah<font color="#E5E5E5"> so the first request was to the</font>

77
00:06:07,690 --> 00:06:19,330
legitimate site and this one has been

78
00:06:12,160 --> 00:06:24,310
replaced with<font color="#CCCCCC"> a very direction</font><font color="#E5E5E5"> to this</font>

79
00:06:19,330 --> 00:06:30,099
second

80
00:06:24,310 --> 00:06:32,860
<font color="#CCCCCC">to this</font><font color="#E5E5E5"> another</font><font color="#CCCCCC"> site</font><font color="#E5E5E5"> now as you can see</font>

81
00:06:30,100 --> 00:06:35,500
in the right side<font color="#E5E5E5"> around summer has</font>

82
00:06:32,860 --> 00:06:40,630
started to<font color="#CCCCCC"> increase the files all the</font>

83
00:06:35,500 --> 00:06:43,660
files from the hard drive it will

84
00:06:40,630 --> 00:06:48,610
<font color="#E5E5E5">finished in just</font><font color="#CCCCCC"> a bit and then it will</font>

85
00:06:43,660 --> 00:06:51,940
display a message informing me that it

86
00:06:48,610 --> 00:06:56,530
has successfully installed the

87
00:06:51,940 --> 00:07:01,810
ransomware<font color="#CCCCCC"> it all</font><font color="#E5E5E5"> out</font>

88
00:06:56,530 --> 00:07:05,710
<font color="#E5E5E5">it's a server somewhere</font><font color="#CCCCCC"> has here all the</font>

89
00:07:01,810 --> 00:07:13,360
information<font color="#CCCCCC"> send</font><font color="#E5E5E5"> me</font><font color="#CCCCCC"> money</font>

90
00:07:05,710 --> 00:07:15,700
please<font color="#CCCCCC"> sit and</font><font color="#E5E5E5"> let</font><font color="#CCCCCC"> continue so from</font><font color="#E5E5E5"> the</font>

91
00:07:13,360 --> 00:07:20,290
<font color="#E5E5E5">come from my sight it goes to this</font>

92
00:07:15,700 --> 00:07:23,500
gateway<font color="#CCCCCC"> it's called the Gateway</font><font color="#E5E5E5"> because</font>

93
00:07:20,290 --> 00:07:28,030
it will redirect to the<font color="#CCCCCC"> expert landing</font>

94
00:07:23,500 --> 00:07:30,460
page later<font color="#E5E5E5"> first it does</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> tries to</font><font color="#CCCCCC"> do</font>

95
00:07:28,030 --> 00:07:34,780
<font color="#CCCCCC">a fingerprinting</font><font color="#E5E5E5"> tries to detect if</font>

96
00:07:30,460 --> 00:07:39,580
<font color="#CCCCCC">kaspersky is installed</font><font color="#E5E5E5"> and if not we'll</font>

97
00:07:34,780 --> 00:07:44,140
go to the<font color="#CCCCCC"> exploit landing page</font><font color="#E5E5E5"> this URL</font>

98
00:07:39,580 --> 00:07:48,190
here now<font color="#CCCCCC"> to exploit</font><font color="#E5E5E5"> landing page</font>

99
00:07:44,140 --> 00:07:56,050
<font color="#CCCCCC">displayed</font><font color="#E5E5E5"> keeps landing page</font><font color="#CCCCCC"> is creating</font>

100
00:07:48,190 --> 00:08:00,640
a flash object<font color="#CCCCCC"> you can</font><font color="#E5E5E5"> see here which is</font>

101
00:07:56,050 --> 00:08:02,470
taken from this URL<font color="#CCCCCC"> i don't know if you</font>

102
00:08:00,640 --> 00:08:07,990
can<font color="#E5E5E5"> see there it's a very small flesh</font>

103
00:08:02,470 --> 00:08:16,160
has<font color="#E5E5E5"> 700</font><font color="#CCCCCC"> rights i will save the</font>

104
00:08:07,990 --> 00:08:22,610
<font color="#E5E5E5">racecourse</font>

105
00:08:16,160 --> 00:08:29,700
<font color="#CCCCCC">say</font><font color="#E5E5E5"> first</font><font color="#CCCCCC"> flesh</font>

106
00:08:22,610 --> 00:08:37,050
<font color="#E5E5E5">then delivers another flesh</font>

107
00:08:29,700 --> 00:08:43,559
<font color="#E5E5E5">second</font><font color="#CCCCCC"> flesh</font>

108
00:08:37,049 --> 00:08:47,399
and then<font color="#CCCCCC"> there is</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> JavaScript</font><font color="#E5E5E5"> exploit</font>

109
00:08:43,559 --> 00:08:51,300
that didn't work<font color="#E5E5E5"> and</font><font color="#CCCCCC"> crest explorer</font><font color="#E5E5E5"> and</font>

110
00:08:47,399 --> 00:08:58,680
then finally the payload the server

111
00:08:51,300 --> 00:09:02,609
<font color="#CCCCCC">palette is</font><font color="#E5E5E5"> downloaded here and executed</font>

112
00:08:58,680 --> 00:09:07,890
as we can see in the process monitor it

113
00:09:02,610 --> 00:09:11,399
drops in a temporary file a dot exe and

114
00:09:07,890 --> 00:09:14,699
tries to run it in three different ways

115
00:09:11,399 --> 00:09:22,390
<font color="#E5E5E5">one of them is using the windows</font>

116
00:09:14,700 --> 00:09:27,940
management instrumentation

117
00:09:22,390 --> 00:09:33,040
<font color="#CCCCCC">is</font><font color="#E5E5E5"> WM</font><font color="#CCCCCC"> IC</font><font color="#E5E5E5"> exhale followed by process</font>

118
00:09:27,940 --> 00:09:38,800
<font color="#E5E5E5">called create command /c</font><font color="#CCCCCC"> start and then</font>

119
00:09:33,040 --> 00:09:41,589
the temporary file<font color="#E5E5E5"> it also tries to</font>

120
00:09:38,800 --> 00:09:50,439
create it normally with process<font color="#E5E5E5"> grade</font>

121
00:09:41,590 --> 00:09:52,720
and also through<font color="#CCCCCC"> powershell ok let's</font>

122
00:09:50,440 --> 00:10:00,710
have a look at those<font color="#E5E5E5"> flash friends</font><font color="#CCCCCC"> and I</font>

123
00:09:52,720 --> 00:10:03,050
said here

124
00:10:00,710 --> 00:10:07,760
<font color="#E5E5E5">the first flash is a really small one</font>

125
00:10:03,050 --> 00:10:12,410
this is<font color="#E5E5E5"> a flash</font><font color="#CCCCCC"> decompiler to free</font>

126
00:10:07,760 --> 00:10:20,030
<font color="#E5E5E5">slightly compiler it contains only one</font>

127
00:10:12,410 --> 00:10:22,819
script and this script only checks for

128
00:10:20,030 --> 00:10:25,220
the flash version<font color="#CCCCCC"> reading is installed</font>

129
00:10:22,820 --> 00:10:30,140
and then based on that flash version

130
00:10:25,220 --> 00:10:33,590
will construct another request that has

131
00:10:30,140 --> 00:10:41,270
that<font color="#CCCCCC"> expression</font><font color="#E5E5E5"> transmitted to the</font>

132
00:10:33,590 --> 00:10:43,790
server in<font color="#CCCCCC"> a get</font><font color="#E5E5E5"> request was the purpose</font>

133
00:10:41,270 --> 00:10:47,840
of this<font color="#E5E5E5"> / well are depending on the</font>

134
00:10:43,790 --> 00:10:49,579
flash version it will deliver an

135
00:10:47,840 --> 00:10:52,910
appropriate<font color="#E5E5E5"> exploit for that</font><font color="#CCCCCC"> flash</font>

136
00:10:49,580 --> 00:10:57,260
version<font color="#E5E5E5"> so i could see that's a flash</font>

137
00:10:52,910 --> 00:11:02,600
select or if you want and the second

138
00:10:57,260 --> 00:11:07,460
<font color="#CCCCCC">flash is sent after the version has been</font>

139
00:11:02,600 --> 00:11:11,180
established we can see there's a binary

140
00:11:07,460 --> 00:11:14,810
data here it looks gibberish<font color="#E5E5E5"> and</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> this</font>

141
00:11:11,180 --> 00:11:21,260
<font color="#E5E5E5">nothing recognizable there and some</font>

142
00:11:14,810 --> 00:11:30,199
scripts<font color="#E5E5E5"> most of them are</font><font color="#CCCCCC"> NP</font>

143
00:11:21,260 --> 00:11:34,939
<font color="#E5E5E5">and one of them has the description part</font>

144
00:11:30,200 --> 00:11:37,370
it takes stuff from the binary data<font color="#E5E5E5"> put</font>

145
00:11:34,940 --> 00:11:41,180
it together in a buffer and then calls

146
00:11:37,370 --> 00:11:44,510
the<font color="#CCCCCC"> flash function load bites that would</font>

147
00:11:41,180 --> 00:11:47,780
<font color="#E5E5E5">take</font><font color="#CCCCCC"> that buffer</font><font color="#E5E5E5"> interpreted as flash</font>

148
00:11:44,510 --> 00:11:56,300
file and open it<font color="#E5E5E5"> but that happens in</font>

149
00:11:47,780 --> 00:12:03,680
memory<font color="#E5E5E5"> so what we can tell from from the</font>

150
00:11:56,300 --> 00:12:07,699
traffic analysis and hardest activity is

151
00:12:03,680 --> 00:12:09,500
that you<font color="#CCCCCC"> drop the flesh and that less</font>

152
00:12:07,700 --> 00:12:12,110
loads another<font color="#E5E5E5"> flesh but we don't have</font>

153
00:12:09,500 --> 00:12:29,260
<font color="#CCCCCC">the</font><font color="#E5E5E5"> offer we don't know what</font><font color="#CCCCCC"> their</font>

154
00:12:12,110 --> 00:12:37,390
flashes<font color="#CCCCCC"> ok</font>

155
00:12:29,260 --> 00:12:39,400
<font color="#E5E5E5">I think I lost my winter right</font>

156
00:12:37,390 --> 00:12:42,699
<font color="#E5E5E5">so let's recap from the behavior</font>

157
00:12:39,400 --> 00:12:45,910
analysis<font color="#CCCCCC"> to</font><font color="#E5E5E5"> in traffic inspection</font>

158
00:12:42,700 --> 00:12:48,130
<font color="#E5E5E5">that's the</font><font color="#CCCCCC"> fiddler part</font><font color="#E5E5E5"> we have seen the</font>

159
00:12:45,910 --> 00:12:50,469
<font color="#E5E5E5">compromise website we've seen</font><font color="#CCCCCC"> their</font>

160
00:12:48,130 --> 00:12:54,490
<font color="#E5E5E5">direction to the</font><font color="#CCCCCC"> Gateway</font><font color="#E5E5E5"> then we see</font>

161
00:12:50,470 --> 00:13:00,370
very direction to the magnitude<font color="#E5E5E5"> exploit</font>

162
00:12:54,490 --> 00:13:03,370
landing page<font color="#CCCCCC"> now</font><font color="#E5E5E5"> how can</font><font color="#CCCCCC"> I tell that</font><font color="#E5E5E5"> its</font>

163
00:13:00,370 --> 00:13:07,210
magnitude because that<font color="#CCCCCC"> flash selector</font>

164
00:13:03,370 --> 00:13:09,400
<font color="#E5E5E5">thing is a characteristic to magnitude</font>

165
00:13:07,210 --> 00:13:13,480
<font color="#CCCCCC">explosion so we have recognized the</font>

166
00:13:09,400 --> 00:13:19,240
<font color="#E5E5E5">exploited</font><font color="#CCCCCC"> we know</font><font color="#E5E5E5"> that the</font><font color="#CCCCCC"> pellet server</font>

167
00:13:13,480 --> 00:13:20,950
what we need is<font color="#E5E5E5"> the exploit</font><font color="#CCCCCC"> we</font><font color="#E5E5E5"> don't</font>

168
00:13:19,240 --> 00:13:23,290
know what the expletive yet because

169
00:13:20,950 --> 00:13:28,120
<font color="#CCCCCC">there's only is Robert that cause</font><font color="#E5E5E5"> lights</font>

170
00:13:23,290 --> 00:13:30,790
<font color="#E5E5E5">also from process activity we can only</font>

171
00:13:28,120 --> 00:13:33,070
see that<font color="#CCCCCC"> download it executes the</font><font color="#E5E5E5"> the</font>

172
00:13:30,790 --> 00:13:39,819
<font color="#CCCCCC">flash selector</font><font color="#E5E5E5"> than the first dropper</font>

173
00:13:33,070 --> 00:13:42,940
and directly<font color="#CCCCCC"> to the payload the problem</font>

174
00:13:39,820 --> 00:13:48,970
is<font color="#E5E5E5"> like I said</font><font color="#CCCCCC"> first proper has no</font>

175
00:13:42,940 --> 00:13:50,620
expert court<font color="#E5E5E5"> it has only a loader</font><font color="#CCCCCC"> those</font>

176
00:13:48,970 --> 00:13:54,130
<font color="#E5E5E5">bites</font>

177
00:13:50,620 --> 00:13:58,210
where is the actual exploit<font color="#E5E5E5"> well</font><font color="#CCCCCC"> i could</font>

178
00:13:54,130 --> 00:14:02,500
think that it's in there that<font color="#CCCCCC"> flash that</font>

179
00:13:58,210 --> 00:14:06,610
is loaded dynamically<font color="#E5E5E5"> so what we need is</font>

180
00:14:02,500 --> 00:14:09,970
more<font color="#E5E5E5"> in-depth inspection</font><font color="#CCCCCC"> basically this</font>

181
00:14:06,610 --> 00:14:10,690
thing here<font color="#CCCCCC"> we need</font><font color="#E5E5E5"> the buffer</font><font color="#CCCCCC"> offload</font>

182
00:14:09,970 --> 00:14:15,490
<font color="#CCCCCC">bites</font>

183
00:14:10,690 --> 00:14:20,140
now the problem is that the flash file

184
00:14:15,490 --> 00:14:22,390
cannot<font color="#E5E5E5"> be but not easily because it has</font>

185
00:14:20,140 --> 00:14:27,699
to contain<font color="#CCCCCC"> the body</font><font color="#E5E5E5"> information there is</font>

186
00:14:22,390 --> 00:14:30,040
a project that could that could put

187
00:14:27,700 --> 00:14:36,769
<font color="#E5E5E5">about information</font><font color="#CCCCCC"> and flash file by</font><font color="#E5E5E5"> is a</font>

188
00:14:30,040 --> 00:14:42,079
bit fragile much better would be

189
00:14:36,769 --> 00:14:45,230
<font color="#CCCCCC">browser instrumentation how does it work</font>

190
00:14:42,079 --> 00:14:47,508
well in the browser process<font color="#CCCCCC"> there is</font><font color="#E5E5E5"> an</font>

191
00:14:45,230 --> 00:14:53,809
instrumentation<font color="#CCCCCC"> more do</font><font color="#E5E5E5"> there with the</font>

192
00:14:47,509 --> 00:14:58,879
blue which makes<font color="#CCCCCC"> books on key functions</font>

193
00:14:53,809 --> 00:15:05,600
for instance<font color="#CCCCCC"> document.write</font><font color="#E5E5E5"> is used to</font>

194
00:14:58,879 --> 00:15:09,350
dynamically load HTML CSS<font color="#CCCCCC"> JavaScript</font>

195
00:15:05,600 --> 00:15:14,269
<font color="#CCCCCC">evil is used for dynamically loading</font>

196
00:15:09,350 --> 00:15:17,869
javascript and flash load<font color="#CCCCCC"> bites is used</font>

197
00:15:14,269 --> 00:15:21,439
for dynamically loading<font color="#E5E5E5"> flash files in</font>

198
00:15:17,869 --> 00:15:23,179
memory<font color="#CCCCCC"> this instrumentation all do</font>

199
00:15:21,439 --> 00:15:26,299
<font color="#E5E5E5">there's hooks on those functions and</font>

200
00:15:23,179 --> 00:15:42,279
dumps the memory object to the hard

201
00:15:26,299 --> 00:15:48,550
drive where they can be analyzed

202
00:15:42,279 --> 00:15:51,670
<font color="#E5E5E5">so as we can see</font><font color="#CCCCCC"> folks can be installed</font>

203
00:15:48,550 --> 00:15:54,758
in both browser components like the

204
00:15:51,670 --> 00:16:01,180
browser engine and in any browser

205
00:15:54,759 --> 00:16:04,180
<font color="#CCCCCC">plug-in that</font><font color="#E5E5E5"> we wish</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> wrote there are</font>

206
00:16:01,180 --> 00:16:09,550
the functions<font color="#E5E5E5"> as</font><font color="#CCCCCC"> I hooked</font><font color="#E5E5E5"> in each case</font>

207
00:16:04,180 --> 00:16:11,920
<font color="#CCCCCC">what's</font><font color="#E5E5E5"> interesting is the last part if</font>

208
00:16:09,550 --> 00:16:14,680
we also hook<font color="#E5E5E5"> create processing right</font>

209
00:16:11,920 --> 00:16:16,959
process memory and<font color="#CCCCCC"> create more threads</font>

210
00:16:14,680 --> 00:16:20,589
<font color="#CCCCCC">and things like that we can block the</font>

211
00:16:16,959 --> 00:16:22,388
payload execution<font color="#E5E5E5"> because in my case</font><font color="#CCCCCC"> I'm</font>

212
00:16:20,589 --> 00:16:24,459
only interested in the exploitation part

213
00:16:22,389 --> 00:16:29,230
<font color="#CCCCCC">i don't want the target to become</font>

214
00:16:24,459 --> 00:16:33,219
<font color="#CCCCCC">affected</font><font color="#E5E5E5"> so i can analyze because like</font>

215
00:16:29,230 --> 00:16:36,879
the<font color="#CCCCCC"> ransomware before it encrypted</font>

216
00:16:33,220 --> 00:16:39,999
everything on<font color="#CCCCCC"> the</font><font color="#E5E5E5"> hard</font><font color="#CCCCCC"> drive</font><font color="#E5E5E5"> and for</font>

217
00:16:36,879 --> 00:16:43,480
<font color="#E5E5E5">instance if i create</font><font color="#CCCCCC"> logs and</font><font color="#E5E5E5"> downsides</font>

218
00:16:39,999 --> 00:16:45,910
<font color="#E5E5E5">from the brother instrumentation</font><font color="#CCCCCC"> module</font>

219
00:16:43,480 --> 00:16:46,629
<font color="#E5E5E5">it would equip them so</font><font color="#CCCCCC"> i</font><font color="#E5E5E5"> can't have</font>

220
00:16:45,910 --> 00:16:51,519
access

221
00:16:46,629 --> 00:16:54,430
what I want is a dry run so after<font color="#E5E5E5"> the</font>

222
00:16:51,519 --> 00:16:56,139
<font color="#E5E5E5">exploit has taken place</font><font color="#CCCCCC"> Internet</font>

223
00:16:54,430 --> 00:16:57,099
<font color="#CCCCCC">Explorer</font><font color="#E5E5E5"> will not create any new</font>

224
00:16:56,139 --> 00:17:04,959
processes

225
00:16:57,100 --> 00:17:09,099
let's have a look at another demo this

226
00:17:04,959 --> 00:17:18,809
time it's another exploit kit with

227
00:17:09,099 --> 00:17:27,928
another payload

228
00:17:18,809 --> 00:17:35,549
<font color="#E5E5E5">and this time it will run with the</font>

229
00:17:27,929 --> 00:17:38,879
instrumentation module installed<font color="#E5E5E5"> same</font>

230
00:17:35,549 --> 00:17:42,990
thing as<font color="#E5E5E5"> before in my left hand side</font><font color="#CCCCCC"> I</font>

231
00:17:38,879 --> 00:17:45,928
have<font color="#CCCCCC"> fiddler</font><font color="#E5E5E5"> which captures the traffic</font>

232
00:17:42,990 --> 00:17:48,749
HTTP traffic on the right side<font color="#E5E5E5"> i have</font>

233
00:17:45,929 --> 00:17:56,610
<font color="#CCCCCC">process morning tour and I</font><font color="#E5E5E5"> will access</font>

234
00:17:48,749 --> 00:18:02,700
<font color="#CCCCCC">this compromise site it already finished</font>

235
00:17:56,610 --> 00:18:09,570
because tomorrow has not<font color="#CCCCCC"> here and we can</font>

236
00:18:02,700 --> 00:18:13,919
have a look again at the first<font color="#E5E5E5"> the entry</font>

237
00:18:09,570 --> 00:18:17,039
point if you wish<font color="#E5E5E5"> to compromise site now</font>

238
00:18:13,919 --> 00:18:24,090
is not replaced with the right direction

239
00:18:17,039 --> 00:18:29,940
<font color="#E5E5E5">but just some code is inserted here at</font>

240
00:18:24,090 --> 00:18:36,100
the beginning<font color="#E5E5E5"> it's an iframe</font><font color="#CCCCCC"> with this</font>

241
00:18:29,940 --> 00:18:40,210
<font color="#CCCCCC">Russian</font><font color="#E5E5E5"> URL</font>

242
00:18:36,100 --> 00:18:43,090
<font color="#E5E5E5">this is the gateway it doesn't have</font>

243
00:18:40,210 --> 00:18:46,419
fingerprinting<font color="#CCCCCC"> but it has another</font>

244
00:18:43,090 --> 00:18:54,760
direction to the<font color="#E5E5E5"> expert landing page</font>

245
00:18:46,419 --> 00:18:57,010
which is this<font color="#CCCCCC"> month now is</font><font color="#E5E5E5"> I</font><font color="#CCCCCC"> see me for</font>

246
00:18:54,760 --> 00:18:58,750
<font color="#CCCCCC">one am interested</font><font color="#E5E5E5"> is the what the expert</font>

247
00:18:57,010 --> 00:19:03,970
<font color="#E5E5E5">it was the exploit it was the</font><font color="#CCCCCC"> market</font>

248
00:18:58,750 --> 00:19:06,370
expert it is<font color="#CCCCCC"> sundown or Greek I can tell</font>

249
00:19:03,970 --> 00:19:11,080
that from the pattern of the landing

250
00:19:06,370 --> 00:19:14,020
page<font color="#E5E5E5"> but how can i tell which one is it</font>

251
00:19:11,080 --> 00:19:16,570
<font color="#E5E5E5">is it real or is it sundown</font><font color="#CCCCCC"> they have</font>

252
00:19:14,020 --> 00:19:21,010
the same pattern because most of the

253
00:19:16,570 --> 00:19:24,700
time<font color="#E5E5E5"> exploit kits still things from one</font>

254
00:19:21,010 --> 00:19:28,179
another<font color="#CCCCCC"> all</font><font color="#E5E5E5"> exploits and patterns so</font>

255
00:19:24,700 --> 00:19:33,370
that they create confusion<font color="#E5E5E5"> but there is</font>

256
00:19:28,179 --> 00:19:36,640
a<font color="#E5E5E5"> there's a header here in the</font><font color="#CCCCCC"> scaling</font>

257
00:19:33,370 --> 00:19:41,709
<font color="#E5E5E5">the page that says</font><font color="#CCCCCC"> X</font><font color="#E5E5E5"> powered by</font>

258
00:19:36,640 --> 00:19:44,440
<font color="#CCCCCC">Yugoslavian</font><font color="#E5E5E5"> business network</font><font color="#CCCCCC"> so that's</font>

259
00:19:41,710 --> 00:19:46,090
<font color="#E5E5E5">how I know it's a sundown because</font><font color="#CCCCCC"> they</font>

260
00:19:44,440 --> 00:19:47,890
<font color="#E5E5E5">was</font><font color="#CCCCCC"> livin business network is</font>

261
00:19:46,090 --> 00:19:56,230
responsible for sound down

262
00:19:47,890 --> 00:19:59,169
<font color="#CCCCCC">ok next it delivers a flash</font><font color="#E5E5E5"> and the</font>

263
00:19:56,230 --> 00:20:00,940
<font color="#E5E5E5">flesh</font><font color="#CCCCCC"> deliver the payload</font><font color="#E5E5E5"> after the</font>

264
00:19:59,169 --> 00:20:02,890
<font color="#E5E5E5">expectation is taking place</font>

265
00:20:00,940 --> 00:20:05,620
what's more interesting is here in the

266
00:20:02,890 --> 00:20:09,220
right side you can see the dumper

267
00:20:05,620 --> 00:20:15,639
<font color="#E5E5E5">creating a lot of dumps from memory</font>

268
00:20:09,220 --> 00:20:19,809
there's a lot of HTML dumps<font color="#E5E5E5"> there's also</font>

269
00:20:15,640 --> 00:20:24,880
<font color="#CCCCCC">javascript</font><font color="#E5E5E5"> dance from the eval function</font>

270
00:20:19,809 --> 00:20:29,260
<font color="#CCCCCC">there's also written</font><font color="#E5E5E5"> HTML that's HTML</font>

271
00:20:24,880 --> 00:20:32,860
that is appended to the<font color="#CCCCCC"> Dom</font><font color="#E5E5E5"> while</font>

272
00:20:29,260 --> 00:20:37,539
running<font color="#E5E5E5"> so dynamically created HTML you</font>

273
00:20:32,860 --> 00:20:40,000
can also the object parameters for<font color="#E5E5E5"> their</font>

274
00:20:37,539 --> 00:20:52,580
<font color="#CCCCCC">javascript for the flesh</font><font color="#E5E5E5"> object</font>

275
00:20:40,000 --> 00:20:55,970
<font color="#CCCCCC">association so</font><font color="#E5E5E5"> yes</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> look here</font>

276
00:20:52,580 --> 00:20:59,149
<font color="#E5E5E5">as you can see here the delivered</font>

277
00:20:55,970 --> 00:21:03,350
<font color="#CCCCCC">webpage from</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> expertise is a very</font>

278
00:20:59,149 --> 00:21:06,979
long and encrypted<font color="#CCCCCC"> javascript as you can</font>

279
00:21:03,350 --> 00:21:12,049
see there's not much to see the naked

280
00:21:06,980 --> 00:21:20,630
eye<font color="#E5E5E5"> somewhere here it decrypts this</font>

281
00:21:12,049 --> 00:21:23,480
<font color="#CCCCCC">JavaScript and cause evil</font><font color="#E5E5E5"> and here we</font>

282
00:21:20,630 --> 00:21:28,130
can see the encrypted<font color="#CCCCCC"> javascript</font><font color="#E5E5E5"> and</font>

283
00:21:23,480 --> 00:21:34,639
then<font color="#CCCCCC"> decrypted one which is done from</font>

284
00:21:28,130 --> 00:21:38,360
memory by the instrumentation utility<font color="#CCCCCC"> we</font>

285
00:21:34,639 --> 00:21:40,789
also see the written<font color="#E5E5E5"> HTML</font><font color="#CCCCCC"> don't know if</font>

286
00:21:38,360 --> 00:21:43,399
you can see there but it's a flash

287
00:21:40,789 --> 00:21:48,889
object created and ran

288
00:21:43,399 --> 00:21:52,158
now<font color="#E5E5E5"> what the most interesting part is</font>

289
00:21:48,889 --> 00:21:57,469
this<font color="#CCCCCC"> /</font><font color="#E5E5E5"> file that was dropped</font><font color="#CCCCCC"> this is the</font>

290
00:21:52,159 --> 00:22:01,250
actual exploitation is the buffer that

291
00:21:57,470 --> 00:22:04,220
was given to load<font color="#CCCCCC"> bites</font><font color="#E5E5E5"> because in this</font>

292
00:22:01,250 --> 00:22:08,210
case<font color="#CCCCCC"> is very</font><font color="#E5E5E5"> similar to the old one</font>

293
00:22:04,220 --> 00:22:10,460
<font color="#E5E5E5">where it would</font><font color="#CCCCCC"> lot bites with</font><font color="#E5E5E5"> above her</font>

294
00:22:08,210 --> 00:22:14,510
<font color="#E5E5E5">and this is</font><font color="#CCCCCC"> the buffer it's a flash file</font>

295
00:22:10,460 --> 00:22:17,480
<font color="#CCCCCC">can have a look on it and is the actual</font>

296
00:22:14,510 --> 00:22:21,320
exploit<font color="#CCCCCC"> I'm telling</font><font color="#E5E5E5"> an hour but you will</font>

297
00:22:17,480 --> 00:22:27,049
see with your own eyes

298
00:22:21,320 --> 00:22:28,720
<font color="#CCCCCC">that's</font><font color="#E5E5E5"> ever looking inside</font><font color="#CCCCCC"> it's not</font><font color="#E5E5E5"> much</font>

299
00:22:27,049 --> 00:22:35,650
here

300
00:22:28,720 --> 00:22:46,059
<font color="#CCCCCC">not here</font><font color="#E5E5E5"> not</font><font color="#CCCCCC"> here</font>

301
00:22:35,650 --> 00:22:51,370
oh this is it<font color="#E5E5E5"> it's a one of the</font><font color="#CCCCCC"> flash</font>

302
00:22:46,059 --> 00:22:54,639
components<font color="#E5E5E5"> script is using this function</font>

303
00:22:51,370 --> 00:22:57,459
<font color="#CCCCCC">is</font><font color="#E5E5E5"> type</font>

304
00:22:54,640 --> 00:23:01,000
actually it's<font color="#E5E5E5"> a</font><font color="#CCCCCC"> complete range timeline</font>

305
00:22:57,460 --> 00:23:06,700
operation and<font color="#E5E5E5"> there's lower another type</font>

306
00:23:01,000 --> 00:23:09,580
<font color="#E5E5E5">placement and because it's here</font><font color="#CCCCCC"> using</font>

307
00:23:06,700 --> 00:23:15,070
this type<font color="#CCCCCC"> delete</font><font color="#E5E5E5"> range time</font><font color="#CCCCCC"> I operation</font>

308
00:23:09,580 --> 00:23:21,129
which is very odd<font color="#E5E5E5"> we can tell that it's</font>

309
00:23:15,070 --> 00:23:28,330
<font color="#E5E5E5">a specific</font><font color="#CCCCCC"> flash expert 4117</font><font color="#E5E5E5"> from 2016</font>

310
00:23:21,130 --> 00:23:32,500
<font color="#E5E5E5">as</font><font color="#CCCCCC"> I will explain in the slides also</font><font color="#E5E5E5"> so</font>

311
00:23:28,330 --> 00:23:39,340
<font color="#E5E5E5">for</font><font color="#CCCCCC"> our recap</font><font color="#E5E5E5"> we could see in the memory</font>

312
00:23:32,500 --> 00:23:43,150
<font color="#CCCCCC">the decrypted javascript</font><font color="#E5E5E5"> then we can see</font>

313
00:23:39,340 --> 00:23:45,039
the flesh<font color="#E5E5E5"> object instance</font><font color="#CCCCCC"> equation</font><font color="#E5E5E5"> we</font>

314
00:23:43,150 --> 00:23:49,570
can<font color="#E5E5E5"> also see that the parameter their</font>

315
00:23:45,039 --> 00:23:52,720
<font color="#CCCCCC">exec</font><font color="#E5E5E5"> with a bobsled followed by</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> might</font>

316
00:23:49,570 --> 00:23:59,379
<font color="#E5E5E5">that's a shellcode we will see the</font>

317
00:23:52,720 --> 00:24:02,110
<font color="#E5E5E5">shellcode</font><font color="#CCCCCC"> in a bit</font><font color="#E5E5E5"> here we don't even</font>

318
00:23:59,380 --> 00:24:05,169
need to disassemble it because we can

319
00:24:02,110 --> 00:24:09,340
see the<font color="#CCCCCC"> Zito</font><font color="#E5E5E5"> TMP</font><font color="#CCCCCC"> that's the created file</font>

320
00:24:05,169 --> 00:24:14,350
in<font color="#E5E5E5"> the temporary folder and there is</font><font color="#CCCCCC"> a</font>

321
00:24:09,340 --> 00:24:17,020
<font color="#E5E5E5">URL with a</font><font color="#CCCCCC"> model</font><font color="#E5E5E5"> that's</font><font color="#CCCCCC"> a banker</font><font color="#E5E5E5"> that's</font>

322
00:24:14,350 --> 00:24:22,510
going to get executed<font color="#E5E5E5"> so this exploit</font>

323
00:24:17,020 --> 00:24:26,710
<font color="#CCCCCC">takes as a parameter</font><font color="#E5E5E5"> shellcode with a</font>

324
00:24:22,510 --> 00:24:29,110
URL<font color="#E5E5E5"> so</font><font color="#CCCCCC"> its genetic you can somebody can</font>

325
00:24:26,710 --> 00:24:31,890
put another URL there and use it

326
00:24:29,110 --> 00:24:35,280
<font color="#E5E5E5">same way</font>

327
00:24:31,890 --> 00:24:38,850
<font color="#E5E5E5">from</font><font color="#CCCCCC"> there our</font><font color="#E5E5E5"> delivery style operation</font>

328
00:24:35,280 --> 00:24:44,550
and placement<font color="#CCCCCC"> keywords if you</font><font color="#E5E5E5"> wish we</font>

329
00:24:38,850 --> 00:24:51,629
can tell that<font color="#CCCCCC"> this vulnerability</font><font color="#E5E5E5"> is a</font><font color="#CCCCCC"> cv</font>

330
00:24:44,550 --> 00:25:05,040
<font color="#E5E5E5">2016 417</font><font color="#CCCCCC"> about to this summer i think</font>

331
00:24:51,630 --> 00:25:11,160
somewhere or

332
00:25:05,040 --> 00:25:13,800
<font color="#CCCCCC">ok of some</font><font color="#E5E5E5"> words of advice please use</font>

333
00:25:11,160 --> 00:25:16,560
modern medication<font color="#E5E5E5"> please tell windows 10</font>

334
00:25:13,800 --> 00:25:21,030
<font color="#E5E5E5">at least</font><font color="#CCCCCC"> for a control flow</font><font color="#E5E5E5"> guard</font>

335
00:25:16,560 --> 00:25:23,940
because<font color="#CCCCCC"> the that's a very good very good</font>

336
00:25:21,030 --> 00:25:30,690
defense against<font color="#CCCCCC"> Rob</font><font color="#E5E5E5"> chains and things</font>

337
00:25:23,940 --> 00:25:33,840
like that<font color="#E5E5E5"> there's no real reason why you</font>

338
00:25:30,690 --> 00:25:35,790
wouldn't use Windows 10 actually if

339
00:25:33,840 --> 00:25:36,990
<font color="#E5E5E5">you're very very interesting</font>

340
00:25:35,790 --> 00:25:39,000
<font color="#CCCCCC">insecurities</font>

341
00:25:36,990 --> 00:25:44,130
there's also<font color="#E5E5E5"> chrome an edge</font><font color="#CCCCCC"> they have</font>

342
00:25:39,000 --> 00:25:49,350
powerful sandboxing features for

343
00:25:44,130 --> 00:25:53,970
instance if this exploit was<font color="#E5E5E5"> run in</font>

344
00:25:49,350 --> 00:25:56,340
<font color="#CCCCCC">chrome reg it would exploit but it would</font>

345
00:25:53,970 --> 00:26:00,960
remain in the sandbox<font color="#CCCCCC"> so it could</font>

346
00:25:56,340 --> 00:26:04,050
couldn't very much<font color="#E5E5E5"> people have need</font>

347
00:26:00,960 --> 00:26:07,440
another excellent for<font color="#E5E5E5"> privilege</font>

348
00:26:04,050 --> 00:26:10,770
escalation and that obviously raises the

349
00:26:07,440 --> 00:26:14,100
cost of the exploitation

350
00:26:10,770 --> 00:26:16,470
also<font color="#E5E5E5"> I recommend</font><font color="#CCCCCC"> adblock</font><font color="#E5E5E5"> not just for</font>

351
00:26:14,100 --> 00:26:19,560
blocking ads<font color="#E5E5E5"> but also from blocking</font>

352
00:26:16,470 --> 00:26:23,700
<font color="#E5E5E5">mother and exploit that comes through</font>

353
00:26:19,560 --> 00:26:26,429
<font color="#E5E5E5">ads</font><font color="#CCCCCC"> this is called him el vertising</font><font color="#E5E5E5"> and</font>

354
00:26:23,700 --> 00:26:29,730
obviously<font color="#E5E5E5"> makeups for your files so they</font>

355
00:26:26,430 --> 00:26:33,570
don't get encrypted but here<font color="#E5E5E5"> i can</font>

356
00:26:29,730 --> 00:26:36,930
recommend<font color="#CCCCCC"> dropbox</font><font color="#E5E5E5"> because</font><font color="#CCCCCC"> dropbox keeps</font>

357
00:26:33,570 --> 00:26:39,810
<font color="#CCCCCC">previous versions of files so let's</font><font color="#E5E5E5"> say</font>

358
00:26:36,930 --> 00:26:43,650
I'm keeping my pictures on<font color="#E5E5E5"> dropbox</font>

359
00:26:39,810 --> 00:26:50,280
<font color="#E5E5E5">folder that's always synchronized</font><font color="#CCCCCC"> I find</font>

360
00:26:43,650 --> 00:26:51,750
out there it goes<font color="#E5E5E5"> in a cloud and if the</font>

361
00:26:50,280 --> 00:26:55,200
computer<font color="#CCCCCC"> it becomes</font><font color="#E5E5E5"> effective</font><font color="#CCCCCC"> the</font>

362
00:26:51,750 --> 00:27:00,870
<font color="#CCCCCC">ransomware it</font><font color="#E5E5E5"> will increase those files</font>

363
00:26:55,200 --> 00:27:04,590
but<font color="#CCCCCC"> i can go</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> robach</font><font color="#E5E5E5"> side and get an</font>

364
00:27:00,870 --> 00:27:06,989
earlier version of each picture which is

365
00:27:04,590 --> 00:27:10,409
<font color="#CCCCCC">unencrypted</font>

366
00:27:06,990 --> 00:27:16,020
<font color="#CCCCCC">I hope you enjoyed the presentation</font>

367
00:27:10,410 --> 00:27:22,730
<font color="#CCCCCC">thanks for watching</font><font color="#E5E5E5"> and if you have</font>

368
00:27:16,020 --> 00:27:22,730
questions please

