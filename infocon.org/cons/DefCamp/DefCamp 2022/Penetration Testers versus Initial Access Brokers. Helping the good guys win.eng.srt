1
00:00:00,120 --> 00:00:02,820
hello hello everybody

2
00:00:02,820 --> 00:00:05,220
so many people in the room thank you for

3
00:00:05,220 --> 00:00:07,080
being here

4
00:00:07,080 --> 00:00:09,840
uh first of all I would like to say that

5
00:00:09,840 --> 00:00:11,820
it's very nice to be back

6
00:00:11,820 --> 00:00:15,299
after this period of pandemic it's a

7
00:00:15,299 --> 00:00:17,039
very good feeling to talk to real people

8
00:00:17,039 --> 00:00:19,680
instead of screens so thank you very

9
00:00:19,680 --> 00:00:21,119
much for being here

10
00:00:21,119 --> 00:00:22,740
and um

11
00:00:22,740 --> 00:00:24,900
a good shout of Applause for the death

12
00:00:24,900 --> 00:00:26,939
camp organizers who are doing a very

13
00:00:26,939 --> 00:00:28,980
good job

14
00:00:28,980 --> 00:00:32,180
for organizing different

15
00:00:34,440 --> 00:00:37,320
my name is Adrian Fortuna and today

16
00:00:37,320 --> 00:00:39,840
we're going to talk about initial access

17
00:00:39,840 --> 00:00:41,040
brokers

18
00:00:41,040 --> 00:00:43,440
and the difference between them and

19
00:00:43,440 --> 00:00:46,020
penetration testers in uh in the matter

20
00:00:46,020 --> 00:00:49,140
of the way they act and

21
00:00:49,140 --> 00:00:52,280
their techniques

22
00:00:52,739 --> 00:00:55,620
the agenda for today after a short

23
00:00:55,620 --> 00:00:57,960
introduction we will see the motivation

24
00:00:57,960 --> 00:00:59,280
for this talk

25
00:00:59,280 --> 00:01:01,800
we will see what are these initial

26
00:01:01,800 --> 00:01:03,480
access brokers

27
00:01:03,480 --> 00:01:07,619
what are their techniques and we will do

28
00:01:07,619 --> 00:01:10,340
in the second part a live demonstration

29
00:01:10,340 --> 00:01:13,140
of three

30
00:01:13,140 --> 00:01:15,299
attack techniques

31
00:01:15,299 --> 00:01:18,560
to see how how they go

32
00:01:21,119 --> 00:01:24,900
about myself I'm on EX full-time

33
00:01:24,900 --> 00:01:26,820
penetration tester

34
00:01:26,820 --> 00:01:28,920
I've been doing this for more than 10 15

35
00:01:28,920 --> 00:01:29,820
years

36
00:01:29,820 --> 00:01:33,479
I do have also a security engineering

37
00:01:33,479 --> 00:01:34,860
background

38
00:01:34,860 --> 00:01:37,020
and um

39
00:01:37,020 --> 00:01:39,240
five years ago I founded the pentas

40
00:01:39,240 --> 00:01:42,600
tools which is a security company based

41
00:01:42,600 --> 00:01:44,460
here in Romania

42
00:01:44,460 --> 00:01:47,759
and we are creating a product

43
00:01:47,759 --> 00:01:50,340
actually a toolkit for penetration

44
00:01:50,340 --> 00:01:53,399
testing and the vulnerability assessment

45
00:01:53,399 --> 00:01:55,500
you will show it you will see it today

46
00:01:55,500 --> 00:01:57,500
in the second part of the presentation

47
00:01:57,500 --> 00:02:00,540
also during my free time I do some

48
00:02:00,540 --> 00:02:02,340
teaching at the polytechnica University

49
00:02:02,340 --> 00:02:04,079
of Bucharest

50
00:02:04,079 --> 00:02:07,200
and I do some speaking at

51
00:02:07,200 --> 00:02:10,580
security events

52
00:02:12,120 --> 00:02:16,620
why are you why are we having this talk

53
00:02:16,620 --> 00:02:20,340
I wanted to share the light on what is

54
00:02:20,340 --> 00:02:23,040
happening on the

55
00:02:23,040 --> 00:02:25,800
dark economy let's say

56
00:02:25,800 --> 00:02:31,980
and um what are malicious threat actors

57
00:02:31,980 --> 00:02:34,620
um doing um

58
00:02:34,620 --> 00:02:37,620
to gain access on our networks and how

59
00:02:37,620 --> 00:02:41,220
how they work the purpose is to better

60
00:02:41,220 --> 00:02:44,940
understand their their behavior

61
00:02:44,940 --> 00:02:48,420
and to be able to reproduce it in our

62
00:02:48,420 --> 00:02:50,220
attack simulations

63
00:02:50,220 --> 00:02:53,519
and the pi the final purpose being to

64
00:02:53,519 --> 00:02:55,800
better defend against this type of

65
00:02:55,800 --> 00:02:58,200
attacks

66
00:02:58,200 --> 00:03:01,140
and the second point is uh to let you

67
00:03:01,140 --> 00:03:02,220
know

68
00:03:02,220 --> 00:03:05,819
and where to be aware that offensive

69
00:03:05,819 --> 00:03:06,959
knowledge

70
00:03:06,959 --> 00:03:08,519
can be used

71
00:03:08,519 --> 00:03:10,800
for good also for bad

72
00:03:10,800 --> 00:03:12,300
and um

73
00:03:12,300 --> 00:03:15,480
I want to incur encourage you to stick

74
00:03:15,480 --> 00:03:19,399
to the white side of the fence

75
00:03:21,300 --> 00:03:25,440
so what are these initial access brokers

76
00:03:25,440 --> 00:03:29,040
we all know about ransomware

77
00:03:29,040 --> 00:03:32,239
there are a lot of ransomware ganks

78
00:03:32,239 --> 00:03:35,700
that are operating tools like lock bit

79
00:03:35,700 --> 00:03:38,879
Conti black matter and so on

80
00:03:38,879 --> 00:03:41,580
and a few years ago

81
00:03:41,580 --> 00:03:44,519
a ransomware group had to do all the

82
00:03:44,519 --> 00:03:48,959
work they had to hack the company gain

83
00:03:48,959 --> 00:03:50,330
access pivot

84
00:03:50,330 --> 00:03:54,599
[Music]

85
00:03:54,599 --> 00:03:57,239
and install their malware

86
00:03:57,239 --> 00:04:01,739
then ask for ransom negotiate and do the

87
00:04:01,739 --> 00:04:03,080
whole process

88
00:04:03,080 --> 00:04:05,400
recently there are people who have

89
00:04:05,400 --> 00:04:07,019
specialized

90
00:04:07,019 --> 00:04:10,860
and they chose only the first part of

91
00:04:10,860 --> 00:04:14,280
the of the assessment and they what are

92
00:04:14,280 --> 00:04:17,639
they doing their their only gaining the

93
00:04:17,639 --> 00:04:21,540
access to corporate networks and they

94
00:04:21,540 --> 00:04:26,240
are selling this access on a dark Market

95
00:04:27,060 --> 00:04:30,060
for a rather small amount of money

96
00:04:30,060 --> 00:04:33,060
compared to what the ransomware gangs

97
00:04:33,060 --> 00:04:34,500
are doing

98
00:04:34,500 --> 00:04:37,860
but the thing is that um using this

99
00:04:37,860 --> 00:04:40,380
specialization the ransomware ganks

100
00:04:40,380 --> 00:04:45,120
right now have a much broader attack

101
00:04:45,120 --> 00:04:48,020
surface because they actually buy access

102
00:04:48,020 --> 00:04:53,240
and go and do their core stuff

103
00:04:55,979 --> 00:04:58,500
and where do they do we find these these

104
00:04:58,500 --> 00:04:59,430
access brokers

105
00:04:59,430 --> 00:05:00,720
[Music]

106
00:05:00,720 --> 00:05:05,960
on the dark web there are a few forums

107
00:05:06,300 --> 00:05:08,360
um especially for for this type of

108
00:05:08,360 --> 00:05:11,220
activities uh exploit is the most

109
00:05:11,220 --> 00:05:14,520
well-known xss Bridge forum

110
00:05:14,520 --> 00:05:17,699
these are their onion addresses

111
00:05:17,699 --> 00:05:19,919
and for those of you who have never

112
00:05:19,919 --> 00:05:22,080
entered um

113
00:05:22,080 --> 00:05:26,100
a dark web Forum uh here is a sneak peek

114
00:05:26,100 --> 00:05:29,220
this is the xss Forum you can see

115
00:05:29,220 --> 00:05:33,560
everything is in Russian mostly

116
00:05:34,560 --> 00:05:37,440
but with the help of Google translate we

117
00:05:37,440 --> 00:05:39,000
can see that this is a section for

118
00:05:39,000 --> 00:05:40,620
trading

119
00:05:40,620 --> 00:05:44,340
and they have a dedicated

120
00:05:44,340 --> 00:05:48,000
group for selling and buying access for

121
00:05:48,000 --> 00:05:51,479
networks RDP shells FTP SQL injection

122
00:05:51,479 --> 00:05:54,419
whatever you want

123
00:05:54,419 --> 00:05:58,979
so there is a high demand and also a

124
00:05:58,979 --> 00:06:00,780
good offer for this

125
00:06:00,780 --> 00:06:04,560
and here are some examples

126
00:06:04,560 --> 00:06:08,460
uh this person was selling in uh June

127
00:06:08,460 --> 00:06:10,740
last year

128
00:06:10,740 --> 00:06:12,780
for instance

129
00:06:12,780 --> 00:06:16,080
um Microsoft exchanged to access to

130
00:06:16,080 --> 00:06:19,800
companies with Microsoft exchange for

131
00:06:19,800 --> 00:06:22,940
only 5K

132
00:06:23,819 --> 00:06:26,400
these these were in the period where uh

133
00:06:26,400 --> 00:06:28,860
specific vulnerabilities were were being

134
00:06:28,860 --> 00:06:31,800
public for those software for sonic wall

135
00:06:31,800 --> 00:06:35,539
for Confluence and so on

136
00:06:35,880 --> 00:06:39,240
another example this user Salvador Dali

137
00:06:39,240 --> 00:06:42,780
is selling access to a USA based company

138
00:06:42,780 --> 00:06:44,580
Citrix access

139
00:06:44,580 --> 00:06:46,800
with active directory more than 100

140
00:06:46,800 --> 00:06:50,160
hosts and this is the price

141
00:06:50,160 --> 00:06:54,300
and another example you know archive.org

142
00:06:54,300 --> 00:07:00,060
the well-known internet history website

143
00:07:00,060 --> 00:07:03,000
it looks like they're having a Blog

144
00:07:03,000 --> 00:07:05,819
and um

145
00:07:05,819 --> 00:07:07,680
one month ago almost

146
00:07:07,680 --> 00:07:11,280
uh it was for for sale the access to the

147
00:07:11,280 --> 00:07:15,020
admin panel of their blog for only

148
00:07:15,020 --> 00:07:18,380
750 dollars

149
00:07:18,780 --> 00:07:21,120
so you can see that this stuff is uh is

150
00:07:21,120 --> 00:07:23,819
happening and it's real

151
00:07:23,819 --> 00:07:26,340
most types of access is

152
00:07:26,340 --> 00:07:28,860
um and the most interesting are for RDP

153
00:07:28,860 --> 00:07:32,400
VPN Citrix web admins web admin panels

154
00:07:32,400 --> 00:07:34,620
and so on

155
00:07:34,620 --> 00:07:37,680
and right now if we're talking about

156
00:07:37,680 --> 00:07:39,780
um how they work

157
00:07:39,780 --> 00:07:43,880
what are their techniques

158
00:07:44,340 --> 00:07:47,639
we know that they they borrow these

159
00:07:47,639 --> 00:07:50,099
techniques from they ransomware gangs

160
00:07:50,099 --> 00:07:53,880
and we know how Ransom ransomware games

161
00:07:53,880 --> 00:07:54,800
work

162
00:07:54,800 --> 00:07:56,360
by

163
00:07:56,360 --> 00:08:00,360
various reports from agencies like sisa

164
00:08:00,360 --> 00:08:02,840
they have a detailed

165
00:08:02,840 --> 00:08:05,580
detailed report on Conti ransomware for

166
00:08:05,580 --> 00:08:06,539
instance

167
00:08:06,539 --> 00:08:10,560
there was the famous Conte leaks

168
00:08:10,560 --> 00:08:13,020
that was really nice in February

169
00:08:13,020 --> 00:08:15,979
some

170
00:08:15,979 --> 00:08:19,560
some angry member from the Conti

171
00:08:19,560 --> 00:08:22,979
ransomware group was uh was angry

172
00:08:22,979 --> 00:08:24,000
because

173
00:08:24,000 --> 00:08:24,840
um

174
00:08:24,840 --> 00:08:27,900
the Conti group was supporting Russia

175
00:08:27,900 --> 00:08:32,219
and he was a pro-ukrainian and he got

176
00:08:32,219 --> 00:08:36,059
mad and he leaked a lot of data inside

177
00:08:36,059 --> 00:08:39,179
our data from from the group and this

178
00:08:39,179 --> 00:08:43,020
data contained actually a manual for

179
00:08:43,020 --> 00:08:46,620
those hackers with step-by-step guide on

180
00:08:46,620 --> 00:08:48,800
how to access the networks how to Pivot

181
00:08:48,800 --> 00:08:52,200
and and so on

182
00:08:52,200 --> 00:08:54,959
and also there are some Public public

183
00:08:54,959 --> 00:08:57,959
breach reports like the Cisco hack that

184
00:08:57,959 --> 00:09:00,660
happened a few months ago they wrote a

185
00:09:00,660 --> 00:09:02,959
really nice write-up

186
00:09:02,959 --> 00:09:06,060
detailing uh how the access was gained

187
00:09:06,060 --> 00:09:07,920
also the

188
00:09:07,920 --> 00:09:10,800
Colonial pipeline attack also ransomware

189
00:09:10,800 --> 00:09:12,600
attack

190
00:09:12,600 --> 00:09:14,519
we have um

191
00:09:14,519 --> 00:09:17,339
we have details for those also so I have

192
00:09:17,339 --> 00:09:19,860
compiled from those sources

193
00:09:19,860 --> 00:09:22,560
a list of most common initial access

194
00:09:22,560 --> 00:09:23,880
techniques

195
00:09:23,880 --> 00:09:27,180
and I also have mapped them to the miter

196
00:09:27,180 --> 00:09:29,220
attack framework

197
00:09:29,220 --> 00:09:31,740
just in a few words we have spear

198
00:09:31,740 --> 00:09:32,640
phishing

199
00:09:32,640 --> 00:09:36,000
so these are this is a targeted these

200
00:09:36,000 --> 00:09:38,220
are targeted emails to specific persons

201
00:09:38,220 --> 00:09:40,920
uh containing malicious attachments or

202
00:09:40,920 --> 00:09:44,700
malicious links also we have access

203
00:09:44,700 --> 00:09:48,120
using valid accounts

204
00:09:48,120 --> 00:09:51,480
from um one from leaked credentials you

205
00:09:51,480 --> 00:09:53,720
know that there are

206
00:09:53,720 --> 00:09:57,420
periodically appear appears in the news

207
00:09:57,420 --> 00:10:00,360
that some company has been breached and

208
00:10:00,360 --> 00:10:04,740
their data has been made public

209
00:10:04,740 --> 00:10:06,959
um what the attackers are doing are

210
00:10:06,959 --> 00:10:10,620
using that data those credentials and

211
00:10:10,620 --> 00:10:15,060
trying them on other services of that

212
00:10:15,060 --> 00:10:17,880
company uh basing on the fact that

213
00:10:17,880 --> 00:10:20,220
people reuse passwords

214
00:10:20,220 --> 00:10:22,980
so this is another technique for gaining

215
00:10:22,980 --> 00:10:24,300
access

216
00:10:24,300 --> 00:10:28,580
also doing brute forcing attacks on RDP

217
00:10:28,580 --> 00:10:31,519
SSH and so on

218
00:10:31,519 --> 00:10:34,440
exploiting vulnerabilities in external

219
00:10:34,440 --> 00:10:38,100
assets or in unpatched servers

220
00:10:38,100 --> 00:10:41,040
like the first one that we saw on the

221
00:10:41,040 --> 00:10:43,459
dark Market

222
00:10:45,120 --> 00:10:48,779
and another cool one is promoting fake

223
00:10:48,779 --> 00:10:51,000
software via SEO

224
00:10:51,000 --> 00:10:54,779
for instance if you you as an attacker

225
00:10:54,779 --> 00:10:55,600
create

226
00:10:55,600 --> 00:10:55,860
[Music]

227
00:10:55,860 --> 00:10:57,720
um

228
00:10:57,720 --> 00:11:00,839
create a fake website for TeamViewer

229
00:11:00,839 --> 00:11:04,260
and you promote it very well and you do

230
00:11:04,260 --> 00:11:07,680
have a good C SEO then somebody who

231
00:11:07,680 --> 00:11:11,040
would search download thing viewer they

232
00:11:11,040 --> 00:11:13,800
will land on your fake website and

233
00:11:13,800 --> 00:11:17,100
download a fake TeamViewer which has of

234
00:11:17,100 --> 00:11:21,140
course some backdoor inside

235
00:11:22,019 --> 00:11:25,260
uh what we will do today we will demo

236
00:11:25,260 --> 00:11:29,899
these three these three techniques

237
00:11:30,779 --> 00:11:34,620
okay so enough uh enough talking let's

238
00:11:34,620 --> 00:11:39,380
do some live hacking

239
00:11:40,019 --> 00:11:42,000
so what we're doing uh first of all

240
00:11:42,000 --> 00:11:43,860
we're trying to

241
00:11:43,860 --> 00:11:44,700
um

242
00:11:44,700 --> 00:11:47,399
we're doing an RDP Brute Force attack a

243
00:11:47,399 --> 00:11:51,779
simple one then um we will exploit an

244
00:11:51,779 --> 00:11:53,880
unpatched service

245
00:11:53,880 --> 00:11:57,480
and we in the the second the third one

246
00:11:57,480 --> 00:12:01,040
it will be a spear phishing attack

247
00:12:05,640 --> 00:12:08,100
okay we will use for this uh for these

248
00:12:08,100 --> 00:12:12,079
scenarios the Panthers tools platform

249
00:12:17,399 --> 00:12:22,760
let me see if I need to do some Zoom

250
00:12:27,420 --> 00:12:29,899
okay

251
00:12:31,560 --> 00:12:35,579
so um I have an empty workspace here

252
00:12:35,579 --> 00:12:39,899
and uh let's assume that for this um for

253
00:12:39,899 --> 00:12:43,200
this scenario we have uh we as uh pen

254
00:12:43,200 --> 00:12:45,660
testers who simulate

255
00:12:45,660 --> 00:12:48,660
um an initial access broker

256
00:12:48,660 --> 00:12:53,000
um we we use these two IP addresses

257
00:12:54,000 --> 00:12:57,360
we will add them one by one in the

258
00:12:57,360 --> 00:12:58,560
platform

259
00:12:58,560 --> 00:13:02,660
in the assets page

260
00:13:06,779 --> 00:13:11,540
so this one we will call it Target one

261
00:13:17,519 --> 00:13:20,899
we'll take the second one

262
00:13:29,880 --> 00:13:32,700
we'll call it Target Two

263
00:13:32,700 --> 00:13:34,620
and

264
00:13:34,620 --> 00:13:37,440
of course the first thing that we want

265
00:13:37,440 --> 00:13:40,980
to see is which ports are open on these

266
00:13:40,980 --> 00:13:42,240
targets

267
00:13:42,240 --> 00:13:46,760
we will do a simple board scanning

268
00:13:48,899 --> 00:13:51,720
for options in order to go faster we

269
00:13:51,720 --> 00:13:55,399
will use top 100 ports

270
00:14:04,380 --> 00:14:09,920
okay the scans are finishing quickly

271
00:14:14,700 --> 00:14:17,760
and we see that the first Target

272
00:14:17,760 --> 00:14:21,540
has an RDP Port open and

273
00:14:21,540 --> 00:14:23,940
some HTTP Port open

274
00:14:23,940 --> 00:14:27,420
if we go here to see what is there

275
00:14:27,420 --> 00:14:30,120
we see that it's uh it looks what looks

276
00:14:30,120 --> 00:14:33,779
like a plane Tomcat um

277
00:14:33,779 --> 00:14:38,420
installed without any configuration

278
00:14:38,940 --> 00:14:42,680
and the second one

279
00:14:47,880 --> 00:14:50,060
thank you

280
00:14:50,519 --> 00:14:53,480
Target Two

281
00:14:55,800 --> 00:14:59,760
has also on RDP Port exposed to the

282
00:14:59,760 --> 00:15:02,519
internet and some

283
00:15:02,519 --> 00:15:06,240
RPC Port from from Windows

284
00:15:06,240 --> 00:15:08,399
okay so this is the uh the attack

285
00:15:08,399 --> 00:15:11,220
surface so that that we're having just

286
00:15:11,220 --> 00:15:15,360
from scanning top 100 ports this is a

287
00:15:15,360 --> 00:15:17,880
an aggregated visualization

288
00:15:17,880 --> 00:15:19,740
and uh

289
00:15:19,740 --> 00:15:24,000
I said that we will we will do an RDP

290
00:15:24,000 --> 00:15:25,920
Brute Force attack

291
00:15:25,920 --> 00:15:28,019
and we will do it against Target Two

292
00:15:28,019 --> 00:15:34,019
this is the 100 140 IP

293
00:15:34,019 --> 00:15:36,720
and for this um so these are the

294
00:15:36,720 --> 00:15:39,839
categories of tools available

295
00:15:39,839 --> 00:15:42,300
and for this one we'll be we will use

296
00:15:42,300 --> 00:15:45,439
the password auditor

297
00:15:48,000 --> 00:15:54,300
this is the IP we want port 3389

298
00:15:54,300 --> 00:15:57,000
uh these are all the services that can

299
00:15:57,000 --> 00:15:59,160
be brute forced automatically but we

300
00:15:59,160 --> 00:16:03,740
will disable them and leave only RDP

301
00:16:04,199 --> 00:16:08,519
okay and um we should use a word list

302
00:16:08,519 --> 00:16:11,399
there are multiple word lists defined in

303
00:16:11,399 --> 00:16:13,680
the platform but um

304
00:16:13,680 --> 00:16:17,880
I'll use a small one created especially

305
00:16:17,880 --> 00:16:20,100
for for this exercise

306
00:16:20,100 --> 00:16:23,639
and I'm trying to see if you guys see

307
00:16:23,639 --> 00:16:26,300
what I'm seeing

308
00:16:28,320 --> 00:16:30,720
so the first word list it's a small one

309
00:16:30,720 --> 00:16:32,579
with common usernames administrator

310
00:16:32,579 --> 00:16:36,199
admin test user

311
00:16:37,740 --> 00:16:41,220
the second one is is with some very

312
00:16:41,220 --> 00:16:46,339
small uh small list of common passwords

313
00:16:49,620 --> 00:16:55,100
okay and um yeah we will scan it

314
00:17:09,900 --> 00:17:11,760
okay you see that it's finished pretty

315
00:17:11,760 --> 00:17:15,660
quickly and uh we found an RDP weak

316
00:17:15,660 --> 00:17:16,559
password

317
00:17:16,559 --> 00:17:18,660
for this one

318
00:17:18,660 --> 00:17:20,579
in order to

319
00:17:20,579 --> 00:17:22,439
in order to test it

320
00:17:22,439 --> 00:17:25,819
let's go um

321
00:17:25,980 --> 00:17:29,720
with the RDP client

322
00:17:31,679 --> 00:17:36,799
and use the credentials admin

323
00:17:39,059 --> 00:17:41,899
and password

324
00:17:48,600 --> 00:17:52,679
okay so it worked no big deal

325
00:17:52,679 --> 00:17:55,860
this is um

326
00:17:55,860 --> 00:17:57,360
this is a simple Brute Force attack

327
00:17:57,360 --> 00:18:01,039
against uh against RDP

328
00:18:01,500 --> 00:18:03,299
okay uh

329
00:18:03,299 --> 00:18:07,260
of course this depends on which user

330
00:18:07,260 --> 00:18:10,140
names you enter which passwords

331
00:18:10,140 --> 00:18:12,000
um if you want to do it more effectively

332
00:18:12,000 --> 00:18:13,919
you should you you should do some

333
00:18:13,919 --> 00:18:17,480
profiling on the target to see names

334
00:18:17,480 --> 00:18:20,280
preferences and so on to put there as

335
00:18:20,280 --> 00:18:23,360
candidate passwords

336
00:18:23,400 --> 00:18:24,720
okay

337
00:18:24,720 --> 00:18:26,460
um this was the first uh the first

338
00:18:26,460 --> 00:18:29,460
scenario of gaining initial access

339
00:18:29,460 --> 00:18:32,160
uh going to the second scenario

340
00:18:32,160 --> 00:18:35,520
I said that we will try to

341
00:18:35,520 --> 00:18:38,820
exploit some unpatched vulnerability

342
00:18:38,820 --> 00:18:42,020
exposed to the internet

343
00:18:44,640 --> 00:18:48,240
as any attacker would do would we would

344
00:18:48,240 --> 00:18:51,720
also do a simple vulnerability scanning

345
00:18:51,720 --> 00:18:53,600
on this

346
00:18:53,600 --> 00:18:56,400
two devices

347
00:18:56,400 --> 00:18:59,940
and we will use for this one

348
00:18:59,940 --> 00:19:03,539
our Network scanner which

349
00:19:03,539 --> 00:19:05,400
uses custom detection modules

350
00:19:05,400 --> 00:19:08,640
implemented by our team

351
00:19:08,640 --> 00:19:12,380
we call them sniper modules

352
00:19:15,419 --> 00:19:19,620
and I have started a network scanner for

353
00:19:19,620 --> 00:19:21,960
uh for the for this against these two

354
00:19:21,960 --> 00:19:25,799
Targets only with those those modules to

355
00:19:25,799 --> 00:19:28,320
see what they they look like

356
00:19:28,320 --> 00:19:32,220
we have there is a

357
00:19:32,220 --> 00:19:35,400
vulnerability database it should be here

358
00:19:35,400 --> 00:19:37,260
somewhere

359
00:19:37,260 --> 00:19:40,860
with all the vulnerability detections uh

360
00:19:40,860 --> 00:19:44,100
that that are implemented in um

361
00:19:44,100 --> 00:19:47,100
in pentastools

362
00:19:56,220 --> 00:19:59,820
so the scanner it's uh it's it has found

363
00:19:59,820 --> 00:20:02,640
also the the two ports against Target

364
00:20:02,640 --> 00:20:04,260
one

365
00:20:04,260 --> 00:20:06,780
uh you can see that it's checking these

366
00:20:06,780 --> 00:20:09,000
are the list of modules that it is

367
00:20:09,000 --> 00:20:10,380
checking

368
00:20:10,380 --> 00:20:12,840
um VMware vcenter remote code execution

369
00:20:12,840 --> 00:20:15,660
Tomcat remote code execution

370
00:20:15,660 --> 00:20:18,559
and so on

371
00:20:23,460 --> 00:20:24,419
um

372
00:20:24,419 --> 00:20:27,120
this one usually finishes pretty quickly

373
00:20:27,120 --> 00:20:32,780
but uh yeah depending on the demo gods

374
00:20:47,340 --> 00:20:49,500
yeah just a second because some some

375
00:20:49,500 --> 00:20:52,919
detectors take longer than uh than

376
00:20:52,919 --> 00:20:55,280
others

377
00:20:58,320 --> 00:21:00,620
foreign

378
00:21:03,980 --> 00:21:07,260
yeah thank you

379
00:21:07,260 --> 00:21:09,660
so uh yeah it looks like uh it has

380
00:21:09,660 --> 00:21:13,020
finished the the scan for Target one

381
00:21:13,020 --> 00:21:16,440
and the uh the network scanner has

382
00:21:16,440 --> 00:21:18,600
um has detected the remote code

383
00:21:18,600 --> 00:21:22,080
execution in the Tomcat server that I

384
00:21:22,080 --> 00:21:23,580
showed you

385
00:21:23,580 --> 00:21:24,539
um

386
00:21:24,539 --> 00:21:27,720
it's a vulnerability in the spring

387
00:21:27,720 --> 00:21:29,159
framework

388
00:21:29,159 --> 00:21:31,740
spring is a web

389
00:21:31,740 --> 00:21:34,440
programming framework for Java Java

390
00:21:34,440 --> 00:21:37,740
applications and this year uh they um

391
00:21:37,740 --> 00:21:42,679
they have a remote code execution in um

392
00:21:43,799 --> 00:21:46,980
in what they do and um

393
00:21:46,980 --> 00:21:49,580
the the scanner managed to

394
00:21:49,580 --> 00:21:53,220
ex to detect it reliably and it has run

395
00:21:53,220 --> 00:21:56,179
the who am I command

396
00:21:56,940 --> 00:22:01,679
and in order to to actually see if uh

397
00:22:01,679 --> 00:22:04,679
how how is this exploitable and uh what

398
00:22:04,679 --> 00:22:07,679
type of access we can gain we can chain

399
00:22:07,679 --> 00:22:10,679
it further and um

400
00:22:10,679 --> 00:22:13,140
exploit it with sniper

401
00:22:13,140 --> 00:22:16,559
sniper is a tool for automatic

402
00:22:16,559 --> 00:22:20,280
exploitation you can you can see it as a

403
00:22:20,280 --> 00:22:24,740
more of an automatic Metasploit

404
00:22:24,960 --> 00:22:25,559
um

405
00:22:25,559 --> 00:22:27,659
we'll just let it run and I'll tell you

406
00:22:27,659 --> 00:22:31,159
I I'll tell you how it works

407
00:22:37,140 --> 00:22:39,240
so we have we have created this tool in

408
00:22:39,240 --> 00:22:41,700
order to

409
00:22:41,700 --> 00:22:44,059
uh to be able to easily validate

410
00:22:44,059 --> 00:22:46,260
vulnerabilities you know that common

411
00:22:46,260 --> 00:22:48,840
vulnerability scanners are are

412
00:22:48,840 --> 00:22:50,940
outputting

413
00:22:50,940 --> 00:22:53,159
um sometimes a lot of junk

414
00:22:53,159 --> 00:22:55,440
meaning vulnerabilities that are not

415
00:22:55,440 --> 00:22:58,799
actually real or not very important and

416
00:22:58,799 --> 00:23:01,140
you have to waste a lot of time to do

417
00:23:01,140 --> 00:23:02,460
triage

418
00:23:02,460 --> 00:23:05,039
and that's why we have created this tool

419
00:23:05,039 --> 00:23:08,580
to address the exploitable

420
00:23:08,580 --> 00:23:11,580
vulnerabilities and the ones that pose a

421
00:23:11,580 --> 00:23:12,720
real risk

422
00:23:12,720 --> 00:23:16,020
and in order to prove how uh to prove

423
00:23:16,020 --> 00:23:19,200
that to prove it uh it does exploitation

424
00:23:19,200 --> 00:23:22,860
and um after a successfully exploit it

425
00:23:22,860 --> 00:23:26,039
also extracts some artifacts with data

426
00:23:26,039 --> 00:23:31,200
from from the Target in order to see um

427
00:23:31,200 --> 00:23:33,120
the real impact

428
00:23:33,120 --> 00:23:35,880
and uh yeah there is some uh there are

429
00:23:35,880 --> 00:23:39,240
some console messages here and uh one of

430
00:23:39,240 --> 00:23:41,400
them is saying Target is vulnerable to

431
00:23:41,400 --> 00:23:43,440
Spring core

432
00:23:43,440 --> 00:23:44,640
um cve

433
00:23:44,640 --> 00:23:46,919
successfully gained the exploit session

434
00:23:46,919 --> 00:23:49,020
for spring core

435
00:23:49,020 --> 00:23:51,480
uh for for this vulnerability and right

436
00:23:51,480 --> 00:23:52,380
now

437
00:23:52,380 --> 00:23:55,740
um it will stay a couple of minutes to

438
00:23:55,740 --> 00:23:59,640
to extract some to search for some some

439
00:23:59,640 --> 00:24:02,039
interesting information and we won't

440
00:24:02,039 --> 00:24:05,159
wait for it I will show you in a full

441
00:24:05,159 --> 00:24:07,620
scan that I previously did how the

442
00:24:07,620 --> 00:24:10,340
report looks like

443
00:24:16,679 --> 00:24:18,860
foreign

444
00:24:19,580 --> 00:24:22,700
this is a successful

445
00:24:22,700 --> 00:24:25,080
exploit of

446
00:24:25,080 --> 00:24:27,360
the spring core vulnerabilities bring

447
00:24:27,360 --> 00:24:29,100
for shell

448
00:24:29,100 --> 00:24:31,140
so it says that sniper managed to obtain

449
00:24:31,140 --> 00:24:32,760
remote code execution as user

450
00:24:32,760 --> 00:24:35,280
anti-authority system current working

451
00:24:35,280 --> 00:24:36,900
directory

452
00:24:36,900 --> 00:24:39,720
Apache Tomcat

453
00:24:39,720 --> 00:24:40,880
Etc

454
00:24:40,880 --> 00:24:43,980
computer name

455
00:24:43,980 --> 00:24:46,400
and so on

456
00:24:46,400 --> 00:24:50,240
details about the exploit

457
00:24:50,520 --> 00:24:53,880
and here on the left are the artifacts

458
00:24:53,880 --> 00:24:55,580
that are being extracted from the target

459
00:24:55,580 --> 00:24:59,600
so we have the local users

460
00:24:59,600 --> 00:25:02,400
if it has the right privileges it can

461
00:25:02,400 --> 00:25:06,240
extract also the hashes of the password

462
00:25:06,240 --> 00:25:08,520
the processes that are running on the

463
00:25:08,520 --> 00:25:10,700
system

464
00:25:11,159 --> 00:25:13,919
uh then the disk drives

465
00:25:13,919 --> 00:25:17,400
we do some some scraping of the drive

466
00:25:17,400 --> 00:25:19,740
and the extract some interesting

467
00:25:19,740 --> 00:25:23,460
information for instance uh this server

468
00:25:23,460 --> 00:25:25,679
has some file

469
00:25:25,679 --> 00:25:28,140
with a txt file apparently with some

470
00:25:28,140 --> 00:25:30,799
credentials

471
00:25:31,500 --> 00:25:35,460
and another nice stuff is the network

472
00:25:35,460 --> 00:25:38,240
visualization

473
00:25:38,400 --> 00:25:41,460
so imagine that a sniper has is is

474
00:25:41,460 --> 00:25:43,860
running on the target machine and it

475
00:25:43,860 --> 00:25:45,840
knows all the network configuration of

476
00:25:45,840 --> 00:25:49,080
the machine and the systems that it is

477
00:25:49,080 --> 00:25:50,880
connected to

478
00:25:50,880 --> 00:25:55,220
and uh we do a graph here

479
00:25:55,220 --> 00:25:59,159
this is the target machine

480
00:25:59,159 --> 00:26:02,880
and we we see that it has an incoming

481
00:26:02,880 --> 00:26:04,679
connection

482
00:26:04,679 --> 00:26:07,140
from uh this is the pentas tools server

483
00:26:07,140 --> 00:26:09,960
that it has initiated the the attack

484
00:26:09,960 --> 00:26:12,059
we also see

485
00:26:12,059 --> 00:26:15,059
uh some some hosts on the internal

486
00:26:15,059 --> 00:26:18,659
network from the ARP table

487
00:26:18,659 --> 00:26:21,659
and some other connections if there are

488
00:26:21,659 --> 00:26:26,340
there so imagine if you see a host that

489
00:26:26,340 --> 00:26:29,760
is uh has a SQL connection you can see

490
00:26:29,760 --> 00:26:31,140
that it's connected to something

491
00:26:31,140 --> 00:26:33,539
interesting and um

492
00:26:33,539 --> 00:26:35,520
you can dig further

493
00:26:35,520 --> 00:26:37,380
so this is a this is a report of a

494
00:26:37,380 --> 00:26:40,799
successful exploitation

495
00:26:41,220 --> 00:26:43,020
okay

496
00:26:43,020 --> 00:26:45,419
if you're still with me

497
00:26:45,419 --> 00:26:48,840
then we will go to the third attack

498
00:26:48,840 --> 00:26:52,140
scenario which is a bit more complex

499
00:26:52,140 --> 00:26:56,480
and I'll show you how it works

500
00:26:58,080 --> 00:27:00,960
before before

501
00:27:00,960 --> 00:27:02,520
demoing

502
00:27:02,520 --> 00:27:04,919
I created a

503
00:27:04,919 --> 00:27:07,260
diagram of the attack

504
00:27:07,260 --> 00:27:10,919
this is so this is a spear phishing

505
00:27:10,919 --> 00:27:14,880
attack okay and this one is the uh

506
00:27:14,880 --> 00:27:16,679
the pen tester who simulates the attack

507
00:27:16,679 --> 00:27:19,320
this one is the victim

508
00:27:19,320 --> 00:27:21,600
that is the pen Test 2 server this is

509
00:27:21,600 --> 00:27:24,659
the mail which uh intermediates the the

510
00:27:24,659 --> 00:27:25,500
message

511
00:27:25,500 --> 00:27:27,720
and the first step would be

512
00:27:27,720 --> 00:27:30,900
in any spear phishing attack with the

513
00:27:30,900 --> 00:27:34,200
malicious link so we need a malicious

514
00:27:34,200 --> 00:27:36,480
document that we want to send to the

515
00:27:36,480 --> 00:27:39,179
victim and we want them to open the

516
00:27:39,179 --> 00:27:43,020
document and run some some code on their

517
00:27:43,020 --> 00:27:43,919
machine

518
00:27:43,919 --> 00:27:45,539
and we have created this functionality

519
00:27:45,539 --> 00:27:46,980
in pentas tools

520
00:27:46,980 --> 00:27:50,880
and as a pen tester you can download the

521
00:27:50,880 --> 00:27:52,799
attack file

522
00:27:52,799 --> 00:27:56,159
on your machine what we will do we will

523
00:27:56,159 --> 00:27:59,279
archive the file and password protect it

524
00:27:59,279 --> 00:28:02,400
in order to be able to send it via Gmail

525
00:28:02,400 --> 00:28:03,960
or Google Drive

526
00:28:03,960 --> 00:28:06,360
to the to the Target

527
00:28:06,360 --> 00:28:08,580
we will also create a nice phishing

528
00:28:08,580 --> 00:28:10,919
email to try to trick the target into

529
00:28:10,919 --> 00:28:13,020
opening opening it

530
00:28:13,020 --> 00:28:15,779
and then

531
00:28:15,779 --> 00:28:19,919
the the victim should open the file and

532
00:28:19,919 --> 00:28:23,400
if the message is good enough it uh it

533
00:28:23,400 --> 00:28:26,400
will actually it will also enable the

534
00:28:26,400 --> 00:28:27,840
macros

535
00:28:27,840 --> 00:28:31,500
and after that when the macros run

536
00:28:31,500 --> 00:28:34,919
they will run the same extractors that

537
00:28:34,919 --> 00:28:36,900
you previously saw and in the other

538
00:28:36,900 --> 00:28:39,659
attack they will run it here and they

539
00:28:39,659 --> 00:28:41,580
will send the data back to pen test

540
00:28:41,580 --> 00:28:45,360
tools and the pen tester can can see

541
00:28:45,360 --> 00:28:49,559
when the document has been opened and uh

542
00:28:49,559 --> 00:28:53,480
all the data from from that machine

543
00:28:54,360 --> 00:28:57,179
Okay so

544
00:28:57,179 --> 00:29:00,320
good luck with that

545
00:29:04,200 --> 00:29:07,380
okay so we will start

546
00:29:07,380 --> 00:29:10,140
we will start with the

547
00:29:10,140 --> 00:29:13,159
with the Gmail account

548
00:29:13,740 --> 00:29:16,860
which simulates uh the attacker in this

549
00:29:16,860 --> 00:29:19,039
case

550
00:29:19,440 --> 00:29:21,720
and I create have created the Gmail

551
00:29:21,720 --> 00:29:26,419
account called sector Uno

552
00:29:27,000 --> 00:29:30,620
uh which has this email

553
00:29:30,620 --> 00:29:33,120
sector.just.row for those of you

554
00:29:33,120 --> 00:29:36,179
non-romanian speaking this is a court in

555
00:29:36,179 --> 00:29:38,720
Bucharest

556
00:29:39,179 --> 00:29:43,640
okay and um I tried to create a message

557
00:29:43,640 --> 00:29:48,659
as uh realistically I could

558
00:29:48,659 --> 00:29:53,120
and yeah let's see how it goes

559
00:29:53,820 --> 00:29:56,880
so compose message first this is the

560
00:29:56,880 --> 00:29:58,200
target

561
00:29:58,200 --> 00:30:00,360
it's a it's a person called Giorgio

562
00:30:00,360 --> 00:30:01,500
petrescu

563
00:30:01,500 --> 00:30:05,299
of course he's a fictional character

564
00:30:06,539 --> 00:30:07,919
and

565
00:30:07,919 --> 00:30:12,899
the subject of the of the email is

566
00:30:14,260 --> 00:30:17,400
[Music]

567
00:30:21,360 --> 00:30:24,799
just a second

568
00:30:28,200 --> 00:30:31,200
so in English it's a subpoena

569
00:30:31,200 --> 00:30:34,740
so we're calling for a witness in uh in

570
00:30:34,740 --> 00:30:36,980
trial

571
00:30:39,899 --> 00:30:42,559
and

572
00:30:48,600 --> 00:30:51,439
it's uh

573
00:31:02,520 --> 00:31:05,520
address

574
00:31:06,960 --> 00:31:09,320
is

575
00:31:15,240 --> 00:31:17,220
the best I could

576
00:31:17,220 --> 00:31:19,340
um

577
00:31:22,380 --> 00:31:23,720
in English

578
00:31:23,720 --> 00:31:26,580
Dear Mr petresk who you are being called

579
00:31:26,580 --> 00:31:30,960
that the court from Bucharest

580
00:31:30,960 --> 00:31:34,080
uh in the 12th of December

581
00:31:34,080 --> 00:31:37,799
as a witness in the trial number

582
00:31:37,799 --> 00:31:41,600
Etc you can access the full

583
00:31:41,600 --> 00:31:44,760
subpoena document electronically at this

584
00:31:44,760 --> 00:31:45,840
address

585
00:31:45,840 --> 00:31:48,779
and for security reasons the document is

586
00:31:48,779 --> 00:31:51,240
password protected and the password is

587
00:31:51,240 --> 00:31:53,100
your family name

588
00:31:53,100 --> 00:31:56,460
this could have been also the CNP of the

589
00:31:56,460 --> 00:31:58,440
the person or the personal identifier

590
00:31:58,440 --> 00:32:00,980
number

591
00:32:01,860 --> 00:32:04,679
okay so this is this is the the template

592
00:32:04,679 --> 00:32:06,779
of the message right now and uh let's

593
00:32:06,779 --> 00:32:10,100
see what we put on this link

594
00:32:11,600 --> 00:32:14,220
we're going to

595
00:32:14,220 --> 00:32:15,899
as I said we're going to paint the

596
00:32:15,899 --> 00:32:18,320
stools

597
00:32:22,380 --> 00:32:24,419
and we have recently implemented this

598
00:32:24,419 --> 00:32:27,799
feature called client-side attack

599
00:32:28,500 --> 00:32:31,620
where you can create

600
00:32:31,620 --> 00:32:34,200
a malicious document

601
00:32:34,200 --> 00:32:37,919
with an attack Handler it can be a doc

602
00:32:37,919 --> 00:32:41,480
XLS and so on

603
00:32:42,179 --> 00:32:46,679
um and what uh okay so this is here you

604
00:32:46,679 --> 00:32:48,899
can download the the those that attack

605
00:32:48,899 --> 00:32:53,159
file and um here it will be received the

606
00:32:53,159 --> 00:32:56,539
the data from the customer

607
00:32:56,880 --> 00:33:01,820
we download it locally on on our machine

608
00:33:05,340 --> 00:33:07,980
on desktop

609
00:33:07,980 --> 00:33:10,559
so I have a Windows machine here

610
00:33:10,559 --> 00:33:12,899
and um

611
00:33:12,899 --> 00:33:15,779
it should it should run

612
00:33:15,779 --> 00:33:17,700
if I open it

613
00:33:17,700 --> 00:33:21,500
so I'm still the attacker now

614
00:33:22,919 --> 00:33:24,730
if I open it

615
00:33:24,730 --> 00:33:24,960
[Music]

616
00:33:24,960 --> 00:33:25,799
um

617
00:33:25,799 --> 00:33:27,840
this is the whole context of the

618
00:33:27,840 --> 00:33:30,600
document you can you can edit it and

619
00:33:30,600 --> 00:33:35,418
write some of your own text here

620
00:33:36,059 --> 00:33:38,760
I'm still the attacker but Windows

621
00:33:38,760 --> 00:33:41,340
doesn't let me doesn't let me run the

622
00:33:41,340 --> 00:33:43,740
macros because of a recent feature

623
00:33:43,740 --> 00:33:48,059
recent uh introduced by Microsoft

624
00:33:48,059 --> 00:33:51,120
um which is called Mark Mark of the web

625
00:33:51,120 --> 00:33:53,279
have you heard about it

626
00:33:53,279 --> 00:33:55,500
okay so the mark of the web is the

627
00:33:55,500 --> 00:33:57,960
feature introduced by Microsoft which uh

628
00:33:57,960 --> 00:34:01,320
actually doesn't allow you at all to run

629
00:34:01,320 --> 00:34:04,380
documents uh which have been downloaded

630
00:34:04,380 --> 00:34:05,640
from the internet

631
00:34:05,640 --> 00:34:09,000
to run macros from those documents

632
00:34:09,000 --> 00:34:10,859
and of course this file has been

633
00:34:10,859 --> 00:34:12,899
downloaded downloaded from pen test

634
00:34:12,899 --> 00:34:16,080
tools and it's a web location and it

635
00:34:16,080 --> 00:34:19,320
doesn't allow me to to run it so for

636
00:34:19,320 --> 00:34:21,480
this what we will do

637
00:34:21,480 --> 00:34:24,179
in order to see this Mark of the web you

638
00:34:24,179 --> 00:34:26,520
can see the properties of the file

639
00:34:26,520 --> 00:34:29,879
and here it says security this file came

640
00:34:29,879 --> 00:34:31,679
from another computer and might be

641
00:34:31,679 --> 00:34:34,440
blocked to help protect this computer

642
00:34:34,440 --> 00:34:37,679
but anyway we can unblock it

643
00:34:37,679 --> 00:34:41,159
okay we press here we unblock it and we

644
00:34:41,159 --> 00:34:42,540
apply

645
00:34:42,540 --> 00:34:44,820
so the mark of the web is gone for this

646
00:34:44,820 --> 00:34:45,599
document

647
00:34:45,599 --> 00:34:47,879
we are still the attacker here

648
00:34:47,879 --> 00:34:51,000
and right now we want to send this

649
00:34:51,000 --> 00:34:52,980
document to the victim

650
00:34:52,980 --> 00:34:55,859
for that

651
00:34:55,859 --> 00:34:58,800
um we will do the following

652
00:34:58,800 --> 00:35:01,500
in order to make it more credible we

653
00:35:01,500 --> 00:35:04,520
will give it a nice name

654
00:35:05,940 --> 00:35:08,460
um just a second

655
00:35:08,460 --> 00:35:11,540
so yeah

656
00:35:18,180 --> 00:35:19,980
we will give it a nice name I want to

657
00:35:19,980 --> 00:35:21,960
open it here because it will execute and

658
00:35:21,960 --> 00:35:24,480
I don't really execute a my machine

659
00:35:24,480 --> 00:35:27,000
and I said that we will password protect

660
00:35:27,000 --> 00:35:27,660
it

661
00:35:27,660 --> 00:35:30,480
and we will do this with the with 7-Zip

662
00:35:30,480 --> 00:35:33,980
and there is a reason for that

663
00:35:34,980 --> 00:35:38,300
um it's uh

664
00:35:39,420 --> 00:35:43,140
create create add to Archive

665
00:35:43,140 --> 00:35:45,839
okay and password is the family name of

666
00:35:45,839 --> 00:35:47,000
the person

667
00:35:47,000 --> 00:35:51,320
the tresco let's say

668
00:35:52,079 --> 00:35:54,300
and this is the

669
00:35:54,300 --> 00:35:56,040
uh

670
00:35:56,040 --> 00:36:00,300
the the archived form okay so next step

671
00:36:00,300 --> 00:36:04,640
we will upload this to Google Drive

672
00:36:09,599 --> 00:36:14,060
we have a simple directory here

673
00:36:15,060 --> 00:36:18,380
new file upload

674
00:36:19,740 --> 00:36:21,900
and we're on desktop we are uploading

675
00:36:21,900 --> 00:36:25,280
the seven zip file

676
00:36:27,839 --> 00:36:31,020
okay and uh we need to share it in order

677
00:36:31,020 --> 00:36:34,940
to be able to to be accessible

678
00:36:35,220 --> 00:36:38,700
so we will share it with anyone with the

679
00:36:38,700 --> 00:36:40,320
link

680
00:36:40,320 --> 00:36:42,359
copy done

681
00:36:42,359 --> 00:36:47,060
and go back going back to the email

682
00:36:49,140 --> 00:36:53,420
we're putting this new URL here

683
00:36:54,720 --> 00:36:58,980
we can do this bold we can do this some

684
00:36:58,980 --> 00:36:59,760
other

685
00:36:59,760 --> 00:37:01,680
types to make it more

686
00:37:01,680 --> 00:37:03,480
interesting

687
00:37:03,480 --> 00:37:04,980
and uh

688
00:37:04,980 --> 00:37:08,960
that should be it let's send it

689
00:37:10,320 --> 00:37:12,359
okay

690
00:37:12,359 --> 00:37:15,420
right now we are on this phase

691
00:37:15,420 --> 00:37:18,180
so we are as attackers have sent this to

692
00:37:18,180 --> 00:37:19,440
email

693
00:37:19,440 --> 00:37:22,740
and now we're moving on the victim side

694
00:37:22,740 --> 00:37:25,020
we're moving here

695
00:37:25,020 --> 00:37:26,460
so this

696
00:37:26,460 --> 00:37:29,579
um this is a a virtual machine that we

697
00:37:29,579 --> 00:37:32,180
have created

698
00:37:35,280 --> 00:37:40,700
where Mr Georgia petresco has a user

699
00:37:52,200 --> 00:37:54,660
okay so right now we have moved on the

700
00:37:54,660 --> 00:37:59,480
of the victim side on the victim's side

701
00:38:00,300 --> 00:38:04,280
and uh Mr petresco

702
00:38:04,859 --> 00:38:06,960
has

703
00:38:06,960 --> 00:38:09,240
this yeah this was the test that I

704
00:38:09,240 --> 00:38:10,920
previously did

705
00:38:10,920 --> 00:38:15,020
uh has received this email

706
00:38:15,060 --> 00:38:18,359
which looks like this

707
00:38:18,359 --> 00:38:22,380
and of course for somebody who knows

708
00:38:22,380 --> 00:38:23,820
their stuff

709
00:38:23,820 --> 00:38:28,500
the the fishy things here are the email

710
00:38:28,500 --> 00:38:31,859
address of course it's it's a Gmail and

711
00:38:31,859 --> 00:38:35,339
some link it's Google drive but this can

712
00:38:35,339 --> 00:38:38,400
be easily done on a dedicated domain to

713
00:38:38,400 --> 00:38:41,640
make it even more more credible

714
00:38:41,640 --> 00:38:45,180
and on this machine we have an

715
00:38:45,180 --> 00:38:46,800
anti-virus

716
00:38:46,800 --> 00:38:50,880
the basic Defender

717
00:38:54,780 --> 00:38:58,880
which should open

718
00:38:59,820 --> 00:39:01,079
come on

719
00:39:01,079 --> 00:39:03,560
open

720
00:39:04,920 --> 00:39:08,280
okay and the signatures we have that we

721
00:39:08,280 --> 00:39:11,960
see that it's it has been updated today

722
00:39:14,540 --> 00:39:18,359
okay so Mr petresco

723
00:39:18,359 --> 00:39:20,880
tries to access the link

724
00:39:20,880 --> 00:39:23,880
for some reason Google

725
00:39:23,880 --> 00:39:28,380
wants me to check if I can see bicycles

726
00:39:28,380 --> 00:39:31,320
do you see bicycles

727
00:39:31,320 --> 00:39:34,520
oh look another one

728
00:39:34,560 --> 00:39:37,200
are there any more bicycles

729
00:39:37,200 --> 00:39:40,260
these are not bicycles okay

730
00:39:40,260 --> 00:39:43,099
God damn it

731
00:39:46,980 --> 00:39:51,480
oh bicycles these should be bicycles

732
00:39:51,480 --> 00:39:54,480
more bicycles

733
00:39:54,480 --> 00:39:58,020
and verify yay

734
00:39:58,020 --> 00:40:00,720
I found the bicycles

735
00:40:00,720 --> 00:40:03,900
so on Google Drive Google shows me this

736
00:40:03,900 --> 00:40:06,599
file but since it's inside on our

737
00:40:06,599 --> 00:40:08,940
protected archive it doesn't open it to

738
00:40:08,940 --> 00:40:12,980
me so I need to download it

739
00:40:14,099 --> 00:40:18,560
I will download it on the on the desktop

740
00:40:19,440 --> 00:40:21,720
and um

741
00:40:21,720 --> 00:40:25,260
regarding the the mark of the web

742
00:40:25,260 --> 00:40:28,260
this archive is being a password

743
00:40:28,260 --> 00:40:30,780
protected again marked as downloaded

744
00:40:30,780 --> 00:40:32,640
from the web

745
00:40:32,640 --> 00:40:35,700
but if we

746
00:40:35,700 --> 00:40:39,020
if we extract here

747
00:40:40,200 --> 00:40:43,140
of course we want to enter the

748
00:40:43,140 --> 00:40:46,279
uh the name

749
00:40:49,560 --> 00:40:52,859
if we extract the the file we look again

750
00:40:52,859 --> 00:40:55,560
inside as properties

751
00:40:55,560 --> 00:40:57,540
and we see that it doesn't have the mark

752
00:40:57,540 --> 00:40:59,220
of the web

753
00:40:59,220 --> 00:41:02,099
so it has been extracted from from 7-Zip

754
00:41:02,099 --> 00:41:04,680
there is a catch here because not all

755
00:41:04,680 --> 00:41:08,220
archive archiving files do this so there

756
00:41:08,220 --> 00:41:10,619
are others who preserve the mark of the

757
00:41:10,619 --> 00:41:14,119
web but 7-Zip doesn't

758
00:41:14,880 --> 00:41:17,820
so we have this document and Mr petrescu

759
00:41:17,820 --> 00:41:20,160
opens it

760
00:41:20,160 --> 00:41:22,220
since maybe

761
00:41:22,220 --> 00:41:26,540
he's pretty scared about the chord stuff

762
00:41:26,540 --> 00:41:30,359
he really wants to to see what is inside

763
00:41:30,359 --> 00:41:34,260
and he does enable content

764
00:41:34,260 --> 00:41:36,359
okay at this stage

765
00:41:36,359 --> 00:41:40,140
the attack can be even more elaborate we

766
00:41:40,140 --> 00:41:43,079
can make it disappear that uh

767
00:41:43,079 --> 00:41:46,680
that message and uh make it even more

768
00:41:46,680 --> 00:41:47,520
real

769
00:41:47,520 --> 00:41:49,740
but uh

770
00:41:49,740 --> 00:41:51,900
I have enabled the macros and what is

771
00:41:51,900 --> 00:41:53,579
happening behind

772
00:41:53,579 --> 00:41:56,300
is

773
00:41:57,540 --> 00:42:01,280
there is some should be some

774
00:42:01,280 --> 00:42:03,320
Powershell

775
00:42:03,320 --> 00:42:05,820
processes here running

776
00:42:05,820 --> 00:42:08,700
so these are started from the the macros

777
00:42:08,700 --> 00:42:10,619
from from the document

778
00:42:10,619 --> 00:42:14,099
and the user doesn't see anything

779
00:42:14,099 --> 00:42:16,440
he can also close the document believing

780
00:42:16,440 --> 00:42:19,140
maybe that it's an error or something

781
00:42:19,140 --> 00:42:23,760
but on the back we we go on Apprentice

782
00:42:23,760 --> 00:42:25,440
tools again

783
00:42:25,440 --> 00:42:28,619
and we see here that uh

784
00:42:28,619 --> 00:42:30,900
on this uh this Handler we have one

785
00:42:30,900 --> 00:42:31,920
target

786
00:42:31,920 --> 00:42:34,079
meaning that somebody has connected back

787
00:42:34,079 --> 00:42:35,579
to us

788
00:42:35,579 --> 00:42:38,940
uh right now a few minutes ago

789
00:42:38,940 --> 00:42:42,300
and there is a sniper scan which is

790
00:42:42,300 --> 00:42:43,619
running

791
00:42:43,619 --> 00:42:47,480
on his machine

792
00:42:51,900 --> 00:42:55,500
and um yeah this is the the desktop of

793
00:42:55,500 --> 00:42:57,599
Mr Georgia petresco

794
00:42:57,599 --> 00:43:00,720
and this is the sniper extracting some

795
00:43:00,720 --> 00:43:03,960
basic artifacts proving the the

796
00:43:03,960 --> 00:43:07,460
vulnerability we run some commands like

797
00:43:07,460 --> 00:43:10,560
Nets that ipconfig

798
00:43:10,560 --> 00:43:13,740
or system info

799
00:43:13,740 --> 00:43:15,480
who am I

800
00:43:15,480 --> 00:43:17,700
and so on process list

801
00:43:17,700 --> 00:43:21,540
Etc and at the end we won't wait to to

802
00:43:21,540 --> 00:43:23,640
finish at the end we will receive a

803
00:43:23,640 --> 00:43:26,160
report similar to the previous scan that

804
00:43:26,160 --> 00:43:28,500
that I showed you oh it finished quicker

805
00:43:28,500 --> 00:43:30,599
than I expected

806
00:43:30,599 --> 00:43:33,660
and we see uh on this machine also the

807
00:43:33,660 --> 00:43:36,240
list of local users we can see that are

808
00:43:36,240 --> 00:43:37,740
more users on this machine that the

809
00:43:37,740 --> 00:43:41,099
other one the list of processes

810
00:43:41,099 --> 00:43:45,780
the network you see that there are more

811
00:43:45,780 --> 00:43:48,599
more systems connected here

812
00:43:48,599 --> 00:43:52,260
we can see that the the machine has a

813
00:43:52,260 --> 00:43:54,599
an outgoing connection

814
00:43:54,599 --> 00:43:58,819
using Firefox to Port 80 somewhere

815
00:43:58,819 --> 00:44:02,300
explorer.exe and so on

816
00:44:02,520 --> 00:44:04,980
good so so these are these are the demos

817
00:44:04,980 --> 00:44:06,839
for the three uh for the three initial

818
00:44:06,839 --> 00:44:10,500
access scenarios and as a final words of

819
00:44:10,500 --> 00:44:13,760
my long presentation

820
00:44:14,280 --> 00:44:18,599
we can see that um pen testers

821
00:44:18,599 --> 00:44:21,660
and initial access brokers

822
00:44:21,660 --> 00:44:24,359
should use the same techniques basically

823
00:44:24,359 --> 00:44:27,060
pen testers should be able to mimic the

824
00:44:27,060 --> 00:44:29,760
same techniques as real threat actors in

825
00:44:29,760 --> 00:44:33,480
order to simulate real threats but with

826
00:44:33,480 --> 00:44:36,900
very different intents one is being on

827
00:44:36,900 --> 00:44:39,780
the ethical side and wanting to secure

828
00:44:39,780 --> 00:44:42,000
the systems and the other one being

829
00:44:42,000 --> 00:44:45,500
purely malicious for financial purposes

830
00:44:45,500 --> 00:44:48,660
and yeah we should know that the initial

831
00:44:48,660 --> 00:44:52,500
access Brokers are are a key element for

832
00:44:52,500 --> 00:44:57,300
the growth of the ransomware phenomenon

833
00:44:57,300 --> 00:45:00,540
and yeah please uh don't go to the dark

834
00:45:00,540 --> 00:45:01,920
side

835
00:45:01,920 --> 00:45:03,119
because

836
00:45:03,119 --> 00:45:05,180
as uh you probably

837
00:45:05,180 --> 00:45:10,440
known from the Conte leaks documents

838
00:45:10,440 --> 00:45:12,839
the salaries on the dark Market as the

839
00:45:12,839 --> 00:45:14,700
pen testers are not very good as the

840
00:45:14,700 --> 00:45:17,460
ones in the real Market

841
00:45:17,460 --> 00:45:19,500
really

842
00:45:19,500 --> 00:45:23,240
I can share your details at the end

843
00:45:23,280 --> 00:45:26,099
so uh thank you very much for attending

844
00:45:26,099 --> 00:45:30,079
this talk thank you very much Adriano

845
00:45:35,300 --> 00:45:38,280
even though we are validate with the

846
00:45:38,280 --> 00:45:40,980
presentation apparently Adrian was not

847
00:45:40,980 --> 00:45:42,720
comfortable but what's comfortable with

848
00:45:42,720 --> 00:45:44,520
me on the stage for the last 20 minutes

849
00:45:44,520 --> 00:45:46,260
really

850
00:45:46,260 --> 00:45:49,319
um are there any questions

851
00:45:49,319 --> 00:45:52,160
short ones

852
00:45:52,560 --> 00:45:55,140
thank you for the presentation I have

853
00:45:55,140 --> 00:45:58,859
one question regarding the spearfishing

854
00:45:58,859 --> 00:46:01,079
scenario

855
00:46:01,079 --> 00:46:05,460
um after the macro executed we saw a

856
00:46:05,460 --> 00:46:06,900
partial process

857
00:46:06,900 --> 00:46:09,000
uh being created

858
00:46:09,000 --> 00:46:14,160
do we have a means in the pentas tools

859
00:46:14,160 --> 00:46:16,920
platform to customize this Behavior

860
00:46:16,920 --> 00:46:18,380
because

861
00:46:18,380 --> 00:46:22,680
for example if we target a user uh in a

862
00:46:22,680 --> 00:46:25,680
corporate environment and we have a

863
00:46:25,680 --> 00:46:27,079
media

864
00:46:27,079 --> 00:46:30,180
solution or this kind of behavior is

865
00:46:30,180 --> 00:46:34,040
immediately detected if not blocked

866
00:46:34,040 --> 00:46:35,579
so

867
00:46:35,579 --> 00:46:39,000
so right now uh this is a very fresh

868
00:46:39,000 --> 00:46:40,800
functionality introduced in pen test

869
00:46:40,800 --> 00:46:43,500
tools basically last week was live

870
00:46:43,500 --> 00:46:47,880
and um we introduced some basic

871
00:46:47,880 --> 00:46:51,040
um and anti-detection features

872
00:46:51,040 --> 00:46:52,260
[Music]

873
00:46:52,260 --> 00:46:56,280
for Defender it works but we are we are

874
00:46:56,280 --> 00:46:58,800
aware that there are anti-malware

875
00:46:58,800 --> 00:47:01,560
Solutions who detect better this type of

876
00:47:01,560 --> 00:47:04,940
behavior and we intend to

877
00:47:04,940 --> 00:47:07,440
introduce more types of obvious

878
00:47:07,440 --> 00:47:10,500
obfuscations to to try to bypass those

879
00:47:10,500 --> 00:47:12,900
also so we we know it's not a

880
00:47:12,900 --> 00:47:16,020
bulletproof solution but it's the first

881
00:47:16,020 --> 00:47:18,000
first phase

882
00:47:18,000 --> 00:47:19,200
thank you

883
00:47:19,200 --> 00:47:21,859
thank you

884
00:47:22,920 --> 00:47:24,900
thank you Adriano

885
00:47:24,900 --> 00:47:27,300
thank you very much I guess he will be

886
00:47:27,300 --> 00:47:29,520
available in the in the lobby and for

887
00:47:29,520 --> 00:47:31,920
any other questions you can address them

888
00:47:31,920 --> 00:47:34,339
directly

889
00:47:34,800 --> 00:47:36,540
yeah we can find you can find me at our

890
00:47:36,540 --> 00:47:38,760
standard

891
00:47:38,760 --> 00:47:41,359
at the

