1
00:00:00,000 --> 00:00:02,220
hello everyone my name is Jonas jernika

2
00:00:02,220 --> 00:00:04,200
and I will present techniques to the

3
00:00:04,200 --> 00:00:07,140
anonymized storage https hidden services

4
00:00:07,140 --> 00:00:09,300
so I'll have an introduction about Thor

5
00:00:09,300 --> 00:00:12,360
water store and then known the

6
00:00:12,360 --> 00:00:15,240
anonymization techniques then how

7
00:00:15,240 --> 00:00:17,520
downgrading the protocol you can leak

8
00:00:17,520 --> 00:00:18,900
the IP address

9
00:00:18,900 --> 00:00:20,460
after that I'll show you other

10
00:00:20,460 --> 00:00:22,680
techniques that I developed

11
00:00:22,680 --> 00:00:26,519
and how to fix them then the demo time

12
00:00:26,519 --> 00:00:28,260
who am I I'm application security

13
00:00:28,260 --> 00:00:31,920
engineer I'm a CTF player a PhD student

14
00:00:31,920 --> 00:00:33,960
security researcher and former bug

15
00:00:33,960 --> 00:00:37,940
Bounty Hunter and former entrepreneur

16
00:00:37,940 --> 00:00:41,340
the onion router it helps you to

17
00:00:41,340 --> 00:00:43,140
anonymize through the internet and

18
00:00:43,140 --> 00:00:45,719
enables you enables access to the dark

19
00:00:45,719 --> 00:00:47,340
web

20
00:00:47,340 --> 00:00:49,680
a basic configuration is like you'll

21
00:00:49,680 --> 00:00:50,940
have to define a hidden service

22
00:00:50,940 --> 00:00:53,879
directory where the configurations will

23
00:00:53,879 --> 00:00:56,219
be stored in Hidden service directory

24
00:00:56,219 --> 00:00:58,800
then you have to configure the

25
00:00:58,800 --> 00:01:01,860
networking part with the ports and then

26
00:01:01,860 --> 00:01:05,519
you have an output like the one like on

27
00:01:05,519 --> 00:01:08,040
a domain like that one from the from the

28
00:01:08,040 --> 00:01:12,200
slide a big a big name domain

29
00:01:13,159 --> 00:01:15,720
techniques are server status key

30
00:01:15,720 --> 00:01:18,180
certificates then you can search for the

31
00:01:18,180 --> 00:01:19,560
address

32
00:01:19,560 --> 00:01:22,259
through the internet gzip technique is

33
00:01:22,259 --> 00:01:24,540
not just to the anonymize just you have

34
00:01:24,540 --> 00:01:26,939
when I make an idea about where the

35
00:01:26,939 --> 00:01:29,400
server is located on

36
00:01:29,400 --> 00:01:32,880
on the planet then five icon technique

37
00:01:32,880 --> 00:01:35,759
and just hack the server find them you

38
00:01:35,759 --> 00:01:39,479
know remote command execution and so on

39
00:01:39,479 --> 00:01:43,200
the HTTP server status is enabled in

40
00:01:43,200 --> 00:01:45,960
applies to servers by default and you

41
00:01:45,960 --> 00:01:48,780
can you can access it from the local

42
00:01:48,780 --> 00:01:51,299
host and in tour you are from the you

43
00:01:51,299 --> 00:01:52,920
are visiting the server from the local

44
00:01:52,920 --> 00:01:55,979
host and sometimes you can find in

45
00:01:55,979 --> 00:01:57,540
Virtual host

46
00:01:57,540 --> 00:02:01,320
uh column you can find the IP other

47
00:02:01,320 --> 00:02:04,680
other domains or IP addresses from the

48
00:02:04,680 --> 00:02:06,960
public internet and you maybe you can

49
00:02:06,960 --> 00:02:10,080
click the like the real IP address the

50
00:02:10,080 --> 00:02:12,840
key certificate you can take some uh

51
00:02:12,840 --> 00:02:15,840
artifacts from the key certificate and

52
00:02:15,840 --> 00:02:18,360
you just have to search it from for for

53
00:02:18,360 --> 00:02:20,760
for those artifacts in the on the

54
00:02:20,760 --> 00:02:22,440
internet and the best way is to use

55
00:02:22,440 --> 00:02:24,420
Showdown because Showdown indexes

56
00:02:24,420 --> 00:02:28,080
information from TLS certificate

57
00:02:28,080 --> 00:02:30,540
where this is a little chance of success

58
00:02:30,540 --> 00:02:33,120
maybe some I don't know seven years ago

59
00:02:33,120 --> 00:02:35,879
or eight years ago maybe would work but

60
00:02:35,879 --> 00:02:39,000
who knows but you maybe can search this

61
00:02:39,000 --> 00:02:40,940
the whole onion address on Google

62
00:02:40,940 --> 00:02:45,420
bing.com you you should give a try

63
00:02:45,420 --> 00:02:49,580
the G zip compression is about

64
00:02:49,580 --> 00:02:53,760
finding the local date from the from the

65
00:02:53,760 --> 00:02:55,860
gzip traffic because the communication

66
00:02:55,860 --> 00:02:59,700
between servers are are compressed and

67
00:02:59,700 --> 00:03:02,940
is compressed and it gives you an idea

68
00:03:02,940 --> 00:03:06,120
where the the server is located

69
00:03:06,120 --> 00:03:09,500
five icon you can is that time you have

70
00:03:09,500 --> 00:03:15,000
that tiny image from the URL bar and

71
00:03:15,000 --> 00:03:17,220
it is found it is possible to make a

72
00:03:17,220 --> 00:03:19,860
hash of it and find it on the shotgun

73
00:03:19,860 --> 00:03:22,800
because Showdown index is such a

74
00:03:22,800 --> 00:03:25,500
such hashes and you can find it on

75
00:03:25,500 --> 00:03:28,440
Showdown an example of this is quantum

76
00:03:28,440 --> 00:03:31,200
ransomware Group which their server

77
00:03:31,200 --> 00:03:35,040
could was located by Talos just by

78
00:03:35,040 --> 00:03:38,099
finding the hash hash of the five icon

79
00:03:38,099 --> 00:03:41,459
of the ransomware website which was on

80
00:03:41,459 --> 00:03:42,480
the tour

81
00:03:42,480 --> 00:03:45,180
or just hack the server you recommend

82
00:03:45,180 --> 00:03:46,620
the execution I don't know local file

83
00:03:46,620 --> 00:03:50,220
inclusion maybe you can leak the IP

84
00:03:50,220 --> 00:03:52,739
so downgrading the protocol how did I

85
00:03:52,739 --> 00:03:56,340
find this so a few years ago I found a

86
00:03:56,340 --> 00:03:59,220
strange request on my web server on the

87
00:03:59,220 --> 00:04:01,379
public internet

88
00:04:01,379 --> 00:04:04,019
um it was nothing to do with the

89
00:04:04,019 --> 00:04:07,140
tour because at that time I was working

90
00:04:07,140 --> 00:04:10,560
on tour as well but I I was looking on

91
00:04:10,560 --> 00:04:13,700
the access log and I was fine I I so

92
00:04:13,700 --> 00:04:16,380
strange requests like not found not

93
00:04:16,380 --> 00:04:18,000
found exactly like this not found not

94
00:04:18,000 --> 00:04:19,858
found it was a big one

95
00:04:19,858 --> 00:04:21,358
and

96
00:04:21,358 --> 00:04:23,460
at the first glance I didn't notice

97
00:04:23,460 --> 00:04:27,120
anything strange but it was just that

98
00:04:27,120 --> 00:04:30,240
big name in the URL uh the same thing

99
00:04:30,240 --> 00:04:32,759
the same behavior was on my honeypots as

100
00:04:32,759 --> 00:04:35,220
well and after a few days because the

101
00:04:35,220 --> 00:04:38,699
the requests keep coming for days I was

102
00:04:38,699 --> 00:04:40,440
thinking to dump the whole request maybe

103
00:04:40,440 --> 00:04:43,380
it is an exploit on my web server on all

104
00:04:43,380 --> 00:04:45,360
on all the internet and

105
00:04:45,360 --> 00:04:48,600
I was curious about what they are

106
00:04:48,600 --> 00:04:50,100
sending to my web server the whole

107
00:04:50,100 --> 00:04:51,600
request because in Access log you don't

108
00:04:51,600 --> 00:04:54,500
have all the information

109
00:04:54,960 --> 00:04:56,580
site because

110
00:04:56,580 --> 00:04:58,919
it gave some details about what were

111
00:04:58,919 --> 00:05:01,979
they were doing there it was about uh

112
00:05:01,979 --> 00:05:04,560
from a Germany from a University from

113
00:05:04,560 --> 00:05:07,560
Germany and they said that they just

114
00:05:07,560 --> 00:05:10,139
make a research and don't worry we are

115
00:05:10,139 --> 00:05:11,759
not exploiting anything on your web

116
00:05:11,759 --> 00:05:12,900
server

117
00:05:12,900 --> 00:05:15,060
and

118
00:05:15,060 --> 00:05:17,759
what I tried was to replicate what they

119
00:05:17,759 --> 00:05:20,160
did and it was very strange to see in

120
00:05:20,160 --> 00:05:23,520
the response that my one of my domain

121
00:05:23,520 --> 00:05:26,039
which which was the first configured on

122
00:05:26,039 --> 00:05:29,520
my virtual host domains was leaked and

123
00:05:29,520 --> 00:05:31,020
it shouldn't be leaked because I wanted

124
00:05:31,020 --> 00:05:34,139
to keep it safe so

125
00:05:34,139 --> 00:05:36,840
I was thinking to apply this on tour or

126
00:05:36,840 --> 00:05:39,419
even on the internet to find new new

127
00:05:39,419 --> 00:05:42,660
domains like on information gathering

128
00:05:42,660 --> 00:05:45,419
so why this behavior is not because it's

129
00:05:45,419 --> 00:05:48,479
a security problem in Apache to servers

130
00:05:48,479 --> 00:05:51,479
or Engineers or Tomcat uh it's all about

131
00:05:51,479 --> 00:05:53,460
how I said it's all about configuration

132
00:05:53,460 --> 00:05:55,740
you have to configure it

133
00:05:55,740 --> 00:05:59,160
of course no one thinks about this

134
00:05:59,160 --> 00:06:03,419
problem but that could that could might

135
00:06:03,419 --> 00:06:06,080
happen this problem but

136
00:06:06,080 --> 00:06:08,639
uh sometimes if you

137
00:06:08,639 --> 00:06:10,979
if you try to remove the horse header

138
00:06:10,979 --> 00:06:13,500
and downgrade the protocol you can find

139
00:06:13,500 --> 00:06:17,220
other domains and the server should

140
00:06:17,220 --> 00:06:20,419
should the response with one of the

141
00:06:20,419 --> 00:06:22,680
responses from one of the domains or

142
00:06:22,680 --> 00:06:24,720
something and it choose the first one

143
00:06:24,720 --> 00:06:26,960
from the virtual host configuration file

144
00:06:26,960 --> 00:06:30,180
and this is what you are looking for the

145
00:06:30,180 --> 00:06:32,039
first domain configured

146
00:06:32,039 --> 00:06:35,039
and how is the delete how it can be

147
00:06:35,039 --> 00:06:37,940
triggered so it can be triggered by

148
00:06:37,940 --> 00:06:41,699
making an exception on the web server I

149
00:06:41,699 --> 00:06:44,460
don't know bad request or forbidden or

150
00:06:44,460 --> 00:06:47,100
not found this one is not exception but

151
00:06:47,100 --> 00:06:50,100
you can you can trigger it by creating a

152
00:06:50,100 --> 00:06:53,520
forbidden response or not found even but

153
00:06:53,520 --> 00:06:55,620
the best way to leak the IPS through the

154
00:06:55,620 --> 00:06:57,900
server redirects which you can trigger

155
00:06:57,900 --> 00:07:01,080
varies in most of the web servers

156
00:07:01,080 --> 00:07:03,319
so

157
00:07:03,319 --> 00:07:07,259
this is how it looks this is in the in

158
00:07:07,259 --> 00:07:08,580
the in the

159
00:07:08,580 --> 00:07:11,400
left it this is the request sent to the

160
00:07:11,400 --> 00:07:13,800
server and in the right is the is the

161
00:07:13,800 --> 00:07:15,960
response from the server if we don't

162
00:07:15,960 --> 00:07:18,000
downgrade the protocol you can see that

163
00:07:18,000 --> 00:07:20,940
in the response we have server at and

164
00:07:20,940 --> 00:07:23,699
what is in the host header which is my

165
00:07:23,699 --> 00:07:25,259
Toronto address

166
00:07:25,259 --> 00:07:27,599
if we downgrade the protocol this is

167
00:07:27,599 --> 00:07:29,160
just an example

168
00:07:29,160 --> 00:07:32,400
um we put dot HTML I will explain why

169
00:07:32,400 --> 00:07:36,300
this triggers the 403 Forbidden

170
00:07:36,300 --> 00:07:38,400
as you can see I downloaded the protocol

171
00:07:38,400 --> 00:07:40,080
I removed the host header and the

172
00:07:40,080 --> 00:07:43,680
servers he was he needs to to choose one

173
00:07:43,680 --> 00:07:45,780
of the virtual hosts and you will choose

174
00:07:45,780 --> 00:07:48,360
the first one which is not the total on

175
00:07:48,360 --> 00:07:51,240
your address it's the IP address and he

176
00:07:51,240 --> 00:07:55,020
will the server will respond with the IP

177
00:07:55,020 --> 00:07:57,780
address through the the bed through the

178
00:07:57,780 --> 00:08:00,500
Forbidden response

179
00:08:00,500 --> 00:08:04,199
if we try to to insert the long header

180
00:08:04,199 --> 00:08:08,819
and the trigger an uh a bad request as

181
00:08:08,819 --> 00:08:12,240
well we can find the IP IP in the

182
00:08:12,240 --> 00:08:15,539
response the same result with a long URL

183
00:08:15,539 --> 00:08:19,139
as I saw in my access log and if you

184
00:08:19,139 --> 00:08:21,139
upload the Big File Maybe

185
00:08:21,139 --> 00:08:24,900
the the file size will be bigger enough

186
00:08:24,900 --> 00:08:27,720
to to trigger the bad request because of

187
00:08:27,720 --> 00:08:29,879
the server limit

188
00:08:29,879 --> 00:08:34,200
so 403 Forbidden is triggered by the dot

189
00:08:34,200 --> 00:08:38,159
HD rule from the Apache servers and if

190
00:08:38,159 --> 00:08:41,580
you write slash anything is the dot HD

191
00:08:41,580 --> 00:08:44,940
anything it will trigger the 403

192
00:08:44,940 --> 00:08:48,540
Forbidden because the server tries to to

193
00:08:48,540 --> 00:08:51,660
protect the HD files like HD access or

194
00:08:51,660 --> 00:08:56,700
HD password and want one response with

195
00:08:56,700 --> 00:08:59,100
the content of these files

196
00:08:59,100 --> 00:09:01,800
the server redirects is the best way to

197
00:09:01,800 --> 00:09:03,420
trigger a

198
00:09:03,420 --> 00:09:06,600
do I to to leak the IP through the

199
00:09:06,600 --> 00:09:07,860
redirects

200
00:09:07,860 --> 00:09:08,640
um

201
00:09:08,640 --> 00:09:11,760
if you don't put the in the end of the

202
00:09:11,760 --> 00:09:15,180
URL a slash and that one is a directory

203
00:09:15,180 --> 00:09:17,459
the server will redirect you to the

204
00:09:17,459 --> 00:09:19,620
directory with the with the slash at the

205
00:09:19,620 --> 00:09:22,560
end of the URL so in this here is an

206
00:09:22,560 --> 00:09:25,980
example of server.com deal will redirect

207
00:09:25,980 --> 00:09:27,620
you to server.com

208
00:09:27,620 --> 00:09:31,260
it will put the slash at the end if

209
00:09:31,260 --> 00:09:34,560
there is an app without like an API or

210
00:09:34,560 --> 00:09:37,440
an app without an HTML content and you

211
00:09:37,440 --> 00:09:39,779
just have the an API and you don't have

212
00:09:39,779 --> 00:09:44,820
directories then you can use slash CSS

213
00:09:44,820 --> 00:09:47,339
slash icons is there are some predefined

214
00:09:47,339 --> 00:09:49,500
directories in the Apache but only if

215
00:09:49,500 --> 00:09:50,480
you are

216
00:09:50,480 --> 00:09:52,860
coming from the Local Host with the

217
00:09:52,860 --> 00:09:54,600
request and in tour most of the time

218
00:09:54,600 --> 00:09:57,120
you'll visit will be visiting the server

219
00:09:57,120 --> 00:09:59,339
with localhost

220
00:09:59,339 --> 00:10:02,339
so if you want to trigger direct the

221
00:10:02,339 --> 00:10:04,260
best way is to look at the HTML page

222
00:10:04,260 --> 00:10:08,040
find locate the directory like this so

223
00:10:08,040 --> 00:10:10,459
the CSS directory with the file

224
00:10:10,459 --> 00:10:14,040
style.css and you have you just have to

225
00:10:14,040 --> 00:10:17,040
request slash CSS without the slash out

226
00:10:17,040 --> 00:10:19,800
to the end and you'll see that the

227
00:10:19,800 --> 00:10:21,800
redirect will be triggered by the server

228
00:10:21,800 --> 00:10:24,779
and if you remove the post header and

229
00:10:24,779 --> 00:10:27,120
downgrade the protocol then you'll have

230
00:10:27,120 --> 00:10:29,700
the IP Linked In the redirect in the

231
00:10:29,700 --> 00:10:33,180
location and in the response

232
00:10:33,180 --> 00:10:36,120
um I didn't make a research on this by

233
00:10:36,120 --> 00:10:38,279
applying this my This research on the

234
00:10:38,279 --> 00:10:40,260
internet because I'm not sure if it's

235
00:10:40,260 --> 00:10:42,839
legal it appears and I don't want to

236
00:10:42,839 --> 00:10:45,360
have headaches uh it appears that others

237
00:10:45,360 --> 00:10:47,279
did this before like the German

238
00:10:47,279 --> 00:10:50,640
University which I told you about and

239
00:10:50,640 --> 00:10:52,800
maybe they were looking for this I don't

240
00:10:52,800 --> 00:10:55,680
know I'm not sure for this but uh

241
00:10:55,680 --> 00:10:59,820
it's like a kind of reverse DNS on on IP

242
00:10:59,820 --> 00:11:03,959
kind of not DNS reverse

243
00:11:03,959 --> 00:11:06,060
um other techniques develop developed by

244
00:11:06,060 --> 00:11:08,040
by me like

245
00:11:08,040 --> 00:11:12,300
that one of searching the URL Tor URL on

246
00:11:12,300 --> 00:11:13,920
the internet you can search for Attack

247
00:11:13,920 --> 00:11:17,760
on Showdown uh the attack is that part

248
00:11:17,760 --> 00:11:20,339
of the HTTP protocol for world wide web

249
00:11:20,339 --> 00:11:23,220
and downgrading the protocol has nothing

250
00:11:23,220 --> 00:11:25,980
to do with the attack technique

251
00:11:25,980 --> 00:11:27,500
so

252
00:11:27,500 --> 00:11:31,200
is specific for static files if you

253
00:11:31,200 --> 00:11:33,600
visit a static file we have an attack

254
00:11:33,600 --> 00:11:35,880
which is a unique value it's a hash

255
00:11:35,880 --> 00:11:37,680
something like this I think it's based

256
00:11:37,680 --> 00:11:41,339
on it most of an Apache server is based

257
00:11:41,339 --> 00:11:42,300
on

258
00:11:42,300 --> 00:11:45,180
like on a md5 or something then reduce

259
00:11:45,180 --> 00:11:48,540
to this type of hashing

260
00:11:48,540 --> 00:11:51,540
and

261
00:11:51,959 --> 00:11:55,620
then if you search for this one on The

262
00:11:55,620 --> 00:11:57,420
Showdown maybe you can give a try and

263
00:11:57,420 --> 00:11:58,620
find the

264
00:11:58,620 --> 00:12:01,200
correlation between the Tor server and

265
00:12:01,200 --> 00:12:04,079
what you'll find on Showdown

266
00:12:04,079 --> 00:12:06,360
other techniques same network technique

267
00:12:06,360 --> 00:12:08,820
you have a list of all the Tor Onion

268
00:12:08,820 --> 00:12:10,740
addresses

269
00:12:10,740 --> 00:12:11,459
um

270
00:12:11,459 --> 00:12:14,519
maybe I can show you on another slide

271
00:12:14,519 --> 00:12:17,480
about this problem

272
00:12:18,240 --> 00:12:20,640
Okay so

273
00:12:20,640 --> 00:12:22,560
not this one

274
00:12:22,560 --> 00:12:24,480
this one

275
00:12:24,480 --> 00:12:26,880
um you have the host header and you can

276
00:12:26,880 --> 00:12:30,480
insert uh for each request the other

277
00:12:30,480 --> 00:12:32,700
onion addresses from Tor and if it

278
00:12:32,700 --> 00:12:35,220
responds the same with if you would

279
00:12:35,220 --> 00:12:38,959
visit them without using the host header

280
00:12:38,959 --> 00:12:41,579
maybe you make a brute force on the

281
00:12:41,579 --> 00:12:43,260
horse header maybe you'll find the same

282
00:12:43,260 --> 00:12:45,899
same content and then you suppose that

283
00:12:45,899 --> 00:12:48,180
the the both servers are on the same

284
00:12:48,180 --> 00:12:50,700
server and you just increase your attack

285
00:12:50,700 --> 00:12:53,339
surface and maybe you can you don't need

286
00:12:53,339 --> 00:12:55,620
to to the anonymize the first server

287
00:12:55,620 --> 00:12:58,019
just the enemies like the anonymize the

288
00:12:58,019 --> 00:13:01,019
second one and maybe you can you can

289
00:13:01,019 --> 00:13:04,680
succeed and find the IP address

290
00:13:04,680 --> 00:13:09,260
oh sorry I went back

291
00:13:10,860 --> 00:13:13,519
so

292
00:13:14,700 --> 00:13:18,500
I I will have the demo right now

293
00:13:18,660 --> 00:13:22,380
so in my demo I'll show you how how you

294
00:13:22,380 --> 00:13:24,620
can trigger The Forbidden so if you put

295
00:13:24,620 --> 00:13:27,300
hd.hd and anything you will trigger the

296
00:13:27,300 --> 00:13:29,000
forbidden

297
00:13:29,000 --> 00:13:33,420
434 billion you have the server at

298
00:13:33,420 --> 00:13:36,480
you have the server out here with the

299
00:13:36,480 --> 00:13:39,720
onion address then here I'll show you

300
00:13:39,720 --> 00:13:41,639
how to trigger it without any noise

301
00:13:41,639 --> 00:13:43,620
because dot HTML it's

302
00:13:43,620 --> 00:13:46,980
I don't think will trigger the attention

303
00:13:46,980 --> 00:13:49,860
of any sys admin maybe I don't know and

304
00:13:49,860 --> 00:13:51,000
we'll

305
00:13:51,000 --> 00:13:53,820
if you downgrade the protocol as you can

306
00:13:53,820 --> 00:13:56,459
see you can find my real domain name

307
00:13:56,459 --> 00:13:59,700
which was configured on the virtual host

308
00:13:59,700 --> 00:14:02,639
and maybe that hidden minus domain dot

309
00:14:02,639 --> 00:14:05,100
ml maybe you can find it on internet you

310
00:14:05,100 --> 00:14:07,800
can find a real address and it's the

311
00:14:07,800 --> 00:14:10,260
same with the Tor address

312
00:14:10,260 --> 00:14:12,839
now I'm trying to put a long header to

313
00:14:12,839 --> 00:14:14,579
trigger the bad request

314
00:14:14,579 --> 00:14:20,160
and right now I insert the long header

315
00:14:20,160 --> 00:14:21,959
and

316
00:14:21,959 --> 00:14:25,200
I expect to have the 400 bad request in

317
00:14:25,200 --> 00:14:28,200
order to to leak the IP and this is what

318
00:14:28,200 --> 00:14:29,940
I'm doing right now

319
00:14:29,940 --> 00:14:31,800
so as you can see I triggered the bad

320
00:14:31,800 --> 00:14:34,019
request through the long header and we

321
00:14:34,019 --> 00:14:37,079
have the hidden domain

322
00:14:37,079 --> 00:14:38,639
another

323
00:14:38,639 --> 00:14:40,500
possibilities that with the server

324
00:14:40,500 --> 00:14:41,760
redirect

325
00:14:41,760 --> 00:14:45,600
as I told you the CSS redirect

326
00:14:45,600 --> 00:14:48,180
so here is not downgrading the protocol

327
00:14:48,180 --> 00:14:51,959
is HTTP 1.1 with the host header we try

328
00:14:51,959 --> 00:14:54,360
to do the redirect as you can see in the

329
00:14:54,360 --> 00:14:56,699
response right now it's redirecting to

330
00:14:56,699 --> 00:14:59,279
the same onion address stored on your

331
00:14:59,279 --> 00:15:01,019
address that big one

332
00:15:01,019 --> 00:15:03,959
if we remove the part with the host and

333
00:15:03,959 --> 00:15:06,180
downgrade the protocol then the response

334
00:15:06,180 --> 00:15:09,839
will leak the hidden domain

335
00:15:09,839 --> 00:15:14,060
it should leak yeah word

336
00:15:15,060 --> 00:15:17,040
and now

337
00:15:17,040 --> 00:15:20,279
I'm trying to see if the hidden domain

338
00:15:20,279 --> 00:15:22,800
still responds with an i it's configured

339
00:15:22,800 --> 00:15:25,380
an IP which is on the same IP for the

340
00:15:25,380 --> 00:15:27,480
Tor address

341
00:15:27,480 --> 00:15:30,420
I'm visiting from the internet the IP

342
00:15:30,420 --> 00:15:33,540
which I found on on the Torah address

343
00:15:33,540 --> 00:15:35,519
because I'm connected through the tour

344
00:15:35,519 --> 00:15:37,740
on the Tor address and I just changed

345
00:15:37,740 --> 00:15:39,660
the hostname

346
00:15:39,660 --> 00:15:41,760
right now I'm on the internet and I'm

347
00:15:41,760 --> 00:15:43,740
trying to do some requests from the

348
00:15:43,740 --> 00:15:46,440
internet then to validate with the

349
00:15:46,440 --> 00:15:49,860
server status page

350
00:15:49,860 --> 00:15:52,980
so my my traffic made from the internet

351
00:15:52,980 --> 00:15:56,100
should be seen on the HTTP torch server

352
00:15:56,100 --> 00:15:58,800
on the server status that's what I'm

353
00:15:58,800 --> 00:16:01,680
trying to do right now

354
00:16:01,680 --> 00:16:04,019
and we'll see

355
00:16:04,019 --> 00:16:06,860
the server status

356
00:16:07,199 --> 00:16:10,680
and we will see the the traffic I made

357
00:16:10,680 --> 00:16:14,719
it should be happening in a while

358
00:16:20,820 --> 00:16:23,579
uh right now I'm I'm showing you the

359
00:16:23,579 --> 00:16:26,160
e-tag technique that is the same e-tag

360
00:16:26,160 --> 00:16:29,760
on the onion here as from the internet

361
00:16:29,760 --> 00:16:32,399
the same e-tag now I'm visiting the

362
00:16:32,399 --> 00:16:34,860
server status

363
00:16:34,860 --> 00:16:38,399
I'll go on the browser to have a nice

364
00:16:38,399 --> 00:16:40,079
printing

365
00:16:40,079 --> 00:16:42,959
and right now as you can see I have

366
00:16:42,959 --> 00:16:45,360
all the requests both from the tour and

367
00:16:45,360 --> 00:16:47,940
from the internet that's that's how I

368
00:16:47,940 --> 00:16:50,279
can validate that is the same server

369
00:16:50,279 --> 00:16:52,920
right now it's another I want to pause

370
00:16:52,920 --> 00:16:54,360
up

371
00:16:54,360 --> 00:16:57,300
right now it's another configuration I

372
00:16:57,300 --> 00:16:58,440
want to show you something very

373
00:16:58,440 --> 00:17:00,420
interesting because it doesn't help you

374
00:17:00,420 --> 00:17:05,240
just to the anonymize servers or go back

375
00:17:05,880 --> 00:17:10,980
oh I cannot go can you help me with the

376
00:17:10,980 --> 00:17:13,640
the video

377
00:17:14,160 --> 00:17:18,799
right at the end of the video if you can

378
00:17:19,619 --> 00:17:23,239
it is not having it or not

379
00:17:24,119 --> 00:17:26,339
what I'm trying to do is to reconfigure

380
00:17:26,339 --> 00:17:30,299
the hidden domain to to be in the to

381
00:17:30,299 --> 00:17:32,640
have a cloud thread in front of it and

382
00:17:32,640 --> 00:17:34,740
to show you that even it's Cloud free in

383
00:17:34,740 --> 00:17:38,460
front of it I will I can I can anonymize

384
00:17:38,460 --> 00:17:42,660
it and I can get the real IP address

385
00:17:42,660 --> 00:17:45,179
okay can we go to

386
00:17:45,179 --> 00:17:47,460
the the final of the video something

387
00:17:47,460 --> 00:17:49,700
like

388
00:17:58,080 --> 00:17:59,240
yeah

389
00:17:59,240 --> 00:18:03,059
uh can I see the minutes of how much how

390
00:18:03,059 --> 00:18:05,780
long is this video

391
00:18:10,200 --> 00:18:12,480
yeah I will tell you about what I did so

392
00:18:12,480 --> 00:18:15,000
it's about the cloud cloud flare I

393
00:18:15,000 --> 00:18:17,580
configured the server to be in front of

394
00:18:17,580 --> 00:18:20,520
a cloudflare so you know that you cannot

395
00:18:20,520 --> 00:18:22,799
find the IP address of cloudflare the

396
00:18:22,799 --> 00:18:25,320
real IP address of a Cloud Server what I

397
00:18:25,320 --> 00:18:27,678
did was

398
00:18:27,900 --> 00:18:30,179
was to use the long header technique

399
00:18:30,179 --> 00:18:32,400
because that's the only technique that

400
00:18:32,400 --> 00:18:34,500
doesn't imply to downgrade the protocol

401
00:18:34,500 --> 00:18:36,900
so in cloudflare if you change the host

402
00:18:36,900 --> 00:18:38,820
header host name and downgrade the

403
00:18:38,820 --> 00:18:41,820
protocol you'll get nothing so the long

404
00:18:41,820 --> 00:18:43,620
header technique will help you to

405
00:18:43,620 --> 00:18:46,080
trigger the bad request and in the bad

406
00:18:46,080 --> 00:18:48,660
request we'll get the IP address and

407
00:18:48,660 --> 00:18:51,240
that's what ah here thank you you can

408
00:18:51,240 --> 00:18:52,200
play it

409
00:18:52,200 --> 00:18:54,980
from here

410
00:18:55,799 --> 00:18:58,260
okay you can start

411
00:18:58,260 --> 00:19:01,200
so as I said I put a long header and in

412
00:19:01,200 --> 00:19:03,539
the response I get the the real IP

413
00:19:03,539 --> 00:19:05,760
address of the server which is protected

414
00:19:05,760 --> 00:19:07,620
by cloudflare it's not a problem in

415
00:19:07,620 --> 00:19:09,780
cloudflare it's not a problem in Apache

416
00:19:09,780 --> 00:19:14,160
it's just about configuration and

417
00:19:18,000 --> 00:19:20,400
that's all you can close the video and

418
00:19:20,400 --> 00:19:23,780
go on with the slides

419
00:19:24,600 --> 00:19:27,840
so in conclusion any sys admin should

420
00:19:27,840 --> 00:19:30,059
know about this and configure the first

421
00:19:30,059 --> 00:19:32,700
virtual domain of the configuration file

422
00:19:32,700 --> 00:19:36,419
with localhost to not not leak any

423
00:19:36,419 --> 00:19:39,299
domain which is very important from the

424
00:19:39,299 --> 00:19:43,200
from the company and

425
00:19:43,940 --> 00:19:46,320
disable the server status on tour

426
00:19:46,320 --> 00:19:49,919
because they're disabling it you can you

427
00:19:49,919 --> 00:19:52,080
cannot see any more the request to the

428
00:19:52,080 --> 00:19:54,000
server and maybe someone can leak the IP

429
00:19:54,000 --> 00:19:55,380
for them

430
00:19:55,380 --> 00:19:57,419
and

431
00:19:57,419 --> 00:20:00,559
just pay attention at the the

432
00:20:00,559 --> 00:20:03,900
exceptions and forbidden and not found

433
00:20:03,900 --> 00:20:06,900
Pages because those pages can can

434
00:20:06,900 --> 00:20:09,960
trigger can leak the IP as well thank

435
00:20:09,960 --> 00:20:11,820
you

436
00:20:11,820 --> 00:20:14,780
still

437
00:20:17,039 --> 00:20:20,039
foreign

438
00:20:20,700 --> 00:20:22,880
that's a really interesting presentation

439
00:20:22,880 --> 00:20:26,400
uh we're going to have to take some

440
00:20:26,400 --> 00:20:28,200
questions from the audience if there are

441
00:20:28,200 --> 00:20:30,299
any perfect

442
00:20:30,299 --> 00:20:33,780
just a second also for the people that

443
00:20:33,780 --> 00:20:36,360
have questions please stand up so we can

444
00:20:36,360 --> 00:20:39,059
see you it's better for us to to see

445
00:20:39,059 --> 00:20:42,720
where we can you have the mic there

446
00:20:42,720 --> 00:20:45,360
thank you uh one question to these

447
00:20:45,360 --> 00:20:47,280
attacks also apply please stand up

448
00:20:47,280 --> 00:20:49,140
services

449
00:20:49,140 --> 00:20:51,299
um behind i2p

450
00:20:51,299 --> 00:20:54,600
and in general what's your opinion on

451
00:20:54,600 --> 00:20:57,360
the current status of in regards to

452
00:20:57,360 --> 00:20:58,740
anonymity

453
00:20:58,740 --> 00:21:02,120
for i2p service both for operators and

454
00:21:02,120 --> 00:21:05,580
users because there was a

455
00:21:05,580 --> 00:21:08,940
I think like recently a migration to ITP

456
00:21:08,940 --> 00:21:11,400
because of the constant Tulsa tax for

457
00:21:11,400 --> 00:21:13,440
for tour services

458
00:21:13,440 --> 00:21:16,860
these attacks are working only on Apache

459
00:21:16,860 --> 00:21:19,260
based based server I'm not sure

460
00:21:19,260 --> 00:21:20,960
I

461
00:21:20,960 --> 00:21:25,500
heard it very well what you said i2p

462
00:21:25,500 --> 00:21:28,860
okay I'm not it's a protocol it's it's

463
00:21:28,860 --> 00:21:31,320
also a protocol

464
00:21:31,320 --> 00:21:34,020
um which is not a problem in the

465
00:21:34,020 --> 00:21:36,659
protocol it's just the it's a problem in

466
00:21:36,659 --> 00:21:39,000
the Apache server core server of that

467
00:21:39,000 --> 00:21:42,780
page because nginx Tomcat used some some

468
00:21:42,780 --> 00:21:45,960
things from the Apache and Apache 2 as

469
00:21:45,960 --> 00:21:49,140
well is is using what they developed and

470
00:21:49,140 --> 00:21:52,080
the problem is just in these servers not

471
00:21:52,080 --> 00:21:55,100
it's not in other servers like

472
00:21:55,100 --> 00:21:58,620
glassfish or weblogic or any other

473
00:21:58,620 --> 00:22:02,100
server like python or The Flash and so

474
00:22:02,100 --> 00:22:06,840
on So This Server this Apache core based

475
00:22:06,840 --> 00:22:09,840
servers are having this problem maybe I

476
00:22:09,840 --> 00:22:12,320
try to to to do some research on the

477
00:22:12,320 --> 00:22:15,559
Microsoft servers and so on but I didn't

478
00:22:15,559 --> 00:22:18,480
have any result on this

479
00:22:18,480 --> 00:22:22,020
so if you mention any anything else and

480
00:22:22,020 --> 00:22:24,659
I don't know maybe another protocol if

481
00:22:24,659 --> 00:22:26,460
they are using this on anonymization

482
00:22:26,460 --> 00:22:28,500
protocol or something else they are if

483
00:22:28,500 --> 00:22:30,659
you are they are using this then maybe

484
00:22:30,659 --> 00:22:33,299
you can leak something

485
00:22:33,299 --> 00:22:35,220
would be interesting to try because I

486
00:22:35,220 --> 00:22:37,320
think they would also work there because

487
00:22:37,320 --> 00:22:40,860
basically they expose the IP address

488
00:22:40,860 --> 00:22:43,200
and you can't also hide that

489
00:22:43,200 --> 00:22:45,840
thank you yep

490
00:22:45,840 --> 00:22:47,880
do we have other questions from the

491
00:22:47,880 --> 00:22:50,039
audience yes another question over there

492
00:22:50,039 --> 00:22:51,600
and also here

493
00:22:51,600 --> 00:22:54,260
great

494
00:23:08,039 --> 00:23:11,280
then I'll ask my question I guess I was

495
00:23:11,280 --> 00:23:13,559
curious how worth it is to keep support

496
00:23:13,559 --> 00:23:15,600
for HTTP 1.0

497
00:23:15,600 --> 00:23:18,659
uh are there many legitimate requests

498
00:23:18,659 --> 00:23:21,780
my opinion is that no you can't disable

499
00:23:21,780 --> 00:23:24,840
it because it's no one is working with

500
00:23:24,840 --> 00:23:28,860
HTTP 1.0 it was left there because maybe

501
00:23:28,860 --> 00:23:31,620
I don't know some

502
00:23:31,620 --> 00:23:35,640
all devices use it but in these days no

503
00:23:35,640 --> 00:23:39,059
we are trying to go to http.20 and

504
00:23:39,059 --> 00:23:41,880
so on so I think they were thinking they

505
00:23:41,880 --> 00:23:43,679
were thinking that won't be any problem

506
00:23:43,679 --> 00:23:45,900
if you left there I don't know someone

507
00:23:45,900 --> 00:23:50,100
who really wants to use it but it you

508
00:23:50,100 --> 00:23:51,419
can disable it

509
00:23:51,419 --> 00:23:54,120
thanks yeah it's the best way to

510
00:23:54,120 --> 00:23:58,100
to protect to fix these problems

511
00:23:58,740 --> 00:24:01,380
yeah hey it was a really awesome

512
00:24:01,380 --> 00:24:02,640
presentation thank you very much for

513
00:24:02,640 --> 00:24:04,220
that

514
00:24:04,220 --> 00:24:08,280
yeah I was wondering will this technique

515
00:24:08,280 --> 00:24:11,280
help in regards to domain fronting to

516
00:24:11,280 --> 00:24:14,580
leak additional information about so

517
00:24:14,580 --> 00:24:17,640
what's behind that domain fronting like

518
00:24:17,640 --> 00:24:19,559
you said about cloudflare okay

519
00:24:19,559 --> 00:24:22,140
cloudflare is sometimes used for as

520
00:24:22,140 --> 00:24:24,299
domain fronting by I don't know trit

521
00:24:24,299 --> 00:24:27,659
actors or stuff like that will it help

522
00:24:27,659 --> 00:24:31,320
uh I don't know in any way to leak

523
00:24:31,320 --> 00:24:33,980
additional information this technique

524
00:24:33,980 --> 00:24:37,679
depends no for instance you just click

525
00:24:37,679 --> 00:24:39,240
the IP and

526
00:24:39,240 --> 00:24:42,179
from them there one I don't know you you

527
00:24:42,179 --> 00:24:45,000
choose what to do how how what are your

528
00:24:45,000 --> 00:24:47,480
limits and so on but

529
00:24:47,480 --> 00:24:50,159
you don't like any other information as

530
00:24:50,159 --> 00:24:52,400
from what I saw

531
00:24:52,400 --> 00:24:55,500
I could I could also answer to your

532
00:24:55,500 --> 00:24:57,539
question in business no

533
00:24:57,539 --> 00:25:00,240
so just the IP I I was focusing on IP

534
00:25:00,240 --> 00:25:02,700
because it was interesting for me for

535
00:25:02,700 --> 00:25:06,480
the Tor Browser for protocol sorry

536
00:25:06,480 --> 00:25:09,780
so it might be a shitty question but did

537
00:25:09,780 --> 00:25:13,860
you try with downgrading it to http 0.9

538
00:25:13,860 --> 00:25:15,179
oh

539
00:25:15,179 --> 00:25:18,179
0.9 ah 0.9 because yeah that's the first

540
00:25:18,179 --> 00:25:20,280
protocol you might find another other

541
00:25:20,280 --> 00:25:22,500
meters there yeah I think it's working

542
00:25:22,500 --> 00:25:25,080
as well as 1.0 because they don't have

543
00:25:25,080 --> 00:25:27,960
the host header because yeah at that

544
00:25:27,960 --> 00:25:33,779
time the older well not the PHP serving

545
00:25:33,779 --> 00:25:36,059
servers but maybe with the Microsoft

546
00:25:36,059 --> 00:25:37,679
ones and

547
00:25:37,679 --> 00:25:40,980
uh IBM weblogic and whatever

548
00:25:40,980 --> 00:25:43,260
it might be a vector there yeah I think

549
00:25:43,260 --> 00:25:46,320
it's working on 0.9 it's it's nice you

550
00:25:46,320 --> 00:25:49,200
mention it because I I forgot that it

551
00:25:49,200 --> 00:25:51,840
exists on that one

552
00:25:51,840 --> 00:25:54,240
okay thank you we have another question

553
00:25:54,240 --> 00:25:56,960
over here

554
00:25:57,360 --> 00:26:01,860
more of a curiosity from my side uh if

555
00:26:01,860 --> 00:26:05,419
you made some experimental uh assessment

556
00:26:05,419 --> 00:26:08,760
what would a server-like nginx compare

557
00:26:08,760 --> 00:26:12,059
to the Apache based

558
00:26:12,059 --> 00:26:13,919
Solutions

559
00:26:13,919 --> 00:26:18,120
So based on my research and what I

560
00:26:18,120 --> 00:26:21,000
presented here I can say that on nginx

561
00:26:21,000 --> 00:26:23,340
you cannot trigger those exceptions I

562
00:26:23,340 --> 00:26:26,340
talked about at web applash Apache 2

563
00:26:26,340 --> 00:26:29,580
servers but it works with the server

564
00:26:29,580 --> 00:26:32,580
redirects because the core of the server

565
00:26:32,580 --> 00:26:35,220
it's from the Apache something like this

566
00:26:35,220 --> 00:26:38,940
and the redirects are triggering the

567
00:26:38,940 --> 00:26:43,100
same way as Apache 2 and Tomcat

568
00:26:43,620 --> 00:26:45,900
that's all and

569
00:26:45,900 --> 00:26:48,720
yeah on nginx just you can use just the

570
00:26:48,720 --> 00:26:50,460
server redirects

571
00:26:50,460 --> 00:26:52,140
nothing else

572
00:26:52,140 --> 00:26:54,900
so on cloudflare we can maybe you can

573
00:26:54,900 --> 00:26:56,880
anonymize just

574
00:26:56,880 --> 00:26:59,520
the applies to servers not anything not

575
00:26:59,520 --> 00:27:02,880
Tomcat not nginx and I said it's not a

576
00:27:02,880 --> 00:27:04,440
problem in cloudflare

577
00:27:04,440 --> 00:27:06,539
it's just the way you configure the

578
00:27:06,539 --> 00:27:08,820
approach to

579
00:27:08,820 --> 00:27:11,100
servers thank you you know do we have

580
00:27:11,100 --> 00:27:12,840
another other questions in the audience

581
00:27:12,840 --> 00:27:15,779
or shall we move on

582
00:27:15,779 --> 00:27:18,179
well perfect then let's have a big round

583
00:27:18,179 --> 00:27:21,320
of applause for your notes

584
00:27:21,900 --> 00:27:26,299
awesome presentation thank you

