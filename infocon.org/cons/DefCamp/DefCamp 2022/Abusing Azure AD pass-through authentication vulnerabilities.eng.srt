1
00:00:00,000 --> 00:00:01,979
today I'm going to talk about how to

2
00:00:01,979 --> 00:00:05,179
abuse Azure ad

3
00:00:05,580 --> 00:00:07,859
post authentication vulnerabilities we

4
00:00:07,859 --> 00:00:10,380
found earlier this year

5
00:00:10,380 --> 00:00:12,719
so I'm going to do a lot of demos so a

6
00:00:12,719 --> 00:00:15,059
couple of slides then to the demos and

7
00:00:15,059 --> 00:00:16,560
they are live demo so let's see how it

8
00:00:16,560 --> 00:00:18,180
goes as always

9
00:00:18,180 --> 00:00:21,060
nice to you know try to tease demo cards

10
00:00:21,060 --> 00:00:25,560
okay so I got already introduced so

11
00:00:25,560 --> 00:00:28,380
it's me nestory hi I'm from Finland I

12
00:00:28,380 --> 00:00:30,480
work for CQ works and you can you know

13
00:00:30,480 --> 00:00:31,920
follow me on Twitter and also in

14
00:00:31,920 --> 00:00:33,840
masterton because that's what we do

15
00:00:33,840 --> 00:00:35,399
nowadays

16
00:00:35,399 --> 00:00:38,059
uh I'm a Microsoft MVP

17
00:00:38,059 --> 00:00:41,340
and I'm also Microsoft MBR which stands

18
00:00:41,340 --> 00:00:43,440
for Microsoft's most valuable researcher

19
00:00:43,440 --> 00:00:47,460
so every year in dacat US Microsoft

20
00:00:47,460 --> 00:00:49,620
security Response Center is publishing a

21
00:00:49,620 --> 00:00:51,960
list of 100 most valuable researchers

22
00:00:51,960 --> 00:00:54,420
and I was secondly on that list and this

23
00:00:54,420 --> 00:00:57,539
time I was on on 70th Place

24
00:00:57,539 --> 00:00:59,579
so it's nice to be there

25
00:00:59,579 --> 00:01:03,120
okay so most of the people around the

26
00:01:03,120 --> 00:01:05,760
world know me from my toolkit A8

27
00:01:05,760 --> 00:01:08,700
internals anybody use that here

28
00:01:08,700 --> 00:01:11,220
okay a couple of yes okay well I have

29
00:01:11,220 --> 00:01:13,920
some stickers here so I can you can uh

30
00:01:13,920 --> 00:01:15,180
you know

31
00:01:15,180 --> 00:01:18,060
just pick me from my leave later on and

32
00:01:18,060 --> 00:01:19,380
I will give you a sticker If you want to

33
00:01:19,380 --> 00:01:21,420
so it's an open source tool and I'm

34
00:01:21,420 --> 00:01:23,159
gonna use that today also

35
00:01:23,159 --> 00:01:25,920
uh it's been listed by my attacks since

36
00:01:25,920 --> 00:01:30,180
February this year as a soft s677 and it

37
00:01:30,180 --> 00:01:33,600
has been used by groups like apt-29

38
00:01:33,600 --> 00:01:36,600
also known as nobelium and as we as we

39
00:01:36,600 --> 00:01:39,840
track that in City work it's called Ira

40
00:01:39,840 --> 00:01:42,180
ritual but the same organization

41
00:01:42,180 --> 00:01:44,520
but they haven't paid me anything any

42
00:01:44,520 --> 00:01:47,159
ransomware they got from this so

43
00:01:47,159 --> 00:01:48,420
yeah

44
00:01:48,420 --> 00:01:52,259
and today's talk it's based on three

45
00:01:52,259 --> 00:01:54,600
let's say documents if we also two blog

46
00:01:54,600 --> 00:01:57,180
post of me and then secure Works threat

47
00:01:57,180 --> 00:01:59,939
analysis we published on I think that

48
00:01:59,939 --> 00:02:03,380
was in September yes

49
00:02:04,259 --> 00:02:05,340
so

50
00:02:05,340 --> 00:02:06,899
today I'm going to cover three things

51
00:02:06,899 --> 00:02:09,360
not necessarily in this order

52
00:02:09,360 --> 00:02:10,860
but anyways I'm going to tell you what

53
00:02:10,860 --> 00:02:12,480
is possible indication

54
00:02:12,480 --> 00:02:15,000
how we can abuse that and also how to

55
00:02:15,000 --> 00:02:17,580
detect the abuse and how to mitigate if

56
00:02:17,580 --> 00:02:19,200
possible

57
00:02:19,200 --> 00:02:21,720
and let's start with talking about Cloud

58
00:02:21,720 --> 00:02:22,920
security

59
00:02:22,920 --> 00:02:26,160
so quite I have got this question quite

60
00:02:26,160 --> 00:02:29,280
many times that is cloud secure and I

61
00:02:29,280 --> 00:02:31,140
would say that yes cloud is secure as

62
00:02:31,140 --> 00:02:32,160
thoughts

63
00:02:32,160 --> 00:02:34,379
so it's easy for users they just need to

64
00:02:34,379 --> 00:02:37,680
you know provide some form of proof of

65
00:02:37,680 --> 00:02:40,379
identity and they are able to you know

66
00:02:40,379 --> 00:02:42,420
use their services

67
00:02:42,420 --> 00:02:45,239
it is bad for attackers or threat actors

68
00:02:45,239 --> 00:02:47,819
because they can't use their old you

69
00:02:47,819 --> 00:02:50,040
know methods to penetrate on-prem they

70
00:02:50,040 --> 00:02:51,120
can't do that anymore

71
00:02:51,120 --> 00:02:54,420
so yeah if you are using only Cloud it's

72
00:02:54,420 --> 00:02:55,260
okay

73
00:02:55,260 --> 00:02:57,000
but most of the organizations are not

74
00:02:57,000 --> 00:02:59,700
Cloud only they are so-called hybrid

75
00:02:59,700 --> 00:03:01,680
which means that they are using same

76
00:03:01,680 --> 00:03:03,660
identities in your on-prem and then also

77
00:03:03,660 --> 00:03:04,860
in Cloud

78
00:03:04,860 --> 00:03:07,379
and that's good for admins because it's

79
00:03:07,379 --> 00:03:09,300
easier to manage you have only one set

80
00:03:09,300 --> 00:03:10,920
of management tools

81
00:03:10,920 --> 00:03:12,780
and it's good for users because you can

82
00:03:12,780 --> 00:03:14,640
use same credentials in on-prem and in

83
00:03:14,640 --> 00:03:15,720
Cloud

84
00:03:15,720 --> 00:03:18,780
and it's extremely good for attackers or

85
00:03:18,780 --> 00:03:20,040
threat actors

86
00:03:20,040 --> 00:03:22,560
because why because when you are doing

87
00:03:22,560 --> 00:03:24,599
this hybrid you're actually connecting

88
00:03:24,599 --> 00:03:26,640
your on-prem to cloud and you are poking

89
00:03:26,640 --> 00:03:29,340
holes to that safe Cloud environment

90
00:03:29,340 --> 00:03:31,200
and guess what

91
00:03:31,200 --> 00:03:34,080
attackers can now attack your on-prem

92
00:03:34,080 --> 00:03:36,120
and Via on-prem they can get into your

93
00:03:36,120 --> 00:03:37,080
cloud

94
00:03:37,080 --> 00:03:39,599
so that's what happened during the solar

95
00:03:39,599 --> 00:03:41,760
arcade attacks for instance

96
00:03:41,760 --> 00:03:44,040
and there are plenty of options you can

97
00:03:44,040 --> 00:03:45,959
choose that reads like authentication

98
00:03:45,959 --> 00:03:47,760
option you are using and today we are

99
00:03:47,760 --> 00:03:49,560
going to talk about the

100
00:03:49,560 --> 00:03:53,459
where is here the ptas

101
00:03:53,459 --> 00:03:56,340
and talking about PTA let's go to the

102
00:03:56,340 --> 00:03:58,440
high level architecture to how it works

103
00:03:58,440 --> 00:04:01,080
so here it is

104
00:04:01,080 --> 00:04:03,959
so basically what happens is that when

105
00:04:03,959 --> 00:04:05,940
users are trying to log in in an

106
00:04:05,940 --> 00:04:08,459
organization that is using PTA it is

107
00:04:08,459 --> 00:04:10,080
like typing the credentials using my

108
00:04:10,080 --> 00:04:12,180
password in Cloud okay

109
00:04:12,180 --> 00:04:15,780
and then after already is sending those

110
00:04:15,780 --> 00:04:18,000
credentials to eight cents that are

111
00:04:18,000 --> 00:04:20,100
installed in your on-prem environment so

112
00:04:20,100 --> 00:04:22,079
they need to be installed on server

113
00:04:22,079 --> 00:04:24,300
domain joint

114
00:04:24,300 --> 00:04:27,540
it's right here as we can see

115
00:04:27,540 --> 00:04:31,560
and those credentials are like encrypted

116
00:04:31,560 --> 00:04:34,199
and the 18 is decrypting them and then

117
00:04:34,199 --> 00:04:36,780
technically the Third

118
00:04:36,780 --> 00:04:39,120
part here is it is sending those

119
00:04:39,120 --> 00:04:41,820
credentials to system 32 function called

120
00:04:41,820 --> 00:04:44,400
logon user W so basically it's trying to

121
00:04:44,400 --> 00:04:46,199
log in as that user

122
00:04:46,199 --> 00:04:48,240
and that's when the agent is actually

123
00:04:48,240 --> 00:04:50,880
connecting to on-prem ad

124
00:04:50,880 --> 00:04:54,000
and then it will will return the results

125
00:04:54,000 --> 00:04:56,400
so that's the high level architecture

126
00:04:56,400 --> 00:05:00,000
but now let's go into details

127
00:05:00,000 --> 00:05:02,699
so this is what happens when the PTA

128
00:05:02,699 --> 00:05:04,800
agent is starting up

129
00:05:04,800 --> 00:05:07,860
and as you can see

130
00:05:07,860 --> 00:05:10,320
here on the top left there's a

131
00:05:10,320 --> 00:05:13,340
certificate which means that

132
00:05:13,340 --> 00:05:16,500
PDA agents are using certificates as an

133
00:05:16,500 --> 00:05:18,180
authentication method so they are using

134
00:05:18,180 --> 00:05:21,360
certificate based on application or CBA

135
00:05:21,360 --> 00:05:23,400
and it is connecting to

136
00:05:23,400 --> 00:05:25,680
the Azure ID and the first thing it

137
00:05:25,680 --> 00:05:27,600
wants to get is a configuration and that

138
00:05:27,600 --> 00:05:29,880
is called bootstrap

139
00:05:29,880 --> 00:05:32,340
and that what happens with the steps one

140
00:05:32,340 --> 00:05:33,660
two four

141
00:05:33,660 --> 00:05:36,660
so basically it start by connecting to

142
00:05:36,660 --> 00:05:38,820
Azure ready and it's telling us already

143
00:05:38,820 --> 00:05:41,639
that hey give me the configuration and

144
00:05:41,639 --> 00:05:43,440
when it gets the configuration

145
00:05:43,440 --> 00:05:46,380
it is establishing websocket connections

146
00:05:46,380 --> 00:05:49,500
to Azure service bus

147
00:05:49,500 --> 00:05:51,479
so it usually has like eight different

148
00:05:51,479 --> 00:05:53,820
connection points it is oh sorry input

149
00:05:53,820 --> 00:05:56,580
is connecting to so this happens what

150
00:05:56,580 --> 00:05:58,800
you start updated

151
00:05:58,800 --> 00:06:01,979
and now the 18th is ready to you know uh

152
00:06:01,979 --> 00:06:06,139
for receiving the authentication request

153
00:06:06,180 --> 00:06:09,000
and now what happens Technically when

154
00:06:09,000 --> 00:06:11,520
you authenticate it is like this so

155
00:06:11,520 --> 00:06:13,680
everything starts with a service bus

156
00:06:13,680 --> 00:06:16,440
we're actually already sending you the

157
00:06:16,440 --> 00:06:19,259
credentials to use a type when he or she

158
00:06:19,259 --> 00:06:21,120
logged in right

159
00:06:21,120 --> 00:06:23,699
and then it says that actually first

160
00:06:23,699 --> 00:06:26,220
that hey connect to this relay and then

161
00:06:26,220 --> 00:06:29,400
18 connects to relay and then by a relay

162
00:06:29,400 --> 00:06:32,639
you will get the authentication request

163
00:06:32,639 --> 00:06:34,979
and then on step four

164
00:06:34,979 --> 00:06:37,919
you will the agent is sending those

165
00:06:37,919 --> 00:06:40,560
allocation response to a proxy so

166
00:06:40,560 --> 00:06:42,360
there's a lot of components here so it's

167
00:06:42,360 --> 00:06:45,000
very messy but it's a white robust

168
00:06:45,000 --> 00:06:47,520
actually it's working all right

169
00:06:47,520 --> 00:06:50,160
now what is inside that authentication

170
00:06:50,160 --> 00:06:53,580
request then so that's an important

171
00:06:53,580 --> 00:06:56,520
so actually I think I forgot to mention

172
00:06:56,520 --> 00:06:58,380
that Microsoft says that you should have

173
00:06:58,380 --> 00:07:00,419
at least three agents for high

174
00:07:00,419 --> 00:07:02,699
availability and a maximum number is

175
00:07:02,699 --> 00:07:04,259
like 40.

176
00:07:04,259 --> 00:07:05,819
so technically you can't add more than

177
00:07:05,819 --> 00:07:07,560
40 agents

178
00:07:07,560 --> 00:07:10,199
and in order to get some request you

179
00:07:10,199 --> 00:07:13,560
have the users username and password and

180
00:07:13,560 --> 00:07:15,720
the password is like encrypted

181
00:07:15,720 --> 00:07:20,759
and it has entry for all agents here so

182
00:07:20,759 --> 00:07:22,759
every agent usually get the list of

183
00:07:22,759 --> 00:07:25,259
sorry the authentication request and it

184
00:07:25,259 --> 00:07:28,139
has entries for each of those agents and

185
00:07:28,139 --> 00:07:29,720
usually there's only one

186
00:07:29,720 --> 00:07:32,819
certificate per agent but there can be

187
00:07:32,819 --> 00:07:34,800
more than one usually if you are

188
00:07:34,800 --> 00:07:36,539
compromised but there are certain

189
00:07:36,539 --> 00:07:39,120
situations where that's normal for a

190
00:07:39,120 --> 00:07:41,819
short period of time but anyways based

191
00:07:41,819 --> 00:07:43,680
on this information like a key

192
00:07:43,680 --> 00:07:46,620
identifier so that's the agent ID and

193
00:07:46,620 --> 00:07:49,259
then the thumbprint of the certificate

194
00:07:49,259 --> 00:07:51,900
so those help the AIDS and recognize

195
00:07:51,900 --> 00:07:54,960
weeds like encrypt that block I should

196
00:07:54,960 --> 00:07:58,099
be decrypting

197
00:07:58,319 --> 00:08:00,720
so yeah

198
00:08:00,720 --> 00:08:03,000
we will get back to this later and now

199
00:08:03,000 --> 00:08:05,400
how to abuse PDA now that we know some

200
00:08:05,400 --> 00:08:07,680
technical backgrounds and I only have

201
00:08:07,680 --> 00:08:09,060
like 30 minutes so I need to move

202
00:08:09,060 --> 00:08:10,500
forward quite fast

203
00:08:10,500 --> 00:08:11,639
so

204
00:08:11,639 --> 00:08:14,160
to abusing

205
00:08:14,160 --> 00:08:17,520
so I've been doing this PTA app using

206
00:08:17,520 --> 00:08:20,460
since 2019 at least so that was when I

207
00:08:20,460 --> 00:08:23,879
published a thing called PDS pie

208
00:08:23,879 --> 00:08:26,099
and to use that it requires that you

209
00:08:26,099 --> 00:08:28,800
will get the local admin level access to

210
00:08:28,800 --> 00:08:31,680
that server that is running PDA agent so

211
00:08:31,680 --> 00:08:33,779
you don't need to be like domain admin

212
00:08:33,779 --> 00:08:35,279
or anything like that local admin is

213
00:08:35,279 --> 00:08:36,899
just fine

214
00:08:36,899 --> 00:08:38,880
and what you do there is that you

215
00:08:38,880 --> 00:08:42,059
actually inject the dll

216
00:08:42,059 --> 00:08:45,060
to the PTA agent process

217
00:08:45,060 --> 00:08:47,160
and what it what that technically does

218
00:08:47,160 --> 00:08:49,560
is that it replaces the local user W

219
00:08:49,560 --> 00:08:51,540
system function

220
00:08:51,540 --> 00:08:53,940
in that process not in the whole

221
00:08:53,940 --> 00:08:56,160
computer but in that process

222
00:08:56,160 --> 00:08:58,140
and it accepts all the password so it

223
00:08:58,140 --> 00:09:00,360
doesn't communicate with ad anymore it's

224
00:09:00,360 --> 00:09:01,920
just accepting every password you keep

225
00:09:01,920 --> 00:09:03,000
them

226
00:09:03,000 --> 00:09:05,700
and it also saves all the credentials to

227
00:09:05,700 --> 00:09:07,620
the local CSV file

228
00:09:07,620 --> 00:09:11,339
and I heard that apt-29 has been using

229
00:09:11,339 --> 00:09:15,000
this actual PDS pie for you know

230
00:09:15,000 --> 00:09:17,880
Gathering credentials but also like as a

231
00:09:17,880 --> 00:09:19,620
backdoor because it accepts every

232
00:09:19,620 --> 00:09:21,000
password you are able to login as any

233
00:09:21,000 --> 00:09:22,860
user you want to right

234
00:09:22,860 --> 00:09:25,320
but this is a bit noisy

235
00:09:25,320 --> 00:09:26,760
you know when you are injecting

236
00:09:26,760 --> 00:09:28,920
something in processes in Windows it's

237
00:09:28,920 --> 00:09:31,620
uh well every EDR solution nowadays will

238
00:09:31,620 --> 00:09:32,580
you know

239
00:09:32,580 --> 00:09:34,980
notice that and block that or whatever

240
00:09:34,980 --> 00:09:36,240
they are doing

241
00:09:36,240 --> 00:09:39,660
so we invited another way so this is

242
00:09:39,660 --> 00:09:42,000
based on our research this year

243
00:09:42,000 --> 00:09:45,660
so we can now steal the identity of the

244
00:09:45,660 --> 00:09:48,240
pdas and so so we don't have to be on

245
00:09:48,240 --> 00:09:51,480
the server anymore we can be the server

246
00:09:51,480 --> 00:09:54,320
and this also requires only local admin

247
00:09:54,320 --> 00:09:57,120
permissions on the target server so what

248
00:09:57,120 --> 00:09:59,160
we do here we just you know get the

249
00:09:59,160 --> 00:10:02,160
certificate with the PTA agent is using

250
00:10:02,160 --> 00:10:05,339
for CBA and also for decrypting those

251
00:10:05,339 --> 00:10:07,500
credentials

252
00:10:07,500 --> 00:10:11,040
and we put it on the threat actor

253
00:10:11,040 --> 00:10:13,200
control computer and now we can

254
00:10:13,200 --> 00:10:15,120
impersonate that agent

255
00:10:15,120 --> 00:10:17,279
without any connection to the on-prem

256
00:10:17,279 --> 00:10:18,839
anymore

257
00:10:18,839 --> 00:10:21,660
and you want to see some demos

258
00:10:21,660 --> 00:10:24,240
okay so let's let's do that and I'm

259
00:10:24,240 --> 00:10:27,800
going to test a Meek now Mike now

260
00:10:29,640 --> 00:10:32,399
okay yes

261
00:10:32,399 --> 00:10:34,260
nice

262
00:10:34,260 --> 00:10:37,320
so let's see how this works

263
00:10:37,320 --> 00:10:39,560
okay

264
00:10:40,740 --> 00:10:44,420
I found my mouse great

265
00:10:44,519 --> 00:10:49,160
um and I'm pretty much in time so

266
00:10:50,279 --> 00:10:54,260
it might be a bit funny because I

267
00:10:54,899 --> 00:10:56,399
I don't know how this actually works

268
00:10:56,399 --> 00:10:58,260
because I don't know let me try

269
00:10:58,260 --> 00:11:00,560
something

270
00:11:02,279 --> 00:11:06,300
it's a bit far away to see there

271
00:11:06,300 --> 00:11:10,579
so let's try something totally different

272
00:11:13,560 --> 00:11:15,240
now that's better

273
00:11:15,240 --> 00:11:17,399
okay

274
00:11:17,399 --> 00:11:20,220
so what do we have here so we have two

275
00:11:20,220 --> 00:11:24,779
let's say Target organization servers so

276
00:11:24,779 --> 00:11:27,839
we have a domain controller that has pth

277
00:11:27,839 --> 00:11:29,100
and running

278
00:11:29,100 --> 00:11:33,200
it's a bit small here but it's this

279
00:11:33,839 --> 00:11:35,820
to right there

280
00:11:35,820 --> 00:11:38,399
and then we have the server that only

281
00:11:38,399 --> 00:11:40,560
has PTA and it also has the agent

282
00:11:40,560 --> 00:11:43,380
running right there

283
00:11:43,380 --> 00:11:45,680
okay

284
00:11:46,200 --> 00:11:49,320
and then we have the attacker machine

285
00:11:49,320 --> 00:11:52,040
and let's start by

286
00:11:52,040 --> 00:11:55,079
running the pts boy

287
00:11:55,079 --> 00:11:58,920
but first i'm gonna shut down the oh no

288
00:11:58,920 --> 00:12:00,839
I'm not going to do that yet sorry about

289
00:12:00,839 --> 00:12:04,380
that I was going ahead of my time

290
00:12:04,380 --> 00:12:05,760
so

291
00:12:05,760 --> 00:12:08,160
let's open up

292
00:12:08,160 --> 00:12:11,180
admin portal

293
00:12:11,220 --> 00:12:12,839
of the organization

294
00:12:12,839 --> 00:12:15,440
so

295
00:12:15,959 --> 00:12:19,140
what an admin can see about those ptas

296
00:12:19,140 --> 00:12:20,579
and so we are now running two of them

297
00:12:20,579 --> 00:12:23,940
and here's the admin portal which shows

298
00:12:23,940 --> 00:12:28,320
us that okay we have two agents

299
00:12:28,320 --> 00:12:30,839
we know their names and the IP addresses

300
00:12:30,839 --> 00:12:32,820
and that they are active

301
00:12:32,820 --> 00:12:34,560
and that's the only information you can

302
00:12:34,560 --> 00:12:37,800
get as a as an admin from the portal

303
00:12:37,800 --> 00:12:40,680
however there are some API

304
00:12:40,680 --> 00:12:44,040
endpoints that you can use to request

305
00:12:44,040 --> 00:12:45,959
the same information and I'm also

306
00:12:45,959 --> 00:12:48,120
implementing this in Aid internal so I'm

307
00:12:48,120 --> 00:12:51,000
going to say get a 80 in what is that

308
00:12:51,000 --> 00:12:53,760
called proxy Athens

309
00:12:53,760 --> 00:12:56,160
and form a table

310
00:12:56,160 --> 00:12:59,160
and here we can see

311
00:12:59,160 --> 00:13:01,620
in a second okay so now we can see the

312
00:13:01,620 --> 00:13:03,300
same information here but we can also

313
00:13:03,300 --> 00:13:06,959
see what is the ID of the agent and that

314
00:13:06,959 --> 00:13:08,160
is important

315
00:13:08,160 --> 00:13:11,459
because that kind of will it identifies

316
00:13:11,459 --> 00:13:12,540
the

317
00:13:12,540 --> 00:13:15,300
agent so now we're part of director

318
00:13:15,300 --> 00:13:18,120
stuff so again when I go back to Paul

319
00:13:18,120 --> 00:13:22,459
here and I'm gonna go to signing logs

320
00:13:26,160 --> 00:13:29,820
like right here okay

321
00:13:29,820 --> 00:13:33,180
okay two fat fingers

322
00:13:33,180 --> 00:13:37,399
let's go back and sign in locks

323
00:13:37,740 --> 00:13:41,040
so we can see signing events here

324
00:13:41,040 --> 00:13:42,839
and I'm going to try to find out the

325
00:13:42,839 --> 00:13:47,540
correct one I would like you to see

326
00:13:49,800 --> 00:13:51,779
there's too many of these okay so

327
00:13:51,779 --> 00:13:55,079
failure failure stocks is that try

328
00:13:55,079 --> 00:13:57,420
that one

329
00:13:57,420 --> 00:13:59,279
and when we go to authentication details

330
00:13:59,279 --> 00:14:03,000
we see that well it's very small

331
00:14:03,000 --> 00:14:07,320
so when I you know hover my mouse there

332
00:14:07,320 --> 00:14:09,600
it says that this was possible

333
00:14:09,600 --> 00:14:12,360
indication and the agent ID here is 3E

334
00:14:12,360 --> 00:14:14,579
something so you can see actually that

335
00:14:14,579 --> 00:14:18,060
which states and perform this the login

336
00:14:18,060 --> 00:14:20,519
so if they are like a

337
00:14:20,519 --> 00:14:23,279
some weird behavior that okay these

338
00:14:23,279 --> 00:14:25,680
certain agent is like accepting

339
00:14:25,680 --> 00:14:27,060
everything or blocking everything you

340
00:14:27,060 --> 00:14:29,579
know that okay maybe that's compromised

341
00:14:29,579 --> 00:14:31,320
but anyways

342
00:14:31,320 --> 00:14:33,420
uh

343
00:14:33,420 --> 00:14:35,220
I'm actually going to start a script

344
00:14:35,220 --> 00:14:37,079
here that is showing this same status

345
00:14:37,079 --> 00:14:39,839
here every three seconds okay and now I

346
00:14:39,839 --> 00:14:42,720
go to DC and I'm going to shut down this

347
00:14:42,720 --> 00:14:45,540
particular 18th row that we can be sure

348
00:14:45,540 --> 00:14:48,120
that the PTA server is going to get all

349
00:14:48,120 --> 00:14:50,300
the requests

350
00:14:50,300 --> 00:14:53,959
and I'm gonna

351
00:14:54,420 --> 00:14:57,540
start the publisher here and as we can

352
00:14:57,540 --> 00:15:00,839
see I created a new version def cam

353
00:15:00,839 --> 00:15:03,180
Edison for just for this conference

354
00:15:03,180 --> 00:15:04,920
and what I'm going to do now is that I'm

355
00:15:04,920 --> 00:15:08,699
going to install AED in PDS by

356
00:15:08,699 --> 00:15:11,399
are you sure about that yes

357
00:15:11,399 --> 00:15:13,380
and it's completed and I'm going to open

358
00:15:13,380 --> 00:15:16,500
the process hacker I'm gonna search for

359
00:15:16,500 --> 00:15:18,899
azure

360
00:15:18,899 --> 00:15:22,740
I'm going to tune in so not yet so it's

361
00:15:22,740 --> 00:15:23,699
this one

362
00:15:23,699 --> 00:15:25,800
and

363
00:15:25,800 --> 00:15:27,959
I'm gonna tube in a bit so I can see

364
00:15:27,959 --> 00:15:31,139
that the PTA spy is actually injected in

365
00:15:31,139 --> 00:15:33,720
that process okay so now it's accepting

366
00:15:33,720 --> 00:15:36,000
all the passwords and and saving

367
00:15:36,000 --> 00:15:38,279
everything to

368
00:15:38,279 --> 00:15:41,279
to a file and now I'm going to try to

369
00:15:41,279 --> 00:15:44,220
sign in as this user

370
00:15:44,220 --> 00:15:46,440
and what password should be

371
00:15:46,440 --> 00:15:48,420
try okay

372
00:15:48,420 --> 00:15:50,279
hello if

373
00:15:50,279 --> 00:15:52,860
camp

374
00:15:52,860 --> 00:15:55,620
and it doesn't actually matter what I

375
00:15:55,620 --> 00:15:58,620
type here because it accepts everything

376
00:15:58,620 --> 00:16:02,519
and I'm just gonna no that one I need to

377
00:16:02,519 --> 00:16:05,000
log out

378
00:16:05,399 --> 00:16:07,980
I don't want to say my password okay

379
00:16:07,980 --> 00:16:09,300
sign out

380
00:16:09,300 --> 00:16:12,240
and when I go back to this computer now

381
00:16:12,240 --> 00:16:13,980
I can say

382
00:16:13,980 --> 00:16:17,540
get a ad

383
00:16:17,540 --> 00:16:21,500
int okay can type

384
00:16:21,500 --> 00:16:25,519
PDA spy lock

385
00:16:25,620 --> 00:16:29,820
and provide decrypt Optical passwords

386
00:16:29,820 --> 00:16:31,920
and now it shows the password so hello

387
00:16:31,920 --> 00:16:34,019
devcamp here and it shows when it

388
00:16:34,019 --> 00:16:36,000
happens as well but anyways as I told

389
00:16:36,000 --> 00:16:38,160
you this is a bit like noisy it's easy

390
00:16:38,160 --> 00:16:41,279
to be get caught

391
00:16:41,279 --> 00:16:45,259
so let's um

392
00:16:45,660 --> 00:16:48,660
let's do the stealing the identity stuff

393
00:16:48,660 --> 00:16:50,220
now

394
00:16:50,220 --> 00:16:52,920
it's going to close this one

395
00:16:52,920 --> 00:16:54,480
and

396
00:16:54,480 --> 00:16:57,380
I have another

397
00:16:57,600 --> 00:17:00,899
session here it's red because that I

398
00:17:00,899 --> 00:17:02,459
recognize that because when I run this

399
00:17:02,459 --> 00:17:04,740
command to export or certificates this

400
00:17:04,740 --> 00:17:06,299
system gets elevated to local system

401
00:17:06,299 --> 00:17:08,339
which means that you can't use that to

402
00:17:08,339 --> 00:17:10,619
anything after that so I'm just going to

403
00:17:10,619 --> 00:17:13,939
say export in

404
00:17:13,939 --> 00:17:16,079
proxy AIDS and

405
00:17:16,079 --> 00:17:17,640
certificates

406
00:17:17,640 --> 00:17:19,859
and it's exporting everything

407
00:17:19,859 --> 00:17:21,660
and as we can see there's two different

408
00:17:21,660 --> 00:17:23,160
certificates

409
00:17:23,160 --> 00:17:25,319
and I happen to know that the one that

410
00:17:25,319 --> 00:17:29,640
starts with 308 is the correct one okay

411
00:17:29,640 --> 00:17:31,860
now what I'm going to do is that I'm

412
00:17:31,860 --> 00:17:35,280
going to shut down the agent also here

413
00:17:35,280 --> 00:17:38,460
like this and then I go to attacker

414
00:17:38,460 --> 00:17:41,039
machine where I have already copied that

415
00:17:41,039 --> 00:17:42,660
certificate

416
00:17:42,660 --> 00:17:45,299
and when we were researching this we

417
00:17:45,299 --> 00:17:47,220
actually implemented our own

418
00:17:47,220 --> 00:17:48,720
let's say

419
00:17:48,720 --> 00:17:51,840
proof of concept of agent

420
00:17:51,840 --> 00:17:54,240
and I'm going to show you how that works

421
00:17:54,240 --> 00:17:56,520
so I'm going to run PTA agent it's on

422
00:17:56,520 --> 00:17:58,440
very small sorry about that

423
00:17:58,440 --> 00:18:01,980
and I'm going to provide the certificate

424
00:18:01,980 --> 00:18:05,179
which we have

425
00:18:06,059 --> 00:18:09,600
which we have here it's the dev camp

426
00:18:09,600 --> 00:18:11,700
so it's that one and also I need to

427
00:18:11,700 --> 00:18:14,760
provide the name for the machine

428
00:18:14,760 --> 00:18:17,280
and I say okay hacked

429
00:18:17,280 --> 00:18:19,380
and let's see what happens

430
00:18:19,380 --> 00:18:22,860
it should work but we we don't know

431
00:18:22,860 --> 00:18:25,200
because that's a proof of concept so so

432
00:18:25,200 --> 00:18:27,480
it is so it was actually now connecting

433
00:18:27,480 --> 00:18:29,280
to those endpoints I was mentioning

434
00:18:29,280 --> 00:18:30,660
earlier so these are in the

435
00:18:30,660 --> 00:18:32,760
configuration file and now when you are

436
00:18:32,760 --> 00:18:35,220
looking at the bottom of the screen the

437
00:18:35,220 --> 00:18:37,799
name and the IP address should now

438
00:18:37,799 --> 00:18:39,600
change

439
00:18:39,600 --> 00:18:42,480
and why that happens is that we we

440
00:18:42,480 --> 00:18:44,940
discovered that that IP address is

441
00:18:44,940 --> 00:18:47,160
changed whenever the agent is getting

442
00:18:47,160 --> 00:18:49,320
the configuration

443
00:18:49,320 --> 00:18:51,059
and when it's getting the configuration

444
00:18:51,059 --> 00:18:53,220
it's also sending the machine name

445
00:18:53,220 --> 00:18:55,380
so it should like change here in okay

446
00:18:55,380 --> 00:18:57,840
now we can see so it's hacked and the IP

447
00:18:57,840 --> 00:18:59,820
address changed so you all get caught

448
00:18:59,820 --> 00:19:02,880
okay this obviously works so if I go

449
00:19:02,880 --> 00:19:05,580
here and try to sign in

450
00:19:05,580 --> 00:19:07,440
well hopefully it works

451
00:19:07,440 --> 00:19:10,320
I just type something here

452
00:19:10,320 --> 00:19:14,240
and we should see some traffic here

453
00:19:15,140 --> 00:19:18,059
let's see

454
00:19:18,059 --> 00:19:19,740
again because it's a proof of concept

455
00:19:19,740 --> 00:19:21,780
it's not that stable so it didn't work

456
00:19:21,780 --> 00:19:23,100
this time

457
00:19:23,100 --> 00:19:25,080
so we're just gonna

458
00:19:25,080 --> 00:19:27,860
start again

459
00:19:34,740 --> 00:19:37,820
and let's try again

460
00:19:44,640 --> 00:19:47,940
and it should show us the password it's

461
00:19:47,940 --> 00:19:50,280
a couple of seconds but again it depends

462
00:19:50,280 --> 00:19:52,080
so

463
00:19:52,080 --> 00:19:54,120
this is nice to have this you know live

464
00:19:54,120 --> 00:19:56,400
demos but I'm gonna do that one more

465
00:19:56,400 --> 00:20:00,260
time we have a time for that

466
00:20:01,860 --> 00:20:04,559
also so also the network connection

467
00:20:04,559 --> 00:20:08,299
might be one of the reasons but

468
00:20:08,880 --> 00:20:12,260
let's just try a

469
00:20:13,200 --> 00:20:15,600
but we said we see the yeah but there's

470
00:20:15,600 --> 00:20:18,179
like a no it doesn't want to work now

471
00:20:18,179 --> 00:20:19,919
let's see if it works after a couple of

472
00:20:19,919 --> 00:20:20,940
seconds

473
00:20:20,940 --> 00:20:23,100
or minutes maybe maybe not but anyway

474
00:20:23,100 --> 00:20:24,960
what's the point it was here that

475
00:20:24,960 --> 00:20:26,640
that

476
00:20:26,640 --> 00:20:28,860
you will get caught because the name and

477
00:20:28,860 --> 00:20:32,360
IP address changes right

478
00:20:32,580 --> 00:20:35,760
but we discovered that if you like

479
00:20:35,760 --> 00:20:38,280
provide the configuration to the agent

480
00:20:38,280 --> 00:20:40,320
so that it doesn't need to get that so

481
00:20:40,320 --> 00:20:41,880
it is connecting to directly those

482
00:20:41,880 --> 00:20:43,080
endpoints

483
00:20:43,080 --> 00:20:45,120
the IP address and the name doesn't

484
00:20:45,120 --> 00:20:47,160
change

485
00:20:47,160 --> 00:20:48,740
so

486
00:20:48,740 --> 00:20:53,100
so now I go back to

487
00:20:53,100 --> 00:20:54,480
the

488
00:20:54,480 --> 00:20:57,000
PTA server I'm going to start the agent

489
00:20:57,000 --> 00:20:59,039
so it will get the

490
00:20:59,039 --> 00:21:01,679
configuration and change the IP

491
00:21:01,679 --> 00:21:05,120
ax is original and I think

492
00:21:05,120 --> 00:21:09,480
I think it's done already so I can stop

493
00:21:09,480 --> 00:21:11,220
that

494
00:21:11,220 --> 00:21:13,980
so it should change back

495
00:21:13,980 --> 00:21:16,980
but now I'm going to run the same pth in

496
00:21:16,980 --> 00:21:18,539
here but now this time I'm going to

497
00:21:18,539 --> 00:21:22,280
provide the bootstrap

498
00:21:25,440 --> 00:21:27,240
and now you can see the name James back

499
00:21:27,240 --> 00:21:29,280
to original

500
00:21:29,280 --> 00:21:33,440
and now when I provide the bootstrap

501
00:21:33,780 --> 00:21:36,419
it is connecting there now but

502
00:21:36,419 --> 00:21:37,620
because it's not getting the

503
00:21:37,620 --> 00:21:39,360
configuration from the server those

504
00:21:39,360 --> 00:21:42,120
stays the same

505
00:21:42,120 --> 00:21:45,179
so let's try to log in now if if that

506
00:21:45,179 --> 00:21:48,500
helped anything

507
00:21:52,799 --> 00:21:54,240
because now I'm running this from the

508
00:21:54,240 --> 00:21:56,220
local computer and it's connected to

509
00:21:56,220 --> 00:21:59,580
internet via my phone so it might be not

510
00:21:59,580 --> 00:22:02,280
fast enough so that might be the reason

511
00:22:02,280 --> 00:22:05,400
that it you know doesn't allow us to log

512
00:22:05,400 --> 00:22:08,580
in but anyways as we can see that the

513
00:22:08,580 --> 00:22:10,140
name didn't change even though we

514
00:22:10,140 --> 00:22:13,260
connected there so this is a way that if

515
00:22:13,260 --> 00:22:16,919
you eyeball as an as an uh threat actor

516
00:22:16,919 --> 00:22:18,720
you're able to get that

517
00:22:18,720 --> 00:22:21,600
certificate it gives you like undetected

518
00:22:21,600 --> 00:22:24,059
access to the organization

519
00:22:24,059 --> 00:22:27,179
and also what I would like to you to see

520
00:22:27,179 --> 00:22:30,840
is that if I provide a parameter called

521
00:22:30,840 --> 00:22:36,240
failure and into any Windows like error

522
00:22:36,240 --> 00:22:38,940
code like here

523
00:22:38,940 --> 00:22:42,299
it will it will work as a denial of

524
00:22:42,299 --> 00:22:44,039
service attack because now you anybody

525
00:22:44,039 --> 00:22:46,020
can log in it says that your account is

526
00:22:46,020 --> 00:22:49,080
disabled so I'm just trying to run this

527
00:22:49,080 --> 00:22:51,600
one more time

528
00:22:51,600 --> 00:22:53,400
and if it doesn't work it doesn't work

529
00:22:53,400 --> 00:22:56,700
so but I can then demonstrate it later

530
00:22:56,700 --> 00:22:58,940
on

531
00:22:59,940 --> 00:23:03,679
so let's try once again

532
00:23:08,280 --> 00:23:10,679
no it doesn't want to do that but

533
00:23:10,679 --> 00:23:13,320
anyways what it what the agent is doing

534
00:23:13,320 --> 00:23:15,720
now here it would show the password of

535
00:23:15,720 --> 00:23:17,700
the user and then saying that you are

536
00:23:17,700 --> 00:23:20,159
your account is locked so you can log in

537
00:23:20,159 --> 00:23:22,200
to every user and you don't know what

538
00:23:22,200 --> 00:23:23,880
the hell is happening

539
00:23:23,880 --> 00:23:26,640
and and um

540
00:23:26,640 --> 00:23:28,620
what you can do actually is now you can

541
00:23:28,620 --> 00:23:30,240
go to see the signing logs that if

542
00:23:30,240 --> 00:23:32,220
there's a there is an agent ID that is

543
00:23:32,220 --> 00:23:34,320
like you know

544
00:23:34,320 --> 00:23:37,320
uh having like blocking other users or

545
00:23:37,320 --> 00:23:40,260
accessing every user and then you can do

546
00:23:40,260 --> 00:23:42,000
something about that but what you can do

547
00:23:42,000 --> 00:23:44,460
as an admin

548
00:23:44,460 --> 00:23:48,059
so now when I go back to the portal and

549
00:23:48,059 --> 00:23:50,159
I see that okay this particular agent

550
00:23:50,159 --> 00:23:53,340
here is now compromised

551
00:23:53,340 --> 00:23:56,580
so what can I do as an admin

552
00:23:56,580 --> 00:23:58,500
there's no delete button here that I

553
00:23:58,500 --> 00:24:00,360
want to you know delete this I8 and so

554
00:24:00,360 --> 00:24:02,400
you can't do anything well actually you

555
00:24:02,400 --> 00:24:03,360
can

556
00:24:03,360 --> 00:24:04,520
so

557
00:24:04,520 --> 00:24:07,080
when you don't use that agent for 10

558
00:24:07,080 --> 00:24:10,740
days so it's inactive it goes away

559
00:24:10,740 --> 00:24:12,419
automatically

560
00:24:12,419 --> 00:24:15,240
but so you can install your uninstall

561
00:24:15,240 --> 00:24:17,700
your server and wait for 10 days but

562
00:24:17,700 --> 00:24:19,980
that doesn't help why not

563
00:24:19,980 --> 00:24:22,860
because the threat actor is using your

564
00:24:22,860 --> 00:24:24,840
you know certificate

565
00:24:24,840 --> 00:24:28,740
so it it remains active until well

566
00:24:28,740 --> 00:24:32,159
forever well it may it remains active as

567
00:24:32,159 --> 00:24:34,559
long as the certificate is valid

568
00:24:34,559 --> 00:24:36,000
but guess what

569
00:24:36,000 --> 00:24:39,059
you can renew that certificate using the

570
00:24:39,059 --> 00:24:41,640
old old certificate and you can do that

571
00:24:41,640 --> 00:24:44,100
again and again and again

572
00:24:44,100 --> 00:24:45,620
so

573
00:24:45,620 --> 00:24:49,559
that means that now and it also this

574
00:24:49,559 --> 00:24:51,780
system allows that the one agent has

575
00:24:51,780 --> 00:24:54,299
more than one certificate so we tried

576
00:24:54,299 --> 00:24:57,600
and it was something like 10 118 can

577
00:24:57,600 --> 00:25:00,240
have 10 certificates but you can see it

578
00:25:00,240 --> 00:25:02,820
here you can only see that okay there

579
00:25:02,820 --> 00:25:05,100
are agents active but you don't know how

580
00:25:05,100 --> 00:25:08,220
many of those are are compromised or are

581
00:25:08,220 --> 00:25:10,200
they

582
00:25:10,200 --> 00:25:13,740
so for that purpose we in Secure works

583
00:25:13,740 --> 00:25:17,600
we actually created a tool

584
00:25:18,620 --> 00:25:22,320
that is called PTA agents and dump and

585
00:25:22,320 --> 00:25:23,940
we're gonna that's a free tool we're

586
00:25:23,940 --> 00:25:25,320
gonna publish it later this week

587
00:25:25,320 --> 00:25:26,940
hopefully

588
00:25:26,940 --> 00:25:30,299
which allows you uh to see that whether

589
00:25:30,299 --> 00:25:31,980
you are compromised or not

590
00:25:31,980 --> 00:25:34,140
so I'm going to show how that works

591
00:25:34,140 --> 00:25:36,360
so now I'm running this command on the

592
00:25:36,360 --> 00:25:39,120
PTA server which you can to do also just

593
00:25:39,120 --> 00:25:42,360
shut down the original agent

594
00:25:42,360 --> 00:25:44,460
then I'm going to run the tool here so

595
00:25:44,460 --> 00:25:46,500
PDA agent

596
00:25:46,500 --> 00:25:49,039
dump

597
00:25:50,419 --> 00:25:54,440
oh sorry wrong place

598
00:25:57,179 --> 00:25:59,100
and then I'm going to provide the

599
00:25:59,100 --> 00:26:00,299
certificate

600
00:26:00,299 --> 00:26:05,960
which is under demo and

601
00:26:08,880 --> 00:26:11,760
it's not that one it's this one and

602
00:26:11,760 --> 00:26:15,779
that's it and now it also connects to if

603
00:26:15,779 --> 00:26:18,720
we can see the connections here

604
00:26:18,720 --> 00:26:20,400
we can't

605
00:26:20,400 --> 00:26:22,320
that's nice

606
00:26:22,320 --> 00:26:24,900
let's try again

607
00:26:24,900 --> 00:26:26,520
okay now we can see that that is

608
00:26:26,520 --> 00:26:27,779
connecting

609
00:26:27,779 --> 00:26:31,440
and then you just need to sign in

610
00:26:31,440 --> 00:26:34,260
using any user or and also any password

611
00:26:34,260 --> 00:26:37,100
it doesn't matter

612
00:26:37,679 --> 00:26:39,000
okay well

613
00:26:39,000 --> 00:26:42,419
it already did that okay so what it does

614
00:26:42,419 --> 00:26:45,000
is that it actually if you remember the

615
00:26:45,000 --> 00:26:48,059
audience gets a request so it can see

616
00:26:48,059 --> 00:26:50,520
that all the agent and the certificate

617
00:26:50,520 --> 00:26:53,100
pairs so here we can see that it says

618
00:26:53,100 --> 00:26:55,500
that this particular agent has two

619
00:26:55,500 --> 00:26:57,240
active certifications so now we know

620
00:26:57,240 --> 00:26:59,880
that tractor has

621
00:26:59,880 --> 00:27:02,760
you know export your certificate and

622
00:27:02,760 --> 00:27:04,980
they have renewed that so somewhere

623
00:27:04,980 --> 00:27:07,200
there is a threat actor that is you know

624
00:27:07,200 --> 00:27:10,140
doing this stuff and you can see that

625
00:27:10,140 --> 00:27:12,059
anywhere

626
00:27:12,059 --> 00:27:13,860
we accept using our tool which allows

627
00:27:13,860 --> 00:27:15,659
you to list those at least

628
00:27:15,659 --> 00:27:18,960
but after that you know the agent ID you

629
00:27:18,960 --> 00:27:21,120
need to report to micro tap that hey

630
00:27:21,120 --> 00:27:23,159
remove this so they can do that but you

631
00:27:23,159 --> 00:27:25,880
can do it by yourself

632
00:27:26,400 --> 00:27:28,260
okay

633
00:27:28,260 --> 00:27:30,600
so I think that was all the demos I was

634
00:27:30,600 --> 00:27:33,240
gonna show you

635
00:27:33,240 --> 00:27:35,059
and

636
00:27:35,059 --> 00:27:38,220
takeaways from my talk

637
00:27:38,220 --> 00:27:40,620
so first one my personal opinion don't

638
00:27:40,620 --> 00:27:42,360
use PTA

639
00:27:42,360 --> 00:27:45,600
that's a piece of fine technology but

640
00:27:45,600 --> 00:27:48,900
two fine in currently because you can't

641
00:27:48,900 --> 00:27:51,840
you can't detect that and you can't you

642
00:27:51,840 --> 00:27:53,820
know do any medications

643
00:27:53,820 --> 00:27:57,059
except for you know connecting Microsoft

644
00:27:57,059 --> 00:28:00,480
and to protect yourself against these

645
00:28:00,480 --> 00:28:02,159
kind of attacks is the first thing is

646
00:28:02,159 --> 00:28:03,960
that you need to create any of those

647
00:28:03,960 --> 00:28:05,700
servers that are involved in hybrid

648
00:28:05,700 --> 00:28:08,520
identity as a tr0 servers which means

649
00:28:08,520 --> 00:28:10,140
that you need to protect them as well as

650
00:28:10,140 --> 00:28:12,419
you protect your domain controllers and

651
00:28:12,419 --> 00:28:14,460
that's the first step so this wouldn't

652
00:28:14,460 --> 00:28:15,779
happen at all

653
00:28:15,779 --> 00:28:18,240
and then you can use MFA

654
00:28:18,240 --> 00:28:21,059
which prevents using PTA as a backdoor

655
00:28:21,059 --> 00:28:23,159
because that doesn't you know allow you

656
00:28:23,159 --> 00:28:25,200
to bypass back door it only accepts all

657
00:28:25,200 --> 00:28:27,539
the passwords and as we probably know

658
00:28:27,539 --> 00:28:31,159
MFA is post on vacation like protection

659
00:28:31,159 --> 00:28:34,860
mechanism so if you are using PTA you

660
00:28:34,860 --> 00:28:38,460
are blocking that using as a backdoor

661
00:28:38,460 --> 00:28:41,159
but you can still Harvest credentials as

662
00:28:41,159 --> 00:28:42,840
a direct actor you can't log in but you

663
00:28:42,840 --> 00:28:44,820
can Harvest credentials and maybe use

664
00:28:44,820 --> 00:28:47,220
them in other services

665
00:28:47,220 --> 00:28:49,679
and then you should monitor those items

666
00:28:49,679 --> 00:28:52,919
in a regular bases like are the other IP

667
00:28:52,919 --> 00:28:54,720
addresses changing and you can do that

668
00:28:54,720 --> 00:28:56,760
with A8 internals or by calling

669
00:28:56,760 --> 00:28:59,220
Microsoft apis and you should monitor

670
00:28:59,220 --> 00:29:01,679
those certificates using the ptas and

671
00:29:01,679 --> 00:29:02,580
dump

672
00:29:02,580 --> 00:29:05,340
when we publish that obviously and then

673
00:29:05,340 --> 00:29:07,860
to follow any such business activity in

674
00:29:07,860 --> 00:29:10,020
signing logs

675
00:29:10,020 --> 00:29:12,299
and finally if you see that there's

676
00:29:12,299 --> 00:29:13,559
something

677
00:29:13,559 --> 00:29:15,960
suspices going on with some PDA agent

678
00:29:15,960 --> 00:29:17,880
you need to contact Microsoft to remove

679
00:29:17,880 --> 00:29:20,240
that

680
00:29:20,520 --> 00:29:23,460
and with that and 22nd

681
00:29:23,460 --> 00:29:27,100
left in my schedule thank you

682
00:29:27,100 --> 00:29:30,619
[Applause]

683
00:29:35,220 --> 00:29:37,559
thank you so much

684
00:29:37,559 --> 00:29:39,600
um technically we can take some

685
00:29:39,600 --> 00:29:41,460
questions but we're gonna eat out of

686
00:29:41,460 --> 00:29:43,080
your break so if you want to ask

687
00:29:43,080 --> 00:29:45,059
questions just

688
00:29:45,059 --> 00:29:46,340
you know

689
00:29:46,340 --> 00:29:48,419
choose between that and go into the

690
00:29:48,419 --> 00:29:49,620
bathroom so we can take one or two

691
00:29:49,620 --> 00:29:52,580
questions here

692
00:29:53,580 --> 00:29:55,919
hello uh thanks thanks for the

693
00:29:55,919 --> 00:29:59,279
presentation uh I have a question

694
00:29:59,279 --> 00:30:02,399
um there was a recently an attack well

695
00:30:02,399 --> 00:30:04,500
it's not necessarily recently but

696
00:30:04,500 --> 00:30:07,200
um a Microsoft researcher who presented

697
00:30:07,200 --> 00:30:10,919
a Nico X relay attack Nico X being the

698
00:30:10,919 --> 00:30:14,340
protocol that Azure ad uses that is

699
00:30:14,340 --> 00:30:17,100
similar to to Kerberos or it's based on

700
00:30:17,100 --> 00:30:21,059
the same API uh and it's active on any

701
00:30:21,059 --> 00:30:24,539
any machine that's joined to an Azure to

702
00:30:24,539 --> 00:30:28,320
Azure ID and he demonstrated an attack

703
00:30:28,320 --> 00:30:31,200
that's similar to ntlm relay but but

704
00:30:31,200 --> 00:30:36,120
done on on this new protocol Nico X do

705
00:30:36,120 --> 00:30:38,279
you know if that still is that related

706
00:30:38,279 --> 00:30:41,580
to this does that still work if PTA is

707
00:30:41,580 --> 00:30:44,220
disabled or does does PTA need to be

708
00:30:44,220 --> 00:30:46,320
enabled for that attack to work I have

709
00:30:46,320 --> 00:30:47,820
to say that that doesn't ring a bell so

710
00:30:47,820 --> 00:30:49,679
I think that it's not related to PDA

711
00:30:49,679 --> 00:30:53,399
assets yes okay but we can discuss about

712
00:30:53,399 --> 00:30:56,159
that offline okay sure thank you thank

713
00:30:56,159 --> 00:30:58,279
you

714
00:31:00,059 --> 00:31:02,159
are there any more questions we can take

715
00:31:02,159 --> 00:31:05,240
maybe another question

716
00:31:07,260 --> 00:31:09,360
if not then thank you so much for your

717
00:31:09,360 --> 00:31:12,179
presentation and uh in about two minutes

718
00:31:12,179 --> 00:31:15,500
we'll start the next one

719
00:31:15,730 --> 00:31:18,809
[Applause]

