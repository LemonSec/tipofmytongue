1
00:00:00,000 --> 00:00:02,639
thank you hello everyone

2
00:00:02,639 --> 00:00:06,779
so who here has heard of ebpf

3
00:00:06,779 --> 00:00:10,740
quite a lot of hands excellent

4
00:00:10,740 --> 00:00:13,860
so evpf is a Hot Topic in Cloud native

5
00:00:13,860 --> 00:00:16,199
for very good reason it's a wonderful

6
00:00:16,199 --> 00:00:18,300
platform for building Network

7
00:00:18,300 --> 00:00:22,199
observability and security tooling

8
00:00:22,199 --> 00:00:25,199
ebpf lets us detect and react to events

9
00:00:25,199 --> 00:00:27,599
from within the kernel whether those

10
00:00:27,599 --> 00:00:29,580
events are triggered by something

11
00:00:29,580 --> 00:00:32,520
happening in user space or events that

12
00:00:32,520 --> 00:00:34,320
happen in the kernel like a network

13
00:00:34,320 --> 00:00:36,719
packet reaching some point in a network

14
00:00:36,719 --> 00:00:38,520
stack

15
00:00:38,520 --> 00:00:40,680
and the beauty of this in Cloud native

16
00:00:40,680 --> 00:00:43,620
is that because ebpf programs run in the

17
00:00:43,620 --> 00:00:46,320
kernel we only have to instrument nodes

18
00:00:46,320 --> 00:00:48,300
rather than instrumenting each

19
00:00:48,300 --> 00:00:50,940
individual workload all of the

20
00:00:50,940 --> 00:00:52,980
applications that run on a virtual

21
00:00:52,980 --> 00:00:56,879
machine share one same kernel and a

22
00:00:56,879 --> 00:00:58,739
process whether it's running inside a

23
00:00:58,739 --> 00:01:01,320
container in a pod or even directly on

24
00:01:01,320 --> 00:01:05,159
the host is using that same kernel and

25
00:01:05,159 --> 00:01:06,680
whenever it wants to do anything

26
00:01:06,680 --> 00:01:09,420
interesting and potentially security

27
00:01:09,420 --> 00:01:12,360
relevant it's going to have to ask for

28
00:01:12,360 --> 00:01:15,119
assistance from the kernel

29
00:01:15,119 --> 00:01:17,880
so if we have eppf programs in the

30
00:01:17,880 --> 00:01:20,640
kernel we can detect and even affect

31
00:01:20,640 --> 00:01:24,119
what's happening in any user space

32
00:01:24,119 --> 00:01:26,880
application or process

33
00:01:26,880 --> 00:01:28,920
and if an attacker manages to run

34
00:01:28,920 --> 00:01:31,560
malicious code on your machine ebpf

35
00:01:31,560 --> 00:01:34,020
tooling will be just as aware of it as

36
00:01:34,020 --> 00:01:36,920
any other process

37
00:01:37,500 --> 00:01:39,840
there are several projects in the cncf

38
00:01:39,840 --> 00:01:42,180
today and sub-projects that leverage

39
00:01:42,180 --> 00:01:45,299
ebpf for connectivity and observability

40
00:01:45,299 --> 00:01:47,880
and security you just heard about Falco

41
00:01:47,880 --> 00:01:49,500
for example

42
00:01:49,500 --> 00:01:51,600
and today I want to talk about the power

43
00:01:51,600 --> 00:01:54,479
of taking the events that these kinds of

44
00:01:54,479 --> 00:01:57,860
tools generate and using them to create

45
00:01:57,860 --> 00:02:00,659
visualizations that can help us solve

46
00:02:00,659 --> 00:02:03,899
security specific problems

47
00:02:03,899 --> 00:02:06,899
so let's leave Seattle and go and visit

48
00:02:06,899 --> 00:02:08,520
an organization that's actually been

49
00:02:08,520 --> 00:02:10,318
using Cloud native tooling for a very

50
00:02:10,318 --> 00:02:11,879
long time

51
00:02:11,879 --> 00:02:15,480
the Empire is a huge user of Open Source

52
00:02:15,480 --> 00:02:16,940
software

53
00:02:16,940 --> 00:02:22,760
adopted kubernetes a long long time ago

54
00:02:22,819 --> 00:02:25,020
and if we look at what's currently

55
00:02:25,020 --> 00:02:27,780
running around Endor we can see there

56
00:02:27,780 --> 00:02:29,540
are a few Tie fighters Milling about

57
00:02:29,540 --> 00:02:32,340
there are a couple of instances of well

58
00:02:32,340 --> 00:02:33,599
we run the debtstart with high

59
00:02:33,599 --> 00:02:36,738
availability obviously

60
00:02:36,840 --> 00:02:38,940
the Empire uses psyllium for network

61
00:02:38,940 --> 00:02:41,400
connectivity so we can look at the

62
00:02:41,400 --> 00:02:43,920
network flow logs that are generated by

63
00:02:43,920 --> 00:02:46,140
psyllium's Hubble component and we can

64
00:02:46,140 --> 00:02:48,360
see all the traffic that's flowing

65
00:02:48,360 --> 00:02:51,900
in the spacecraft around Endor

66
00:02:51,900 --> 00:02:53,819
the information that goes into these

67
00:02:53,819 --> 00:02:56,400
Hubble logs is collected by psyllium's

68
00:02:56,400 --> 00:02:59,220
ebpf programs that are inserted into

69
00:02:59,220 --> 00:03:01,920
various points in the network stack

70
00:03:01,920 --> 00:03:04,019
and because psyllium is aware of

71
00:03:04,019 --> 00:03:07,080
kubernetes identities the network logs

72
00:03:07,080 --> 00:03:09,120
don't show us IP addresses they show us

73
00:03:09,120 --> 00:03:11,040
which pods are involved in each Network

74
00:03:11,040 --> 00:03:13,860
flow and we can also see details of

75
00:03:13,860 --> 00:03:16,260
what's happening at layer 7.

76
00:03:16,260 --> 00:03:18,599
so this is giving us lots of really

77
00:03:18,599 --> 00:03:20,640
great information and lots of really

78
00:03:20,640 --> 00:03:23,640
useful details but

79
00:03:23,640 --> 00:03:26,340
the Stormtrooper who's in charge of

80
00:03:26,340 --> 00:03:29,760
security on the Death Star knows that it

81
00:03:29,760 --> 00:03:31,440
would be a lot easier to understand

82
00:03:31,440 --> 00:03:33,599
what's happening and which spacecraft

83
00:03:33,599 --> 00:03:35,819
are communicating with each other if

84
00:03:35,819 --> 00:03:38,159
that was presented in some kind of

85
00:03:38,159 --> 00:03:41,720
visual pictorial form

86
00:03:41,720 --> 00:03:44,700
here's the psyllium Hubble UI which

87
00:03:44,700 --> 00:03:46,920
takes all those individual Network flow

88
00:03:46,920 --> 00:03:49,860
logs and builds up a picture of which

89
00:03:49,860 --> 00:03:52,500
services are communicating in the end or

90
00:03:52,500 --> 00:03:53,580
namespace

91
00:03:53,580 --> 00:03:56,040
everything seems okay we can see some

92
00:03:56,040 --> 00:03:57,900
Tie fighters are talking to the Death

93
00:03:57,900 --> 00:04:00,480
Star talking to the Star Wars API

94
00:04:00,480 --> 00:04:03,360
totally makes sense and also to Disney

95
00:04:03,360 --> 00:04:05,519
because I think they're negotiating

96
00:04:05,519 --> 00:04:08,220
contracts on some kind of reality TV

97
00:04:08,220 --> 00:04:09,720
series that they're going to film on the

98
00:04:09,720 --> 00:04:11,580
Death Star

99
00:04:11,580 --> 00:04:14,400
and on our security Stormtrooper wants

100
00:04:14,400 --> 00:04:17,339
to put some Network policy in place he

101
00:04:17,339 --> 00:04:19,620
wants to know that only Empire traffic

102
00:04:19,620 --> 00:04:21,839
is going to be able to flow in this

103
00:04:21,839 --> 00:04:23,040
namespace

104
00:04:23,040 --> 00:04:25,080
but Network policy can be a bit fiddly

105
00:04:25,080 --> 00:04:26,940
and he doesn't want to get it wrong he

106
00:04:26,940 --> 00:04:29,639
doesn't want to upset the generals

107
00:04:29,639 --> 00:04:32,699
but this Stormtrooper knows that Hubble

108
00:04:32,699 --> 00:04:35,040
doesn't just generate Network flows it

109
00:04:35,040 --> 00:04:38,520
also generates Prometheus metrics and in

110
00:04:38,520 --> 00:04:40,199
particular he's interested in the

111
00:04:40,199 --> 00:04:41,940
Prometheus metrics that are generated

112
00:04:41,940 --> 00:04:45,360
about Network policy verdicts so

113
00:04:45,360 --> 00:04:47,759
whenever a policy decision is made

114
00:04:47,759 --> 00:04:50,280
whether to drop or forward or redirect a

115
00:04:50,280 --> 00:04:53,580
packet that generates metrics so our

116
00:04:53,580 --> 00:04:56,759
Stormtrooper has set up a grafana

117
00:04:56,759 --> 00:04:58,500
security dashboard

118
00:04:58,500 --> 00:05:00,300
and right now there's nothing on it

119
00:05:00,300 --> 00:05:02,340
because we don't have any policies in

120
00:05:02,340 --> 00:05:04,680
place yet so there are no policy

121
00:05:04,680 --> 00:05:07,080
verdicts to show

122
00:05:07,080 --> 00:05:09,479
but let's start by putting in place and

123
00:05:09,479 --> 00:05:11,940
allow all policy so that every single

124
00:05:11,940 --> 00:05:15,300
packet will generate a policy event

125
00:05:15,300 --> 00:05:17,580
so the allow all policy is going to

126
00:05:17,580 --> 00:05:20,340
apply to all the spacecraft in Endor and

127
00:05:20,340 --> 00:05:22,020
it's going to allow those craft to

128
00:05:22,020 --> 00:05:23,880
receive packets that's Ingress traffic

129
00:05:23,880 --> 00:05:26,400
from anywhere and it's going to allow

130
00:05:26,400 --> 00:05:29,340
sending packets that's egress traffic to

131
00:05:29,340 --> 00:05:31,740
anywhere

132
00:05:31,740 --> 00:05:33,780
and when we put that policy in place

133
00:05:33,780 --> 00:05:35,940
once things have settled down we'll see

134
00:05:35,940 --> 00:05:38,820
a pretty steady state of we'll just look

135
00:05:38,820 --> 00:05:40,860
at Ingress traffic for now that's being

136
00:05:40,860 --> 00:05:42,960
generated by the Thai fighters around

137
00:05:42,960 --> 00:05:44,100
Endor

138
00:05:44,100 --> 00:05:46,500
all of that traffic is matching on

139
00:05:46,500 --> 00:05:48,900
policy type so on the left hand side we

140
00:05:48,900 --> 00:05:50,220
can see all the packets are being

141
00:05:50,220 --> 00:05:52,919
forwarded and on the right hand side we

142
00:05:52,919 --> 00:05:55,199
can see they're all matching an all

143
00:05:55,199 --> 00:05:57,979
policy type

144
00:05:58,380 --> 00:06:00,840
so now our security stormtroop is going

145
00:06:00,840 --> 00:06:03,360
to start with the Ingress traffic and

146
00:06:03,360 --> 00:06:05,460
introduce a policy that's going to make

147
00:06:05,460 --> 00:06:07,620
sure that traffic can only flow to the

148
00:06:07,620 --> 00:06:09,479
Death Star if it comes from Empire

149
00:06:09,479 --> 00:06:11,100
spacecraft

150
00:06:11,100 --> 00:06:14,100
and when he applies that policy we can

151
00:06:14,100 --> 00:06:16,800
see traffic continues to be successfully

152
00:06:16,800 --> 00:06:18,660
forwarded so the left-hand side stays

153
00:06:18,660 --> 00:06:20,880
the same but on the right hand side we

154
00:06:20,880 --> 00:06:22,979
can see that the traffic is now being

155
00:06:22,979 --> 00:06:25,740
matched by a layer 3 specific policy

156
00:06:25,740 --> 00:06:29,460
rather than that allow all policy

157
00:06:29,460 --> 00:06:32,759
and if we remove the Ingress rules from

158
00:06:32,759 --> 00:06:34,740
that allowable policy

159
00:06:34,740 --> 00:06:36,660
everything is going to basically stay

160
00:06:36,660 --> 00:06:38,460
the same because all our expected

161
00:06:38,460 --> 00:06:42,060
traffic is matching that end or specific

162
00:06:42,060 --> 00:06:45,740
policy so that's great

163
00:06:46,740 --> 00:06:49,919
but we're hearing a rumor that there are

164
00:06:49,919 --> 00:06:52,380
some Empire State spacecraft in another

165
00:06:52,380 --> 00:06:55,199
star system and they're trying to send

166
00:06:55,199 --> 00:06:58,400
us some messages from Hoth

167
00:06:58,400 --> 00:07:00,660
and if we check the security dashboard

168
00:07:00,660 --> 00:07:02,520
we can see that those packets are being

169
00:07:02,520 --> 00:07:04,919
dropped this is a problem because some

170
00:07:04,919 --> 00:07:07,740
of this traffic from Hoth is coming from

171
00:07:07,740 --> 00:07:10,620
an Empire star destroyer and we're going

172
00:07:10,620 --> 00:07:12,419
to be in big trouble if that traffic

173
00:07:12,419 --> 00:07:13,979
doesn't get through

174
00:07:13,979 --> 00:07:17,220
so our security Stormtrooper adjusts the

175
00:07:17,220 --> 00:07:20,880
policy and allows traffic to come from

176
00:07:20,880 --> 00:07:23,759
anywhere provided it comes from an

177
00:07:23,759 --> 00:07:25,380
Empire spacecraft something that's

178
00:07:25,380 --> 00:07:30,319
labeled with the organization of Empire

179
00:07:31,020 --> 00:07:33,360
and things improve we see fewer packets

180
00:07:33,360 --> 00:07:36,840
being dropped and we can see that the

181
00:07:36,840 --> 00:07:39,419
Star Destroyer traffic is being

182
00:07:39,419 --> 00:07:41,699
forwarded correctly but we're still

183
00:07:41,699 --> 00:07:44,400
blocking traffic from some X-Wing

184
00:07:44,400 --> 00:07:45,960
Fighters that are being flown by the

185
00:07:45,960 --> 00:07:48,960
Rebel Alliance and also from some

186
00:07:48,960 --> 00:07:50,819
known as the Millennium Falcon whatever

187
00:07:50,819 --> 00:07:53,300
that is

188
00:07:53,639 --> 00:07:55,560
so this all seems good

189
00:07:55,560 --> 00:07:58,440
but we have heard another rumor that

190
00:07:58,440 --> 00:08:01,919
there's a spy there's some kind of rebel

191
00:08:01,919 --> 00:08:04,919
Android thing that stowed away and is

192
00:08:04,919 --> 00:08:07,560
trying to exfiltrate the plans to the

193
00:08:07,560 --> 00:08:09,660
Death Star

194
00:08:09,660 --> 00:08:12,660
fortunately our Stormtrooper team are

195
00:08:12,660 --> 00:08:15,060
running with psyllium's tetragon runtime

196
00:08:15,060 --> 00:08:18,360
detection tool and the tetragon logs are

197
00:08:18,360 --> 00:08:20,220
also hooked up into the security

198
00:08:20,220 --> 00:08:22,440
dashboard

199
00:08:22,440 --> 00:08:24,599
and if we check out the executables pane

200
00:08:24,599 --> 00:08:26,879
of the security dashboard we can see

201
00:08:26,879 --> 00:08:29,879
some highly suspicious activity right

202
00:08:29,879 --> 00:08:31,979
there at the top highlighted in red we

203
00:08:31,979 --> 00:08:34,020
can see that somebody is running netcat

204
00:08:34,020 --> 00:08:37,080
this is not expected but we can see

205
00:08:37,080 --> 00:08:39,479
exactly which pod did it when it

206
00:08:39,479 --> 00:08:41,580
happened so we're going to be easily

207
00:08:41,580 --> 00:08:43,380
able to root out the spy and throw them

208
00:08:43,380 --> 00:08:46,580
into the trash compactor

209
00:08:46,740 --> 00:08:50,640
so I've shown here some dashboards set

210
00:08:50,640 --> 00:08:52,740
up in grafana that the Empire security

211
00:08:52,740 --> 00:08:56,220
team have built using logs coming from

212
00:08:56,220 --> 00:08:59,160
psyllium and Hubble and tetragon and

213
00:08:59,160 --> 00:09:02,100
Prometheus metrics coming from Hubble

214
00:09:02,100 --> 00:09:05,000
and psyllium

215
00:09:08,700 --> 00:09:11,040
is that you can use to solve other kinds

216
00:09:11,040 --> 00:09:13,620
of security problems with Cloud native

217
00:09:13,620 --> 00:09:15,120
tooling

218
00:09:15,120 --> 00:09:17,339
here are a few other examples that I've

219
00:09:17,339 --> 00:09:19,260
found

220
00:09:19,260 --> 00:09:22,140
so here's a visualization of detecting

221
00:09:22,140 --> 00:09:24,959
SQL injections using pixie it's another

222
00:09:24,959 --> 00:09:29,399
ebpf based project in the cncf

223
00:09:29,399 --> 00:09:31,860
you just heard about Falco here's a pie

224
00:09:31,860 --> 00:09:36,120
chart showing Falco rule violations

225
00:09:36,120 --> 00:09:38,100
here's a more complex dashboard that's

226
00:09:38,100 --> 00:09:40,080
been built on tetragon showing

227
00:09:40,080 --> 00:09:42,420
information about access to sensitive

228
00:09:42,420 --> 00:09:43,800
files

229
00:09:43,800 --> 00:09:46,620
and all of these tools are able to pull

230
00:09:46,620 --> 00:09:49,860
this really detailed information and tie

231
00:09:49,860 --> 00:09:52,620
it back to kubernetes identities thanks

232
00:09:52,620 --> 00:09:55,980
to the power of ebpf and the ability to

233
00:09:55,980 --> 00:09:58,440
write tooling that's both very finely

234
00:09:58,440 --> 00:10:02,160
grained and highly performant

235
00:10:02,160 --> 00:10:05,519
so ebpf tools can generate these streams

236
00:10:05,519 --> 00:10:08,760
of really rich contextualized events in

237
00:10:08,760 --> 00:10:11,880
the form of logs and metrics and traces

238
00:10:11,880 --> 00:10:14,580
and as humans we can make much more

239
00:10:14,580 --> 00:10:17,040
sense of that data if we can visualize

240
00:10:17,040 --> 00:10:19,980
it and then we can use it to debug

241
00:10:19,980 --> 00:10:22,320
Network policy like you store our

242
00:10:22,320 --> 00:10:24,779
Stormtrooper security team doing we can

243
00:10:24,779 --> 00:10:27,660
use it to spot unexpected access to

244
00:10:27,660 --> 00:10:30,180
particularly sensitive files we can use

245
00:10:30,180 --> 00:10:33,480
it to spot data being exfiltrated we can

246
00:10:33,480 --> 00:10:36,180
use it to see unexpected binaries being

247
00:10:36,180 --> 00:10:39,660
run anywhere in our cluster

248
00:10:39,660 --> 00:10:41,880
can even identify privilege escalations

249
00:10:41,880 --> 00:10:44,760
using ebpf

250
00:10:44,760 --> 00:10:47,640
all of these things can help us solve

251
00:10:47,640 --> 00:10:51,380
real security problems

252
00:10:52,140 --> 00:10:54,959
and Darth Vader is so impressed he's

253
00:10:54,959 --> 00:10:56,220
actually thinking of having the Empire

254
00:10:56,220 --> 00:10:58,140
join the cncf as an end user

255
00:10:58,140 --> 00:11:00,740
organization

256
00:11:02,459 --> 00:11:04,100
thank you very much

257
00:11:04,100 --> 00:11:08,690
[Applause]

