1
00:00:03,560 --> 00:00:09,240
[Applause]

2
00:00:06,270 --> 00:00:13,090
[Music]

3
00:00:09,240 --> 00:00:15,400
so thanks everyone and thanks for the

4
00:00:13,090 --> 00:00:17,619
world pretty nice introduction I could

5
00:00:15,400 --> 00:00:19,750
say it was very creative and excellent

6
00:00:17,619 --> 00:00:22,390
but it was pretty dry just the way I

7
00:00:19,750 --> 00:00:25,570
like it so that's fine so we're going to

8
00:00:22,390 --> 00:00:28,119
talk a bit more about caldera first of

9
00:00:25,570 --> 00:00:29,770
all I'd like to thank all of you because

10
00:00:28,119 --> 00:00:31,420
this is a pretty late session well

11
00:00:29,770 --> 00:00:34,000
actually the latest one or the last one

12
00:00:31,420 --> 00:00:35,559
of today I was a bit afraid that no one

13
00:00:34,000 --> 00:00:37,300
would be here but at least some of you

14
00:00:35,559 --> 00:00:41,709
showed up so I'll take that as a win

15
00:00:37,300 --> 00:00:44,428
already which is good as super

16
00:00:41,710 --> 00:00:46,780
interaction here already so going great

17
00:00:44,429 --> 00:00:49,539
so maybe a bit more about what we're

18
00:00:46,780 --> 00:00:52,389
going to talk about first one slide

19
00:00:49,539 --> 00:00:54,609
about me just to what do I do and I'm

20
00:00:52,389 --> 00:00:56,319
that guy I look different a bit maybe

21
00:00:54,609 --> 00:00:59,350
now because I have a flamingo my shirt

22
00:00:56,319 --> 00:01:01,510
which is apparently odd topic I work at

23
00:00:59,350 --> 00:01:03,760
visa which is a European cybersecurity

24
00:01:01,510 --> 00:01:05,649
firm so we do the typical consulting

25
00:01:03,760 --> 00:01:07,780
stuff pen testing forensics you name it

26
00:01:05,650 --> 00:01:09,790
that's the kind of stuff we do I also

27
00:01:07,780 --> 00:01:11,020
teach courses force and so I do a couple

28
00:01:09,790 --> 00:01:14,170
of those things there as well

29
00:01:11,020 --> 00:01:16,509
my main background is debating between

30
00:01:14,170 --> 00:01:18,450
so I used to be pen testing all the time

31
00:01:16,510 --> 00:01:22,840
that was when I first started working

32
00:01:18,450 --> 00:01:24,820
it's my golden years when 2008 about

33
00:01:22,840 --> 00:01:26,770
2012 the only thing I really did was

34
00:01:24,820 --> 00:01:29,139
penetration testing and a bit of red

35
00:01:26,770 --> 00:01:31,570
teaming that kind of stuff those were

36
00:01:29,140 --> 00:01:33,850
the days when I used Metasploit all over

37
00:01:31,570 --> 00:01:35,649
the place and I thought I was being 127

38
00:01:33,850 --> 00:01:39,039
so I go no one's no one sees what I'm

39
00:01:35,650 --> 00:01:41,230
doing so I'm good but funny thing was

40
00:01:39,040 --> 00:01:43,030
that I wasn't that good most people are

41
00:01:41,230 --> 00:01:45,000
just not paying attention which is one

42
00:01:43,030 --> 00:01:47,230
of the things we'll talk about today

43
00:01:45,000 --> 00:01:49,210
looking at how we can do this better and

44
00:01:47,230 --> 00:01:53,530
how we can make blue team's detect more

45
00:01:49,210 --> 00:01:55,899
that's a bit the ID so you have to start

46
00:01:53,530 --> 00:01:58,000
with a joke just kidding no no one ever

47
00:01:55,900 --> 00:02:00,070
said that but I I introduced it there we

48
00:01:58,000 --> 00:02:02,490
go why are assembly developers usually

49
00:02:00,070 --> 00:02:02,490
wet

50
00:02:03,760 --> 00:02:08,289
because they work below sea level

51
00:02:08,949 --> 00:02:17,780
amazing so topics for today first of all

52
00:02:15,980 --> 00:02:18,799
what is adversary emulation just talking

53
00:02:17,780 --> 00:02:21,290
about more about what we're trying to

54
00:02:18,800 --> 00:02:23,810
achieve here what are we doing and how

55
00:02:21,290 --> 00:02:26,179
does it compare to other activities then

56
00:02:23,810 --> 00:02:27,710
we look into some tools of the trade so

57
00:02:26,180 --> 00:02:30,380
we'll talk about typical tools that are

58
00:02:27,710 --> 00:02:32,720
available to do adversary emulation how

59
00:02:30,380 --> 00:02:35,180
do you work my experiences with them how

60
00:02:32,720 --> 00:02:36,680
I've liked them or not like them and how

61
00:02:35,180 --> 00:02:38,360
you can use them to your benefit of

62
00:02:36,680 --> 00:02:40,550
course it does depend on what you're

63
00:02:38,360 --> 00:02:42,709
looking for not every two is suited for

64
00:02:40,550 --> 00:02:44,660
a specific objective all depends on what

65
00:02:42,709 --> 00:02:46,040
you're trying to achieve then we're

66
00:02:44,660 --> 00:02:48,049
going to discuss called a of course

67
00:02:46,040 --> 00:02:49,820
which is the big one and we'll do a

68
00:02:48,050 --> 00:02:52,730
quite some demos on my count there are

69
00:02:49,820 --> 00:02:54,440
plugins using it using in different ways

70
00:02:52,730 --> 00:02:56,540
seeing how we can customize it at

71
00:02:54,440 --> 00:02:59,209
additional functionality which is rather

72
00:02:56,540 --> 00:03:00,739
impressive the goal of course is to get

73
00:02:59,209 --> 00:03:01,610
you all thinking about hey maybe we can

74
00:03:00,740 --> 00:03:04,130
use this too

75
00:03:01,610 --> 00:03:05,690
and actively start developing modules as

76
00:03:04,130 --> 00:03:07,790
well because it's not that hard that

77
00:03:05,690 --> 00:03:11,239
currently which is nice who's ever heard

78
00:03:07,790 --> 00:03:14,090
of or used it few of you and maybe off

79
00:03:11,239 --> 00:03:15,920
of you interesting nice so we'll talk a

80
00:03:14,090 --> 00:03:19,130
bit more about how does it work last

81
00:03:15,920 --> 00:03:21,260
year they think of around April or May

82
00:03:19,130 --> 00:03:22,609
they released a new version since then

83
00:03:21,260 --> 00:03:24,709
it's been a bit unstable

84
00:03:22,610 --> 00:03:26,420
now unstable is a big word but they've

85
00:03:24,709 --> 00:03:28,310
just been developing like well like not

86
00:03:26,420 --> 00:03:29,839
so it's going very quickly but there's a

87
00:03:28,310 --> 00:03:32,180
lot of things you can do and you can add

88
00:03:29,840 --> 00:03:34,519
to it which is very nice you can really

89
00:03:32,180 --> 00:03:35,959
call it a bad tool because it it's only

90
00:03:34,519 --> 00:03:38,989
as good as how you use it that's

91
00:03:35,959 --> 00:03:40,940
basically the idea which is nice so

92
00:03:38,989 --> 00:03:43,250
first what is adversary emulation what

93
00:03:40,940 --> 00:03:44,450
are we trying to achieve here I think

94
00:03:43,250 --> 00:03:46,040
it's important to make a distinction

95
00:03:44,450 --> 00:03:47,420
here of course on the left hand side

96
00:03:46,040 --> 00:03:50,600
you've got your typical vulnerability

97
00:03:47,420 --> 00:03:53,268
scanners everything pentesting this is

98
00:03:50,600 --> 00:03:55,609
not necessarily penetration adversary

99
00:03:53,269 --> 00:03:57,019
emulation it's something I see quite

100
00:03:55,610 --> 00:03:59,330
frequently as a consultant you can

101
00:03:57,019 --> 00:04:01,100
already imagine adversary emulation the

102
00:03:59,330 --> 00:04:03,650
first step is we're gonna launch a neces

103
00:04:01,100 --> 00:04:06,530
can of course which isn't a bad idea

104
00:04:03,650 --> 00:04:08,420
right I I don't - why not or next pose

105
00:04:06,530 --> 00:04:10,940
pose whatever you want to do but that's

106
00:04:08,420 --> 00:04:13,399
vulnerability scanning as far as I know

107
00:04:10,940 --> 00:04:16,230
I haven't seen a lot of apts or actual

108
00:04:13,400 --> 00:04:17,850
adversaries use message in there

109
00:04:16,230 --> 00:04:21,090
way of doing things it's kind of like

110
00:04:17,850 --> 00:04:23,400
the machine gun right pretty obvious on

111
00:04:21,089 --> 00:04:25,710
the other hand you've got open testing

112
00:04:23,400 --> 00:04:27,510
right I do a penetration test so I do

113
00:04:25,710 --> 00:04:28,799
necess but then I do metal spirit right

114
00:04:27,510 --> 00:04:30,240
that's the idea so I find it from the

115
00:04:28,800 --> 00:04:32,700
ability but now I also exploit it

116
00:04:30,240 --> 00:04:34,830
because that makes me not a

117
00:04:32,700 --> 00:04:36,390
vulnerability scanner that's also not a

118
00:04:34,830 --> 00:04:38,190
dresser emulation and then finally you

119
00:04:36,390 --> 00:04:40,800
could say when we do a red team so it

120
00:04:38,190 --> 00:04:41,550
must be adversary emulation or maybe it

121
00:04:40,800 --> 00:04:44,100
depends

122
00:04:41,550 --> 00:04:46,650
are you actually emulating a real

123
00:04:44,100 --> 00:04:49,560
adversary that's a pretty good question

124
00:04:46,650 --> 00:04:51,299
because it does depend the it's a bit of

125
00:04:49,560 --> 00:04:53,370
a weird thing it's a bit small as well

126
00:04:51,300 --> 00:04:54,960
but the caption says we are the UN

127
00:04:53,370 --> 00:04:57,150
winner inspectors which is a bit weird

128
00:04:54,960 --> 00:04:58,950
but the point though is it's not because

129
00:04:57,150 --> 00:05:02,190
you've got some kind of crazy creative

130
00:04:58,950 --> 00:05:04,050
red team which does something wild which

131
00:05:02,190 --> 00:05:05,610
gives them access to your and farmed or

132
00:05:04,050 --> 00:05:07,710
even physically because they break into

133
00:05:05,610 --> 00:05:10,380
your building it doesn't mean that

134
00:05:07,710 --> 00:05:12,419
that's adversary emulation because what

135
00:05:10,380 --> 00:05:14,460
is every simulation it's about going for

136
00:05:12,420 --> 00:05:15,900
a realistic adversary who is the

137
00:05:14,460 --> 00:05:17,789
adversary to your environment or your

138
00:05:15,900 --> 00:05:20,039
organization it depends right so you

139
00:05:17,790 --> 00:05:22,290
have to first do that thinking what does

140
00:05:20,040 --> 00:05:26,400
a typical adversary do and so the whole

141
00:05:22,290 --> 00:05:28,470
point is using TTP's so now in tactics

142
00:05:26,400 --> 00:05:31,049
techniques and procedures that you know

143
00:05:28,470 --> 00:05:34,020
are being used against you to emulate

144
00:05:31,050 --> 00:05:35,430
how that goes and to what extent you can

145
00:05:34,020 --> 00:05:37,169
actually deal with it whether you

146
00:05:35,430 --> 00:05:37,800
prevent that or you detect that that's

147
00:05:37,170 --> 00:05:39,960
the whole point

148
00:05:37,800 --> 00:05:41,790
miter attack of course which I don't

149
00:05:39,960 --> 00:05:43,049
have to introduce because if you haven't

150
00:05:41,790 --> 00:05:44,520
heard about miter attack you've been

151
00:05:43,050 --> 00:05:47,280
living under a rock for the past couple

152
00:05:44,520 --> 00:05:49,440
of months or years even so that's a

153
00:05:47,280 --> 00:05:51,450
pretty nice database of techniques

154
00:05:49,440 --> 00:05:53,190
tactics that are typically abused by

155
00:05:51,450 --> 00:05:55,670
adversaries they even link them with

156
00:05:53,190 --> 00:05:57,870
certain adversaries which is nice so

157
00:05:55,670 --> 00:06:00,090
contesting vs. adversary emulation

158
00:05:57,870 --> 00:06:02,790
left-hand-side pentesting right identify

159
00:06:00,090 --> 00:06:05,179
and exploit you go for a specific scope

160
00:06:02,790 --> 00:06:07,620
right I want you to pen test this system

161
00:06:05,180 --> 00:06:09,180
excellent so I'll launch my scans and

162
00:06:07,620 --> 00:06:09,780
I'll see what I find or even if I do it

163
00:06:09,180 --> 00:06:12,420
manually

164
00:06:09,780 --> 00:06:14,669
point this you're quite often limited to

165
00:06:12,420 --> 00:06:18,720
a certain scope when you look at address

166
00:06:14,670 --> 00:06:20,970
or emulation assess the resilience how

167
00:06:18,720 --> 00:06:23,070
well does this organization either

168
00:06:20,970 --> 00:06:25,110
prevent or detect

169
00:06:23,070 --> 00:06:26,730
these kind of attacks so what did they

170
00:06:25,110 --> 00:06:29,100
do what kind of security controls have

171
00:06:26,730 --> 00:06:30,600
they implemented but the point is you

172
00:06:29,100 --> 00:06:33,360
are typically not limited to a certain

173
00:06:30,600 --> 00:06:35,880
scope or to not less bound to a certain

174
00:06:33,360 --> 00:06:39,060
scope you emulate an adversary how they

175
00:06:35,880 --> 00:06:40,920
would work which is nice on the left

176
00:06:39,060 --> 00:06:43,320
hand side of course you mostly focus on

177
00:06:40,920 --> 00:06:45,500
prevention a bit less on detection while

178
00:06:43,320 --> 00:06:47,730
of course with emulation it's about boat

179
00:06:45,500 --> 00:06:48,120
that doesn't require you to have a blue

180
00:06:47,730 --> 00:06:50,370
team

181
00:06:48,120 --> 00:06:51,780
there's no no point of doing adversary

182
00:06:50,370 --> 00:06:54,570
emulation if there's no detection going

183
00:06:51,780 --> 00:06:55,799
on which brings me to this one I'm going

184
00:06:54,570 --> 00:06:58,380
a bit quick on you because this is the

185
00:06:55,800 --> 00:07:00,540
basics red versus purple is a new thing

186
00:06:58,380 --> 00:07:02,490
right now we're purple used to be red

187
00:07:00,540 --> 00:07:04,650
versus blue now it's all purple or I

188
00:07:02,490 --> 00:07:06,930
don't know what colonial doesn't really

189
00:07:04,650 --> 00:07:08,960
matter the whole point is we're trying

190
00:07:06,930 --> 00:07:11,520
to make sure that everyone gets better

191
00:07:08,960 --> 00:07:14,039
the traditional red versus blue is

192
00:07:11,520 --> 00:07:16,440
definitely a good idea it works but it

193
00:07:14,040 --> 00:07:18,690
works to a certain extent red versus

194
00:07:16,440 --> 00:07:20,969
blue means that there's assessment red

195
00:07:18,690 --> 00:07:23,610
assesses how blue does its thing which

196
00:07:20,970 --> 00:07:25,920
is a good idea doesn't necessarily mean

197
00:07:23,610 --> 00:07:29,280
that blue is actually improving because

198
00:07:25,920 --> 00:07:32,130
to be fair red is only there to improve

199
00:07:29,280 --> 00:07:34,559
blue if you are any kind of commercial

200
00:07:32,130 --> 00:07:37,020
organization you do not need a red team

201
00:07:34,560 --> 00:07:38,880
to do anything else but make your blue

202
00:07:37,020 --> 00:07:41,010
team better which is fine I mean it's

203
00:07:38,880 --> 00:07:42,870
very good it's still it's - a very good

204
00:07:41,010 --> 00:07:44,820
reason for being there but that's

205
00:07:42,870 --> 00:07:46,230
important to note is that you use the

206
00:07:44,820 --> 00:07:49,590
red team to make the blue team better

207
00:07:46,230 --> 00:07:50,880
but typically the SS my team let's say

208
00:07:49,590 --> 00:07:53,429
you have a traditional red versus blue

209
00:07:50,880 --> 00:07:54,630
so red is doing things blue doesn't

210
00:07:53,430 --> 00:07:56,850
really know about it right they're

211
00:07:54,630 --> 00:07:58,770
seeing how well that works and there's

212
00:07:56,850 --> 00:08:01,170
no knowledge of communication there's no

213
00:07:58,770 --> 00:08:02,310
real feedback loop and then of course at

214
00:08:01,170 --> 00:08:05,940
the end of the team that's the report

215
00:08:02,310 --> 00:08:07,590
here it is that's how well you did could

216
00:08:05,940 --> 00:08:10,200
be good could be bad but the whole point

217
00:08:07,590 --> 00:08:11,640
of the purple part or red and blue or

218
00:08:10,200 --> 00:08:13,680
called better yet I don't know how you

219
00:08:11,640 --> 00:08:16,710
want to call it is instead of just

220
00:08:13,680 --> 00:08:18,360
assessing who actually try to improve so

221
00:08:16,710 --> 00:08:20,070
immediately we emulate a certain

222
00:08:18,360 --> 00:08:22,830
technique something that an actual

223
00:08:20,070 --> 00:08:26,610
adversary does and we try to figure out

224
00:08:22,830 --> 00:08:28,140
did we see this and the red could even

225
00:08:26,610 --> 00:08:29,850
be in the socratic could evil it should

226
00:08:28,140 --> 00:08:32,130
be next to the blue team saying oh let's

227
00:08:29,850 --> 00:08:32,460
try this did you see it if you didn't

228
00:08:32,130 --> 00:08:34,500
see it

229
00:08:32,460 --> 00:08:35,219
why not because you're missing certain

230
00:08:34,500 --> 00:08:36,839
loss but

231
00:08:35,219 --> 00:08:40,409
you're missing certain use cases but

232
00:08:36,839 --> 00:08:41,939
let's try to fix it that's the ID of

233
00:08:40,409 --> 00:08:43,289
course we can use matter attack we can

234
00:08:41,938 --> 00:08:45,329
use all of the stuff tactics and

235
00:08:43,289 --> 00:08:46,860
techniques we all know about this right

236
00:08:45,329 --> 00:08:48,540
so that's my two attack tactics

237
00:08:46,860 --> 00:08:50,339
techniques tactics at the top techniques

238
00:08:48,540 --> 00:08:52,889
the bottom we all know this common

239
00:08:50,339 --> 00:08:54,959
knowledge so imagine you've got

240
00:08:52,889 --> 00:08:57,629
component object model module hajeck

241
00:08:54,959 --> 00:08:59,579
income hijacking which is me personally

242
00:08:57,629 --> 00:09:01,740
I think it's a very underrated thing

243
00:08:59,579 --> 00:09:02,219
don't think it gets the attention it

244
00:09:01,740 --> 00:09:04,680
deserves

245
00:09:02,220 --> 00:09:06,839
it's madness it works really well it's a

246
00:09:04,680 --> 00:09:08,250
very nice way of doing persistence so

247
00:09:06,839 --> 00:09:10,589
we've got a lot of documentation it

248
00:09:08,250 --> 00:09:15,029
might attack explaining one where is it

249
00:09:10,589 --> 00:09:16,829
so how does it work uses it so you get

250
00:09:15,029 --> 00:09:18,449
some information about these are typical

251
00:09:16,829 --> 00:09:20,430
adversaries who use it and of course

252
00:09:18,449 --> 00:09:22,949
information about how we could

253
00:09:20,430 --> 00:09:25,199
potentially detect or mitigate this one

254
00:09:22,949 --> 00:09:26,519
right so we know okay this is how we

255
00:09:25,199 --> 00:09:27,899
could potentially do something about

256
00:09:26,519 --> 00:09:31,379
this which is nice

257
00:09:27,899 --> 00:09:33,209
gives us a solid base of information so

258
00:09:31,379 --> 00:09:35,250
how do you use the tacky more couple of

259
00:09:33,209 --> 00:09:37,109
things you could do emulation which is

260
00:09:35,250 --> 00:09:39,029
the primary part of course of what we're

261
00:09:37,110 --> 00:09:40,680
talking about today but there's open

262
00:09:39,029 --> 00:09:43,019
means there's other things you could do

263
00:09:40,680 --> 00:09:46,459
it might attack you could map your

264
00:09:43,019 --> 00:09:49,889
detection capability you could use it to

265
00:09:46,459 --> 00:09:52,170
classify or analyze or even categorize

266
00:09:49,889 --> 00:09:54,509
your threat intelligence right look at

267
00:09:52,170 --> 00:09:57,149
all that information you have this

268
00:09:54,509 --> 00:09:59,000
hostname is bad right the strat

269
00:09:57,149 --> 00:10:01,079
intelligence you've got like a feet

270
00:09:59,000 --> 00:10:02,759
irises come in right it depends on what

271
00:10:01,079 --> 00:10:04,949
you have of course but there's a host

272
00:10:02,759 --> 00:10:09,720
name which is bad okay but what does it

273
00:10:04,949 --> 00:10:11,579
mean I don't know is it used someone

274
00:10:09,720 --> 00:10:13,889
used as a commander control server is it

275
00:10:11,579 --> 00:10:15,839
used to drop another payload so you

276
00:10:13,889 --> 00:10:17,430
could of course categorize and make your

277
00:10:15,839 --> 00:10:18,199
threatened term more valuable by mapping

278
00:10:17,430 --> 00:10:20,040
it to my tree attack

279
00:10:18,199 --> 00:10:22,680
that on the side of course

280
00:10:20,040 --> 00:10:24,839
prioritization of defenses if you're not

281
00:10:22,680 --> 00:10:27,120
preventing or detecting a technique

282
00:10:24,839 --> 00:10:29,040
it might be worth prioritizing to look

283
00:10:27,120 --> 00:10:32,430
into okay should we improve on this yes

284
00:10:29,040 --> 00:10:34,319
or no small note on this as well I've

285
00:10:32,430 --> 00:10:37,410
seen a couple organizations try to fix

286
00:10:34,319 --> 00:10:41,370
this by saying role we just do miter

287
00:10:37,410 --> 00:10:45,329
attack discourse why not just slave

288
00:10:41,370 --> 00:10:48,420
hands there we go my Trotec sword do not

289
00:10:45,329 --> 00:10:50,189
all the techniques as one or as the well

290
00:10:48,420 --> 00:10:53,009
the same value if you will because they

291
00:10:50,189 --> 00:10:54,689
are not equal they have a certain weight

292
00:10:53,009 --> 00:10:58,290
to them some of them are more important

293
00:10:54,689 --> 00:11:01,139
than others which ones are of course

294
00:10:58,290 --> 00:11:03,629
relevant to you that's an important one

295
00:11:01,139 --> 00:11:05,850
it's not a Holy Trinity there are quite

296
00:11:03,629 --> 00:11:07,529
some gaps in mitre attacking it's not

297
00:11:05,850 --> 00:11:08,970
plenty because they're pretty exhaustive

298
00:11:07,529 --> 00:11:10,559
but are things which are not on mitre

299
00:11:08,970 --> 00:11:12,689
attack I checked today for example

300
00:11:10,559 --> 00:11:14,730
credential dumping which I'll discuss in

301
00:11:12,689 --> 00:11:17,429
the next one as a good example it's huge

302
00:11:14,730 --> 00:11:19,470
it includes almost everything like oh

303
00:11:17,429 --> 00:11:21,449
you've got credential dumping from also

304
00:11:19,470 --> 00:11:23,249
using mimic ads you've got temple

305
00:11:21,449 --> 00:11:25,738
attentions from the registry you've got

306
00:11:23,249 --> 00:11:27,929
dumping credentials using DC sink you've

307
00:11:25,739 --> 00:11:29,970
got dumping the entry has dubbed it it's

308
00:11:27,929 --> 00:11:31,559
one technique but let three ten

309
00:11:29,970 --> 00:11:33,509
different attacks and ten different

310
00:11:31,559 --> 00:11:35,699
detection methods which is interesting

311
00:11:33,509 --> 00:11:37,709
right so you cannot just say it's one or

312
00:11:35,699 --> 00:11:41,549
zero that specific technique it's a lot

313
00:11:37,709 --> 00:11:43,138
more than that so that's basically what

314
00:11:41,549 --> 00:11:44,730
that slide says don't consider it as the

315
00:11:43,139 --> 00:11:46,410
only thing the thing you absolutely have

316
00:11:44,730 --> 00:11:49,199
to do and this is what I wanted to

317
00:11:46,410 --> 00:11:50,850
mention this is credential dumping so

318
00:11:49,199 --> 00:11:52,439
this is the windows sam security grants

319
00:11:50,850 --> 00:11:56,100
manager of course which stores your

320
00:11:52,439 --> 00:11:58,349
local credentials and question how would

321
00:11:56,100 --> 00:12:11,519
you detect someone stealing your Sam the

322
00:11:58,350 --> 00:12:13,290
same file options but if they're doing

323
00:12:11,519 --> 00:12:15,419
it from disk or potentially exporting

324
00:12:13,290 --> 00:12:16,799
from the registry hives you want to be

325
00:12:15,419 --> 00:12:18,569
looking at command line interaction

326
00:12:16,799 --> 00:12:19,889
maybe it's a bit lame I know but that's

327
00:12:18,569 --> 00:12:22,279
one of the options that you could use

328
00:12:19,889 --> 00:12:24,720
there's different other ones but

329
00:12:22,279 --> 00:12:27,299
credential is something else right it's

330
00:12:24,720 --> 00:12:29,129
the same technique credentials cash

331
00:12:27,299 --> 00:12:30,569
credentials are used by the system when

332
00:12:29,129 --> 00:12:32,100
you don't have that existed domain

333
00:12:30,569 --> 00:12:34,259
controller so it uses cash credentials

334
00:12:32,100 --> 00:12:37,009
to authenticate a domain user perfectly

335
00:12:34,259 --> 00:12:39,600
fine but that's another way of detecting

336
00:12:37,009 --> 00:12:41,220
anted yes right copying and this is the

337
00:12:39,600 --> 00:12:42,600
trough from the domain controller using

338
00:12:41,220 --> 00:12:45,089
the volume Shadow Copy Service for

339
00:12:42,600 --> 00:12:48,059
example again completely other thing and

340
00:12:45,089 --> 00:12:49,390
then of course using DC sync how did you

341
00:12:48,059 --> 00:12:52,519
take this is Inc

342
00:12:49,390 --> 00:12:52,519
[Music]

343
00:12:54,070 --> 00:13:01,340
this is an interesting room

344
00:12:58,390 --> 00:13:03,050
maybe I should know I'll leave you Turks

345
00:13:01,340 --> 00:13:04,670
for later let's focus first on the

346
00:13:03,050 --> 00:13:06,349
content people so this is think how can

347
00:13:04,670 --> 00:13:08,569
you detect this is sink what is this you

348
00:13:06,350 --> 00:13:10,400
think it's about replication right you

349
00:13:08,570 --> 00:13:13,730
replicate from one domain controller to

350
00:13:10,400 --> 00:13:15,829
another one it's perfectly fine okay

351
00:13:13,730 --> 00:13:17,330
unless someone replicates from a

352
00:13:15,830 --> 00:13:19,760
workstation to a domain controller it

353
00:13:17,330 --> 00:13:21,980
doesn't make any sense this uses a very

354
00:13:19,760 --> 00:13:23,600
specific mics of protocol called MSDS R

355
00:13:21,980 --> 00:13:25,490
which is the Micro stereo application

356
00:13:23,600 --> 00:13:27,050
service protocol which you should never

357
00:13:25,490 --> 00:13:29,000
see between a workstation and a domain

358
00:13:27,050 --> 00:13:31,459
controller if you have any kind of

359
00:13:29,000 --> 00:13:33,500
segmentation in place your workstations

360
00:13:31,460 --> 00:13:34,970
are probably neck notes next to your

361
00:13:33,500 --> 00:13:36,800
domain controllers

362
00:13:34,970 --> 00:13:38,090
I hope or there's something in between

363
00:13:36,800 --> 00:13:40,790
which is actually looking at what's

364
00:13:38,090 --> 00:13:42,470
going on in between those systems if you

365
00:13:40,790 --> 00:13:44,000
don't you not see it but you can see

366
00:13:42,470 --> 00:13:48,560
that's very different than the other

367
00:13:44,000 --> 00:13:50,360
ones so that's quite a few interesting

368
00:13:48,560 --> 00:13:58,010
patrols another one another variant but

369
00:13:50,360 --> 00:14:01,880
all of this one specific technique so

370
00:13:58,010 --> 00:14:03,560
how important is it and you could say

371
00:14:01,880 --> 00:14:05,439
well Eric but how do we know how

372
00:14:03,560 --> 00:14:11,180
important that is well two main criteria

373
00:14:05,440 --> 00:14:12,800
the first one is how is it on a wider

374
00:14:11,180 --> 00:14:15,560
scale and though it's pretty

375
00:14:12,800 --> 00:14:17,959
straightforward because my turn Caitie

376
00:14:15,560 --> 00:14:20,180
nickles who is the lead at Intel at

377
00:14:17,960 --> 00:14:22,430
mitre and of course the guys from red

378
00:14:20,180 --> 00:14:24,589
Canary I don't remember the name is the

379
00:14:22,430 --> 00:14:27,050
CEO actually of the the film he

380
00:14:24,590 --> 00:14:28,670
presented Caitie nickles about what are

381
00:14:27,050 --> 00:14:31,579
the most common techniques they see

382
00:14:28,670 --> 00:14:33,709
being used we did that in February 2019

383
00:14:31,580 --> 00:14:35,960
and they came up with seven techniques

384
00:14:33,710 --> 00:14:38,240
which are most prevalent which are used

385
00:14:35,960 --> 00:14:40,850
all the time by adversaries you probably

386
00:14:38,240 --> 00:14:42,620
want to look for those seven maybe I

387
00:14:40,850 --> 00:14:44,990
don't know just to start random thought

388
00:14:42,620 --> 00:14:47,440
maybe look for those first if you get a

389
00:14:44,990 --> 00:14:49,490
bit more mature look at your overall

390
00:14:47,440 --> 00:14:52,310
relevance of threat actors for your

391
00:14:49,490 --> 00:14:55,570
organization who are you dealing with is

392
00:14:52,310 --> 00:14:59,709
apt 28 is tape - 29

393
00:14:55,570 --> 00:15:01,630
I don't know an anon apt either but

394
00:14:59,709 --> 00:15:02,979
who's important who is coming after you

395
00:15:01,630 --> 00:15:04,480
and what techniques are they using

396
00:15:02,980 --> 00:15:06,100
that's another thing that should of

397
00:15:04,480 --> 00:15:09,519
course influence what you're

398
00:15:06,100 --> 00:15:11,860
prioritizing so you develop an emulation

399
00:15:09,519 --> 00:15:15,209
plan right so because we're talking

400
00:15:11,860 --> 00:15:18,279
about emulation and addressing emulation

401
00:15:15,209 --> 00:15:20,319
develop a plan say okay let's do this

402
00:15:18,279 --> 00:15:21,430
red team or purple team however you want

403
00:15:20,319 --> 00:15:23,829
the color to what are we trying to

404
00:15:21,430 --> 00:15:26,109
achieve we structure it according to

405
00:15:23,829 --> 00:15:28,810
different phases and in every phase we

406
00:15:26,110 --> 00:15:30,310
execute certain techniques for example

407
00:15:28,810 --> 00:15:30,849
this is one developed by might of

408
00:15:30,310 --> 00:15:34,689
themselves

409
00:15:30,850 --> 00:15:36,399
it's the apt three emulation plan so

410
00:15:34,690 --> 00:15:39,250
what is the apt three emulation plan

411
00:15:36,399 --> 00:15:42,160
look like they've done quite and things

412
00:15:39,250 --> 00:15:43,750
set up a c2 channel get initial access

413
00:15:42,160 --> 00:15:46,449
in phase one so the number of things

414
00:15:43,750 --> 00:15:48,009
preparation as well in phase number two

415
00:15:46,449 --> 00:15:49,660
we compromise host we do some lateral

416
00:15:48,009 --> 00:15:53,110
movement with them credentials all that

417
00:15:49,660 --> 00:15:54,790
stuff that we do most of the things we

418
00:15:53,110 --> 00:15:56,709
need to do to reach our objectives and

419
00:15:54,790 --> 00:15:58,060
finally in of course phase three we

420
00:15:56,709 --> 00:16:00,459
collect what we need and we try to

421
00:15:58,060 --> 00:16:01,660
exfiltrate it for example very simple

422
00:16:00,459 --> 00:16:04,239
very straightforward

423
00:16:01,660 --> 00:16:07,870
it's an emulation plan so you build your

424
00:16:04,240 --> 00:16:10,329
own and infrastructure you start doing

425
00:16:07,870 --> 00:16:12,550
discovery you start getting initial

426
00:16:10,329 --> 00:16:14,439
access you start running through all

427
00:16:12,550 --> 00:16:15,699
those different steps you select the

428
00:16:14,440 --> 00:16:17,649
techniques which you think are most

429
00:16:15,699 --> 00:16:21,639
important and of course you report back

430
00:16:17,649 --> 00:16:23,470
on that now if you ask me as a

431
00:16:21,639 --> 00:16:24,610
consultant Eric can you do adversary

432
00:16:23,470 --> 00:16:27,819
Malaysian first I will tell you of

433
00:16:24,610 --> 00:16:31,449
course here's an emulation plan 200

434
00:16:27,819 --> 00:16:33,490
techniques 200 thousand euros but that

435
00:16:31,449 --> 00:16:36,010
doesn't work right no one has unlimited

436
00:16:33,490 --> 00:16:37,420
budgets or efforts you want to select of

437
00:16:36,010 --> 00:16:39,100
course as we already mentioned the ones

438
00:16:37,420 --> 00:16:40,839
that are most relevant to you so you

439
00:16:39,100 --> 00:16:43,810
could come up with something like this

440
00:16:40,839 --> 00:16:46,120
PT 28 all known to use these specific

441
00:16:43,810 --> 00:16:49,689
techniques so we develop an emulation

442
00:16:46,120 --> 00:16:51,819
plan to run through these not every

443
00:16:49,689 --> 00:16:53,620
single plan needs to run through every

444
00:16:51,819 --> 00:16:55,719
single tactic right you can be creative

445
00:16:53,620 --> 00:16:57,699
the one thing which would be nice though

446
00:16:55,720 --> 00:16:59,819
if you could make this repeatable if you

447
00:16:57,699 --> 00:17:03,219
could rate okay but how are we doing now

448
00:16:59,819 --> 00:17:05,949
versus tomorrow versus next week versus

449
00:17:03,220 --> 00:17:08,130
next year and that gets annoying when

450
00:17:05,949 --> 00:17:10,860
it's all fully manual right

451
00:17:08,130 --> 00:17:12,690
let's work out there comes into play now

452
00:17:10,859 --> 00:17:15,329
enough with inter about what a treasure

453
00:17:12,690 --> 00:17:17,490
emulation is all about let's look at

454
00:17:15,329 --> 00:17:19,619
some tools all right how can we do this

455
00:17:17,490 --> 00:17:23,280
what can we use what can we leverage to

456
00:17:19,619 --> 00:17:25,129
get this done right on the left hand

457
00:17:23,280 --> 00:17:28,050
side we've got everything which I call

458
00:17:25,130 --> 00:17:29,820
automated or scripting or more things

459
00:17:28,050 --> 00:17:32,100
that do automated adversary Malaysian if

460
00:17:29,820 --> 00:17:33,840
you will on the right hand side you're

461
00:17:32,100 --> 00:17:36,540
looking at more manual stuff you're

462
00:17:33,840 --> 00:17:39,209
looking at typical metal sports faction

463
00:17:36,540 --> 00:17:41,280
see two covenants even combat strike I

464
00:17:39,210 --> 00:17:42,300
got with a vampire because they stopped

465
00:17:41,280 --> 00:17:44,010
well

466
00:17:42,300 --> 00:17:46,110
supporting it a few months ago but still

467
00:17:44,010 --> 00:17:49,080
very effective all the powers at the

468
00:17:46,110 --> 00:17:51,060
moment is while PowerShell used to be

469
00:17:49,080 --> 00:17:52,560
what I call a dumpster fire it's not

470
00:17:51,060 --> 00:17:54,149
really a dumpster fire anymore it's

471
00:17:52,560 --> 00:17:56,810
pretty hard to get things done in

472
00:17:54,150 --> 00:17:59,610
PowerShell but more on that in a second

473
00:17:56,810 --> 00:18:01,770
so what does that look like well simple

474
00:17:59,610 --> 00:18:03,060
things right atomic Red Team you just

475
00:18:01,770 --> 00:18:05,820
run through some techniques

476
00:18:03,060 --> 00:18:07,770
it's very manual atomic regime is an

477
00:18:05,820 --> 00:18:10,889
excellent knowledge base which is

478
00:18:07,770 --> 00:18:13,320
primarily maintained if you will not on

479
00:18:10,890 --> 00:18:14,760
their own by the guys over at red canary

480
00:18:13,320 --> 00:18:17,040
but of course they have many

481
00:18:14,760 --> 00:18:21,150
contributors but the idea is they

482
00:18:17,040 --> 00:18:22,950
develop very simple atomic tests if you

483
00:18:21,150 --> 00:18:24,750
will which are neutral commands lines

484
00:18:22,950 --> 00:18:26,250
right for example this one it's using

485
00:18:24,750 --> 00:18:29,250
bits admin to download a specific

486
00:18:26,250 --> 00:18:31,380
payload it's one of the techniques you

487
00:18:29,250 --> 00:18:33,030
don't need to install any kind of tools

488
00:18:31,380 --> 00:18:35,640
you don't need to get a metal point

489
00:18:33,030 --> 00:18:37,379
meterpreter a confident command or

490
00:18:35,640 --> 00:18:38,490
anything anything of that stuff you

491
00:18:37,380 --> 00:18:40,470
don't need to get anything of that

492
00:18:38,490 --> 00:18:41,910
running you just run that specific

493
00:18:40,470 --> 00:18:44,130
command line and you see what you get

494
00:18:41,910 --> 00:18:46,530
back does it work does anyone detect

495
00:18:44,130 --> 00:18:48,960
that I ran that interesting it's very

496
00:18:46,530 --> 00:18:51,629
manual work very effective they're all

497
00:18:48,960 --> 00:18:53,520
free easy to contribute to so it's not a

498
00:18:51,630 --> 00:18:55,160
bad idea to use this this is not

499
00:18:53,520 --> 00:18:57,540
something you would use in a red team

500
00:18:55,160 --> 00:18:59,340
contrary to the name it's something you

501
00:18:57,540 --> 00:19:00,960
would use as a blue team to test how

502
00:18:59,340 --> 00:19:03,570
well to actually detect that specific

503
00:19:00,960 --> 00:19:05,730
technique so you try to convert my to

504
00:19:03,570 --> 00:19:10,080
attack techniques in one or two lines of

505
00:19:05,730 --> 00:19:12,030
very simple commands trade for a bit

506
00:19:10,080 --> 00:19:17,240
less well known mainly developed by

507
00:19:12,030 --> 00:19:17,240
Chris gates which I think he might be

508
00:19:18,669 --> 00:19:22,299
which is the carnal owners on Twitter

509
00:19:20,139 --> 00:19:24,758
that's Chris gates so he developed this

510
00:19:22,299 --> 00:19:26,799
one which uses vagrant and virtual books

511
00:19:24,759 --> 00:19:29,019
to spin up machines as well and to just

512
00:19:26,799 --> 00:19:30,970
run commands as well very similar uses

513
00:19:29,019 --> 00:19:32,710
the ML files for configuration you

514
00:19:30,970 --> 00:19:34,659
specify what specific commands you want

515
00:19:32,710 --> 00:19:35,169
to run and again it emulates that kind

516
00:19:34,659 --> 00:19:39,519
of stuff

517
00:19:35,169 --> 00:19:41,230
nice this I was gonna say this is my

518
00:19:39,519 --> 00:19:42,820
favorites but I shouldn't say it because

519
00:19:41,230 --> 00:19:44,980
caldera should be my favorite but as

520
00:19:42,820 --> 00:19:48,639
this infection monkey has anyone ever

521
00:19:44,980 --> 00:19:50,889
ran infection monkey they're all missing

522
00:19:48,639 --> 00:19:53,168
out this is the most amazing tool ever

523
00:19:50,889 --> 00:19:55,449
so what is infection monkey do well it

524
00:19:53,169 --> 00:19:57,789
acts like a monkey so you get it you

525
00:19:55,450 --> 00:19:59,320
stage it with PowerShell or you could

526
00:19:57,789 --> 00:20:02,139
also use a binary if you really want to

527
00:19:59,320 --> 00:20:04,239
but that infects a system but then the

528
00:20:02,139 --> 00:20:06,008
monkey does what the micro it does what

529
00:20:04,239 --> 00:20:08,139
the monkey does right which is kind of

530
00:20:06,009 --> 00:20:13,840
unstructured so you get something like

531
00:20:08,139 --> 00:20:15,789
that animation just slightly touch of

532
00:20:13,840 --> 00:20:18,609
almost but that's what it looks like

533
00:20:15,789 --> 00:20:20,259
this entire infection map and it starts

534
00:20:18,609 --> 00:20:22,389
moving from one system to the other it

535
00:20:20,259 --> 00:20:36,789
doesn't think though there's no logic

536
00:20:22,389 --> 00:20:38,619
behind it there's no you do not tell the

537
00:20:36,789 --> 00:20:40,269
monkey what to do right the monkey

538
00:20:38,619 --> 00:20:43,178
doesn't care the monkey does its own

539
00:20:40,269 --> 00:20:44,619
thing which is interesting I will turn

540
00:20:43,179 --> 00:20:46,480
this in the production environment oh

541
00:20:44,619 --> 00:20:48,189
but well might make sense right who

542
00:20:46,480 --> 00:20:50,220
knows what you find out it starts

543
00:20:48,190 --> 00:20:53,080
running around and it generates

544
00:20:50,220 --> 00:20:55,239
infection which is interesting so you

545
00:20:53,080 --> 00:20:58,119
can see here on this small legend you've

546
00:20:55,239 --> 00:20:59,980
got an initial island if you will which

547
00:20:58,119 --> 00:21:01,418
is the c2 which is like almost in the

548
00:20:59,980 --> 00:21:04,149
middle a bit to the left and then you

549
00:21:01,419 --> 00:21:06,460
can see the monkey which is on a linux

550
00:21:04,149 --> 00:21:07,869
system over there the 10 0 3 6 8 and

551
00:21:06,460 --> 00:21:09,549
then it managed to pivot through some

552
00:21:07,869 --> 00:21:11,230
other systems you've got some throwing

553
00:21:09,549 --> 00:21:13,658
going on to connect back to the c2

554
00:21:11,230 --> 00:21:15,669
server all pretty nice but again very

555
00:21:13,659 --> 00:21:18,249
uncontrolled this is no purple

556
00:21:15,669 --> 00:21:20,259
controlled emulation right because what

557
00:21:18,249 --> 00:21:20,909
this thing does give you at the end it's

558
00:21:20,259 --> 00:21:24,460
actually

559
00:21:20,909 --> 00:21:26,649
animation it comes back I forgot about

560
00:21:24,460 --> 00:21:27,610
the animation sorry and it comes back

561
00:21:26,649 --> 00:21:29,439
with a ports

562
00:21:27,610 --> 00:21:31,590
hey you've got these vulnerabilities

563
00:21:29,440 --> 00:21:35,830
this hi this is how you should fix them

564
00:21:31,590 --> 00:21:40,600
not bad but we deserve more right and

565
00:21:35,830 --> 00:21:41,949
it's be a bit more structured mistake on

566
00:21:40,600 --> 00:21:43,360
the slide this should be sliver it's

567
00:21:41,950 --> 00:21:45,850
still sliver but the title says

568
00:21:43,360 --> 00:21:49,659
confident sliver isn't very nice one

569
00:21:45,850 --> 00:21:51,399
what's developed by Bishop Fox which is

570
00:21:49,660 --> 00:21:53,200
a American film pretty well-known for

571
00:21:51,400 --> 00:21:53,730
some of their pen test services that

572
00:21:53,200 --> 00:21:56,320
they offer

573
00:21:53,730 --> 00:21:58,630
what does sliver do it's currently in

574
00:21:56,320 --> 00:22:01,600
alpha state but it aims to be a stout

575
00:21:58,630 --> 00:22:04,240
implant for adversary emulation the idea

576
00:22:01,600 --> 00:22:06,250
is that you deploy it manually she put

577
00:22:04,240 --> 00:22:07,480
it somewhere on a system again it's

578
00:22:06,250 --> 00:22:09,370
always the same thing right get an

579
00:22:07,480 --> 00:22:12,040
implant going those ones there was a

580
00:22:09,370 --> 00:22:17,320
Twitter rant a few weeks ago I think by

581
00:22:12,040 --> 00:22:19,899
Tim Dean going about look can we please

582
00:22:17,320 --> 00:22:21,580
decide on a name right because some are

583
00:22:19,900 --> 00:22:24,340
using it an agent orbital created

584
00:22:21,580 --> 00:22:25,689
implant covenant causes a grunt these

585
00:22:24,340 --> 00:22:27,520
guys covered something else oh it keeps

586
00:22:25,690 --> 00:22:30,309
on going which it's interesting but so

587
00:22:27,520 --> 00:22:31,840
one name out called an agent a grunt

588
00:22:30,309 --> 00:22:34,450
whatever you want it to be but you have

589
00:22:31,840 --> 00:22:36,428
an implant on a system right which is in

590
00:22:34,450 --> 00:22:39,549
this case the sliver implant one of the

591
00:22:36,429 --> 00:22:41,950
nice things liver does it tries to catch

592
00:22:39,549 --> 00:22:43,720
the blue team which is a nice change of

593
00:22:41,950 --> 00:22:45,970
dynamic right because usually red trying

594
00:22:43,720 --> 00:22:49,090
to catch blue so how does liver work in

595
00:22:45,970 --> 00:22:51,760
every binary that's used to execute the

596
00:22:49,090 --> 00:22:53,409
implant the ads of course the real c2

597
00:22:51,760 --> 00:22:57,040
information because needs to be in there

598
00:22:53,410 --> 00:23:01,059
to well set up a c2 channel but it also

599
00:22:57,040 --> 00:23:03,100
includes a canary c2 which is a DNS name

600
00:23:01,059 --> 00:23:05,440
that they put in clear-text in the

601
00:23:03,100 --> 00:23:07,540
binary the whole point is if some blue

602
00:23:05,440 --> 00:23:10,030
Timur catches it and just runs strings

603
00:23:07,540 --> 00:23:12,100
against its ago look here's the here's

604
00:23:10,030 --> 00:23:13,690
the hostname that must be the c2 if they

605
00:23:12,100 --> 00:23:16,750
try to resolve it then of course never

606
00:23:13,690 --> 00:23:18,340
catches them that's the ID so perfect

607
00:23:16,750 --> 00:23:19,720
but it's an interesting train of thought

608
00:23:18,340 --> 00:23:22,540
it's like deception by the red team

609
00:23:19,720 --> 00:23:24,970
which is nice so they booted in which is

610
00:23:22,540 --> 00:23:27,850
pretty impressive and of course our

611
00:23:24,970 --> 00:23:29,770
confidence this one big fan very

612
00:23:27,850 --> 00:23:32,918
impressive work these are the guys from

613
00:23:29,770 --> 00:23:34,809
spectrums more specifically this is a

614
00:23:32,919 --> 00:23:36,580
Cooper who used to be one of the well

615
00:23:34,809 --> 00:23:38,119
some of the main cast as well behind

616
00:23:36,580 --> 00:23:40,879
Empire

617
00:23:38,119 --> 00:23:42,769
well not 100% but this is more of a flop

618
00:23:40,879 --> 00:23:44,389
after Empire so Empire of course

619
00:23:42,769 --> 00:23:46,969
everyone knows Empire which is a very

620
00:23:44,389 --> 00:23:48,529
nice framework but of course since

621
00:23:46,969 --> 00:23:55,549
Microsoft decided to get their act

622
00:23:48,529 --> 00:23:56,869
together and kind of hard to use I don't

623
00:23:55,549 --> 00:23:58,609
have to tell you if you're a pen tester

624
00:23:56,869 --> 00:24:01,249
you deal with things like mg with

625
00:23:58,609 --> 00:24:02,989
constrained language mode skipping it's

626
00:24:01,249 --> 00:24:05,479
pretty messy to get proper partial

627
00:24:02,989 --> 00:24:07,729
execution it's still feasible but it's a

628
00:24:05,479 --> 00:24:09,499
lot less feasible than it used to be so

629
00:24:07,729 --> 00:24:11,659
we now have covenant which is very

630
00:24:09,499 --> 00:24:13,969
similar if you look at the interface as

631
00:24:11,659 --> 00:24:16,159
well but it's more focused on that step

632
00:24:13,969 --> 00:24:17,509
basically moving away from PowerShell

633
00:24:16,159 --> 00:24:19,489
and showing look this is all the stuff

634
00:24:17,509 --> 00:24:21,589
you can do it not which is also pretty

635
00:24:19,489 --> 00:24:23,029
crazy so definitely have a look at this

636
00:24:21,589 --> 00:24:25,399
one if you're ever in the market for a

637
00:24:23,029 --> 00:24:27,529
new implant system all pretty pretty

638
00:24:25,399 --> 00:24:30,829
nice pretty effective all of this

639
00:24:27,529 --> 00:24:33,319
however is manual stuff things that you

640
00:24:30,829 --> 00:24:34,668
do manually and then of course you have

641
00:24:33,319 --> 00:24:37,609
to start manually running through all of

642
00:24:34,669 --> 00:24:41,539
your commands there's even purple team

643
00:24:37,609 --> 00:24:43,188
automation which is develop a pattern

644
00:24:41,539 --> 00:24:44,829
and what they've done is they've

645
00:24:43,189 --> 00:24:47,239
actually taken Metasploit and they've

646
00:24:44,829 --> 00:24:49,158
written a whole bunch of post modules

647
00:24:47,239 --> 00:24:51,289
for meterpreter which are all trying to

648
00:24:49,159 --> 00:24:52,519
do like lateral movement my tree tech

649
00:24:51,289 --> 00:24:54,139
techniques they're all map to my tree

650
00:24:52,519 --> 00:24:56,659
tech as well but all that stuff is

651
00:24:54,139 --> 00:24:58,938
manual it's hard to reproduce and it's

652
00:24:56,659 --> 00:25:01,309
hard to run in a proper production

653
00:24:58,939 --> 00:25:04,399
environment if you will so what is the

654
00:25:01,309 --> 00:25:06,649
idea well how about we use an automated

655
00:25:04,399 --> 00:25:08,268
to something that structured this in a

656
00:25:06,649 --> 00:25:12,168
good way that we can start detecting

657
00:25:08,269 --> 00:25:14,449
things all right that's we're out now

658
00:25:12,169 --> 00:25:16,219
again a new version was pretty recently

659
00:25:14,449 --> 00:25:17,959
released so it's kind of like in the

660
00:25:16,219 --> 00:25:20,479
making and you'll notice that a lot of

661
00:25:17,959 --> 00:25:21,079
the stuff is prettier you'll see during

662
00:25:20,479 --> 00:25:22,609
my demo

663
00:25:21,079 --> 00:25:23,869
sometimes the web interfaces and load

664
00:25:22,609 --> 00:25:25,129
well so you have to refresh and you have

665
00:25:23,869 --> 00:25:27,499
to do this and restart the database

666
00:25:25,129 --> 00:25:27,978
sometimes a bit nasty but it's pretty

667
00:25:27,499 --> 00:25:31,489
nice

668
00:25:27,979 --> 00:25:32,689
there's a very there's a bit of a trend

669
00:25:31,489 --> 00:25:34,669
nowadays you see more and more

670
00:25:32,689 --> 00:25:36,859
commercial vendors trying to sell these

671
00:25:34,669 --> 00:25:40,579
kind of products as well some of these

672
00:25:36,859 --> 00:25:43,718
do it with their I said machine learning

673
00:25:40,579 --> 00:25:46,399
or AI right but this thing is very

674
00:25:43,719 --> 00:25:47,840
automated doesn't do anything like that

675
00:25:46,399 --> 00:25:51,169
right it's not the point

676
00:25:47,840 --> 00:25:53,030
now there is pretty stupid in that sense

677
00:25:51,170 --> 00:25:55,220
that it's a structured approach you tell

678
00:25:53,030 --> 00:25:58,580
it to do a it was a it's very simple

679
00:25:55,220 --> 00:26:01,040
utility ABC does ABC you put it - ACB

680
00:25:58,580 --> 00:26:04,040
does ACB it's very simple if it hits a

681
00:26:01,040 --> 00:26:05,870
wall it stops it doesn't know how to

682
00:26:04,040 --> 00:26:07,070
deal with a certain defense because you

683
00:26:05,870 --> 00:26:08,570
didn't tell it how to deal with a

684
00:26:07,070 --> 00:26:10,669
certain defense which is fine I mean

685
00:26:08,570 --> 00:26:13,040
we're emulating here this is assistance

686
00:26:10,670 --> 00:26:15,280
right it's not some kind of a magic

687
00:26:13,040 --> 00:26:18,940
solution so what does it look like

688
00:26:15,280 --> 00:26:23,149
develop I might as well so it's nice

689
00:26:18,940 --> 00:26:24,650
yeah again if you see that they're

690
00:26:23,150 --> 00:26:26,060
competing all the time it's pretty crazy

691
00:26:24,650 --> 00:26:28,940
how many plugins that they're adding and

692
00:26:26,060 --> 00:26:30,500
things that are changing the reshuffle

693
00:26:28,940 --> 00:26:32,840
the entire thing and since then it's

694
00:26:30,500 --> 00:26:35,650
it's been pretty impressive to see how

695
00:26:32,840 --> 00:26:38,480
it moves along so this is a very quick

696
00:26:35,650 --> 00:26:40,460
walkthrough so the main component

697
00:26:38,480 --> 00:26:43,100
encounter is what we call an ability

698
00:26:40,460 --> 00:26:47,210
what's an ability is the execution of a

699
00:26:43,100 --> 00:26:49,389
certain technique now paralyzed implants

700
00:26:47,210 --> 00:26:52,850
and different systems which are deployed

701
00:26:49,390 --> 00:26:56,360
upfront right it doesn't do initial

702
00:26:52,850 --> 00:26:58,730
intrusion that's not the point there's

703
00:26:56,360 --> 00:27:00,979
already something running and that thing

704
00:26:58,730 --> 00:27:02,570
will then start doing things running

705
00:27:00,980 --> 00:27:03,890
mitre attack techniques and it's those

706
00:27:02,570 --> 00:27:06,260
techniques that you want to try to

707
00:27:03,890 --> 00:27:09,200
detect that's what it tries to help with

708
00:27:06,260 --> 00:27:11,629
so you deploy a certain agent and I'll

709
00:27:09,200 --> 00:27:14,240
get back to it in a second once that's

710
00:27:11,630 --> 00:27:15,620
deployed you can start doing things you

711
00:27:14,240 --> 00:27:17,600
can start running abilities

712
00:27:15,620 --> 00:27:20,840
what's an ability is this kind of stuff

713
00:27:17,600 --> 00:27:25,280
for example it uses a specific ID which

714
00:27:20,840 --> 00:27:26,419
is you you you ready for I'll tell you

715
00:27:25,280 --> 00:27:29,000
in a second if you want to actually

716
00:27:26,420 --> 00:27:31,040
create an operation you cannot reference

717
00:27:29,000 --> 00:27:33,530
the ability name you have to reference

718
00:27:31,040 --> 00:27:39,290
the actual ID and there's no drop-down

719
00:27:33,530 --> 00:27:41,090
button so it's kind of a it's the edges

720
00:27:39,290 --> 00:27:44,000
if you will have to actually remember

721
00:27:41,090 --> 00:27:45,919
the number which is nice credential xst

722
00:27:44,000 --> 00:27:47,630
zero one zero zero three potential

723
00:27:45,920 --> 00:27:49,730
damping when power cuts

724
00:27:47,630 --> 00:27:51,980
use power cuts to execute mimic at this

725
00:27:49,730 --> 00:27:53,720
is a built-in technique you can see

726
00:27:51,980 --> 00:27:57,170
there what's the actual command that it

727
00:27:53,720 --> 00:28:00,170
runs the caldera implant is a power

728
00:27:57,170 --> 00:28:02,000
implants which means that any command

729
00:28:00,170 --> 00:28:03,800
you'll see here when it's windows driven

730
00:28:02,000 --> 00:28:05,330
it's gonna be PowerShell execution

731
00:28:03,800 --> 00:28:09,530
because it does PowerShell execution

732
00:28:05,330 --> 00:28:11,929
that's what it does okay so you see here

733
00:28:09,530 --> 00:28:14,000
very simple it's just downloading invoke

734
00:28:11,930 --> 00:28:15,470
mimikatz and it's trying to write it's

735
00:28:14,000 --> 00:28:18,890
pretty straightforward that's a pretty

736
00:28:15,470 --> 00:28:21,680
simple built-in technique or ability if

737
00:28:18,890 --> 00:28:22,970
you will you have groups so what are

738
00:28:21,680 --> 00:28:25,280
groups those are collection of systems

739
00:28:22,970 --> 00:28:27,590
are deployed on so what should you do

740
00:28:25,280 --> 00:28:31,660
break out the arm well typically not on

741
00:28:27,590 --> 00:28:31,659
your production environments right

742
00:28:41,740 --> 00:28:47,450
because if you have if you have mg Delta

743
00:28:45,470 --> 00:28:49,250
motors can interface which I got back to

744
00:28:47,450 --> 00:28:51,350
in a second that's gonna hurt out there

745
00:28:49,250 --> 00:28:53,270
it doesn't like it it doesn't do well

746
00:28:51,350 --> 00:28:55,719
with it so you don't deploy it in a

747
00:28:53,270 --> 00:28:58,129
production environment you deploy it in

748
00:28:55,720 --> 00:28:59,930
test environments couple of systems

749
00:28:58,130 --> 00:29:02,930
domain controller something realistic

750
00:28:59,930 --> 00:29:05,210
with security controls that you might

751
00:29:02,930 --> 00:29:07,670
have in real life as well just bear in

752
00:29:05,210 --> 00:29:08,960
mind what you would you if you break out

753
00:29:07,670 --> 00:29:11,960
there of course it kind of defeats the

754
00:29:08,960 --> 00:29:13,250
purpose the agent needs to run it's very

755
00:29:11,960 --> 00:29:15,740
effective though from a detection

756
00:29:13,250 --> 00:29:17,930
perspective right so you have a small

757
00:29:15,740 --> 00:29:20,540
product small test environment very

758
00:29:17,930 --> 00:29:22,850
similar to production but you feed all

759
00:29:20,540 --> 00:29:25,010
the looks into production seam or

760
00:29:22,850 --> 00:29:26,780
elastic stacker spring whatever you want

761
00:29:25,010 --> 00:29:28,700
to use you put all the logs in there and

762
00:29:26,780 --> 00:29:30,379
then you try to hunt for the actual

763
00:29:28,700 --> 00:29:32,090
techniques so you know if your

764
00:29:30,380 --> 00:29:34,030
production rules would detect something

765
00:29:32,090 --> 00:29:36,050
like that if it actually gets executed

766
00:29:34,030 --> 00:29:37,580
that's kind of the point that's what

767
00:29:36,050 --> 00:29:39,560
we're trying to achieve here so here we

768
00:29:37,580 --> 00:29:41,449
have a deployed on a couple of Windows

769
00:29:39,560 --> 00:29:43,340
systems and one Linux system is just a

770
00:29:41,450 --> 00:29:45,500
small screen shot it's cross-platform so

771
00:29:43,340 --> 00:29:46,909
it's got Mac OS as well works pretty

772
00:29:45,500 --> 00:29:49,370
well and then you can start creating

773
00:29:46,910 --> 00:29:51,230
what we call an adversary an adversary

774
00:29:49,370 --> 00:29:52,939
consists of a number of phases and a

775
00:29:51,230 --> 00:29:55,010
number of phases consists of course of

776
00:29:52,940 --> 00:29:57,920
abilities those are those matter attack

777
00:29:55,010 --> 00:30:00,470
techniques so here we see an screenshot

778
00:29:57,920 --> 00:30:03,140
of the built-in adversary which is the

779
00:30:00,470 --> 00:30:05,090
nosy neighbor which is put in more its

780
00:30:03,140 --> 00:30:06,590
nosy but it's also very noisy because it

781
00:30:05,090 --> 00:30:07,679
runs almost everything which is in

782
00:30:06,590 --> 00:30:09,510
caldera

783
00:30:07,680 --> 00:30:11,940
more not in a second and then of course

784
00:30:09,510 --> 00:30:13,560
it starts running and you get some live

785
00:30:11,940 --> 00:30:16,080
feedback on what it's doing what's going

786
00:30:13,560 --> 00:30:17,730
on and so on so here we can see OS

787
00:30:16,080 --> 00:30:19,020
number one inserting the history it fell

788
00:30:17,730 --> 00:30:21,150
to rank two all the steps

789
00:30:19,020 --> 00:30:22,680
bear in mind that it does take a bit of

790
00:30:21,150 --> 00:30:24,450
time because everything runs live of

791
00:30:22,680 --> 00:30:26,820
course it's doing all that as you go

792
00:30:24,450 --> 00:30:29,190
along so how do you get it up and

793
00:30:26,820 --> 00:30:33,389
running straight forward twist on this

794
00:30:29,190 --> 00:30:34,860
PowerShell command so I'm just running

795
00:30:33,390 --> 00:30:37,350
this PowerShell command together send

796
00:30:34,860 --> 00:30:39,629
cattle examining which is my executable

797
00:30:37,350 --> 00:30:41,850
and then it's stirr it connects back to

798
00:30:39,630 --> 00:30:44,190
of course a certain endpoint which in

799
00:30:41,850 --> 00:30:45,959
this case is the c2 demolition - Hector

800
00:30:44,190 --> 00:30:47,730
dot-com port 888

801
00:30:45,960 --> 00:30:49,710
you can even specify the groups that it

802
00:30:47,730 --> 00:30:52,140
should join because you can add multiple

803
00:30:49,710 --> 00:30:53,340
groups to split up certain systems into

804
00:30:52,140 --> 00:30:55,020
different groups that you want to treat

805
00:30:53,340 --> 00:30:57,679
differently in caldera pretty

806
00:30:55,020 --> 00:30:57,680
straightforward

807
00:30:58,380 --> 00:31:03,810
as I mentioned you could say well Kerry

808
00:31:01,080 --> 00:31:06,780
but you've got squid language much MZ

809
00:31:03,810 --> 00:31:09,840
what's people looking it's some pretty

810
00:31:06,780 --> 00:31:12,930
decently it's event ID for 1:04 which

811
00:31:09,840 --> 00:31:16,139
kind of removes all the things if you

812
00:31:12,930 --> 00:31:19,410
enable scripting there's no way of doing

813
00:31:16,140 --> 00:31:21,360
stuff PowerShell without getting another

814
00:31:19,410 --> 00:31:23,970
executable or a binary like insecure

815
00:31:21,360 --> 00:31:25,620
partial for example but proper normal

816
00:31:23,970 --> 00:31:27,540
partial execution is going to be caught

817
00:31:25,620 --> 00:31:29,219
of course because it's very strong it's

818
00:31:27,540 --> 00:31:30,930
pretty effective there's constraint

819
00:31:29,220 --> 00:31:33,030
language mode which of course limits

820
00:31:30,930 --> 00:31:34,830
PowerShell to the basics which is going

821
00:31:33,030 --> 00:31:36,840
to break a lot of this execution and

822
00:31:34,830 --> 00:31:40,740
there's MZ which is the anti-malware

823
00:31:36,840 --> 00:31:43,139
scanning interface which is a real-time

824
00:31:40,740 --> 00:31:45,630
interface between your scripting engine

825
00:31:43,140 --> 00:31:48,000
like PowerShell and for example your

826
00:31:45,630 --> 00:31:49,440
defender ATP or AV engine to check a

827
00:31:48,000 --> 00:31:52,490
descriptor I'm going to run these

828
00:31:49,440 --> 00:31:55,080
malicious or not I can tell you if you

829
00:31:52,490 --> 00:31:58,020
the power cuts module which runs

830
00:31:55,080 --> 00:31:59,460
mimikatz and MZ is enabled no way write

831
00:31:58,020 --> 00:32:00,720
something gonna work even constraint

832
00:31:59,460 --> 00:32:02,250
language mode is going to trigger and

833
00:32:00,720 --> 00:32:04,710
say that's not something you should be

834
00:32:02,250 --> 00:32:07,020
doing so do note that this is always

835
00:32:04,710 --> 00:32:09,360
going to be the case so the idea is not

836
00:32:07,020 --> 00:32:11,129
to detect the actual agent but it's dect

837
00:32:09,360 --> 00:32:15,270
and to see how all the techniques are

838
00:32:11,130 --> 00:32:18,060
being booked or detected so that's the

839
00:32:15,270 --> 00:32:20,100
entire thing in one very impressive

840
00:32:18,060 --> 00:32:21,570
slide if I say so myself

841
00:32:20,100 --> 00:32:23,850
abilities there and then you can see

842
00:32:21,570 --> 00:32:25,529
okay is powershell ethics or linux and

843
00:32:23,850 --> 00:32:27,478
then it starts running on two different

844
00:32:25,529 --> 00:32:29,850
groups can be groups that you name

845
00:32:27,479 --> 00:32:32,399
custom like foo and bar could be Windows

846
00:32:29,850 --> 00:32:34,109
OSX or Linux and so on all depends on

847
00:32:32,399 --> 00:32:38,029
what you're trying to achieve let's do a

848
00:32:34,109 --> 00:32:38,029
small first demo before we continue I

849
00:32:40,220 --> 00:32:51,149
don't do videos I do it live and now

850
00:32:46,559 --> 00:32:57,899
everything breaks of course I'm using

851
00:32:51,149 --> 00:33:00,238
Kali because we've got our lab

852
00:32:57,899 --> 00:33:05,309
environment of course I'm running it in

853
00:33:00,239 --> 00:33:08,700
dark modes I'm not because that would be

854
00:33:05,309 --> 00:33:11,759
unreadable so what do we have here let

855
00:33:08,700 --> 00:33:13,889
me just show you very quickly this is

856
00:33:11,759 --> 00:33:15,869
one system which is windows 10 machine

857
00:33:13,889 --> 00:33:17,668
which is just hosted somewhere in my lap

858
00:33:15,869 --> 00:33:20,519
environments it's actually spoon up

859
00:33:17,669 --> 00:33:22,499
using ansible so a super number of

860
00:33:20,519 --> 00:33:24,239
machines there's a DC there there's some

861
00:33:22,499 --> 00:33:25,649
an elastic machine for monitoring

862
00:33:24,239 --> 00:33:28,289
there's cimabue into machines we

863
00:33:25,649 --> 00:33:29,849
understand Windows Server 2008 a whole

864
00:33:28,289 --> 00:33:32,629
bunch of system is connected okay this

865
00:33:29,849 --> 00:33:35,249
is one of them so let's have a look

866
00:33:32,629 --> 00:33:38,039
we've got three modules here or key

867
00:33:35,249 --> 00:33:40,889
plugins at the top there's one attack

868
00:33:38,039 --> 00:33:43,529
which is kinda lame it's just a locally

869
00:33:40,889 --> 00:33:45,269
hosted attack framework okay

870
00:33:43,529 --> 00:33:46,889
it's not even the Navigator it's fine

871
00:33:45,269 --> 00:33:48,509
okay but I could I could also go online

872
00:33:46,889 --> 00:33:50,428
so I'll just leave it at that that's

873
00:33:48,509 --> 00:33:52,259
fine thank you for I think that the

874
00:33:50,429 --> 00:33:54,269
chain is of course the big one I love

875
00:33:52,259 --> 00:33:56,249
the chain it has all the functionalities

876
00:33:54,269 --> 00:33:57,749
all of the capabilities so what can we

877
00:33:56,249 --> 00:34:05,210
do in the chain let me maybe zoom in a

878
00:33:57,749 --> 00:34:05,210
bit okay no zooming for now

879
00:34:08,810 --> 00:34:15,750
very excellent so we've got groups

880
00:34:13,500 --> 00:34:17,969
abilities facts adversaries operations

881
00:34:15,750 --> 00:34:19,830
if you've entered groups you can see all

882
00:34:17,969 --> 00:34:22,109
of my different systems I've got some

883
00:34:19,830 --> 00:34:24,239
Windows machines Linux windows as I

884
00:34:22,110 --> 00:34:26,700
showed you in the screenshot you get

885
00:34:24,239 --> 00:34:28,529
some information whether or not they're

886
00:34:26,699 --> 00:34:31,949
running or whether they check in all of

887
00:34:28,530 --> 00:34:33,720
these systems are currently online any

888
00:34:31,949 --> 00:34:35,310
ones in the audience and I know one or

889
00:34:33,719 --> 00:34:36,989
two are who is connected to a lab

890
00:34:35,310 --> 00:34:46,650
environment if you now kill the stack

891
00:34:36,989 --> 00:34:48,120
I'm gonna murder you small warning you

892
00:34:46,650 --> 00:34:49,950
can see the attack tactics so they're

893
00:34:48,120 --> 00:34:51,330
divided amongst tactics and then you can

894
00:34:49,949 --> 00:34:53,069
go into the different techniques which

895
00:34:51,330 --> 00:34:55,590
are available which are translated as

896
00:34:53,070 --> 00:34:58,350
beauties for example collector or

897
00:34:55,590 --> 00:34:59,070
details on windows for G Eric that's

898
00:34:58,350 --> 00:35:01,470
impressive

899
00:34:59,070 --> 00:35:03,270
gosh a right so show me the ARP table

900
00:35:01,470 --> 00:35:04,830
it's pretty simple okay but it's one

901
00:35:03,270 --> 00:35:07,110
technique which is essentially also

902
00:35:04,830 --> 00:35:08,819
being used by adversaries so you could

903
00:35:07,110 --> 00:35:13,620
write your own very quickly of course to

904
00:35:08,820 --> 00:35:16,020
add things like this fancier ones let me

905
00:35:13,620 --> 00:35:18,420
have a look at this rock topography is

906
00:35:16,020 --> 00:35:20,490
pretty lame we'll just collation a weak

907
00:35:18,420 --> 00:35:24,540
executable files credential ax is pretty

908
00:35:20,490 --> 00:35:26,819
big for example here you have run power

909
00:35:24,540 --> 00:35:29,460
cuts credentials in registry finding

910
00:35:26,820 --> 00:35:31,470
private keys running put them that's a

911
00:35:29,460 --> 00:35:33,420
new one more on that in a second

912
00:35:31,470 --> 00:35:35,430
execution so you can find your different

913
00:35:33,420 --> 00:35:37,320
ones when the execution is a new one

914
00:35:35,430 --> 00:35:38,430
that we added as well I'll explain a bit

915
00:35:37,320 --> 00:35:40,410
more on that in a second

916
00:35:38,430 --> 00:35:42,210
she's got different things that you can

917
00:35:40,410 --> 00:35:43,920
add it's always the same thing right

918
00:35:42,210 --> 00:35:46,230
it's a command it's all PowerShell

919
00:35:43,920 --> 00:35:48,090
driven if it works in a PowerShell

920
00:35:46,230 --> 00:35:50,010
you can also run it like that in an

921
00:35:48,090 --> 00:35:54,900
ability if you will which is pretty

922
00:35:50,010 --> 00:35:56,640
straightforward facts customization so

923
00:35:54,900 --> 00:35:58,110
here for example you can add usernames

924
00:35:56,640 --> 00:36:00,150
or passwords that can be used by

925
00:35:58,110 --> 00:36:01,710
different abilities in caldera if you

926
00:36:00,150 --> 00:36:03,330
would like to connect using a certain

927
00:36:01,710 --> 00:36:05,400
username or password you can add those

928
00:36:03,330 --> 00:36:07,500
things inside the facts or even

929
00:36:05,400 --> 00:36:09,150
brute-forcing that kind of stuff you can

930
00:36:07,500 --> 00:36:10,980
customize that a bit more so you don't

931
00:36:09,150 --> 00:36:13,170
have to do it and have an ability level

932
00:36:10,980 --> 00:36:16,330
you can do it in the facts as well then

933
00:36:13,170 --> 00:36:19,130
of course as the adversaries which show

934
00:36:16,330 --> 00:36:20,180
this all of the different phases that

935
00:36:19,130 --> 00:36:22,280
they went to and all the different

936
00:36:20,180 --> 00:36:25,220
techniques that they run so if you run

937
00:36:22,280 --> 00:36:27,260
this adversary well it's gonna be fun so

938
00:36:25,220 --> 00:36:29,868
let's have a very quick look let's add

939
00:36:27,260 --> 00:36:32,359
one my GUI is a bit messed up of course

940
00:36:29,869 --> 00:36:37,100
because I zoomed in but let's add this

941
00:36:32,359 --> 00:36:38,900
one here test one keyboard layout

942
00:36:37,100 --> 00:36:40,190
nosy neighbor right why not because I'm

943
00:36:38,900 --> 00:36:42,590
lazy I'll just run this on all my

944
00:36:40,190 --> 00:36:44,300
Windows machines I don't want cleanup

945
00:36:42,590 --> 00:36:46,340
actually get called to clean up the

946
00:36:44,300 --> 00:36:48,619
artifacts or it drops as well because

947
00:36:46,340 --> 00:36:50,600
you can make additional executables

948
00:36:48,619 --> 00:36:52,730
imagine that you for example want to run

949
00:36:50,600 --> 00:36:54,500
actual mini cats you don't even want to

950
00:36:52,730 --> 00:36:56,810
do power cuts you want to actually put

951
00:36:54,500 --> 00:36:58,820
in mimic a TXE it's perfectly fine you

952
00:36:56,810 --> 00:37:00,980
can do it but do you want to clean it up

953
00:36:58,820 --> 00:37:02,359
afterwards that's the question right so

954
00:37:00,980 --> 00:37:06,200
you can add that or you can change that

955
00:37:02,359 --> 00:37:08,330
so let's run this thing this thing is

956
00:37:06,200 --> 00:37:13,040
super annoying there you go it's running

957
00:37:08,330 --> 00:37:15,590
now amazing this is the time where you

958
00:37:13,040 --> 00:37:16,880
go and get a coffee and have a chat talk

959
00:37:15,590 --> 00:37:18,920
to some friends that you haven't seen

960
00:37:16,880 --> 00:37:22,030
often and of course the nice thing is it

961
00:37:18,920 --> 00:37:24,380
shows the output of the commands as well

962
00:37:22,030 --> 00:37:27,290
I'm clearing the history it has no

963
00:37:24,380 --> 00:37:28,940
output superb there's more though that's

964
00:37:27,290 --> 00:37:30,710
more of them coming so I'll leave this

965
00:37:28,940 --> 00:37:31,970
run for a while and so you can actually

966
00:37:30,710 --> 00:37:34,010
live see what's going on

967
00:37:31,970 --> 00:37:36,560
I could even notice here on my system

968
00:37:34,010 --> 00:37:38,180
now this guy this is one of the systems

969
00:37:36,560 --> 00:37:40,910
in the windows group so of course it's a

970
00:37:38,180 --> 00:37:42,680
victim if you will of this attack it

971
00:37:40,910 --> 00:37:48,399
will run all those commands on the

972
00:37:42,680 --> 00:37:51,169
system as well just a little bit let's

973
00:37:48,400 --> 00:37:52,670
just ok let's create a new adversary

974
00:37:51,170 --> 00:37:55,040
which is a bit more limited because this

975
00:37:52,670 --> 00:37:56,960
is a pretty noisy one I even prepared a

976
00:37:55,040 --> 00:37:59,270
small cheat sheet because if you as I

977
00:37:56,960 --> 00:38:01,280
mentioned copying you you IDs or even

978
00:37:59,270 --> 00:38:04,759
typing them is a mess because you have

979
00:38:01,280 --> 00:38:06,440
to reference them using this UUID this

980
00:38:04,760 --> 00:38:08,750
is a small feature that caldera might

981
00:38:06,440 --> 00:38:10,490
want to add that you can actually search

982
00:38:08,750 --> 00:38:12,440
by name instead of the UID which is a

983
00:38:10,490 --> 00:38:15,049
bit of a mess so this one will actually

984
00:38:12,440 --> 00:38:16,970
disable your defender ATP for example or

985
00:38:15,050 --> 00:38:18,500
disable real-time protection it just

986
00:38:16,970 --> 00:38:20,569
uses the PowerShell command to get that

987
00:38:18,500 --> 00:38:22,880
done so you just copy this one and say

988
00:38:20,570 --> 00:38:25,560
for example ok let's create an adversary

989
00:38:22,880 --> 00:38:28,020
here switch the thing to add

990
00:38:25,560 --> 00:38:30,360
this is the broken adversary so it uses

991
00:38:28,020 --> 00:38:36,090
the built-in techniques and abilities of

992
00:38:30,360 --> 00:38:37,410
course test select the face face one so

993
00:38:36,090 --> 00:38:39,450
that's the first step that you want to

994
00:38:37,410 --> 00:38:43,049
achieve and I'll just copy the entire ID

995
00:38:39,450 --> 00:38:44,100
in there attach so this is a nice one

996
00:38:43,050 --> 00:38:46,050
this is the whole thing that I mentioned

997
00:38:44,100 --> 00:38:48,900
about the GUI it actually attached now

998
00:38:46,050 --> 00:38:51,780
to this one the the nosy neighbor

999
00:38:48,900 --> 00:38:53,910
never mind quick refresh you guys all

1000
00:38:51,780 --> 00:38:56,190
love caldera now of course Eric it's

1001
00:38:53,910 --> 00:39:00,149
super stable a couple of those little

1002
00:38:56,190 --> 00:39:08,520
things in there at blue contest

1003
00:39:00,150 --> 00:39:10,800
excellent attach let's add power cuts to

1004
00:39:08,520 --> 00:39:12,870
see if it works let's see what that one

1005
00:39:10,800 --> 00:39:15,480
does if I'm running almost system which

1006
00:39:12,870 --> 00:39:17,370
has no more defender because I'm the IDS

1007
00:39:15,480 --> 00:39:18,600
I'm stopping it in the first phase so

1008
00:39:17,370 --> 00:39:20,670
let me see if I can actually do that in

1009
00:39:18,600 --> 00:39:22,140
the second phase there we go attach this

1010
00:39:20,670 --> 00:39:24,270
one as well boom

1011
00:39:22,140 --> 00:39:28,920
so it's also overlapping a bit but

1012
00:39:24,270 --> 00:39:35,190
that's because of my GUI screen thank

1013
00:39:28,920 --> 00:39:37,290
God I'm not selling it right so let's

1014
00:39:35,190 --> 00:39:39,090
have a look at the operations the one

1015
00:39:37,290 --> 00:39:40,710
that I run is still ongoing let's have a

1016
00:39:39,090 --> 00:39:42,300
look at the groups I'm now going to

1017
00:39:40,710 --> 00:39:43,560
target one specific system because I

1018
00:39:42,300 --> 00:39:46,050
don't want to target all two because

1019
00:39:43,560 --> 00:39:48,090
then you're gonna really fall asleep so

1020
00:39:46,050 --> 00:39:50,730
let's just go for one and I'll call it

1021
00:39:48,090 --> 00:39:53,070
blue chrome click test and I'll select

1022
00:39:50,730 --> 00:39:54,780
this one machine and I'll add it to my

1023
00:39:53,070 --> 00:39:56,520
book on the group which you'll see here

1024
00:39:54,780 --> 00:39:58,170
it gets the tag blue comb so it's now a

1025
00:39:56,520 --> 00:40:01,200
member of that group as well so let's

1026
00:39:58,170 --> 00:40:04,950
add another operation which I'll call

1027
00:40:01,200 --> 00:40:06,629
blue comb I'll use my blue cone

1028
00:40:04,950 --> 00:40:09,629
adversary and I'll just start it my blue

1029
00:40:06,630 --> 00:40:12,000
comb thing as well my broken group start

1030
00:40:09,630 --> 00:40:14,390
boom starts running start to disable

1031
00:40:12,000 --> 00:40:14,390
Windows Defender

1032
00:40:17,349 --> 00:40:24,519
let's have a look still running ah

1033
00:40:20,910 --> 00:40:25,719
disabled now it seems actually don't

1034
00:40:24,519 --> 00:40:29,758
know if I turn it on well we'll see

1035
00:40:25,719 --> 00:40:29,759
we'll see the output in just a second I

1036
00:40:31,440 --> 00:40:37,299
was gonna do one joke but I ruin it for

1037
00:40:34,749 --> 00:40:39,578
me where did the hacker go but it's all

1038
00:40:37,299 --> 00:40:46,209
over Twitter at the moment you haven't

1039
00:40:39,579 --> 00:40:48,549
heard ok he ran somewhere ok let me just

1040
00:40:46,209 --> 00:40:50,140
switch here to see if we have to go on

1041
00:40:48,549 --> 00:40:54,459
with the awkward jokes or if we actually

1042
00:40:50,140 --> 00:40:56,049
have some output already so this is my

1043
00:40:54,459 --> 00:40:57,578
output from the first operation that I'm

1044
00:40:56,049 --> 00:40:59,079
running you can see it's running to all

1045
00:40:57,579 --> 00:41:01,390
the different windows House is getting a

1046
00:40:59,079 --> 00:41:03,219
lot of info collecting ARP details so

1047
00:41:01,390 --> 00:41:04,509
you can get all that info here here you

1048
00:41:03,219 --> 00:41:05,979
can see the actual output of an herb

1049
00:41:04,509 --> 00:41:08,489
command and so on and so on and so on

1050
00:41:05,979 --> 00:41:12,160
keeps on running which is pretty nice

1051
00:41:08,489 --> 00:41:14,049
again the GUI sometimes is a bit of do

1052
00:41:12,160 --> 00:41:16,569
sometimes have to refresh a bit there's

1053
00:41:14,049 --> 00:41:19,599
one of those things this one is a bit

1054
00:41:16,569 --> 00:41:21,279
slow though normally this one wouldn't

1055
00:41:19,599 --> 00:41:23,440
have any output but let's ah there we go

1056
00:41:21,279 --> 00:41:25,569
it's green the green part by the way

1057
00:41:23,440 --> 00:41:27,699
it's just based on the status code so

1058
00:41:25,569 --> 00:41:29,349
even if the command doesn't exit with if

1059
00:41:27,699 --> 00:41:30,729
the command doesn't exit with error but

1060
00:41:29,349 --> 00:41:32,529
you didn't get the internet result it

1061
00:41:30,729 --> 00:41:34,390
will still show green which is an

1062
00:41:32,529 --> 00:41:35,619
important remark it's not that smart to

1063
00:41:34,390 --> 00:41:43,209
actually realise whether or not your

1064
00:41:35,619 --> 00:41:45,009
attack actually worked but running power

1065
00:41:43,209 --> 00:41:49,109
cuts let me see if these guys freaking

1066
00:41:45,009 --> 00:41:49,109
out already not yet it seems to be ok

1067
00:41:51,660 --> 00:41:59,308
internet it's actually running locally

1068
00:41:55,869 --> 00:41:59,309
inside my lab environment and

1069
00:42:02,910 --> 00:42:09,129
mimikatz output he'll see secures

1070
00:42:05,979 --> 00:42:10,058
acquired as a key import see look I

1071
00:42:09,130 --> 00:42:12,099
dumped credentials

1072
00:42:10,059 --> 00:42:14,289
no I didn't that's an error message it's

1073
00:42:12,099 --> 00:42:16,940
perfectly acceptable because that's what

1074
00:42:14,289 --> 00:42:18,770
I predicted this isn't older

1075
00:42:16,940 --> 00:42:21,170
ability which is using the invoke

1076
00:42:18,770 --> 00:42:23,420
mimikatz of ps1 if you google it you'll

1077
00:42:21,170 --> 00:42:25,010
soon figure out that you need to use a

1078
00:42:23,420 --> 00:42:26,540
newer version of mimic ads it has

1079
00:42:25,010 --> 00:42:28,880
nothing to do with credential guard or

1080
00:42:26,540 --> 00:42:30,259
else's protection it's just a small book

1081
00:42:28,880 --> 00:42:32,390
in mimic ads on newer versions of

1082
00:42:30,260 --> 00:42:36,470
Windows so this shows you need to

1083
00:42:32,390 --> 00:42:38,480
customize excellent next part so you

1084
00:42:36,470 --> 00:42:40,098
need to customize a neat boot on top of

1085
00:42:38,480 --> 00:42:44,690
this because it doesn't just all work

1086
00:42:40,099 --> 00:42:46,220
like that right so how do you develop

1087
00:42:44,690 --> 00:42:48,260
stuff right developing all there are

1088
00:42:46,220 --> 00:42:49,520
plugins so you want to probably start

1089
00:42:48,260 --> 00:42:52,069
developing your own stuff

1090
00:42:49,520 --> 00:42:55,609
and there's a couple different levels of

1091
00:42:52,069 --> 00:42:57,800
developing stuff fair warning I'm not

1092
00:42:55,609 --> 00:43:00,380
the developer don't let me anywhere near

1093
00:42:57,800 --> 00:43:02,060
your codebase I'll write very ugly code

1094
00:43:00,380 --> 00:43:06,050
that might work but it's absolutely

1095
00:43:02,060 --> 00:43:08,000
disgusting so couple of levels right

1096
00:43:06,050 --> 00:43:09,579
using built-in adversary this one I just

1097
00:43:08,000 --> 00:43:11,990
showed you it's pretty straightforward

1098
00:43:09,579 --> 00:43:13,670
you can build adversaries with existing

1099
00:43:11,990 --> 00:43:15,589
abilities that's also when I showed you

1100
00:43:13,670 --> 00:43:17,720
I create my own able adversary with a

1101
00:43:15,589 --> 00:43:20,000
custom ability now with an existing

1102
00:43:17,720 --> 00:43:21,560
ability my bad you can develop your own

1103
00:43:20,000 --> 00:43:23,329
custom abilities which I'll show you in

1104
00:43:21,560 --> 00:43:24,380
a second and you can even develop your

1105
00:43:23,329 --> 00:43:26,780
own custom plugins

1106
00:43:24,380 --> 00:43:29,060
what's plug-in well the entire chain

1107
00:43:26,780 --> 00:43:30,530
that I showed you that's a plug-in one

1108
00:43:29,060 --> 00:43:33,109
of the things one of the things called

1109
00:43:30,530 --> 00:43:35,510
doesn't have for example is a nice link

1110
00:43:33,109 --> 00:43:36,589
to the attack navigator which would be

1111
00:43:35,510 --> 00:43:38,210
nice right it's my turn

1112
00:43:36,589 --> 00:43:40,190
why wouldn't they build it I don't know

1113
00:43:38,210 --> 00:43:42,619
they're building other things which is

1114
00:43:40,190 --> 00:43:44,030
very much appreciated but we decided to

1115
00:43:42,619 --> 00:43:46,130
give them a hand and we build our own

1116
00:43:44,030 --> 00:43:47,839
plugin to actually export to my tech

1117
00:43:46,130 --> 00:43:50,030
navigator view so you can run your

1118
00:43:47,839 --> 00:43:51,890
attacks and immediately see inside your

1119
00:43:50,030 --> 00:43:53,869
attack navigator okay what's going on

1120
00:43:51,890 --> 00:43:58,089
what do I detect what do I not detect

1121
00:43:53,869 --> 00:44:00,859
which is pretty nice yes documentation

1122
00:43:58,089 --> 00:44:02,540
it's getting better but since the change

1123
00:44:00,859 --> 00:44:04,098
from version 1 to 2 a lot of the

1124
00:44:02,540 --> 00:44:06,170
documentation is still from version 1

1125
00:44:04,099 --> 00:44:09,020
and there's it's not like version 2 is

1126
00:44:06,170 --> 00:44:11,329
30% different it's 100% difference from

1127
00:44:09,020 --> 00:44:12,770
version 1 so doesn't really work you

1128
00:44:11,329 --> 00:44:15,170
really need to use version 2

1129
00:44:12,770 --> 00:44:17,300
documentation to get things done so this

1130
00:44:15,170 --> 00:44:19,460
is a custom ability you can imagine here

1131
00:44:17,300 --> 00:44:21,829
you side and agree already this is

1132
00:44:19,460 --> 00:44:23,240
straightforward it's easiest biofuel if

1133
00:44:21,829 --> 00:44:25,490
you know how to write some powerful

1134
00:44:23,240 --> 00:44:28,430
commands well congratulations you can

1135
00:44:25,490 --> 00:44:30,109
write accountability so why

1136
00:44:28,430 --> 00:44:31,940
started contributing right you can add

1137
00:44:30,110 --> 00:44:33,740
stuff you can add stuff to take it to

1138
00:44:31,940 --> 00:44:35,270
purple and why not right those are

1139
00:44:33,740 --> 00:44:36,919
things you can definitely do we've been

1140
00:44:35,270 --> 00:44:38,720
working quite a bit on this to build

1141
00:44:36,920 --> 00:44:40,490
more and more of these modules because

1142
00:44:38,720 --> 00:44:44,839
it's pretty nice in your purple team

1143
00:44:40,490 --> 00:44:47,180
approach if you will now this guy small

1144
00:44:44,840 --> 00:44:48,920
word this is actually building a lot of

1145
00:44:47,180 --> 00:44:51,200
the brains on our side I decided to also

1146
00:44:48,920 --> 00:44:52,700
give him a small shot at its maximum do

1147
00:44:51,200 --> 00:44:53,779
not recruit Maxime I will hunt you down

1148
00:44:52,700 --> 00:44:55,220
and I'll find you

1149
00:44:53,780 --> 00:44:57,020
he's been working on a lot of these

1150
00:44:55,220 --> 00:44:59,750
plugins it's pretty straightforward you

1151
00:44:57,020 --> 00:45:01,910
can add your own plugins in the plugins

1152
00:44:59,750 --> 00:45:03,380
folder of course it's all peyten so all

1153
00:45:01,910 --> 00:45:04,850
the plugins are written in Python so you

1154
00:45:03,380 --> 00:45:06,650
do have to know button to be able to do

1155
00:45:04,850 --> 00:45:08,600
it and then you can start enabling them

1156
00:45:06,650 --> 00:45:10,040
and you can start doing things so let's

1157
00:45:08,600 --> 00:45:15,470
have a look at the custom plug-in as

1158
00:45:10,040 --> 00:45:22,550
well second one first one went 100

1159
00:45:15,470 --> 00:45:31,279
percent okay so back into my caldera

1160
00:45:22,550 --> 00:45:32,750
stack mimikatz on the system to dump

1161
00:45:31,280 --> 00:45:34,190
ashes right so you have a bit more

1162
00:45:32,750 --> 00:45:35,660
brains than you think well maybe I

1163
00:45:34,190 --> 00:45:37,490
shouldn't be just running Macca's

1164
00:45:35,660 --> 00:45:39,020
because it's kind of noisy right

1165
00:45:37,490 --> 00:45:41,120
imagine you're dumping credentials from

1166
00:45:39,020 --> 00:45:44,630
L source how would you detect mimikatz

1167
00:45:41,120 --> 00:45:48,220
it's a question make it clear that's the

1168
00:45:44,630 --> 00:45:48,220
questions I'm expecting the feedback

1169
00:45:49,800 --> 00:46:01,950
no one oh sorry yes sir that's a nice

1170
00:46:00,240 --> 00:46:03,270
one look at the number of bytes read

1171
00:46:01,950 --> 00:46:05,430
from the ELSA process that's pretty

1172
00:46:03,270 --> 00:46:07,410
impressive I was gonna say look for

1173
00:46:05,430 --> 00:46:09,000
event ID 10 for example his mom I look

1174
00:46:07,410 --> 00:46:10,350
for access to all souls but it's a bit

1175
00:46:09,000 --> 00:46:11,850
more prone to false positives in mind

1176
00:46:10,350 --> 00:46:14,759
but yes that's one approach very

1177
00:46:11,850 --> 00:46:16,080
effective pretty nice a bad idea would

1178
00:46:14,760 --> 00:46:18,600
be to say well I'll look for mimic at

1179
00:46:16,080 --> 00:46:20,490
the eggsy right or I'll look for did you

1180
00:46:18,600 --> 00:46:22,319
see the latest one in defender like

1181
00:46:20,490 --> 00:46:24,419
Microsoft Defender the latest detection

1182
00:46:22,320 --> 00:46:27,530
that they added it's pretty nice one if

1183
00:46:24,420 --> 00:46:29,610
you run notepad.exe second one second

1184
00:46:27,530 --> 00:46:32,190
password it's actually triggers because

1185
00:46:29,610 --> 00:46:33,360
it says that's a bad process which is

1186
00:46:32,190 --> 00:46:35,190
interesting so they're just looking for

1187
00:46:33,360 --> 00:46:38,310
the actual arguments you're passing to

1188
00:46:35,190 --> 00:46:39,480
the command which is stupid from one

1189
00:46:38,310 --> 00:46:40,860
side but it's actually also very

1190
00:46:39,480 --> 00:46:42,150
effective because there's no reason why

1191
00:46:40,860 --> 00:46:44,250
someone would want note but we check

1192
00:46:42,150 --> 00:46:46,740
your also I would guess but whatever

1193
00:46:44,250 --> 00:46:48,510
when I showed up now here we have this

1194
00:46:46,740 --> 00:46:51,330
one for example you say ok but let's

1195
00:46:48,510 --> 00:46:53,700
just adapt this and let's just run power

1196
00:46:51,330 --> 00:46:56,069
them right so we could just use power

1197
00:46:53,700 --> 00:46:58,290
the important problem we can use put

1198
00:46:56,070 --> 00:47:00,030
them put uses internals - it's signed by

1199
00:46:58,290 --> 00:47:02,400
well Microsoft it's part of these

1200
00:47:00,030 --> 00:47:03,840
internals it's Apple Microsoft - it's

1201
00:47:02,400 --> 00:47:06,090
not installed by default but you can

1202
00:47:03,840 --> 00:47:08,310
very easily add it typically doesn't get

1203
00:47:06,090 --> 00:47:10,290
picked up because well it's a normal

1204
00:47:08,310 --> 00:47:11,850
tool so it might be better to use this

1205
00:47:10,290 --> 00:47:18,180
one alright so you could say ok but

1206
00:47:11,850 --> 00:47:22,580
let's just add our own ability let's put

1207
00:47:18,180 --> 00:47:22,580
it under the decent category

1208
00:47:25,450 --> 00:47:35,299
keyboards so that's the reason why my

1209
00:47:33,190 --> 00:47:37,820
still showing up because I didn't remove

1210
00:47:35,300 --> 00:47:40,130
it afterwards so you can see the four

1211
00:47:37,820 --> 00:47:42,800
one eight one there and I actually added

1212
00:47:40,130 --> 00:47:45,650
it well couple of hours ago you can see

1213
00:47:42,800 --> 00:47:47,510
there four one eight FBD for something

1214
00:47:45,650 --> 00:47:49,880
like that it's not part of your

1215
00:47:47,510 --> 00:47:51,770
traditional if you move so what does it

1216
00:47:49,880 --> 00:47:55,040
do very simple start process because

1217
00:47:51,770 --> 00:47:57,170
it's power it runs put them 64 eggsy

1218
00:47:55,040 --> 00:47:59,480
it uses the working at UFC users public

1219
00:47:57,170 --> 00:48:01,610
libraries because i don't know maybe

1220
00:47:59,480 --> 00:48:03,920
they don't loop there and it just uses

1221
00:48:01,610 --> 00:48:06,590
put them to them the else's lot eggsy

1222
00:48:03,920 --> 00:48:10,120
process as a foul call to recorded to

1223
00:48:06,590 --> 00:48:13,460
TMP right why not we can try

1224
00:48:10,120 --> 00:48:15,440
now that doesn't return it though right

1225
00:48:13,460 --> 00:48:18,620
because we still need to obtain that

1226
00:48:15,440 --> 00:48:20,360
problem we try to achieve is for just

1227
00:48:18,620 --> 00:48:22,520
dumping the else's memory we will just

1228
00:48:20,360 --> 00:48:23,960
retrieve it recover it on our site and

1229
00:48:22,520 --> 00:48:25,790
then of course we can just write offline

1230
00:48:23,960 --> 00:48:28,310
using maquettes alright that would be

1231
00:48:25,790 --> 00:48:29,750
one ID so it's a bit more stout if you

1232
00:48:28,310 --> 00:48:31,820
will so it's another variation of

1233
00:48:29,750 --> 00:48:33,230
credential damping which is nice to

1234
00:48:31,820 --> 00:48:35,120
start adding these kind of things it's

1235
00:48:33,230 --> 00:48:37,460
of course part of credential damping as

1236
00:48:35,120 --> 00:48:39,830
well a payload of course is put them

1237
00:48:37,460 --> 00:48:46,330
6402 eggsy because what we have now is

1238
00:48:39,830 --> 00:48:50,330
an additional payload Jesus Christ

1239
00:48:46,330 --> 00:48:52,460
it's too late I actually had my keyboard

1240
00:48:50,330 --> 00:48:53,810
layout on QWERTY until I until I decided

1241
00:48:52,460 --> 00:48:56,630
to walk up to the stage and I thought

1242
00:48:53,810 --> 00:49:01,190
I'll just change it to Belgian and it's

1243
00:48:56,630 --> 00:49:08,780
even worse this dots Oh

1244
00:49:01,190 --> 00:49:10,250
Siri and you can go into the payload

1245
00:49:08,780 --> 00:49:11,690
directory and you can see here for

1246
00:49:10,250 --> 00:49:15,530
example I have a couple of files there

1247
00:49:11,690 --> 00:49:17,690
and one of them is six six nine nine D

1248
00:49:15,530 --> 00:49:18,710
to e for to DLL one of them that's not

1249
00:49:17,690 --> 00:49:20,750
there is my problem

1250
00:49:18,710 --> 00:49:22,430
why not because as I mentioned I still

1251
00:49:20,750 --> 00:49:25,700
need to put it there I could just use

1252
00:49:22,430 --> 00:49:27,470
live versus internal suit come couple of

1253
00:49:25,700 --> 00:49:29,149
options I could also do this life right

1254
00:49:27,470 --> 00:49:30,830
I could just have my ability download it

1255
00:49:29,150 --> 00:49:32,570
and then execute it but I'll just help

1256
00:49:30,830 --> 00:49:38,450
it a bit and I'll just

1257
00:49:32,570 --> 00:49:40,750
just put it in just throw it here there

1258
00:49:38,450 --> 00:49:40,750
we go

1259
00:49:41,180 --> 00:49:44,960
the one thing though is if you add any

1260
00:49:43,220 --> 00:49:46,459
kind of a poutine caldera which is also

1261
00:49:44,960 --> 00:49:48,500
between you have to stupid delete the

1262
00:49:46,460 --> 00:49:51,530
database started again which started

1263
00:49:48,500 --> 00:49:53,690
which sounds very bad but it's like this

1264
00:49:51,530 --> 00:49:55,310
just get rid of the database started

1265
00:49:53,690 --> 00:49:57,290
again because every time it loads it

1266
00:49:55,310 --> 00:49:59,540
database its nodes all of the new

1267
00:49:57,290 --> 00:50:03,590
plugins there we go and all of the

1268
00:49:59,540 --> 00:50:05,330
abilities excellent so let's try again

1269
00:50:03,590 --> 00:50:07,400
let's go in here

1270
00:50:05,330 --> 00:50:12,710
but we have to refresh and real tentacle

1271
00:50:07,400 --> 00:50:16,670
there we go and then you can start

1272
00:50:12,710 --> 00:50:18,110
adding your own little things so I have

1273
00:50:16,670 --> 00:50:20,270
to recreate my group of course because

1274
00:50:18,110 --> 00:50:22,730
it no longer exists that's because I

1275
00:50:20,270 --> 00:50:31,930
restarted wait for the different systems

1276
00:50:22,730 --> 00:50:31,930
to come up well it's not very

1277
00:50:37,329 --> 00:50:43,180
I'm looking for wind 1001 already on

1278
00:50:40,849 --> 00:50:43,180
this one

1279
00:50:50,190 --> 00:50:54,320
there is accident

1280
00:50:55,490 --> 00:51:03,379
code test 1 2 3 ad group boom it's time

1281
00:51:00,860 --> 00:51:07,660
in test 23 excellent so let's again

1282
00:51:03,380 --> 00:51:09,830
create a small new adversary test 1 2 3

1283
00:51:07,660 --> 00:51:13,520
the naming convention I'm using is not

1284
00:51:09,830 --> 00:51:15,560
that effective I'm gonna get confused

1285
00:51:13,520 --> 00:51:18,050
about all of this this is the one that I

1286
00:51:15,560 --> 00:51:19,759
used to it's for 1/8 again it's a bit of

1287
00:51:18,050 --> 00:51:21,470
a mess you have to really know which one

1288
00:51:19,760 --> 00:51:25,550
that you're looking for I'm gonna attach

1289
00:51:21,470 --> 00:51:27,830
it here boom hmm

1290
00:51:25,550 --> 00:51:30,560
I'll put this one a face too because

1291
00:51:27,830 --> 00:51:33,500
just to be sure I'm gonna run the other

1292
00:51:30,560 --> 00:51:36,160
one first which is actually going to get

1293
00:51:33,500 --> 00:51:36,160
rid of defender

1294
00:51:42,299 --> 00:51:57,599
boom boom save it just want to tree and

1295
00:51:47,579 --> 00:51:59,789
I run it had adversary group the jitter

1296
00:51:57,599 --> 00:52:01,289
by the way is to add some randomness in

1297
00:51:59,789 --> 00:52:04,170
the communication between the actual

1298
00:52:01,289 --> 00:52:05,249
agent and c2 if you will depends if you

1299
00:52:04,170 --> 00:52:06,660
are actually if you actually want to

1300
00:52:05,249 --> 00:52:08,729
test whether you pick up on the c2 as

1301
00:52:06,660 --> 00:52:11,009
well start doing the same thing starts

1302
00:52:08,729 --> 00:52:13,649
trying to disable Windows Defender to be

1303
00:52:11,009 --> 00:52:17,369
fired it's pretty still was disabled -

1304
00:52:13,650 --> 00:52:19,289
there you go excellent and we leave that

1305
00:52:17,369 --> 00:52:21,299
to be let's have a look I already go to

1306
00:52:19,289 --> 00:52:23,309
the right directory which I think I go I

1307
00:52:21,299 --> 00:52:36,569
went for C users public or something

1308
00:52:23,309 --> 00:52:46,439
like hidden items excellent libraries

1309
00:52:36,569 --> 00:52:47,699
they recorded the MB so that follows so

1310
00:52:46,439 --> 00:52:50,269
we're gonna say that if I was just

1311
00:52:47,699 --> 00:52:50,269
created right now

1312
00:52:53,770 --> 00:53:02,320
it's probably no one smaller different

1313
00:52:55,570 --> 00:53:08,220
let me get rid of that guy I don't want

1314
00:53:02,320 --> 00:53:08,220
to open temple now it's raining problem

1315
00:53:11,520 --> 00:53:23,369
come on give it to me red means bad

1316
00:53:32,960 --> 00:53:45,720
this is linked to my executable didn't

1317
00:53:42,150 --> 00:53:46,609
that download them to the wrong

1318
00:53:45,720 --> 00:53:50,700
directory

1319
00:53:46,609 --> 00:53:52,078
the dangers of litem live demos right if

1320
00:53:50,700 --> 00:53:54,180
I would do it again now it would work

1321
00:53:52,079 --> 00:53:59,690
I'll run it again and lost I will finish

1322
00:53:54,180 --> 00:54:03,089
up on my blahblah operations there we go

1323
00:53:59,690 --> 00:54:11,520
and it again just one two four I'll call

1324
00:54:03,089 --> 00:54:14,160
this time there we go

1325
00:54:11,520 --> 00:54:15,869
I'll leave this to run but that's one

1326
00:54:14,160 --> 00:54:18,420
part right so that's just doing that

1327
00:54:15,869 --> 00:54:19,470
it's just running ability couple of

1328
00:54:18,420 --> 00:54:20,970
other things that you might want to

1329
00:54:19,470 --> 00:54:22,680
achieve it's actually still in my demo

1330
00:54:20,970 --> 00:54:24,209
you might want to say okay but Eric

1331
00:54:22,680 --> 00:54:25,980
you're doing a lot of things in caldera

1332
00:54:24,210 --> 00:54:27,990
now it's all isolate in that small

1333
00:54:25,980 --> 00:54:29,460
segment if you go back to the home

1334
00:54:27,990 --> 00:54:30,930
you'll actually see that there's an

1335
00:54:29,460 --> 00:54:33,869
interesting plug in there that we added

1336
00:54:30,930 --> 00:54:36,118
so that's called X it's called this is a

1337
00:54:33,869 --> 00:54:40,140
new plug-in if you will it doesn't exist

1338
00:54:36,119 --> 00:54:42,299
in caldera as such we've just created it

1339
00:54:40,140 --> 00:54:46,460
give us one or two more days to clean up

1340
00:54:42,299 --> 00:54:48,780
the code a bit it's pretty dirty it's

1341
00:54:46,460 --> 00:54:51,089
it's mainly Maximo actually we're done

1342
00:54:48,780 --> 00:54:51,839
it's very impressive work it's pretty

1343
00:54:51,089 --> 00:54:53,849
straightforward

1344
00:54:51,839 --> 00:54:55,619
it just creates a JSON response it

1345
00:54:53,849 --> 00:54:57,000
actually responds with an entire

1346
00:54:55,619 --> 00:54:58,710
overview of all different attack

1347
00:54:57,000 --> 00:55:00,030
techniques that you're using whether or

1348
00:54:58,710 --> 00:55:01,559
not those techniques are running

1349
00:55:00,030 --> 00:55:03,690
successfully on your different systems

1350
00:55:01,559 --> 00:55:06,000
so if you would want you could just say

1351
00:55:03,690 --> 00:55:07,440
okay give me the raw data it's pretty

1352
00:55:06,000 --> 00:55:10,140
limited now because I've just been

1353
00:55:07,440 --> 00:55:12,690
running some stupid little abilities if

1354
00:55:10,140 --> 00:55:14,308
you will you can just save it up as a

1355
00:55:12,690 --> 00:55:16,799
small JSON file I'll just go out

1356
00:55:14,309 --> 00:55:17,940
whatever I'm export to Jason and then of

1357
00:55:16,799 --> 00:55:19,890
course you could go to the attack

1358
00:55:17,940 --> 00:55:21,660
navigator you could go here and say okay

1359
00:55:19,890 --> 00:55:25,558
I want to load my own or create my own

1360
00:55:21,660 --> 00:55:29,640
layer and you could open existing layer

1361
00:55:25,559 --> 00:55:30,990
layer which is of course your weather I

1362
00:55:29,640 --> 00:55:36,420
draw it do it here

1363
00:55:30,990 --> 00:55:38,848
exports of Jason indicates okay what

1364
00:55:36,420 --> 00:55:40,619
what is actually working here I just run

1365
00:55:38,849 --> 00:55:41,670
credential dumping it's pretty red why

1366
00:55:40,619 --> 00:55:43,650
because it worked

1367
00:55:41,670 --> 00:55:44,880
I've been running that a few times

1368
00:55:43,650 --> 00:55:47,970
so it actually shows you look this is

1369
00:55:44,880 --> 00:55:49,800
how well you're doing which is pretty

1370
00:55:47,970 --> 00:55:51,450
nice so it's one small plugin you can

1371
00:55:49,800 --> 00:55:52,650
only think about well there's so many

1372
00:55:51,450 --> 00:55:54,540
different things you can do right you

1373
00:55:52,650 --> 00:55:57,240
can add-on stuff you can even automate a

1374
00:55:54,540 --> 00:55:58,980
link in between and you can adapt it's

1375
00:55:57,240 --> 00:56:00,509
pretty nice to see how well it's all

1376
00:55:58,980 --> 00:56:03,030
open source it's all there

1377
00:56:00,510 --> 00:56:09,380
let me see if my other model actually

1378
00:56:03,030 --> 00:56:09,380
stopped running how are we doing here

1379
00:56:25,730 --> 00:56:34,430
Karina accent so it executed then why

1380
00:56:31,560 --> 00:56:34,430
where's my file

1381
00:56:50,850 --> 00:56:59,490
this is interesting though just again

1382
00:56:55,620 --> 00:56:59,490
add capitals

1383
00:57:18,820 --> 00:57:24,550
wynton zero on the return section so

1384
00:57:21,880 --> 00:57:26,050
while this one is running our not hold

1385
00:57:24,550 --> 00:57:26,950
it too long I'll just go back to the

1386
00:57:26,050 --> 00:57:28,900
results in a second

1387
00:57:26,950 --> 00:57:31,750
the idea here of the stock just

1388
00:57:28,900 --> 00:57:32,970
explaining caldera we're 26 Hertz

1389
00:57:31,750 --> 00:57:35,680
perfect timing

1390
00:57:32,970 --> 00:57:37,839
pretty nice - there's a couple of rough

1391
00:57:35,680 --> 00:57:39,580
edges in it probably noticed for example

1392
00:57:37,840 --> 00:57:41,110
that Greece isn't always what you would

1393
00:57:39,580 --> 00:57:43,180
like it to be you have to reference the

1394
00:57:41,110 --> 00:57:44,950
abilities with the specific IDs but the

1395
00:57:43,180 --> 00:57:46,600
whole idea of the framework is pretty

1396
00:57:44,950 --> 00:57:48,370
nice because you can customize you can

1397
00:57:46,600 --> 00:57:50,529
add things you can run them in autumn

1398
00:57:48,370 --> 00:57:52,690
automatic repeatable way if you will and

1399
00:57:50,530 --> 00:57:54,040
you can even add additional modules you

1400
00:57:52,690 --> 00:57:55,870
can add plugins to it - for example

1401
00:57:54,040 --> 00:57:58,210
export stuff that you can then load into

1402
00:57:55,870 --> 00:58:00,819
your attack navigator it doesn't replace

1403
00:57:58,210 --> 00:58:02,560
a popular theme no this is never going

1404
00:58:00,820 --> 00:58:04,750
to be a tool that that can be used as

1405
00:58:02,560 --> 00:58:06,520
part of a Red Team even not even as part

1406
00:58:04,750 --> 00:58:08,650
of it because the whole point of caldera

1407
00:58:06,520 --> 00:58:10,300
is that you work together with the blue

1408
00:58:08,650 --> 00:58:12,220
team you really check ok but what did

1409
00:58:10,300 --> 00:58:14,050
you see what did you not see the IDS

1410
00:58:12,220 --> 00:58:16,089
make it repeatable what you want to

1411
00:58:14,050 --> 00:58:18,760
avoid is a red team that comes in day

1412
00:58:16,090 --> 00:58:20,440
one gets domain admin because they

1413
00:58:18,760 --> 00:58:21,880
always do right that's the that's the

1414
00:58:20,440 --> 00:58:23,860
point they get domain admin they dump

1415
00:58:21,880 --> 00:58:25,120
everything and say oh and then one year

1416
00:58:23,860 --> 00:58:26,770
later they come back to do the same

1417
00:58:25,120 --> 00:58:28,779
thing over and over again the whole

1418
00:58:26,770 --> 00:58:30,759
point of caldera is empowering a blue

1419
00:58:28,780 --> 00:58:33,130
team look for those techniques

1420
00:58:30,760 --> 00:58:34,690
themselves and without having all that

1421
00:58:33,130 --> 00:58:36,130
red team knowledge right using

1422
00:58:34,690 --> 00:58:38,530
techniques that have been built for

1423
00:58:36,130 --> 00:58:40,450
example by the red team or even by the

1424
00:58:38,530 --> 00:58:42,430
community and running them continuously

1425
00:58:40,450 --> 00:58:44,169
run them once every three months see how

1426
00:58:42,430 --> 00:58:46,270
well you are doing just map it to your

1427
00:58:44,170 --> 00:58:48,550
attack navigator get visibility so you

1428
00:58:46,270 --> 00:58:50,650
actually know what's going to happen if

1429
00:58:48,550 --> 00:58:52,210
you're a team comes in and destroys your

1430
00:58:50,650 --> 00:58:54,340
entire organization and you haven't seen

1431
00:58:52,210 --> 00:58:55,690
a single thing it probably shouldn't

1432
00:58:54,340 --> 00:58:56,980
come as a surprise because you should

1433
00:58:55,690 --> 00:58:58,420
know your coverage and you should never

1434
00:58:56,980 --> 00:59:00,670
get this is what we should be able to

1435
00:58:58,420 --> 00:59:03,820
see that's what we're not able to see so

1436
00:59:00,670 --> 00:59:05,920
that's the whole point is that we're

1437
00:59:03,820 --> 00:59:08,500
hosting one of them is callbacks which

1438
00:59:05,920 --> 00:59:10,210
is the export module for Navigator

1439
00:59:08,500 --> 00:59:11,740
it's a pretty nice one if you want to

1440
00:59:10,210 --> 00:59:13,360
have a look and see how it works if you

1441
00:59:11,740 --> 00:59:15,729
want to develop your own the other one

1442
00:59:13,360 --> 00:59:17,140
is called abilities give us a few days

1443
00:59:15,730 --> 00:59:20,220
though because we need to clean up some

1444
00:59:17,140 --> 00:59:23,529
of the code it was a bit of a rush but

1445
00:59:20,220 --> 00:59:25,299
plenty of work that we mostly may have

1446
00:59:23,530 --> 00:59:28,109
been doing not for this presentation

1447
00:59:25,300 --> 00:59:30,059
actually other things good fun one

1448
00:59:28,109 --> 00:59:31,380
had a reach out to us red teaming all

1449
00:59:30,059 --> 00:59:32,999
that stuff they're happy to do it if

1450
00:59:31,380 --> 00:59:36,660
you're already hacked then you can also

1451
00:59:32,999 --> 00:59:39,959
call us even worse I would say thank you

1452
00:59:36,660 --> 00:59:42,890
very much and let me have a look boom

1453
00:59:39,959 --> 00:59:42,890
boom boom boom

1454
00:59:43,279 --> 00:59:50,839
you've got to be me

1455
00:59:46,759 --> 00:59:53,459
it's green why would you make it green

1456
00:59:50,839 --> 00:59:59,359
let's have a look actually if my phone

1457
00:59:53,459 --> 00:59:59,359
is actually there I know it's going home

1458
01:00:00,829 --> 01:00:05,430
and I think it's too wrinkled so it's

1459
01:00:03,599 --> 01:00:06,749
actually dumping to my C Drive that's

1460
01:00:05,430 --> 01:00:08,940
what's going on now you can see the dose

1461
01:00:06,749 --> 01:00:13,879
actually where great

1462
01:00:08,940 --> 01:00:13,880
no also well yeah interesting

1463
01:00:17,770 --> 01:00:21,900
[Applause]

1464
01:00:21,130 --> 01:00:24,049
[Music]

1465
01:00:21,900 --> 01:00:29,910
[Applause]

1466
01:00:24,049 --> 01:00:34,369
any questions maybe as well maybe one

1467
01:00:29,910 --> 01:00:37,649
final joke if I may just to close down

1468
01:00:34,369 --> 01:00:44,960
what type of gear does loading those

1469
01:00:37,650 --> 01:00:44,960
activists where activists adidas

