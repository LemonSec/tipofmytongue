1
00:00:00,240 --> 00:00:02,639
everybody nate warfield here um full

2
00:00:02,639 --> 00:00:04,160
disclosure i have a confession to make

3
00:00:04,160 --> 00:00:05,920
if you read the abstract in the schedule

4
00:00:05,920 --> 00:00:07,520
this talk is very different than what i

5
00:00:07,520 --> 00:00:09,679
had there um i chose to give a little

6
00:00:09,679 --> 00:00:12,080
bit more uh informational stuff i wanted

7
00:00:12,080 --> 00:00:13,519
you to learn something to take away more

8
00:00:13,519 --> 00:00:15,040
than just me yammering on about some

9
00:00:15,040 --> 00:00:16,720
technology stuff so

10
00:00:16,720 --> 00:00:18,400
with that said

11
00:00:18,400 --> 00:00:19,920
um

12
00:00:19,920 --> 00:00:23,119
technological problems there we go

13
00:00:23,119 --> 00:00:25,840
so who i am um so like i said my nj

14
00:00:25,840 --> 00:00:27,519
warfield you saw me this morning talking

15
00:00:27,519 --> 00:00:28,640
with mark

16
00:00:28,640 --> 00:00:29,359
uh

17
00:00:29,359 --> 00:00:32,079
here we go again all right so i used to

18
00:00:32,079 --> 00:00:33,920
work for microsoft i was a senior

19
00:00:33,920 --> 00:00:36,480
researcher for windows defender atp

20
00:00:36,480 --> 00:00:38,320
um before that i spent about four and a

21
00:00:38,320 --> 00:00:40,160
half years pushing out patches for the

22
00:00:40,160 --> 00:00:42,239
msrc on patch tuesday so i always like

23
00:00:42,239 --> 00:00:45,120
to say you're welcome and i'm also sorry

24
00:00:45,120 --> 00:00:46,640
if it had a logo at a website between

25
00:00:46,640 --> 00:00:49,360
2016 and 2020 i probably ran it

26
00:00:49,360 --> 00:00:50,559
if you want to know more about that just

27
00:00:50,559 --> 00:00:53,039
come find me later so

28
00:00:53,039 --> 00:00:54,719
i've been a network hacker researcher

29
00:00:54,719 --> 00:00:57,440
for 20 something years i'm also the

30
00:00:57,440 --> 00:00:59,120
subject of a bunch of deep fakes on

31
00:00:59,120 --> 00:01:00,719
account of one of my intel guys who's

32
00:01:00,719 --> 00:01:02,480
decided that i'm the next star of the

33
00:01:02,480 --> 00:01:04,080
vikings tv show

34
00:01:04,080 --> 00:01:05,280
um

35
00:01:05,280 --> 00:01:06,640
i'm not trying to keep this a little bit

36
00:01:06,640 --> 00:01:08,080
lighter this afternoon i want to keep

37
00:01:08,080 --> 00:01:09,360
you awake so you guys can have fun

38
00:01:09,360 --> 00:01:11,600
tonight um i'm a conference speaker so i

39
00:01:11,600 --> 00:01:12,960
was actually here at brucon about three

40
00:01:12,960 --> 00:01:15,600
years ago um i've done kaspersky sass

41
00:01:15,600 --> 00:01:17,360
b-sides blue hat a whole bunch of other

42
00:01:17,360 --> 00:01:19,520
ones that are too many to name and then

43
00:01:19,520 --> 00:01:21,600
as we mentioned uh i helped start cti

44
00:01:21,600 --> 00:01:22,960
league last year

45
00:01:22,960 --> 00:01:24,400
we actually got written up in wired for

46
00:01:24,400 --> 00:01:25,759
it which was pretty cool we got to be on

47
00:01:25,759 --> 00:01:27,840
a panel with dr fauci in the u.s which

48
00:01:27,840 --> 00:01:29,360
is kind of neat

49
00:01:29,360 --> 00:01:31,200
the 25 groups and people that were doing

50
00:01:31,200 --> 00:01:33,119
good things in 2020 so what i'm really

51
00:01:33,119 --> 00:01:35,119
going to tell you about today

52
00:01:35,119 --> 00:01:36,400
is some of the techniques and tricks

53
00:01:36,400 --> 00:01:38,159
that we use in cti league that i was

54
00:01:38,159 --> 00:01:40,079
doing beforehand and i planned on

55
00:01:40,079 --> 00:01:42,720
talking about in 2020 um just to sort of

56
00:01:42,720 --> 00:01:44,560
do your own threat percepts threat

57
00:01:44,560 --> 00:01:46,479
assessment perimeter assessments figure

58
00:01:46,479 --> 00:01:47,840
out the holes in your network before

59
00:01:47,840 --> 00:01:49,920
somebody like me who's not nice like me

60
00:01:49,920 --> 00:01:52,159
comes and breaks into your network

61
00:01:52,159 --> 00:01:54,960
um so why is this important um

62
00:01:54,960 --> 00:01:56,240
we constantly are losing this fight

63
00:01:56,240 --> 00:01:57,920
against ransomware this was something we

64
00:01:57,920 --> 00:01:59,680
saw at defender when i was at microsoft

65
00:01:59,680 --> 00:02:01,119
this is something we see it by the

66
00:02:01,119 --> 00:02:03,200
company that i switched to back in march

67
00:02:03,200 --> 00:02:05,360
um we're always losing right we're very

68
00:02:05,360 --> 00:02:06,560
rarely do you hear somebody getting

69
00:02:06,560 --> 00:02:08,878
ahead of ransomware they're getting in

70
00:02:08,878 --> 00:02:10,318
they're dwelling they're having all this

71
00:02:10,318 --> 00:02:11,760
time to get into people's networks and

72
00:02:11,760 --> 00:02:13,440
nobody notices it until their screens

73
00:02:13,440 --> 00:02:16,400
turn you know a skull and crossbones

74
00:02:16,400 --> 00:02:18,480
supply chain attacks another thing if

75
00:02:18,480 --> 00:02:20,560
you all remember solarwinds earlier this

76
00:02:20,560 --> 00:02:22,480
year of course it wasn't the first

77
00:02:22,480 --> 00:02:23,760
um but it's becoming more prevalent

78
00:02:23,760 --> 00:02:25,360
right we saw solar winds we saw it was a

79
00:02:25,360 --> 00:02:27,680
cassaya attackers are realizing that if

80
00:02:27,680 --> 00:02:28,959
they can't get into the company they

81
00:02:28,959 --> 00:02:30,879
want just get into the suppliers back

82
00:02:30,879 --> 00:02:32,480
door through it um this is going to

83
00:02:32,480 --> 00:02:33,920
continue this isn't new but it's going

84
00:02:33,920 --> 00:02:36,480
to get worse i promise you um and then

85
00:02:36,480 --> 00:02:37,920
some of the security solutions that

86
00:02:37,920 --> 00:02:39,760
we've relied on and especially some of

87
00:02:39,760 --> 00:02:42,400
the black box black box products

88
00:02:42,400 --> 00:02:44,879
that i'm going to show you how we found

89
00:02:44,879 --> 00:02:46,319
those things have vulnerabilities right

90
00:02:46,319 --> 00:02:47,840
every day we're seeing citrix net

91
00:02:47,840 --> 00:02:49,680
scalers vmware all these different

92
00:02:49,680 --> 00:02:50,879
things that are being found to have

93
00:02:50,879 --> 00:02:52,800
vulnerabilities that are getting owned

94
00:02:52,800 --> 00:02:55,519
and people are getting in through them

95
00:02:55,519 --> 00:02:57,360
um it's also pretty impossible and this

96
00:02:57,360 --> 00:02:58,560
will be towards the end i'll kind of get

97
00:02:58,560 --> 00:02:59,680
into this but it's really hard to know

98
00:02:59,680 --> 00:03:01,280
what your partner's security solution

99
00:03:01,280 --> 00:03:03,360
and their stance is right you can ask

100
00:03:03,360 --> 00:03:05,360
them they might tell you um but

101
00:03:05,360 --> 00:03:06,720
especially if you're doing mergers and

102
00:03:06,720 --> 00:03:08,879
acquisitions or you're like doing vpn

103
00:03:08,879 --> 00:03:10,720
connectivity between other businesses

104
00:03:10,720 --> 00:03:12,800
for all this b2b stuff

105
00:03:12,800 --> 00:03:14,720
um knowing what their network looks like

106
00:03:14,720 --> 00:03:15,920
you know the same thing like if you'd

107
00:03:15,920 --> 00:03:17,519
known that solarwinds had malware in

108
00:03:17,519 --> 00:03:18,640
their software you probably wouldn't

109
00:03:18,640 --> 00:03:20,000
have installed their software now would

110
00:03:20,000 --> 00:03:21,599
you

111
00:03:21,599 --> 00:03:23,280
um and then with covet and remote

112
00:03:23,280 --> 00:03:25,440
working they're like like i said i was a

113
00:03:25,440 --> 00:03:27,040
network engineer for a bunch of years

114
00:03:27,040 --> 00:03:29,120
and my perimeter was my data center it

115
00:03:29,120 --> 00:03:30,799
was my you know all the stuff that was

116
00:03:30,799 --> 00:03:33,440
sort of my kingdom now with kovid your

117
00:03:33,440 --> 00:03:35,440
perimeter is not only that but it's your

118
00:03:35,440 --> 00:03:37,440
dual cloud or hybrid cloud it's all your

119
00:03:37,440 --> 00:03:39,599
remote workers and uh the gentleman that

120
00:03:39,599 --> 00:03:40,959
was up here earlier talking about all

121
00:03:40,959 --> 00:03:42,319
these netgear vulnerabilities he's

122
00:03:42,319 --> 00:03:43,840
finding are these router vulnerabilities

123
00:03:43,840 --> 00:03:45,519
he's finding like there's guys out there

124
00:03:45,519 --> 00:03:47,120
like that that aren't nice like that

125
00:03:47,120 --> 00:03:48,239
they're gonna try to get into your

126
00:03:48,239 --> 00:03:49,599
remote workers network and then

127
00:03:49,599 --> 00:03:51,440
piggyback through that into your network

128
00:03:51,440 --> 00:03:53,360
so that's the sort of context where

129
00:03:53,360 --> 00:03:55,680
we're at where we're at

130
00:03:55,680 --> 00:03:58,239
on to the risk so

131
00:03:58,239 --> 00:03:59,599
i'm gonna start off with a bunch of

132
00:03:59,599 --> 00:04:01,120
stuff from showdown does anybody quick

133
00:04:01,120 --> 00:04:02,480
show my hands does anybody use showdown

134
00:04:02,480 --> 00:04:04,400
i know what it is

135
00:04:04,400 --> 00:04:06,080
sweet so that you guys are going to be a

136
00:04:06,080 --> 00:04:07,360
little bit bored with some of this stuff

137
00:04:07,360 --> 00:04:09,200
and hopefully you'll learn something

138
00:04:09,200 --> 00:04:10,480
um

139
00:04:10,480 --> 00:04:11,599
well i should just stop with this

140
00:04:11,599 --> 00:04:14,080
clicker um so this is one thing here

141
00:04:14,080 --> 00:04:15,920
unpatched systems right we these are

142
00:04:15,920 --> 00:04:17,759
netscaler vulnerabilities vulnerable net

143
00:04:17,759 --> 00:04:19,918
scalers we can find on showdown

144
00:04:19,918 --> 00:04:21,600
um some of those are imprisoned risk

145
00:04:21,600 --> 00:04:23,440
right i work for microsoft microsoft

146
00:04:23,440 --> 00:04:24,880
leaves a quarter billion customer

147
00:04:24,880 --> 00:04:27,040
records exposed in a cloud instance when

148
00:04:27,040 --> 00:04:28,160
i was here three years ago i was

149
00:04:28,160 --> 00:04:29,919
literally talking about elasticsearch

150
00:04:29,919 --> 00:04:31,520
like being left open to the internet and

151
00:04:31,520 --> 00:04:33,759
then two years later microsoft does it

152
00:04:33,759 --> 00:04:36,720
so the irony was not lost on me here

153
00:04:36,720 --> 00:04:38,639
um network hardware right you can do

154
00:04:38,639 --> 00:04:40,880
these are all quest queries you can go

155
00:04:40,880 --> 00:04:42,160
around on showdown if you want you'll

156
00:04:42,160 --> 00:04:44,080
find this stuff too right telnet open on

157
00:04:44,080 --> 00:04:45,919
cisco routers what i clipped out was

158
00:04:45,919 --> 00:04:47,440
some of them actually have the password

159
00:04:47,440 --> 00:04:49,360
in the login banner of the telnet to the

160
00:04:49,360 --> 00:04:50,560
router

161
00:04:50,560 --> 00:04:52,560
so if you think that that's not a

162
00:04:52,560 --> 00:04:53,759
problem

163
00:04:53,759 --> 00:04:56,160
come talk to me later um server ilo and

164
00:04:56,160 --> 00:04:57,440
this is something we kind of know about

165
00:04:57,440 --> 00:04:59,520
but i wanted to highlight it because

166
00:04:59,520 --> 00:05:02,000
with remote work and with people um not

167
00:05:02,000 --> 00:05:04,320
being in the office turning on ilo ports

168
00:05:04,320 --> 00:05:05,919
for your data centers is becoming more

169
00:05:05,919 --> 00:05:07,520
common right i've seen people saying

170
00:05:07,520 --> 00:05:09,039
well if i can't i'm not in the office or

171
00:05:09,039 --> 00:05:11,280
my servers are in my office i can't go

172
00:05:11,280 --> 00:05:12,880
there anymore with covid so they turn on

173
00:05:12,880 --> 00:05:14,800
ilo and they open up to the internet

174
00:05:14,800 --> 00:05:17,759
right makes sense for you know the world

175
00:05:17,759 --> 00:05:19,360
we live in but as a security standpoint

176
00:05:19,360 --> 00:05:20,960
it's not a good idea

177
00:05:20,960 --> 00:05:22,400
and then the black box products which is

178
00:05:22,400 --> 00:05:23,680
what i'm really gonna go beat up right

179
00:05:23,680 --> 00:05:25,840
now

180
00:05:26,000 --> 00:05:28,560
so i'm gonna start um a couple years ago

181
00:05:28,560 --> 00:05:29,919
uh citrix

182
00:05:29,919 --> 00:05:31,440
um everybody works knows what a citrus

183
00:05:31,440 --> 00:05:32,880
device is if you all heard of these

184
00:05:32,880 --> 00:05:33,919
things

185
00:05:33,919 --> 00:05:36,080
big expensive black box load balancers

186
00:05:36,080 --> 00:05:38,639
firewalls vpn concentrators wafts you

187
00:05:38,639 --> 00:05:39,680
know you spend a hundred thousand

188
00:05:39,680 --> 00:05:41,440
dollars it's supposed to do everything

189
00:05:41,440 --> 00:05:43,919
it also gets owned um so they found this

190
00:05:43,919 --> 00:05:46,479
vulnerability it was disclosed by citrix

191
00:05:46,479 --> 00:05:49,039
in december last year or 2019 i should

192
00:05:49,039 --> 00:05:50,240
say

193
00:05:50,240 --> 00:05:52,080
nobody really noticed it right i didn't

194
00:05:52,080 --> 00:05:53,919
even notice it and i always kind of keep

195
00:05:53,919 --> 00:05:55,120
an eye out for this stuff because it's

196
00:05:55,120 --> 00:05:57,919
my thing um but then in january of last

197
00:05:57,919 --> 00:05:59,120
year as everybody was starting to

198
00:05:59,120 --> 00:06:01,440
realize where the world was going this

199
00:06:01,440 --> 00:06:03,120
guy from tripwire writes this really

200
00:06:03,120 --> 00:06:05,280
detailed blog piece about it including

201
00:06:05,280 --> 00:06:06,960
how to exploit it essentially like it

202
00:06:06,960 --> 00:06:08,880
wasn't quite poc but it was pretty much

203
00:06:08,880 --> 00:06:11,199
pock um so

204
00:06:11,199 --> 00:06:13,120
i read this and i'm like all right this

205
00:06:13,120 --> 00:06:15,120
is going to be a problem um i go and

206
00:06:15,120 --> 00:06:16,560
talk to the guys from gray noise and say

207
00:06:16,560 --> 00:06:18,080
hey let's go throw a signature in here

208
00:06:18,080 --> 00:06:19,440
because we know what the exploit looks

209
00:06:19,440 --> 00:06:21,520
like let's get this in as fast as we can

210
00:06:21,520 --> 00:06:22,960
and see how long it's going to take

211
00:06:22,960 --> 00:06:24,080
before people start like

212
00:06:24,080 --> 00:06:26,639
indiscriminately throwing this payload

213
00:06:26,639 --> 00:06:29,360
it took one day

214
00:06:29,360 --> 00:06:31,120
literally one day after the signature

215
00:06:31,120 --> 00:06:32,560
was in there they saw automated

216
00:06:32,560 --> 00:06:34,240
exploitation attacks going against these

217
00:06:34,240 --> 00:06:35,440
net scalers

218
00:06:35,440 --> 00:06:37,199
this was then confirmed by trusted sec

219
00:06:37,199 --> 00:06:38,639
who a couple days later had found the

220
00:06:38,639 --> 00:06:40,720
same stuff going on um in one of their

221
00:06:40,720 --> 00:06:43,120
honey pots the fun thing and the

222
00:06:43,120 --> 00:06:44,319
screenshot you're looking at on the

223
00:06:44,319 --> 00:06:45,919
lower left is actually from the grain

224
00:06:45,919 --> 00:06:47,280
noise back end i asked them if they'd

225
00:06:47,280 --> 00:06:48,880
give me the very first instance that

226
00:06:48,880 --> 00:06:50,800
they saw and then a few weeks like a

227
00:06:50,800 --> 00:06:53,199
week later after people had been going

228
00:06:53,199 --> 00:06:55,440
through citrix's guidance to say add

229
00:06:55,440 --> 00:06:57,120
these different things into the http

230
00:06:57,120 --> 00:06:59,520
config to block this weird you know dot

231
00:06:59,520 --> 00:07:02,000
semicolon path traversal attack

232
00:07:02,000 --> 00:07:03,680
attackers started changing it and you'll

233
00:07:03,680 --> 00:07:05,280
notice that when they flew in there they

234
00:07:05,280 --> 00:07:07,520
started using a url encoding because to

235
00:07:07,520 --> 00:07:09,360
bypass this thing

236
00:07:09,360 --> 00:07:11,360
and we picked that up also you know so a

237
00:07:11,360 --> 00:07:13,039
week later people are evading it grey

238
00:07:13,039 --> 00:07:15,039
noise is picking it up the interesting

239
00:07:15,039 --> 00:07:17,199
timeline about this is the tripwire

240
00:07:17,199 --> 00:07:18,880
article came out on a thursday or

241
00:07:18,880 --> 00:07:20,560
wednesday so

242
00:07:20,560 --> 00:07:21,919
by

243
00:07:21,919 --> 00:07:24,319
friday like automated exploitation it

244
00:07:24,319 --> 00:07:25,520
happened if you hadn't been paying

245
00:07:25,520 --> 00:07:26,800
attention you could have easily you

246
00:07:26,800 --> 00:07:28,160
would come back on monday and you'd find

247
00:07:28,160 --> 00:07:30,479
out that your netscaler was owned like

248
00:07:30,479 --> 00:07:32,160
pretty much entirely because this is

249
00:07:32,160 --> 00:07:33,599
this is a vulnerable this is a poc that

250
00:07:33,599 --> 00:07:36,080
fits in a tweet

251
00:07:36,080 --> 00:07:37,520
then

252
00:07:37,520 --> 00:07:38,720
and this is one that we worked on

253
00:07:38,720 --> 00:07:41,520
heavily in the cti league um

254
00:07:41,520 --> 00:07:43,759
real fast forward the clock to june

255
00:07:43,759 --> 00:07:46,560
anybody heard of an f5 device

256
00:07:46,560 --> 00:07:49,039
so these f5 is one of citrix's biggest

257
00:07:49,039 --> 00:07:50,879
competitors they make the same type of

258
00:07:50,879 --> 00:07:53,039
stuff it's a big overpriced piece of

259
00:07:53,039 --> 00:07:55,120
network hardware that does everything

260
00:07:55,120 --> 00:07:57,599
including getting owned well

261
00:07:57,599 --> 00:07:59,680
june 30th they post this you know

262
00:07:59,680 --> 00:08:01,360
security advisor saying hey we've got

263
00:08:01,360 --> 00:08:03,199
this vulnerability in our web ui and

264
00:08:03,199 --> 00:08:04,960
it's very long and it's basically

265
00:08:04,960 --> 00:08:07,199
doesn't tell you anything it's also past

266
00:08:07,199 --> 00:08:09,440
reversal against the management ui

267
00:08:09,440 --> 00:08:12,479
that's the poc

268
00:08:12,479 --> 00:08:15,440
it's not really hard um so we ended up

269
00:08:15,440 --> 00:08:17,360
working pretty much in the united states

270
00:08:17,360 --> 00:08:18,800
it was the fourth of july weekend so the

271
00:08:18,800 --> 00:08:21,440
june 30th was a wednesday or thursday we

272
00:08:21,440 --> 00:08:23,280
start working on it we actually get this

273
00:08:23,280 --> 00:08:25,680
poc from someone at ncc group i think it

274
00:08:25,680 --> 00:08:27,280
was july 3rd

275
00:08:27,280 --> 00:08:29,360
and then cti league members worked the

276
00:08:29,360 --> 00:08:31,360
entire weekend trying to pull devices

277
00:08:31,360 --> 00:08:33,039
out of that showdown trying to figure

278
00:08:33,039 --> 00:08:34,159
out which ones were on healthcare

279
00:08:34,159 --> 00:08:36,559
networks trying to call people which you

280
00:08:36,559 --> 00:08:37,599
know fourth of july if you're not

281
00:08:37,599 --> 00:08:39,039
familiar with americans we just drink

282
00:08:39,039 --> 00:08:40,880
beer and shoot fireworks so getting a

283
00:08:40,880 --> 00:08:42,240
hold of somebody who wants to stop

284
00:08:42,240 --> 00:08:43,760
drinking beer and shooting off fireworks

285
00:08:43,760 --> 00:08:46,160
to go and patch 0.5 device

286
00:08:46,160 --> 00:08:48,480
pretty much impossible but at least we

287
00:08:48,480 --> 00:08:50,000
put a lot of emails in their mailbox so

288
00:08:50,000 --> 00:08:51,600
they can not only have a hangover but

289
00:08:51,600 --> 00:08:55,279
some really bad news on monday

290
00:08:55,279 --> 00:08:57,600
um now unfair to us to f5 not not to

291
00:08:57,600 --> 00:08:59,040
totally diss them i did work for them

292
00:08:59,040 --> 00:09:00,560
for a bunch of years they do tell people

293
00:09:00,560 --> 00:09:02,240
don't point this management interface to

294
00:09:02,240 --> 00:09:04,800
the internet um we found like 10 000

295
00:09:04,800 --> 00:09:06,000
people that hadn't listened to that

296
00:09:06,000 --> 00:09:07,200
advice

297
00:09:07,200 --> 00:09:09,040
the other tricky part about this was

298
00:09:09,040 --> 00:09:10,560
that their management interface runs on

299
00:09:10,560 --> 00:09:12,800
like a dedicated one gig interface

300
00:09:12,800 --> 00:09:14,800
however when you set it up the way they

301
00:09:14,800 --> 00:09:16,240
tell you to it also enables the

302
00:09:16,240 --> 00:09:17,680
management interface on what are

303
00:09:17,680 --> 00:09:19,760
essentially the hsrp floating addresses

304
00:09:19,760 --> 00:09:21,760
on each device so if you've got those

305
00:09:21,760 --> 00:09:23,120
open to the internet did you think your

306
00:09:23,120 --> 00:09:24,399
management interface was off the

307
00:09:24,399 --> 00:09:27,279
internet you're wrong um a very large

308
00:09:27,279 --> 00:09:28,800
redmond software company that i used to

309
00:09:28,800 --> 00:09:30,560
work for had a bunch of their customers

310
00:09:30,560 --> 00:09:34,080
get hit with this too allegedly

311
00:09:34,080 --> 00:09:36,399
so when we dug into this this f51 was

312
00:09:36,399 --> 00:09:38,720
really interesting to me um

313
00:09:38,720 --> 00:09:40,640
the first one you know i'm going to back

314
00:09:40,640 --> 00:09:42,640
up real quick here for you

315
00:09:42,640 --> 00:09:45,680
so this tmsh thing um what that is is

316
00:09:45,680 --> 00:09:47,839
basically if you notice the middle pock

317
00:09:47,839 --> 00:09:49,519
command they have what they call their

318
00:09:49,519 --> 00:09:51,040
traffic management shell right so you

319
00:09:51,040 --> 00:09:52,480
see traffic management user interface

320
00:09:52,480 --> 00:09:54,320
this is the gui traffic management shell

321
00:09:54,320 --> 00:09:56,399
was a jsp implementation of a full

322
00:09:56,399 --> 00:09:58,480
command line client for the device that

323
00:09:58,480 --> 00:10:01,200
has zero documentation on any f5 website

324
00:10:01,200 --> 00:10:02,399
in fact if you search this thing on

325
00:10:02,399 --> 00:10:04,720
google the only thing you will find is

326
00:10:04,720 --> 00:10:06,079
this exploit

327
00:10:06,079 --> 00:10:08,399
like nobody seems to know why it's there

328
00:10:08,399 --> 00:10:10,880
so we get in and

329
00:10:10,880 --> 00:10:13,200
it turns out the researcher that found

330
00:10:13,200 --> 00:10:15,120
it had found an entirely different poc

331
00:10:15,120 --> 00:10:17,600
that attacked the hsqldb like back end

332
00:10:17,600 --> 00:10:18,720
which is where they store all their

333
00:10:18,720 --> 00:10:20,560
configuration stuff

334
00:10:20,560 --> 00:10:22,000
nobody seems to know where this other

335
00:10:22,000 --> 00:10:23,920
x-play came out from right 24 hours

336
00:10:23,920 --> 00:10:25,200
later there was an exploit in the wild

337
00:10:25,200 --> 00:10:26,720
for something nobody'd ever heard of and

338
00:10:26,720 --> 00:10:28,079
it wasn't even the thing that the guy

339
00:10:28,079 --> 00:10:30,320
from russia had found so who knew i

340
00:10:30,320 --> 00:10:32,560
don't even know where this came from

341
00:10:32,560 --> 00:10:34,640
um the interesting part about it was

342
00:10:34,640 --> 00:10:36,560
because it was so automated and i

343
00:10:36,560 --> 00:10:38,640
apologize for the eye chart here what we

344
00:10:38,640 --> 00:10:40,480
started seeing in the log messages was

345
00:10:40,480 --> 00:10:42,079
attackers weren't just they're being

346
00:10:42,079 --> 00:10:44,399
very crafty right you don't need c2

347
00:10:44,399 --> 00:10:45,680
which we'll talk about in a minute we

348
00:10:45,680 --> 00:10:47,440
don't need like an interactive c2 when

349
00:10:47,440 --> 00:10:49,279
you can just create a user on the device

350
00:10:49,279 --> 00:10:50,800
that's a valid user

351
00:10:50,800 --> 00:10:52,880
so within about three or four days when

352
00:10:52,880 --> 00:10:54,399
we're doing forensics on some of these

353
00:10:54,399 --> 00:10:56,000
i5 devices we're seeing all these log

354
00:10:56,000 --> 00:10:57,839
messages of the user already exists the

355
00:10:57,839 --> 00:10:59,440
user already exists like they were going

356
00:10:59,440 --> 00:11:00,959
so well that they'd already hit the

357
00:11:00,959 --> 00:11:02,480
device once and they'd come back again

358
00:11:02,480 --> 00:11:03,519
and they were trying to add the same

359
00:11:03,519 --> 00:11:05,600
username a second time right i mean this

360
00:11:05,600 --> 00:11:07,200
is how this is all unfolding in like a

361
00:11:07,200 --> 00:11:08,240
week

362
00:11:08,240 --> 00:11:10,640
um the other fun thing

363
00:11:10,640 --> 00:11:13,760
f5 didn't send us any iocs um they also

364
00:11:13,760 --> 00:11:15,600
staggered their patches out across the

365
00:11:15,600 --> 00:11:18,079
entire month of june with security fixes

366
00:11:18,079 --> 00:11:19,600
but then didn't tell anybody until the

367
00:11:19,600 --> 00:11:21,360
very last patch was delivered so all of

368
00:11:21,360 --> 00:11:24,079
a sudden on the 30th of june they say oh

369
00:11:24,079 --> 00:11:25,200
look at all these look at this

370
00:11:25,200 --> 00:11:26,880
vulnerability we fixed and everybody's

371
00:11:26,880 --> 00:11:29,040
like wait what like this is a device

372
00:11:29,040 --> 00:11:30,320
that lives in the core of your network

373
00:11:30,320 --> 00:11:31,839
you don't just patch this thing like you

374
00:11:31,839 --> 00:11:33,519
do a domain controller because everybody

375
00:11:33,519 --> 00:11:35,200
knows how easy that is

376
00:11:35,200 --> 00:11:36,160
you know we're in the middle of a

377
00:11:36,160 --> 00:11:38,160
pandemic these things are vpn devices so

378
00:11:38,160 --> 00:11:40,720
they basically give people no notice um

379
00:11:40,720 --> 00:11:42,399
yeah you can imagine how

380
00:11:42,399 --> 00:11:43,760
i would have hated to work there when

381
00:11:43,760 --> 00:11:46,320
this happened um but this

382
00:11:46,320 --> 00:11:48,720
this hideous z-grep string is what we

383
00:11:48,720 --> 00:11:50,800
ended up putting together in cti league

384
00:11:50,800 --> 00:11:52,079
because we were working with people that

385
00:11:52,079 --> 00:11:53,600
had been owned and we were just like

386
00:11:53,600 --> 00:11:55,120
what do you have in your logs how do we

387
00:11:55,120 --> 00:11:56,800
tell other people even what to look for

388
00:11:56,800 --> 00:11:58,720
when this thing is with this thing is

389
00:11:58,720 --> 00:12:00,560
compromised keep in mind if i was like a

390
00:12:00,560 --> 00:12:02,160
six billion dollar software company

391
00:12:02,160 --> 00:12:03,760
right it's not like these guys are just

392
00:12:03,760 --> 00:12:06,000
some hole in the wall shop so the point

393
00:12:06,000 --> 00:12:07,440
i'm trying to get at is just because you

394
00:12:07,440 --> 00:12:08,800
threw a bunch of money at a problem

395
00:12:08,800 --> 00:12:10,399
doesn't mean you're actually solved the

396
00:12:10,399 --> 00:12:12,320
problem

397
00:12:12,320 --> 00:12:14,399
um here's the best part

398
00:12:14,399 --> 00:12:16,000
uh and if you have anybody that follows

399
00:12:16,000 --> 00:12:17,360
me on twitter i'm constantly beating

400
00:12:17,360 --> 00:12:20,240
people up for this so this guy at pt

401
00:12:20,240 --> 00:12:22,240
this is the pt security blog about that

402
00:12:22,240 --> 00:12:24,880
f5 vulnerability the guy who found it is

403
00:12:24,880 --> 00:12:26,160
the same guy who found the citrix

404
00:12:26,160 --> 00:12:27,440
vulnerability

405
00:12:27,440 --> 00:12:29,040
here's the better part

406
00:12:29,040 --> 00:12:31,680
that's not even his volume so orange sci

407
00:12:31,680 --> 00:12:34,720
in black hat in asia in 2018 had done a

408
00:12:34,720 --> 00:12:37,120
talk about past traversals this dot dot

409
00:12:37,120 --> 00:12:39,519
semicolon forward slash that's exactly

410
00:12:39,519 --> 00:12:43,440
the poc from the f5 exploit three years

411
00:12:43,440 --> 00:12:46,000
three year 20 months before this f5 bug

412
00:12:46,000 --> 00:12:48,160
was found the entire poc method had been

413
00:12:48,160 --> 00:12:50,480
like disclosed at black hat

414
00:12:50,480 --> 00:12:52,320
you know five months before that citrix

415
00:12:52,320 --> 00:12:54,399
had gotten hit now you would assume

416
00:12:54,399 --> 00:12:56,160
competing vendors would say hey there's

417
00:12:56,160 --> 00:12:57,600
you know we have a similar product we

418
00:12:57,600 --> 00:12:59,519
both use apache for our back-end we both

419
00:12:59,519 --> 00:13:01,680
use tomcat or whatever it is and they

420
00:13:01,680 --> 00:13:04,000
would do some level of code review

421
00:13:04,000 --> 00:13:05,839
that's not true and if you look at the

422
00:13:05,839 --> 00:13:08,000
internet now like vm sphere or vm one of

423
00:13:08,000 --> 00:13:09,680
the vmware products just had the same

424
00:13:09,680 --> 00:13:11,360
thing it was a dot dot semicolon forward

425
00:13:11,360 --> 00:13:13,760
slash like go search past traversal on

426
00:13:13,760 --> 00:13:15,279
anything right now and you'll see tons

427
00:13:15,279 --> 00:13:16,560
of twitter posts about these different

428
00:13:16,560 --> 00:13:18,959
like devices and web uis and things that

429
00:13:18,959 --> 00:13:20,079
are all getting hit with just a

430
00:13:20,079 --> 00:13:22,160
variation of a three-year-old black hat

431
00:13:22,160 --> 00:13:24,959
talk like it's it's obscene

432
00:13:24,959 --> 00:13:27,200
um so yeah who found that tms hpoc we'll

433
00:13:27,200 --> 00:13:29,040
never know

434
00:13:29,040 --> 00:13:31,120
what we did find uh which was

435
00:13:31,120 --> 00:13:32,320
interesting and not really too

436
00:13:32,320 --> 00:13:33,440
surprising

437
00:13:33,440 --> 00:13:35,519
um looking at these in these f5 devices

438
00:13:35,519 --> 00:13:37,040
because keep in mind these are you don't

439
00:13:37,040 --> 00:13:38,639
buy these as a mom and pop shop right

440
00:13:38,639 --> 00:13:40,959
you have to you're spending 200 300 400

441
00:13:40,959 --> 00:13:43,279
000 on a pair of these things

442
00:13:43,279 --> 00:13:44,720
they're really good targets for like

443
00:13:44,720 --> 00:13:46,839
nation state stuff and we found web

444
00:13:46,839 --> 00:13:49,680
shells uh we found xml like monero

445
00:13:49,680 --> 00:13:51,680
miners which you know these things run

446
00:13:51,680 --> 00:13:53,120
until chips you can still mine the

447
00:13:53,120 --> 00:13:55,199
narrow on them and then we found puppy

448
00:13:55,199 --> 00:13:57,360
rat which for the thread until guys tell

449
00:13:57,360 --> 00:13:59,040
me is an iranian tool

450
00:13:59,040 --> 00:14:00,240
um

451
00:14:00,240 --> 00:14:02,639
imagine we also found people loading

452
00:14:02,639 --> 00:14:04,639
python port scanners because the manager

453
00:14:04,639 --> 00:14:06,079
in the management operating system of

454
00:14:06,079 --> 00:14:08,079
these devices is basically linux but

455
00:14:08,079 --> 00:14:09,600
they don't include a port scanner

456
00:14:09,600 --> 00:14:11,360
there's no end map there's no your

457
00:14:11,360 --> 00:14:13,040
favorite tool so people would just break

458
00:14:13,040 --> 00:14:15,519
in load their port scanners we found smb

459
00:14:15,519 --> 00:14:16,639
client things that were written in

460
00:14:16,639 --> 00:14:18,320
python so they could laterally move to

461
00:14:18,320 --> 00:14:20,399
windows infrastructure behind the net f5

462
00:14:20,399 --> 00:14:22,399
devices like it was an absolute

463
00:14:22,399 --> 00:14:23,600
free-for-all

464
00:14:23,600 --> 00:14:26,160
and then the scarier part was

465
00:14:26,160 --> 00:14:28,160
having worked for f5 there was a few

466
00:14:28,160 --> 00:14:31,600
details that i still remembered ptsd-ish

467
00:14:31,600 --> 00:14:33,760
when you the way these things are built

468
00:14:33,760 --> 00:14:35,920
the user file system is read-only right

469
00:14:35,920 --> 00:14:37,360
this is sort of a way that they try to

470
00:14:37,360 --> 00:14:38,800
keep people from breaking their device

471
00:14:38,800 --> 00:14:40,639
or loading you know trying to install an

472
00:14:40,639 --> 00:14:42,720
rpm package on a net zone and taking it

473
00:14:42,720 --> 00:14:44,480
out of support and all that

474
00:14:44,480 --> 00:14:46,000
what these attackers had built was they

475
00:14:46,000 --> 00:14:47,920
built a command line string that would

476
00:14:47,920 --> 00:14:49,920
hit they would throw the exploit then it

477
00:14:49,920 --> 00:14:51,519
would remount the file system in read

478
00:14:51,519 --> 00:14:53,199
write mode it would drop the web shell

479
00:14:53,199 --> 00:14:54,720
then it would put it back into read-only

480
00:14:54,720 --> 00:14:56,240
mode so that you'd have really no idea

481
00:14:56,240 --> 00:14:57,440
looking at it that something had been

482
00:14:57,440 --> 00:14:59,360
written to the device

483
00:14:59,360 --> 00:15:02,480
the other part was this secure vault

484
00:15:02,480 --> 00:15:04,240
device key because these things are load

485
00:15:04,240 --> 00:15:05,839
balancers what people usually use them

486
00:15:05,839 --> 00:15:07,839
for is they'll put an ssl certificate

487
00:15:07,839 --> 00:15:09,519
terminate all their ssl on it they have

488
00:15:09,519 --> 00:15:11,120
these big excessive cell accelerator

489
00:15:11,120 --> 00:15:12,480
chip so you don't have to buy search for

490
00:15:12,480 --> 00:15:14,639
all your devices you just stick it on

491
00:15:14,639 --> 00:15:16,959
one and load balance it well if your

492
00:15:16,959 --> 00:15:18,880
cert has a password you don't want to

493
00:15:18,880 --> 00:15:20,399
enter it every single time so you type

494
00:15:20,399 --> 00:15:21,680
it in once and then it stores it in

495
00:15:21,680 --> 00:15:23,839
secure vault it also lets you encrypt

496
00:15:23,839 --> 00:15:25,360
your backup files

497
00:15:25,360 --> 00:15:27,279
this key is how you decrypt it so they

498
00:15:27,279 --> 00:15:28,880
were literally looking and mining the

499
00:15:28,880 --> 00:15:30,639
devices to pull their backup files and

500
00:15:30,639 --> 00:15:32,160
their secure keys so they could take all

501
00:15:32,160 --> 00:15:33,519
their search and the passwords out of

502
00:15:33,519 --> 00:15:35,120
their certs like these weren't these

503
00:15:35,120 --> 00:15:36,480
weren't script keys right and this had

504
00:15:36,480 --> 00:15:37,680
keep in mind this happened in a matter

505
00:15:37,680 --> 00:15:39,519
of like a week this wasn't like it

506
00:15:39,519 --> 00:15:40,800
doesn't like some of the even the print

507
00:15:40,800 --> 00:15:42,959
nightmare stuff took longer than that

508
00:15:42,959 --> 00:15:43,759
um

509
00:15:43,759 --> 00:15:46,639
we also saw rest apis being abused one

510
00:15:46,639 --> 00:15:48,720
of f5's initial attempts at a workaround

511
00:15:48,720 --> 00:15:50,480
was just to say block this you know

512
00:15:50,480 --> 00:15:52,480
specific dot dot semicolon forward slash

513
00:15:52,480 --> 00:15:54,560
path um what these guys would do is

514
00:15:54,560 --> 00:15:56,000
they'd come here they'd make the account

515
00:15:56,000 --> 00:15:57,600
and that was all they would do

516
00:15:57,600 --> 00:15:59,360
the people we spoke to try to remediate

517
00:15:59,360 --> 00:16:01,440
it but when you came back in with the

518
00:16:01,440 --> 00:16:03,440
rest api that was totally vendor

519
00:16:03,440 --> 00:16:05,839
supported with valid credentials

520
00:16:05,839 --> 00:16:07,279
right i mean it was it was actually kind

521
00:16:07,279 --> 00:16:09,519
of um it was almost elegant in sort of a

522
00:16:09,519 --> 00:16:11,680
sick way how how quickly and how like

523
00:16:11,680 --> 00:16:14,240
well done this attack campaign was um

524
00:16:14,240 --> 00:16:16,560
but end of the day we did save a few

525
00:16:16,560 --> 00:16:17,920
hospitals and that was kind of the most

526
00:16:17,920 --> 00:16:19,600
important thing for us

527
00:16:19,600 --> 00:16:22,240
if you want more details on what this um

528
00:16:22,240 --> 00:16:23,759
slides will be available afterwards you

529
00:16:23,759 --> 00:16:25,920
can check out ncc group they were super

530
00:16:25,920 --> 00:16:27,360
cool with us they gave us lots of

531
00:16:27,360 --> 00:16:30,000
information helped us hunt this down

532
00:16:30,000 --> 00:16:31,600
so

533
00:16:31,600 --> 00:16:33,519
now some of how we did this and you know

534
00:16:33,519 --> 00:16:34,720
a bunch of showdown experts in here

535
00:16:34,720 --> 00:16:36,000
maybe this isn't going to be news to you

536
00:16:36,000 --> 00:16:38,160
but i'm going to tell you how i use it

537
00:16:38,160 --> 00:16:40,560
census binary edge great tools i don't

538
00:16:40,560 --> 00:16:42,320
use them mostly because at the time i

539
00:16:42,320 --> 00:16:43,519
had a free enterprise account from

540
00:16:43,519 --> 00:16:45,440
showdown through microsoft

541
00:16:45,440 --> 00:16:47,680
bgp view my personal favorite maybe you

542
00:16:47,680 --> 00:16:49,360
like hurricane electric whatever it is

543
00:16:49,360 --> 00:16:51,519
that you find your bgp routing and asn

544
00:16:51,519 --> 00:16:53,839
and network discovery

545
00:16:53,839 --> 00:16:54,959
but what i'm really going to do is

546
00:16:54,959 --> 00:16:56,160
screenshot the crap out of you with

547
00:16:56,160 --> 00:16:59,120
showdown and grey noise so get ready

548
00:16:59,120 --> 00:17:01,839
um so gray noise for the uninitiated

549
00:17:01,839 --> 00:17:03,519
they basically run a sensor network it's

550
00:17:03,519 --> 00:17:04,959
kind of it's not really a honeypot but

551
00:17:04,959 --> 00:17:06,880
essentially it's a port zero that's a

552
00:17:06,880 --> 00:17:08,480
packet capture wide open to the internet

553
00:17:08,480 --> 00:17:10,079
that records every single thing that

554
00:17:10,079 --> 00:17:11,839
hits it and it puts it in a database

555
00:17:11,839 --> 00:17:13,280
that you can search

556
00:17:13,280 --> 00:17:14,959
um some of these are screenshots of all

557
00:17:14,959 --> 00:17:16,319
the different stuff these are actually

558
00:17:16,319 --> 00:17:18,480
dated these are different uh tags from

559
00:17:18,480 --> 00:17:19,839
the different malware families and the

560
00:17:19,839 --> 00:17:21,359
different bots and scanners and things

561
00:17:21,359 --> 00:17:23,119
that grain always knows about

562
00:17:23,119 --> 00:17:25,439
um from every single country on earth

563
00:17:25,439 --> 00:17:26,720
all the way down to you'll notice

564
00:17:26,720 --> 00:17:28,960
antarctica is represented there's a bad

565
00:17:28,960 --> 00:17:30,880
machine in antarctica antarctica

566
00:17:30,880 --> 00:17:32,559
indiscriminately scanning the internet

567
00:17:32,559 --> 00:17:34,000
but the thing that i like to to

568
00:17:34,000 --> 00:17:35,520
illustrate on this when you're trying to

569
00:17:35,520 --> 00:17:37,840
do some sort of hunting with it

570
00:17:37,840 --> 00:17:39,440
um yeah and then there's you know

571
00:17:39,440 --> 00:17:40,960
another 9 million ips they don't know

572
00:17:40,960 --> 00:17:42,799
what they are so 15 million and change

573
00:17:42,799 --> 00:17:44,720
ips scanning the internet constantly

574
00:17:44,720 --> 00:17:46,559
every day doing things

575
00:17:46,559 --> 00:17:48,640
but what i like is

576
00:17:48,640 --> 00:17:51,919
i went and i found one of these ones

577
00:17:51,919 --> 00:17:54,559
you notice greenland has

578
00:17:54,559 --> 00:17:56,480
three ips cool so there's three systems

579
00:17:56,480 --> 00:17:58,880
in greenland they're doing bad things

580
00:17:58,880 --> 00:18:00,480
so i go and look up one of those systems

581
00:18:00,480 --> 00:18:02,400
in greenland and showdown i'm sorry

582
00:18:02,400 --> 00:18:03,760
grain always tells me okay this thing is

583
00:18:03,760 --> 00:18:05,679
doing ms sql scanning ms equal brew

584
00:18:05,679 --> 00:18:06,880
forcing

585
00:18:06,880 --> 00:18:09,679
you punch that ip address into showdown

586
00:18:09,679 --> 00:18:11,600
and one of the features that showdan has

587
00:18:11,600 --> 00:18:13,440
and you can use this with a free account

588
00:18:13,440 --> 00:18:15,280
with a you know black friday five dollar

589
00:18:15,280 --> 00:18:17,600
account if you go to it by ip address

590
00:18:17,600 --> 00:18:19,600
like if you put it in a single ip it'll

591
00:18:19,600 --> 00:18:20,960
tell you what vulnerabilities it

592
00:18:20,960 --> 00:18:22,720
believes that system might have like it

593
00:18:22,720 --> 00:18:24,559
looks at the what's called common

594
00:18:24,559 --> 00:18:26,480
platform enumeration field which is the

595
00:18:26,480 --> 00:18:28,320
version of the software that's running

596
00:18:28,320 --> 00:18:30,799
iis apache whatever it is and then does

597
00:18:30,799 --> 00:18:32,240
a correlation saying this might have

598
00:18:32,240 --> 00:18:34,799
this vulnerability however if i see an

599
00:18:34,799 --> 00:18:36,559
is box that says it's got a buffer

600
00:18:36,559 --> 00:18:39,280
overflow in webdav and it's doing sql

601
00:18:39,280 --> 00:18:40,720
scanning that to me kind of has a high

602
00:18:40,720 --> 00:18:42,080
probability that this thing has been

603
00:18:42,080 --> 00:18:43,440
owned through this i believe that's

604
00:18:43,440 --> 00:18:44,640
actually one of the shadow broker

605
00:18:44,640 --> 00:18:47,679
exploits against webdav so with two free

606
00:18:47,679 --> 00:18:49,520
literally free tools that i can go stick

607
00:18:49,520 --> 00:18:51,280
an ip in here stick an ip in there i'm

608
00:18:51,280 --> 00:18:52,799
like okay that box has probably got an

609
00:18:52,799 --> 00:18:54,880
msql worm in it which i think is kind of

610
00:18:54,880 --> 00:18:57,600
cool um the other thing grain noise is

611
00:18:57,600 --> 00:19:00,080
kind of cool with is forensics

612
00:19:00,080 --> 00:19:01,520
they have this analyze feature where you

613
00:19:01,520 --> 00:19:02,799
can take all your log files and just

614
00:19:02,799 --> 00:19:04,480
throw them in there and it'll spit out

615
00:19:04,480 --> 00:19:06,480
all the stuff that it knows is noise so

616
00:19:06,480 --> 00:19:07,760
you can sort of cut through and say okay

617
00:19:07,760 --> 00:19:09,600
this is the stuff i can ignore this is

618
00:19:09,600 --> 00:19:13,039
the stuff that maybe if you're on an um

619
00:19:13,039 --> 00:19:14,320
incident response and you're trying to

620
00:19:14,320 --> 00:19:15,840
figure out you know which of these

621
00:19:15,840 --> 00:19:17,600
machines which of these ips that hit my

622
00:19:17,600 --> 00:19:19,520
thing do i need to worry about you could

623
00:19:19,520 --> 00:19:21,120
say okay all this crafted scanning me

624
00:19:21,120 --> 00:19:23,039
from china all the bing bok crawlers and

625
00:19:23,039 --> 00:19:25,120
all these other things just toss them

626
00:19:25,120 --> 00:19:26,640
and figure out what you actually need to

627
00:19:26,640 --> 00:19:29,280
pay attention to

628
00:19:29,280 --> 00:19:30,880
this is a cool feature

629
00:19:30,880 --> 00:19:32,160
i'm not sure if it's actually still in

630
00:19:32,160 --> 00:19:34,320
beta my intel on this is a little old

631
00:19:34,320 --> 00:19:35,760
and i've been a little busy in the last

632
00:19:35,760 --> 00:19:37,520
year but what he's going to do what they

633
00:19:37,520 --> 00:19:39,679
were trying to do and you can probably

634
00:19:39,679 --> 00:19:40,799
talk to grain noise if you're really

635
00:19:40,799 --> 00:19:43,200
interested is basically let you download

636
00:19:43,200 --> 00:19:44,960
a packet capture at a point in time from

637
00:19:44,960 --> 00:19:46,960
what their sensors had picked up so you

638
00:19:46,960 --> 00:19:48,640
could say okay i want this time slice

639
00:19:48,640 --> 00:19:50,559
for this ip address and you're just

640
00:19:50,559 --> 00:19:52,559
going to chug away and it would stop you

641
00:19:52,559 --> 00:19:54,320
like an s3 bucket link and you'd get a

642
00:19:54,320 --> 00:19:56,160
pcap file with literally the traffic

643
00:19:56,160 --> 00:19:59,760
that the sensor sent to it so this is

644
00:19:59,760 --> 00:20:01,440
i had to obfuscate some of this because

645
00:20:01,440 --> 00:20:03,200
there was some of their internal ips and

646
00:20:03,200 --> 00:20:04,720
andrew over there asked me not to show

647
00:20:04,720 --> 00:20:06,720
off their infrastructure but this is the

648
00:20:06,720 --> 00:20:08,320
same machine that i just showed you from

649
00:20:08,320 --> 00:20:10,240
greenland and you can see

650
00:20:10,240 --> 00:20:12,320
there's a username essay password essay

651
00:20:12,320 --> 00:20:13,919
attempt to do a sql brute forcing

652
00:20:13,919 --> 00:20:15,280
connection which i don't know it's like

653
00:20:15,280 --> 00:20:16,640
a it's like a flight recorder for the

654
00:20:16,640 --> 00:20:18,080
internet and i just think i kind of nerd

655
00:20:18,080 --> 00:20:20,080
out on this stuff

656
00:20:20,080 --> 00:20:21,919
um it's also cool for augmenting like

657
00:20:21,919 --> 00:20:23,919
other thread intel i was reading this

658
00:20:23,919 --> 00:20:25,280
fire eye post

659
00:20:25,280 --> 00:20:27,120
and they had this strange log entry and

660
00:20:27,120 --> 00:20:28,559
they were like yeah this is some exploit

661
00:20:28,559 --> 00:20:30,480
that they picked up coming from

662
00:20:30,480 --> 00:20:32,559
god knows where um

663
00:20:32,559 --> 00:20:33,840
you could stick that into grain noise

664
00:20:33,840 --> 00:20:35,120
and it'll tell you all the machines that

665
00:20:35,120 --> 00:20:36,799
are trying to throw this exploit now it

666
00:20:36,799 --> 00:20:38,080
might not be feasible for you to be

667
00:20:38,080 --> 00:20:39,679
adding these all to a firewall policy

668
00:20:39,679 --> 00:20:41,919
but i'm very data centric and i like to

669
00:20:41,919 --> 00:20:43,440
figure out like everything i can learn

670
00:20:43,440 --> 00:20:45,440
about what's going on and this is the

671
00:20:45,440 --> 00:20:46,640
type of stuff i do i'm just sitting

672
00:20:46,640 --> 00:20:48,080
there like wow okay who's throwing these

673
00:20:48,080 --> 00:20:50,080
exploits most of the stuff comes out of

674
00:20:50,080 --> 00:20:52,400
china surprise surprise russia doesn't

675
00:20:52,400 --> 00:20:53,919
really like to do indiscriminate hacking

676
00:20:53,919 --> 00:20:55,600
it apparently they're more interested in

677
00:20:55,600 --> 00:20:58,720
the very targeted stuff

678
00:20:58,720 --> 00:20:59,919
now

679
00:20:59,919 --> 00:21:01,039
here we go

680
00:21:01,039 --> 00:21:02,799
showdown hunting 101. most of you

681
00:21:02,799 --> 00:21:04,960
probably know this port's products

682
00:21:04,960 --> 00:21:07,120
fairly self-explanatory don't trust the

683
00:21:07,120 --> 00:21:08,880
product field all the time

684
00:21:08,880 --> 00:21:10,880
showdown has gaps so i usually go by

685
00:21:10,880 --> 00:21:12,320
port

686
00:21:12,320 --> 00:21:13,840
organization i'm going to get to the

687
00:21:13,840 --> 00:21:15,520
cool features are is if you can convince

688
00:21:15,520 --> 00:21:17,039
your boss or your workplace or something

689
00:21:17,039 --> 00:21:18,400
to buy you the enterprise license then

690
00:21:18,400 --> 00:21:20,080
you get to do the really cool stuff and

691
00:21:20,080 --> 00:21:21,520
full disclosure i don't have any

692
00:21:21,520 --> 00:21:23,120
business association with showdown i

693
00:21:23,120 --> 00:21:24,960
just really like it as a tool

694
00:21:24,960 --> 00:21:26,880
um so their enterprise license you get

695
00:21:26,880 --> 00:21:28,320
this thing which is the tag for

696
00:21:28,320 --> 00:21:30,240
self-signed certificates now what runs

697
00:21:30,240 --> 00:21:32,080
self-signed certificates

698
00:21:32,080 --> 00:21:34,240
everything everything that you have an

699
00:21:34,240 --> 00:21:36,000
ssl connection to but don't want to pay

700
00:21:36,000 --> 00:21:38,720
for an ssl cert for administrator panels

701
00:21:38,720 --> 00:21:41,360
for f5s citrix's local like your home

702
00:21:41,360 --> 00:21:44,320
routers smart tvs everything that has an

703
00:21:44,320 --> 00:21:46,080
admin panel runs a self-signed ssl

704
00:21:46,080 --> 00:21:48,240
certificate you look for ssls like a

705
00:21:48,240 --> 00:21:49,440
self-signed cert against your

706
00:21:49,440 --> 00:21:51,679
organization you'll be horrified at the

707
00:21:51,679 --> 00:21:54,240
things you find online i did an analysis

708
00:21:54,240 --> 00:21:55,919
for

709
00:21:55,919 --> 00:21:57,600
i can't name them they're a very big

710
00:21:57,600 --> 00:21:59,280
agency in the united states it has stuff

711
00:21:59,280 --> 00:22:00,960
to do with food

712
00:22:00,960 --> 00:22:02,320
i found one of their printers hanging

713
00:22:02,320 --> 00:22:03,760
off the internet

714
00:22:03,760 --> 00:22:05,840
with an active print job going

715
00:22:05,840 --> 00:22:07,840
and i was speaking to them about this

716
00:22:07,840 --> 00:22:09,760
and i pulled up a demo and i did another

717
00:22:09,760 --> 00:22:11,919
search and i found an admin panel for

718
00:22:11,919 --> 00:22:13,360
one of the hewlett packard printers so

719
00:22:13,360 --> 00:22:15,120
we connect into it and it says hi you

720
00:22:15,120 --> 00:22:16,559
haven't set an admin password would you

721
00:22:16,559 --> 00:22:17,919
like to set one

722
00:22:17,919 --> 00:22:19,760
so i asked the cso of this agency do you

723
00:22:19,760 --> 00:22:20,799
want me to set a password on your

724
00:22:20,799 --> 00:22:21,760
printer or do you want to wait for the

725
00:22:21,760 --> 00:22:24,320
black house to do it um yeah it takes

726
00:22:24,320 --> 00:22:26,640
seconds to find this stuff

727
00:22:26,640 --> 00:22:28,240
and then the other cool thing is you can

728
00:22:28,240 --> 00:22:30,159
search by vulnerability now i mentioned

729
00:22:30,159 --> 00:22:31,679
that you'll see that vulnerability info

730
00:22:31,679 --> 00:22:33,840
when you go to it by ip address

731
00:22:33,840 --> 00:22:35,520
it won't let you search that unless you

732
00:22:35,520 --> 00:22:37,520
pay for it and the idea is that john who

733
00:22:37,520 --> 00:22:39,039
runs showdown didn't want to make it any

734
00:22:39,039 --> 00:22:40,720
easier for people like script kitties to

735
00:22:40,720 --> 00:22:42,960
go just mine you know like if you know

736
00:22:42,960 --> 00:22:44,400
if somebody maliciously could go and

737
00:22:44,400 --> 00:22:46,320
mine all of those f5 devices you just

738
00:22:46,320 --> 00:22:48,320
created a curated target list for them

739
00:22:48,320 --> 00:22:50,159
so the idea was if it's locked behind a

740
00:22:50,159 --> 00:22:52,000
license it's a little bit less of a

741
00:22:52,000 --> 00:22:53,840
dangerous thing now it's not a hundred

742
00:22:53,840 --> 00:22:54,799
percent

743
00:22:54,799 --> 00:22:56,640
but um the ones you search with the

744
00:22:56,640 --> 00:22:57,840
volume tag are ones that are actually

745
00:22:57,840 --> 00:22:59,919
generally confirmed he'll actually run

746
00:22:59,919 --> 00:23:02,400
secondary tests and make sure like smb's

747
00:23:02,400 --> 00:23:05,679
ms1710 the wannacry vol the f51 a few

748
00:23:05,679 --> 00:23:07,120
other ones it'll actually test so when

749
00:23:07,120 --> 00:23:08,720
you see yes it's actually vulnerable

750
00:23:08,720 --> 00:23:12,159
it's 100 vulnerable

751
00:23:12,159 --> 00:23:13,919
so

752
00:23:13,919 --> 00:23:15,679
some little pro tips for those who like

753
00:23:15,679 --> 00:23:17,600
to use showdown um if you ever want to

754
00:23:17,600 --> 00:23:20,120
find uh the entire internet

755
00:23:20,120 --> 00:23:22,720
xeroslatnet00 is the whole internet so i

756
00:23:22,720 --> 00:23:24,320
used to like to start i used to just go

757
00:23:24,320 --> 00:23:26,080
on safaris and spend like my entire

758
00:23:26,080 --> 00:23:28,159
afternoons digging for stuff so you know

759
00:23:28,159 --> 00:23:29,840
you can look for these the facet stuff

760
00:23:29,840 --> 00:23:31,520
on the command line the other pro tip

761
00:23:31,520 --> 00:23:33,280
command line client way better than the

762
00:23:33,280 --> 00:23:35,280
web i usually start with the web kind of

763
00:23:35,280 --> 00:23:36,559
figure out what i'm looking for and then

764
00:23:36,559 --> 00:23:37,919
drop into the command line because you

765
00:23:37,919 --> 00:23:40,080
can dig really really deep but you can

766
00:23:40,080 --> 00:23:41,679
look for these facet data so he'll

767
00:23:41,679 --> 00:23:43,600
identify and then tag devices and you

768
00:23:43,600 --> 00:23:45,200
can do like a search right you know

769
00:23:45,200 --> 00:23:47,120
showdown stats facet and then for this

770
00:23:47,120 --> 00:23:49,200
one i wanted to look at waps that tells

771
00:23:49,200 --> 00:23:51,200
you okay how many like f5 devices it

772
00:23:51,200 --> 00:23:52,799
knows about how many netscalers there

773
00:23:52,799 --> 00:23:55,440
are you can actually search for you know

774
00:23:55,440 --> 00:23:56,960
waff and then stick in the name of it

775
00:23:56,960 --> 00:23:58,640
and it'll show you all of them like

776
00:23:58,640 --> 00:23:59,919
there's all this power that most people

777
00:23:59,919 --> 00:24:01,039
think oh it's good for looking up

778
00:24:01,039 --> 00:24:03,679
screenshots of ics devices or like rdp

779
00:24:03,679 --> 00:24:05,039
servers that are left on the internet

780
00:24:05,039 --> 00:24:06,960
it's a super powerful like investigative

781
00:24:06,960 --> 00:24:09,360
and threat analysis tool

782
00:24:09,360 --> 00:24:12,480
the other one too ssl cert details

783
00:24:12,480 --> 00:24:13,840
what you'll find with a lot of these

784
00:24:13,840 --> 00:24:15,600
solutions that people like to use once

785
00:24:15,600 --> 00:24:17,440
again as self-signed certs which are

786
00:24:17,440 --> 00:24:20,960
perfectly valuable or viable um but say

787
00:24:20,960 --> 00:24:22,880
kubernetes you know everybody sets up a

788
00:24:22,880 --> 00:24:24,240
kubernetes instance and it has a

789
00:24:24,240 --> 00:24:26,559
self-signed cert that somewhere in the

790
00:24:26,559 --> 00:24:29,120
issuer name is kubernetes you can go

791
00:24:29,120 --> 00:24:30,640
find all of them right if you're doing

792
00:24:30,640 --> 00:24:32,640
anybody likes to do bug bounty hunting

793
00:24:32,640 --> 00:24:34,080
these are tips that you might you might

794
00:24:34,080 --> 00:24:35,360
find useful the next time you see

795
00:24:35,360 --> 00:24:36,799
something the volume come out it's

796
00:24:36,799 --> 00:24:38,799
usually the race to you know the first

797
00:24:38,799 --> 00:24:41,120
to the uh what is it first of the flag

798
00:24:41,120 --> 00:24:43,200
something like that

799
00:24:43,200 --> 00:24:44,080
um

800
00:24:44,080 --> 00:24:46,240
this http html is more powerful than

801
00:24:46,240 --> 00:24:48,080
most people think

802
00:24:48,080 --> 00:24:49,679
i've used it we used this to find all

803
00:24:49,679 --> 00:24:51,919
those f5 management devices and what we

804
00:24:51,919 --> 00:24:53,520
did was because the manager interface

805
00:24:53,520 --> 00:24:55,840
didn't actually it wasn't tagging it as

806
00:24:55,840 --> 00:24:57,760
a big-ip or an f5 device and plus

807
00:24:57,760 --> 00:24:59,440
there's different product versions so i

808
00:24:59,440 --> 00:25:01,200
actually asked a guy who ran them inside

809
00:25:01,200 --> 00:25:03,440
his network can you just curl this ip

810
00:25:03,440 --> 00:25:05,200
address and tell me what the html is

811
00:25:05,200 --> 00:25:06,799
like you just sent me the raw html

812
00:25:06,799 --> 00:25:08,880
output and it was a very strange it had

813
00:25:08,880 --> 00:25:11,279
like an app for sam and some other stuff

814
00:25:11,279 --> 00:25:12,720
once we knew what the html looked like

815
00:25:12,720 --> 00:25:14,480
we could just search it based on http

816
00:25:14,480 --> 00:25:18,480
html and there was ten thousand devices

817
00:25:18,480 --> 00:25:20,480
uh titles i use this all the time for

818
00:25:20,480 --> 00:25:22,960
routings routers um switches anything

819
00:25:22,960 --> 00:25:24,400
like uh the gentleman before talking

820
00:25:24,400 --> 00:25:26,080
about zytel devices you see some of

821
00:25:26,080 --> 00:25:28,559
these cisco asa devices this is how you

822
00:25:28,559 --> 00:25:30,159
find them right they're all over the

823
00:25:30,159 --> 00:25:31,760
place and if the more the point is not

824
00:25:31,760 --> 00:25:33,440
to go and mess with people but if you're

825
00:25:33,440 --> 00:25:34,960
administering a network if you're trying

826
00:25:34,960 --> 00:25:37,360
to assess your own network your partners

827
00:25:37,360 --> 00:25:38,880
this is how you go and kind of can you

828
00:25:38,880 --> 00:25:40,400
know see what they have on the internet

829
00:25:40,400 --> 00:25:42,960
if they don't want to tell you

830
00:25:42,960 --> 00:25:45,039
and then subject for ssl subject same

831
00:25:45,039 --> 00:25:46,720
thing this it also does it's basically

832
00:25:46,720 --> 00:25:48,159
wild card searching when you do it this

833
00:25:48,159 --> 00:25:51,200
way so the the word vpn exists in all

834
00:25:51,200 --> 00:25:52,880
these ssl certificates so these are all

835
00:25:52,880 --> 00:25:55,440
vpn devices you can go start looking for

836
00:25:55,440 --> 00:25:57,760
pbx look for phone

837
00:25:57,760 --> 00:25:59,440
see what you find

838
00:25:59,440 --> 00:26:00,480
and

839
00:26:00,480 --> 00:26:01,600
so

840
00:26:01,600 --> 00:26:03,919
yeah kind of this round we i usually go

841
00:26:03,919 --> 00:26:05,520
in i'll find the system that i know is

842
00:26:05,520 --> 00:26:07,520
is what i'm looking for and dig through

843
00:26:07,520 --> 00:26:09,279
the raw data this is all the raw

844
00:26:09,279 --> 00:26:10,640
back-end showdown stuff if you're just

845
00:26:10,640 --> 00:26:12,320
trying to use the ui or even the command

846
00:26:12,320 --> 00:26:14,080
line you're going to get lost if you go

847
00:26:14,080 --> 00:26:15,600
look at the actual like you see this

848
00:26:15,600 --> 00:26:17,120
little

849
00:26:17,120 --> 00:26:19,200
raw data thing at the top

850
00:26:19,200 --> 00:26:20,480
click in there and you can see the

851
00:26:20,480 --> 00:26:22,559
entire all the metadata everything that

852
00:26:22,559 --> 00:26:23,679
it's storing that's not going to show

853
00:26:23,679 --> 00:26:25,440
you in the ui

854
00:26:25,440 --> 00:26:27,279
find what you're looking for whether

855
00:26:27,279 --> 00:26:30,000
it's vendor strings landing pages 302

856
00:26:30,000 --> 00:26:31,360
redirects are actually kind of fun to

857
00:26:31,360 --> 00:26:33,039
search on as a lot of these things will

858
00:26:33,039 --> 00:26:34,720
just try to redirect you and then you

859
00:26:34,720 --> 00:26:36,000
can actually search them and figure out

860
00:26:36,000 --> 00:26:38,880
what the devices are and then i'm a big

861
00:26:38,880 --> 00:26:41,039
fan of downloading everything into json

862
00:26:41,039 --> 00:26:42,720
and just playing around more deeply that

863
00:26:42,720 --> 00:26:44,640
way

864
00:26:44,640 --> 00:26:46,640
um here's another one i did there's an

865
00:26:46,640 --> 00:26:48,320
assessment i ran for

866
00:26:48,320 --> 00:26:50,640
ingram micro um probably shouldn't have

867
00:26:50,640 --> 00:26:53,520
named them my bad uh so they asked so

868
00:26:53,520 --> 00:26:54,799
somebody asked me if i could go and see

869
00:26:54,799 --> 00:26:56,159
what their perimeter looks like i'm like

870
00:26:56,159 --> 00:26:57,600
all right cool turns out angry

871
00:26:57,600 --> 00:26:59,120
microphone is this massive company out

872
00:26:59,120 --> 00:27:00,799
of california i believe has acquired

873
00:27:00,799 --> 00:27:02,320
tons and tons of tech companies over the

874
00:27:02,320 --> 00:27:04,400
years so my usual way of looking at the

875
00:27:04,400 --> 00:27:06,000
autonomous system number and figure out

876
00:27:06,000 --> 00:27:08,720
okay where's your ip block doesn't work

877
00:27:08,720 --> 00:27:09,919
now

878
00:27:09,919 --> 00:27:11,279
showdown on the other hand has figured

879
00:27:11,279 --> 00:27:13,120
out how to just they just sort of smack

880
00:27:13,120 --> 00:27:14,480
everything together of all the ingram

881
00:27:14,480 --> 00:27:17,120
micro organizations over the years so

882
00:27:17,120 --> 00:27:18,799
there was a lot of interesting stuff

883
00:27:18,799 --> 00:27:20,320
when i actually searched it that way

884
00:27:20,320 --> 00:27:21,840
including that somebody in their serbian

885
00:27:21,840 --> 00:27:24,399
office is running a minecraft server

886
00:27:24,399 --> 00:27:25,919
and then you've got

887
00:27:25,919 --> 00:27:26,799
this

888
00:27:26,799 --> 00:27:28,640
oh there's a pro tip when you see an rdp

889
00:27:28,640 --> 00:27:30,559
screenshot on showdown what that means

890
00:27:30,559 --> 00:27:32,399
is they're not using network level

891
00:27:32,399 --> 00:27:35,039
authentication which somebody earlier

892
00:27:35,039 --> 00:27:36,720
today was talking about rdp being

893
00:27:36,720 --> 00:27:39,039
exposed and not having good security

894
00:27:39,039 --> 00:27:40,399
this

895
00:27:40,399 --> 00:27:42,799
this nla is how we at microsoft when

896
00:27:42,799 --> 00:27:44,559
deja blue and blue keefe came out this

897
00:27:44,559 --> 00:27:46,240
was the remediation we gave people was

898
00:27:46,240 --> 00:27:48,559
turn on nla the vulnerability was in the

899
00:27:48,559 --> 00:27:50,240
authentication subsystem so if you

900
00:27:50,240 --> 00:27:52,799
turned on nla it basically required a

901
00:27:52,799 --> 00:27:54,320
password before it would ever show you a

902
00:27:54,320 --> 00:27:56,000
screenshot and the vulnerable code path

903
00:27:56,000 --> 00:27:58,320
was never hit so every one of those is

904
00:27:58,320 --> 00:28:00,000
probably if it's not patched it's

905
00:28:00,000 --> 00:28:01,679
definitely vulnerable so

906
00:28:01,679 --> 00:28:04,320
pro tips

907
00:28:04,480 --> 00:28:06,799
now i'm going to kind of close off with

908
00:28:06,799 --> 00:28:08,960
this command and control malware and

909
00:28:08,960 --> 00:28:10,640
sort of the reason why i left microsoft

910
00:28:10,640 --> 00:28:12,080
and the technology that we're working on

911
00:28:12,080 --> 00:28:14,399
now um for those who are going to kind

912
00:28:14,399 --> 00:28:15,760
of blow through this i call that there's

913
00:28:15,760 --> 00:28:18,080
bespoke sort of malware right there's a

914
00:28:18,080 --> 00:28:20,320
sort of free range you know organic you

915
00:28:20,320 --> 00:28:22,640
know gluten-free stuff that the russians

916
00:28:22,640 --> 00:28:24,080
and the iranians and the chinese make

917
00:28:24,080 --> 00:28:25,440
for themselves and they don't share it

918
00:28:25,440 --> 00:28:26,880
they certainly don't sell it on the dark

919
00:28:26,880 --> 00:28:28,000
web

920
00:28:28,000 --> 00:28:29,520
uh there's the professional tooling of

921
00:28:29,520 --> 00:28:31,919
metasploit cobalt strike um it was used

922
00:28:31,919 --> 00:28:33,200
to be nice when cobalt strike was

923
00:28:33,200 --> 00:28:34,960
expensive and only the you know the red

924
00:28:34,960 --> 00:28:36,240
teams could have it and of course it's

925
00:28:36,240 --> 00:28:37,760
since leaked on the internet like all

926
00:28:37,760 --> 00:28:39,120
software does

927
00:28:39,120 --> 00:28:40,880
and there's what i call commodity which

928
00:28:40,880 --> 00:28:42,880
is the stuff you buy on the dark web um

929
00:28:42,880 --> 00:28:44,480
you know it's kind of written by script

930
00:28:44,480 --> 00:28:46,559
kitties you know two or three levels of

931
00:28:46,559 --> 00:28:48,559
script kitties it's not super good it's

932
00:28:48,559 --> 00:28:50,640
not super great but it does the job in a

933
00:28:50,640 --> 00:28:52,399
lot of cases

934
00:28:52,399 --> 00:28:54,159
um obviously the most common attack

935
00:28:54,159 --> 00:28:55,679
vector is email if you're going to get

936
00:28:55,679 --> 00:28:57,360
in through a broken network device or an

937
00:28:57,360 --> 00:28:59,760
rdp you don't need to use c2 malware

938
00:28:59,760 --> 00:29:01,840
it's noisy it's prone to getting caught

939
00:29:01,840 --> 00:29:04,399
by antivirus sometimes

940
00:29:04,399 --> 00:29:05,919
um and it's you know these little

941
00:29:05,919 --> 00:29:08,240
obfuscated payloads it'll try to go out

942
00:29:08,240 --> 00:29:10,240
through c2s it'll try to find a dns

943
00:29:10,240 --> 00:29:11,279
address

944
00:29:11,279 --> 00:29:13,120
to get to its c2 which is where the fun

945
00:29:13,120 --> 00:29:15,279
part gets into

946
00:29:15,279 --> 00:29:17,440
um the nation state guys are not going

947
00:29:17,440 --> 00:29:19,919
to use dns well unless you're like

948
00:29:19,919 --> 00:29:22,320
solarwinds and they really only used the

949
00:29:22,320 --> 00:29:24,080
domain generation algorithm to figure

950
00:29:24,080 --> 00:29:25,440
out which companies had ran these

951
00:29:25,440 --> 00:29:27,120
solarwinds malware

952
00:29:27,120 --> 00:29:28,559
most of your targeted attacks they're

953
00:29:28,559 --> 00:29:29,840
either going to stand up the spoke

954
00:29:29,840 --> 00:29:31,440
infrastructure for that that single

955
00:29:31,440 --> 00:29:32,720
attack or they're going to have one ip

956
00:29:32,720 --> 00:29:33,919
address that they use they're not going

957
00:29:33,919 --> 00:29:36,320
to use the sort of shotgun spray and

958
00:29:36,320 --> 00:29:38,559
pray put 20 domains into payload and

959
00:29:38,559 --> 00:29:39,919
hope that one of them works because they

960
00:29:39,919 --> 00:29:41,679
know they're going to lose some

961
00:29:41,679 --> 00:29:42,960
because of that

962
00:29:42,960 --> 00:29:44,880
the way we do things

963
00:29:44,880 --> 00:29:47,120
we actually take over the domains we

964
00:29:47,120 --> 00:29:49,039
don't subpoena them like microsoft we

965
00:29:49,039 --> 00:29:51,039
just have friends that work with dns

966
00:29:51,039 --> 00:29:52,320
registrars

967
00:29:52,320 --> 00:29:54,559
it's 100 legal and we basically just say

968
00:29:54,559 --> 00:29:56,320
hey we found malware that's using these

969
00:29:56,320 --> 00:29:58,399
c2 domains you want to give them to us

970
00:29:58,399 --> 00:30:00,240
and they will um and it turns out that

971
00:30:00,240 --> 00:30:01,840
you don't need to take over the entire

972
00:30:01,840 --> 00:30:03,679
c2 infrastructure to see signals of

973
00:30:03,679 --> 00:30:04,799
what's coming out of these different

974
00:30:04,799 --> 00:30:06,960
malware systems right if you get about

975
00:30:06,960 --> 00:30:08,720
five or ten percent you can see a crazy

976
00:30:08,720 --> 00:30:10,720
amount of like distribution across the

977
00:30:10,720 --> 00:30:13,279
world on what's coming out of these uh

978
00:30:13,279 --> 00:30:14,799
these networks plus it also lets us do

979
00:30:14,799 --> 00:30:17,679
some fun mischief

980
00:30:17,679 --> 00:30:19,840
um the nice thing about this is the bad

981
00:30:19,840 --> 00:30:21,360
guys don't notice right when we take

982
00:30:21,360 --> 00:30:23,360
over these things they just assumed that

983
00:30:23,360 --> 00:30:25,039
somebody from you know threat intel

984
00:30:25,039 --> 00:30:27,600
group had thrown out an ioc and said oh

985
00:30:27,600 --> 00:30:28,880
you know this is a bad domain and

986
00:30:28,880 --> 00:30:30,320
they've gone to the dns place and said

987
00:30:30,320 --> 00:30:32,240
shut it down it's doing malicious stuff

988
00:30:32,240 --> 00:30:33,919
they don't actually notice that we can

989
00:30:33,919 --> 00:30:35,520
sort of commandeered and we're still

990
00:30:35,520 --> 00:30:36,559
running it

991
00:30:36,559 --> 00:30:38,080
um we don't have to like it doesn't

992
00:30:38,080 --> 00:30:40,240
require anybody to do anything so we can

993
00:30:40,240 --> 00:30:41,840
we've been able to sort of spy on

994
00:30:41,840 --> 00:30:43,360
malware for the last couple years and

995
00:30:43,360 --> 00:30:44,960
just see what the world is doing and see

996
00:30:44,960 --> 00:30:45,840
what all these different malware

997
00:30:45,840 --> 00:30:47,200
families are doing

998
00:30:47,200 --> 00:30:49,440
um and we get really it also takes out

999
00:30:49,440 --> 00:30:51,039
that c2 so if you've got a bunch of

1000
00:30:51,039 --> 00:30:52,960
domains that get taken over

1001
00:30:52,960 --> 00:30:55,120
the other malware that use that you know

1002
00:30:55,120 --> 00:30:57,039
round robin lands on that address isn't

1003
00:30:57,039 --> 00:30:59,200
going to work

1004
00:30:59,200 --> 00:31:00,559
and there's two ways that we've started

1005
00:31:00,559 --> 00:31:02,240
spying on this traffic which is just

1006
00:31:02,240 --> 00:31:03,679
looking at the dns signals and then

1007
00:31:03,679 --> 00:31:05,360
we've actually kind of taken a granois

1008
00:31:05,360 --> 00:31:07,360
model and made sensors that collect data

1009
00:31:07,360 --> 00:31:09,600
and that's kind of that's pretty sweet

1010
00:31:09,600 --> 00:31:10,960
and it's just cool right this is like i

1011
00:31:10,960 --> 00:31:12,880
said i was at microsoft a bunch of years

1012
00:31:12,880 --> 00:31:14,240
i was ready for something different and

1013
00:31:14,240 --> 00:31:15,519
i was like wow dude we want to go work

1014
00:31:15,519 --> 00:31:17,440
on something that's just really new and

1015
00:31:17,440 --> 00:31:19,279
sort of novel way of looking at malware

1016
00:31:19,279 --> 00:31:21,760
so i'm like let's go play with it

1017
00:31:21,760 --> 00:31:23,919
um dns has its limitations and if you're

1018
00:31:23,919 --> 00:31:25,440
asking is this a sinkhole yeah it's

1019
00:31:25,440 --> 00:31:27,440
basically a sinkhole um except that

1020
00:31:27,440 --> 00:31:28,559
we're actually

1021
00:31:28,559 --> 00:31:30,399
doing a lot of sort of like data

1022
00:31:30,399 --> 00:31:33,519
processing and data science on top of it

1023
00:31:33,519 --> 00:31:34,880
there's a lot of false positives though

1024
00:31:34,880 --> 00:31:36,159
when you're looking at sort of sinkhole

1025
00:31:36,159 --> 00:31:38,320
data right anytime a security company

1026
00:31:38,320 --> 00:31:39,919
does a malware detonation or takes a

1027
00:31:39,919 --> 00:31:41,519
part of you somehow or that dns signal

1028
00:31:41,519 --> 00:31:42,960
goes out

1029
00:31:42,960 --> 00:31:44,399
anytime you've got like attachment

1030
00:31:44,399 --> 00:31:46,640
detonation services or email appliances

1031
00:31:46,640 --> 00:31:48,799
or somebody pastes a malicious url into

1032
00:31:48,799 --> 00:31:51,200
slack and forgets to defang it that's a

1033
00:31:51,200 --> 00:31:53,760
dns lookup that looks like a signal

1034
00:31:53,760 --> 00:31:56,240
also big open resolvers you know this is

1035
00:31:56,240 --> 00:31:58,320
these mask actual victims we always see

1036
00:31:58,320 --> 00:32:00,000
is you know cloudflare or google we

1037
00:32:00,000 --> 00:32:02,080
don't see what's who's actually been

1038
00:32:02,080 --> 00:32:03,679
victimized

1039
00:32:03,679 --> 00:32:05,200
and once again apts are going to be

1040
00:32:05,200 --> 00:32:06,559
invisible there's

1041
00:32:06,559 --> 00:32:08,159
if anybody has an idea on how to catch

1042
00:32:08,159 --> 00:32:11,200
these guys let's talk seriously

1043
00:32:11,200 --> 00:32:12,880
but it's still interesting one of the

1044
00:32:12,880 --> 00:32:14,320
things i like to say is it shows how bad

1045
00:32:14,320 --> 00:32:15,919
we as the industry are doing anything

1046
00:32:15,919 --> 00:32:18,480
with dns iocs we pick up about a billion

1047
00:32:18,480 --> 00:32:20,480
signals a day from stuff that's in the

1048
00:32:20,480 --> 00:32:22,000
public domain like this isn't secret

1049
00:32:22,000 --> 00:32:23,440
sauce we're just taking the information

1050
00:32:23,440 --> 00:32:24,880
that's on the public internet in threat

1051
00:32:24,880 --> 00:32:26,159
feeds and we're taking it over and we

1052
00:32:26,159 --> 00:32:27,919
see a billion signals a day so that's

1053
00:32:27,919 --> 00:32:28,640
like

1054
00:32:28,640 --> 00:32:30,080
i like that everybody's taking up our

1055
00:32:30,080 --> 00:32:31,440
malware and throwing this information

1056
00:32:31,440 --> 00:32:32,960
out there i wish the industry would do

1057
00:32:32,960 --> 00:32:34,480
something more with it than sort of skim

1058
00:32:34,480 --> 00:32:36,240
to the bottom and be like oh malware

1059
00:32:36,240 --> 00:32:39,039
hashes and then stop processing

1060
00:32:39,039 --> 00:32:40,399
but it does let us know that something

1061
00:32:40,399 --> 00:32:42,480
happened and that's a lot of times

1062
00:32:42,480 --> 00:32:43,679
that's sort of pushing where we're

1063
00:32:43,679 --> 00:32:45,279
pushing left right of the attack chain

1064
00:32:45,279 --> 00:32:47,760
we're getting something faster

1065
00:32:47,760 --> 00:32:49,519
we're getting something earlier but it

1066
00:32:49,519 --> 00:32:50,960
may or may or may not have been picked

1067
00:32:50,960 --> 00:32:53,200
up by you know endpoint software or av

1068
00:32:53,200 --> 00:32:56,080
but it's it's we're seeing it um and

1069
00:32:56,080 --> 00:32:57,840
like i said it gives us the groundwork

1070
00:32:57,840 --> 00:32:59,840
for this stuff it also makes pretty

1071
00:32:59,840 --> 00:33:02,320
pictures

1072
00:33:03,200 --> 00:33:04,640
ransomware

1073
00:33:04,640 --> 00:33:06,240
so it's kind of neat to lay this out

1074
00:33:06,240 --> 00:33:08,000
right we all know that russian-speaking

1075
00:33:08,000 --> 00:33:09,600
countries don't get a lot of ransomware

1076
00:33:09,600 --> 00:33:11,039
and now i actually have data to show

1077
00:33:11,039 --> 00:33:13,440
this off right so here's ryuk here's

1078
00:33:13,440 --> 00:33:15,200
where we see traffic coming out i mean

1079
00:33:15,200 --> 00:33:17,760
the north america is no surprise the big

1080
00:33:17,760 --> 00:33:19,360
companies are sort of the the favorite

1081
00:33:19,360 --> 00:33:21,200
kung like country of ransomware gangs to

1082
00:33:21,200 --> 00:33:22,399
go after

1083
00:33:22,399 --> 00:33:24,240
i can never pronounce this sudden a code

1084
00:33:24,240 --> 00:33:26,880
so no kibby another one i just kind of

1085
00:33:26,880 --> 00:33:28,880
took the top four ransomwares that i've

1086
00:33:28,880 --> 00:33:30,640
heard of and like that we play with

1087
00:33:30,640 --> 00:33:33,120
wasted locker that's just like it's just

1088
00:33:33,120 --> 00:33:34,559
destroying most of the world but you

1089
00:33:34,559 --> 00:33:36,320
notice this pattern of russian-speaking

1090
00:33:36,320 --> 00:33:39,840
countries don't have any of it

1091
00:33:39,840 --> 00:33:42,080
and then maze although you know they're

1092
00:33:42,080 --> 00:33:44,559
they're not as popular anymore but yeah

1093
00:33:44,559 --> 00:33:46,000
pretty pictures

1094
00:33:46,000 --> 00:33:47,519
um then we started looking at some of

1095
00:33:47,519 --> 00:33:49,039
the rats and the trojan stuff because i

1096
00:33:49,039 --> 00:33:51,279
just find this interesting right iced id

1097
00:33:51,279 --> 00:33:52,880
is really this the new hotness in the

1098
00:33:52,880 --> 00:33:55,200
u.s once again not much distribution in

1099
00:33:55,200 --> 00:33:57,519
russian-speaking countries um it's kind

1100
00:33:57,519 --> 00:33:59,760
of global africa seems to be avoiding

1101
00:33:59,760 --> 00:34:01,440
this i've never been able to figure why

1102
00:34:01,440 --> 00:34:03,440
if it's just that it's a geopolitical or

1103
00:34:03,440 --> 00:34:05,360
economical thing that it's not really

1104
00:34:05,360 --> 00:34:07,120
cost effective to attack african

1105
00:34:07,120 --> 00:34:09,119
countries businesses if anybody knows

1106
00:34:09,119 --> 00:34:11,119
i'm genuinely curious

1107
00:34:11,119 --> 00:34:12,879
um nanocore this is you know like i was

1108
00:34:12,879 --> 00:34:14,239
saying this sort of you know script

1109
00:34:14,239 --> 00:34:16,159
kitty bots that they you buy on the dark

1110
00:34:16,159 --> 00:34:18,239
net obviously still very popular there's

1111
00:34:18,239 --> 00:34:19,760
a ton of it out there

1112
00:34:19,760 --> 00:34:21,679
quackbot i think everybody loves

1113
00:34:21,679 --> 00:34:23,199
quackbot

1114
00:34:23,199 --> 00:34:25,760
and trickbot right trickbot actually

1115
00:34:25,760 --> 00:34:27,520
seems to be more popular in australia

1116
00:34:27,520 --> 00:34:28,719
than just about any other type of

1117
00:34:28,719 --> 00:34:30,719
malware which is another interesting

1118
00:34:30,719 --> 00:34:32,639
point i like to i love conversations if

1119
00:34:32,639 --> 00:34:34,079
anybody knows about this stuff because

1120
00:34:34,079 --> 00:34:36,800
this is just data for you

1121
00:34:36,800 --> 00:34:38,560
and then cobalt strike

1122
00:34:38,560 --> 00:34:40,879
everybody's favorite um it's just it is

1123
00:34:40,879 --> 00:34:41,918
an interesting thing living in the

1124
00:34:41,918 --> 00:34:43,760
united states and we can't all we hear

1125
00:34:43,760 --> 00:34:45,440
in the news is about ransomware and like

1126
00:34:45,440 --> 00:34:46,800
cyber attacks and then when i actually

1127
00:34:46,800 --> 00:34:48,639
look at data i'm like you're right we

1128
00:34:48,639 --> 00:34:51,359
are the largest target of it

1129
00:34:51,359 --> 00:34:53,520
so what we did in cti league with this

1130
00:34:53,520 --> 00:34:55,440
information is actually how i met my new

1131
00:34:55,440 --> 00:34:58,000
boss he basically came in

1132
00:34:58,000 --> 00:34:59,040
and we realized that healthcare

1133
00:34:59,040 --> 00:35:00,720
organizations aren't security companies

1134
00:35:00,720 --> 00:35:02,400
and i know that sounds kind of like like

1135
00:35:02,400 --> 00:35:04,400
one of those well no kidding but the

1136
00:35:04,400 --> 00:35:05,839
point i'm making is that when you see a

1137
00:35:05,839 --> 00:35:08,079
malware signal coming out of a hospital

1138
00:35:08,079 --> 00:35:09,839
it's probably not a malware analyst

1139
00:35:09,839 --> 00:35:11,760
detonating malware in a sandbox it's

1140
00:35:11,760 --> 00:35:13,200
probably a signal that something worse

1141
00:35:13,200 --> 00:35:14,560
is happening and especially if you see a

1142
00:35:14,560 --> 00:35:16,560
trend of it coming up that's when we

1143
00:35:16,560 --> 00:35:18,000
start to realize that that hospital is

1144
00:35:18,000 --> 00:35:20,160
under attack like this is a list of

1145
00:35:20,160 --> 00:35:21,760
hospitals right now that i can pick up

1146
00:35:21,760 --> 00:35:23,200
that have things coming out of their

1147
00:35:23,200 --> 00:35:24,480
network

1148
00:35:24,480 --> 00:35:25,839
um

1149
00:35:25,839 --> 00:35:28,000
so in 2020 as you know market i talked

1150
00:35:28,000 --> 00:35:29,760
about this morning we started cti league

1151
00:35:29,760 --> 00:35:31,760
my boss joined basically we gave away he

1152
00:35:31,760 --> 00:35:33,200
gave away free access to every health

1153
00:35:33,200 --> 00:35:35,280
care company that wanted it um and said

1154
00:35:35,280 --> 00:35:36,800
hey if you want access to this stuff

1155
00:35:36,800 --> 00:35:38,240
i'll just give it away for you so it's

1156
00:35:38,240 --> 00:35:39,680
the right thing to do

1157
00:35:39,680 --> 00:35:41,839
um and then we would coordinate once you

1158
00:35:41,839 --> 00:35:43,520
know usually we'd find or he would find

1159
00:35:43,520 --> 00:35:45,040
things he'd come in and say hey we found

1160
00:35:45,040 --> 00:35:46,560
a hospital that's got a bunch of like

1161
00:35:46,560 --> 00:35:48,720
ryuk beaconing out like pre three stages

1162
00:35:48,720 --> 00:35:50,800
of ryuk how do we get a hold of them

1163
00:35:50,800 --> 00:35:52,800
we'd work with the hi sacks they'd reach

1164
00:35:52,800 --> 00:35:55,200
out to the hospital um the thing one of

1165
00:35:55,200 --> 00:35:56,800
the interesting lessons we learned in

1166
00:35:56,800 --> 00:35:58,720
cti league

1167
00:35:58,720 --> 00:36:00,160
and it was something that i was really

1168
00:36:00,160 --> 00:36:02,160
surprised about is hospitals

1169
00:36:02,160 --> 00:36:04,320
are very reluctant to take any free

1170
00:36:04,320 --> 00:36:06,079
information mark mentioned how they they

1171
00:36:06,079 --> 00:36:08,160
would think we were blackmailing them

1172
00:36:08,160 --> 00:36:09,920
sometimes they would get very defensive

1173
00:36:09,920 --> 00:36:11,920
but even after they got it there was a

1174
00:36:11,920 --> 00:36:13,520
sort of hush hush thing they didn't want

1175
00:36:13,520 --> 00:36:14,880
to they didn't even want to admit that

1176
00:36:14,880 --> 00:36:16,800
they needed the help um and

1177
00:36:16,800 --> 00:36:18,240
unfortunately there's some

1178
00:36:18,240 --> 00:36:19,680
my theory on this is because there's

1179
00:36:19,680 --> 00:36:21,520
just reliability for them right you're

1180
00:36:21,520 --> 00:36:23,119
in a life-saving industry if you're

1181
00:36:23,119 --> 00:36:24,560
admitting that you're having holes in

1182
00:36:24,560 --> 00:36:26,480
your network just last week in the

1183
00:36:26,480 --> 00:36:27,839
united states there was a lawsuit that

1184
00:36:27,839 --> 00:36:29,599
was kicked off by a woman who's claiming

1185
00:36:29,599 --> 00:36:31,680
that the fact that her infant passed

1186
00:36:31,680 --> 00:36:33,280
away was because the hospital had a

1187
00:36:33,280 --> 00:36:35,040
ransomware attack happening at the time

1188
00:36:35,040 --> 00:36:35,760
so

1189
00:36:35,760 --> 00:36:37,280
once again we're dealing with the

1190
00:36:37,280 --> 00:36:39,119
economical things of ransomware actors

1191
00:36:39,119 --> 00:36:40,800
trying to take over networks for money

1192
00:36:40,800 --> 00:36:41,680
and then we're dealing with the

1193
00:36:41,680 --> 00:36:43,760
economical aspect economical aspect of

1194
00:36:43,760 --> 00:36:45,599
hospitals that are afraid to ask for

1195
00:36:45,599 --> 00:36:47,760
help because if they do that could open

1196
00:36:47,760 --> 00:36:50,000
themselves up for another lawsuit right

1197
00:36:50,000 --> 00:36:51,680
this is this isn't an easy problem to

1198
00:36:51,680 --> 00:36:53,280
solve and we've been kind of tackling it

1199
00:36:53,280 --> 00:36:54,720
in one way or another for the last year

1200
00:36:54,720 --> 00:36:56,400
and a half

1201
00:36:56,400 --> 00:36:57,920
but we did help a bunch of them get away

1202
00:36:57,920 --> 00:36:59,280
from and i think there was five or six

1203
00:36:59,280 --> 00:37:00,800
hospitals on the east coast of the us

1204
00:37:00,800 --> 00:37:02,240
that we managed to help

1205
00:37:02,240 --> 00:37:04,720
um we worked with some folks from nhs

1206
00:37:04,720 --> 00:37:06,320
national health services in the uk to

1207
00:37:06,320 --> 00:37:08,320
give them some intel so it was

1208
00:37:08,320 --> 00:37:10,960
successful

1209
00:37:10,960 --> 00:37:13,200
the other way we can do this as we we

1210
00:37:13,200 --> 00:37:14,560
start controlling it and using these

1211
00:37:14,560 --> 00:37:16,560
sensors is we actually answer

1212
00:37:16,560 --> 00:37:18,640
the malware we keep running the zones we

1213
00:37:18,640 --> 00:37:20,880
hand it back ip addresses that we own

1214
00:37:20,880 --> 00:37:22,880
and then we let the malware talk to us

1215
00:37:22,880 --> 00:37:24,560
and send us a whole bunch of information

1216
00:37:24,560 --> 00:37:26,400
and depending on the malware family it's

1217
00:37:26,400 --> 00:37:27,680
more or less

1218
00:37:27,680 --> 00:37:29,520
we can't actually touch the mail where

1219
00:37:29,520 --> 00:37:30,960
we can't send it commands that's

1220
00:37:30,960 --> 00:37:32,720
technically illegal

1221
00:37:32,720 --> 00:37:34,320
but we can take everything that it gives

1222
00:37:34,320 --> 00:37:34,960
us

1223
00:37:34,960 --> 00:37:36,800
um and then we can do things like using

1224
00:37:36,800 --> 00:37:38,640
rapid seven data to correlate which

1225
00:37:38,640 --> 00:37:41,280
cloud ip address from digitalocean

1226
00:37:41,280 --> 00:37:42,880
talk to one of the sensors and realizing

1227
00:37:42,880 --> 00:37:45,200
this is an amstel machine right this is

1228
00:37:45,200 --> 00:37:46,640
just all data science right this isn't

1229
00:37:46,640 --> 00:37:48,560
enough it's not super it's not really

1230
00:37:48,560 --> 00:37:50,560
it's not machine learning it's not ai

1231
00:37:50,560 --> 00:37:52,240
it's just clever ways of taking data and

1232
00:37:52,240 --> 00:37:53,839
matching it up together to find actually

1233
00:37:53,839 --> 00:37:55,839
interesting stuff like this

1234
00:37:55,839 --> 00:37:56,880
um

1235
00:37:56,880 --> 00:37:58,079
let's see here

1236
00:37:58,079 --> 00:38:00,160
well that's an eye chart and i apologize

1237
00:38:00,160 --> 00:38:02,480
so this is a snapshot of one of the one

1238
00:38:02,480 --> 00:38:04,000
of the systems that talk to a sensor

1239
00:38:04,000 --> 00:38:05,920
right and it's got we take away the

1240
00:38:05,920 --> 00:38:08,240
masking from the dns recursion right we

1241
00:38:08,240 --> 00:38:09,760
actually get the ip of the victim it's

1242
00:38:09,760 --> 00:38:11,440
talking directly to us so the malware is

1243
00:38:11,440 --> 00:38:13,280
trying to talk directly to us

1244
00:38:13,280 --> 00:38:14,480
and it's sending us usernames and

1245
00:38:14,480 --> 00:38:17,280
passwords machine names operating system

1246
00:38:17,280 --> 00:38:19,200
versions of windows

1247
00:38:19,200 --> 00:38:21,040
and then weird payloads what you might

1248
00:38:21,040 --> 00:38:22,800
not be able to see here

1249
00:38:22,800 --> 00:38:24,320
is this machine is saying it's saying

1250
00:38:24,320 --> 00:38:25,520
it's basically saying it's an operating

1251
00:38:25,520 --> 00:38:28,000
system it's windows 7 sp1 but then what

1252
00:38:28,000 --> 00:38:29,599
it's trying to tell us the user agent is

1253
00:38:29,599 --> 00:38:31,520
is an iphone

1254
00:38:31,520 --> 00:38:32,640
right

1255
00:38:32,640 --> 00:38:34,480
i didn't know iphones ran on windows or

1256
00:38:34,480 --> 00:38:37,040
windows ran on iphones um but yeah this

1257
00:38:37,040 --> 00:38:40,079
is the it's just very strange i obsess

1258
00:38:40,079 --> 00:38:42,000
over this kind of stuff so yeah we see

1259
00:38:42,000 --> 00:38:43,280
these types of payloads it's like that's

1260
00:38:43,280 --> 00:38:46,560
really weird this is actually um uh dang

1261
00:38:46,560 --> 00:38:48,000
i forget the name of the malware family

1262
00:38:48,000 --> 00:38:50,240
off the top of my head but

1263
00:38:50,240 --> 00:38:52,000
then we had some ideas that we can this

1264
00:38:52,000 --> 00:38:53,280
is i could talk about this because we

1265
00:38:53,280 --> 00:38:55,440
can't do it um one of the ideas we

1266
00:38:55,440 --> 00:38:57,280
kicked around was what if we just bgp

1267
00:38:57,280 --> 00:39:00,320
hijack attacker networks and try to man

1268
00:39:00,320 --> 00:39:02,320
in the middle of their traffic so that

1269
00:39:02,320 --> 00:39:04,079
we can spy on what they're doing between

1270
00:39:04,079 --> 00:39:06,240
the victim and the end point now you can

1271
00:39:06,240 --> 00:39:07,440
imagine if we're seeing a billion

1272
00:39:07,440 --> 00:39:08,960
signals a day would have been on that

1273
00:39:08,960 --> 00:39:11,440
amount of bgb hijacking would probably

1274
00:39:11,440 --> 00:39:14,240
be noticed um it'd also be illegal the

1275
00:39:14,240 --> 00:39:15,920
other thought was we could pull kind of

1276
00:39:15,920 --> 00:39:17,359
like what the dutch police that took

1277
00:39:17,359 --> 00:39:19,359
down the hansa drug market did where at

1278
00:39:19,359 --> 00:39:21,839
one point they put tracking images uh in

1279
00:39:21,839 --> 00:39:23,359
these excel files that they were giving

1280
00:39:23,359 --> 00:39:24,560
to these drug dealers and they said hey

1281
00:39:24,560 --> 00:39:26,079
you can download your stats and your

1282
00:39:26,079 --> 00:39:27,520
sales from you know the hansa market

1283
00:39:27,520 --> 00:39:28,800
this month and you can be on like a

1284
00:39:28,800 --> 00:39:30,560
leaderboard and they actually trick

1285
00:39:30,560 --> 00:39:32,079
these drug dealers into opening excel

1286
00:39:32,079 --> 00:39:33,920
files that had images that call back to

1287
00:39:33,920 --> 00:39:35,359
their servers and they realized the home

1288
00:39:35,359 --> 00:39:37,280
ips of these folks like there was a

1289
00:39:37,280 --> 00:39:39,760
great talk that data did a few years ago

1290
00:39:39,760 --> 00:39:41,440
that's once again tampering with stuff

1291
00:39:41,440 --> 00:39:42,640
in transit we're not allowed to do that

1292
00:39:42,640 --> 00:39:44,400
we're not the cops

1293
00:39:44,400 --> 00:39:45,680
the other thought was maybe we just took

1294
00:39:45,680 --> 00:39:46,880
a ransomware payload into the

1295
00:39:46,880 --> 00:39:48,640
exfiltrated data and send it back to the

1296
00:39:48,640 --> 00:39:50,000
attacker so that when they open enough

1297
00:39:50,000 --> 00:39:51,280
to see what they got it just ran so

1298
00:39:51,280 --> 00:39:53,440
where's their network once again all of

1299
00:39:53,440 --> 00:39:55,440
this stuff is illegal

1300
00:39:55,440 --> 00:39:56,640
and then we thought well maybe we could

1301
00:39:56,640 --> 00:39:58,079
remotely delete the payloads that are on

1302
00:39:58,079 --> 00:39:59,359
the machine like literally we have a

1303
00:39:59,359 --> 00:40:00,640
team of lawyers we've talked to no

1304
00:40:00,640 --> 00:40:02,720
that's also illegal the one cool thing

1305
00:40:02,720 --> 00:40:04,720
we've been able to do is not patch

1306
00:40:04,720 --> 00:40:07,440
botnets but look at botnets anybody

1307
00:40:07,440 --> 00:40:09,359
heard of maris

1308
00:40:09,359 --> 00:40:10,400
real recent

1309
00:40:10,400 --> 00:40:11,119
so

1310
00:40:11,119 --> 00:40:13,599
we managed to take over 90 of their

1311
00:40:13,599 --> 00:40:14,960
interest of their c2 domain

1312
00:40:14,960 --> 00:40:16,560
infrastructure and we've just been

1313
00:40:16,560 --> 00:40:19,359
watching it for the last two weeks um

1314
00:40:19,359 --> 00:40:20,960
it's hard to commit to a number i think

1315
00:40:20,960 --> 00:40:22,640
ross telecom said that they looked and

1316
00:40:22,640 --> 00:40:24,880
saw about 44 000 ips talking to their

1317
00:40:24,880 --> 00:40:28,240
sensors we've picked up over 120 000 unh

1318
00:40:28,240 --> 00:40:30,480
ips talking to sensors

1319
00:40:30,480 --> 00:40:31,839
they're not entirely sure that that's

1320
00:40:31,839 --> 00:40:33,520
the number of infected clients there's

1321
00:40:33,520 --> 00:40:35,280
we're still digging through the data but

1322
00:40:35,280 --> 00:40:37,599
we can kind of do a breakdown of where

1323
00:40:37,599 --> 00:40:39,440
these things are coming from

1324
00:40:39,440 --> 00:40:41,520
you know obviously isps are the big ones

1325
00:40:41,520 --> 00:40:43,119
and we obfuscate a lot of this i don't

1326
00:40:43,119 --> 00:40:44,960
want to name and shame any isps so these

1327
00:40:44,960 --> 00:40:45,839
are just

1328
00:40:45,839 --> 00:40:48,400
max code for organizations but we've got

1329
00:40:48,400 --> 00:40:49,680
healthcare industries we've got

1330
00:40:49,680 --> 00:40:50,880
government sectors we've got

1331
00:40:50,880 --> 00:40:52,800
manufacturing and the thing that's scary

1332
00:40:52,800 --> 00:40:54,960
about maris is it's more advanced than

1333
00:40:54,960 --> 00:40:56,319
just mirai right this isn't just a

1334
00:40:56,319 --> 00:40:59,280
scriptkd.net it's actually using um

1335
00:40:59,280 --> 00:41:01,280
built-in router os commands to basically

1336
00:41:01,280 --> 00:41:02,720
take over these routers and make them

1337
00:41:02,720 --> 00:41:04,880
accessible to the botnet operators so

1338
00:41:04,880 --> 00:41:06,640
there's a non-zero chance if they wanted

1339
00:41:06,640 --> 00:41:07,920
to they can figure out where these

1340
00:41:07,920 --> 00:41:09,520
devices running is this a network i want

1341
00:41:09,520 --> 00:41:11,280
to get into and they can go get back

1342
00:41:11,280 --> 00:41:13,119
into it and every one of these companies

1343
00:41:13,119 --> 00:41:14,720
that are on this list

1344
00:41:14,720 --> 00:41:16,480
now they're at risk for this stuff

1345
00:41:16,480 --> 00:41:17,599
so

1346
00:41:17,599 --> 00:41:19,520
in closing

1347
00:41:19,520 --> 00:41:20,720
the 90s called and they want their

1348
00:41:20,720 --> 00:41:22,560
exploits back none of those exploits we

1349
00:41:22,560 --> 00:41:24,160
saw from you know network vendors are

1350
00:41:24,160 --> 00:41:25,760
really that complicated right this isn't

1351
00:41:25,760 --> 00:41:27,599
super elite there's no rap change

1352
00:41:27,599 --> 00:41:28,880
there's no exploit chaining there's

1353
00:41:28,880 --> 00:41:30,400
nothing that you hear about it like

1354
00:41:30,400 --> 00:41:32,480
windows or apple or um you know linux

1355
00:41:32,480 --> 00:41:34,720
exploitation this is just dumb

1356
00:41:34,720 --> 00:41:36,880
programming problems

1357
00:41:36,880 --> 00:41:38,319
uh the other thing about it is zero days

1358
00:41:38,319 --> 00:41:40,240
are expensive i worked for microsoft for

1359
00:41:40,240 --> 00:41:42,400
a long time doing patching zero days i

1360
00:41:42,400 --> 00:41:43,680
could tell you we didn't see a lot of

1361
00:41:43,680 --> 00:41:45,440
them most of them came from north korea

1362
00:41:45,440 --> 00:41:47,200
most of them were crappy vbscript stuff

1363
00:41:47,200 --> 00:41:48,319
and code that should have been ripped

1364
00:41:48,319 --> 00:41:49,920
out but you know what isn't expensive

1365
00:41:49,920 --> 00:41:51,200
mistakes

1366
00:41:51,200 --> 00:41:52,400
and that's what these people are getting

1367
00:41:52,400 --> 00:41:53,839
in on they're waiting for people like

1368
00:41:53,839 --> 00:41:55,599
you or people like you who you work for

1369
00:41:55,599 --> 00:41:57,359
to make a mistake and to screw up and i

1370
00:41:57,359 --> 00:41:58,720
guarantee you they're looking at your

1371
00:41:58,720 --> 00:42:00,480
network more than you are

1372
00:42:00,480 --> 00:42:02,000
and you need to be doing the same thing

1373
00:42:02,000 --> 00:42:03,359
and that's kind of what i was trying to

1374
00:42:03,359 --> 00:42:05,200
illustrate here is how to do this

1375
00:42:05,200 --> 00:42:06,960
do this when you every week every month

1376
00:42:06,960 --> 00:42:08,480
make it part of your sort of basic

1377
00:42:08,480 --> 00:42:10,160
security hygiene just to figure out what

1378
00:42:10,160 --> 00:42:12,319
you've got or obviously any time there's

1379
00:42:12,319 --> 00:42:14,160
an exploit disclosure do you know all

1380
00:42:14,160 --> 00:42:15,760
your inventory especially if you just

1381
00:42:15,760 --> 00:42:17,760
came to a company you start a new job

1382
00:42:17,760 --> 00:42:19,040
this is a good way to look good really

1383
00:42:19,040 --> 00:42:20,880
quickly when you tell your boss hey did

1384
00:42:20,880 --> 00:42:22,240
you know we have a bunch of net scalers

1385
00:42:22,240 --> 00:42:23,280
out there that haven't been patched in

1386
00:42:23,280 --> 00:42:26,000
six months he might not know right

1387
00:42:26,000 --> 00:42:27,200
and of course if you're partnering with

1388
00:42:27,200 --> 00:42:28,560
people if you're doing a merger

1389
00:42:28,560 --> 00:42:30,880
acquisition something like that um just

1390
00:42:30,880 --> 00:42:32,560
do this please so that you don't have to

1391
00:42:32,560 --> 00:42:34,400
have me talking about you next time at

1392
00:42:34,400 --> 00:42:35,599
brucon

1393
00:42:35,599 --> 00:42:37,200
and if you liked i throw some of my

1394
00:42:37,200 --> 00:42:39,440
showdown stuff up on github it's there

1395
00:42:39,440 --> 00:42:41,040
if you want to check it out and with

1396
00:42:41,040 --> 00:42:42,240
that

1397
00:42:42,240 --> 00:42:43,839
thank you very much if you have any

1398
00:42:43,839 --> 00:42:45,920
questions i think we got about

1399
00:42:45,920 --> 00:42:47,840
10 minutes

1400
00:42:47,840 --> 00:42:57,440
[Applause]

1401
00:42:57,440 --> 00:43:01,319
anyone has any questions

1402
00:43:13,839 --> 00:43:16,560
thank you very much um my question is

1403
00:43:16,560 --> 00:43:18,240
you're saying that normally what you do

1404
00:43:18,240 --> 00:43:19,680
is just leave

1405
00:43:19,680 --> 00:43:21,839
the c2

1406
00:43:21,839 --> 00:43:23,839
malware just running and just look at

1407
00:43:23,839 --> 00:43:26,560
what it does you do not or sometimes you

1408
00:43:26,560 --> 00:43:28,480
do not inoculate what it

1409
00:43:28,480 --> 00:43:30,640
gets rid of it yeah we can't touch it

1410
00:43:30,640 --> 00:43:33,520
right like for us to do anything i mean

1411
00:43:33,520 --> 00:43:35,200
when we see whatever signal we see

1412
00:43:35,200 --> 00:43:36,400
coming from it it's essentially been

1413
00:43:36,400 --> 00:43:38,160
inoculated at that point because it's

1414
00:43:38,160 --> 00:43:40,319
trying we don't keep sending it to the

1415
00:43:40,319 --> 00:43:42,640
actual c2 infrastructure once we take it

1416
00:43:42,640 --> 00:43:44,560
over we don't even get the original zone

1417
00:43:44,560 --> 00:43:46,160
files we have no idea where it was going

1418
00:43:46,160 --> 00:43:47,599
and we never respond with something that

1419
00:43:47,599 --> 00:43:49,680
gets it back to the mothership so it is

1420
00:43:49,680 --> 00:43:51,920
it to a degree inoculated but we can't

1421
00:43:51,920 --> 00:43:53,280
we can't do anything like send a

1422
00:43:53,280 --> 00:43:55,040
self-destruct command to it because that

1423
00:43:55,040 --> 00:43:58,560
would be us being the bad guys

1424
00:44:11,280 --> 00:44:13,440
hey nate hey joe

1425
00:44:13,440 --> 00:44:17,040
so one tension um and maybe like to use

1426
00:44:17,040 --> 00:44:19,200
an example with one of the cassaya with

1427
00:44:19,200 --> 00:44:21,680
the cassaya incident there was just in

1428
00:44:21,680 --> 00:44:23,760
the news a lot of

1429
00:44:23,760 --> 00:44:25,839
disgruntled people were like oh the fbi

1430
00:44:25,839 --> 00:44:28,160
had some information about the

1431
00:44:28,160 --> 00:44:29,760
decryption key and didn't share it

1432
00:44:29,760 --> 00:44:31,839
because they were investigating and you

1433
00:44:31,839 --> 00:44:33,520
know trying to

1434
00:44:33,520 --> 00:44:34,880
make indictments or whatever around

1435
00:44:34,880 --> 00:44:36,800
these lines do you think that there's a

1436
00:44:36,800 --> 00:44:38,880
worry that because i think what you're

1437
00:44:38,880 --> 00:44:40,800
doing is very good but do you think that

1438
00:44:40,800 --> 00:44:42,240
it's setting up a potential tension

1439
00:44:42,240 --> 00:44:46,480
between yourself cci league and whatnot

1440
00:44:46,480 --> 00:44:48,880
with law enforcement authorities that

1441
00:44:48,880 --> 00:44:51,280
are trying to gather evidence and

1442
00:44:51,280 --> 00:44:53,760
information in order to do prosecutions

1443
00:44:53,760 --> 00:44:55,280
which you could argue really doesn't

1444
00:44:55,280 --> 00:44:56,480
make any sense because it hasn't solved

1445
00:44:56,480 --> 00:44:58,319
the problem just yet but it could lead

1446
00:44:58,319 --> 00:45:00,560
to trouble later on we work with law

1447
00:45:00,560 --> 00:45:01,920
enforcement we've actually had

1448
00:45:01,920 --> 00:45:04,319
conversations with the fbi um we've had

1449
00:45:04,319 --> 00:45:06,079
conversations with some other letter

1450
00:45:06,079 --> 00:45:07,760
agencies that i can't name

1451
00:45:07,760 --> 00:45:09,599
um and we there was an there was

1452
00:45:09,599 --> 00:45:10,640
something with marist that we were

1453
00:45:10,640 --> 00:45:12,640
working on we were actually asked to to

1454
00:45:12,640 --> 00:45:14,400
stand down on it until europol was

1455
00:45:14,400 --> 00:45:16,000
finished with their work so yeah we

1456
00:45:16,000 --> 00:45:17,920
definitely we want to fully collaborate

1457
00:45:17,920 --> 00:45:19,359
with law enforcement and government

1458
00:45:19,359 --> 00:45:20,960
wherever we can just because we have a

1459
00:45:20,960 --> 00:45:23,200
visibility like we do and so we're we're

1460
00:45:23,200 --> 00:45:24,160
just saying

1461
00:45:24,160 --> 00:45:25,599
governments law enforcement people that

1462
00:45:25,599 --> 00:45:30,280
we can help out we'd love to cool

1463
00:45:42,000 --> 00:45:44,400
hey buddy hey question for you um so one

1464
00:45:44,400 --> 00:45:45,920
of the things that scares the absolute

1465
00:45:45,920 --> 00:45:48,160
 out of me is edge computing

1466
00:45:48,160 --> 00:45:50,480
um now my question for you is how

1467
00:45:50,480 --> 00:45:51,760
excuse me how does what you just

1468
00:45:51,760 --> 00:45:53,920
described in very good detail relate to

1469
00:45:53,920 --> 00:45:54,960
that

1470
00:45:54,960 --> 00:45:56,640
which part of what i described oh like

1471
00:45:56,640 --> 00:45:58,480
basically like uh let's say the

1472
00:45:58,480 --> 00:46:01,119
adversarial networks their approaches um

1473
00:46:01,119 --> 00:46:02,319
your technology stack and how it

1474
00:46:02,319 --> 00:46:03,920
connects to edge computing specifically

1475
00:46:03,920 --> 00:46:05,040
is there a difference or is it about the

1476
00:46:05,040 --> 00:46:06,319
same

1477
00:46:06,319 --> 00:46:08,800
it's i mean in my experience it's fairly

1478
00:46:08,800 --> 00:46:10,480
the same i mean

1479
00:46:10,480 --> 00:46:11,839
at least the did i have limited

1480
00:46:11,839 --> 00:46:13,280
experience with edge computing it

1481
00:46:13,280 --> 00:46:15,839
loosely was microsoft pushing things out

1482
00:46:15,839 --> 00:46:18,880
closer to people um but i mean it to me

1483
00:46:18,880 --> 00:46:20,400
i don't think there's a much of a

1484
00:46:20,400 --> 00:46:21,599
difference only

1485
00:46:21,599 --> 00:46:23,599
it gets harder and harder the more like

1486
00:46:23,599 --> 00:46:24,800
we one of the things we have is

1487
00:46:24,800 --> 00:46:26,880
visibility problems even when i would do

1488
00:46:26,880 --> 00:46:28,160
assessments for companies where they'd

1489
00:46:28,160 --> 00:46:29,440
say yeah here's our autonomous system

1490
00:46:29,440 --> 00:46:32,079
but we're also in azure and we're in aws

1491
00:46:32,079 --> 00:46:33,920
all right i can't find you anymore right

1492
00:46:33,920 --> 00:46:36,000
if and if you're dns if it's not on like

1493
00:46:36,000 --> 00:46:37,640
a you know

1494
00:46:37,640 --> 00:46:40,000
www.yourcompany.com domain name in your

1495
00:46:40,000 --> 00:46:41,599
dns zones i'm not going to be able to

1496
00:46:41,599 --> 00:46:43,119
brute force it like right i can't run

1497
00:46:43,119 --> 00:46:44,960
brute forcing on your dns servers all

1498
00:46:44,960 --> 00:46:46,400
the time so

1499
00:46:46,400 --> 00:46:48,319
i'll know what ips you might own but if

1500
00:46:48,319 --> 00:46:50,079
you're doing a hybrid cloud approach or

1501
00:46:50,079 --> 00:46:51,200
you have stuff in the cloud that's not

1502
00:46:51,200 --> 00:46:52,880
in your dns records like we're totally

1503
00:46:52,880 --> 00:46:54,640
blind to it and that's that's continuing

1504
00:46:54,640 --> 00:46:56,160
to get to be a bigger and bigger gap is

1505
00:46:56,160 --> 00:46:58,240
the more people push to the cloud

1506
00:46:58,240 --> 00:47:00,160
the harder it becomes to do what i'm

1507
00:47:00,160 --> 00:47:02,400
talking about yeah once the cloud gets

1508
00:47:02,400 --> 00:47:04,400
its own cloud it's all over where is the

1509
00:47:04,400 --> 00:47:05,440
 out of me

1510
00:47:05,440 --> 00:47:07,440
yeah and i feel like the cloud companies

1511
00:47:07,440 --> 00:47:08,960
you know the cloud companies could be

1512
00:47:08,960 --> 00:47:10,160
doing a little bit better job to

1513
00:47:10,160 --> 00:47:12,160
proactively tell their own customers i

1514
00:47:12,160 --> 00:47:13,760
mean they could use grey noise to see if

1515
00:47:13,760 --> 00:47:15,280
something's scanning outside of their

1516
00:47:15,280 --> 00:47:17,760
cloud right if you if i was an aws and

1517
00:47:17,760 --> 00:47:19,599
azure customer and my vm suddenly starts

1518
00:47:19,599 --> 00:47:21,520
scanning the internet for microsoft sql

1519
00:47:21,520 --> 00:47:23,359
i would want to know that right but i'm

1520
00:47:23,359 --> 00:47:24,800
not aware of any cloud provider that

1521
00:47:24,800 --> 00:47:26,240
does that

1522
00:47:26,240 --> 00:47:29,100
thanks appreciate it yeah let's drink

1523
00:47:29,100 --> 00:47:31,680
[Laughter]

1524
00:47:31,680 --> 00:47:34,919
thank you

