1
00:00:00,030 --> 00:00:05,100
hi everyone first of all I'm gonna start

2
00:00:02,850 --> 00:00:06,990
by putting on my glasses because I never

3
00:00:05,100 --> 00:00:11,820
have them on and people don't recognize

4
00:00:06,990 --> 00:00:14,400
me with them on so I'm rather humbled to

5
00:00:11,820 --> 00:00:17,100
be here because believe it or not this

6
00:00:14,400 --> 00:00:19,230
is the 11th time I'm at activity and

7
00:00:17,100 --> 00:00:21,449
this is the first presentation I were

8
00:00:19,230 --> 00:00:24,359
submitted and it got accepted so I'm

9
00:00:21,449 --> 00:00:28,619
forever grateful for the organizers so

10
00:00:24,359 --> 00:00:30,570
um honestly I have so many friends

11
00:00:28,619 --> 00:00:32,040
sitting here in the front row that kind

12
00:00:30,570 --> 00:00:34,469
of feels like a bachelor party at this

13
00:00:32,040 --> 00:00:36,540
point except my fiance is here as well

14
00:00:34,469 --> 00:00:39,629
so okay ah

15
00:00:36,540 --> 00:00:41,610
hacking games my budget so those of you

16
00:00:39,629 --> 00:00:44,420
who don't know me I'm a penetration

17
00:00:41,610 --> 00:00:47,899
tester slash red team lead at Vodafone

18
00:00:44,420 --> 00:00:51,300
I'm a Buddhist University technology and

19
00:00:47,899 --> 00:00:54,090
inside that the security team alumna I'm

20
00:00:51,300 --> 00:00:57,209
enough abet soup enthusiast I like

21
00:00:54,090 --> 00:00:59,219
collecting certificates and since my job

22
00:00:57,210 --> 00:01:00,989
is pen testing my biggest hobbies

23
00:00:59,219 --> 00:01:02,699
writing script I wrote one into all the

24
00:01:00,989 --> 00:01:05,518
possible fields on web applications so

25
00:01:02,699 --> 00:01:07,830
but when I'm not doing that I enjoy good

26
00:01:05,519 --> 00:01:10,530
working building with Legos which I'm

27
00:01:07,830 --> 00:01:11,760
not ashamed of and weight lifting

28
00:01:10,530 --> 00:01:15,900
because let's go

29
00:01:11,760 --> 00:01:17,820
but ah you're not about not here to hear

30
00:01:15,900 --> 00:01:22,110
about me you're here to hear about

31
00:01:17,820 --> 00:01:24,720
hacking ATMs and I'm gonna speak first a

32
00:01:22,110 --> 00:01:27,119
little bit about the journey on how this

33
00:01:24,720 --> 00:01:29,429
whole thing went and one of the reasons

34
00:01:27,119 --> 00:01:32,100
is because one of the questions I get

35
00:01:29,430 --> 00:01:35,310
all the time is hey how do you get into

36
00:01:32,100 --> 00:01:36,839
hacking ATMs without going to jail and I

37
00:01:35,310 --> 00:01:38,850
must speak a little bit about that and

38
00:01:36,840 --> 00:01:41,009
the second reason is that a lot of

39
00:01:38,850 --> 00:01:43,439
people helped me actually doing this and

40
00:01:41,009 --> 00:01:46,009
a couple of thank yous are in order and

41
00:01:43,439 --> 00:01:50,548
I really don't wanna miss that so yeah

42
00:01:46,009 --> 00:01:52,049
story time it all started out and my

43
00:01:50,549 --> 00:01:54,960
previous work place I used to work at

44
00:01:52,049 --> 00:01:57,479
console r12 which is a small consultancy

45
00:01:54,960 --> 00:02:00,869
here in Budapest and we actually offered

46
00:01:57,479 --> 00:02:02,969
testing ATMs as a service we didn't have

47
00:02:00,869 --> 00:02:06,509
too many customers but it gave me a

48
00:02:02,969 --> 00:02:09,869
taste of this whole business and I found

49
00:02:06,509 --> 00:02:12,310
it fascinating I mean an ATM is

50
00:02:09,869 --> 00:02:14,350
essentially a big pile of cash

51
00:02:12,310 --> 00:02:17,620
by a computer if that's not motivating I

52
00:02:14,350 --> 00:02:20,680
don't know what is it also combines a

53
00:02:17,620 --> 00:02:23,050
lot of areas of hacking I mean you get

54
00:02:20,680 --> 00:02:25,500
hardware hacking you get software

55
00:02:23,050 --> 00:02:27,970
reverse engineering malware Network

56
00:02:25,500 --> 00:02:29,530
hacking all of that stuff in the single

57
00:02:27,970 --> 00:02:34,480
package so I think it's fascinating

58
00:02:29,530 --> 00:02:37,270
absolutely like all both my journeys I

59
00:02:34,480 --> 00:02:40,450
think this started out with a conflict

60
00:02:37,270 --> 00:02:42,100
and the conflict was that it was I had

61
00:02:40,450 --> 00:02:45,670
to write my master's thesis and I didn't

62
00:02:42,100 --> 00:02:47,620
want to and I figured the only way I'm

63
00:02:45,670 --> 00:02:51,970
ever gonna finish this is if I pick a

64
00:02:47,620 --> 00:02:53,680
topic that you know interesting and I

65
00:02:51,970 --> 00:02:57,609
don't get tired of it

66
00:02:53,680 --> 00:03:00,580
and my professor at the University dr.

67
00:02:57,610 --> 00:03:02,769
Demento Bucheon was super helpful he

68
00:03:00,580 --> 00:03:04,360
actually let me pick my own topic I mean

69
00:03:02,769 --> 00:03:06,640
obviously they couldn't provide me an

70
00:03:04,360 --> 00:03:09,819
actual ATM to heck that was on me to

71
00:03:06,640 --> 00:03:13,208
solve but they were fully supportive of

72
00:03:09,819 --> 00:03:15,790
me writing my thesis on this so I

73
00:03:13,209 --> 00:03:18,100
started doing research and to avoid

74
00:03:15,790 --> 00:03:20,890
getting into trouble the way I approach

75
00:03:18,100 --> 00:03:23,500
this whole thing was that I started

76
00:03:20,890 --> 00:03:26,649
first browsing open source intelligence

77
00:03:23,500 --> 00:03:29,500
so I did a lot of google hacking I speak

78
00:03:26,650 --> 00:03:32,680
very little Russian so I proposed on

79
00:03:29,500 --> 00:03:35,049
Russian forums apparently legislation on

80
00:03:32,680 --> 00:03:39,280
ATM security is a little bit different

81
00:03:35,049 --> 00:03:41,320
in Russia so you have a somewhat more

82
00:03:39,280 --> 00:03:44,709
information in Russian on ATMs than you

83
00:03:41,320 --> 00:03:46,180
get in English so that was helpful and I

84
00:03:44,709 --> 00:03:47,859
just tried to learn about the different

85
00:03:46,180 --> 00:03:50,470
attack techniques on how you can

86
00:03:47,859 --> 00:03:52,840
actually crack an ATM how do I read a

87
00:03:50,470 --> 00:03:56,530
lot of articles police reports white

88
00:03:52,840 --> 00:03:59,019
papers you name it and by that time I

89
00:03:56,530 --> 00:04:01,120
started getting a picture of all the

90
00:03:59,019 --> 00:04:04,780
different areas you can attack an ATM on

91
00:04:01,120 --> 00:04:07,510
and it was interesting but the problem

92
00:04:04,780 --> 00:04:12,850
was obviously to proceed I needed access

93
00:04:07,510 --> 00:04:14,440
to an actual ATM and that's where it was

94
00:04:12,850 --> 00:04:18,820
great that Bureau Gabriela and her

95
00:04:14,440 --> 00:04:21,608
colleague chubby Shaggy Java who worked

96
00:04:18,820 --> 00:04:23,330
at the bank at the time took me under

97
00:04:21,608 --> 00:04:27,020
their wings

98
00:04:23,330 --> 00:04:29,300
I actually got to test my first ATM in

99
00:04:27,020 --> 00:04:31,490
their bank unfortunately I couldn't try

100
00:04:29,300 --> 00:04:34,250
everything because this was this wasn't

101
00:04:31,490 --> 00:04:35,720
a production ATM it was a test ATM but

102
00:04:34,250 --> 00:04:39,890
they obviously couldn't rip it apart

103
00:04:35,720 --> 00:04:43,010
and but it finally let a little glimpse

104
00:04:39,890 --> 00:04:46,820
into how this whole thing works and I

105
00:04:43,010 --> 00:04:50,150
could try a couple of things and after

106
00:04:46,820 --> 00:04:52,580
this I gave us a really small talk to a

107
00:04:50,150 --> 00:04:54,580
handful of people at the women in IT

108
00:04:52,580 --> 00:04:59,180
security conference two years ago and

109
00:04:54,580 --> 00:05:00,890
there was when I met dr. major Shimon

110
00:04:59,180 --> 00:05:05,270
Bella who is a professor at the

111
00:05:00,890 --> 00:05:08,210
university of public service and I just

112
00:05:05,270 --> 00:05:10,190
treated my talk and the whole

113
00:05:08,210 --> 00:05:13,010
conversation went something like this he

114
00:05:10,190 --> 00:05:14,960
came up to me and he said hey I'm from

115
00:05:13,010 --> 00:05:19,670
law enforcement are you the guy who acts

116
00:05:14,960 --> 00:05:23,539
ATMs I was like yeah we have two ATMs do

117
00:05:19,670 --> 00:05:26,150
you even hack them yeah yeah we just

118
00:05:23,540 --> 00:05:27,920
started doing this and it was awesome

119
00:05:26,150 --> 00:05:30,950
because obviously these were

120
00:05:27,920 --> 00:05:35,120
decommissioned ATMs for disclosure these

121
00:05:30,950 --> 00:05:37,130
are somewhat older models 2006 if but

122
00:05:35,120 --> 00:05:40,610
they were still in use when I started

123
00:05:37,130 --> 00:05:45,950
doing this whole thing in Hungary and I

124
00:05:40,610 --> 00:05:48,980
believe ATMs have a tendency to wander

125
00:05:45,950 --> 00:05:50,390
around from west to east so if something

126
00:05:48,980 --> 00:05:52,490
gets thrown out in Germany that's

127
00:05:50,390 --> 00:05:54,020
usually ends up in Hungary and what gets

128
00:05:52,490 --> 00:05:57,380
thrown out to Hungary usually ends up

129
00:05:54,020 --> 00:05:59,900
far east so yeah these models might

130
00:05:57,380 --> 00:06:02,840
still be in use but they are officially

131
00:05:59,900 --> 00:06:05,929
unsupported so I could do whatever I

132
00:06:02,840 --> 00:06:07,760
want with them um obviously we had to

133
00:06:05,930 --> 00:06:10,160
set some goals on what we wanted to

134
00:06:07,760 --> 00:06:13,520
achieve and since I already knew the

135
00:06:10,160 --> 00:06:17,090
different attack categories and you know

136
00:06:13,520 --> 00:06:19,609
some I had some research on how to

137
00:06:17,090 --> 00:06:23,479
actually do this we set out to be a

138
00:06:19,610 --> 00:06:27,620
series of demos to demonstrate ATM

139
00:06:23,480 --> 00:06:30,530
attacks against these systems and the

140
00:06:27,620 --> 00:06:33,230
purpose for this was to show forensic

141
00:06:30,530 --> 00:06:34,580
specialist police officers whatever how

142
00:06:33,230 --> 00:06:38,150
actually this thing worked and

143
00:06:34,580 --> 00:06:41,000
your life so as I said at this point I

144
00:06:38,150 --> 00:06:45,198
knew quite a lot about ATMs so we're

145
00:06:41,000 --> 00:06:47,210
gonna start by looking at how actually

146
00:06:45,199 --> 00:06:48,919
an ATM is built so we can understand all

147
00:06:47,210 --> 00:06:55,758
the different attack vectors that you

148
00:06:48,919 --> 00:06:57,650
can have an on ATM yeah so forgive my

149
00:06:55,759 --> 00:07:00,530
terrible terrible it's really design

150
00:06:57,650 --> 00:07:03,318
skills but yeah this is where I could

151
00:07:00,530 --> 00:07:05,030
cook up ah obviously everyone is

152
00:07:03,319 --> 00:07:07,969
familiar with this this is the outside

153
00:07:05,030 --> 00:07:11,239
of ATM but we're going to look how it

154
00:07:07,969 --> 00:07:14,569
looks on the inside so an ATM actually

155
00:07:11,240 --> 00:07:18,020
consists of two main parts if you rip

156
00:07:14,569 --> 00:07:20,090
the outer cover off which is essentially

157
00:07:18,020 --> 00:07:21,590
just sheet metal nothing it's it's not

158
00:07:20,090 --> 00:07:23,568
armored on the outside if you go up to

159
00:07:21,590 --> 00:07:26,210
an ATM and knock on the side you can

160
00:07:23,569 --> 00:07:29,029
feel that it really really feels like a

161
00:07:26,210 --> 00:07:31,099
PC case so it's just sheet metal plastic

162
00:07:29,029 --> 00:07:33,590
you have a frame which holds all the

163
00:07:31,099 --> 00:07:36,349
components and actually an ATM is

164
00:07:33,590 --> 00:07:39,758
surprising modular and all these modules

165
00:07:36,349 --> 00:07:42,800
are usually manufactured by different

166
00:07:39,759 --> 00:07:46,669
companies so they have to have a common

167
00:07:42,800 --> 00:07:48,889
interface to work together the lower

168
00:07:46,669 --> 00:07:50,990
half of the whole thing is called the

169
00:07:48,889 --> 00:07:54,020
safe area because that's where the safe

170
00:07:50,990 --> 00:07:56,569
is and the top half is called the

171
00:07:54,020 --> 00:07:59,479
service area and that woods actually all

172
00:07:56,569 --> 00:08:01,430
the components that control the safe and

173
00:07:59,479 --> 00:08:05,360
the whole operation that was the

174
00:08:01,430 --> 00:08:07,370
computer and that holds obviously all

175
00:08:05,360 --> 00:08:09,770
the components that are visible from the

176
00:08:07,370 --> 00:08:12,259
outside the touchscreen the pin pad the

177
00:08:09,770 --> 00:08:13,669
card reader the receipt printer stuff

178
00:08:12,259 --> 00:08:15,259
like that but you can't see on the

179
00:08:13,669 --> 00:08:17,628
outside obviously is that it has a

180
00:08:15,259 --> 00:08:20,889
computer and you would be surprised so

181
00:08:17,629 --> 00:08:25,129
this I've seen ATMs which actually had a

182
00:08:20,889 --> 00:08:27,650
simple EDX IBM computer so it's nothing

183
00:08:25,129 --> 00:08:28,250
special it's not like something fancy

184
00:08:27,650 --> 00:08:31,250
flashy

185
00:08:28,250 --> 00:08:33,740
I know industrial stuff it's usually

186
00:08:31,250 --> 00:08:35,269
just a regular PC to make matters worse

187
00:08:33,740 --> 00:08:36,890
it does

188
00:08:35,269 --> 00:08:39,409
I mean you've all seen the screenshots I

189
00:08:36,890 --> 00:08:40,250
suppose of ATMs crashing it does around

190
00:08:39,409 --> 00:08:43,338
windows

191
00:08:40,250 --> 00:08:45,649
these ones Ryan ran Windows XP newer

192
00:08:43,339 --> 00:08:47,800
ones are much more secure they run in

193
00:08:45,649 --> 00:08:47,800
those

194
00:08:47,949 --> 00:08:55,699
but yeah it's windows what else so you

195
00:08:51,889 --> 00:08:58,459
have a really massive power supply to

196
00:08:55,699 --> 00:09:01,300
run all this an ATM throws a ridiculous

197
00:08:58,459 --> 00:09:04,849
amount of power when it's powered on and

198
00:09:01,300 --> 00:09:06,050
you usually have a hub it's either so it

199
00:09:04,850 --> 00:09:09,319
depends on the manufacturer it's either

200
00:09:06,050 --> 00:09:10,910
USB or some kind of serial hop 2 to

201
00:09:09,319 --> 00:09:16,069
connect all these variants to the

202
00:09:10,910 --> 00:09:18,589
computer so what else do you have in the

203
00:09:16,069 --> 00:09:20,060
lower half you have something that's

204
00:09:18,589 --> 00:09:21,769
really really interesting I mean the

205
00:09:20,060 --> 00:09:24,469
safe itself is fascinating from a

206
00:09:21,769 --> 00:09:27,560
mechanical engineering part but I am NOT

207
00:09:24,470 --> 00:09:28,970
going to talk much about it from our

208
00:09:27,560 --> 00:09:30,258
point of view the most interesting

209
00:09:28,970 --> 00:09:33,860
component of the whole thing is the

210
00:09:30,259 --> 00:09:36,019
dispenser this is like really really

211
00:09:33,860 --> 00:09:39,190
massive this is electromechanical beast

212
00:09:36,019 --> 00:09:42,829
of a machine housed inside the safe and

213
00:09:39,190 --> 00:09:45,430
all it does is just delivers banknotes

214
00:09:42,829 --> 00:09:47,329
to the to the slot on the top but it's

215
00:09:45,430 --> 00:09:49,040
fascinating the complex

216
00:09:47,329 --> 00:09:50,689
the only problem obvious is that it's

217
00:09:49,040 --> 00:09:56,870
mostly controlled by the computer in the

218
00:09:50,690 --> 00:09:59,180
in the top half of the ATM so yeah ok

219
00:09:56,870 --> 00:10:03,649
so that's your crash course on how ATMs

220
00:09:59,180 --> 00:10:07,699
work I think from this you can already

221
00:10:03,649 --> 00:10:09,980
deduce a couple of potential problems

222
00:10:07,699 --> 00:10:13,459
and potential attack vectors I mean as I

223
00:10:09,980 --> 00:10:17,060
said obviously you can just attack it

224
00:10:13,459 --> 00:10:20,810
from the outside so one of the most

225
00:10:17,060 --> 00:10:22,910
common attack methods against ATMs is

226
00:10:20,810 --> 00:10:24,018
the so called skimming attack I'm pretty

227
00:10:22,910 --> 00:10:26,930
sure everyone this room heard about

228
00:10:24,019 --> 00:10:29,000
these this is when they slap something

229
00:10:26,930 --> 00:10:31,670
over the card slot a little gadget that

230
00:10:29,000 --> 00:10:35,600
records the magnetic stripe card data

231
00:10:31,670 --> 00:10:38,810
presented to the ATM and then they just

232
00:10:35,600 --> 00:10:40,939
do this for code from the robot ever the

233
00:10:38,810 --> 00:10:43,040
next one is network network attacks

234
00:10:40,939 --> 00:10:45,560
these aren't that common I mean there

235
00:10:43,040 --> 00:10:47,269
was a surge I think a year ago when they

236
00:10:45,560 --> 00:10:49,638
actually didn't attack the ATMs but

237
00:10:47,269 --> 00:10:52,670
instead attacked the back end through

238
00:10:49,639 --> 00:10:55,220
these network connections sometimes

239
00:10:52,670 --> 00:10:57,180
these are exposed I mean you can see it

240
00:10:55,220 --> 00:11:00,090
on you

241
00:10:57,180 --> 00:11:02,010
eighteens please just on the street but

242
00:11:00,090 --> 00:11:04,080
sometimes Etienne's use wireless so you

243
00:11:02,010 --> 00:11:05,610
don't even see this but if you can

244
00:11:04,080 --> 00:11:08,250
access that you can try your luck with

245
00:11:05,610 --> 00:11:13,740
that that can get some interesting

246
00:11:08,250 --> 00:11:15,930
results as well but the actual

247
00:11:13,740 --> 00:11:17,670
interesting technical attack methods

248
00:11:15,930 --> 00:11:20,040
usually involves somehow getting into

249
00:11:17,670 --> 00:11:22,410
the service area as I said this is

250
00:11:20,040 --> 00:11:24,000
usually protected by weak materials so

251
00:11:22,410 --> 00:11:27,900
you can just ask actually drill a hole

252
00:11:24,000 --> 00:11:31,370
into it and access the wiring and this

253
00:11:27,900 --> 00:11:36,180
is what most of the attacks that are

254
00:11:31,370 --> 00:11:38,730
more advanced are based on so they first

255
00:11:36,180 --> 00:11:41,430
reel a hole and they connect to some of

256
00:11:38,730 --> 00:11:44,520
the components inside the ADM depending

257
00:11:41,430 --> 00:11:47,640
on what you want to do you can either do

258
00:11:44,520 --> 00:11:50,640
a Navarrete AK where you just plug in

259
00:11:47,640 --> 00:11:52,800
the USB into the control contributor and

260
00:11:50,640 --> 00:11:54,900
install them over on that it has two

261
00:11:52,800 --> 00:11:57,660
interface obviously the ATM software and

262
00:11:54,900 --> 00:12:00,420
drivers and stuff there to dispense cash

263
00:11:57,660 --> 00:12:03,300
or you can do a black box attack which

264
00:12:00,420 --> 00:12:05,670
is if you look at that way I mean it's

265
00:12:03,300 --> 00:12:07,859
kind of like a hardware mall there you

266
00:12:05,670 --> 00:12:09,510
plug it either on the dispenser or

267
00:12:07,860 --> 00:12:11,880
between the dispenser and the computer

268
00:12:09,510 --> 00:12:13,800
and just you you just do a man in the

269
00:12:11,880 --> 00:12:16,460
middle attack against the traffic

270
00:12:13,800 --> 00:12:18,780
between the computer and the dispenser I

271
00:12:16,460 --> 00:12:22,200
mean you can see on this picture this is

272
00:12:18,780 --> 00:12:24,120
so black boxes are supposed to be small

273
00:12:22,200 --> 00:12:27,000
so you because you are supposed to put

274
00:12:24,120 --> 00:12:28,440
it in the ATM then close it back this on

275
00:12:27,000 --> 00:12:31,530
the picture this is a Russian black box

276
00:12:28,440 --> 00:12:34,680
and it's massive so that card there

277
00:12:31,530 --> 00:12:37,140
that's an is a bus and it's like this

278
00:12:34,680 --> 00:12:40,349
long so it's it's really it's a backpack

279
00:12:37,140 --> 00:12:42,900
size thing the whole point of this is

280
00:12:40,350 --> 00:12:46,710
that it runs the driver that interfaces

281
00:12:42,900 --> 00:12:48,300
with the ATM and just sends commands to

282
00:12:46,710 --> 00:12:56,910
the dispenser so this is the basic

283
00:12:48,300 --> 00:12:59,430
layout so and yeah so mal there mal

284
00:12:56,910 --> 00:13:02,160
there is a really interesting because

285
00:12:59,430 --> 00:13:04,229
you would think that all the ATM vendors

286
00:13:02,160 --> 00:13:08,069
write their own software and that's true

287
00:13:04,230 --> 00:13:09,210
to an extent but these now can actually

288
00:13:08,070 --> 00:13:12,210
be

289
00:13:09,210 --> 00:13:13,950
cross-platform because the financial

290
00:13:12,210 --> 00:13:17,280
industry has something called

291
00:13:13,950 --> 00:13:20,370
XFS protocol and that is basically a

292
00:13:17,280 --> 00:13:23,939
common API that all the vendors software

293
00:13:20,370 --> 00:13:25,650
have to call and most malware target

294
00:13:23,940 --> 00:13:29,100
this directly so it doesn't matter of

295
00:13:25,650 --> 00:13:30,810
each vendor the ATM was made by you can

296
00:13:29,100 --> 00:13:32,640
install the malware on it and it's gonna

297
00:13:30,810 --> 00:13:35,160
interface with the XSS API and just

298
00:13:32,640 --> 00:13:37,250
dispense cash to that so it's kind of

299
00:13:35,160 --> 00:13:42,630
amazing

300
00:13:37,250 --> 00:13:46,050
so I set out to build try to be at all

301
00:13:42,630 --> 00:13:48,630
of these things I choose first of all I

302
00:13:46,050 --> 00:13:51,180
wanted to build myself a skimmer because

303
00:13:48,630 --> 00:13:52,830
you know that seemed like something from

304
00:13:51,180 --> 00:13:55,439
engineering perspective that could be

305
00:13:52,830 --> 00:13:59,070
done doesn't didn't look too

306
00:13:55,440 --> 00:14:02,220
sophisticated to be honest I set out to

307
00:13:59,070 --> 00:14:05,910
get a mother sample that I can actually

308
00:14:02,220 --> 00:14:08,400
run on my test ATMs and see if it works

309
00:14:05,910 --> 00:14:11,219
or not so I just there are a lot of

310
00:14:08,400 --> 00:14:15,630
different samples some of them are

311
00:14:11,220 --> 00:14:17,820
really hard to get but event you're

312
00:14:15,630 --> 00:14:20,150
going to see I went with a Russian

313
00:14:17,820 --> 00:14:21,630
sample which was kind of advanced so I

314
00:14:20,150 --> 00:14:24,270
chose that one

315
00:14:21,630 --> 00:14:27,840
and I also set out to be a black box

316
00:14:24,270 --> 00:14:28,949
attack which again I thought would be

317
00:14:27,840 --> 00:14:30,770
interesting from engineering perspective

318
00:14:28,950 --> 00:14:32,850
but turned out to be a real nightmare so

319
00:14:30,770 --> 00:14:37,710
these are the three things I'm going to

320
00:14:32,850 --> 00:14:41,370
talk about so let's start um

321
00:14:37,710 --> 00:14:42,630
skimming to understand skimming you're

322
00:14:41,370 --> 00:14:45,740
gonna know a little bit about how this

323
00:14:42,630 --> 00:14:49,740
whole magnetic stripe thing works

324
00:14:45,740 --> 00:14:51,360
basically I mean I ran into a lot of

325
00:14:49,740 --> 00:14:53,280
misinformation on this topic when I

326
00:14:51,360 --> 00:14:54,540
research it because people don't really

327
00:14:53,280 --> 00:14:57,420
seem to realize what is actually

328
00:14:54,540 --> 00:14:59,160
contained on the magnetic stripe and how

329
00:14:57,420 --> 00:15:00,390
you decode that is it encrypt it not

330
00:14:59,160 --> 00:15:03,510
encrypt it how it works yeah

331
00:15:00,390 --> 00:15:06,090
so the thing is on a physical level the

332
00:15:03,510 --> 00:15:08,450
magnetic stripe has something called an

333
00:15:06,090 --> 00:15:10,860
NRC and arbiter to zero in coding and

334
00:15:08,450 --> 00:15:12,240
basically just those binary data so if

335
00:15:10,860 --> 00:15:16,260
you stripe it it's just a series of

336
00:15:12,240 --> 00:15:18,150
chirps you can actually use a sound card

337
00:15:16,260 --> 00:15:22,319
and the magnetic tape had to decode it

338
00:15:18,150 --> 00:15:26,130
or yeah in theory the data

339
00:15:22,320 --> 00:15:28,980
hold is I mean depends kind of on the

340
00:15:26,130 --> 00:15:31,470
manufacturer but usually it is the card

341
00:15:28,980 --> 00:15:33,240
number the expiration date and the name

342
00:15:31,470 --> 00:15:36,960
of the cardholder so it doesn't have the

343
00:15:33,240 --> 00:15:38,850
pink code or whatever but and this is

344
00:15:36,960 --> 00:15:40,380
where most people in from Hungary ask

345
00:15:38,850 --> 00:15:42,540
how do you use that because that's

346
00:15:40,380 --> 00:15:44,760
usually enough for payment right I'm in

347
00:15:42,540 --> 00:15:47,640
Europe because you either use a chip and

348
00:15:44,760 --> 00:15:51,240
pin or tap your card or whatever the

349
00:15:47,640 --> 00:15:53,760
thing is legislation in the banking

350
00:15:51,240 --> 00:15:56,880
sector differs across countries so in

351
00:15:53,760 --> 00:15:58,890
some countries you can actually pay just

352
00:15:56,880 --> 00:16:01,770
swiping your card and they don't ask for

353
00:15:58,890 --> 00:16:04,650
any code or anything and what happens is

354
00:16:01,770 --> 00:16:06,720
they steal card data in Europe then

355
00:16:04,650 --> 00:16:08,850
kinda export it to those countries I

356
00:16:06,720 --> 00:16:10,080
mean you might ask what are those

357
00:16:08,850 --> 00:16:11,370
countries there must be some

358
00:16:10,080 --> 00:16:13,020
underdeveloped whatever kind of

359
00:16:11,370 --> 00:16:15,540
countries yes so the biggest one is the

360
00:16:13,020 --> 00:16:18,210
USA so in the US you can actually just

361
00:16:15,540 --> 00:16:21,410
save it swiping your card so there you

362
00:16:18,210 --> 00:16:23,670
go so yeah this is data you have to read

363
00:16:21,410 --> 00:16:25,500
obviously there are some challenges

364
00:16:23,670 --> 00:16:27,270
because it's not really a sterile

365
00:16:25,500 --> 00:16:29,580
environment you know it's not like when

366
00:16:27,270 --> 00:16:31,280
you actually swipe your card it goes

367
00:16:29,580 --> 00:16:34,680
through the card slot it shakes whatever

368
00:16:31,280 --> 00:16:38,339
you can actually by skimmer Hardware

369
00:16:34,680 --> 00:16:42,030
online and as far as I observed the

370
00:16:38,340 --> 00:16:44,430
price really depends on how obvious it

371
00:16:42,030 --> 00:16:46,459
is that it's a skimmer so you can get

372
00:16:44,430 --> 00:16:50,969
the skimmer for five thousand US dollars

373
00:16:46,460 --> 00:16:54,600
you can get a portable small form-factor

374
00:16:50,970 --> 00:16:57,150
card reader that this has advanced error

375
00:16:54,600 --> 00:16:59,400
correction for incorrect reads and the

376
00:16:57,150 --> 00:17:00,810
memory chip and bluetooth that goes

377
00:16:59,400 --> 00:17:03,030
about for a thousand dollars or

378
00:17:00,810 --> 00:17:05,310
something but I mean calling a skimmer a

379
00:17:03,030 --> 00:17:07,010
portable small Fox or card reader is

380
00:17:05,310 --> 00:17:11,750
just like you know calling a handgun

381
00:17:07,010 --> 00:17:14,699
stainless table a dispenser so it yeah

382
00:17:11,750 --> 00:17:16,470
but I didn't wanna do that reason a I

383
00:17:14,699 --> 00:17:18,240
had about 100 dollars for this whole

384
00:17:16,470 --> 00:17:19,980
project and that was a little bit

385
00:17:18,240 --> 00:17:21,870
outside my budget and reason BAE I

386
00:17:19,980 --> 00:17:25,920
didn't wanna get in trouble so I just

387
00:17:21,869 --> 00:17:28,198
went on and design my own so since I was

388
00:17:25,920 --> 00:17:31,020
an engineering student I approach it

389
00:17:28,199 --> 00:17:32,880
from engineering perspective so I just

390
00:17:31,020 --> 00:17:34,360
laid out in my head you I'm gonna need a

391
00:17:32,880 --> 00:17:35,380
magnetic tape head

392
00:17:34,360 --> 00:17:37,928
I'm gonna need an operational amplifier

393
00:17:35,380 --> 00:17:40,059
I'm gonna need an ad convent go after

394
00:17:37,929 --> 00:17:41,500
connected to microprocessor I'm gonna

395
00:17:40,059 --> 00:17:43,030
need you Artie to connect to the

396
00:17:41,500 --> 00:17:44,080
Bluetooth interface I'm gonna need see

397
00:17:43,030 --> 00:17:45,760
view and I'm gonna write a custom

398
00:17:44,080 --> 00:17:48,189
application to receive all the data from

399
00:17:45,760 --> 00:17:50,440
the Bluetooth module I was like yeah no

400
00:17:48,190 --> 00:17:52,270
I mean I had like one weekend for this

401
00:17:50,440 --> 00:17:54,370
whole project so what I actually ended

402
00:17:52,270 --> 00:17:55,690
up doing was I bought the Chinese in

403
00:17:54,370 --> 00:18:02,409
card reader from eBay and sleddin

404
00:17:55,690 --> 00:18:03,100
Arduino on it so tough luck but it

405
00:18:02,410 --> 00:18:05,530
worked

406
00:18:03,100 --> 00:18:07,659
I mentioned Bluetooth I really wanted

407
00:18:05,530 --> 00:18:10,530
something with Bluetooth the reason is

408
00:18:07,660 --> 00:18:13,919
because you know men love bluetooth no I

409
00:18:10,530 --> 00:18:16,899
wanted it because actual card with

410
00:18:13,919 --> 00:18:19,450
schemers and nowadays have Bluetooth and

411
00:18:16,900 --> 00:18:21,040
the reason for that is it reduces the

412
00:18:19,450 --> 00:18:23,470
risk of for the attacker I mean you know

413
00:18:21,040 --> 00:18:25,990
if you just have a memory chip on it you

414
00:18:23,470 --> 00:18:27,520
have to go to the ATM install it wait

415
00:18:25,990 --> 00:18:29,410
for people to use their code hoping

416
00:18:27,520 --> 00:18:31,840
doesn't get discovered and then go back

417
00:18:29,410 --> 00:18:33,580
again and you know retrieve it with blue

418
00:18:31,840 --> 00:18:35,620
services you can just drive-by download

419
00:18:33,580 --> 00:18:38,110
the data and forget about the schemers

420
00:18:35,620 --> 00:18:40,540
so that's also if you go on google play

421
00:18:38,110 --> 00:18:43,719
you can download an application called

422
00:18:40,540 --> 00:18:45,610
schemer scanner which is basically an

423
00:18:43,720 --> 00:18:48,179
app for discovering Bluetooth modules

424
00:18:45,610 --> 00:18:50,590
that are commonly used in skimmers I

425
00:18:48,179 --> 00:18:54,040
believe it was written for the US market

426
00:18:50,590 --> 00:18:56,709
they have card slots on gas pumps as

427
00:18:54,040 --> 00:18:59,200
well so gas pump skimmers are really

428
00:18:56,710 --> 00:19:00,760
really common and I want it to be as

429
00:18:59,200 --> 00:19:02,440
something that could be detected by this

430
00:19:00,760 --> 00:19:05,470
application so I choose a Bluetooth

431
00:19:02,440 --> 00:19:11,770
module that was coming in in actual

432
00:19:05,470 --> 00:19:14,669
skimmers so oh this is my schematic this

433
00:19:11,770 --> 00:19:16,809
is the Chinese in card reader it is

434
00:19:14,669 --> 00:19:18,790
absolutely amazing from an engineering

435
00:19:16,809 --> 00:19:20,710
perspective so this is a card reader

436
00:19:18,790 --> 00:19:22,809
that actually acts as a USB keyboard

437
00:19:20,710 --> 00:19:25,390
when you plug it in so what happens if

438
00:19:22,809 --> 00:19:28,000
you swipe your card it just type is your

439
00:19:25,390 --> 00:19:28,570
card number into notepad so it's it's

440
00:19:28,000 --> 00:19:31,840
lovely

441
00:19:28,570 --> 00:19:34,360
ah so I use the USB shield

442
00:19:31,840 --> 00:19:36,370
connected that to the Arduino said that

443
00:19:34,360 --> 00:19:40,600
the card readers actually keyboard

444
00:19:36,370 --> 00:19:45,129
slapped on Bluetooth module and wrote a

445
00:19:40,600 --> 00:19:47,019
few lines of code and it worked this is

446
00:19:45,130 --> 00:19:49,429
the housing I made

447
00:19:47,019 --> 00:19:54,159
you can see my amazing craftsmanship

448
00:19:49,429 --> 00:19:57,769
there I'm calling it the milk skimmer

449
00:19:54,159 --> 00:19:59,419
but it actually works this isn't a

450
00:19:57,769 --> 00:20:01,610
credit card it's my gym membership card

451
00:19:59,419 --> 00:20:04,220
I almost photographed my own credit card

452
00:20:01,610 --> 00:20:06,500
and that would be shameful but now and

453
00:20:04,220 --> 00:20:09,860
yeah this is the application I mean this

454
00:20:06,500 --> 00:20:12,919
is a standard USB USB bluetooth serial

455
00:20:09,860 --> 00:20:15,049
terminal for Android I implemented a

456
00:20:12,919 --> 00:20:18,740
couple of commands you can just dump the

457
00:20:15,049 --> 00:20:22,279
core data from the from the machine and

458
00:20:18,740 --> 00:20:26,919
yeah I mean it's not super reliable but

459
00:20:22,279 --> 00:20:32,450
for demonstration purposes it works okay

460
00:20:26,919 --> 00:20:33,740
let's move on now there again first I

461
00:20:32,450 --> 00:20:35,870
approach this from the engineering

462
00:20:33,740 --> 00:20:38,539
perspective so I actually tried writing

463
00:20:35,870 --> 00:20:43,039
my malware from the bottom up carefully

464
00:20:38,539 --> 00:20:45,740
reading the XFS API reverse engineering

465
00:20:43,039 --> 00:20:48,500
software whatever but again you know I

466
00:20:45,740 --> 00:20:51,889
had a deadline so what I ended up doing

467
00:20:48,500 --> 00:20:55,370
was I actually required a sample of the

468
00:20:51,889 --> 00:20:56,689
cube came all there I'm yeah I speak a

469
00:20:55,370 --> 00:20:59,178
bit of Russian but I have no idea how to

470
00:20:56,690 --> 00:21:03,049
pronounce this or what it means I hope

471
00:20:59,179 --> 00:21:06,320
it's nothing dirty and this is a really

472
00:21:03,049 --> 00:21:07,490
really famous I think you might have

473
00:21:06,320 --> 00:21:11,629
heard about this is a really famous

474
00:21:07,490 --> 00:21:15,610
mother it was it started its operation

475
00:21:11,629 --> 00:21:19,340
around 2009 but it was at its peak in

476
00:21:15,610 --> 00:21:20,990
2014 I believe and the reason why this

477
00:21:19,340 --> 00:21:24,100
is still around is because it's cross

478
00:21:20,990 --> 00:21:27,519
platform and it's awesome

479
00:21:24,100 --> 00:21:29,779
how do you get them over samples so

480
00:21:27,519 --> 00:21:32,179
apparently just go up to people on the

481
00:21:29,779 --> 00:21:34,700
internet and ask for it so I just went

482
00:21:32,179 --> 00:21:36,919
up to research and hey I need a TM over

483
00:21:34,700 --> 00:21:38,570
for research purposes she's like are you

484
00:21:36,919 --> 00:21:40,700
sure this is for research purposes I

485
00:21:38,570 --> 00:21:45,889
mean yeah and she just sent me a bunch

486
00:21:40,700 --> 00:21:47,870
of those I was really happy but yeah you

487
00:21:45,889 --> 00:21:50,600
can also do it with google hacking and

488
00:21:47,870 --> 00:21:53,389
obviously because sis admins are people

489
00:21:50,600 --> 00:21:57,459
some people just upload a TM ever to

490
00:21:53,389 --> 00:21:57,459
virustotal so yeah

491
00:21:57,900 --> 00:22:03,770
interesting thing about yukine is that

492
00:22:01,290 --> 00:22:06,360
it's written in C sharp or I mean dotnet

493
00:22:03,770 --> 00:22:08,100
which is awesome because you can use DNS

494
00:22:06,360 --> 00:22:09,899
pi if you haven't used the Nspire before

495
00:22:08,100 --> 00:22:14,879
try it it's like one of the most amazing

496
00:22:09,900 --> 00:22:17,060
free software I've ever used so you can

497
00:22:14,880 --> 00:22:18,960
use this to disassemble it and modify it

498
00:22:17,060 --> 00:22:21,570
it has some really really interesting

499
00:22:18,960 --> 00:22:23,970
mechanisms built into it some which are

500
00:22:21,570 --> 00:22:25,770
standard to male there some which is

501
00:22:23,970 --> 00:22:29,130
unique to 80 another I'm gonna talk a

502
00:22:25,770 --> 00:22:31,320
little bit about those as well and yeah

503
00:22:29,130 --> 00:22:33,920
so the whole problem was this had to be

504
00:22:31,320 --> 00:22:36,540
patched in order to be suitable for

505
00:22:33,920 --> 00:22:38,310
demonstration purposes and I'm just

506
00:22:36,540 --> 00:22:41,430
going to talk about the reasons why so

507
00:22:38,310 --> 00:22:45,540
first of all the malware has an anti

508
00:22:41,430 --> 00:22:48,330
sandbox check in check I mean it's like

509
00:22:45,540 --> 00:22:52,379
one of the Maverick coding one of the

510
00:22:48,330 --> 00:22:54,449
ones to avoid sandbox when the ATM when

511
00:22:52,380 --> 00:22:58,050
the marver is started you put in a delay

512
00:22:54,450 --> 00:23:01,220
asleep and you know the sandbox just

513
00:22:58,050 --> 00:23:03,480
times out if it's not set up properly

514
00:23:01,220 --> 00:23:05,190
obviously for demonstration purposes

515
00:23:03,480 --> 00:23:07,260
this is not too convenient because no

516
00:23:05,190 --> 00:23:07,980
student is going to wait 16 hours to see

517
00:23:07,260 --> 00:23:12,060
a demo of

518
00:23:07,980 --> 00:23:15,660
80ml there so I had to remove that that

519
00:23:12,060 --> 00:23:18,000
was fairly trivial another interesting

520
00:23:15,660 --> 00:23:20,490
thing the mavar was set up to only run

521
00:23:18,000 --> 00:23:24,600
at specific intervals during the day and

522
00:23:20,490 --> 00:23:26,070
during the week as well so all the cash

523
00:23:24,600 --> 00:23:29,580
health operations apparently happened

524
00:23:26,070 --> 00:23:32,879
between two at night and four at dawn on

525
00:23:29,580 --> 00:23:34,590
Saturdays so yeah also not too

526
00:23:32,880 --> 00:23:37,470
convenient for demonstration purposes I

527
00:23:34,590 --> 00:23:39,750
mean I could have just set the clock on

528
00:23:37,470 --> 00:23:41,640
the ATM obviously but you know your

529
00:23:39,750 --> 00:23:45,120
thought it was more awesome to patch

530
00:23:41,640 --> 00:23:47,070
this out as well there are a lot of

531
00:23:45,120 --> 00:23:49,260
white papers on this malware online and

532
00:23:47,070 --> 00:23:52,649
in Casper scales down one a bunch of

533
00:23:49,260 --> 00:23:54,450
other companies is done one but is

534
00:23:52,650 --> 00:23:56,610
usually obvious that they couldn't

535
00:23:54,450 --> 00:24:00,600
actually try it on a real mother a real

536
00:23:56,610 --> 00:24:02,520
atm sorry because the control mappings

537
00:24:00,600 --> 00:24:05,639
were almost always incorrect so I had to

538
00:24:02,520 --> 00:24:07,830
reverse engineer there as well and this

539
00:24:05,640 --> 00:24:09,430
is messed up honestly so you have key

540
00:24:07,830 --> 00:24:14,379
codes in hex

541
00:24:09,430 --> 00:24:16,270
and well I spent like 1/2 hours on just

542
00:24:14,380 --> 00:24:17,650
crazily pressing buttons is dead for

543
00:24:16,270 --> 00:24:21,190
example the number of on key on the

544
00:24:17,650 --> 00:24:23,020
keyboard is actually 0 x2 in hex it

545
00:24:21,190 --> 00:24:26,470
doesn't make sense so yeah that's

546
00:24:23,020 --> 00:24:28,150
confusing but it was really awesome that

547
00:24:26,470 --> 00:24:30,010
the Melva routers actually could

548
00:24:28,150 --> 00:24:32,260
intercept the keyboard messages from the

549
00:24:30,010 --> 00:24:36,000
pin pad and use that for controlling the

550
00:24:32,260 --> 00:24:39,220
ATM oh yeah

551
00:24:36,000 --> 00:24:41,910
miscellaneous stuff so since this was

552
00:24:39,220 --> 00:24:45,640
used by organized crime there was a

553
00:24:41,910 --> 00:24:49,390
pretty neat authentication process so

554
00:24:45,640 --> 00:24:50,460
how this how they operated from yeah my

555
00:24:49,390 --> 00:24:53,560
point of view is kind of fascinating

556
00:24:50,460 --> 00:24:56,620
because what they did is they had

557
00:24:53,560 --> 00:25:00,730
apparently smart people in the gang and

558
00:24:56,620 --> 00:25:03,159
muscle in the gang and they usually sent

559
00:25:00,730 --> 00:25:05,500
out people to collect the money from the

560
00:25:03,160 --> 00:25:07,720
ATMs but obviously the two groups didn't

561
00:25:05,500 --> 00:25:09,850
trust each other so what the smart guys

562
00:25:07,720 --> 00:25:12,160
did is they implemented a challenge

563
00:25:09,850 --> 00:25:13,840
response protocol in the malware so when

564
00:25:12,160 --> 00:25:16,390
someone went out to the ATM and

565
00:25:13,840 --> 00:25:18,490
activated the malware it presented a

566
00:25:16,390 --> 00:25:20,440
challenge code and wouldn't accept

567
00:25:18,490 --> 00:25:22,780
anything until a proper response was

568
00:25:20,440 --> 00:25:26,020
provided so the crook at the ATM had to

569
00:25:22,780 --> 00:25:28,330
activate the marver phone the guys back

570
00:25:26,020 --> 00:25:30,310
at HQ hey guys this is a challenge cause

571
00:25:28,330 --> 00:25:31,600
I need the response code the guys would

572
00:25:30,310 --> 00:25:33,429
give him the code and this way they

573
00:25:31,600 --> 00:25:36,780
would know who was redrawing is how much

574
00:25:33,430 --> 00:25:39,130
money at which ATM which is awesome

575
00:25:36,780 --> 00:25:41,860
obviously you can deduce from this that

576
00:25:39,130 --> 00:25:43,660
it had another software component for

577
00:25:41,860 --> 00:25:45,550
generating the responses based on

578
00:25:43,660 --> 00:25:49,090
challenge code and that just wasn't

579
00:25:45,550 --> 00:25:50,560
looking included with the sample I spent

580
00:25:49,090 --> 00:25:52,060
quite a lot of time we were sent during

581
00:25:50,560 --> 00:25:54,790
this algorithm how this whole thing was

582
00:25:52,060 --> 00:25:57,280
generated it's I mean it's messed up

583
00:25:54,790 --> 00:25:59,290
seriously it's really messed up I'm not

584
00:25:57,280 --> 00:26:01,389
gonna presented that now because I think

585
00:25:59,290 --> 00:26:04,659
that would be a little bit our line but

586
00:26:01,390 --> 00:26:07,180
I just ended up replacing the whole

587
00:26:04,660 --> 00:26:09,190
thing with the static code so so it

588
00:26:07,180 --> 00:26:13,840
would be easier to demo the whole thing

589
00:26:09,190 --> 00:26:16,390
so oh yeah extra my first write it in

590
00:26:13,840 --> 00:26:18,820
didn't work it just started spinning the

591
00:26:16,390 --> 00:26:21,149
ATM and no money came out it was like

592
00:26:18,820 --> 00:26:22,619
baffled I mean I spent like 20 hour

593
00:26:21,149 --> 00:26:26,399
reverse engineering patching valuer

594
00:26:22,619 --> 00:26:28,619
what's wrong and it turned out that the

595
00:26:26,399 --> 00:26:31,049
mayor wanted to dispense a stack of 40

596
00:26:28,619 --> 00:26:33,658
banknotes which is like pretty thick and

597
00:26:31,049 --> 00:26:35,158
my ATM just couldn't do that so just

598
00:26:33,659 --> 00:26:37,950
choked on the lot of money that was

599
00:26:35,159 --> 00:26:38,820
trying to dispense and yeah I had to

600
00:26:37,950 --> 00:26:43,259
patch it as well

601
00:26:38,820 --> 00:26:48,139
so malware video let's see how does this

602
00:26:43,259 --> 00:26:50,639
work to do there you go

603
00:26:48,139 --> 00:26:54,029
okay so this is the default interface of

604
00:26:50,639 --> 00:26:56,459
the ATM nothing fancier apparently this

605
00:26:54,029 --> 00:26:58,499
one came from the UK yeah eight pounds a

606
00:26:56,460 --> 00:27:01,589
year yeah

607
00:26:58,499 --> 00:27:05,159
so first step you go up to the ATM and

608
00:27:01,589 --> 00:27:06,450
you enter a cheat code and boom you have

609
00:27:05,159 --> 00:27:09,599
a cheat menu

610
00:27:06,450 --> 00:27:13,019
you can't just select the cassette from

611
00:27:09,599 --> 00:27:15,599
each video cache and you have a

612
00:27:13,019 --> 00:27:17,580
challenge code here and you see it says

613
00:27:15,599 --> 00:27:20,759
enter session key to proceed so you're

614
00:27:17,580 --> 00:27:22,439
gonna need the session key as I said I

615
00:27:20,759 --> 00:27:25,109
just replaced the algorithm with the

616
00:27:22,440 --> 00:27:26,580
static key because that was easier it's

617
00:27:25,109 --> 00:27:30,119
really tedious to type because it's like

618
00:27:26,580 --> 00:27:31,799
8 characters long boom it's really

619
00:27:30,119 --> 00:27:35,849
awesome good oh sorry

620
00:27:31,799 --> 00:27:37,918
rewind because it's really yep as you

621
00:27:35,849 --> 00:27:39,299
can see it does a couple of other things

622
00:27:37,919 --> 00:27:41,609
to protect itself as well I mean

623
00:27:39,299 --> 00:27:46,918
disables the local network and only

624
00:27:41,609 --> 00:27:49,769
after that does it allow the cache to

625
00:27:46,919 --> 00:27:52,169
proceed this is obviously to disable

626
00:27:49,769 --> 00:27:54,059
alarms and stuff like that okay and you

627
00:27:52,169 --> 00:27:57,089
can see cached operation permitted they

628
00:27:54,059 --> 00:28:01,379
go and yeah just pick which cassette you

629
00:27:57,089 --> 00:28:03,089
wanna video from which is awesome so you

630
00:28:01,379 --> 00:28:05,658
just select the cassette enter the code

631
00:28:03,089 --> 00:28:09,178
and it starts working working working

632
00:28:05,659 --> 00:28:14,179
again all the ATM super slow takes a lot

633
00:28:09,179 --> 00:28:19,190
of time but if you just wait patiently

634
00:28:14,179 --> 00:28:19,190
then we're gonna get a stack of

635
00:28:21,100 --> 00:28:30,500
four pieces of copy paper yeah that was

636
00:28:26,600 --> 00:28:37,699
what the ATM was filled with actually so

637
00:28:30,500 --> 00:28:39,320
yeah it works so yeah this is problem

638
00:28:37,700 --> 00:28:42,290
that was the conclusion of the the

639
00:28:39,320 --> 00:28:44,179
malware part I was really happy with it

640
00:28:42,290 --> 00:28:50,830
I honestly didn't believe it would work

641
00:28:44,180 --> 00:28:55,850
but it did so yeah next step black box

642
00:28:50,830 --> 00:28:57,350
as I said first I approach this again

643
00:28:55,850 --> 00:29:00,830
from an engineering perspective so I

644
00:28:57,350 --> 00:29:04,100
really really wanted to do it on a low

645
00:29:00,830 --> 00:29:05,990
level and figure out how to you know how

646
00:29:04,100 --> 00:29:08,659
this whole thing works the communication

647
00:29:05,990 --> 00:29:10,940
protocol everything and I wanted to do

648
00:29:08,660 --> 00:29:13,310
usb man-in-the-middle attack and just

649
00:29:10,940 --> 00:29:17,420
hands up guys who has ever tried

650
00:29:13,310 --> 00:29:20,210
debugging USB actually yeah

651
00:29:17,420 --> 00:29:21,800
I mean I haven't before this so those

652
00:29:20,210 --> 00:29:22,880
people will raise their hands gonna know

653
00:29:21,800 --> 00:29:25,340
that this is nightmare

654
00:29:22,880 --> 00:29:29,510
so the USB protocol is really complex

655
00:29:25,340 --> 00:29:32,330
you have device classes different speed

656
00:29:29,510 --> 00:29:35,210
settings whatever and the cherry on top

657
00:29:32,330 --> 00:29:37,490
of the whole thing and obviously Windows

658
00:29:35,210 --> 00:29:39,860
and Linux they treat the USB stack

659
00:29:37,490 --> 00:29:45,260
differently so whatever we try it's not

660
00:29:39,860 --> 00:29:48,610
gonna work even though I knew all this

661
00:29:45,260 --> 00:29:51,080
I did try doing the USB

662
00:29:48,610 --> 00:29:53,780
man-in-the-middle attack and I'm

663
00:29:51,080 --> 00:29:55,310
mentioning this because I by doing this

664
00:29:53,780 --> 00:29:58,040
whole thing I found a really amazing

665
00:29:55,310 --> 00:29:59,360
tool and even though it didn't work in

666
00:29:58,040 --> 00:30:01,520
the end I just want to talk a little bit

667
00:29:59,360 --> 00:30:03,139
about this because it might be used for

668
00:30:01,520 --> 00:30:06,290
some some of you if you try to ever do

669
00:30:03,140 --> 00:30:08,090
this it's called the USB Q framework is

670
00:30:06,290 --> 00:30:13,100
written by an engineer named Benoit

671
00:30:08,090 --> 00:30:15,350
Cameron and I actually talked with him

672
00:30:13,100 --> 00:30:19,189
because the documentation was yeah a

673
00:30:15,350 --> 00:30:20,719
little bit lacking the point is this

674
00:30:19,190 --> 00:30:23,090
software runs on a bigger bone black

675
00:30:20,720 --> 00:30:24,470
board which is if you don't know what

676
00:30:23,090 --> 00:30:26,659
that is it's kind of like a Raspberry Pi

677
00:30:24,470 --> 00:30:29,180
the only difference is it has two USB

678
00:30:26,660 --> 00:30:31,309
interfaces and one of them is a USB host

679
00:30:29,180 --> 00:30:33,409
interface and the other ones are USB

680
00:30:31,309 --> 00:30:35,600
client interface so what you can do is

681
00:30:33,409 --> 00:30:38,029
if you have two devices I mean a USB

682
00:30:35,600 --> 00:30:40,129
device in the USB host a PC in this case

683
00:30:38,029 --> 00:30:41,570
and you want to listen on in the traffic

684
00:30:40,129 --> 00:30:43,908
between the two endpoints you can just

685
00:30:41,570 --> 00:30:46,249
plug this thing between the two things

686
00:30:43,909 --> 00:30:48,110
and you can proxy the traffic much like

687
00:30:46,249 --> 00:30:51,259
I don't know it works you just for USB

688
00:30:48,110 --> 00:30:53,959
and I actually ended up writing a module

689
00:30:51,259 --> 00:30:58,610
for it which can modify traffic on the

690
00:30:53,960 --> 00:30:59,870
fly using regular expressions and so

691
00:30:58,610 --> 00:31:03,709
this is how the whole setup looks

692
00:30:59,870 --> 00:31:06,199
nothing fancy I tried a bunch of USB

693
00:31:03,710 --> 00:31:08,419
hardware I tried intercepting USB

694
00:31:06,200 --> 00:31:10,970
keyboard messages tried intercepting

695
00:31:08,419 --> 00:31:12,710
various game controllers and yeah it

696
00:31:10,970 --> 00:31:15,110
worked I mean I could do stuff like

697
00:31:12,710 --> 00:31:17,749
flash I don't know not lucky and things

698
00:31:15,110 --> 00:31:20,809
like that and at this point I thought

699
00:31:17,749 --> 00:31:23,210
this would be enough because you know I

700
00:31:20,809 --> 00:31:24,980
mean this shouldn't be so complex I mean

701
00:31:23,210 --> 00:31:26,149
the protocol itself between the PC and

702
00:31:24,980 --> 00:31:28,220
the dispenser

703
00:31:26,149 --> 00:31:29,389
it just you know how much how many nodes

704
00:31:28,220 --> 00:31:30,440
see one of these pens from which

705
00:31:29,389 --> 00:31:33,908
cassette it shouldn't be something

706
00:31:30,440 --> 00:31:37,549
sophisticated turns out it is I mean

707
00:31:33,909 --> 00:31:39,769
when I connected my USB proxy to the ATM

708
00:31:37,549 --> 00:31:43,549
there was just so much traffic on that

709
00:31:39,769 --> 00:31:45,769
bus that proxy just crashed so there was

710
00:31:43,549 --> 00:31:48,590
no way I'm gonna do this from the ground

711
00:31:45,769 --> 00:31:52,220
up and I was kind of disappointed at

712
00:31:48,590 --> 00:31:56,629
this point so I tried doing Plan B and

713
00:31:52,220 --> 00:32:00,289
Plan B was to reverse engineer the

714
00:31:56,629 --> 00:32:03,230
driver on the on the ATM which

715
00:32:00,289 --> 00:32:06,259
communicates with the dispenser and by

716
00:32:03,230 --> 00:32:07,789
reverse engineering the driver I you

717
00:32:06,259 --> 00:32:09,649
know just did what every reverse

718
00:32:07,789 --> 00:32:13,490
engineer does googled all the strings I

719
00:32:09,649 --> 00:32:15,439
could find in the binary and I found the

720
00:32:13,490 --> 00:32:18,019
legitimate testing to for that model of

721
00:32:15,440 --> 00:32:19,940
ATM which could be used for testing the

722
00:32:18,019 --> 00:32:22,129
dispenser now obviously this has

723
00:32:19,940 --> 00:32:24,080
security controls so you can just make

724
00:32:22,129 --> 00:32:26,480
the ATM spew out cash during the test

725
00:32:24,080 --> 00:32:29,029
because that's you know outside

726
00:32:26,480 --> 00:32:32,690
operational policy so it only works if

727
00:32:29,029 --> 00:32:34,850
the safe is safe is open only then can

728
00:32:32,690 --> 00:32:37,700
you test the dispenser which you know

729
00:32:34,850 --> 00:32:41,330
doesn't really make it useful for that

730
00:32:37,700 --> 00:32:43,429
attack purposes but it turned out that

731
00:32:41,330 --> 00:32:44,659
someone has actually reppin eyes this

732
00:32:43,429 --> 00:32:46,700
already

733
00:32:44,660 --> 00:32:50,870
they patched it remove the security

734
00:32:46,700 --> 00:32:52,220
controls from the tool and the attack is

735
00:32:50,870 --> 00:32:56,030
actually called coffee maker you can

736
00:32:52,220 --> 00:32:59,150
look it up online their only problem was

737
00:32:56,030 --> 00:33:02,600
I could get my hands true I don't know

738
00:32:59,150 --> 00:33:05,180
like rapidshare or some crazy side on

739
00:33:02,600 --> 00:33:08,300
the original legit - so I had the real

740
00:33:05,180 --> 00:33:10,880
tool but I didn't have the modified I

741
00:33:08,300 --> 00:33:12,530
didn't know the patch and it's like I

742
00:33:10,880 --> 00:33:14,720
mean that's not an enormous binary but

743
00:33:12,530 --> 00:33:16,730
it's kinda big you can get lost in it

744
00:33:14,720 --> 00:33:18,140
very easily because it can be used for

745
00:33:16,730 --> 00:33:19,970
testing the dispenser the printer

746
00:33:18,140 --> 00:33:21,290
whatever so it has a lot of stuff you

747
00:33:19,970 --> 00:33:26,800
would need to analyze if you started

748
00:33:21,290 --> 00:33:30,530
reverse engineering it and yeah but

749
00:33:26,800 --> 00:33:33,159
there was a rainbow someone one of the

750
00:33:30,530 --> 00:33:35,660
researchers to analyze this evil -

751
00:33:33,160 --> 00:33:39,470
actually released euro rules for

752
00:33:35,660 --> 00:33:43,010
detecting the modified tool yeah I can

753
00:33:39,470 --> 00:33:45,730
see a couple of people grinning so what

754
00:33:43,010 --> 00:33:48,590
happens you have a legit tool that works

755
00:33:45,730 --> 00:33:50,860
you need to write a rule that detects

756
00:33:48,590 --> 00:33:54,520
the evil tool that is patched and

757
00:33:50,860 --> 00:33:57,469
obviously if the error will you wrote

758
00:33:54,520 --> 00:33:58,850
detect the legitimate tool that's going

759
00:33:57,470 --> 00:34:00,770
to be a false positive so you don't want

760
00:33:58,850 --> 00:34:03,409
to do it what do you do you base your

761
00:34:00,770 --> 00:34:05,139
error rule on the patch that has been

762
00:34:03,410 --> 00:34:07,760
applied to the legitimate tool obviously

763
00:34:05,140 --> 00:34:10,550
now if you do the simple math you have

764
00:34:07,760 --> 00:34:13,219
the legit to apply a patch to it you get

765
00:34:10,550 --> 00:34:16,040
the evil tool now you want to make the

766
00:34:13,219 --> 00:34:18,259
error rule the right do you have the

767
00:34:16,040 --> 00:34:20,120
evil to legitimate tool you get the

768
00:34:18,260 --> 00:34:21,500
difference between the two and that's

769
00:34:20,120 --> 00:34:23,149
your our rule because that's the only

770
00:34:21,500 --> 00:34:26,449
way you can differentiate between the

771
00:34:23,149 --> 00:34:29,480
legitimate and evil two problem euro

772
00:34:26,449 --> 00:34:31,580
euro rule is going to be the patch so if

773
00:34:29,480 --> 00:34:33,560
you reverse engineer the euro rule you

774
00:34:31,580 --> 00:34:39,350
which is basically just a byte string

775
00:34:33,560 --> 00:34:41,168
you get the patch and yeah the super

776
00:34:39,350 --> 00:34:45,080
sophisticated modification the patch

777
00:34:41,168 --> 00:34:49,100
it's blurry on reason on purpose but you

778
00:34:45,080 --> 00:34:51,679
can see the arrows hands up who finds

779
00:34:49,100 --> 00:34:54,069
the arrow that's missing or what

780
00:34:51,679 --> 00:34:54,070
happened

781
00:34:55,399 --> 00:35:02,328
yep yep exactly so it's like the classic

782
00:35:00,289 --> 00:35:04,249
when you had correct means in the 90s to

783
00:35:02,329 --> 00:35:06,859
disable serial protection or something

784
00:35:04,249 --> 00:35:11,149
like that you replace a jump with an OP

785
00:35:06,859 --> 00:35:12,558
and yeah that's the page basically so we

786
00:35:11,150 --> 00:35:16,789
are based on this I could actually

787
00:35:12,559 --> 00:35:23,180
modify the legitimate tool and yeah use

788
00:35:16,789 --> 00:35:27,619
it as a black box um I was yeah so since

789
00:35:23,180 --> 00:35:29,749
this thing is from 2006 everything runs

790
00:35:27,619 --> 00:35:34,940
on Windows XP the driver only runs on

791
00:35:29,749 --> 00:35:36,950
Windows XP the tool only runs on Windows

792
00:35:34,940 --> 00:35:38,690
XP so I need the Windows XP machine and

793
00:35:36,950 --> 00:35:40,730
on top of all this it won't run in a

794
00:35:38,690 --> 00:35:45,009
virtual machine because it needed some

795
00:35:40,730 --> 00:35:47,509
idle access to the USB stack funny story

796
00:35:45,009 --> 00:35:49,519
just a week before I did all this thing

797
00:35:47,509 --> 00:35:52,160
I went to my neighbor to fix this

798
00:35:49,519 --> 00:35:53,749
computer and he was like I mean I fixed

799
00:35:52,160 --> 00:35:56,089
it it was like super grateful and said

800
00:35:53,749 --> 00:35:58,368
hey I have an old laptop do you need

801
00:35:56,089 --> 00:36:00,109
that and I was like yeah sure whatever

802
00:35:58,369 --> 00:36:01,759
I just tossed it in the drawer you know

803
00:36:00,109 --> 00:36:03,739
I'm gonna do it something with it later

804
00:36:01,759 --> 00:36:07,759
and yeah I ended up using this

805
00:36:03,739 --> 00:36:09,200
monstrosity for for running the two so

806
00:36:07,759 --> 00:36:11,569
yeah I got lucky

807
00:36:09,200 --> 00:36:13,489
so this is the tool this is the patch

808
00:36:11,569 --> 00:36:17,869
tool actually as you can see in the

809
00:36:13,489 --> 00:36:20,269
background the safe of the ATM is closed

810
00:36:17,869 --> 00:36:22,579
and I just you know I just have a cable

811
00:36:20,269 --> 00:36:25,910
plugged in inside somewhere but the ATM

812
00:36:22,579 --> 00:36:27,230
itself is closed and what you're gonna

813
00:36:25,910 --> 00:36:34,700
see is basically you just press the

814
00:36:27,230 --> 00:36:35,119
button wait a little bit and and there

815
00:36:34,700 --> 00:36:38,569
you go

816
00:36:35,119 --> 00:36:42,339
you acted and yeah that was the basic

817
00:36:38,569 --> 00:36:48,170
idea behind this whole thing okay

818
00:36:42,339 --> 00:36:52,640
as usual I was little but I think I told

819
00:36:48,170 --> 00:36:55,430
you everything I wanted to I mean no

820
00:36:52,640 --> 00:36:57,230
people are shy in the beginning but just

821
00:36:55,430 --> 00:36:59,690
go ahead ask questions I mean usually

822
00:36:57,230 --> 00:37:01,759
people have a lot of questions so I left

823
00:36:59,690 --> 00:37:04,450
like 10 minutes for that so we have four

824
00:37:01,759 --> 00:37:10,700
extra minutes just go add anyone

825
00:37:04,450 --> 00:37:15,919
gentlemen there how do ya great question

826
00:37:10,700 --> 00:37:18,950
so if you go back did it did it today

827
00:37:15,920 --> 00:37:22,310
today no not this not this not this yeah

828
00:37:18,950 --> 00:37:24,950
dad so depending on what you want to

829
00:37:22,310 --> 00:37:26,720
deliver it to the ATM a black box or a

830
00:37:24,950 --> 00:37:29,480
mail there you drill either on the

831
00:37:26,720 --> 00:37:31,730
bottom or the top of the ATM because on

832
00:37:29,480 --> 00:37:35,510
the bottom you have cabling which goes

833
00:37:31,730 --> 00:37:40,580
to the dispenser and on the top you have

834
00:37:35,510 --> 00:37:43,460
the PC on the slot and the PC has front

835
00:37:40,580 --> 00:37:46,190
panel USB which is great so what people

836
00:37:43,460 --> 00:37:47,990
do yeah exactly

837
00:37:46,190 --> 00:37:50,150
so what people do is actually they use

838
00:37:47,990 --> 00:37:52,850
like a a piece of wire or something

839
00:37:50,150 --> 00:37:55,460
strapped USB cable on it use a USB hub

840
00:37:52,850 --> 00:37:57,740
plug it in the USB hub has a flash drive

841
00:37:55,460 --> 00:38:00,050
a mouse and a keyboard and just install

842
00:37:57,740 --> 00:38:02,660
the mother on it so that's basically it

843
00:38:00,050 --> 00:38:04,940
on some ATMs you don't even have to

844
00:38:02,660 --> 00:38:08,299
drill because they have panels that pop

845
00:38:04,940 --> 00:38:11,150
up for the purpose evil you know putting

846
00:38:08,300 --> 00:38:13,580
in advertisements or stuff like that so

847
00:38:11,150 --> 00:38:19,040
yeah it's it's nothing fancy nothing

848
00:38:13,580 --> 00:38:21,880
sophisticated I'll bring the mic over to

849
00:38:19,040 --> 00:38:21,880
you thank you

850
00:38:32,140 --> 00:38:38,440
so about the mother part you mentioned

851
00:38:35,530 --> 00:38:40,990
the smart guys and the muscle guys and

852
00:38:38,440 --> 00:38:44,860
even in this picture it seems that the

853
00:38:40,990 --> 00:38:47,830
ATM's has a camera did the mother do

854
00:38:44,860 --> 00:38:51,100
something with that as well as I said it

855
00:38:47,830 --> 00:38:53,049
disables network connection so the

856
00:38:51,100 --> 00:38:55,839
camera is interesting I think in ATMs

857
00:38:53,050 --> 00:38:59,260
because if you look at a catalogue for

858
00:38:55,840 --> 00:39:01,210
ATMs that is listed as an extra so don't

859
00:38:59,260 --> 00:39:04,120
so not all ATMs have cameras installed

860
00:39:01,210 --> 00:39:05,530
actually and those that have cameras not

861
00:39:04,120 --> 00:39:08,290
all of them are connected to the backend

862
00:39:05,530 --> 00:39:11,020
some of them just log to the disk it

863
00:39:08,290 --> 00:39:14,980
didn't try to delete any files from the

864
00:39:11,020 --> 00:39:17,440
disk but the thing is so these old ATMs

865
00:39:14,980 --> 00:39:21,070
have cameras that have resolutions of

866
00:39:17,440 --> 00:39:23,470
VGA so 640 by 480 or something like that

867
00:39:21,070 --> 00:39:27,280
so you can hardly make out anything on

868
00:39:23,470 --> 00:39:29,620
them and some of the ATMs are only set

869
00:39:27,280 --> 00:39:31,690
up not to record video just take

870
00:39:29,620 --> 00:39:32,470
pictures at key moments so it's super

871
00:39:31,690 --> 00:39:34,810
easy to evade it

872
00:39:32,470 --> 00:39:37,089
it just takes pictures when you insert

873
00:39:34,810 --> 00:39:39,100
the card you type something and you know

874
00:39:37,090 --> 00:39:40,870
from a whole transaction you get like

875
00:39:39,100 --> 00:39:43,029
three pictures which is it doesn't have

876
00:39:40,870 --> 00:39:51,779
motion sensors or anything so it's

877
00:39:43,030 --> 00:39:54,430
pretty bad anybody else have any hope

878
00:39:51,780 --> 00:40:01,830
just just a funny one why didn't you use

879
00:39:54,430 --> 00:40:06,819
banknotes from monopoly yeah I mean

880
00:40:01,830 --> 00:40:08,860
these ATMs are fitted to do standard

881
00:40:06,820 --> 00:40:10,330
sized cash I mean you know it varies

882
00:40:08,860 --> 00:40:12,850
between countries but you have likely

883
00:40:10,330 --> 00:40:14,740
the slides but that's actually a nice

884
00:40:12,850 --> 00:40:16,660
idea but I don't think the slides ago as

885
00:40:14,740 --> 00:40:22,779
little as monopoly money but that would

886
00:40:16,660 --> 00:40:25,920
be cool true anybody else have a

887
00:40:22,780 --> 00:40:25,920
question from ourselves

888
00:40:26,530 --> 00:40:31,180
no it seems nothing myself thank you

889
00:40:29,830 --> 00:40:36,900
very very much thank you very much

890
00:40:31,180 --> 00:40:36,899
[Applause]

