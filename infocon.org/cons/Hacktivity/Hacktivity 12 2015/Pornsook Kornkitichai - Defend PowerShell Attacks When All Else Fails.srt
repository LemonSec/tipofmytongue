1
00:00:00,440 --> 00:00:07,610
hello everyone my name is sponsored
content is high I come from Thailand and

2
00:00:07,610 --> 00:00:10,799
today I'm going to talk about how to
defend

3
00:00:10,799 --> 00:00:18,360
attacks when all every defense fails but
before going further I would like to

4
00:00:18,360 --> 00:00:26,630
introduce a bit more about myself
working as a senior manager and the

5
00:00:26,630 --> 00:00:35,789
security assessment team at 18:40
Thailand and basically my everything ok

6
00:00:35,789 --> 00:00:40,670
charges up a lot about 10 testing are
doing some time off I T C Cody

7
00:00:40,670 --> 00:00:47,289
consulting and mains listos eternal
interest is about offensive security and

8
00:00:47,289 --> 00:00:54,370
some kind since about defensive security
about cyber warfare now that topics that

9
00:00:54,370 --> 00:01:01,690
I'm going to copper for today there's so
little ones first one is about I'm going

10
00:01:01,690 --> 00:01:02,318
to talk

11
00:01:02,319 --> 00:01:08,810
publisher and is offensive sites next
year's about why whole defense against

12
00:01:08,810 --> 00:01:15,910
the PowerShot epic fails next i'm going
to talk how and why it is quite

13
00:01:15,910 --> 00:01:22,710
difficult to do some implementation to
defend the PowerShell and next and going

14
00:01:22,710 --> 00:01:29,300
to introduce you brought a higher power
shared to defend those attacks and then

15
00:01:29,300 --> 00:01:38,429
I'm going to do some demonstration

16
00:01:38,430 --> 00:01:44,120
basically you have ever used commercial
before you might have to question why

17
00:01:44,120 --> 00:01:49,090
don't we show in the new election of
Bend ore and going to talk about a

18
00:01:49,090 --> 00:01:55,990
little bit about PowerShell because when
you going to cost day we have just a

19
00:01:55,990 --> 00:02:03,850
week but sometimes there are Microsoft
would like to have some kind of powerful

20
00:02:03,850 --> 00:02:13,400
ally like shell in Linux but have to you
know it's different platform in the five

21
00:02:13,400 --> 00:02:21,610
best platform but in Windows API and
optic base so we can implement that the

22
00:02:21,610 --> 00:02:27,670
thumb Cairo Telkom I look like that she
told they create things like polish el

23
00:02:27,670 --> 00:02:34,160
cambio at the thing just cover it but
since 2010

24
00:02:34,160 --> 00:02:40,190
there have been lots of similar works
and lisa Lee at the two offensive

25
00:02:40,190 --> 00:02:46,390
offensive side of PowerShell I'm quite
certain that there are a lot of people

26
00:02:46,390 --> 00:02:54,029
here have seen this leads of offensive
pi wish more those before but I will try

27
00:02:54,030 --> 00:03:01,540
to give you a quick or peel off its hot
models the first one is Paula Sprott

28
00:03:01,540 --> 00:03:09,590
power splitter collection was
exploitation if your pen tester you can

29
00:03:09,590 --> 00:03:12,640
use it to buy possibly wells to

30
00:03:12,640 --> 00:03:19,579
walks and chill port injection are you
can use it to do something later text

31
00:03:19,580 --> 00:03:27,290
filtration and at the framework is a
collection of PowerShell scripts and

32
00:03:27,290 --> 00:03:34,739
peer Lord the main purpose of meeting
its just offensive security Nexus

33
00:03:34,739 --> 00:03:46,850
if you have a worse we were friends
before this model the idea of power used

34
00:03:46,850 --> 00:03:47,819
when

35
00:03:47,819 --> 00:03:53,138
10 kisser would like to attack some
enrollment but that ten women these

36
00:03:53,139 --> 00:04:03,109
simple commands so the author of its
borders to mimic the behavior netcom an

37
00:04:03,109 --> 00:04:11,139
example you can you get user while get
instead of instead of just zero net

38
00:04:11,139 --> 00:04:22,840
groups Metris power 101 part of power
tools power used for local

39
00:04:22,840 --> 00:04:29,789
escalation and frameworks Powercat

40
00:04:29,789 --> 00:04:39,270
netcat but this implemented in Polish
Air Nexus the payload call interactive

41
00:04:39,270 --> 00:04:40,979
PowerShell payload

42
00:04:40,979 --> 00:04:49,900
destroyed if you have ever use met the
pretty be before if you lunch and then

43
00:04:49,900 --> 00:04:56,659
I've PowerShell that sexy your session
will be forced to because you cannot

44
00:04:56,659 --> 00:05:02,820
have an interactive session with the
publisher so in this day and a half

45
00:05:02,820 --> 00:05:07,880
interactive PowerShell that you can use
and kept in interactive to the

46
00:05:07,880 --> 00:05:17,000
PowerShell on the target system that
attack led test work in pie is published

47
00:05:17,000 --> 00:05:26,110
in the last week US this year basically
ideas about create some kind of answer

48
00:05:26,110 --> 00:05:31,490
send it to the target system when the
packet system random the power station

49
00:05:31,490 --> 00:05:37,139
it connect back to your command and
control then you can do anything you

50
00:05:37,139 --> 00:05:42,840
want with PowerShell for example you can
send something like Chilcott injection

51
00:05:42,840 --> 00:05:47,969
or do something around injection on do
anything they want you want with our

52
00:05:47,969 --> 00:05:54,659
show it look like but PowerShell so

53
00:05:54,660 --> 00:06:02,280
just only some examples of offensive
security models of the PowerShell next

54
00:06:02,280 --> 00:06:10,890
why all defense are powerful shells
fails to the attacks the first one is

55
00:06:10,890 --> 00:06:17,260
this is the first line of defense maybe
you have heard of this before its

56
00:06:17,260 --> 00:06:25,840
execution will I see if you are new
rochelle if you are an interview sir you

57
00:06:25,840 --> 00:06:26,869
cannot land

58
00:06:26,870 --> 00:06:36,180
script but if you are involved user you
can line script as you can see from the

59
00:06:36,180 --> 00:06:45,770
screenshot you cannot let us feed the
post but ps1 one thing that you can do

60
00:06:45,770 --> 00:06:52,530
is just hi the comment on the console or
just got beat their publishers creep and

61
00:06:52,530 --> 00:07:00,049
piercing in the console and that's the
way you can do if you know about how

62
00:07:00,050 --> 00:07:07,140
execution execution quality work you can
buy passes normally they are five

63
00:07:07,140 --> 00:07:21,690
options for execution policy 1333 for
all sides but we more side the forties

64
00:07:21,690 --> 00:07:30,300
bypass and 503 that if you would just
change the option to buy past you can do

65
00:07:30,300 --> 00:07:39,570
anything well the main purpose of this
execution policy is to play when you

66
00:07:39,570 --> 00:07:47,169
hear from landing the PowerShell scripts
and intentionally it is not decide to

67
00:07:47,169 --> 00:07:55,380
defend the attacks so it's not the
defense another technique to bypass

68
00:07:55,380 --> 00:07:59,930
execution policies you can use bear
succeeded

69
00:07:59,930 --> 00:08:06,940
64 and corded command for example if you
have the publisher script and corded to

70
00:08:06,940 --> 00:08:15,110
bed before and place it into the console
and run it you can bypass another thing

71
00:08:15,110 --> 00:08:20,630
that i talked about and hoarded command
because some

72
00:08:20,630 --> 00:08:27,229
when you download when you use
PowerShell scripts when you attack the

73
00:08:27,229 --> 00:08:36,338
system some candy take it you can use
mine too high or so but that's a

74
00:08:36,339 --> 00:08:43,459
limitation in route Windows XP and Annie
Wersching because the length of the

75
00:08:43,458 --> 00:08:44,790
console

76
00:08:44,790 --> 00:08:51,550
be made to allow a pulsing and 100 some
things if you have a weary law

77
00:08:51,550 --> 00:08:59,589
you need to do some complex and then be
complete in the memory some people here

78
00:08:59,589 --> 00:09:08,520
are some people that they're writing
more due to do this for you so that's

79
00:09:08,520 --> 00:09:18,920
not the problem and that protection
mechanism is a block air locker was

80
00:09:18,920 --> 00:09:26,060
introduced since Windows 7 and Windows
2008 to but you can do with it

81
00:09:26,060 --> 00:09:35,859
only one in the Enterprise and Ultimate
worship only to allow administrators to

82
00:09:35,860 --> 00:09:42,110
lock that the system to play when an
Iranian from the unauthorized

83
00:09:42,110 --> 00:09:49,370
applications you might have heard about
software restriction policy is this the

84
00:09:49,370 --> 00:09:58,300
same but these tasty order technique
order system why is this order because

85
00:09:58,300 --> 00:10:07,459
when you saw barry's rules you cannot
apply to each issue and is quite

86
00:10:07,459 --> 00:10:08,810
difficult to manage

87
00:10:08,810 --> 00:10:17,680
but if you enable bought a plot care and
saw babysit least AC at the same time

88
00:10:17,680 --> 00:10:28,079
you're all the abductors rules when you
apply a block here to share you can use

89
00:10:28,080 --> 00:10:36,230
to block executable five orders
powershell script fire let's see if you

90
00:10:36,230 --> 00:10:45,080
do here with PowerShell that exe and I S
edict exe we think you cannot run you

91
00:10:45,080 --> 00:10:47,500
next

92
00:10:47,500 --> 00:10:55,520
you can use to play when Andy running
the script price but as you know this is

93
00:10:55,520 --> 00:11:02,630
the setting from administrators if the
attacker can gain access to the previous

94
00:11:02,630 --> 00:11:13,890
a cost of the system protection
mechanism is now moving to some kind of

95
00:11:13,890 --> 00:11:20,160
power-sharing more than publisher we
more thing means that if you land power

96
00:11:20,160 --> 00:11:25,969
to share and would like to execute on
the remote machine we call dias amor

97
00:11:25,970 --> 00:11:34,970
thing when do you think you connect you
to the fourth session configuration you

98
00:11:34,970 --> 00:11:42,040
can find some configuration on you
mentioned with this command get psn

99
00:11:42,040 --> 00:11:52,660
configuration or white but she'll from

100
00:11:52,660 --> 00:12:02,660
and Slade who worship you can enable
some rain showers and point what does it

101
00:12:02,660 --> 00:12:11,279
means it means that you can limit the
number of the commands that can use for

102
00:12:11,279 --> 00:12:14,939
example I can make to

103
00:12:14,940 --> 00:12:24,990
the magazine called window 81 and try to
leave the number of the common what I

104
00:12:24,990 --> 00:12:32,600
got back he's a row less than 10 comment
that I can use normally more than

105
00:12:32,600 --> 00:12:40,110
hundred commands in PowerShell console
so if you want to apply this inside your

106
00:12:40,110 --> 00:12:48,450
enterprise organization you could do it
but as same as a blocker is that I can't

107
00:12:48,450 --> 00:12:58,250
get access to the admin level constraint
how show that somehow makes about locked

108
00:12:58,250 --> 00:13:08,530
doubtful I see there's not much
information they let that there's just

109
00:13:08,530 --> 00:13:14,699
two links the thing is you can use some
and Roman

110
00:13:14,700 --> 00:13:18,920
by creating some worry about it

111
00:13:18,920 --> 00:13:25,910
call PSA locked up for AC and set the
number to call your PowerShell console

112
00:13:25,910 --> 00:13:34,850
into Khan's friend languish more what
this means you can use command you can

113
00:13:34,850 --> 00:13:42,640
just come out in publisher but you
cannot access any type of that made

114
00:13:42,640 --> 00:13:49,449
object you cannot access class you
cannot access in stance because coal

115
00:13:49,450 --> 00:13:58,850
mines friend languish more but the same
as the same thing about this way well

116
00:13:58,850 --> 00:14:06,279
did this variable and apply it they can
bypass these pieces so

117
00:14:06,279 --> 00:14:16,999
my well what about my work working
passes on this assumption first attack

118
00:14:16,999 --> 00:14:23,129
you could gain access to the previous
cars for example they can get access to

119
00:14:23,129 --> 00:14:29,980
local administrator of the ticket system
that can can access 21 X haha domain

120
00:14:29,980 --> 00:14:40,879
admin group sex they can enable
publishers morning and so it all off

121
00:14:40,879 --> 00:14:48,499
what I said before off the protection I
mentioned earlier here at Taco Bell and

122
00:14:48,499 --> 00:14:59,350
fought I don't talk about even that's
because it had attended symbol next why

123
00:14:59,350 --> 00:15:09,259
use defends against our people some of
you might think why we don't do some

124
00:15:09,259 --> 00:15:16,980
cooking just intercept in 232 AP a
function I did it but it's quite

125
00:15:16,980 --> 00:15:17,970
difficult

126
00:15:17,970 --> 00:15:31,809
screenshot if you call local polish
polish exe process born here and then if

127
00:15:31,809 --> 00:15:41,230
you stack trace on monitoring the
stacktrace yeah you will see

128
00:15:41,230 --> 00:15:47,270
there is no proper polite to do some
hookah line deception or what you can

129
00:15:47,270 --> 00:15:54,560
see the net for people that our shield

130
00:15:54,560 --> 00:16:06,160
or.net objects class and instance the
library so that's why to win some winter

131
00:16:06,160 --> 00:16:14,280
due to API for power sharing more than
you might think that why we don't do

132
00:16:14,280 --> 00:16:22,630
some Cairo interception and analyze
traffic traffic I did it the same

133
00:16:22,630 --> 00:16:31,360
basically when we use PowerShell
PowerShell use the brokaw call the best

134
00:16:31,360 --> 00:16:34,020
man win dole

135
00:16:34,020 --> 00:16:54,439
management protocol it land on http and
HTTPS on poor 5965 5966 but when you use

136
00:16:54,440 --> 00:17:05,050
HTTP HTTP content is encrypted you can
see only the HTTP header with not much

137
00:17:05,050 --> 00:17:12,800
if you much more information you can see
it in trip with some things when you use

138
00:17:12,800 --> 00:17:16,099
PowerShell inside the main enrollment

139
00:17:16,099 --> 00:17:25,490
encrypt that with us but if you use in
their group and quick clip SSP you

140
00:17:25,490 --> 00:17:34,080
cannot do any many damn it though
however if you use https to http header

141
00:17:34,080 --> 00:17:36,740
and content

142
00:17:36,740 --> 00:17:45,040
encrypt twice so it's very difficult to
do some men in tomato here and do some

143
00:17:45,040 --> 00:17:47,670
unlicensed on my sister

144
00:17:47,670 --> 00:17:54,800
but in this year Microsoft Publisher
some tools for a nice tools

145
00:17:54,800 --> 00:18:08,120
traffic networks but Microsoft has a new
tool for Microsoft method a nicer you

146
00:18:08,120 --> 00:18:18,969
can watch some Glenlivet details of
method is even better indoor use when I

147
00:18:18,970 --> 00:18:25,240
like Microsoft message slicer when I
used publisher with more thing I can see

148
00:18:25,240 --> 00:18:34,830
everything you see hear everything is
installed message because of how shall

149
00:18:34,830 --> 00:18:39,919
we just grab soviet you can see some
plan

150
00:18:39,920 --> 00:18:47,730
message classic vintage communication
you can analyze but it's impractical to

151
00:18:47,730 --> 00:18:53,940
apply these functions into each and
every workstation in the optimization

152
00:18:53,940 --> 00:19:01,220
because you are utilizing a network
resource and what station results too

153
00:19:01,220 --> 00:19:11,360
much so this is my stride offical last
year that's a peres is well-known people

154
00:19:11,360 --> 00:19:19,850
in the publisher is investigating
PowerShell a tax based in death . 2014

155
00:19:19,850 --> 00:19:27,600
and black had to send year the paper try
to find information about how to locate

156
00:19:27,600 --> 00:19:35,990
some evidence from this from memory and
from even lost Wednesday's attacks I

157
00:19:35,990 --> 00:19:42,720
give you some leak had before because
he's going to to my work because this

158
00:19:42,720 --> 00:19:50,840
paper way influenced my my platform as
well when you

159
00:19:50,840 --> 00:19:57,110
do some power shows when you drive the
command line on your console your

160
00:19:57,110 --> 00:20:05,040
comment lie inside your match in class
and object it will see rise and then

161
00:20:05,040 --> 00:20:11,620
send it to the target system that target
what station on the US-japan protocol

162
00:20:11,620 --> 00:20:20,689
when that happens we see by the
dispatcher on the packet system it will

163
00:20:20,690 --> 00:20:28,220
lock in which the application has been
reached Easter dispatcher if you

164
00:20:28,220 --> 00:20:36,740
consider whether it is better if it is
PowerShot send it to the Improv

165
00:20:36,740 --> 00:20:41,130
exe

166
00:20:41,130 --> 00:20:48,620
packet matching when you received some
more com- mand amor con man and if you

167
00:20:48,620 --> 00:21:00,570
see any executable file it was born in
Nigeria vs this paper said that if you

168
00:21:00,570 --> 00:21:09,240
want to see some publisher con man you
want to see some important when you need

169
00:21:09,240 --> 00:21:20,530
to do some memory and Isis against the
post-utme exceed but the problem is that

170
00:21:20,530 --> 00:21:22,840
when West improper

171
00:21:22,840 --> 00:21:29,199
immediately after the end of the session
that's why it's very difficult to do

172
00:21:29,200 --> 00:21:38,850
some real time and I assist on the
memory of the WSM proper horse

173
00:21:38,850 --> 00:21:50,060
from the assumption lies from their
latest sadi going to propose but I call

174
00:21:50,060 --> 00:21:57,240
PowerShares you can be implemented you
to copy my idea to apply to some work

175
00:21:57,240 --> 00:22:05,130
station in your organization I just
apply to some machine the idea of the

176
00:22:05,130 --> 00:22:15,420
wine to be the first one she took
command and control it I D Half Life

177
00:22:15,420 --> 00:22:22,440
Center life can receive and send a con
man we see the even from the aging or

178
00:22:22,440 --> 00:22:24,380
the sensor

179
00:22:24,380 --> 00:22:35,350
client I call it sends her and from my
experiment I did it on window when the

180
00:22:35,350 --> 00:22:43,750
white one with Windows PowerShell v2 v3
and v4 and that the internal component

181
00:22:43,750 --> 00:22:52,350
of the sensor three companions to adapt
and one sensor first adapt their next

182
00:22:52,350 --> 00:23:01,469
year's WSM Proforce after and then
sensor sensor line because it needs to

183
00:23:01,470 --> 00:23:10,350
communicate with the c2 you can see them
affordable five boys come from the sea

184
00:23:10,350 --> 00:23:18,959
to number five traffic even information
from the sensor is encrypted with AES

185
00:23:18,960 --> 00:23:27,760
encryption so I'm going to solve the
problem of WSM proposed study exceed you

186
00:23:27,760 --> 00:23:36,510
can see that in the part C Windows
system 32 I will look it up in your

187
00:23:36,510 --> 00:23:46,010
employ horse here you might notice that
there are two WSM profiles that sexy the

188
00:23:46,010 --> 00:23:46,879
real one

189
00:23:46,880 --> 00:23:56,210
every machine since mean the way this I
rename it into WS time clock Force One

190
00:23:56,210 --> 00:24:01,370
that you'd see you can rename it into
anything you want to just change the

191
00:24:01,370 --> 00:24:02,979
configuration

192
00:24:02,980 --> 00:24:16,680
prototype and effect a means day my
adapter if so next time if there is her

193
00:24:16,680 --> 00:24:24,680
publisher with more than direct for
directing to you a doctor

194
00:24:24,680 --> 00:24:40,610
WSM proper and powers showdown exe the
only application is not if you need to

195
00:24:40,610 --> 00:24:48,639
change and then after you should rename
it back now what I'm going to intercept

196
00:24:48,640 --> 00:24:55,250
I'm going to intercept some window into
a TI to locate some important

197
00:24:55,250 --> 00:25:07,070
information I tried to it does have to
process the first one is exit process as

198
00:25:07,070 --> 00:25:12,950
I mentioned the problem is it very
quickly you cannot do anything with

199
00:25:12,950 --> 00:25:22,330
itself so I will exit bought it because
I need to pass some time and then do

200
00:25:22,330 --> 00:25:30,260
some memory indices before it self and
then with Fred process because I would

201
00:25:30,260 --> 00:25:41,680
like to know if attacked their spawn
some executable Feiss and Nexus you to

202
00:25:41,680 --> 00:25:49,920
what I want to do is to monitor network
traffic because Mauritius our share more

203
00:25:49,920 --> 00:25:53,170
those often download things on the
network

204
00:25:53,170 --> 00:26:03,270
this is what I'm going to try to look
here inside the memory from the bear

205
00:26:03,270 --> 00:26:09,020
investigating publisher attacked a try
to do some memory and I said in five

206
00:26:09,020 --> 00:26:15,740
pattern of the common man from number
225 from my experiments number one is

207
00:26:15,740 --> 00:26:25,900
very important to because content some
previous come and attack you use ok

208
00:26:25,900 --> 00:26:33,280
let's see some demonstration I have to
demonstrate the two demonstration that

209
00:26:33,280 --> 00:26:39,649
reason is because I need to change the
sign in to turn on and turn off this

210
00:26:39,650 --> 00:26:51,690
publisher and all estimate to take some
time and life for one the first series

211
00:26:51,690 --> 00:29:18,900
of three more on my window for Windows 7
client

212
00:29:18,900 --> 00:29:51,410
and then because I would like to but the
result of the crisis at this point

213
00:29:51,410 --> 00:29:58,630
depends on what his team sign the memory
sometimes I got important clues sometime

214
00:29:58,630 --> 00:29:59,580
I got nothing

215
00:29:59,580 --> 00:30:23,600
depends now back to that sports can see
some some lock

216
00:30:23,600 --> 00:32:00,320
here

217
00:32:00,320 --> 00:32:07,039
back to you

218
00:32:07,039 --> 00:32:16,809
2012

219
00:32:16,809 --> 00:32:21,889
I'm going to use walkman

220
00:32:21,889 --> 00:32:29,330
we want to land a commonly more on the
limb on the target much I want to come

221
00:32:29,330 --> 00:32:40,439
onto the computer name call we know one
with the command inside this year I use

222
00:32:40,440 --> 00:32:46,340
I mean that we have to be want to
download some script that's creepy

223
00:32:46,340 --> 00:32:51,019
many cat that ps1

224
00:32:51,019 --> 00:34:24,389
these IP address which is my Mac machine
and then lunch meat at so let's see

225
00:34:24,389 --> 00:34:41,859
demonstration here just have to 25
minutes left going to show you some of

226
00:34:41,859 --> 00:34:59,190
my video demonstration is the same

227
00:34:59,190 --> 00:35:39,850
and then

228
00:35:39,850 --> 00:36:50,390
then back to hear from the network

229
00:36:50,390 --> 00:38:43,920
you can see from the network if you use
general

230
00:38:43,920 --> 00:39:08,470
now

231
00:39:08,470 --> 00:39:44,319
that directly access to the class in
stan and Jan everything which my brother

232
00:39:44,320 --> 00:39:50,900
I cannot be taken but if you thinking
another way if they can run the

233
00:39:50,900 --> 00:39:56,180
application in your magazine didn't need
to use PowerShell

234
00:39:56,180 --> 00:40:03,109
do anything right and yes just what
application this is the limitation of my

235
00:40:03,109 --> 00:40:06,230
work there are some say roe

236
00:40:06,230 --> 00:40:11,380
work talking about window horse
application you can learn from this

237
00:40:11,380 --> 00:40:24,119
lease and last but not least this is
slightly improved because they feature

238
00:40:24,119 --> 00:40:33,099
and the mall West can be different this
is way nice because remember that I

239
00:40:33,099 --> 00:40:35,099
tried to intercept

240
00:40:35,099 --> 00:40:41,230
windows 32 API but this time some guys
from Microsoft to why

241
00:40:41,230 --> 00:40:52,780
APA itu and is a TI you can switch and
the company can use these people are

242
00:40:52,780 --> 00:40:59,900
finding evidence that can identify which
is not from

243
00:40:59,900 --> 00:41:11,730
so lots of work right

244
00:41:11,730 --> 00:41:21,600
and if you have any questions here if
you would like to talk much about the

245
00:41:21,600 --> 00:41:29,420
platform and going out here for tomorrow
and thank you for attending the last

246
00:41:29,420 --> 00:41:31,600
session today thank you so much

