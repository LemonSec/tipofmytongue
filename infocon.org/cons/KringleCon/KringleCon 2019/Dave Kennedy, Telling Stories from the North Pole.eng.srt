1
00:00:00,030 --> 00:00:04,980
hello everybody and welcome to a brand

2
00:00:02,790 --> 00:00:07,680
new season in New Year Ron Kringle con

3
00:00:04,980 --> 00:00:09,809
2019 this is Dave Kennedy telling

4
00:00:07,680 --> 00:00:11,340
stories from the North Pole I'm so

5
00:00:09,809 --> 00:00:12,719
excited about this year for Kringle

6
00:00:11,340 --> 00:00:15,929
kannan you don't know anything about it

7
00:00:12,719 --> 00:00:18,119
or you story or anything else all I know

8
00:00:15,929 --> 00:00:20,160
is that the team over there just does an

9
00:00:18,119 --> 00:00:21,960
amazing job every single year for

10
00:00:20,160 --> 00:00:23,550
producing this I just want to say a

11
00:00:21,960 --> 00:00:25,740
special thanks to it's ed SCOTUS and his

12
00:00:23,550 --> 00:00:28,140
team this do a phenomenal job bringing

13
00:00:25,740 --> 00:00:30,778
this amazing thing to us each and every

14
00:00:28,140 --> 00:00:32,430
year I also mentioned I also check out

15
00:00:30,779 --> 00:00:34,500
the holiday hack challenge it's so

16
00:00:32,430 --> 00:00:36,390
important so much fun to go through that

17
00:00:34,500 --> 00:00:38,700
I know last year I spent oodles of hours

18
00:00:36,390 --> 00:00:39,840
going through all of that and had a

19
00:00:38,700 --> 00:00:42,510
great time so make sure you check that

20
00:00:39,840 --> 00:00:44,760
out as you go through so this talk is is

21
00:00:42,510 --> 00:00:47,099
really getting into telling stories and

22
00:00:44,760 --> 00:00:48,539
we know about social engineering and

23
00:00:47,100 --> 00:00:50,340
everybody talks about social engineering

24
00:00:48,539 --> 00:00:52,260
all the time and phishing campaigns and

25
00:00:50,340 --> 00:00:54,989
things like that but it has gotten

26
00:00:52,260 --> 00:00:56,280
harder for us to actually hack into

27
00:00:54,989 --> 00:00:57,959
organizations and companies people

28
00:00:56,280 --> 00:01:00,149
invest in a lot of security systems they

29
00:00:57,960 --> 00:01:01,890
invest in endpoint visibility they

30
00:01:00,149 --> 00:01:04,170
invest in perimeter defenses and they

31
00:01:01,890 --> 00:01:06,780
also invest in education awareness and

32
00:01:04,170 --> 00:01:08,580
so you know as an attacker we're going

33
00:01:06,780 --> 00:01:10,290
after companies you know from a trusted

34
00:01:08,580 --> 00:01:11,908
SEC perspective it's gotten

35
00:01:10,290 --> 00:01:14,159
substantially harder for us to to be

36
00:01:11,909 --> 00:01:16,439
successful with more of the commodity

37
00:01:14,159 --> 00:01:18,450
type fishes and so this talk isn't about

38
00:01:16,439 --> 00:01:20,610
social engineering and the traditional

39
00:01:18,450 --> 00:01:22,619
sense it's about what we tell our

40
00:01:20,610 --> 00:01:24,240
stories to when we're getting identified

41
00:01:22,619 --> 00:01:25,920
or busted by the security operation

42
00:01:24,240 --> 00:01:28,470
center or the team that's actually

43
00:01:25,920 --> 00:01:31,610
monitoring an organization can we use

44
00:01:28,470 --> 00:01:33,210
the same types of principles against a

45
00:01:31,610 --> 00:01:35,369
security analyst

46
00:01:33,210 --> 00:01:38,548
versus what we actually do to end point

47
00:01:35,369 --> 00:01:41,159
users I'm Dave Kennedy founder and CEO

48
00:01:38,549 --> 00:01:42,630
of trusted second binary defense I've

49
00:01:41,159 --> 00:01:44,369
had a long career in the security

50
00:01:42,630 --> 00:01:46,530
industry the author the social engineer

51
00:01:44,369 --> 00:01:47,729
toolkit magic unicorn the pen testers

52
00:01:46,530 --> 00:01:49,579
framework I co-authored the book

53
00:01:47,729 --> 00:01:52,770
Metasploit the penetration testers guide

54
00:01:49,579 --> 00:01:54,059
and you know it's been a great time for

55
00:01:52,770 --> 00:01:55,829
the past couple years doing the the

56
00:01:54,060 --> 00:01:57,780
cremeux connivance last year got the

57
00:01:55,829 --> 00:01:59,339
keynote which was a amazing success

58
00:01:57,780 --> 00:02:01,110
there and had I had a great time doing

59
00:01:59,340 --> 00:02:04,049
it and again look forward to another

60
00:02:01,110 --> 00:02:06,570
year this year and again welcome to

61
00:02:04,049 --> 00:02:07,619
creme con 2019 this is probably my

62
00:02:06,570 --> 00:02:09,690
favorite time of the year not just

63
00:02:07,619 --> 00:02:11,970
cremeux cod but the whole Christmas

64
00:02:09,690 --> 00:02:13,890
spirit and you know the festivities and

65
00:02:11,970 --> 00:02:15,570
people being nice to one another

66
00:02:13,890 --> 00:02:17,579
so it's such an honor to be back again

67
00:02:15,570 --> 00:02:19,049
to talk to the Korean cotton folks and

68
00:02:17,580 --> 00:02:20,850
hopefully you're enjoying this through

69
00:02:19,050 --> 00:02:22,140
the Christmas season and seeing

70
00:02:20,850 --> 00:02:24,030
everything that's happening during these

71
00:02:22,140 --> 00:02:25,350
periods of time and hopefully unwinding

72
00:02:24,030 --> 00:02:28,230
a little bit from a busy year and

73
00:02:25,350 --> 00:02:29,579
spending some time with your family and

74
00:02:28,230 --> 00:02:32,429
so we start talking about telling

75
00:02:29,580 --> 00:02:35,280
stories what's interesting to note is

76
00:02:32,430 --> 00:02:38,190
that you know it's still very easy for

77
00:02:35,280 --> 00:02:39,960
us as hackers to circumvent most of the

78
00:02:38,190 --> 00:02:41,490
traditional prevention mechanisms

79
00:02:39,960 --> 00:02:43,560
whether that's antivirus for endpoint

80
00:02:41,490 --> 00:02:45,150
protection products if we modify or

81
00:02:43,560 --> 00:02:47,430
change some of our techniques in some

82
00:02:45,150 --> 00:02:49,350
way shape or form we can usually get

83
00:02:47,430 --> 00:02:52,260
around those pretty trivially and don't

84
00:02:49,350 --> 00:02:54,660
have to worry about specific prevention

85
00:02:52,260 --> 00:02:56,160
techniques the issue though is that on

86
00:02:54,660 --> 00:02:58,460
the detection side it's becoming

87
00:02:56,160 --> 00:03:01,230
increasingly harder for us as attackers

88
00:02:58,460 --> 00:03:02,970
to simulate an attack against an

89
00:03:01,230 --> 00:03:04,470
organization and not be identified if

90
00:03:02,970 --> 00:03:06,930
we're using traditional techniques like

91
00:03:04,470 --> 00:03:09,690
chroma roasting or null sessions or you

92
00:03:06,930 --> 00:03:12,420
know brute forcing user accounts you

93
00:03:09,690 --> 00:03:15,329
know using Active Directory all of those

94
00:03:12,420 --> 00:03:17,130
things are ways that people are looking

95
00:03:15,330 --> 00:03:19,709
at their infrastructure and saying hey

96
00:03:17,130 --> 00:03:21,030
how do i best detect these attacks and

97
00:03:19,709 --> 00:03:23,790
the spill detection is around those and

98
00:03:21,030 --> 00:03:25,050
and now it's kind of like a way where we

99
00:03:23,790 --> 00:03:27,359
used to be able to hack into companies

100
00:03:25,050 --> 00:03:29,670
without any that's excellent so ever we

101
00:03:27,360 --> 00:03:31,020
now run into these landmines when we're

102
00:03:29,670 --> 00:03:33,570
going into organizations and companies

103
00:03:31,020 --> 00:03:36,920
and so you know what this talk is really

104
00:03:33,570 --> 00:03:39,510
designed for is is how do we as hackers

105
00:03:36,920 --> 00:03:42,239
simulate real-world events that we know

106
00:03:39,510 --> 00:03:43,980
are going to go to a security analyst or

107
00:03:42,240 --> 00:03:47,070
to a Security Operations Center and how

108
00:03:43,980 --> 00:03:48,510
do we you know coax that data to make it

109
00:03:47,070 --> 00:03:49,829
look believable in some way shape or

110
00:03:48,510 --> 00:03:51,899
form applying the same concepts around

111
00:03:49,830 --> 00:03:53,970
social engineering to be able to do that

112
00:03:51,900 --> 00:03:56,850
and so let's do a quick demonstration

113
00:03:53,970 --> 00:03:58,350
here and I want to do a quick

114
00:03:56,850 --> 00:03:59,579
introductory around what living up lamp

115
00:03:58,350 --> 00:04:00,540
miners and scrip Starks I think it's

116
00:03:59,580 --> 00:04:03,510
important for folks that may not

117
00:04:00,540 --> 00:04:05,010
understand this but you know what we're

118
00:04:03,510 --> 00:04:07,049
trying to do when we gain access to a

119
00:04:05,010 --> 00:04:09,209
system is get remote code execution

120
00:04:07,050 --> 00:04:10,500
that's that's a pretty big objective

121
00:04:09,209 --> 00:04:12,030
that's it the only objective you know

122
00:04:10,500 --> 00:04:14,220
people could be going for usernames and

123
00:04:12,030 --> 00:04:16,620
passwords or harvesting information

124
00:04:14,220 --> 00:04:18,149
there's a lot of attacks right now

125
00:04:16,620 --> 00:04:20,100
happening around the Disney Plus

126
00:04:18,149 --> 00:04:22,409
streaming service and that's not because

127
00:04:20,100 --> 00:04:24,240
of any security exposures on Disney but

128
00:04:22,410 --> 00:04:25,650
people are using the same password from

129
00:04:24,240 --> 00:04:27,560
a data breach jump from like CafePress

130
00:04:25,650 --> 00:04:29,570
and then being able to

131
00:04:27,560 --> 00:04:31,250
use that to login to a Disney Plus site

132
00:04:29,570 --> 00:04:32,599
that's using the same password and so

133
00:04:31,250 --> 00:04:34,430
there's a lot of objectives and motives

134
00:04:32,600 --> 00:04:35,750
but let's just say as an attacker my

135
00:04:34,430 --> 00:04:38,540
motive is getting remote code execution

136
00:04:35,750 --> 00:04:39,770
onto a system the way that I have to do

137
00:04:38,540 --> 00:04:42,230
that you know is I can use traditional

138
00:04:39,770 --> 00:04:44,359
methods I could you know use an HT 8

139
00:04:42,230 --> 00:04:47,120
file I could use you know an Excel

140
00:04:44,360 --> 00:04:48,950
document I can use any type of office

141
00:04:47,120 --> 00:04:50,480
products I can use a PDF any of things

142
00:04:48,950 --> 00:04:52,789
that people traditionally have installed

143
00:04:50,480 --> 00:04:55,010
and what living on the land binders and

144
00:04:52,790 --> 00:04:57,500
scripts are are applications that are

145
00:04:55,010 --> 00:04:59,719
installed in Windows by default that our

146
00:04:57,500 --> 00:05:01,669
code signed by Microsoft that have

147
00:04:59,720 --> 00:05:03,139
additional functionality out there and

148
00:05:01,669 --> 00:05:04,549
what they allow what those binaries law

149
00:05:03,139 --> 00:05:07,340
do you do that our party installed in

150
00:05:04,550 --> 00:05:09,770
your system do things like remote code

151
00:05:07,340 --> 00:05:11,299
execution the ability to go out to the

152
00:05:09,770 --> 00:05:12,859
internet download files have them

153
00:05:11,300 --> 00:05:14,570
execute onto your system a lot of times

154
00:05:12,860 --> 00:05:16,160
not touching disk or maybe having to

155
00:05:14,570 --> 00:05:17,780
download just a specific type of file

156
00:05:16,160 --> 00:05:19,940
and then having those execute under

157
00:05:17,780 --> 00:05:22,309
system there's a lot number of these one

158
00:05:19,940 --> 00:05:24,560
of the most notorious ones is under your

159
00:05:22,310 --> 00:05:28,430
system 32 directory called reg STR 32

160
00:05:24,560 --> 00:05:30,440
and registry or 32 is an interesting one

161
00:05:28,430 --> 00:05:32,810
because it's proxy aware it has its own

162
00:05:30,440 --> 00:05:35,570
browser and what it can do when you call

163
00:05:32,810 --> 00:05:38,060
that specific application is you can

164
00:05:35,570 --> 00:05:40,490
have registry r32 go out to the internet

165
00:05:38,060 --> 00:05:42,320
download a specific file and execute

166
00:05:40,490 --> 00:05:44,810
that file is what we call scriptlet

167
00:05:42,320 --> 00:05:47,120
object download that fun execute it

168
00:05:44,810 --> 00:05:48,860
allowing for remote code execution and

169
00:05:47,120 --> 00:05:51,140
why that's damaging and challenging for

170
00:05:48,860 --> 00:05:53,180
it for defenders is that you know now

171
00:05:51,140 --> 00:05:54,560
you have a whole new attack surface and

172
00:05:53,180 --> 00:05:56,840
this isn't just for Windows by the way

173
00:05:54,560 --> 00:05:59,330
there are living off land binary scripts

174
00:05:56,840 --> 00:06:01,460
for Windows for OSX and Linux but why

175
00:05:59,330 --> 00:06:02,810
this is damaging is that you know from a

176
00:06:01,460 --> 00:06:04,190
code-signing perspective you trust

177
00:06:02,810 --> 00:06:06,200
implicitly Microsoft code signing

178
00:06:04,190 --> 00:06:07,880
applications and so now you have to look

179
00:06:06,200 --> 00:06:10,789
at different ways of either preventing

180
00:06:07,880 --> 00:06:12,229
that specific attack or defending or

181
00:06:10,789 --> 00:06:14,360
detecting that specific type of attack

182
00:06:12,229 --> 00:06:15,080
in your environment and so what I'm

183
00:06:14,360 --> 00:06:17,240
going to do is I'm going to show you a

184
00:06:15,080 --> 00:06:21,590
quick demo here and we're gonna use for

185
00:06:17,240 --> 00:06:23,900
Jesse r32 to communicate to a system and

186
00:06:21,590 --> 00:06:26,330
that has the latest version of Windows

187
00:06:23,900 --> 00:06:29,539
and I guess a little bit of an update to

188
00:06:26,330 --> 00:06:30,070
do later today but we have I'm not doing

189
00:06:29,539 --> 00:06:32,750
this right now

190
00:06:30,070 --> 00:06:34,520
that's good timing and so with this

191
00:06:32,750 --> 00:06:35,990
specific one here what we're gonna do is

192
00:06:34,520 --> 00:06:38,330
we're gonna call registry on 32 we're

193
00:06:35,990 --> 00:06:39,590
gonna have it execute this specific

194
00:06:38,330 --> 00:06:41,240
script logic here this is just one of

195
00:06:39,590 --> 00:06:43,520
prepended in

196
00:06:41,240 --> 00:06:46,310
and pre-made ahead of time and what this

197
00:06:43,520 --> 00:06:48,198
is is that it's gonna call W script uh

198
00:06:46,310 --> 00:06:50,090
shell and it's going to run a specific

199
00:06:48,199 --> 00:06:52,069
command calculate exe now I'm just

200
00:06:50,090 --> 00:06:54,138
demonstrating that rumah code execution

201
00:06:52,069 --> 00:06:56,090
actually works when I run this script

202
00:06:54,139 --> 00:06:57,860
attack so I'm gonna start a web server

203
00:06:56,090 --> 00:06:59,359
I'm gonna run a web server from a Linux

204
00:06:57,860 --> 00:07:01,699
machine in them and have a file called

205
00:06:59,360 --> 00:07:03,169
test that txt it's gonna have this code

206
00:07:01,699 --> 00:07:03,970
in here and I can just show you that

207
00:07:03,169 --> 00:07:08,289
right now

208
00:07:03,970 --> 00:07:08,289
so I log in to my mix machine here

209
00:07:08,349 --> 00:07:15,860
here's my IP address so I'm running at

210
00:07:12,169 --> 00:07:19,008
220 1.1 42 and here I have test that txt

211
00:07:15,860 --> 00:07:20,630
and in here is my scriptlet object that

212
00:07:19,009 --> 00:07:23,750
I have on running a readily available

213
00:07:20,630 --> 00:07:31,009
now I'm going to go ahead and run a web

214
00:07:23,750 --> 00:07:36,470
server and we stopped it past you really

215
00:07:31,009 --> 00:07:37,789
quick that's in command again and now

216
00:07:36,470 --> 00:07:40,130
we've got our web server running on 80

217
00:07:37,789 --> 00:07:41,840
so how is this specific instance now if

218
00:07:40,130 --> 00:07:43,610
you Google register you're at 32

219
00:07:41,840 --> 00:07:44,299
anywhere this is the example that you're

220
00:07:43,610 --> 00:07:46,490
going to find

221
00:07:44,300 --> 00:07:49,190
and so with registry or 32 there's a

222
00:07:46,490 --> 00:07:51,259
slash s slash n fu so non-interactive

223
00:07:49,190 --> 00:07:53,120
silence and then /i means go to the

224
00:07:51,259 --> 00:07:55,310
specific sites this specific website

225
00:07:53,120 --> 00:07:57,139
which is my malicious web server and run

226
00:07:55,310 --> 00:08:00,020
tests at txt which is our script object

227
00:07:57,139 --> 00:08:05,599
now we could also the last part you see

228
00:08:00,020 --> 00:08:08,240
here with the ser the this here our odj

229
00:08:05,599 --> 00:08:09,710
DLL is a scribble object yellow that's

230
00:08:08,240 --> 00:08:12,020
going to tell it to execute and run that

231
00:08:09,710 --> 00:08:13,070
specifics for the strength of objects so

232
00:08:12,020 --> 00:08:15,349
if we go ahead and copy and paste this

233
00:08:13,070 --> 00:08:16,969
into our Windows machine that we want to

234
00:08:15,349 --> 00:08:19,570
attack the simulate exit code execution

235
00:08:16,969 --> 00:08:21,979
you notice here then it gets the not

236
00:08:19,570 --> 00:08:23,780
Windows Defender specifically stopped at

237
00:08:21,979 --> 00:08:26,840
specific command which is great they

238
00:08:23,780 --> 00:08:28,190
took a specific technique and it's the

239
00:08:26,840 --> 00:08:29,210
hint and this is the part that gets me a

240
00:08:28,190 --> 00:08:31,130
little bit instead of removing the

241
00:08:29,210 --> 00:08:33,588
malicious functionality cuz obviously

242
00:08:31,130 --> 00:08:35,328
they consider this malicious where you

243
00:08:33,589 --> 00:08:37,159
know you have a binary going out to

244
00:08:35,328 --> 00:08:38,390
website downloading unsigned code to the

245
00:08:37,159 --> 00:08:40,458
from the internet directly to your

246
00:08:38,390 --> 00:08:42,380
system and executing but instead of

247
00:08:40,458 --> 00:08:44,329
removing the functionality inside the

248
00:08:42,380 --> 00:08:47,209
specific application they write a

249
00:08:44,329 --> 00:08:49,489
signature to potentially stop the

250
00:08:47,209 --> 00:08:51,410
specific issue from happening now as an

251
00:08:49,490 --> 00:08:53,540
attacker if I want to get around this

252
00:08:51,410 --> 00:08:55,010
all I need to do is apply some sort of

253
00:08:53,540 --> 00:08:56,630
Occupation technique or you

254
00:08:55,010 --> 00:08:58,460
Niq way of actually going and doing it

255
00:08:56,630 --> 00:09:01,010
so in this case we can use it a few

256
00:08:58,460 --> 00:09:03,860
different techniques out there we can

257
00:09:01,010 --> 00:09:05,510
use bits admin and bits admin is a tool

258
00:09:03,860 --> 00:09:07,580
that can go and download essentially any

259
00:09:05,510 --> 00:09:09,260
file from the internet there's also

260
00:09:07,580 --> 00:09:09,920
options and especially later versions of

261
00:09:09,260 --> 00:09:12,110
Windows 10

262
00:09:09,920 --> 00:09:14,449
curls install did you know that you can

263
00:09:12,110 --> 00:09:15,680
use Excel if you do Excel that Exe space

264
00:09:14,450 --> 00:09:18,350
and you give it a web address with an

265
00:09:15,680 --> 00:09:19,880
Excel document it'll actually save that

266
00:09:18,350 --> 00:09:21,230
excel document to the temp directory

267
00:09:19,880 --> 00:09:22,220
which you can execute it doesn't even

268
00:09:21,230 --> 00:09:24,500
Excel that may be anything you want to

269
00:09:22,220 --> 00:09:26,660
any file to your temperature entry to go

270
00:09:24,500 --> 00:09:28,190
and use in this specific case what we're

271
00:09:26,660 --> 00:09:30,560
gonna do is we're gonna run bits admin

272
00:09:28,190 --> 00:09:32,660
we're gonna have a download that test

273
00:09:30,560 --> 00:09:34,849
that txt file and then we're gonna call

274
00:09:32,660 --> 00:09:37,640
reg s cura 32 and instead we're gonna

275
00:09:34,850 --> 00:09:39,530
use that same thing in the /s /u and

276
00:09:37,640 --> 00:09:41,990
then we're into /i but instead of giving

277
00:09:39,530 --> 00:09:44,180
it the hcp site we're just going to call

278
00:09:41,990 --> 00:09:45,590
that specific test that txt file and

279
00:09:44,180 --> 00:09:50,270
call our script with logic and see if

280
00:09:45,590 --> 00:09:52,820
that gets around Windows Defender so

281
00:09:50,270 --> 00:09:54,470
we're gonna run this notice here it's

282
00:09:52,820 --> 00:10:00,110
gonna go and download that test that txt

283
00:09:54,470 --> 00:10:01,130
through bits admin and let me just

284
00:10:00,110 --> 00:10:02,680
double check my IP address really quick

285
00:10:01,130 --> 00:10:07,010
here because I think might be just one

286
00:10:02,680 --> 00:10:11,239
to two point one forty two to two one

287
00:10:07,010 --> 00:10:12,470
well that's why two 21.1 42 so if it

288
00:10:11,240 --> 00:10:14,630
salmon would fail because I didn't have

289
00:10:12,470 --> 00:10:16,670
the right IP address there that changed

290
00:10:14,630 --> 00:10:20,270
last minute I mean so let's go and run

291
00:10:16,670 --> 00:10:22,310
this again with the 142 notice here it

292
00:10:20,270 --> 00:10:24,199
downloads and it executes sim you get

293
00:10:22,310 --> 00:10:28,040
successful code execution by passing

294
00:10:24,200 --> 00:10:29,900
Windows Defender specific detection for

295
00:10:28,040 --> 00:10:32,689
that specific one interesting enough we

296
00:10:29,900 --> 00:10:37,579
can also do certain things like this we

297
00:10:32,690 --> 00:10:39,770
can just copy ser OB data dll and name

298
00:10:37,580 --> 00:10:43,790
it test that DLL and call register here

299
00:10:39,770 --> 00:10:46,100
at 32 without using the ser obj that DLL

300
00:10:43,790 --> 00:10:47,390
file itself and just calling a rename

301
00:10:46,100 --> 00:10:49,460
version of that so all we're gonna do is

302
00:10:47,390 --> 00:10:51,170
copy that file to our local directory

303
00:10:49,460 --> 00:10:53,180
then we're gonna call register your 32

304
00:10:51,170 --> 00:10:54,979
with test at the allow which we ended up

305
00:10:53,180 --> 00:10:57,079
using in this specific case so let's go

306
00:10:54,980 --> 00:10:58,300
and run that again we're going to the

307
00:10:57,080 --> 00:11:00,860
same exact thing

308
00:10:58,300 --> 00:11:04,130
notice here we get caught that exe to

309
00:11:00,860 --> 00:11:06,440
execute as well so very trivial for us

310
00:11:04,130 --> 00:11:08,310
as an attacker to circumvent traditional

311
00:11:06,440 --> 00:11:10,050
protection mechanisms ragazza

312
00:11:08,310 --> 00:11:12,859
what they are just by applying some

313
00:11:10,050 --> 00:11:15,120
different types of techniques out there

314
00:11:12,860 --> 00:11:16,590
so if I'm running specific commands like

315
00:11:15,120 --> 00:11:17,670
this in your environment and this is

316
00:11:16,590 --> 00:11:19,520
where we start talking about the the

317
00:11:17,670 --> 00:11:21,990
social engineering aspects of things

318
00:11:19,520 --> 00:11:24,360
when you look at at this one

319
00:11:21,990 --> 00:11:26,160
specifically we should you know if a

320
00:11:24,360 --> 00:11:29,430
security operation center a stock

321
00:11:26,160 --> 00:11:31,290
analyst sees this type of you know code

322
00:11:29,430 --> 00:11:34,410
running in your environment and you know

323
00:11:31,290 --> 00:11:36,180
powershell aki skated you know it's it's

324
00:11:34,410 --> 00:11:38,640
calling sis well 64 which is what we

325
00:11:36,180 --> 00:11:40,500
call powershell downgrade attack if you

326
00:11:38,640 --> 00:11:42,000
see all of these happening in your

327
00:11:40,500 --> 00:11:43,950
environment and the stock analyst gets

328
00:11:42,000 --> 00:11:46,470
this they look at that initiative say

329
00:11:43,950 --> 00:11:48,480
they should instantly say hey this is

330
00:11:46,470 --> 00:11:49,890
malicious this is something that we

331
00:11:48,480 --> 00:11:51,570
should take a look at in our environment

332
00:11:49,890 --> 00:11:53,189
because it does not look right you know

333
00:11:51,570 --> 00:11:54,600
you're applying obfuscation techniques

334
00:11:53,190 --> 00:11:56,370
when you're applying you know ways of

335
00:11:54,600 --> 00:11:57,720
encryption to hide the data the reason

336
00:11:56,370 --> 00:11:59,220
all of those things are common the

337
00:11:57,720 --> 00:12:00,210
techniques I mean look at the name that

338
00:11:59,220 --> 00:12:02,190
was being the service name that was

339
00:12:00,210 --> 00:12:03,720
being created specific in this case is a

340
00:12:02,190 --> 00:12:06,060
random - service name you know

341
00:12:03,720 --> 00:12:08,870
randomized hockey skated code it's using

342
00:12:06,060 --> 00:12:11,790
PowerShell is using no profile is using

343
00:12:08,870 --> 00:12:13,800
encoded man through basically for

344
00:12:11,790 --> 00:12:16,530
encoding there's a lot of things that

345
00:12:13,800 --> 00:12:18,740
are being executed here that that should

346
00:12:16,530 --> 00:12:22,110
stand out very quickly to a sake analyst

347
00:12:18,740 --> 00:12:23,970
so what if we change the story that

348
00:12:22,110 --> 00:12:26,640
we're telling a sake analyst what if we

349
00:12:23,970 --> 00:12:29,089
execute something that looks legitimate

350
00:12:26,640 --> 00:12:31,560
but is actually remote code execution

351
00:12:29,089 --> 00:12:33,390
remember this is all about a story that

352
00:12:31,560 --> 00:12:35,910
we're telling the end analyst around

353
00:12:33,390 --> 00:12:38,220
what we want to portray that we're

354
00:12:35,910 --> 00:12:40,079
actually going and doing again this is

355
00:12:38,220 --> 00:12:42,150
taking the same concepts from ten years

356
00:12:40,080 --> 00:12:43,800
ago of how we used to hack systems and

357
00:12:42,150 --> 00:12:47,790
do traditional social engineering

358
00:12:43,800 --> 00:12:49,109
methods and applying that today to when

359
00:12:47,790 --> 00:12:51,599
we actually get remote code execution

360
00:12:49,110 --> 00:12:54,270
onto a system so by creating something

361
00:12:51,600 --> 00:12:56,370
legitimate and telling a story our

362
00:12:54,270 --> 00:12:58,079
success rates drastically increased for

363
00:12:56,370 --> 00:12:59,610
non detection x' if you look at a

364
00:12:58,080 --> 00:13:03,320
security operation center they're

365
00:12:59,610 --> 00:13:05,190
oftentimes going through a lot of data

366
00:13:03,320 --> 00:13:06,959
haven't met a security operations center

367
00:13:05,190 --> 00:13:09,600
that is not busy there's a lot of noise

368
00:13:06,959 --> 00:13:11,489
and you know 99% of time alarm comes in

369
00:13:09,600 --> 00:13:13,440
Paul's father arm comes in false

370
00:13:11,490 --> 00:13:15,870
positive arm comes in false positive and

371
00:13:13,440 --> 00:13:18,030
so these analysts need to make very

372
00:13:15,870 --> 00:13:19,470
quick decisions to understand whether or

373
00:13:18,030 --> 00:13:21,510
not something is malicious to you again

374
00:13:19,470 --> 00:13:22,290
if you see something like this very

375
00:13:21,510 --> 00:13:24,899
quickly can it

376
00:13:22,290 --> 00:13:27,240
as malicious start your instant response

377
00:13:24,899 --> 00:13:28,500
process or start the reactionary methods

378
00:13:27,240 --> 00:13:30,029
to be able to handle the specific

379
00:13:28,500 --> 00:13:31,709
incident and then moving on to different

380
00:13:30,029 --> 00:13:35,189
ones escalated tier two or two or three

381
00:13:31,709 --> 00:13:37,680
and so you look at this and you say okay

382
00:13:35,190 --> 00:13:39,269
well if if this has to make a

383
00:13:37,680 --> 00:13:40,229
determination within a few seconds to a

384
00:13:39,269 --> 00:13:42,360
few minutes and whether or not

385
00:13:40,230 --> 00:13:44,970
something's malicious can I do something

386
00:13:42,360 --> 00:13:47,550
that that tricks them into thinking it

387
00:13:44,970 --> 00:13:49,589
is legitimate so my shape or form so

388
00:13:47,550 --> 00:13:51,508
let's take that example with register

389
00:13:49,589 --> 00:13:53,279
you're 32 really quick again so again we

390
00:13:51,509 --> 00:13:54,870
mentioned register you're 32 as a way to

391
00:13:53,279 --> 00:13:57,209
download and execute I'll by the way

392
00:13:54,870 --> 00:13:58,769
there's a there's over 70 of these

393
00:13:57,209 --> 00:14:00,209
difference living off gland binders and

394
00:13:58,769 --> 00:14:02,940
scripts I'm just picking on register up

395
00:14:00,209 --> 00:14:04,739
through to you there's CBD THC CSC DXE

396
00:14:02,940 --> 00:14:06,930
Mavin's Jack list there's just so many

397
00:14:04,740 --> 00:14:09,630
substantial ones that you can use for

398
00:14:06,930 --> 00:14:12,060
code execution at the system's MSHDA is

399
00:14:09,630 --> 00:14:15,209
another one the older versions of BG

400
00:14:12,060 --> 00:14:17,160
info there's quite a few and so if we if

401
00:14:15,209 --> 00:14:18,779
we can say to an analyst well you know

402
00:14:17,160 --> 00:14:20,310
every time you see register your 32 it's

403
00:14:18,779 --> 00:14:22,350
malicious which in most environments

404
00:14:20,310 --> 00:14:24,239
when you see register your are 32

405
00:14:22,350 --> 00:14:25,920
communicating out to the Internet it is

406
00:14:24,240 --> 00:14:27,779
in a malicious fashion that it's very

407
00:14:25,920 --> 00:14:30,599
rare I have never person seen in my

408
00:14:27,779 --> 00:14:32,339
career a legitimate version of a

409
00:14:30,600 --> 00:14:33,930
register at 32 communicating out to the

410
00:14:32,339 --> 00:14:36,540
Internet or being leveraged in their

411
00:14:33,930 --> 00:14:38,160
environment and so most analysts if they

412
00:14:36,540 --> 00:14:40,050
see registered through period are gonna

413
00:14:38,160 --> 00:14:42,269
have a heightened level of alert to say

414
00:14:40,050 --> 00:14:43,829
okay well but I see the specific command

415
00:14:42,269 --> 00:14:45,300
being executed my environment especially

416
00:14:43,829 --> 00:14:46,920
with never communications and it's

417
00:14:45,300 --> 00:14:48,810
picking up other child processes like

418
00:14:46,920 --> 00:14:50,430
PowerShell for example or other things

419
00:14:48,810 --> 00:14:52,819
these are things that I'd want to take a

420
00:14:50,430 --> 00:14:55,589
look at so what if I tell them the story

421
00:14:52,819 --> 00:14:57,630
so let's let's let's use this as a

422
00:14:55,589 --> 00:14:59,190
specific example you know I'll explain

423
00:14:57,630 --> 00:15:01,829
why we're doing this here in just a

424
00:14:59,190 --> 00:15:03,839
second so we use Excel dot exe to

425
00:15:01,829 --> 00:15:05,729
download you know fake website is being

426
00:15:03,839 --> 00:15:08,579
hosted company name reports underscore

427
00:15:05,730 --> 00:15:11,189
metrics version two XLS XLS it's not

428
00:15:08,579 --> 00:15:14,189
xlsm so it's not a macro it doesn't look

429
00:15:11,189 --> 00:15:15,750
malicious and even empty sock C's for

430
00:15:14,189 --> 00:15:17,010
some reason Excel is going out and

431
00:15:15,750 --> 00:15:18,959
downloading a file from the internet

432
00:15:17,010 --> 00:15:20,819
they are not gonna Stu think that is any

433
00:15:18,959 --> 00:15:22,439
in any way shape or form malicious and

434
00:15:20,819 --> 00:15:24,810
what that does is Excel actually saves

435
00:15:22,439 --> 00:15:26,009
that file in the temp directory so you

436
00:15:24,810 --> 00:15:28,649
know that file is in that specific

437
00:15:26,009 --> 00:15:30,930
location the excel file though isn't an

438
00:15:28,649 --> 00:15:32,069
excel file it's a scripted object in

439
00:15:30,930 --> 00:15:33,630
fact you can make the structural

440
00:15:32,069 --> 00:15:34,979
integrity of the excel file look like an

441
00:15:33,630 --> 00:15:36,280
excel file still contain script with

442
00:15:34,980 --> 00:15:38,640
objects in there as well

443
00:15:36,280 --> 00:15:40,930
so you know making it a scripted object

444
00:15:38,640 --> 00:15:42,819
wait some time on the system you know

445
00:15:40,930 --> 00:15:44,589
don't do this immediately so maybe wait

446
00:15:42,820 --> 00:15:47,110
you know maybe a time period of like 30

447
00:15:44,590 --> 00:15:49,360
minutes 45 minutes you know in your

448
00:15:47,110 --> 00:15:55,180
specific payload and then from there

449
00:15:49,360 --> 00:15:57,580
rename SCR obj dot dl l to st hmm gmt

450
00:15:55,180 --> 00:15:59,260
dot dl our copy and rename right so you

451
00:15:57,580 --> 00:16:01,960
basically have a dll called schema

452
00:15:59,260 --> 00:16:04,120
management that dll that's being renamed

453
00:16:01,960 --> 00:16:05,740
don't need you know administer level

454
00:16:04,120 --> 00:16:08,260
permissions for this in any way shape or

455
00:16:05,740 --> 00:16:10,540
form and then from there we rename

456
00:16:08,260 --> 00:16:14,740
company name report underscore metrics

457
00:16:10,540 --> 00:16:17,709
version 2.3 XLS to DLL install and then

458
00:16:14,740 --> 00:16:20,740
we issued the command register 32 / s /

459
00:16:17,710 --> 00:16:22,810
u /i d ll uninstall schema management

460
00:16:20,740 --> 00:16:24,880
that DLL now when we execute that

461
00:16:22,810 --> 00:16:27,609
command let's just say that the sock is

462
00:16:24,880 --> 00:16:30,550
is trained extremely well they know

463
00:16:27,610 --> 00:16:31,750
exactly what they're doing and any time

464
00:16:30,550 --> 00:16:33,339
their directives are anything to

465
00:16:31,750 --> 00:16:36,070
register through - you need to analyze

466
00:16:33,340 --> 00:16:37,450
this most are gonna fit in the 50 50

467
00:16:36,070 --> 00:16:38,770
mark cake we're gonna look at this we're

468
00:16:37,450 --> 00:16:41,260
gonna automatically assume that it's

469
00:16:38,770 --> 00:16:42,939
just the DLL being uninstalled and we're

470
00:16:41,260 --> 00:16:44,740
gonna move on but you might get the

471
00:16:42,940 --> 00:16:46,570
analyst that's like I'm really gonna

472
00:16:44,740 --> 00:16:48,550
investigate this specific command

473
00:16:46,570 --> 00:16:50,380
because you know I've taught anytime I

474
00:16:48,550 --> 00:16:53,109
see you register your 32 I need to take

475
00:16:50,380 --> 00:16:54,820
a look at this and so what's the story

476
00:16:53,110 --> 00:16:56,470
that I'm actually telling there so what

477
00:16:54,820 --> 00:16:59,530
would a sake unless that is a little bit

478
00:16:56,470 --> 00:17:02,050
you know skeptical of the specific thing

479
00:16:59,530 --> 00:17:03,459
happening do first thing they do is they

480
00:17:02,050 --> 00:17:05,198
probably researchers come in and see if

481
00:17:03,460 --> 00:17:07,240
it is actually legitimate so going to

482
00:17:05,199 --> 00:17:10,480
Google well what happens when you google

483
00:17:07,240 --> 00:17:11,949
register you are 32 / s / u /i d a long

484
00:17:10,480 --> 00:17:15,670
install with schema management the DLL

485
00:17:11,949 --> 00:17:17,650
the first thing you get is is from Doc's

486
00:17:15,670 --> 00:17:19,270
at Microsoft calm and it shows hey

487
00:17:17,650 --> 00:17:22,240
there's options for this specific one to

488
00:17:19,270 --> 00:17:23,500
be used like DLL I'm Saul and in this

489
00:17:22,240 --> 00:17:25,930
specific it with especially with these

490
00:17:23,500 --> 00:17:28,119
/i parameter and notice here an example

491
00:17:25,930 --> 00:17:29,200
of registering a DLL from Active

492
00:17:28,119 --> 00:17:31,899
Directory schema is that schema

493
00:17:29,200 --> 00:17:33,310
management that's yellow so when an

494
00:17:31,900 --> 00:17:34,990
analyst goes to check to see whether or

495
00:17:33,310 --> 00:17:37,870
not this command is actually legitimate

496
00:17:34,990 --> 00:17:39,820
they see oh DLL install and management

497
00:17:37,870 --> 00:17:41,110
dll's being used this is a classic

498
00:17:39,820 --> 00:17:43,540
example of something that's legitimate

499
00:17:41,110 --> 00:17:45,100
for our environment let's baseline that

500
00:17:43,540 --> 00:17:46,750
in the future so that we can get future

501
00:17:45,100 --> 00:17:48,520
future false positives from this and all

502
00:17:46,750 --> 00:17:49,899
of a sudden now you go on their system

503
00:17:48,520 --> 00:17:52,119
completely undetected

504
00:17:49,899 --> 00:17:54,488
and that's you know that the concept of

505
00:17:52,119 --> 00:17:55,059
this is can you tell a different type of

506
00:17:54,489 --> 00:17:58,659
story

507
00:17:55,059 --> 00:18:01,330
and so again applying the same the same

508
00:17:58,659 --> 00:18:03,279
concepts of social engineering to the

509
00:18:01,330 --> 00:18:05,908
story you're telling security analysts

510
00:18:03,279 --> 00:18:08,710
within an organization can make your

511
00:18:05,909 --> 00:18:10,690
success criteria for going on detected

512
00:18:08,710 --> 00:18:13,119
in an environment substantially higher

513
00:18:10,690 --> 00:18:14,619
and you can apply this to all phases of

514
00:18:13,119 --> 00:18:16,779
an attack whether its persistence

515
00:18:14,619 --> 00:18:19,029
purpose escalation post exploitation

516
00:18:16,779 --> 00:18:21,190
scenarios all of those things can be

517
00:18:19,029 --> 00:18:23,379
applied we need to talk about these

518
00:18:21,190 --> 00:18:25,899
types of techniques in the tax you can

519
00:18:23,379 --> 00:18:28,449
do custom environment some suggestions

520
00:18:25,899 --> 00:18:30,968
for defenders defenders need as much

521
00:18:28,450 --> 00:18:32,619
information as possible to make informed

522
00:18:30,969 --> 00:18:35,320
decisions and one common thing that we

523
00:18:32,619 --> 00:18:36,789
see for a lot of defenders is that they

524
00:18:35,320 --> 00:18:38,678
don't have the right amount of

525
00:18:36,789 --> 00:18:40,539
information centralized in a location

526
00:18:38,679 --> 00:18:42,909
that they can view single pane of glass

527
00:18:40,539 --> 00:18:44,710
and so a lot of times will happen is is

528
00:18:42,909 --> 00:18:47,259
that a sake analyst has to log into

529
00:18:44,710 --> 00:18:49,389
multiple tools to see the type of data

530
00:18:47,259 --> 00:18:51,009
that see the types of data they need in

531
00:18:49,389 --> 00:18:51,789
order to make a accurate decision and

532
00:18:51,009 --> 00:18:53,200
they're on top of that they're getting

533
00:18:51,789 --> 00:18:54,309
flooded in with more and more and more

534
00:18:53,200 --> 00:18:57,969
alarms that they have to meet specific

535
00:18:54,309 --> 00:19:00,668
SL A's and so that that process between

536
00:18:57,969 --> 00:19:02,769
there is very difficult for sake analyst

537
00:19:00,669 --> 00:19:04,809
to keep up and do the appropriate amount

538
00:19:02,769 --> 00:19:06,759
of an analysis so you know from a

539
00:19:04,809 --> 00:19:08,440
defense perspective giving the sake

540
00:19:06,759 --> 00:19:12,460
analyst as much information as possible

541
00:19:08,440 --> 00:19:14,049
to make a correct and informed decision

542
00:19:12,460 --> 00:19:16,269
on whether or not something's malicious

543
00:19:14,049 --> 00:19:17,499
in the specific case you know some some

544
00:19:16,269 --> 00:19:19,359
indicators we potentially could have

545
00:19:17,499 --> 00:19:21,940
detected on yes you know when register

546
00:19:19,359 --> 00:19:24,009
after BTW XD kicks off and it runs at

547
00:19:21,940 --> 00:19:25,659
scriptlet object you know whenever you

548
00:19:24,009 --> 00:19:28,179
see a scripted object being executed

549
00:19:25,659 --> 00:19:30,669
within register you're at 32 on even if

550
00:19:28,179 --> 00:19:32,799
it's not calling scr j obj that dll

551
00:19:30,669 --> 00:19:34,389
those are things that that you can do

552
00:19:32,799 --> 00:19:35,950
from an indicators perspective but again

553
00:19:34,389 --> 00:19:38,738
you know if you're not providing

554
00:19:35,950 --> 00:19:39,849
behavior data to individual sake miles

555
00:19:38,739 --> 00:19:41,739
with everything that's in there like the

556
00:19:39,849 --> 00:19:43,689
contents of dll and installed by the way

557
00:19:41,739 --> 00:19:45,249
would be fantastic hey what is this

558
00:19:43,690 --> 00:19:47,469
actually doing what's the contents of

559
00:19:45,249 --> 00:19:49,570
those Cryptologic now again let's just

560
00:19:47,469 --> 00:19:51,129
say we decided to make it look like deal

561
00:19:49,570 --> 00:19:52,509
uninstall in it that it's it's it's some

562
00:19:51,129 --> 00:19:53,799
innocuous thing that's going out and

563
00:19:52,509 --> 00:19:55,239
doing something and then you know from

564
00:19:53,799 --> 00:19:57,099
there maybe we have we tuck in some code

565
00:19:55,239 --> 00:19:58,389
in the middle of that you know those are

566
00:19:57,099 --> 00:20:00,609
all things that we can do again as an

567
00:19:58,389 --> 00:20:02,678
attacker to simulate that specific thing

568
00:20:00,609 --> 00:20:04,250
being legitimate so things that we can

569
00:20:02,679 --> 00:20:05,840
do better

570
00:20:04,250 --> 00:20:08,680
and that's really the main concept of

571
00:20:05,840 --> 00:20:12,500
this whole presentation is can we trick

572
00:20:08,680 --> 00:20:16,010
our defense into thinking that something

573
00:20:12,500 --> 00:20:17,930
is legitimate and and good in the

574
00:20:16,010 --> 00:20:19,610
environments but that's really it

575
00:20:17,930 --> 00:20:20,840
that's the end of my presentation you

576
00:20:19,610 --> 00:20:24,229
know for defenders obviously this is

577
00:20:20,840 --> 00:20:26,060
something that is up-and-coming we've

578
00:20:24,230 --> 00:20:27,260
seen it work very successfully in a lot

579
00:20:26,060 --> 00:20:30,440
of the simulations that we've been

580
00:20:27,260 --> 00:20:32,210
through as well as you know you see from

581
00:20:30,440 --> 00:20:34,130
a lot of adversaries that are more

582
00:20:32,210 --> 00:20:35,540
skilled in nature when they're doing

583
00:20:34,130 --> 00:20:37,520
more attack vectors within the

584
00:20:35,540 --> 00:20:39,620
organization and trying to go undetected

585
00:20:37,520 --> 00:20:41,330
for a larger period of time but I want

586
00:20:39,620 --> 00:20:43,550
to thank Ringo Khan for having me you

587
00:20:41,330 --> 00:20:45,290
know such an amazing event that they're

588
00:20:43,550 --> 00:20:45,710
having again check out the D holiday

589
00:20:45,290 --> 00:20:47,120
hack

590
00:20:45,710 --> 00:20:49,220
challenge everything that they've been

591
00:20:47,120 --> 00:20:51,560
provides it's such an amazing thing out

592
00:20:49,220 --> 00:20:53,870
there so have a great Christmas have a

593
00:20:51,560 --> 00:20:56,270
great Happy New Year and thanks again to

594
00:20:53,870 --> 00:20:58,959
Kringle Khan for having me here and go

595
00:20:56,270 --> 00:20:58,960
save Christmas

