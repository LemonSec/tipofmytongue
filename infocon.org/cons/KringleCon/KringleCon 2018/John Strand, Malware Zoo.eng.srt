1
00:00:00,000 --> 00:00:04,440
hello everybody and welcome back to

2
00:00:01,979 --> 00:00:07,109
Kringle Con once again a huge huge thank

3
00:00:04,440 --> 00:00:09,179
you to mr. Claus for having us up here

4
00:00:07,109 --> 00:00:10,679
and mrs. Claus I don't know if you guys

5
00:00:09,179 --> 00:00:13,349
are aware of this but mrs. Claus makes

6
00:00:10,679 --> 00:00:15,240
the absolute best cookies in the whole

7
00:00:13,349 --> 00:00:16,770
wide world so I'm basically letting you

8
00:00:15,240 --> 00:00:18,359
all know this because kids you better

9
00:00:16,770 --> 00:00:20,340
start upping your cookie game because

10
00:00:18,359 --> 00:00:22,439
you're gonna do nothing but disappoint

11
00:00:20,340 --> 00:00:23,400
Santa whenever he comes to your house on

12
00:00:22,439 --> 00:00:24,660
Christmas Eve

13
00:00:23,400 --> 00:00:27,119
all right so I wanted to give another

14
00:00:24,660 --> 00:00:29,400
presentation on creating a malware zu zu

15
00:00:27,119 --> 00:00:30,840
and doing malware analysis so let's dive

16
00:00:29,400 --> 00:00:32,040
right in the first thing that you're

17
00:00:30,840 --> 00:00:33,660
gonna have to do when you're setting up

18
00:00:32,040 --> 00:00:35,670
your malware zu is you're going to have

19
00:00:33,660 --> 00:00:37,500
to have an overall concept of what the

20
00:00:35,670 --> 00:00:39,270
design is going to look at Oh

21
00:00:37,500 --> 00:00:41,309
generally wonder if we're creating a

22
00:00:39,270 --> 00:00:44,250
malware analysis lab for creating

23
00:00:41,309 --> 00:00:46,769
malware for implants or doing detection

24
00:00:44,250 --> 00:00:48,660
with Rita and doing analysis we create

25
00:00:46,770 --> 00:00:50,550
an Active Directory environment we

26
00:00:48,660 --> 00:00:52,769
infect a single system on the inside of

27
00:00:50,550 --> 00:00:55,709
that environment and then we have a bro

28
00:00:52,770 --> 00:00:57,480
or Z because it's now called and Rita

29
00:00:55,710 --> 00:00:59,820
system that's watching all of that

30
00:00:57,480 --> 00:01:02,069
traffic that is leaving that particular

31
00:00:59,820 --> 00:01:03,300
environment and this is key because you

32
00:01:02,070 --> 00:01:05,519
want to have that level of visibility

33
00:01:03,300 --> 00:01:07,740
now some people would argue that you

34
00:01:05,519 --> 00:01:10,290
would need full peak apps and full TCP

35
00:01:07,740 --> 00:01:12,539
dump that would be great if everybody

36
00:01:10,290 --> 00:01:13,530
could do that that would be just

37
00:01:12,540 --> 00:01:15,509
fantastic

38
00:01:13,530 --> 00:01:18,150
but a lot of organizations have very

39
00:01:15,509 --> 00:01:20,640
limited number of span ports that they

40
00:01:18,150 --> 00:01:22,500
can use for the Eagers traffic so that

41
00:01:20,640 --> 00:01:24,689
may not be available so just try to tie

42
00:01:22,500 --> 00:01:26,189
up just bro and Rita don't try to get

43
00:01:24,689 --> 00:01:29,008
too crazy with what you're trying to

44
00:01:26,189 --> 00:01:31,408
capture also running VMware VMware is

45
00:01:29,009 --> 00:01:34,409
absolutely essential this is my lab this

46
00:01:31,409 --> 00:01:35,970
is what I use all the time for doing

47
00:01:34,409 --> 00:01:37,799
analysis with Rita and active

48
00:01:35,970 --> 00:01:40,229
countermeasures AI hunter and this

49
00:01:37,799 --> 00:01:42,420
particular lab can scale anywhere from

50
00:01:40,229 --> 00:01:44,850
like a handful of systems like 20 all

51
00:01:42,420 --> 00:01:47,280
the way up to about 70 to 80 systems it

52
00:01:44,850 --> 00:01:49,020
depends on how crazy I want to get with

53
00:01:47,280 --> 00:01:51,869
a lab that I'm trying to create and

54
00:01:49,020 --> 00:01:52,860
VMware is just fantastic for that also

55
00:01:51,869 --> 00:01:56,189
bro

56
00:01:52,860 --> 00:01:58,289
Zeke bro is amazing we should do a

57
00:01:56,189 --> 00:02:00,719
number of we don't we should all get

58
00:01:58,290 --> 00:02:03,090
together here I think that there's some

59
00:02:00,719 --> 00:02:05,189
like ship a little bit south of us I

60
00:02:03,090 --> 00:02:07,350
think some researchers got stranded

61
00:02:05,189 --> 00:02:09,720
there and possibly died horrible painful

62
00:02:07,350 --> 00:02:11,099
cold deaths we could all meet there

63
00:02:09,720 --> 00:02:12,239
because I think all the food stores are

64
00:02:11,099 --> 00:02:13,899
there and I think all the liquors there

65
00:02:12,239 --> 00:02:15,790
but we can all get together later

66
00:02:13,900 --> 00:02:18,459
just do a tabletop session and talk

67
00:02:15,790 --> 00:02:20,590
about bro but bro actually decodes a

68
00:02:18,459 --> 00:02:24,340
large amount of data and I automatically

69
00:02:20,590 --> 00:02:28,319
identify DNS data HTTP data HTTP data

70
00:02:24,340 --> 00:02:31,569
TCP connections it slices it dices it is

71
00:02:28,319 --> 00:02:34,750
fantastic and Rita rides on top of bro

72
00:02:31,569 --> 00:02:36,640
also generating noise is important

73
00:02:34,750 --> 00:02:39,519
anytime you're trying to analyze any

74
00:02:36,640 --> 00:02:41,798
network intrusion detection product it

75
00:02:39,519 --> 00:02:44,920
is really really easy to say the product

76
00:02:41,799 --> 00:02:46,420
works whenever it is just watching for

77
00:02:44,920 --> 00:02:48,429
computer systems and one of those

78
00:02:46,420 --> 00:02:50,619
computer systems is making an outbound

79
00:02:48,430 --> 00:02:54,310
connection that's just stupid easy to do

80
00:02:50,620 --> 00:02:57,670
so this is one of the cool tools that we

81
00:02:54,310 --> 00:03:00,459
created and Hills Information Security

82
00:02:57,670 --> 00:03:02,349
it was one of the first things that a

83
00:03:00,459 --> 00:03:04,359
Systems Administrator that I hired Kent

84
00:03:02,349 --> 00:03:07,119
who's now one of our pen testers did

85
00:03:04,359 --> 00:03:08,230
when he joined bh is he came on board

86
00:03:07,120 --> 00:03:10,060
I'm like here's what I want I want a

87
00:03:08,230 --> 00:03:13,290
PowerShell script that pulls down the

88
00:03:10,060 --> 00:03:16,359
alexia top 500 picks a system or a

89
00:03:13,290 --> 00:03:17,948
website and they alexia top 500 and then

90
00:03:16,359 --> 00:03:20,019
serves to that website for five minutes

91
00:03:17,949 --> 00:03:22,060
closes the connection and then opens up

92
00:03:20,019 --> 00:03:23,739
and starts surfing again so it generates

93
00:03:22,060 --> 00:03:26,049
a tremendous amount of white noise

94
00:03:23,739 --> 00:03:27,879
because literally every single system in

95
00:03:26,049 --> 00:03:30,400
this environment is making those

96
00:03:27,879 --> 00:03:32,440
outbound connections like a standard

97
00:03:30,400 --> 00:03:34,780
user would be making those outbound

98
00:03:32,440 --> 00:03:37,060
connections this allows you to see how

99
00:03:34,780 --> 00:03:39,040
well your implant blends in with the

100
00:03:37,060 --> 00:03:41,470
white noise and it also allows you to

101
00:03:39,040 --> 00:03:43,989
kind of get a baseline on how effective

102
00:03:41,470 --> 00:03:46,030
your network intrusion detection system

103
00:03:43,989 --> 00:03:48,400
or your extrusion detection system is at

104
00:03:46,030 --> 00:03:50,590
detecting attacks as well so check it

105
00:03:48,400 --> 00:03:52,419
out now the goals and objectives we

106
00:03:50,590 --> 00:03:54,940
don't want to get lost in the weeds it's

107
00:03:52,419 --> 00:03:57,099
about identifying and understanding very

108
00:03:54,940 --> 00:03:59,530
specific malware samples this would be

109
00:03:57,099 --> 00:04:01,209
malware samples that you want to

110
00:03:59,530 --> 00:04:03,609
recreate in the lab to test a product

111
00:04:01,209 --> 00:04:05,349
this would be malware samples as a red

112
00:04:03,609 --> 00:04:07,720
teamer that you want to generate and see

113
00:04:05,349 --> 00:04:10,298
if its profile is going to be easily

114
00:04:07,720 --> 00:04:11,889
detected by a target organization that

115
00:04:10,299 --> 00:04:14,260
you're doing an assessment on as well

116
00:04:11,889 --> 00:04:15,729
and we really want to start looking that

117
00:04:14,260 --> 00:04:19,029
this is something that should be done

118
00:04:15,729 --> 00:04:22,300
structurally across the board you should

119
00:04:19,029 --> 00:04:23,950
be constantly testing your IDs IPS user

120
00:04:22,300 --> 00:04:25,960
behavioral and entity analytics your

121
00:04:23,950 --> 00:04:27,460
antivirus products as much as you

122
00:04:25,960 --> 00:04:30,430
possibly can and

123
00:04:27,460 --> 00:04:32,229
trying to create that malware zoo will

124
00:04:30,430 --> 00:04:35,050
allow you to develop the skills and the

125
00:04:32,229 --> 00:04:38,318
techniques to fully vet all the security

126
00:04:35,050 --> 00:04:40,539
products that are out there right now so

127
00:04:38,319 --> 00:04:42,099
watching the malware so whenever I'm

128
00:04:40,539 --> 00:04:43,870
running malware on a system I'll be

129
00:04:42,099 --> 00:04:46,150
watching and making sure that it

130
00:04:43,870 --> 00:04:49,419
actually fires off like it'll basically

131
00:04:46,150 --> 00:04:50,109
pop up and let me know yes it is in fact

132
00:04:49,419 --> 00:04:52,568
working

133
00:04:50,110 --> 00:04:54,610
I will also name my malware something

134
00:04:52,569 --> 00:04:56,860
that's easy for me to identify and that

135
00:04:54,610 --> 00:04:59,110
noise this is all part of an effort to

136
00:04:56,860 --> 00:05:00,699
make sure that it's working properly so

137
00:04:59,110 --> 00:05:04,120
in this example I named my malware

138
00:05:00,699 --> 00:05:05,979
beacon DXE because it's a beacon and

139
00:05:04,120 --> 00:05:08,380
then I ran a little PowerShell script

140
00:05:05,979 --> 00:05:10,630
and that's that - nao b5 we're gonna

141
00:05:08,380 --> 00:05:13,479
pull through select string batch the

142
00:05:10,630 --> 00:05:16,870
pattern beacon and then we're gonna kick

143
00:05:13,479 --> 00:05:18,729
it out to a file called beacon txt this

144
00:05:16,870 --> 00:05:21,880
is a quick way for me to be sure that

145
00:05:18,729 --> 00:05:24,460
the beacon is firing and it does not go

146
00:05:21,880 --> 00:05:26,590
down so the Black Hills Information

147
00:05:24,460 --> 00:05:28,000
Security testers they actually hate me a

148
00:05:26,590 --> 00:05:30,369
lot of the testers are constantly

149
00:05:28,000 --> 00:05:32,710
creating malware specimens dropping

150
00:05:30,370 --> 00:05:34,259
malware specimens in the lab or even in

151
00:05:32,710 --> 00:05:37,900
customer networks where we have Rita

152
00:05:34,259 --> 00:05:40,539
setup for them and they basically say go

153
00:05:37,900 --> 00:05:42,669
and try and check this malware as well

154
00:05:40,539 --> 00:05:44,440
so there's lots of custom malware that

155
00:05:42,669 --> 00:05:46,508
they generate all the time there's all a

156
00:05:44,440 --> 00:05:49,330
lot of off-the-shelf malware that they

157
00:05:46,509 --> 00:05:51,039
create as well and you don't have to be

158
00:05:49,330 --> 00:05:52,960
a test or to create malware there's tons

159
00:05:51,039 --> 00:05:54,789
of examples easy things that you can do

160
00:05:52,960 --> 00:05:56,919
in Metasploit and if you go out and get

161
00:05:54,789 --> 00:05:59,380
a tool like cobalt strike it makes it's

162
00:05:56,919 --> 00:06:00,639
super duper simple to create tons of

163
00:05:59,380 --> 00:06:04,180
different command and control profiles

164
00:06:00,639 --> 00:06:07,630
so let's start with Java so Java is kind

165
00:06:04,180 --> 00:06:08,940
of the lead tester for creating malware

166
00:06:07,630 --> 00:06:10,870
at Black Hills information security

167
00:06:08,940 --> 00:06:12,610
constantly creating payloads and

168
00:06:10,870 --> 00:06:14,259
backdoors that other testers are using

169
00:06:12,610 --> 00:06:17,050
and constantly coming up with new

170
00:06:14,259 --> 00:06:19,509
techniques to bypass endpoint security

171
00:06:17,050 --> 00:06:21,280
products that's just kind of jobs gig

172
00:06:19,509 --> 00:06:23,380
right and that would make sense I mean a

173
00:06:21,280 --> 00:06:27,159
guy is an instructor of the Python class

174
00:06:23,380 --> 00:06:28,719
and that's just what he does so he out

175
00:06:27,159 --> 00:06:31,599
of everybody probably has the biggest

176
00:06:28,719 --> 00:06:33,340
vested interest and trying to find a way

177
00:06:31,599 --> 00:06:35,169
to bypass Rita because if any of my

178
00:06:33,340 --> 00:06:37,719
testers are working on an engagement and

179
00:06:35,169 --> 00:06:40,150
Rita's catching them he immediately is

180
00:06:37,719 --> 00:06:41,260
going to get that phone call so Java

181
00:06:40,150 --> 00:06:42,909
ated a backdoor

182
00:06:41,260 --> 00:06:45,940
called mole-rat with the help of a lot

183
00:06:42,910 --> 00:06:48,640
of other testers Egypt and marchello and

184
00:06:45,940 --> 00:06:50,410
Matt to Seine and Dakota all of these

185
00:06:48,640 --> 00:06:52,419
testers got together and kind of created

186
00:06:50,410 --> 00:06:54,910
a backdoor an implant framework that we

187
00:06:52,420 --> 00:06:57,310
use on our engagements and he set up all

188
00:06:54,910 --> 00:06:59,320
kinds of fun things he set up jitter he

189
00:06:57,310 --> 00:07:01,270
set up all kinds of different profiles

190
00:06:59,320 --> 00:07:05,230
for what is the interval for that jitter

191
00:07:01,270 --> 00:07:07,090
and just a really cool tool well here's

192
00:07:05,230 --> 00:07:09,310
the deal if you have an attacker that's

193
00:07:07,090 --> 00:07:10,690
creating super advanced malware it's not

194
00:07:09,310 --> 00:07:13,270
enough just to be able to analyze that

195
00:07:10,690 --> 00:07:15,400
malware based on its interval so if

196
00:07:13,270 --> 00:07:17,650
you're confused as far as what interval

197
00:07:15,400 --> 00:07:20,349
actually means interval is a lot like a

198
00:07:17,650 --> 00:07:24,250
heartbeat so if you have a heartbeat a

199
00:07:20,350 --> 00:07:26,650
heartbeat can be relatively slow or the

200
00:07:24,250 --> 00:07:29,470
heartbeat could be really really fast as

201
00:07:26,650 --> 00:07:31,870
well so we can identify that heartbeat

202
00:07:29,470 --> 00:07:33,670
what is the consistency in the

203
00:07:31,870 --> 00:07:35,770
connections that are coming out bound so

204
00:07:33,670 --> 00:07:37,390
an attacker can actually randomize that

205
00:07:35,770 --> 00:07:39,490
heartbeat and make it a little bit more

206
00:07:37,390 --> 00:07:42,490
difficult for a lot of tools to detect

207
00:07:39,490 --> 00:07:45,040
that interval however if you take the

208
00:07:42,490 --> 00:07:46,960
output of a tool like Rita and you sort

209
00:07:45,040 --> 00:07:49,210
it by the number of connections some

210
00:07:46,960 --> 00:07:52,359
really cool things come about in this

211
00:07:49,210 --> 00:07:55,750
particular example a 24-hour a period of

212
00:07:52,360 --> 00:07:58,120
time Jaffe's back door at a relatively

213
00:07:55,750 --> 00:07:59,860
low score on the interval only had a

214
00:07:58,120 --> 00:08:02,110
point seven nine interval it means it

215
00:07:59,860 --> 00:08:03,880
was not a perfect interval but whenever

216
00:08:02,110 --> 00:08:06,640
you couple that with the connections you

217
00:08:03,880 --> 00:08:08,650
sorted it on the interval and then by

218
00:08:06,640 --> 00:08:12,190
the connections you saw at his back door

219
00:08:08,650 --> 00:08:15,280
had 72 thousand two hundred and forty

220
00:08:12,190 --> 00:08:17,050
three connections that's because that

221
00:08:15,280 --> 00:08:19,479
backdoor was an interactive backdoor

222
00:08:17,050 --> 00:08:21,940
that was being used by the team at that

223
00:08:19,480 --> 00:08:23,710
specific time so you could actually see

224
00:08:21,940 --> 00:08:25,090
he that backdoor you could work with

225
00:08:23,710 --> 00:08:27,909
that backdoor interact with that

226
00:08:25,090 --> 00:08:30,039
backdoor that basically means it had to

227
00:08:27,910 --> 00:08:32,710
be responsive so whenever you start

228
00:08:30,040 --> 00:08:34,570
coupling the overall beacon score with

229
00:08:32,710 --> 00:08:36,460
the number of connections you start

230
00:08:34,570 --> 00:08:37,419
getting increased visibility in finding

231
00:08:36,460 --> 00:08:39,700
a number of different interesting

232
00:08:37,419 --> 00:08:42,549
backdoors so this is Derek's backdoor

233
00:08:39,700 --> 00:08:44,530
Derek banks is another tester Derek went

234
00:08:42,549 --> 00:08:47,410
even further he actually went through

235
00:08:44,530 --> 00:08:50,140
and created a cobalt strike backdoor

236
00:08:47,410 --> 00:08:52,630
that was going through domain fronting

237
00:08:50,140 --> 00:08:54,939
specifically through cloud front so it

238
00:08:52,630 --> 00:08:57,189
went like when the malware goes

239
00:08:54,940 --> 00:08:59,110
runs it fires up it makes a connection

240
00:08:57,190 --> 00:09:01,750
out to cloud from cloud front looks

241
00:08:59,110 --> 00:09:03,640
inside of that HTTP header and inside of

242
00:09:01,750 --> 00:09:05,230
it it says host and then it says here's

243
00:09:03,640 --> 00:09:07,630
the IP address where you should forward

244
00:09:05,230 --> 00:09:10,240
that traffic it's almost like a proxy

245
00:09:07,630 --> 00:09:11,560
for web content and with that proxy for

246
00:09:10,240 --> 00:09:13,810
web content it can make it very

247
00:09:11,560 --> 00:09:16,030
difficult to detect because many

248
00:09:13,810 --> 00:09:17,979
security products will ignore everything

249
00:09:16,030 --> 00:09:20,410
that goes to CD ends they'll ignore

250
00:09:17,980 --> 00:09:23,110
everything that goes to social media

251
00:09:20,410 --> 00:09:24,730
sites like Google or Facebook they'll

252
00:09:23,110 --> 00:09:27,370
just ignore because it's so much traffic

253
00:09:24,730 --> 00:09:30,190
and the odds of it being malicious are

254
00:09:27,370 --> 00:09:32,440
actually pretty low also he added in all

255
00:09:30,190 --> 00:09:34,720
kinds of randomization and also sleep in

256
00:09:32,440 --> 00:09:37,240
this back door as well and yes we could

257
00:09:34,720 --> 00:09:39,520
detect Derek as well once again when you

258
00:09:37,240 --> 00:09:41,230
have that overall score and the number

259
00:09:39,520 --> 00:09:43,090
of connections combined with each other

260
00:09:41,230 --> 00:09:44,500
it gave you the ability to find this

261
00:09:43,090 --> 00:09:46,840
backdoor the other thing that was really

262
00:09:44,500 --> 00:09:50,500
neat and it's not up here is the

263
00:09:46,840 --> 00:09:52,780
dispersion was very even a lot of

264
00:09:50,500 --> 00:09:55,630
backdoors out there today they will

265
00:09:52,780 --> 00:09:57,400
randomize their entry before so say

266
00:09:55,630 --> 00:09:59,470
there's a 10-second interval I want you

267
00:09:57,400 --> 00:10:01,750
to connect outbound plus or minus two

268
00:09:59,470 --> 00:10:03,100
seconds and what you end up with is 50%

269
00:10:01,750 --> 00:10:04,870
of the connections are going to be

270
00:10:03,100 --> 00:10:06,670
between ten and twelve seconds and

271
00:10:04,870 --> 00:10:08,050
you're gonna have 50% of the connections

272
00:10:06,670 --> 00:10:10,630
are gonna be between ten and eight

273
00:10:08,050 --> 00:10:13,719
seconds when you have that flat kind of

274
00:10:10,630 --> 00:10:15,100
background between fifty percent on one

275
00:10:13,720 --> 00:10:17,350
side fifty percent on that I decided

276
00:10:15,100 --> 00:10:19,210
that flat dispersion it means that you

277
00:10:17,350 --> 00:10:20,740
have another backdoor in your

278
00:10:19,210 --> 00:10:22,510
environment so that's pretty cool just

279
00:10:20,740 --> 00:10:24,930
cool way to take the output of a tool

280
00:10:22,510 --> 00:10:27,730
like Rita import it into a spreadsheet

281
00:10:24,930 --> 00:10:30,280
sort it and then find back doors on a

282
00:10:27,730 --> 00:10:32,920
network so lessons learned additional

283
00:10:30,280 --> 00:10:35,560
things that we've discovered one DNS and

284
00:10:32,920 --> 00:10:37,300
NTP generated ton of beaconing noise

285
00:10:35,560 --> 00:10:39,219
when you're setting up your malware Zoo

286
00:10:37,300 --> 00:10:42,310
you may have to go through and find a

287
00:10:39,220 --> 00:10:44,110
way to deal with that traffic in short

288
00:10:42,310 --> 00:10:46,000
you may want to filter that out for

289
00:10:44,110 --> 00:10:48,180
something like a beaconing algorithm but

290
00:10:46,000 --> 00:10:51,310
you still want that analysis to be done

291
00:10:48,180 --> 00:10:53,500
for like let's say subdomains or hosts

292
00:10:51,310 --> 00:10:55,839
on a domain as well domain fronting is

293
00:10:53,500 --> 00:10:57,730
tough to catch really really tough to

294
00:10:55,839 --> 00:10:58,870
catch folks we've got to be careful a

295
00:10:57,730 --> 00:11:03,190
lot of security products aren't doing

296
00:10:58,870 --> 00:11:04,930
really well unfortunately major vendors

297
00:11:03,190 --> 00:11:06,670
are saying oh we're gonna do away with

298
00:11:04,930 --> 00:11:08,709
domain fronting we're just gonna get rid

299
00:11:06,670 --> 00:11:12,729
of that unfortunately we're not seeing

300
00:11:08,710 --> 00:11:14,080
disappear and that's kind of sad so we

301
00:11:12,730 --> 00:11:15,640
can't just hold on to beaconing it's

302
00:11:14,080 --> 00:11:17,710
going to require us to start doing cross

303
00:11:15,640 --> 00:11:19,900
referencing across multiple different

304
00:11:17,710 --> 00:11:21,790
aspects of how malware actually makes a

305
00:11:19,900 --> 00:11:23,770
connection outbound so beacon and

306
00:11:21,790 --> 00:11:25,810
connection count combining those two is

307
00:11:23,770 --> 00:11:29,680
just one example of how we can do that

308
00:11:25,810 --> 00:11:32,410
as well crypto I spent a lot of time in

309
00:11:29,680 --> 00:11:34,630
the past few months doing analysis on

310
00:11:32,410 --> 00:11:36,459
blockchain technology and crypto

311
00:11:34,630 --> 00:11:38,020
currencies I had some contracts to the

312
00:11:36,460 --> 00:11:41,620
Department of Defense and I also wanted

313
00:11:38,020 --> 00:11:43,540
to have conversations where I could sit

314
00:11:41,620 --> 00:11:45,400
down with Beau and Mike and they

315
00:11:43,540 --> 00:11:47,349
wouldn't look at me and say oh aren't

316
00:11:45,400 --> 00:11:48,699
you cute here's your happy meal why

317
00:11:47,350 --> 00:11:51,070
don't you go sit in the corner while we

318
00:11:48,700 --> 00:11:53,020
talk about real stuff so I really don't

319
00:11:51,070 --> 00:11:57,010
ablack chain and cryptocurrency for a

320
00:11:53,020 --> 00:11:58,990
while and we found out in a lot of the

321
00:11:57,010 --> 00:12:00,790
hunt teams that we're doing the malware

322
00:11:58,990 --> 00:12:02,560
that we're actually detecting isn't even

323
00:12:00,790 --> 00:12:05,260
really malware it's actually

324
00:12:02,560 --> 00:12:07,420
cryptocurrency mining usually Manero

325
00:12:05,260 --> 00:12:09,130
running on a system or systems

326
00:12:07,420 --> 00:12:11,020
administrators running multiple systems

327
00:12:09,130 --> 00:12:13,210
running nice hash on thousands of

328
00:12:11,020 --> 00:12:16,180
computer systems so how do you actually

329
00:12:13,210 --> 00:12:18,520
go through to detect those back doors as

330
00:12:16,180 --> 00:12:21,550
well does a beacon well it turns out in

331
00:12:18,520 --> 00:12:24,460
the example of nice hash no it doesn't

332
00:12:21,550 --> 00:12:25,900
it doesn't actually beacon at all once

333
00:12:24,460 --> 00:12:27,160
again we have to move beyond just

334
00:12:25,900 --> 00:12:28,930
looking at beaconing what are some other

335
00:12:27,160 --> 00:12:31,150
attributes for this potential malware

336
00:12:28,930 --> 00:12:33,400
communicating outbound and we can

337
00:12:31,150 --> 00:12:36,060
instead look at it from the perspective

338
00:12:33,400 --> 00:12:39,340
of how long does that connection stay

339
00:12:36,060 --> 00:12:41,050
alive and in this example we had this

340
00:12:39,340 --> 00:12:42,430
backdoor there was was this situation it

341
00:12:41,050 --> 00:12:45,010
was nice ash which wasn't two back doors

342
00:12:42,430 --> 00:12:47,859
just beacon it was just cryptocurrency

343
00:12:45,010 --> 00:12:50,860
mining and instead of beaconing it would

344
00:12:47,860 --> 00:12:54,010
establish a full connection and never

345
00:12:50,860 --> 00:12:55,300
tear that connection down and this is

346
00:12:54,010 --> 00:12:57,069
interesting this is interesting for a

347
00:12:55,300 --> 00:12:59,319
number of reasons this is interesting

348
00:12:57,070 --> 00:13:01,750
because if we go back in time about

349
00:12:59,320 --> 00:13:03,400
eight years ago a lot of malware that

350
00:13:01,750 --> 00:13:05,410
was out there would actually establish

351
00:13:03,400 --> 00:13:08,020
connections keep those connections up

352
00:13:05,410 --> 00:13:10,120
and running the whole time that could be

353
00:13:08,020 --> 00:13:12,520
hours days weeks months years and that's

354
00:13:10,120 --> 00:13:13,720
just how the malware worked then a lot

355
00:13:12,520 --> 00:13:16,180
of security products started getting

356
00:13:13,720 --> 00:13:18,940
really smart about that and identifying

357
00:13:16,180 --> 00:13:20,949
really long-lived connections and then

358
00:13:18,940 --> 00:13:22,279
would alert people on their firewall

359
00:13:20,950 --> 00:13:24,980
rules about

360
00:13:22,279 --> 00:13:26,509
long lived connections so then malware

361
00:13:24,980 --> 00:13:30,860
switched to beaconing it would basically

362
00:13:26,509 --> 00:13:32,209
pulse out an HTTP or an HTTP session now

363
00:13:30,860 --> 00:13:34,670
you're starting to see tools that are

364
00:13:32,209 --> 00:13:36,619
actually detecting that beaconing so now

365
00:13:34,670 --> 00:13:39,319
we're seeing malware and in this

366
00:13:36,620 --> 00:13:42,050
situation crypto miners go back to

367
00:13:39,319 --> 00:13:44,029
establishing long held connections so

368
00:13:42,050 --> 00:13:47,029
the easiest way to bypass beacon

369
00:13:44,029 --> 00:13:47,899
detection just don't beacon it's much

370
00:13:47,029 --> 00:13:49,370
easier that way

371
00:13:47,899 --> 00:13:51,350
so we need to be looking at beaconing

372
00:13:49,370 --> 00:13:53,329
total number of connections some

373
00:13:51,350 --> 00:13:55,249
mathematical attributes all of those

374
00:13:53,329 --> 00:13:56,839
connections and then also looking for

375
00:13:55,249 --> 00:13:59,420
really long connections as well which

376
00:13:56,839 --> 00:14:00,980
once again Rito's free and it does all

377
00:13:59,420 --> 00:14:03,769
of these if you'd like to get some our

378
00:14:00,980 --> 00:14:05,449
Lenny's Elster has a great web page with

379
00:14:03,769 --> 00:14:07,579
a ton of resources where you can

380
00:14:05,449 --> 00:14:09,050
download all kinds of different malware

381
00:14:07,579 --> 00:14:11,239
and I know that this is important for a

382
00:14:09,050 --> 00:14:13,339
lot of you because you may not know how

383
00:14:11,240 --> 00:14:15,259
to create malware Metasploit may freak

384
00:14:13,339 --> 00:14:17,240
you out a little bit and that's fine

385
00:14:15,259 --> 00:14:20,149
just go download now or just do me a

386
00:14:17,240 --> 00:14:23,059
solid favor don't run this on your

387
00:14:20,149 --> 00:14:24,319
production network free pretty please

388
00:14:23,059 --> 00:14:26,449
just don't don't do that

389
00:14:24,319 --> 00:14:27,860
once again this malware zu creating a

390
00:14:26,449 --> 00:14:30,378
malware as we would to test our implants

391
00:14:27,860 --> 00:14:32,809
to test our security products it's not

392
00:14:30,379 --> 00:14:34,069
malware oh my god everything's on fire

393
00:14:32,809 --> 00:14:35,660
everyone run

394
00:14:34,069 --> 00:14:38,389
once again please don't do that we're in

395
00:14:35,660 --> 00:14:40,100
the North Pole things don't burn here I

396
00:14:38,389 --> 00:14:41,540
wanted to finally say thank you very

397
00:14:40,100 --> 00:14:43,490
much I've provided my phone number my

398
00:14:41,540 --> 00:14:45,319
Twitter handle my websites that I'm at

399
00:14:43,490 --> 00:14:46,879
please check it out once again I'm like

400
00:14:45,319 --> 00:14:48,410
a NASCAR driver with all of these

401
00:14:46,879 --> 00:14:51,559
different organizations that I work with

402
00:14:48,410 --> 00:14:54,889
so thanks again everyone stay warm and

403
00:14:51,559 --> 00:14:57,399
don't forget to check out mrs. Claus's

404
00:14:54,889 --> 00:14:57,399
cookies

