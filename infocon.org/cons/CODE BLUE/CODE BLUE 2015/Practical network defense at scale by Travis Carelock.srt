1
00:00:02,780 --> 00:00:15,049
thank you for coming out

2
00:00:15,049 --> 00:00:27,910
defense at scale so I am currently an
engineer at SoundCloud before that I was

3
00:00:27,910 --> 00:00:32,399
a technical content director at black
hat and before that I worked in the

4
00:00:32,399 --> 00:00:38,370
Louisiana Department of Justice so this
talk this talk is going to be primarily

5
00:00:38,370 --> 00:00:43,239
about defense I've been around the
conference series for quite some time

6
00:00:43,239 --> 00:00:48,559
now and a lot of times in the security
conferences you leave with a sense of

7
00:00:48,559 --> 00:00:55,659
doom and gloom a lot of times you hear
about how everything is broken and how

8
00:00:55,659 --> 00:01:01,059
bad a shape we are in its true but I
want to make a different type of

9
00:01:01,059 --> 00:01:05,158
presentation I wanted to make a
presentation that hopefully you guys can

10
00:01:05,159 --> 00:01:10,700
take back with you and use some of the
techniques that we discuss here so I

11
00:01:10,700 --> 00:01:17,390
love defense I love understanding the
network of building walls and traps and

12
00:01:17,390 --> 00:01:22,860
that sort of thing but I don't love is
this and many of us in this room are

13
00:01:22,860 --> 00:01:28,630
paid to avoid something like this so
we're going to be talking about building

14
00:01:28,630 --> 00:01:35,429
defense I'm gonna be focusing on
building a network scalable scene seemed

15
00:01:35,430 --> 00:01:40,979
as a security event and incident
management system but like I said I love

16
00:01:40,979 --> 00:01:44,979
techniques that go into building the
scene I believe you could probably use

17
00:01:44,979 --> 00:01:51,810
in your own environments so when I
decided to make this to decide to write

18
00:01:51,810 --> 00:01:56,500
this presentation writing about defense
is a little tough because every

19
00:01:56,500 --> 00:02:03,030
organization has its own set of things
that need to defend and whenever you

20
00:02:03,030 --> 00:02:08,899
have that there is no one easy button
there is one no easy answer on how

21
00:02:08,899 --> 00:02:13,130
you're supposed to do it it really
depends on your organization

22
00:02:13,130 --> 00:02:18,019
so again I decided to talk about the
process of building one of these

23
00:02:18,020 --> 00:02:23,430
scalable themes and all the different
types of questions you might have to ask

24
00:02:23,430 --> 00:02:28,440
yourself if you're going to build
something like this so that that's how

25
00:02:28,440 --> 00:02:31,329
I'm gonna structure this presentation
has a series of questions that you would

26
00:02:31,330 --> 00:02:37,120
want to answer the very first question
and it seems simple but it's it's

27
00:02:37,120 --> 00:02:41,130
crucial the very first question you can
ask is what am I trying to accomplish

28
00:02:41,130 --> 00:02:45,900
now like I said it seems like a simple
question and if you talk to people

29
00:02:45,900 --> 00:02:50,240
outside of your security team outside
your organization they may something say

30
00:02:50,240 --> 00:02:54,560
something like this we want to just stop
the hackers right we want to stop them

31
00:02:54,560 --> 00:03:00,100
from getting and we want to protect all
the stuff and just stop them but you and

32
00:03:00,100 --> 00:03:05,090
I both know that this really is not a
realistic goal it doesn't do anyone any

33
00:03:05,090 --> 00:03:12,860
good 22 fearsome amorphous person in the
sky that maybe has more caffeine more

34
00:03:12,860 --> 00:03:20,240
time is better financed then you really
doesn't help what does how your defense

35
00:03:20,240 --> 00:03:25,260
is a realistic and detailed
understanding of your infrastructure or

36
00:03:25,260 --> 00:03:29,450
your environment and in fact this is the
very first step in answering the

37
00:03:29,450 --> 00:03:33,679
question what you're trying to
accomplish because without this

38
00:03:33,680 --> 00:03:38,870
understanding you're not going to know
your goals so this this part is required

39
00:03:38,870 --> 00:03:43,320
you have to understand and do a thorough
risk analysis and risk analysis of your

40
00:03:43,320 --> 00:03:49,700
environment in order to continue this
presentation I need to have an example

41
00:03:49,700 --> 00:03:54,859
network for you guys I need to have an
example type of environment that we can

42
00:03:54,860 --> 00:04:02,780
apply the next group of questions to
have chosen this sort of network so this

43
00:04:02,780 --> 00:04:09,160
is a highly highly active network it's
got thousands and thousands of nodes in

44
00:04:09,160 --> 00:04:09,890
it

45
00:04:09,890 --> 00:04:16,599
performs billions of user requests today
and it may serve you know hundreds of

46
00:04:16,600 --> 00:04:21,440
millions of logged in users each day
this network is generally very flat

47
00:04:21,440 --> 00:04:26,750
which means that all the nodes can talk
to each other but it's like I said it's

48
00:04:26,750 --> 00:04:32,600
really really active I can't say this
the Soundcloud network but it might be

49
00:04:32,600 --> 00:04:37,669
something something like that so let's
look at any one of these nodes in the

50
00:04:37,669 --> 00:04:45,270
network might be so any one of these
notes they could be installed on some

51
00:04:45,270 --> 00:04:49,940
sort of physical hardware they could be
a container or virtual machines some

52
00:04:49,940 --> 00:04:53,940
sort they might be the networking
equipment driving the infrastructure

53
00:04:53,940 --> 00:05:01,060
they might be your cloud instances most
people most environments nowadays have

54
00:05:01,060 --> 00:05:06,300
some sort of cloud component to them or
they could just be in general users

55
00:05:06,300 --> 00:05:11,020
coming into your network to form some
sort of action

56
00:05:11,020 --> 00:05:15,130
VPN into your network or something like
that so these note pop up and perform

57
00:05:15,130 --> 00:05:20,659
some sort of action and then go away now
these notes can be doing any number of

58
00:05:20,660 --> 00:05:25,080
things they could be serviced seen some
micro service or some sort of web-scale

59
00:05:25,080 --> 00:05:31,060
application dependencies the node candy
database are part of a database cluster

60
00:05:31,060 --> 00:05:38,610
it might be part of a service-oriented
cluster more like a scheduling Coster

61
00:05:38,610 --> 00:05:44,940
that it schedules out it could be
getting your DNS UDP your internal

62
00:05:44,940 --> 00:05:50,450
network services these notes can be load
balancers so they might be accepting

63
00:05:50,450 --> 00:05:54,800
traffic for a whole host of skilled
applications behind it

64
00:05:54,800 --> 00:05:59,820
these nodes might be your business
people coming and clean your databases

65
00:05:59,820 --> 00:06:04,919
so they can get insights into their
business intelligence they might be like

66
00:06:04,919 --> 00:06:07,900
I said your administrators your systems
engineers coming in

67
00:06:07,900 --> 00:06:14,630
making changes to your network it might
even be a security device that you felt

68
00:06:14,630 --> 00:06:19,240
that that comes in and scanned to try
and figure out what's going on but the

69
00:06:19,240 --> 00:06:23,360
most important thing is you want to make
sure it's not this we want to make sure

70
00:06:23,360 --> 00:06:27,330
that none of these notes are some sort
of zombie or malicious entity that

71
00:06:27,330 --> 00:06:33,130
fifteen around your network we're doing
some sort of thing so I wanted to step

72
00:06:33,130 --> 00:06:37,360
back a second and talk about notes in
general and the modern infrastructure

73
00:06:37,360 --> 00:06:44,580
and the old days and unfortunately I'm
old enough to be in the old days this is

74
00:06:44,580 --> 00:06:50,150
how we treated our servers generally our
servers were pets they were so hard to

75
00:06:50,150 --> 00:06:54,919
configure they were so hard to keep
running that you're up time counter with

76
00:06:54,919 --> 00:06:59,859
everything you you you strive to do
whatever you could to keep the service

77
00:06:59,860 --> 00:07:05,110
up and running all the time in fact this
caused a huge problem because people

78
00:07:05,110 --> 00:07:09,520
would apply security patches or updates
to these servers because they were

79
00:07:09,520 --> 00:07:10,539
scared what would happen

80
00:07:10,539 --> 00:07:19,880
well now we move beyond a little bit and
some people have suggested that we see

81
00:07:19,880 --> 00:07:29,180
service this way now we see services
cattle so this means that something

82
00:07:29,180 --> 00:07:33,169
happens to the node something happens to
the server hard drive good bad someone

83
00:07:33,169 --> 00:07:35,250
RN's

84
00:07:35,250 --> 00:07:40,250
important directories no big deal we
just pull up a new node and soak it up

85
00:07:40,250 --> 00:07:46,030
to the load balancer whatever we need
and continue along the way but I really

86
00:07:46,030 --> 00:07:51,729
don't think does justice to what we what
the modern system administrator system

87
00:07:51,729 --> 00:07:58,880
engineer want to know they want this now
what is that this is from my title the

88
00:07:58,880 --> 00:08:07,000
this is a longer works out so I recently
moved to Germany and I came across this

89
00:08:07,000 --> 00:08:13,120
term this term is used to describe this
myth that mythical beast and directly

90
00:08:13,120 --> 00:08:18,090
translated it is an egg lane will
produce seen milk giving

91
00:08:18,090 --> 00:08:24,919
big and it's it's in German culture it's
a slang for a catch all it gives you

92
00:08:24,919 --> 00:08:30,099
anything you need at any time and I
believe this is what your modern systems

93
00:08:30,100 --> 00:08:34,800
engineers want out of a node they want
that node to be anything at anytime

94
00:08:34,799 --> 00:08:40,699
whatever they may need for example a
node might be part of the database

95
00:08:40,700 --> 00:08:46,170
cluster so it's serving database traffic
but then thirty minutes later that

96
00:08:46,170 --> 00:08:50,740
database might be moved into some sort
of cloud instance and that known as and

97
00:08:50,740 --> 00:08:56,430
then destroyed and in its place two more
notes come up and made have the same one

98
00:08:56,430 --> 00:09:00,670
of those notes might have the same IP
and now serving application traffic so

99
00:09:00,670 --> 00:09:06,579
it's completely changed or maybe during
peak times we have a certain application

100
00:09:06,580 --> 00:09:10,930
that has normally 1502 associated with
it but it's a peak time so he went to

101
00:09:10,930 --> 00:09:15,020
scale it up to a hundred and fifty notes
and all the dependencies that that

102
00:09:15,020 --> 00:09:20,040
microsoft office might need course need
to scale that up as well so now and we

103
00:09:20,040 --> 00:09:26,430
look back at our infrastructure we see
this giant flat network and its like I

104
00:09:26,430 --> 00:09:31,069
said it's it's serving billions of user
requests every day and each user request

105
00:09:31,070 --> 00:09:35,540
is this fanart sort of process that can
taxes innumerable amount of databases

106
00:09:35,540 --> 00:09:42,339
not the numeral but a lot of databases
and and any known can be anything at any

107
00:09:42,339 --> 00:09:48,000
time during any type of data that they
may need so now how do you know what the

108
00:09:48,000 --> 00:09:53,300
malicious entities how do you know where
the problem is well it can be trouble

109
00:09:53,300 --> 00:10:00,920
but don't panic and we just need to
start simple so going back to what we're

110
00:10:00,920 --> 00:10:05,240
trying to accomplish now we have this
very dynamic network it's a Chinese

111
00:10:05,240 --> 00:10:09,709
notes constantly what are some of the
things we do some of the goals we might

112
00:10:09,709 --> 00:10:12,180
want to accomplish in such a network

113
00:10:12,180 --> 00:10:17,209
well we're very starting you might want
to investigate network traffic I'm gonna

114
00:10:17,209 --> 00:10:19,430
go through these individual in a second

115
00:10:19,430 --> 00:10:24,199
you also my network traffic rules and
alerts and of course you're going to

116
00:10:24,200 --> 00:10:27,270
want to have some sort of forensic
analysis store

117
00:10:27,270 --> 00:10:31,840
I store this data somewhere so you have
to have a compromise you can go back and

118
00:10:31,840 --> 00:10:36,480
understand what really happened so what
do I mean by investigating the worst

119
00:10:36,480 --> 00:10:44,000
traffic maybe I have a node or a logical
grouping of nodes that make up a scaled

120
00:10:44,000 --> 00:10:49,190
application and i wanna know how that
failed application or group of nodes

121
00:10:49,190 --> 00:10:54,340
interact with the rest of my network I
might wanna know all the IP's for that

122
00:10:54,340 --> 00:10:59,350
application or those group of nodes and
all the hype is that it talks to within

123
00:10:59,350 --> 00:11:04,180
my network what ports does it connect to
and of course we want to know how much

124
00:11:04,180 --> 00:11:08,989
data is transferred to that would be
maybe a simple goal about investigating

125
00:11:08,990 --> 00:11:14,740
network traffic we might also want
traffic rules that we haven't known and

126
00:11:14,740 --> 00:11:19,200
we have a database cluster and we want
to allow that no two clearly that that's

127
00:11:19,200 --> 00:11:23,490
fine I may be that note is it logical
grouping of nodes in the form of some

128
00:11:23,490 --> 00:11:28,500
sort of application and we want to allow
that to contact that data source maybe

129
00:11:28,500 --> 00:11:32,580
we ought to applications and we won't
allow both of those who we want to make

130
00:11:32,580 --> 00:11:38,210
sure that nothing out nothing out from
the rest of the infrastructure can clear

131
00:11:38,210 --> 00:11:43,260
that that would be an example but rather
cool or if something does queria send an

132
00:11:43,260 --> 00:11:45,150
alert

133
00:11:45,150 --> 00:11:49,439
addition we might have that database
cluster and want to make sure it never

134
00:11:49,440 --> 00:11:56,410
ever speaks to the internet this is this
is a good this is a good rule so

135
00:11:56,410 --> 00:12:02,589
examples of our network traffic rules
maybe I also want to do the forensics

136
00:12:02,589 --> 00:12:07,629
analysis so I need a long-term storage
for this data that's pretty self-evident

137
00:12:07,629 --> 00:12:15,810
and some way to collect that data to
perform evaluations so we have some

138
00:12:15,810 --> 00:12:21,099
goals we want invest in network traffic
and we want to write traffic rules what

139
00:12:21,100 --> 00:12:25,240
are sources sources of truth that will
answer the questions and I'm trying to

140
00:12:25,240 --> 00:12:31,910
ask where can I get the data that will
tell me what I'm trying to do well when

141
00:12:31,910 --> 00:12:36,550
the primary sources of truth i think is
really great on a network is traffic

142
00:12:36,550 --> 00:12:45,139
flows so things like a slow and NetFlow
what what is these are from a routers

143
00:12:45,139 --> 00:12:51,600
switches point of view what goes across
the backplane what's the source IP what

144
00:12:51,600 --> 00:12:56,759
the destination IP and how much traffic
was set from that routers point of view

145
00:12:56,759 --> 00:13:04,019
but you wouldn't want to stop their run
include firewall log and other type of

146
00:13:04,019 --> 00:13:10,350
networking equipment logs ideas logs are
very important bro and network

147
00:13:10,350 --> 00:13:14,139
monitoring is actually a great tool I
suggest you guys check it out of new and

148
00:13:14,139 --> 00:13:19,800
used it it will actually do packet
analysis as traffic flows across the

149
00:13:19,800 --> 00:13:26,359
interface you definitely don't want to
collect logs from DHCP DNS and other

150
00:13:26,360 --> 00:13:29,110
networking services you want to do

151
00:13:29,110 --> 00:13:34,310
coast-based logs so there's a deal of
course are you off logs but then think

152
00:13:34,310 --> 00:13:38,920
outside of that so you're maybe rootkit
hunters your audit d some of your

153
00:13:38,920 --> 00:13:44,309
application logs come up the host so
that's another source of true of course

154
00:13:44,309 --> 00:13:49,689
database logs are always important and
then again if you're using a cloud-based

155
00:13:49,689 --> 00:13:53,939
service many of them at their own type
of logs for example like Cloud trail

156
00:13:53,939 --> 00:14:01,660
Amazon s3 access logs can tell what's
happening to your s3 buckets

157
00:14:01,660 --> 00:14:07,510
and you're gonna see this icon a lot in
this presentation this is an icon I'm

158
00:14:07,510 --> 00:14:12,370
using for custom code so maybe there's
nothing on your infrastructure that a

159
00:14:12,370 --> 00:14:15,980
median the type of data you need to
answer the question you want to ask

160
00:14:15,980 --> 00:14:20,480
maybe you need to code something that
will tell you this that will emit a

161
00:14:20,480 --> 00:14:25,820
certain type of law to give you that
source of truth and almost almost

162
00:14:25,820 --> 00:14:30,750
certainly will go a couple of things to
consider

163
00:14:30,750 --> 00:14:36,300
whenever you're talking about the source
of truth is how consistent is this data

164
00:14:36,300 --> 00:14:42,670
that you're receiving is an erratic can
which means can you can be certain that

165
00:14:42,670 --> 00:14:47,469
the data is actually measuring what you
think it's measuring he's a very

166
00:14:47,470 --> 00:14:53,670
important when you're considering the
log types how independent is the log and

167
00:14:53,670 --> 00:14:59,550
by how independent I mean when you talk
about a compromise system say about her

168
00:14:59,550 --> 00:15:05,329
a note might be compromised the law is
gonna get from that note are not very

169
00:15:05,330 --> 00:15:09,150
independent but maybe the logs in the
networking infrastructure around it

170
00:15:09,150 --> 00:15:15,500
would be how how easy is it to crop
these logs either in transit or in

171
00:15:15,500 --> 00:15:20,190
storage it's also super important and
all of this will lead you to some sort

172
00:15:20,190 --> 00:15:26,930
of confidence score a confidence score
is how confident and I in this long that

173
00:15:26,930 --> 00:15:30,229
it's telling me what I think it's
telling me if we go back to that

174
00:15:30,230 --> 00:15:34,620
compromised node I'm gonna read all the
walls I'm gonna gather all the logs off

175
00:15:34,620 --> 00:15:38,380
that system and read them on my
confidence score probably won't be very

176
00:15:38,380 --> 00:15:43,540
high but I'm still gonna read them and
then retention policy that's also very

177
00:15:43,540 --> 00:15:45,160
important

178
00:15:45,160 --> 00:15:50,439
retention policy is really is dependent
on your infrastructure and what's in

179
00:15:50,440 --> 00:15:56,830
that log there are some some in germany
there some laws that say I can only keep

180
00:15:56,830 --> 00:16:01,070
certain types of laws source for certain
amount of time because it contained user

181
00:16:01,070 --> 00:16:07,830
data or personal I P P I personally PII
personally identifiable information and

182
00:16:07,830 --> 00:16:11,870
so those laws can only stay for a little
bit but

183
00:16:11,870 --> 00:16:16,690
still you need to make sure it's long
and so so if a compromise does happen

184
00:16:16,690 --> 00:16:21,779
you have the data their retention
policies really important and it's kind

185
00:16:21,779 --> 00:16:29,140
of dependent on the law now we have this
source of truth one of the problems I

186
00:16:29,140 --> 00:16:36,830
see that happens a lot is people will
collect lots of those say I'm longing

187
00:16:36,830 --> 00:16:42,720
unloading everything but they just don't
fit into a giant that giant folder maybe

188
00:16:42,720 --> 00:16:48,790
HDFS or something like that so the logs
don't become relative to each other

189
00:16:48,790 --> 00:16:53,300
they're only relative to the log self so
you're going to want to process your

190
00:16:53,300 --> 00:16:58,109
logs before you store them before you
put in the new datastore the very first

191
00:16:58,110 --> 00:17:03,980
thing you gonna do is normalized logs
and what I mean by normalize well each

192
00:17:03,980 --> 00:17:08,480
one of these laws have a timestamp
that's great time to answer very

193
00:17:08,480 --> 00:17:12,309
important but I know you can't see this
but if you look closely each when these

194
00:17:12,309 --> 00:17:16,730
timestamps are actually in a different
time zone and not only that but each

195
00:17:16,730 --> 00:17:23,170
time stamp is in a different format so
as you in just these laws you don't want

196
00:17:23,170 --> 00:17:29,100
to modify that so that it's consistent
amongst all your logs so now you can ask

197
00:17:29,100 --> 00:17:34,649
questions like what happened two o'clock
yesterday from two to three what exactly

198
00:17:34,650 --> 00:17:42,750
happen across all my logs not just
within one web log or 14 log in addition

199
00:17:42,750 --> 00:17:47,010
you going to normalize things like the
data transfer all three of these laws

200
00:17:47,010 --> 00:17:52,230
have a certain amount of by trans 1300
data transfer but when one of them it in

201
00:17:52,230 --> 00:18:00,040
bits I think this one's bites and this
one can be bits bytes or megabytes so as

202
00:18:00,040 --> 00:18:04,540
you bring these logs in your going to
standardize that to some sort of format

203
00:18:04,540 --> 00:18:08,879
it doesn't matter which one you just
need to pick 12 now you'll be able to

204
00:18:08,880 --> 00:18:12,550
understand exactly how much data is
transferred when you do it just a

205
00:18:12,550 --> 00:18:13,750
general search of

206
00:18:13,750 --> 00:18:21,360
you're also been wanna Tagalongs this is
this is really important as well in this

207
00:18:21,360 --> 00:18:26,800
log all three of these bloodlines have a
source IP and the top this one just has

208
00:18:26,800 --> 00:18:33,350
source equals super useful and these two
don't even have anything next to him so

209
00:18:33,350 --> 00:18:38,600
once you tagged them as the source IP
for this log and you can do the same

210
00:18:38,600 --> 00:18:43,949
thing force a destination IP he's now
you can ask across all your logs for

211
00:18:43,950 --> 00:18:50,550
destination IP X what happened and now
you can ask questions like a destination

212
00:18:50,550 --> 00:18:55,909
IP what happen at two o'clock from two
o'clock to 3 o'clock yesterday you'll be

213
00:18:55,910 --> 00:18:56,840
able to find out

214
00:18:56,840 --> 00:19:01,530
be able to easily correlate between our
logs what is going on with this certain

215
00:19:01,530 --> 00:19:11,690
node or IP also type your logs typing
refers to the variable type so as you

216
00:19:11,690 --> 00:19:16,060
chop up the laws and you're tagging and
you're normalizing you're also going to

217
00:19:16,060 --> 00:19:22,730
type them so for example ports ports are
integers and when you type it as an

218
00:19:22,730 --> 00:19:26,670
integer now be able to do calculations
that you couldn't do it he just left it

219
00:19:26,670 --> 00:19:30,610
as a string is most things just leave
things that strings but now that you

220
00:19:30,610 --> 00:19:34,750
know that your system knows it's an
integer you can do ranges you can do say

221
00:19:34,750 --> 00:19:41,770
so me all the ports from 80 to 90 for
example the same thing with IP type it

222
00:19:41,770 --> 00:19:47,510
as an IP so now you can start asking
questions such as where this range of

223
00:19:47,510 --> 00:19:58,480
IPs from 10 . tend to 28 / 16 / 15 and
CIDR you can now ask questions about his

224
00:19:58,480 --> 00:20:04,010
entire range of IP's this this is how
you can say for example did any traffic

225
00:20:04,010 --> 00:20:09,310
go to something that's not in my
internal IP range because you've typed

226
00:20:09,310 --> 00:20:14,360
them as I peas and not just left mister
rings so now that you're tagging typing

227
00:20:14,360 --> 00:20:18,550
and normalizing you're logged you can
ask questions already before we get too

228
00:20:18,550 --> 00:20:21,840
far into the system you can already
asked questions like where this

229
00:20:21,840 --> 00:20:23,439
destination IP

230
00:20:23,440 --> 00:20:26,840
how much data is transferred

231
00:20:26,840 --> 00:20:31,350
what percentage changes that from an
hour ago what percentage change of that

232
00:20:31,350 --> 00:20:35,120
is from yesterday and now you can start
doing cue some scores and things like

233
00:20:35,120 --> 00:20:41,299
that you can start really understanding
what's going on now we're starting to

234
00:20:41,299 --> 00:20:45,549
realize that we want certain laws are
starting to pull out certain data types

235
00:20:45,549 --> 00:20:50,679
from these laws well what are you going
to use to turn all this what what tools

236
00:20:50,679 --> 00:20:57,019
are in your toolbox this again is
dependent on your source of truth for

237
00:20:57,019 --> 00:21:03,210
this example I decide to use strings and
logs and that sort of thing so probably

238
00:21:03,210 --> 00:21:08,299
seen this project so far first tools
that we're going to use is the Elks tat

239
00:21:08,299 --> 00:21:15,918
it stands for log stash elasticsearch
partner and so this is a really popular

240
00:21:15,919 --> 00:21:19,389
project I'm sure a lot of you heard
about it

241
00:21:19,389 --> 00:21:24,799
logs that is the thing that you can use
to manipulate your logs as you're

242
00:21:24,799 --> 00:21:30,320
ingesting them once it in just the laws
and modifies it it shoots out JSON into

243
00:21:30,320 --> 00:21:35,928
elasticsearch elasticsearch you probably
heard of it is a distributed data store

244
00:21:35,929 --> 00:21:41,600
and indexes on the fly to make all your
logs immediately searchable and then

245
00:21:41,600 --> 00:21:46,809
combine is used then query data to
create dashboards and the query out from

246
00:21:46,809 --> 00:21:50,970
elasticsearch and you can create pretty
dashboards like this that you can show

247
00:21:50,970 --> 00:21:56,100
your boss boss is always like really
pretty dashboards but I will have to say

248
00:21:56,100 --> 00:22:01,830
for this project for this scene
elasticsearch is the real is the real

249
00:22:01,830 --> 00:22:05,580
hero here because you can write and you
probably will write once you hit a

250
00:22:05,580 --> 00:22:09,519
certain scale you can write your own
ingested you can write your own logs

251
00:22:09,519 --> 00:22:13,710
desk loan and for sure you're going to
write your own enquiries Sokoban is

252
00:22:13,710 --> 00:22:15,440
great for visualization

253
00:22:15,440 --> 00:22:19,259
to ask the really hard questions you
probably write your own theories you're

254
00:22:19,259 --> 00:22:22,740
not going to be right in your own
elasticsearch cluster and to give you an

255
00:22:22,740 --> 00:22:27,660
example currently I am ingesting with
only eight no

256
00:22:27,660 --> 00:22:32,600
ads I can ingest up to a million log
lines and 12 seconds that's that's

257
00:22:32,600 --> 00:22:37,189
that's how powerful asset searches and
if I need to do more I can easily to

258
00:22:37,190 --> 00:22:44,120
scale up its really useful ok so now
we've got our pipeline our main pipeline

259
00:22:44,120 --> 00:22:48,110
obviously there's a whole bunch of other
tool not a whole bunch but other tools

260
00:22:48,110 --> 00:22:53,969
around here as focal actors are syslog
those types of things that you can use

261
00:22:53,970 --> 00:22:59,460
to gather all your sources of truth but
the primary point is we're going to

262
00:22:59,460 --> 00:23:04,860
gather source of truth to enter the
pipeline near normalizing all this sort

263
00:23:04,860 --> 00:23:12,479
of stuff now again I want to talk about
this like on the custom code here as you

264
00:23:12,480 --> 00:23:17,190
develop these systems and especially as
you development in relationship to your

265
00:23:17,190 --> 00:23:22,950
infrastructure you're gonna write your
own stuff I security professional some

266
00:23:22,950 --> 00:23:27,850
of the Skoda lot some of us don't for
these types of queries really it's not

267
00:23:27,850 --> 00:23:31,850
gonna it's not going to take a whole lot
of major coding you just pick a language

268
00:23:31,850 --> 00:23:35,570
teacher kind of useful that you kind of
good with words you kind of like and

269
00:23:35,570 --> 00:23:40,169
look at the libraries don't reinvent the
wheel just look at the library that they

270
00:23:40,170 --> 00:23:43,760
offer a lot of people have been doing
similar stuff this for quite some time

271
00:23:43,760 --> 00:23:48,960
so it's so it's really easy to find
quality stuff out there but for this

272
00:23:48,960 --> 00:23:55,750
type of project you will get your hands
dirty you will have to write code just a

273
00:23:55,750 --> 00:24:03,000
side note there ok so now great we're
starting to ingest all these laws that a

274
00:24:03,000 --> 00:24:07,040
certain amount of time we had these
sources of truth coming in there sounds

275
00:24:07,040 --> 00:24:12,730
pretty good and we're starting to know
things but not right now all we have is

276
00:24:12,730 --> 00:24:16,920
a vat of knowledge so you have to start
targeting you have to start

277
00:24:16,920 --> 00:24:21,760
understanding what do I want to protect
and really the only way you can figure

278
00:24:21,760 --> 00:24:26,270
this out is to do a risk analysis of
your organization what are the jewels

279
00:24:26,270 --> 00:24:31,060
what are the things that your
organization cannot lose some places

280
00:24:31,060 --> 00:24:36,780
might be a database cluster some places
might be an API endpoint that has taken

281
00:24:36,780 --> 00:24:38,740
has access to particular types of data

282
00:24:38,740 --> 00:24:43,320
could be financial data on a certain
server whatever just pick your most

283
00:24:43,320 --> 00:24:48,200
important target first and then work
your way up from there so for this

284
00:24:48,200 --> 00:24:53,710
example we're just gonna pick a database
cluster maybe has some special user

285
00:24:53,710 --> 00:24:59,340
information or whatever but it's a
really important database cluster so at

286
00:24:59,340 --> 00:25:05,689
this point we need to understand what is
normality what is supposed to connect to

287
00:25:05,690 --> 00:25:11,380
the database Costa Rica certainly it
wouldn't exist unless you're using it so

288
00:25:11,380 --> 00:25:12,900
what is supposed to use it

289
00:25:12,900 --> 00:25:22,420
what connects to what where and more
importantly where's this database

290
00:25:22,420 --> 00:25:26,280
cluster what know that even is it even
distributed on where where is it

291
00:25:26,280 --> 00:25:31,200
deployed and what is supposed to happen
with it well who knows a sort of

292
00:25:31,200 --> 00:25:39,920
information these things know that so in
a scale environment generally you don't

293
00:25:39,920 --> 00:25:46,420
hand never handled the servers you had
this whole field roughly named ups I'm

294
00:25:46,420 --> 00:25:50,830
not sure many of you heard of it
probably sell and you have these these

295
00:25:50,830 --> 00:25:58,178
frameworks that basically see
configuration as code and so these these

296
00:25:58,179 --> 00:26:02,179
are the actual engines chef is super
popular answerable that sort of thing

297
00:26:02,179 --> 00:26:06,100
these are the engines there were
actually go out and take your

298
00:26:06,100 --> 00:26:14,399
configurations and deploy that onto so
it has that mapping application to note

299
00:26:14,400 --> 00:26:18,679
for you so that we can start to
understand where is this cluster even

300
00:26:18,679 --> 00:26:25,410
even deployed word watertight peas in
addition so when you deploy application

301
00:26:25,410 --> 00:26:29,920
it needs and know how to figure out
whether database cluster is and this is

302
00:26:29,920 --> 00:26:35,710
usually done through DNS and service
discovery and the Council which is the

303
00:26:35,710 --> 00:26:42,520
type of memory management system but it
has a sort of information so for example

304
00:26:42,520 --> 00:26:48,010
if a micro service has a dependency
that's where it's going to query DNS and

305
00:26:48,010 --> 00:26:51,389
there are services can be in service
discovery might come back with six IP

306
00:26:51,389 --> 00:26:55,178
for all the notes that that are
associated with it so it will just pick

307
00:26:55,179 --> 00:27:01,589
one of those notes to go to go services
in addition you might have deployed to

308
00:27:01,589 --> 00:27:06,339
the cloud or two other sorts of cloud
services the army services have their

309
00:27:06,339 --> 00:27:11,168
own API's that you can query to get this
information as well you can create these

310
00:27:11,169 --> 00:27:16,129
API's to get the IP addresses possibly
the tags that you've put on these notes

311
00:27:16,129 --> 00:27:20,609
so that you know what's going on but
that that's another source of true that

312
00:27:20,609 --> 00:27:26,299
understands how your environment setup
and finally there's always your source

313
00:27:26,299 --> 00:27:32,209
code repositories these are invaluable
and again there's that custom code thing

314
00:27:32,209 --> 00:27:37,499
so you may have to develop your own
scraper they will actually go into your

315
00:27:37,499 --> 00:27:41,859
company's repositories and look for
configuration files and with these

316
00:27:41,859 --> 00:27:46,359
configuration files you'll be able to
understand what that application once

317
00:27:46,359 --> 00:27:59,739
deployed needs to speak to so I have to
say real quick if you're lucky and your

318
00:27:59,739 --> 00:28:04,459
developers are we developing one or two
coding styles or coding languages than

319
00:28:04,459 --> 00:28:04,879
this

320
00:28:04,879 --> 00:28:09,649
scraping is relatively easy in some
environments and especially in start-up

321
00:28:09,649 --> 00:28:10,899
environments

322
00:28:10,899 --> 00:28:16,070
that's not the case is considered a
polyglot environment which means they

323
00:28:16,070 --> 00:28:20,178
basically let the developers code and
whatever they want to code in and leave

324
00:28:20,179 --> 00:28:26,019
it to everyone else to kind of pick up
the pieces in that case one thing I

325
00:28:26,019 --> 00:28:31,989
would suggest is instituting something
like a manifest file where in the in the

326
00:28:31,989 --> 00:28:36,279
root directory of all the source code
it's a machine readable file that you

327
00:28:36,279 --> 00:28:41,119
can go in and it will it will say what
dependencies it's going to need that

328
00:28:41,119 --> 00:28:45,820
sort of manifest file is very useful not
just to you but to other members of the

329
00:28:45,820 --> 00:28:52,269
organization so think about that
eventually you're going to start to see

330
00:28:52,269 --> 00:28:53,159
something like this

331
00:28:53,159 --> 00:29:00,369
this a nice dependency graph you gonna
start to understand what relies on what

332
00:29:00,369 --> 00:29:06,678
needs to call what and how it's gonna do
it I just starting to figure out this

333
00:29:06,679 --> 00:29:12,210
discovery also be thinking about how you
can automate this in the future is sure

334
00:29:12,210 --> 00:29:16,499
the first few times you might go to
manually look into how how these

335
00:29:16,499 --> 00:29:21,440
services or are discovered or how your
configuration systems deployed these

336
00:29:21,440 --> 00:29:25,619
notes but eventually you're going to
want to automate this process and I get

337
00:29:25,619 --> 00:29:32,109
to that by now now you start and how
this view of the world you start to

338
00:29:32,109 --> 00:29:36,178
understand where these nodes are
deployed and what they need to connect

339
00:29:36,179 --> 00:29:43,559
to and when they are deployed what would
systems are they depended on so now now

340
00:29:43,559 --> 00:29:47,908
you're able to have a long line like
this come in from your infrastructure

341
00:29:47,909 --> 00:29:55,259
networking equipment that said this I P
did connected this IP on the sport this

342
00:29:55,259 --> 00:30:01,080
did happen and now you have a full
dependency tree you understand what

343
00:30:01,080 --> 00:30:06,549
should happen to have what did happen
and what should be happening anything

344
00:30:06,549 --> 00:30:11,570
outside of that is your anomaly is your
investigation that's where you start to

345
00:30:11,570 --> 00:30:18,389
look into it so now we're able to start
figuring out the traffic in between the

346
00:30:18,389 --> 00:30:24,209
note we're starting to understand what
type of traffic is taking place but

347
00:30:24,210 --> 00:30:28,799
remember what I said about automation
because this view of the world become

348
00:30:28,799 --> 00:30:33,570
stale very quickly maybe even a matter
of minutes your view of the world

349
00:30:33,570 --> 00:30:39,189
changes because I'm administrator some
auto scaling outpatient changed

350
00:30:39,190 --> 00:30:43,389
everything so again that's why you gonna
automate this process this this

351
00:30:43,389 --> 00:30:47,719
discovery of your of your particular
world is gonna have to happen a lot

352
00:30:47,720 --> 00:30:54,700
ok so now we started to detect anomalies
it's at this point when you're building

353
00:30:54,700 --> 00:31:01,109
where these systems that you're going to
have to focus on false-positive houses

354
00:31:01,109 --> 00:31:04,809
are a pain to your system they're the
things that can

355
00:31:04,809 --> 00:31:10,279
kind of bring it all down and make it
unusable a false-positive is one of your

356
00:31:10,279 --> 00:31:10,899
system

357
00:31:10,899 --> 00:31:17,209
things it's an anomaly but that actually
not that actually good traffic so

358
00:31:17,210 --> 00:31:22,889
there's a couple of things you can start
to do about that first you can think

359
00:31:22,889 --> 00:31:28,209
about better query design so insidious
asking a simple question

360
00:31:28,210 --> 00:31:33,440
build your query strings with an doors
that sort of thing or take into account

361
00:31:33,440 --> 00:31:38,320
white lists so that certain things
certain edge cases are taken into

362
00:31:38,320 --> 00:31:43,850
account with generalized think about how
the query that you're asking in addition

363
00:31:43,850 --> 00:31:47,980
you can query additional services that
can tell you if that was an anomaly or

364
00:31:47,980 --> 00:31:56,289
not for example I had that database
cluster and someone SSH SSH is in which

365
00:31:56,289 --> 00:32:05,090
is a way to modify or log into a node
someone else to say well that's usually

366
00:32:05,090 --> 00:32:07,668
it's going to be an online I don't know
I don't want someone else to say to my

367
00:32:07,669 --> 00:32:12,799
database class there but if I can query
that I P figure out that I P that came

368
00:32:12,799 --> 00:32:17,889
in and look at that in a user table and
that user table is one of my system

369
00:32:17,889 --> 00:32:24,110
engineers posit goes away because he's
allowed to do that or that group is

370
00:32:24,110 --> 00:32:28,258
allowed to do that so that's one way to
do it another way to deal with it

371
00:32:28,259 --> 00:32:34,559
policy and guidelines for the humans in
your organization think about policy and

372
00:32:34,559 --> 00:32:40,580
guidelines how they construct their apps
how they develop their their their calls

373
00:32:40,580 --> 00:32:46,439
within your network for example in that
database cluster again maybe you have

374
00:32:46,440 --> 00:32:52,419
mastered slave nodes so that read access
only goes to the slave nodes but read

375
00:32:52,419 --> 00:32:58,470
rights can go to a wholly separate
cluster so in putting in policy and

376
00:32:58,470 --> 00:33:02,629
guidelines like that can help you to
normalize your traffic and by

377
00:33:02,629 --> 00:33:07,320
normalizing your traffic will cut down
on your false positives and always

378
00:33:07,320 --> 00:33:08,780
always think about blocking

379
00:33:08,780 --> 00:33:14,790
firewall iptables that sort of thing is
that they can't do it then it won't be a

380
00:33:14,790 --> 00:33:19,850
false positive blocking can be
contentious and highly skilled

381
00:33:19,850 --> 00:33:24,629
environment so you really need to be
careful with that one but it is really

382
00:33:24,630 --> 00:33:31,400
useful to get it right now we're clear
up as possible and with who we still

383
00:33:31,400 --> 00:33:38,410
have these anomalies coming in but not
all numbers are created equal

384
00:33:38,410 --> 00:33:47,310
for example take an nmap scan taken in
again onto your external notes in your

385
00:33:47,310 --> 00:33:53,340
DMZ something like that and then match
game company outside your probably

386
00:33:53,340 --> 00:33:56,949
really don't care about that there's not
much you can do about it it happens all

387
00:33:56,950 --> 00:34:02,990
the time so that's one type of anomaly
now imagine though the anomaly for gigs

388
00:34:02,990 --> 00:34:07,140
for your database cluster even to the
internet that's a wholly different type

389
00:34:07,140 --> 00:34:13,870
of anomaly so because not all anomalies
or equal the alert actions that result

390
00:34:13,870 --> 00:34:18,389
from anomalies should not be equal as
well so you have to have categories

391
00:34:18,389 --> 00:34:25,120
alert actions similar actions you might
just want to create another log that

392
00:34:25,120 --> 00:34:26,929
happen

393
00:34:26,929 --> 00:34:35,580
actions you might want to mail some may
send an IRC black slacks all the rage

394
00:34:35,580 --> 00:34:43,649
now Mason the slack message some may go
out to pager duty or or or paid you

395
00:34:43,649 --> 00:34:47,810
aren't since I'm sorry SMS and then
there's some anomalies that we really

396
00:34:47,810 --> 00:34:54,418
want just $1 to put on a pair of pants
by about take it right your house and

397
00:34:54,418 --> 00:35:00,420
wake you up I haven't really figured out
how to code this yet but it's a good way

398
00:35:00,420 --> 00:35:07,210
though now that we're starting to bring
these back into our system we're

399
00:35:07,210 --> 00:35:09,610
starting to have these alerts

400
00:35:09,610 --> 00:35:13,470
you're going to think about making your
alerts and 22 feed them back

401
00:35:13,470 --> 00:35:19,959
into your system and I think of your
alert as data because once you start to

402
00:35:19,960 --> 00:35:24,869
think of your large as data you can
start doing escalation chains and even

403
00:35:24,869 --> 00:35:28,340
killed chains so what do I mean by that

404
00:35:28,340 --> 00:35:34,220
so escalation chain maybe a certain a
certain number of anomalies only

405
00:35:34,220 --> 00:35:39,490
required mail but if I get five of those
anomalies that only requirement within

406
00:35:39,490 --> 00:35:43,729
five minutes I might want page about
that because something's off sometimes

407
00:35:43,730 --> 00:35:49,140
we're taught me that would be an alert
escalation chain and then killed change

408
00:35:49,140 --> 00:35:55,040
filters could been pretty popular lately
I killed change is defined as the

409
00:35:55,040 --> 00:35:59,830
actions that a hacker or someone
exploiting your system would need to

410
00:35:59,830 --> 00:36:05,290
take in order to get to their target and
then possibly to exit rate that target

411
00:36:05,290 --> 00:36:10,380
so what are the steps might need to come
into your network and then before me

412
00:36:10,380 --> 00:36:18,849
perform his exploitation so again this
is depending on your infrastructure you

413
00:36:18,849 --> 00:36:21,570
have to know your infrastructure to know
what it could kill chain would look like

414
00:36:21,570 --> 00:36:29,170
but maybe that you see that can that's
just a log maybe you see as usual

415
00:36:29,170 --> 00:36:34,790
logging in at a weird time just to mail
maybe see that user moving data from

416
00:36:34,790 --> 00:36:39,750
your database again that's a male but
those three actions together could form

417
00:36:39,750 --> 00:36:44,140
the beginnings of your killed chain and
as your kill chain get stripped and go

418
00:36:44,140 --> 00:36:50,500
ahead and senior page to think about
your alerts as data and then act

419
00:36:50,500 --> 00:36:51,210
accordingly

420
00:36:51,210 --> 00:36:57,500
also something that might affect your
alert level action is clearing services

421
00:36:57,500 --> 00:37:01,990
now this is different inquiry and
services to see if this is a minimally

422
00:37:01,990 --> 00:37:09,060
this is Kareem services to affect your
alert level so example again you may

423
00:37:09,060 --> 00:37:13,670
have a user who VPNs into your
datacenter and they're coming from an

424
00:37:13,670 --> 00:37:15,170
odd country

425
00:37:15,170 --> 00:37:18,380
normally that might send a page because
you're not expecting them to come from

426
00:37:18,380 --> 00:37:22,140
the country but if you can clearly some
service

427
00:37:22,140 --> 00:37:27,200
oh that users had a conference that
users registered to be on vacation or

428
00:37:27,200 --> 00:37:30,240
something like that then maybe you don't
want to be woken up in the middle of the

429
00:37:30,240 --> 00:37:35,598
night when he could from the conference
maybe just wanna get email about that

430
00:37:35,599 --> 00:37:37,130
the next day

431
00:37:37,130 --> 00:37:41,079
aquarium external services can affect
your alert level that result from your

432
00:37:41,079 --> 00:37:48,529
anomalies and now hopefully you're
building a system not just for yourself

433
00:37:48,529 --> 00:37:53,339
to use but you want to build this system
for your for operators and four people

434
00:37:53,339 --> 00:37:58,980
on your team to use as well as the real
thing that we've been talking about

435
00:37:58,980 --> 00:38:04,109
alerts and all the alerts we can
generate that sort of thing but what

436
00:38:04,109 --> 00:38:10,660
happens if one of your operators get the
same message to 10 kinds in an hour and

437
00:38:10,660 --> 00:38:14,769
then two hours later he get the same
message and it's not actionable maybe he

438
00:38:14,769 --> 00:38:18,848
gets that in maps can maybe he gets a
mail about 10 minutes can what is he

439
00:38:18,849 --> 00:38:21,529
going to do about that he's not gonna
shut down the Internet

440
00:38:21,529 --> 00:38:25,319
he's not going to go hunt down some IP
and some foreign country that it's

441
00:38:25,319 --> 00:38:31,788
scanning you so it's not actionable for
him or are your operator so why do they

442
00:38:31,789 --> 00:38:33,390
even need to know about it

443
00:38:33,390 --> 00:38:39,549
think about what alerts make it and
service to your operators because you're

444
00:38:39,549 --> 00:38:44,119
gonna wanna keep them as fresh as
possible and interested as possible and

445
00:38:44,119 --> 00:38:48,200
the alerts that surface from your system
because if they start ignoring your

446
00:38:48,200 --> 00:38:56,019
alert even have them in addition for
operators think about the user interface

447
00:38:56,019 --> 00:39:04,500
that you created for the system for
example I want my operator to

448
00:39:04,500 --> 00:39:08,960
investigate traffic between to scale
that no it's just too scared of

449
00:39:08,960 --> 00:39:15,440
applications so this application has 250
nodes and maybe this application has 200

450
00:39:15,440 --> 00:39:20,350
I'm not going to expect them to type in
all the IP's discovering type in all the

451
00:39:20,350 --> 00:39:26,779
IP's that note so think about custom
dashboard generation for them so that

452
00:39:26,780 --> 00:39:31,040
they can easily just created that for
the click of a button and it will show

453
00:39:31,040 --> 00:39:36,870
them all the traffic between those
logical grouping of notes but outside of

454
00:39:36,870 --> 00:39:42,200
that I think about other things you can
do for your free operators such as alert

455
00:39:42,200 --> 00:39:46,549
management and search so they can go in
and snooze alerts or modify them as they

456
00:39:46,550 --> 00:39:53,410
need think about the history of this is
super important so what I mean by

457
00:39:53,410 --> 00:39:56,420
history major operator

458
00:39:56,420 --> 00:40:00,750
there's a a mail came in at an anomaly
happen at three in the morning

459
00:40:00,750 --> 00:40:04,410
know this anomaly wasn't kept classified
high enough to page them but they need

460
00:40:04,410 --> 00:40:08,080
to check up on it the next day so they
come in at eight in the morning the next

461
00:40:08,080 --> 00:40:09,940
day to check on this this alert

462
00:40:09,940 --> 00:40:15,380
well the view of the world has changed
how many times in the last five hours so

463
00:40:15,380 --> 00:40:20,710
if they go investigate an anomaly now
who knows what the network looks like so

464
00:40:20,710 --> 00:40:25,270
when the anomaly happens you need to
have a snapshot of your world view that

465
00:40:25,270 --> 00:40:30,170
they can go back and investigate what
that was so providing them a history is

466
00:40:30,170 --> 00:40:36,670
really important I think about including
query tools into your user interface for

467
00:40:36,670 --> 00:40:42,430
you I think this would be like for
example the tools used to automate the

468
00:40:42,430 --> 00:40:47,520
process of discovery your network or
possibly other sorts of investigated

469
00:40:47,520 --> 00:40:51,410
just scripts and sort of things like
that that you use the simpler you can

470
00:40:51,410 --> 00:40:56,529
make this for your operators the better
and faster they'll be and also think

471
00:40:56,530 --> 00:41:00,710
about including help to be honest this
is more for you than it is for them

472
00:41:00,710 --> 00:41:04,460
because they're going to basically
asking the same questions over and over

473
00:41:04,460 --> 00:41:09,930
again as much easier if you can just put
into the help again we aren't where

474
00:41:09,930 --> 00:41:14,509
security people so we're not frontin
developers or or anything like that but

475
00:41:14,510 --> 00:41:19,000
you can make something really usable
with us with with a small amount of work

476
00:41:19,000 --> 00:41:21,560
for example I created something like
this

477
00:41:21,560 --> 00:41:26,430
using sinatra super simple lightweight
and does what it needs to do

478
00:41:26,430 --> 00:41:32,540
it doesn't need a lot of flash so now
we're starting to look pretty good right

479
00:41:32,540 --> 00:41:36,890
we are collecting all these logs are
chopping them up we understand their

480
00:41:36,890 --> 00:41:43,049
view of the world we have anomalies we
cut down on the false positives we have

481
00:41:43,050 --> 00:41:48,910
we have a good user interface for all
operators to go in so it looks pretty

482
00:41:48,910 --> 00:41:56,250
good how was it working how do you know
if you should have gotten an alert if

483
00:41:56,250 --> 00:42:00,300
you didn't get one how do you know if it
should have happened or not is your

484
00:42:00,300 --> 00:42:02,540
system working

485
00:42:02,540 --> 00:42:09,009
think about creating automated test
spots we think about creating a safe

486
00:42:09,010 --> 00:42:13,569
automated test but sweet because we're
talking about production here so you

487
00:42:13,569 --> 00:42:18,500
gonna wanna make ten spots or test
scripts that make erroneous connections

488
00:42:18,500 --> 00:42:23,660
now and then and see if your system
detects it you can even make it so that

489
00:42:23,660 --> 00:42:27,910
your system expects an erroneous
connection from these tests pots and

490
00:42:27,910 --> 00:42:32,578
since you're an alert if it doesn't see
this traffic created here so that's a

491
00:42:32,579 --> 00:42:35,000
good way to test your system

492
00:42:35,000 --> 00:42:40,410
author think about testing using scripts
to test all the different components of

493
00:42:40,410 --> 00:42:46,328
your alerts for example chef uses role
and say you have a certain amount of

494
00:42:46,329 --> 00:42:51,809
roles in your defined in your alerts
with those roles go away and no one

495
00:42:51,809 --> 00:42:56,599
tells you when you're just stuck there
so but if you have a if you have a

496
00:42:56,599 --> 00:42:59,940
script that will go in and test each
component does this still exists does

497
00:42:59,940 --> 00:43:03,609
this still exists does it still exists
then you know you still have quality

498
00:43:03,609 --> 00:43:07,950
components in your alerts you don't have
some sort of I'd cross or privileged

499
00:43:07,950 --> 00:43:09,980
creep or something like that

500
00:43:09,980 --> 00:43:16,630
whenever you have old styles always test
which you have beyond bill passed

501
00:43:16,630 --> 00:43:24,880
create tests after we're creating a
security device here so you're gonna

502
00:43:24,880 --> 00:43:30,180
have to think about the system security
line definition there is specialized

503
00:43:30,180 --> 00:43:34,618
since the data on this system that we're
building think about how you can protect

504
00:43:34,619 --> 00:43:35,000
the

505
00:43:35,000 --> 00:43:39,340
that what kind of perimeter you gonna
put around it are you gonna do user all

506
00:43:39,340 --> 00:43:44,790
are you gonna make sure everything's
encrypted that you need to his if if if

507
00:43:44,790 --> 00:43:47,900
an attacker can figure out that this is
your system that's doing anomaly

508
00:43:47,900 --> 00:43:53,360
detection and they can come in and
modify everything came over to think

509
00:43:53,360 --> 00:43:58,850
about how you can protect the system
itself after think about how robust the

510
00:43:58,850 --> 00:44:03,799
system might be if it loses one of its
database notes

511
00:44:03,800 --> 00:44:11,020
detection if it loses connection to
outside data sources and it still have a

512
00:44:11,020 --> 00:44:16,060
cached copy of its view of the world
that can still at least to some sort of

513
00:44:16,060 --> 00:44:21,210
anomaly detection until you get those
external services back online to think

514
00:44:21,210 --> 00:44:26,190
about how robust the system is and how
it can act in the absence of other

515
00:44:26,190 --> 00:44:31,260
things are so one thing also to consider
is I think about if this system can

516
00:44:31,260 --> 00:44:35,440
rebuild itself if in the absence of the
internet say you lose Internet in some

517
00:44:35,440 --> 00:44:40,580
way some dogs attack or something like
that this system Kenneth system still

518
00:44:40,580 --> 00:44:44,700
function cannot rebuild itself cannot
see its view of the world without that

519
00:44:44,700 --> 00:44:52,129
now we have all these data were
collected in where we're not we're

520
00:44:52,130 --> 00:44:57,010
checking for anomalies looking looking
pretty good but what else what else can

521
00:44:57,010 --> 00:45:01,300
you do with all this data like you have
probably one of the biggest data stores

522
00:45:01,300 --> 00:45:05,190
and sources of truth in your entire
organization what else can you do with

523
00:45:05,190 --> 00:45:12,100
all this machine learning is probably
one logical step as i've talked about

524
00:45:12,100 --> 00:45:17,460
everything we're doing now is very
targeted we did a risk analysis we know

525
00:45:17,460 --> 00:45:21,830
we want to protect we're talking in that
and protecting it but what about

526
00:45:21,830 --> 00:45:26,799
everything else this is where machine
learning can help detect anomalies that

527
00:45:26,800 --> 00:45:31,280
you're not looking for machine learning
this phone entire world

528
00:45:31,280 --> 00:45:37,090
luckily I have people on my team that
can help me out with us but it is usable

529
00:45:37,090 --> 00:45:40,170
and I would suggest looking into it

530
00:45:40,170 --> 00:45:45,059
also this system could be used by people
outside your security organization maybe

531
00:45:45,059 --> 00:45:48,869
your system engineers are you
application engineers need to understand

532
00:45:48,869 --> 00:45:54,619
when they create an application scales
out and bring down tree databases what

533
00:45:54,619 --> 00:45:58,799
happened you know what what when what
went awry or maybe your load balancers

534
00:45:58,799 --> 00:46:00,770
aren't acting like they're supposed to

535
00:46:00,770 --> 00:46:06,079
or maybe you're not you're pushing your
notifications to the internet for your

536
00:46:06,079 --> 00:46:08,710
various services aren't working
correctly

537
00:46:08,710 --> 00:46:12,770
are are these signals going out this is
like a free TCP done for your entire

538
00:46:12,770 --> 00:46:17,730
infrastructure to think about how other
P teams outside your security teams can

539
00:46:17,730 --> 00:46:23,880
use all this data and finally I I was in
law enforcement for a little bit and I

540
00:46:23,880 --> 00:46:27,430
can tell you the very first thing when
law enforcement comes in and asked asked

541
00:46:27,430 --> 00:46:34,109
where the logs so now you have them and
think about also auditors and compliance

542
00:46:34,109 --> 00:46:40,990
is now you have the ability to prove
something did or did not happen I know

543
00:46:40,990 --> 00:46:45,759
for a fact that database wasn't wasn't
touched by this group of servers you can

544
00:46:45,760 --> 00:46:52,940
prove that we're getting to the end here
and I just want to go over some of those

545
00:46:52,940 --> 00:46:59,740
questions real quick that I talked about
the first one was what goes in my trying

546
00:46:59,740 --> 00:47:05,259
to accomplish and like I said that can
only be answered if you understand your

547
00:47:05,260 --> 00:47:11,210
infrastructure and your network what are
my source the truth that will help me

548
00:47:11,210 --> 00:47:16,970
answer those goals that will help me
figure out those goals what tools

549
00:47:16,970 --> 00:47:22,770
consider the source of truth what tools
work best and modifying or analyzing

550
00:47:22,770 --> 00:47:29,420
these sources the truth what is an
anomaly so what is erroneous connections

551
00:47:29,420 --> 00:47:33,799
in your infrastructure what is supposed
to happen and was not supposed to happen

552
00:47:33,799 --> 00:47:40,930
in MI correlating My Alerts do I have a
feedback system so that my alert are now

553
00:47:40,930 --> 00:47:47,230
data and I can glean some information
from and what about user experience the

554
00:47:47,230 --> 00:47:51,380
more people you can get to use a system
that you're building a better and more

555
00:47:51,380 --> 00:47:58,220
active it will be my system robust and
secure our it's a security appliance it

556
00:47:58,220 --> 00:48:04,200
should be and then finally what else can
I do with all this data logger system

557
00:48:04,200 --> 00:48:08,149
I'm collecting all this house can the
rest of my organization take advantage

558
00:48:08,150 --> 00:48:18,369
of that conclusion I just a couple of
words I know defenses hard defense is is

559
00:48:18,369 --> 00:48:23,450
actually really difficult but but you're
the hero you are the one that gets to

560
00:48:23,450 --> 00:48:27,189
come in and save the organization you
are the game master when the hackers

561
00:48:27,190 --> 00:48:34,430
come in they're playing on your turf so
you get to set the rules once you

562
00:48:34,430 --> 00:48:39,240
understand how everything works in your
system only thing that can fail you its

563
00:48:39,240 --> 00:48:43,299
hardware and we could always get more
hardware

564
00:48:43,299 --> 00:49:44,130
keep fighting thank you

565
00:49:44,130 --> 00:50:04,090
I don't know what to do his own is
simply do not have anyone to talk

566
00:50:04,090 --> 00:50:19,570
started to my must also meet the
hospitals are not alike Unite union hall

567
00:50:19,570 --> 00:50:52,730
its linger about going on a bike that I
care about us

568
00:50:52,730 --> 00:51:09,270
you gonna call you a security guard
called the only board idea what to do or

569
00:51:09,270 --> 00:51:20,020
why you can I move out of the way must
do to today using the device so you

570
00:51:20,020 --> 00:51:33,920
think he did yes when you're shopping
when you're starting to adjust your logs

571
00:51:33,920 --> 00:51:38,990
it is true that you probably don't want
everything some some laws are very noisy

572
00:51:38,990 --> 00:51:43,759
and this is this the kind of decision
you're gonna make on the ingestion point

573
00:51:43,760 --> 00:51:50,230
that said this system like I said is
handling over with 8 notes I am

574
00:51:50,230 --> 00:51:55,870
processing over a million log lines
every 12 seconds three able to process a

575
00:51:55,870 --> 00:52:01,180
lot of data and then on the ingestion
point when you tag and pipe and

576
00:52:01,180 --> 00:52:06,060
normalize your data you're actually able
to pick and choose what you want to put

577
00:52:06,060 --> 00:52:10,290
into elasticsearch so that's a way that
you can that's the way that you can

578
00:52:10,290 --> 00:52:16,850
lower and lower the amount of logging
that your that you're doing but yes to

579
00:52:16,850 --> 00:52:20,299
your point some logs are very noisy
especially denounce logs there were

580
00:52:20,300 --> 00:52:24,380
certain type they can be very difficult
because they want to give you lots of

581
00:52:24,380 --> 00:52:31,510
extra data when are you really want his
whose roofer who asked that DNS query

582
00:52:31,510 --> 00:52:37,080
hated their beliefs on a case-by-case
basis for his log about which is how you

583
00:52:37,080 --> 00:52:42,840
do it wishes to top out but like I said
at this scale I'm doing quite a bit of

584
00:52:42,840 --> 00:52:49,040
logs and so I almost think more is
better as long as you have the storage

585
00:52:49,040 --> 00:52:55,279
space is is really my answer then

586
00:52:55,280 --> 00:53:03,070
they come out the winner with what they
did

587
00:53:03,070 --> 00:53:13,020
will be returned immediately became on
Tuesday 6:30 was a normal you see at all

588
00:53:13,020 --> 00:53:39,310
honesty I must regard to my must they
started out well I can do this Oct one

589
00:53:39,310 --> 00:53:47,740
that's good for the community college in
order to finish so I cannot continue to

590
00:53:47,740 --> 00:54:10,379
keep the question do I have any tips
with regard to visualize the data or

591
00:54:10,380 --> 00:54:14,640
creating your own alerts and and and
using outside tools to complement those

592
00:54:14,640 --> 00:54:24,580
alerts that the question

593
00:54:24,580 --> 00:54:56,140
ok always lead to a lot of time when I
used to the idea of custom code would I

594
00:54:56,140 --> 00:55:01,190
really mean is just a small blue coat
small little parts just to fill in the

595
00:55:01,190 --> 00:55:06,670
gaps that you need there is really a lot
of work being done in the incident

596
00:55:06,670 --> 00:55:12,750
response and data analysis field and so
when you go try and do it yourself too

597
00:55:12,750 --> 00:55:17,550
much you're probably not going to do it
as well as some other collective so

598
00:55:17,550 --> 00:55:22,940
always be on the lookout for for what's
been done before

599
00:55:22,940 --> 00:55:26,700
like I said all of this is built with
open source tools I work for a start-up

600
00:55:26,700 --> 00:55:32,799
so we don't have a whole lot of money to
go buy security equipment so but you can

601
00:55:32,800 --> 00:55:36,300
but there's still such great stuff out
there there's really a lot of really

602
00:55:36,300 --> 00:55:41,160
good things that have been created the
bro for example network analysis is

603
00:55:41,160 --> 00:55:48,220
amazing tool that but always look around
first before you start building is a

604
00:55:48,220 --> 00:55:52,220
chance that somebody has a nice library
or some sort of tool that does what you

605
00:55:52,220 --> 00:56:21,419
need that answers your question

606
00:56:21,420 --> 00:57:21,130
sort of the machine learning part is is
is the part actually I'm discovering a

607
00:57:21,130 --> 00:57:27,549
bit we have machine learners on my team
and right now they use they use their

608
00:57:27,549 --> 00:57:33,710
own custom code most of it since collor
to detect and to create patterns for

609
00:57:33,710 --> 00:57:40,250
spam detection and user user analysis
and that sort of thing so actually I

610
00:57:40,250 --> 00:57:44,900
can't really recommend any certain
ticular SPT libraries are things like

611
00:57:44,900 --> 00:57:52,140
that because that's more of their field
to be honest the i i i focus on the the

612
00:57:52,140 --> 00:57:57,740
targeted attack and protecting what
exactly you need to protect and I'll be

613
00:57:57,740 --> 00:58:03,799
honest what I've seen of machine
learning and one of my colleagues had to

614
00:58:03,799 --> 00:58:09,380
talk about it today it still in its
infancy it can be fooled pretty easily

615
00:58:09,380 --> 00:58:16,880
even our spam detection can be pooled 30
easily and so I wouldn't want to trust

616
00:58:16,880 --> 00:58:21,839
the crown jewels of my network to
machine learning just yet I don't think

617
00:58:21,839 --> 00:58:27,190
it's I don't think it's at that stage in
development so that's why I would always

618
00:58:27,190 --> 00:58:32,309
suggest learning your environment and
writing writing rules around which you

619
00:58:32,309 --> 00:58:33,790
need to protect

620
00:58:33,790 --> 00:58:37,200
and then with all the rest of the data
to maybe maybe to make sure there's no

621
00:58:37,200 --> 00:58:42,930
pity somehow pivoting no to know within
your network some unimportant know that

622
00:58:42,930 --> 00:58:47,129
you don't know about maybe that's what
you might use machine learning for but I

623
00:58:47,130 --> 00:58:53,950
i just dont trusted enough at this stage
to just basically put it on let the

624
00:58:53,950 --> 00:58:58,230
classifiers figure out what normal
traffic is and let them tell me what

625
00:58:58,230 --> 00:59:07,870
anomaly that classifier because from my
experience it takes a lot of a lot of

626
00:59:07,870 --> 00:59:11,890
nuanced work and a lot of testing and
you need to run tests to make sure that

627
00:59:11,890 --> 00:59:16,940
your classifier is even is even
classifying what you think it is so

628
00:59:16,940 --> 00:59:22,310
again I i just look at that is as as the
future of of a system like this is you

629
00:59:22,310 --> 00:59:27,370
can add on a machine learning component
but I i just wouldn't trust it at this

630
00:59:27,370 --> 00:59:55,130
moment completely does that answer some
of the questions

631
00:59:55,130 --> 01:01:08,370
the idea that this was mainly against
external entity because its face I'm a

632
01:01:08,370 --> 01:01:17,319
security person I don't trust really
anyone even internals so that's why I

633
01:01:17,320 --> 01:01:23,420
used for example the SSH I actually want
to know when people a cessation and so

634
01:01:23,420 --> 01:01:27,660
that's why I might go query and group to
make sure that that person is part of a

635
01:01:27,660 --> 01:01:32,920
privileged few it's allowed to do that
same with your database queries that

636
01:01:32,920 --> 01:01:36,950
your business intelligence people might
come in another thing you might think

637
01:01:36,950 --> 01:01:42,109
about is because you're logging all of
this information and you have your by

638
01:01:42,110 --> 01:01:48,270
transfers integers I actually use this
technique you can start to North you can

639
01:01:48,270 --> 01:01:52,720
start to understand what the average
user or that particular user if you can

640
01:01:52,720 --> 01:01:57,680
trace it back to a user how much data
they generally transfer so if suddenly

641
01:01:57,680 --> 01:02:03,649
this user that has transferred five megs
a date in and sequel queries

642
01:02:03,650 --> 01:02:10,230
suddenly transfers to gigs one day that
that the problem so I actually apply

643
01:02:10,230 --> 01:02:17,620
rules to everybody not just the external
hope external one and then as far as

644
01:02:17,620 --> 01:02:24,359
putting private information the club
that is its own can of worms that's

645
01:02:24,360 --> 01:02:29,880
probably bad way that's its own problem
recently the EU did away with safe

646
01:02:29,880 --> 01:02:36,680
harbor I'm not sure if he would wear
with that is that means that companies

647
01:02:36,680 --> 01:02:43,009
like web-scale companies like Facebook
and Google can't can no longer keep

648
01:02:43,010 --> 01:02:44,590
private information

649
01:02:44,590 --> 01:02:49,920
user information outside of the country
of origin so they can't bring back there

650
01:02:49,920 --> 01:02:55,150
is no safe harbor they can bring back an
EU members private information back into

651
01:02:55,150 --> 01:02:59,530
the us- so what we're going to work but
we're starting to have to do now is

652
01:02:59,530 --> 01:03:05,750
create bastions in the love of network
resources that are contained within

653
01:03:05,750 --> 01:03:12,620
whatever law that allows so for example
the German German law makes me makes us

654
01:03:12,620 --> 01:03:16,410
have to contain user information or
begin to think about putting user

655
01:03:16,410 --> 01:03:21,609
information and certain locations to put
to protect that sort of thing one thing

656
01:03:21,610 --> 01:03:28,140
I would like to mention about cloud
services is not I don't own stock on

657
01:03:28,140 --> 01:03:32,230
Amazon or anything but remember I
mentioned below is a really great great

658
01:03:32,230 --> 01:03:36,280
way of figuring out what's going between
your notes Amazon just two months ago

659
01:03:36,280 --> 01:03:42,490
released as flow between instances so
now you can actually log how your how

660
01:03:42,490 --> 01:03:45,830
your instances talk back and forth to
each other and you can apply all the

661
01:03:45,830 --> 01:03:50,950
principles I was talking about to
cloud-based notes so that's that's

662
01:03:50,950 --> 01:03:55,939
that's one really useful useful way to
figure out what you're doing in the

663
01:03:55,940 --> 01:04:03,730
cloud but personal information it's it's
it's wrong and it is completely

664
01:04:03,730 --> 01:04:08,580
dependent on the country and its rules
and how it applies to it that's why I

665
01:04:08,580 --> 01:04:10,670
also talked about the retention policy

666
01:04:10,670 --> 01:04:17,170
all of that is very dependent I we have
a full legal team that I go and I i show

667
01:04:17,170 --> 01:04:20,660
them the law that showed them those in
the log and I ask them how long can I

668
01:04:20,660 --> 01:04:26,870
keep this and so sometimes you need an
outside by about that sort of thing I

669
01:04:26,870 --> 01:04:27,750
hope that answers your question

