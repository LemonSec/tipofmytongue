1
00:00:05,189 --> 00:00:12,940
gravelly everyone my name is Jenny and I

2
00:00:09,580 --> 00:00:19,360
am very glad that you have to come to

3
00:00:12,940 --> 00:00:22,840
listen to me Toby first please let me

4
00:00:19,360 --> 00:00:26,380
introduce us Anna Anna Mae my team

5
00:00:22,840 --> 00:00:30,910
I'm Jenny and I as a security researcher

6
00:00:26,380 --> 00:00:36,010
at 360 our team I focused on Android

7
00:00:30,910 --> 00:00:38,320
system and a Guangdong hates his senior

8
00:00:36,010 --> 00:00:42,190
security researcher and team leader over

9
00:00:38,320 --> 00:00:48,929
360 our team and he focus on Android and

10
00:00:42,190 --> 00:00:52,989
grew a Badman team the man resists

11
00:00:48,929 --> 00:00:56,710
fields of our team under system security

12
00:00:52,989 --> 00:01:00,870
and groom bro browser security we have

13
00:00:56,710 --> 00:01:06,100
found more than 151 of vulnerabilities

14
00:01:00,870 --> 00:01:09,100
in Android system in August 2017 we

15
00:01:06,100 --> 00:01:15,190
submit the Perl sub sorry we sell me the

16
00:01:09,100 --> 00:01:18,130
first we work in remote exploit chain

17
00:01:15,190 --> 00:01:22,060
since the SR programmers expansion and

18
00:01:18,130 --> 00:01:26,470
we want highest rewards in the history

19
00:01:22,060 --> 00:01:31,410
of the SR we have also hacked divert

20
00:01:26,470 --> 00:01:31,410
Netaji's in developing contests

21
00:01:37,260 --> 00:01:44,920
this Zoo is evolved or discovered by us

22
00:01:42,100 --> 00:01:49,509
in the Bluetooth and you can find them

23
00:01:44,920 --> 00:01:51,610
and under the second Burton there are

24
00:01:49,510 --> 00:01:59,860
many security researchers honey amber

25
00:01:51,610 --> 00:02:03,760
twos so damned Kade is inevitable let's

26
00:01:59,860 --> 00:02:06,720
take a look at the architecture overview

27
00:02:03,760 --> 00:02:10,780
of Bluetooth for Android 7 and earlier a

28
00:02:06,720 --> 00:02:15,880
blue system service communications with

29
00:02:10,780 --> 00:02:19,300
the Bluetooth stack through J I and with

30
00:02:15,880 --> 00:02:22,840
applications through bounder IBC the

31
00:02:19,300 --> 00:02:42,100
default protists that is located in

32
00:02:22,840 --> 00:02:45,840
system PT PT the stack implements or job

33
00:02:42,100 --> 00:02:49,690
Pro totus and the generator Bruce h ere

34
00:02:45,840 --> 00:02:54,850
but under 8 Italy is a bit different

35
00:02:49,690 --> 00:02:58,660
let's have a look the latest change in

36
00:02:54,850 --> 00:03:02,230
the native produce stack between Android

37
00:02:58,660 --> 00:03:06,640
edge and the prevents burns is the use

38
00:03:02,230 --> 00:03:11,950
of a tribal vendor implementing in

39
00:03:06,640 --> 00:03:17,738
Android 8 must use hid air instead of

40
00:03:11,950 --> 00:03:20,619
lab bt vendor vendor device interact

41
00:03:17,739 --> 00:03:25,440
with Bluetooth stack using the hardware

42
00:03:20,620 --> 00:03:27,940
interface design language each idea

43
00:03:25,440 --> 00:03:31,560
divides the interface between the

44
00:03:27,940 --> 00:03:35,440
Bluetooth stack and the vendor implement

45
00:03:31,560 --> 00:03:38,590
combination if you want to learn

46
00:03:35,440 --> 00:03:45,070
difficult the details you can visit the

47
00:03:38,590 --> 00:03:48,040
Android official website so you can use

48
00:03:45,070 --> 00:03:51,010
so you can see that to process about

49
00:03:48,040 --> 00:03:54,390
bluetooth when improvements

50
00:03:51,010 --> 00:03:56,709
stags and the other implements a chair

51
00:03:54,390 --> 00:03:58,890
ju was bound or to communicate to each

52
00:03:56,709 --> 00:03:58,890
other

53
00:04:07,920 --> 00:04:15,798
the blue sedan is much like the tcp/ip

54
00:04:11,580 --> 00:04:20,519
stack standards had Harry Tector

55
00:04:15,799 --> 00:04:24,690
structure HDI is the longest layer it is

56
00:04:20,519 --> 00:04:30,360
supposed three transmission most basic

57
00:04:24,690 --> 00:04:34,530
rate enhanced dead read load energy it

58
00:04:30,360 --> 00:04:38,669
is it is implemented in H idea by many

59
00:04:34,530 --> 00:04:46,159
many temperatures the second layer is

60
00:04:38,669 --> 00:04:49,890
air to see IP logical link control and

61
00:04:46,160 --> 00:04:53,520
adaption protocol like TCP it is

62
00:04:49,890 --> 00:04:56,580
supposed various protocols application

63
00:04:53,520 --> 00:05:02,940
protocol for different functions models

64
00:04:56,580 --> 00:05:05,820
like STP PEP area zv SMP so L to say V

65
00:05:02,940 --> 00:05:08,850
and above implement in the purple stack

66
00:05:05,820 --> 00:05:18,810
I were introduced these photos

67
00:05:08,850 --> 00:05:23,040
indeed health later exam were i-ight

68
00:05:18,810 --> 00:05:26,060
ragged with using were shot with a we

69
00:05:23,040 --> 00:05:29,100
are CP packet we can easily analysis the

70
00:05:26,060 --> 00:05:36,570
communication data and every fields of

71
00:05:29,100 --> 00:05:40,320
area CP the man called pass is system PT

72
00:05:36,570 --> 00:05:42,780
the latest version hundred nine it's a

73
00:05:40,320 --> 00:05:47,599
bit different from eight and earlier

74
00:05:42,780 --> 00:05:50,969
whose code seems to be more sorry

75
00:05:47,600 --> 00:05:54,320
Android age and earlier it was compared

76
00:05:50,970 --> 00:05:59,760
to be a dynamic link library near would

77
00:05:54,320 --> 00:06:04,349
protis toward tau s o but lab Bluetooth

78
00:05:59,760 --> 00:06:07,200
doors oh and one night the target code

79
00:06:04,350 --> 00:06:15,060
I'm going to talk about later is better

80
00:06:07,200 --> 00:06:19,289
on Android 8 produced dead is embodied

81
00:06:15,060 --> 00:06:22,169
in the past system PT stack this sub

82
00:06:19,289 --> 00:06:26,568
directors are very clear and

83
00:06:22,169 --> 00:06:26,568
and implement different protocols

84
00:06:27,979 --> 00:06:35,789
Bluetooth is an overworld attack service

85
00:06:32,069 --> 00:06:38,969
and each protocol is a sub attack

86
00:06:35,789 --> 00:06:44,219
service next I merely took about four

87
00:06:38,969 --> 00:06:48,360
portals air-to-air p st p e-- IEP and

88
00:06:44,219 --> 00:06:55,919
every our CP we which have been

89
00:06:48,360 --> 00:06:59,550
discovered more vulnerabilities so first

90
00:06:55,919 --> 00:07:04,049
I will introduce air to therapy the

91
00:06:59,550 --> 00:07:08,400
frame format of air to see AP is very

92
00:07:04,050 --> 00:07:13,349
simple his header is four bytes to bad

93
00:07:08,400 --> 00:07:20,580
lands field too bad channel ID world the

94
00:07:13,349 --> 00:07:25,219
payload is best long he is CID CRE has

95
00:07:20,580 --> 00:07:32,339
two forms fixed CID and the dynamic

96
00:07:25,219 --> 00:07:35,699
allocate here's the idea fixed CID can

97
00:07:32,339 --> 00:07:39,870
be divided into four tabs also main it

98
00:07:35,699 --> 00:07:40,589
halves are divided in the code single in

99
00:07:39,870 --> 00:07:42,810
CID

100
00:07:40,589 --> 00:07:46,919
pyaari single in CID application layer

101
00:07:42,810 --> 00:07:50,180
CID and others different January

102
00:07:46,919 --> 00:07:55,430
represents differing the data channel

103
00:07:50,180 --> 00:07:55,430
processing methods our presence later

104
00:07:57,289 --> 00:08:06,889
when query when creating fixed the CRE

105
00:08:02,039 --> 00:08:09,659
so socket we have to set the value of

106
00:08:06,889 --> 00:08:14,449
structure member heir to the idea not

107
00:08:09,659 --> 00:08:14,449
air to PSM you can see that this one

108
00:08:14,659 --> 00:08:24,199
ltos the ID not l2 TSM when you create

109
00:08:19,580 --> 00:08:24,198
figures say I did it's okay

110
00:08:26,479 --> 00:08:35,779
dynamic dynamically allocated Eid is

111
00:08:31,060 --> 00:08:38,958
alkyd by using PSM when you create stock

112
00:08:35,779 --> 00:08:42,769
it and specify the value of P as am

113
00:08:38,958 --> 00:08:47,899
sorry where p RK dynamically we can use

114
00:08:42,769 --> 00:08:50,410
we can see judge PS am seems like a

115
00:08:47,899 --> 00:08:50,410
support

116
00:08:55,269 --> 00:09:08,410
we PSM seems like the port of of pcp it

117
00:09:03,610 --> 00:09:13,410
up layer upon layer protocol Devon is um

118
00:09:08,410 --> 00:09:17,290
PSM value for example SDPs PSM is one

119
00:09:13,410 --> 00:09:20,819
when create in socket using PSM we just

120
00:09:17,290 --> 00:09:25,139
save the value of the net the member of

121
00:09:20,819 --> 00:09:25,139
air to PSM

122
00:09:31,560 --> 00:09:39,329
the flowchart of air to therapy attack

123
00:09:35,459 --> 00:09:44,128
value is attack Victor is probably like

124
00:09:39,329 --> 00:09:46,378
these when when it was really packet is

125
00:09:44,129 --> 00:09:51,480
received the word be sent to the

126
00:09:46,379 --> 00:09:56,699
function air to see as he we is the air

127
00:09:51,480 --> 00:09:58,649
better based on the CID the payload will

128
00:09:56,699 --> 00:10:02,849
be passed into different handler

129
00:09:58,649 --> 00:10:07,790
function if the CID is is one in word in

130
00:10:02,850 --> 00:10:13,699
web entered process air to CID same D

131
00:10:07,790 --> 00:10:20,879
only is 5 enter air to see air to see a

132
00:10:13,699 --> 00:10:26,990
air to CBRE process 6 MD or if it is

133
00:10:20,879 --> 00:10:30,689
between 4 and survived in bogota

134
00:10:26,990 --> 00:10:34,980
corresponding reduce the function or not

135
00:10:30,689 --> 00:10:38,040
invoke other handlers okay that is the

136
00:10:34,980 --> 00:10:42,709
data processing flow I discussed some

137
00:10:38,040 --> 00:10:42,709
paths in these data processing functions

138
00:10:45,620 --> 00:10:51,050
see we twenty eighteen ninety four

139
00:10:48,959 --> 00:10:53,160
ninety is an information desk lore

140
00:10:51,050 --> 00:10:58,529
vulnerability it was found in the

141
00:10:53,160 --> 00:11:03,829
function to CIB air to Seabury process

142
00:10:58,529 --> 00:11:09,569
16 md let's have a look the augments p

143
00:11:03,829 --> 00:11:14,849
IP is its point to the package send back

144
00:11:09,569 --> 00:11:18,689
attacker so see the Lance takes same day

145
00:11:14,850 --> 00:11:24,709
in ascend from the target we can make it

146
00:11:18,689 --> 00:11:30,149
equal to air to see AP same ddic ruq

147
00:11:24,709 --> 00:11:33,839
then land certain and forty read to pass

148
00:11:30,149 --> 00:11:37,829
from the Park Hill respectively but

149
00:11:33,839 --> 00:11:40,860
without checking that the length of the

150
00:11:37,829 --> 00:11:43,609
packet if all be read beyond the

151
00:11:40,860 --> 00:11:43,610
security end

152
00:11:43,940 --> 00:11:54,590
lest we can see the lines 17

153
00:11:48,130 --> 00:11:55,640
if the CCB isn't even our the ad the El

154
00:11:54,590 --> 00:12:01,010
Cid

155
00:11:55,640 --> 00:12:07,120
and receive our CID we'll be back where

156
00:12:01,010 --> 00:12:12,520
we send back to attack her in land 23

157
00:12:07,120 --> 00:12:12,520
that is information desk Laurel haven't

158
00:12:14,620 --> 00:12:21,220
the POC is very simple we can just send

159
00:12:18,260 --> 00:12:25,430
for bias data to the target device and

160
00:12:21,220 --> 00:12:29,030
received a liquidator the past or the

161
00:12:25,430 --> 00:12:33,069
ortho symbol check if all be read the

162
00:12:29,030 --> 00:12:33,069
packs lens is enough or not

163
00:12:36,910 --> 00:12:44,600
next we need to be I live here the frame

164
00:12:40,720 --> 00:12:47,360
format of be IEP is not complicated the

165
00:12:44,600 --> 00:12:50,030
first seven piece represents film tab

166
00:12:47,360 --> 00:12:58,520
and it's a a speech the prinster

167
00:12:50,030 --> 00:13:03,530
extension the bmep a source code is

168
00:12:58,520 --> 00:13:08,650
divine five tabs from 0 to support being

169
00:13:03,530 --> 00:13:12,170
in payload is based on these tabs as

170
00:13:08,650 --> 00:13:15,980
mentioned earlier be IEP is based on air

171
00:13:12,170 --> 00:13:20,839
to see AP dynamically allocated the ID

172
00:13:15,980 --> 00:13:23,570
it uses PSM value to register the

173
00:13:20,840 --> 00:13:28,700
ability handle to the air to therapy

174
00:13:23,570 --> 00:13:33,230
layer the function the boundary is the

175
00:13:28,700 --> 00:13:35,960
IEP data and D when air to therapy

176
00:13:33,230 --> 00:13:43,520
received being later just cour biases

177
00:13:35,960 --> 00:13:47,860
handler pyramid her process in polar and

178
00:13:43,520 --> 00:13:47,860
so above when being pediatr

179
00:13:47,890 --> 00:13:51,340
it received

180
00:13:57,820 --> 00:14:08,840
in the world it was sent to into B&B

181
00:14:02,270 --> 00:14:13,550
debt and D where we go back after being

182
00:14:08,840 --> 00:14:17,840
filled that's Andy first the head header

183
00:14:13,550 --> 00:14:23,839
it were checked tap the check the tab

184
00:14:17,840 --> 00:14:28,130
failure if tab is each one core be IEP

185
00:14:23,840 --> 00:14:32,540
process counter packet to handle control

186
00:14:28,130 --> 00:14:36,710
firm it otherwise it will invoke peer in

187
00:14:32,540 --> 00:14:41,050
theater buff and ECB and the PTA appear

188
00:14:36,710 --> 00:14:52,250
and data above and the fee back to pass

189
00:14:41,050 --> 00:14:55,849
peer in better see we eat 2018 9356 was

190
00:14:52,250 --> 00:15:02,560
a dab of Reebok it was introduced by the

191
00:14:55,850 --> 00:15:05,690
patch of another bug 2017 one three two

192
00:15:02,560 --> 00:15:09,199
five seven let's have a look at the

193
00:15:05,690 --> 00:15:18,290
patch in in in the function be an EP

194
00:15:09,200 --> 00:15:23,570
debtor and at one line core OS ivory in

195
00:15:18,290 --> 00:15:30,040
function B BT a plant-eater path and

196
00:15:23,570 --> 00:15:33,980
easy back has removed order OS ivory

197
00:15:30,040 --> 00:15:37,670
then less knowledge what's wrong with

198
00:15:33,980 --> 00:15:45,260
this pack patch and how its introduced

199
00:15:37,670 --> 00:15:49,520
new vulnerability in fact simbiani

200
00:15:45,260 --> 00:15:52,960
pediatr nd outer hander being a header

201
00:15:49,520 --> 00:15:59,420
it work or the function pointer P

202
00:15:52,960 --> 00:16:03,950
theater buff CB which point function TN

203
00:15:59,420 --> 00:16:06,490
better path and ECB other after the end

204
00:16:03,950 --> 00:16:10,970
core OS I

205
00:16:06,490 --> 00:16:18,410
three let's take a look as a function pn

206
00:16:10,970 --> 00:16:21,470
debtor can get her path and d c-- be in

207
00:16:18,410 --> 00:16:27,230
function p and data path in and ECB

208
00:16:21,470 --> 00:16:34,430
there are several players that core OSI

209
00:16:27,230 --> 00:16:37,700
three I chose the tracker 7017 land

210
00:16:34,430 --> 00:16:44,920
seventeen in order to do this we need to

211
00:16:37,700 --> 00:16:46,670
meet the condition of land edge and nine

212
00:16:44,920 --> 00:16:50,839
SRC UUID

213
00:16:46,670 --> 00:16:56,719
is contriver so it is easy to to pass

214
00:16:50,840 --> 00:17:01,220
the check TST TST TST is also a conveyer

215
00:16:56,720 --> 00:17:04,880
patch land forty used land fourteen used

216
00:17:01,220 --> 00:17:09,890
DST to found a remote device connection

217
00:17:04,880 --> 00:17:13,640
so DST must be the real a real attackers

218
00:17:09,890 --> 00:17:17,240
device or twist therefore we need a

219
00:17:13,640 --> 00:17:23,920
bluetooth device whose address mr. limit

220
00:17:17,240 --> 00:17:23,920
of of line 9 after other other land

221
00:17:24,910 --> 00:17:31,790
seventeen aware returned after land

222
00:17:28,700 --> 00:17:34,850
seventeen OS ivory it were written back

223
00:17:31,790 --> 00:17:43,010
being in theater and II and also ivory

224
00:17:34,850 --> 00:17:46,659
coral ivory again that is double free we

225
00:17:43,010 --> 00:17:50,570
can go on looking at twenty line 22

226
00:17:46,660 --> 00:17:56,410
invoked function pointer pan PN debtor

227
00:17:50,570 --> 00:18:00,710
bath and ECB which points be a PT a pan

228
00:17:56,410 --> 00:18:06,890
better path and easy back let's have a

229
00:18:00,710 --> 00:18:11,630
look dysfunction yes that is the

230
00:18:06,890 --> 00:18:14,440
function which removed all the OS ivory

231
00:18:11,630 --> 00:18:19,280
color in the past mentioned before

232
00:18:14,440 --> 00:18:22,030
remove them remove them here meaningless

233
00:18:19,280 --> 00:18:22,030
isn't it

234
00:18:23,140 --> 00:18:29,660
actually the debtor pan theater buff and

235
00:18:27,070 --> 00:18:32,620
easy back is not cord

236
00:18:29,660 --> 00:18:36,170
it's not called by being EP debtor

237
00:18:32,620 --> 00:18:39,739
directory but instead occurs of PA and

238
00:18:36,170 --> 00:18:42,920
debtor bath and ECB first I don't know

239
00:18:39,740 --> 00:18:53,090
if the engineer who developed the patch

240
00:18:42,920 --> 00:18:56,270
and or implied the patch think so to

241
00:18:53,090 --> 00:19:00,620
track the back at least to be angry

242
00:18:56,270 --> 00:19:05,260
packet need to be sent sent a contour is

243
00:19:00,620 --> 00:19:09,199
have a looked cozy send a control frame

244
00:19:05,260 --> 00:19:12,770
since the concur frame first using

245
00:19:09,200 --> 00:19:16,120
career spear and using the correct

246
00:19:12,770 --> 00:19:21,100
Pierre and UID to set up a connection

247
00:19:16,120 --> 00:19:24,469
first then send a being in debtor better

248
00:19:21,100 --> 00:19:26,980
from it to track it up to Tiger the top

249
00:19:24,470 --> 00:19:26,980
of Reebok

250
00:19:33,940 --> 00:19:42,490
this is my partner views a bad patch

251
00:19:37,120 --> 00:19:46,540
before patch have you mastered the code

252
00:19:42,490 --> 00:19:55,570
relevant code after patch whether the

253
00:19:46,540 --> 00:19:59,560
patch has been tested enough then our

254
00:19:55,570 --> 00:20:04,240
talk about a reality the frame for

255
00:19:59,560 --> 00:20:08,889
format of a velocity it is sadly more

256
00:20:04,240 --> 00:20:15,310
complicated the header lens is 9 the

257
00:20:08,890 --> 00:20:19,690
first code PU or because PD you para

258
00:20:15,310 --> 00:20:22,960
melons and prevail are important when

259
00:20:19,690 --> 00:20:31,240
hounding bands we can analysis with with

260
00:20:22,960 --> 00:20:35,520
Wireshark a bar CP Divine's 5 of course

261
00:20:31,240 --> 00:20:40,450
but when adding the code the men

262
00:20:35,520 --> 00:20:46,480
constant is 3 link Sarah's ex third

263
00:20:40,450 --> 00:20:50,910
arrow there are x7 c0x debrief pixel

264
00:20:46,480 --> 00:20:59,530
suppose for versions that the board is

265
00:20:50,910 --> 00:21:03,010
1.6 1.4 a recipe supposed to most

266
00:20:59,530 --> 00:21:07,240
controller and target the communication

267
00:21:03,010 --> 00:21:10,390
each other on to device the source code

268
00:21:07,240 --> 00:21:16,270
of controller is in file a we are see

269
00:21:10,390 --> 00:21:25,470
parse City turn CC an attack it in a VAR

270
00:21:16,270 --> 00:21:30,720
c pass key G don't see see a way RC p

271
00:21:25,470 --> 00:21:35,440
was introduced in Android 8 but it was

272
00:21:30,720 --> 00:21:41,320
refactored we factored on and when I so

273
00:21:35,440 --> 00:21:44,950
here I just britain's and will it only

274
00:21:41,320 --> 00:21:45,730
introduce the attack factor of over the

275
00:21:44,950 --> 00:21:49,080
target

276
00:21:45,730 --> 00:21:53,320
the controller is similar to these

277
00:21:49,080 --> 00:21:56,949
hander functioning handle RC mentor BCG

278
00:21:53,320 --> 00:22:00,730
CMD is the main entry to handle away our

279
00:21:56,950 --> 00:22:06,999
CP data then pass the message to every

280
00:22:00,730 --> 00:22:13,720
RC pass command and anywhere check the

281
00:22:06,999 --> 00:22:21,899
OB code 0 0 XL 0 pass data to air as he

282
00:22:13,720 --> 00:22:28,059
passed vendors MD or Gerald a77 see

283
00:22:21,899 --> 00:22:36,039
since you ever see pass pass pass th are

284
00:22:28,059 --> 00:22:40,240
you and zinc or and or 0 X double F in

285
00:22:36,039 --> 00:22:47,950
folk ever see purse proteins MD data

286
00:22:40,240 --> 00:22:52,809
person follow is possible legacies see

287
00:22:47,950 --> 00:22:55,980
we 2017 1 3 2 8 1 is a very interested

288
00:22:52,809 --> 00:22:58,178
in stack over stack crushin

289
00:22:55,980 --> 00:23:03,940
vulnerability I discovered it's a

290
00:22:58,179 --> 00:23:07,240
function a VAR c pass proteins MD let's

291
00:23:03,940 --> 00:23:11,200
have a look I mean to keep you mean sir

292
00:23:07,240 --> 00:23:17,139
he missed it point to the farc browsing

293
00:23:11,200 --> 00:23:21,999
profile data sent by a tiger P buff is

294
00:23:17,139 --> 00:23:30,549
its point to array on the stack whose

295
00:23:21,999 --> 00:23:33,369
length is 500 and sheriff line for reads

296
00:23:30,549 --> 00:23:42,360
of PD you from the packet when it is

297
00:23:33,369 --> 00:23:48,570
well it is equal to ling 0x80

298
00:23:42,360 --> 00:23:53,168
go to the land 17 1 night lighting and

299
00:23:48,570 --> 00:23:59,350
the 19th with real to bass from the

300
00:23:53,169 --> 00:24:02,100
packet and and then into str land so str

301
00:23:59,350 --> 00:24:02,100
lane is contriver

302
00:24:02,640 --> 00:24:15,220
land 20 20 21 and 22 and 23

303
00:24:09,690 --> 00:24:18,700
if Pavle is bigger than str a favela is

304
00:24:15,220 --> 00:24:25,780
as anna - as Charlane water in

305
00:24:18,700 --> 00:24:31,350
incredible code if it's Carolyn is 1,000

306
00:24:25,780 --> 00:24:35,410
the bubbling is also is also as end to

307
00:24:31,350 --> 00:24:39,520
poverty is also as end to 1000 and then

308
00:24:35,410 --> 00:24:47,890
Kobe you went out in the bath into array

309
00:24:39,520 --> 00:24:50,260
of a 512 stack over lo the check of the

310
00:24:47,890 --> 00:24:55,090
check over 22 is meaningless

311
00:24:50,260 --> 00:24:57,400
in addition almost all case front

312
00:24:55,090 --> 00:25:04,389
branches have experienced the

313
00:24:57,400 --> 00:25:05,700
vulnerabilities the path of this pack is

314
00:25:04,390 --> 00:25:09,100
very simple

315
00:25:05,700 --> 00:25:17,260
correct compare comparison Pavlin and

316
00:25:09,100 --> 00:25:20,980
STR STR STR Lane in controller and

317
00:25:17,260 --> 00:25:24,400
target hinders their load of switch-case

318
00:25:20,980 --> 00:25:32,380
bronty's and of course a lot of critical

319
00:25:24,400 --> 00:25:37,120
bugs the last protocol our introduced is

320
00:25:32,380 --> 00:25:41,050
SDP it's frame format is simple Pfaff

321
00:25:37,120 --> 00:25:49,989
pass header and his pillows it's based

322
00:25:41,050 --> 00:25:53,649
on the PDU s DB divan 7p do tabs 3/4

323
00:25:49,990 --> 00:26:00,880
request and 3/4 response and more and

324
00:25:53,650 --> 00:26:04,050
1/4 arrows response code lock PT SD b is

325
00:26:00,880 --> 00:26:10,740
also based on air to see a dynamic

326
00:26:04,050 --> 00:26:13,930
allocate allocated CID it use is TSM to

327
00:26:10,740 --> 00:26:14,770
register the STB handler to the air to

328
00:26:13,930 --> 00:26:19,630
therapy layer

329
00:26:14,770 --> 00:26:22,450
the function is SDV debtor Andy when it

330
00:26:19,630 --> 00:26:29,710
was therapy receive SD be better just go

331
00:26:22,450 --> 00:26:32,740
behind his handler attack vector of SD

332
00:26:29,710 --> 00:26:37,289
be instead of Ward 4 replaced for

333
00:26:32,740 --> 00:26:42,640
requested her for STP hand handle and

334
00:26:37,289 --> 00:26:47,289
req & st bede ASC server SS r SP for

335
00:26:42,640 --> 00:26:51,340
spawns later in in function f DV hunt

336
00:26:47,289 --> 00:26:55,750
handle and ru q 4 different handlers

337
00:26:51,340 --> 00:26:59,789
according to differ in a PD you the same

338
00:26:55,750 --> 00:27:05,830
at function STP gassy server response

339
00:26:59,789 --> 00:27:15,240
for example if PDU is for process

340
00:27:05,830 --> 00:27:21,070
service attr ruq will be invoked say we

341
00:27:15,240 --> 00:27:24,279
2020 1894 78 it's a memory cooperation

342
00:27:21,070 --> 00:27:28,418
vulnerability caused by integer overflow

343
00:27:24,279 --> 00:27:33,520
it was found in function process service

344
00:27:28,419 --> 00:27:39,070
80 gr req to track the back we need to

345
00:27:33,520 --> 00:27:46,799
send at least 2 SD b packet let's take a

346
00:27:39,070 --> 00:27:46,799
look and the buggy code admins p p ru q

347
00:27:46,860 --> 00:27:57,120
point to the debtor send back retractor

348
00:27:50,070 --> 00:28:05,200
line 6 Lansing's reading the data from p

349
00:27:57,120 --> 00:28:08,918
ru q to initialize attr seq line 9 in

350
00:28:05,200 --> 00:28:12,760
the first in the first packet we make

351
00:28:08,919 --> 00:28:19,289
this batch of our P Rho equal to 0 then

352
00:28:12,760 --> 00:28:19,289
go then go to land 13

353
00:28:22,179 --> 00:28:30,999
attr obviously it is initialized to zero

354
00:28:25,950 --> 00:28:35,679
lands line 16 from the fund attributed

355
00:28:30,999 --> 00:28:41,529
from s from s DB DB database based on

356
00:28:35,679 --> 00:28:45,789
contriver forever a TDR seq so we can

357
00:28:41,529 --> 00:28:53,679
think that P edit er is in directory

358
00:28:45,789 --> 00:28:58,389
conveyor from LA 18 so from 18 so we can

359
00:28:53,679 --> 00:29:01,179
see that REM Len is also a conveyor we

360
00:28:58,389 --> 00:29:01,658
met a small value to meet a condition of

361
00:29:01,179 --> 00:29:11,950
life

362
00:29:01,659 --> 00:29:16,360
laughs 25 then SDP birth pattern it attr

363
00:29:11,950 --> 00:29:24,090
be entry where B occurred let's have a

364
00:29:16,360 --> 00:29:29,729
look at this function first first cord

365
00:29:24,090 --> 00:29:37,840
admins always say it is zero mentioned

366
00:29:29,730 --> 00:29:41,999
earlier LAN LAN 11 look like 11 at 80

367
00:29:37,840 --> 00:29:45,100
Ireland sub always it is less than learn

368
00:29:41,999 --> 00:29:50,470
so venerable one or ever learned to

369
00:29:45,100 --> 00:29:55,590
Korpi is as an 280 Charlane with the

370
00:29:50,470 --> 00:29:59,470
first packet then go to land 16

371
00:29:55,590 --> 00:30:02,470
obviously add learn to quirky and as an

372
00:29:59,470 --> 00:30:05,080
it we deserve that is so over there is

373
00:30:02,470 --> 00:30:10,990
as an Judah edge are aligned with the

374
00:30:05,080 --> 00:30:14,199
first packet average the first package

375
00:30:10,990 --> 00:30:18,119
was hand over sin the sin in the second

376
00:30:14,200 --> 00:30:18,119
packet let's go back the color

377
00:30:21,870 --> 00:30:34,750
line 9 in the second packet we make this

378
00:30:27,549 --> 00:30:37,150
bad - - not zero then attr edit here are

379
00:30:34,750 --> 00:30:43,179
always it was not

380
00:30:37,150 --> 00:30:46,090
we're not changed land 616 found a new

381
00:30:43,179 --> 00:30:49,510
attribute land 16 find a new attribute

382
00:30:46,090 --> 00:30:53,980
by the second packet LAN 18

383
00:30:49,510 --> 00:30:57,760
I am learn is contriver we make it's a

384
00:30:53,980 --> 00:31:00,669
big one in the second packet because

385
00:30:57,760 --> 00:31:05,590
because 80 gr obviously is assigned to

386
00:31:00,669 --> 00:31:13,020
value it's it's not it's not zero so it

387
00:31:05,590 --> 00:31:19,480
will go to land 26 2027 core STV you

388
00:31:13,020 --> 00:31:23,668
pure passer attributes entry again so

389
00:31:19,480 --> 00:31:27,490
let's have a look at the function again

390
00:31:23,669 --> 00:31:29,980
and the second time I came in the P akka

391
00:31:27,490 --> 00:31:33,520
means obviously it is equal to 80

392
00:31:29,980 --> 00:31:34,830
garland found with the first target line

393
00:31:33,520 --> 00:31:38,770
6

394
00:31:34,830 --> 00:31:44,909
attr learn give the new attribute lens

395
00:31:38,770 --> 00:31:49,480
by second target so go to the land 11

396
00:31:44,910 --> 00:31:53,380
ltd ireland sub o visit and compare with

397
00:31:49,480 --> 00:31:56,280
lane and give them manner one what if

398
00:31:53,380 --> 00:32:00,150
what if Eddie Ireland is less than

399
00:31:56,280 --> 00:32:05,879
obvious tell the baggala integer

400
00:32:00,150 --> 00:32:09,580
overflow but that is on zani in the 16

401
00:32:05,880 --> 00:32:14,679
menos on sand in the 16 and compared to

402
00:32:09,580 --> 00:32:20,590
on zani in 16 was the back so let's take

403
00:32:14,679 --> 00:32:23,290
a look at a small case compare the small

404
00:32:20,590 --> 00:32:26,909
case with compare the small case with

405
00:32:23,290 --> 00:32:32,340
GCC and salon get the same result

406
00:32:26,910 --> 00:32:34,929
negative 2 less the december lee code

407
00:32:32,340 --> 00:32:40,238
compared with

408
00:32:34,929 --> 00:32:45,009
so it's 32 bits with registers and using

409
00:32:40,239 --> 00:32:48,899
je je p instruction that is to say

410
00:32:45,009 --> 00:32:56,559
compared on - P - Lane we stand into

411
00:32:48,899 --> 00:33:02,978
integer sure negative 2 is less than 16

412
00:32:56,559 --> 00:33:05,678
so whenever whenever 2 is equal to

413
00:33:02,979 --> 00:33:10,299
resolve that negative to convert-- to

414
00:33:05,679 --> 00:33:16,869
convert-- bias as says t why is this

415
00:33:10,299 --> 00:33:19,539
I can't found the convergence about

416
00:33:16,869 --> 00:33:23,080
Jesus en si Lang but I've only in

417
00:33:19,539 --> 00:33:26,859
Microsoft OBS because of the time I

418
00:33:23,080 --> 00:33:31,149
don't talk about every very every Klaus

419
00:33:26,859 --> 00:33:34,629
just to directly to the last code that's

420
00:33:31,149 --> 00:33:40,718
the way if the operands are not tab or

421
00:33:34,629 --> 00:33:46,809
are not for floats are not on that law

422
00:33:40,719 --> 00:33:52,269
and and not long the complier convert

423
00:33:46,809 --> 00:33:58,599
them into in tab okay let's go by the

424
00:33:52,269 --> 00:34:04,089
back hole ATT Ireland and obviously are

425
00:33:58,599 --> 00:34:07,570
not are you in 16 so or converted to int

426
00:34:04,089 --> 00:34:14,909
winds up from the idea we can also see

427
00:34:07,570 --> 00:34:20,940
that compared compared with an integer

428
00:34:14,909 --> 00:34:24,879
using air tea instruction therefore if

429
00:34:20,940 --> 00:34:28,299
attr then from the second packet is la

430
00:34:24,879 --> 00:34:31,538
is less than the first one learn to copy

431
00:34:28,299 --> 00:34:35,168
learn to copy where B as an a negative

432
00:34:31,539 --> 00:34:39,929
value convert to when it was converted

433
00:34:35,168 --> 00:34:43,739
to SAS T a very big value so memory copy

434
00:34:39,929 --> 00:34:43,740
will be over vlog

435
00:34:47,199 --> 00:34:53,419
to complete POC

436
00:34:49,730 --> 00:34:55,730
you knew to say send to SVP packets in

437
00:34:53,420 --> 00:34:58,430
order to track the path to bag the lens

438
00:34:55,730 --> 00:35:01,370
of the attribute obtained from the first

439
00:34:58,430 --> 00:35:04,390
packet it's greater than second and is

440
00:35:01,370 --> 00:35:09,529
it is necessary to process the contour

441
00:35:04,390 --> 00:35:13,520
other data so it's can if it can

442
00:35:09,530 --> 00:35:19,720
establish the correct state and pass the

443
00:35:13,520 --> 00:35:24,460
checks in the code when a row Marable

444
00:35:19,720 --> 00:35:28,549
RUC hander is the debtor of its sales

445
00:35:24,460 --> 00:35:32,660
it's better that effects effects the

446
00:35:28,550 --> 00:35:38,300
length of the attribute in in say in the

447
00:35:32,660 --> 00:35:45,170
first packet RUC hander is is zero

448
00:35:38,300 --> 00:35:48,470
things 100h so let's have a look at the

449
00:35:45,170 --> 00:35:55,190
second packet in the second packet are

450
00:35:48,470 --> 00:35:59,180
easy hander was 0 X 1 0 3 to make to

451
00:35:55,190 --> 00:36:03,320
make integer overflow you are interested

452
00:35:59,180 --> 00:36:06,200
in the POC you can read the POC code

453
00:36:03,320 --> 00:36:13,010
from Mac in hub I will not explain in

454
00:36:06,200 --> 00:36:16,370
detail here earlier I introduce some of

455
00:36:13,010 --> 00:36:19,700
the bias I found so how did I found this

456
00:36:16,370 --> 00:36:22,580
box our bars are discovered so called

457
00:36:19,700 --> 00:36:27,040
eating well or didn't close combat

458
00:36:22,580 --> 00:36:31,490
protocol practice and vulnerability tabs

459
00:36:27,040 --> 00:36:35,779
for memory compression back I focus on

460
00:36:31,490 --> 00:36:40,009
TR we form a person code passing code

461
00:36:35,780 --> 00:36:42,500
those are more prone to problems for

462
00:36:40,010 --> 00:36:45,980
information disclosed disc lore of bugs

463
00:36:42,500 --> 00:36:49,610
just focus on these penguins these

464
00:36:45,980 --> 00:36:55,630
functions which send data back to

465
00:36:49,610 --> 00:36:58,670
attacker and the back facing but tracing

466
00:36:55,630 --> 00:37:00,180
Bluetooth there is different to give

467
00:36:58,670 --> 00:37:02,910
God's too fast

468
00:37:00,180 --> 00:37:06,779
beforehand or fasting better need to

469
00:37:02,910 --> 00:37:10,049
need to establish connection conveying

470
00:37:06,779 --> 00:37:15,059
some parents and initialize a correct

471
00:37:10,049 --> 00:37:17,549
state as long as well as any state is

472
00:37:15,059 --> 00:37:21,119
wrong you need to restart the con

473
00:37:17,549 --> 00:37:24,420
connection in addition a lot of protocol

474
00:37:21,119 --> 00:37:29,190
used state machine to ensure that data

475
00:37:24,420 --> 00:37:31,049
is first in the correct order any status

476
00:37:29,190 --> 00:37:36,180
arrow the connection will be

477
00:37:31,049 --> 00:37:37,849
disconnected the third path is it's a

478
00:37:36,180 --> 00:37:47,009
very infection

479
00:37:37,849 --> 00:37:50,849
every agent how to fund new attack

480
00:37:47,010 --> 00:37:54,869
service and vectors we need to fill out

481
00:37:50,849 --> 00:37:58,559
on the stat co-star code looking for

482
00:37:54,869 --> 00:38:02,099
looking for a new for protocol or

483
00:37:58,559 --> 00:38:08,660
profiles based on the new channel ID P

484
00:38:02,099 --> 00:38:14,609
or GSM we factor it code actually

485
00:38:08,660 --> 00:38:18,440
Android 9 has refactored some code new

486
00:38:14,609 --> 00:38:26,000
fields tabs new processing function and

487
00:38:18,440 --> 00:38:26,000
is that any way to research purpose SOC

488
00:38:27,740 --> 00:38:33,740
in addition to these vulnerabilities I

489
00:38:30,750 --> 00:38:37,890
also found some some other security

490
00:38:33,740 --> 00:38:40,558
risks related to the design first

491
00:38:37,890 --> 00:38:43,348
attacker can make connections with the

492
00:38:40,559 --> 00:38:46,710
target device without any user

493
00:38:43,349 --> 00:38:50,039
interaction and other otherwise even as

494
00:38:46,710 --> 00:38:53,849
a code show above other crew after

495
00:38:50,039 --> 00:38:56,880
creating a socket to target device and

496
00:38:53,849 --> 00:39:02,980
sending theater to send data to the

497
00:38:56,880 --> 00:39:05,530
target device directory second

498
00:39:02,980 --> 00:39:08,880
the attackers death can reach the

499
00:39:05,530 --> 00:39:11,950
response process branch of Apple stack

500
00:39:08,880 --> 00:39:14,770
even if the target device does not send

501
00:39:11,950 --> 00:39:19,060
any requests in forged amber

502
00:39:14,770 --> 00:39:21,490
both a with TTP and the G ATT have this

503
00:39:19,060 --> 00:39:26,589
problem the data processing pass is

504
00:39:21,490 --> 00:39:34,598
judged only best under feared that the

505
00:39:26,589 --> 00:39:36,009
attacker can counter in response to

506
00:39:34,599 --> 00:39:38,790
these issues

507
00:39:36,010 --> 00:39:40,530
I've made some poster suggestions for

508
00:39:38,790 --> 00:39:43,599
improvement

509
00:39:40,530 --> 00:39:46,690
authentication should be applied when

510
00:39:43,599 --> 00:39:49,990
applying the up when applying the upper

511
00:39:46,690 --> 00:39:52,300
layer connection check whether the

512
00:39:49,990 --> 00:39:55,839
device has sent the corresponding

513
00:39:52,300 --> 00:39:59,800
request before posting the response data

514
00:39:55,839 --> 00:40:03,430
all of these problems include some other

515
00:39:59,800 --> 00:40:11,849
risky easiest I have reported to endorse

516
00:40:03,430 --> 00:40:15,060
secure team so okay let's make a

517
00:40:11,849 --> 00:40:18,700
conclusion this talk I introduce the

518
00:40:15,060 --> 00:40:22,270
Bluetooth architecture Brutus tag and a

519
00:40:18,700 --> 00:40:25,140
profess the SAP attack service service

520
00:40:22,270 --> 00:40:31,240
and the Victor's the series founded on

521
00:40:25,140 --> 00:40:35,799
Brutus Brutus portables and the Provos

522
00:40:31,240 --> 00:40:39,069
and the POCs how to also talk about how

523
00:40:35,800 --> 00:40:44,619
to find the paths and new attack service

524
00:40:39,069 --> 00:40:51,000
and vectors to and risky design is used

525
00:40:44,619 --> 00:40:54,430
and other improvements sense or

526
00:40:51,000 --> 00:40:57,849
colleagues at our team I have uploaded

527
00:40:54,430 --> 00:41:00,700
this POC to make it hub if you are

528
00:40:57,849 --> 00:41:02,460
interested you can click from the from

529
00:41:00,700 --> 00:41:06,480
it

530
00:41:02,460 --> 00:41:09,550
hey the rubber burns used in this talk

531
00:41:06,480 --> 00:41:12,329
so thank you thank you for listening

532
00:41:09,550 --> 00:41:12,329
thank you

