1
00:00:06,260 --> 00:00:08,240
so welcome everybody a

2
00:00:08,240 --> 00:00:12,420
modularity and I will talk about AP file
formats do in those exact word-for-word

3
00:00:12,420 --> 00:00:15,469
and I'm the author over website call
core committee

4
00:00:15,469 --> 00:00:19,369
where I share my reverse engineering
experiments and I try also to to visual

5
00:00:19,369 --> 00:00:20,300
documentations

6
00:00:20,300 --> 00:00:24,560
so the agenda for today I start with the
easy introduction

7
00:00:24,560 --> 00:00:28,619
explaining what's to pee and then what
there are problems about it

8
00:00:28,619 --> 00:00:32,650
and what was my approach to tackle the
problem then stepping up

9
00:00:32,650 --> 00:00:36,019
just an overview of the p5 from it and
then

10
00:00:36,019 --> 00:00:39,150
I'll enumerate a few basic tricks that
maybe you must've

11
00:00:39,150 --> 00:00:43,830
you have heard of and ends it show some
new tricks so

12
00:00:43,830 --> 00:00:48,750
ok to speak about b5 for much keys which
is portable executable file format which

13
00:00:48,750 --> 00:00:49,610
is based on

14
00:00:49,610 --> 00:00:54,019
the common object file format from UNIX
so

15
00:00:54,019 --> 00:00:58,879
apps use

16
00:00:58,879 --> 00:01:03,199
slide she's

17
00:01:03,199 --> 00:01:08,020
sorry well

18
00:01:08,020 --> 00:01:12,229
missing slates ok it is missing flight
weird that's very bad start

19
00:01:12,229 --> 00:01:15,509
her so the and be fights

20
00:01:15,509 --> 00:01:18,600
are used over everywhere in the in
Windows

21
00:01:18,600 --> 00:01:21,600
where there it's for executables
libraries drivers

22
00:01:21,600 --> 00:01:25,829
ActiveX and whatever and other day are
many who I mean thousands of them

23
00:01:25,829 --> 00:01:29,899
in overall the system for many functions
so for example this is an example of

24
00:01:29,899 --> 00:01:31,810
order dealers-tata loaded on this

25
00:01:31,810 --> 00:01:36,359
freshly installed Windows seven and it's
not just use for executables

26
00:01:36,359 --> 00:01:39,619
but it's also used Bove for data storing

27
00:01:39,619 --> 00:01:42,710
storage because move your resources in a
pee file format

28
00:01:42,710 --> 00:01:46,579
are you can very easily via three APA
calls access to resources

29
00:01:46,579 --> 00:01:49,729
so the new Windows system is using them
everywhere

30
00:01:49,729 --> 00:01:52,729
whether it's for icons or first

31
00:01:52,729 --> 00:01:56,310
string for localization or even keyboard
layouts

32
00:01:56,310 --> 00:02:00,560
so did those fights or disk examples of
eyes don't have code

33
00:02:00,560 --> 00:02:04,630
but they are you stimpy fights and they
are used in the window system

34
00:02:04,630 --> 00:02:08,630
a so basically the AP file is really do
windows

35
00:02:08,630 --> 00:02:12,430
any universal windows binary whether
it's for executables

36
00:02:12,430 --> 00:02:16,180
or for the tie and everything and it's
been so since 1993

37
00:02:16,180 --> 00:02:19,710
defies his even used in all the systems
like x-box

38
00:02:19,710 --> 00:02:23,280
if I boot and other Windows CE but I
don't cover them

39
00:02:23,280 --> 00:02:27,500
I discovered new windows for the windows
part so

40
00:02:27,500 --> 00:02:30,560
if you need the nother introduction

41
00:02:30,560 --> 00:02:34,070
a gentle introduction to do P fight for
what I made a poster

42
00:02:34,070 --> 00:02:37,290
at that address the it's been quite so

43
00:02:37,290 --> 00:02:41,130
were received thirty thousand dollar
loans I really think it's available in

44
00:02:41,130 --> 00:02:42,090
eight languages

45
00:02:42,090 --> 00:02:46,990
and I just made myself a simple P a no
show and dissect and explain

46
00:02:46,990 --> 00:02:50,970
the loading process and everything not
too complex puts

47
00:02:50,970 --> 00:02:54,250
free if you're interested to download
print it yourself

48
00:02:54,250 --> 00:02:57,310
so the problem is dot

49
00:02:57,310 --> 00:03:00,840
Microsoft has an official documentation
but

50
00:03:00,840 --> 00:03:04,030
is documentation is extremely small re
six in San

51
00:03:04,030 --> 00:03:08,670
at best it's can be said seen as a
gentle guy to explain to stand RP's

52
00:03:08,670 --> 00:03:12,440
which means it has a very weird a way to
explain things

53
00:03:12,440 --> 00:03:15,470
based on the section names which are
absurdity not relevant

54
00:03:15,470 --> 00:03:19,450
which means a as soon as you have a
simply must formed

55
00:03:19,450 --> 00:03:23,060
peas then the stock is quite useless and
I'm not talking about

56
00:03:23,060 --> 00:03:26,450
advancement formation so it's really
down

57
00:03:26,450 --> 00:03:29,880
other documentations naturally butts
this document dishes is

58
00:03:29,880 --> 00:03:33,250
a shame I don't know have its

59
00:03:33,250 --> 00:03:36,500
far from complete so the problems that
it creates his doubts

60
00:03:36,500 --> 00:03:40,170
well first with some small law firm
operation you can trust us.

61
00:03:40,170 --> 00:03:45,080
are you can crush security tools so for
example that scored a security crushing

62
00:03:45,080 --> 00:03:48,820
on a fight with the weird image-based
but it or does five work

63
00:03:48,820 --> 00:03:53,920
but pecan crust US crusher security
towards which is not good for PRN users

64
00:03:53,920 --> 00:03:57,740
another problem is that it can be also
it painful for developers

65
00:03:57,740 --> 00:04:01,140
so that's windows up hooker which is
fading too weak to

66
00:04:01,140 --> 00:04:05,300
recognize a valid executable and the
problem was that

67
00:04:05,300 --> 00:04:08,770
it will do it with its own compiling
environment that is not

68
00:04:08,770 --> 00:04:12,360
officials to do naturally but all the
fires that were generated with this

69
00:04:12,360 --> 00:04:14,740
compiling and very environment where
rejected but

70
00:04:14,740 --> 00:04:18,329
a broker because there were some details
that were not in the official Microsoft

71
00:04:18,329 --> 00:04:19,419
documentation

72
00:04:19,419 --> 00:04:23,070
so it can be given a problem for
developers any developer using that

73
00:04:23,070 --> 00:04:23,820
framework

74
00:04:23,820 --> 00:04:27,509
would not be able to use a broker
because of gray area

75
00:04:27,509 --> 00:04:32,090
in the p5 from its and then another
problem you face with my wares and

76
00:04:32,090 --> 00:04:33,219
security to its

77
00:04:33,219 --> 00:04:37,069
his first being able to distinguish
between accorded fights because it

78
00:04:37,069 --> 00:04:39,469
happens all the time with downloads and
stuff

79
00:04:39,469 --> 00:04:43,780
we n about formed mother were filed it
is working and malicious so it sucks

80
00:04:43,780 --> 00:04:47,219
very hard to distinguish so you can
escape

81
00:04:47,219 --> 00:04:50,569
detection and evade security the
measures

82
00:04:50,569 --> 00:04:54,729
by tricking 2x doing this and then so
this for example

83
00:04:54,729 --> 00:04:59,430
as a simple AP file simple that is not
seen as a p5 but doesn't olds

84
00:04:59,430 --> 00:05:02,460
executive style and then if you get
crazy then you can

85
00:05:02,460 --> 00:05:06,050
the on um could see

86
00:05:06,050 --> 00:05:10,620
versatile thinks this is a PDF so which
means induced in one security tunes

87
00:05:10,620 --> 00:05:13,770
the file my start being scanned as a PDF
and then

88
00:05:13,770 --> 00:05:17,860
the PDF part is clean okay and its
totally hit me totally ignored 0

89
00:05:17,860 --> 00:05:20,930
malicious P part so another problem

90
00:05:20,930 --> 00:05:24,259
for malicious for for with my wares

91
00:05:24,259 --> 00:05:28,310
um then you can a failure automation

92
00:05:28,310 --> 00:05:32,539
systems so for example is a simple
example where with just patching

93
00:05:32,539 --> 00:05:36,219
one bite in AU Peace file then do it you
peaks

94
00:05:36,219 --> 00:05:40,590
to me the we failed to unpack its it's
quite a lame example but they still see

95
00:05:40,590 --> 00:05:41,849
a lot of fun

96
00:05:41,849 --> 00:05:44,870
%uh how you say of write-ups

97
00:05:44,870 --> 00:05:48,050
due Wed the use actually you pics to
unpack you pics which is like

98
00:05:48,050 --> 00:05:51,460
kindergarten unpacking and the good

99
00:05:51,460 --> 00:05:54,999
but this means that do is just change
the one by promised under 50

100
00:05:54,999 --> 00:05:58,569
you could face you could fade automation
methodology

101
00:05:58,569 --> 00:06:02,279
and then the worst so the worst
consequences are you could fail even the

102
00:06:02,279 --> 00:06:04,069
most advanced on such as

103
00:06:04,069 --> 00:06:07,479
see if if Explorer idea or debug in this
case

104
00:06:07,479 --> 00:06:10,680
even own advance tomorrow where analysts
are

105
00:06:10,680 --> 00:06:14,279
River singer by just fade being able to
analyze the file

106
00:06:14,279 --> 00:06:19,430
which is not X which is not nice so many
but consequences whether it's for users

107
00:06:19,430 --> 00:06:23,069
developers or automation good ends

108
00:06:23,069 --> 00:06:27,550
even advanced to researchers and my
where analysts

109
00:06:27,550 --> 00:06:32,499
so my approach instead of must write up
so they're most documentation

110
00:06:32,499 --> 00:06:35,590
out there about P file formats are justs

111
00:06:35,590 --> 00:06:39,349
based on what exist in the wild so
basically just covering what's existing

112
00:06:39,349 --> 00:06:40,120
its

113
00:06:40,120 --> 00:06:43,159
ans basically deeds full of

114
00:06:43,159 --> 00:06:47,639
I've never seen that used ever before
and so on so basically do wat maybe to

115
00:06:47,639 --> 00:06:49,620
wait for the next two virus malware

116
00:06:49,620 --> 00:06:53,439
buyers were writers to a 2d implement
that and then you discover in

117
00:06:53,439 --> 00:06:56,580
maybe it's too late for you to its for
your knowledge and so on

118
00:06:56,580 --> 00:06:59,919
so instead of thats I saw the a very
kiddish approach

119
00:06:59,919 --> 00:07:02,990
where well you give to go to a kid child
n

120
00:07:02,990 --> 00:07:06,229
dividend deal under rules by themselves
seeing if it holds on odds

121
00:07:06,229 --> 00:07:09,389
so I do thats reading the docs reversing
the loader

122
00:07:09,389 --> 00:07:13,039
and seeing if this is akiho things works
so of course

123
00:07:13,039 --> 00:07:16,249
this is my kind of Lego no liver legos

124
00:07:16,249 --> 00:07:20,529
and then well it's a bit like this of
course not with the growth wing might be

125
00:07:20,529 --> 00:07:22,279
difficult to see if it executes

126
00:07:22,279 --> 00:07:26,229
but they do the same with Legos that
they would do in assembly site creates

127
00:07:26,229 --> 00:07:29,650
entirely manually exactly like with Lego
blocks

128
00:07:29,650 --> 00:07:32,830
for executable files and India you

129
00:07:32,830 --> 00:07:36,749
you build up your word up in India when
you get a complete executable

130
00:07:36,749 --> 00:07:40,189
that's a computer executable and its
equivalent in Lego so

131
00:07:40,189 --> 00:07:43,879
just with a few blocks you get something
that is acceptable and that might also

132
00:07:43,879 --> 00:07:45,729
failed to load San the

133
00:07:45,729 --> 00:07:49,419
anti virus or whatever so security
softwares

134
00:07:49,419 --> 00:07:53,229
so aideed I started at research long ago
so

135
00:07:53,229 --> 00:07:57,770
be in basically a butte hundreds 00 170
youuu

136
00:07:57,770 --> 00:08:02,460
proof-of-concept that they share on my
website and i also chrome created a

137
00:08:02,460 --> 00:08:06,360
summary page P decor committed come
where I start to

138
00:08:06,360 --> 00:08:10,639
where's try to gather all my findings
but you should heed my proof of concept

139
00:08:10,639 --> 00:08:13,580
set is more advance and it's really
exploring

140
00:08:13,580 --> 00:08:17,779
things that are usually not covered by
existing already existing files

141
00:08:17,779 --> 00:08:20,909
so just exploring slowly

142
00:08:20,909 --> 00:08:25,229
every suspect LDP if i format ensuring
for everybody to tests for

143
00:08:25,229 --> 00:08:28,279
study and so on so

144
00:08:28,279 --> 00:08:31,869
now a start love you above the p5 from
its

145
00:08:31,869 --> 00:08:34,890
so p5 formats so

146
00:08:34,890 --> 00:08:39,200
this is a fight itself you can have you
have to pee header at the stop

147
00:08:39,200 --> 00:08:43,240
other stuff at the top and then you the
P had are defined and whole

148
00:08:43,240 --> 00:08:46,180
area that we could be considered as a
pee file another bottle you could have

149
00:08:46,180 --> 00:08:47,209
some extra yup

150
00:08:47,209 --> 00:08:51,040
which would be a pity data this is not
loaded into in memory

151
00:08:51,040 --> 00:08:55,610
then on AP file itself you have the
header

152
00:08:55,610 --> 00:08:59,410
and then the sections busy two sections
are ordered a bottle to pee find it is

153
00:08:59,410 --> 00:09:01,120
not a header so it could be called

154
00:09:01,120 --> 00:09:04,690
imports day to initialize data and so
forth

155
00:09:04,690 --> 00:09:08,009
and then you had a header so originally

156
00:09:08,009 --> 00:09:11,949
the the top of the head or is it does
header which comes from which was first

157
00:09:11,949 --> 00:09:13,079
used by you

158
00:09:13,079 --> 00:09:16,600
Microsoft for IBM in IBM PC DOS 1.0 in

159
00:09:16,600 --> 00:09:21,180
19 81 so even missed even before I
missed dose 1.0 so

160
00:09:21,180 --> 00:09:24,800
way before the Windows

161
00:09:24,800 --> 00:09:28,009
and then there had the opportunity to

162
00:09:28,009 --> 00:09:32,040
I another kind of headers so this could
be a portable executable

163
00:09:32,040 --> 00:09:35,110
adjusted yet still a DOS XX to bodied
it's nothing with

164
00:09:35,110 --> 00:09:38,269
I'll 40 nothing of Appeal whatever

165
00:09:38,269 --> 00:09:41,329
and then you could other another kind of
header

166
00:09:41,329 --> 00:09:45,019
so it could turn it into a new text a
billionaire executable

167
00:09:45,019 --> 00:09:48,570
and portable executable so then
depending on the signature here

168
00:09:48,570 --> 00:09:52,570
you would have different kind of header
and different kind of

169
00:09:52,570 --> 00:09:56,930
file entirely but as I said here could
just covered AP file formats

170
00:09:56,930 --> 00:10:01,690
so then it starts with AP signature than
you had 25 header which is always there

171
00:10:01,690 --> 00:10:05,040
and then you could have optional header
which is

172
00:10:05,040 --> 00:10:09,190
option on it's not present in object
files its only present in executables

173
00:10:09,190 --> 00:10:12,389
and you can have a section tables the
section table

174
00:10:12,389 --> 00:10:16,019
defied her door is the one saying will
there be an optional header

175
00:10:16,019 --> 00:10:20,170
with every sections n at the end of the
optional header

176
00:10:20,170 --> 00:10:24,149
it's a bit special that you have an
error rate which are the data directory

177
00:10:24,149 --> 00:10:28,139
but each of his first 16 elements have a
very completely different

178
00:10:28,139 --> 00:10:32,380
use so basically you called in data
directory as usual even though dr.

179
00:10:32,380 --> 00:10:36,069
initially the same search are then their
use is totally different

180
00:10:36,069 --> 00:10:41,410
so loss header is not completely ignored
when you're loading the file as a PE

181
00:10:41,410 --> 00:10:45,269
if you're loading def if the Peapod is
coated or if it's really in order

182
00:10:45,269 --> 00:10:49,910
does format n you have a Windows a a
32-bit Windows so even on their windows

183
00:10:49,910 --> 00:10:51,170
7 32 bits

184
00:10:51,170 --> 00:10:54,579
this part will be used otherwise it's
totally ignored by

185
00:10:54,579 --> 00:10:58,060
the mmm p by 2p loader so you just need

186
00:10:58,060 --> 00:11:01,089
MZ signature and then a DN

187
00:11:01,089 --> 00:11:04,389
a pointer which point points it's an
offset 2d

188
00:11:04,389 --> 00:11:09,630
of P header then DP header defied head
of the firsts first

189
00:11:09,630 --> 00:11:14,300
part of the image into headers has a few
if stuff so for example he did say that

190
00:11:14,300 --> 00:11:16,259
it would be x-box whatever but

191
00:11:16,259 --> 00:11:19,880
we are only trust if it's %uh to beat or
64 bit now

192
00:11:19,880 --> 00:11:23,269
this would say how many sections they
will be if if any

193
00:11:23,269 --> 00:11:26,709
and then sizeof option ahead as we like
to say where do

194
00:11:26,709 --> 00:11:29,850
section table is and some
characteristics to say if it's an

195
00:11:29,850 --> 00:11:31,360
executable ordeal

196
00:11:31,360 --> 00:11:34,800
to all the stuff but usually not
importance

197
00:11:34,800 --> 00:11:39,089
then the optional header his big boats
many of the elements

198
00:11:39,089 --> 00:11:43,180
nah not so important so most important
Marco start

199
00:11:43,180 --> 00:11:47,920
says emergent on to address a 12 point
image basin section alignment

200
00:11:47,920 --> 00:11:52,639
you do geometry defied wildest west of
our a line on the file would see that

201
00:11:52,639 --> 00:11:53,410
later

202
00:11:53,410 --> 00:11:56,490
size of the match declares hoping to
find will be in memory

203
00:11:56,490 --> 00:12:00,420
subsystem say's if it's a driver command
line

204
00:12:00,420 --> 00:12:03,709
and then the data directories with the
culture of for them

205
00:12:03,709 --> 00:12:09,019
the data ok for you Dr complex
themselves with cedar later

206
00:12:09,019 --> 00:12:12,050
so know the first two sections so there

207
00:12:12,050 --> 00:12:16,190
after the sorry you have the number of
section here

208
00:12:16,190 --> 00:12:19,680
size of optional header would say where
dissection table is located so

209
00:12:19,680 --> 00:12:23,350
follow just following that well pointed
by size of optional header

210
00:12:23,350 --> 00:12:27,509
dissection table with were reportedly
where deer section so

211
00:12:27,509 --> 00:12:31,350
the second says where which part of the
fight would be loaded in memory and with

212
00:12:31,350 --> 00:12:32,160
which

213
00:12:32,160 --> 00:12:35,350
attributes like is it right to vote is
it executable

214
00:12:35,350 --> 00:12:38,430
and so which addresses where it will be
loaded

215
00:12:38,430 --> 00:12:41,660
pointer to row determines where it is in
the file as an offset

216
00:12:41,660 --> 00:12:44,680
characteristics means is it readable
writeable executable

217
00:12:44,680 --> 00:12:49,660
so here is an example where here you
have the representation of the fun

218
00:12:49,660 --> 00:12:52,850
and then what it would be in memory so
the

219
00:12:52,850 --> 00:12:56,050
or daigneault determines an image-based
an

220
00:12:56,050 --> 00:13:00,279
the initial image base and fro and from
this point on everything is related to

221
00:13:00,279 --> 00:13:00,569
these

222
00:13:00,569 --> 00:13:05,339
image bays and then for each section
pointer to rotate our size or the tar

223
00:13:05,339 --> 00:13:08,540
is red and loaded in memory I do get
your address

224
00:13:08,540 --> 00:13:12,170
individual sites YouTube always bigger

225
00:13:12,170 --> 00:13:15,600
are required then it would be full of
zeros

226
00:13:15,600 --> 00:13:19,079
extended with zeros and numbers of
section here is determining so it's

227
00:13:19,079 --> 00:13:21,810
doing this for the number of sections

228
00:13:21,810 --> 00:13:25,910
and altogether this is the size of image

229
00:13:25,910 --> 00:13:30,230
now the data directories well date %uh
the elements were to date other tree but

230
00:13:30,230 --> 00:13:34,129
all of them are completely different so
for us you have to export and import

231
00:13:34,129 --> 00:13:34,819
sweep rope

232
00:13:34,819 --> 00:13:38,730
provide communication between do
executables Angeles

233
00:13:38,730 --> 00:13:42,120
then resources where the the third its
second World

234
00:13:42,120 --> 00:13:46,759
the second one if you come this way is
what's will provide resources like icons

235
00:13:46,759 --> 00:13:48,850
money first Russian information

236
00:13:48,850 --> 00:13:53,069
security is where you have the digital
signature its points where do digital

237
00:13:53,069 --> 00:13:53,870
signature

238
00:13:53,870 --> 00:14:00,870
is into fine the exception is used for
in 64-bit mode for exception handling

239
00:14:01,050 --> 00:14:05,560
relocations would see with I talk about
them later but it's when defile our

240
00:14:05,560 --> 00:14:08,720
have to be relocated memories for this
information to

241
00:14:08,720 --> 00:14:13,300
to know how to perform that the books
debug is obvious is all you present when

242
00:14:13,300 --> 00:14:14,579
you combine with debug

243
00:14:14,579 --> 00:14:18,839
copywriter architecture as usual this
global pointer was only used in it on

244
00:14:18,839 --> 00:14:19,410
%um

245
00:14:19,410 --> 00:14:23,680
40 well it on %um structure so to do
it's the relocation Inc you wince or

246
00:14:23,680 --> 00:14:27,449
retirements not used on x86 and 64 bits

247
00:14:27,449 --> 00:14:31,689
TNS is important because it's can be
called it is actually called before

248
00:14:31,689 --> 00:14:35,709
do a two point is called load config is
used for the safe the structure

249
00:14:35,709 --> 00:14:36,810
exception handling

250
00:14:36,810 --> 00:14:40,160
implemented by Visual Studio compilers
but it's not

251
00:14:40,160 --> 00:14:43,879
appeal order of Cup structure when you
have these it is

252
00:14:43,879 --> 00:14:48,670
the file and its extra code from the
compiler bone report suggests

253
00:14:48,670 --> 00:14:53,310
to speed up the imports lauding instead
of um

254
00:14:53,310 --> 00:14:56,480
prepare for me look up so much over with
the exports

255
00:14:56,480 --> 00:15:00,660
then you can store the imports sorta
though deduct your vote value that would

256
00:15:00,660 --> 00:15:02,790
be low delivery to speed up things

257
00:15:02,790 --> 00:15:06,829
I A T important to see what is not
really important only with files without

258
00:15:06,829 --> 00:15:08,310
section but it's just

259
00:15:08,310 --> 00:15:12,240
a highlight of the imports it themselves
the name port just another compiler

260
00:15:12,240 --> 00:15:14,759
mechanism that is totally ignored by the
loader

261
00:15:14,759 --> 00:15:18,029
but it makes a compiler able to not load

262
00:15:18,029 --> 00:15:21,250
the fight at the start execution but so
on demand

263
00:15:21,250 --> 00:15:25,180
and come to script or false yellow
discretized use for dotnet

264
00:15:25,180 --> 00:15:29,149
and the last one well it's never used
except it's known because it's using us

265
00:15:29,149 --> 00:15:30,339
protect him

266
00:15:30,339 --> 00:15:34,889
an ice pack but she it's not use it has
no meaning for the loader itself

267
00:15:34,889 --> 00:15:38,350
saw export-import other way do pipeline

268
00:15:38,350 --> 00:15:42,790
between a call from the guy for an
executable to DL

269
00:15:42,790 --> 00:15:47,300
so exports you have three lists

270
00:15:47,300 --> 00:15:50,379
it so first you say you declare the name
what did you learn how it's

271
00:15:50,379 --> 00:15:53,560
internally its I don't think it's really
I real event

272
00:15:53,560 --> 00:15:56,699
and then you declare an amount of
functions and names which kinda do you

273
00:15:56,699 --> 00:15:57,699
define

274
00:15:57,699 --> 00:16:02,769
the export name which means address a
name and an ordinal

275
00:16:02,769 --> 00:16:06,550
imports so first you had to describe
those it's a list of descriptors

276
00:16:06,550 --> 00:16:10,249
typically it's one district are pretty
alone so basically for HDL it that you

277
00:16:10,249 --> 00:16:11,029
want

278
00:16:11,029 --> 00:16:14,290
you will have one described or well a 2d
can beef

279
00:16:14,290 --> 00:16:17,839
wrong but that's usually the case and
then you have

280
00:16:17,839 --> 00:16:21,430
a pointer to did your name to be loaded
and then you have

281
00:16:21,430 --> 00:16:24,999
arm the two lists themselves

282
00:16:24,999 --> 00:16:28,740
the new terminating this of pointers and
initially 2.22

283
00:16:28,740 --> 00:16:31,990
actual few name of two API to be loaded

284
00:16:31,990 --> 00:16:35,810
and then just did this one once the file
is loaded

285
00:16:35,810 --> 00:16:38,759
then it would point to do it would be
over return with the actual address in

286
00:16:38,759 --> 00:16:39,550
memory

287
00:16:39,550 --> 00:16:42,850
so these kinda defines imports under
stable

288
00:16:42,850 --> 00:16:48,399
int in memory and the other data
directory which is raat is

289
00:16:48,399 --> 00:16:53,389
concerning the switch means said this as
writeable for the loader

290
00:16:53,389 --> 00:16:57,019
otherwise the right would fade when the
imports are resolved

291
00:16:57,019 --> 00:17:01,360
relocations first and our peas and
yellows hav

292
00:17:01,360 --> 00:17:04,870
a standard image base so basically when
you have to do. this with the same

293
00:17:04,870 --> 00:17:09,620
image-based there could be a conflict so
in this case to OS needs to say

294
00:17:09,620 --> 00:17:13,900
no not that this image-based but another
one and or the absolute its

295
00:17:13,900 --> 00:17:17,409
a hope so you'd address into code or in
the date up

296
00:17:17,409 --> 00:17:20,559
will have to be updated most of the

297
00:17:20,559 --> 00:17:24,400
address into a header aren't you rated
so that they don't need to be fixed but

298
00:17:24,400 --> 00:17:25,100
only obsolete

299
00:17:25,100 --> 00:17:28,980
addressed need to be fixed so basically
it's a set of tables

300
00:17:28,980 --> 00:17:33,890
that needs to say at this offsets for
example here it's an absolute reference

301
00:17:33,890 --> 00:17:37,390
the 3 to address then you need to fix
that because the image made will be

302
00:17:37,390 --> 00:17:39,730
change and there's nothing anymore this

303
00:17:39,730 --> 00:17:43,960
address so you have the whole directory
then you have a set of blocks

304
00:17:43,960 --> 00:17:47,020
and for all the blocks because code is
usually in blocks

305
00:17:47,020 --> 00:17:51,700
and then Denny define two starts and
decide the amount over locations here in

306
00:17:51,700 --> 00:17:54,159
for each of them decide which kinda
relocation

307
00:17:54,159 --> 00:17:57,779
at what's relatable sought from the
start block

308
00:17:57,779 --> 00:18:01,539
the resources it so mmm phylum structure

309
00:18:01,539 --> 00:18:06,010
through her so it's a recursive but
typically it's usually only three levels

310
00:18:06,010 --> 00:18:09,360
so you define among the important thing
to you have the same structure repeating

311
00:18:09,360 --> 00:18:11,610
over and over but by standouts roots
type

312
00:18:11,610 --> 00:18:14,710
language and then the results themselves
and then you just

313
00:18:14,710 --> 00:18:18,460
just declares the number of named
country's first and i'd entries

314
00:18:18,460 --> 00:18:22,059
and then points to the next one and so
on so it's like fights richer but based

315
00:18:22,059 --> 00:18:24,429
on guard with few levels

316
00:18:24,429 --> 00:18:27,970
and the TNS very simple structure even
though to chill it itself is quite a

317
00:18:27,970 --> 00:18:28,700
pain to

318
00:18:28,700 --> 00:18:31,750
understand fully so basically you have
earned the

319
00:18:31,750 --> 00:18:34,900
lists of call box and each of them would
be called

320
00:18:34,900 --> 00:18:38,400
one after each other before a thread you
started an

321
00:18:38,400 --> 00:18:42,470
after a thread is dominated saudis means
there is colder

322
00:18:42,470 --> 00:18:47,470
deserve life before and left I V after
this or something like this:

323
00:18:47,470 --> 00:18:51,750
some a.m. here a small address our index
which is which would be the point that

324
00:18:51,750 --> 00:18:52,779
it would be over return on

325
00:18:52,779 --> 00:18:56,779
each year to slow to just know which
chill issue you look you currently

326
00:18:56,779 --> 00:18:58,789
executing

327
00:18:58,789 --> 00:19:01,860
so first I don't show a few classic
tricks to take

328
00:19:01,860 --> 00:19:06,279
keep being asked about so known in
usually known in do

329
00:19:06,279 --> 00:19:09,820
Marware reverse engineering world so
first

330
00:19:09,820 --> 00:19:13,000
it's not really a trick but she can
already feel some tools

331
00:19:13,000 --> 00:19:16,809
maximum number of section in Windows XP
is 96

332
00:19:16,809 --> 00:19:20,919
in under and then from Vista on its 64k

333
00:19:20,919 --> 00:19:24,200
so super funds they work but

334
00:19:24,200 --> 00:19:28,490
good enough to fail already but one into
when it doesn't fade good just give this

335
00:19:28,490 --> 00:19:29,809
funny our message

336
00:19:29,809 --> 00:19:33,730
but after it works me but it's quite
slow so you he did could be

337
00:19:33,730 --> 00:19:38,350
it will also host be a kind of does on
tunes and security tools

338
00:19:38,350 --> 00:19:41,720
then 0 mmm one of the

339
00:19:41,720 --> 00:19:44,700
biggest problem with it official
Microsoft the commission is so he's

340
00:19:44,700 --> 00:19:45,620
defines

341
00:19:45,620 --> 00:19:49,000
PCs by their section and actually when

342
00:19:49,000 --> 00:19:52,970
the file is loaded as a driver you have
these requirement of I'll alignment

343
00:19:52,970 --> 00:19:53,590
being small

344
00:19:53,590 --> 00:19:57,500
unequal to section alignment which means
dis each of the section

345
00:19:57,500 --> 00:20:00,659
is I don't recall physically and
culturally

346
00:20:00,659 --> 00:20:04,450
and basically just means that or to file
is loaded as is

347
00:20:04,450 --> 00:20:08,080
and it's been such actually dissection
table is more or less ignored so you can

348
00:20:08,080 --> 00:20:09,320
help no section

349
00:20:09,320 --> 00:20:14,200
or like previously this is another
example of the case of

350
00:20:14,200 --> 00:20:17,950
section table because section less flow
alignment

351
00:20:17,950 --> 00:20:22,260
because even though they are 96 section
well quite obvious coated I hope you can

352
00:20:22,260 --> 00:20:23,110
all see

353
00:20:23,110 --> 00:20:28,000
can you will see and did do the numbers

354
00:20:28,000 --> 00:20:31,539
this is a working section table but
basically it's ignored

355
00:20:31,539 --> 00:20:36,200
but third because of the low alignments
dis is on ignoring the file is loaded

356
00:20:36,200 --> 00:20:40,190
as is in memory

357
00:20:40,190 --> 00:20:43,240
saw another unknown like formation

358
00:20:43,240 --> 00:20:46,440
of 2 p-5 format is the tiny P files

359
00:20:46,440 --> 00:20:49,690
so basically it implies a the

360
00:20:49,690 --> 00:20:53,190
because it does header is mostly unused
the

361
00:20:53,190 --> 00:20:56,940
you stop putting the other headers
insider does header

362
00:20:56,940 --> 00:21:00,460
and then you just make sure that a
devout you for the

363
00:21:00,460 --> 00:21:03,850
pointer to be heard or read correspond
to sectional I'm and that works

364
00:21:03,850 --> 00:21:08,320
and then the other treaties that the
optional header is truncated to the last

365
00:21:08,320 --> 00:21:12,020
important value it's actually truncated
even before he is it's a word but you

366
00:21:12,020 --> 00:21:13,149
only need to first

367
00:21:13,149 --> 00:21:16,980
by to be defined so by doing this you
can have a 92

368
00:21:16,980 --> 00:21:20,809
beats bites be file a cheater origin or

369
00:21:20,809 --> 00:21:25,090
P Tony P by Alexander soldier of a
dissection table but it's not required

370
00:21:25,090 --> 00:21:26,039
at all

371
00:21:26,039 --> 00:21:29,500
so this at this other treats all the
tiny pee fives

372
00:21:29,500 --> 00:21:33,809
the thing is the after XP so far the
star in the father

373
00:21:33,809 --> 00:21:38,039
you though he doesn't accept any more to
have a truncated optional header

374
00:21:38,039 --> 00:21:41,490
so the trunk you cannot have its
optional header to

375
00:21:41,490 --> 00:21:45,330
to close from the end of the fight so
visibly interested it might still work

376
00:21:45,330 --> 00:21:47,279
but you just need out some stupid
putting

377
00:21:47,279 --> 00:21:52,260
I mean full of zeros so in this case
under Windows 7 64 bit the smallest

378
00:21:52,260 --> 00:21:56,649
executable file is 278 but it's exactly
the same structure

379
00:21:56,649 --> 00:22:03,090
with just I did putting ok to 206 68
bytes

380
00:22:03,090 --> 00:22:06,409
another known tree cue onto funny from

381
00:22:06,409 --> 00:22:09,620
also if from reversing loves is a

382
00:22:09,620 --> 00:22:13,620
and GRP header or folded header I called
for lead

383
00:22:13,620 --> 00:22:18,330
header so basically you extend if I head
are you put it father

384
00:22:18,330 --> 00:22:21,820
by extending the values so that its its

385
00:22:21,820 --> 00:22:25,390
a almost line to the start of the
section so that the details for

386
00:22:25,390 --> 00:22:28,940
directories will be at the start of this
section the thing is the data

387
00:22:28,940 --> 00:22:30,539
directories are only use

388
00:22:30,539 --> 00:22:34,059
once defined as much in memory and the
trick here is

389
00:22:34,059 --> 00:22:37,070
that actually so basically did not being
will happen

390
00:22:37,070 --> 00:22:40,270
or this is checked this is checked this
is checked this is

391
00:22:40,270 --> 00:22:44,309
ignored then the file is not then this
dissection is loaded at these virtual

392
00:22:44,309 --> 00:22:45,120
address

393
00:22:45,120 --> 00:22:48,320
and this will over right the actual the
fake

394
00:22:48,320 --> 00:22:52,250
vid eight other eateries so basically
you have due in part that is here at the

395
00:22:52,250 --> 00:22:53,120
fake but it is

396
00:22:53,120 --> 00:22:57,620
completely ignored so you have to any of
course you could have another fake

397
00:22:57,620 --> 00:23:01,640
header here but it would be ignored the
data is directories themselves he would

398
00:23:01,640 --> 00:23:02,130
be

399
00:23:02,130 --> 00:23:05,559
taken into account once the file is not
in memory and then

400
00:23:05,559 --> 00:23:09,740
if Joe to love not aware of the trick
then you can practice and do some ASCII

401
00:23:09,740 --> 00:23:12,340
art or x-art with the fake data
directories

402
00:23:12,340 --> 00:23:16,510
but of course these laws because the
actual the real ones are

403
00:23:16,510 --> 00:23:21,090
after just after wrapping before take
into account overwriting the fake ones

404
00:23:21,090 --> 00:23:26,399
so ASCII art with eight other eateries
another unknown trick but not so well

405
00:23:26,399 --> 00:23:30,649
Nana already documented treat but not so
well known in its quite worrying

406
00:23:30,649 --> 00:23:34,799
was documented by Skyway in 2000 the 9i
think

407
00:23:34,799 --> 00:23:38,640
is dots on DL in Maine you have
Parmenter titties okie be reserved

408
00:23:38,640 --> 00:23:41,840
which means no documentation n

409
00:23:41,840 --> 00:23:45,820
it's actually quite worrisome because so
it's only on study others

410
00:23:45,820 --> 00:23:49,769
and this is up to 2.0 to the context of
the future

411
00:23:49,769 --> 00:23:53,080
ahead p5 been loaded so you're DP

412
00:23:53,080 --> 00:23:56,840
is being loaded it's not already started
but did did you let some Upton

413
00:23:56,840 --> 00:24:00,649
deal deal in Maine is executed and they
already have and access to the context

414
00:24:00,649 --> 00:24:01,740
of the future

415
00:24:01,740 --> 00:24:05,010
executive it to be loaded which means if
in your

416
00:24:05,010 --> 00:24:09,549
executable you have a bogus entry point
for you an Indiana Maine

417
00:24:09,549 --> 00:24:13,190
just check that your a touchy at the
start of the load the Nexus is the

418
00:24:13,190 --> 00:24:16,610
you access to context and then you
change in the future I P because the

419
00:24:16,610 --> 00:24:17,769
future I P

420
00:24:17,769 --> 00:24:21,100
the IP of the intro which is already day
to you can would you fight between

421
00:24:21,100 --> 00:24:24,279
here just to curb soon a simple minus a
the

422
00:24:24,279 --> 00:24:27,980
addition but basically it means as soon
as a file

423
00:24:27,980 --> 00:24:31,970
HUS study gillen's which is most of the
time did the case

424
00:24:31,970 --> 00:24:35,899
then your entry point can be completely
modified by did your

425
00:24:35,899 --> 00:24:40,309
n your room he actually extended that to
say because you have access to the

426
00:24:40,309 --> 00:24:42,470
context order for the future thread

427
00:24:42,470 --> 00:24:46,370
you can even starts setting debug
registers and so on are changing the

428
00:24:46,370 --> 00:24:46,980
values

429
00:24:46,980 --> 00:24:50,140
so it can be in st. 80 bucks and so on
but its

430
00:24:50,140 --> 00:24:53,570
we had that its did you learn is being
loaded

431
00:24:53,570 --> 00:24:57,679
did fees not started but the future but
you're going to put is already there

432
00:24:57,679 --> 00:25:01,809
and you can freely body fights sono a
few new tricks

433
00:25:01,809 --> 00:25:05,610
so let's start simply H I saw that in
the characteristics

434
00:25:05,610 --> 00:25:09,909
of defiant you have one that says is it
a fight is so to beat

435
00:25:09,909 --> 00:25:13,600
an first of all well it's valid for even
for 64-bit

436
00:25:13,600 --> 00:25:17,340
okay thanks for the logic but actually
it's not use at all

437
00:25:17,340 --> 00:25:20,799
so even if the fight is 32-bit and
discard his dick is not set

438
00:25:20,799 --> 00:25:25,820
well it works so ways did there and it
can be for 64-bit and whites

439
00:25:25,820 --> 00:25:29,179
actually not even used for 32-bit I
don't know

440
00:25:29,179 --> 00:25:32,649
another funny one see Millar in the
characteristics is not

441
00:25:32,649 --> 00:25:36,210
if you loaded yellow statically then you
don't set

442
00:25:36,210 --> 00:25:40,010
it's a dealer well its it works export
work

443
00:25:40,010 --> 00:25:43,159
but one thing is funny is that the
island maine will not be called

444
00:25:43,159 --> 00:25:47,269
so did you put that you can be totally
bogus and so you have a

445
00:25:47,269 --> 00:25:50,269
find that use deal it loaded statically
by the imports

446
00:25:50,269 --> 00:25:53,380
that is ideologue because you can use
the export

447
00:25:53,380 --> 00:25:57,320
but its doesn't have that yellow flag
and he doesn't have a deal in Maine

448
00:25:57,320 --> 00:26:00,740
and then you and a UFO encounter
problems because

449
00:26:00,740 --> 00:26:03,820
or debug relies on the flight to safe
it's a dealer on exit

450
00:26:03,820 --> 00:26:07,299
Saudi debug unable to debug it because
it's not an executable

451
00:26:07,299 --> 00:26:10,149
doesn't have an entry point but it
doesn't have the flight got delayed sets

452
00:26:10,149 --> 00:26:11,190
its sights

453
00:26:11,190 --> 00:26:14,380
in the mean in the sorry in the in
between of

454
00:26:14,380 --> 00:26:19,990
for reality of the possibly Tesoro de
debug is not able to stay to

455
00:26:19,990 --> 00:26:23,120
to open that's fake entry point
completely ignored n

456
00:26:23,120 --> 00:26:26,779
not set as ideal yet works fine

457
00:26:26,779 --> 00:26:30,230
um another for personel trick that stood
watch a lot

458
00:26:30,230 --> 00:26:33,350
ida 6.3 endorse you and so on is Dutch

459
00:26:33,350 --> 00:26:37,549
to import a script or on you do last two
elements need to be defined

460
00:26:37,549 --> 00:26:41,289
so the first ones you can you can be
zeros

461
00:26:41,289 --> 00:26:44,659
and those one just need to be present so
the trick here is to put it

462
00:26:44,659 --> 00:26:47,679
individual space between the header or
between two sections

463
00:26:47,679 --> 00:26:51,100
so this will be no detour space systems

464
00:26:51,100 --> 00:26:54,320
home space that would be filled with
zeros but

465
00:26:54,320 --> 00:26:58,039
in this file itself as the into fight
itself

466
00:26:58,039 --> 00:27:01,960
the end of it is pointing to another is
that doesn't exist yet

467
00:27:01,960 --> 00:27:05,740
so basically i'd of its tune to
understand what it would be you know

468
00:27:05,740 --> 00:27:07,860
it's just a printer finish just exit
process

469
00:27:07,860 --> 00:27:11,250
but I don't doesn't know who seeks to
buy plus even in Houston

470
00:27:11,250 --> 00:27:14,250
doesn't know what to use just doesn't
understand that our

471
00:27:14,250 --> 00:27:18,299
imports their is also face a you and so
on so it still

472
00:27:18,299 --> 00:27:22,630
simple trick butts no more imports

473
00:27:22,630 --> 00:27:27,260
another advance to but yeah imports much
formation

474
00:27:27,260 --> 00:27:30,889
that they did is when you start putting

475
00:27:30,889 --> 00:27:33,899
values imports for structures inside

476
00:27:33,899 --> 00:27:36,929
the to had to say inside the other
structures

477
00:27:36,929 --> 00:27:40,789
so basically you have won the script or
and then you had the Terminator

478
00:27:40,789 --> 00:27:43,990
so disturbed or here despite your is not

479
00:27:43,990 --> 00:27:47,570
you really fun for the descriptor itself
but

480
00:27:47,570 --> 00:27:52,029
sorry his pointed as a imported a stable

481
00:27:52,029 --> 00:27:56,200
the thing is because this is also a
pointer loader could think

482
00:27:56,200 --> 00:28:00,190
this is important to stable but it's not
the case so they think it's corrupt but

483
00:28:00,190 --> 00:28:01,309
in the loader itself

484
00:28:01,309 --> 00:28:04,960
even if this is AppSense or corrupt

485
00:28:04,960 --> 00:28:08,059
even if it looks right but in the end
its current it's ignored

486
00:28:08,059 --> 00:28:11,190
so basically this structure is breaking

487
00:28:11,190 --> 00:28:15,500
the loading and then you can actually
puts disses terminate all supposedly

488
00:28:15,500 --> 00:28:17,919
it's full of zero so five double was

489
00:28:17,919 --> 00:28:21,029
mo Sep 20 but actually a

490
00:28:21,029 --> 00:28:25,330
what the only matters is either Dan the
pointer to the name oil or the first

491
00:28:25,330 --> 00:28:26,669
thank you said two zeros

492
00:28:26,669 --> 00:28:29,880
so sheer ice put the dealer name and I
is said

493
00:28:29,880 --> 00:28:33,880
the a and the name stated the report
name table

494
00:28:33,880 --> 00:28:38,620
here inside the Terminator but it's too
soon as a terminator because the last

495
00:28:38,620 --> 00:28:40,130
number 12 snazzy was

496
00:28:40,130 --> 00:28:44,470
this stood breaks I to 6.3 and other
stuff

497
00:28:44,470 --> 00:28:48,029
and order another simple trick is that
um well

498
00:28:48,029 --> 00:28:53,130
from Windows 2000 on you don't need the
extension and maybe you don't make the

499
00:28:53,130 --> 00:28:56,740
own only XP you can also open dots here

500
00:28:56,740 --> 00:29:00,049
you can have so I'm is this your tea
dyed yellow dot dot dot

501
00:29:00,049 --> 00:29:03,620
is seen as a valid DL even if defied
cannot have such a name

502
00:29:03,620 --> 00:29:06,620
and it's loaded so he can fail also some
heuristics

503
00:29:06,620 --> 00:29:10,159
because under XP that would work it
doesn't work under 7 anymore

504
00:29:10,159 --> 00:29:13,210
as give mister firm a simple

505
00:29:13,210 --> 00:29:17,000
oh one thing that is not usually you
played with is the exception tables

506
00:29:17,000 --> 00:29:20,669
because in their 64-bit because before
you could just set

507
00:29:20,669 --> 00:29:24,380
affair play with FS and said things
directly in the code

508
00:29:24,380 --> 00:29:27,630
but and 64-bit Delle Donne into PE
header

509
00:29:27,630 --> 00:29:31,340
in one of the important data directories
such a amid a simple example because

510
00:29:31,340 --> 00:29:32,769
it's was much simpler than

511
00:29:32,769 --> 00:29:36,559
I thought and you don't need complex
mechanism to said exception handling

512
00:29:36,559 --> 00:29:40,730
but my biggest surprise is that if you
change on the fly by the cold

513
00:29:40,730 --> 00:29:43,809
the value that is in the header in the

514
00:29:43,809 --> 00:29:46,960
I'm how to save in the hand if you
modify

515
00:29:46,960 --> 00:29:51,250
on-the-fly defender value that is in the
header then it's currently taken into

516
00:29:51,250 --> 00:29:51,960
account

517
00:29:51,960 --> 00:29:55,450
which is weird because it was supposed
to bring more pros security

518
00:29:55,450 --> 00:29:59,130
so I would assume that does OS was you
you needed some API calls

519
00:29:59,130 --> 00:30:03,399
whatever lectured by you being used by
do OS would be somewhere else in memory

520
00:30:03,399 --> 00:30:07,149
it would be a copy the night still the
value that is in to be heard or saw

521
00:30:07,149 --> 00:30:11,980
you can still modify on the flight the
exception handler and 64bits

522
00:30:11,980 --> 00:30:17,700
or you can read statically like some pho
voter file in fact does do

523
00:30:17,700 --> 00:30:22,360
/url I play with location so first three
locations are not used

524
00:30:22,360 --> 00:30:26,649
when do that you don't need to perform
them so you if you import the fuel

525
00:30:26,649 --> 00:30:30,139
a hunter bogus values here then some
dudes might

526
00:30:30,139 --> 00:30:33,860
just crushed because the start passing
its which is known going 1-for-2 it's

527
00:30:33,860 --> 00:30:35,649
what you try to pass everything

528
00:30:35,649 --> 00:30:40,299
another funny to reach out to eat or you
come into a is dots if you perform a

529
00:30:40,299 --> 00:30:41,179
revision on

530
00:30:41,179 --> 00:30:45,919
image-based itself image bases decided
by the US itself so usually

531
00:30:45,919 --> 00:30:50,260
a in had

532
00:30:50,260 --> 00:30:53,870
odor is so you you you wouldn't mind if
I do or your image made yourself because

533
00:30:53,870 --> 00:30:54,549
the OS

534
00:30:54,549 --> 00:30:58,880
already modifies its church decides what
to vote for you it will have

535
00:30:58,880 --> 00:31:03,350
but then wants to the heebie jeebies
Israel is change because a relocation

536
00:31:03,350 --> 00:31:06,850
n you perform a recognition on it it was
actually affect the value of the entry

537
00:31:06,850 --> 00:31:07,740
point because

538
00:31:07,740 --> 00:31:10,820
it's a related value nd made a new
version

539
00:31:10,820 --> 00:31:14,990
value of the yen JPY image-based is
actually perform to calculate the value

540
00:31:14,990 --> 00:31:15,870
of the entry point

541
00:31:15,870 --> 00:31:18,870
so basically if you pervert manually
perform a relocation

542
00:31:18,870 --> 00:31:22,340
on d-mich base itself in the header then
a some

543
00:31:22,340 --> 00:31:25,720
early you need an extra that does so
here's statically define would have a

544
00:31:25,720 --> 00:31:28,950
fit wrong entry point but because of his
work is shown

545
00:31:28,950 --> 00:31:32,320
it's fixed by the US a she

546
00:31:32,320 --> 00:31:36,600
when you start looking at most
documentations about so relocations

547
00:31:36,600 --> 00:31:39,769
maybe izumi bit the

548
00:31:39,769 --> 00:31:44,220
the only mention muzah Commission only
mentioned a stunner relocation

549
00:31:44,220 --> 00:31:47,600
the high-low 1 and the absolute one
which is just here

550
00:31:47,600 --> 00:31:51,850
for putting so basically must document
shows a seat height ok to stand out

551
00:31:51,850 --> 00:31:53,710
there talking much based in Taiwan

552
00:31:53,710 --> 00:31:57,820
an is one or duress is just ignored and
then I was surprised to see that

553
00:31:57,820 --> 00:32:01,559
MIPS and all these artists is systems
are still

554
00:32:01,559 --> 00:32:04,630
present whether it's under XP Windows
2000

555
00:32:04,630 --> 00:32:08,769
or Windows seven in which is funny is
that you have those two types that are

556
00:32:08,769 --> 00:32:10,240
completely doubt I'll just sit

557
00:32:10,240 --> 00:32:14,090
ignore like lemme from exit the absolute
one

558
00:32:14,090 --> 00:32:17,360
then type eighties rejected okay who
knows

559
00:32:17,360 --> 00:32:21,159
then you have me to look Asian even if
you're process or NDP

560
00:32:21,159 --> 00:32:24,980
are x86 then meets relocation are
performed

561
00:32:24,980 --> 00:32:28,559
and they are all the types or no is not
used

562
00:32:28,559 --> 00:32:32,460
and high you're not know is obsolete not
use because do

563
00:32:32,460 --> 00:32:36,850
image bass are rounded have to be
rounded so no it doesn't do anything

564
00:32:36,850 --> 00:32:40,750
what you need so it was the same and the
EXP but actually in Windows 8 there was

565
00:32:40,750 --> 00:32:42,539
some cleaning so they are more no more

566
00:32:42,539 --> 00:32:45,880
a MIPS and I is 60 40 location but since

567
00:32:45,880 --> 00:32:50,059
XP and Windows to lose two thousand and
to tweet was to set the

568
00:32:50,059 --> 00:32:53,259
Windows seven they were not of audit
relocation format

569
00:32:53,259 --> 00:32:56,330
let's take advantage of them so first of
all

570
00:32:56,330 --> 00:32:59,539
a issue the type sick as a showed

571
00:32:59,539 --> 00:33:03,500
so the zeros for budding so plus she
doesn't do anything because of their

572
00:33:03,500 --> 00:33:07,500
wrong values of image-based and his two
czar also not doing anything

573
00:33:07,500 --> 00:33:10,870
so basically issue said them on the
entry point all those times we do

574
00:33:10,870 --> 00:33:11,370
nothing

575
00:33:11,370 --> 00:33:14,380
you can see peace is unknown but it's up
to you will do nothing

576
00:33:14,380 --> 00:33:17,519
then you can a preset a fake location on
the value

577
00:33:17,519 --> 00:33:21,210
thats the is not taken into account by
the fight itself

578
00:33:21,210 --> 00:33:24,309
so this is a sit a single proof of
concept that

579
00:33:24,309 --> 00:33:28,570
homes all history together so then you
can set order relocations types

580
00:33:28,570 --> 00:33:32,889
what is important is that high arch to
talk for achieve requires a permit or

581
00:33:32,889 --> 00:33:35,909
is the only location that's Oct the next
the

582
00:33:35,909 --> 00:33:39,159
entry is a far better for adj hai aaj so
this

583
00:33:39,159 --> 00:33:42,230
you cure basically you can set any
values and actually there's a bug in

584
00:33:42,230 --> 00:33:44,850
Windows and apartment is completely
ignored

585
00:33:44,850 --> 00:33:48,409
so if you could set a value and you hit
dehere just means wrong passing another

586
00:33:48,409 --> 00:33:49,269
location

587
00:33:49,269 --> 00:33:52,960
because you had to type 8 which is the
rejected one then

588
00:33:52,960 --> 00:33:57,240
loading would fail then locations are
actually

589
00:33:57,240 --> 00:34:00,970
perform on the fly and you can perform
relocations on themselves

590
00:34:00,970 --> 00:34:04,950
so here this is a simple blocked that
will actually modify something I even

591
00:34:04,950 --> 00:34:06,559
used in its location

592
00:34:06,559 --> 00:34:10,909
and dissident this blog here and his
book he will actually fix

593
00:34:10,909 --> 00:34:13,980
the next block length so basically
locations can

594
00:34:13,980 --> 00:34:18,129
apply to themselves consequence of that
is that if you take the latest I don't

595
00:34:18,129 --> 00:34:19,869
first you have some error messages

596
00:34:19,869 --> 00:34:23,050
and even if you look in manually well
because of these

597
00:34:23,050 --> 00:34:26,490
I don't just has no idea what define
called would be but

598
00:34:26,490 --> 00:34:29,899
because it futur image bases predictable

599
00:34:29,899 --> 00:34:33,490
n you can set everything because these
nice blog here

600
00:34:33,490 --> 00:34:37,129
is actually generating the code with
location then

601
00:34:37,129 --> 00:34:40,169
what's your it's loaded then you have
perfectly working call

602
00:34:40,169 --> 00:34:43,300
the thing is if you wanted automated
static analysis

603
00:34:43,300 --> 00:34:48,389
failure own Peter fairy documented most
of the values

604
00:34:48,389 --> 00:34:52,599
that are possible into I each element of
the PE header

605
00:34:52,599 --> 00:34:55,690
and it's a very valuable documents and
eight so there's a study to take that

606
00:34:55,690 --> 00:34:57,869
into account so this is a working foo

607
00:34:57,869 --> 00:35:01,750
then if you can see H I said it's

608
00:35:01,750 --> 00:35:06,329
most values with completely bogus values
ffffff

609
00:35:06,329 --> 00:35:09,920
and of course just works so this can
really crush

610
00:35:09,920 --> 00:35:13,339
many tools because i reset crazy values

611
00:35:13,339 --> 00:35:16,930
and then so you can either kinda foes

612
00:35:16,930 --> 00:35:20,150
passes and facing the that's a side
effect

613
00:35:20,150 --> 00:35:24,500
or you can put some code so it is one
example where he is this is a PE header

614
00:35:24,500 --> 00:35:30,010
and actually the whole P header is
executed and for example

615
00:35:30,010 --> 00:35:33,280
this here which is some

616
00:35:33,280 --> 00:35:36,710
not so important values he's a cutie if
you go so

617
00:35:36,710 --> 00:35:40,160
my code is not important but actually
the whole PE header is executed

618
00:35:40,160 --> 00:35:44,550
then so it goes execution through the
data and Sony doesn't jump

619
00:35:44,550 --> 00:35:48,359
through another much more practical a
nice example

620
00:35:48,359 --> 00:35:52,599
is diz demo by young mentor from to BCC
21 kilobyte

621
00:35:52,599 --> 00:35:55,940
the mall so it's pretty impressive for
being the one kilobyte

622
00:35:55,940 --> 00:35:59,420
and actually to pee header is the Packer
code mmm cannot see

623
00:35:59,420 --> 00:36:02,650
well well you can see that's on my
website

624
00:36:02,650 --> 00:36:06,380
and I documented with authorization the
poll a coat

625
00:36:06,380 --> 00:36:09,410
the whole EP header n this departure
could

626
00:36:09,410 --> 00:36:12,720
is in the P header but she's cheating
leader because he's jumping for

627
00:36:12,720 --> 00:36:16,560
between blocks when Mike example was to
but this is an actual Parker

628
00:36:16,560 --> 00:36:19,800
into PE header among order values and
stuff

629
00:36:19,800 --> 00:36:22,880
and this is quite impressive ended the
waiter well it rocks because

630
00:36:22,880 --> 00:36:26,420
won't look quite nice 3d effects and
music good stuff

631
00:36:26,420 --> 00:36:30,220
amazing /url okay

632
00:36:30,220 --> 00:36:34,349
um another a study recently playing with
dotnet fights

633
00:36:34,349 --> 00:36:38,310
so when you know the dot that file the
fight is loaded as p

634
00:36:38,310 --> 00:36:41,740
then there's aim for to ms. Corey Dillon
then

635
00:36:41,740 --> 00:36:45,310
her doing is Corey will let you check to
pee file again

636
00:36:45,310 --> 00:36:49,390
from out but that prospect you n partied
again

637
00:36:49,390 --> 00:36:53,260
it's actually more tricky admits more
specific things to be right

638
00:36:53,260 --> 00:36:56,680
so for example but so for example
fordice is what

639
00:36:56,680 --> 00:37:00,390
is important for the p5 just need
imports then to dot net units one

640
00:37:00,390 --> 00:37:02,359
relocation on the entry point

641
00:37:02,359 --> 00:37:05,500
and um ok

642
00:37:05,500 --> 00:37:09,470
and then the the archer dotnet header
the thing is

643
00:37:09,470 --> 00:37:13,780
this value is sets by do amount of data
to riches is said by number of

644
00:37:13,780 --> 00:37:18,119
VA's and dotnet loader forget to check
out your value

645
00:37:18,119 --> 00:37:22,579
so she said the 22 then but that will
see work because he thinks he is big

646
00:37:22,579 --> 00:37:24,480
enough to check today to 32 is

647
00:37:24,480 --> 00:37:27,800
but both I dot and CFF for eg

648
00:37:27,800 --> 00:37:31,490
a phase 2 seed as a dotnet file so this
was

649
00:37:31,490 --> 00:37:35,099
fix last weekend but this is actually
already used in a wide by my way as in

650
00:37:35,099 --> 00:37:36,210
so that so subtly

651
00:37:36,210 --> 00:37:41,599
reflectors I dunno where failing to
recognize dotnet finds out that net

652
00:37:41,599 --> 00:37:45,210
/url not so very important butts love
just for fun

653
00:37:45,210 --> 00:37:48,650
he made a PE file that Prince itself so

654
00:37:48,650 --> 00:37:52,410
each print it on sore so when you
execute its the source is actually into

655
00:37:52,410 --> 00:37:54,700
fights eso with a ski tricks and so on

656
00:37:54,700 --> 00:37:59,160
its putting its on source in DP phone or
if you type it

657
00:37:59,160 --> 00:38:02,310
it also works on you c2 source from the
file

658
00:38:02,310 --> 00:38:06,150
oh this is another file that they did
though so basically

659
00:38:06,150 --> 00:38:09,829
this is the key 50

660
00:38:09,829 --> 00:38:12,849
and who to we'll

661
00:38:12,849 --> 00:38:17,490
more shit scat is on so basically DC to
be fired a few other PDF signature at

662
00:38:17,490 --> 00:38:19,400
the beginning it can become PDF

663
00:38:19,400 --> 00:38:22,869
the issue ml then PK can become a Zep
also

664
00:38:22,869 --> 00:38:25,910
and you can have a huge the Java class
inside

665
00:38:25,910 --> 00:38:29,280
so basically this is a fight that works
as a PDF

666
00:38:29,280 --> 00:38:32,420
as a as a zip as a Java

667
00:38:32,420 --> 00:38:36,810
n Asha met with JavaScript an I I did
more tricks

668
00:38:36,810 --> 00:38:40,190
so that's a it's not the CSC here is
invited

669
00:38:40,190 --> 00:38:44,960
but it works PDF here is invalid for
standard he does but it works without a

670
00:38:44,960 --> 00:38:45,359
rose

671
00:38:45,359 --> 00:38:49,010
in Adobe and because I had full control
of the structure

672
00:38:49,010 --> 00:38:52,410
instead of doing putting a PDF and stuff
then I made like these

673
00:38:52,410 --> 00:38:55,450
so for example a part of the PDF is
inside

674
00:38:55,450 --> 00:39:00,859
Java class and so on it just breaks with
some

675
00:39:00,859 --> 00:39:06,770
thank you oh yeah I also true in some
and a committed according to pee files

676
00:39:06,770 --> 00:39:09,819
just to fill went to be genes on

677
00:39:09,819 --> 00:39:13,599
so conclusion ok sorry

678
00:39:13,599 --> 00:39:17,810
0 Windows executable for much stew
complex

679
00:39:17,810 --> 00:39:21,200
Microsoft doesn't cover much but new
tricks

680
00:39:21,200 --> 00:39:24,319
little tricks everyday suddenly so

681
00:39:24,319 --> 00:39:28,270
if you want to easy poster introduction

682
00:39:28,270 --> 00:39:32,089
his address an issue are serious about P
fives

683
00:39:32,089 --> 00:39:39,089
is Chris any questions

684
00:39:45,700 --> 00:39:47,350
on

685
00:39:47,350 --> 00:39:50,120
bonus yeah

686
00:39:50,120 --> 00:39:54,020
the questions or you can reach me by
email and so on

687
00:39:54,020 --> 00:39:58,020
so bonus why not if you're

688
00:39:58,020 --> 00:40:01,680
using us 32bits a OS then the old

689
00:40:01,680 --> 00:40:05,250
Windows binaries are still executable
not the norm P once

690
00:40:05,250 --> 00:40:08,550
so usually did the study is just about
printing something

691
00:40:08,550 --> 00:40:12,430
and exiting but actually the dust-up HUS
many capabilities

692
00:40:12,430 --> 00:40:16,340
so this is one witnesses a file that is
actually a coated p

693
00:40:16,340 --> 00:40:20,460
with a duster that will actually repair
itself and then executed say it again

694
00:40:20,460 --> 00:40:24,280
so it's weird if you think about it
because this is executed by section

695
00:40:24,280 --> 00:40:25,880
because this is touchy because

696
00:40:25,880 --> 00:40:29,730
it also works in Windows 7 32 bits so
you can escape

697
00:40:29,730 --> 00:40:34,200
network detection the thing is d changes
dawn on disk so at this moment could be

698
00:40:34,200 --> 00:40:35,320
called as a key file

699
00:40:35,320 --> 00:40:39,380
but if you think dust-up could be
innocent that it's a problem actually

700
00:40:39,380 --> 00:40:42,780
a fav of did a.m. sachi 3

701
00:40:42,780 --> 00:40:45,800
bites demo that is visual Indus collar
fix

702
00:40:45,800 --> 00:40:48,970
so basically you can replace the dust-up
with this

703
00:40:48,970 --> 00:40:51,900
so instead of having to cope you said
you can hear you have a very nice full

704
00:40:51,900 --> 00:40:52,810
screen animation

705
00:40:52,810 --> 00:40:57,890
awesome the issued a be hired by Rex of
another trick is that for those formats

706
00:40:57,890 --> 00:41:01,320
you don't need a cutie and seed ends its
again so you can have as your signature

707
00:41:01,320 --> 00:41:02,000
which is

708
00:41:02,000 --> 00:41:06,010
goods to evade all the detections 00 or

709
00:41:06,010 --> 00:41:09,560
you can have a common folk on file which
is even before the exit

710
00:41:09,560 --> 00:41:13,330
it former existed saudis had a less
confined

711
00:41:13,330 --> 00:41:17,310
454 much and you can use is a use case
has a go well

712
00:41:17,310 --> 00:41:20,540
encoder so it's a symbolical could also
it's better than

713
00:41:20,540 --> 00:41:24,690
a fun to make this is executable file n
this is a calm fine

714
00:41:24,690 --> 00:41:28,840
thats when executed would rather be
executed so I see if you need to type a

715
00:41:28,840 --> 00:41:29,480
p/e

716
00:41:29,480 --> 00:41:32,730
his words still in their windows 7
32-bit

717
00:41:32,730 --> 00:41:37,040
own a funny tree case so is dirt heard
if the

718
00:41:37,040 --> 00:41:40,290
bitmap fonts it are still the same
format

719
00:41:40,290 --> 00:41:43,620
very old format in their windows 7 since

720
00:41:43,620 --> 00:41:47,280
Windows a well the Windows NT

721
00:41:47,280 --> 00:41:50,520
not yet when we doesn t 3.1 so basically

722
00:41:50,520 --> 00:41:54,270
this is not p .05 switches music to
balloon fight for it

723
00:41:54,270 --> 00:41:57,780
and so this five are these five former

724
00:41:57,780 --> 00:42:01,150
is from 85 no +91 sorry

725
00:42:01,150 --> 00:42:04,610
+91 you ended data inside

726
00:42:04,610 --> 00:42:08,300
is from 84 n if you're going to
properties

727
00:42:08,300 --> 00:42:11,690
this is pasta so this means in 2012
Windows

728
00:42:11,690 --> 00:42:15,330
8 because it's also too in Windows 8
Windows 8 is to parsing

729
00:42:15,330 --> 00:42:18,720
the fight for what the 16 beach fun
format from

730
00:42:18,720 --> 00:42:21,900
not in 85 Cody

731
00:42:21,900 --> 00:42:25,070
0 wide containing a 84 the 28

732
00:42:25,070 --> 00:42:28,580
so is someone fight over everything that
you know you can imagine someone to call

733
00:42:28,580 --> 00:42:32,360
in a comment this is it's really is 16
feet 5 formats

734
00:42:32,360 --> 00:42:35,630
don't change that and if someone finds
oven for that it's also

735
00:42:35,630 --> 00:42:39,450
and also if you open those files which
are new executive order before P fines

736
00:42:39,450 --> 00:42:44,770
in Ida it fades recognizing anything
another one

737
00:42:44,770 --> 00:42:47,770
just because I also like that the

738
00:42:47,770 --> 00:42:51,180
ok Go's I found out that lock is usually

739
00:42:51,180 --> 00:42:54,570
into who triggering exception in many
cases and the OS

740
00:42:54,570 --> 00:42:58,190
is interfering with that in has already
a history I mention that let's join host

741
00:42:58,190 --> 00:42:58,470
is

742
00:42:58,470 --> 00:43:01,500
the of history of being wrongly handled
by

743
00:43:01,500 --> 00:43:05,340
the US n this one is really funny under
Windows 7 64 bit

744
00:43:05,340 --> 00:43:08,770
so it is not perfect should fail and if
it fails

745
00:43:08,770 --> 00:43:12,600
should trigger an exec an exception but
here he doesn't trigger an exceptional

746
00:43:12,600 --> 00:43:15,810
just fade silently so if you are

747
00:43:15,810 --> 00:43:19,430
I have this and you start running
nothing happens and if you put your

748
00:43:19,430 --> 00:43:22,820
actually here and even funnier it was
been have been touched

749
00:43:22,820 --> 00:43:26,410
but US doesn't trigger an exception you
cannot go further

750
00:43:26,410 --> 00:43:29,820
so the fight is like stock it so

751
00:43:29,820 --> 00:43:33,070
unites usually US doesn't touch

752
00:43:33,070 --> 00:43:36,980
quotes that you type yourself and I
don't they were

753
00:43:36,980 --> 00:43:41,030
run I don't trigger an exception but
your windows 7 64 bit is an able to take

754
00:43:41,030 --> 00:43:41,630
a decision

755
00:43:41,630 --> 00:43:44,660
and define stops but not crush

756
00:43:44,660 --> 00:43:48,870
that's all or arm

757
00:43:48,870 --> 00:43:53,860
my initial Sladek was much bigger so I
really is an extended slide X

758
00:43:53,860 --> 00:43:57,630
first with explanation so if you need to
remember what this guy's head or

759
00:43:57,630 --> 00:43:58,080
anything

760
00:43:58,080 --> 00:44:01,670
and which many more examples so released

761
00:44:01,670 --> 00:44:06,960
both Sladek for the presentation and
indexed in its latex thank you

762
00:44:06,960 --> 00:44:07,600
for your attention

