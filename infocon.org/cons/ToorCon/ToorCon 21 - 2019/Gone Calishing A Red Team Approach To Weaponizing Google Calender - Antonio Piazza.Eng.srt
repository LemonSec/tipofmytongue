1
00:00:22,130 --> 00:00:26,359
so many good talks got Robert car

2
00:00:26,359 --> 00:00:28,250
hacking extraordinaire over here that's

3
00:00:28,250 --> 00:00:30,590
just hanging out it's kind of cool

4
00:00:30,590 --> 00:00:33,320
Michael Osman is here like the dude that

5
00:00:33,320 --> 00:00:36,800
created hack RF I hung out with a hacker

6
00:00:36,800 --> 00:00:38,449
last night most of you probably don't

7
00:00:38,449 --> 00:00:40,489
know and I'm like a fanboy this guy and

8
00:00:40,489 --> 00:00:42,110
he just kind of showed up and I'm like

9
00:00:42,110 --> 00:00:45,260
holy so having a really good time

10
00:00:45,260 --> 00:00:48,229
so we're gonna do a toast you probably

11
00:00:48,229 --> 00:00:49,790
I'm probably the only guy here with

12
00:00:49,790 --> 00:00:52,699
alcohol in the morning so shot of

13
00:00:52,699 --> 00:00:54,879
tequila but thanks for having me and

14
00:00:54,879 --> 00:01:03,500
Cheers red team all right so as you can

15
00:01:03,500 --> 00:01:04,549
see my talks gonna be a little

16
00:01:04,549 --> 00:01:12,500
suspenseful so Halloween back in 2018 to

17
00:01:12,500 --> 00:01:15,650
Black Hills security researchers Bo

18
00:01:15,650 --> 00:01:16,990
Bullock and Michael felch

19
00:01:16,990 --> 00:01:20,540
disclosed a Google step-by-step how

20
00:01:20,540 --> 00:01:22,880
anybody with a gmail account could

21
00:01:22,880 --> 00:01:28,159
inject a event into anyone elses Google

22
00:01:28,159 --> 00:01:31,960
Calendar as accepted via the Google API

23
00:01:31,960 --> 00:01:35,390
Google calls us a feature as a red

24
00:01:35,390 --> 00:01:40,280
teamer I totally agree with that so a

25
00:01:40,280 --> 00:01:43,280
year later still is not fixed and this

26
00:01:43,280 --> 00:01:48,139
is why I entitled my talk what the

27
00:01:48,139 --> 00:01:51,649
Google how is this still not fixed but

28
00:01:51,649 --> 00:01:53,990
really no my talk is actually gone

29
00:01:53,990 --> 00:01:57,350
coalition a little bit about Who I am

30
00:01:57,350 --> 00:01:59,560
again I'm Antonio Piazza I go by tawny

31
00:01:59,560 --> 00:02:02,929
ant-man Ben my handle for a long time

32
00:02:02,929 --> 00:02:04,759
I'm an offensive security engineer at

33
00:02:04,759 --> 00:02:08,869
Vox at Austin Texas started my career

34
00:02:08,869 --> 00:02:12,260
and doing this social engineering thing

35
00:02:12,260 --> 00:02:14,330
way back when I got my psychology degree

36
00:02:14,330 --> 00:02:17,240
from Ohio State and then went to the

37
00:02:17,240 --> 00:02:18,800
army and was a 35 Mike human

38
00:02:18,800 --> 00:02:20,959
intelligence collector slash

39
00:02:20,959 --> 00:02:23,090
interrogator in Iraq slash professional

40
00:02:23,090 --> 00:02:27,830
liar slash lie detector so later I

41
00:02:27,830 --> 00:02:29,510
decided to kind of get a computer

42
00:02:29,510 --> 00:02:31,160
science degree and translated this all

43
00:02:31,160 --> 00:02:32,190
over and

44
00:02:32,190 --> 00:02:33,750
you know have fun doing social

45
00:02:33,750 --> 00:02:41,330
engineering so a little bit of an update

46
00:02:41,330 --> 00:02:45,480
back derbycon time Forbes wrote up this

47
00:02:45,480 --> 00:02:47,550
really nice article for Google and said

48
00:02:47,550 --> 00:02:49,950
hey they're working on this they're

49
00:02:49,950 --> 00:02:52,170
aware of this based solely on this one

50
00:02:52,170 --> 00:02:54,510
forum post from a Google employee that

51
00:02:54,510 --> 00:02:56,430
said they're working on this no

52
00:02:56,430 --> 00:02:59,130
interviewing anyone and I'm a little bit

53
00:02:59,130 --> 00:03:00,660
of a conspiracy theorist I don't know

54
00:03:00,660 --> 00:03:03,330
how much weight this would hold but cool

55
00:03:03,330 --> 00:03:06,470
Google's working on it

56
00:03:07,470 --> 00:03:09,150
it's gonna kind of skip through the

57
00:03:09,150 --> 00:03:11,790
agenda this is a did this talk a few

58
00:03:11,790 --> 00:03:15,360
times as much long longer my demo is

59
00:03:15,360 --> 00:03:18,300
gonna be much shorter here so what is

60
00:03:18,300 --> 00:03:21,930
coalition well I made up the word and I

61
00:03:21,930 --> 00:03:25,860
put it on urban dictionary so it's it's

62
00:03:25,860 --> 00:03:29,340
legit now I have much more upvotes and a

63
00:03:29,340 --> 00:03:31,020
bunch of trolls down voting me too then

64
00:03:31,020 --> 00:03:33,690
from when I took this screenshot but

65
00:03:33,690 --> 00:03:36,380
yeah it's just basically fishing using

66
00:03:36,380 --> 00:03:38,700
calendar and in this case Google

67
00:03:38,700 --> 00:03:44,670
Calendar yeah so used in a sentence this

68
00:03:44,670 --> 00:03:46,110
Google Calendar event is likely a

69
00:03:46,110 --> 00:03:49,110
coalition scam and I'm going to click

70
00:03:49,110 --> 00:03:52,610
these fools and get a shell on their Mac

71
00:03:52,850 --> 00:03:55,380
all right why is this talk relevant to

72
00:03:55,380 --> 00:03:57,810
red and blue teamers well let's start

73
00:03:57,810 --> 00:04:01,830
with red super effective and super easy

74
00:04:01,830 --> 00:04:05,130
to do so if you're working in an

75
00:04:05,130 --> 00:04:07,709
in-house red team and you have a for a

76
00:04:07,709 --> 00:04:10,740
corporation that has sales client-facing

77
00:04:10,740 --> 00:04:17,730
sales or support they make a lotta they

78
00:04:17,730 --> 00:04:18,660
put a lot of stuff on their Google

79
00:04:18,660 --> 00:04:20,459
calendars right especially the reason

80
00:04:20,459 --> 00:04:23,670
obviously they're using gee sweet they

81
00:04:23,670 --> 00:04:26,340
don't really pay attention to you know

82
00:04:26,340 --> 00:04:27,720
that like they'll put something on their

83
00:04:27,720 --> 00:04:29,040
calendar they'll forget about it and

84
00:04:29,040 --> 00:04:31,200
then all of a sudden they'll get a pop

85
00:04:31,200 --> 00:04:33,000
up you know saying hey you got an event

86
00:04:33,000 --> 00:04:34,500
in five minutes where you need to talk

87
00:04:34,500 --> 00:04:36,540
to this person you know a sales meeting

88
00:04:36,540 --> 00:04:40,110
whatnot so yeah they they go cool here's

89
00:04:40,110 --> 00:04:41,780
the zoom link let me click on it

90
00:04:41,780 --> 00:04:43,950
download malicious payload and week we

91
00:04:43,950 --> 00:04:44,910
got a shell

92
00:04:44,910 --> 00:04:48,810
I'm super convincing I've had a lot of

93
00:04:48,810 --> 00:04:51,270
success with this attack so on the other

94
00:04:51,270 --> 00:04:53,010
hand why is this you know how does this

95
00:04:53,010 --> 00:04:55,470
help blue well I heard Dave Kennedy give

96
00:04:55,470 --> 00:04:57,930
a talk once talking about you know you

97
00:04:57,930 --> 00:05:00,390
can you can use all the tactics you want

98
00:05:00,390 --> 00:05:02,160
have a have a wide array attack just to

99
00:05:02,160 --> 00:05:03,900
throw at your blue team but um you

100
00:05:03,900 --> 00:05:05,220
really got to get down to the technique

101
00:05:05,220 --> 00:05:07,470
right this is a newer technique this is

102
00:05:07,470 --> 00:05:12,390
a newer attack vector so you know this

103
00:05:12,390 --> 00:05:14,100
it's it's something that your blue team

104
00:05:14,100 --> 00:05:15,960
might not have seen yet and you can

105
00:05:15,960 --> 00:05:17,490
expose them to it before you actually

106
00:05:17,490 --> 00:05:20,580
see it coming up at them in the wild

107
00:05:20,580 --> 00:05:22,950
helps you can also educate your users

108
00:05:22,950 --> 00:05:26,160
and what to look for you know when there

109
00:05:26,160 --> 00:05:27,930
could be a malicious injection into the

110
00:05:27,930 --> 00:05:30,390
calendar and that's kind of the best way

111
00:05:30,390 --> 00:05:34,190
you can defend against it in my opinion

112
00:05:34,190 --> 00:05:36,630
relevance continued so did some digging

113
00:05:36,630 --> 00:05:41,340
and I think of the at 37 Fortune 1000

114
00:05:41,340 --> 00:05:43,860
companies in Silicon Valley about 17

115
00:05:43,860 --> 00:05:46,680
percent of them used G suite and then I

116
00:05:46,680 --> 00:05:49,170
continued to dig and just random big

117
00:05:49,170 --> 00:05:51,630
companies and I found all the 27 that I

118
00:05:51,630 --> 00:05:53,730
looked at ten of them use G Suites

119
00:05:53,730 --> 00:05:55,290
there's about 37 percent so there's a

120
00:05:55,290 --> 00:05:57,870
lot of G suite customers out there that

121
00:05:57,870 --> 00:06:00,870
are that are vulnerable to attack and I

122
00:06:00,870 --> 00:06:02,010
didn't give you all these names by the

123
00:06:02,010 --> 00:06:08,250
way you did this all on your own yeah so

124
00:06:08,250 --> 00:06:10,560
I normally would go through each step of

125
00:06:10,560 --> 00:06:12,510
this attack but I'm gonna kind of this

126
00:06:12,510 --> 00:06:14,610
again this condensed version I'll have

127
00:06:14,610 --> 00:06:16,320
the links to where I actually have the

128
00:06:16,320 --> 00:06:18,510
step-by-step of things the first thing

129
00:06:18,510 --> 00:06:21,390
if you're if you're working not so much

130
00:06:21,390 --> 00:06:22,850
an in-house red team but maybe a

131
00:06:22,850 --> 00:06:26,130
contractor you know you do find out if

132
00:06:26,130 --> 00:06:29,550
the company you're looking at users G

133
00:06:29,550 --> 00:06:31,280
suite dig is a great tool

134
00:06:31,280 --> 00:06:33,570
sometimes it's super obvious obviously

135
00:06:33,570 --> 00:06:35,669
if I dig on an MX record on google.com

136
00:06:35,669 --> 00:06:37,500
and I see that Google is there their

137
00:06:37,500 --> 00:06:41,640
email kind of stupid but sometimes it's

138
00:06:41,640 --> 00:06:43,200
not as obvious you get something like

139
00:06:43,200 --> 00:06:47,040
you know PPP hosted so you got proof

140
00:06:47,040 --> 00:06:49,730
point protection and cloud protection

141
00:06:49,730 --> 00:06:51,810
you can give it a shot if it's up in the

142
00:06:51,810 --> 00:06:53,520
cloud right you got a chance if you want

143
00:06:53,520 --> 00:06:56,930
to try this but I think even better dig

144
00:06:56,930 --> 00:06:59,430
would be

145
00:06:59,430 --> 00:07:04,500
- so I did on the txt record for Twitter

146
00:07:04,500 --> 00:07:07,440
you can see the the SPF record down here

147
00:07:07,440 --> 00:07:09,389
which is a type of DNS record anybody

148
00:07:09,389 --> 00:07:15,449
familiar with SPF good good so what

149
00:07:15,449 --> 00:07:17,430
happened what can happen if you don't

150
00:07:17,430 --> 00:07:24,500
use SPF under email but no what's that

151
00:07:24,500 --> 00:07:27,030
okay so anyway I'll give you the answer

152
00:07:27,030 --> 00:07:29,729
you can spoof the email so I can send a

153
00:07:29,729 --> 00:07:31,800
send an email as you know if Twitter

154
00:07:31,800 --> 00:07:35,009
didn't have SPF protection I could send

155
00:07:35,009 --> 00:07:37,500
an email to somebody as you know ant-man

156
00:07:37,500 --> 00:07:41,580
at twitter.com so but for us just doing

157
00:07:41,580 --> 00:07:44,699
recon we can see that their SPF is

158
00:07:44,699 --> 00:07:46,409
actually Google pounds of Twitter users

159
00:07:46,409 --> 00:07:50,509
gee sweet for their their email

160
00:07:51,750 --> 00:07:55,110
finally my partner at box Cedric Owens

161
00:07:55,110 --> 00:07:56,990
been doing a lot of talks at der beek on

162
00:07:56,990 --> 00:07:59,400
DEFCON red team village this year first

163
00:07:59,400 --> 00:08:01,020
time they had that there which is

164
00:08:01,020 --> 00:08:03,840
surprising but cool

165
00:08:03,840 --> 00:08:06,270
he created a tool called gobbler which

166
00:08:06,270 --> 00:08:08,400
is really good open source and get it on

167
00:08:08,400 --> 00:08:11,219
github and it you put in a domain name

168
00:08:11,219 --> 00:08:14,360
it does a ton of recon stuff for you

169
00:08:14,360 --> 00:08:20,280
including the SPF tax records you can

170
00:08:20,280 --> 00:08:26,550
find here so again twitter.com so the

171
00:08:26,550 --> 00:08:28,319
way that you get this attack to work is

172
00:08:28,319 --> 00:08:32,399
you have to actually get a Google

173
00:08:32,399 --> 00:08:34,620
account or G suite API key for Google

174
00:08:34,620 --> 00:08:36,390
Calendar super easy to do and again

175
00:08:36,390 --> 00:08:38,039
here's my medium post that will take you

176
00:08:38,039 --> 00:08:39,690
step-by-step normally I would show this

177
00:08:39,690 --> 00:08:47,459
but it's too time-consuming so it takes

178
00:08:47,459 --> 00:08:49,200
me to the tool that I wrote called G

179
00:08:49,200 --> 00:08:51,680
coalesce your open source Python tool

180
00:08:51,680 --> 00:08:55,829
all this really is is I copy so there's

181
00:08:55,829 --> 00:08:58,709
a PowerShell module called mail

182
00:08:58,709 --> 00:09:00,930
sniper by the two black Hill security

183
00:09:00,930 --> 00:09:04,350
guys I mentioned that found this they

184
00:09:04,350 --> 00:09:09,089
have a module called invoke inject G

185
00:09:09,089 --> 00:09:11,560
event API I that's all

186
00:09:11,560 --> 00:09:14,080
PowerShell obviously I took that ported

187
00:09:14,080 --> 00:09:16,090
it over to Python because not everybody

188
00:09:16,090 --> 00:09:17,950
uses Windows I worked on all Mac shops

189
00:09:17,950 --> 00:09:24,580
so this works out much better for me all

190
00:09:24,580 --> 00:09:26,529
right so the demonstration of how this

191
00:09:26,529 --> 00:09:29,370
works let me get out of this slideshow I

192
00:09:29,370 --> 00:09:31,360
guess I'm doing pretty good on time

193
00:09:31,360 --> 00:09:34,140
maybe I could have gone through all that

194
00:09:34,140 --> 00:09:38,339
hopefully the Internet's working

195
00:09:39,180 --> 00:09:40,990
hopefully can you everybody see that

196
00:09:40,990 --> 00:09:52,570
don't need to zoom in make it big okay

197
00:09:52,570 --> 00:09:55,800
so this kind of help menu there's a

198
00:09:55,800 --> 00:09:57,940
semana tour arguments that you're going

199
00:09:57,940 --> 00:10:01,720
to need the tacky is the attacker email

200
00:10:01,720 --> 00:10:04,570
so that's again if we'd go through the

201
00:10:04,570 --> 00:10:06,010
steps that I thought I showed I was

202
00:10:06,010 --> 00:10:09,040
going to show the attacker email you

203
00:10:09,040 --> 00:10:10,420
kind of want it to be something that's

204
00:10:10,420 --> 00:10:14,830
gonna help you fool your victim so in

205
00:10:14,830 --> 00:10:17,080
the case for this demo I created a guy

206
00:10:17,080 --> 00:10:18,250
named John Lear

207
00:10:18,250 --> 00:10:21,100
so I created a gmail address John Lear

208
00:10:21,100 --> 00:10:24,400
dot CCF you know at gmail.com

209
00:10:24,400 --> 00:10:26,320
but the CCF in there CCF was the

210
00:10:26,320 --> 00:10:28,780
fictitious company that this John Lear

211
00:10:28,780 --> 00:10:30,910
works for so make it make it believable

212
00:10:30,910 --> 00:10:33,490
I mean I know it has at gmail calm at

213
00:10:33,490 --> 00:10:35,860
the end of it but you can you can fool a

214
00:10:35,860 --> 00:10:37,210
lot of people if you just throw in a dot

215
00:10:37,210 --> 00:10:41,680
whatever you know on there the attack X

216
00:10:41,680 --> 00:10:44,200
for targets you can put as many targets

217
00:10:44,200 --> 00:10:48,339
as you want these are the victims email

218
00:10:48,339 --> 00:10:51,040
addresses and this comma separated no

219
00:10:51,040 --> 00:10:55,540
spaces the access token that's the

220
00:10:55,540 --> 00:10:57,700
biggest part that I again you can go to

221
00:10:57,700 --> 00:10:59,020
my medium post go through step by step

222
00:10:59,020 --> 00:11:01,150
and get that that's going to give you

223
00:11:01,150 --> 00:11:04,870
the API access that you need the attack

224
00:11:04,870 --> 00:11:06,760
guess which is the start date you need

225
00:11:06,760 --> 00:11:09,850
that and it has to be in this format the

226
00:11:09,850 --> 00:11:13,300
year year year month month day day T

227
00:11:13,300 --> 00:11:16,750
hour hour : minute minute if you don't

228
00:11:16,750 --> 00:11:19,890
do it like that you're getting there and

229
00:11:19,890 --> 00:11:22,720
just want to let you know like this tool

230
00:11:22,720 --> 00:11:24,640
sucks I didn't do any kind of

231
00:11:24,640 --> 00:11:27,519
error checking or argument checking

232
00:11:27,519 --> 00:11:28,660
everything like that but anybody's

233
00:11:28,660 --> 00:11:30,490
welcome to go and github and do that for

234
00:11:30,490 --> 00:11:31,930
me if not I don't give a it still

235
00:11:31,930 --> 00:11:36,490
works so for me and then you have to

236
00:11:36,490 --> 00:11:38,920
have the tak F for the finish date time

237
00:11:38,920 --> 00:11:41,290
which is again the same format and if

238
00:11:41,290 --> 00:11:43,000
you have something wrong again no error

239
00:11:43,000 --> 00:11:45,610
checking you might get like a 401 or 404

240
00:11:45,610 --> 00:11:47,529
not know why you know it works when you

241
00:11:47,529 --> 00:11:48,940
get a two hundred back so that's all I

242
00:11:48,940 --> 00:11:50,410
got for you

243
00:11:50,410 --> 00:11:53,920
the the other optional arguments

244
00:11:53,920 --> 00:11:56,550
important one tak T is the event title

245
00:11:56,550 --> 00:11:58,630
you probably don't want to send a

246
00:11:58,630 --> 00:12:00,040
calendar event to somebody without a

247
00:12:00,040 --> 00:12:03,329
title that could look pretty suspicious

248
00:12:03,329 --> 00:12:09,630
the let's see what else is good on here

249
00:12:09,630 --> 00:12:12,610
attack D the description that's where

250
00:12:12,610 --> 00:12:15,459
you're probably going to you can you can

251
00:12:15,459 --> 00:12:20,019
embed URLs using HTML and that and

252
00:12:20,019 --> 00:12:21,670
that's where your little description of

253
00:12:21,670 --> 00:12:24,160
the events gonna be so get creative I

254
00:12:24,160 --> 00:12:25,930
would I wouldn't recommend skipping that

255
00:12:25,930 --> 00:12:28,120
either but you don't have to put those

256
00:12:28,120 --> 00:12:31,029
if you don't want time zone first time

257
00:12:31,029 --> 00:12:32,589
using the time zone was actually in

258
00:12:32,589 --> 00:12:34,420
Canada last weekend I was like hack fest

259
00:12:34,420 --> 00:12:36,610
and then I used it again here and it

260
00:12:36,610 --> 00:12:39,760
works normally it defaults to Central

261
00:12:39,760 --> 00:12:41,050
Time so if you don't want to be central

262
00:12:41,050 --> 00:12:52,480
time change that one so let me get out

263
00:12:52,480 --> 00:13:00,550
of here before I run this anybody want

264
00:13:00,550 --> 00:13:03,250
about anybody get the Google Calendar on

265
00:13:03,250 --> 00:13:04,240
their phone that wants to give me their

266
00:13:04,240 --> 00:13:08,529
gmail address I'll come on man I know I

267
00:13:08,529 --> 00:13:09,910
told you I was a professional liar but I

268
00:13:09,910 --> 00:13:13,480
swear I won't hack you so anyway I got

269
00:13:13,480 --> 00:13:17,190
to set up for mine so you guys

270
00:13:17,629 --> 00:13:22,059
yeah so as you can see I already got the

271
00:13:22,059 --> 00:13:24,439
API key here told you that as an

272
00:13:24,439 --> 00:13:26,269
important part when all these are

273
00:13:26,269 --> 00:13:28,819
important you can see down here I

274
00:13:28,819 --> 00:13:31,519
embedded a link it created a zoom link

275
00:13:31,519 --> 00:13:35,120
this is actually based on a real you

276
00:13:35,120 --> 00:13:36,860
know calendar invite that I had with a

277
00:13:36,860 --> 00:13:41,769
zoom link on it and then I embedded the

278
00:13:41,769 --> 00:13:46,129
malicious link here before I do that

279
00:13:46,129 --> 00:13:47,689
just want to show you guys this one

280
00:13:47,689 --> 00:13:51,230
thing hopefully you can see this I have

281
00:13:51,230 --> 00:13:52,970
this unchecked so this keep that in mind

282
00:13:52,970 --> 00:13:55,999
automatically add events from Gmail to

283
00:13:55,999 --> 00:13:59,089
my calendar and I think that's unchecked

284
00:13:59,089 --> 00:14:00,620
by default because a lot of people like

285
00:14:00,620 --> 00:14:02,089
when they get you know get the email

286
00:14:02,089 --> 00:14:04,459
from their for their flights or whatever

287
00:14:04,459 --> 00:14:05,720
it automatically adds that to their

288
00:14:05,720 --> 00:14:08,600
calendar this is one of the fixes that

289
00:14:08,600 --> 00:14:10,850
Google said works but it doesn't doesn't

290
00:14:10,850 --> 00:14:12,319
stop the API injection so I just want to

291
00:14:12,319 --> 00:14:14,749
show you before I run this that that's

292
00:14:14,749 --> 00:14:17,139


293
00:14:18,759 --> 00:14:21,920
and hopefully the internet works those

294
00:14:21,920 --> 00:14:24,980
having some problems all right we got

295
00:14:24,980 --> 00:14:26,600
200 right so it worked

296
00:14:26,600 --> 00:14:33,110
yay and there I am got your shells got

297
00:14:33,110 --> 00:14:39,429
my zoom link here so just sorry for a

298
00:14:39,429 --> 00:14:42,439
educational purposes for your people in

299
00:14:42,439 --> 00:14:45,019
your corporation that you want to again

300
00:14:45,019 --> 00:14:46,490
this is kind of same old trick and

301
00:14:46,490 --> 00:14:48,740
emails roll over the hyperlink you're

302
00:14:48,740 --> 00:14:50,870
gonna see down here that it's really not

303
00:14:50,870 --> 00:14:53,059
going to where it says it is here so

304
00:14:53,059 --> 00:14:55,129
something to educate people on of course

305
00:14:55,129 --> 00:14:56,720
you got all this Google garbage at the

306
00:14:56,720 --> 00:14:58,129
beginning so you got to train people to

307
00:14:58,129 --> 00:15:02,209
look past that know how easy that's

308
00:15:02,209 --> 00:15:05,149
going to be but you know it's there so

309
00:15:05,149 --> 00:15:08,540
educate your folks on that so when I

310
00:15:08,540 --> 00:15:15,879
click on the zoom link come on internet

311
00:15:15,879 --> 00:15:18,170
probably get some ads from YouTube

312
00:15:18,170 --> 00:15:19,830
because they love to

313
00:15:19,830 --> 00:15:25,880
yeah maybe yeah you got it yeah

314
00:15:25,880 --> 00:15:32,010
all right sell me some and there we

315
00:15:32,010 --> 00:15:36,090
go I love the rickroll still I'm an

316
00:15:36,090 --> 00:15:36,570
idiot

317
00:15:36,570 --> 00:15:39,780
but it's funny to me every time I get

318
00:15:39,780 --> 00:15:42,210
somebody fall for a rick roll so yeah

319
00:15:42,210 --> 00:15:46,020
that's it that's the tool go back to the

320
00:15:46,020 --> 00:15:59,190
slideshow oh thanks so yeah that's

321
00:15:59,190 --> 00:16:00,360
plenty of time

322
00:16:00,360 --> 00:16:03,060
so moving on command-and-control this is

323
00:16:03,060 --> 00:16:04,470
kind of my bread and butter when I do

324
00:16:04,470 --> 00:16:06,270
these social engineering fishing things

325
00:16:06,270 --> 00:16:08,460
I like I have I build the infrastructure

326
00:16:08,460 --> 00:16:12,510
up in GCP but we create it for a

327
00:16:12,510 --> 00:16:14,790
exercise that we did recently we created

328
00:16:14,790 --> 00:16:17,160
a fake zoom update that's why I use the

329
00:16:17,160 --> 00:16:19,170
zoom link so instead of getting

330
00:16:19,170 --> 00:16:20,940
rickrolled they would go and it would

331
00:16:20,940 --> 00:16:23,000
download a dmg again a Mac environment

332
00:16:23,000 --> 00:16:27,270
and that dmg would actually had a zoom

333
00:16:27,270 --> 00:16:29,790
update app that wrapped around an Apfel

334
00:16:29,790 --> 00:16:32,870
payload anybody here familiar with Apfel

335
00:16:32,870 --> 00:16:36,180
Wow nobody okay you guys don't like

336
00:16:36,180 --> 00:16:40,080
Mac's do you yeah either do i but i want

337
00:16:40,080 --> 00:16:43,200
to attack them so specter ops Cody

338
00:16:43,200 --> 00:16:46,350
Thomas it's a feature created this c2

339
00:16:46,350 --> 00:16:48,720
framework called Apfel and it works

340
00:16:48,720 --> 00:16:51,800
great for macs it's got a JX a payload

341
00:16:51,800 --> 00:16:54,240
works perfect gets around a lot of

342
00:16:54,240 --> 00:16:56,910
Defense's just awesome and he's

343
00:16:56,910 --> 00:16:59,310
constantly updating it so if you if you

344
00:16:59,310 --> 00:17:00,960
get into max or even they have some good

345
00:17:00,960 --> 00:17:03,630
Linux payloads as well check it out

346
00:17:03,630 --> 00:17:05,310
I've been running with it for a while

347
00:17:05,310 --> 00:17:07,079
and again he's constantly updating it

348
00:17:07,079 --> 00:17:09,480
and it's great My partner Cedric Goins

349
00:17:09,480 --> 00:17:11,400
by the way he has a medium post where he

350
00:17:11,400 --> 00:17:13,859
talks about building that up that zoom

351
00:17:13,859 --> 00:17:18,209
app wrapper yeah around the pail up

352
00:17:18,209 --> 00:17:23,130
around the jx8 payload so yeah okay

353
00:17:23,130 --> 00:17:27,420
anybody familiar with a mac hacking and

354
00:17:27,420 --> 00:17:29,520
all right cool all right we got one at

355
00:17:29,520 --> 00:17:30,470
least so

356
00:17:30,470 --> 00:17:32,480
maybe gatekeeper you know what

357
00:17:32,480 --> 00:17:34,639
gatekeeper is so basically it's just

358
00:17:34,639 --> 00:17:38,149
it's a it's a security measure put in by

359
00:17:38,149 --> 00:17:41,269
Apple where it checks to make sure that

360
00:17:41,269 --> 00:17:43,730
an app that you download from a browser

361
00:17:43,730 --> 00:17:46,279
is signed right it has to be signed and

362
00:17:46,279 --> 00:17:47,539
notarized by Apple

363
00:17:47,539 --> 00:17:49,879
now since Kay well I think is before

364
00:17:49,879 --> 00:17:53,059
Catalina during a Mojave they they and

365
00:17:53,059 --> 00:17:54,320
now if you have Catalina

366
00:17:54,320 --> 00:17:56,269
you can't run any Apple apps without it

367
00:17:56,269 --> 00:18:02,149
being notarized so so yeah okay so think

368
00:18:02,149 --> 00:18:04,940
about my zoo map how the hell am I going

369
00:18:04,940 --> 00:18:06,220
to get that around gate keeper right

370
00:18:06,220 --> 00:18:10,220
well so you just register for a Apple

371
00:18:10,220 --> 00:18:14,419
Developer account on our box right the

372
00:18:14,419 --> 00:18:15,799
cool way you can do this is use this

373
00:18:15,799 --> 00:18:17,899
NetSpend and go get one of these prepaid

374
00:18:17,899 --> 00:18:20,960
cards and the cool thing with NetSpend

375
00:18:20,960 --> 00:18:24,200
is you can actually give it an address a

376
00:18:24,200 --> 00:18:25,970
name that links to create a completely

377
00:18:25,970 --> 00:18:29,090
fictitious person fictitious email

378
00:18:29,090 --> 00:18:31,820
address you got yourself a card they'll

379
00:18:31,820 --> 00:18:33,139
actually you got to give them your

380
00:18:33,139 --> 00:18:35,000
address so they're gonna mail you the

381
00:18:35,000 --> 00:18:36,230
card with your name and everything on it

382
00:18:36,230 --> 00:18:38,840
but you can use this prepaid one before

383
00:18:38,840 --> 00:18:41,210
they do that works really well for red

384
00:18:41,210 --> 00:18:43,159
teaming so we go ahead and we spend 100

385
00:18:43,159 --> 00:18:45,220
bucks we get an Apple Developer account

386
00:18:45,220 --> 00:18:53,539
and we get stuff notarized um getting

387
00:18:53,539 --> 00:18:56,769
stuff notarized is actually really easy

388
00:18:56,769 --> 00:18:59,240
takes about three minutes total Apple

389
00:18:59,240 --> 00:19:02,389
notarize is your app right we found out

390
00:19:02,389 --> 00:19:04,789
the hard way though that if you have

391
00:19:04,789 --> 00:19:06,350
anything malicious in it and about a

392
00:19:06,350 --> 00:19:09,230
week they're gonna just cut your your

393
00:19:09,230 --> 00:19:13,000
certs and you no longer can use that but

394
00:19:13,000 --> 00:19:16,309
so you burn a hundred dollars but yeah

395
00:19:16,309 --> 00:19:19,700
you got a week to use it so if you're

396
00:19:19,700 --> 00:19:21,620
cool to spend 100 bucks for a week you

397
00:19:21,620 --> 00:19:24,789
know you can have a good time

398
00:19:27,309 --> 00:19:30,860
so and this is also what happens if you

399
00:19:30,860 --> 00:19:32,539
link your NetSpend account to your real

400
00:19:32,539 --> 00:19:35,059
name and you actually have a developer

401
00:19:35,059 --> 00:19:38,210
account under your real name your certs

402
00:19:38,210 --> 00:19:39,230
are actually going to have your real

403
00:19:39,230 --> 00:19:40,710
name in it so when you

404
00:19:40,710 --> 00:19:44,760
Blue team finds the the payload they'll

405
00:19:44,760 --> 00:19:46,049
see that you're part of the red team so

406
00:19:46,049 --> 00:19:49,010
I learned that one the hard way as well

407
00:19:49,010 --> 00:19:55,789
don't use your real name this is just an

408
00:19:55,789 --> 00:19:59,130
example of that zoom update wrapper that

409
00:19:59,130 --> 00:20:00,539
I was telling you about that's the foo

410
00:20:00,539 --> 00:20:03,929
gots and that's the real pretty similar

411
00:20:03,929 --> 00:20:05,549
we just got rid of the what's new thing

412
00:20:05,549 --> 00:20:06,870
and make sure that all they could do is

413
00:20:06,870 --> 00:20:08,970
update but at that time when they open

414
00:20:08,970 --> 00:20:11,070
that dmg and run it they don't even have

415
00:20:11,070 --> 00:20:13,020
to click that we're already got the situ

416
00:20:13,020 --> 00:20:15,600
or where he got the call back to our

417
00:20:15,600 --> 00:20:19,049
seats you um the way we got burned with

418
00:20:19,049 --> 00:20:22,200
the we found out that when we made the

419
00:20:22,200 --> 00:20:24,059
first developer account we got burned

420
00:20:24,059 --> 00:20:25,230
lost a hundred bucks

421
00:20:25,230 --> 00:20:27,360
because we had this and we had it

422
00:20:27,360 --> 00:20:29,520
calling out to the c2 but we also had it

423
00:20:29,520 --> 00:20:30,210
stealing

424
00:20:30,210 --> 00:20:32,730
obviously stealing credentials there's a

425
00:20:32,730 --> 00:20:34,590
pop-up asking for credentials when we

426
00:20:34,590 --> 00:20:36,480
took that out I'm still going strong for

427
00:20:36,480 --> 00:20:38,429
about a month and Apple has not killed

428
00:20:38,429 --> 00:20:42,539
my my malware yet so just don't make it

429
00:20:42,539 --> 00:20:44,700
obvious to and you can you can go that

430
00:20:44,700 --> 00:20:48,899
hundred bucks just take you far so how

431
00:20:48,899 --> 00:20:50,669
do we stop this right google says this

432
00:20:50,669 --> 00:20:55,169
is a feature okay I thought I had a

433
00:20:55,169 --> 00:20:56,760
partial fix once I was in the shower

434
00:20:56,760 --> 00:20:58,710
like jumped out but naked random my

435
00:20:58,710 --> 00:20:59,850
computer's that came up with this

436
00:20:59,850 --> 00:21:04,440
Epiphany you know that it basically what

437
00:21:04,440 --> 00:21:07,409
I was like okay if I if I can have burp

438
00:21:07,409 --> 00:21:09,779
suite running and I can do the API

439
00:21:09,779 --> 00:21:12,840
injection versus a normal Edition event

440
00:21:12,840 --> 00:21:14,669
edition to counter some sort of

441
00:21:14,669 --> 00:21:18,480
difference um so yeah I thought okay

442
00:21:18,480 --> 00:21:22,110
well the person that you're injecting

443
00:21:22,110 --> 00:21:24,630
into might still have have that invite

444
00:21:24,630 --> 00:21:26,909
come to their phone but who cares right

445
00:21:26,909 --> 00:21:28,529
now my job is to protect the enterprise

446
00:21:28,529 --> 00:21:31,169
I don't give a about your phone so

447
00:21:31,169 --> 00:21:34,620
yeah it's partial fix right yeah I was

448
00:21:34,620 --> 00:21:39,720
wrong and that didn't work so there

449
00:21:39,720 --> 00:21:41,880
really is no difference that I can see

450
00:21:41,880 --> 00:21:45,299
I'm also not like you know super skilled

451
00:21:45,299 --> 00:21:49,530
on picking out the fine details of

452
00:21:49,530 --> 00:21:53,820
HTTP posts so if anybody else is that

453
00:21:53,820 --> 00:21:56,010
might be something that he could help me

454
00:21:56,010 --> 00:21:58,380
look into you cool thing is some of the

455
00:21:58,380 --> 00:22:00,540
guys on the blue team at box um I

456
00:22:00,540 --> 00:22:01,830
started meeting with them come up with

457
00:22:01,830 --> 00:22:03,210
ideas after I pulled the out of

458
00:22:03,210 --> 00:22:07,500
everybody guy Brandon he's on the red

459
00:22:07,500 --> 00:22:09,000
team with me he thought about well maybe

460
00:22:09,000 --> 00:22:12,059
there's like a time discrepancy right so

461
00:22:12,059 --> 00:22:15,570
like because you're making an API

462
00:22:15,570 --> 00:22:18,870
calling it instantly as the ads the

463
00:22:18,870 --> 00:22:21,419
event to somebody's calendar that's

464
00:22:21,419 --> 00:22:23,010
unnatural right of humans not gonna

465
00:22:23,010 --> 00:22:25,230
instantly you know accept the the invite

466
00:22:25,230 --> 00:22:28,460
so maybe there's a difference in time

467
00:22:28,460 --> 00:22:30,299
something we're still looking into

468
00:22:30,299 --> 00:22:34,020
haven't found that I'll tell you why and

469
00:22:34,020 --> 00:22:38,429
then one of our analysts ben Phillips

470
00:22:38,429 --> 00:22:41,809
also came up with the idea that is

471
00:22:41,809 --> 00:22:45,600
pretty cool looking at the user agent

472
00:22:45,600 --> 00:22:48,510
string you can identify that like my app

473
00:22:48,510 --> 00:22:52,650
is a Python app right so it's it can

474
00:22:52,650 --> 00:22:56,250
stop script kiddies that maybe just grab

475
00:22:56,250 --> 00:22:59,190
your tool of course right after he found

476
00:22:59,190 --> 00:23:00,960
that I went and add it into my tool

477
00:23:00,960 --> 00:23:02,520
where you could change a user agent

478
00:23:02,520 --> 00:23:06,450
string so him but that's kind of

479
00:23:06,450 --> 00:23:07,770
like the you know the back and forth

480
00:23:07,770 --> 00:23:09,230
between red and blue

481
00:23:09,230 --> 00:23:12,480
obviously he came up with a fix I had to

482
00:23:12,480 --> 00:23:14,220
come up with a you know workaround the

483
00:23:14,220 --> 00:23:17,820
fix fun times right so yeah we were all

484
00:23:17,820 --> 00:23:19,290
like okay cool we can stop script

485
00:23:19,290 --> 00:23:22,410
kiddies with this and then we took a

486
00:23:22,410 --> 00:23:26,970
look at Google's like lag time between

487
00:23:26,970 --> 00:23:29,910
getting us the logs and I don't know if

488
00:23:29,910 --> 00:23:31,320
you can read this but it says one to

489
00:23:31,320 --> 00:23:34,470
three days so yeah that doesn't work out

490
00:23:34,470 --> 00:23:36,990
for us we can't really catch stuff in

491
00:23:36,990 --> 00:23:39,990
real time um turns out it's not actually

492
00:23:39,990 --> 00:23:44,450
that long but it's I think it was like

493
00:23:44,450 --> 00:23:46,919
much would like maybe close to an hour

494
00:23:46,919 --> 00:23:48,360
or something when we were getting logs

495
00:23:48,360 --> 00:23:52,380
still not there still on Sat I mean we

496
00:23:52,380 --> 00:23:55,100
need to see this stuff in real time so

497
00:23:55,100 --> 00:23:57,630
the thing is is like all right well

498
00:23:57,630 --> 00:24:00,080
maybe Google is

499
00:24:00,080 --> 00:24:01,820
the only one that can fix this for us

500
00:24:01,820 --> 00:24:04,070
maybe not maybe there's a lot of smart

501
00:24:04,070 --> 00:24:05,810
blue teamers from yesterday's talk so

502
00:24:05,810 --> 00:24:07,040
when we go out there if you have any

503
00:24:07,040 --> 00:24:09,170
ideas man I'm open to listening to them

504
00:24:09,170 --> 00:24:11,860
because my job as red teamers to help

505
00:24:11,860 --> 00:24:15,140
help our blue teamers learn and you know

506
00:24:15,140 --> 00:24:17,990
flex their muscles two different attacks

507
00:24:17,990 --> 00:24:21,860
and you know set up our defenses so the

508
00:24:21,860 --> 00:24:26,920
work so yeah back to this checkbox thing

509
00:24:26,920 --> 00:24:30,410
this is I I don't know if you guys saw

510
00:24:30,410 --> 00:24:31,940
but like there's Twitter kind of

511
00:24:31,940 --> 00:24:34,280
exploded maybe a month or more ago with

512
00:24:34,280 --> 00:24:35,630
all the spam coming in on Google

513
00:24:35,630 --> 00:24:37,310
calendars it was just after I finished

514
00:24:37,310 --> 00:24:39,800
writing this this talk and all of a

515
00:24:39,800 --> 00:24:41,180
sudden everybody in the cybersecurity

516
00:24:41,180 --> 00:24:43,130
community wanted to have a medium post

517
00:24:43,130 --> 00:24:44,840
though you can fix that you can fix that

518
00:24:44,840 --> 00:24:46,430
and this was their fix and I just showed

519
00:24:46,430 --> 00:24:47,660
you obviously that's like

520
00:24:47,660 --> 00:24:49,700
that's not a fix but if they were to

521
00:24:49,700 --> 00:24:53,750
read the Black Hills security paper yeah

522
00:24:53,750 --> 00:24:55,730
they would have known that actually

523
00:24:55,730 --> 00:24:58,580
those guys wrote that this only fixed

524
00:24:58,580 --> 00:25:00,650
the there was two versions there was an

525
00:25:00,650 --> 00:25:02,360
email injection there was API injection

526
00:25:02,360 --> 00:25:04,640
it stopped the email injection but as we

527
00:25:04,640 --> 00:25:05,960
just saw it doesn't stop the API

528
00:25:05,960 --> 00:25:12,920
injection yeah so that's it normally I

529
00:25:12,920 --> 00:25:14,480
take questions but I think we're about

530
00:25:14,480 --> 00:25:17,600
out of time so take them out there and

531
00:25:17,600 --> 00:25:20,180
if anybody wants here's like all the

532
00:25:20,180 --> 00:25:25,190
references and github take pictures

533
00:25:25,190 --> 00:25:31,160
whatever and I just got it right on the

534
00:25:31,160 --> 00:25:35,570
end so finally the most important point

535
00:25:35,570 --> 00:25:37,760
most important takeaway from this talk I

536
00:25:37,760 --> 00:25:41,240
got I got to tell you is Epstein did not

537
00:25:41,240 --> 00:25:43,740
kill himself

538
00:25:43,740 --> 00:25:51,809
[Applause]

539
00:25:51,809 --> 00:25:57,999
thanks amen is awesome so I if anyone

540
00:25:57,999 --> 00:26:00,549
has any questions for him we can move it

541
00:26:00,549 --> 00:26:02,379
out to the patio get some drinks and

542
00:26:02,379 --> 00:26:04,809
talk to each other I do have one other

543
00:26:04,809 --> 00:26:06,759
announcement for anyone that's doing

544
00:26:06,759 --> 00:26:12,070
skydiving tomorrow for a fun day we all

545
00:26:12,070 --> 00:26:15,220
have to meet at the registration desk at

546
00:26:15,220 --> 00:26:17,950
1:00 p.m. so if if you're doing

547
00:26:17,950 --> 00:26:20,110
skydiving just keep that in mind 1 p.m.

548
00:26:20,110 --> 00:26:22,240
go to the registration desk all right

549
00:26:22,240 --> 00:26:25,299
but yeah give it up again for ant-man

550
00:26:25,299 --> 00:26:27,550
and we'll we'll see you outside

551
00:26:27,550 --> 00:26:35,040
[Applause]

552
00:26:35,650 --> 00:26:39,179
[Music]

