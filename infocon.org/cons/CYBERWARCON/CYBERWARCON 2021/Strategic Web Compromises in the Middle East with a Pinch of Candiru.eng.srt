1
00:00:00,399 --> 00:00:02,560
hello i'm very happy to be back at

2
00:00:02,560 --> 00:00:04,960
cyborocon and thank john for organizing

3
00:00:04,960 --> 00:00:07,359
this great conference again

4
00:00:07,359 --> 00:00:09,200
today i'm going to talk about large

5
00:00:09,200 --> 00:00:11,679
strategic web compromise campaigns that

6
00:00:11,679 --> 00:00:14,320
we first encountered last year and what

7
00:00:14,320 --> 00:00:16,079
is interesting with this campaign is

8
00:00:16,079 --> 00:00:17,920
that it shows a link with a private

9
00:00:17,920 --> 00:00:21,199
spiral firm known as candio

10
00:00:21,199 --> 00:00:23,279
first a quick who am i i've been a

11
00:00:23,279 --> 00:00:25,519
researcher at eset for a bit more than

12
00:00:25,519 --> 00:00:26,880
five years

13
00:00:26,880 --> 00:00:28,640
my day-to-day job is to perform

14
00:00:28,640 --> 00:00:30,640
technical analysis of targeted attacks

15
00:00:30,640 --> 00:00:32,320
so it includes reverse engineering

16
00:00:32,320 --> 00:00:34,719
forensic threatening and of course

17
00:00:34,719 --> 00:00:38,480
giving presentation from taking time

18
00:00:38,640 --> 00:00:41,840
first let me take you back to the 2017

19
00:00:41,840 --> 00:00:44,480
edition of buttconf which is a technical

20
00:00:44,480 --> 00:00:46,079
security conference

21
00:00:46,079 --> 00:00:49,520
held every year in france

22
00:00:50,000 --> 00:00:52,800
that year a fellow researcher felix emme

23
00:00:52,800 --> 00:00:55,600
presented a tool he called nikola i

24
00:00:55,600 --> 00:00:58,239
developed this custom system to discover

25
00:00:58,239 --> 00:01:00,480
watering oils on the internet and the

26
00:01:00,480 --> 00:01:02,399
slides are available online and you can

27
00:01:02,399 --> 00:01:06,320
check them there is a link right here

28
00:01:08,000 --> 00:01:09,920
so i believe most of you

29
00:01:09,920 --> 00:01:11,840
know what the watering or strategic web

30
00:01:11,840 --> 00:01:14,000
compromise is but i'd like to make sure

31
00:01:14,000 --> 00:01:16,960
that we're all on the same page so let's

32
00:01:16,960 --> 00:01:19,360
imagine that a guy named john runs a

33
00:01:19,360 --> 00:01:21,200
security conference and wants to order

34
00:01:21,200 --> 00:01:24,000
custom socks for all participants

35
00:01:24,000 --> 00:01:26,240
so of course any resemblance to real

36
00:01:26,240 --> 00:01:28,000
persons living or dead is poorly

37
00:01:28,000 --> 00:01:30,720
coincidental

38
00:01:31,119 --> 00:01:32,320
so

39
00:01:32,320 --> 00:01:33,960
john connects to

40
00:01:33,960 --> 00:01:37,280
mycustomsocks.com to other custom socks

41
00:01:37,280 --> 00:01:39,600
um

42
00:01:39,759 --> 00:01:41,920
sorry

43
00:01:41,920 --> 00:01:42,799
and

44
00:01:42,799 --> 00:01:45,520
but a person linked to an apt group knew

45
00:01:45,520 --> 00:01:46,640
that john will connect to

46
00:01:46,640 --> 00:01:48,240
microsomestocks.com

47
00:01:48,240 --> 00:01:49,680
so what they did

48
00:01:49,680 --> 00:01:51,439
they compromised the website and

49
00:01:51,439 --> 00:01:53,040
including a small piece of javascript

50
00:01:53,040 --> 00:01:54,960
code in it

51
00:01:54,960 --> 00:01:57,479
so next time john connects to

52
00:01:57,479 --> 00:01:59,759
mycustomsocks.com this small javascript

53
00:01:59,759 --> 00:02:01,439
runs in the background will fingerprint

54
00:02:01,439 --> 00:02:04,079
his browser and if the attacker thinks

55
00:02:04,079 --> 00:02:05,759
he is an interesting target they will

56
00:02:05,759 --> 00:02:09,119
deliver him an exploit to take control

57
00:02:09,119 --> 00:02:11,120
first of its browser and then office

58
00:02:11,120 --> 00:02:12,800
device

59
00:02:12,800 --> 00:02:14,560
and what is important is that it shows

60
00:02:14,560 --> 00:02:17,920
that my custom sucks is just a vector to

61
00:02:17,920 --> 00:02:21,799
reach the final target

62
00:02:22,319 --> 00:02:23,280
so

63
00:02:23,280 --> 00:02:26,480
systems like nikola are relatively easy

64
00:02:26,480 --> 00:02:28,959
to understand they first regularly

65
00:02:28,959 --> 00:02:32,239
process a predefined list of legitimate

66
00:02:32,239 --> 00:02:34,000
websites high profile websites belonging

67
00:02:34,000 --> 00:02:38,480
to governments media outlets ngos etc

68
00:02:38,480 --> 00:02:41,120
then it analyzes the javascript code for

69
00:02:41,120 --> 00:02:42,720
example every day

70
00:02:42,720 --> 00:02:45,760
or manufactur also analyze iframes

71
00:02:45,760 --> 00:02:48,000
redirections to check for any malicious

72
00:02:48,000 --> 00:02:50,080
contents and then it applies customer

73
00:02:50,080 --> 00:02:52,160
heuristics to remove more most false

74
00:02:52,160 --> 00:02:54,640
positives so now every day you have

75
00:02:54,640 --> 00:02:56,720
access to a list of potentially

76
00:02:56,720 --> 00:02:58,959
compromised websites that you can

77
00:02:58,959 --> 00:03:02,159
investigate manually

78
00:03:02,879 --> 00:03:05,040
after the conference i was really

79
00:03:05,040 --> 00:03:06,480
inspired by

80
00:03:06,480 --> 00:03:08,959
by felix storch so we decided to build

81
00:03:08,959 --> 00:03:11,599
our own version of nikrollo

82
00:03:11,599 --> 00:03:14,159
and after a few lines of code we are now

83
00:03:14,159 --> 00:03:17,920
able to analyze 6000 websites every day

84
00:03:17,920 --> 00:03:20,159
and it enables us to discover water

85
00:03:20,159 --> 00:03:21,680
animals on the internet as soon as

86
00:03:21,680 --> 00:03:22,800
they're live

87
00:03:22,800 --> 00:03:25,120
giving us more chances to grab the final

88
00:03:25,120 --> 00:03:27,599
payloads

89
00:03:29,200 --> 00:03:31,360
so just a few weeks after it was put

90
00:03:31,360 --> 00:03:32,879
into prediction it started to give

91
00:03:32,879 --> 00:03:34,959
interesting results so for example in

92
00:03:34,959 --> 00:03:38,159
november 2018 we detected a supply chain

93
00:03:38,159 --> 00:03:39,040
attack

94
00:03:39,040 --> 00:03:40,879
on an analytics

95
00:03:40,879 --> 00:03:43,120
website called statconter and the goal

96
00:03:43,120 --> 00:03:45,840
of the attack was to

97
00:03:45,840 --> 00:03:48,159
bitcoins from a cryptocurrency currency

98
00:03:48,159 --> 00:03:50,480
exchange called get.ios that was using

99
00:03:50,480 --> 00:03:52,239
step counter at that time

100
00:03:52,239 --> 00:03:55,439
and a few weeks after we found another

101
00:03:55,439 --> 00:03:57,200
watering wall attacks targeting many

102
00:03:57,200 --> 00:03:59,120
different websites in southeast asia and

103
00:03:59,120 --> 00:04:01,840
we were able to link this

104
00:04:01,840 --> 00:04:04,560
attack to a apt group called ocean

105
00:04:04,560 --> 00:04:05,760
lodges

106
00:04:05,760 --> 00:04:08,319
these are just a few examples

107
00:04:08,319 --> 00:04:10,640
and we found few more cases in the

108
00:04:10,640 --> 00:04:12,959
following years

109
00:04:12,959 --> 00:04:15,840
now let's jump to july 2020

110
00:04:15,840 --> 00:04:18,639
when we first noticed the strategic web

111
00:04:18,639 --> 00:04:22,320
compromise i'm talking about today

112
00:04:22,320 --> 00:04:24,080
that day i was reviewing suspicious

113
00:04:24,080 --> 00:04:26,639
javascript code reported by our system

114
00:04:26,639 --> 00:04:29,280
and my curiosity was arose by a piece of

115
00:04:29,280 --> 00:04:31,199
javascript code ejected him to the

116
00:04:31,199 --> 00:04:33,280
website of the iranian embassy in abu

117
00:04:33,280 --> 00:04:34,880
dhabi

118
00:04:34,880 --> 00:04:36,639
the script was loaded from a remote

119
00:04:36,639 --> 00:04:38,720
server called pwx.com

120
00:04:38,720 --> 00:04:41,440
and it injects two pieces of javascript

121
00:04:41,440 --> 00:04:44,160
code one to do the location and another

122
00:04:44,160 --> 00:04:46,479
from samedomanpurits.com

123
00:04:46,479 --> 00:04:48,800
whose

124
00:04:49,120 --> 00:04:51,360
purpose will be detailed later

125
00:04:51,360 --> 00:04:53,360
and this quickly looks suspicious and we

126
00:04:53,360 --> 00:04:55,440
realized that the domain periodics.com

127
00:04:55,440 --> 00:04:58,000
was no longer owned by the matamore web

128
00:04:58,000 --> 00:05:00,880
analytics platform but was registered by

129
00:05:00,880 --> 00:05:04,639
someone else for malicious purpose

130
00:05:05,199 --> 00:05:05,919
so

131
00:05:05,919 --> 00:05:07,440
before continuing this presentation i'd

132
00:05:07,440 --> 00:05:08,720
like to include

133
00:05:08,720 --> 00:05:10,320
that on the fact that all information

134
00:05:10,320 --> 00:05:12,400
using these workshops research was

135
00:05:12,400 --> 00:05:14,560
available online and in other words we

136
00:05:14,560 --> 00:05:16,639
don't have telemetry from any of the

137
00:05:16,639 --> 00:05:19,600
compromised websites

138
00:05:20,320 --> 00:05:23,919
so so far we have one compromise website

139
00:05:23,919 --> 00:05:25,680
and one cnc server

140
00:05:25,680 --> 00:05:28,800
so one thing we can do it to start it

141
00:05:28,800 --> 00:05:31,280
is to start using passive dns data so

142
00:05:31,280 --> 00:05:33,759
based on the ip address of

143
00:05:33,759 --> 00:05:35,759
the sense server we add we found many

144
00:05:35,759 --> 00:05:37,039
more domains

145
00:05:37,039 --> 00:05:39,680
all impersonating url shorteners so they

146
00:05:39,680 --> 00:05:44,479
are all variation of legitimate services

147
00:05:45,199 --> 00:05:47,759
based on this new list we found few more

148
00:05:47,759 --> 00:05:49,440
compromised websites

149
00:05:49,440 --> 00:05:53,039
and it turns out that in 2020 there were

150
00:05:53,039 --> 00:05:55,039
at least five different compromise

151
00:05:55,039 --> 00:05:57,759
websites so as mentioned previously the

152
00:05:57,759 --> 00:05:59,600
iranian ministry of foreign affairs and

153
00:05:59,600 --> 00:06:01,840
many of its own bases

154
00:06:01,840 --> 00:06:04,240
but all these websites were hosted at

155
00:06:04,240 --> 00:06:07,840
subdomain of the main mfa website

156
00:06:07,840 --> 00:06:10,400
then there is a tv channel in lebanon

157
00:06:10,400 --> 00:06:12,960
called el mana which is affiliated with

158
00:06:12,960 --> 00:06:15,440
hezbollah

159
00:06:15,440 --> 00:06:17,280
than in germany

160
00:06:17,280 --> 00:06:18,800
sorry no in

161
00:06:18,800 --> 00:06:21,440
in the uk an online newspaper covering

162
00:06:21,440 --> 00:06:24,000
uh the middle east so this newspaper is

163
00:06:24,000 --> 00:06:26,880
called the middle east eye

164
00:06:26,880 --> 00:06:29,520
yes germany uh medical

165
00:06:29,520 --> 00:06:31,680
trade fair uh this one is a bit

166
00:06:31,680 --> 00:06:34,000
different i will come back on this later

167
00:06:34,000 --> 00:06:36,080
and finally an italian aerospace and

168
00:06:36,080 --> 00:06:38,800
defense company called phd aerospace and

169
00:06:38,800 --> 00:06:41,120
at that time in 2020 they were owned by

170
00:06:41,120 --> 00:06:43,840
a fund from the united emirates arab

171
00:06:43,840 --> 00:06:46,319
emirates

172
00:06:46,319 --> 00:06:48,080
what is different from

173
00:06:48,080 --> 00:06:49,840
the german medical culture is that

174
00:06:49,840 --> 00:06:53,360
attacker register medicare.transfer.co

175
00:06:53,360 --> 00:06:55,280
while the legitimate website is

176
00:06:55,280 --> 00:06:58,280
medica.stratfor.com

177
00:06:58,400 --> 00:07:00,720
so they did not compromise the official

178
00:07:00,720 --> 00:07:03,840
website but

179
00:07:04,479 --> 00:07:07,360
uh yeah they created a new one and what

180
00:07:07,360 --> 00:07:09,360
is interesting is it was hosted at a

181
00:07:09,360 --> 00:07:11,199
very specific hosting provider called

182
00:07:11,199 --> 00:07:14,319
server astra that also hosts many of the

183
00:07:14,319 --> 00:07:17,360
other cnc servers this this tradactor is

184
00:07:17,360 --> 00:07:19,680
using

185
00:07:19,759 --> 00:07:21,759
so the attackers simply cloned the

186
00:07:21,759 --> 00:07:24,319
official website and added a small piece

187
00:07:24,319 --> 00:07:26,400
of javascript code in it so

188
00:07:26,400 --> 00:07:28,960
this is very similar to what they did

189
00:07:28,960 --> 00:07:31,039
at the iranian embassy website but

190
00:07:31,039 --> 00:07:33,199
instead of compromising the the website

191
00:07:33,199 --> 00:07:36,960
they just create a fake one

192
00:07:37,680 --> 00:07:39,680
so we believe attackers were unable to

193
00:07:39,680 --> 00:07:42,160
compromise the main website and so had

194
00:07:42,160 --> 00:07:44,400
to uh clone it

195
00:07:44,400 --> 00:07:45,840
unfortunately

196
00:07:45,840 --> 00:07:48,479
it's not clear how visitors would run on

197
00:07:48,479 --> 00:07:50,800
this website because it did it did not

198
00:07:50,800 --> 00:07:53,039
appear in the first google results so

199
00:07:53,039 --> 00:07:55,280
maybe attackers were expecting

200
00:07:55,280 --> 00:07:58,080
people to mistype the official website

201
00:07:58,080 --> 00:07:58,879
or

202
00:07:58,879 --> 00:08:00,560
it's also possible that it was used as

203
00:08:00,560 --> 00:08:04,000
part of a spearfishing campaign

204
00:08:04,960 --> 00:08:07,360
so now let's do a quick technical

205
00:08:07,360 --> 00:08:10,560
analysis of the scripts they use in 2020

206
00:08:10,560 --> 00:08:12,560
and fortunately for most of you i don't

207
00:08:12,560 --> 00:08:16,160
have any ideas for screenshot today

208
00:08:16,160 --> 00:08:17,599
so this is a

209
00:08:17,599 --> 00:08:19,039
manuscript

210
00:08:19,039 --> 00:08:21,120
loaded from the cnc server

211
00:08:21,120 --> 00:08:22,800
as you can see at the beginning a

212
00:08:22,800 --> 00:08:24,720
malware developer prepares the script

213
00:08:24,720 --> 00:08:27,759
with a copy of the jquery browser

214
00:08:27,759 --> 00:08:30,080
plug-in header probably in order to

215
00:08:30,080 --> 00:08:32,159
avoid raising suspicion but

216
00:08:32,159 --> 00:08:34,559
unfortunately for them my mouse will

217
00:08:34,559 --> 00:08:38,880
work just fine and we can scroll down

218
00:08:39,360 --> 00:08:41,599
who arrived to this function that

219
00:08:41,599 --> 00:08:44,800
use an external library called geogs

220
00:08:44,800 --> 00:08:45,760
to

221
00:08:45,760 --> 00:08:48,080
get the location of the visitor based on

222
00:08:48,080 --> 00:08:49,839
its ip address

223
00:08:49,839 --> 00:08:52,399
then we if we scroll down again we have

224
00:08:52,399 --> 00:08:54,399
this function that will get the browser

225
00:08:54,399 --> 00:08:57,040
name of the browser of the visitor

226
00:08:57,040 --> 00:08:59,440
and a very similar function that will

227
00:08:59,440 --> 00:09:02,640
get the operating system of the visitor

228
00:09:02,640 --> 00:09:06,640
then we'll learn to to the main function

229
00:09:06,640 --> 00:09:08,399
first interesting thing is that it

230
00:09:08,399 --> 00:09:10,880
checks if the platform platform is

231
00:09:10,880 --> 00:09:13,680
either windows or macos meaning that

232
00:09:13,680 --> 00:09:16,399
they are not targeting people running uh

233
00:09:16,399 --> 00:09:18,959
or visiting this website from smartphone

234
00:09:18,959 --> 00:09:19,839
which

235
00:09:19,839 --> 00:09:22,720
while from most watering all attacks in

236
00:09:22,720 --> 00:09:24,640
the middle east from normal one

237
00:09:24,640 --> 00:09:26,399
attackers are targeting dissidents they

238
00:09:26,399 --> 00:09:28,959
really want to infect smartphones but

239
00:09:28,959 --> 00:09:31,279
that's not the case here

240
00:09:31,279 --> 00:09:32,800
then they check for

241
00:09:32,800 --> 00:09:35,279
list of browser it includes

242
00:09:35,279 --> 00:09:38,399
most most common browsers

243
00:09:38,399 --> 00:09:40,399
after that they send an http request to

244
00:09:40,399 --> 00:09:43,120
the cnc server

245
00:09:43,120 --> 00:09:45,600
the reply is decrypted using aes and an

246
00:09:45,600 --> 00:09:47,040
art credit key

247
00:09:47,040 --> 00:09:48,080
and

248
00:09:48,080 --> 00:09:50,160
finally the script expects the decrypted

249
00:09:50,160 --> 00:09:52,959
value to be a valid url and if it's if

250
00:09:52,959 --> 00:09:54,720
it's the case they create an iframe

251
00:09:54,720 --> 00:09:58,240
pointing to to that resource

252
00:09:58,240 --> 00:10:00,399
so

253
00:10:00,720 --> 00:10:01,519
the

254
00:10:01,519 --> 00:10:04,240
the what is in this url will be loaded

255
00:10:04,240 --> 00:10:08,000
in the context of the visitor browser

256
00:10:08,000 --> 00:10:10,560
unfortunately we never got a

257
00:10:10,560 --> 00:10:12,560
valid url

258
00:10:12,560 --> 00:10:15,360
so we were unable to get the final

259
00:10:15,360 --> 00:10:16,959
so the browser exploit or the final

260
00:10:16,959 --> 00:10:19,040
payload

261
00:10:19,040 --> 00:10:21,360
and

262
00:10:21,360 --> 00:10:24,240
this shows attacker carefully selects

263
00:10:24,240 --> 00:10:26,079
their targets based on fingerprinting

264
00:10:26,079 --> 00:10:27,360
information that the browser of the

265
00:10:27,360 --> 00:10:30,160
visitor sent to the cnc server

266
00:10:30,160 --> 00:10:32,399
so the yellow list is still on the

267
00:10:32,399 --> 00:10:34,320
attacker server so we don't know exactly

268
00:10:34,320 --> 00:10:36,160
what are the the conditions to to get

269
00:10:36,160 --> 00:10:38,000
the payload but it probably contains

270
00:10:38,000 --> 00:10:40,480
specific ip ranges that attacker are

271
00:10:40,480 --> 00:10:42,800
targeting so i believe that attackers

272
00:10:42,800 --> 00:10:44,240
know uh

273
00:10:44,240 --> 00:10:45,680
before launching the attack the ip

274
00:10:45,680 --> 00:10:48,719
address of their victims

275
00:10:49,200 --> 00:10:52,079
and unfortunately in august 2020 they

276
00:10:52,079 --> 00:10:53,279
went dark

277
00:10:53,279 --> 00:10:56,079
so in the next few months i was bored

278
00:10:56,079 --> 00:10:58,000
and i thought that i may i had missed my

279
00:10:58,000 --> 00:10:59,120
chance to know more about this

280
00:10:59,120 --> 00:11:01,920
trajectory but fortunately

281
00:11:01,920 --> 00:11:06,079
in january 2021 they were back

282
00:11:06,959 --> 00:11:10,240
one day i was again re reviewing a

283
00:11:10,240 --> 00:11:13,040
potential script reported by our system

284
00:11:13,040 --> 00:11:15,360
and i found this script that was

285
00:11:15,360 --> 00:11:17,600
injected into the website of the mini

286
00:11:17,600 --> 00:11:19,680
suef interior of yemen

287
00:11:19,680 --> 00:11:22,000
and what is interesting

288
00:11:22,000 --> 00:11:23,760
is that it loads

289
00:11:23,760 --> 00:11:25,839
another script from a domain called

290
00:11:25,839 --> 00:11:28,320
visitortrack.net

291
00:11:28,320 --> 00:11:30,000
and what it

292
00:11:30,000 --> 00:11:32,240
is interesting is because it's again a

293
00:11:32,240 --> 00:11:34,000
domain impersonating a web analytics

294
00:11:34,000 --> 00:11:35,200
services

295
00:11:35,200 --> 00:11:39,519
as for pwx.com the year before

296
00:11:40,720 --> 00:11:43,760
so based on this new cnc server we build

297
00:11:43,760 --> 00:11:45,680
some kind of

298
00:11:45,680 --> 00:11:47,600
fingerprints on characteristic of the

299
00:11:47,600 --> 00:11:50,160
servers and using schrodinger we were

300
00:11:50,160 --> 00:11:53,519
able to to find uh 20 different cnc

301
00:11:53,519 --> 00:11:55,680
servers that were used from january to

302
00:11:55,680 --> 00:11:58,880
june 2021

303
00:11:59,680 --> 00:12:01,519
so as mentioned previously attackers

304
00:12:01,519 --> 00:12:04,079
like impersonating either url shorteners

305
00:12:04,079 --> 00:12:06,240
or web antique services but sometimes

306
00:12:06,240 --> 00:12:08,160
they also impersonate from a

307
00:12:08,160 --> 00:12:10,880
digital marketing agency or bootstrap

308
00:12:10,880 --> 00:12:13,519
bootstrap cdn

309
00:12:13,519 --> 00:12:14,399
and

310
00:12:14,399 --> 00:12:16,480
for bootstrapcdn.net

311
00:12:16,480 --> 00:12:19,040
an interesting thing is it was a

312
00:12:19,040 --> 00:12:21,600
legitimate website a few years ago so it

313
00:12:21,600 --> 00:12:24,320
was a cdn for bootstrap so there are

314
00:12:24,320 --> 00:12:26,320
still legitimate websites trying to

315
00:12:26,320 --> 00:12:27,600
fetch

316
00:12:27,600 --> 00:12:30,079
libraries from from this domain while

317
00:12:30,079 --> 00:12:32,000
while it's now in under control of the

318
00:12:32,000 --> 00:12:33,200
attackers

319
00:12:33,200 --> 00:12:35,440
so those websites that have nothing to

320
00:12:35,440 --> 00:12:37,279
do with the current water angle

321
00:12:37,279 --> 00:12:38,480
complaints can

322
00:12:38,480 --> 00:12:40,560
actually be controlled by the attacker

323
00:12:40,560 --> 00:12:43,279
if they wanted so it's kind of dangerous

324
00:12:43,279 --> 00:12:45,360
situation

325
00:12:45,360 --> 00:12:47,920
oh and like all domains there are

326
00:12:47,920 --> 00:12:50,399
variations of the real things so domain

327
00:12:50,399 --> 00:12:54,480
so generally they just change the tld

328
00:12:55,519 --> 00:12:58,480
so in 2020 we found more than 20

329
00:12:58,480 --> 00:13:00,399
different targets most of them are

330
00:13:00,399 --> 00:13:04,079
located in yemen and are either granted

331
00:13:04,079 --> 00:13:06,880
websites such as a ministry of interior

332
00:13:06,880 --> 00:13:09,760
or ministry of finance also a media

333
00:13:09,760 --> 00:13:12,800
outlets press agency called saba an

334
00:13:12,800 --> 00:13:14,959
internet service provider

335
00:13:14,959 --> 00:13:17,680
in lebanon we see again

336
00:13:17,680 --> 00:13:20,000
the almanac tv that were compromised

337
00:13:20,000 --> 00:13:21,519
again

338
00:13:21,519 --> 00:13:24,000
in syria multiple governmental websites

339
00:13:24,000 --> 00:13:26,000
and an isp

340
00:13:26,000 --> 00:13:28,639
and in south africa a defense

341
00:13:28,639 --> 00:13:30,639
conglomerate

342
00:13:30,639 --> 00:13:32,320
called dinell

343
00:13:32,320 --> 00:13:34,399
and finally in saudi arabia an online

344
00:13:34,399 --> 00:13:37,120
media called the saudi reality i believe

345
00:13:37,120 --> 00:13:38,639
this is a

346
00:13:38,639 --> 00:13:40,959
opposition media but i'm not even sure

347
00:13:40,959 --> 00:13:43,040
if it's a real website or not it has

348
00:13:43,040 --> 00:13:45,920
been running for for a few years now but

349
00:13:45,920 --> 00:13:48,560
it's hard to say who's who's behind this

350
00:13:48,560 --> 00:13:51,119
this website

351
00:13:51,839 --> 00:13:54,000
so not only the targets are interesting

352
00:13:54,000 --> 00:13:56,160
but also the timing of some of the

353
00:13:56,160 --> 00:13:58,079
compromises

354
00:13:58,079 --> 00:13:58,880
um

355
00:13:58,880 --> 00:14:00,160
for example

356
00:14:00,160 --> 00:14:03,040
at the beginning of june 2021 the saber

357
00:14:03,040 --> 00:14:05,279
press agency felt under the control of

358
00:14:05,279 --> 00:14:07,760
the thousand transistors council which

359
00:14:07,760 --> 00:14:11,040
is one of the factions in the

360
00:14:11,040 --> 00:14:12,880
yemeni war and it's

361
00:14:12,880 --> 00:14:16,000
allegedly linked to the uae

362
00:14:16,000 --> 00:14:18,800
and around 10 days after

363
00:14:18,800 --> 00:14:21,040
this

364
00:14:21,360 --> 00:14:23,440
that they took control of of

365
00:14:23,440 --> 00:14:26,240
of saber though the website saba dot y

366
00:14:26,240 --> 00:14:27,920
was compromised and started to serve as

367
00:14:27,920 --> 00:14:28,839
a water

368
00:14:28,839 --> 00:14:31,760
anymore another strange coincidence

369
00:14:31,760 --> 00:14:34,480
happened with the dinner defense company

370
00:14:34,480 --> 00:14:37,519
so this is a report from an ngo called

371
00:14:37,519 --> 00:14:40,079
open secret that was released earlier in

372
00:14:40,079 --> 00:14:42,079
march this year

373
00:14:42,079 --> 00:14:43,760
so this report called profiting from

374
00:14:43,760 --> 00:14:44,959
misery

375
00:14:44,959 --> 00:14:47,040
they specifically mentioned dinnell and

376
00:14:47,040 --> 00:14:48,880
its possible involvement in the war in

377
00:14:48,880 --> 00:14:50,000
yemen

378
00:14:50,000 --> 00:14:51,360
and guess what

379
00:14:51,360 --> 00:14:53,040
few weeks after

380
00:14:53,040 --> 00:14:55,199
their main website on the website of

381
00:14:55,199 --> 00:14:58,240
many of the subsidiaries where were

382
00:14:58,240 --> 00:14:59,760
compromised and started to serve as a

383
00:14:59,760 --> 00:15:02,160
water angle so that may be

384
00:15:02,160 --> 00:15:04,160
a simple coincidence again

385
00:15:04,160 --> 00:15:04,959
but

386
00:15:04,959 --> 00:15:06,160
that year

387
00:15:06,160 --> 00:15:08,160
we believe that attackers compromise

388
00:15:08,160 --> 00:15:11,199
only the one the website of one defense

389
00:15:11,199 --> 00:15:14,399
company that is done

390
00:15:16,320 --> 00:15:18,639
so it shows attackers that are reacting

391
00:15:18,639 --> 00:15:20,800
to are interesting in what is going on

392
00:15:20,800 --> 00:15:23,199
in yemen or and are also reacting to

393
00:15:23,199 --> 00:15:24,240
real life

394
00:15:24,240 --> 00:15:27,240
events

395
00:15:27,279 --> 00:15:29,279
and i would like to mention that some of

396
00:15:29,279 --> 00:15:30,959
the iocs of this

397
00:15:30,959 --> 00:15:32,560
second campaign were mentioned on

398
00:15:32,560 --> 00:15:35,680
twitter by felix so it allows us to to

399
00:15:35,680 --> 00:15:37,839
make the link with what kaspersky called

400
00:15:37,839 --> 00:15:40,560
tartadon i'm not sure exactly what are

401
00:15:40,560 --> 00:15:43,199
the limitations of this to adapter but

402
00:15:43,199 --> 00:15:46,639
it's definitely related

403
00:15:47,519 --> 00:15:49,360
now a quick technical analysis of the

404
00:15:49,360 --> 00:15:51,759
scripts using the

405
00:15:51,759 --> 00:15:54,320
in this this second campaign so they

406
00:15:54,320 --> 00:15:57,600
totally abandoned the script using 2020

407
00:15:57,600 --> 00:15:59,680
2020 and started to use this simple

408
00:15:59,680 --> 00:16:01,680
script that can allow direct the user to

409
00:16:01,680 --> 00:16:05,439
url provided by the cnc server

410
00:16:05,519 --> 00:16:07,839
so what we do when we have a new screen

411
00:16:07,839 --> 00:16:09,680
like that is that we create a detection

412
00:16:09,680 --> 00:16:12,240
for it and we quickly started to receive

413
00:16:12,240 --> 00:16:16,000
as much as uh 20 000 detections per day

414
00:16:16,000 --> 00:16:19,839
for very similar scripts so it was a

415
00:16:19,839 --> 00:16:21,920
bit suspicious

416
00:16:21,920 --> 00:16:24,000
turned out that they copied the script

417
00:16:24,000 --> 00:16:25,519
from a

418
00:16:25,519 --> 00:16:27,920
widespread hardware campaign called ln

419
00:16:27,920 --> 00:16:30,079
care

420
00:16:30,079 --> 00:16:33,040
so this adware simply injects ads into

421
00:16:33,040 --> 00:16:34,639
compromised websites

422
00:16:34,639 --> 00:16:36,480
but it has nothing to do

423
00:16:36,480 --> 00:16:38,240
with the water analysis it's just that

424
00:16:38,240 --> 00:16:40,160
they copied the script used by this

425
00:16:40,160 --> 00:16:42,079
hardware

426
00:16:42,079 --> 00:16:43,120
so

427
00:16:43,120 --> 00:16:44,079
why

428
00:16:44,079 --> 00:16:45,680
did they use the script linked to a

429
00:16:45,680 --> 00:16:47,440
network i believe they wanted to to

430
00:16:47,440 --> 00:16:49,839
blend into like the internet mess and

431
00:16:49,839 --> 00:16:51,199
for example it could

432
00:16:51,199 --> 00:16:53,519
lead to wrongly classify a watering or

433
00:16:53,519 --> 00:16:58,000
incident to a simple hardware infection

434
00:16:59,839 --> 00:17:01,440
starting from

435
00:17:01,440 --> 00:17:03,440
april

436
00:17:03,440 --> 00:17:05,839
the script again and started to use this

437
00:17:05,839 --> 00:17:07,839
commercial fingerprint service called

438
00:17:07,839 --> 00:17:09,839
fingerprint gs pro

439
00:17:09,839 --> 00:17:11,679
and it allows to

440
00:17:11,679 --> 00:17:14,000
fingerprint many different artifacts of

441
00:17:14,000 --> 00:17:15,439
the browser

442
00:17:15,439 --> 00:17:16,880
and then

443
00:17:16,880 --> 00:17:19,919
draw the exam to the url of that choice

444
00:17:19,919 --> 00:17:22,720
unfortunately and as last year we never

445
00:17:22,720 --> 00:17:26,000
got a valid reaction

446
00:17:26,240 --> 00:17:28,240
so let's summarize the first part of

447
00:17:28,240 --> 00:17:29,760
this story

448
00:17:29,760 --> 00:17:32,640
when cover strategic web compromise

449
00:17:32,640 --> 00:17:34,960
on high profile websites most linking to

450
00:17:34,960 --> 00:17:36,160
the middle list

451
00:17:36,160 --> 00:17:37,919
attacker like impersonating url

452
00:17:37,919 --> 00:17:40,160
shorteners and web analytics they seem

453
00:17:40,160 --> 00:17:42,080
to mainly target people running windows

454
00:17:42,080 --> 00:17:44,080
and macos but not people are visiting

455
00:17:44,080 --> 00:17:46,480
the website from their smartphones and

456
00:17:46,480 --> 00:17:50,240
the target most common web browsers

457
00:17:50,240 --> 00:17:52,559
so now let's add a pinch of conveyor on

458
00:17:52,559 --> 00:17:55,440
this water animals

459
00:17:57,679 --> 00:17:59,679
less than tweaks ago the us department

460
00:17:59,679 --> 00:18:01,919
of commerce added two prominent israeli

461
00:18:01,919 --> 00:18:04,160
spyware companies to the entity list so

462
00:18:04,160 --> 00:18:06,080
it includes the infamous nso that met

463
00:18:06,080 --> 00:18:08,720
the news last summer for wizards pegasus

464
00:18:08,720 --> 00:18:11,039
spyware but also kandiro another firm

465
00:18:11,039 --> 00:18:13,039
that is specialized in the exploitation

466
00:18:13,039 --> 00:18:14,960
of computers

467
00:18:14,960 --> 00:18:17,600
condiero was also the subject of this

468
00:18:17,600 --> 00:18:19,679
article by citizen lab

469
00:18:19,679 --> 00:18:21,600
this summer

470
00:18:21,600 --> 00:18:24,880
and in the blog post they mentioned

471
00:18:24,880 --> 00:18:26,960
that candio has in capabilities such as

472
00:18:26,960 --> 00:18:29,120
a browser-based zero click vector this

473
00:18:29,120 --> 00:18:32,080
probably means they provide exploits for

474
00:18:32,080 --> 00:18:35,039
most common web browsers

475
00:18:35,039 --> 00:18:36,720
and if we scroll down a little bit we

476
00:18:36,720 --> 00:18:38,000
have

477
00:18:38,000 --> 00:18:40,640
this section called a saudi link cluster

478
00:18:40,640 --> 00:18:42,240
and research has citizen map found

479
00:18:42,240 --> 00:18:43,840
malifu's documents that will open

480
00:18:43,840 --> 00:18:46,320
internet explorer to a specific url and

481
00:18:46,320 --> 00:18:48,799
they mention that this url radio ticked

482
00:18:48,799 --> 00:18:50,240
to another server

483
00:18:50,240 --> 00:18:52,880
userproof.cc and this one is operated by

484
00:18:52,880 --> 00:18:54,000
condio

485
00:18:54,000 --> 00:18:55,679
they also provide a few other domain

486
00:18:55,679 --> 00:18:58,320
names related to the same cluster and

487
00:18:58,320 --> 00:19:00,799
they're all impersonating url shorteners

488
00:19:00,799 --> 00:19:02,000
as

489
00:19:02,000 --> 00:19:03,679
the slider

490
00:19:03,679 --> 00:19:05,760
as for some of the domain using the

491
00:19:05,760 --> 00:19:09,120
water angles that i showed earlier

492
00:19:09,120 --> 00:19:10,960
and finally it is mentioned that saudi

493
00:19:10,960 --> 00:19:13,280
users receive on on twitter links to

494
00:19:13,280 --> 00:19:15,360
this fakual shortness so it shows that

495
00:19:15,360 --> 00:19:17,120
the trait actor is using

496
00:19:17,120 --> 00:19:20,720
different infection vectors

497
00:19:20,720 --> 00:19:22,559
so these

498
00:19:22,559 --> 00:19:24,160
documents manufactures documents related

499
00:19:24,160 --> 00:19:25,919
to this cluster were uploaded on various

500
00:19:25,919 --> 00:19:29,520
total from iran iraq and syria

501
00:19:29,520 --> 00:19:31,760
and they chose a decoy document while in

502
00:19:31,760 --> 00:19:33,440
the background it will open internet

503
00:19:33,440 --> 00:19:37,440
explorer and probe to probably get a

504
00:19:37,440 --> 00:19:40,240
browser exploit

505
00:19:40,720 --> 00:19:42,880
an interesting artifact is that the cnc

506
00:19:42,880 --> 00:19:46,000
server is located in the

507
00:19:46,000 --> 00:19:48,320
metadata of the documents

508
00:19:48,320 --> 00:19:50,960
in this example it is in the

509
00:19:50,960 --> 00:19:54,160
description field

510
00:19:55,360 --> 00:19:57,200
so later in the presentation i will do a

511
00:19:57,200 --> 00:19:58,720
parallel between the water angles and

512
00:19:58,720 --> 00:20:00,799
the documents so let's summarize how

513
00:20:00,799 --> 00:20:01,919
they work

514
00:20:01,919 --> 00:20:03,600
first the attackers send a spearfishing

515
00:20:03,600 --> 00:20:06,000
email that contains a malicious document

516
00:20:06,000 --> 00:20:07,919
for example a word document if the

517
00:20:07,919 --> 00:20:10,400
targets click on it it will do a http

518
00:20:10,400 --> 00:20:12,559
request to a first stage cnc server that

519
00:20:12,559 --> 00:20:14,000
may issue

520
00:20:14,000 --> 00:20:16,159
a redirection to a second station server

521
00:20:16,159 --> 00:20:18,080
that will deliver the exports and

522
00:20:18,080 --> 00:20:20,159
according to the citizenlab the two last

523
00:20:20,159 --> 00:20:22,480
steps are handled directly by condyle

524
00:20:22,480 --> 00:20:24,400
but we believe that the first part

525
00:20:24,400 --> 00:20:26,159
including station of the document is

526
00:20:26,159 --> 00:20:29,039
under by another trajectory from the

527
00:20:29,039 --> 00:20:32,080
customer of conduct

528
00:20:32,640 --> 00:20:34,799
so now it raises a few more questions

529
00:20:34,799 --> 00:20:36,799
who created those documents

530
00:20:36,799 --> 00:20:38,480
and are they related to the watering

531
00:20:38,480 --> 00:20:40,880
holes

532
00:20:40,960 --> 00:20:41,919
let's go

533
00:20:41,919 --> 00:20:43,360
let's go back to the network

534
00:20:43,360 --> 00:20:45,360
infrastructure described in the first

535
00:20:45,360 --> 00:20:48,480
part of this presentation

536
00:20:48,480 --> 00:20:50,960
first there is very similar uh

537
00:20:50,960 --> 00:20:53,280
the topic of the domain names using for

538
00:20:53,280 --> 00:20:55,200
cnc server is very similar url

539
00:20:55,200 --> 00:20:57,440
shorteners and webinar services mainly

540
00:20:57,440 --> 00:20:59,200
and to my knowledge this is not very

541
00:20:59,200 --> 00:21:01,360
common for apt groups targeting the

542
00:21:01,360 --> 00:21:03,840
middle list

543
00:21:03,840 --> 00:21:04,720
then

544
00:21:04,720 --> 00:21:07,520
passive dns data shows interesting

545
00:21:07,520 --> 00:21:08,880
links

546
00:21:08,880 --> 00:21:10,320
so for example if we start from

547
00:21:10,320 --> 00:21:12,240
userproof.cc which was the domain

548
00:21:12,240 --> 00:21:13,120
mentioned

549
00:21:13,120 --> 00:21:15,760
by the citizenlab it resolved to this ip

550
00:21:15,760 --> 00:21:16,640
address

551
00:21:16,640 --> 00:21:18,880
so it's linked to to condyle

552
00:21:18,880 --> 00:21:22,720
and from november to february

553
00:21:22,720 --> 00:21:26,080
to november 2020 to february 2021 two

554
00:21:26,080 --> 00:21:28,000
other domains resolve to this same ip

555
00:21:28,000 --> 00:21:29,400
address

556
00:21:29,400 --> 00:21:32,799
webfx.cc and engagebay.cc

557
00:21:32,799 --> 00:21:35,360
and the second level domain webefix and

558
00:21:35,360 --> 00:21:38,000
gauge bay were also used during the

559
00:21:38,000 --> 00:21:40,799
water angles so for the water angles

560
00:21:40,799 --> 00:21:42,880
attackers were using webefix.com and

561
00:21:42,880 --> 00:21:44,640
engagedbay.app

562
00:21:44,640 --> 00:21:45,440
so

563
00:21:45,440 --> 00:21:47,919
these are not the same domains but there

564
00:21:47,919 --> 00:21:50,240
is some some trends

565
00:21:50,240 --> 00:21:51,600
however

566
00:21:51,600 --> 00:21:52,799
the

567
00:21:52,799 --> 00:21:55,360
registration patterns are very different

568
00:21:55,360 --> 00:21:57,919
and also the server configurations are

569
00:21:57,919 --> 00:21:59,440
different so we believe two different

570
00:21:59,440 --> 00:22:01,200
transactors are operating these two

571
00:22:01,200 --> 00:22:02,880
network infrastructure but they are

572
00:22:02,880 --> 00:22:03,919
somehow

573
00:22:03,919 --> 00:22:06,640
collaborating

574
00:22:07,520 --> 00:22:09,360
another interesting link start from

575
00:22:09,360 --> 00:22:12,720
medica trade fair dot co which is which

576
00:22:12,720 --> 00:22:15,760
result to this ip address and this other

577
00:22:15,760 --> 00:22:18,400
domain kenratraval.com resolved to this

578
00:22:18,400 --> 00:22:20,799
ip address and guess what this is the

579
00:22:20,799 --> 00:22:22,720
domain used by condiro

580
00:22:22,720 --> 00:22:25,280
this is in the list provided by a

581
00:22:25,280 --> 00:22:26,799
microsoft threat intelligence in their

582
00:22:26,799 --> 00:22:29,280
blog post

583
00:22:29,360 --> 00:22:31,679
also this ip address is not a shared vps

584
00:22:31,679 --> 00:22:32,640
hosting

585
00:22:32,640 --> 00:22:35,280
and there is no other domain that

586
00:22:35,280 --> 00:22:38,000
resolves to to this to this ip address

587
00:22:38,000 --> 00:22:41,840
from mid 2020 to mid-2021 so

588
00:22:41,840 --> 00:22:43,600
again i think this is another element

589
00:22:43,600 --> 00:22:45,600
that indicates a collaboration between

590
00:22:45,600 --> 00:22:48,159
two trait actors

591
00:22:48,159 --> 00:22:50,880
the victimology is similar victims are

592
00:22:50,880 --> 00:22:52,880
mostly in the middle east

593
00:22:52,880 --> 00:22:54,960
and finally the watering all servers

594
00:22:54,960 --> 00:22:57,440
stopped responding at the end of july

595
00:22:57,440 --> 00:23:01,440
2021 just a few weeks after uh the the

596
00:23:01,440 --> 00:23:03,600
publication by of blockbuster on

597
00:23:03,600 --> 00:23:04,559
congress

598
00:23:04,559 --> 00:23:09,200
by citizenlab microsoft and google

599
00:23:09,200 --> 00:23:10,000
so

600
00:23:10,000 --> 00:23:11,840
now let's conclude this talk with our

601
00:23:11,840 --> 00:23:13,520
hypothesis

602
00:23:13,520 --> 00:23:15,280
first we believe with low confidence

603
00:23:15,280 --> 00:23:16,799
that the creators of the documents and

604
00:23:16,799 --> 00:23:18,240
the creators of the social web

605
00:23:18,240 --> 00:23:21,840
compromises are the same trade group

606
00:23:21,840 --> 00:23:23,840
then we believe with medium confidence

607
00:23:23,840 --> 00:23:25,679
that the operator of the strategic web

608
00:23:25,679 --> 00:23:27,919
compromises our customer of candido

609
00:23:27,919 --> 00:23:30,240
meaning that they are buying spyware or

610
00:23:30,240 --> 00:23:33,760
exploit from that company

611
00:23:34,559 --> 00:23:36,640
so this assumption led us to draw a

612
00:23:36,640 --> 00:23:38,400
graph that presents our vision of the

613
00:23:38,400 --> 00:23:42,240
infection chain it starts with a

614
00:23:42,240 --> 00:23:44,000
compromised website of those phishing

615
00:23:44,000 --> 00:23:45,760
emails then you have a

616
00:23:45,760 --> 00:23:48,000
fingerprint script or meshes documents

617
00:23:48,000 --> 00:23:49,440
that will do

618
00:23:49,440 --> 00:23:51,679
http request to a first stage cnc server

619
00:23:51,679 --> 00:23:54,480
that may issue a redirection to a

620
00:23:54,480 --> 00:23:56,799
second station server that will deliver

621
00:23:56,799 --> 00:24:00,559
an exploit and then possibly a spyware

622
00:24:00,559 --> 00:24:02,159
we believe that the last part is

623
00:24:02,159 --> 00:24:04,240
operated directly by by the computer

624
00:24:04,240 --> 00:24:06,720
firm while the first part is operated by

625
00:24:06,720 --> 00:24:09,600
the control customer that's why for for

626
00:24:09,600 --> 00:24:12,559
condio we see many different

627
00:24:12,559 --> 00:24:14,880
infection vectors and many different

628
00:24:14,880 --> 00:24:18,240
manner of compromising the victims

629
00:24:18,240 --> 00:24:20,559
now you might think it is just some

630
00:24:20,559 --> 00:24:23,200
vague assumption but uh researchers at

631
00:24:23,200 --> 00:24:25,159
google attack saw redirection from

632
00:24:25,159 --> 00:24:27,279
visitortrack.net which is a domain we

633
00:24:27,279 --> 00:24:29,679
saw in the watering holes to uh to a

634
00:24:29,679 --> 00:24:33,760
server operated by by condero

635
00:24:33,840 --> 00:24:36,320
so a big thanks to to clemen from google

636
00:24:36,320 --> 00:24:38,960
tag that

637
00:24:38,960 --> 00:24:40,880
that helped us and allowed us to to

638
00:24:40,880 --> 00:24:43,279
confirm that hypothesis so this really

639
00:24:43,279 --> 00:24:44,799
shows that

640
00:24:44,799 --> 00:24:47,039
the watering holes operator are a

641
00:24:47,039 --> 00:24:50,480
customer of the continuum firm

642
00:24:51,120 --> 00:24:54,240
so now let's conclude this talk

643
00:24:54,240 --> 00:24:56,559
we uncover strategy web compromises on

644
00:24:56,559 --> 00:24:59,919
high profile websites grantal media or

645
00:24:59,919 --> 00:25:01,039
isp

646
00:25:01,039 --> 00:25:03,360
websites most of them related to the

647
00:25:03,360 --> 00:25:05,279
middle east

648
00:25:05,279 --> 00:25:08,430
then the trajectory is

649
00:25:08,430 --> 00:25:09,840
[Music]

650
00:25:09,840 --> 00:25:11,840
very careful in the target selection

651
00:25:11,840 --> 00:25:13,760
they likely infect only a handful of the

652
00:25:13,760 --> 00:25:16,720
people who visit their websites

653
00:25:16,720 --> 00:25:18,720
we also have

654
00:25:18,720 --> 00:25:20,240
detail is a link with scandinavia a

655
00:25:20,240 --> 00:25:22,400
spyware firm that sells its services to

656
00:25:22,400 --> 00:25:25,200
various governments this link

657
00:25:25,200 --> 00:25:27,039
this link was confirmed by researchers

658
00:25:27,039 --> 00:25:28,559
at google tags that i would like to

659
00:25:28,559 --> 00:25:30,320
thanks again

660
00:25:30,320 --> 00:25:31,279
and

661
00:25:31,279 --> 00:25:32,880
hence it shows that collaboration

662
00:25:32,880 --> 00:25:34,720
between different companies and team is

663
00:25:34,720 --> 00:25:36,880
needed to better understand the threat

664
00:25:36,880 --> 00:25:38,480
this power

665
00:25:38,480 --> 00:25:42,799
private spyware company represents

666
00:25:42,799 --> 00:25:45,840
thanks for your attention

667
00:25:46,640 --> 00:25:48,559
and maybe we have some thanks for

668
00:25:48,559 --> 00:25:51,559
question

