1
00:00:00,970 --> 00:00:08,029
[Music]

2
00:00:15,759 --> 00:00:18,160
thank you very much i'm super excited to

3
00:00:18,160 --> 00:00:20,800
be here today uh blue 22.

4
00:00:20,800 --> 00:00:23,199
um so today we're going to talk about

5
00:00:23,199 --> 00:00:25,439
intercoms um

6
00:00:25,439 --> 00:00:27,279
i have a great story to tell you a great

7
00:00:27,279 --> 00:00:28,800
journey that

8
00:00:28,800 --> 00:00:30,560
we have started and researched uh but

9
00:00:30,560 --> 00:00:32,558
first let's start let's start with a bit

10
00:00:32,558 --> 00:00:35,040
of formalities so my name is fernando

11
00:00:35,040 --> 00:00:36,880
bisinov i work with clarity i'm a

12
00:00:36,880 --> 00:00:39,440
vulnerability researcher uh this is my

13
00:00:39,440 --> 00:00:42,399
playground we have lots of scada devices

14
00:00:42,399 --> 00:00:46,079
and equipment plcs and gmis and also iot

15
00:00:46,079 --> 00:00:48,719
equipment such as cameras and you

16
00:00:48,719 --> 00:00:50,879
guessed it right intercoms

17
00:00:50,879 --> 00:00:52,559
and

18
00:00:52,559 --> 00:00:54,480
i have a question before we'll begin our

19
00:00:54,480 --> 00:00:55,440
journey

20
00:00:55,440 --> 00:00:57,280
how many of you here please raise your

21
00:00:57,280 --> 00:01:00,000
hand have an intercom device at your

22
00:01:00,000 --> 00:01:01,680
home

23
00:01:01,680 --> 00:01:02,800
okay

24
00:01:02,800 --> 00:01:05,040
i see many hands and how many of you

25
00:01:05,040 --> 00:01:07,119
have a cloud-based one that you can

26
00:01:07,119 --> 00:01:10,640
control from your mobile application

27
00:01:10,640 --> 00:01:15,040
okay so i see i see some hands here uh

28
00:01:15,040 --> 00:01:16,799
we'll see if you want to keep it in the

29
00:01:16,799 --> 00:01:18,159
end of this talk

30
00:01:18,159 --> 00:01:20,400
uh we'll see this okay so let's start

31
00:01:20,400 --> 00:01:22,640
with a bit of a background of why we

32
00:01:22,640 --> 00:01:24,560
started this research

33
00:01:24,560 --> 00:01:25,439
so

34
00:01:25,439 --> 00:01:28,560
a few months ago my friend called me and

35
00:01:28,560 --> 00:01:30,159
it was in the middle of the night and

36
00:01:30,159 --> 00:01:32,479
they just told me uh look sharon i just

37
00:01:32,479 --> 00:01:34,240
bought the new intercom device it's a

38
00:01:34,240 --> 00:01:36,960
cloud-based one and i installed it in my

39
00:01:36,960 --> 00:01:39,680
in my place and since then

40
00:01:39,680 --> 00:01:42,960
um keep receiving weird phone calls in

41
00:01:42,960 --> 00:01:45,439
the middle of the night

42
00:01:45,439 --> 00:01:48,240
and when i answer those phone calls

43
00:01:48,240 --> 00:01:50,320
the mobile application the associated

44
00:01:50,320 --> 00:01:52,479
mobile application of the intercom

45
00:01:52,479 --> 00:01:55,759
is opened and i see some weird offices

46
00:01:55,759 --> 00:01:57,759
around the world

47
00:01:57,759 --> 00:01:59,360
and i was like

48
00:01:59,360 --> 00:02:01,759
hold on

49
00:02:01,759 --> 00:02:03,520
what are you saying are you saying

50
00:02:03,520 --> 00:02:04,399
that

51
00:02:04,399 --> 00:02:07,280
you receive weird phone calls from weird

52
00:02:07,280 --> 00:02:08,560
numbers

53
00:02:08,560 --> 00:02:10,878
and when you answer those phone calls

54
00:02:10,878 --> 00:02:14,000
you the associated mobile application is

55
00:02:14,000 --> 00:02:17,440
opened and you see some weird offices

56
00:02:17,440 --> 00:02:18,239
well

57
00:02:18,239 --> 00:02:21,040
something is wrong here and it was like

58
00:02:21,040 --> 00:02:23,760
yeah but it's not for me to interpret

59
00:02:23,760 --> 00:02:24,720
and

60
00:02:24,720 --> 00:02:26,959
i was like okay so what's the name of

61
00:02:26,959 --> 00:02:29,760
the platform and they told me too easy

62
00:02:29,760 --> 00:02:31,599
too easy platform

63
00:02:31,599 --> 00:02:34,560
and i said okay let me run some checks

64
00:02:34,560 --> 00:02:36,160
and obviously when you're starting an

65
00:02:36,160 --> 00:02:38,800
embedded research uh you always start

66
00:02:38,800 --> 00:02:40,560
with async

67
00:02:40,560 --> 00:02:43,680
and i started to google uh

68
00:02:43,680 --> 00:02:46,160
to google this platform to easy platform

69
00:02:46,160 --> 00:02:48,560
and i started to see to watch some

70
00:02:48,560 --> 00:02:50,480
youtube videos showing how to configure

71
00:02:50,480 --> 00:02:51,840
this device

72
00:02:51,840 --> 00:02:53,760
and i saw

73
00:02:53,760 --> 00:02:55,760
how to buy this device how to configure

74
00:02:55,760 --> 00:02:58,080
it how to install it how to configure

75
00:02:58,080 --> 00:02:58,800
the

76
00:02:58,800 --> 00:03:00,800
the mobile application how to use the

77
00:03:00,800 --> 00:03:03,599
panel how to uh how to use the intercom

78
00:03:03,599 --> 00:03:05,519
how to connect all the wires

79
00:03:05,519 --> 00:03:09,599
and also i looked at ebay i wanted to

80
00:03:09,599 --> 00:03:11,360
think maybe i'll i should buy it to

81
00:03:11,360 --> 00:03:13,760
research it even more but again it was

82
00:03:13,760 --> 00:03:16,080
in the middle of the night so i at this

83
00:03:16,080 --> 00:03:18,959
point i did not buy the the device yet

84
00:03:18,959 --> 00:03:21,760
but i also looked at some documents and

85
00:03:21,760 --> 00:03:24,799
user manuals technician manuals

86
00:03:24,799 --> 00:03:26,879
and

87
00:03:26,879 --> 00:03:28,959
and then i found it then i found the

88
00:03:28,959 --> 00:03:31,599
answer to the mystery that my friend

89
00:03:31,599 --> 00:03:34,239
called me for and the answer was in one

90
00:03:34,239 --> 00:03:36,720
of the manuals i saw

91
00:03:36,720 --> 00:03:39,440
some default account and it turned out

92
00:03:39,440 --> 00:03:42,319
to be kind of a technician account

93
00:03:42,319 --> 00:03:43,599
that

94
00:03:43,599 --> 00:03:46,000
technicians are using in order to test

95
00:03:46,000 --> 00:03:48,560
the device so when they're buying when

96
00:03:48,560 --> 00:03:51,200
you buy a new device technicians want

97
00:03:51,200 --> 00:03:54,080
to check the connectivity to the cloud

98
00:03:54,080 --> 00:03:56,159
and they want to check if it works they

99
00:03:56,159 --> 00:03:57,680
don't want to use

100
00:03:57,680 --> 00:03:59,360
the user account

101
00:03:59,360 --> 00:04:01,360
so they have their own kind of a test

102
00:04:01,360 --> 00:04:03,120
account that they're using

103
00:04:03,120 --> 00:04:05,680
and also in the mobile application also

104
00:04:05,680 --> 00:04:07,920
there there is a feature called test

105
00:04:07,920 --> 00:04:09,120
account

106
00:04:09,120 --> 00:04:10,959
and as it turned out

107
00:04:10,959 --> 00:04:13,599
this test account is shared among

108
00:04:13,599 --> 00:04:15,680
all the network all the cloud-based

109
00:04:15,680 --> 00:04:19,358
intercom network of this vendor and

110
00:04:19,358 --> 00:04:22,079
apparently if you download the app and

111
00:04:22,079 --> 00:04:25,120
you enter to this test account

112
00:04:25,120 --> 00:04:27,919
you actually log in as the test account

113
00:04:27,919 --> 00:04:29,919
and you start receiving

114
00:04:29,919 --> 00:04:32,639
phone calls or intercom calls from

115
00:04:32,639 --> 00:04:34,639
people around the world so how it looks

116
00:04:34,639 --> 00:04:36,320
like so there is an office let's say

117
00:04:36,320 --> 00:04:39,120
this office in somewhere in china and

118
00:04:39,120 --> 00:04:41,520
there is a pre-configured intercom over

119
00:04:41,520 --> 00:04:43,440
there that is configured with the test

120
00:04:43,440 --> 00:04:46,560
account so this intercom

121
00:04:46,560 --> 00:04:49,840
will call anyone that has the test

122
00:04:49,840 --> 00:04:52,320
account configured on their device

123
00:04:52,320 --> 00:04:53,840
and this is exactly what happened to my

124
00:04:53,840 --> 00:04:54,880
friend

125
00:04:54,880 --> 00:04:57,199
the technician apparently downloaded the

126
00:04:57,199 --> 00:05:00,639
app on my friend's phone and installed

127
00:05:00,639 --> 00:05:04,000
and configured the app to be as the test

128
00:05:04,000 --> 00:05:06,400
account so all the intercoms around the

129
00:05:06,400 --> 00:05:08,639
world from this vendor started to call

130
00:05:08,639 --> 00:05:10,400
the test account because they

131
00:05:10,400 --> 00:05:12,479
were not configured at the time and so

132
00:05:12,479 --> 00:05:14,880
my friend got some those weird phone

133
00:05:14,880 --> 00:05:16,960
calls and when he answered when he

134
00:05:16,960 --> 00:05:18,160
picked

135
00:05:18,160 --> 00:05:20,000
when he answered the phone calls he got

136
00:05:20,000 --> 00:05:21,759
the office the weird office

137
00:05:21,759 --> 00:05:24,880
in i know china or germany whatever

138
00:05:24,880 --> 00:05:27,280
so what i did i wanted to test this

139
00:05:27,280 --> 00:05:29,360
hypothesis again it was in the middle of

140
00:05:29,360 --> 00:05:31,039
the night when i started this research

141
00:05:31,039 --> 00:05:33,919
so what i did was installing a sip

142
00:05:33,919 --> 00:05:36,639
server and configured the zip server to

143
00:05:36,639 --> 00:05:39,360
use the test account and i ran it for a

144
00:05:39,360 --> 00:05:42,720
few weeks and as you guessed we received

145
00:05:42,720 --> 00:05:44,800
tons of phone calls from different

146
00:05:44,800 --> 00:05:47,440
numbers this these are special numbers

147
00:05:47,440 --> 00:05:50,080
in the intercom network and

148
00:05:50,080 --> 00:05:52,000
everybody called us because we were the

149
00:05:52,000 --> 00:05:53,840
test account

150
00:05:53,840 --> 00:05:54,720
and

151
00:05:54,720 --> 00:05:56,800
in order to keep ourselves the test

152
00:05:56,800 --> 00:06:00,319
account we needed to constantly log in

153
00:06:00,319 --> 00:06:03,039
and override the the next test account

154
00:06:03,039 --> 00:06:06,000
in the network so we ran this server for

155
00:06:06,000 --> 00:06:07,840
a few weeks and collected lots of

156
00:06:07,840 --> 00:06:10,720
numbers and my friend understood that

157
00:06:10,720 --> 00:06:13,039
his mobile application is not configured

158
00:06:13,039 --> 00:06:14,720
properly

159
00:06:14,720 --> 00:06:16,400
so mystery solved

160
00:06:16,400 --> 00:06:20,120
that's it thank you

161
00:06:20,560 --> 00:06:21,840
so

162
00:06:21,840 --> 00:06:24,479
we thought ourselves uh

163
00:06:24,479 --> 00:06:27,680
is is that it um maybe we can find

164
00:06:27,680 --> 00:06:28,720
another

165
00:06:28,720 --> 00:06:31,840
interesting juicy part in this system

166
00:06:31,840 --> 00:06:34,560
which is a bit flawed

167
00:06:34,560 --> 00:06:35,680
and so

168
00:06:35,680 --> 00:06:36,639
we

169
00:06:36,639 --> 00:06:39,120
went back to the manuals

170
00:06:39,120 --> 00:06:40,720
now it wasn't in the middle of the night

171
00:06:40,720 --> 00:06:44,160
again it was a new a new day and we saw

172
00:06:44,160 --> 00:06:45,039
this

173
00:06:45,039 --> 00:06:48,400
surveillance door station via too easy

174
00:06:48,400 --> 00:06:49,360
app

175
00:06:49,360 --> 00:06:51,759
and if you'll read carefully

176
00:06:51,759 --> 00:06:53,360
you'll see that

177
00:06:53,360 --> 00:06:55,120
if you have the app

178
00:06:55,120 --> 00:06:58,400
you can enter a surveillance mode

179
00:06:58,400 --> 00:07:01,199
and open the camera on the intercom

180
00:07:01,199 --> 00:07:02,880
device and not only that you can open

181
00:07:02,880 --> 00:07:04,240
the camera

182
00:07:04,240 --> 00:07:06,080
this is just the first stage you can

183
00:07:06,080 --> 00:07:08,560
also transmit audio

184
00:07:08,560 --> 00:07:12,560
as a push-to-talk feature and also

185
00:07:12,560 --> 00:07:14,160
unlock the door

186
00:07:14,160 --> 00:07:15,280
so

187
00:07:15,280 --> 00:07:16,960
i was like

188
00:07:16,960 --> 00:07:19,599
oh my god

189
00:07:19,599 --> 00:07:20,479
if

190
00:07:20,479 --> 00:07:23,759
if i have an authentication bypass

191
00:07:23,759 --> 00:07:26,000
vulnerability

192
00:07:26,000 --> 00:07:30,080
so i could impersonate any user in the

193
00:07:30,080 --> 00:07:31,199
network

194
00:07:31,199 --> 00:07:34,960
and hack their intercom i could open the

195
00:07:34,960 --> 00:07:38,160
video stream i could open and unlock the

196
00:07:38,160 --> 00:07:41,599
door and i could transmit audio to speak

197
00:07:41,599 --> 00:07:43,680
to their dog because usually intercoms

198
00:07:43,680 --> 00:07:45,120
are outside

199
00:07:45,120 --> 00:07:46,240
and

200
00:07:46,240 --> 00:07:47,280
this is

201
00:07:47,280 --> 00:07:49,280
when sparkles

202
00:07:49,280 --> 00:07:52,400
came out and we started the interesting

203
00:07:52,400 --> 00:07:54,479
research and when again when you're

204
00:07:54,479 --> 00:07:56,479
starting an embedded research or iot

205
00:07:56,479 --> 00:07:57,759
research

206
00:07:57,759 --> 00:08:00,160
the first stage is always awesome the

207
00:08:00,160 --> 00:08:01,840
second stage is understanding the

208
00:08:01,840 --> 00:08:04,479
logistics and what devices are being

209
00:08:04,479 --> 00:08:06,879
used and where so i started to

210
00:08:06,879 --> 00:08:08,639
understand what is this device the

211
00:08:08,639 --> 00:08:11,199
intercom itself the unit itself the

212
00:08:11,199 --> 00:08:14,160
outdoor unit and the indoor unit

213
00:08:14,160 --> 00:08:14,960
and

214
00:08:14,960 --> 00:08:17,280
the mobile application so we'll start

215
00:08:17,280 --> 00:08:19,120
with logistics

216
00:08:19,120 --> 00:08:22,000
the manufacturer is vtec vtec is a

217
00:08:22,000 --> 00:08:23,759
chinese company

218
00:08:23,759 --> 00:08:25,360
they manufacture

219
00:08:25,360 --> 00:08:27,440
most of the intercoms that you know in

220
00:08:27,440 --> 00:08:29,120
israel

221
00:08:29,120 --> 00:08:31,280
and we started to

222
00:08:31,280 --> 00:08:33,440
collect all the different puzzle pieces

223
00:08:33,440 --> 00:08:37,039
and assemble them so we have vtec this

224
00:08:37,039 --> 00:08:39,440
is the oem

225
00:08:39,440 --> 00:08:40,399
and

226
00:08:40,399 --> 00:08:43,039
they manufacture all the intercoms and

227
00:08:43,039 --> 00:08:45,920
the panels hm the

228
00:08:45,920 --> 00:08:48,640
panel home panels that you can receive

229
00:08:48,640 --> 00:08:50,160
the call in

230
00:08:50,160 --> 00:08:52,000
now

231
00:08:52,000 --> 00:08:54,320
they manufacture this in china and they

232
00:08:54,320 --> 00:08:55,680
don't have

233
00:08:55,680 --> 00:08:58,480
direct sellers in

234
00:08:58,480 --> 00:09:00,080
other places in the world so they have

235
00:09:00,080 --> 00:09:01,360
resellers

236
00:09:01,360 --> 00:09:04,640
resellers will take the

237
00:09:04,640 --> 00:09:07,839
intercom devices or other iot devices

238
00:09:07,839 --> 00:09:09,200
and we'll

239
00:09:09,200 --> 00:09:11,920
rebrand them as if they were local so in

240
00:09:11,920 --> 00:09:14,480
israel we have the door company

241
00:09:14,480 --> 00:09:16,399
and they are

242
00:09:16,399 --> 00:09:19,360
white labeling the vtec products and

243
00:09:19,360 --> 00:09:22,880
reselling them as if they were their own

244
00:09:22,880 --> 00:09:25,839
and also they have in britain one cdvi

245
00:09:25,839 --> 00:09:28,800
this is the company in britain and in

246
00:09:28,800 --> 00:09:32,160
all other places around the world so

247
00:09:32,160 --> 00:09:34,080
almost every time that you see intercom

248
00:09:34,080 --> 00:09:38,240
device in you know great percentage of

249
00:09:38,240 --> 00:09:41,760
chances it belongs to unknown chinese

250
00:09:41,760 --> 00:09:43,680
company and just the logo

251
00:09:43,680 --> 00:09:45,360
is rebranded

252
00:09:45,360 --> 00:09:47,680
so that's the logistics now we knew

253
00:09:47,680 --> 00:09:50,640
what devices we needed to look at

254
00:09:50,640 --> 00:09:52,320
and we started to read the manuals to

255
00:09:52,320 --> 00:09:54,160
understand

256
00:09:54,160 --> 00:09:57,200
how the system works so we have two

257
00:09:57,200 --> 00:09:59,680
important parts we have the outdoor

258
00:09:59,680 --> 00:10:02,320
intercom this is where people are

259
00:10:02,320 --> 00:10:05,200
ringing the bell and once they ring the

260
00:10:05,200 --> 00:10:08,800
bell it goes over a two wire system to a

261
00:10:08,800 --> 00:10:11,920
home unit and the home unit is usually a

262
00:10:11,920 --> 00:10:15,120
touch screen and you receive an image

263
00:10:15,120 --> 00:10:18,160
from the camera on the out door intercom

264
00:10:18,160 --> 00:10:20,560
and you can answer the image the answer

265
00:10:20,560 --> 00:10:21,360
the

266
00:10:21,360 --> 00:10:23,440
the call or the ring

267
00:10:23,440 --> 00:10:24,480
now

268
00:10:24,480 --> 00:10:28,000
in a cloud-based intercoms there is a

269
00:10:28,000 --> 00:10:30,079
second stage

270
00:10:30,079 --> 00:10:32,480
we have the same system it's a two-wire

271
00:10:32,480 --> 00:10:34,880
system the intercom sits outside the

272
00:10:34,880 --> 00:10:38,480
home panel sits at home but when you do

273
00:10:38,480 --> 00:10:40,240
not answer

274
00:10:40,240 --> 00:10:42,880
the in the the intercom from

275
00:10:42,880 --> 00:10:46,560
the touchscreen it will divert the call

276
00:10:46,560 --> 00:10:49,760
through a gateway

277
00:10:50,800 --> 00:10:53,200
to your mobile app and then you'll

278
00:10:53,200 --> 00:10:55,920
receive a kind of a phone call it's it's

279
00:10:55,920 --> 00:10:58,399
a fake phone call it's a voip call just

280
00:10:58,399 --> 00:10:59,600
like what's up

281
00:10:59,600 --> 00:11:01,760
to your mobile application

282
00:11:01,760 --> 00:11:04,320
and what we want to do

283
00:11:04,320 --> 00:11:07,279
we want to do the opposite we want to

284
00:11:07,279 --> 00:11:10,480
use the surveillance mode in order to

285
00:11:10,480 --> 00:11:14,640
get through the vtec gateway to the home

286
00:11:14,640 --> 00:11:17,279
panel from the home panel we want to

287
00:11:17,279 --> 00:11:19,760
interact with the intercom and we want

288
00:11:19,760 --> 00:11:22,959
to open the camera and we want to open

289
00:11:22,959 --> 00:11:25,200
the door so that's the plan

290
00:11:25,200 --> 00:11:26,480
all we need

291
00:11:26,480 --> 00:11:30,720
is authentication bypass vulnerability

292
00:11:30,720 --> 00:11:32,240
and

293
00:11:32,240 --> 00:11:34,399
once we had the plan we we knew what we

294
00:11:34,399 --> 00:11:36,880
needed to do and first of all we needed

295
00:11:36,880 --> 00:11:38,000
to understand

296
00:11:38,000 --> 00:11:40,320
the system as an overview so let's go

297
00:11:40,320 --> 00:11:43,120
over this quickly we have the intercom

298
00:11:43,120 --> 00:11:45,519
uh eventually what we bought one we

299
00:11:45,519 --> 00:11:46,600
bought the

300
00:11:46,600 --> 00:11:50,600
dt607 module and we also bought the

301
00:11:50,600 --> 00:11:54,000
dx471 module this is the home panel and

302
00:11:54,000 --> 00:11:56,959
obviously it's a it's a wi-fi monitor

303
00:11:56,959 --> 00:12:00,160
uh because most of the modern uh panels

304
00:12:00,160 --> 00:12:02,480
intercom panels are wi-fi based and we

305
00:12:02,480 --> 00:12:04,639
decided obviously to focus on the wi-fi

306
00:12:04,639 --> 00:12:06,160
monitor because this

307
00:12:06,160 --> 00:12:08,639
this piece connects from one side over

308
00:12:08,639 --> 00:12:10,639
two wire system to the intercom and from

309
00:12:10,639 --> 00:12:13,839
the other side it transmits to the cloud

310
00:12:13,839 --> 00:12:16,480
so this is our our main target

311
00:12:16,480 --> 00:12:18,880
now this target as i said is a two-wire

312
00:12:18,880 --> 00:12:21,680
system it has both ethernet and wi-fi

313
00:12:21,680 --> 00:12:24,800
capabilities and also a cloud-based

314
00:12:24,800 --> 00:12:27,200
interaction so

315
00:12:27,200 --> 00:12:29,839
there is some kind of user sits in this

316
00:12:29,839 --> 00:12:32,959
intercom which is binded to the mobile

317
00:12:32,959 --> 00:12:34,639
application and somehow they're

318
00:12:34,639 --> 00:12:36,959
communicating with each other because

319
00:12:36,959 --> 00:12:38,880
they know how to ring each other in

320
00:12:38,880 --> 00:12:42,320
order to initiate a session to transfer

321
00:12:42,320 --> 00:12:44,639
both audio and video

322
00:12:44,639 --> 00:12:45,760
what we did

323
00:12:45,760 --> 00:12:47,120
is

324
00:12:47,120 --> 00:12:48,800
downloaded the firmware

325
00:12:48,800 --> 00:12:50,240
and started to reverse engineering to

326
00:12:50,240 --> 00:12:53,120
understand how this binding process

327
00:12:53,120 --> 00:12:57,600
work and how user is being entered and

328
00:12:57,600 --> 00:12:59,760
maybe generated

329
00:12:59,760 --> 00:13:01,680
now the firmware is a linux based

330
00:13:01,680 --> 00:13:04,079
operating system based on arm little

331
00:13:04,079 --> 00:13:05,519
indian

332
00:13:05,519 --> 00:13:07,519
and the main binary as you can see here

333
00:13:07,519 --> 00:13:09,760
this is the

334
00:13:09,760 --> 00:13:12,560
the firmware when we extracted it

335
00:13:12,560 --> 00:13:15,920
the main binary is dx471

336
00:13:15,920 --> 00:13:18,480
and you can also see all the other files

337
00:13:18,480 --> 00:13:20,959
these files are the

338
00:13:20,959 --> 00:13:23,760
some kind of multimedia files it can be

339
00:13:23,760 --> 00:13:25,519
maybe

340
00:13:25,519 --> 00:13:26,480
the

341
00:13:26,480 --> 00:13:28,320
sound of what will happen when someone

342
00:13:28,320 --> 00:13:30,880
rings the door so we can change it to

343
00:13:30,880 --> 00:13:33,200
funny stuff like we did or change the

344
00:13:33,200 --> 00:13:36,079
logo of the intercom or change the image

345
00:13:36,079 --> 00:13:38,360
but we obviously decided to focus on the

346
00:13:38,360 --> 00:13:41,600
dx471 because that's the main firmware

347
00:13:41,600 --> 00:13:42,639
now

348
00:13:42,639 --> 00:13:44,480
we also researched the mobile

349
00:13:44,480 --> 00:13:45,920
application the associated mobile

350
00:13:45,920 --> 00:13:49,680
application we downloaded the apk from

351
00:13:49,680 --> 00:13:50,959
from google

352
00:13:50,959 --> 00:13:52,560
and we started to reverse engineer the

353
00:13:52,560 --> 00:13:55,040
apk

354
00:13:55,680 --> 00:13:58,560
we and that's both parts from the mob

355
00:13:58,560 --> 00:14:00,839
application to the intercom

356
00:14:00,839 --> 00:14:04,160
itself now we as

357
00:14:04,160 --> 00:14:06,639
i mentioned earlier we wanted to focus

358
00:14:06,639 --> 00:14:08,880
on the binding so

359
00:14:08,880 --> 00:14:11,760
we really wanted to understand how

360
00:14:11,760 --> 00:14:14,720
i buying a new intercom device

361
00:14:14,720 --> 00:14:17,600
downloading the app and how do i bind my

362
00:14:17,600 --> 00:14:20,160
application to the intercom because if i

363
00:14:20,160 --> 00:14:21,839
could control this

364
00:14:21,839 --> 00:14:23,760
i could impersonate someone else and i

365
00:14:23,760 --> 00:14:25,120
could

366
00:14:25,120 --> 00:14:28,000
log in to their intercom and get the

367
00:14:28,000 --> 00:14:30,800
image that i want so much now

368
00:14:30,800 --> 00:14:32,800
i looked again at the manuals and i saw

369
00:14:32,800 --> 00:14:34,800
that in order to bind the application

370
00:14:34,800 --> 00:14:36,880
you don't need to create an account

371
00:14:36,880 --> 00:14:39,120
that's from the manual you can use the

372
00:14:39,120 --> 00:14:41,680
mobile app to scan the qr code

373
00:14:41,680 --> 00:14:43,279
and

374
00:14:43,279 --> 00:14:45,839
we we saw a couple of videos

375
00:14:45,839 --> 00:14:48,560
from youtube showing the cure code

376
00:14:48,560 --> 00:14:50,079
so

377
00:14:50,079 --> 00:14:52,880
what we did was just scan them

378
00:14:52,880 --> 00:14:55,600
and we scanned one of the qr codes from

379
00:14:55,600 --> 00:14:58,399
the installation guide on youtube and

380
00:14:58,399 --> 00:15:00,639
from our mobile application and we

381
00:15:00,639 --> 00:15:02,480
actually got an image which is censored

382
00:15:02,480 --> 00:15:03,600
because

383
00:15:03,600 --> 00:15:06,320
we're good people

384
00:15:06,320 --> 00:15:08,240
but it actually worked

385
00:15:08,240 --> 00:15:11,040
this poor guy in youtube he just wanted

386
00:15:11,040 --> 00:15:13,440
to share his knowledge on how to

387
00:15:13,440 --> 00:15:15,199
configure the app

388
00:15:15,199 --> 00:15:16,480
and

389
00:15:16,480 --> 00:15:18,079
we abused it

390
00:15:18,079 --> 00:15:21,440
to scan the keys qr code and enter

391
00:15:21,440 --> 00:15:23,199
to their device

392
00:15:23,199 --> 00:15:24,320
now

393
00:15:24,320 --> 00:15:26,320
what's behind this qr code so there are

394
00:15:26,320 --> 00:15:29,279
a couple of uh interesting parts uh the

395
00:15:29,279 --> 00:15:31,440
username the password plain text

396
00:15:31,440 --> 00:15:34,079
everything of course uh the domain the

397
00:15:34,079 --> 00:15:38,079
gateway and the home id now we have two

398
00:15:38,079 --> 00:15:40,800
more parts that are interesting we have

399
00:15:40,800 --> 00:15:43,360
the monitor code and the call code that

400
00:15:43,360 --> 00:15:45,920
we'll get into in a bit but what you

401
00:15:45,920 --> 00:15:48,079
need to look right now is the user and

402
00:15:48,079 --> 00:15:50,880
the home id are the two

403
00:15:50,880 --> 00:15:53,519
interesting parts the user is the mobile

404
00:15:53,519 --> 00:15:56,320
application user and it is associated

405
00:15:56,320 --> 00:15:58,720
with the home panel which is the

406
00:15:58,720 --> 00:16:00,880
username which is the home id

407
00:16:00,880 --> 00:16:03,680
and we have a password being generated

408
00:16:03,680 --> 00:16:05,600
somehow so first of all we want to

409
00:16:05,600 --> 00:16:08,800
understand how the username works again

410
00:16:08,800 --> 00:16:10,480
we turned out to reverse engineering and

411
00:16:10,480 --> 00:16:13,199
we got to this nice little function and

412
00:16:13,199 --> 00:16:15,519
this little function what it does is

413
00:16:15,519 --> 00:16:16,800
reading

414
00:16:16,800 --> 00:16:20,160
from a chip called ds2411

415
00:16:20,160 --> 00:16:22,800
using an iacto and

416
00:16:22,800 --> 00:16:25,519
it reads some kind of a serial now if

417
00:16:25,519 --> 00:16:27,120
you look at the

418
00:16:27,120 --> 00:16:29,279
description of this chip we'll see this

419
00:16:29,279 --> 00:16:31,440
is the chip by the way very blurry

420
00:16:31,440 --> 00:16:34,399
but we will see that it holds a 48-bit

421
00:16:34,399 --> 00:16:37,920
serial number just like a mac

422
00:16:37,920 --> 00:16:38,720
and

423
00:16:38,720 --> 00:16:40,720
mac address and so

424
00:16:40,720 --> 00:16:41,600
this

425
00:16:41,600 --> 00:16:45,279
unique 48-bit serial number

426
00:16:45,279 --> 00:16:47,920
resembles the the username and it has

427
00:16:47,920 --> 00:16:48,839
two

428
00:16:48,839 --> 00:16:51,920
parts it has a constant part

429
00:16:51,920 --> 00:16:54,560
starts always with zero four zero zero

430
00:16:54,560 --> 00:16:58,560
one twenty bits and it has 28 bits

431
00:16:58,560 --> 00:17:00,959
that that are being changed across

432
00:17:00,959 --> 00:17:02,720
different chips

433
00:17:02,720 --> 00:17:05,119
at least from what we researched

434
00:17:05,119 --> 00:17:06,319
so

435
00:17:06,319 --> 00:17:08,640
this is the full image so far we have

436
00:17:08,640 --> 00:17:10,000
two accounts

437
00:17:10,000 --> 00:17:13,199
that are being shared by this chip it's

438
00:17:13,199 --> 00:17:15,679
a hardware hardware based chip so that's

439
00:17:15,679 --> 00:17:18,720
why each intercom has a unique username

440
00:17:18,720 --> 00:17:21,439
and what's being changed between

441
00:17:21,439 --> 00:17:23,919
the wi-fi monitor the home panel and the

442
00:17:23,919 --> 00:17:26,400
intercom device is they share the same

443
00:17:26,400 --> 00:17:27,599
username

444
00:17:27,599 --> 00:17:29,280
only the first byte

445
00:17:29,280 --> 00:17:31,520
actually the second nibble that's the

446
00:17:31,520 --> 00:17:34,480
only difference and you can see up top

447
00:17:34,480 --> 00:17:37,440
the username starts with zero e on the

448
00:17:37,440 --> 00:17:39,440
mobile application and it starts with

449
00:17:39,440 --> 00:17:42,160
zero four on the wi-fi monitor so that's

450
00:17:42,160 --> 00:17:44,000
how they share

451
00:17:44,000 --> 00:17:47,120
how they are binded by the same username

452
00:17:47,120 --> 00:17:48,240
but

453
00:17:48,240 --> 00:17:49,760
obviously we ask yourself what about the

454
00:17:49,760 --> 00:17:52,000
password so we looked again reverse

455
00:17:52,000 --> 00:17:54,320
engineer again the application and we

456
00:17:54,320 --> 00:17:56,559
saw this little nice function

457
00:17:56,559 --> 00:17:59,039
and basically the password can be easily

458
00:17:59,039 --> 00:18:02,080
generated using this one liner

459
00:18:02,080 --> 00:18:04,799
it takes the md5 of the user it takes

460
00:18:04,799 --> 00:18:07,280
last two bytes big indian

461
00:18:07,280 --> 00:18:09,440
that's it so

462
00:18:09,440 --> 00:18:12,799
big fail yeah big fail

463
00:18:13,120 --> 00:18:15,679
and now we had the entire image in our

464
00:18:15,679 --> 00:18:18,960
in our minds uh we had the the two-wire

465
00:18:18,960 --> 00:18:21,600
system the intercom which communicates

466
00:18:21,600 --> 00:18:24,000
with the wire with the home panel the

467
00:18:24,000 --> 00:18:25,760
home panel has

468
00:18:25,760 --> 00:18:27,120
the same

469
00:18:27,120 --> 00:18:29,600
almost exactly the same username as the

470
00:18:29,600 --> 00:18:32,000
mob application that's how they know to

471
00:18:32,000 --> 00:18:33,600
communicate with each other in the

472
00:18:33,600 --> 00:18:35,600
cloud-based network

473
00:18:35,600 --> 00:18:37,760
and the username is based on a hardware

474
00:18:37,760 --> 00:18:40,720
chip ds2411

475
00:18:40,720 --> 00:18:42,960
and the user is generated

476
00:18:42,960 --> 00:18:45,120
easily with md5 big and the end of the

477
00:18:45,120 --> 00:18:47,360
last two bytes now

478
00:18:47,360 --> 00:18:49,520
we knew how to generate a password we

479
00:18:49,520 --> 00:18:52,400
knew how a username looks like so what

480
00:18:52,400 --> 00:18:55,200
we did obviously we created our own cure

481
00:18:55,200 --> 00:18:56,960
generator

482
00:18:56,960 --> 00:18:58,080
and

483
00:18:58,080 --> 00:19:00,240
once we created our own cure generated

484
00:19:00,240 --> 00:19:02,160
we just needed username a single

485
00:19:02,160 --> 00:19:04,080
username because if we had the username

486
00:19:04,080 --> 00:19:06,400
we could generate the password and then

487
00:19:06,400 --> 00:19:07,919
we could scan it with our own

488
00:19:07,919 --> 00:19:10,960
application but how can we get usernames

489
00:19:10,960 --> 00:19:12,000
from

490
00:19:12,000 --> 00:19:13,919
so if you remember from the beginning we

491
00:19:13,919 --> 00:19:15,840
started with gaining lots of phone calls

492
00:19:15,840 --> 00:19:19,600
so they called us so we will call them

493
00:19:19,600 --> 00:19:21,520
and we just

494
00:19:21,520 --> 00:19:22,480
scan

495
00:19:22,480 --> 00:19:25,679
we just generated lots of qr codes from

496
00:19:25,679 --> 00:19:26,799
the

497
00:19:26,799 --> 00:19:28,960
usernames that called us

498
00:19:28,960 --> 00:19:32,320
and then used the qr in our own mobile

499
00:19:32,320 --> 00:19:33,440
app

500
00:19:33,440 --> 00:19:36,160
to open the camera stream

501
00:19:36,160 --> 00:19:38,640
and at this point we could

502
00:19:38,640 --> 00:19:40,799
take username generate qr code scan it

503
00:19:40,799 --> 00:19:42,720
with the mobile application

504
00:19:42,720 --> 00:19:45,200
and get the video feed from the remote

505
00:19:45,200 --> 00:19:46,480
intercom

506
00:19:46,480 --> 00:19:48,559
and we ask ourselves

507
00:19:48,559 --> 00:19:50,720
how can we take

508
00:19:50,720 --> 00:19:52,720
over all the intercoms not just one by

509
00:19:52,720 --> 00:19:55,280
one because we're lazy we wanted to

510
00:19:55,280 --> 00:19:57,360
create an automation to do that

511
00:19:57,360 --> 00:19:59,360
so in order to do that we needed to

512
00:19:59,360 --> 00:20:01,520
create our own client first and to

513
00:20:01,520 --> 00:20:02,880
create our own client we need to

514
00:20:02,880 --> 00:20:04,480
understand a couple of things we need to

515
00:20:04,480 --> 00:20:06,640
understand how the zip network

516
00:20:06,640 --> 00:20:08,799
operates so how all the devices are

517
00:20:08,799 --> 00:20:10,159
communicating and establishing

518
00:20:10,159 --> 00:20:12,240
communication with each other and we

519
00:20:12,240 --> 00:20:13,520
also needed

520
00:20:13,520 --> 00:20:14,720
to understand all the different

521
00:20:14,720 --> 00:20:17,120
multimedia protocol stacks like how

522
00:20:17,120 --> 00:20:19,120
they're transferring data

523
00:20:19,120 --> 00:20:21,919
like video or audio from one to

524
00:20:21,919 --> 00:20:23,440
the the other one

525
00:20:23,440 --> 00:20:25,280
and obviously at the end we need to

526
00:20:25,280 --> 00:20:27,440
implement it ourselves

527
00:20:27,440 --> 00:20:29,120
so let's start with a bit of

528
00:20:29,120 --> 00:20:31,679
introduction into sip networks so

529
00:20:31,679 --> 00:20:33,679
everybody here are using

530
00:20:33,679 --> 00:20:36,240
sip in one one way or another when

531
00:20:36,240 --> 00:20:38,960
you're doing a whatsapp phone call it

532
00:20:38,960 --> 00:20:40,960
uses voip communication and behind the

533
00:20:40,960 --> 00:20:44,000
scene uses zip and when you're using

534
00:20:44,000 --> 00:20:46,480
almost any voip application you use the

535
00:20:46,480 --> 00:20:47,760
zip so

536
00:20:47,760 --> 00:20:49,760
at the very basis zip is very simple

537
00:20:49,760 --> 00:20:52,480
there is a network server in the middle

538
00:20:52,480 --> 00:20:53,520
and

539
00:20:53,520 --> 00:20:56,720
each party in the network each device

540
00:20:56,720 --> 00:20:58,799
has a unique identifier in the zip

541
00:20:58,799 --> 00:21:01,440
network and once they want to call the

542
00:21:01,440 --> 00:21:03,360
other party all they need to do is to

543
00:21:03,360 --> 00:21:06,000
tell the server hey i want to call this

544
00:21:06,000 --> 00:21:07,440
number

545
00:21:07,440 --> 00:21:09,120
and the server will say okay let's do

546
00:21:09,120 --> 00:21:10,080
this

547
00:21:10,080 --> 00:21:11,440
and

548
00:21:11,440 --> 00:21:14,240
as a simple sip

549
00:21:14,240 --> 00:21:16,960
call is very simple so

550
00:21:16,960 --> 00:21:19,120
sip is a textual base protocol in udp

551
00:21:19,120 --> 00:21:22,240
5016 and it can be implemented quite

552
00:21:22,240 --> 00:21:24,640
easily because it's it's textual

553
00:21:24,640 --> 00:21:27,600
a sip call looks like this so one party

554
00:21:27,600 --> 00:21:29,760
sends an invite request to the sip

555
00:21:29,760 --> 00:21:32,000
server telling the server hey i want to

556
00:21:32,000 --> 00:21:34,559
call this number the server will say

557
00:21:34,559 --> 00:21:36,880
okay no problem and we'll

558
00:21:36,880 --> 00:21:38,159
redirect

559
00:21:38,159 --> 00:21:41,600
or divert the call to the actual number

560
00:21:41,600 --> 00:21:43,760
that we want to call to and if they

561
00:21:43,760 --> 00:21:45,520
really want to answer they don't have to

562
00:21:45,520 --> 00:21:47,280
but if they really want to answer they

563
00:21:47,280 --> 00:21:50,400
will return 200 okay we will receive 200

564
00:21:50,400 --> 00:21:53,520
okay these are sip messages and

565
00:21:53,520 --> 00:21:56,960
sip codes and we will try with ack and

566
00:21:56,960 --> 00:22:00,720
then we will coordinate ports for audio

567
00:22:00,720 --> 00:22:03,039
and video transmission and then we'll

568
00:22:03,039 --> 00:22:05,200
transmit audio and video so at the very

569
00:22:05,200 --> 00:22:07,600
basis sip is very simple

570
00:22:07,600 --> 00:22:09,039
now

571
00:22:09,039 --> 00:22:10,640
in order to implement this we first

572
00:22:10,640 --> 00:22:12,480
needed to implement the authentication

573
00:22:12,480 --> 00:22:14,240
so the authentication

574
00:22:14,240 --> 00:22:15,280
is

575
00:22:15,280 --> 00:22:17,120
very simple in sip

576
00:22:17,120 --> 00:22:18,880
the authentication is based on challenge

577
00:22:18,880 --> 00:22:20,320
response

578
00:22:20,320 --> 00:22:22,799
the server sends us a challenge and we

579
00:22:22,799 --> 00:22:25,760
need to do some hash games you can see

580
00:22:25,760 --> 00:22:28,480
up top we are doing some hash games with

581
00:22:28,480 --> 00:22:31,520
this challenge and return to the server

582
00:22:31,520 --> 00:22:34,320
the the overall hash with the challenge

583
00:22:34,320 --> 00:22:36,000
and the server will do the same

584
00:22:36,000 --> 00:22:37,520
calculation

585
00:22:37,520 --> 00:22:40,960
locally and if the answers the results

586
00:22:40,960 --> 00:22:42,320
are the same

587
00:22:42,320 --> 00:22:44,320
it means we really know the password and

588
00:22:44,320 --> 00:22:47,440
we can log in so we need to to implement

589
00:22:47,440 --> 00:22:48,559
this

590
00:22:48,559 --> 00:22:50,880
we implement it in python

591
00:22:50,880 --> 00:22:53,039
and next we need to understand the

592
00:22:53,039 --> 00:22:55,200
multimedia protocols involved

593
00:22:55,200 --> 00:22:57,360
so when we're talking about multimeter

594
00:22:57,360 --> 00:22:59,840
protocol stacks there are different

595
00:22:59,840 --> 00:23:02,960
protocols that we can choose from

596
00:23:02,960 --> 00:23:06,080
specifically in this case they used sip

597
00:23:06,080 --> 00:23:08,400
for signaling sdp

598
00:23:08,400 --> 00:23:11,120
for metadata and port transferring and

599
00:23:11,120 --> 00:23:14,159
rtp for media transfer including audio

600
00:23:14,159 --> 00:23:16,960
and video but if you look at the image

601
00:23:16,960 --> 00:23:18,559
you can pick

602
00:23:18,559 --> 00:23:21,120
different protocols for the same

603
00:23:21,120 --> 00:23:23,039
the same usage actually

604
00:23:23,039 --> 00:23:25,440
so let's start quickly with the sip as i

605
00:23:25,440 --> 00:23:28,240
mentioned this sip is just for signaling

606
00:23:28,240 --> 00:23:30,320
hey i want to call this

607
00:23:30,320 --> 00:23:33,360
party and as you can see here this is an

608
00:23:33,360 --> 00:23:35,600
invite everything is textual so it's a

609
00:23:35,600 --> 00:23:38,960
very basic particle very similar to http

610
00:23:38,960 --> 00:23:40,080
in its

611
00:23:40,080 --> 00:23:41,120
structure

612
00:23:41,120 --> 00:23:45,200
and next over sip we're sending sdp

613
00:23:45,200 --> 00:23:48,880
sdp data which as you can see down below

614
00:23:48,880 --> 00:23:51,760
coordinates the ports for audio and

615
00:23:51,760 --> 00:23:55,039
video and also coordinates the codecs

616
00:23:55,039 --> 00:23:57,600
how the data will be encoded

617
00:23:57,600 --> 00:23:58,640
so

618
00:23:58,640 --> 00:24:00,960
once we have zip we can call the other

619
00:24:00,960 --> 00:24:03,200
party and we can coordinate the ports

620
00:24:03,200 --> 00:24:04,559
using sdp

621
00:24:04,559 --> 00:24:07,919
finally what's left is rtp to encode the

622
00:24:07,919 --> 00:24:10,799
data both the video and the audio so in

623
00:24:10,799 --> 00:24:14,360
this example the video is encoded using

624
00:24:14,360 --> 00:24:16,159
h.264

625
00:24:16,159 --> 00:24:18,559
and again we needed to understand this

626
00:24:18,559 --> 00:24:20,640
very well because we needed to implement

627
00:24:20,640 --> 00:24:21,679
it

628
00:24:21,679 --> 00:24:24,480
uh i could not find any ready to use

629
00:24:24,480 --> 00:24:25,840
packages or something like this to

630
00:24:25,840 --> 00:24:28,080
implement everything so we actually

631
00:24:28,080 --> 00:24:30,559
implemented it ourselves now if you look

632
00:24:30,559 --> 00:24:33,120
at a pickup that we capture from a

633
00:24:33,120 --> 00:24:35,520
normal device you can see all the stages

634
00:24:35,520 --> 00:24:38,559
that i discussed so we have zip to set

635
00:24:38,559 --> 00:24:40,880
up a call we have sdp to coordinate the

636
00:24:40,880 --> 00:24:42,000
ports

637
00:24:42,000 --> 00:24:43,679
we have more particles that are not very

638
00:24:43,679 --> 00:24:45,840
important right now and finally we have

639
00:24:45,840 --> 00:24:48,799
rtp to transfer the audio and video

640
00:24:48,799 --> 00:24:51,919
now we had all of this information so we

641
00:24:51,919 --> 00:24:55,039
started to pawn intercoms at scale and

642
00:24:55,039 --> 00:24:56,720
to do that we needed to build our

643
00:24:56,720 --> 00:24:58,880
automation as i mentioned earlier that

644
00:24:58,880 --> 00:25:01,039
needs to go over all the intercoms and

645
00:25:01,039 --> 00:25:03,919
just log in on their behalf

646
00:25:03,919 --> 00:25:05,360
and

647
00:25:05,360 --> 00:25:07,600
ask the intercom to send a video stream

648
00:25:07,600 --> 00:25:10,240
so how this automation looks like

649
00:25:10,240 --> 00:25:12,080
we have first

650
00:25:12,080 --> 00:25:14,640
stage of finding usernames so we needed

651
00:25:14,640 --> 00:25:16,000
to brute force

652
00:25:16,000 --> 00:25:19,760
3.5 bytes or 28 bits

653
00:25:19,760 --> 00:25:22,559
because we knew uh the 21st bits they're

654
00:25:22,559 --> 00:25:23,679
constant

655
00:25:23,679 --> 00:25:25,360
and to do that all we needed to

656
00:25:25,360 --> 00:25:27,679
implement is the sip

657
00:25:27,679 --> 00:25:28,960
register

658
00:25:28,960 --> 00:25:31,039
request as i

659
00:25:31,039 --> 00:25:32,720
showed you earlier with the challenge

660
00:25:32,720 --> 00:25:35,440
response and if the username and

661
00:25:35,440 --> 00:25:37,919
password matches then we'll get a valid

662
00:25:37,919 --> 00:25:39,919
username and we can move on to the

663
00:25:39,919 --> 00:25:42,960
second stage the second stage

664
00:25:42,960 --> 00:25:44,320
is

665
00:25:44,320 --> 00:25:47,279
mimicking the actual

666
00:25:47,279 --> 00:25:48,640
click

667
00:25:48,640 --> 00:25:49,840
on the

668
00:25:49,840 --> 00:25:51,520
on the mobile application

669
00:25:51,520 --> 00:25:52,799
that

670
00:25:52,799 --> 00:25:55,840
simulates as if someone just wanted to

671
00:25:55,840 --> 00:25:58,240
ring their intercom to open the

672
00:25:58,240 --> 00:26:00,400
surveillance mode on their intercom

673
00:26:00,400 --> 00:26:03,120
and in this stage we are sending a sip

674
00:26:03,120 --> 00:26:04,320
invite

675
00:26:04,320 --> 00:26:06,960
and we're waiting for the intercom

676
00:26:06,960 --> 00:26:08,480
since we're

677
00:26:08,480 --> 00:26:10,159
part of the network and we're

678
00:26:10,159 --> 00:26:12,159
authenticating the network we're waiting

679
00:26:12,159 --> 00:26:14,159
for the intercom to reply back to us

680
00:26:14,159 --> 00:26:15,840
that everything is okay

681
00:26:15,840 --> 00:26:17,120
and

682
00:26:17,120 --> 00:26:19,760
again we're sending first the invite

683
00:26:19,760 --> 00:26:22,159
then we're coordinating the ports and

684
00:26:22,159 --> 00:26:24,320
the codecs and finally we're starting to

685
00:26:24,320 --> 00:26:26,960
receive the rtp stream but before we can

686
00:26:26,960 --> 00:26:29,600
receive the rtp stream again

687
00:26:29,600 --> 00:26:31,919
up until now we're just communicating

688
00:26:31,919 --> 00:26:33,520
not with the intercom itself we're

689
00:26:33,520 --> 00:26:35,919
communicating with the home panel

690
00:26:35,919 --> 00:26:37,520
at this point we're getting a blue

691
00:26:37,520 --> 00:26:41,200
screen because the two-wire system

692
00:26:41,200 --> 00:26:43,120
is not fully configured yet we're just

693
00:26:43,120 --> 00:26:45,520
talking to the home panel in order to

694
00:26:45,520 --> 00:26:48,400
open the camera on the intercom we need

695
00:26:48,400 --> 00:26:50,799
the home panel to tell the intercom

696
00:26:50,799 --> 00:26:53,360
somehow hey please open the the camera

697
00:26:53,360 --> 00:26:56,080
and to do that we're using sip signaling

698
00:26:56,080 --> 00:26:57,600
if you remember the codes from the

699
00:26:57,600 --> 00:27:00,240
beginning we extracted all the codes

700
00:27:00,240 --> 00:27:02,320
from the reverse engineering procedure

701
00:27:02,320 --> 00:27:04,480
and basically what we're doing is we're

702
00:27:04,480 --> 00:27:06,960
telling the home panel

703
00:27:06,960 --> 00:27:09,120
please let the intercom know that we

704
00:27:09,120 --> 00:27:11,840
want to open the camera and we're using

705
00:27:11,840 --> 00:27:13,520
sip signaling to do that basically what

706
00:27:13,520 --> 00:27:16,080
it will do it will signal

707
00:27:16,080 --> 00:27:18,399
through sip to the intercom over the

708
00:27:18,399 --> 00:27:20,640
two-wire system some

709
00:27:20,640 --> 00:27:22,960
some keys so in this case in order to

710
00:27:22,960 --> 00:27:25,760
open the camera we need to transmit the

711
00:27:25,760 --> 00:27:29,520
signaling of one zero zero zero pound

712
00:27:29,520 --> 00:27:31,279
and once we are doing this the intercom

713
00:27:31,279 --> 00:27:33,520
understands that the home panel is

714
00:27:33,520 --> 00:27:36,080
commanding it to open the camera and it

715
00:27:36,080 --> 00:27:39,120
starts transmit data video data to the

716
00:27:39,120 --> 00:27:41,360
home panel and the home panel we will

717
00:27:41,360 --> 00:27:43,919
redirect this data to the surveillance

718
00:27:43,919 --> 00:27:45,600
mode in our app

719
00:27:45,600 --> 00:27:46,559
so

720
00:27:46,559 --> 00:27:48,720
this is the entire automation

721
00:27:48,720 --> 00:27:51,039
we built the final stage is to receive

722
00:27:51,039 --> 00:27:53,520
over the coordinated ports the rtp

723
00:27:53,520 --> 00:27:57,039
stream specifically the h.264 uh encoded

724
00:27:57,039 --> 00:27:59,840
stream video stream and convert it to

725
00:27:59,840 --> 00:28:03,039
mp4 using ffmpeg and

726
00:28:03,039 --> 00:28:04,640
this is the application this is the

727
00:28:04,640 --> 00:28:07,200
stage in the application that

728
00:28:07,200 --> 00:28:08,880
we're mimicking right now

729
00:28:08,880 --> 00:28:11,679
and we have the image now i have a short

730
00:28:11,679 --> 00:28:13,279
demo to show you

731
00:28:13,279 --> 00:28:16,159
of this entire operation running on a

732
00:28:16,159 --> 00:28:19,120
single device

733
00:28:19,200 --> 00:28:22,399
so very hacky stuff

734
00:28:22,399 --> 00:28:24,240
what you're seeing now is the zip

735
00:28:24,240 --> 00:28:27,200
signaling the registration the the

736
00:28:27,200 --> 00:28:28,640
signaling itself

737
00:28:28,640 --> 00:28:31,440
entering the network transmitting the

738
00:28:31,440 --> 00:28:34,080
data from the home panel to the intercom

739
00:28:34,080 --> 00:28:36,159
and once this session is done we're

740
00:28:36,159 --> 00:28:38,799
receiving the the stream and we have

741
00:28:38,799 --> 00:28:41,960
the video

742
00:28:49,039 --> 00:28:52,960
okay okay so we if we have a username we

743
00:28:52,960 --> 00:28:54,640
can open the camera stream we can

744
00:28:54,640 --> 00:28:56,880
transmit audio and we can unlock the

745
00:28:56,880 --> 00:28:59,360
door and again we can do all of these

746
00:28:59,360 --> 00:29:01,840
using the sip signaling the home panel

747
00:29:01,840 --> 00:29:04,399
is transferring this data over the

748
00:29:04,399 --> 00:29:06,000
two-wire system and

749
00:29:06,000 --> 00:29:07,520
for example to unlock the door you can

750
00:29:07,520 --> 00:29:09,120
send the

751
00:29:09,120 --> 00:29:11,360
the specific codes that i showed you

752
00:29:11,360 --> 00:29:12,880
earlier

753
00:29:12,880 --> 00:29:15,440
now all of these are pwned

754
00:29:15,440 --> 00:29:17,520
but

755
00:29:17,520 --> 00:29:19,919
we wanted to do this at scale

756
00:29:19,919 --> 00:29:20,960
so

757
00:29:20,960 --> 00:29:23,279
one is not enough the automation runs on

758
00:29:23,279 --> 00:29:25,360
one device in our lab but we wanted to

759
00:29:25,360 --> 00:29:28,320
do it on a lot of devices from around

760
00:29:28,320 --> 00:29:32,559
the world so we used our brute forcer to

761
00:29:32,559 --> 00:29:35,200
brute force the 28 bits

762
00:29:35,200 --> 00:29:37,120
to go over and just search for intercoms

763
00:29:37,120 --> 00:29:38,559
around the world

764
00:29:38,559 --> 00:29:41,600
eventually we had streams from hundreds

765
00:29:41,600 --> 00:29:42,960
of devices

766
00:29:42,960 --> 00:29:44,880
distributed across the globe you can see

767
00:29:44,880 --> 00:29:46,960
many devices from germany and hungary in

768
00:29:46,960 --> 00:29:48,240
israel and

769
00:29:48,240 --> 00:29:49,360
whatever

770
00:29:49,360 --> 00:29:50,480
but

771
00:29:50,480 --> 00:29:54,000
we had lots of videos and images so what

772
00:29:54,000 --> 00:29:55,360
can we do with

773
00:29:55,360 --> 00:29:58,559
lots of images from all around the world

774
00:29:58,559 --> 00:30:01,600
obviously create a collage

775
00:30:01,600 --> 00:30:03,360
of bluehead

776
00:30:03,360 --> 00:30:05,679
and if we'll enhance we'll see a bit

777
00:30:05,679 --> 00:30:07,039
more images

778
00:30:07,039 --> 00:30:10,240
and more images

779
00:30:14,880 --> 00:30:16,320
yeah so this is

780
00:30:16,320 --> 00:30:18,799
this is our automation running

781
00:30:18,799 --> 00:30:20,640
you can see everything

782
00:30:20,640 --> 00:30:23,840
kind of uh the big brother style

783
00:30:23,840 --> 00:30:26,159
and we let it run it's just beautiful we

784
00:30:26,159 --> 00:30:27,840
let it run for hours

785
00:30:27,840 --> 00:30:30,720
collecting tons of videos donuts tons of

786
00:30:30,720 --> 00:30:32,640
images to create the beautiful collage i

787
00:30:32,640 --> 00:30:34,840
just sent you

788
00:30:34,840 --> 00:30:36,720
um and

789
00:30:36,720 --> 00:30:38,399
that basically that's it that's the

790
00:30:38,399 --> 00:30:42,559
interesting part now for the disclosure

791
00:30:42,559 --> 00:30:45,840
we tried to contact the company once

792
00:30:45,840 --> 00:30:47,279
and twice

793
00:30:47,279 --> 00:30:50,159
and more and more and they just did not

794
00:30:50,159 --> 00:30:52,480
reply to us they ignored all of our

795
00:30:52,480 --> 00:30:54,240
emails all of our

796
00:30:54,240 --> 00:30:56,240
disclosure efforts

797
00:30:56,240 --> 00:30:59,760
and we even called them to china

798
00:30:59,760 --> 00:31:02,799
and a nice lady picked up the phone and

799
00:31:02,799 --> 00:31:05,120
told us in an accident that i can barely

800
00:31:05,120 --> 00:31:06,320
understand

801
00:31:06,320 --> 00:31:07,120
that

802
00:31:07,120 --> 00:31:09,919
she insists us to send an email

803
00:31:09,919 --> 00:31:11,840
detailing

804
00:31:11,840 --> 00:31:14,799
our request and i told her i just sent

805
00:31:14,799 --> 00:31:17,760
three emails and she said no please send

806
00:31:17,760 --> 00:31:19,360
another email we need your email and i

807
00:31:19,360 --> 00:31:22,080
said okay i'm going to send an email but

808
00:31:22,080 --> 00:31:25,200
if we if you'll ignore us we're

809
00:31:25,200 --> 00:31:26,880
we will turn to one of the search

810
00:31:26,880 --> 00:31:28,960
organizations and she said okay send an

811
00:31:28,960 --> 00:31:31,200
email and she ignored us of course and

812
00:31:31,200 --> 00:31:34,640
so we contacted the certio they also

813
00:31:34,640 --> 00:31:36,640
tried to help us to contact the company

814
00:31:36,640 --> 00:31:38,880
because there is a local distributor in

815
00:31:38,880 --> 00:31:41,440
israel and they could not

816
00:31:41,440 --> 00:31:43,600
get any response from the manufacturer

817
00:31:43,600 --> 00:31:46,240
so we just decided uh to publish this

818
00:31:46,240 --> 00:31:48,399
because we think the public need to know

819
00:31:48,399 --> 00:31:50,799
about the dangers and the risks in

820
00:31:50,799 --> 00:31:53,679
exposing internet to the cloud

821
00:31:53,679 --> 00:31:55,519
so to sum up

822
00:31:55,519 --> 00:31:57,600
a bed authentication design allowed us

823
00:31:57,600 --> 00:32:01,039
to hack many devices and

824
00:32:01,039 --> 00:32:02,880
it was due to a mistake

825
00:32:02,880 --> 00:32:04,480
a very and it hurt

826
00:32:04,480 --> 00:32:08,480
a very flawed system that allowed us

827
00:32:08,480 --> 00:32:09,360
to

828
00:32:09,360 --> 00:32:11,600
not only brute force user names but also

829
00:32:11,600 --> 00:32:14,399
generate their passwords

830
00:32:14,399 --> 00:32:17,039
and we use this to pawn intercoms at

831
00:32:17,039 --> 00:32:18,640
scale so we brought

832
00:32:18,640 --> 00:32:21,039
many many many video streams in order to

833
00:32:21,039 --> 00:32:23,519
create the beautiful collage

834
00:32:23,519 --> 00:32:25,120
and

835
00:32:25,120 --> 00:32:27,440
we can use this to unlock doors open

836
00:32:27,440 --> 00:32:30,720
camera streams and even play sounds

837
00:32:30,720 --> 00:32:31,679
and

838
00:32:31,679 --> 00:32:33,440
basically what we wanted to do here is

839
00:32:33,440 --> 00:32:37,360
to say that we need the s in iot

840
00:32:37,360 --> 00:32:38,480
because

841
00:32:38,480 --> 00:32:41,279
many of iot devices are broken and we

842
00:32:41,279 --> 00:32:42,799
must

843
00:32:42,799 --> 00:32:45,120
nudge the vendors in order to them to

844
00:32:45,120 --> 00:32:48,559
add security to iot devices

845
00:32:48,559 --> 00:32:52,678
that's it thank you

846
00:33:01,080 --> 00:33:03,760
[Music]

847
00:33:03,760 --> 00:33:05,840
you

