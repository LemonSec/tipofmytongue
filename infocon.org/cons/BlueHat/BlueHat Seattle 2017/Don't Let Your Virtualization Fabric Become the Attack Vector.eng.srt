1
00:00:00,030 --> 00:00:05,040
and we are gonna turn<font color="#E5E5E5"> the floor over to</font>

2
00:00:02,879 --> 00:00:06,839
<font color="#E5E5E5">Dean</font><font color="#CCCCCC"> Wells who has been around Microsoft</font>

3
00:00:05,040 --> 00:00:09,059
on and off for<font color="#CCCCCC"> a</font><font color="#E5E5E5"> good</font><font color="#CCCCCC"> number of</font><font color="#E5E5E5"> years</font>

4
00:00:06,839 --> 00:00:09,840
now<font color="#CCCCCC"> after a brief</font><font color="#E5E5E5"> stint doing something</font>

5
00:00:09,059 --> 00:00:11,670
with what are they called those

6
00:00:09,840 --> 00:00:16,969
rectangular<font color="#E5E5E5"> objects with pages we all</font>

7
00:00:11,670 --> 00:00:16,969
used to<font color="#CCCCCC"> remember but start with it</font><font color="#E5E5E5"> be</font>

8
00:00:17,690 --> 00:00:25,340
<font color="#E5E5E5">the things that came before Kindles any</font>

9
00:00:20,520 --> 00:00:28,769
case<font color="#E5E5E5"> let's give Dean a warm welcome</font>

10
00:00:25,340 --> 00:00:31,050
come on warmer than<font color="#E5E5E5"> that little warmer</font>

11
00:00:28,769 --> 00:00:32,488
<font color="#E5E5E5">okay</font><font color="#CCCCCC"> - one - oh I'm too warm now it's</font>

12
00:00:31,050 --> 00:00:33,809
all<font color="#E5E5E5"> going</font><font color="#CCCCCC"> to go to his head that's your</font>

13
00:00:32,488 --> 00:00:35,279
idea of warm I'd hate to see<font color="#E5E5E5"> what it was</font>

14
00:00:33,809 --> 00:00:36,959
<font color="#E5E5E5">like</font><font color="#CCCCCC"> when it was a cold welcome all</font>

15
00:00:35,280 --> 00:00:38,520
<font color="#E5E5E5">right my name is Dean</font><font color="#CCCCCC"> Wells I'm a</font>

16
00:00:36,960 --> 00:00:40,320
program manager<font color="#CCCCCC"> in the</font><font color="#E5E5E5"> Windows</font><font color="#CCCCCC"> server</font>

17
00:00:38,520 --> 00:00:42,149
team specifically<font color="#CCCCCC"> I work</font><font color="#E5E5E5"> on assurance</font>

18
00:00:40,320 --> 00:00:44,489
<font color="#E5E5E5">technologies what we're going to be</font>

19
00:00:42,149 --> 00:00:45,719
talking about<font color="#E5E5E5"> today is specifically what</font>

20
00:00:44,489 --> 00:00:48,089
<font color="#E5E5E5">sort</font><font color="#CCCCCC"> of attacks are unique to</font>

21
00:00:45,719 --> 00:00:49,530
virtualization fabrics obviously there

22
00:00:48,090 --> 00:00:51,449
is somewhat<font color="#E5E5E5"> of a bias here toward</font>

23
00:00:49,530 --> 00:00:52,920
hyper-v<font color="#E5E5E5"> but these attack vectors are</font>

24
00:00:51,449 --> 00:00:54,510
pretty much<font color="#CCCCCC"> universal they'll work on</font>

25
00:00:52,920 --> 00:00:56,879
<font color="#CCCCCC">vmware and</font><font color="#E5E5E5"> the rest of the field as well</font>

26
00:00:54,510 --> 00:00:58,230
<font color="#E5E5E5">so why focus well the reason for</font>

27
00:00:56,879 --> 00:01:00,210
focusing<font color="#CCCCCC"> on</font><font color="#E5E5E5"> this is because there</font><font color="#CCCCCC"> are</font>

28
00:00:58,230 --> 00:01:01,620
attack vectors as I said that<font color="#CCCCCC"> are unique</font>

29
00:01:00,210 --> 00:01:03,960
to the fact that<font color="#E5E5E5"> you're</font><font color="#CCCCCC"> running</font><font color="#E5E5E5"> a</font>

30
00:01:01,620 --> 00:01:05,128
workload<font color="#CCCCCC"> on a</font><font color="#E5E5E5"> virtualization fabric now</font>

31
00:01:03,960 --> 00:01:06,900
I want<font color="#E5E5E5"> to give you a checklist of the</font>

32
00:01:05,129 --> 00:01:08,490
requirements<font color="#CCCCCC"> to build one</font><font color="#E5E5E5"> if you want to</font>

33
00:01:06,900 --> 00:01:10,350
<font color="#E5E5E5">build a</font><font color="#CCCCCC"> guided fabric something that</font>

34
00:01:08,490 --> 00:01:11,520
could<font color="#CCCCCC"> protect itself from</font><font color="#E5E5E5"> these attacks</font>

35
00:01:10,350 --> 00:01:13,619
what would a sort of<font color="#CCCCCC"> high-level</font>

36
00:01:11,520 --> 00:01:15,119
checklist look like<font color="#E5E5E5"> last but not least</font>

37
00:01:13,619 --> 00:01:17,250
and let the attacks begin and I'll walk

38
00:01:15,119 --> 00:01:19,140
<font color="#E5E5E5">you through a slew of attacks we can't</font>

39
00:01:17,250 --> 00:01:21,240
do them all<font color="#CCCCCC"> we've got</font><font color="#E5E5E5"> about 12 in</font><font color="#CCCCCC"> total</font>

40
00:01:19,140 --> 00:01:22,770
<font color="#CCCCCC">that we show I'm gonna do about</font><font color="#E5E5E5"> six or</font>

41
00:01:21,240 --> 00:01:25,110
seven here and show you how we<font color="#CCCCCC"> mitigate</font>

42
00:01:22,770 --> 00:01:27,179
them all right first things first then

43
00:01:25,110 --> 00:01:29,220
take a look on<font color="#CCCCCC"> the</font><font color="#E5E5E5"> left side this is the</font>

44
00:01:27,180 --> 00:01:31,290
<font color="#E5E5E5">side</font><font color="#CCCCCC"> of the</font><font color="#E5E5E5"> industry</font><font color="#CCCCCC"> that I'd say got</font>

45
00:01:29,220 --> 00:01:33,689
most of the attention<font color="#E5E5E5"> for a decade</font>

46
00:01:31,290 --> 00:01:34,680
possibly even longer<font color="#E5E5E5"> the right side of</font>

47
00:01:33,689 --> 00:01:37,020
the board though where we've got

48
00:01:34,680 --> 00:01:39,600
compromised fabrics<font color="#E5E5E5"> easy to copy or</font>

49
00:01:37,020 --> 00:01:41,939
modify<font color="#E5E5E5"> VMs without notice can't protect</font>

50
00:01:39,600 --> 00:01:43,979
<font color="#E5E5E5">a virtual</font><font color="#CCCCCC"> machine</font><font color="#E5E5E5"> with gates walls cages</font>

51
00:01:41,939 --> 00:01:46,798
and security guards<font color="#CCCCCC"> who did</font><font color="#E5E5E5"> anything</font>

52
00:01:43,979 --> 00:01:49,200
<font color="#E5E5E5">here precisely nobody the entire</font>

53
00:01:46,799 --> 00:01:51,270
<font color="#E5E5E5">industry had its head in the</font><font color="#CCCCCC"> sand</font><font color="#E5E5E5"> except</font>

54
00:01:49,200 --> 00:01:52,500
for<font color="#E5E5E5"> us we finally decided to do</font>

55
00:01:51,270 --> 00:01:54,630
<font color="#E5E5E5">something about this</font><font color="#CCCCCC"> and I'll show you</font>

56
00:01:52,500 --> 00:01:56,280
what that<font color="#CCCCCC"> is</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> little bit later</font><font color="#E5E5E5"> by the</font>

57
00:01:54,630 --> 00:01:57,449
way if you think<font color="#E5E5E5"> I'm talking fast now</font>

58
00:01:56,280 --> 00:01:59,250
see what<font color="#E5E5E5"> happens when there's two</font>

59
00:01:57,450 --> 00:02:00,780
minutes<font color="#CCCCCC"> of the session left</font><font color="#E5E5E5"> all right</font>

60
00:01:59,250 --> 00:02:02,880
first the solutions<font color="#CCCCCC"> high-level</font>

61
00:02:00,780 --> 00:02:04,799
requirements<font color="#CCCCCC"> a place to run sensitive</font>

62
00:02:02,880 --> 00:02:06,990
virtualized workloads that's free from

63
00:02:04,799 --> 00:02:08,520
<font color="#E5E5E5">malicious software I know I shouldn't</font>

64
00:02:06,990 --> 00:02:10,709
say<font color="#CCCCCC"> this because</font><font color="#E5E5E5"> it's being</font><font color="#CCCCCC"> recorded but</font>

65
00:02:08,520 --> 00:02:12,720
that one falls into the<font color="#E5E5E5"> no-shit category</font>

66
00:02:10,709 --> 00:02:13,550
<font color="#E5E5E5">that's the one we really</font><font color="#CCCCCC"> do have</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> get</font>

67
00:02:12,720 --> 00:02:15,380
nailed

68
00:02:13,550 --> 00:02:17,210
<font color="#E5E5E5">a way to verify</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> the host is in</font><font color="#CCCCCC"> a</font>

69
00:02:15,380 --> 00:02:19,579
healthy<font color="#E5E5E5"> state absolutely that would</font><font color="#CCCCCC"> be</font>

70
00:02:17,210 --> 00:02:21,650
useful<font color="#CCCCCC"> a process to securely release</font>

71
00:02:19,580 --> 00:02:24,170
keys and only to do so to healthy<font color="#CCCCCC"> host</font>

72
00:02:21,650 --> 00:02:26,300
<font color="#E5E5E5">and last but not least management tools</font>

73
00:02:24,170 --> 00:02:28,970
<font color="#E5E5E5">to automate the secure provisioning of</font>

74
00:02:26,300 --> 00:02:30,590
these virtualized workloads<font color="#CCCCCC"> so onto the</font>

75
00:02:28,970 --> 00:02:32,840
<font color="#E5E5E5">attack let me first introduce a couple</font>

76
00:02:30,590 --> 00:02:35,330
of nefarious<font color="#E5E5E5"> characters though anyone</font>

77
00:02:32,840 --> 00:02:37,400
<font color="#E5E5E5">know this face</font><font color="#CCCCCC"> I know he's handsome</font>

78
00:02:35,330 --> 00:02:38,420
boyish looking but he really is a nasty

79
00:02:37,400 --> 00:02:41,090
<font color="#CCCCCC">piece of work</font>

80
00:02:38,420 --> 00:02:42,920
teheh is one of my peers in the<font color="#E5E5E5"> hyper-v</font>

81
00:02:41,090 --> 00:02:44,870
team he owns containers in this

82
00:02:42,920 --> 00:02:46,760
particular guys<font color="#E5E5E5"> he's going to be our</font>

83
00:02:44,870 --> 00:02:48,260
fabric admin and he's going<font color="#E5E5E5"> to be</font>

84
00:02:46,760 --> 00:02:50,600
readily bribable with thin mints and

85
00:02:48,260 --> 00:02:53,420
<font color="#E5E5E5">various other</font><font color="#CCCCCC"> things</font><font color="#E5E5E5"> this guy is just</font>

86
00:02:50,600 --> 00:02:56,150
permanently angry<font color="#E5E5E5"> anyone anyone here</font>

87
00:02:53,420 --> 00:02:57,950
<font color="#E5E5E5">know Ned a few of you erased me hands</font>

88
00:02:56,150 --> 00:03:00,470
<font color="#E5E5E5">okay nobody's going to argue he is angry</font>

89
00:02:57,950 --> 00:03:03,049
<font color="#E5E5E5">a lot he is going</font><font color="#CCCCCC"> to be our</font><font color="#E5E5E5"> storage</font>

90
00:03:00,470 --> 00:03:05,810
admin so here's<font color="#CCCCCC"> attack 1 Ned</font><font color="#E5E5E5"> wants</font><font color="#CCCCCC"> a</font>

91
00:03:03,050 --> 00:03:08,120
race so he decides having his background

92
00:03:05,810 --> 00:03:09,950
in storage<font color="#CCCCCC"> smv</font><font color="#E5E5E5"> and active directory that</font>

93
00:03:08,120 --> 00:03:12,140
<font color="#E5E5E5">he's going</font><font color="#CCCCCC"> to give himself a race by</font>

94
00:03:09,950 --> 00:03:13,970
simply going<font color="#E5E5E5"> ahead and stealing the HR</font>

95
00:03:12,140 --> 00:03:15,410
<font color="#CCCCCC">and accounting admins</font><font color="#E5E5E5"> Active Directory</font>

96
00:03:13,970 --> 00:03:17,390
passwords and then making the

97
00:03:15,410 --> 00:03:18,890
modification himself<font color="#E5E5E5"> how does he do</font><font color="#CCCCCC"> this</font>

98
00:03:17,390 --> 00:03:21,200
because<font color="#E5E5E5"> there's a virtualized domain</font>

99
00:03:18,890 --> 00:03:24,290
controller<font color="#E5E5E5"> running</font><font color="#CCCCCC"> on a hyper-v hosts</font>

100
00:03:21,200 --> 00:03:26,000
<font color="#E5E5E5">who's storing its VH DS the HDX is VM</font>

101
00:03:24,290 --> 00:03:28,970
decays I don't care what hypervisor it

102
00:03:26,000 --> 00:03:32,390
is on Ned's file<font color="#CCCCCC"> service subsequently</font>

103
00:03:28,970 --> 00:03:33,709
<font color="#E5E5E5">Ned has access to it so</font><font color="#CCCCCC"> rolling the demo</font>

104
00:03:32,390 --> 00:03:35,208
forward<font color="#CCCCCC"> so you look made out of fabric</font>

105
00:03:33,709 --> 00:03:36,530
very clever<font color="#CCCCCC"> that was subtle took me</font>

106
00:03:35,209 --> 00:03:38,780
weeks to<font color="#E5E5E5"> come up with that here's the</font>

107
00:03:36,530 --> 00:03:40,880
attack<font color="#CCCCCC"> steal</font><font color="#E5E5E5"> a user's password from an</font>

108
00:03:38,780 --> 00:03:43,010
offline copy of a virtualized Active

109
00:03:40,880 --> 00:03:44,480
Directory domain controller<font color="#E5E5E5"> this virtual</font>

110
00:03:43,010 --> 00:03:47,390
domain controller runs on a high post

111
00:03:44,480 --> 00:03:50,090
<font color="#E5E5E5">that uses nice scuzzy target stored on a</font>

112
00:03:47,390 --> 00:03:52,250
file<font color="#CCCCCC"> server over smb3 to mount the disk</font>

113
00:03:50,090 --> 00:03:54,170
locally so that<font color="#CCCCCC"> it's got nice fast</font>

114
00:03:52,250 --> 00:03:56,300
access to<font color="#E5E5E5"> storage that's managed by</font><font color="#CCCCCC"> a</font>

115
00:03:54,170 --> 00:03:58,458
different team<font color="#E5E5E5"> so the first thing</font><font color="#CCCCCC"> that</font>

116
00:03:56,300 --> 00:04:00,650
Ned does is he<font color="#E5E5E5"> takes a copy of that and</font>

117
00:03:58,459 --> 00:04:03,590
puts it into<font color="#E5E5E5"> his scratch</font><font color="#CCCCCC"> since</font><font color="#E5E5E5"> it's a</font>

118
00:04:00,650 --> 00:04:05,180
VHDX he mounts it he locates the VX<font color="#CCCCCC"> a</font>

119
00:04:03,590 --> 00:04:07,520
<font color="#E5E5E5">VHDX of the Active Directory domain</font>

120
00:04:05,180 --> 00:04:08,989
controller and mounts<font color="#CCCCCC"> that</font><font color="#E5E5E5"> the first</font>

121
00:04:07,520 --> 00:04:11,090
thing he then does is the use these

122
00:04:08,989 --> 00:04:12,830
<font color="#E5E5E5">decisions internals calls or dis</font>

123
00:04:11,090 --> 00:04:14,780
internals as I like to call<font color="#CCCCCC"> them these</font>

124
00:04:12,830 --> 00:04:15,950
<font color="#E5E5E5">BS internals tools have been around for</font>

125
00:04:14,780 --> 00:04:18,589
a while<font color="#CCCCCC"> and now they've gone ahead and</font>

126
00:04:15,950 --> 00:04:22,010
<font color="#E5E5E5">built</font><font color="#CCCCCC"> PowerShell modules around</font><font color="#E5E5E5"> it Thank</font>

127
00:04:18,589 --> 00:04:23,479
<font color="#E5E5E5">You Lee homes much appreciated all we're</font>

128
00:04:22,010 --> 00:04:25,640
doing<font color="#CCCCCC"> here is we are literally</font>

129
00:04:23,479 --> 00:04:27,500
<font color="#E5E5E5">extracting the system key out of the</font>

130
00:04:25,640 --> 00:04:29,330
system hive we're then using<font color="#E5E5E5"> that</font>

131
00:04:27,500 --> 00:04:31,430
system key to decrypt<font color="#E5E5E5"> active</font><font color="#CCCCCC"> directories</font>

132
00:04:29,330 --> 00:04:33,260
password encryption key<font color="#E5E5E5"> and then dumping</font>

133
00:04:31,430 --> 00:04:33,800
all<font color="#E5E5E5"> of the now unencrypted password</font>

134
00:04:33,260 --> 00:04:36,260
hashes

135
00:04:33,800 --> 00:04:38,180
can anyone say pass<font color="#CCCCCC"> the hash brute-force</font>

136
00:04:36,260 --> 00:04:39,770
attack whatever<font color="#CCCCCC"> I want to do I can walk</font>

137
00:04:38,180 --> 00:04:41,810
off with<font color="#E5E5E5"> this how long do you really</font>

138
00:04:39,770 --> 00:04:44,330
<font color="#E5E5E5">think with that list it's gonna take me</font>

139
00:04:41,810 --> 00:04:46,670
to get<font color="#CCCCCC"> something that's useful</font><font color="#E5E5E5"> not too</font>

140
00:04:44,330 --> 00:04:49,159
long<font color="#E5E5E5"> how do we mitigate that particular</font>

141
00:04:46,670 --> 00:04:50,720
attack<font color="#E5E5E5"> how</font><font color="#CCCCCC"> would we mitigate that</font><font color="#E5E5E5"> well</font>

142
00:04:49,160 --> 00:04:53,060
here's one<font color="#E5E5E5"> how about we encrypt the</font>

143
00:04:50,720 --> 00:04:54,590
storage using keying<font color="#CCCCCC"> material that's</font>

144
00:04:53,060 --> 00:04:57,290
only<font color="#CCCCCC"> available to the virtualization</font>

145
00:04:54,590 --> 00:04:59,090
<font color="#E5E5E5">host that way it's not encrypted by</font>

146
00:04:57,290 --> 00:05:01,490
<font color="#CCCCCC">ned's device that ned has the key for</font>

147
00:04:59,090 --> 00:05:04,310
<font color="#E5E5E5">it's encrypted by the hyper-v hosts or</font>

148
00:05:01,490 --> 00:05:05,540
by the<font color="#E5E5E5"> VMware host so let's reset I love</font>

149
00:05:04,310 --> 00:05:07,430
that animation what a fantastic

150
00:05:05,540 --> 00:05:08,900
transition you go<font color="#E5E5E5"> PowerPoint that's the</font>

151
00:05:07,430 --> 00:05:10,310
best and<font color="#E5E5E5"> only good feature you've</font>

152
00:05:08,900 --> 00:05:12,109
implemented<font color="#E5E5E5"> in no</font><font color="#CCCCCC"> I said that last week</font>

153
00:05:10,310 --> 00:05:14,060
<font color="#E5E5E5">sorry sorry PowerPoint I love your</font>

154
00:05:12,110 --> 00:05:16,100
product so<font color="#E5E5E5"> mitigation is in place now</font>

155
00:05:14,060 --> 00:05:18,590
<font color="#CCCCCC">the virtual disk files are stored</font><font color="#E5E5E5"> on</font>

156
00:05:16,100 --> 00:05:20,810
encrypted volumes and the<font color="#E5E5E5"> encrypted</font>

157
00:05:18,590 --> 00:05:22,429
<font color="#CCCCCC">volume is actually being encrypted</font><font color="#E5E5E5"> using</font>

158
00:05:20,810 --> 00:05:25,400
keying material<font color="#CCCCCC"> that's held on the</font>

159
00:05:22,430 --> 00:05:27,140
hyper-v<font color="#E5E5E5"> hosts ie</font><font color="#CCCCCC"> Ned doesn't have it</font><font color="#E5E5E5"> so</font>

160
00:05:25,400 --> 00:05:28,940
Ned decides to collude<font color="#CCCCCC"> with</font><font color="#E5E5E5"> Taylor</font>

161
00:05:27,140 --> 00:05:31,219
offering him a box of<font color="#E5E5E5"> thin mints and</font>

162
00:05:28,940 --> 00:05:32,750
<font color="#E5E5E5">some increase in salary and then because</font>

163
00:05:31,220 --> 00:05:34,790
<font color="#E5E5E5">Taylor can log on</font><font color="#CCCCCC"> to the virtualization</font>

164
00:05:32,750 --> 00:05:36,410
host<font color="#CCCCCC"> Taylor</font><font color="#E5E5E5"> can log on at the hyper-v</font>

165
00:05:34,790 --> 00:05:38,510
hosts he's a fabric admin of course he

166
00:05:36,410 --> 00:05:40,430
can<font color="#E5E5E5"> he lives inside the encryption</font>

167
00:05:38,510 --> 00:05:42,830
bubble my<font color="#E5E5E5"> encryption is transparently</font>

168
00:05:40,430 --> 00:05:44,210
removed<font color="#E5E5E5"> from Taylor's perspective so Ned</font>

169
00:05:42,830 --> 00:05:46,010
bribes Taylor with the<font color="#E5E5E5"> thin mints the</font>

170
00:05:44,210 --> 00:05:47,870
promise of<font color="#E5E5E5"> a huge raise and the attack</font>

171
00:05:46,010 --> 00:05:49,729
<font color="#CCCCCC">proceeds exactly is the same as it did</font>

172
00:05:47,870 --> 00:05:51,140
<font color="#E5E5E5">before</font><font color="#CCCCCC"> so let's</font><font color="#E5E5E5"> just take a look at that</font>

173
00:05:49,729 --> 00:05:53,960
one rolls through<font color="#E5E5E5"> it does get different</font>

174
00:05:51,140 --> 00:05:56,000
<font color="#E5E5E5">in one</font><font color="#CCCCCC"> other place we now</font><font color="#E5E5E5"> don't need to</font>

175
00:05:53,960 --> 00:05:58,700
mount the I scuzzy target<font color="#E5E5E5"> we simply go</font>

176
00:05:56,000 --> 00:06:01,250
<font color="#CCCCCC">straight to what we see</font><font color="#E5E5E5"> is a local VHDX</font>

177
00:05:58,700 --> 00:06:02,599
<font color="#E5E5E5">copy it we could take it home or we</font>

178
00:06:01,250 --> 00:06:04,850
could execute<font color="#E5E5E5"> the attack here it doesn't</font>

179
00:06:02,600 --> 00:06:06,710
<font color="#CCCCCC">really</font><font color="#E5E5E5"> take</font><font color="#CCCCCC"> very long</font><font color="#E5E5E5"> I mean look at the</font>

180
00:06:04,850 --> 00:06:09,770
size of these<font color="#CCCCCC"> VHD X's I can fit these on</font>

181
00:06:06,710 --> 00:06:11,299
<font color="#CCCCCC">a USB</font><font color="#E5E5E5"> stick</font><font color="#CCCCCC"> I can put the entire dump</font>

182
00:06:09,770 --> 00:06:13,549
file of a virtualized domain controller

183
00:06:11,300 --> 00:06:15,680
on a USB<font color="#CCCCCC"> stick but</font><font color="#E5E5E5"> this time when they</font>

184
00:06:13,550 --> 00:06:18,260
try and mount<font color="#E5E5E5"> the filesystem</font><font color="#CCCCCC"> they cannot</font>

185
00:06:15,680 --> 00:06:19,760
do so<font color="#E5E5E5"> so</font><font color="#CCCCCC"> ned was blocked</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> we switch</font>

186
00:06:18,260 --> 00:06:21,979
<font color="#CCCCCC">over to taylor we're now</font><font color="#E5E5E5"> on the hyper-v</font>

187
00:06:19,760 --> 00:06:24,169
<font color="#E5E5E5">server BitLocker provides no</font><font color="#CCCCCC"> defense</font>

188
00:06:21,979 --> 00:06:25,940
here because we're now logged on again

189
00:06:24,169 --> 00:06:28,520
with inside that encryption<font color="#E5E5E5"> bubble this</font>

190
00:06:25,940 --> 00:06:29,990
is the<font color="#E5E5E5"> hyper-v servers key it has</font><font color="#CCCCCC"> the</font>

191
00:06:28,520 --> 00:06:32,570
key it can decrypt the file system and

192
00:06:29,990 --> 00:06:34,040
<font color="#E5E5E5">the attack continues exactly as before</font><font color="#CCCCCC"> I</font>

193
00:06:32,570 --> 00:06:35,780
<font color="#E5E5E5">won't go through the same boring stuff</font>

194
00:06:34,040 --> 00:06:37,490
there<font color="#E5E5E5"> cuz</font><font color="#CCCCCC"> you</font><font color="#E5E5E5"> already seen it once</font><font color="#CCCCCC"> so my</font>

195
00:06:35,780 --> 00:06:39,530
general<font color="#CCCCCC"> guidance here would be fire both</font>

196
00:06:37,490 --> 00:06:40,350
<font color="#E5E5E5">Ned and Taylor we will repeat</font><font color="#CCCCCC"> that</font>

197
00:06:39,530 --> 00:06:42,030
guidance

198
00:06:40,350 --> 00:06:43,590
frequently throughout<font color="#CCCCCC"> the schools</font><font color="#E5E5E5"> and</font>

199
00:06:42,030 --> 00:06:45,419
then move the<font color="#E5E5E5"> file system encryption</font>

200
00:06:43,590 --> 00:06:47,849
somewhere else<font color="#CCCCCC"> the first</font><font color="#E5E5E5"> problem was</font>

201
00:06:45,420 --> 00:06:49,950
<font color="#E5E5E5">there was no key or the key was on the</font>

202
00:06:47,850 --> 00:06:51,720
sand so Ned had it<font color="#E5E5E5"> the second problem is</font>

203
00:06:49,950 --> 00:06:52,650
<font color="#CCCCCC">the key is on the</font><font color="#E5E5E5"> hyper-v hosts so it's</font>

204
00:06:51,720 --> 00:06:54,780
with Taylor

205
00:06:52,650 --> 00:06:56,549
well Taylor shouldn't have natural

206
00:06:54,780 --> 00:06:58,320
access to virtual machine workloads

207
00:06:56,550 --> 00:07:00,870
merely because he's the fabric admin

208
00:06:58,320 --> 00:07:03,540
<font color="#E5E5E5">those two are not</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> same role so why</font>

209
00:07:00,870 --> 00:07:05,250
do many companies absolutely refuse<font color="#CCCCCC"> to</font>

210
00:07:03,540 --> 00:07:07,200
<font color="#CCCCCC">deploy Active Directory domain</font>

211
00:07:05,250 --> 00:07:09,000
controllers on fabrics on virtualized

212
00:07:07,200 --> 00:07:11,550
hosts<font color="#E5E5E5"> because they know these attack</font>

213
00:07:09,000 --> 00:07:13,890
vectors exist we set out to<font color="#CCCCCC"> solve them</font>

214
00:07:11,550 --> 00:07:16,140
so we can move<font color="#E5E5E5"> the</font><font color="#CCCCCC"> filesystem</font><font color="#E5E5E5"> encryption</font>

215
00:07:13,890 --> 00:07:19,229
inside the<font color="#E5E5E5"> guest and we'll do that</font><font color="#CCCCCC"> by</font>

216
00:07:16,140 --> 00:07:20,940
<font color="#CCCCCC">using a bit Locker boot passphrase</font><font color="#E5E5E5"> to</font>

217
00:07:19,230 --> 00:07:22,890
unlock the key that's<font color="#E5E5E5"> the BitLocker key</font>

218
00:07:20,940 --> 00:07:24,420
protector<font color="#CCCCCC"> that allows access</font><font color="#E5E5E5"> to the</font>

219
00:07:22,890 --> 00:07:26,460
<font color="#CCCCCC">effect the full volume encryption key</font>

220
00:07:24,420 --> 00:07:30,720
<font color="#E5E5E5">and from there the</font><font color="#CCCCCC"> Machine can boot</font><font color="#E5E5E5"> up</font>

221
00:07:26,460 --> 00:07:33,870
so we've reset we got those mitigations

222
00:07:30,720 --> 00:07:35,520
in place<font color="#CCCCCC"> Ned's given up but</font><font color="#E5E5E5"> Taylor still</font>

223
00:07:33,870 --> 00:07:38,100
wants his new car so he wants to<font color="#E5E5E5"> get</font>

224
00:07:35,520 --> 00:07:40,560
<font color="#E5E5E5">that pay</font><font color="#CCCCCC"> rise he abuses his fabric admin</font>

225
00:07:38,100 --> 00:07:42,000
permissions and adds a new<font color="#E5E5E5"> bootloader</font>

226
00:07:40,560 --> 00:07:44,400
<font color="#CCCCCC">let's call that tail loader</font>

227
00:07:42,000 --> 00:07:46,350
<font color="#E5E5E5">so what does he do with this he</font>

228
00:07:44,400 --> 00:07:48,120
basically<font color="#E5E5E5"> creates an</font><font color="#CCCCCC"> ISO containing</font>

229
00:07:46,350 --> 00:07:49,620
malware<font color="#CCCCCC"> that's got boot componentry in</font>

230
00:07:48,120 --> 00:07:51,570
it that<font color="#E5E5E5"> looks like the BitLocker boot</font>

231
00:07:49,620 --> 00:07:55,710
screen asking<font color="#E5E5E5"> for the BitLocker password</font>

232
00:07:51,570 --> 00:07:57,659
and he adds<font color="#E5E5E5"> that to the VM and then</font>

233
00:07:55,710 --> 00:08:00,330
waits for a natural<font color="#E5E5E5"> servicing window to</font>

234
00:07:57,660 --> 00:08:02,490
occur once that natural servicing window

235
00:08:00,330 --> 00:08:05,120
occurs<font color="#E5E5E5"> Taylor's going to go ahead and</font>

236
00:08:02,490 --> 00:08:07,500
have the virtual domain controller<font color="#E5E5E5"> owner</font>

237
00:08:05,120 --> 00:08:09,570
<font color="#E5E5E5">console into the VM enter the boot</font>

238
00:08:07,500 --> 00:08:10,710
passphrase and unlock it<font color="#CCCCCC"> but what</font>

239
00:08:09,570 --> 00:08:12,450
they're<font color="#CCCCCC"> really doing is they're going to</font>

240
00:08:10,710 --> 00:08:15,270
<font color="#E5E5E5">end up entering that boot passphrase</font>

241
00:08:12,450 --> 00:08:17,849
into Taylor's nefarious rootkit that

242
00:08:15,270 --> 00:08:19,830
looks and<font color="#E5E5E5"> behaves exactly the same way</font>

243
00:08:17,850 --> 00:08:25,710
<font color="#E5E5E5">that the BitLocker passphrase screen</font>

244
00:08:19,830 --> 00:08:27,359
does so we'll see<font color="#CCCCCC"> that</font><font color="#E5E5E5"> in a second we're</font>

245
00:08:25,710 --> 00:08:28,680
showing you<font color="#E5E5E5"> the mitigation here for the</font>

246
00:08:27,360 --> 00:08:31,080
last one by the way I forgot<font color="#CCCCCC"> we were</font>

247
00:08:28,680 --> 00:08:32,549
<font color="#E5E5E5">doing</font><font color="#CCCCCC"> that in this video</font><font color="#E5E5E5"> so</font><font color="#CCCCCC"> that one</font>

248
00:08:31,080 --> 00:08:34,679
there<font color="#CCCCCC"> is</font><font color="#E5E5E5"> showing that we</font><font color="#CCCCCC"> are now unable</font>

249
00:08:32,549 --> 00:08:36,449
<font color="#CCCCCC">to mount</font><font color="#E5E5E5"> the disk because the virtual</font>

250
00:08:34,679 --> 00:08:38,280
machine<font color="#CCCCCC"> itself has</font><font color="#E5E5E5"> possession of</font><font color="#CCCCCC"> the key</font>

251
00:08:36,450 --> 00:08:39,840
through the boot passphrase that was

252
00:08:38,280 --> 00:08:41,520
what<font color="#CCCCCC"> that first one was</font><font color="#E5E5E5"> doing here's</font>

253
00:08:39,840 --> 00:08:43,530
Taylor now going and accessing the

254
00:08:41,520 --> 00:08:45,630
<font color="#E5E5E5">settings of</font><font color="#CCCCCC"> the VM he's going to browse</font>

255
00:08:43,530 --> 00:08:47,699
through to this<font color="#E5E5E5"> malicious</font><font color="#CCCCCC"> iso file that</font>

256
00:08:45,630 --> 00:08:49,860
contains<font color="#E5E5E5"> necessary boot media and his</font>

257
00:08:47,700 --> 00:08:51,270
little<font color="#E5E5E5"> reek of sorts that presents a</font>

258
00:08:49,860 --> 00:08:53,280
screen<font color="#CCCCCC"> that looks exactly like the</font>

259
00:08:51,270 --> 00:08:54,040
BitLocker entry screen and<font color="#E5E5E5"> finally he</font>

260
00:08:53,280 --> 00:08:57,310
verifies the

261
00:08:54,040 --> 00:08:59,380
device<font color="#E5E5E5"> has boot priority if there's okay</font>

262
00:08:57,310 --> 00:09:01,599
he now waits for this natural<font color="#E5E5E5"> servicing</font>

263
00:08:59,380 --> 00:09:03,130
window to occur<font color="#CCCCCC"> he claims that the VM</font>

264
00:09:01,600 --> 00:09:05,500
has been<font color="#E5E5E5"> shut down for backup</font><font color="#CCCCCC"> purposes</font>

265
00:09:03,130 --> 00:09:07,600
<font color="#E5E5E5">patching whatever</font><font color="#CCCCCC"> at which point it</font>

266
00:09:05,500 --> 00:09:09,279
reboots<font color="#CCCCCC"> he then contacts the virtual</font>

267
00:09:07,600 --> 00:09:11,290
machine owner in the<font color="#E5E5E5"> active directory or</font>

268
00:09:09,279 --> 00:09:13,779
identity team and has them enter the

269
00:09:11,290 --> 00:09:15,969
password<font color="#E5E5E5"> which they did directly into</font>

270
00:09:13,779 --> 00:09:17,649
his bootloader<font color="#E5E5E5"> he stores the password</font>

271
00:09:15,970 --> 00:09:19,569
away somewhere<font color="#CCCCCC"> wherever he chooses and</font>

272
00:09:17,649 --> 00:09:21,430
they and then inject that passphrase

273
00:09:19,569 --> 00:09:23,139
into the natural Windows boot<font color="#E5E5E5"> sequence</font>

274
00:09:21,430 --> 00:09:25,120
<font color="#E5E5E5">and the domain controller comes up as</font>

275
00:09:23,139 --> 00:09:28,720
normal<font color="#CCCCCC"> how many of you have</font><font color="#E5E5E5"> thought of</font>

276
00:09:25,120 --> 00:09:29,860
<font color="#CCCCCC">doing that as an attack before</font><font color="#E5E5E5"> okay all</font>

277
00:09:28,720 --> 00:09:31,180
<font color="#E5E5E5">of you with your hands up should be</font>

278
00:09:29,860 --> 00:09:33,579
fired<font color="#CCCCCC"> because</font><font color="#E5E5E5"> you're clearly nefarious</font>

279
00:09:31,180 --> 00:09:35,290
so move<font color="#CCCCCC"> along</font><font color="#E5E5E5"> right so we're still going</font>

280
00:09:33,579 --> 00:09:36,969
<font color="#E5E5E5">with our recommendation here of firing</font>

281
00:09:35,290 --> 00:09:38,709
both<font color="#CCCCCC"> ned</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> taylor advice this</font><font color="#E5E5E5"> good</font>

282
00:09:36,970 --> 00:09:40,810
<font color="#E5E5E5">rarely needs changing and we're going to</font>

283
00:09:38,709 --> 00:09:42,670
<font color="#E5E5E5">move on to</font><font color="#CCCCCC"> a modern hypervisor</font><font color="#E5E5E5"> enough of</font>

284
00:09:40,810 --> 00:09:44,109
all<font color="#E5E5E5"> this break fix dribble this is a</font>

285
00:09:42,670 --> 00:09:45,310
little bit silly we need to do<font color="#E5E5E5"> better</font>

286
00:09:44,110 --> 00:09:46,779
<font color="#E5E5E5">with our</font><font color="#CCCCCC"> virtual machines and we're</font>

287
00:09:45,310 --> 00:09:49,930
doing<font color="#E5E5E5"> here how</font><font color="#CCCCCC"> about we offer</font>

288
00:09:46,779 --> 00:09:52,269
virtualized UEFI firmware secure boot

289
00:09:49,930 --> 00:09:55,209
<font color="#E5E5E5">measured boot measured boot implies</font>

290
00:09:52,269 --> 00:09:56,440
another device a synthetic TPM<font color="#E5E5E5"> we can do</font>

291
00:09:55,209 --> 00:09:59,260
all of this thing all of these things

292
00:09:56,440 --> 00:10:01,209
now so let's reset<font color="#E5E5E5"> and imagine that</font>

293
00:09:59,260 --> 00:10:02,620
we've got this list of mitigations in

294
00:10:01,209 --> 00:10:04,540
place so the<font color="#E5E5E5"> virtual disk files are</font>

295
00:10:02,620 --> 00:10:06,310
stored<font color="#E5E5E5"> on encrypted volumes the VMS are</font>

296
00:10:04,540 --> 00:10:07,870
encrypting their own volumes using<font color="#CCCCCC"> a</font>

297
00:10:06,310 --> 00:10:09,310
boot passphrase<font color="#E5E5E5"> and the modern</font>

298
00:10:07,870 --> 00:10:10,899
hypervisor<font color="#E5E5E5"> that can provide</font><font color="#CCCCCC"> its v</font><font color="#E5E5E5"> ends</font>

299
00:10:09,310 --> 00:10:12,609
<font color="#E5E5E5">with secure boot and TPM back key</font>

300
00:10:10,899 --> 00:10:14,680
<font color="#E5E5E5">release is now in place</font>

301
00:10:12,610 --> 00:10:16,899
do we need boot passphrases anymore

302
00:10:14,680 --> 00:10:18,760
we'll see in a second so<font color="#CCCCCC"> tailor decides</font>

303
00:10:16,899 --> 00:10:19,779
that with all this in place<font color="#CCCCCC"> I've got to</font>

304
00:10:18,760 --> 00:10:21,459
get<font color="#CCCCCC"> a bit more modern</font>

305
00:10:19,779 --> 00:10:22,959
so<font color="#CCCCCC"> Tyler is now going</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> use</font><font color="#E5E5E5"> a tall</font>

306
00:10:21,459 --> 00:10:24,699
written by mark russinovich thank you

307
00:10:22,959 --> 00:10:26,439
<font color="#E5E5E5">Mark for making our hypervisor subject</font>

308
00:10:24,699 --> 00:10:29,380
<font color="#CCCCCC">to</font><font color="#E5E5E5"> different attack vectors called live</font>

309
00:10:26,440 --> 00:10:31,120
<font color="#CCCCCC">KD live KD is going to attach to a</font><font color="#E5E5E5"> work</font>

310
00:10:29,380 --> 00:10:32,800
<font color="#E5E5E5">of process running on the hyper-v hosts</font>

311
00:10:31,120 --> 00:10:34,420
<font color="#CCCCCC">it's gonna dump its memory and what do</font>

312
00:10:32,800 --> 00:10:36,130
you<font color="#CCCCCC"> think</font><font color="#E5E5E5"> Taylor's</font><font color="#CCCCCC"> gonna do</font><font color="#E5E5E5"> he's</font><font color="#CCCCCC"> gonna</font>

313
00:10:34,420 --> 00:10:37,449
<font color="#E5E5E5">take the dump file off walk home with it</font>

314
00:10:36,130 --> 00:10:39,220
and spend the next three hours<font color="#E5E5E5"> three</font>

315
00:10:37,449 --> 00:10:41,410
days three<font color="#CCCCCC"> weeks he doesn't care how</font>

316
00:10:39,220 --> 00:10:44,620
long it<font color="#CCCCCC"> takes to extract the full</font><font color="#E5E5E5"> volume</font>

317
00:10:41,410 --> 00:10:46,420
encryption key from that<font color="#E5E5E5"> dump file using</font>

318
00:10:44,620 --> 00:10:48,910
publicly<font color="#E5E5E5"> available tools that can be</font>

319
00:10:46,420 --> 00:10:51,099
downloaded<font color="#CCCCCC"> from the internet</font><font color="#E5E5E5"> this is why</font>

320
00:10:48,910 --> 00:10:52,990
virtualization<font color="#E5E5E5"> fabrics need additional</font>

321
00:10:51,100 --> 00:10:55,329
security they provide attack vectors

322
00:10:52,990 --> 00:10:57,430
that<font color="#E5E5E5"> are unique to them you can take a</font>

323
00:10:55,329 --> 00:10:58,930
dump of<font color="#E5E5E5"> a virtual machine</font><font color="#CCCCCC"> and you could</font>

324
00:10:57,430 --> 00:11:00,370
probably<font color="#E5E5E5"> manage to copy the virtual</font>

325
00:10:58,930 --> 00:11:02,138
machine reasonably<font color="#CCCCCC"> quickly bring it back</font>

326
00:11:00,370 --> 00:11:03,760
up<font color="#CCCCCC"> and just</font><font color="#E5E5E5"> say sorry we lost a network</font>

327
00:11:02,139 --> 00:11:05,139
connection for a little bit<font color="#E5E5E5"> you can't</font>

328
00:11:03,760 --> 00:11:06,370
really do that<font color="#E5E5E5"> with a full-on Active</font>

329
00:11:05,139 --> 00:11:07,870
Directory domain controller running<font color="#CCCCCC"> on</font>

330
00:11:06,370 --> 00:11:10,690
bare metal<font color="#E5E5E5"> that's in a</font><font color="#CCCCCC"> dataset</font>

331
00:11:07,870 --> 00:11:12,730
in a cage with<font color="#E5E5E5"> padlocks and</font><font color="#CCCCCC"> -</font><font color="#E5E5E5"> two</font>

332
00:11:10,690 --> 00:11:15,100
cameras focus all those good things work

333
00:11:12,730 --> 00:11:17,200
<font color="#E5E5E5">for physical</font><font color="#CCCCCC"> bare metal boxes</font><font color="#E5E5E5"> they don't</font>

334
00:11:15,100 --> 00:11:18,850
do<font color="#E5E5E5"> much for virtual machinery so in this</font>

335
00:11:17,200 --> 00:11:21,910
case let's show you what this<font color="#E5E5E5"> attack</font>

336
00:11:18,850 --> 00:11:23,650
<font color="#E5E5E5">looks like so the fabric</font><font color="#CCCCCC"> admin wants to</font>

337
00:11:21,910 --> 00:11:25,449
steal the secrets from<font color="#CCCCCC"> a VM they know</font>

338
00:11:23,650 --> 00:11:26,920
the<font color="#E5E5E5"> VM</font><font color="#CCCCCC"> is now encrypting its own disks</font>

339
00:11:25,450 --> 00:11:29,560
<font color="#E5E5E5">so they attempt to steal</font><font color="#CCCCCC"> the VMS</font>

340
00:11:26,920 --> 00:11:30,699
encryption key<font color="#E5E5E5"> by</font><font color="#CCCCCC"> using a debugger so</font>

341
00:11:29,560 --> 00:11:32,920
the first thing we're going<font color="#E5E5E5"> to do is use</font>

342
00:11:30,700 --> 00:11:35,950
<font color="#E5E5E5">this volatility framework and live</font><font color="#CCCCCC"> KD</font>

343
00:11:32,920 --> 00:11:37,180
live KD gives us the dump<font color="#E5E5E5"> and yes I sped</font>

344
00:11:35,950 --> 00:11:39,070
that up<font color="#CCCCCC"> because</font><font color="#E5E5E5"> that was rather boring</font>

345
00:11:37,180 --> 00:11:40,930
<font color="#CCCCCC">ly long and then we sit there</font><font color="#E5E5E5"> and we</font>

346
00:11:39,070 --> 00:11:42,940
basically<font color="#CCCCCC"> run this volatility framework</font>

347
00:11:40,930 --> 00:11:46,420
<font color="#E5E5E5">we tell it</font><font color="#CCCCCC"> to use the</font><font color="#E5E5E5"> following plugins</font>

348
00:11:42,940 --> 00:11:49,290
<font color="#E5E5E5">against 2012 r2 x64 and go and find</font><font color="#CCCCCC"> me</font>

349
00:11:46,420 --> 00:11:52,030
<font color="#CCCCCC">the BitLocker key this</font><font color="#E5E5E5"> was many many</font>

350
00:11:49,290 --> 00:11:53,980
many minutes later way longer<font color="#E5E5E5"> than</font><font color="#CCCCCC"> this</font>

351
00:11:52,030 --> 00:11:56,380
entire<font color="#CCCCCC"> session that's what it spewed</font>

352
00:11:53,980 --> 00:11:58,480
back it just<font color="#E5E5E5"> outputs every single copy</font>

353
00:11:56,380 --> 00:12:00,160
<font color="#CCCCCC">of what looks</font><font color="#E5E5E5"> like or appears to be an</font>

354
00:11:58,480 --> 00:12:01,900
ethnic or a full volume encryption key

355
00:12:00,160 --> 00:12:03,280
in memory<font color="#E5E5E5"> since they're all the same I</font>

356
00:12:01,900 --> 00:12:05,170
<font color="#E5E5E5">think that's a fairly good indication</font>

357
00:12:03,280 --> 00:12:07,449
that<font color="#E5E5E5"> it found the right one at this</font>

358
00:12:05,170 --> 00:12:09,099
point<font color="#E5E5E5"> I'll use tools such as I think</font>

359
00:12:07,450 --> 00:12:10,810
<font color="#CCCCCC">it's called diss internals or something</font>

360
00:12:09,100 --> 00:12:12,430
like<font color="#E5E5E5"> that it's the Linux utility and I</font>

361
00:12:10,810 --> 00:12:13,989
can then just<font color="#E5E5E5"> inject that</font><font color="#CCCCCC"> effect mount</font>

362
00:12:12,430 --> 00:12:16,900
the<font color="#E5E5E5"> disk and take the data off as I see</font>

363
00:12:13,990 --> 00:12:18,700
fit<font color="#E5E5E5"> so again we still</font><font color="#CCCCCC"> fire</font><font color="#E5E5E5"> Taylor it's</font>

364
00:12:16,900 --> 00:12:21,340
extremely<font color="#CCCCCC"> necessary at this</font><font color="#E5E5E5"> point we</font>

365
00:12:18,700 --> 00:12:22,990
implement code integrity now we're at a

366
00:12:21,340 --> 00:12:24,640
point<font color="#E5E5E5"> where he seems to have bypassed</font>

367
00:12:22,990 --> 00:12:26,470
<font color="#E5E5E5">everything that we've tried so far</font><font color="#CCCCCC"> as to</font>

368
00:12:24,640 --> 00:12:28,600
how about we use code integrity policies

369
00:12:26,470 --> 00:12:30,610
to prevent<font color="#E5E5E5"> him from running nefarious</font>

370
00:12:28,600 --> 00:12:32,890
tools that seems reasonable because<font color="#CCCCCC"> the</font>

371
00:12:30,610 --> 00:12:35,290
hyper-v<font color="#E5E5E5"> hosts</font><font color="#CCCCCC"> should be</font><font color="#E5E5E5"> running on an OS</font>

372
00:12:32,890 --> 00:12:37,210
<font color="#CCCCCC">that is very</font><font color="#E5E5E5"> locked down say server core</font>

373
00:12:35,290 --> 00:12:39,670
<font color="#E5E5E5">it doesn't have a plethora of tools on</font>

374
00:12:37,210 --> 00:12:41,500
it it doesn't<font color="#E5E5E5"> have Chrome or Firefox</font><font color="#CCCCCC"> per</font>

375
00:12:39,670 --> 00:12:43,180
the earlier<font color="#CCCCCC"> demo</font><font color="#E5E5E5"> it doesn't have hardly</font>

376
00:12:41,500 --> 00:12:45,010
any tooling<font color="#E5E5E5"> on it at all except what's</font>

377
00:12:43,180 --> 00:12:49,750
necessary<font color="#CCCCCC"> for a fabric admin to do their</font>

378
00:12:45,010 --> 00:12:51,700
job so<font color="#CCCCCC"> let's</font><font color="#E5E5E5"> go</font><font color="#CCCCCC"> ahead and reset</font><font color="#E5E5E5"> we now</font>

379
00:12:49,750 --> 00:12:53,740
have all of<font color="#E5E5E5"> those mitigations in effect</font>

380
00:12:51,700 --> 00:12:56,020
<font color="#E5E5E5">and we're now going</font><font color="#CCCCCC"> to see that Taylor</font>

381
00:12:53,740 --> 00:12:58,600
recognizes a code integrity policy<font color="#CCCCCC"> is</font>

382
00:12:56,020 --> 00:13:01,180
<font color="#E5E5E5">enforce it dislikes the fact that a code</font>

383
00:12:58,600 --> 00:13:03,910
integrity<font color="#CCCCCC"> policy is enforce</font><font color="#E5E5E5"> and abuses</font>

384
00:13:01,180 --> 00:13:06,459
his local admin privilege to remove the

385
00:13:03,910 --> 00:13:08,880
code integrity<font color="#CCCCCC"> policy</font><font color="#E5E5E5"> so let's show you</font>

386
00:13:06,460 --> 00:13:08,880
how<font color="#E5E5E5"> that's done</font>

387
00:13:09,540 --> 00:13:13,689
so he's after<font color="#E5E5E5"> the same thing again some</font>

388
00:13:12,190 --> 00:13:14,860
generic secret could be a sequel

389
00:13:13,690 --> 00:13:16,990
database could be an<font color="#E5E5E5"> Active Directory</font>

390
00:13:14,860 --> 00:13:18,460
domain controller<font color="#E5E5E5"> ad is never really the</font>

391
00:13:16,990 --> 00:13:20,750
<font color="#E5E5E5">target it's usually just a means to an</font>

392
00:13:18,460 --> 00:13:22,610
<font color="#E5E5E5">end here he tries again</font>

393
00:13:20,750 --> 00:13:25,040
to go and dump<font color="#E5E5E5"> the virtual machine</font><font color="#CCCCCC"> but</font>

394
00:13:22,610 --> 00:13:27,260
live<font color="#CCCCCC"> Kati fails</font><font color="#E5E5E5"> the system cannot</font>

395
00:13:25,040 --> 00:13:29,150
execute that because the code integrity

396
00:13:27,260 --> 00:13:31,040
policy<font color="#E5E5E5"> enforced by the</font><font color="#CCCCCC"> hypervisor and</font>

397
00:13:29,150 --> 00:13:34,010
<font color="#E5E5E5">then by the kernel for user mode</font>

398
00:13:31,040 --> 00:13:35,540
components isn't allowed to<font color="#CCCCCC"> run so code</font>

399
00:13:34,010 --> 00:13:38,330
integrity was actually reasonably

400
00:13:35,540 --> 00:13:40,490
successful but<font color="#CCCCCC"> tailors an engineer and</font>

401
00:13:38,330 --> 00:13:42,260
he<font color="#E5E5E5"> knows how code integrity works so he</font>

402
00:13:40,490 --> 00:13:45,320
went into the code integrity folder<font color="#E5E5E5"> and</font>

403
00:13:42,260 --> 00:13:47,090
he renamed the<font color="#CCCCCC"> si policy dot p7b</font><font color="#E5E5E5"> that is</font>

404
00:13:45,320 --> 00:13:49,490
the compiled<font color="#E5E5E5"> code integrity file in a</font>

405
00:13:47,090 --> 00:13:52,190
third format<font color="#E5E5E5"> he renamed that moved</font><font color="#CCCCCC"> it</font><font color="#E5E5E5"> to</font>

406
00:13:49,490 --> 00:13:53,840
the side<font color="#E5E5E5"> rebooted the system what code</font>

407
00:13:52,190 --> 00:13:56,090
integrity<font color="#CCCCCC"> policy is now effective on</font>

408
00:13:53,840 --> 00:13:57,530
this computer<font color="#E5E5E5"> none whatsoever</font>

409
00:13:56,090 --> 00:13:59,300
his<font color="#E5E5E5"> type of</font><font color="#CCCCCC"> the</font><font color="#E5E5E5"> host no longer has a</font>

410
00:13:57,530 --> 00:14:02,030
code integrity<font color="#CCCCCC"> policy</font><font color="#E5E5E5"> and he's off</font><font color="#CCCCCC"> to</font>

411
00:13:59,300 --> 00:14:04,310
the<font color="#CCCCCC"> market again tailors annoying</font><font color="#E5E5E5"> right</font>

412
00:14:02,030 --> 00:14:06,650
so<font color="#E5E5E5"> this firing thing still stands I say</font>

413
00:14:04,310 --> 00:14:08,660
sign and lock the legitimate<font color="#CCCCCC"> restrictive</font>

414
00:14:06,650 --> 00:14:10,069
code integrity policy<font color="#CCCCCC"> to you fee what</font>

415
00:14:08,660 --> 00:14:12,560
the hell does<font color="#CCCCCC"> that mean</font>

416
00:14:10,070 --> 00:14:15,140
what it means is<font color="#E5E5E5"> we have</font><font color="#CCCCCC"> a mechanism now</font>

417
00:14:12,560 --> 00:14:17,599
where we<font color="#E5E5E5"> can lock a signature of the</font>

418
00:14:15,140 --> 00:14:20,300
code integrity policy<font color="#E5E5E5"> into a</font><font color="#CCCCCC"> UV secure</font>

419
00:14:17,600 --> 00:14:22,010
variable that is read only<font color="#E5E5E5"> once you feed</font>

420
00:14:20,300 --> 00:14:23,959
transitions control to a bootloader

421
00:14:22,010 --> 00:14:25,160
<font color="#E5E5E5">hence it can't be easily or readily</font>

422
00:14:23,960 --> 00:14:27,980
changed after the fact

423
00:14:25,160 --> 00:14:30,050
I would imagine<font color="#CCCCCC"> once the world starts</font>

424
00:14:27,980 --> 00:14:31,970
doing this that<font color="#E5E5E5"> somebody in the central</font>

425
00:14:30,050 --> 00:14:33,469
IT department would configure<font color="#E5E5E5"> a code</font>

426
00:14:31,970 --> 00:14:35,420
integrity<font color="#CCCCCC"> policy and then as that</font>

427
00:14:33,470 --> 00:14:38,210
machine is deployed for the first time

428
00:14:35,420 --> 00:14:41,360
somebody trustworthy in central IT would

429
00:14:38,210 --> 00:14:42,860
lock the policy and store it in<font color="#CCCCCC"> UV ok</font>

430
00:14:41,360 --> 00:14:45,110
that's what we're<font color="#E5E5E5"> gonna do here let's</font>

431
00:14:42,860 --> 00:14:46,850
see if<font color="#E5E5E5"> this what Taylor's attack the</font>

432
00:14:45,110 --> 00:14:49,760
fabric<font color="#CCCCCC"> admin attempts to bypass</font><font color="#E5E5E5"> the CI</font>

433
00:14:46,850 --> 00:14:52,460
policy by replacing<font color="#E5E5E5"> it with his own but</font>

434
00:14:49,760 --> 00:14:54,770
the<font color="#E5E5E5"> fabric hosts had their policy locked</font>

435
00:14:52,460 --> 00:14:56,210
to a youthful secure variable so<font color="#CCCCCC"> let's</font>

436
00:14:54,770 --> 00:14:58,220
see what happens when Taylor tries the

437
00:14:56,210 --> 00:14:59,990
<font color="#CCCCCC">same attack</font><font color="#E5E5E5"> again</font><font color="#CCCCCC"> so this</font><font color="#E5E5E5"> case he</font>

438
00:14:58,220 --> 00:15:02,360
locates the<font color="#CCCCCC"> pre-configured CI policy</font>

439
00:14:59,990 --> 00:15:03,770
that permits the malicious<font color="#E5E5E5"> tools he's</font>

440
00:15:02,360 --> 00:15:06,050
gonna go ahead<font color="#E5E5E5"> and locate the code</font>

441
00:15:03,770 --> 00:15:07,939
integrity policy<font color="#E5E5E5"> and he's going to</font>

442
00:15:06,050 --> 00:15:09,949
<font color="#E5E5E5">delete that one and replace it with</font><font color="#CCCCCC"> his</font>

443
00:15:07,940 --> 00:15:12,470
own<font color="#E5E5E5"> arguably he could delete that one</font>

444
00:15:09,950 --> 00:15:14,270
<font color="#E5E5E5">and leave no policy on the system but in</font>

445
00:15:12,470 --> 00:15:15,950
<font color="#E5E5E5">Taylor's mind it's probably better for a</font>

446
00:15:14,270 --> 00:15:17,600
code integrity<font color="#CCCCCC"> policy to be</font><font color="#E5E5E5"> present in</font>

447
00:15:15,950 --> 00:15:18,860
case anyone<font color="#E5E5E5"> is checking for</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> maybe</font>

448
00:15:17,600 --> 00:15:21,380
<font color="#E5E5E5">they're not</font><font color="#CCCCCC"> checking for what the code</font>

449
00:15:18,860 --> 00:15:23,690
integrity policy enforces<font color="#E5E5E5"> so here is now</font>

450
00:15:21,380 --> 00:15:25,910
<font color="#CCCCCC">a very</font><font color="#E5E5E5"> very small code integrity</font><font color="#CCCCCC"> policy</font>

451
00:15:23,690 --> 00:15:27,710
that permits<font color="#CCCCCC"> just the material the</font>

452
00:15:25,910 --> 00:15:30,199
malicious tools and the<font color="#CCCCCC"> windows binaries</font>

453
00:15:27,710 --> 00:15:32,170
that<font color="#E5E5E5"> Taylor needs he</font><font color="#CCCCCC"> has to reboot</font><font color="#E5E5E5"> he</font>

454
00:15:30,200 --> 00:15:34,520
does so<font color="#CCCCCC"> Oh</font>

455
00:15:32,170 --> 00:15:35,900
<font color="#E5E5E5">as soon as</font><font color="#CCCCCC"> windows boots</font>

456
00:15:34,520 --> 00:15:37,790
soon as we get<font color="#E5E5E5"> far</font><font color="#CCCCCC"> enough through that</font>

457
00:15:35,900 --> 00:15:39,680
boot<font color="#CCCCCC"> part which is</font><font color="#E5E5E5"> very</font><font color="#CCCCCC"> very early we</font>

458
00:15:37,790 --> 00:15:41,599
tried to slip up the code integrity

459
00:15:39,680 --> 00:15:43,160
policy<font color="#E5E5E5"> we get its signature back we take</font>

460
00:15:41,600 --> 00:15:45,680
a look<font color="#E5E5E5"> at the lock to you variables</font><font color="#CCCCCC"> if</font>

461
00:15:43,160 --> 00:15:48,650
the two<font color="#CCCCCC"> don't match we blue screen or</font>

462
00:15:45,680 --> 00:15:50,750
<font color="#CCCCCC">black screen as the case may be that is</font>

463
00:15:48,650 --> 00:15:52,610
a conscious choice<font color="#E5E5E5"> on</font><font color="#CCCCCC"> Windows part there</font>

464
00:15:50,750 --> 00:15:55,280
to do<font color="#E5E5E5"> that because it is considered</font><font color="#CCCCCC"> to</font>

465
00:15:52,610 --> 00:15:56,840
<font color="#CCCCCC">be better for</font><font color="#E5E5E5"> that workload to fail than</font>

466
00:15:55,280 --> 00:15:58,670
for that<font color="#E5E5E5"> workload to work while being</font>

467
00:15:56,840 --> 00:16:00,710
susceptible<font color="#CCCCCC"> to attacks or</font><font color="#E5E5E5"> stealing</font>

468
00:15:58,670 --> 00:16:02,209
secrets<font color="#CCCCCC"> it's a conscious choice that the</font>

469
00:16:00,710 --> 00:16:04,010
administrator makes you do not have to

470
00:16:02,210 --> 00:16:05,360
do this<font color="#E5E5E5"> but arguably that's a pretty</font>

471
00:16:04,010 --> 00:16:07,730
good<font color="#E5E5E5"> thing to do on a fabric</font><font color="#CCCCCC"> where</font>

472
00:16:05,360 --> 00:16:09,140
fabric admins can overstep their bounds

473
00:16:07,730 --> 00:16:11,480
and start stealing<font color="#CCCCCC"> secrets from</font><font color="#E5E5E5"> the</font>

474
00:16:09,140 --> 00:16:13,970
virtual workloads running<font color="#E5E5E5"> on them last</font>

475
00:16:11,480 --> 00:16:16,070
but<font color="#E5E5E5"> not least attack number</font><font color="#CCCCCC"> six</font><font color="#E5E5E5"> tailors</font>

476
00:16:13,970 --> 00:16:18,050
run out of options<font color="#E5E5E5"> but he's quite</font>

477
00:16:16,070 --> 00:16:20,240
forceful here<font color="#E5E5E5"> he's gonna take a greater</font>

478
00:16:18,050 --> 00:16:23,240
risk<font color="#E5E5E5"> now he's actually</font><font color="#CCCCCC"> going</font><font color="#E5E5E5"> to call a</font>

479
00:16:20,240 --> 00:16:24,950
<font color="#E5E5E5">call a crash dump of the entire host so</font>

480
00:16:23,240 --> 00:16:26,810
by crash dumping the entire host he's

481
00:16:24,950 --> 00:16:28,550
very much<font color="#CCCCCC"> revealing himself</font><font color="#E5E5E5"> so he's kind</font>

482
00:16:26,810 --> 00:16:30,380
of desperate at this<font color="#E5E5E5"> stage he must get</font>

483
00:16:28,550 --> 00:16:32,990
paid absolute pittance<font color="#CCCCCC"> to keep on this</font>

484
00:16:30,380 --> 00:16:35,740
much so<font color="#E5E5E5"> this is similar to the VM</font>

485
00:16:32,990 --> 00:16:38,450
specific dump<font color="#E5E5E5"> except it's the whole host</font>

486
00:16:35,740 --> 00:16:41,510
<font color="#CCCCCC">okay so let's see exactly</font><font color="#E5E5E5"> how he's</font><font color="#CCCCCC"> going</font>

487
00:16:38,450 --> 00:16:43,640
<font color="#CCCCCC">to do this</font><font color="#E5E5E5"> so he knows that he's got</font>

488
00:16:41,510 --> 00:16:46,100
<font color="#CCCCCC">sine CI policies in effect so he</font>

489
00:16:43,640 --> 00:16:47,810
restored<font color="#E5E5E5"> the CI policy using an offline</font>

490
00:16:46,100 --> 00:16:50,270
restoration of the CI policy<font color="#CCCCCC"> that's</font><font color="#E5E5E5"> the</font>

491
00:16:47,810 --> 00:16:52,430
only way of<font color="#E5E5E5"> getting it back</font><font color="#CCCCCC"> to boot he</font>

492
00:16:50,270 --> 00:16:54,860
then tries to bypass all<font color="#CCCCCC"> of these</font>

493
00:16:52,430 --> 00:16:57,050
systems<font color="#CCCCCC"> by simply crash dumping the</font>

494
00:16:54,860 --> 00:16:58,580
hyper-v<font color="#E5E5E5"> hosts so he ensures that crash</font>

495
00:16:57,050 --> 00:17:00,290
dumps are switched on and configured for

496
00:16:58,580 --> 00:17:02,000
<font color="#E5E5E5">a complete memory dump this does include</font>

497
00:17:00,290 --> 00:17:03,469
<font color="#E5E5E5">all the virtual machine pages it doesn't</font>

498
00:17:02,000 --> 00:17:05,540
include the hypervisor itself but it

499
00:17:03,470 --> 00:17:07,790
does<font color="#CCCCCC"> include VM</font><font color="#E5E5E5"> memory and the fabric</font>

500
00:17:05,540 --> 00:17:10,069
admin<font color="#E5E5E5"> then triggers a crash dump boom he</font>

501
00:17:07,790 --> 00:17:11,750
does that<font color="#E5E5E5"> using an</font><font color="#CCCCCC"> animai and he's done</font>

502
00:17:10,069 --> 00:17:15,889
ice crash dump file that he then copies

503
00:17:11,750 --> 00:17:17,270
off and takes home with him now all he's

504
00:17:15,890 --> 00:17:19,459
got to<font color="#E5E5E5"> do is figure out where's the</font>

505
00:17:17,270 --> 00:17:21,680
<font color="#E5E5E5">isolated VM worker process in there and</font>

506
00:17:19,459 --> 00:17:23,060
all<font color="#CCCCCC"> of its memory</font><font color="#E5E5E5"> take that out segment</font>

507
00:17:21,680 --> 00:17:24,860
it and then use the same tools he did

508
00:17:23,060 --> 00:17:26,419
earlier on<font color="#CCCCCC"> to go through find</font><font color="#E5E5E5"> the effect</font>

509
00:17:24,859 --> 00:17:29,570
and gain<font color="#E5E5E5"> access to the BitLocker</font>

510
00:17:26,420 --> 00:17:31,750
encrypted volumes so yet again<font color="#CCCCCC"> he's</font>

511
00:17:29,570 --> 00:17:34,790
still<font color="#CCCCCC"> found a way around it</font>

512
00:17:31,750 --> 00:17:36,710
there's<font color="#E5E5E5"> only one solution</font><font color="#CCCCCC"> left really</font><font color="#E5E5E5"> we</font>

513
00:17:34,790 --> 00:17:38,870
have to be able<font color="#E5E5E5"> to ensure</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> this host</font>

514
00:17:36,710 --> 00:17:41,120
<font color="#E5E5E5">can't do anything</font><font color="#CCCCCC"> because</font><font color="#E5E5E5"> it lacks</font>

515
00:17:38,870 --> 00:17:44,030
keying material<font color="#E5E5E5"> before has been attested</font>

516
00:17:41,120 --> 00:17:45,590
<font color="#E5E5E5">measured thoroughly measured as healthy</font>

517
00:17:44,030 --> 00:17:47,240
<font color="#E5E5E5">that's what we're going</font><font color="#CCCCCC"> to do now so</font>

518
00:17:45,590 --> 00:17:47,790
we're going<font color="#E5E5E5"> to configure the host to</font>

519
00:17:47,240 --> 00:17:49,530
disallow

520
00:17:47,790 --> 00:17:51,659
or if they are<font color="#E5E5E5"> allowed we're going to</font>

521
00:17:49,530 --> 00:17:53,340
configure<font color="#CCCCCC"> it to encrypt memory</font><font color="#E5E5E5"> in the</font>

522
00:17:51,660 --> 00:17:55,410
crash dump<font color="#E5E5E5"> we're also going to measure</font>

523
00:17:53,340 --> 00:17:58,230
the keys<font color="#E5E5E5"> because</font><font color="#CCCCCC"> there is no point in</font>

524
00:17:55,410 --> 00:17:59,880
measuring that crash dumps are on and if

525
00:17:58,230 --> 00:18:00,960
they are<font color="#E5E5E5"> on we must then measure that</font>

526
00:17:59,880 --> 00:18:02,520
<font color="#CCCCCC">they're encrypted and</font><font color="#E5E5E5"> if they are</font>

527
00:18:00,960 --> 00:18:03,870
encrypted<font color="#CCCCCC"> if we</font><font color="#E5E5E5"> don't measure what the</font>

528
00:18:02,520 --> 00:18:05,580
<font color="#E5E5E5">keying material is that would be</font>

529
00:18:03,870 --> 00:18:06,929
<font color="#CCCCCC">pointless because</font><font color="#E5E5E5"> now the attacker would</font>

530
00:18:05,580 --> 00:18:08,220
use their own keying material and

531
00:18:06,930 --> 00:18:10,980
encrypt it with<font color="#E5E5E5"> a private key they have</font>

532
00:18:08,220 --> 00:18:13,410
no sense at<font color="#E5E5E5"> all</font><font color="#CCCCCC"> so we measure all three</font>

533
00:18:10,980 --> 00:18:15,720
things<font color="#E5E5E5"> if it's on we measure it if it is</font>

534
00:18:13,410 --> 00:18:18,540
on we now need to say is it encrypted if

535
00:18:15,720 --> 00:18:20,310
it's not encrypted<font color="#CCCCCC"> fail</font><font color="#E5E5E5"> if it is on and</font>

536
00:18:18,540 --> 00:18:22,159
it is encrypted<font color="#E5E5E5"> measure the key and</font>

537
00:18:20,310 --> 00:18:24,750
compare it<font color="#CCCCCC"> to a known good set of keys</font>

538
00:18:22,160 --> 00:18:27,420
so this is now all done with an external

539
00:18:24,750 --> 00:18:29,430
<font color="#E5E5E5">health attestation</font><font color="#CCCCCC"> Authority and we're</font>

540
00:18:27,420 --> 00:18:31,140
going to<font color="#E5E5E5"> couple key release for those</font>

541
00:18:29,430 --> 00:18:33,450
virtual machines<font color="#CCCCCC"> to that</font><font color="#E5E5E5"> health</font>

542
00:18:31,140 --> 00:18:35,190
attestation<font color="#CCCCCC"> done so let's go ahead</font><font color="#E5E5E5"> and</font>

543
00:18:33,450 --> 00:18:37,080
<font color="#CCCCCC">show you what this demo looks</font><font color="#E5E5E5"> like so</font>

544
00:18:35,190 --> 00:18:39,240
the fabric<font color="#CCCCCC"> cabin once again attempts</font><font color="#E5E5E5"> to</font>

545
00:18:37,080 --> 00:18:41,850
obtain<font color="#CCCCCC"> a crash dump on a host</font><font color="#E5E5E5"> that's</font>

546
00:18:39,240 --> 00:18:43,020
<font color="#CCCCCC">being measured</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> attested Taylor</font>

547
00:18:41,850 --> 00:18:45,330
doesn't<font color="#E5E5E5"> really know what this means</font>

548
00:18:43,020 --> 00:18:46,530
we're outside of<font color="#E5E5E5"> Taylor's world now so</font>

549
00:18:45,330 --> 00:18:48,270
the first thing that<font color="#E5E5E5"> the fabric admin</font>

550
00:18:46,530 --> 00:18:50,730
needs to do is power<font color="#E5E5E5"> on the VM because</font>

551
00:18:48,270 --> 00:18:52,050
he's got to get the<font color="#CCCCCC"> VMs ethic</font><font color="#E5E5E5"> in memory</font>

552
00:18:50,730 --> 00:18:54,990
for the crash<font color="#E5E5E5"> done for the host to</font><font color="#CCCCCC"> be</font>

553
00:18:52,050 --> 00:18:56,639
<font color="#CCCCCC">useful but he gets</font><font color="#E5E5E5"> an error saying</font><font color="#CCCCCC"> that</font>

554
00:18:54,990 --> 00:18:58,440
the keeper chapter couldn't be unwrapped

555
00:18:56,640 --> 00:19:01,020
<font color="#E5E5E5">this is basically saying that that is</font>

556
00:18:58,440 --> 00:19:02,880
protected by<font color="#CCCCCC"> an asymmetric key pair that</font>

557
00:19:01,020 --> 00:19:04,800
protects a symmetric key<font color="#CCCCCC"> Taylor doesn't</font>

558
00:19:02,880 --> 00:19:06,930
<font color="#E5E5E5">possess the private key</font><font color="#CCCCCC"> that was on</font><font color="#E5E5E5"> the</font>

559
00:19:04,800 --> 00:19:08,909
external attestation service you can see

560
00:19:06,930 --> 00:19:11,250
it failed him because dumps were enabled

561
00:19:08,910 --> 00:19:13,650
and<font color="#CCCCCC"> dumped encryption was not switched</font>

562
00:19:11,250 --> 00:19:16,290
on the external attestation service will

563
00:19:13,650 --> 00:19:17,760
<font color="#CCCCCC">not permit this so if we review every</font>

564
00:19:16,290 --> 00:19:19,590
single<font color="#CCCCCC"> thing that we've done here in</font>

565
00:19:17,760 --> 00:19:21,120
terms of<font color="#CCCCCC"> high-level mitigations</font><font color="#E5E5E5"> we've</font>

566
00:19:19,590 --> 00:19:23,520
got virtual disk files that are now

567
00:19:21,120 --> 00:19:25,409
store on encrypted volumes<font color="#CCCCCC"> vm's</font><font color="#E5E5E5"> that are</font>

568
00:19:23,520 --> 00:19:27,660
encrypting their own volumes<font color="#E5E5E5"> modern</font>

569
00:19:25,410 --> 00:19:30,210
hypervisors that are providing<font color="#CCCCCC"> VMs with</font>

570
00:19:27,660 --> 00:19:32,700
UV secure boot and with<font color="#E5E5E5"> synthetic TPMS</font>

571
00:19:30,210 --> 00:19:34,890
we've got restrictive<font color="#E5E5E5"> signed UV locked</font>

572
00:19:32,700 --> 00:19:36,900
code integrity policies external health

573
00:19:34,890 --> 00:19:38,940
attestation components and tightly

574
00:19:36,900 --> 00:19:42,270
coupled key release to that<font color="#E5E5E5"> health</font>

575
00:19:38,940 --> 00:19:44,880
attestation dance<font color="#CCCCCC"> alright so more</font>

576
00:19:42,270 --> 00:19:47,460
specifically what do we actually need we

577
00:19:44,880 --> 00:19:49,560
need<font color="#E5E5E5"> guest UEFI secure mated boot</font><font color="#CCCCCC"> per</font><font color="#E5E5E5"> VM</font>

578
00:19:47,460 --> 00:19:51,030
synthetic virtual TPM<font color="#E5E5E5"> sign</font><font color="#CCCCCC"> template</font><font color="#E5E5E5"> disk</font>

579
00:19:49,560 --> 00:19:53,310
secure<font color="#CCCCCC"> VM provisioning forward secrecy</font>

580
00:19:51,030 --> 00:19:55,560
hypervisor enforce code integrity secure

581
00:19:53,310 --> 00:19:57,060
key release<font color="#CCCCCC"> both UEFI secure measure boo</font>

582
00:19:55,560 --> 00:19:58,770
crash<font color="#E5E5E5"> dump protection through</font>

583
00:19:57,060 --> 00:19:59,510
<font color="#E5E5E5">measurement and attestation strong TPM</font>

584
00:19:58,770 --> 00:20:01,070
<font color="#E5E5E5">backed identity</font>

585
00:19:59,510 --> 00:20:02,900
<font color="#E5E5E5">per VM encryption keys and encrypted</font>

586
00:20:01,070 --> 00:20:05,389
live migration traffic<font color="#E5E5E5"> with forward</font>

587
00:20:02,900 --> 00:20:07,460
secrecy<font color="#CCCCCC"> now wouldn't it be fantastic if</font>

588
00:20:05,390 --> 00:20:11,230
<font color="#E5E5E5">somebody bothered to build a product</font>

589
00:20:07,460 --> 00:20:11,230
<font color="#E5E5E5">with all those things</font><font color="#CCCCCC"> in it that</font><font color="#E5E5E5"> works</font>

590
00:20:11,410 --> 00:20:17,120
<font color="#E5E5E5">and</font><font color="#CCCCCC"> very nice</font>

591
00:20:13,870 --> 00:20:19,159
Windows Server 2016<font color="#CCCCCC"> guarded hosts and</font>

592
00:20:17,120 --> 00:20:20,510
shielded VMs<font color="#CCCCCC"> I didn't</font><font color="#E5E5E5"> even show you some</font>

593
00:20:19,160 --> 00:20:21,980
of the<font color="#CCCCCC"> things that this thing protects</font>

594
00:20:20,510 --> 00:20:24,020
against<font color="#CCCCCC"> fear</font><font color="#E5E5E5"> we also protect</font>

595
00:20:21,980 --> 00:20:25,760
provisioning<font color="#E5E5E5"> disks template</font><font color="#CCCCCC"> disks so</font>

596
00:20:24,020 --> 00:20:28,129
<font color="#CCCCCC">there's secure provisioning where we</font>

597
00:20:25,760 --> 00:20:30,830
take<font color="#E5E5E5"> a template disk unknown trustworthy</font>

598
00:20:28,130 --> 00:20:32,660
admin signs that template disk<font color="#E5E5E5"> and then</font>

599
00:20:30,830 --> 00:20:34,610
that gets<font color="#E5E5E5"> added to the VM owners</font>

600
00:20:32,660 --> 00:20:36,650
encrypted lump of Secrets that<font color="#E5E5E5"> we</font><font color="#CCCCCC"> call</font>

601
00:20:34,610 --> 00:20:39,320
shielding data and at provisioning time

602
00:20:36,650 --> 00:20:41,090
<font color="#E5E5E5">are healthy attested as healthy</font><font color="#CCCCCC"> hosts</font>

603
00:20:39,320 --> 00:20:43,159
will validate<font color="#E5E5E5"> that the signature</font><font color="#CCCCCC"> of that</font>

604
00:20:41,090 --> 00:20:45,290
<font color="#E5E5E5">template disk matches a trustworthy</font>

605
00:20:43,160 --> 00:20:47,150
signature to ensure<font color="#CCCCCC"> that the template</font>

606
00:20:45,290 --> 00:20:49,639
<font color="#E5E5E5">disk has not been pre infected with</font>

607
00:20:47,150 --> 00:20:52,310
malware<font color="#CCCCCC"> otherwise you'd be deploying a</font>

608
00:20:49,640 --> 00:20:54,410
shielded<font color="#E5E5E5"> malware infested virtual</font>

609
00:20:52,310 --> 00:20:55,820
machine<font color="#CCCCCC"> which would be pointless</font><font color="#E5E5E5"> so</font>

610
00:20:54,410 --> 00:20:57,470
we've got additional<font color="#E5E5E5"> protections in</font>

611
00:20:55,820 --> 00:21:00,730
place<font color="#E5E5E5"> I didn't even have time</font><font color="#CCCCCC"> to show</font>

612
00:20:57,470 --> 00:21:00,730
you here I think we had a question<font color="#E5E5E5"> there</font>

613
00:21:05,530 --> 00:21:10,850
so all of the state files are also

614
00:21:07,730 --> 00:21:12,470
encrypted same basic key so we basically

615
00:21:10,850 --> 00:21:14,060
derive a key from<font color="#E5E5E5"> a transport key and</font>

616
00:21:12,470 --> 00:21:15,320
then we<font color="#E5E5E5"> encrypt them and then transport</font>

617
00:21:14,060 --> 00:21:16,790
key is rolled to a new key each

618
00:21:15,320 --> 00:21:18,379
interaction<font color="#E5E5E5"> with the attestation service</font>

619
00:21:16,790 --> 00:21:20,180
great<font color="#E5E5E5"> question the question there was</font>

620
00:21:18,380 --> 00:21:22,490
how do<font color="#E5E5E5"> you protect the state files it is</font>

621
00:21:20,180 --> 00:21:24,260
a great question<font color="#CCCCCC"> it was the first thing</font>

622
00:21:22,490 --> 00:21:26,360
<font color="#CCCCCC">we solved in terms of disk persistence</font>

623
00:21:24,260 --> 00:21:28,040
<font color="#E5E5E5">the second thing we solved really late</font>

624
00:21:26,360 --> 00:21:31,790
<font color="#CCCCCC">in the game because</font><font color="#E5E5E5"> we forgot</font><font color="#CCCCCC"> about it</font>

625
00:21:28,040 --> 00:21:33,080
<font color="#E5E5E5">was crash dumps and hibernate files yet</font>

626
00:21:31,790 --> 00:21:34,550
<font color="#E5E5E5">we literally forgot about them until</font>

627
00:21:33,080 --> 00:21:35,870
<font color="#E5E5E5">quite late in the engineering cycle when</font>

628
00:21:34,550 --> 00:21:37,010
somebody said what happens when you

629
00:21:35,870 --> 00:21:38,120
<font color="#CCCCCC">crash them the</font><font color="#E5E5E5"> host and we're like yeah</font>

630
00:21:37,010 --> 00:21:40,430
you can just<font color="#CCCCCC"> extract all the</font><font color="#E5E5E5"> keys</font>

631
00:21:38,120 --> 00:21:41,870
fabulous<font color="#E5E5E5"> let's encrypt those so that</font>

632
00:21:40,430 --> 00:21:43,790
<font color="#E5E5E5">came in rather late in</font><font color="#CCCCCC"> the day</font><font color="#E5E5E5"> but</font>

633
00:21:41,870 --> 00:21:44,689
<font color="#CCCCCC">before the RTM went out the door so</font>

634
00:21:43,790 --> 00:21:48,649
<font color="#CCCCCC">that's in there</font><font color="#E5E5E5"> as well</font>

635
00:21:44,690 --> 00:21:51,590
any other questions<font color="#CCCCCC"> I'm curious if</font>

636
00:21:48,650 --> 00:21:53,840
you've surveyed any of your mates very

637
00:21:51,590 --> 00:21:56,720
well-thought coming from<font color="#CCCCCC"> far</font><font color="#E5E5E5"> left</font><font color="#CCCCCC"> are</font>

638
00:21:53,840 --> 00:21:58,189
years you're right well<font color="#E5E5E5"> there we go</font><font color="#CCCCCC"> I'm</font>

639
00:21:56,720 --> 00:22:00,320
<font color="#E5E5E5">curious how many of your large</font>

640
00:21:58,190 --> 00:22:01,790
deployment customers<font color="#E5E5E5"> you're surveyed for</font>

641
00:22:00,320 --> 00:22:04,580
the<font color="#E5E5E5"> feasibility of actually deploying</font>

642
00:22:01,790 --> 00:22:06,200
<font color="#E5E5E5">this full set</font><font color="#CCCCCC"> of features so the</font>

643
00:22:04,580 --> 00:22:08,449
question now<font color="#E5E5E5"> imagine you basically</font>

644
00:22:06,200 --> 00:22:10,700
hearing is how many people<font color="#CCCCCC"> have deployed</font>

645
00:22:08,450 --> 00:22:12,750
this based<font color="#CCCCCC"> upon a perceived level</font><font color="#E5E5E5"> of</font>

646
00:22:10,700 --> 00:22:14,190
complexity well

647
00:22:12,750 --> 00:22:15,930
largest customers that we've got<font color="#E5E5E5"> looking</font>

648
00:22:14,190 --> 00:22:17,670
at this right<font color="#CCCCCC"> now are</font><font color="#E5E5E5"> all</font><font color="#CCCCCC"> governments</font><font color="#E5E5E5"> I</font>

649
00:22:15,930 --> 00:22:19,170
won't be no more<font color="#E5E5E5"> specific than that</font>

650
00:22:17,670 --> 00:22:21,720
there are obviously governmental

651
00:22:19,170 --> 00:22:23,400
agencies military<font color="#E5E5E5"> agencies that are</font>

652
00:22:21,720 --> 00:22:24,630
deploying this as well<font color="#E5E5E5"> the biggest</font>

653
00:22:23,400 --> 00:22:27,510
blocker<font color="#CCCCCC"> that we're seeing</font><font color="#E5E5E5"> right</font><font color="#CCCCCC"> now</font>

654
00:22:24,630 --> 00:22:29,040
<font color="#E5E5E5">isn't</font><font color="#CCCCCC"> the hyper-v hosts it isn't the</font>

655
00:22:27,510 --> 00:22:30,750
shielded VM it isn't the slightly

656
00:22:29,040 --> 00:22:32,520
<font color="#E5E5E5">different deployment semantics and</font>

657
00:22:30,750 --> 00:22:34,260
signing of template<font color="#CCCCCC"> disks creation of</font>

658
00:22:32,520 --> 00:22:35,190
shielding data all the primitives that

659
00:22:34,260 --> 00:22:37,860
<font color="#E5E5E5">build a</font><font color="#CCCCCC"> shielded VM</font>

660
00:22:35,190 --> 00:22:39,540
it's that<font color="#E5E5E5"> host</font><font color="#CCCCCC"> Guardian service the host</font>

661
00:22:37,860 --> 00:22:41,850
<font color="#E5E5E5">Guardian service is an external</font>

662
00:22:39,540 --> 00:22:43,830
attestation<font color="#E5E5E5"> and key release mechanism it</font>

663
00:22:41,850 --> 00:22:45,419
would typically be<font color="#E5E5E5"> backed</font><font color="#CCCCCC"> by an HSM a</font>

664
00:22:43,830 --> 00:22:47,639
hardware security module<font color="#E5E5E5"> for key release</font>

665
00:22:45,420 --> 00:22:49,650
<font color="#E5E5E5">but it needs to</font><font color="#CCCCCC"> be managed with the</font><font color="#E5E5E5"> same</font>

666
00:22:47,640 --> 00:22:52,740
<font color="#E5E5E5">kid gloves as you do domain controllers</font>

667
00:22:49,650 --> 00:22:54,870
and<font color="#CCCCCC"> PKI environments it even</font><font color="#E5E5E5"> uses</font><font color="#CCCCCC"> PKI</font>

668
00:22:52,740 --> 00:22:57,240
for its own purposes<font color="#CCCCCC"> we've heard that</font>

669
00:22:54,870 --> 00:22:59,790
feedback loud and clear we're working to

670
00:22:57,240 --> 00:23:01,230
build an HTTPS<font color="#E5E5E5"> as a service so it would</font>

671
00:22:59,790 --> 00:23:03,000
be something<font color="#E5E5E5"> that</font><font color="#CCCCCC"> runs in Azure and you</font>

672
00:23:01,230 --> 00:23:05,280
can simply point hyper-v hosts<font color="#E5E5E5"> on Prem</font>

673
00:23:03,000 --> 00:23:07,050
at a restful endpoint in<font color="#CCCCCC"> Azure</font><font color="#E5E5E5"> over</font><font color="#CCCCCC"> at</font>

674
00:23:05,280 --> 00:23:08,879
TLS and it<font color="#E5E5E5"> will go ahead and do the</font>

675
00:23:07,050 --> 00:23:10,230
attestation dance for you there<font color="#E5E5E5"> so does</font>

676
00:23:08,880 --> 00:23:12,630
that<font color="#E5E5E5"> answer your question most of them</font>

677
00:23:10,230 --> 00:23:14,760
are not<font color="#CCCCCC"> happy with the HDS side because</font>

678
00:23:12,630 --> 00:23:16,680
they claim<font color="#E5E5E5"> it's a little bit too much</font><font color="#CCCCCC"> of</font>

679
00:23:14,760 --> 00:23:18,270
a burden<font color="#CCCCCC"> those that are happy</font><font color="#E5E5E5"> typically</font>

680
00:23:16,680 --> 00:23:20,460
have an Active Directory forest called

681
00:23:18,270 --> 00:23:22,110
an es<font color="#E5E5E5"> AE forest the enhanced</font>

682
00:23:20,460 --> 00:23:24,360
administration and security<font color="#E5E5E5"> forest that</font>

683
00:23:22,110 --> 00:23:26,490
the<font color="#E5E5E5"> MCS guys put together they combine</font>

684
00:23:24,360 --> 00:23:28,590
<font color="#CCCCCC">HGS with that forest</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> that tends to</font>

685
00:23:26,490 --> 00:23:29,550
be<font color="#E5E5E5"> a none blocker but that is the</font>

686
00:23:28,590 --> 00:23:31,740
feedback<font color="#E5E5E5"> that we're here in the</font><font color="#CCCCCC"> hosts</font>

687
00:23:29,550 --> 00:23:36,800
<font color="#E5E5E5">Guardian service needs to be slightly</font>

688
00:23:31,740 --> 00:23:36,800
simpler to deploy any other questions

689
00:23:37,190 --> 00:23:41,160
perhaps the most<font color="#E5E5E5"> amazing thing is if we</font>

690
00:23:39,420 --> 00:23:44,360
gave Dean a full hour<font color="#CCCCCC"> he</font><font color="#E5E5E5"> just has the</font>

691
00:23:41,160 --> 00:23:46,920
same presentation<font color="#CCCCCC"> over again</font><font color="#E5E5E5"> backwards</font>

692
00:23:44,360 --> 00:23:51,570
just<font color="#E5E5E5"> reverse it rewind question</font><font color="#CCCCCC"> at the</font>

693
00:23:46,920 --> 00:23:55,170
back<font color="#E5E5E5"> there if I change my signing policy</font>

694
00:23:51,570 --> 00:23:57,300
<font color="#E5E5E5">how hard is it to revalidate</font><font color="#CCCCCC"> or is there</font>

695
00:23:55,170 --> 00:23:59,550
a process to revalidate that signing

696
00:23:57,300 --> 00:24:02,280
process<font color="#CCCCCC"> II do</font><font color="#E5E5E5"> the signing finding of</font>

697
00:23:59,550 --> 00:24:05,010
what code<font color="#E5E5E5"> signing so I change my code</font>

698
00:24:02,280 --> 00:24:06,389
signing policy or update it<font color="#CCCCCC"> are you</font>

699
00:24:05,010 --> 00:24:08,850
talking for code integrity<font color="#CCCCCC"> purposes</font>

700
00:24:06,390 --> 00:24:10,650
integrity yeah it's<font color="#CCCCCC"> there you can merge</font>

701
00:24:08,850 --> 00:24:12,929
CI policies together<font color="#E5E5E5"> so the question</font>

702
00:24:10,650 --> 00:24:14,550
there<font color="#CCCCCC"> is around the the cert that are</font>

703
00:24:12,930 --> 00:24:16,110
being<font color="#E5E5E5"> used to code</font><font color="#CCCCCC"> sign the binaries</font>

704
00:24:14,550 --> 00:24:17,340
<font color="#CCCCCC">that are permitted to</font><font color="#E5E5E5"> run as</font><font color="#CCCCCC"> part of</font><font color="#E5E5E5"> the</font>

705
00:24:16,110 --> 00:24:19,770
code integrity policy<font color="#CCCCCC"> on</font><font color="#E5E5E5"> the hyper-v</font>

706
00:24:17,340 --> 00:24:21,419
<font color="#E5E5E5">hosts yes we can merge new CI policies</font>

707
00:24:19,770 --> 00:24:23,460
on top of the new on<font color="#E5E5E5"> of the existing one</font>

708
00:24:21,420 --> 00:24:25,830
<font color="#E5E5E5">in order to bring new CI into play I</font>

709
00:24:23,460 --> 00:24:26,310
won't<font color="#E5E5E5"> say it's the easiest thing to do</font>

710
00:24:25,830 --> 00:24:28,530
there<font color="#CCCCCC"> is a</font>

711
00:24:26,310 --> 00:24:30,290
<font color="#CCCCCC">command that however to do it but yeah</font>

712
00:24:28,530 --> 00:24:34,770
it's<font color="#E5E5E5"> definitely doable</font>

713
00:24:30,290 --> 00:24:37,230
any other questions<font color="#CCCCCC"> last</font><font color="#E5E5E5"> call before</font><font color="#CCCCCC"> we</font>

714
00:24:34,770 --> 00:24:39,560
reset for our next<font color="#E5E5E5"> presentation</font><font color="#CCCCCC"> can't</font>

715
00:24:37,230 --> 00:24:41,820
<font color="#CCCCCC">believe I got</font><font color="#E5E5E5"> into</font><font color="#CCCCCC"> 25</font><font color="#E5E5E5"> minutes hi</font>

716
00:24:39,560 --> 00:24:45,030
how many of you understood more<font color="#E5E5E5"> than</font>

717
00:24:41,820 --> 00:24:52,079
seven words<font color="#CCCCCC"> alright</font><font color="#E5E5E5"> thank you very much</font>

718
00:24:45,030 --> 00:24:52,079
[Applause]

