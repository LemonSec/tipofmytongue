1
00:00:08,960 --> 00:00:14,400
thank you all just just to get an idea

2
00:00:11,750 --> 00:00:16,259
can I see hands or move in this room

3
00:00:14,400 --> 00:00:21,510
considers himself the blue side of

4
00:00:16,260 --> 00:00:24,359
things of each other Allah Hafiz Iraq we

5
00:00:21,510 --> 00:00:27,930
have 18 Beretta corporators the

6
00:00:24,359 --> 00:00:30,300
Malaysian testers also but shall we put

7
00:00:27,930 --> 00:00:32,130
a nice fifty fifty years with while

8
00:00:30,300 --> 00:00:35,280
Esther has introduced we are from

9
00:00:32,130 --> 00:00:37,140
athlete and you're going to talk about

10
00:00:35,280 --> 00:00:39,600
of secretaries that are made by blue

11
00:00:37,140 --> 00:00:41,520
teams especially how do we as rating

12
00:00:39,600 --> 00:00:42,899
operators but monitor what's happening

13
00:00:41,520 --> 00:00:48,480
out there what we see on our

14
00:00:42,899 --> 00:00:51,690
infrastructure about us I'm mark started

15
00:00:48,480 --> 00:00:53,519
coding on mainframes just before the

16
00:00:51,690 --> 00:00:55,110
hero conversion and the year 2000

17
00:00:53,520 --> 00:00:56,250
problem and all that stuff so the black

18
00:00:55,110 --> 00:00:58,589
screens which really matters

19
00:00:56,250 --> 00:01:00,090
fathers quite fast and I was not the

20
00:00:58,590 --> 00:01:02,280
energy developer doesn't also mean that

21
00:01:00,090 --> 00:01:04,049
I was better developer and not

22
00:01:02,280 --> 00:01:06,030
structured enough to be a proper

23
00:01:04,049 --> 00:01:09,150
developer but I did have my way with

24
00:01:06,030 --> 00:01:10,740
computers so I wrote into security did

25
00:01:09,150 --> 00:01:14,820
that for a while I started being with

26
00:01:10,740 --> 00:01:17,669
offensive security as of 2004 now I'm

27
00:01:14,820 --> 00:01:19,610
writing operator and also lazy so if I

28
00:01:17,670 --> 00:01:21,930
do things twice or three times I tend to

29
00:01:19,610 --> 00:01:26,580
develop something around it to make it

30
00:01:21,930 --> 00:01:31,280
easier for me my colleague mark as years

31
00:01:26,580 --> 00:01:31,280
well yeah so my my name is Mark

32
00:01:32,259 --> 00:01:36,250
an extract Marco's IP I want to thank

33
00:01:34,630 --> 00:01:37,990
you all for being here one thing to the

34
00:01:36,250 --> 00:01:39,399
conference organisers question allow us

35
00:01:37,990 --> 00:01:43,689
to talk about this topic

36
00:01:39,399 --> 00:01:46,090
my official information security career

37
00:01:43,689 --> 00:01:47,469
started in 2006 before that I had a

38
00:01:46,090 --> 00:01:50,560
background in system and after of

39
00:01:47,469 --> 00:01:54,669
engineering making these days are big

40
00:01:50,560 --> 00:01:56,950
things most of my parties to pet the

41
00:01:54,670 --> 00:02:00,490
operator I built some tools to use my

42
00:01:56,950 --> 00:02:04,240
work also recently I had the experience

43
00:02:00,490 --> 00:02:06,640
of doing some spread hunting experience

44
00:02:04,240 --> 00:02:09,459
at the blue side of the company so fully

45
00:02:06,640 --> 00:02:12,340
aligned with the keynote I want to say

46
00:02:09,459 --> 00:02:13,900
that it really helps the red teamer to

47
00:02:12,340 --> 00:02:15,640
be in the blue side and otherwise as

48
00:02:13,900 --> 00:02:17,560
well the blue team we're working right

49
00:02:15,640 --> 00:02:18,819
now really benefit from the red team

50
00:02:17,560 --> 00:02:29,069
degrees that they bring to the whole

51
00:02:18,819 --> 00:02:31,839
threat hunting and yeah so that's why we

52
00:02:29,069 --> 00:02:35,920
give security firms out there my wife

53
00:02:31,840 --> 00:02:38,470
why finally one we saw that that often

54
00:02:35,920 --> 00:02:41,470
pen testers moved to being red teamers

55
00:02:38,470 --> 00:02:43,840
and those two are in our opinion

56
00:02:41,470 --> 00:02:45,790
different kinds of creatures been tested

57
00:02:43,840 --> 00:02:49,150
on already whose retinas are always pen

58
00:02:45,790 --> 00:02:51,160
testers so even though they have similar

59
00:02:49,150 --> 00:02:53,500
skill sets the way they operate should

60
00:02:51,160 --> 00:02:55,870
be quite different so that's why we

61
00:02:53,500 --> 00:02:58,420
found our plane about three three and a

62
00:02:55,870 --> 00:03:01,359
half years ago to specialize in red

63
00:02:58,420 --> 00:03:03,399
teaming we try to build a small team

64
00:03:01,359 --> 00:03:05,829
we're now with six people always a

65
00:03:03,400 --> 00:03:07,900
decent amount of experience so we don't

66
00:03:05,829 --> 00:03:09,730
have to tackle boards the proper ID

67
00:03:07,900 --> 00:03:12,100
teams also have a vision and how things

68
00:03:09,730 --> 00:03:14,260
should be done before we dive into our

69
00:03:12,100 --> 00:03:16,388
product of rebuilding and how we try to

70
00:03:14,260 --> 00:03:18,310
improve our work I first want to dive a

71
00:03:16,389 --> 00:03:20,349
bit into what we think retinol should be

72
00:03:18,310 --> 00:03:22,209
so these don't were all on the same page

73
00:03:20,349 --> 00:03:24,548
we might agree

74
00:03:22,209 --> 00:03:26,379
but at least then we know what we are we

75
00:03:24,549 --> 00:03:29,950
defined red teaming and how we how we

76
00:03:26,379 --> 00:03:32,590
see it we often like to compare a TV

77
00:03:29,950 --> 00:03:36,369
with this image a boxing match well not

78
00:03:32,590 --> 00:03:38,140
a match between gigg if you're if you've

79
00:03:36,370 --> 00:03:40,599
considered the red team to be the

80
00:03:38,140 --> 00:03:43,420
trainer then there's no use in mocking

81
00:03:40,599 --> 00:03:46,089
the blue team out breaking in stealing

82
00:03:43,420 --> 00:03:48,010
all their gold going away make a dance

83
00:03:46,090 --> 00:03:50,200
write a report there's no learning

84
00:03:48,010 --> 00:03:53,319
adapter the blue team is not going to

85
00:03:50,200 --> 00:03:55,599
prove by doing that once twice or five

86
00:03:53,319 --> 00:03:57,369
times they might learn from the reports

87
00:03:55,599 --> 00:04:00,010
that the white builds on some more

88
00:03:57,370 --> 00:04:02,019
detections to find what you specific you

89
00:04:00,010 --> 00:04:03,340
did at that point but you're not going

90
00:04:02,019 --> 00:04:05,230
to really train them in their daily

91
00:04:03,340 --> 00:04:07,030
operations especially nothing if the

92
00:04:05,230 --> 00:04:10,090
real actor will once knock on the door

93
00:04:07,030 --> 00:04:13,329
so how we see where teaming is more in

94
00:04:10,090 --> 00:04:16,298
the sparring situation we even would go

95
00:04:13,329 --> 00:04:19,269
as far as to state that the red team

96
00:04:16,298 --> 00:04:21,370
that was undetected due to the whole

97
00:04:19,269 --> 00:04:21,940
operation is a field for the red team as

98
00:04:21,370 --> 00:04:24,699
well

99
00:04:21,940 --> 00:04:26,860
red team should move to what's being

100
00:04:24,699 --> 00:04:29,260
detected they should move to watch

101
00:04:26,860 --> 00:04:31,300
engage with the blue team because only

102
00:04:29,260 --> 00:04:33,039
that is how training which works that

103
00:04:31,300 --> 00:04:36,389
how a training Mexican be used to

104
00:04:33,039 --> 00:04:39,159
improve capabilities on both both sides

105
00:04:36,389 --> 00:04:43,120
but before we dive deeper into the end

106
00:04:39,159 --> 00:04:45,010
the red up the tool presents I want a

107
00:04:43,120 --> 00:04:48,190
word on our infrastructure looks like

108
00:04:45,010 --> 00:04:50,530
and I think it's really closely aligned

109
00:04:48,190 --> 00:04:52,330
to what we see out in the world and we

110
00:04:50,530 --> 00:04:54,849
have the customer here and all the left

111
00:04:52,330 --> 00:04:56,710
side and a line of three directors in

112
00:04:54,849 --> 00:04:58,419
between and then we have to come all the

113
00:04:56,710 --> 00:05:00,698
controls over that we will be operating

114
00:04:58,419 --> 00:05:03,330
on we tend to use a lot we tend to use

115
00:05:00,699 --> 00:05:05,340
like a lot of course

116
00:05:03,330 --> 00:05:07,289
of mine just as good and just as usable

117
00:05:05,340 --> 00:05:10,530
and even then you'll end up with a

118
00:05:07,289 --> 00:05:12,688
similar IT infrastructure on the

119
00:05:10,530 --> 00:05:14,520
offensive side to being a layer of

120
00:05:12,689 --> 00:05:17,460
redirector state you used to leave out

121
00:05:14,520 --> 00:05:18,780
or do more intelligent stuff but at

122
00:05:17,460 --> 00:05:22,289
least used to read arrive to see to

123
00:05:18,780 --> 00:05:24,270
traffic through your back ends now while

124
00:05:22,289 --> 00:05:25,710
this is described schematics but as soon

125
00:05:24,270 --> 00:05:27,750
as we started with an offensive

126
00:05:25,710 --> 00:05:30,060
operation but we might read three

127
00:05:27,750 --> 00:05:31,979
scenarios at the same time and within

128
00:05:30,060 --> 00:05:33,949
this one scenario one of my comments

129
00:05:31,979 --> 00:05:36,750
were always at work can I have another

130
00:05:33,949 --> 00:05:38,909
prophecy to profile for this specific

131
00:05:36,750 --> 00:05:40,919
scenario supplied soon you'll see we'll

132
00:05:38,909 --> 00:05:43,020
find ourselves having at least four or

133
00:05:40,919 --> 00:05:46,859
five the mana control servers on the

134
00:05:43,020 --> 00:05:49,258
back end up to 15 sometimes even 23

135
00:05:46,860 --> 00:05:52,650
directors the word there's a lot of need

136
00:05:49,259 --> 00:05:54,479
of many old editions in we want to

137
00:05:52,650 --> 00:05:56,638
divert traffic now we want to monitor

138
00:05:54,479 --> 00:05:58,979
traffic where we want to send it I think

139
00:05:56,639 --> 00:06:02,310
the basic message is things get complex

140
00:05:58,979 --> 00:06:04,680
quite fast also on the red team side of

141
00:06:02,310 --> 00:06:07,199
things that we quite often have over 40

142
00:06:04,680 --> 00:06:09,569
or 50 systems that we just split up over

143
00:06:07,199 --> 00:06:11,460
the last few weeks and we want to keep

144
00:06:09,569 --> 00:06:12,840
an eye on what's going on what's

145
00:06:11,460 --> 00:06:15,900
happening all these machines who is

146
00:06:12,840 --> 00:06:18,440
paying them who is visiting the size of

147
00:06:15,900 --> 00:06:21,239
there it was talking to see to and so on

148
00:06:18,440 --> 00:06:23,490
so that's why further reading the big

149
00:06:21,240 --> 00:06:25,949
challenges and only if the Reta vision

150
00:06:23,490 --> 00:06:27,900
is in control of its operation that's

151
00:06:25,949 --> 00:06:30,680
the place where we can help the blue

152
00:06:27,900 --> 00:06:30,679
team in the best way possible

153
00:06:33,020 --> 00:06:41,330
so our infrastructure grows

154
00:06:36,449 --> 00:06:43,699
exponentially we try to

155
00:06:41,330 --> 00:06:45,620
as long when the such it grows and grows

156
00:06:43,699 --> 00:06:48,650
and all components are headed so if

157
00:06:45,620 --> 00:06:52,340
we're having roughly said two challenges

158
00:06:48,650 --> 00:06:54,378
with our info center remaining in the

159
00:06:52,340 --> 00:06:57,500
position of proper oversight and having

160
00:06:54,379 --> 00:07:00,710
proper inside during the operation want

161
00:06:57,500 --> 00:07:03,469
to know what's going on if you look at

162
00:07:00,710 --> 00:07:06,530
the concept of oversight let's go

163
00:07:03,469 --> 00:07:08,300
Cowboys they have typical challenges

164
00:07:06,530 --> 00:07:11,508
they have their herd which was running

165
00:07:08,300 --> 00:07:14,389
around everywhere they want to know if

166
00:07:11,509 --> 00:07:18,889
they hurt is in proper shape where they

167
00:07:14,389 --> 00:07:22,300
are etc all these things said have the

168
00:07:18,889 --> 00:07:25,069
same type of changes with the oversight

169
00:07:22,300 --> 00:07:26,900
if you look at the inside that we want

170
00:07:25,069 --> 00:07:32,479
to get I want to reference back to the

171
00:07:26,900 --> 00:07:34,190
French surely : this is a picture at the

172
00:07:32,479 --> 00:07:38,300
new park he was in the early twenty

173
00:07:34,190 --> 00:07:40,029
century he was the first person with

174
00:07:38,300 --> 00:07:42,439
forensic science to do it properly

175
00:07:40,029 --> 00:07:45,289
scientific based evidence based practice

176
00:07:42,439 --> 00:07:46,849
he used actually scientific measures to

177
00:07:45,289 --> 00:07:49,878
go to inform scene into the

178
00:07:46,849 --> 00:07:55,520
investigation he used raw data to get

179
00:07:49,879 --> 00:07:58,610
the proper insights so he is most famous

180
00:07:55,520 --> 00:08:02,930
for his statement which is every contact

181
00:07:58,610 --> 00:08:03,949
leaves a trace for principle and this

182
00:08:02,930 --> 00:08:07,159
actually goes both ways

183
00:08:03,949 --> 00:08:08,639
every interaction that rats does will

184
00:08:07,159 --> 00:08:11,280
leave a trace

185
00:08:08,639 --> 00:08:14,460
find every interaction and new dose will

186
00:08:11,280 --> 00:08:15,929
leave a trace for Reza to find that's

187
00:08:14,460 --> 00:08:19,020
interesting there's an important thing

188
00:08:15,930 --> 00:08:21,419
to remember so with those two challenges

189
00:08:19,020 --> 00:08:26,599
that we have let's look at the tools

190
00:08:21,419 --> 00:08:30,448
that we can use for getting better in it

191
00:08:26,599 --> 00:08:33,450
so the dogs that are used by fabulous

192
00:08:30,449 --> 00:08:36,209
the microscopes that are used by by

193
00:08:33,450 --> 00:08:37,919
forensic investigators we do not have

194
00:08:36,208 --> 00:08:41,130
something like that for our own

195
00:08:37,919 --> 00:08:44,279
infrastructure operation so we need to

196
00:08:41,130 --> 00:08:46,439
create something ourselves and that's

197
00:08:44,279 --> 00:08:49,079
what we came up with I apologize in

198
00:08:46,440 --> 00:08:50,399
advance for this awesome picture if

199
00:08:49,079 --> 00:08:52,260
there's anybody in the room who has some

200
00:08:50,399 --> 00:08:53,970
creative background that can make a

201
00:08:52,260 --> 00:08:56,220
better picture we are open to death but

202
00:08:53,970 --> 00:08:59,850
at this moment it's just this this help

203
00:08:56,220 --> 00:09:05,449
with a read sometimes you've already put

204
00:08:59,850 --> 00:09:08,940
it on stickers I believe we do have so

205
00:09:05,449 --> 00:09:11,849
Reta combines the two things that we

206
00:09:08,940 --> 00:09:13,709
need to fix oversight and inside you can

207
00:09:11,850 --> 00:09:15,810
read the blog or we introduced this you

208
00:09:13,709 --> 00:09:17,099
can go to very github because we thought

209
00:09:15,810 --> 00:09:18,750
this is important as well because

210
00:09:17,100 --> 00:09:21,329
there's no such thing community at this

211
00:09:18,750 --> 00:09:22,769
moment so we of resources feel free to

212
00:09:21,329 --> 00:09:25,489
play with it either if you on the red

213
00:09:22,769 --> 00:09:25,490
side corner do

214
00:09:26,710 --> 00:09:33,160
what have to do well let's have a more

215
00:09:29,560 --> 00:09:34,689
higher overview for our network or an

216
00:09:33,160 --> 00:09:36,670
operation should do plug on the left

217
00:09:34,690 --> 00:09:38,070
side you I have to target network the

218
00:09:36,670 --> 00:09:40,270
client that we're trying to pick

219
00:09:38,070 --> 00:09:46,089
normalcy to traffic and normal high tech

220
00:09:40,270 --> 00:09:47,470
traffic you will always flow through so

221
00:09:46,089 --> 00:09:49,120
there's the first one infrastructure

222
00:09:47,470 --> 00:09:51,940
which will have the first proxies the

223
00:09:49,120 --> 00:09:53,350
way in front a normal web sites freaking

224
00:09:51,940 --> 00:09:57,190
pictures everything goes through the

225
00:09:53,350 --> 00:09:59,680
first line and then there is some

226
00:09:57,190 --> 00:10:02,020
traffic that is allowed to go through as

227
00:09:59,680 --> 00:10:04,829
c2 traffic back to our seat or service

228
00:10:02,020 --> 00:10:10,060
which can be moved

229
00:10:04,830 --> 00:10:13,600
basically right let's put in red red elf

230
00:10:10,060 --> 00:10:21,130
does a few things of course the L stands

231
00:10:13,600 --> 00:10:24,399
for an asset search okay this is better

232
00:10:21,130 --> 00:10:27,399
okay so an Essex search log stash Cubana

233
00:10:24,399 --> 00:10:29,200
the NoSQL data set with key banovina

234
00:10:27,399 --> 00:10:35,980
front-end for it and locks I mean the

235
00:10:29,200 --> 00:10:38,980
whole thing right now gets is data using

236
00:10:35,980 --> 00:10:40,660
file beat components that reach all the

237
00:10:38,980 --> 00:10:42,160
log files from the data vectors or

238
00:10:40,660 --> 00:10:45,219
anything within the first line of

239
00:10:42,160 --> 00:10:47,800
infrastructure as well as the logs from

240
00:10:45,220 --> 00:10:50,680
our team service during operation so we

241
00:10:47,800 --> 00:10:53,109
get traffic data as well as operational

242
00:10:50,680 --> 00:10:55,689
data and on the right side you will see

243
00:10:53,110 --> 00:10:58,120
another picture for data copy which

244
00:10:55,690 --> 00:11:00,910
means that we transfer specific files

245
00:10:58,120 --> 00:11:03,610
during the operation as well back to our

246
00:11:00,910 --> 00:11:05,770
central catalog server why we want to

247
00:11:03,610 --> 00:11:07,900
have one central overview of all

248
00:11:05,770 --> 00:11:09,670
screenshots all downloaded files all

249
00:11:07,900 --> 00:11:11,560
piece goes everything during the

250
00:11:09,670 --> 00:11:14,140
operation which was spread across

251
00:11:11,560 --> 00:11:15,910
multiple team service you wanna have one

252
00:11:14,140 --> 00:11:19,050
central location so we'll transferring

253
00:11:15,910 --> 00:11:20,939
that back to de facto simple

254
00:11:19,050 --> 00:11:22,800
we're making some dashboards for storing

255
00:11:20,940 --> 00:11:24,630
it into indexes we're doing the richness

256
00:11:22,800 --> 00:11:26,790
of the data that is coming in I mean of

257
00:11:24,630 --> 00:11:28,680
course as it's being a big search engine

258
00:11:26,790 --> 00:11:30,660
we can do some searching with it and

259
00:11:28,680 --> 00:11:32,189
with that we can have a proper access

260
00:11:30,660 --> 00:11:34,199
for the head team as well if you might

261
00:11:32,190 --> 00:11:37,350
want to do that I have the white team as

262
00:11:34,200 --> 00:11:39,839
well look into some of the data of

263
00:11:37,350 --> 00:11:41,790
course for the blue team it's not that

264
00:11:39,839 --> 00:11:43,920
weird it's actually new at all to

265
00:11:41,790 --> 00:11:45,719
collect data put it in one place you can

266
00:11:43,920 --> 00:11:48,660
look at it but you would be surprised to

267
00:11:45,720 --> 00:11:53,700
see how little to wait for atoms to do

268
00:11:48,660 --> 00:11:56,490
this properly so pretty simple right

269
00:11:53,700 --> 00:11:58,380
we're putting on some some help stack in

270
00:11:56,490 --> 00:11:59,670
the middle put in some locks using

271
00:11:58,380 --> 00:12:03,120
filtering through some Richmond's that's

272
00:11:59,670 --> 00:12:05,670
it well let's look what happens when the

273
00:12:03,120 --> 00:12:08,070
blue team actually finds some artifacts

274
00:12:05,670 --> 00:12:10,110
of our art area the sock starts to do

275
00:12:08,070 --> 00:12:11,459
some analysis they will find a piece of

276
00:12:10,110 --> 00:12:13,589
malware on their systems they will do

277
00:12:11,459 --> 00:12:16,680
some analysis that the nanoscale

278
00:12:13,589 --> 00:12:19,399
includes basically clearing for the any

279
00:12:16,680 --> 00:12:21,510
files or other i/o sees to online

280
00:12:19,399 --> 00:12:23,730
security service providers something of

281
00:12:21,510 --> 00:12:27,560
Spamhaus virustotal IBM x-force some

282
00:12:23,730 --> 00:12:31,440
online resources that's interesting

283
00:12:27,560 --> 00:12:34,560
because those online service providers

284
00:12:31,440 --> 00:12:37,230
will start doing live analysis and will

285
00:12:34,560 --> 00:12:39,510
start searching on the IP address or DNS

286
00:12:37,230 --> 00:12:41,100
names of our infrastructure which will

287
00:12:39,510 --> 00:12:46,170
be the first line of defense and as

288
00:12:41,100 --> 00:12:48,690
we're getting the data many times

289
00:12:46,170 --> 00:12:51,300
analysts as well start creating our

290
00:12:48,690 --> 00:12:53,910
infrastructure as well so there's

291
00:12:51,300 --> 00:13:01,319
communication from the sock perhaps a

292
00:12:53,910 --> 00:13:05,069
difference and here comes the sim

293
00:13:01,320 --> 00:13:08,279
functionality we can query for all those

294
00:13:05,070 --> 00:13:10,350
attacks or these artifacts VOCs at the

295
00:13:08,279 --> 00:13:12,180
online service providers as well as we

296
00:13:10,350 --> 00:13:14,970
because we put all the data inside a

297
00:13:12,180 --> 00:13:19,349
telex deck as well we can very smartly

298
00:13:14,970 --> 00:13:25,649
in our own data which will give us some

299
00:13:19,350 --> 00:13:26,880
rule-based alarming from Shannon that's

300
00:13:25,649 --> 00:13:28,949
the high vision now let's talk about

301
00:13:26,880 --> 00:13:30,570
specific infrastructure components that

302
00:13:28,949 --> 00:13:33,180
are supported at this moment like my

303
00:13:30,570 --> 00:13:35,130
colleague Mark said already we tend to

304
00:13:33,180 --> 00:13:37,770
use commerce right quite a lot we built

305
00:13:35,130 --> 00:13:40,470
this in the beginning for off collar

306
00:13:37,770 --> 00:13:42,329
strike so it has a full support for call

307
00:13:40,470 --> 00:13:44,670
strike if you use a couple strike this

308
00:13:42,329 --> 00:13:46,770
is a tool to check c1 you might want to

309
00:13:44,670 --> 00:13:48,660
dive into red over there is no costume

310
00:13:46,770 --> 00:13:51,959
CNA required everything is done with the

311
00:13:48,660 --> 00:13:55,319
are the back of box experience we are

312
00:13:51,959 --> 00:13:57,630
working on Section C 2 as well as Empire

313
00:13:55,320 --> 00:13:59,490
for the team server components to have

314
00:13:57,630 --> 00:14:02,760
that included as well we're working on

315
00:13:59,490 --> 00:14:04,529
that will be released somewhere in the

316
00:14:02,760 --> 00:14:07,650
next few months and you are encouraged

317
00:14:04,529 --> 00:14:09,150
to help us with this we're gaining one

318
00:14:07,650 --> 00:14:10,860
location for all the logs all the data

319
00:14:09,150 --> 00:14:12,150
every everything from the entire

320
00:14:10,860 --> 00:14:13,890
operation to once

321
00:14:12,150 --> 00:14:16,069
vacation and reducing have any rich

322
00:14:13,890 --> 00:14:20,550
friends talking about the video vectors

323
00:14:16,070 --> 00:14:24,120
we started with H a proxy as a proper

324
00:14:20,550 --> 00:14:25,829
tool we will be working on support for

325
00:14:24,120 --> 00:14:27,090
nginx and Apache there will be somewhere

326
00:14:25,830 --> 00:14:29,450
in the near future

327
00:14:27,090 --> 00:14:32,580
again you are encouraged to help us

328
00:14:29,450 --> 00:14:34,170
every depending on every reader vector

329
00:14:32,580 --> 00:14:36,120
the first proxy to which you will use

330
00:14:34,170 --> 00:14:37,740
you will need to adjust some type of

331
00:14:36,120 --> 00:14:42,000
logging bills and the basics they will

332
00:14:37,740 --> 00:14:44,040
never lock will never give you custom

333
00:14:42,000 --> 00:14:46,830
login is required to all the traffic

334
00:14:44,040 --> 00:14:51,569
traffic is locked and then we can give

335
00:14:46,830 --> 00:14:53,190
some Richman's with tour interest we

336
00:14:51,570 --> 00:14:57,750
know which door preferences are there

337
00:14:53,190 --> 00:15:00,150
and you can include it as well we know

338
00:14:57,750 --> 00:15:03,480
which IP addresses are of our own team

339
00:15:00,150 --> 00:15:06,750
as well from the blue team and we can

340
00:15:03,480 --> 00:15:08,760
tag those addresses within each stack to

341
00:15:06,750 --> 00:15:10,230
make smart decisions of course that's

342
00:15:08,760 --> 00:15:12,569
something you have to set before we

343
00:15:10,230 --> 00:15:14,370
start we'll find our own test labs or

344
00:15:12,570 --> 00:15:16,680
well tester own beacons for tester setup

345
00:15:14,370 --> 00:15:18,120
we'll put these in an IP listeners

346
00:15:16,680 --> 00:15:20,189
this is directing though the alarm of

347
00:15:18,120 --> 00:15:21,960
death is it's ourselves and we'll make a

348
00:15:20,190 --> 00:15:24,240
list as soon as we can off the first

349
00:15:21,960 --> 00:15:27,450
contact is there with the customer to

350
00:15:24,240 --> 00:15:28,890
gather the IPS they often use and yeah

351
00:15:27,450 --> 00:15:32,550
you might have someone working for all

352
00:15:28,890 --> 00:15:34,710
you know that idea but the base IDs they

353
00:15:32,550 --> 00:15:36,810
use you can also put in a text file

354
00:15:34,710 --> 00:15:40,290
saying okay this is what we expect to be

355
00:15:36,810 --> 00:15:42,260
the customer and all other IDs might be

356
00:15:40,290 --> 00:15:46,140
worth investigating

357
00:15:42,260 --> 00:15:46,530
ok graphical wise no rocket science here

358
00:15:46,140 --> 00:15:48,300
huh

359
00:15:46,530 --> 00:15:50,550
so it is data from the actual target

360
00:15:48,300 --> 00:15:52,680
there's data coming in from from non

361
00:15:50,550 --> 00:15:54,120
target IP addresses it's on the data

362
00:15:52,680 --> 00:15:54,750
vector you can make some smart routing

363
00:15:54,120 --> 00:15:56,400
over there

364
00:15:54,750 --> 00:16:00,180
either gate effects your vocals websites

365
00:15:56,400 --> 00:16:01,439
or whatever and maybe he defected some

366
00:16:00,180 --> 00:16:03,120
data back to you see teasers

367
00:16:01,440 --> 00:16:05,010
yeah and I think what's worth mentioning

368
00:16:03,120 --> 00:16:06,180
here is that a redirection but I think

369
00:16:05,010 --> 00:16:07,920
the picture is clear on that the

370
00:16:06,180 --> 00:16:08,930
redirector is more than just so-called

371
00:16:07,920 --> 00:16:11,420
it's more than just

372
00:16:08,930 --> 00:16:13,160
I'd be Dennis which force everything we

373
00:16:11,420 --> 00:16:16,790
try to make these redirects smart

374
00:16:13,160 --> 00:16:19,699
somehow and diverting notes into traffic

375
00:16:16,790 --> 00:16:21,860
so it will never end up on our team

376
00:16:19,699 --> 00:16:23,839
server and diverting that to a bogus

377
00:16:21,860 --> 00:16:29,269
website or to some other tool that we

378
00:16:23,839 --> 00:16:31,040
might use for some reason yeah so enter

379
00:16:29,269 --> 00:16:34,160
traffic Internet traffic and see to

380
00:16:31,040 --> 00:16:36,019
traffic will hit our infrastructure any

381
00:16:34,160 --> 00:16:38,540
any first proxy tool that we use will

382
00:16:36,019 --> 00:16:40,339
make use with send it to a specific

383
00:16:38,540 --> 00:16:42,589
destination and depending on the name

384
00:16:40,339 --> 00:16:45,800
educate for that destination you will

385
00:16:42,589 --> 00:16:48,050
see that back into Gretel important

386
00:16:45,800 --> 00:16:49,878
thing to note if you start using red elk

387
00:16:48,050 --> 00:16:51,859
you will need to do some configuration

388
00:16:49,879 --> 00:16:53,869
yourself the installer of Retta will not

389
00:16:51,860 --> 00:16:56,149
fix your thing first proxy for you

390
00:16:53,869 --> 00:17:00,379
there's a wiki it's not that hard but

391
00:16:56,149 --> 00:17:02,089
just be aware of that foul beats reach

392
00:17:00,379 --> 00:17:04,630
the locks for words at all to read out

393
00:17:02,089 --> 00:17:08,779
locks - receives it does some enrichment

394
00:17:04,630 --> 00:17:10,579
and stores its search and there's a few

395
00:17:08,779 --> 00:17:12,740
back-end processes going on every

396
00:17:10,579 --> 00:17:16,908
minutes extra enrichment is done on a

397
00:17:12,740 --> 00:17:19,579
data that be received for example

398
00:17:16,909 --> 00:17:21,770
tagging which specific IP address if it

399
00:17:19,579 --> 00:17:24,198
was from the red team or from the target

400
00:17:21,770 --> 00:17:25,908
or some other unknown extra for which

401
00:17:24,199 --> 00:17:27,649
asclepias is known we can take those

402
00:17:25,909 --> 00:17:30,080
things and make smart decisions with

403
00:17:27,648 --> 00:17:31,729
that with the data a fact every two

404
00:17:30,080 --> 00:17:33,860
minutes we sing a specific file from

405
00:17:31,730 --> 00:17:38,529
team server every five minutes there is

406
00:17:33,860 --> 00:17:38,529
a rule-based sim like from sanity

407
00:17:40,510 --> 00:17:51,408
because for transferring screenshots one

408
00:17:49,279 --> 00:17:53,450
reason for wanting this is that we I

409
00:17:51,409 --> 00:17:55,700
often have to manage all the team

410
00:17:53,450 --> 00:17:57,950
surface and I get multiple requests in

411
00:17:55,700 --> 00:17:59,539
team members they've taken SSH keys on

412
00:17:57,950 --> 00:18:01,010
the team server so they can queries

413
00:17:59,539 --> 00:18:03,169
through the log files at couple strike

414
00:18:01,010 --> 00:18:03,570
rights to this and so on and then they

415
00:18:03,169 --> 00:18:05,430
have to

416
00:18:03,570 --> 00:18:07,020
to find change and come back to me that

417
00:18:05,430 --> 00:18:10,500
they can't find the data and so on and

418
00:18:07,020 --> 00:18:16,980
so on so now it's all in one place we

419
00:18:10,500 --> 00:18:18,090
want to see everything so let's pray for

420
00:18:16,980 --> 00:18:22,680
the demo guards

421
00:18:18,090 --> 00:18:24,110
we've got our metal instance here and

422
00:18:22,680 --> 00:18:27,750
you will be welcomed with the normal

423
00:18:24,110 --> 00:18:30,290
Cabana interface let's just go to

424
00:18:27,750 --> 00:18:30,290
discover

425
00:18:34,520 --> 00:18:39,920
yep there it is so this is like a

426
00:18:36,880 --> 00:18:41,600
typical Cabana interface for the people

427
00:18:39,920 --> 00:18:42,980
not familiar with this I will walk you

428
00:18:41,600 --> 00:18:45,230
through it

429
00:18:42,980 --> 00:18:46,910
we're in the discovery this is the

430
00:18:45,230 --> 00:18:48,860
section where you can look at the raw

431
00:18:46,910 --> 00:18:50,120
data this is a search field where you

432
00:18:48,860 --> 00:18:52,340
can do some live searching in the data

433
00:18:50,120 --> 00:18:53,719
you can select on a top right so you can

434
00:18:52,340 --> 00:18:58,059
select a time period that you want to

435
00:18:53,720 --> 00:19:01,190
search in and there is a timestamp

436
00:18:58,059 --> 00:19:05,420
period indication where data will be

437
00:19:01,190 --> 00:19:08,960
received your below you will see your

438
00:19:05,420 --> 00:19:11,510
raw data okay I don't like this type of

439
00:19:08,960 --> 00:19:15,110
columns or there is no structure in that

440
00:19:11,510 --> 00:19:17,570
so we create a few views for you let's

441
00:19:15,110 --> 00:19:20,629
start with time on overview which will

442
00:19:17,570 --> 00:19:24,620
give you a view of the commands and

443
00:19:20,630 --> 00:19:27,170
actions taken by every cut team operator

444
00:19:24,620 --> 00:19:31,280
its parsing the coca stripe logs and

445
00:19:27,170 --> 00:19:33,890
giving you some information so I've got

446
00:19:31,280 --> 00:19:36,170
a timestamp a specific date or in a top

447
00:19:33,890 --> 00:19:39,380
scenario you will give these names

448
00:19:36,170 --> 00:19:41,600
yourself the specific username that this

449
00:19:39,380 --> 00:19:45,559
targets beacon was running on internal

450
00:19:41,600 --> 00:19:47,300
PHS on beacon Heidi the hostname rating

451
00:19:45,559 --> 00:19:49,370
system and the actual message of the log

452
00:19:47,300 --> 00:19:51,800
file you can remove things as you want

453
00:19:49,370 --> 00:19:55,360
and you can get you a bit more raw data

454
00:19:51,800 --> 00:19:59,450
in this this is default Cabana stuff

455
00:19:55,360 --> 00:20:04,639
messages are stored here so let's look

456
00:19:59,450 --> 00:20:08,090
at a dip different view I again I'm

457
00:20:04,640 --> 00:20:10,160
leaving out every join leave events new

458
00:20:08,090 --> 00:20:12,860
beacon events web block event etc I'm

459
00:20:10,160 --> 00:20:15,410
focusing for specific input commands and

460
00:20:12,860 --> 00:20:17,149
I'm focusing for a specific attack

461
00:20:15,410 --> 00:20:20,269
scenario because

462
00:20:17,149 --> 00:20:22,488
I'm engagements afterwards let's just

463
00:20:20,269 --> 00:20:23,749
say we want to give new team the proper

464
00:20:22,489 --> 00:20:26,149
information about a specific attack

465
00:20:23,749 --> 00:20:27,589
let's say we hit an SSH we tried to do

466
00:20:26,149 --> 00:20:29,869
as a sage connection to a specific

467
00:20:27,589 --> 00:20:31,759
system and when he gave that detailed

468
00:20:29,869 --> 00:20:32,959
information back to the team the data is

469
00:20:31,759 --> 00:20:34,669
in there or you need to do is live

470
00:20:32,960 --> 00:20:37,489
searching we know it was good in this

471
00:20:34,669 --> 00:20:39,649
attack name these are all the ones being

472
00:20:37,489 --> 00:20:43,999
parsed somewhere let's just search for

473
00:20:39,649 --> 00:20:46,070
SSH and introduce some parrying and here

474
00:20:43,999 --> 00:20:48,559
you will see that a specific operator at

475
00:20:46,070 --> 00:20:51,559
a specific time hit the SSH commands and

476
00:20:48,559 --> 00:20:53,779
a feature that I really like is that we

477
00:20:51,559 --> 00:20:55,849
created some hyperlinks to this and you

478
00:20:53,779 --> 00:20:57,889
can easily just get to full a beacon log

479
00:20:55,849 --> 00:21:03,109
of the specific operation and you can

480
00:20:57,889 --> 00:21:04,998
use normal of the chat or searching and

481
00:21:03,109 --> 00:21:06,499
winning the browser all the data is one

482
00:21:04,999 --> 00:21:09,619
central location it will give you

483
00:21:06,499 --> 00:21:11,269
overview if you're in the blue team go

484
00:21:09,619 --> 00:21:13,519
and ask for one if you're ready members

485
00:21:11,269 --> 00:21:16,070
to to send you all the commands for user

486
00:21:13,519 --> 00:21:18,710
excellent system boy I'll tell you

487
00:21:16,070 --> 00:21:20,210
they'll start sweating we had a similar

488
00:21:18,710 --> 00:21:21,889
thing with an overview of all the

489
00:21:20,210 --> 00:21:23,599
indicators compromised at the end you

490
00:21:21,889 --> 00:21:25,748
might want to give the build team an

491
00:21:23,599 --> 00:21:29,029
overview of all the icy sticky this

492
00:21:25,749 --> 00:21:30,919
simple click this is the overview it

493
00:21:29,029 --> 00:21:32,719
will list everything that's generated by

494
00:21:30,919 --> 00:21:35,570
Corbett strikes every file uploaded

495
00:21:32,719 --> 00:21:39,409
every file created and here of course

496
00:21:35,570 --> 00:21:43,489
you can share an easy to get your CSV

497
00:21:39,409 --> 00:21:48,399
report does it just keep default Obama

498
00:21:43,489 --> 00:21:53,089
stuff to generate a CSV file for you

499
00:21:48,399 --> 00:21:55,189
which you can download we really tend to

500
00:21:53,089 --> 00:21:57,529
put all our IOC's in here so even if we

501
00:21:55,190 --> 00:22:00,529
send out a phishing bill which we attach

502
00:21:57,529 --> 00:22:02,330
or HTML smuggle the word documents we

503
00:22:00,529 --> 00:22:04,159
want the blood that same document to 104

504
00:22:02,330 --> 00:22:05,749
test beacons just to make sure that it's

505
00:22:04,159 --> 00:22:07,339
in here because this system is

506
00:22:05,749 --> 00:22:08,960
monitoring virustotal and all the others

507
00:22:07,339 --> 00:22:12,649
so even if not the blue team with the

508
00:22:08,960 --> 00:22:14,340
user decides on behind sighs distorting

509
00:22:12,649 --> 00:22:16,409
was a bit odd that's it

510
00:22:14,340 --> 00:22:18,899
that at least at least we did in the

511
00:22:16,410 --> 00:22:20,910
world sort of so someone at the client

512
00:22:18,900 --> 00:22:22,980
decided to upload their documents and we

513
00:22:20,910 --> 00:22:25,800
might decide to clean up the persistency

514
00:22:22,980 --> 00:22:27,300
we had on that users desktop or build

515
00:22:25,800 --> 00:22:29,909
with other opposition see somewhere else

516
00:22:27,300 --> 00:22:32,550
at least it gives us to be thankful for

517
00:22:29,910 --> 00:22:34,080
all of our scenario to decide what we

518
00:22:32,550 --> 00:22:35,960
wanted how we want to engage with the

519
00:22:34,080 --> 00:22:38,040
blue team and train them to be better

520
00:22:35,960 --> 00:22:40,980
yep exactly

521
00:22:38,040 --> 00:22:43,470
so simple IOC overview same goes for

522
00:22:40,980 --> 00:22:45,600
keystrokes when I'm in a long operation

523
00:22:43,470 --> 00:22:47,700
I don't remember that specific system

524
00:22:45,600 --> 00:22:49,469
where we had that specific key long so I

525
00:22:47,700 --> 00:22:51,900
build one login to a specific team

526
00:22:49,470 --> 00:22:53,010
server to go to query through the key

527
00:22:51,900 --> 00:22:55,200
locks I want to have one central

528
00:22:53,010 --> 00:22:56,760
location same goes here it's big list

529
00:22:55,200 --> 00:23:03,200
and you can click again on the link to

530
00:22:56,760 --> 00:23:06,210
get the full text based screenshots

531
00:23:03,200 --> 00:23:08,190
simple overview I do remember that

532
00:23:06,210 --> 00:23:10,320
specific screenshot that I saw some

533
00:23:08,190 --> 00:23:12,840
weeks ago during the operation which had

534
00:23:10,320 --> 00:23:15,530
that very important application honors I

535
00:23:12,840 --> 00:23:17,939
can quickly browse through this list and

536
00:23:15,530 --> 00:23:23,100
on this case actually catch some

537
00:23:17,940 --> 00:23:27,720
antivirus a box of cookies again linked

538
00:23:23,100 --> 00:23:30,270
to the because P shot okay so that's all

539
00:23:27,720 --> 00:23:32,430
on the operations yep we make a lot of

540
00:23:30,270 --> 00:23:34,200
screenshots during operation because as

541
00:23:32,430 --> 00:23:36,210
we see feel ready even more Lisa's

542
00:23:34,200 --> 00:23:37,350
scenario BK plus usually has an out

543
00:23:36,210 --> 00:23:39,900
phase as well you want to reach

544
00:23:37,350 --> 00:23:42,270
something to a certain goal for most of

545
00:23:39,900 --> 00:23:44,100
our active operations being domain admin

546
00:23:42,270 --> 00:23:46,050
is in the end it's basically the start

547
00:23:44,100 --> 00:23:47,760
off of actually getting to the business

548
00:23:46,050 --> 00:23:49,430
crown jewels that's how you also involve

549
00:23:47,760 --> 00:23:51,960
the business in an exercise like this

550
00:23:49,430 --> 00:23:53,640
which means that sometimes for days or

551
00:23:51,960 --> 00:23:55,740
even weeks we might wanna have two key

552
00:23:53,640 --> 00:23:58,350
log and screenshot users in order to

553
00:23:55,740 --> 00:24:00,000
learn how they how they work or the

554
00:23:58,350 --> 00:24:02,280
later operation operation is we don't

555
00:24:00,000 --> 00:24:03,870
know all the business and stuff on the

556
00:24:02,280 --> 00:24:05,820
application so we have to learn from the

557
00:24:03,870 --> 00:24:08,550
users and the daily procedures and how

558
00:24:05,820 --> 00:24:10,290
to get to what we consider our goal and

559
00:24:08,550 --> 00:24:12,540
we'll do that through screenshots and

560
00:24:10,290 --> 00:24:13,149
that's why it's available to us to have

561
00:24:12,540 --> 00:24:17,559
it at all

562
00:24:13,149 --> 00:24:19,658
location so what I just show you was all

563
00:24:17,559 --> 00:24:22,059
about operations during the red teaming

564
00:24:19,659 --> 00:24:24,009
as in commands typed by the operators so

565
00:24:22,059 --> 00:24:28,749
let's take a quick talk about specific

566
00:24:24,009 --> 00:24:31,479
data requests that came back to me that

567
00:24:28,749 --> 00:24:35,139
touched our infrastructure so we got a

568
00:24:31,479 --> 00:24:37,719
different view which is on the detector

569
00:24:35,139 --> 00:24:41,349
traffic it will give you the same type

570
00:24:37,719 --> 00:24:44,499
of columns scenario the destination that

571
00:24:41,349 --> 00:24:46,089
the reverse proxy actually chose which

572
00:24:44,499 --> 00:24:47,259
could be your decoy or the Cobra strike

573
00:24:46,089 --> 00:24:49,690
or this is the name that you give it

574
00:24:47,259 --> 00:24:52,179
yourself an adult summer enrichment on

575
00:24:49,690 --> 00:24:53,739
source IP addresses when geoip tagging

576
00:24:52,179 --> 00:24:56,349
and it will give beautiful requests to

577
00:24:53,739 --> 00:24:58,239
stuff like that enrichment is also done

578
00:24:56,349 --> 00:25:00,489
with the text so you will see here that

579
00:24:58,239 --> 00:25:01,809
there's an IP list for red team and I

580
00:25:00,489 --> 00:25:03,190
Peters for the customer if you would

581
00:25:01,809 --> 00:25:05,168
define these within the conflicts

582
00:25:03,190 --> 00:25:08,649
tagging will be done automatically you

583
00:25:05,169 --> 00:25:15,219
can quickly just select for every

584
00:25:08,649 --> 00:25:18,070
specific customer requests ok I've got a

585
00:25:15,219 --> 00:25:24,429
few more examples simply searching for

586
00:25:18,070 --> 00:25:26,739
non antivirus systems or systems it's as

587
00:25:24,429 --> 00:25:29,379
easy as this this you will get all the

588
00:25:26,739 --> 00:25:30,879
information from where antivirus systems

589
00:25:29,379 --> 00:25:35,529
are doing live interaction with your

590
00:25:30,879 --> 00:25:36,998
infrastructure this is I've got a few

591
00:25:35,529 --> 00:25:43,799
examples but we're running low on time

592
00:25:36,999 --> 00:25:47,549
so let's go back to presentation so

593
00:25:43,799 --> 00:25:47,549
backup things for

594
00:25:47,640 --> 00:25:53,250
yeah

595
00:25:50,120 --> 00:25:56,459
this is the interface of Symantec EDR

596
00:25:53,250 --> 00:25:59,640
their next generation EDR solution and

597
00:25:56,460 --> 00:26:02,720
why did I pick this pre shut well look

598
00:25:59,640 --> 00:26:05,610
at the two arrows below they're too easy

599
00:26:02,720 --> 00:26:07,650
clickable things for the operator one is

600
00:26:05,610 --> 00:26:10,110
submitted sandbox which is semantics own

601
00:26:07,650 --> 00:26:10,740
specific sandbox and their submit to

602
00:26:10,110 --> 00:26:13,379
virustotal

603
00:26:10,740 --> 00:26:17,070
it's made easy for the blue team to

604
00:26:13,380 --> 00:26:18,780
upload stuff to online life analysis

605
00:26:17,070 --> 00:26:20,399
blue team or the customer in general

606
00:26:18,780 --> 00:26:22,440
often if you speak to blue teams they

607
00:26:20,400 --> 00:26:24,870
would say we would never upload anything

608
00:26:22,440 --> 00:26:28,430
to normalise surface but we yet have to

609
00:26:24,870 --> 00:26:31,649
find the first customer when we didn't

610
00:26:28,430 --> 00:26:36,960
this is nowadays is called Microsoft

611
00:26:31,650 --> 00:26:38,670
Defender ATP again to speed shots two

612
00:26:36,960 --> 00:26:41,280
buttons one is that actually it already

613
00:26:38,670 --> 00:26:43,200
doesn't a check with online virustotal

614
00:26:41,280 --> 00:26:45,389
and the second one is if you want to

615
00:26:43,200 --> 00:26:48,990
submit it for deep analysis at the

616
00:26:45,390 --> 00:26:51,210
Microsoft analysis cloud thingy funny

617
00:26:48,990 --> 00:26:52,710
thing is that because we're getting the

618
00:26:51,210 --> 00:26:54,840
beacons back or at least because we're

619
00:26:52,710 --> 00:26:57,780
analyzing the data we can see which

620
00:26:54,840 --> 00:27:04,320
specific systems are being getting the

621
00:26:57,780 --> 00:27:05,040
beacon better the amount of these are

622
00:27:04,320 --> 00:27:07,850
system names

623
00:27:05,040 --> 00:27:12,570
Edmond PC John PC stuff like that

624
00:27:07,850 --> 00:27:15,270
compared to the different scenario it's

625
00:27:12,570 --> 00:27:16,950
pretty awful send boxes will stand out

626
00:27:15,270 --> 00:27:20,040
these do not look like your average

627
00:27:16,950 --> 00:27:22,440
target a computer name it's the clear

628
00:27:20,040 --> 00:27:24,270
indicator but basically this data you

629
00:27:22,440 --> 00:27:26,130
could give the food presentation on what

630
00:27:24,270 --> 00:27:28,110
we see is if you post something to our

631
00:27:26,130 --> 00:27:30,120
sandbox you will likely see that sandbox

632
00:27:28,110 --> 00:27:32,010
call back to you and then half an hour

633
00:27:30,120 --> 00:27:33,449
later two other sandbox is pop-up where

634
00:27:32,010 --> 00:27:35,370
you never submitted yourself costly

635
00:27:33,450 --> 00:27:37,860
sharing data and let's go go over a few

636
00:27:35,370 --> 00:27:39,330
hours and then it will be quiet and if

637
00:27:37,860 --> 00:27:41,669
your mower

638
00:27:39,330 --> 00:27:42,820
did evil stuff then the next morning or

639
00:27:41,670 --> 00:27:45,190
a few hours later you

640
00:27:42,820 --> 00:27:47,110
a huge wave of investigators and send

641
00:27:45,190 --> 00:27:49,870
boxes flowing all of you apparently

642
00:27:47,110 --> 00:27:51,550
people that buy all samples that go into

643
00:27:49,870 --> 00:27:53,800
these hand boxes and trying to reanalyze

644
00:27:51,550 --> 00:27:56,379
in themselves and you'll have a huge

645
00:27:53,800 --> 00:27:58,270
wave of incoming connections you've also

646
00:27:56,380 --> 00:27:59,470
see interesting things like I don't know

647
00:27:58,270 --> 00:28:01,389
if there's anybody from trust wave

648
00:27:59,470 --> 00:28:04,000
within the audience but if there is I

649
00:28:01,390 --> 00:28:08,950
don't have to talk with you because we

650
00:28:04,000 --> 00:28:10,570
always see traffic from trust wave with

651
00:28:08,950 --> 00:28:12,340
multiple different IP address at the

652
00:28:10,570 --> 00:28:16,600
same time trying to reach a different

653
00:28:12,340 --> 00:28:18,699
type of Google hell's a URLs uppercase

654
00:28:16,600 --> 00:28:19,840
lowercase everything but always requests

655
00:28:18,700 --> 00:28:21,940
at the same time from different IP

656
00:28:19,840 --> 00:28:23,139
addresses I wonder what's going on so if

657
00:28:21,940 --> 00:28:25,660
there's somebody from Trustwave please

658
00:28:23,140 --> 00:28:28,780
catch you later on the presentation we

659
00:28:25,660 --> 00:28:31,030
can do some user agents checking all the

660
00:28:28,780 --> 00:28:32,860
data is here I'm gonna go quickly

661
00:28:31,030 --> 00:28:35,320
through knees these are instruments in

662
00:28:32,860 --> 00:28:37,090
previews things it's no new research but

663
00:28:35,320 --> 00:28:40,179
because we have the data you can quickly

664
00:28:37,090 --> 00:28:45,399
see how the previews are generated in

665
00:28:40,180 --> 00:28:48,340
this case bar you need to read this from

666
00:28:45,400 --> 00:28:49,570
bottom to top so this is life types and

667
00:28:48,340 --> 00:28:52,209
it's building up the URL that were

668
00:28:49,570 --> 00:28:54,850
tested here so there's many more

669
00:28:52,210 --> 00:28:57,760
resources at this specific link and

670
00:28:54,850 --> 00:29:00,520
other red team operators are interested

671
00:28:57,760 --> 00:29:02,740
in public IP addresses of known domain

672
00:29:00,520 --> 00:29:04,060
classifiers as well so this was a

673
00:29:02,740 --> 00:29:06,450
discussion that I had with one of the

674
00:29:04,060 --> 00:29:08,860
operational first but drops coming

675
00:29:06,450 --> 00:29:13,300
because we have such data we can easily

676
00:29:08,860 --> 00:29:15,939
go through and get this Intel to us then

677
00:29:13,300 --> 00:29:18,100
we have the catch of the day if we get

678
00:29:15,940 --> 00:29:19,480
caught by surprise sometimes and when I

679
00:29:18,100 --> 00:29:21,879
was asked by one of my colleagues to

680
00:29:19,480 --> 00:29:23,410
spin up a new in frustration with Neary

681
00:29:21,880 --> 00:29:25,720
directors for one of the ongoing

682
00:29:23,410 --> 00:29:28,180
assignments we found this I just spin up

683
00:29:25,720 --> 00:29:30,490
this freshly director linked it into our

684
00:29:28,180 --> 00:29:33,120
system and then we suddenly get all

685
00:29:30,490 --> 00:29:34,590
kinds of calls from phones to

686
00:29:33,120 --> 00:29:36,870
whatever it is they all came from where

687
00:29:34,590 --> 00:29:39,149
it I've got no clue what I what I P

688
00:29:36,870 --> 00:29:41,489
address digitalocean assigned to us in

689
00:29:39,150 --> 00:29:43,830
this case but this went on for hours and

690
00:29:41,490 --> 00:29:46,680
actually it's just contained it's still

691
00:29:43,830 --> 00:29:48,210
it's still ready we decided to scoot

692
00:29:46,680 --> 00:29:49,559
this idea as out of the engagement

693
00:29:48,210 --> 00:29:52,110
because it could film a database may be

694
00:29:49,559 --> 00:29:54,090
fast but I've got no clue what I'm

695
00:29:52,110 --> 00:29:55,830
looking at here I've got some recaps if

696
00:29:54,090 --> 00:29:58,770
anyone's interested in diving into this

697
00:29:55,830 --> 00:30:00,030
stuff or if anyone has a clue catch me

698
00:29:58,770 --> 00:30:02,010
later on on the conference and we'll

699
00:30:00,030 --> 00:30:04,260
have a chat about it I decided to park

700
00:30:02,010 --> 00:30:06,510
it for a while and continue our daily

701
00:30:04,260 --> 00:30:08,280
operation but now we have these insights

702
00:30:06,510 --> 00:30:08,790
we get these kind of surprises they

703
00:30:08,280 --> 00:30:14,790
ignore me

704
00:30:08,790 --> 00:30:18,450
my buddy will see okay so one more thing

705
00:30:14,790 --> 00:30:20,879
I wanna point touch on is we look at

706
00:30:18,450 --> 00:30:22,860
data on the external infrastructure but

707
00:30:20,880 --> 00:30:26,910
we can do the same thing on the internal

708
00:30:22,860 --> 00:30:28,399
side can we see actions by the booty on

709
00:30:26,910 --> 00:30:30,630
the internal side once we've been

710
00:30:28,400 --> 00:30:33,870
detected one of the things is for

711
00:30:30,630 --> 00:30:37,770
example change of the krbtgt password

712
00:30:33,870 --> 00:30:39,600
date if you come into clients and we see

713
00:30:37,770 --> 00:30:41,190
that the last time the Festivus change

714
00:30:39,600 --> 00:30:43,830
was many many many years ago we journey

715
00:30:41,190 --> 00:30:45,980
up all of a sudden the best what is

716
00:30:43,830 --> 00:30:48,139
changed well something fishy's going on

717
00:30:45,980 --> 00:30:51,780
there many more things that we can do

718
00:30:48,140 --> 00:30:53,250
quick overview you've got the data with

719
00:30:51,780 --> 00:30:54,629
retic you can do this much care of

720
00:30:53,250 --> 00:30:57,390
yourself and many interesting things

721
00:30:54,630 --> 00:30:59,970
that you can do we are working on more

722
00:30:57,390 --> 00:31:02,640
automatic alarms but it's not up to the

723
00:30:59,970 --> 00:31:05,370
level that we are it works for us right

724
00:31:02,640 --> 00:31:07,170
now but we will be improving so two

725
00:31:05,370 --> 00:31:09,239
major alarms that we've got right now is

726
00:31:07,170 --> 00:31:11,400
an IOC of ourselves

727
00:31:09,240 --> 00:31:12,990
seen as one of the public security

728
00:31:11,400 --> 00:31:16,550
service providers virustotal

729
00:31:12,990 --> 00:31:18,920
again expose our bid analysis and you

730
00:31:16,550 --> 00:31:20,930
when the diocese found as well as an

731
00:31:18,920 --> 00:31:23,750
unknown appeared dress hitting ROC -

732
00:31:20,930 --> 00:31:26,590
which is not attacked by one of the

733
00:31:23,750 --> 00:31:28,820
great nor'easter things as being a

734
00:31:26,590 --> 00:31:33,740
typical web scandal like background

735
00:31:28,820 --> 00:31:34,939
noise at the Internet's okay if you want

736
00:31:33,740 --> 00:31:38,050
to get in touch and help him out this

737
00:31:34,940 --> 00:31:41,090
project please please get in touch

738
00:31:38,050 --> 00:31:43,159
what we see is so far from Rydell it's

739
00:31:41,090 --> 00:31:45,110
still somewhat passive though and we do

740
00:31:43,160 --> 00:31:47,000
get all the affiliate ever'one database

741
00:31:45,110 --> 00:31:49,219
and we can manually grab through that

742
00:31:47,000 --> 00:31:52,250
but we felt the need also to be able to

743
00:31:49,220 --> 00:31:54,830
interact live when something happens and

744
00:31:52,250 --> 00:31:57,440
we want to we want to stay in control of

745
00:31:54,830 --> 00:31:59,929
our operation to act as a proper trailer

746
00:31:57,440 --> 00:32:02,900
for for a customer for the blue team and

747
00:31:59,930 --> 00:32:04,550
the organization behind it or wait so in

748
00:32:02,900 --> 00:32:06,650
order to stay in control we need to move

749
00:32:04,550 --> 00:32:09,980
faster or easier to be able to hold life

750
00:32:06,650 --> 00:32:12,380
to what what's happening one of the

751
00:32:09,980 --> 00:32:12,830
things we do just a glance and how we

752
00:32:12,380 --> 00:32:15,110
operate

753
00:32:12,830 --> 00:32:18,740
we never tend to work with confide

754
00:32:15,110 --> 00:32:23,120
staging we make our own staging and we

755
00:32:18,740 --> 00:32:25,220
never tend to work with status items on

756
00:32:23,120 --> 00:32:27,050
this so we don't want our full States

757
00:32:25,220 --> 00:32:29,240
already there because if it's there we

758
00:32:27,050 --> 00:32:33,409
can't control it anymore we tend to find

759
00:32:29,240 --> 00:32:35,630
so away for our initial vector to down

760
00:32:33,410 --> 00:32:37,510
or the initial vector and/or persistency

761
00:32:35,630 --> 00:32:39,860
to download the full station instability

762
00:32:37,510 --> 00:32:45,140
usually for example host text file

763
00:32:39,860 --> 00:32:46,939
somewhere as easy as and then we have

764
00:32:45,140 --> 00:32:48,800
usually have a Boston virus if we have

765
00:32:46,940 --> 00:32:50,630
persistence in words we'll have both of

766
00:32:48,800 --> 00:32:52,639
a wide way into another process that

767
00:32:50,630 --> 00:32:54,710
will live longer than words because the

768
00:32:52,640 --> 00:32:57,980
user might feel good after a few minutes

769
00:32:54,710 --> 00:32:59,420
and if you can dive into some tray icon

770
00:32:57,980 --> 00:33:04,700
you can live for the rest of the day of

771
00:32:59,420 --> 00:33:08,930
day so what we introduced was read file

772
00:33:04,700 --> 00:33:11,600
it's basically a very simple Python tool

773
00:33:08,930 --> 00:33:14,420
that lives in your web server that can

774
00:33:11,600 --> 00:33:16,750
help you serving files the way you need

775
00:33:14,420 --> 00:33:19,540
them to be served

776
00:33:16,750 --> 00:33:22,080
to some some examples on that but

777
00:33:19,540 --> 00:33:25,780
basically every faulty request is built

778
00:33:22,080 --> 00:33:27,909
life and you can code however you want

779
00:33:25,780 --> 00:33:29,350
that you can do it at eBay store you can

780
00:33:27,910 --> 00:33:31,870
have a lot of rules in there

781
00:33:29,350 --> 00:33:33,639
hey yes you can always whiteness on IP

782
00:33:31,870 --> 00:33:35,020
if you want something like so I'd be

783
00:33:33,640 --> 00:33:37,690
restrictive but you might want to be

784
00:33:35,020 --> 00:33:40,090
able to react on user agent and serve a

785
00:33:37,690 --> 00:33:41,800
different content for certain user

786
00:33:40,090 --> 00:33:44,649
agents you might want to be able to

787
00:33:41,800 --> 00:33:46,600
react on the time of the day that the

788
00:33:44,650 --> 00:33:48,340
amount of calls you get if a certain

789
00:33:46,600 --> 00:33:51,820
person is hit before the payload is

790
00:33:48,340 --> 00:33:53,439
called and so on or basically I was

791
00:33:51,820 --> 00:33:55,419
building a lot of these tools separately

792
00:33:53,440 --> 00:33:57,040
and decided it had to be easier so I

793
00:33:55,420 --> 00:33:59,080
built something that works with modules

794
00:33:57,040 --> 00:34:00,820
you can just have despite a shell

795
00:33:59,080 --> 00:34:02,730
running or despite this philosophy of

796
00:34:00,820 --> 00:34:05,350
running and this is a working code

797
00:34:02,730 --> 00:34:07,390
basically twelve lines of effective code

798
00:34:05,350 --> 00:34:10,719
that will serve something based on

799
00:34:07,390 --> 00:34:13,389
basically huge ratings so we can observe

800
00:34:10,719 --> 00:34:16,810
whatever we want to serve and I'm gonna

801
00:34:13,389 --> 00:34:20,260
walk you through two examples of how we

802
00:34:16,810 --> 00:34:23,469
do that I think this is the first one we

803
00:34:20,260 --> 00:34:26,679
that we saw but another engagement where

804
00:34:23,469 --> 00:34:28,810
we see customer are hitting we see a

805
00:34:26,679 --> 00:34:31,690
protecting our bailout and then it

806
00:34:28,810 --> 00:34:33,399
really is race it comes along we want to

807
00:34:31,690 --> 00:34:35,710
divert the spot see somewhere else

808
00:34:33,399 --> 00:34:37,600
so at least at the investigation doesn't

809
00:34:35,710 --> 00:34:40,389
see something evil is going on and we

810
00:34:37,600 --> 00:34:42,810
want the usual of course you get a

811
00:34:40,389 --> 00:34:42,810
little pale

812
00:34:45,639 --> 00:34:53,389
yeah so that's got to be this one here

813
00:34:51,739 --> 00:34:55,429
we have the default baler that you'll

814
00:34:53,389 --> 00:34:57,799
see if you come from a random IP so an

815
00:34:55,429 --> 00:35:01,310
IP that has not been that that is not

816
00:34:57,800 --> 00:35:04,460
known better after I click this this

817
00:35:01,310 --> 00:35:06,470
what this will I get served if I could

818
00:35:04,460 --> 00:35:08,510
defeat the end off now I'm just opening

819
00:35:06,470 --> 00:35:11,899
our own web environment so it's a

820
00:35:08,510 --> 00:35:13,190
whitelist IP and I will get the bailout

821
00:35:11,900 --> 00:35:15,980
that I'm really want to serve for the

822
00:35:13,190 --> 00:35:17,570
customer of course if I'd be like this

823
00:35:15,980 --> 00:35:19,250
you can build a web server it's just a

824
00:35:17,570 --> 00:35:23,530
concept it's really easy to build this

825
00:35:19,250 --> 00:35:25,970
diversity file might be all on any other

826
00:35:23,530 --> 00:35:34,930
any other thing you want to dive right

827
00:35:25,970 --> 00:35:34,930
on another one we have here

828
00:35:43,859 --> 00:35:48,100
what we saw add another custom race we

829
00:35:46,390 --> 00:35:51,009
have persistence in Word Microsoft Word

830
00:35:48,100 --> 00:35:52,779
and this customer attends this specific

831
00:35:51,010 --> 00:35:54,760
and persistency this dye intended to

832
00:35:52,780 --> 00:35:57,070
select a lot of documents on his desktop

833
00:35:54,760 --> 00:35:59,470
and open all at the same time so we

834
00:35:57,070 --> 00:35:59,920
would see a lot of beacons in a few

835
00:35:59,470 --> 00:36:02,470
minutes

836
00:35:59,920 --> 00:36:04,930
but as we have after migration on in

837
00:36:02,470 --> 00:36:06,879
this case we would migrate 18 times to

838
00:36:04,930 --> 00:36:09,310
our process we want to live it for today

839
00:36:06,880 --> 00:36:11,290
or she can imagine that's not something

840
00:36:09,310 --> 00:36:15,160
that's useful for us so what did we

841
00:36:11,290 --> 00:36:17,380
build we built same little module that

842
00:36:15,160 --> 00:36:19,540
will serve content only once in 30

843
00:36:17,380 --> 00:36:21,850
seconds so it will serve the content if

844
00:36:19,540 --> 00:36:22,750
you hit a 5 it will not serve you

845
00:36:21,850 --> 00:36:25,118
anything at all

846
00:36:22,750 --> 00:36:27,220
until 30 seconds later just just another

847
00:36:25,119 --> 00:36:31,570
simple way of controlling when and how

848
00:36:27,220 --> 00:36:33,520
we serve content to our victim and again

849
00:36:31,570 --> 00:36:35,380
the code it's just it's a one patient

850
00:36:33,520 --> 00:36:37,660
it's this might not be 12 or 20 lines

851
00:36:35,380 --> 00:36:40,660
but that's divided well that's just how

852
00:36:37,660 --> 00:36:42,430
we ease of operation but then once we've

853
00:36:40,660 --> 00:36:44,649
built this we can also use it to decoy

854
00:36:42,430 --> 00:36:48,100
we can use it to see if we can serve a

855
00:36:44,650 --> 00:36:52,900
real payload to our victim and another

856
00:36:48,100 --> 00:36:55,270
payload to the blue team well let's give

857
00:36:52,900 --> 00:37:02,800
that a try now I've built a payload

858
00:36:55,270 --> 00:37:03,970
that's goes that goes by key so I'm

859
00:37:02,800 --> 00:37:06,190
going to click this link this is the

860
00:37:03,970 --> 00:37:08,589
link this one I paid off with a key in

861
00:37:06,190 --> 00:37:11,680
it and the first click might be for the

862
00:37:08,590 --> 00:37:13,930
proxy we all see get a robots.txt here

863
00:37:11,680 --> 00:37:16,419
so this your rather theory gives you

864
00:37:13,930 --> 00:37:18,430
your robots.txt if you're not quite

865
00:37:16,420 --> 00:37:20,770
press refresh as this might be the

866
00:37:18,430 --> 00:37:23,618
second call after the process when this

867
00:37:20,770 --> 00:37:28,780
thing will now have a default called

868
00:37:23,619 --> 00:37:30,280
strike a PowerShell macro interesting so

869
00:37:28,780 --> 00:37:33,340
stop find some infection and they'll

870
00:37:30,280 --> 00:37:36,910
start researching 2-0 once they look up

871
00:37:33,340 --> 00:37:38,530
to your realm they also get some

872
00:37:36,910 --> 00:37:40,299
PowerShell but there seems to be a big

873
00:37:38,530 --> 00:37:42,520
point Stephen is that any threat a bit

874
00:37:40,300 --> 00:37:43,670
coastal it's it's annoying turn all that

875
00:37:42,520 --> 00:37:45,710
around organization

876
00:37:43,670 --> 00:37:48,020
for bitcoins but unless you're a Bitcoin

877
00:37:45,710 --> 00:37:50,599
exchange this is likely not going to put

878
00:37:48,020 --> 00:37:52,009
a high road over you but nevertheless

879
00:37:50,599 --> 00:37:54,410
it's weird that the different comes in

880
00:37:52,010 --> 00:37:55,910
so you shared a colleague he also looks

881
00:37:54,410 --> 00:37:59,078
at it she adds it's a bit car stealer

882
00:37:55,910 --> 00:38:01,670
it's odd but how do we get this into our

883
00:37:59,079 --> 00:38:04,190
endpoints why didn't we see this before

884
00:38:01,670 --> 00:38:06,230
maybe we should gather the team and have

885
00:38:04,190 --> 00:38:07,760
a look at it together so they get to the

886
00:38:06,230 --> 00:38:12,260
team put it on Beamer and then request

887
00:38:07,760 --> 00:38:13,819
here out again but this is lab don't see

888
00:38:12,260 --> 00:38:15,380
basically what I'm trying to show you

889
00:38:13,819 --> 00:38:21,470
here that it's really easy to have one

890
00:38:15,380 --> 00:38:23,270
URL and change it I should go for us

891
00:38:21,470 --> 00:38:25,250
it's two months really convenient to

892
00:38:23,270 --> 00:38:27,020
work alongside right out so right out we

893
00:38:25,250 --> 00:38:29,960
have passive information to gather data

894
00:38:27,020 --> 00:38:31,520
and decide how we want to react but then

895
00:38:29,960 --> 00:38:34,190
we have read file which we can really

896
00:38:31,520 --> 00:38:37,190
easy program to react how we want it and

897
00:38:34,190 --> 00:38:40,099
the way we want it and we can decide

898
00:38:37,190 --> 00:38:42,230
what we want to teach booty and we might

899
00:38:40,099 --> 00:38:44,569
be pushing them by decoying them we

900
00:38:42,230 --> 00:38:45,260
might choose not to depending on where

901
00:38:44,569 --> 00:38:47,599
they stand

902
00:38:45,260 --> 00:38:51,490
what we all decided on foreheads what

903
00:38:47,599 --> 00:38:55,430
whatevs to learn additional is operation

904
00:38:51,490 --> 00:38:57,439
so basically we think red teaming should

905
00:38:55,430 --> 00:38:59,868
be there to make blue team's better that

906
00:38:57,440 --> 00:39:03,230
should be a training game and not an ego

907
00:38:59,869 --> 00:39:07,430
based win-win situation not red against

908
00:39:03,230 --> 00:39:11,119
blue red father red can be can be of

909
00:39:07,430 --> 00:39:12,980
great help to red teamers to make proper

910
00:39:11,119 --> 00:39:15,309
reports and all the data in one place

911
00:39:12,980 --> 00:39:18,230
and also to roll a better scenario and

912
00:39:15,309 --> 00:39:20,980
then please blue think of you're upset

913
00:39:18,230 --> 00:39:23,980
we always get alarms somewhere

914
00:39:20,980 --> 00:39:23,980
Thanks

915
00:39:27,520 --> 00:39:29,580
you

