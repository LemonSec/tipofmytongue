1
00:00:08,189 --> 00:00:15,639
thank you thank you all right all right

2
00:00:13,210 --> 00:00:17,349
thank you very much yes so that's here I

3
00:00:15,639 --> 00:00:19,300
came here to talk about a couple of

4
00:00:17,349 --> 00:00:21,070
things about graphene and just analytics

5
00:00:19,300 --> 00:00:22,240
but then you know when I came back I

6
00:00:21,070 --> 00:00:24,250
started thinking about all the other

7
00:00:22,240 --> 00:00:26,439
things that are beneficial before even

8
00:00:24,250 --> 00:00:28,539
going forward for you know talking about

9
00:00:26,439 --> 00:00:30,279
analytics is to understand your data so

10
00:00:28,539 --> 00:00:33,220
today we're gonna be talking about data

11
00:00:30,279 --> 00:00:34,360
and also it might attack framework so

12
00:00:33,220 --> 00:00:36,100
you guys already heard from me

13
00:00:34,360 --> 00:00:38,019
so if you go to that you know link at

14
00:00:36,100 --> 00:00:39,549
the bottom it's pretty much my github if

15
00:00:38,019 --> 00:00:41,320
you want to talk about a few projects

16
00:00:39,549 --> 00:00:43,360
with me I would love to do that because

17
00:00:41,320 --> 00:00:46,239
I like to talk about you know helping

18
00:00:43,360 --> 00:00:47,680
all these things so and I'm also a

19
00:00:46,239 --> 00:00:49,839
former capital once in your thread

20
00:00:47,680 --> 00:00:51,879
hunter in Virginia and there is what I

21
00:00:49,839 --> 00:00:53,739
started also working with a lot of I

22
00:00:51,879 --> 00:00:56,110
would say data like more than you know

23
00:00:53,739 --> 00:00:57,549
300,000 endpoints and you know then

24
00:00:56,110 --> 00:00:59,140
including the cloud so I think that

25
00:00:57,549 --> 00:01:01,239
wasn't like an awesome experience to

26
00:00:59,140 --> 00:01:03,159
know exactly you know how it goes from

27
00:01:01,239 --> 00:01:04,920
ten thousand two thousand endpoints all

28
00:01:03,159 --> 00:01:08,110
the way to a massive amount of data

29
00:01:04,920 --> 00:01:10,570
hi everyone my name is Jose I call by

30
00:01:08,110 --> 00:01:12,100
cyber panda in Twitter I'm currently a

31
00:01:10,570 --> 00:01:15,880
cybersecurity students are not the

32
00:01:12,100 --> 00:01:17,079
Virginia Community College in the US I'd

33
00:01:15,880 --> 00:01:19,929
like to contribute to open source

34
00:01:17,079 --> 00:01:21,158
projects with my brother and also a

35
00:01:19,929 --> 00:01:24,310
former senior business intelligence

36
00:01:21,159 --> 00:01:26,740
analyst from UNICEF Peru oh and you can

37
00:01:24,310 --> 00:01:29,469
follow me inside rewarded sorry I didn't

38
00:01:26,740 --> 00:01:30,759
mention that okay so the agenda for

39
00:01:29,469 --> 00:01:32,589
today we're going to be talking about a

40
00:01:30,759 --> 00:01:35,770
little bit you know three hunting

41
00:01:32,590 --> 00:01:37,390
programs with data all the way to start

42
00:01:35,770 --> 00:01:39,310
you know coming up with a methodology to

43
00:01:37,390 --> 00:01:40,450
start mapping your windows event logs or

44
00:01:39,310 --> 00:01:43,119
your you know security in general

45
00:01:40,450 --> 00:01:44,979
security event logs in general to the

46
00:01:43,119 --> 00:01:45,880
attack framework for example and then

47
00:01:44,979 --> 00:01:47,710
we're going to talk about a little bit

48
00:01:45,880 --> 00:01:50,020
about more than at the end and you guys

49
00:01:47,710 --> 00:01:52,928
are gonna know why in a little bit so

50
00:01:50,020 --> 00:01:54,670
three hunting and data so I believe that

51
00:01:52,929 --> 00:01:55,869
a lot of organizations are doing this

52
00:01:54,670 --> 00:01:57,579
already right they're putting together

53
00:01:55,869 --> 00:01:59,590
their programs they're doing all the way

54
00:01:57,579 --> 00:02:01,419
from the pre hunt activities all the way

55
00:01:59,590 --> 00:02:03,819
to defining their hypothesis analytics

56
00:02:01,420 --> 00:02:05,079
hunting you know reporting all the way

57
00:02:03,819 --> 00:02:07,090
to enhance and security controls

58
00:02:05,079 --> 00:02:08,829
everybody's doing that already right the

59
00:02:07,090 --> 00:02:10,780
problem that I see a lot every time I go

60
00:02:08,830 --> 00:02:13,240
to a company is that they focus so much

61
00:02:10,780 --> 00:02:16,810
on that you know but they don't focus at

62
00:02:13,240 --> 00:02:17,860
all into this primer they have which is

63
00:02:16,810 --> 00:02:19,270
there's a lot of

64
00:02:17,860 --> 00:02:21,250
there's a lot of data that is being

65
00:02:19,270 --> 00:02:23,800
generated that if you don't understand

66
00:02:21,250 --> 00:02:26,140
exactly what that data is then it's hard

67
00:02:23,800 --> 00:02:27,670
to implement all the other processes you

68
00:02:26,140 --> 00:02:30,309
know you have in there some other

69
00:02:27,670 --> 00:02:31,720
organizations are even skipping some of

70
00:02:30,310 --> 00:02:33,550
the steps on their own programs and

71
00:02:31,720 --> 00:02:35,560
they're just giving a console a search

72
00:02:33,550 --> 00:02:37,390
bar to a security analyst and say go on

73
00:02:35,560 --> 00:02:39,670
hunt and all they do is it just Google

74
00:02:37,390 --> 00:02:41,170
they find a script or it find a specific

75
00:02:39,670 --> 00:02:42,850
query they run it and they just call it

76
00:02:41,170 --> 00:02:45,100
a day and they say this is a hunting

77
00:02:42,850 --> 00:02:46,690
engagement so there's a lot of things

78
00:02:45,100 --> 00:02:48,130
going on right all the way from a basic

79
00:02:46,690 --> 00:02:49,840
program all the way to just giving a

80
00:02:48,130 --> 00:02:51,400
search bar but I did know the day if you

81
00:02:49,840 --> 00:02:53,080
don't care about your data it doesn't

82
00:02:51,400 --> 00:02:54,760
matter what you're doing talent

83
00:02:53,080 --> 00:02:56,800
technology it doesn't matter if you're

84
00:02:54,760 --> 00:02:58,720
the best of hunting if you have a data

85
00:02:56,800 --> 00:03:01,060
swamp rather than a data Lake is gonna

86
00:02:58,720 --> 00:03:02,709
be very very hard to even do your job

87
00:03:01,060 --> 00:03:06,220
and I have experienced that I actually

88
00:03:02,709 --> 00:03:08,860
have performed IR and also hunting

89
00:03:06,220 --> 00:03:10,990
engagements on that and it's not fun at

90
00:03:08,860 --> 00:03:12,610
all it is very painful and a lot of

91
00:03:10,990 --> 00:03:14,260
people just get frustrated because

92
00:03:12,610 --> 00:03:16,750
that's one of the biggest problems out

93
00:03:14,260 --> 00:03:18,310
there we talked about how to do you know

94
00:03:16,750 --> 00:03:20,590
procedures how to put together your

95
00:03:18,310 --> 00:03:22,780
program some nicest lights about how you

96
00:03:20,590 --> 00:03:24,640
can link your different teams together

97
00:03:22,780 --> 00:03:26,650
and all this stuff you know work

98
00:03:24,640 --> 00:03:28,570
together with a red team it's amazing

99
00:03:26,650 --> 00:03:30,850
right but in reality when you go to your

100
00:03:28,570 --> 00:03:33,190
organization that's the problem at the

101
00:03:30,850 --> 00:03:35,140
end and that's gonna force define if

102
00:03:33,190 --> 00:03:36,700
you're gonna be successful or not so you

103
00:03:35,140 --> 00:03:39,369
might be asking yourself okay so more

104
00:03:36,700 --> 00:03:41,109
data there more problems yes I know so

105
00:03:39,370 --> 00:03:42,489
if you have data it's gonna be great if

106
00:03:41,110 --> 00:03:43,900
you wanna do an investigation if you're

107
00:03:42,489 --> 00:03:45,519
going to use it to you know find

108
00:03:43,900 --> 00:03:46,930
anomalies outliers and things like that

109
00:03:45,519 --> 00:03:48,489
but at the same time you have to

110
00:03:46,930 --> 00:03:50,560
understand what it is that you're

111
00:03:48,489 --> 00:03:51,310
actually collecting and when I ask this

112
00:03:50,560 --> 00:03:52,989
question

113
00:03:51,310 --> 00:03:54,880
it actually has another question which

114
00:03:52,989 --> 00:03:56,470
is do you know what you're collecting

115
00:03:54,880 --> 00:03:57,790
and do you know what data you're

116
00:03:56,470 --> 00:03:59,650
collecting two different questions

117
00:03:57,790 --> 00:04:01,810
because when I said do you know what

118
00:03:59,650 --> 00:04:03,910
you're collecting the answers are yes

119
00:04:01,810 --> 00:04:05,890
I'm collecting process monitoring I use

120
00:04:03,910 --> 00:04:08,170
my EDR I use this maaan I'm collecting

121
00:04:05,890 --> 00:04:09,790
all this my question is no no but do you

122
00:04:08,170 --> 00:04:12,280
really know what you're collecting what

123
00:04:09,790 --> 00:04:13,780
is the data behind those data categories

124
00:04:12,280 --> 00:04:15,489
or names that you have in an excel sheet

125
00:04:13,780 --> 00:04:17,380
you know what's going on with those

126
00:04:15,489 --> 00:04:19,269
events do you understand exactly what's

127
00:04:17,380 --> 00:04:22,659
under that and most of the time the

128
00:04:19,269 --> 00:04:24,700
answer is no so how you might be doing

129
00:04:22,660 --> 00:04:27,039
it to start at least getting a little

130
00:04:24,700 --> 00:04:29,289
bit closer to talking about data and

131
00:04:27,039 --> 00:04:31,180
also your hunting engagements so a lot

132
00:04:29,289 --> 00:04:32,740
of organizations that we go to right

133
00:04:31,180 --> 00:04:34,539
my attack came last year to talk about

134
00:04:32,740 --> 00:04:36,370
you know their emulation plans and

135
00:04:34,539 --> 00:04:38,080
things like that and it's been for the

136
00:04:36,370 --> 00:04:40,449
past year and I have a belief he's being

137
00:04:38,080 --> 00:04:42,609
crazy the amount of people that I talked

138
00:04:40,449 --> 00:04:45,400
to in the implement minor attack so that

139
00:04:42,610 --> 00:04:48,669
should be pretty much everywhere in your

140
00:04:45,400 --> 00:04:51,039
hunting program in some organizations

141
00:04:48,669 --> 00:04:53,109
that I go to they say hey I have an idea

142
00:04:51,039 --> 00:04:55,240
minor attack has these you know metadata

143
00:04:53,110 --> 00:04:58,270
called data sources and I can start

144
00:04:55,240 --> 00:04:59,500
mapping all my controls to those data

145
00:04:58,270 --> 00:05:03,008
sources that are gonna map to a

146
00:04:59,500 --> 00:05:04,630
technique so easy right and then before

147
00:05:03,009 --> 00:05:06,460
we continue a data source for minor

148
00:05:04,630 --> 00:05:08,469
attack is considered a you know

149
00:05:06,460 --> 00:05:10,299
information collected by a sensor in

150
00:05:08,470 --> 00:05:13,840
order to allow you you know to validate

151
00:05:10,300 --> 00:05:16,660
a detection of an adversary technique so

152
00:05:13,840 --> 00:05:18,638
if we take this concept right you can go

153
00:05:16,660 --> 00:05:20,650
from a pilla technique to data sources

154
00:05:18,639 --> 00:05:22,270
that will map to other things in might

155
00:05:20,650 --> 00:05:24,099
attack which is awesome how you can just

156
00:05:22,270 --> 00:05:26,229
you know have relationships in there and

157
00:05:24,099 --> 00:05:28,180
you can just start doing this right and

158
00:05:26,229 --> 00:05:30,219
a lot of companies have solved this

159
00:05:28,180 --> 00:05:32,380
right they think that they have solved

160
00:05:30,220 --> 00:05:34,660
this they say my taxes process

161
00:05:32,380 --> 00:05:36,580
monitoring I have my Eevee are minor

162
00:05:34,660 --> 00:05:38,440
attacks is Windows security event logs I

163
00:05:36,580 --> 00:05:40,449
have my domain controller and that's it

164
00:05:38,440 --> 00:05:42,820
they just you know check the box and I

165
00:05:40,449 --> 00:05:44,949
already have my coverage well that's in

166
00:05:42,820 --> 00:05:46,300
work like that right we have you know

167
00:05:44,949 --> 00:05:48,639
windows security van locks we have more

168
00:05:46,300 --> 00:05:50,770
than 400 events if you map a technique

169
00:05:48,639 --> 00:05:53,500
to Windows Windows security events

170
00:05:50,770 --> 00:05:56,560
you're mapping 400 more than 400 events

171
00:05:53,500 --> 00:05:58,360
to just one your data source and there

172
00:05:56,560 --> 00:05:59,949
is not a way to understand exactly what

173
00:05:58,360 --> 00:06:02,590
it is that you need per technique if you

174
00:05:59,949 --> 00:06:07,000
only say I need Windows Event data

175
00:06:02,590 --> 00:06:08,169
sources so if you're doing this and you

176
00:06:07,000 --> 00:06:09,280
feel you don't have to move forward

177
00:06:08,169 --> 00:06:11,320
right you might be asking yourself why

178
00:06:09,280 --> 00:06:13,840
are we here right the main goal is to

179
00:06:11,320 --> 00:06:15,430
start sharing a little bit of the value

180
00:06:13,840 --> 00:06:17,440
of it is to understand data and when you

181
00:06:15,430 --> 00:06:19,030
start hunting at the same time we want

182
00:06:17,440 --> 00:06:21,009
to define a methodology to allow

183
00:06:19,030 --> 00:06:23,380
companies to start mapping their

184
00:06:21,009 --> 00:06:25,060
security events all the way to to attack

185
00:06:23,380 --> 00:06:26,620
data source and at the end of the day

186
00:06:25,060 --> 00:06:28,330
also we want to make sure that at this

187
00:06:26,620 --> 00:06:29,919
conference which I like the concept from

188
00:06:28,330 --> 00:06:31,840
a blue and red team perspective if

189
00:06:29,919 --> 00:06:35,320
you're a blue I want you to understand

190
00:06:31,840 --> 00:06:36,969
exactly you know what data sources you

191
00:06:35,320 --> 00:06:38,380
can use to validate a detection of

192
00:06:36,970 --> 00:06:40,510
specific techniques and from our Red

193
00:06:38,380 --> 00:06:42,370
Team perspective what actually you look

194
00:06:40,510 --> 00:06:43,870
like in the environment every action

195
00:06:42,370 --> 00:06:45,880
that you make

196
00:06:43,870 --> 00:06:48,190
or take it's going to be locked

197
00:06:45,880 --> 00:06:50,080
somewhere or somehow so we want to make

198
00:06:48,190 --> 00:06:52,419
sure that we identify how you can start

199
00:06:50,080 --> 00:06:54,400
mapping actions of an adversary to

200
00:06:52,419 --> 00:06:57,639
specific events as well so we're

201
00:06:54,400 --> 00:06:58,388
focusing on these you know right now so

202
00:06:57,639 --> 00:07:00,340
we're gonna start defining the

203
00:06:58,389 --> 00:07:00,850
methodology and it's gonna be very

204
00:07:00,340 --> 00:07:02,109
simple

205
00:07:00,850 --> 00:07:04,270
I mean we're gonna just start going

206
00:07:02,110 --> 00:07:06,220
through attack data sources all the way

207
00:07:04,270 --> 00:07:07,960
to start mapping specific events to

208
00:07:06,220 --> 00:07:09,750
attack and we're gonna start doing some

209
00:07:07,960 --> 00:07:12,940
validation to make sure that our

210
00:07:09,750 --> 00:07:14,740
mappings of security events to certain

211
00:07:12,940 --> 00:07:16,900
actions actually make sense when you

212
00:07:14,740 --> 00:07:18,669
star you know put it in against in a

213
00:07:16,900 --> 00:07:21,340
specific technique or variation of a

214
00:07:18,669 --> 00:07:23,469
technique so we're gonna explore attack

215
00:07:21,340 --> 00:07:25,719
first and how do we do that

216
00:07:23,470 --> 00:07:28,030
oh but first before that you know people

217
00:07:25,720 --> 00:07:29,830
also ask me why do you use attack to

218
00:07:28,030 --> 00:07:31,659
start mapping data sources why you know

219
00:07:29,830 --> 00:07:33,280
do I need attack I can do it myself just

220
00:07:31,660 --> 00:07:36,130
without thinking about attack what

221
00:07:33,280 --> 00:07:38,049
attack is a great I would say project or

222
00:07:36,130 --> 00:07:39,760
framework to start and then you can

223
00:07:38,050 --> 00:07:41,350
build on the top of that right cuz

224
00:07:39,760 --> 00:07:42,820
nothing is perfect right you can build

225
00:07:41,350 --> 00:07:44,770
on the top of that and if you feel that

226
00:07:42,820 --> 00:07:46,690
something could be updated you know it's

227
00:07:44,770 --> 00:07:48,070
an opportunity for collaboration don't

228
00:07:46,690 --> 00:07:49,180
reinvent the wheel right if you're gonna

229
00:07:48,070 --> 00:07:50,979
start creating your own categories

230
00:07:49,180 --> 00:07:52,510
mapped to your own techniques that

231
00:07:50,979 --> 00:07:54,370
sounds to me like miter attack already

232
00:07:52,510 --> 00:07:55,450
so you should be able to at least use

233
00:07:54,370 --> 00:07:57,220
something that's out there for the

234
00:07:55,450 --> 00:08:00,190
community and start building on the top

235
00:07:57,220 --> 00:08:03,190
of that the way how I access my tower

236
00:08:00,190 --> 00:08:05,110
attack is by querying the data through

237
00:08:03,190 --> 00:08:07,060
their public taxi server in sticks

238
00:08:05,110 --> 00:08:09,070
content it might ask yourself what's

239
00:08:07,060 --> 00:08:11,410
taxing the sticks so I have this slice

240
00:08:09,070 --> 00:08:14,620
inside here so taxi would be just the

241
00:08:11,410 --> 00:08:16,660
application a application protocol to

242
00:08:14,620 --> 00:08:18,760
exchange cyber threat intelligence over

243
00:08:16,660 --> 00:08:21,039
HTTP and we have his sticks it's pretty

244
00:08:18,760 --> 00:08:24,219
much the language the format were the

245
00:08:21,039 --> 00:08:28,930
data ax is you know presented in

246
00:08:24,220 --> 00:08:31,300
serialized as well so for example on May

247
00:08:28,930 --> 00:08:32,740
4th of last year miter attack pretty

248
00:08:31,300 --> 00:08:34,750
much announced that they were pushing

249
00:08:32,740 --> 00:08:36,729
all their information as well into this

250
00:08:34,750 --> 00:08:40,029
public taxi server so when we talk about

251
00:08:36,729 --> 00:08:42,400
sticks data that's an example how a

252
00:08:40,029 --> 00:08:45,370
technique turns into an attack pattern

253
00:08:42,400 --> 00:08:47,380
grouped an instruction set and so on so

254
00:08:45,370 --> 00:08:49,810
you have to now understand what it means

255
00:08:47,380 --> 00:08:53,470
when you query data directly from the

256
00:08:49,810 --> 00:08:55,239
taxi server so because of that I build

257
00:08:53,470 --> 00:08:57,640
my own library or I will call it more

258
00:08:55,240 --> 00:09:00,340
like a wrapper on the top of

259
00:08:57,640 --> 00:09:02,620
is to libraries Python sticks and

260
00:09:00,340 --> 00:09:04,540
clients and taxi Kline and those two

261
00:09:02,620 --> 00:09:06,430
allow me to play with that data query

262
00:09:04,540 --> 00:09:08,560
the data and it starts serializing it

263
00:09:06,430 --> 00:09:12,459
and transforming it in any way that I

264
00:09:08,560 --> 00:09:15,160
want or filtering the data as well you

265
00:09:12,460 --> 00:09:17,830
can install this it's pretty much a via

266
00:09:15,160 --> 00:09:19,540
pip just pip install I updated yesterday

267
00:09:17,830 --> 00:09:22,630
I like to update my tools before talking

268
00:09:19,540 --> 00:09:23,920
it's pain in the ass because because

269
00:09:22,630 --> 00:09:25,330
sometimes you're like this is gonna be

270
00:09:23,920 --> 00:09:26,530
awesome then something breaks and then

271
00:09:25,330 --> 00:09:28,930
you have to make sure that it's done

272
00:09:26,530 --> 00:09:31,030
before that presentation and there is

273
00:09:28,930 --> 00:09:33,760
also a couple of jupiter notebooks which

274
00:09:31,030 --> 00:09:36,520
arches you know web documents that

275
00:09:33,760 --> 00:09:38,380
allows you to you know run queries in a

276
00:09:36,520 --> 00:09:40,390
specific programming language you can

277
00:09:38,380 --> 00:09:42,130
save the output on that document and you

278
00:09:40,390 --> 00:09:44,110
can share that document with anybody

279
00:09:42,130 --> 00:09:46,000
else that's a beauty of that so there is

280
00:09:44,110 --> 00:09:48,220
a folder for that any all the

281
00:09:46,000 --> 00:09:51,130
instructions on how to do it so now you

282
00:09:48,220 --> 00:09:53,470
have a way to use the library to query a

283
00:09:51,130 --> 00:09:55,060
minor attack or you can use the jupiter

284
00:09:53,470 --> 00:09:58,660
notebook where you can use use the

285
00:09:55,060 --> 00:10:00,130
library and still map minor attack so

286
00:09:58,660 --> 00:10:02,829
what does that look like right so you

287
00:10:00,130 --> 00:10:07,300
just pretty much import the library you

288
00:10:02,830 --> 00:10:10,240
initialize a specific class and then you

289
00:10:07,300 --> 00:10:11,410
pretty much you know do dot and tap and

290
00:10:10,240 --> 00:10:13,420
it was going to show you all these

291
00:10:11,410 --> 00:10:15,010
specific methods that are available the

292
00:10:13,420 --> 00:10:17,349
reason why I do this is because if you

293
00:10:15,010 --> 00:10:20,020
are using the miter attack or just a

294
00:10:17,350 --> 00:10:21,730
miter itself the miter sticks in

295
00:10:20,020 --> 00:10:23,590
libraries you have to write a lot of

296
00:10:21,730 --> 00:10:25,960
different lines of code in order just to

297
00:10:23,590 --> 00:10:28,630
make a simple query like give me all the

298
00:10:25,960 --> 00:10:31,180
techniques from your database with this

299
00:10:28,630 --> 00:10:33,490
tool you can just do all techniques

300
00:10:31,180 --> 00:10:35,469
equal to using the method get all

301
00:10:33,490 --> 00:10:38,770
techniques and you get every single

302
00:10:35,470 --> 00:10:40,720
technique in a Stix object format and

303
00:10:38,770 --> 00:10:42,520
you can just play with that data and you

304
00:10:40,720 --> 00:10:44,140
can use import it to another application

305
00:10:42,520 --> 00:10:45,730
you can do you know whatever you want

306
00:10:44,140 --> 00:10:48,100
with it if you want to do it through the

307
00:10:45,730 --> 00:10:49,990
website good luck taking snapshot of

308
00:10:48,100 --> 00:10:52,240
every technique and then put it in a

309
00:10:49,990 --> 00:10:53,350
format that you want so this at least

310
00:10:52,240 --> 00:10:56,050
allows you to have everything

311
00:10:53,350 --> 00:10:57,760
programmatic whole way so if you want to

312
00:10:56,050 --> 00:10:59,859
have attack in your applications this

313
00:10:57,760 --> 00:11:01,840
would be a good way to do it keep in

314
00:10:59,860 --> 00:11:04,060
mind there is 500 techniques apparently

315
00:11:01,840 --> 00:11:06,670
for the whole all the matrices in might

316
00:11:04,060 --> 00:11:08,680
attack there is this concept of you know

317
00:11:06,670 --> 00:11:10,479
revoked techniques so minor attack

318
00:11:08,680 --> 00:11:11,410
pretty much will save techniques as well

319
00:11:10,480 --> 00:11:14,199
that have

320
00:11:11,410 --> 00:11:15,399
disable or revoked or light a canal so

321
00:11:14,199 --> 00:11:17,649
you have to make sure that if you work

322
00:11:15,399 --> 00:11:21,220
with minor attack data through their

323
00:11:17,649 --> 00:11:23,139
api's you take the revoked ones ow

324
00:11:21,220 --> 00:11:25,170
there is a method that allows you to see

325
00:11:23,139 --> 00:11:27,459
a specific technique just by the name

326
00:11:25,170 --> 00:11:29,889
and as you can see there is a specific

327
00:11:27,459 --> 00:11:31,599
field that says revoked so I did that

328
00:11:29,889 --> 00:11:34,029
for you already you can use use another

329
00:11:31,600 --> 00:11:36,160
method called remote you know remove

330
00:11:34,029 --> 00:11:38,470
revoked and you can get pretty much all

331
00:11:36,160 --> 00:11:40,329
the techniques that are available in the

332
00:11:38,470 --> 00:11:42,279
minor attack framework you can play with

333
00:11:40,329 --> 00:11:44,920
those and you know start understanding

334
00:11:42,279 --> 00:11:49,990
the data sources behind each technique

335
00:11:44,920 --> 00:11:53,139
which is my main goal so the minor

336
00:11:49,990 --> 00:11:55,779
attack team distributed East 485

337
00:11:53,139 --> 00:11:57,850
techniques in three matrices is the

338
00:11:55,779 --> 00:12:01,389
enterprise the mobile and the pre attack

339
00:11:57,850 --> 00:12:03,129
matrix these are the last the last

340
00:12:01,389 --> 00:12:10,540
numbers we have after applying our

341
00:12:03,129 --> 00:12:13,720
library now from a data source

342
00:12:10,540 --> 00:12:16,240
perspective almost 50% of the techniques

343
00:12:13,720 --> 00:12:19,079
have data sources the question here is

344
00:12:16,240 --> 00:12:22,060
what's happening with the other half

345
00:12:19,079 --> 00:12:24,819
part of techniques right so basically

346
00:12:22,060 --> 00:12:26,739
the idea here is this could be the

347
00:12:24,819 --> 00:12:28,810
reason this is this is happening is

348
00:12:26,740 --> 00:12:30,040
because maybe some of these techniques

349
00:12:28,810 --> 00:12:31,660
are not happening inside your

350
00:12:30,040 --> 00:12:33,240
environment where your sensors where

351
00:12:31,660 --> 00:12:35,259
were your sensors are collecting data

352
00:12:33,240 --> 00:12:37,720
such as for example the pre attack

353
00:12:35,259 --> 00:12:39,009
techniques or this is also an

354
00:12:37,720 --> 00:12:41,430
opportunity to collaborate with the

355
00:12:39,009 --> 00:12:41,430
attack team

356
00:12:43,320 --> 00:12:48,660
if we split all the techniques with and

357
00:12:46,410 --> 00:12:51,209
without data sources by matrices right

358
00:12:48,660 --> 00:12:53,459
we can find that all the techniques that

359
00:12:51,210 --> 00:12:55,410
do have data sources belongs to the

360
00:12:53,460 --> 00:12:56,910
enterprise attack something very

361
00:12:55,410 --> 00:12:58,410
interesting is that there are four

362
00:12:56,910 --> 00:13:00,689
techniques from the enterprise attack

363
00:12:58,410 --> 00:13:02,520
that do not have data sources so this is

364
00:13:00,690 --> 00:13:04,380
a big opportunity for us to collaborate

365
00:13:02,520 --> 00:13:05,610
with the attack team yep so there's

366
00:13:04,380 --> 00:13:07,230
something you can do this weekend if you

367
00:13:05,610 --> 00:13:12,590
don't have anything going on yeah you

368
00:13:07,230 --> 00:13:12,590
can you can do this conference now

369
00:13:13,160 --> 00:13:17,069
looking at information about all the

370
00:13:15,630 --> 00:13:20,820
data sources that we have in the middle

371
00:13:17,070 --> 00:13:23,190
attack framework the most relevant data

372
00:13:20,820 --> 00:13:25,230
sources are process monitoring file

373
00:13:23,190 --> 00:13:27,030
monitoring and process command-line and

374
00:13:25,230 --> 00:13:29,790
this is because for example with process

375
00:13:27,030 --> 00:13:33,000
monitoring you can start analyzing or

376
00:13:29,790 --> 00:13:35,250
validating the detection of at least 169

377
00:13:33,000 --> 00:13:37,860
techniques out of the 214

378
00:13:35,250 --> 00:13:40,500
before we continue with our analysis of

379
00:13:37,860 --> 00:13:42,600
the attack framework there is something

380
00:13:40,500 --> 00:13:46,260
very interesting here is there are some

381
00:13:42,600 --> 00:13:50,190
data sources names that are related to a

382
00:13:46,260 --> 00:13:52,439
specific that for in this case windows

383
00:13:50,190 --> 00:13:56,790
windows yep yeah they are related to the

384
00:13:52,440 --> 00:13:58,140
Windows platform so only you can do you

385
00:13:56,790 --> 00:14:00,270
know with these libraries you can get

386
00:13:58,140 --> 00:14:01,890
all the techniques by a data source so

387
00:14:00,270 --> 00:14:03,660
in this case if I want to know all the

388
00:14:01,890 --> 00:14:07,260
techniques that are mapped to PowerShell

389
00:14:03,660 --> 00:14:09,959
logs there is actually four of them and

390
00:14:07,260 --> 00:14:11,850
if you go just do a basic loop please

391
00:14:09,960 --> 00:14:14,400
you know don't judge my Python I'm

392
00:14:11,850 --> 00:14:15,720
actually still learning Python you can

393
00:14:14,400 --> 00:14:17,280
actually get a technique map to a

394
00:14:15,720 --> 00:14:19,530
platform and as you can see two out of

395
00:14:17,280 --> 00:14:21,900
the four are mapped to more platforms

396
00:14:19,530 --> 00:14:23,730
beyond just windows so that's very

397
00:14:21,900 --> 00:14:24,990
interesting cuz when you start playing

398
00:14:23,730 --> 00:14:27,360
with this data you gotta be careful

399
00:14:24,990 --> 00:14:29,430
because you cannot just say one data

400
00:14:27,360 --> 00:14:31,140
source PowerShell locks is helping me in

401
00:14:29,430 --> 00:14:33,270
you know three meters I'm sorry in three

402
00:14:31,140 --> 00:14:34,830
platforms Mac OS and in Linux and

403
00:14:33,270 --> 00:14:38,610
windows so you know keep that in mind

404
00:14:34,830 --> 00:14:42,060
when you do this type of analysis yeah

405
00:14:38,610 --> 00:14:46,680
so and if we apply the same concept for

406
00:14:42,060 --> 00:14:48,569
all these data sources PowerShell WMI

407
00:14:46,680 --> 00:14:50,520
windows are all reporting Windows

408
00:14:48,570 --> 00:14:53,100
registry or windows even logs we need to

409
00:14:50,520 --> 00:14:54,930
be careful if we have these data sources

410
00:14:53,100 --> 00:14:56,920
we cannot consider that we are covering

411
00:14:54,930 --> 00:14:59,199
all the made all the platform

412
00:14:56,920 --> 00:15:00,639
right these data sources only works for

413
00:14:59,200 --> 00:15:05,620
Windows so we need to be careful with

414
00:15:00,639 --> 00:15:08,110
that now going back to our graph is we

415
00:15:05,620 --> 00:15:09,459
we already said that the process

416
00:15:08,110 --> 00:15:12,070
monitoring is that the most relevant

417
00:15:09,459 --> 00:15:13,719
data source right because it's from a

418
00:15:12,070 --> 00:15:15,910
coverage perspective you can answer

419
00:15:13,720 --> 00:15:20,410
analyzing at least 169 techniques but

420
00:15:15,910 --> 00:15:23,740
the question is can we only use one data

421
00:15:20,410 --> 00:15:26,800
source right to analyze the variation of

422
00:15:23,740 --> 00:15:30,100
a specific technique well the answer is

423
00:15:26,800 --> 00:15:34,540
that we can only do that in 2121

424
00:15:30,100 --> 00:15:37,510
techniques the other 219 techniques

425
00:15:34,540 --> 00:15:40,029
requires at least two data sources so

426
00:15:37,510 --> 00:15:42,220
for for us the number of data sources

427
00:15:40,029 --> 00:15:44,800
that you require or the order that are

428
00:15:42,220 --> 00:15:48,339
recommended to validate the detection of

429
00:15:44,800 --> 00:15:51,459
a specific technique is related to how

430
00:15:48,339 --> 00:15:55,690
much context you need from your data to

431
00:15:51,459 --> 00:15:57,339
validate that the detection mm-hmm so

432
00:15:55,690 --> 00:15:58,779
now we are not talking about just one

433
00:15:57,339 --> 00:16:01,089
data source we're talking about groups

434
00:15:58,779 --> 00:16:04,360
of data sources right so this is the top

435
00:16:01,089 --> 00:16:06,160
15 groups of data sources that the

436
00:16:04,360 --> 00:16:08,529
attack team recommends to work together

437
00:16:06,160 --> 00:16:10,120
right all the techniques in this case

438
00:16:08,529 --> 00:16:12,579
for example file moratorium process

439
00:16:10,120 --> 00:16:14,320
command line and process monitoring if

440
00:16:12,579 --> 00:16:15,760
you start collecting these three data

441
00:16:14,320 --> 00:16:18,339
sources you can assign a list at least

442
00:16:15,760 --> 00:16:20,709
42 techniques yeah it's like at least 42

443
00:16:18,339 --> 00:16:23,140
that require the combination but of

444
00:16:20,709 --> 00:16:25,750
course if you look up the first you know

445
00:16:23,140 --> 00:16:27,640
you one two three at least it covers you

446
00:16:25,750 --> 00:16:30,070
know combination of file monitoring and

447
00:16:27,640 --> 00:16:32,230
process monitoring only so the idea with

448
00:16:30,070 --> 00:16:34,959
this is that I have clients that say I'm

449
00:16:32,230 --> 00:16:36,970
good with 169 techniques because I do

450
00:16:34,959 --> 00:16:39,040
have process monitoring that's it you

451
00:16:36,970 --> 00:16:40,720
know so we're just gonna go with it no

452
00:16:39,040 --> 00:16:42,399
it doesn't work like that right that's

453
00:16:40,720 --> 00:16:46,149
just part of the context that you need

454
00:16:42,399 --> 00:16:48,100
to do analysis so now that we understand

455
00:16:46,149 --> 00:16:49,870
at least attack data sources from their

456
00:16:48,100 --> 00:16:51,370
perspective right that's something that

457
00:16:49,870 --> 00:16:53,380
they're providing to us so we can at

458
00:16:51,370 --> 00:16:54,940
least get some information we can start

459
00:16:53,380 --> 00:16:57,519
documenting event locks that are might

460
00:16:54,940 --> 00:16:58,959
be related to those data sources every

461
00:16:57,519 --> 00:17:00,610
time we think about this technique for

462
00:16:58,959 --> 00:17:03,339
example they recommend these three data

463
00:17:00,610 --> 00:17:05,169
sources right away you think about 46 ad

464
00:17:03,339 --> 00:17:07,990
a from a Windows security event logs and

465
00:17:05,169 --> 00:17:09,260
that covers both of the you know data

466
00:17:07,990 --> 00:17:10,790
sources

467
00:17:09,260 --> 00:17:12,439
we actually have a recommendation that

468
00:17:10,790 --> 00:17:13,849
process command lines should be inside

469
00:17:12,439 --> 00:17:16,309
of the other one but that's something

470
00:17:13,849 --> 00:17:18,500
that we can talk about later but this is

471
00:17:16,309 --> 00:17:20,689
beyond just 460 a process monitoring

472
00:17:18,500 --> 00:17:23,329
could mean process termination it could

473
00:17:20,689 --> 00:17:24,829
mean process monitoring creation from

474
00:17:23,329 --> 00:17:26,569
another data source or a process

475
00:17:24,829 --> 00:17:28,309
accessing a process process right into a

476
00:17:26,569 --> 00:17:29,540
process there's a lot of things that can

477
00:17:28,309 --> 00:17:31,460
happen with a process monitoring

478
00:17:29,540 --> 00:17:33,230
perspective so you need to define that

479
00:17:31,460 --> 00:17:35,780
and document that otherwise it's not

480
00:17:33,230 --> 00:17:38,990
gonna be valuable at the end so you can

481
00:17:35,780 --> 00:17:40,570
start doing this by you know applying

482
00:17:38,990 --> 00:17:42,919
this concept that I learned also from

483
00:17:40,570 --> 00:17:44,780
from working at Capital One which is the

484
00:17:42,919 --> 00:17:46,400
data dictionary concept which you have

485
00:17:44,780 --> 00:17:48,379
to define and understand what it is that

486
00:17:46,400 --> 00:17:50,030
you're getting for each event all the

487
00:17:48,380 --> 00:17:51,950
way from the fuel level to the

488
00:17:50,030 --> 00:17:53,690
description of the field you can talk

489
00:17:51,950 --> 00:17:55,640
about data types as well so the way you

490
00:17:53,690 --> 00:17:58,640
understand what it is that your aquarium

491
00:17:55,640 --> 00:18:00,140
is this an integer and string and this

492
00:17:58,640 --> 00:18:02,150
is very interesting for example if we

493
00:18:00,140 --> 00:18:04,040
look at event ID 3 we have like source

494
00:18:02,150 --> 00:18:05,270
port destination port those are

495
00:18:04,040 --> 00:18:09,320
numerical values right those are

496
00:18:05,270 --> 00:18:10,879
integers but what can I do with that we

497
00:18:09,320 --> 00:18:12,260
can start doing something basic like if

498
00:18:10,880 --> 00:18:14,059
we take for example one field we can

499
00:18:12,260 --> 00:18:15,650
just do basic stat counting we can see

500
00:18:14,059 --> 00:18:17,629
the most frequent least frequent you

501
00:18:15,650 --> 00:18:19,070
know ports being used pretty much over

502
00:18:17,630 --> 00:18:20,990
time we can do a lot of stuff like that

503
00:18:19,070 --> 00:18:22,790
but when you start thinking about this

504
00:18:20,990 --> 00:18:24,490
is a number this is a number so I can

505
00:18:22,790 --> 00:18:27,620
actually do some type of descriptive

506
00:18:24,490 --> 00:18:30,950
descriptive statistics average max

507
00:18:27,620 --> 00:18:32,510
medium so can I do that yes you can but

508
00:18:30,950 --> 00:18:34,100
at the end of the day if you do that to

509
00:18:32,510 --> 00:18:36,530
a port I don't think that that's gonna

510
00:18:34,100 --> 00:18:39,709
have any meaning to you you cannot

511
00:18:36,530 --> 00:18:41,210
connect to app or you know 10.5 you know

512
00:18:39,710 --> 00:18:43,309
point 5 6 7 because that's the average

513
00:18:41,210 --> 00:18:46,460
of ports in my environment it doesn't

514
00:18:43,309 --> 00:18:47,690
work like that right so when you talk

515
00:18:46,460 --> 00:18:50,750
about that concept then you have to

516
00:18:47,690 --> 00:18:54,260
understand the events themselves and the

517
00:18:50,750 --> 00:18:58,130
types in a different way as well because

518
00:18:54,260 --> 00:19:01,309
if we see this column of type of data

519
00:18:58,130 --> 00:19:04,210
right is giving us more an idea of the

520
00:19:01,309 --> 00:19:06,470
format of the data right but if we use

521
00:19:04,210 --> 00:19:08,570
another perspective let's use a

522
00:19:06,470 --> 00:19:15,110
mathematical perspective if we start

523
00:19:08,570 --> 00:19:17,270
consider describing our data with type

524
00:19:15,110 --> 00:19:19,639
of data it could be qualitative or

525
00:19:17,270 --> 00:19:21,650
quantitative data qualitative data the

526
00:19:19,640 --> 00:19:23,210
concepts really basic you can describe

527
00:19:21,650 --> 00:19:26,390
your values using letter

528
00:19:23,210 --> 00:19:27,950
numbers or or symbols and in

529
00:19:26,390 --> 00:19:29,929
quantitative data you can use only

530
00:19:27,950 --> 00:19:33,309
numbers to represent your values right

531
00:19:29,929 --> 00:19:35,750
so the idea is for example Roberto

532
00:19:33,309 --> 00:19:38,840
already talked about source port value

533
00:19:35,750 --> 00:19:41,539
the source port value gets or poor value

534
00:19:38,840 --> 00:19:43,549
so this value is a quantitative discrete

535
00:19:41,539 --> 00:19:46,158
value what is the meaning of a discrete

536
00:19:43,549 --> 00:19:49,580
value is like in a range of value you

537
00:19:46,159 --> 00:19:52,070
can only have a specific values right so

538
00:19:49,580 --> 00:19:54,860
using the descriptive analytics like the

539
00:19:52,070 --> 00:19:58,730
mean or the average sorry the average or

540
00:19:54,860 --> 00:20:00,649
maybe the standard deviation right so

541
00:19:58,730 --> 00:20:02,960
most of the time the value is not going

542
00:20:00,649 --> 00:20:05,000
to it's not going to mean anything but

543
00:20:02,960 --> 00:20:07,520
for example if we apply the same concept

544
00:20:05,000 --> 00:20:10,299
for a quantitative continuous data which

545
00:20:07,520 --> 00:20:12,260
is in a range of of data you will have

546
00:20:10,299 --> 00:20:15,500
infinite values right

547
00:20:12,260 --> 00:20:17,929
like for example bytes in or out your

548
00:20:15,500 --> 00:20:19,309
network you can find what is the mean

549
00:20:17,929 --> 00:20:21,679
the standard deviation all these

550
00:20:19,309 --> 00:20:23,629
descriptive statistics in if you put

551
00:20:21,679 --> 00:20:25,730
these information in a graph that you

552
00:20:23,630 --> 00:20:29,299
supports plot graph you can start

553
00:20:25,730 --> 00:20:31,399
identifying what values are outliers or

554
00:20:29,299 --> 00:20:34,220
a typic in your environment so that's

555
00:20:31,399 --> 00:20:38,629
the way you can use these maths approach

556
00:20:34,220 --> 00:20:40,520
to prioritize your actions or yeah so

557
00:20:38,630 --> 00:20:42,350
for example yesterday I was talking

558
00:20:40,520 --> 00:20:43,970
about a little bit for example someone

559
00:20:42,350 --> 00:20:45,949
asked about and someone asked me about

560
00:20:43,970 --> 00:20:47,870
machine learning and all the stuff out

561
00:20:45,950 --> 00:20:49,309
there and to me saying well if we're

562
00:20:47,870 --> 00:20:50,600
gonna talk about machine learning and

563
00:20:49,309 --> 00:20:52,510
all these concepts that are crazy out

564
00:20:50,600 --> 00:20:54,949
there that everybody uses for marketing

565
00:20:52,510 --> 00:20:57,740
from our perspective we need to

566
00:20:54,950 --> 00:21:00,380
understand this the data to be described

567
00:20:57,740 --> 00:21:02,299
like this if I don't understand my data

568
00:21:00,380 --> 00:21:04,669
described that way I cannot come up with

569
00:21:02,299 --> 00:21:06,320
a use case for any specific data source

570
00:21:04,669 --> 00:21:08,210
so we're gonna be doing is actually

571
00:21:06,320 --> 00:21:10,309
creating data dictionaries that gives me

572
00:21:08,210 --> 00:21:11,570
a basic data type for a format but then

573
00:21:10,309 --> 00:21:13,760
also give you a little bit of the

574
00:21:11,570 --> 00:21:15,260
mathematical type for that feel and

575
00:21:13,760 --> 00:21:17,210
that's what if you talk to a data

576
00:21:15,260 --> 00:21:19,250
scientist they love that because they

577
00:21:17,210 --> 00:21:20,690
want to know exactly what are the values

578
00:21:19,250 --> 00:21:22,760
are gonna be working with so they know

579
00:21:20,690 --> 00:21:25,340
what they can apply to that specific

580
00:21:22,760 --> 00:21:27,169
data so that's you know very very useful

581
00:21:25,340 --> 00:21:28,850
another reason why you should be doing

582
00:21:27,169 --> 00:21:31,279
this especially from the red team you

583
00:21:28,850 --> 00:21:33,230
know perspective so our colleagues well

584
00:21:31,279 --> 00:21:35,570
my colleague Mac raver and you know Lee

585
00:21:33,230 --> 00:21:37,040
Christensen does their presentation in

586
00:21:35,570 --> 00:21:39,110
black cat last year they

587
00:21:37,040 --> 00:21:41,270
about documenting sis Mon for example

588
00:21:39,110 --> 00:21:43,100
what a specific feels there's gonna be

589
00:21:41,270 --> 00:21:44,660
the attack influence rating it's gonna

590
00:21:43,100 --> 00:21:46,310
be higher what are the fields that they

591
00:21:44,660 --> 00:21:47,210
can actually manipulate in one of the

592
00:21:46,310 --> 00:21:49,940
fields that you know they can easily

593
00:21:47,210 --> 00:21:51,920
just touch and then change well they

594
00:21:49,940 --> 00:21:53,780
have to do data dictionaries in order to

595
00:21:51,920 --> 00:21:56,330
understand that so if a red teamer is

596
00:21:53,780 --> 00:21:58,100
doing it why isn't a blue team we're

597
00:21:56,330 --> 00:21:59,780
doing it as well so in general we all

598
00:21:58,100 --> 00:22:01,699
need to be doing data dictionaries for

599
00:21:59,780 --> 00:22:03,860
the data that we collect and the data

600
00:22:01,700 --> 00:22:06,320
that we generate as well so it goes for

601
00:22:03,860 --> 00:22:08,510
both sides next step we're going to

602
00:22:06,320 --> 00:22:10,669
develop a data model in a data model now

603
00:22:08,510 --> 00:22:11,960
that we understand our data from an

604
00:22:10,670 --> 00:22:13,250
attack perspective now that we

605
00:22:11,960 --> 00:22:15,610
understand our data also that were

606
00:22:13,250 --> 00:22:18,440
collecting from specific field levels

607
00:22:15,610 --> 00:22:20,060
descriptions we can install now defining

608
00:22:18,440 --> 00:22:22,670
the structure or understanding the

609
00:22:20,060 --> 00:22:24,260
structure of our data miner has their

610
00:22:22,670 --> 00:22:25,970
own data model that's the link over

611
00:22:24,260 --> 00:22:28,730
there and they also use once again

612
00:22:25,970 --> 00:22:31,610
sticks definitions or specifications to

613
00:22:28,730 --> 00:22:34,220
map specific objects that they can

614
00:22:31,610 --> 00:22:35,659
identify on the data sources when you

615
00:22:34,220 --> 00:22:37,610
think about a data model some of you

616
00:22:35,660 --> 00:22:39,380
guys understand these concepts might be

617
00:22:37,610 --> 00:22:41,120
thinking about a database well it's you

618
00:22:39,380 --> 00:22:43,040
know a similar concept how you can start

619
00:22:41,120 --> 00:22:44,989
structuring your data so that it makes

620
00:22:43,040 --> 00:22:47,480
sense to be store in a database right

621
00:22:44,990 --> 00:22:49,430
this apply this gets applied also to for

622
00:22:47,480 --> 00:22:51,950
example CDI right when you can use a

623
00:22:49,430 --> 00:22:54,020
basic graph knowledge for example to

624
00:22:51,950 --> 00:22:56,330
start mapping specific entities each

625
00:22:54,020 --> 00:22:58,310
entity can have a specific properties

626
00:22:56,330 --> 00:23:00,620
inside and you keep a relationship

627
00:22:58,310 --> 00:23:02,899
across all of them why can't we start

628
00:23:00,620 --> 00:23:04,610
doing that with you know fear you know

629
00:23:02,900 --> 00:23:07,010
security event logs for example we have

630
00:23:04,610 --> 00:23:09,530
every event log that we have we're gonna

631
00:23:07,010 --> 00:23:11,570
identify a user a potential process an

632
00:23:09,530 --> 00:23:13,460
IP a file well there's kind of peer

633
00:23:11,570 --> 00:23:15,500
relationships across these entities that

634
00:23:13,460 --> 00:23:17,630
we find in our event logs all those

635
00:23:15,500 --> 00:23:18,770
events have you know properties and they

636
00:23:17,630 --> 00:23:21,290
also have relationships that we can

637
00:23:18,770 --> 00:23:23,000
identify across those events at the end

638
00:23:21,290 --> 00:23:25,100
of the day if you're doing sis Mon you

639
00:23:23,000 --> 00:23:26,420
can actually have this type of basic

640
00:23:25,100 --> 00:23:27,679
data model which allows you to

641
00:23:26,420 --> 00:23:29,420
understand what it is that you can do

642
00:23:27,680 --> 00:23:31,520
with system on this is very helpful for

643
00:23:29,420 --> 00:23:33,440
an instant response perspective for

644
00:23:31,520 --> 00:23:35,720
example if somebody finds an IP or a

645
00:23:33,440 --> 00:23:37,670
process you can pretty much think about

646
00:23:35,720 --> 00:23:39,620
the other possibilities that might be

647
00:23:37,670 --> 00:23:41,510
attached to that specific you know

648
00:23:39,620 --> 00:23:42,709
entity for example or from a hunting

649
00:23:41,510 --> 00:23:44,030
perspective or from a Red Team

650
00:23:42,710 --> 00:23:46,070
perspective if I'm making a specific

651
00:23:44,030 --> 00:23:48,470
action that's what it will look like on

652
00:23:46,070 --> 00:23:50,389
sis Mon you can apply this on enterprise

653
00:23:48,470 --> 00:23:51,020
tool like carbon black and as you can

654
00:23:50,390 --> 00:23:53,600
see this

655
00:23:51,020 --> 00:23:55,610
a similar way if you start reading one

656
00:23:53,600 --> 00:23:57,250
by one you can pretty much see also

657
00:23:55,610 --> 00:23:59,479
carbon black giving you certain

658
00:23:57,250 --> 00:24:01,010
relationships in the data so that's very

659
00:23:59,480 --> 00:24:03,080
important because that's how you can

660
00:24:01,010 --> 00:24:05,330
actually start telling somebody I do

661
00:24:03,080 --> 00:24:07,220
need simple sis Mon I don't need this

662
00:24:05,330 --> 00:24:08,960
man I need an easier solution or I don't

663
00:24:07,220 --> 00:24:10,880
need an easier solution you have to be

664
00:24:08,960 --> 00:24:13,160
able to define that if you can do that

665
00:24:10,880 --> 00:24:14,780
if you say that you want to use an EDR

666
00:24:13,160 --> 00:24:16,760
because I have some cool shirts in a

667
00:24:14,780 --> 00:24:18,920
nice calendar you know good luck with

668
00:24:16,760 --> 00:24:21,590
that it needs to be defined this way you

669
00:24:18,920 --> 00:24:24,110
know from our perspective so going back

670
00:24:21,590 --> 00:24:25,850
to our technique from attack from a data

671
00:24:24,110 --> 00:24:28,159
source perspective now that we

672
00:24:25,850 --> 00:24:30,320
understand what are the different events

673
00:24:28,160 --> 00:24:32,630
that might provide specific sub data

674
00:24:30,320 --> 00:24:34,909
sources for the attack data source in

675
00:24:32,630 --> 00:24:37,100
there we can apply our data model and

676
00:24:34,910 --> 00:24:39,620
it's star mapping what are the

677
00:24:37,100 --> 00:24:41,570
relationships that we find in each sub

678
00:24:39,620 --> 00:24:43,699
data source that then will be related

679
00:24:41,570 --> 00:24:45,919
back to an attack data source this is

680
00:24:43,700 --> 00:24:48,770
very interesting because then I'm going

681
00:24:45,920 --> 00:24:51,410
deeper into what does attack data source

682
00:24:48,770 --> 00:24:53,720
actually mean to me so when we talk

683
00:24:51,410 --> 00:24:55,550
about now process monitoring then I

684
00:24:53,720 --> 00:24:58,100
understand now that this means something

685
00:24:55,550 --> 00:24:59,870
like this now not just a data source

686
00:24:58,100 --> 00:25:01,909
name that I just mapped to a tool

687
00:24:59,870 --> 00:25:04,429
directly now there is a process in

688
00:25:01,910 --> 00:25:06,590
between I can do the same thing with

689
00:25:04,430 --> 00:25:08,540
registry for example right I can find

690
00:25:06,590 --> 00:25:11,360
relationships inside of my data sources

691
00:25:08,540 --> 00:25:14,030
that provide those sub data sources map

692
00:25:11,360 --> 00:25:15,409
to attack data source but this is very

693
00:25:14,030 --> 00:25:17,389
interesting because I'm identifying

694
00:25:15,410 --> 00:25:20,630
relationships about a process in the

695
00:25:17,390 --> 00:25:23,600
registry but what if I want to do a user

696
00:25:20,630 --> 00:25:25,520
point to a registry if you're using

697
00:25:23,600 --> 00:25:27,949
system on system does not give you that

698
00:25:25,520 --> 00:25:30,110
right system does not give you the user

699
00:25:27,950 --> 00:25:34,070
name so if you're running an analytic

700
00:25:30,110 --> 00:25:35,389
saying username blob and this is

701
00:25:34,070 --> 00:25:37,429
monumentally twelve thirteen or fourteen

702
00:25:35,390 --> 00:25:38,720
you're not gonna get anything and you

703
00:25:37,430 --> 00:25:41,060
might think it's a high-fidelity rule

704
00:25:38,720 --> 00:25:43,310
right if you want to do some type of

705
00:25:41,060 --> 00:25:46,520
registry map to a user you might need a

706
00:25:43,310 --> 00:25:48,590
cycle right a cycle pretty much is a

707
00:25:46,520 --> 00:25:50,690
system access control list you can use

708
00:25:48,590 --> 00:25:53,209
this cycle map to a you know system on

709
00:25:50,690 --> 00:25:54,980
in for example registry if I map if I

710
00:25:53,210 --> 00:25:57,140
create a cycle on the system registry

711
00:25:54,980 --> 00:25:59,060
every time I adversary wants to query or

712
00:25:57,140 --> 00:26:00,890
access information about system own

713
00:25:59,060 --> 00:26:03,590
through the registry I'll be able to get

714
00:26:00,890 --> 00:26:04,850
this event which is gonna give me the

715
00:26:03,590 --> 00:26:07,520
specific user is

716
00:26:04,850 --> 00:26:08,570
give me the registry map to a process so

717
00:26:07,520 --> 00:26:11,840
that's very interesting to me because

718
00:26:08,570 --> 00:26:13,189
from a red team's perspective this is

719
00:26:11,840 --> 00:26:15,260
what you will look like if you query

720
00:26:13,190 --> 00:26:17,780
this Mon and I have a cycle in it and

721
00:26:15,260 --> 00:26:19,370
from a you know from a detection

722
00:26:17,780 --> 00:26:21,230
perspective I want to know that I have

723
00:26:19,370 --> 00:26:23,449
some use cases that I can work with I

724
00:26:21,230 --> 00:26:26,450
have process to a registry and user to a

725
00:26:23,450 --> 00:26:28,310
registry as well so you know today you

726
00:26:26,450 --> 00:26:30,440
might be asking yourself okay it still

727
00:26:28,310 --> 00:26:32,179
does not make sense right yeah this is

728
00:26:30,440 --> 00:26:33,440
probably a little you know like I don't

729
00:26:32,180 --> 00:26:36,080
understand how this could be helpful

730
00:26:33,440 --> 00:26:38,690
when I execute a hundred stuff like that

731
00:26:36,080 --> 00:26:41,060
let's say we're using WMI to spawn a new

732
00:26:38,690 --> 00:26:43,880
agent to move laterally right so you can

733
00:26:41,060 --> 00:26:45,710
just do that with Empires module from a

734
00:26:43,880 --> 00:26:47,360
detection perspective it looks like this

735
00:26:45,710 --> 00:26:49,850
to me there is an authentication going

736
00:26:47,360 --> 00:26:52,090
on specific port every time you do an

737
00:26:49,850 --> 00:26:55,280
execution through WMI on the destination

738
00:26:52,090 --> 00:26:57,860
it's going to be hosted by WMI prvs see

739
00:26:55,280 --> 00:26:59,300
as a parent process and then the parent

740
00:26:57,860 --> 00:27:01,250
execute whatever you wanted to execute

741
00:26:59,300 --> 00:27:02,990
and if you are doing it to launch an

742
00:27:01,250 --> 00:27:06,140
asian it's going to then make a network

743
00:27:02,990 --> 00:27:08,660
connection i can map that with my data

744
00:27:06,140 --> 00:27:10,730
model and say i have event to be one and

745
00:27:08,660 --> 00:27:13,010
three they both can be joined by a

746
00:27:10,730 --> 00:27:16,160
specific field the process good and I

747
00:27:13,010 --> 00:27:18,500
can actually say I have W my prvc as a

748
00:27:16,160 --> 00:27:20,990
parent I don't care about a child if the

749
00:27:18,500 --> 00:27:23,030
adversary uses PowerShell Cmdr any other

750
00:27:20,990 --> 00:27:24,740
process that they want to use or names

751
00:27:23,030 --> 00:27:27,410
or anything I don't care about that I

752
00:27:24,740 --> 00:27:30,110
want I care about the specific behavior

753
00:27:27,410 --> 00:27:31,460
going on in here W am i executing

754
00:27:30,110 --> 00:27:33,679
something and then making a network

755
00:27:31,460 --> 00:27:35,840
connection that could be translated to a

756
00:27:33,680 --> 00:27:37,730
query for example a basic sequel query

757
00:27:35,840 --> 00:27:39,980
which can be used by any other tools

758
00:27:37,730 --> 00:27:41,600
that support sequel right so you can

759
00:27:39,980 --> 00:27:43,100
pretty much have this and I did another

760
00:27:41,600 --> 00:27:45,560
day you'll be able to find that type of

761
00:27:43,100 --> 00:27:47,540
behavior which these slides are gonna be

762
00:27:45,560 --> 00:27:49,490
available so the query pretty much was

763
00:27:47,540 --> 00:27:51,220
put on the top do this in your

764
00:27:49,490 --> 00:27:53,840
environment try to find every single

765
00:27:51,220 --> 00:27:55,460
parent process that is W my that is

766
00:27:53,840 --> 00:27:57,620
executing something that that makes a

767
00:27:55,460 --> 00:28:02,420
network connection that does not happen

768
00:27:57,620 --> 00:28:04,729
that often so now that we understand our

769
00:28:02,420 --> 00:28:06,140
data which occupant it all the way to

770
00:28:04,730 --> 00:28:07,910
the fuel level we understand the

771
00:28:06,140 --> 00:28:09,410
specific data types we understand

772
00:28:07,910 --> 00:28:11,330
destruction of our data relationship

773
00:28:09,410 --> 00:28:14,000
that we can find we're gonna start then

774
00:28:11,330 --> 00:28:16,220
now mapping it all the way to attack in

775
00:28:14,000 --> 00:28:18,540
a way that will make more sense to me

776
00:28:16,220 --> 00:28:21,450
where I could say I have

777
00:28:18,540 --> 00:28:23,760
data I have a specific event IDs map to

778
00:28:21,450 --> 00:28:26,370
an a specific relation that I can find

779
00:28:23,760 --> 00:28:28,379
all my data sources all the way back to

780
00:28:26,370 --> 00:28:30,659
an attack data source for example that

781
00:28:28,380 --> 00:28:32,850
to me is so valuable because I will be

782
00:28:30,660 --> 00:28:35,010
able now to understand that I have

783
00:28:32,850 --> 00:28:37,350
certain possibilities just by one

784
00:28:35,010 --> 00:28:39,750
specific attack data source and I can

785
00:28:37,350 --> 00:28:41,850
also create built on the top of attack

786
00:28:39,750 --> 00:28:43,890
and say every time we say process

787
00:28:41,850 --> 00:28:46,290
monitoring those are the possibilities

788
00:28:43,890 --> 00:28:48,300
that we have and of course those will

789
00:28:46,290 --> 00:28:50,250
change depending on the variant if the

790
00:28:48,300 --> 00:28:52,680
variant of the technique calls for a

791
00:28:50,250 --> 00:28:54,870
process accessing a process or writing

792
00:28:52,680 --> 00:28:57,510
to you know to a specific thread in the

793
00:28:54,870 --> 00:28:59,939
process then now you can pretty much say

794
00:28:57,510 --> 00:29:02,280
this technique requires process

795
00:28:59,940 --> 00:29:04,890
monitoring and requires process right

796
00:29:02,280 --> 00:29:07,410
into another process pretty much so you

797
00:29:04,890 --> 00:29:09,240
know the data idea is to have this

798
00:29:07,410 --> 00:29:11,820
documented in a way that will make sense

799
00:29:09,240 --> 00:29:13,620
I have this link in a project called

800
00:29:11,820 --> 00:29:16,370
awesome that is going to allow you to

801
00:29:13,620 --> 00:29:19,469
see exactly what certain actions mean

802
00:29:16,370 --> 00:29:21,540
back to an event ID I show these sort of

803
00:29:19,470 --> 00:29:24,330
red teamers they loved it because now

804
00:29:21,540 --> 00:29:26,250
they say if I go to this list I can just

805
00:29:24,330 --> 00:29:29,399
type if I want to look at relationship

806
00:29:26,250 --> 00:29:32,310
between a process to a user or a user to

807
00:29:29,400 --> 00:29:34,200
an ad object I just filter all this and

808
00:29:32,310 --> 00:29:36,149
I can find all the event IDs that will

809
00:29:34,200 --> 00:29:37,560
give me that relationship and then they

810
00:29:36,150 --> 00:29:41,310
can pretty much go on and do whatever

811
00:29:37,560 --> 00:29:43,889
they want with it it's in this project

812
00:29:41,310 --> 00:29:46,200
right here you have dictionaries data

813
00:29:43,890 --> 00:29:48,150
model the mapping to attack and also a

814
00:29:46,200 --> 00:29:49,560
common information model it's a it's a

815
00:29:48,150 --> 00:29:51,060
project that we're building to start

816
00:29:49,560 --> 00:29:52,860
documenting all this so we're doing a

817
00:29:51,060 --> 00:29:55,200
lot of the heavy work already we will

818
00:29:52,860 --> 00:29:56,760
have to uh you know love some

819
00:29:55,200 --> 00:29:58,260
contributors and you know see where this

820
00:29:56,760 --> 00:29:59,970
actually takes us and we have

821
00:29:58,260 --> 00:30:01,560
conversations with attack to update

822
00:29:59,970 --> 00:30:03,810
their attack data sources to sub data

823
00:30:01,560 --> 00:30:04,950
sources so you know so that will be

824
00:30:03,810 --> 00:30:08,129
interesting to you know see that

825
00:30:04,950 --> 00:30:10,200
happening as well so how does that look

826
00:30:08,130 --> 00:30:12,180
like from a hunting perspective now that

827
00:30:10,200 --> 00:30:14,010
we understand the methodology well you

828
00:30:12,180 --> 00:30:15,990
have to understand that if you have a

829
00:30:14,010 --> 00:30:18,420
program like this you have to understand

830
00:30:15,990 --> 00:30:20,730
where data actually fits data will fit

831
00:30:18,420 --> 00:30:22,530
before you even try to build your

832
00:30:20,730 --> 00:30:24,750
analytic because otherwise you will not

833
00:30:22,530 --> 00:30:26,310
understand the analytic itself or the

834
00:30:24,750 --> 00:30:28,170
possibilities that you can use with the

835
00:30:26,310 --> 00:30:30,090
data to build potential analytics

836
00:30:28,170 --> 00:30:32,040
analytics by the way goes all the way

837
00:30:30,090 --> 00:30:32,370
from the basic query all the way to a

838
00:30:32,040 --> 00:30:34,139
put

839
00:30:32,370 --> 00:30:35,820
no statistical model the loser was

840
00:30:34,140 --> 00:30:37,620
talking about possibly sorry I call in

841
00:30:35,820 --> 00:30:42,210
which all the tankers how we talk to

842
00:30:37,620 --> 00:30:44,429
each other and then data also fits

843
00:30:42,210 --> 00:30:45,930
before you even execute the hunt and

844
00:30:44,430 --> 00:30:48,210
that will define if you're gonna be

845
00:30:45,930 --> 00:30:50,250
successful or not if you have this crazy

846
00:30:48,210 --> 00:30:52,470
technology people with so much talent

847
00:30:50,250 --> 00:30:54,330
dream team right dream team in there

848
00:30:52,470 --> 00:30:55,680
going on hunt and you're not collecting

849
00:30:54,330 --> 00:30:59,159
the data that you were defining or

850
00:30:55,680 --> 00:31:01,230
analytic good luck with that so the data

851
00:30:59,160 --> 00:31:02,580
quality assessments which are also part

852
00:31:01,230 --> 00:31:04,230
of other presentations that we talked

853
00:31:02,580 --> 00:31:06,330
about are very important as well but we

854
00:31:04,230 --> 00:31:08,070
just want to talk about how data really

855
00:31:06,330 --> 00:31:10,770
will define how successful you could be

856
00:31:08,070 --> 00:31:12,059
for an engagement so we're gonna just do

857
00:31:10,770 --> 00:31:14,520
a quick validation in here we're gonna

858
00:31:12,059 --> 00:31:15,960
talk about overpass the hash in this

859
00:31:14,520 --> 00:31:17,760
case we have this technique pass the

860
00:31:15,960 --> 00:31:19,679
hash first right which is the basic

861
00:31:17,760 --> 00:31:21,120
concept is to use you know to

862
00:31:19,679 --> 00:31:23,429
authenticate to a box you know without

863
00:31:21,120 --> 00:31:25,979
using the explicit credentials or clear

864
00:31:23,429 --> 00:31:28,410
text from a user that's just basis of

865
00:31:25,980 --> 00:31:30,059
pass a hash it is a variation of penser

866
00:31:28,410 --> 00:31:31,320
hash right there is an overpass de hash

867
00:31:30,059 --> 00:31:33,300
which is gonna use Kerberos

868
00:31:31,320 --> 00:31:36,149
authentication right you can pretty much

869
00:31:33,300 --> 00:31:38,730
get that ticket or that hash and you can

870
00:31:36,150 --> 00:31:41,040
pretty much you know use it to request a

871
00:31:38,730 --> 00:31:43,200
ticket so what does that look like just

872
00:31:41,040 --> 00:31:45,360
in case the basics of you know Kerberos

873
00:31:43,200 --> 00:31:47,130
right you have your password gets you

874
00:31:45,360 --> 00:31:48,990
know go through a you know one-way

875
00:31:47,130 --> 00:31:50,160
function depends on the functionality of

876
00:31:48,990 --> 00:31:52,590
your domain controller you have a

877
00:31:50,160 --> 00:31:54,690
specific keys you can use that key then

878
00:31:52,590 --> 00:31:56,760
to request a ticket get the ticket back

879
00:31:54,690 --> 00:31:58,470
use that ticket to request all our

880
00:31:56,760 --> 00:32:00,210
service tickets and then you can pretty

881
00:31:58,470 --> 00:32:02,030
much access other services in the

882
00:32:00,210 --> 00:32:03,600
network there's the basics of Kerberos

883
00:32:02,030 --> 00:32:05,700
overpass the hash

884
00:32:03,600 --> 00:32:08,159
basically just gets the key or the hash

885
00:32:05,700 --> 00:32:10,200
that was just stolen and you can use

886
00:32:08,160 --> 00:32:14,400
that to pretty much start the whole

887
00:32:10,200 --> 00:32:15,960
Kerberos process as well this is a

888
00:32:14,400 --> 00:32:17,640
question for red teamers and blue

889
00:32:15,960 --> 00:32:18,950
teamers which one is mimic ads in which

890
00:32:17,640 --> 00:32:21,150
one is Rubeus

891
00:32:18,950 --> 00:32:22,620
and we will talk about rubio's in a

892
00:32:21,150 --> 00:32:33,690
little bit but at least which one is

893
00:32:22,620 --> 00:32:36,750
mimic as anybody left or right okay time

894
00:32:33,690 --> 00:32:39,000
is up well your mimikatz is the left and

895
00:32:36,750 --> 00:32:40,890
Ruby's is the right we have sacrificial

896
00:32:39,000 --> 00:32:42,690
logon sessions being done by mimikatz

897
00:32:40,890 --> 00:32:43,800
when it does the overpass a hash the

898
00:32:42,690 --> 00:32:44,850
reason they do that is because they

899
00:32:43,800 --> 00:32:46,139
don't want to deal with the current

900
00:32:44,850 --> 00:32:48,060
logon session so they

901
00:32:46,140 --> 00:32:50,700
create a sacrificial Allen session they

902
00:32:48,060 --> 00:32:52,290
inject the hash into else's point into

903
00:32:50,700 --> 00:32:53,610
that session and then that pretty much

904
00:32:52,290 --> 00:32:56,129
kicks in the whole Kerberos

905
00:32:53,610 --> 00:32:58,919
authentication process with Rubeus you

906
00:32:56,130 --> 00:33:00,780
have a similar concept but Rubeus does

907
00:32:58,920 --> 00:33:03,360
not touch else s does not want to deal

908
00:33:00,780 --> 00:33:06,180
with that and crafts the whole packets

909
00:33:03,360 --> 00:33:08,639
to request a ticket gets a ticket back

910
00:33:06,180 --> 00:33:10,350
parses it in them and then imports it to

911
00:33:08,640 --> 00:33:13,470
the sacrificial logon session so it

912
00:33:10,350 --> 00:33:16,830
hasn't led else as doing it Rubeus is a

913
00:33:13,470 --> 00:33:19,020
tool built by harm joy or a wielder from

914
00:33:16,830 --> 00:33:21,629
inspector ops and it uses you know

915
00:33:19,020 --> 00:33:23,970
c-sharp to start also providing most of

916
00:33:21,630 --> 00:33:26,280
the functionalities of kikyo a project

917
00:33:23,970 --> 00:33:28,410
also by Benjamin Delpy and I'm gonna do

918
00:33:26,280 --> 00:33:32,010
a quick demo into how exactly that works

919
00:33:28,410 --> 00:33:37,170
and so the way we have some time still

920
00:33:32,010 --> 00:33:38,730
cool so if I just execute this what can

921
00:33:37,170 --> 00:33:40,980
I just do an hour pass the hash we're

922
00:33:38,730 --> 00:33:43,740
gonna use Pedro is my dog like I'm gonna

923
00:33:40,980 --> 00:33:45,090
make him famous and then we have the the

924
00:33:43,740 --> 00:33:48,230
commands that we're gonna use with

925
00:33:45,090 --> 00:33:50,580
Rovio's we have our victim it's an admin

926
00:33:48,230 --> 00:33:53,310
we do have our domain controller and

927
00:33:50,580 --> 00:33:55,439
then what I do with my victim is a try

928
00:33:53,310 --> 00:33:58,110
to understand if it's possible to query

929
00:33:55,440 --> 00:34:00,060
you know do a directory listing on the

930
00:33:58,110 --> 00:34:02,459
domain controller of course access the

931
00:34:00,060 --> 00:34:04,620
nine pedro has access to that and i only

932
00:34:02,460 --> 00:34:09,330
have two hash so let's just use Rufus

933
00:34:04,620 --> 00:34:10,620
for that and it creates a new process

934
00:34:09,330 --> 00:34:13,310
which is gonna be the one with the

935
00:34:10,620 --> 00:34:15,989
sacrificial logon session and then

936
00:34:13,310 --> 00:34:17,940
reviews already imported a ticket on

937
00:34:15,989 --> 00:34:20,569
that session so I should be able then to

938
00:34:17,940 --> 00:34:22,679
query write the domain controller

939
00:34:20,570 --> 00:34:25,200
nothing crazy

940
00:34:22,679 --> 00:34:27,960
I mean this has been done but you may

941
00:34:25,199 --> 00:34:30,540
because for years but the process you

942
00:34:27,960 --> 00:34:33,649
can see where ruby is is going to create

943
00:34:30,540 --> 00:34:36,989
a process with net only it's gonna do a

944
00:34:33,649 --> 00:34:39,330
lot on type nine new credentials using

945
00:34:36,989 --> 00:34:42,120
the hash that wasn't stolen and it's

946
00:34:39,330 --> 00:34:45,120
going to of course you know create a

947
00:34:42,120 --> 00:34:48,359
requests or crafted it's gonna receive

948
00:34:45,120 --> 00:34:49,830
the ticket before it's connecting to the

949
00:34:48,360 --> 00:34:51,899
domain controller over pour eight eight

950
00:34:49,830 --> 00:34:54,360
it's gonna request a ticket get to take

951
00:34:51,899 --> 00:34:57,450
it back and then each is imports the

952
00:34:54,360 --> 00:34:59,380
ticket so that's very interesting it's

953
00:34:57,450 --> 00:35:01,509
actually pretty cool

954
00:34:59,380 --> 00:35:06,240
you're pretty cool attack so let's just

955
00:35:01,510 --> 00:35:09,160
go back to this from current slide yep

956
00:35:06,240 --> 00:35:10,569
okay so it's pretty cool right because

957
00:35:09,160 --> 00:35:13,509
now we have this behavior that we

958
00:35:10,570 --> 00:35:15,940
identify them from from Rubeus we can

959
00:35:13,510 --> 00:35:17,380
start mapping reviews to specific

960
00:35:15,940 --> 00:35:19,150
actions going on in here

961
00:35:17,380 --> 00:35:21,370
where we can see successful

962
00:35:19,150 --> 00:35:23,700
authentication locally we logon type 9

963
00:35:21,370 --> 00:35:26,290
with new credentials we can see also

964
00:35:23,700 --> 00:35:28,210
reviews creating a process but then at

965
00:35:26,290 --> 00:35:29,620
the same time we can see also reviews

966
00:35:28,210 --> 00:35:31,480
connecting to the domain controller and

967
00:35:29,620 --> 00:35:33,520
then at the end it's gonna be the one

968
00:35:31,480 --> 00:35:36,190
handle in the hole Kerberos indication I

969
00:35:33,520 --> 00:35:38,650
can start mapping all that for example

970
00:35:36,190 --> 00:35:41,740
to specific events so I can at least say

971
00:35:38,650 --> 00:35:44,140
this is what I would like to use from a

972
00:35:41,740 --> 00:35:45,759
relevant data source perspective to

973
00:35:44,140 --> 00:35:47,980
start approaching you don't move this a

974
00:35:45,760 --> 00:35:49,750
little bit one interesting piece in here

975
00:35:47,980 --> 00:35:53,170
is that you can see I have system event

976
00:35:49,750 --> 00:35:55,000
ID 3 and you know five one five six from

977
00:35:53,170 --> 00:35:56,380
security I've seen clients saying I

978
00:35:55,000 --> 00:35:58,900
don't need system or some other people

979
00:35:56,380 --> 00:36:00,520
say I don't need security locks because

980
00:35:58,900 --> 00:36:03,160
this one is doing it well you have to

981
00:36:00,520 --> 00:36:04,570
understand that system for example gives

982
00:36:03,160 --> 00:36:06,790
you the username and the destination

983
00:36:04,570 --> 00:36:08,530
host and how do we know this because

984
00:36:06,790 --> 00:36:10,420
we're doing data dictionaries right

985
00:36:08,530 --> 00:36:12,880
there's no other way to know what fields

986
00:36:10,420 --> 00:36:14,290
are available when you do it with five

987
00:36:12,880 --> 00:36:17,080
one five six you don't get that

988
00:36:14,290 --> 00:36:19,810
information so if you're looking for

989
00:36:17,080 --> 00:36:21,720
stacking the values of users five one

990
00:36:19,810 --> 00:36:24,549
five six will not be your friend right

991
00:36:21,720 --> 00:36:27,100
this one will be your friend you can do

992
00:36:24,550 --> 00:36:29,830
this still find the user if you link it

993
00:36:27,100 --> 00:36:31,839
with another event that will match for

994
00:36:29,830 --> 00:36:33,310
example in a specific behavior or you

995
00:36:31,840 --> 00:36:34,990
can do like a time-based type of

996
00:36:33,310 --> 00:36:36,730
analysis but it gets a little

997
00:36:34,990 --> 00:36:39,910
complicated so you have to know which

998
00:36:36,730 --> 00:36:41,710
events will give you what when we talk

999
00:36:39,910 --> 00:36:43,690
about authentication also here with

1000
00:36:41,710 --> 00:36:45,880
reviews and mimic ads for example you

1001
00:36:43,690 --> 00:36:48,670
can see the mimic ads right it's going

1002
00:36:45,880 --> 00:36:51,100
to patch Alsace and then let's Alsace do

1003
00:36:48,670 --> 00:36:52,570
the whole process Rubeus is not going to

1004
00:36:51,100 --> 00:36:54,580
bother Alsace so at the end of the day

1005
00:36:52,570 --> 00:36:57,490
you have this process that is not Alsace

1006
00:36:54,580 --> 00:36:59,920
it's not a system user and it doesn't

1007
00:36:57,490 --> 00:37:02,379
have the signatures or anything from

1008
00:36:59,920 --> 00:37:07,000
Alsace and it's just talking to port 88

1009
00:37:02,380 --> 00:37:09,250
for example so from a system perspective

1010
00:37:07,000 --> 00:37:11,860
you get more information right you get

1011
00:37:09,250 --> 00:37:12,790
the system user you have a regular user

1012
00:37:11,860 --> 00:37:15,150
probably you know the

1013
00:37:12,790 --> 00:37:19,150
it needs to be of course and that mean

1014
00:37:15,150 --> 00:37:20,500
administrator can account and then at

1015
00:37:19,150 --> 00:37:21,850
the end you get information about how it

1016
00:37:20,500 --> 00:37:23,610
connects to the domain controller

1017
00:37:21,850 --> 00:37:26,049
through poor 8a

1018
00:37:23,610 --> 00:37:28,840
so the other day if I can throw this to

1019
00:37:26,050 --> 00:37:31,450
my either lab environment or to my to my

1020
00:37:28,840 --> 00:37:34,180
environment in production I can see that

1021
00:37:31,450 --> 00:37:35,740
if I look for destination port 88 I will

1022
00:37:34,180 --> 00:37:38,049
be able to find that most of them will

1023
00:37:35,740 --> 00:37:39,669
be else as doing all that do this when

1024
00:37:38,050 --> 00:37:41,500
you go back to your organization please

1025
00:37:39,670 --> 00:37:43,720
because I've done it in a couple of

1026
00:37:41,500 --> 00:37:46,260
organizations and you will be surprised

1027
00:37:43,720 --> 00:37:48,220
that there is only a few applications

1028
00:37:46,260 --> 00:37:50,770
performing these connections to a domain

1029
00:37:48,220 --> 00:37:52,600
controller through port 8080 and so it's

1030
00:37:50,770 --> 00:37:54,280
very interesting to start using that

1031
00:37:52,600 --> 00:37:57,880
data and to start probably finding

1032
00:37:54,280 --> 00:38:00,310
potential rubyists like type of behavior

1033
00:37:57,880 --> 00:38:01,870
right because we cannot just say you're

1034
00:38:00,310 --> 00:38:03,040
gonna find Rufio stat Exe right

1035
00:38:01,870 --> 00:38:05,430
but at least you're gonna find the

1036
00:38:03,040 --> 00:38:08,050
behavior itself is very very interesting

1037
00:38:05,430 --> 00:38:10,290
from a sacrificial logon session which

1038
00:38:08,050 --> 00:38:17,110
one is mimic as in which one is Rubeus

1039
00:38:10,290 --> 00:38:17,620
which means mimikatz left or right all

1040
00:38:17,110 --> 00:38:20,290
right

1041
00:38:17,620 --> 00:38:24,819
there's a quiz for infra red teamers and

1042
00:38:20,290 --> 00:38:26,470
blue teamers somebody said right I heard

1043
00:38:24,820 --> 00:38:29,170
somebody said right but mimikatz is the

1044
00:38:26,470 --> 00:38:31,000
left and rubio's is the right and

1045
00:38:29,170 --> 00:38:33,550
probably have more information in here

1046
00:38:31,000 --> 00:38:35,920
that's because when you do a sacrificial

1047
00:38:33,550 --> 00:38:39,820
law one session you're just doing random

1048
00:38:35,920 --> 00:38:41,590
dummy username domain and passwords to

1049
00:38:39,820 --> 00:38:45,310
create that process with the sacrificial

1050
00:38:41,590 --> 00:38:47,560
logon session mimikatz takes the you

1051
00:38:45,310 --> 00:38:50,590
know parameters that you use for you

1052
00:38:47,560 --> 00:38:53,020
know for user for in domain and then at

1053
00:38:50,590 --> 00:38:55,720
the end you can pretty much have that in

1054
00:38:53,020 --> 00:38:57,640
the log so me Macca's who actually

1055
00:38:55,720 --> 00:38:59,680
improve my perspective right now it

1056
00:38:57,640 --> 00:39:01,509
would be boo blend in a little bit more

1057
00:38:59,680 --> 00:39:04,359
than Rubeus as you can see because

1058
00:39:01,510 --> 00:39:07,090
review has a random strings that's

1059
00:39:04,360 --> 00:39:09,520
because there is a specific function

1060
00:39:07,090 --> 00:39:11,860
they're being used that applies the you

1061
00:39:09,520 --> 00:39:14,110
know random strings for the values of

1062
00:39:11,860 --> 00:39:16,090
the username domain and password so you

1063
00:39:14,110 --> 00:39:18,100
know that's what rules does it so very

1064
00:39:16,090 --> 00:39:20,200
interesting also you know thing to look

1065
00:39:18,100 --> 00:39:22,390
at and at the end of the day you can

1066
00:39:20,200 --> 00:39:24,430
find more sacrificial organizations

1067
00:39:22,390 --> 00:39:26,540
across your network if you're collecting

1068
00:39:24,430 --> 00:39:29,000
the right data we have mimic ants

1069
00:39:26,540 --> 00:39:30,950
we have reviews and we have also you

1070
00:39:29,000 --> 00:39:33,080
know bypass you otoki manipulation for

1071
00:39:30,950 --> 00:39:34,899
example so that's the one from toka

1072
00:39:33,080 --> 00:39:37,970
manipulation of course that could be

1073
00:39:34,900 --> 00:39:39,530
adjusted but if somebody's using this

1074
00:39:37,970 --> 00:39:41,689
type of behavior at least you know that

1075
00:39:39,530 --> 00:39:43,160
that data set would allow you to you

1076
00:39:41,690 --> 00:39:45,170
know get to that specific type of

1077
00:39:43,160 --> 00:39:47,569
behavior you might be asking yourself

1078
00:39:45,170 --> 00:39:48,860
okay that's awesome how do I learn about

1079
00:39:47,570 --> 00:39:50,150
these things also from a data

1080
00:39:48,860 --> 00:39:52,190
perspective like I don't have the

1081
00:39:50,150 --> 00:39:54,170
expertise to do all these executions of

1082
00:39:52,190 --> 00:39:55,820
of all these techniques there is a

1083
00:39:54,170 --> 00:39:57,830
project that will release a couple weeks

1084
00:39:55,820 --> 00:40:00,410
ago called Mordor has you know pre

1085
00:39:57,830 --> 00:40:02,240
security you know events generated by

1086
00:40:00,410 --> 00:40:04,129
specific techniques and you might be

1087
00:40:02,240 --> 00:40:06,319
asking yourself why do we know this or

1088
00:40:04,130 --> 00:40:08,300
you don't need this and this is of

1089
00:40:06,320 --> 00:40:10,160
course a you know map to the might

1090
00:40:08,300 --> 00:40:11,690
attack framework as well that's because

1091
00:40:10,160 --> 00:40:13,370
if you want to do something like this is

1092
00:40:11,690 --> 00:40:16,070
sync and you say I want to learn about

1093
00:40:13,370 --> 00:40:19,190
this sync you know like the abuse of AD

1094
00:40:16,070 --> 00:40:21,680
replication services because I know that

1095
00:40:19,190 --> 00:40:24,440
my domain admins have this permission so

1096
00:40:21,680 --> 00:40:25,669
they can do it so if somebody if there

1097
00:40:24,440 --> 00:40:28,370
is replication in my environment

1098
00:40:25,670 --> 00:40:31,580
happening from a non domain computer

1099
00:40:28,370 --> 00:40:33,529
from a known domain controller account

1100
00:40:31,580 --> 00:40:34,940
and it's happening from somebody else

1101
00:40:33,530 --> 00:40:36,290
that doesn't have the dollar sign at the

1102
00:40:34,940 --> 00:40:39,080
end that is part of my domain controller

1103
00:40:36,290 --> 00:40:41,210
name you're gonna start doing this and

1104
00:40:39,080 --> 00:40:43,009
crazy you know building your detection

1105
00:40:41,210 --> 00:40:45,230
lab and then stand in all these boxes

1106
00:40:43,010 --> 00:40:47,150
and trying to do all these things then

1107
00:40:45,230 --> 00:40:49,580
you're gonna find specific ways to do it

1108
00:40:47,150 --> 00:40:52,280
through PowerShell Python through pure

1109
00:40:49,580 --> 00:40:55,100
that net just can do whatever the data

1110
00:40:52,280 --> 00:40:57,410
is gonna be similar the relevant data

1111
00:40:55,100 --> 00:41:01,009
associated with that behavior is gonna

1112
00:40:57,410 --> 00:41:03,589
be a similar data set okay I can do it

1113
00:41:01,010 --> 00:41:06,170
through impact it cool I can do this

1114
00:41:03,590 --> 00:41:08,030
I'm not touching or not my users I'm

1115
00:41:06,170 --> 00:41:11,420
just doing a whole relay as well if I

1116
00:41:08,030 --> 00:41:12,710
could date is going to be the same the

1117
00:41:11,420 --> 00:41:14,210
data is going to still generate this

1118
00:41:12,710 --> 00:41:16,490
event which is going to tell me there is

1119
00:41:14,210 --> 00:41:18,950
a some type of access you know request

1120
00:41:16,490 --> 00:41:21,319
to a domain object with the you know

1121
00:41:18,950 --> 00:41:23,660
replication also you know permissions as

1122
00:41:21,320 --> 00:41:25,970
well so the goal of Mordor is to allow

1123
00:41:23,660 --> 00:41:27,799
you to for us to share those data sets

1124
00:41:25,970 --> 00:41:29,120
because we're ready to care of the whole

1125
00:41:27,800 --> 00:41:32,120
execution if you want to learn about

1126
00:41:29,120 --> 00:41:33,950
execution due for example the atomic

1127
00:41:32,120 --> 00:41:36,140
read team project if you want to focus

1128
00:41:33,950 --> 00:41:38,810
on the data directly you can use model

1129
00:41:36,140 --> 00:41:40,160
and how does that work you can consume

1130
00:41:38,810 --> 00:41:42,680
the data

1131
00:41:40,160 --> 00:41:45,020
the Kafka cat which is a tool that would

1132
00:41:42,680 --> 00:41:46,850
allow me to grab the JSON files push

1133
00:41:45,020 --> 00:41:49,370
into a Kafka broker and then you can

1134
00:41:46,850 --> 00:41:51,020
pretty much you know you say with else

1135
00:41:49,370 --> 00:41:52,819
tax to Paterno books any other

1136
00:41:51,020 --> 00:41:56,330
application that can consume that data

1137
00:41:52,820 --> 00:41:58,820
as well this is how easy is Kafka CAD

1138
00:41:56,330 --> 00:42:00,799
pointing to a Kafka broker the help

1139
00:41:58,820 --> 00:42:02,360
comes actually with a broker itself so

1140
00:42:00,800 --> 00:42:05,930
you can use point it to the to the port

1141
00:42:02,360 --> 00:42:08,420
a specific port specific topic and then

1142
00:42:05,930 --> 00:42:10,700
it's gonna be in what is called producer

1143
00:42:08,420 --> 00:42:12,320
mode point it to the specific JSON file

1144
00:42:10,700 --> 00:42:15,080
that we share and you're gonna have data

1145
00:42:12,320 --> 00:42:16,970
in two seconds you can pretty much run a

1146
00:42:15,080 --> 00:42:19,520
query on that data and you'll be able to

1147
00:42:16,970 --> 00:42:22,640
find whatever it was a DC sync type of

1148
00:42:19,520 --> 00:42:25,730
attack so this is very interesting

1149
00:42:22,640 --> 00:42:27,350
because now you can do your analysis on

1150
00:42:25,730 --> 00:42:29,330
data set that has been already created

1151
00:42:27,350 --> 00:42:31,610
in an environment that was similar to

1152
00:42:29,330 --> 00:42:34,190
also a minor attack uses for the evils

1153
00:42:31,610 --> 00:42:36,680
with three computers domain controller a

1154
00:42:34,190 --> 00:42:38,360
specific collector and inside that so

1155
00:42:36,680 --> 00:42:40,220
we're doing all the stuff and it's

1156
00:42:38,360 --> 00:42:43,070
already documented what's next for

1157
00:42:40,220 --> 00:42:44,509
Mordor and I only have a few seconds we

1158
00:42:43,070 --> 00:42:47,060
want to release today we're gonna

1159
00:42:44,510 --> 00:42:49,310
announce the apt three the data set

1160
00:42:47,060 --> 00:42:52,730
because last year the attack team came

1161
00:42:49,310 --> 00:42:55,509
with apt three emulation talk and that

1162
00:42:52,730 --> 00:42:58,040
was also from a Red Team perspective I

1163
00:42:55,510 --> 00:43:00,320
got the inspiration from that talk from

1164
00:42:58,040 --> 00:43:02,480
here and now I'm bringing the data set

1165
00:43:00,320 --> 00:43:04,730
which you can watch the other

1166
00:43:02,480 --> 00:43:06,800
presentation about how they did it I can

1167
00:43:04,730 --> 00:43:08,150
show you the data set as well so you

1168
00:43:06,800 --> 00:43:09,980
know the day you can pretty much point

1169
00:43:08,150 --> 00:43:11,840
it to the apt three data set and you

1170
00:43:09,980 --> 00:43:14,480
will be able to have the data as well

1171
00:43:11,840 --> 00:43:18,140
and before I leave to the last my last

1172
00:43:14,480 --> 00:43:20,810
thing here it's already there at least

1173
00:43:18,140 --> 00:43:24,910
the definition of the apt three data set

1174
00:43:20,810 --> 00:43:27,140
I do have this specific I would say

1175
00:43:24,910 --> 00:43:29,149
resource files that are used for Empire

1176
00:43:27,140 --> 00:43:30,589
and at the end of the day you can pretty

1177
00:43:29,150 --> 00:43:32,060
much start playing with this I'm

1178
00:43:30,590 --> 00:43:33,770
releasing the data set at the end of the

1179
00:43:32,060 --> 00:43:35,570
week because I want to make sure that

1180
00:43:33,770 --> 00:43:37,430
everything loose it was good in there

1181
00:43:35,570 --> 00:43:39,500
but at least all the things that are

1182
00:43:37,430 --> 00:43:43,850
used are in there and you can actually

1183
00:43:39,500 --> 00:43:45,350
also access the specific file that was

1184
00:43:43,850 --> 00:43:48,920
used as the playbook

1185
00:43:45,350 --> 00:43:54,049
because miter attack shared their

1186
00:43:48,920 --> 00:43:57,380
playbook but they only share Metasploit

1187
00:43:54,050 --> 00:43:59,360
and the other one is well Kabul strike I

1188
00:43:57,380 --> 00:44:01,610
actually was able to map that all the

1189
00:43:59,360 --> 00:44:04,880
way to PowerShell Empire so I have every

1190
00:44:01,610 --> 00:44:06,740
single every single command mapped to a

1191
00:44:04,880 --> 00:44:08,960
technique mapped on a specific step on

1192
00:44:06,740 --> 00:44:12,080
the eval for mitre attack and now you

1193
00:44:08,960 --> 00:44:16,460
have the data set as well and that would

1194
00:44:12,080 --> 00:44:18,080
be it let me just go back here thank you

1195
00:44:16,460 --> 00:44:19,850
very much everybody and I hope that you

1196
00:44:18,080 --> 00:44:21,920
guys enjoyed the presentation and these

1197
00:44:19,850 --> 00:44:26,799
are some links for you also to go back

1198
00:44:21,920 --> 00:44:26,800
with thank you guys

1199
00:44:29,730 --> 00:44:31,790
you

