1
00:00:01,850 --> 00:00:07,119
[Music]

2
00:00:07,120 --> 00:00:09,679
hello welcome to zeefcon

3
00:00:09,679 --> 00:00:11,200
welcome to the afternoon you made it

4
00:00:11,200 --> 00:00:12,480
this far

5
00:00:12,480 --> 00:00:14,000
how's everyone doing y'all enjoying the

6
00:00:14,000 --> 00:00:17,000
conference

7
00:00:17,680 --> 00:00:20,400
all right so this is not as a technical

8
00:00:20,400 --> 00:00:21,920
talk as we've seen

9
00:00:21,920 --> 00:00:24,000
some talks be

10
00:00:24,000 --> 00:00:25,920
that's fine but i think what

11
00:00:25,920 --> 00:00:27,279
implementation

12
00:00:27,279 --> 00:00:28,800
of this theory

13
00:00:28,800 --> 00:00:31,039
of what we're trying to get to will help

14
00:00:31,039 --> 00:00:33,120
better

15
00:00:33,120 --> 00:00:34,079
conduct

16
00:00:34,079 --> 00:00:36,880
adversary emulations better conduct red

17
00:00:36,880 --> 00:00:38,879
teaming engagements

18
00:00:38,879 --> 00:00:40,480
and better drive

19
00:00:40,480 --> 00:00:42,399
purple teams understanding about what

20
00:00:42,399 --> 00:00:45,120
adversaries are doing

21
00:00:45,120 --> 00:00:48,000
so with that who am i i'm christopher

22
00:00:48,000 --> 00:00:49,520
peacock

23
00:00:49,520 --> 00:00:50,320
i

24
00:00:50,320 --> 00:00:53,120
started out as a help desk engineer and

25
00:00:53,120 --> 00:00:56,559
then moved into networking at alpha 2. i

26
00:00:56,559 --> 00:00:58,640
finally moved on to a

27
00:00:58,640 --> 00:01:00,559
sock tier 3 roll

28
00:01:00,559 --> 00:01:03,199
or tier 2 role at general dynamics i

29
00:01:03,199 --> 00:01:05,360
also started doing purple test purple

30
00:01:05,360 --> 00:01:07,119
team testing

31
00:01:07,119 --> 00:01:08,799
back before it was really called purple

32
00:01:08,799 --> 00:01:11,119
teaming

33
00:01:11,119 --> 00:01:12,560
back in the day you always wanted to

34
00:01:12,560 --> 00:01:14,640
beat the pin testers to make your boss

35
00:01:14,640 --> 00:01:16,560
look good so we actually started doing

36
00:01:16,560 --> 00:01:18,320
stuff like running mimi cats and

37
00:01:18,320 --> 00:01:20,640
kerberos and things like that

38
00:01:20,640 --> 00:01:23,200
and that started my drive of trying to

39
00:01:23,200 --> 00:01:26,080
understand what adversaries do and what

40
00:01:26,080 --> 00:01:28,560
it looks like in the environment because

41
00:01:28,560 --> 00:01:31,280
growing up and learning information

42
00:01:31,280 --> 00:01:32,479
security

43
00:01:32,479 --> 00:01:34,400
on the blue side it was one of those

44
00:01:34,400 --> 00:01:35,520
things of

45
00:01:35,520 --> 00:01:39,600
antivirus catches malware malware is bad

46
00:01:39,600 --> 00:01:41,439
remove malware

47
00:01:41,439 --> 00:01:42,880
and then we realize that really wasn't

48
00:01:42,880 --> 00:01:43,920
working

49
00:01:43,920 --> 00:01:46,079
because everyone kept getting popped and

50
00:01:46,079 --> 00:01:47,759
i think that's quite evident by just

51
00:01:47,759 --> 00:01:50,880
ransomware and how prevalent it is

52
00:01:50,880 --> 00:01:53,360
across multiple industries it shows that

53
00:01:53,360 --> 00:01:54,960
organizations from a defensive

54
00:01:54,960 --> 00:01:57,360
standpoint are nowhere near where they

55
00:01:57,360 --> 00:01:59,759
need to be and also they haven't been

56
00:01:59,759 --> 00:02:01,119
learning

57
00:02:01,119 --> 00:02:02,159
uh

58
00:02:02,159 --> 00:02:04,560
you know how to actually prevent attacks

59
00:02:04,560 --> 00:02:06,960
from happening and preparing themselves

60
00:02:06,960 --> 00:02:08,160
for that and that's why i think we're

61
00:02:08,160 --> 00:02:10,318
here in a purple team conference is to

62
00:02:10,318 --> 00:02:11,520
help uh

63
00:02:11,520 --> 00:02:12,800
organizations have a better

64
00:02:12,800 --> 00:02:14,400
understanding of what's actually going

65
00:02:14,400 --> 00:02:16,400
on so from general dynamics and doing

66
00:02:16,400 --> 00:02:18,640
that sock tier 2 work i went to raytheon

67
00:02:18,640 --> 00:02:22,480
intelligence where i was at an mssp had

68
00:02:22,480 --> 00:02:24,750
multiple clients across multiple

69
00:02:24,750 --> 00:02:26,400
[Music]

70
00:02:26,400 --> 00:02:28,879
industries and i worked everything from

71
00:02:28,879 --> 00:02:32,000
incident response there to sock tier 3

72
00:02:32,000 --> 00:02:33,840
to threat hunting

73
00:02:33,840 --> 00:02:35,440
incident responder i think i already

74
00:02:35,440 --> 00:02:36,560
said that

75
00:02:36,560 --> 00:02:37,599
and

76
00:02:37,599 --> 00:02:39,920
lead intelligence as well

77
00:02:39,920 --> 00:02:41,519
so pretty much a jack of all trades

78
00:02:41,519 --> 00:02:44,080
there and had my hat in many different

79
00:02:44,080 --> 00:02:45,760
areas and then from there i'm now at

80
00:02:45,760 --> 00:02:48,400
scythe where we do adversary emulation

81
00:02:48,400 --> 00:02:50,959
and detection engineering

82
00:02:50,959 --> 00:02:52,560
and that's where i kind of went down

83
00:02:52,560 --> 00:02:54,000
this rabbit hole

84
00:02:54,000 --> 00:02:55,920
and hopefully i can share some of the

85
00:02:55,920 --> 00:02:57,280
knowledge gained

86
00:02:57,280 --> 00:02:58,879
from the rabbit hole i went down and

87
00:02:58,879 --> 00:03:01,120
help you all better do emulation and

88
00:03:01,120 --> 00:03:03,280
purple team engagements

89
00:03:03,280 --> 00:03:06,239
so one of the things with the

90
00:03:06,239 --> 00:03:09,120
intelligence timeline that we see

91
00:03:09,120 --> 00:03:11,040
we really didn't have cyber threat

92
00:03:11,040 --> 00:03:13,920
intelligence for a while

93
00:03:13,920 --> 00:03:16,400
and then we got the kill chain and this

94
00:03:16,400 --> 00:03:18,560
is a great uh write-up if you ever get

95
00:03:18,560 --> 00:03:19,599
the chance

96
00:03:19,599 --> 00:03:21,680
the kill chain is

97
00:03:21,680 --> 00:03:24,319
a great structure that you can start

98
00:03:24,319 --> 00:03:27,120
categorizing adversaries

99
00:03:27,120 --> 00:03:28,720
actions

100
00:03:28,720 --> 00:03:30,400
into different steps of a kill chain and

101
00:03:30,400 --> 00:03:33,280
you can start mapping that to defense

102
00:03:33,280 --> 00:03:35,760
well with that as well

103
00:03:35,760 --> 00:03:37,680
you can get into things like diamond

104
00:03:37,680 --> 00:03:39,200
modeling and you can start tracking

105
00:03:39,200 --> 00:03:41,360
adversaries and that's great but it

106
00:03:41,360 --> 00:03:44,319
didn't really give us a lot of

107
00:03:44,319 --> 00:03:46,720
actions sort of so to speak from the

108
00:03:46,720 --> 00:03:50,080
blue team side it was more just a way to

109
00:03:50,080 --> 00:03:53,280
bucket what we did to say these rules

110
00:03:53,280 --> 00:03:55,760
are applicable for this area or these

111
00:03:55,760 --> 00:03:58,080
rules are applicable for this area

112
00:03:58,080 --> 00:03:59,680
so we had the kill chain

113
00:03:59,680 --> 00:04:00,640
and

114
00:04:00,640 --> 00:04:02,640
um some time went on and then we finally

115
00:04:02,640 --> 00:04:05,760
had the apt-1 report and with the apt-1

116
00:04:05,760 --> 00:04:07,280
report

117
00:04:07,280 --> 00:04:08,799
it was the first time that we actually

118
00:04:08,799 --> 00:04:10,799
started looking at adversaries right we

119
00:04:10,799 --> 00:04:13,200
started moving past antivirus we

120
00:04:13,200 --> 00:04:15,840
actually saw that there's humans behind

121
00:04:15,840 --> 00:04:18,160
the operation it's not just a worm that

122
00:04:18,160 --> 00:04:21,040
just spreads like i love you worm

123
00:04:21,040 --> 00:04:22,479
and then finally we have the pyramid of

124
00:04:22,479 --> 00:04:24,720
pain we'll cover that a little bit later

125
00:04:24,720 --> 00:04:27,199
oh by the way how many people are red

126
00:04:27,199 --> 00:04:29,759
teamers by chance

127
00:04:29,759 --> 00:04:31,520
how many people are blue teamers by

128
00:04:31,520 --> 00:04:32,880
chance

129
00:04:32,880 --> 00:04:34,639
okay we actually have a good split okay

130
00:04:34,639 --> 00:04:37,120
nice any purple teamers anyone on both

131
00:04:37,120 --> 00:04:38,960
sides

132
00:04:38,960 --> 00:04:40,479
all right all right

133
00:04:40,479 --> 00:04:42,320
it's it's up and coming you know it's an

134
00:04:42,320 --> 00:04:44,000
off-a-coming field

135
00:04:44,000 --> 00:04:46,240
and then uh so from the pyramid of pain

136
00:04:46,240 --> 00:04:47,919
i think a lot of blue teamers will be

137
00:04:47,919 --> 00:04:49,600
familiar with that

138
00:04:49,600 --> 00:04:51,919
red teamers might be something new then

139
00:04:51,919 --> 00:04:53,520
we get some minor attack and that's kind

140
00:04:53,520 --> 00:04:55,440
of where everyone's at now everyone

141
00:04:55,440 --> 00:04:57,360
loves talking about miter attack and

142
00:04:57,360 --> 00:04:59,520
technique coverage and we'll dive into

143
00:04:59,520 --> 00:05:02,320
that a little bit and where we're going

144
00:05:02,320 --> 00:05:04,639
so with the apt-1 report one of the

145
00:05:04,639 --> 00:05:06,240
interesting things is

146
00:05:06,240 --> 00:05:08,320
we're actually focused on the human

147
00:05:08,320 --> 00:05:10,639
element

148
00:05:10,639 --> 00:05:11,919
this is where we actually understand

149
00:05:11,919 --> 00:05:14,000
that there's organizations

150
00:05:14,000 --> 00:05:16,400
behind the actions taken

151
00:05:16,400 --> 00:05:17,840
and this is important because when you

152
00:05:17,840 --> 00:05:19,840
think about organizations

153
00:05:19,840 --> 00:05:22,160
it could be ransomware actors

154
00:05:22,160 --> 00:05:24,880
they're an organization crime groups

155
00:05:24,880 --> 00:05:27,039
it could be an advanced persistent

156
00:05:27,039 --> 00:05:30,400
threat it's an organization as well

157
00:05:30,400 --> 00:05:33,120
with organizations

158
00:05:33,120 --> 00:05:34,960
you have a lot of

159
00:05:34,960 --> 00:05:37,199
things that start getting repeated at

160
00:05:37,199 --> 00:05:39,759
the procedure level and that's because

161
00:05:39,759 --> 00:05:41,680
they have tendencies even if it's just

162
00:05:41,680 --> 00:05:43,120
one person

163
00:05:43,120 --> 00:05:45,039
if you did something the past five

164
00:05:45,039 --> 00:05:46,960
engagements as a red teamer

165
00:05:46,960 --> 00:05:48,880
you're probably going to try that trick

166
00:05:48,880 --> 00:05:51,440
again on your next engagement

167
00:05:51,440 --> 00:05:53,440
within an organization too

168
00:05:53,440 --> 00:05:56,960
they have certain approved tooling

169
00:05:56,960 --> 00:05:58,560
if you're going up up against an

170
00:05:58,560 --> 00:06:00,319
advanced persistent threat

171
00:06:00,319 --> 00:06:03,039
it takes time for them to actually have

172
00:06:03,039 --> 00:06:05,120
tooling that gets approved to use in

173
00:06:05,120 --> 00:06:07,440
their environment

174
00:06:07,440 --> 00:06:09,120
similarly too

175
00:06:09,120 --> 00:06:11,280
it takes time to get used to certain

176
00:06:11,280 --> 00:06:12,240
tooling

177
00:06:12,240 --> 00:06:13,680
and that comes down to training maybe

178
00:06:13,680 --> 00:06:15,199
you have training in certain tooling

179
00:06:15,199 --> 00:06:16,560
maybe you have training in certain

180
00:06:16,560 --> 00:06:19,680
procedures maybe you go to

181
00:06:19,680 --> 00:06:22,080
a youtube video and it says you type

182
00:06:22,080 --> 00:06:24,800
this command in you get this result you

183
00:06:24,800 --> 00:06:27,280
take that result and you put it in here

184
00:06:27,280 --> 00:06:29,600
so training is again

185
00:06:29,600 --> 00:06:31,759
and then manuals as well such as the

186
00:06:31,759 --> 00:06:33,759
conte manual

187
00:06:33,759 --> 00:06:36,400
a huge resource you can see that people

188
00:06:36,400 --> 00:06:38,800
follow manuals

189
00:06:38,800 --> 00:06:42,000
so what we're getting at here is that

190
00:06:42,000 --> 00:06:44,479
av i think most of us in this room know

191
00:06:44,479 --> 00:06:47,360
that av hasn't cut it if not we wouldn't

192
00:06:47,360 --> 00:06:48,960
have a career because

193
00:06:48,960 --> 00:06:51,360
av would work and it'd be

194
00:06:51,360 --> 00:06:54,000
left up to them and we'd be out of jobs

195
00:06:54,000 --> 00:06:54,880
but

196
00:06:54,880 --> 00:06:56,960
there's humans behind it

197
00:06:56,960 --> 00:06:59,360
in the apt-1 report it brought up that

198
00:06:59,360 --> 00:07:01,520
they have certain procedures that these

199
00:07:01,520 --> 00:07:02,800
humans run

200
00:07:02,800 --> 00:07:05,360
with the malware that they use

201
00:07:05,360 --> 00:07:08,160
and the interesting thing here is

202
00:07:08,160 --> 00:07:10,160
this was back in the

203
00:07:10,160 --> 00:07:11,840
early teens

204
00:07:11,840 --> 00:07:14,560
what 2014 i think 2015

205
00:07:14,560 --> 00:07:16,479
this was released

206
00:07:16,479 --> 00:07:20,319
we see a bunch of net view net group

207
00:07:20,319 --> 00:07:21,919
net local group

208
00:07:21,919 --> 00:07:24,639
we see all these procedures

209
00:07:24,639 --> 00:07:26,080
but what we failed to do is actually

210
00:07:26,080 --> 00:07:28,479
make these actionable we're not actually

211
00:07:28,479 --> 00:07:29,680
testing

212
00:07:29,680 --> 00:07:32,080
these procedures in organizations and

213
00:07:32,080 --> 00:07:34,000
helping blue teams and organizations

214
00:07:34,000 --> 00:07:36,160
defend against themselves

215
00:07:36,160 --> 00:07:38,479
and i can show you this because when i

216
00:07:38,479 --> 00:07:40,479
go to the comptia playbook these

217
00:07:40,479 --> 00:07:43,280
commands should look familiar because

218
00:07:43,280 --> 00:07:46,479
they were used in the apt-1 report

219
00:07:46,479 --> 00:07:50,400
so we had over what half a decade

220
00:07:50,400 --> 00:07:52,000
and the same procedures are still

221
00:07:52,000 --> 00:07:53,840
operating on networks without getting

222
00:07:53,840 --> 00:07:55,599
caught and it's because we failed to

223
00:07:55,599 --> 00:07:58,240
evolve as blue teamers to the procedures

224
00:07:58,240 --> 00:08:01,039
that the adversaries were using

225
00:08:01,039 --> 00:08:02,720
so with that

226
00:08:02,720 --> 00:08:06,000
we also go down to the pyramid of pain

227
00:08:06,000 --> 00:08:07,680
now if you're not used to this that's

228
00:08:07,680 --> 00:08:09,680
fine we'll go over it briefly there's a

229
00:08:09,680 --> 00:08:12,960
great write-up though by david bianco

230
00:08:12,960 --> 00:08:15,120
and he starts out with hash values if

231
00:08:15,120 --> 00:08:16,240
you're a red teamer i'm sure you

232
00:08:16,240 --> 00:08:17,919
probably generate a new hash every

233
00:08:17,919 --> 00:08:19,759
payload and you probably put multiple

234
00:08:19,759 --> 00:08:21,680
payloads in an environment

235
00:08:21,680 --> 00:08:23,280
so that way

236
00:08:23,280 --> 00:08:25,360
when one hash gets caught you're going

237
00:08:25,360 --> 00:08:26,400
to have other

238
00:08:26,400 --> 00:08:28,479
payloads that are available to you

239
00:08:28,479 --> 00:08:31,039
so we don't really want to focus here

240
00:08:31,039 --> 00:08:33,760
from the defensive side it's trivial for

241
00:08:33,760 --> 00:08:36,958
a threat actor to change the hash

242
00:08:36,958 --> 00:08:39,120
then we get to ip address it's very

243
00:08:39,120 --> 00:08:41,679
trivial or easy for them to change that

244
00:08:41,679 --> 00:08:43,679
domain names

245
00:08:43,679 --> 00:08:45,519
it's very easy to change that you can do

246
00:08:45,519 --> 00:08:47,200
it with an algorithm you have domain

247
00:08:47,200 --> 00:08:50,000
generated or algorithm

248
00:08:50,000 --> 00:08:51,920
algorithms algorithms that generate

249
00:08:51,920 --> 00:08:54,320
domain names so that's very simple for

250
00:08:54,320 --> 00:08:56,480
threat actors to change

251
00:08:56,480 --> 00:08:58,000
so we're really not focused on any of

252
00:08:58,000 --> 00:08:58,959
this

253
00:08:58,959 --> 00:09:01,680
from a perspective of defense

254
00:09:01,680 --> 00:09:03,600
now we do pay

255
00:09:03,600 --> 00:09:05,200
ioc feeds

256
00:09:05,200 --> 00:09:07,600
to bring these into our environment and

257
00:09:07,600 --> 00:09:10,000
then check for you know compliance

258
00:09:10,000 --> 00:09:12,959
reasons if someone's known to be bad we

259
00:09:12,959 --> 00:09:15,279
do want to check for that but our focus

260
00:09:15,279 --> 00:09:17,040
shouldn't be here we don't want to waste

261
00:09:17,040 --> 00:09:19,519
time for this we can automate it and we

262
00:09:19,519 --> 00:09:21,920
can do that validation check so to speak

263
00:09:21,920 --> 00:09:23,839
but we know a good adversary will just

264
00:09:23,839 --> 00:09:25,360
get around that

265
00:09:25,360 --> 00:09:28,399
we get up to network and host artifacts

266
00:09:28,399 --> 00:09:30,320
and tooling now this is where things

267
00:09:30,320 --> 00:09:32,320
start getting more challenging

268
00:09:32,320 --> 00:09:34,240
but still at this point most of the time

269
00:09:34,240 --> 00:09:37,200
we're relying on our vendors still to do

270
00:09:37,200 --> 00:09:39,680
this so for network artifacts you know

271
00:09:39,680 --> 00:09:41,839
we're starting to look at our ids ips

272
00:09:41,839 --> 00:09:44,399
vendor to address those issues and track

273
00:09:44,399 --> 00:09:45,519
those

274
00:09:45,519 --> 00:09:47,279
and then tooling we're looking at our

275
00:09:47,279 --> 00:09:48,880
edr and av

276
00:09:48,880 --> 00:09:51,040
and things like yara to do that and at

277
00:09:51,040 --> 00:09:53,760
the top of david bianco's pyramid he put

278
00:09:53,760 --> 00:09:55,600
ttps

279
00:09:55,600 --> 00:09:57,519
now this is one of the things that us in

280
00:09:57,519 --> 00:09:59,600
the industry and i've been guilty of it

281
00:09:59,600 --> 00:10:02,240
myself we throw around ttps we say the

282
00:10:02,240 --> 00:10:05,440
ttps of the adversary the ttps did this

283
00:10:05,440 --> 00:10:07,360
they did that

284
00:10:07,360 --> 00:10:09,600
but we're just throwing it around

285
00:10:09,600 --> 00:10:12,079
and with that

286
00:10:12,079 --> 00:10:12,880
we

287
00:10:12,880 --> 00:10:14,560
aren't really getting down to granular

288
00:10:14,560 --> 00:10:15,519
levels

289
00:10:15,519 --> 00:10:16,480
of what

290
00:10:16,480 --> 00:10:17,640
each

291
00:10:17,640 --> 00:10:20,160
ttp stands for

292
00:10:20,160 --> 00:10:21,760
and we'll break that out later but for

293
00:10:21,760 --> 00:10:24,640
now one of the things to highlight

294
00:10:24,640 --> 00:10:26,560
is what those atomic indicators that we

295
00:10:26,560 --> 00:10:29,920
were talking about before

296
00:10:29,920 --> 00:10:33,120
with the hashes just to show why if if

297
00:10:33,120 --> 00:10:34,640
you're ever on an engagement from the

298
00:10:34,640 --> 00:10:36,160
red team side

299
00:10:36,160 --> 00:10:37,680
or if you're on the blue team side and

300
00:10:37,680 --> 00:10:39,519
your boss is asking you to go after

301
00:10:39,519 --> 00:10:40,800
hashes

302
00:10:40,800 --> 00:10:42,320
this is why it's not really worth the

303
00:10:42,320 --> 00:10:44,480
time because

304
00:10:44,480 --> 00:10:47,360
in 91 percent of the submissions that

305
00:10:47,360 --> 00:10:49,360
david bianco reviewed

306
00:10:49,360 --> 00:10:51,360
they were only submitted from one source

307
00:10:51,360 --> 00:10:54,160
so this shows that when we have an

308
00:10:54,160 --> 00:10:56,240
ioc feed with hashes

309
00:10:56,240 --> 00:10:58,399
most likely it's not going to add that

310
00:10:58,399 --> 00:11:01,120
much value to our organization

311
00:11:01,120 --> 00:11:03,519
but they're worthwhile because they do

312
00:11:03,519 --> 00:11:05,680
they do checked just to make sure so

313
00:11:05,680 --> 00:11:07,040
that's one thing to highlight with those

314
00:11:07,040 --> 00:11:10,640
atomic indicators as we call them

315
00:11:11,839 --> 00:11:15,279
then the other thing is

316
00:11:15,279 --> 00:11:18,320
did i skip something

317
00:11:22,160 --> 00:11:23,200
sorry

318
00:11:23,200 --> 00:11:27,959
all right so then we get to attack

319
00:11:28,079 --> 00:11:29,680
was released

320
00:11:29,680 --> 00:11:30,640
um

321
00:11:30,640 --> 00:11:33,120
the same or two years after the ap21

322
00:11:33,120 --> 00:11:35,040
report in the pyramid of pain so we're

323
00:11:35,040 --> 00:11:36,640
still going through that timeline of

324
00:11:36,640 --> 00:11:38,399
what's gone on with cyber threat

325
00:11:38,399 --> 00:11:40,480
intelligence

326
00:11:40,480 --> 00:11:42,800
and the thing is with attack

327
00:11:42,800 --> 00:11:44,560
one of the big things that we like to

328
00:11:44,560 --> 00:11:48,000
talk about is it's a one-way function

329
00:11:48,000 --> 00:11:50,639
so one of the areas with this that we

330
00:11:50,639 --> 00:11:52,639
see right now is everyone's talking

331
00:11:52,639 --> 00:11:55,040
about techniques techniques techniques

332
00:11:55,040 --> 00:11:56,880
and this is a great area to be in it's

333
00:11:56,880 --> 00:12:00,000
better than the hashes and the ip

334
00:12:00,000 --> 00:12:01,519
addresses because now we're starting to

335
00:12:01,519 --> 00:12:04,240
understand those behaviors of the human

336
00:12:04,240 --> 00:12:06,079
behind the attack

337
00:12:06,079 --> 00:12:08,639
but it's only a one-way function so when

338
00:12:08,639 --> 00:12:10,160
we have those procedures and

339
00:12:10,160 --> 00:12:12,560
observations we then map it to an attack

340
00:12:12,560 --> 00:12:14,320
technique and that's why we have the

341
00:12:14,320 --> 00:12:15,839
sorting hat here

342
00:12:15,839 --> 00:12:18,800
because he sorts the observations to a

343
00:12:18,800 --> 00:12:20,160
technique

344
00:12:20,160 --> 00:12:21,920
but when we have a technique that's

345
00:12:21,920 --> 00:12:23,120
reported

346
00:12:23,120 --> 00:12:24,720
we can't really map down to the

347
00:12:24,720 --> 00:12:27,519
procedure level

348
00:12:27,680 --> 00:12:29,200
and this is kind of what the sorting hat

349
00:12:29,200 --> 00:12:30,320
looks like

350
00:12:30,320 --> 00:12:33,320
so if i just gave you

351
00:12:33,320 --> 00:12:34,959
t1003

352
00:12:34,959 --> 00:12:38,079
which is down here in credential dumping

353
00:12:38,079 --> 00:12:39,839
you don't really know how an adversary

354
00:12:39,839 --> 00:12:41,680
dumped the credentials

355
00:12:41,680 --> 00:12:43,760
so it doesn't go from technique down to

356
00:12:43,760 --> 00:12:45,760
procedure but here we can see that the

357
00:12:45,760 --> 00:12:47,040
procedure

358
00:12:47,040 --> 00:12:49,200
maps to the technique so we can see that

359
00:12:49,200 --> 00:12:51,839
proc dump was used so now if i'm doing

360
00:12:51,839 --> 00:12:53,760
adversary emulation

361
00:12:53,760 --> 00:12:56,320
i can go out and i can emulate this

362
00:12:56,320 --> 00:12:58,399
because the detection side will be

363
00:12:58,399 --> 00:13:01,519
different if it's proc dump or mimikats

364
00:13:01,519 --> 00:13:04,079
it's going to be different

365
00:13:04,079 --> 00:13:05,360
and then so that's where we get to the

366
00:13:05,360 --> 00:13:06,880
breakout

367
00:13:06,880 --> 00:13:08,079
and

368
00:13:08,079 --> 00:13:10,000
we worked our way up we've gotten to

369
00:13:10,000 --> 00:13:12,240
that technique level

370
00:13:12,240 --> 00:13:13,519
and you're going to hear me say

371
00:13:13,519 --> 00:13:14,880
procedures a lot because that's what

372
00:13:14,880 --> 00:13:16,320
we're trying to get to that's like the

373
00:13:16,320 --> 00:13:19,360
next level of cyber threat intelligence

374
00:13:19,360 --> 00:13:21,600
sticks and taxi they're not really

375
00:13:21,600 --> 00:13:23,680
pushing out procedures everything stops

376
00:13:23,680 --> 00:13:25,040
at the technique

377
00:13:25,040 --> 00:13:27,680
and it's preventing us from getting to

378
00:13:27,680 --> 00:13:30,959
the actual point of knowing

379
00:13:30,959 --> 00:13:32,480
if we have defenses against this

380
00:13:32,480 --> 00:13:35,440
procedure or not

381
00:13:35,440 --> 00:13:36,959
so we'll start out first with the

382
00:13:36,959 --> 00:13:40,160
tactics and that's at the lower level

383
00:13:40,160 --> 00:13:42,399
in the tactics that represent the why an

384
00:13:42,399 --> 00:13:44,399
adversary

385
00:13:44,399 --> 00:13:47,360
is doing a technique or sub technique

386
00:13:47,360 --> 00:13:49,600
it's pretty much the goal

387
00:13:49,600 --> 00:13:50,480
so

388
00:13:50,480 --> 00:13:52,160
what does that mean for us though to

389
00:13:52,160 --> 00:13:54,079
make actionable

390
00:13:54,079 --> 00:13:56,079
we actually don't have a lot of actions

391
00:13:56,079 --> 00:13:58,000
we can take from this yet you know we

392
00:13:58,000 --> 00:14:00,160
can see the techniques in there so we

393
00:14:00,160 --> 00:14:02,399
can start prepping for that

394
00:14:02,399 --> 00:14:04,000
but we can't actually do any sort of

395
00:14:04,000 --> 00:14:07,040
defense validation there

396
00:14:07,040 --> 00:14:07,839
so

397
00:14:07,839 --> 00:14:09,839
at the end of the day tactics exist to

398
00:14:09,839 --> 00:14:13,040
help categorize techniques into buckets

399
00:14:13,040 --> 00:14:15,040
it makes the attack graph look a little

400
00:14:15,040 --> 00:14:17,040
nicer instead of just having a bunch of

401
00:14:17,040 --> 00:14:19,600
techniques

402
00:14:19,600 --> 00:14:22,000
so from there we then get to the

403
00:14:22,000 --> 00:14:24,639
technique level

404
00:14:24,639 --> 00:14:27,519
this is a level that most of the threat

405
00:14:27,519 --> 00:14:30,800
intelligence right now is

406
00:14:30,800 --> 00:14:32,720
being communicated at

407
00:14:32,720 --> 00:14:34,800
so you know we moved past those hashes

408
00:14:34,800 --> 00:14:37,920
and those ips and now thankfully a lot

409
00:14:37,920 --> 00:14:38,959
of

410
00:14:38,959 --> 00:14:41,040
intelligence reports are actually

411
00:14:41,040 --> 00:14:44,240
containing the technique ids

412
00:14:44,240 --> 00:14:46,079
but that's where it stops so like once

413
00:14:46,079 --> 00:14:48,320
again if we say that

414
00:14:48,320 --> 00:14:50,079
they dumped lsas

415
00:14:50,079 --> 00:14:52,399
okay that's great but i still don't know

416
00:14:52,399 --> 00:14:54,160
what that actually means

417
00:14:54,160 --> 00:14:56,880
once again adversaries have tools when

418
00:14:56,880 --> 00:14:58,480
when an operator

419
00:14:58,480 --> 00:15:00,240
who um

420
00:15:00,240 --> 00:15:02,399
is operating with for a specific

421
00:15:02,399 --> 00:15:04,720
adversary they have a tool they might

422
00:15:04,720 --> 00:15:07,199
click one button to do one specific

423
00:15:07,199 --> 00:15:08,240
request

424
00:15:08,240 --> 00:15:09,839
and then that tool is going to do that

425
00:15:09,839 --> 00:15:11,920
request for actions on objectives

426
00:15:11,920 --> 00:15:14,160
regardless of hash it's still going to

427
00:15:14,160 --> 00:15:17,120
come out to a certain procedure

428
00:15:17,120 --> 00:15:18,480
and that's where

429
00:15:18,480 --> 00:15:21,360
we don't know when we say this technique

430
00:15:21,360 --> 00:15:24,480
is being ran by this adversary we still

431
00:15:24,480 --> 00:15:28,480
don't know how and that leaves a gap

432
00:15:28,480 --> 00:15:29,360
in

433
00:15:29,360 --> 00:15:31,519
multiple areas of intelligence for one

434
00:15:31,519 --> 00:15:34,160
it we can't necessarily do the tracking

435
00:15:34,160 --> 00:15:35,920
because you need procedures to help

436
00:15:35,920 --> 00:15:38,480
track to see that procedure across

437
00:15:38,480 --> 00:15:40,880
different engagements from the adversary

438
00:15:40,880 --> 00:15:43,279
from a defensive perspective

439
00:15:43,279 --> 00:15:46,079
different procedures leave different

440
00:15:46,079 --> 00:15:48,079
artifacts behind

441
00:15:48,079 --> 00:15:48,880
so

442
00:15:48,880 --> 00:15:51,040
one of the things is

443
00:15:51,040 --> 00:15:54,480
we see a lot of times with attack

444
00:15:54,480 --> 00:15:56,959
everyone wants a hundred percent attack

445
00:15:56,959 --> 00:15:59,360
coverage

446
00:15:59,360 --> 00:16:01,600
it's an admirable goal but i don't think

447
00:16:01,600 --> 00:16:03,440
it's actually doable even though the

448
00:16:03,440 --> 00:16:05,440
report just came out from the last test

449
00:16:05,440 --> 00:16:07,279
and they said that they all these you

450
00:16:07,279 --> 00:16:10,160
know edrs had 100 attack coverage

451
00:16:10,160 --> 00:16:11,759
so that's kind of the goal that a lot of

452
00:16:11,759 --> 00:16:14,079
people are after

453
00:16:14,079 --> 00:16:17,279
and it kind of leads to this one area

454
00:16:17,279 --> 00:16:20,480
where i call it the checkbox fallacy

455
00:16:20,480 --> 00:16:23,519
and what what the blue teams are doing

456
00:16:23,519 --> 00:16:25,680
they'll go in and they'll say well we

457
00:16:25,680 --> 00:16:29,839
have logs for this technique

458
00:16:29,839 --> 00:16:31,519
but does it actually result in a

459
00:16:31,519 --> 00:16:34,000
response does it actually result in an

460
00:16:34,000 --> 00:16:35,440
alert

461
00:16:35,440 --> 00:16:36,800
we don't know

462
00:16:36,800 --> 00:16:38,480
so it's a checkbox fallacy the other

463
00:16:38,480 --> 00:16:39,519
thing too

464
00:16:39,519 --> 00:16:41,199
that happens here

465
00:16:41,199 --> 00:16:43,120
with the attack matrix

466
00:16:43,120 --> 00:16:45,120
you know you get a ciso comes in and

467
00:16:45,120 --> 00:16:48,959
says hey i want coverage of attack

468
00:16:48,959 --> 00:16:50,800
well what does that mean because there's

469
00:16:50,800 --> 00:16:53,759
a lot of techniques out there so it's

470
00:16:53,759 --> 00:16:56,160
going to be very costly to actually go

471
00:16:56,160 --> 00:16:57,920
through all the techniques and that's

472
00:16:57,920 --> 00:16:59,680
where cti comes in but we'll get into

473
00:16:59,680 --> 00:17:01,600
that a little bit later

474
00:17:01,600 --> 00:17:04,959
the other area too is what procedure

475
00:17:04,959 --> 00:17:07,760
is used most what procedures are most

476
00:17:07,760 --> 00:17:10,480
relevant to you

477
00:17:10,480 --> 00:17:11,359
and

478
00:17:11,359 --> 00:17:13,359
that we don't always know so what some

479
00:17:13,359 --> 00:17:16,000
people do is they'll do atomic tests

480
00:17:16,000 --> 00:17:17,359
they'll come in and they'll say we need

481
00:17:17,359 --> 00:17:20,720
to uh test whatever this technique is

482
00:17:20,720 --> 00:17:22,400
and someone will go out they'll grab an

483
00:17:22,400 --> 00:17:25,359
atomic test they'll run it and then

484
00:17:25,359 --> 00:17:27,439
they'll do a blue check mark next to it

485
00:17:27,439 --> 00:17:29,360
so that's another area that i call it

486
00:17:29,360 --> 00:17:30,240
the

487
00:17:30,240 --> 00:17:33,840
the check box fallacy for attack

488
00:17:33,840 --> 00:17:35,919
i also have another thing that i use and

489
00:17:35,919 --> 00:17:38,720
it's called procedure assumption

490
00:17:38,720 --> 00:17:40,400
and like we said here we have process

491
00:17:40,400 --> 00:17:41,760
discovery

492
00:17:41,760 --> 00:17:43,919
and we map it down to

493
00:17:43,919 --> 00:17:44,799
a

494
00:17:44,799 --> 00:17:46,960
atomic test

495
00:17:46,960 --> 00:17:48,080
now

496
00:17:48,080 --> 00:17:49,679
one of the issues that we have is what

497
00:17:49,679 --> 00:17:50,799
happens if

498
00:17:50,799 --> 00:17:53,200
only one of these gets ran well if only

499
00:17:53,200 --> 00:17:54,400
one is run

500
00:17:54,400 --> 00:17:57,280
you can't say that that is coverage

501
00:17:57,280 --> 00:17:57,960
for

502
00:17:57,960 --> 00:17:59,600
t1057

503
00:17:59,600 --> 00:18:01,120
because there's a lot of other ways to

504
00:18:01,120 --> 00:18:04,799
do 10 uh 1057.

505
00:18:04,799 --> 00:18:06,559
so these are great they're great

506
00:18:06,559 --> 00:18:08,720
starting points if you're just getting

507
00:18:08,720 --> 00:18:11,200
started in a purple team engagement or

508
00:18:11,200 --> 00:18:13,200
you're just starting out with blue team

509
00:18:13,200 --> 00:18:15,919
and trying to test a few things

510
00:18:15,919 --> 00:18:18,480
doing the basic atomic test

511
00:18:18,480 --> 00:18:20,080
that's a great area to start for

512
00:18:20,080 --> 00:18:22,720
coverage to see what your edr's alerting

513
00:18:22,720 --> 00:18:23,520
on

514
00:18:23,520 --> 00:18:26,640
where do you have gaps things like that

515
00:18:26,640 --> 00:18:29,039
but you should never assume from a

516
00:18:29,039 --> 00:18:31,039
report that you read that it says

517
00:18:31,039 --> 00:18:33,280
process discovery so it must be one of

518
00:18:33,280 --> 00:18:34,880
these procedures

519
00:18:34,880 --> 00:18:37,760
so one of the areas is for this native

520
00:18:37,760 --> 00:18:40,240
api

521
00:18:40,320 --> 00:18:42,640
that's not an atomic test

522
00:18:42,640 --> 00:18:43,520
so

523
00:18:43,520 --> 00:18:46,720
what if the adversary is using that

524
00:18:46,720 --> 00:18:47,919
do you know if you actually have

525
00:18:47,919 --> 00:18:50,720
detections around that

526
00:18:50,720 --> 00:18:54,559
is are the adversaries using that

527
00:18:54,559 --> 00:18:56,400
that's where cti gets involved and you

528
00:18:56,400 --> 00:18:58,160
actually have to study and you have to

529
00:18:58,160 --> 00:19:01,039
do the procedures that the adversaries

530
00:19:01,039 --> 00:19:02,400
are leveraging

531
00:19:02,400 --> 00:19:03,919
to validate

532
00:19:03,919 --> 00:19:06,480
the the detections and the response for

533
00:19:06,480 --> 00:19:09,720
the organization

534
00:19:11,280 --> 00:19:13,200
one of the other areas that we also see

535
00:19:13,200 --> 00:19:14,880
is where they say hey i'm really worried

536
00:19:14,880 --> 00:19:18,000
about apt-1 so then they go in and they

537
00:19:18,000 --> 00:19:20,240
grab the apt-1 graph

538
00:19:20,240 --> 00:19:22,720
off of attack navigator i love attack

539
00:19:22,720 --> 00:19:26,000
navigator but for one apt-1 is outdated

540
00:19:26,000 --> 00:19:27,760
because they've probably merged into a

541
00:19:27,760 --> 00:19:30,640
different apt group by now but also once

542
00:19:30,640 --> 00:19:32,799
again we have like local account

543
00:19:32,799 --> 00:19:34,559
discovery

544
00:19:34,559 --> 00:19:35,679
how

545
00:19:35,679 --> 00:19:38,960
how did they actually go out and do that

546
00:19:38,960 --> 00:19:40,720
we don't know so

547
00:19:40,720 --> 00:19:42,720
when you're asked to do a red team

548
00:19:42,720 --> 00:19:45,280
engagement

549
00:19:45,600 --> 00:19:48,160
sure you can grab a random procedure and

550
00:19:48,160 --> 00:19:50,640
you can run it to check that box

551
00:19:50,640 --> 00:19:51,919
but are you actually doing what the

552
00:19:51,919 --> 00:19:54,080
adversary does or not

553
00:19:54,080 --> 00:19:55,520
so that's one thing to think about when

554
00:19:55,520 --> 00:19:58,400
you're doing a red team engagement

555
00:19:58,400 --> 00:19:59,679
is to wonder

556
00:19:59,679 --> 00:20:02,720
how's the adversary doing it go out

557
00:20:02,720 --> 00:20:04,400
see if you can find it

558
00:20:04,400 --> 00:20:06,080
and actually replicate that for the

559
00:20:06,080 --> 00:20:08,559
customer

560
00:20:09,440 --> 00:20:11,760
finally at the top of the new pyramid

561
00:20:11,760 --> 00:20:14,559
that i've expanded on are the procedures

562
00:20:14,559 --> 00:20:16,400
so this is where we get to how they

563
00:20:16,400 --> 00:20:18,799
actually did it in this example it's

564
00:20:18,799 --> 00:20:21,600
proc dump was it mimi cats there's a

565
00:20:21,600 --> 00:20:24,400
bunch of different ways to dump lsas

566
00:20:24,400 --> 00:20:28,320
there's a bunch of different ways to do

567
00:20:28,320 --> 00:20:30,320
pretty much all the techniques you know

568
00:20:30,320 --> 00:20:31,760
i think

569
00:20:31,760 --> 00:20:33,440
fishing with an attachment is a

570
00:20:33,440 --> 00:20:34,480
technique

571
00:20:34,480 --> 00:20:36,799
you know is an excel document with a

572
00:20:36,799 --> 00:20:38,159
macro

573
00:20:38,159 --> 00:20:40,960
is it an iso with a link file in it

574
00:20:40,960 --> 00:20:43,120
these things matter because at the end

575
00:20:43,120 --> 00:20:44,559
of the day

576
00:20:44,559 --> 00:20:47,280
it's what we're going to use to validate

577
00:20:47,280 --> 00:20:50,080
detections against real world threats

578
00:20:50,080 --> 00:20:51,520
and we need those procedures that the

579
00:20:51,520 --> 00:20:54,960
adversary is doing to do it

580
00:20:55,120 --> 00:20:57,360
one of the things this looks like

581
00:20:57,360 --> 00:20:59,440
pretty much is that

582
00:20:59,440 --> 00:21:00,559
we have

583
00:21:00,559 --> 00:21:02,880
all these different techniques

584
00:21:02,880 --> 00:21:06,000
but what it what we really want

585
00:21:06,000 --> 00:21:09,600
is the procedures over here

586
00:21:09,600 --> 00:21:11,280
and it takes a little bit more work if

587
00:21:11,280 --> 00:21:13,360
you're in cyber threat intelligence

588
00:21:13,360 --> 00:21:14,799
you're gonna actually have to read

589
00:21:14,799 --> 00:21:17,679
through and extract procedures if you're

590
00:21:17,679 --> 00:21:18,880
trying to do

591
00:21:18,880 --> 00:21:21,600
adversary emulation from the red side

592
00:21:21,600 --> 00:21:23,120
you're going to have to read through and

593
00:21:23,120 --> 00:21:25,600
try to get to procedure level

594
00:21:25,600 --> 00:21:27,760
but we see a bunch of commands that

595
00:21:27,760 --> 00:21:29,360
adversaries do

596
00:21:29,360 --> 00:21:32,559
over and over again

597
00:21:33,039 --> 00:21:34,880
and that's what we need to test we need

598
00:21:34,880 --> 00:21:36,559
to test the way the adversary is

599
00:21:36,559 --> 00:21:41,520
actually operating at a procedure level

600
00:21:42,159 --> 00:21:44,240
and what this helps us do is once again

601
00:21:44,240 --> 00:21:46,000
focus on that human element so they have

602
00:21:46,000 --> 00:21:47,600
the training the tools they have

603
00:21:47,600 --> 00:21:49,520
approved actions

604
00:21:49,520 --> 00:21:51,039
i don't know how many of y'all are in a

605
00:21:51,039 --> 00:21:52,799
large organization

606
00:21:52,799 --> 00:21:53,520
but

607
00:21:53,520 --> 00:21:56,559
if you run an unapproved action

608
00:21:56,559 --> 00:21:58,559
it's a very risky thing and you might

609
00:21:58,559 --> 00:22:00,960
not end up with a job anymore

610
00:22:00,960 --> 00:22:02,880
so you have to think about these things

611
00:22:02,880 --> 00:22:04,960
but we're getting down to the procedure

612
00:22:04,960 --> 00:22:06,960
level because those get repeated over

613
00:22:06,960 --> 00:22:09,600
and over again when we read d4 reports

614
00:22:09,600 --> 00:22:12,640
by the way shout out to thed4report.com

615
00:22:12,640 --> 00:22:16,400
when we go through different adversaries

616
00:22:16,400 --> 00:22:18,640
they're using the same procedures

617
00:22:18,640 --> 00:22:21,039
over and over again

618
00:22:21,039 --> 00:22:23,520
in fact one point with a conti playbook

619
00:22:23,520 --> 00:22:25,840
example in one case they observed the

620
00:22:25,840 --> 00:22:29,360
operator copy and pasting from the

621
00:22:29,360 --> 00:22:30,960
uh the script

622
00:22:30,960 --> 00:22:32,559
and they didn't even fill in the ip

623
00:22:32,559 --> 00:22:34,640
address that's how much these things get

624
00:22:34,640 --> 00:22:36,720
repeated

625
00:22:36,720 --> 00:22:39,760
just like in a in a security operations

626
00:22:39,760 --> 00:22:41,440
center their sock tier one right and

627
00:22:41,440 --> 00:22:44,320
they handle most of the triage events

628
00:22:44,320 --> 00:22:46,559
well a lot of times with

629
00:22:46,559 --> 00:22:48,240
red teams

630
00:22:48,240 --> 00:22:50,240
or advanced persistent threats guess

631
00:22:50,240 --> 00:22:52,960
what there's tier one operators who are

632
00:22:52,960 --> 00:22:55,039
doing much of the grunt work just copy

633
00:22:55,039 --> 00:22:56,960
and pasting from things

634
00:22:56,960 --> 00:23:00,240
so that's something we have to consider

635
00:23:00,400 --> 00:23:03,520
so how do we leverage procedure level

636
00:23:03,520 --> 00:23:05,280
uh intelligence

637
00:23:05,280 --> 00:23:07,039
well for one we have to go out and

638
00:23:07,039 --> 00:23:09,360
extract it

639
00:23:09,360 --> 00:23:11,600
and you just have to start identifying

640
00:23:11,600 --> 00:23:14,159
it so in this example

641
00:23:14,159 --> 00:23:16,799
microsoft they released a blog about a

642
00:23:16,799 --> 00:23:19,039
chinese apt

643
00:23:19,039 --> 00:23:21,520
and one of the ways that we can start

644
00:23:21,520 --> 00:23:23,120
thinking about oh what would this look

645
00:23:23,120 --> 00:23:25,280
like in our environment is we can go in

646
00:23:25,280 --> 00:23:28,000
and we can see that mshta or mishta i'm

647
00:23:28,000 --> 00:23:29,919
not going to get into that in that

648
00:23:29,919 --> 00:23:31,360
argument here i don't know if you've

649
00:23:31,360 --> 00:23:33,520
ever seen the argument on twitter if

650
00:23:33,520 --> 00:23:34,240
it's

651
00:23:34,240 --> 00:23:36,559
mshta or mishta

652
00:23:36,559 --> 00:23:37,360
but

653
00:23:37,360 --> 00:23:39,280
we can talk about that over drinks cold

654
00:23:39,280 --> 00:23:41,039
beverages after the conference which one

655
00:23:41,039 --> 00:23:42,640
it's pronounced as

656
00:23:42,640 --> 00:23:45,120
but then we also see who am i uh being

657
00:23:45,120 --> 00:23:48,159
piped out to a dot text file

658
00:23:48,159 --> 00:23:49,760
so these are things that we can start

659
00:23:49,760 --> 00:23:51,440
wondering all right well what would this

660
00:23:51,440 --> 00:23:53,679
look like in our environment how rare is

661
00:23:53,679 --> 00:23:56,400
this can we do detections on it

662
00:23:56,400 --> 00:23:59,200
we actually see the adversaries actions

663
00:23:59,200 --> 00:24:02,480
on objectives we see the procedures

664
00:24:02,480 --> 00:24:03,200
so

665
00:24:03,200 --> 00:24:05,600
start thinking about how i can replicate

666
00:24:05,600 --> 00:24:06,400
this

667
00:24:06,400 --> 00:24:07,919
and then how i can use this in my

668
00:24:07,919 --> 00:24:10,240
environment to do my checks because once

669
00:24:10,240 --> 00:24:12,480
again those hashes those ips

670
00:24:12,480 --> 00:24:14,159
they don't mean some they don't really

671
00:24:14,159 --> 00:24:16,799
mean much to us because the adversary is

672
00:24:16,799 --> 00:24:19,039
always coming from a different location

673
00:24:19,039 --> 00:24:21,120
with a different hash

674
00:24:21,120 --> 00:24:23,120
so we have to start looking at

675
00:24:23,120 --> 00:24:26,080
taking this intelligence extracting it

676
00:24:26,080 --> 00:24:29,760
replicating it verifying detections

677
00:24:29,760 --> 00:24:31,440
building detections and then also

678
00:24:31,440 --> 00:24:34,000
verifying response

679
00:24:34,000 --> 00:24:37,120
so outside of reports

680
00:24:37,120 --> 00:24:39,200
i'll touch there real quick too shout

681
00:24:39,200 --> 00:24:42,320
out to uh george in the audience

682
00:24:42,320 --> 00:24:45,679
george actually brought us a

683
00:24:45,679 --> 00:24:48,559
thread intel report that had a link

684
00:24:48,559 --> 00:24:50,320
inside of an iso

685
00:24:50,320 --> 00:24:52,799
so with that example we went ahead and

686
00:24:52,799 --> 00:24:53,919
we

687
00:24:53,919 --> 00:24:56,080
replicated the procedures once again

688
00:24:56,080 --> 00:24:58,799
this only maps really back to fishing

689
00:24:58,799 --> 00:25:01,200
with an attachment

690
00:25:01,200 --> 00:25:03,120
but we got down to the procedure level

691
00:25:03,120 --> 00:25:05,120
it was an iso with a link you click that

692
00:25:05,120 --> 00:25:08,400
link that link runs run dll-32 and then

693
00:25:08,400 --> 00:25:11,279
that kicks off a malicious dll

694
00:25:11,279 --> 00:25:14,080
we saw the report we went ahead george

695
00:25:14,080 --> 00:25:16,640
performed it i reviewed the logs and

696
00:25:16,640 --> 00:25:19,520
then we're pushing new rules to sigma

697
00:25:19,520 --> 00:25:22,080
just like that within about a day we're

698
00:25:22,080 --> 00:25:24,480
already catching a new delivery and i

699
00:25:24,480 --> 00:25:26,400
think like two or three months later

700
00:25:26,400 --> 00:25:28,400
like gossip the dog by the way

701
00:25:28,400 --> 00:25:29,919
if you don't follow him and you're in

702
00:25:29,919 --> 00:25:32,720
any sort of intelligence type setup or

703
00:25:32,720 --> 00:25:34,960
blue team i highly recommend following

704
00:25:34,960 --> 00:25:36,080
him

705
00:25:36,080 --> 00:25:37,440
but it was like two or three months

706
00:25:37,440 --> 00:25:39,039
later he's talking about this uh

707
00:25:39,039 --> 00:25:42,880
procedure getting used again

708
00:25:42,880 --> 00:25:44,240
the other area that we can look at

709
00:25:44,240 --> 00:25:46,480
outside of reports and open source

710
00:25:46,480 --> 00:25:48,799
intelligence is our incidents if we're

711
00:25:48,799 --> 00:25:50,400
on the inside

712
00:25:50,400 --> 00:25:52,000
we actually have intelligence from our

713
00:25:52,000 --> 00:25:54,080
incidents

714
00:25:54,080 --> 00:25:56,000
we can replicate that a lot of times

715
00:25:56,000 --> 00:25:58,080
people don't go through and replay their

716
00:25:58,080 --> 00:25:59,120
incidents

717
00:25:59,120 --> 00:26:01,440
you should do that and you can start

718
00:26:01,440 --> 00:26:04,159
actually testing different procedures as

719
00:26:04,159 --> 00:26:06,240
the incident progressed to where it was

720
00:26:06,240 --> 00:26:09,440
and you can start doing detections

721
00:26:09,440 --> 00:26:11,760
for each procedure along the way so next

722
00:26:11,760 --> 00:26:14,159
time when that adversary comes in

723
00:26:14,159 --> 00:26:15,840
i like to say that you have enough land

724
00:26:15,840 --> 00:26:18,080
mines around then that they'll step on

725
00:26:18,080 --> 00:26:20,480
one you know they're not going to repeat

726
00:26:20,480 --> 00:26:22,000
a whole string

727
00:26:22,000 --> 00:26:24,559
but they might repeat one

728
00:26:24,559 --> 00:26:26,320
so look at your incidents and start

729
00:26:26,320 --> 00:26:28,559
replaying each procedure and then

730
00:26:28,559 --> 00:26:30,559
triggering those alarms and build those

731
00:26:30,559 --> 00:26:33,679
alarms where where necessary

732
00:26:33,679 --> 00:26:35,440
the other area that we can do is we can

733
00:26:35,440 --> 00:26:38,480
set up honey pots so if you're in cti

734
00:26:38,480 --> 00:26:40,240
or if you're on the blue team you can

735
00:26:40,240 --> 00:26:42,559
set up honey pots now some people will

736
00:26:42,559 --> 00:26:46,799
be like chris honey pots are terrible

737
00:26:46,799 --> 00:26:49,360
and i'll be like why and they go well

738
00:26:49,360 --> 00:26:52,080
because a good hacker once they get into

739
00:26:52,080 --> 00:26:53,760
a honey pot they're going to know

740
00:26:53,760 --> 00:26:55,919
they're in a honey pot and then they're

741
00:26:55,919 --> 00:26:58,880
going to leave it alone

742
00:26:59,120 --> 00:27:00,720
fair point

743
00:27:00,720 --> 00:27:02,240
but they're going to give me some good

744
00:27:02,240 --> 00:27:04,080
procedures first

745
00:27:04,080 --> 00:27:05,919
let's say they have to exploit their way

746
00:27:05,919 --> 00:27:07,760
into a honeypot

747
00:27:07,760 --> 00:27:09,200
well then i'm going to see something

748
00:27:09,200 --> 00:27:11,760
like apache kick off another process

749
00:27:11,760 --> 00:27:14,240
like powershell and then possibly call

750
00:27:14,240 --> 00:27:16,559
out to do a download

751
00:27:16,559 --> 00:27:18,799
i'm going to see some actions there that

752
00:27:18,799 --> 00:27:21,679
i can start building detections on

753
00:27:21,679 --> 00:27:23,600
i'm also going to see if i can take

754
00:27:23,600 --> 00:27:26,240
those procedures and replicate them in

755
00:27:26,240 --> 00:27:28,480
other areas such as production in my in

756
00:27:28,480 --> 00:27:30,640
my environment and see if that triggers

757
00:27:30,640 --> 00:27:33,279
a sock response

758
00:27:33,279 --> 00:27:34,960
the other thing is let's say they've

759
00:27:34,960 --> 00:27:36,880
done the exploit

760
00:27:36,880 --> 00:27:39,760
they've now done their initial chain

761
00:27:39,760 --> 00:27:41,520
that's great

762
00:27:41,520 --> 00:27:42,799
typically before they know they're in a

763
00:27:42,799 --> 00:27:43,919
honey pot

764
00:27:43,919 --> 00:27:45,120
you're going to have to do a little bit

765
00:27:45,120 --> 00:27:46,960
of enumeration

766
00:27:46,960 --> 00:27:48,960
so now i can flag on that enumeration as

767
00:27:48,960 --> 00:27:49,760
well

768
00:27:49,760 --> 00:27:51,919
we can replicate those procedures again

769
00:27:51,919 --> 00:27:54,240
so honey pots aren't useless

770
00:27:54,240 --> 00:27:58,000
do they give us the full attack chain no

771
00:27:58,000 --> 00:28:00,640
but it's it's way better to catch an

772
00:28:00,640 --> 00:28:02,240
adversary at the beginning of that

773
00:28:02,240 --> 00:28:03,919
attack chain and we're catching those

774
00:28:03,919 --> 00:28:05,840
procedures there

775
00:28:05,840 --> 00:28:08,000
and then the other area that we get to

776
00:28:08,000 --> 00:28:09,760
that we can also get procedure level

777
00:28:09,760 --> 00:28:13,039
intelligence from is sandboxing

778
00:28:13,039 --> 00:28:14,799
one of the best areas that we can

779
00:28:14,799 --> 00:28:16,559
actually

780
00:28:16,559 --> 00:28:19,039
get sandboxing data from is email

781
00:28:19,039 --> 00:28:22,399
gateways security email gateways

782
00:28:22,399 --> 00:28:24,720
you can go in there and you can grab

783
00:28:24,720 --> 00:28:27,200
samples from the email gateway

784
00:28:27,200 --> 00:28:28,840
you can run them in a

785
00:28:28,840 --> 00:28:31,679
sandbox and then you can see the actions

786
00:28:31,679 --> 00:28:33,919
that occur from there

787
00:28:33,919 --> 00:28:35,200
and if you leave it on long enough

788
00:28:35,200 --> 00:28:37,440
sometimes you'll get some interactions

789
00:28:37,440 --> 00:28:39,840
from the adversary once again they might

790
00:28:39,840 --> 00:28:41,039
know that they're in a sandbox

791
00:28:41,039 --> 00:28:42,320
eventually

792
00:28:42,320 --> 00:28:45,039
but you still have those initial actions

793
00:28:45,039 --> 00:28:46,399
and that way you can make sure that

794
00:28:46,399 --> 00:28:48,320
you're flagging on those in your

795
00:28:48,320 --> 00:28:50,000
environment

796
00:28:50,000 --> 00:28:53,120
so sandboxing from your email gateway is

797
00:28:53,120 --> 00:28:55,840
a great area and the other thing too is

798
00:28:55,840 --> 00:28:58,880
you know maybe the adversary is using

799
00:28:58,880 --> 00:29:01,279
macros right now to get in and your

800
00:29:01,279 --> 00:29:03,039
email gateway is doing a great job at

801
00:29:03,039 --> 00:29:05,200
blocking that great but what if they

802
00:29:05,200 --> 00:29:07,440
change that delivery

803
00:29:07,440 --> 00:29:09,600
you know it still might be a cobalt

804
00:29:09,600 --> 00:29:12,480
strike payload at either

805
00:29:12,480 --> 00:29:15,200
after either's one's ingress it still

806
00:29:15,200 --> 00:29:17,760
might be the same type of c2

807
00:29:17,760 --> 00:29:19,760
but you're still going to get a few of

808
00:29:19,760 --> 00:29:22,080
those initial actions of the adversary

809
00:29:22,080 --> 00:29:23,360
potentially

810
00:29:23,360 --> 00:29:24,640
so that's another area that we can

811
00:29:24,640 --> 00:29:28,159
gather cyber threat intelligence

812
00:29:28,159 --> 00:29:30,640
and one of the ways that we see

813
00:29:30,640 --> 00:29:33,440
making procedure level intelligence

814
00:29:33,440 --> 00:29:35,120
actionable

815
00:29:35,120 --> 00:29:37,279
is we're going out we're identifying the

816
00:29:37,279 --> 00:29:39,360
adversary

817
00:29:39,360 --> 00:29:41,120
i can't talk about how to identify

818
00:29:41,120 --> 00:29:43,440
adversaries for each organization

819
00:29:43,440 --> 00:29:46,880
there's a great talk or a great uh post

820
00:29:46,880 --> 00:29:47,840
by

821
00:29:47,840 --> 00:29:49,919
andy piazza i believe

822
00:29:49,919 --> 00:29:51,760
who talks about threat box if you get a

823
00:29:51,760 --> 00:29:54,240
chance it's on medium i recommend

824
00:29:54,240 --> 00:29:55,919
reading that and you can start

825
00:29:55,919 --> 00:29:57,520
identifying adversaries the other thing

826
00:29:57,520 --> 00:29:59,840
that you can do to identify adversaries

827
00:29:59,840 --> 00:30:02,880
is you can ask the organization hey

828
00:30:02,880 --> 00:30:04,159
what

829
00:30:04,159 --> 00:30:06,320
adversaries are you seeing on your email

830
00:30:06,320 --> 00:30:09,840
gateway because microsoft proofpoint

831
00:30:09,840 --> 00:30:11,440
pretty much all the email gateway

832
00:30:11,440 --> 00:30:13,840
vendors they track adversaries and

833
00:30:13,840 --> 00:30:16,080
they'll actually tell you who's hitting

834
00:30:16,080 --> 00:30:17,360
you

835
00:30:17,360 --> 00:30:19,039
so we start looking at that we

836
00:30:19,039 --> 00:30:20,480
hypothesize

837
00:30:20,480 --> 00:30:22,799
who would our adversaries be or who's

838
00:30:22,799 --> 00:30:25,120
hitting us now and then we can focus on

839
00:30:25,120 --> 00:30:26,399
gathering that threat intelligence

840
00:30:26,399 --> 00:30:27,520
around them

841
00:30:27,520 --> 00:30:30,000
extract the ttps and once once again

842
00:30:30,000 --> 00:30:31,360
we're getting down to that procedure

843
00:30:31,360 --> 00:30:33,440
level we want to know what their

844
00:30:33,440 --> 00:30:35,679
procedures are so that we can validate

845
00:30:35,679 --> 00:30:38,000
our detections around it

846
00:30:38,000 --> 00:30:40,640
and then we'll analyze and organize it

847
00:30:40,640 --> 00:30:42,640
create a plan and then finally we'll do

848
00:30:42,640 --> 00:30:45,279
the red team or the adversary emulation

849
00:30:45,279 --> 00:30:47,840
side of it

850
00:30:48,480 --> 00:30:50,320
so with that we want to start with the

851
00:30:50,320 --> 00:30:52,960
emulation

852
00:30:53,200 --> 00:30:54,960
with the emulation

853
00:30:54,960 --> 00:30:56,480
we want to first test the known

854
00:30:56,480 --> 00:30:58,720
procedures

855
00:30:58,720 --> 00:31:01,519
we do this just to make sure

856
00:31:01,519 --> 00:31:04,320
i'm telling you there's often times i'm

857
00:31:04,320 --> 00:31:06,640
sure any of you red teamers out here

858
00:31:06,640 --> 00:31:08,720
you've heard it time and time again

859
00:31:08,720 --> 00:31:09,919
oh yeah

860
00:31:09,919 --> 00:31:12,799
we'll catch that

861
00:31:13,360 --> 00:31:15,440
the sad thing is is often times we don't

862
00:31:15,440 --> 00:31:17,200
catch that

863
00:31:17,200 --> 00:31:19,200
so let's just start with the gnome

864
00:31:19,200 --> 00:31:20,880
procedures first if you're on the red

865
00:31:20,880 --> 00:31:23,919
team and you're trying to do emulation

866
00:31:23,919 --> 00:31:25,600
from there though

867
00:31:25,600 --> 00:31:28,799
once we're up to snuff on that um

868
00:31:28,799 --> 00:31:30,240
up to snuff is probably a saying that

869
00:31:30,240 --> 00:31:32,399
doesn't always translate well once we

870
00:31:32,399 --> 00:31:34,640
have coverage

871
00:31:34,640 --> 00:31:36,399
of the known procedures and we know that

872
00:31:36,399 --> 00:31:38,399
we have alerts firing and we know that

873
00:31:38,399 --> 00:31:40,799
the sock is responding to it then we

874
00:31:40,799 --> 00:31:43,519
want to adapt the procedures

875
00:31:43,519 --> 00:31:46,640
so maybe we have iso with link

876
00:31:46,640 --> 00:31:48,399
file and the link file is kicking off

877
00:31:48,399 --> 00:31:51,919
run dll32 to kick off malicious dlo well

878
00:31:51,919 --> 00:31:54,000
what else can you use to kick off the

879
00:31:54,000 --> 00:31:55,279
dll

880
00:31:55,279 --> 00:31:56,640
let's start there let's start

881
00:31:56,640 --> 00:31:58,080
substituting

882
00:31:58,080 --> 00:31:59,919
other ways that the adversary might

883
00:31:59,919 --> 00:32:01,840
migrate to

884
00:32:01,840 --> 00:32:03,519
and then we can further improve the

885
00:32:03,519 --> 00:32:06,320
detections around that

886
00:32:06,320 --> 00:32:08,159
and then the other area that we want to

887
00:32:08,159 --> 00:32:09,279
talk about

888
00:32:09,279 --> 00:32:10,080
is

889
00:32:10,080 --> 00:32:12,399
hypothesizing

890
00:32:12,399 --> 00:32:14,559
and testing variations to break the

891
00:32:14,559 --> 00:32:17,600
detection so as we do the

892
00:32:17,600 --> 00:32:19,919
original control verification of the

893
00:32:19,919 --> 00:32:22,080
procedures from the adversary

894
00:32:22,080 --> 00:32:24,960
and then as we've adapted that

895
00:32:24,960 --> 00:32:26,960
we get to the point where hopefully the

896
00:32:26,960 --> 00:32:29,519
blue team's starting to get detections

897
00:32:29,519 --> 00:32:30,960
around it and they're starting to

898
00:32:30,960 --> 00:32:33,279
respond to it well that's where we want

899
00:32:33,279 --> 00:32:35,360
to look at the the red team for some

900
00:32:35,360 --> 00:32:37,120
help

901
00:32:37,120 --> 00:32:38,480
you know hopefully in a purple team

902
00:32:38,480 --> 00:32:39,360
engagement because we want to

903
00:32:39,360 --> 00:32:41,360
collaborate that's where we want to say

904
00:32:41,360 --> 00:32:43,919
here's the detection rule you know red

905
00:32:43,919 --> 00:32:45,840
teamers reach out to the the detection

906
00:32:45,840 --> 00:32:48,399
engineers detection engineers reach out

907
00:32:48,399 --> 00:32:51,519
to the red team and tell them hey try to

908
00:32:51,519 --> 00:32:53,840
break my rule

909
00:32:53,840 --> 00:32:56,399
we want to get to that next step

910
00:32:56,399 --> 00:32:58,080
so that's where we also want to see red

911
00:32:58,080 --> 00:33:00,240
team emulations go from the procedure

912
00:33:00,240 --> 00:33:03,120
level and be adaptive

913
00:33:03,120 --> 00:33:05,360
this is a way that we operationalize

914
00:33:05,360 --> 00:33:07,360
purple team with procedure level

915
00:33:07,360 --> 00:33:09,120
intelligence

916
00:33:09,120 --> 00:33:11,279
so we get the new procedures

917
00:33:11,279 --> 00:33:13,919
from there we take them we emulate an

918
00:33:13,919 --> 00:33:15,519
attack

919
00:33:15,519 --> 00:33:17,039
that's great

920
00:33:17,039 --> 00:33:18,799
after you've emulated an attack you have

921
00:33:18,799 --> 00:33:20,240
to work on detection engineering

922
00:33:20,240 --> 00:33:22,399
typically

923
00:33:22,399 --> 00:33:25,120
so from there we kick off the detection

924
00:33:25,120 --> 00:33:27,679
engineering cycle and what we have there

925
00:33:27,679 --> 00:33:30,320
is the collection which is going out and

926
00:33:30,320 --> 00:33:31,919
getting the logs

927
00:33:31,919 --> 00:33:33,760
i don't know if you've ever actually had

928
00:33:33,760 --> 00:33:35,760
to go through and try to get logs we

929
00:33:35,760 --> 00:33:38,240
were doing a purple team workshop class

930
00:33:38,240 --> 00:33:39,840
earlier

931
00:33:39,840 --> 00:33:41,279
and

932
00:33:41,279 --> 00:33:43,279
one of the students was asking he said

933
00:33:43,279 --> 00:33:45,840
so not everything is in the sim

934
00:33:45,840 --> 00:33:47,679
and i'm like no not everything's in the

935
00:33:47,679 --> 00:33:49,679
sim it might be in the edr because you

936
00:33:49,679 --> 00:33:51,279
don't want to pay to store

937
00:33:51,279 --> 00:33:53,919
process logs in both places

938
00:33:53,919 --> 00:33:56,720
or maybe certain firewall logs are sent

939
00:33:56,720 --> 00:33:59,120
to the sim but not all the logs

940
00:33:59,120 --> 00:34:01,519
so we do the collection

941
00:34:01,519 --> 00:34:03,760
and then we process that collection and

942
00:34:03,760 --> 00:34:05,360
that's where we start doing detection

943
00:34:05,360 --> 00:34:07,519
engineering and hopefully we disseminate

944
00:34:07,519 --> 00:34:10,239
it back as an alert to the sock so this

945
00:34:10,239 --> 00:34:12,000
is one of the areas in the ways that we

946
00:34:12,000 --> 00:34:13,918
see that we're operationalizing purple

947
00:34:13,918 --> 00:34:14,719
team

948
00:34:14,719 --> 00:34:17,918
we get procedures we test the procedures

949
00:34:17,918 --> 00:34:20,719
what didn't get alerted on let's build

950
00:34:20,719 --> 00:34:22,800
an alert

951
00:34:22,800 --> 00:34:24,800
we have some more in-depth write-ups on

952
00:34:24,800 --> 00:34:26,879
this and once again that's a whole other

953
00:34:26,879 --> 00:34:29,118
talk

954
00:34:29,280 --> 00:34:30,800
one of the areas that you need to know

955
00:34:30,800 --> 00:34:32,480
though from a blue team perspective and

956
00:34:32,480 --> 00:34:35,679
a red team perspective

957
00:34:35,679 --> 00:34:38,239
we said that attack and technique

958
00:34:38,239 --> 00:34:40,000
mapping is a one-way function you can go

959
00:34:40,000 --> 00:34:43,119
up but it's very difficult to come down

960
00:34:43,119 --> 00:34:45,119
but with logging we actually can get

961
00:34:45,119 --> 00:34:47,679
close enough so from a blue team side if

962
00:34:47,679 --> 00:34:49,599
a red teamer says they did this

963
00:34:49,599 --> 00:34:51,679
technique this procedure we can get

964
00:34:51,679 --> 00:34:54,320
close enough to do log verification this

965
00:34:54,320 --> 00:34:55,760
is one of the important areas to know so

966
00:34:55,760 --> 00:34:58,000
we run a procedure

967
00:34:58,000 --> 00:35:00,560
we then map that to a technique in this

968
00:35:00,560 --> 00:35:04,839
example it's a technique 1059.001

969
00:35:06,640 --> 00:35:08,960
and then so if you go to the attack page

970
00:35:08,960 --> 00:35:11,040
for the technique that it's mapped to

971
00:35:11,040 --> 00:35:12,880
you then can actually go down and see

972
00:35:12,880 --> 00:35:15,119
the data components

973
00:35:15,119 --> 00:35:16,720
and then you can actually start going

974
00:35:16,720 --> 00:35:19,040
through and mapping each data component

975
00:35:19,040 --> 00:35:20,240
and this helps with detection

976
00:35:20,240 --> 00:35:21,359
engineering

977
00:35:21,359 --> 00:35:22,160
so

978
00:35:22,160 --> 00:35:24,160
that's one way too that we can also

979
00:35:24,160 --> 00:35:25,680
check these procedures and make sure

980
00:35:25,680 --> 00:35:28,400
that our procedure level intelligence is

981
00:35:28,400 --> 00:35:29,599
giving us

982
00:35:29,599 --> 00:35:32,079
actions one of the actions is verifying

983
00:35:32,079 --> 00:35:33,680
that we have these data components that

984
00:35:33,680 --> 00:35:36,480
are given to us by mitre

985
00:35:36,480 --> 00:35:38,560
like i said before the other area that

986
00:35:38,560 --> 00:35:41,440
we can also map to are alerts so in this

987
00:35:41,440 --> 00:35:43,839
example we see alerts that were

988
00:35:43,839 --> 00:35:45,119
generated

989
00:35:45,119 --> 00:35:48,400
by a ransomware campaign

990
00:35:48,400 --> 00:35:50,480
we have a lot of area

991
00:35:50,480 --> 00:35:52,640
that we have a lot of detection

992
00:35:52,640 --> 00:35:54,480
opportunities so that we can actually

993
00:35:54,480 --> 00:35:56,560
make detections

994
00:35:56,560 --> 00:35:59,200
you can use an excel sheet like this

995
00:35:59,200 --> 00:36:00,480
you can implement it how you want in

996
00:36:00,480 --> 00:36:02,400
your environment

997
00:36:02,400 --> 00:36:04,160
one of the other areas too that we see

998
00:36:04,160 --> 00:36:05,920
for detection engineering

999
00:36:05,920 --> 00:36:08,079
is that people get hyper focused when we

1000
00:36:08,079 --> 00:36:10,400
say procedures i want to tell you do not

1001
00:36:10,400 --> 00:36:12,800
get hyper focused when i say procedure i

1002
00:36:12,800 --> 00:36:15,440
do not mean focus on every single little

1003
00:36:15,440 --> 00:36:17,520
command in the command line because

1004
00:36:17,520 --> 00:36:19,599
you'll end up only catching a few events

1005
00:36:19,599 --> 00:36:21,760
that are malicious

1006
00:36:21,760 --> 00:36:22,640
so

1007
00:36:22,640 --> 00:36:24,079
make sure you don't do that and like we

1008
00:36:24,079 --> 00:36:26,560
said before work with the red team

1009
00:36:26,560 --> 00:36:28,720
to have them expand the detection where

1010
00:36:28,720 --> 00:36:31,359
necessary

1011
00:36:32,480 --> 00:36:34,560
and then hopefully you can grow to where

1012
00:36:34,560 --> 00:36:36,079
you're not just focused on one little

1013
00:36:36,079 --> 00:36:39,200
area don't get too granular try to catch

1014
00:36:39,200 --> 00:36:40,640
a broad

1015
00:36:40,640 --> 00:36:43,440
set of malicious events for that rule

1016
00:36:43,440 --> 00:36:44,800
also by the way

1017
00:36:44,800 --> 00:36:45,839
um

1018
00:36:45,839 --> 00:36:47,680
embrace a certain amount of false

1019
00:36:47,680 --> 00:36:49,119
positives because you're going to find

1020
00:36:49,119 --> 00:36:52,680
some weird activity

1021
00:36:54,000 --> 00:36:57,599
other area is monitoring and response

1022
00:36:57,599 --> 00:37:00,880
so when we get down to procedure level

1023
00:37:00,880 --> 00:37:03,119
this is where we can actually

1024
00:37:03,119 --> 00:37:05,440
validate that we have monitoring and

1025
00:37:05,440 --> 00:37:10,000
response for the adversaries procedures

1026
00:37:10,400 --> 00:37:12,079
but it takes understanding the threat

1027
00:37:12,079 --> 00:37:15,040
landscape so maybe we have our sock

1028
00:37:15,040 --> 00:37:16,000
train

1029
00:37:16,000 --> 00:37:18,240
in a

1030
00:37:18,240 --> 00:37:20,880
sandbox environment where we're running

1031
00:37:20,880 --> 00:37:22,400
the procedures

1032
00:37:22,400 --> 00:37:24,320
so that they can get used to seeing the

1033
00:37:24,320 --> 00:37:25,760
procedures

1034
00:37:25,760 --> 00:37:27,839
and then we can eventually test that in

1035
00:37:27,839 --> 00:37:30,240
production so then when those procedures

1036
00:37:30,240 --> 00:37:32,000
actually are in production

1037
00:37:32,000 --> 00:37:36,079
they're responding to it appropriately

1038
00:37:36,079 --> 00:37:37,839
one of the things is for the longest

1039
00:37:37,839 --> 00:37:38,800
time

1040
00:37:38,800 --> 00:37:40,720
blue teamers i feel like didn't even

1041
00:37:40,720 --> 00:37:42,240
know that powershell was being used

1042
00:37:42,240 --> 00:37:43,760
maliciously

1043
00:37:43,760 --> 00:37:45,920
this is one of those examples though

1044
00:37:45,920 --> 00:37:48,160
of where you know if they know

1045
00:37:48,160 --> 00:37:50,240
powershell is being used how it's being

1046
00:37:50,240 --> 00:37:52,560
used maliciously they respond better to

1047
00:37:52,560 --> 00:37:54,000
alerts

1048
00:37:54,000 --> 00:37:58,160
so we need to practice practice practice

1049
00:37:58,160 --> 00:37:59,680
one of the

1050
00:37:59,680 --> 00:38:03,200
areas too that we need to focus on

1051
00:38:03,200 --> 00:38:04,560
is

1052
00:38:04,560 --> 00:38:07,040
i'll go ahead and skip one down to

1053
00:38:07,040 --> 00:38:09,440
verifying the response

1054
00:38:09,440 --> 00:38:11,200
so i've seen it before

1055
00:38:11,200 --> 00:38:12,079
where

1056
00:38:12,079 --> 00:38:13,280
an av

1057
00:38:13,280 --> 00:38:15,520
alert triggers it says mimikatz was

1058
00:38:15,520 --> 00:38:19,200
detected on a domain controller

1059
00:38:19,200 --> 00:38:22,320
and sock analyst goes in and they say

1060
00:38:22,320 --> 00:38:24,160
hey

1061
00:38:24,160 --> 00:38:25,280
that alert

1062
00:38:25,280 --> 00:38:28,960
it's okay mimikatz was detected but av

1063
00:38:28,960 --> 00:38:31,680
cleaned it up

1064
00:38:31,760 --> 00:38:33,599
case closed if you don't know what

1065
00:38:33,599 --> 00:38:37,280
mimikatz is it it dumps the credentials

1066
00:38:37,280 --> 00:38:39,760
so this is a very bad response what

1067
00:38:39,760 --> 00:38:42,480
should happen is they should go hmm how

1068
00:38:42,480 --> 00:38:45,040
the heck did this malicious application

1069
00:38:45,040 --> 00:38:47,040
end up on a domain controller and then

1070
00:38:47,040 --> 00:38:49,280
they should start tracing back

1071
00:38:49,280 --> 00:38:50,560
so that's one of the things where we

1072
00:38:50,560 --> 00:38:52,320
need to actually look at the

1073
00:38:52,320 --> 00:38:54,800
response to each procedure to make sure

1074
00:38:54,800 --> 00:38:57,200
that the response is appropriate

1075
00:38:57,200 --> 00:39:00,400
and then finally don't focus on

1076
00:39:00,400 --> 00:39:03,440
the technique level because it just it

1077
00:39:03,440 --> 00:39:06,160
leads to too much confusion

1078
00:39:06,160 --> 00:39:09,520
well what other procedures

1079
00:39:10,400 --> 00:39:12,000
and then finally

1080
00:39:12,000 --> 00:39:13,839
if you want to start taking procedure

1081
00:39:13,839 --> 00:39:16,400
level intelligence

1082
00:39:16,400 --> 00:39:19,680
extracting it and using it in a in a

1083
00:39:19,680 --> 00:39:20,960
meaningful way

1084
00:39:20,960 --> 00:39:22,720
for your organization

1085
00:39:22,720 --> 00:39:25,040
we do have the purple team exercise

1086
00:39:25,040 --> 00:39:27,520
framework this is for free

1087
00:39:27,520 --> 00:39:28,400
uh

1088
00:39:28,400 --> 00:39:30,079
george and some friends did a great job

1089
00:39:30,079 --> 00:39:32,640
putting it together i will say you you

1090
00:39:32,640 --> 00:39:35,200
don't have to use every specific thing

1091
00:39:35,200 --> 00:39:37,040
in there just start

1092
00:39:37,040 --> 00:39:38,720
doing some

1093
00:39:38,720 --> 00:39:40,720
some testing though start out with some

1094
00:39:40,720 --> 00:39:43,040
atomic if you're not doing atomic

1095
00:39:43,040 --> 00:39:44,480
and then start looking at what

1096
00:39:44,480 --> 00:39:46,480
adversaries are doing that matter to

1097
00:39:46,480 --> 00:39:49,440
your organization and validate and build

1098
00:39:49,440 --> 00:39:53,440
detections around those procedures

1099
00:39:53,440 --> 00:39:54,800
and that's really what we're we're

1100
00:39:54,800 --> 00:39:57,359
trying to get to is just making sure

1101
00:39:57,359 --> 00:39:59,119
that when an adversary gets in we can

1102
00:39:59,119 --> 00:40:01,040
kick them out before impact

1103
00:40:01,040 --> 00:40:03,119
and as as an industry i don't think

1104
00:40:03,119 --> 00:40:05,119
we've done a good enough job because

1105
00:40:05,119 --> 00:40:06,960
ransomware has been so

1106
00:40:06,960 --> 00:40:09,440
prevalent it's just it's

1107
00:40:09,440 --> 00:40:11,839
it's impacting organizations across

1108
00:40:11,839 --> 00:40:12,960
different

1109
00:40:12,960 --> 00:40:15,280
industries and across different

1110
00:40:15,280 --> 00:40:17,200
countries

1111
00:40:17,200 --> 00:40:18,319
and

1112
00:40:18,319 --> 00:40:19,920
oftentimes they're still running the

1113
00:40:19,920 --> 00:40:21,839
same procedures

1114
00:40:21,839 --> 00:40:23,520
so we really need to get down to that

1115
00:40:23,520 --> 00:40:26,720
procedure level and help organizations

1116
00:40:26,720 --> 00:40:30,319
build detections tune their edrs

1117
00:40:30,319 --> 00:40:32,560
and get after the adversaries out there

1118
00:40:32,560 --> 00:40:34,560
i know it might make some red team jobs

1119
00:40:34,560 --> 00:40:36,240
harder but i think that's what we're

1120
00:40:36,240 --> 00:40:38,640
really about is having a more secure

1121
00:40:38,640 --> 00:40:39,520
world

1122
00:40:39,520 --> 00:40:40,640
and

1123
00:40:40,640 --> 00:40:43,760
having more secure

1124
00:40:43,760 --> 00:40:44,880
industry

1125
00:40:44,880 --> 00:40:46,800
and commerce

1126
00:40:46,800 --> 00:40:49,920
across the world so i hope that you go

1127
00:40:49,920 --> 00:40:51,359
out and you study some procedure

1128
00:40:51,359 --> 00:40:53,520
intelligence i hope you actually start

1129
00:40:53,520 --> 00:40:55,200
replicating different procedures that

1130
00:40:55,200 --> 00:40:57,920
you're seeing in organizations and like

1131
00:40:57,920 --> 00:40:59,680
i said happy procedure level purple

1132
00:40:59,680 --> 00:41:01,440
teaming i think that's the way of the

1133
00:41:01,440 --> 00:41:03,599
future i think that actually helps

1134
00:41:03,599 --> 00:41:04,720
validate

1135
00:41:04,720 --> 00:41:07,119
detections around our adversaries

1136
00:41:07,119 --> 00:41:09,040
and with that i'll open it up to any

1137
00:41:09,040 --> 00:41:12,040
questions

