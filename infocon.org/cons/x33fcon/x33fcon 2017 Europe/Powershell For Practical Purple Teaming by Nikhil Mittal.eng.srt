1
00:00:01,150 --> 00:00:04,330
[Applause]

2
00:00:10,280 --> 00:00:18,210
so thank<font color="#E5E5E5"> you very much for coming to the</font>

3
00:00:14,910 --> 00:00:21,720
talk I'm<font color="#CCCCCC"> going to talk about how we can</font>

4
00:00:18,210 --> 00:00:25,350
use<font color="#E5E5E5"> PowerShell for practical purpose</font>

5
00:00:21,720 --> 00:00:26,910
teaming are not the stuff which was

6
00:00:25,350 --> 00:00:28,529
discussed in<font color="#CCCCCC"> the</font><font color="#E5E5E5"> talk that talk--i</font>

7
00:00:26,910 --> 00:00:30,560
should watch after this one because I'm

8
00:00:28,529 --> 00:00:33,480
<font color="#CCCCCC">not going to discuss how you can</font>

9
00:00:30,560 --> 00:00:36,390
<font color="#E5E5E5">actually process the events once you</font>

10
00:00:33,480 --> 00:00:39,510
connect<font color="#E5E5E5"> them from from a Windows box</font>

11
00:00:36,390 --> 00:00:42,989
let's<font color="#E5E5E5"> say suppose maybe after the</font>

12
00:00:39,510 --> 00:00:44,730
conference if you're trying<font color="#E5E5E5"> to do</font><font color="#CCCCCC"> is to</font>

13
00:00:42,989 --> 00:00:47,879
<font color="#CCCCCC">implement something</font><font color="#E5E5E5"> really practical out</font>

14
00:00:44,730 --> 00:00:49,589
of the talk<font color="#E5E5E5"> watch this one first</font><font color="#CCCCCC"> see how</font>

15
00:00:47,879 --> 00:00:52,140
I just<font color="#E5E5E5"> point you how you can collect</font>

16
00:00:49,590 --> 00:00:56,129
<font color="#CCCCCC">some data and</font><font color="#E5E5E5"> then see the previous one</font>

17
00:00:52,140 --> 00:00:58,309
how you can actually do it on scale with

18
00:00:56,129 --> 00:01:01,620
that a<font color="#E5E5E5"> couple of</font><font color="#CCCCCC"> things about me</font><font color="#E5E5E5"> you</font>

19
00:00:58,309 --> 00:01:03,419
<font color="#CCCCCC">know I'm</font><font color="#E5E5E5"> a hacker obviously I trained at</font>

20
00:01:01,620 --> 00:01:06,840
various conferences trained for past

21
00:01:03,420 --> 00:01:08,760
<font color="#CCCCCC">three days</font><font color="#E5E5E5"> at</font><font color="#CCCCCC"> Sipan I speak at some of</font>

22
00:01:06,840 --> 00:01:11,490
the conference's spoken<font color="#E5E5E5"> ettor many</font>

23
00:01:08,760 --> 00:01:14,159
<font color="#E5E5E5">around the world on Twitter you can find</font>

24
00:01:11,490 --> 00:01:16,890
me up on this idea<font color="#E5E5E5"> you killed underscore</font>

25
00:01:14,159 --> 00:01:20,040
<font color="#E5E5E5">mi TT so if you are on Twitter please</font>

26
00:01:16,890 --> 00:01:23,159
follow me as I always say I'm a<font color="#E5E5E5"> sucker</font>

27
00:01:20,040 --> 00:01:26,220
for Twitter followers so please do that

28
00:01:23,159 --> 00:01:28,619
<font color="#CCCCCC">I blog regularly on lab of a penetration</font>

29
00:01:26,220 --> 00:01:31,408
tester<font color="#CCCCCC"> dot-com that's my home on</font><font color="#E5E5E5"> the</font>

30
00:01:28,619 --> 00:01:34,710
<font color="#E5E5E5">Internet I maintain</font><font color="#CCCCCC"> two open-source tool</font>

31
00:01:31,409 --> 00:01:36,450
kits for the<font color="#E5E5E5"> red teamers penetration</font>

32
00:01:34,710 --> 00:01:40,199
testers hackers whatever you want to say

33
00:01:36,450 --> 00:01:42,710
<font color="#E5E5E5">a</font><font color="#CCCCCC"> cotillion</font><font color="#E5E5E5"> mission</font><font color="#CCCCCC"> Cordelia</font><font color="#E5E5E5"> is useful</font>

34
00:01:40,200 --> 00:01:45,570
for for using human interface devices

35
00:01:42,710 --> 00:01:47,610
for offensive security<font color="#E5E5E5"> penetration</font>

36
00:01:45,570 --> 00:01:49,460
testing to break into boxes where of

37
00:01:47,610 --> 00:01:53,549
course<font color="#E5E5E5"> we have the permission</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> do so</font>

38
00:01:49,460 --> 00:01:55,530
nishang is a tool which is a collection

39
00:01:53,549 --> 00:01:57,090
of<font color="#CCCCCC"> powershell scripts which you can use</font>

40
00:01:55,530 --> 00:02:00,240
in different<font color="#E5E5E5"> phases</font><font color="#CCCCCC"> of a</font><font color="#E5E5E5"> penetration</font>

41
00:01:57,090 --> 00:02:02,729
test<font color="#CCCCCC"> I'm generally interested in new</font>

42
00:02:00,240 --> 00:02:05,280
<font color="#E5E5E5">ways of breaking into boxes once again</font>

43
00:02:02,729 --> 00:02:07,380
where I have<font color="#E5E5E5"> four mission to do so now</font>

44
00:02:05,280 --> 00:02:11,220
previously<font color="#E5E5E5"> spoken at</font><font color="#CCCCCC"> Def Con</font><font color="#E5E5E5"> or black</font>

45
00:02:07,380 --> 00:02:12,460
<font color="#CCCCCC">hat two troopers or</font><font color="#E5E5E5"> shat upon and few</font>

46
00:02:11,220 --> 00:02:15,270
<font color="#E5E5E5">more conferences</font>

47
00:02:12,460 --> 00:02:17,620
what we are going<font color="#E5E5E5"> to discuss today</font><font color="#CCCCCC"> is</font>

48
00:02:15,270 --> 00:02:19,990
<font color="#E5E5E5">what traditional red teaming was of</font>

49
00:02:17,620 --> 00:02:22,560
course<font color="#E5E5E5"> you must</font><font color="#CCCCCC"> have</font><font color="#E5E5E5"> seen some of these</font>

50
00:02:19,990 --> 00:02:28,060
<font color="#E5E5E5">things</font><font color="#CCCCCC"> already from the from the morning</font>

51
00:02:22,560 --> 00:02:29,650
<font color="#E5E5E5">why</font><font color="#CCCCCC"> why poeple teaming is a bit better</font>

52
00:02:28,060 --> 00:02:31,750
than<font color="#CCCCCC"> traditional red teaming what</font>

53
00:02:29,650 --> 00:02:34,870
purpose<font color="#E5E5E5"> teaming is actually why we</font><font color="#CCCCCC"> would</font>

54
00:02:31,750 --> 00:02:37,630
<font color="#CCCCCC">like to</font><font color="#E5E5E5"> use PowerShell for different</font>

55
00:02:34,870 --> 00:02:40,270
things<font color="#E5E5E5"> then couple of stories that would</font>

56
00:02:37,630 --> 00:02:42,790
take to<font color="#CCCCCC"> you through</font><font color="#E5E5E5"> purple teaming</font>

57
00:02:40,270 --> 00:02:44,890
stories with live demonstrations

58
00:02:42,790 --> 00:02:48,880
hopefully that<font color="#E5E5E5"> would be the more</font>

59
00:02:44,890 --> 00:02:50,829
interesting part and<font color="#E5E5E5"> then of how we can</font>

60
00:02:48,880 --> 00:02:52,750
implement purple teaming or just a

61
00:02:50,830 --> 00:02:55,560
brainstorming how<font color="#CCCCCC"> pop assuming can be</font>

62
00:02:52,750 --> 00:02:58,440
done with an external red team as well

63
00:02:55,560 --> 00:03:01,450
so the traditional red teaming has been

64
00:02:58,440 --> 00:03:04,180
has an adversarial nature that<font color="#CCCCCC"> tends you</font>

65
00:03:01,450 --> 00:03:10,119
<font color="#CCCCCC">up it is it has been drag versus blue</font>

66
00:03:04,180 --> 00:03:13,390
you need<font color="#CCCCCC"> our results who</font><font color="#E5E5E5"> want red born</font>

67
00:03:10,120 --> 00:03:15,910
<font color="#E5E5E5">or blue one or the I have been into</font>

68
00:03:13,390 --> 00:03:17,980
<font color="#E5E5E5">engagements where there there has there</font>

69
00:03:15,910 --> 00:03:21,010
have been<font color="#E5E5E5"> actually tracks or metrics of</font>

70
00:03:17,980 --> 00:03:23,619
the<font color="#E5E5E5"> points scored who who scored more</font>

71
00:03:21,010 --> 00:03:26,230
<font color="#CCCCCC">points</font><font color="#E5E5E5"> and that is where the adversarial</font>

72
00:03:23,620 --> 00:03:30,700
adversarial nature<font color="#E5E5E5"> the red vs. blue</font>

73
00:03:26,230 --> 00:03:32,200
narrative comes in<font color="#CCCCCC"> Oh</font><font color="#E5E5E5"> also what the</font>

74
00:03:30,700 --> 00:03:34,989
tradition of red teaming is of course

75
00:03:32,200 --> 00:03:36,730
<font color="#CCCCCC">I'm</font><font color="#E5E5E5"> I'm in no way against traditional</font>

76
00:03:34,990 --> 00:03:39,670
red teaming that's my bread and<font color="#E5E5E5"> butter</font>

77
00:03:36,730 --> 00:03:42,910
<font color="#E5E5E5">as</font><font color="#CCCCCC"> well but but</font><font color="#E5E5E5"> in traditional red</font>

78
00:03:39,670 --> 00:03:47,049
teaming<font color="#E5E5E5"> what we see generally is it is</font>

79
00:03:42,910 --> 00:03:50,560
focused on stealth the goal is for red

80
00:03:47,050 --> 00:03:53,350
team is not to get<font color="#E5E5E5"> caught which is which</font>

81
00:03:50,560 --> 00:03:56,440
<font color="#CCCCCC">is perfectly</font><font color="#E5E5E5"> fine if we we are trying to</font>

82
00:03:53,350 --> 00:04:00,340
simulate<font color="#E5E5E5"> a real adversary of the</font><font color="#CCCCCC"> best</font>

83
00:03:56,440 --> 00:04:03,490
way is to sue not to get caught<font color="#E5E5E5"> maybe</font>

84
00:04:00,340 --> 00:04:05,530
<font color="#E5E5E5">for like</font><font color="#CCCCCC"> ten years only four years</font><font color="#E5E5E5"> two</font>

85
00:04:03,490 --> 00:04:07,420
<font color="#CCCCCC">months one week depends on the length</font><font color="#E5E5E5"> of</font>

86
00:04:05,530 --> 00:04:09,280
<font color="#E5E5E5">the red team engagement of course there</font>

87
00:04:07,420 --> 00:04:10,869
has been no red team engagement in my

88
00:04:09,280 --> 00:04:13,570
<font color="#E5E5E5">knowledge where you're allowed to decide</font>

89
00:04:10,870 --> 00:04:16,149
inside an environment for<font color="#E5E5E5"> 10 years but</font>

90
00:04:13,570 --> 00:04:18,820
<font color="#E5E5E5">real attackers do they have been</font><font color="#CCCCCC"> cases</font>

91
00:04:16,149 --> 00:04:21,099
of technology<font color="#E5E5E5"> companies if for you can</font>

92
00:04:18,820 --> 00:04:23,800
guess what I'm talking<font color="#CCCCCC"> about who were</font>

93
00:04:21,100 --> 00:04:26,250
found<font color="#E5E5E5"> for let's say for a decade and</font>

94
00:04:23,800 --> 00:04:29,850
<font color="#E5E5E5">they they don't</font><font color="#CCCCCC"> know it</font>

95
00:04:26,250 --> 00:04:32,820
<font color="#CCCCCC">Oh because of this</font><font color="#E5E5E5"> focus on stealth many</font>

96
00:04:29,850 --> 00:04:35,130
red teamers do not want to share you

97
00:04:32,820 --> 00:04:36,900
know<font color="#E5E5E5"> their their methods their</font>

98
00:04:35,130 --> 00:04:40,050
<font color="#E5E5E5">technologies their techniques with blue</font>

99
00:04:36,900 --> 00:04:41,729
<font color="#CCCCCC">teams which</font><font color="#E5E5E5"> makes sense of course</font><font color="#CCCCCC"> even</font>

100
00:04:40,050 --> 00:04:43,350
even I<font color="#CCCCCC"> don't share it with the clients</font>

101
00:04:41,730 --> 00:04:47,340
unless it is<font color="#E5E5E5"> specifically asked that</font>

102
00:04:43,350 --> 00:04:49,950
something we with the<font color="#E5E5E5"> we spent weekends</font>

103
00:04:47,340 --> 00:04:52,340
nice to develop tools and<font color="#E5E5E5"> things of</font>

104
00:04:49,950 --> 00:04:54,810
course if<font color="#E5E5E5"> those are not open source</font>

105
00:04:52,340 --> 00:04:56,789
<font color="#E5E5E5">that's something which we develop that's</font>

106
00:04:54,810 --> 00:04:58,500
<font color="#E5E5E5">our intellectual property</font><font color="#CCCCCC"> similarly many</font>

107
00:04:56,790 --> 00:05:01,890
<font color="#E5E5E5">blue teamers</font><font color="#CCCCCC"> are why</font><font color="#E5E5E5"> discussing their</font>

108
00:04:58,500 --> 00:05:04,590
detection methodologies<font color="#E5E5E5"> techniques with</font>

109
00:05:01,890 --> 00:05:07,740
<font color="#E5E5E5">writings once again that's that that</font>

110
00:05:04,590 --> 00:05:10,200
<font color="#E5E5E5">makes sense as well</font><font color="#CCCCCC"> Oh</font><font color="#E5E5E5"> traditional red</font>

111
00:05:07,740 --> 00:05:14,760
teaming is adversarial nature once again

112
00:05:10,200 --> 00:05:16,800
red<font color="#CCCCCC"> versus blue a boxing match</font><font color="#E5E5E5"> of the</font>

113
00:05:14,760 --> 00:05:19,110
result may be<font color="#E5E5E5"> a knockdown</font><font color="#CCCCCC"> or after four</font>

114
00:05:16,800 --> 00:05:22,800
rounds<font color="#CCCCCC"> who won the matrix's</font><font color="#E5E5E5"> is in the</font>

115
00:05:19,110 --> 00:05:25,380
same<font color="#E5E5E5"> way also about this of which which</font>

116
00:05:22,800 --> 00:05:27,390
<font color="#E5E5E5">I added at the last moment in the slide</font>

117
00:05:25,380 --> 00:05:30,270
<font color="#E5E5E5">I've seen it a lot</font><font color="#CCCCCC"> of time faced this</font>

118
00:05:27,390 --> 00:05:32,820
problem<font color="#E5E5E5"> myself as well red teamers</font>

119
00:05:30,270 --> 00:05:35,310
generally do<font color="#CCCCCC"> not</font><font color="#E5E5E5"> have access</font><font color="#CCCCCC"> to the</font>

120
00:05:32,820 --> 00:05:38,300
<font color="#CCCCCC">enterprise-grade</font><font color="#E5E5E5"> tools which blue</font>

121
00:05:35,310 --> 00:05:40,500
teamers have access to now<font color="#E5E5E5"> let's say of</font>

122
00:05:38,300 --> 00:05:42,630
<font color="#E5E5E5">multi-million dollar</font><font color="#CCCCCC"> stream device which</font>

123
00:05:40,500 --> 00:05:45,030
may or may<font color="#CCCCCC"> not be useful depending on</font>

124
00:05:42,630 --> 00:05:48,260
how you configure<font color="#E5E5E5"> it but still having</font>

125
00:05:45,030 --> 00:05:51,030
the ability to<font color="#E5E5E5"> correlate events things</font>

126
00:05:48,260 --> 00:05:52,789
<font color="#CCCCCC">it may</font><font color="#E5E5E5"> mean or may not be possible for</font><font color="#CCCCCC"> a</font>

127
00:05:51,030 --> 00:05:55,349
<font color="#CCCCCC">recce mother have access to that</font>

128
00:05:52,790 --> 00:05:57,690
<font color="#E5E5E5">specifically for a freelancer like me</font><font color="#CCCCCC"> i</font>

129
00:05:55,350 --> 00:06:01,169
rely more on open<font color="#E5E5E5"> source or maybe just</font>

130
00:05:57,690 --> 00:06:03,479
some tools<font color="#CCCCCC"> in such cases it is always</font>

131
00:06:01,169 --> 00:06:07,080
<font color="#E5E5E5">advised if you can just make your red</font>

132
00:06:03,479 --> 00:06:10,200
<font color="#CCCCCC">and blue team work together</font><font color="#E5E5E5"> now what and</font>

133
00:06:07,080 --> 00:06:12,960
or how property<font color="#E5E5E5"> purple teaming can help</font>

134
00:06:10,200 --> 00:06:15,180
in<font color="#E5E5E5"> such a scenario once again there are</font>

135
00:06:12,960 --> 00:06:18,390
<font color="#CCCCCC">different goals for</font><font color="#E5E5E5"> a penetration test</font>

136
00:06:15,180 --> 00:06:20,990
<font color="#CCCCCC">alright</font><font color="#E5E5E5"> teaming or a purpose</font><font color="#CCCCCC"> teaming so</font>

137
00:06:18,390 --> 00:06:23,700
<font color="#E5E5E5">it do not think of it is a Venn diagram</font>

138
00:06:20,990 --> 00:06:26,580
<font color="#E5E5E5">intersecting somewhere it is</font><font color="#CCCCCC"> not at all</font>

139
00:06:23,700 --> 00:06:29,780
<font color="#E5E5E5">that the</font><font color="#CCCCCC"> the goals of all</font><font color="#E5E5E5"> these</font>

140
00:06:26,580 --> 00:06:33,300
exercises<font color="#E5E5E5"> is completely different</font>

141
00:06:29,780 --> 00:06:36,989
<font color="#CCCCCC">so what is purple teaming it's not red</font>

142
00:06:33,300 --> 00:06:39,180
<font color="#CCCCCC">versus blue it's red</font><font color="#E5E5E5"> and blue so for me</font>

143
00:06:36,990 --> 00:06:39,920
you<font color="#CCCCCC"> know</font><font color="#E5E5E5"> I should admit</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> it's false</font>

144
00:06:39,180 --> 00:06:44,720
<font color="#E5E5E5">it's been</font>

145
00:06:39,920 --> 00:06:46,790
like an<font color="#E5E5E5"> ear or so when I started doing</font>

146
00:06:44,720 --> 00:06:48,980
<font color="#E5E5E5">this thing there were presentations by I</font>

147
00:06:46,790 --> 00:06:51,680
think<font color="#CCCCCC"> I know if Chris Gates is here or</font>

148
00:06:48,980 --> 00:06:53,050
<font color="#E5E5E5">not</font><font color="#CCCCCC"> you're supposed to</font><font color="#E5E5E5"> do a</font><font color="#CCCCCC"> presentation</font>

149
00:06:51,680 --> 00:06:57,290
with<font color="#CCCCCC"> mu bigs</font>

150
00:06:53,050 --> 00:06:58,850
so I saw that<font color="#E5E5E5"> presentation got queries</font>

151
00:06:57,290 --> 00:07:02,360
from<font color="#E5E5E5"> some of</font><font color="#CCCCCC"> my</font><font color="#E5E5E5"> clients if you can do</font>

152
00:06:58,850 --> 00:07:04,520
something<font color="#CCCCCC"> like</font><font color="#E5E5E5"> this I tried it with few</font>

153
00:07:02,360 --> 00:07:06,320
clients<font color="#CCCCCC"> they'd like to not more</font><font color="#E5E5E5"> than</font><font color="#CCCCCC"> ten</font>

154
00:07:04,520 --> 00:07:09,289
<font color="#E5E5E5">engagements</font><font color="#CCCCCC"> up to now</font><font color="#E5E5E5"> for purple teaming</font>

155
00:07:06,320 --> 00:07:14,750
how I did that was sitting<font color="#E5E5E5"> with the blue</font>

156
00:07:09,290 --> 00:07:16,550
team<font color="#CCCCCC"> more of more</font><font color="#E5E5E5"> of it in a you know</font><font color="#CCCCCC"> in</font>

157
00:07:14,750 --> 00:07:18,500
a training set up instead<font color="#E5E5E5"> of using my</font>

158
00:07:16,550 --> 00:07:22,310
lab access<font color="#E5E5E5"> which</font><font color="#CCCCCC"> you which I use in my</font>

159
00:07:18,500 --> 00:07:23,720
my training classes<font color="#CCCCCC"> we use</font><font color="#E5E5E5"> their live</font>

160
00:07:22,310 --> 00:07:25,070
network<font color="#E5E5E5"> of course with the permission</font>

161
00:07:23,720 --> 00:07:27,980
and<font color="#E5E5E5"> all that and do it in the training</font>

162
00:07:25,070 --> 00:07:29,990
<font color="#E5E5E5">format that is to work together to</font>

163
00:07:27,980 --> 00:07:35,260
<font color="#E5E5E5">improve</font><font color="#CCCCCC"> the security</font><font color="#E5E5E5"> not just to score</font>

164
00:07:29,990 --> 00:07:37,640
points<font color="#E5E5E5"> the focus is on detection that's</font>

165
00:07:35,260 --> 00:07:40,400
that's what is<font color="#E5E5E5"> the major difference</font>

166
00:07:37,640 --> 00:07:44,750
<font color="#E5E5E5">between the red and or purple assessment</font>

167
00:07:40,400 --> 00:07:47,719
is you must get caught<font color="#E5E5E5"> that's and this I</font>

168
00:07:44,750 --> 00:07:49,340
directly<font color="#CCCCCC"> quote Chris here</font><font color="#E5E5E5"> the focus is</font>

169
00:07:47,720 --> 00:07:52,690
on assessing detection and response

170
00:07:49,340 --> 00:07:55,640
mechanisms that<font color="#CCCCCC"> is</font><font color="#E5E5E5"> getting caught and</font>

171
00:07:52,690 --> 00:07:58,280
training of red and blue teams if you

172
00:07:55,640 --> 00:08:00,950
get start<font color="#E5E5E5"> red team need</font><font color="#CCCCCC"> to improve their</font>

173
00:07:58,280 --> 00:08:02,299
<font color="#CCCCCC">tailor tools and techniques if you don't</font>

174
00:08:00,950 --> 00:08:06,190
get<font color="#E5E5E5"> caught then blue team needs to</font>

175
00:08:02,300 --> 00:08:06,190
<font color="#E5E5E5">improve their detection mechanisms oh</font>

176
00:08:06,400 --> 00:08:13,489
and why detection and prevention because

177
00:08:10,460 --> 00:08:16,729
<font color="#E5E5E5">that's proactive it's not something like</font>

178
00:08:13,490 --> 00:08:18,830
<font color="#CCCCCC">you got hacked</font><font color="#E5E5E5"> and then you try to find</font>

179
00:08:16,730 --> 00:08:22,400
out who was<font color="#CCCCCC"> the attacker this was the</font>

180
00:08:18,830 --> 00:08:24,830
<font color="#CCCCCC">CNC or</font><font color="#E5E5E5"> probably an Asian actor</font><font color="#CCCCCC"> or</font>

181
00:08:22,400 --> 00:08:27,890
something<font color="#CCCCCC"> like that try to</font><font color="#E5E5E5"> do it before</font>

182
00:08:24,830 --> 00:08:30,400
<font color="#CCCCCC">you got hacked</font><font color="#E5E5E5"> and later on when you</font>

183
00:08:27,890 --> 00:08:32,659
when we<font color="#E5E5E5"> discussed the assumed Beach of</font>

184
00:08:30,400 --> 00:08:36,909
methodology which<font color="#CCCCCC"> is used by Microsoft's</font>

185
00:08:32,659 --> 00:08:40,339
cloud<font color="#E5E5E5"> writing security we will see that</font>

186
00:08:36,909 --> 00:08:42,890
it is<font color="#CCCCCC"> always better to assume</font><font color="#E5E5E5"> that you</font>

187
00:08:40,340 --> 00:08:45,470
are<font color="#E5E5E5"> already hacked there is an adversary</font>

188
00:08:42,890 --> 00:08:50,270
living in your environment<font color="#CCCCCC"> and in that</font>

189
00:08:45,470 --> 00:08:53,480
case<font color="#E5E5E5"> purple teaming helps even</font><font color="#CCCCCC"> more once</font>

190
00:08:50,270 --> 00:08:57,170
again if attacks are successful

191
00:08:53,480 --> 00:09:01,700
<font color="#E5E5E5">trained looting attacks Phil trained red</font>

192
00:08:57,170 --> 00:09:03,229
<font color="#E5E5E5">team improvement</font><font color="#CCCCCC"> for both of us</font><font color="#E5E5E5"> also</font><font color="#CCCCCC"> red</font>

193
00:09:01,700 --> 00:09:05,600
team<font color="#E5E5E5"> gets to see the monitoring</font>

194
00:09:03,230 --> 00:09:08,690
<font color="#E5E5E5">detection and response mechanisms</font><font color="#CCCCCC"> I</font>

195
00:09:05,600 --> 00:09:11,950
never knew before<font color="#E5E5E5"> doing</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> purple teaming</font>

196
00:09:08,690 --> 00:09:15,650
environment<font color="#E5E5E5"> that there is something</font><font color="#CCCCCC"> like</font>

197
00:09:11,950 --> 00:09:18,080
<font color="#E5E5E5">time-based law correlation</font><font color="#CCCCCC"> where in new</font>

198
00:09:15,650 --> 00:09:20,360
teams can actually<font color="#E5E5E5"> create a complete</font>

199
00:09:18,080 --> 00:09:23,020
timeline<font color="#E5E5E5"> of my attack using automated</font>

200
00:09:20,360 --> 00:09:26,030
<font color="#CCCCCC">tools never knew that</font>

201
00:09:23,020 --> 00:09:29,030
similarly<font color="#E5E5E5"> gluten gets to see how we can</font>

202
00:09:26,030 --> 00:09:30,680
run let's say my clients<font color="#E5E5E5"> always when I</font>

203
00:09:29,030 --> 00:09:33,050
used to use PowerShell in in my rectum

204
00:09:30,680 --> 00:09:34,819
<font color="#CCCCCC">engagements</font><font color="#E5E5E5"> during</font><font color="#CCCCCC"> my closure meetings</font>

205
00:09:33,050 --> 00:09:37,160
<font color="#E5E5E5">the clients would always recommend</font>

206
00:09:34,820 --> 00:09:39,860
blocking let's say<font color="#E5E5E5"> PowerShell that</font><font color="#CCCCCC"> exe</font>

207
00:09:37,160 --> 00:09:41,870
of course that<font color="#E5E5E5"> doesn't help those</font><font color="#CCCCCC"> of you</font>

208
00:09:39,860 --> 00:09:43,250
who overviews PowerShell in<font color="#CCCCCC"> red team</font>

209
00:09:41,870 --> 00:09:45,170
engagements will know<font color="#CCCCCC"> that blocking</font>

210
00:09:43,250 --> 00:09:48,950
PowerShell that exe is<font color="#E5E5E5"> not a solution at</font>

211
00:09:45,170 --> 00:09:51,979
all<font color="#E5E5E5"> it's just</font><font color="#CCCCCC"> a snake-oil so</font><font color="#E5E5E5"> that my</font>

212
00:09:48,950 --> 00:09:55,900
clients blue<font color="#E5E5E5"> team's get to know with</font><font color="#CCCCCC"> the</font>

213
00:09:51,980 --> 00:10:00,740
<font color="#CCCCCC">help of my knowledge or what</font><font color="#E5E5E5"> I know now</font>

214
00:09:55,900 --> 00:10:02,959
why PowerShell<font color="#E5E5E5"> of course of how many</font><font color="#CCCCCC"> of</font>

215
00:10:00,740 --> 00:10:09,290
you actually<font color="#E5E5E5"> use PowerShell for red or</font>

216
00:10:02,960 --> 00:10:14,300
blue many not many<font color="#E5E5E5"> still oh I got a big</font>

217
00:10:09,290 --> 00:10:16,339
<font color="#E5E5E5">hand over there so a partial because it</font>

218
00:10:14,300 --> 00:10:18,439
is<font color="#E5E5E5"> available by default in modern</font>

219
00:10:16,340 --> 00:10:21,560
Windows operating system<font color="#CCCCCC"> post Windows</font>

220
00:10:18,440 --> 00:10:24,770
<font color="#E5E5E5">Vista in all windows of ring operating</font>

221
00:10:21,560 --> 00:10:26,689
systems<font color="#E5E5E5"> seven eight dated one ten two</font>

222
00:10:24,770 --> 00:10:28,850
thousand eight twelve sixteen in all of

223
00:10:26,690 --> 00:10:32,540
these<font color="#E5E5E5"> even Windows IOT code you will</font>

224
00:10:28,850 --> 00:10:34,760
have a PowerShell present and that makes

225
00:10:32,540 --> 00:10:36,680
it really useful with upgrade to

226
00:10:34,760 --> 00:10:39,350
<font color="#CCCCCC">PowerShell version five</font><font color="#E5E5E5"> the detection</font>

227
00:10:36,680 --> 00:10:41,349
<font color="#E5E5E5">capabilities have</font><font color="#CCCCCC"> been enhanced a lot</font><font color="#E5E5E5"> it</font>

228
00:10:39,350 --> 00:10:45,400
provides you access to<font color="#CCCCCC"> job lay my</font>

229
00:10:41,350 --> 00:10:47,600
<font color="#CCCCCC">windows</font><font color="#E5E5E5"> API so</font><font color="#CCCCCC"> WMI is an alternate</font>

230
00:10:45,400 --> 00:10:50,770
object system<font color="#CCCCCC"> it is still</font><font color="#E5E5E5"> provides you</font>

231
00:10:47,600 --> 00:10:53,810
access<font color="#E5E5E5"> to that comma objects so comma if</font>

232
00:10:50,770 --> 00:10:57,260
if you are<font color="#CCCCCC"> really</font><font color="#E5E5E5"> up to</font><font color="#CCCCCC"> date with with</font>

233
00:10:53,810 --> 00:11:01,250
<font color="#E5E5E5">latest threat vectors you may like to</font>

234
00:10:57,260 --> 00:11:04,460
<font color="#E5E5E5">see talks by let's say</font><font color="#CCCCCC"> KZ JC Smith who</font>

235
00:11:01,250 --> 00:11:06,950
works a lot on<font color="#E5E5E5"> comm object and that do</font>

236
00:11:04,460 --> 00:11:07,250
that basically<font color="#E5E5E5"> tweets whitelisting by</font>

237
00:11:06,950 --> 00:11:11,180
<font color="#CCCCCC">far</font>

238
00:11:07,250 --> 00:11:12,680
every second<font color="#CCCCCC"> minute so about</font><font color="#E5E5E5"> she'll want</font>

239
00:11:11,180 --> 00:11:14,510
to<font color="#E5E5E5"> empower shall provide</font><font color="#CCCCCC"> success not</font>

240
00:11:12,680 --> 00:11:16,160
<font color="#E5E5E5">only to these things to registry other</font>

241
00:11:14,510 --> 00:11:18,310
boxes<font color="#E5E5E5"> on the net file</font><font color="#CCCCCC"> powershell</font>

242
00:11:16,160 --> 00:11:20,750
remoting<font color="#CCCCCC"> provides you the ability to</font>

243
00:11:18,310 --> 00:11:23,420
interact<font color="#E5E5E5"> with other boxes on the network</font>

244
00:11:20,750 --> 00:11:25,910
<font color="#CCCCCC">that have administrative credentials</font><font color="#E5E5E5"> it</font>

245
00:11:23,420 --> 00:11:28,400
is based on dotnet framework<font color="#E5E5E5"> which means</font>

246
00:11:25,910 --> 00:11:30,860
you can extend its capability if

247
00:11:28,400 --> 00:11:34,699
something is<font color="#E5E5E5"> not</font><font color="#CCCCCC"> available in PowerShell</font>

248
00:11:30,860 --> 00:11:38,120
<font color="#E5E5E5">by default so why</font><font color="#CCCCCC"> ratting</font><font color="#E5E5E5"> would use</font>

249
00:11:34,700 --> 00:11:39,950
partial those of who you do red teaming

250
00:11:38,120 --> 00:11:44,020
or even penetration testing and are not

251
00:11:39,950 --> 00:11:46,730
<font color="#E5E5E5">using this ability</font><font color="#CCCCCC"> to</font><font color="#E5E5E5"> execute attacks</font>

252
00:11:44,020 --> 00:11:48,140
<font color="#E5E5E5">without touching disk and</font><font color="#CCCCCC"> that is</font>

253
00:11:46,730 --> 00:11:50,570
something<font color="#E5E5E5"> which is</font><font color="#CCCCCC"> built in PowerShell</font>

254
00:11:48,140 --> 00:11:54,710
<font color="#E5E5E5">sounds really</font><font color="#CCCCCC"> easy to do</font><font color="#E5E5E5"> it's hard to do</font>

255
00:11:50,570 --> 00:11:59,780
without having tools like<font color="#E5E5E5"> PowerShell at</font>

256
00:11:54,710 --> 00:12:02,080
your disposal script based attacks that

257
00:11:59,780 --> 00:12:04,160
means if you use partial scripts

258
00:12:02,080 --> 00:12:07,220
<font color="#E5E5E5">specifically not the frameworks</font><font color="#CCCCCC"> and</font>

259
00:12:04,160 --> 00:12:09,140
single script the chances of detection

260
00:12:07,220 --> 00:12:11,480
<font color="#E5E5E5">are really low it</font><font color="#CCCCCC"> is this</font><font color="#E5E5E5"> easy to change</font>

261
00:12:09,140 --> 00:12:13,960
<font color="#E5E5E5">signature for your</font><font color="#CCCCCC"> script and you can</font>

262
00:12:11,480 --> 00:12:16,610
avoid detection for<font color="#CCCCCC"> a really long</font><font color="#E5E5E5"> time</font>

263
00:12:13,960 --> 00:12:19,430
<font color="#CCCCCC">plenty</font><font color="#E5E5E5"> of open source attack tools the</font>

264
00:12:16,610 --> 00:12:23,030
this is<font color="#CCCCCC"> CD the hard thing when it comes</font>

265
00:12:19,430 --> 00:12:26,989
to attackers<font color="#E5E5E5"> you may need not write</font>

266
00:12:23,030 --> 00:12:29,209
anything you<font color="#E5E5E5"> if you just maybe look up</font>

267
00:12:26,990 --> 00:12:30,560
on the internet<font color="#CCCCCC"> for something</font><font color="#E5E5E5"> if it can</font>

268
00:12:29,210 --> 00:12:33,290
be<font color="#E5E5E5"> done with the help of PowerShell</font>

269
00:12:30,560 --> 00:12:35,239
something<font color="#CCCCCC"> nasty some</font><font color="#E5E5E5"> something for</font>

270
00:12:33,290 --> 00:12:37,099
offensive security<font color="#CCCCCC"> there may</font><font color="#E5E5E5"> be already</font>

271
00:12:35,240 --> 00:12:41,900
<font color="#E5E5E5">a script of</font><font color="#CCCCCC"> framework which has that</font>

272
00:12:37,100 --> 00:12:44,000
<font color="#E5E5E5">thing and capability to avoid or bypass</font>

273
00:12:41,900 --> 00:12:49,550
<font color="#E5E5E5">detection mechanisms will I think</font><font color="#CCCCCC"> we</font>

274
00:12:44,000 --> 00:12:52,790
will<font color="#E5E5E5"> have</font><font color="#CCCCCC"> a look</font><font color="#E5E5E5"> at this thing alive why</font>

275
00:12:49,550 --> 00:12:55,459
would you team use it once<font color="#CCCCCC"> again ability</font>

276
00:12:52,790 --> 00:12:57,969
<font color="#E5E5E5">to exit monitoring and detection scripts</font>

277
00:12:55,460 --> 00:13:00,800
<font color="#E5E5E5">without</font><font color="#CCCCCC"> installing agents Oh</font>

278
00:12:57,970 --> 00:13:02,420
<font color="#CCCCCC">so agent installation is something which</font>

279
00:13:00,800 --> 00:13:04,699
which creeps up<font color="#CCCCCC"> whenever you discuss</font>

280
00:13:02,420 --> 00:13:07,520
detection mechanisms with the<font color="#E5E5E5"> fabulous</font>

281
00:13:04,700 --> 00:13:10,610
performance of many antivirus vendors to

282
00:13:07,520 --> 00:13:13,160
get owned while running a system<font color="#CCCCCC"> on</font>

283
00:13:10,610 --> 00:13:15,830
different boxes with the data protection

284
00:13:13,160 --> 00:13:17,839
<font color="#E5E5E5">mechanisms getting on with their agents</font>

285
00:13:15,830 --> 00:13:20,690
<font color="#E5E5E5">agent</font><font color="#CCCCCC"> installation is something which</font>

286
00:13:17,839 --> 00:13:24,440
<font color="#CCCCCC">always comes up</font><font color="#E5E5E5"> when we discuss the</font><font color="#CCCCCC"> fair</font>

287
00:13:20,690 --> 00:13:27,530
<font color="#E5E5E5">defense mechanisms are techniques of</font>

288
00:13:24,440 --> 00:13:29,800
agent lee the ability to run<font color="#E5E5E5"> agentless</font>

289
00:13:27,530 --> 00:13:30,920
<font color="#E5E5E5">detection mechanisms with the help of</font>

290
00:13:29,800 --> 00:13:35,449
anyone

291
00:13:30,920 --> 00:13:37,040
<font color="#E5E5E5">WMI maybe you can</font><font color="#CCCCCC"> easily access WMI with</font>

292
00:13:35,450 --> 00:13:42,130
<font color="#CCCCCC">powershell</font><font color="#E5E5E5"> with just</font><font color="#CCCCCC"> four commandlets</font>

293
00:13:37,040 --> 00:13:44,810
<font color="#E5E5E5">and the ability to use that</font><font color="#CCCCCC"> WMI stuff</font>

294
00:13:42,130 --> 00:13:47,330
for agent less detection mechanisms

295
00:13:44,810 --> 00:13:49,369
takes<font color="#CCCCCC"> powershell a real mix also really</font>

296
00:13:47,330 --> 00:13:52,070
really<font color="#E5E5E5"> useful</font><font color="#CCCCCC"> when it</font><font color="#E5E5E5"> comes to blue</font>

297
00:13:49,370 --> 00:13:54,500
<font color="#CCCCCC">team's</font><font color="#E5E5E5"> I think it's not in the slides</font>

298
00:13:52,070 --> 00:13:57,950
<font color="#E5E5E5">but tools like from the guys from</font>

299
00:13:54,500 --> 00:14:01,640
<font color="#CCCCCC">mandate</font><font color="#E5E5E5"> wrw my ideas an inclusion</font>

300
00:13:57,950 --> 00:14:03,800
detection system not tried it yet<font color="#CCCCCC"> don't</font>

301
00:14:01,640 --> 00:14:07,069
<font color="#CCCCCC">even I don't</font><font color="#E5E5E5"> know if it works in</font>

302
00:14:03,800 --> 00:14:10,579
<font color="#CCCCCC">production environment or</font><font color="#E5E5E5"> not but to do</font>

303
00:14:07,070 --> 00:14:13,820
like<font color="#E5E5E5"> EE my ideas are based completely on</font>

304
00:14:10,580 --> 00:14:15,590
<font color="#CCCCCC">WMI with agent</font><font color="#E5E5E5"> less detection mechanisms</font>

305
00:14:13,820 --> 00:14:19,970
that could be really really<font color="#CCCCCC"> helpful for</font>

306
00:14:15,590 --> 00:14:22,190
<font color="#E5E5E5">blue team's not only that if you ever</font>

307
00:14:19,970 --> 00:14:24,740
use PowerShell remoting<font color="#CCCCCC"> let's say for</font>

308
00:14:22,190 --> 00:14:26,300
little movement things like invoke

309
00:14:24,740 --> 00:14:28,760
command which is<font color="#CCCCCC"> a command letting</font>

310
00:14:26,300 --> 00:14:33,140
PowerShell to<font color="#E5E5E5"> execute stuff on different</font>

311
00:14:28,760 --> 00:14:35,060
boxes that allows you<font color="#E5E5E5"> to scale so invoke</font>

312
00:14:33,140 --> 00:14:37,010
a thing about invoke command that

313
00:14:35,060 --> 00:14:39,739
command let allows you to execute

314
00:14:37,010 --> 00:14:41,240
scripts<font color="#E5E5E5"> and commands on let's say 10,000</font>

315
00:14:39,740 --> 00:14:45,050
boxes<font color="#CCCCCC"> parallely that's a</font><font color="#E5E5E5"> built-in</font>

316
00:14:41,240 --> 00:14:47,150
feature<font color="#E5E5E5"> why that is not useful</font><font color="#CCCCCC"> for a</font>

317
00:14:45,050 --> 00:14:50,240
blue team guy of course<font color="#CCCCCC"> it is I mean you</font>

318
00:14:47,150 --> 00:14:52,370
can run<font color="#E5E5E5"> your detection scripts of she'll</font>

319
00:14:50,240 --> 00:14:54,830
a job<font color="#CCCCCC"> a partial job maybe on</font><font color="#E5E5E5"> your domain</font>

320
00:14:52,370 --> 00:14:58,460
controller somewhere run a simple

321
00:14:54,830 --> 00:15:00,710
detection script or a<font color="#E5E5E5"> baselining script</font>

322
00:14:58,460 --> 00:15:03,440
every half an hour<font color="#CCCCCC"> our NR on all of your</font>

323
00:15:00,710 --> 00:15:05,990
boxes<font color="#CCCCCC"> parallely without having really</font>

324
00:15:03,440 --> 00:15:09,800
any overhead overhead on the performance

325
00:15:05,990 --> 00:15:12,530
<font color="#CCCCCC">oh another thing</font><font color="#E5E5E5"> which I would</font><font color="#CCCCCC"> like to</font>

326
00:15:09,800 --> 00:15:14,240
mention here<font color="#CCCCCC"> is so which which I started</font>

327
00:15:12,530 --> 00:15:18,709
<font color="#CCCCCC">with</font><font color="#E5E5E5"> actually blocking PowerShell dot</font>

328
00:15:14,240 --> 00:15:21,440
exe<font color="#CCCCCC"> I have been</font><font color="#E5E5E5"> in two meetings or</font><font color="#CCCCCC"> a</font>

329
00:15:18,710 --> 00:15:24,680
closure meetings discussions etc<font color="#E5E5E5"> where</font>

330
00:15:21,440 --> 00:15:26,900
PowerShell dot exe is considered or

331
00:15:24,680 --> 00:15:29,000
<font color="#CCCCCC">PowerShell in itself is</font><font color="#E5E5E5"> considered the</font>

332
00:15:26,900 --> 00:15:31,790
evil something<font color="#CCCCCC"> which has been unleashed</font>

333
00:15:29,000 --> 00:15:34,230
on on the walls and it will consume it

334
00:15:31,790 --> 00:15:36,750
all it's<font color="#E5E5E5"> not</font><font color="#CCCCCC"> that thing</font>

335
00:15:34,230 --> 00:15:38,550
in fact if<font color="#E5E5E5"> you're as well as a vacuum or</font>

336
00:15:36,750 --> 00:15:41,070
who has<font color="#E5E5E5"> been doing things these things</font>

337
00:15:38,550 --> 00:15:45,000
for past nine years<font color="#E5E5E5"> I can assure you</font>

338
00:15:41,070 --> 00:15:47,010
that<font color="#E5E5E5"> I can bet</font><font color="#CCCCCC"> my life on it</font><font color="#E5E5E5"> if you have</font>

339
00:15:45,000 --> 00:15:47,730
PowerShell version<font color="#CCCCCC"> 5 installed on</font><font color="#E5E5E5"> your</font>

340
00:15:47,010 --> 00:15:50,370
boxes

341
00:15:47,730 --> 00:15:53,250
the chances of detection<font color="#E5E5E5"> often attacked</font>

342
00:15:50,370 --> 00:15:56,010
<font color="#E5E5E5">are on your box increases multifold</font><font color="#CCCCCC"> it</font>

343
00:15:53,250 --> 00:15:58,410
is really really really<font color="#CCCCCC"> hard not to</font>

344
00:15:56,010 --> 00:16:00,150
leave<font color="#CCCCCC"> a trace if you have PowerShell</font>

345
00:15:58,410 --> 00:16:02,310
version 5<font color="#E5E5E5"> installed with its and an</font>

346
00:16:00,150 --> 00:16:03,600
enhanced logging capabilities<font color="#E5E5E5"> and of</font>

347
00:16:02,310 --> 00:16:05,640
course if<font color="#CCCCCC"> you're managing</font><font color="#E5E5E5"> your logs</font>

348
00:16:03,600 --> 00:16:08,580
perfectly as discussed<font color="#E5E5E5"> in the last</font><font color="#CCCCCC"> last</font>

349
00:16:05,640 --> 00:16:10,470
talk<font color="#E5E5E5"> you're forwarding things to</font><font color="#CCCCCC"> two</font>

350
00:16:08,580 --> 00:16:12,830
<font color="#CCCCCC">central log system monitoring things of</font>

351
00:16:10,470 --> 00:16:16,920
<font color="#E5E5E5">course if</font><font color="#CCCCCC"> no-one is</font><font color="#E5E5E5"> monitoring the logs</font>

352
00:16:12,830 --> 00:16:18,960
<font color="#E5E5E5">logging anything is useless</font><font color="#CCCCCC"> so if you</font>

353
00:16:16,920 --> 00:16:21,060
have PowerShell version 5 installed<font color="#CCCCCC"> and</font>

354
00:16:18,960 --> 00:16:24,480
ends logging capabilities<font color="#E5E5E5"> like system by</font>

355
00:16:21,060 --> 00:16:27,510
transcripts or<font color="#CCCCCC"> suspiciousness script</font>

356
00:16:24,480 --> 00:16:29,040
<font color="#CCCCCC">block</font><font color="#E5E5E5"> logging couple that with the with</font>

357
00:16:27,510 --> 00:16:32,189
the elephant in<font color="#CCCCCC"> the room which</font><font color="#E5E5E5"> no one</font>

358
00:16:29,040 --> 00:16:34,439
wants<font color="#CCCCCC"> to address process creation a logs</font>

359
00:16:32,190 --> 00:16:37,440
<font color="#E5E5E5">or if you have all these three</font><font color="#CCCCCC"> things</font>

360
00:16:34,440 --> 00:16:39,690
set up<font color="#E5E5E5"> its really really</font><font color="#CCCCCC"> hard not to</font>

361
00:16:37,440 --> 00:16:42,450
leave a trace any attacker will leave a

362
00:16:39,690 --> 00:16:44,520
trace somewhere of course if if you

363
00:16:42,450 --> 00:16:46,710
still find<font color="#CCCCCC"> ways to silently do things</font>

364
00:16:44,520 --> 00:16:48,569
after<font color="#CCCCCC"> this that's what purple</font><font color="#E5E5E5"> teaming is</font>

365
00:16:46,710 --> 00:16:52,560
for come up with new ways<font color="#CCCCCC"> of detection</font>

366
00:16:48,570 --> 00:16:55,170
<font color="#CCCCCC">oh</font><font color="#E5E5E5"> then there are plenty of open source</font>

367
00:16:52,560 --> 00:16:58,079
detection and response tools<font color="#E5E5E5"> when it</font>

368
00:16:55,170 --> 00:17:01,530
comes to beauty<font color="#CCCCCC"> em as</font><font color="#E5E5E5"> well</font><font color="#CCCCCC"> now some of</font>

369
00:16:58,080 --> 00:17:03,570
which I can quote at the<font color="#E5E5E5"> top of my head</font>

370
00:17:01,530 --> 00:17:07,319
<font color="#CCCCCC">concerts</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> IR Incident Response</font>

371
00:17:03,570 --> 00:17:10,290
framework<font color="#CCCCCC"> posh tech power forensics</font>

372
00:17:07,319 --> 00:17:12,689
<font color="#CCCCCC">invoke IR all these are</font><font color="#E5E5E5"> open source</font>

373
00:17:10,290 --> 00:17:15,000
<font color="#E5E5E5">PowerShell tools which you can</font><font color="#CCCCCC"> use for</font>

374
00:17:12,690 --> 00:17:19,890
<font color="#E5E5E5">Incident Response baselining auditing</font>

375
00:17:15,000 --> 00:17:22,890
and<font color="#E5E5E5"> whatnot also if you are specifically</font>

376
00:17:19,890 --> 00:17:27,089
or threatened by PowerShell the name

377
00:17:22,890 --> 00:17:30,660
PowerShell itself then you<font color="#E5E5E5"> can then</font><font color="#CCCCCC"> you</font>

378
00:17:27,089 --> 00:17:33,149
have the capability to to really run

379
00:17:30,660 --> 00:17:35,160
PowerShell in a constraint mode maybe

380
00:17:33,150 --> 00:17:37,650
<font color="#CCCCCC">try by application whitelisting</font>

381
00:17:35,160 --> 00:17:41,220
it can of course<font color="#CCCCCC"> we bypass but at least</font>

382
00:17:37,650 --> 00:17:43,800
it adds a cost to the attacker<font color="#E5E5E5"> so that's</font>

383
00:17:41,220 --> 00:17:46,020
why I drag and you<font color="#E5E5E5"> should use or they</font>

384
00:17:43,800 --> 00:17:47,560
use partial why should purple use it<font color="#E5E5E5"> or</font>

385
00:17:46,020 --> 00:17:49,629
a purple<font color="#CCCCCC"> theme</font>

386
00:17:47,560 --> 00:17:52,389
<font color="#E5E5E5">the ability to demonstrate and detect</font>

387
00:17:49,630 --> 00:17:54,160
real attacks<font color="#E5E5E5"> as you'll see and as at</font>

388
00:17:52,390 --> 00:17:56,500
least<font color="#E5E5E5"> I have been doing I do purple</font>

389
00:17:54,160 --> 00:18:02,230
teaming engagements in<font color="#CCCCCC"> a training</font><font color="#E5E5E5"> format</font>

390
00:17:56,500 --> 00:18:04,000
so<font color="#E5E5E5"> PowerShell allows me to detect to</font><font color="#CCCCCC"> not</font>

391
00:18:02,230 --> 00:18:08,800
only execute attacks but detect them<font color="#CCCCCC"> in</font>

392
00:18:04,000 --> 00:18:12,580
real<font color="#CCCCCC"> time</font><font color="#E5E5E5"> and also not</font><font color="#CCCCCC"> only on a single</font>

393
00:18:08,800 --> 00:18:14,500
<font color="#E5E5E5">box or on</font><font color="#CCCCCC"> 100 boxes</font><font color="#E5E5E5"> using let's say</font>

394
00:18:12,580 --> 00:18:16,899
<font color="#E5E5E5">PowerShell remoting or the capabilities</font>

395
00:18:14,500 --> 00:18:20,110
which come up with<font color="#CCCCCC"> WM I may be on</font><font color="#E5E5E5"> 10,000</font>

396
00:18:16,900 --> 00:18:23,440
boxes at a time once<font color="#CCCCCC"> against 90 of</font>

397
00:18:20,110 --> 00:18:26,850
<font color="#CCCCCC">open-source</font><font color="#E5E5E5"> attack detection and</font>

398
00:18:23,440 --> 00:18:29,140
response tools and techniques available

399
00:18:26,850 --> 00:18:32,230
so I think<font color="#CCCCCC"> that would be</font><font color="#E5E5E5"> enough of</font>

400
00:18:29,140 --> 00:18:33,700
theory<font color="#E5E5E5"> well what's the first</font><font color="#CCCCCC"> story</font><font color="#E5E5E5"> or</font>

401
00:18:32,230 --> 00:18:40,920
<font color="#E5E5E5">what the first attack which we are going</font>

402
00:18:33,700 --> 00:18:42,040
<font color="#E5E5E5">to have a look at</font><font color="#CCCCCC"> Oh start as a normal</font>

403
00:18:40,920 --> 00:18:45,400
non-locals

404
00:18:42,040 --> 00:18:47,379
of<font color="#E5E5E5"> non local admin domain user that is a</font>

405
00:18:45,400 --> 00:18:50,620
<font color="#E5E5E5">normal domain user with no local admin</font>

406
00:18:47,380 --> 00:18:53,410
right look for a local<font color="#E5E5E5"> admin access so</font>

407
00:18:50,620 --> 00:18:55,959
pretty much run-of-the-mill user hunting

408
00:18:53,410 --> 00:18:58,680
look for a<font color="#CCCCCC"> DEA token once we find the</font>

409
00:18:55,960 --> 00:19:01,960
<font color="#E5E5E5">gho current use that escalate privileges</font>

410
00:18:58,680 --> 00:19:03,760
<font color="#CCCCCC">create maybe a golden ticket</font><font color="#E5E5E5"> use that</font>

411
00:19:01,960 --> 00:19:11,560
golden ticket later on and exfiltrate

412
00:19:03,760 --> 00:19:14,770
<font color="#E5E5E5">interesting stuff if we</font><font color="#CCCCCC"> start</font><font color="#E5E5E5"> with a a</font>

413
00:19:11,560 --> 00:19:19,050
domain user access is that is that

414
00:19:14,770 --> 00:19:23,350
<font color="#CCCCCC">something</font><font color="#E5E5E5"> which we are making up nope I</font>

415
00:19:19,050 --> 00:19:25,510
would like<font color="#E5E5E5"> you to read this cloud red</font>

416
00:19:23,350 --> 00:19:29,189
<font color="#E5E5E5">teaming paper from Microsoft very very</font>

417
00:19:25,510 --> 00:19:32,560
good if you<font color="#CCCCCC"> are into</font><font color="#E5E5E5"> interacting at all</font>

418
00:19:29,190 --> 00:19:35,380
<font color="#CCCCCC">its</font><font color="#E5E5E5"> of details the assumed breach</font>

419
00:19:32,560 --> 00:19:37,090
methodology and this line I<font color="#E5E5E5"> think sums</font>

420
00:19:35,380 --> 00:19:38,920
up it is<font color="#E5E5E5"> more likely</font><font color="#CCCCCC"> that an</font>

421
00:19:37,090 --> 00:19:40,480
organization<font color="#CCCCCC"> has</font><font color="#E5E5E5"> already been</font>

422
00:19:38,920 --> 00:19:43,960
compromised<font color="#E5E5E5"> and</font><font color="#CCCCCC"> I'm quoting the paper</font>

423
00:19:40,480 --> 00:19:47,020
here but just hasn't discovered it here

424
00:19:43,960 --> 00:19:51,340
<font color="#E5E5E5">and what that</font><font color="#CCCCCC"> is actually the nice thing</font>

425
00:19:47,020 --> 00:19:53,530
to begin<font color="#CCCCCC"> with three things which we</font><font color="#E5E5E5"> are</font>

426
00:19:51,340 --> 00:19:55,149
<font color="#CCCCCC">going</font><font color="#E5E5E5"> to talk about</font><font color="#CCCCCC"> shortly of course</font>

427
00:19:53,530 --> 00:19:58,540
because there is not enough<font color="#CCCCCC"> time I</font>

428
00:19:55,150 --> 00:20:00,880
<font color="#CCCCCC">believe of right timing</font><font color="#E5E5E5"> inside the track</font>

429
00:19:58,540 --> 00:20:03,430
<font color="#CCCCCC">insider tech</font><font color="#E5E5E5"> simulation and loot</font>

430
00:20:00,880 --> 00:20:05,350
in the talk when you<font color="#E5E5E5"> talk about insider</font>

431
00:20:03,430 --> 00:20:08,910
threat simulation of<font color="#E5E5E5"> course an insider</font>

432
00:20:05,350 --> 00:20:11,560
would at<font color="#E5E5E5"> some point would</font><font color="#CCCCCC"> have at least</font>

433
00:20:08,910 --> 00:20:13,540
<font color="#CCCCCC">normal domain</font><font color="#E5E5E5"> user privileges so that</font>

434
00:20:11,560 --> 00:20:16,090
they can log<font color="#E5E5E5"> into a box and do their</font>

435
00:20:13,540 --> 00:20:18,280
stuff whatever<font color="#CCCCCC"> they want to so we start</font>

436
00:20:16,090 --> 00:20:21,879
<font color="#E5E5E5">with that not discussing</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> sim</font><font color="#CCCCCC"> which</font>

437
00:20:18,280 --> 00:20:25,930
<font color="#E5E5E5">anymore so we will look for local admin</font>

438
00:20:21,880 --> 00:20:27,610
access<font color="#E5E5E5"> so we already have normal domain</font>

439
00:20:25,930 --> 00:20:29,290
user access do you think it's really

440
00:20:27,610 --> 00:20:32,770
<font color="#CCCCCC">easy to easy</font><font color="#E5E5E5"> does anyone</font><font color="#CCCCCC"> think that</font>

441
00:20:29,290 --> 00:20:35,860
<font color="#CCCCCC">having normal</font><font color="#E5E5E5"> domain user access makes</font>

442
00:20:32,770 --> 00:20:38,920
it too easy<font color="#E5E5E5"> if you</font><font color="#CCCCCC"> think that</font><font color="#E5E5E5"> go back to</font>

443
00:20:35,860 --> 00:20:40,330
<font color="#CCCCCC">the previous</font><font color="#E5E5E5"> talk see where it was very</font>

444
00:20:38,920 --> 00:20:44,410
<font color="#CCCCCC">interesting</font><font color="#E5E5E5"> talk see how you can get</font>

445
00:20:40,330 --> 00:20:46,389
<font color="#E5E5E5">that</font><font color="#CCCCCC"> or maybe Oh for example I always</font>

446
00:20:44,410 --> 00:20:48,790
like to<font color="#E5E5E5"> quote this example I used your I</font>

447
00:20:46,390 --> 00:20:51,640
didn't track<font color="#E5E5E5"> timming six years back</font>

448
00:20:48,790 --> 00:20:54,639
maybe<font color="#E5E5E5"> four for a German</font><font color="#CCCCCC"> on ecology back</font>

449
00:20:51,640 --> 00:20:56,200
there in New Delhi<font color="#CCCCCC"> and so I used to</font><font color="#E5E5E5"> work</font>

450
00:20:54,640 --> 00:20:57,640
for<font color="#E5E5E5"> a company</font><font color="#CCCCCC"> and right now I'm</font>

451
00:20:56,200 --> 00:20:59,890
independent I used to work for<font color="#E5E5E5"> a company</font>

452
00:20:57,640 --> 00:21:01,870
at<font color="#CCCCCC"> that time and we</font><font color="#E5E5E5"> were made</font><font color="#CCCCCC"> to sit</font>

453
00:20:59,890 --> 00:21:04,210
<font color="#CCCCCC">inside a conference room without</font><font color="#E5E5E5"> any</font>

454
00:21:01,870 --> 00:21:08,169
network<font color="#CCCCCC"> approach at</font><font color="#E5E5E5"> all so it was a it</font>

455
00:21:04,210 --> 00:21:10,360
was<font color="#E5E5E5"> a longer engagement</font><font color="#CCCCCC"> two or three</font>

456
00:21:08,170 --> 00:21:12,520
months but<font color="#E5E5E5"> still without</font><font color="#CCCCCC"> MetroAccess I</font>

457
00:21:10,360 --> 00:21:15,790
<font color="#E5E5E5">mean you cannot there was no Wi-Fi only</font>

458
00:21:12,520 --> 00:21:18,970
<font color="#CCCCCC">our</font><font color="#E5E5E5"> next cables</font><font color="#CCCCCC"> Network and we were</font>

459
00:21:15,790 --> 00:21:21,610
supposed to break<font color="#E5E5E5"> into that company</font>

460
00:21:18,970 --> 00:21:23,680
without<font color="#E5E5E5"> any</font><font color="#CCCCCC"> network access</font><font color="#E5E5E5"> and at that</font>

461
00:21:21,610 --> 00:21:25,540
time<font color="#CCCCCC"> I</font><font color="#E5E5E5"> got started with</font><font color="#CCCCCC"> this human</font>

462
00:21:23,680 --> 00:21:27,940
<font color="#E5E5E5">interface device thing we can program</font>

463
00:21:25,540 --> 00:21:30,340
devices<font color="#E5E5E5"> throw them into parking lot</font>

464
00:21:27,940 --> 00:21:33,660
maybe<font color="#E5E5E5"> leave</font><font color="#CCCCCC"> it reception</font><font color="#E5E5E5"> cafeteria sell</font>

465
00:21:30,340 --> 00:21:36,070
them to the<font color="#E5E5E5"> also</font><font color="#CCCCCC"> email them</font><font color="#E5E5E5"> to employees</font>

466
00:21:33,660 --> 00:21:37,900
there will be connections<font color="#E5E5E5"> and that's</font>

467
00:21:36,070 --> 00:21:41,879
<font color="#E5E5E5">that's how I actually got into that</font>

468
00:21:37,900 --> 00:21:46,060
<font color="#E5E5E5">environment</font><font color="#CCCCCC"> so that's another example</font><font color="#E5E5E5"> of</font>

469
00:21:41,880 --> 00:21:49,030
using of objecting a normal domain user

470
00:21:46,060 --> 00:21:50,919
access<font color="#E5E5E5"> client</font><font color="#CCCCCC"> side</font><font color="#E5E5E5"> at X maybe people</font>

471
00:21:49,030 --> 00:21:53,110
<font color="#CCCCCC">just love to open a Testaments which is</font>

472
00:21:50,920 --> 00:21:57,280
strangers from<font color="#CCCCCC"> the</font><font color="#E5E5E5"> internet</font><font color="#CCCCCC"> sent</font><font color="#E5E5E5"> them so</font>

473
00:21:53,110 --> 00:21:59,919
when we tried that as well<font color="#E5E5E5"> with all that</font>

474
00:21:57,280 --> 00:22:02,889
we can safely<font color="#CCCCCC"> assume that</font><font color="#E5E5E5"> we have</font><font color="#CCCCCC"> our</font>

475
00:21:59,920 --> 00:22:05,140
normal<font color="#E5E5E5"> domain user level access now what</font>

476
00:22:02,890 --> 00:22:08,170
our<font color="#E5E5E5"> next step is to</font><font color="#CCCCCC"> hunt for local admin</font>

477
00:22:05,140 --> 00:22:10,180
or<font color="#E5E5E5"> a set</font><font color="#CCCCCC"> of religious locally</font><font color="#E5E5E5"> now when</font>

478
00:22:08,170 --> 00:22:13,960
it<font color="#E5E5E5"> comes to a domain environment</font><font color="#CCCCCC"> the</font>

479
00:22:10,180 --> 00:22:16,000
most<font color="#E5E5E5"> interesting thing is it's a</font><font color="#CCCCCC"> shitbox</font>

480
00:22:13,960 --> 00:22:18,179
<font color="#E5E5E5">you really don't know where you may have</font>

481
00:22:16,000 --> 00:22:21,970
<font color="#CCCCCC">a local admin privilege or the user</font>

482
00:22:18,179 --> 00:22:24,130
let's say you get this normal<font color="#E5E5E5"> domain</font>

483
00:22:21,970 --> 00:22:27,909
user access with<font color="#E5E5E5"> the</font><font color="#CCCCCC"> client-side attack</font>

484
00:22:24,130 --> 00:22:31,029
<font color="#E5E5E5">it is always possible that the user is</font>

485
00:22:27,909 --> 00:22:35,049
not a local admin<font color="#E5E5E5"> on the current box but</font>

486
00:22:31,029 --> 00:22:38,049
if<font color="#E5E5E5"> it's so it's a reasonably big domain</font>

487
00:22:35,049 --> 00:22:40,000
<font color="#E5E5E5">less even more than</font><font color="#CCCCCC"> 1k boxes</font><font color="#E5E5E5"> there are</font>

488
00:22:38,049 --> 00:22:41,950
<font color="#E5E5E5">chances that there would be some box</font>

489
00:22:40,000 --> 00:22:44,890
<font color="#E5E5E5">lying in the domain where that user</font>

490
00:22:41,950 --> 00:22:46,809
would<font color="#CCCCCC"> be a</font><font color="#E5E5E5"> local admin if not you may</font>

491
00:22:44,890 --> 00:22:49,779
try local privilege escalation as well

492
00:22:46,809 --> 00:22:54,010
there are all these services are ready

493
00:22:49,779 --> 00:22:57,250
to be<font color="#E5E5E5"> hijacked and how would</font><font color="#CCCCCC"> you do that</font>

494
00:22:54,010 --> 00:23:01,059
<font color="#E5E5E5">well of course</font><font color="#CCCCCC"> Power</font><font color="#E5E5E5"> View the tool which</font>

495
00:22:57,250 --> 00:23:03,309
made it possible for everyone<font color="#E5E5E5"> to do user</font>

496
00:23:01,059 --> 00:23:05,830
hunting we are going to use power you of

497
00:23:03,309 --> 00:23:09,250
course<font color="#CCCCCC"> you</font><font color="#E5E5E5"> can</font><font color="#CCCCCC"> empower shell to find</font>

498
00:23:05,830 --> 00:23:18,039
<font color="#CCCCCC">access of fine local admin access on one</font>

499
00:23:09,250 --> 00:23:20,649
<font color="#CCCCCC">of the boxes in our domain so this is</font>

500
00:23:18,039 --> 00:23:25,090
the box which we are going<font color="#E5E5E5"> to use for</font>

501
00:23:20,649 --> 00:23:31,110
the<font color="#CCCCCC"> printer tax and what I'm</font><font color="#E5E5E5"> going to do</font>

502
00:23:25,090 --> 00:23:37,980
here I'm going<font color="#E5E5E5"> to load it is visible</font>

503
00:23:31,110 --> 00:23:40,979
<font color="#CCCCCC">thank</font><font color="#E5E5E5"> you now we are going to run find</font>

504
00:23:37,980 --> 00:23:40,980
oops

505
00:23:42,480 --> 00:23:49,750
let's run<font color="#E5E5E5"> it</font><font color="#CCCCCC"> with verbosity oh</font><font color="#E5E5E5"> I've been</font>

506
00:23:47,740 --> 00:23:50,590
<font color="#E5E5E5">using the same life for my training for</font>

507
00:23:49,750 --> 00:23:52,900
past<font color="#E5E5E5"> three days</font>

508
00:23:50,590 --> 00:23:58,600
so those<font color="#CCCCCC"> of my students sitting here</font>

509
00:23:52,900 --> 00:24:02,380
will identify<font color="#E5E5E5"> some of the boxes so</font><font color="#CCCCCC"> we</font>

510
00:23:58,600 --> 00:24:05,649
have<font color="#E5E5E5"> actually local admin access</font><font color="#CCCCCC"> on a</font>

511
00:24:02,380 --> 00:24:10,660
number<font color="#E5E5E5"> of</font><font color="#CCCCCC"> boxes</font><font color="#E5E5E5"> oh that's fine but</font>

512
00:24:05,650 --> 00:24:12,640
please note one<font color="#E5E5E5"> thing here</font><font color="#CCCCCC"> that the</font>

513
00:24:10,660 --> 00:24:15,190
script identified<font color="#E5E5E5"> that there are total</font>

514
00:24:12,640 --> 00:24:17,470
number of<font color="#CCCCCC"> 43 boxes in the domain</font><font color="#E5E5E5"> and</font>

515
00:24:15,190 --> 00:24:19,000
then it<font color="#CCCCCC"> approached each and every one</font>

516
00:24:17,470 --> 00:24:21,850
box don't you think that<font color="#E5E5E5"> that is</font>

517
00:24:19,000 --> 00:24:25,830
<font color="#E5E5E5">something really</font><font color="#CCCCCC"> nice e makes some logs</font>

518
00:24:21,850 --> 00:24:30,010
probably so we'll come back<font color="#CCCCCC"> to that</font>

519
00:24:25,830 --> 00:24:35,020
<font color="#E5E5E5">right</font><font color="#CCCCCC"> now the</font><font color="#E5E5E5"> box I'm interested in is</font>

520
00:24:30,010 --> 00:24:38,770
this<font color="#CCCCCC"> one although it's the tag is quite</font>

521
00:24:35,020 --> 00:24:39,190
scripted but many<font color="#E5E5E5"> times the name of the</font>

522
00:24:38,770 --> 00:24:41,260
<font color="#CCCCCC">box</font>

523
00:24:39,190 --> 00:24:45,760
the NetBIOS name of the<font color="#E5E5E5"> box is enough to</font>

524
00:24:41,260 --> 00:24:47,730
tell you interesting things so once we

525
00:24:45,760 --> 00:24:52,480
have identified<font color="#E5E5E5"> a box</font>

526
00:24:47,730 --> 00:24:56,190
we may have local admin access<font color="#CCCCCC"> let's see</font>

527
00:24:52,480 --> 00:24:59,590
what kind of logs<font color="#CCCCCC"> our activity generated</font>

528
00:24:56,190 --> 00:25:02,140
for<font color="#CCCCCC"> all the boxes where it was not</font>

529
00:24:59,590 --> 00:25:04,480
successful<font color="#E5E5E5"> you will see event</font><font color="#CCCCCC"> 462</font><font color="#E5E5E5"> for a</font>

530
00:25:02,140 --> 00:25:09,010
successful<font color="#CCCCCC"> logon</font><font color="#E5E5E5"> and</font><font color="#CCCCCC"> four</font><font color="#E5E5E5"> six</font><font color="#CCCCCC"> three four</font>

531
00:25:04,480 --> 00:25:13,170
log off<font color="#CCCCCC"> from the user on this</font><font color="#E5E5E5"> box which</font>

532
00:25:09,010 --> 00:25:16,540
is lab user so in case someone<font color="#E5E5E5"> runs this</font>

533
00:25:13,170 --> 00:25:18,670
reads<font color="#CCCCCC"> of it on the</font><font color="#E5E5E5"> internet so this is</font>

534
00:25:16,540 --> 00:25:20,649
how many many times people do<font color="#CCCCCC"> it on just</font>

535
00:25:18,670 --> 00:25:22,210
do the stuff<font color="#CCCCCC"> there Metasploit payloads</font>

536
00:25:20,650 --> 00:25:24,430
are getting detected<font color="#E5E5E5"> they move quickly</font>

537
00:25:22,210 --> 00:25:27,040
to partial found out the power views

538
00:25:24,430 --> 00:25:30,850
awesome<font color="#E5E5E5"> for user hunting</font><font color="#CCCCCC"> ran fine</font><font color="#E5E5E5"> local</font>

539
00:25:27,040 --> 00:25:33,639
<font color="#E5E5E5">admin access and the user ID these logs</font>

540
00:25:30,850 --> 00:25:36,730
<font color="#CCCCCC">if you have seen it</font><font color="#E5E5E5"> I'm quite sure many</font>

541
00:25:33,640 --> 00:25:39,280
of you have they do log a user ID<font color="#E5E5E5"> so</font>

542
00:25:36,730 --> 00:25:43,000
<font color="#E5E5E5">maybe on</font><font color="#CCCCCC"> 1,000</font><font color="#E5E5E5"> boxes of your domain you</font>

543
00:25:39,280 --> 00:25:46,510
<font color="#E5E5E5">will have these</font><font color="#CCCCCC"> to rent for 6</font><font color="#E5E5E5"> to 4 and</font>

544
00:25:43,000 --> 00:25:49,780
3/4<font color="#E5E5E5"> from a particular</font><font color="#CCCCCC"> user name that's a</font>

545
00:25:46,510 --> 00:25:51,400
dead<font color="#CCCCCC"> giveaway I mean if you cannot you</font>

546
00:25:49,780 --> 00:25:54,310
should<font color="#CCCCCC"> develop the capability to detect</font>

547
00:25:51,400 --> 00:25:55,570
<font color="#E5E5E5">that in cases of successful login</font>

548
00:25:54,310 --> 00:25:58,360
because<font color="#E5E5E5"> we are looking for</font>

549
00:25:55,570 --> 00:26:00,909
local admin access<font color="#CCCCCC"> in cases of success</font>

550
00:25:58,360 --> 00:26:04,479
<font color="#E5E5E5">there would be event for</font><font color="#CCCCCC"> six seven -</font>

551
00:26:00,910 --> 00:26:07,030
admin<font color="#E5E5E5"> log on on those boxes where this</font>

552
00:26:04,480 --> 00:26:09,040
user is a local admin and how can<font color="#CCCCCC"> you</font>

553
00:26:07,030 --> 00:26:11,889
<font color="#E5E5E5">read it</font><font color="#CCCCCC"> with partial I mean there are</font><font color="#E5E5E5"> so</font>

554
00:26:09,040 --> 00:26:13,960
many tools<font color="#E5E5E5"> in written in PowerShell</font>

555
00:26:11,890 --> 00:26:17,050
which can do it easily for<font color="#CCCCCC"> you but if</font>

556
00:26:13,960 --> 00:26:21,370
you just<font color="#E5E5E5"> want simple one-line partial</font>

557
00:26:17,050 --> 00:26:24,879
command then you can do this to list the

558
00:26:21,370 --> 00:26:27,520
latest event<font color="#E5E5E5"> let's iterate it to</font><font color="#CCCCCC"> went ID</font>

559
00:26:24,880 --> 00:26:30,190
<font color="#CCCCCC">four six seven two from the security log</font>

560
00:26:27,520 --> 00:26:32,860
of the<font color="#CCCCCC"> Box</font><font color="#E5E5E5"> how</font><font color="#CCCCCC"> would you do it on scale</font>

561
00:26:30,190 --> 00:26:36,430
maybe use PowerShell remoting using<font color="#E5E5E5"> will</font>

562
00:26:32,860 --> 00:26:38,409
come on the script block pass to<font color="#CCCCCC"> it the</font>

563
00:26:36,430 --> 00:26:41,470
list of servers you want to run it on

564
00:26:38,410 --> 00:26:44,500
and it would do it<font color="#CCCCCC"> parallely on those n</font>

565
00:26:41,470 --> 00:26:47,320
number of<font color="#E5E5E5"> boxes you</font><font color="#CCCCCC"> can also for example</font>

566
00:26:44,500 --> 00:26:49,480
if you have all the<font color="#E5E5E5"> organizations to</font>

567
00:26:47,320 --> 00:26:52,240
have older boxes which<font color="#E5E5E5"> are there for</font>

568
00:26:49,480 --> 00:26:54,940
<font color="#E5E5E5">backward</font><font color="#CCCCCC"> compatibility</font><font color="#E5E5E5"> XP 2003 or even</font>

569
00:26:52,240 --> 00:26:57,760
earlier then you<font color="#E5E5E5"> can use W my classes</font>

570
00:26:54,940 --> 00:27:00,070
<font color="#E5E5E5">these ones to do the same thing once</font>

571
00:26:57,760 --> 00:27:02,290
<font color="#E5E5E5">again using PowerShell</font><font color="#CCCCCC"> to if just</font>

572
00:27:00,070 --> 00:27:06,450
<font color="#E5E5E5">because I mentioned</font><font color="#CCCCCC"> it even if you run</font>

573
00:27:02,290 --> 00:27:09,310
<font color="#CCCCCC">WMI queries from a</font><font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> powershell</font>

574
00:27:06,450 --> 00:27:11,200
instance on<font color="#CCCCCC"> your box it need</font><font color="#E5E5E5"> not be</font>

575
00:27:09,310 --> 00:27:14,020
partial need not be installed<font color="#E5E5E5"> on the</font>

576
00:27:11,200 --> 00:27:20,200
<font color="#E5E5E5">remote box it's just plain</font><font color="#CCCCCC"> WMI if</font><font color="#E5E5E5"> you</font>

577
00:27:14,020 --> 00:27:23,620
<font color="#CCCCCC">use mm and so once we identify</font><font color="#E5E5E5"> that we</font>

578
00:27:20,200 --> 00:27:25,240
have local admin access<font color="#CCCCCC"> we can use</font>

579
00:27:23,620 --> 00:27:29,939
something like<font color="#E5E5E5"> this</font>

580
00:27:25,240 --> 00:27:33,190
the<font color="#E5E5E5"> Box walls</font><font color="#CCCCCC"> opf</font><font color="#E5E5E5"> stash terminal</font><font color="#CCCCCC"> fer</font>

581
00:27:29,940 --> 00:27:37,060
let's run<font color="#E5E5E5"> enter PS session which</font>

582
00:27:33,190 --> 00:27:41,010
provides you a one-to-one<font color="#CCCCCC"> PowerShell</font>

583
00:27:37,060 --> 00:27:44,580
remoting session with<font color="#E5E5E5"> a box running a</font>

584
00:27:41,010 --> 00:27:44,580
running partial remoting

585
00:27:46,650 --> 00:27:54,420
so if you see here<font color="#E5E5E5"> you are still lab</font>

586
00:27:51,180 --> 00:27:57,210
user<font color="#E5E5E5"> but on a</font><font color="#CCCCCC"> different box now</font><font color="#E5E5E5"> it's</font>

587
00:27:54,420 --> 00:27:59,010
that<font color="#E5E5E5"> simple</font><font color="#CCCCCC"> once you</font><font color="#E5E5E5"> have a piece</font><font color="#CCCCCC"> of</font>

588
00:27:57,210 --> 00:28:04,410
keep in mind that we need<font color="#E5E5E5"> administrative</font>

589
00:27:59,010 --> 00:28:07,590
privileges by default to do that once

590
00:28:04,410 --> 00:28:09,600
this<font color="#E5E5E5"> is done then</font><font color="#CCCCCC"> we are going to</font><font color="#E5E5E5"> use</font>

591
00:28:07,590 --> 00:28:12,179
once it is<font color="#CCCCCC"> confirm</font><font color="#E5E5E5"> that yes you indeed</font>

592
00:28:09,600 --> 00:28:15,719
<font color="#CCCCCC">have administrative access the</font><font color="#E5E5E5"> next step</font>

593
00:28:12,180 --> 00:28:18,929
is to<font color="#E5E5E5"> get some credentials</font><font color="#CCCCCC"> with</font>

594
00:28:15,720 --> 00:28:21,840
providers interesting things and we'll

595
00:28:18,929 --> 00:28:24,270
use mimikatz for that<font color="#CCCCCC"> so but I will say</font>

596
00:28:21,840 --> 00:28:26,760
that<font color="#CCCCCC"> there</font><font color="#E5E5E5"> you know if we talk about at</font>

597
00:28:24,270 --> 00:28:28,980
least<font color="#CCCCCC"> flat landscape</font><font color="#E5E5E5"> when it comes to</font>

598
00:28:26,760 --> 00:28:31,920
red teamers or writing<font color="#E5E5E5"> techniques there</font>

599
00:28:28,980 --> 00:28:35,330
<font color="#CCCCCC">are</font><font color="#E5E5E5"> two</font><font color="#CCCCCC"> errors one was before mimikatz</font>

600
00:28:31,920 --> 00:28:37,679
and one is optimally hedged<font color="#E5E5E5"> so are no</font>

601
00:28:35,330 --> 00:28:40,080
engagement at least for me no engagement

602
00:28:37,679 --> 00:28:42,540
at some point of<font color="#CCCCCC"> time</font><font color="#E5E5E5"> building one or</font>

603
00:28:40,080 --> 00:28:44,399
two or is where I use<font color="#CCCCCC"> mimic X and</font><font color="#E5E5E5"> not</font>

604
00:28:42,540 --> 00:28:47,550
actually for pulling credentials in

605
00:28:44,400 --> 00:28:54,420
<font color="#E5E5E5">clear-text</font><font color="#CCCCCC"> that's so 2012 it's been</font>

606
00:28:47,550 --> 00:29:01,250
useful<font color="#CCCCCC"> for</font><font color="#E5E5E5"> many more things now so let's</font>

607
00:28:54,420 --> 00:29:04,140
run mimic<font color="#CCCCCC"> add onto the target</font><font color="#E5E5E5"> box and</font>

608
00:29:01,250 --> 00:29:06,360
here you can see the interesting<font color="#E5E5E5"> thing</font>

609
00:29:04,140 --> 00:29:08,160
is not the ability<font color="#E5E5E5"> to run mimic ads on a</font>

610
00:29:06,360 --> 00:29:11,340
target box the interesting thing here<font color="#E5E5E5"> is</font>

611
00:29:08,160 --> 00:29:13,230
<font color="#E5E5E5">we're</font><font color="#CCCCCC"> using PowerShell remoting</font><font color="#E5E5E5"> mimikatz</font>

612
00:29:11,340 --> 00:29:15,750
invoke mimikatz<font color="#CCCCCC"> uses</font><font color="#E5E5E5"> PowerShell remoting</font>

613
00:29:13,230 --> 00:29:18,150
in the background<font color="#E5E5E5"> that means if you have</font>

614
00:29:15,750 --> 00:29:20,040
<font color="#E5E5E5">process creation logs your collecting</font>

615
00:29:18,150 --> 00:29:23,850
process creation logs on the target box

616
00:29:20,040 --> 00:29:26,010
<font color="#CCCCCC">you can see WS</font><font color="#E5E5E5"> improv host</font><font color="#CCCCCC"> though the</font>

617
00:29:23,850 --> 00:29:28,260
service or<font color="#CCCCCC"> the executable which</font>

618
00:29:26,010 --> 00:29:30,540
<font color="#E5E5E5">PowerShell remoting uses and not</font>

619
00:29:28,260 --> 00:29:33,110
<font color="#E5E5E5">PowerShell dot exe at all so let's have</font>

620
00:29:30,540 --> 00:29:33,110
a look at<font color="#E5E5E5"> that</font>

621
00:29:38,820 --> 00:29:46,418
if we go to this box<font color="#CCCCCC"> and try to see logs</font>

622
00:29:43,350 --> 00:30:01,779
for process creation<font color="#CCCCCC"> let's see what we</font>

623
00:29:46,419 --> 00:30:08,369
<font color="#E5E5E5">can see the security logs would be</font>

624
00:30:01,779 --> 00:30:16,450
<font color="#E5E5E5">something</font><font color="#CCCCCC"> like this or W central hosts</font>

625
00:30:08,369 --> 00:30:20,259
not<font color="#E5E5E5"> PowerShell that</font><font color="#CCCCCC"> we agree what</font>

626
00:30:16,450 --> 00:30:21,429
actually helps here is maybe I'll come

627
00:30:20,259 --> 00:30:24,190
back to it in<font color="#E5E5E5"> a moment</font>

628
00:30:21,429 --> 00:30:29,499
there is something<font color="#CCCCCC"> each helps here do</font>

629
00:30:24,190 --> 00:30:32,019
<font color="#CCCCCC">not get disheartened</font><font color="#E5E5E5"> so unless you have</font>

630
00:30:29,499 --> 00:30:34,299
PowerShell version 5<font color="#E5E5E5"> and enhances</font>

631
00:30:32,019 --> 00:30:36,070
logging capabilities<font color="#CCCCCC"> there would be</font>

632
00:30:34,299 --> 00:30:37,840
<font color="#CCCCCC">actually</font><font color="#E5E5E5"> no really interesting logs as</font>

633
00:30:36,070 --> 00:30:40,799
you can see even with<font color="#E5E5E5"> process creation</font>

634
00:30:37,840 --> 00:30:43,830
logs<font color="#E5E5E5"> with command line auditing enabled</font>

635
00:30:40,799 --> 00:30:46,269
<font color="#CCCCCC">what we need</font><font color="#E5E5E5"> here is things like</font>

636
00:30:43,830 --> 00:30:49,990
system-wide transcripts<font color="#E5E5E5"> scripts</font><font color="#CCCCCC"> log</font>

637
00:30:46,269 --> 00:30:52,929
logging because<font color="#E5E5E5"> the reality of today's</font>

638
00:30:49,990 --> 00:30:55,659
threat landscape is you have so many

639
00:30:52,929 --> 00:30:57,759
script based tools out there<font color="#E5E5E5"> that it</font>

640
00:30:55,659 --> 00:31:00,309
<font color="#E5E5E5">really helps if you can</font><font color="#CCCCCC"> pinpoint on</font>

641
00:30:57,759 --> 00:31:03,119
script based attacks<font color="#E5E5E5"> frankly if you ask</font>

642
00:31:00,309 --> 00:31:05,619
me it is easier to bypass<font color="#E5E5E5"> a</font>

643
00:31:03,119 --> 00:31:08,199
countermeasure<font color="#E5E5E5"> while if you use an</font>

644
00:31:05,619 --> 00:31:10,090
executable and not a script based<font color="#E5E5E5"> attack</font>

645
00:31:08,200 --> 00:31:13,149
but they are so easy<font color="#E5E5E5"> to execute it's</font>

646
00:31:10,090 --> 00:31:15,939
almost<font color="#E5E5E5"> addicting so what we are going to</font>

647
00:31:13,149 --> 00:31:17,678
do or on this<font color="#E5E5E5"> box I have</font><font color="#CCCCCC"> a partial</font>

648
00:31:15,940 --> 00:31:22,169
version<font color="#CCCCCC"> files installed</font><font color="#E5E5E5"> and some of the</font>

649
00:31:17,679 --> 00:31:24,759
<font color="#E5E5E5">capable logging capabilities enabled so</font>

650
00:31:22,169 --> 00:31:28,899
first of all let's have<font color="#E5E5E5"> a look at if</font><font color="#CCCCCC"> we</font>

651
00:31:24,759 --> 00:31:33,850
have any malicious script block logging

652
00:31:28,899 --> 00:31:36,879
which goes to PowerShell operational so

653
00:31:33,850 --> 00:31:39,969
although this<font color="#CCCCCC"> is quite scattered those</font>

654
00:31:36,879 --> 00:31:43,418
of you who have seen source of<font color="#E5E5E5"> mimic ads</font>

655
00:31:39,970 --> 00:31:45,389
will know that this is this<font color="#E5E5E5"> comes from</font>

656
00:31:43,419 --> 00:31:48,429
invoke mimikatz

657
00:31:45,389 --> 00:31:49,780
these all<font color="#E5E5E5"> logs these are almost 100 of</font>

658
00:31:48,429 --> 00:31:52,660
<font color="#E5E5E5">log entries</font>

659
00:31:49,780 --> 00:31:56,530
so what enhanced script block logging

660
00:31:52,660 --> 00:32:01,090
does if it<font color="#E5E5E5"> thinks</font><font color="#CCCCCC"> that our script blocks</font>

661
00:31:56,530 --> 00:32:03,430
a PowerShell script<font color="#CCCCCC"> block is suspicious</font>

662
00:32:01,090 --> 00:32:06,159
or malicious it is logged<font color="#E5E5E5"> into the</font>

663
00:32:03,430 --> 00:32:10,930
<font color="#CCCCCC">PowerShell operational logs</font><font color="#E5E5E5"> that means</font>

664
00:32:06,160 --> 00:32:14,860
you may<font color="#E5E5E5"> have a complete script</font><font color="#CCCCCC"> in here</font>

665
00:32:10,930 --> 00:32:18,040
<font color="#E5E5E5">the obfuscated decrypted D whatever</font>

666
00:32:14,860 --> 00:32:20,889
<font color="#E5E5E5">that's sort of your free D obfuscated</font>

667
00:32:18,040 --> 00:32:23,230
right here<font color="#E5E5E5"> whatever stuff you pass on to</font>

668
00:32:20,890 --> 00:32:25,030
a<font color="#E5E5E5"> PowerShell scripting host gets logged</font>

669
00:32:23,230 --> 00:32:27,000
in here if it is<font color="#CCCCCC"> as</font><font color="#E5E5E5"> in the malicious in</font>

670
00:32:25,030 --> 00:32:30,520
case you're<font color="#CCCCCC"> using obfuscation</font>

671
00:32:27,000 --> 00:32:34,450
it's almost sure and I think<font color="#CCCCCC"> we have the</font>

672
00:32:30,520 --> 00:32:38,800
god of obfuscation here in the room so

673
00:32:34,450 --> 00:32:42,910
pardon me<font color="#E5E5E5"> if I</font><font color="#CCCCCC"> use alpha station drum by</font>

674
00:32:38,800 --> 00:32:45,220
any chance<font color="#E5E5E5"> so if you use any sort</font><font color="#CCCCCC"> of</font>

675
00:32:42,910 --> 00:32:47,590
obfuscation<font color="#CCCCCC"> your script</font><font color="#E5E5E5"> unless you are</font>

676
00:32:45,220 --> 00:32:52,390
Daniel<font color="#E5E5E5"> your script will be visible right</font>

677
00:32:47,590 --> 00:32:58,959
here so not<font color="#E5E5E5"> only that the thing which</font>

678
00:32:52,390 --> 00:33:01,750
helps most here is<font color="#CCCCCC"> is this if you</font><font color="#E5E5E5"> have</font>

679
00:32:58,960 --> 00:33:09,190
system-wide transcripts enabled you will

680
00:33:01,750 --> 00:33:10,990
<font color="#E5E5E5">have something like this of course</font>

681
00:33:09,190 --> 00:33:12,640
<font color="#E5E5E5">please make sure</font><font color="#CCCCCC"> that</font><font color="#E5E5E5"> your transcripts</font>

682
00:33:10,990 --> 00:33:14,860
are forwarded to<font color="#CCCCCC"> a</font><font color="#E5E5E5"> theme device or</font>

683
00:33:12,640 --> 00:33:19,000
central log management system what this

684
00:33:14,860 --> 00:33:22,870
transcript says that a user lab user on

685
00:33:19,000 --> 00:33:25,810
this machine<font color="#E5E5E5"> executed this process WSM</font>

686
00:33:22,870 --> 00:33:32,290
<font color="#E5E5E5">prog host and what that script does it</font>

687
00:33:25,810 --> 00:33:35,290
runs this script which is invoke

688
00:33:32,290 --> 00:33:38,620
mimikatz<font color="#E5E5E5"> source code of invoke mimikatz</font>

689
00:33:35,290 --> 00:33:46,629
<font color="#CCCCCC">and what it did</font><font color="#E5E5E5"> was</font><font color="#CCCCCC"> if it is visible</font>

690
00:33:38,620 --> 00:33:51,780
<font color="#CCCCCC">over thing</font><font color="#E5E5E5"> the result was this this tool</font>

691
00:33:46,630 --> 00:33:54,160
was executed<font color="#E5E5E5"> on your box and</font><font color="#CCCCCC"> your</font>

692
00:33:51,780 --> 00:33:55,840
credentials<font color="#E5E5E5"> or hashes or whatever was</font>

693
00:33:54,160 --> 00:33:58,330
visible<font color="#E5E5E5"> to this guy</font>

694
00:33:55,840 --> 00:34:00,699
that's what system<font color="#CCCCCC"> why transcripts</font><font color="#E5E5E5"> you</font>

695
00:33:58,330 --> 00:34:03,480
of course<font color="#E5E5E5"> if you can follow these things</font>

696
00:34:00,700 --> 00:34:05,040
to a device which manages your<font color="#CCCCCC"> logs and</font>

697
00:34:03,480 --> 00:34:17,219
and create some correlation rules out of

698
00:34:05,040 --> 00:34:18,690
this it would<font color="#CCCCCC"> be really helpful now we</font>

699
00:34:17,219 --> 00:34:21,389
<font color="#CCCCCC">thought</font><font color="#E5E5E5"> that in case we</font><font color="#CCCCCC"> ran in wrote</font>

700
00:34:18,690 --> 00:34:24,000
mimic<font color="#E5E5E5"> as the most useful thing was</font>

701
00:34:21,389 --> 00:34:28,310
<font color="#E5E5E5">system by transcripts let's solve this</font>

702
00:34:24,000 --> 00:34:31,980
already now what the next<font color="#E5E5E5"> step is</font><font color="#CCCCCC"> oh</font>

703
00:34:28,310 --> 00:34:35,009
<font color="#E5E5E5">let's look for domain admin although I</font>

704
00:34:31,980 --> 00:34:37,440
personally in my<font color="#E5E5E5"> engagements I do not go</font>

705
00:34:35,010 --> 00:34:40,050
after domain admin specifically since

706
00:34:37,440 --> 00:34:43,560
the time Microsoft<font color="#CCCCCC"> ATA has come on</font><font color="#E5E5E5"> to in</font>

707
00:34:40,050 --> 00:34:46,350
<font color="#E5E5E5">the scene and</font><font color="#CCCCCC"> we'll discuss that</font><font color="#E5E5E5"> as well</font>

708
00:34:43,560 --> 00:34:50,130
I<font color="#CCCCCC"> believe</font><font color="#E5E5E5"> but still let's go for a</font><font color="#CCCCCC"> da</font>

709
00:34:46,350 --> 00:34:53,850
<font color="#E5E5E5">because that's many of us do in in a</font>

710
00:34:50,130 --> 00:34:56,850
real<font color="#E5E5E5"> world engagement leaving the talker</font>

711
00:34:53,850 --> 00:34:59,370
<font color="#E5E5E5">side I would suggest you not to do that</font>

712
00:34:56,850 --> 00:35:01,589
not<font color="#CCCCCC"> to go for da immediately as soon as</font>

713
00:34:59,370 --> 00:35:04,020
you got a local admin access because

714
00:35:01,590 --> 00:35:08,220
that's really<font color="#E5E5E5"> nicely maybe stick to your</font>

715
00:35:04,020 --> 00:35:10,470
<font color="#E5E5E5">goals</font><font color="#CCCCCC"> go after clients IP or</font><font color="#E5E5E5"> world</font>

716
00:35:08,220 --> 00:35:13,919
<font color="#CCCCCC">employee data or whatever the goal</font><font color="#E5E5E5"> of</font>

717
00:35:10,470 --> 00:35:15,959
your engagement<font color="#E5E5E5"> is but</font><font color="#CCCCCC"> one once you</font>

718
00:35:13,920 --> 00:35:19,850
think<font color="#E5E5E5"> that it</font><font color="#CCCCCC"> is it is the best way to</font>

719
00:35:15,960 --> 00:35:19,850
go for let's<font color="#CCCCCC"> just try how we can do that</font>

720
00:35:20,150 --> 00:35:28,140
so what we<font color="#E5E5E5"> have done</font><font color="#CCCCCC"> up to now is we</font>

721
00:35:26,400 --> 00:35:34,950
have admin<font color="#E5E5E5"> access to a box we have</font>

722
00:35:28,140 --> 00:35:37,650
<font color="#CCCCCC">hashes of of a local admin which was</font>

723
00:35:34,950 --> 00:35:40,189
term admin which<font color="#CCCCCC"> I've actually copied</font>

724
00:35:37,650 --> 00:35:43,380
already so that<font color="#CCCCCC"> things</font><font color="#E5E5E5"> a bit fast so</font>

725
00:35:40,190 --> 00:35:45,600
<font color="#CCCCCC">what</font><font color="#E5E5E5"> we are going to do now using hashes</font>

726
00:35:43,380 --> 00:35:48,450
ntlm hashes<font color="#CCCCCC"> of that user we are going to</font>

727
00:35:45,600 --> 00:35:52,370
create a<font color="#CCCCCC"> powershell process with the</font>

728
00:35:48,450 --> 00:35:54,960
privileges of that user of this thing

729
00:35:52,370 --> 00:35:57,750
the new partial process which opens up

730
00:35:54,960 --> 00:35:59,700
has the<font color="#CCCCCC"> three</font><font color="#E5E5E5"> are the privileges of term</font>

731
00:35:57,750 --> 00:36:04,500
<font color="#CCCCCC">admins at administrator on that remote</font>

732
00:35:59,700 --> 00:36:07,259
<font color="#E5E5E5">box what we are going to do now is try</font>

733
00:36:04,500 --> 00:36:09,530
to look for a domain admin from<font color="#E5E5E5"> this</font>

734
00:36:07,260 --> 00:36:09,530
thing

735
00:36:14,559 --> 00:36:20,869
also<font color="#CCCCCC"> oh now I'm so used to</font><font color="#E5E5E5"> load</font><font color="#CCCCCC"> mini</font>

736
00:36:18,109 --> 00:36:25,670
<font color="#CCCCCC">guests every second it's even not</font>

737
00:36:20,869 --> 00:36:27,799
required so let's run invoke user<font color="#E5E5E5"> hunter</font>

738
00:36:25,670 --> 00:36:30,440
what invoke user<font color="#E5E5E5"> hunter does it looks</font>

739
00:36:27,799 --> 00:36:34,250
for let's not run it<font color="#E5E5E5"> with velocity it</font>

740
00:36:30,440 --> 00:36:36,710
looks for a token of domain admin on any

741
00:36:34,250 --> 00:36:39,319
of the<font color="#CCCCCC"> boxes it can do it on all the</font>

742
00:36:36,710 --> 00:36:41,000
boxes<font color="#E5E5E5"> success would be shown</font><font color="#CCCCCC"> only on</font>

743
00:36:39,319 --> 00:36:44,599
those<font color="#E5E5E5"> boxes where</font><font color="#CCCCCC"> you have local</font><font color="#E5E5E5"> admin</font>

744
00:36:41,000 --> 00:36:47,089
rights as well that is<font color="#E5E5E5"> it will find for</font>

745
00:36:44,599 --> 00:36:48,859
<font color="#E5E5E5">box</font><font color="#CCCCCC"> look for a box where a domain admin</font>

746
00:36:47,089 --> 00:36:52,099
is logged in and<font color="#CCCCCC"> you have local</font><font color="#E5E5E5"> admin</font>

747
00:36:48,859 --> 00:36:55,960
rights<font color="#CCCCCC"> so</font><font color="#E5E5E5"> that you can reuse the token</font>

748
00:36:52,099 --> 00:36:58,400
off domain admin<font color="#E5E5E5"> just true for this box</font>

749
00:36:55,960 --> 00:37:01,280
<font color="#E5E5E5">so as you might have guessed once you</font>

750
00:36:58,400 --> 00:37:03,140
once we have<font color="#E5E5E5"> something like this it's</font>

751
00:37:01,280 --> 00:37:05,480
really<font color="#CCCCCC"> easy to escalate our privileges</font>

752
00:37:03,140 --> 00:37:07,098
<font color="#E5E5E5">to domain admin but there is</font><font color="#CCCCCC"> something</font>

753
00:37:05,480 --> 00:37:11,450
which comes<font color="#E5E5E5"> in when you do things like</font>

754
00:37:07,099 --> 00:37:15,920
<font color="#E5E5E5">this of course</font><font color="#CCCCCC"> regular logs and I have</font>

755
00:37:11,450 --> 00:37:18,319
been looking<font color="#E5E5E5"> at this thing</font><font color="#CCCCCC"> in being used</font>

756
00:37:15,920 --> 00:37:20,180
<font color="#E5E5E5">increasingly in enterprise</font><font color="#CCCCCC"> environments</font>

757
00:37:18,319 --> 00:37:23,299
Microsoft<font color="#E5E5E5"> ata advanced threat analytics</font>

758
00:37:20,180 --> 00:37:25,609
<font color="#CCCCCC">they bought of a behavioral analysis</font>

759
00:37:23,299 --> 00:37:27,710
<font color="#E5E5E5">company's previous</font><font color="#CCCCCC"> pack two or three</font>

760
00:37:25,609 --> 00:37:29,450
years back<font color="#CCCCCC"> and this tool is ismail</font>

761
00:37:27,710 --> 00:37:34,220
personally<font color="#E5E5E5"> for me this is my latest</font>

762
00:37:29,450 --> 00:37:35,689
nightmare<font color="#CCCCCC"> of how ata works is and I'm</font>

763
00:37:34,220 --> 00:37:38,328
<font color="#CCCCCC">not endorsing</font><font color="#E5E5E5"> it I mean this is</font>

764
00:37:35,690 --> 00:37:39,980
fantastic<font color="#E5E5E5"> tool and Microsoft is</font><font color="#CCCCCC"> not as</font>

765
00:37:38,329 --> 00:37:42,140
evil as<font color="#CCCCCC"> it used</font><font color="#E5E5E5"> to be but still I'm not</font>

766
00:37:39,980 --> 00:37:42,589
<font color="#E5E5E5">endorsing it try it on you with your own</font>

767
00:37:42,140 --> 00:37:46,640
risk

768
00:37:42,589 --> 00:37:48,828
<font color="#E5E5E5">oh how</font><font color="#CCCCCC"> ATO works is it looks</font><font color="#E5E5E5"> for</font>

769
00:37:46,640 --> 00:37:50,930
whatever traffic you<font color="#CCCCCC"> are sending to the</font>

770
00:37:48,829 --> 00:37:53,089
DC in my lab it<font color="#CCCCCC"> is a light</font><font color="#E5E5E5"> gate very</font>

771
00:37:50,930 --> 00:37:55,308
installed on the DC itself<font color="#CCCCCC"> or</font><font color="#E5E5E5"> you may</font>

772
00:37:53,089 --> 00:37:58,130
have<font color="#CCCCCC"> a sensor which sends whatever</font>

773
00:37:55,309 --> 00:38:03,020
traffic is being<font color="#E5E5E5"> sent to the DC</font><font color="#CCCCCC"> - now -</font>

774
00:37:58,130 --> 00:38:06,170
<font color="#E5E5E5">ATS gateway it looks for of anomalies</font>

775
00:38:03,020 --> 00:38:08,299
<font color="#CCCCCC">like if you are</font><font color="#E5E5E5"> using let's say ntlm</font>

776
00:38:06,170 --> 00:38:10,010
authentication<font color="#CCCCCC"> of because Kerberos is</font>

777
00:38:08,299 --> 00:38:13,609
<font color="#E5E5E5">the default one in in in</font><font color="#CCCCCC"> a domain</font>

778
00:38:10,010 --> 00:38:17,089
<font color="#CCCCCC">environment or if one of</font><font color="#E5E5E5"> your users used</font>

779
00:38:13,609 --> 00:38:19,759
to<font color="#CCCCCC"> login</font><font color="#E5E5E5"> only</font><font color="#CCCCCC"> no</font><font color="#E5E5E5"> extend</font><font color="#CCCCCC"> in</font><font color="#E5E5E5"> the morning</font>

780
00:38:17,089 --> 00:38:21,890
and logs out at 4:00 in<font color="#CCCCCC"> the evening but</font>

781
00:38:19,760 --> 00:38:24,560
today<font color="#CCCCCC"> for some via trees and that user</font>

782
00:38:21,890 --> 00:38:26,629
logs in at<font color="#E5E5E5"> 11:00 in the night</font><font color="#CCCCCC"> even that</font>

783
00:38:24,560 --> 00:38:29,090
<font color="#E5E5E5">it claims gets affected so there are</font><font color="#CCCCCC"> a</font>

784
00:38:26,630 --> 00:38:32,120
lot<font color="#CCCCCC"> of</font><font color="#E5E5E5"> claims a lot of avoidance lot of</font>

785
00:38:29,090 --> 00:38:33,800
bypasses in fact if you are interested

786
00:38:32,120 --> 00:38:36,170
in a team and<font color="#E5E5E5"> here is the chance for me</font>

787
00:38:33,800 --> 00:38:39,440
<font color="#CCCCCC">to</font><font color="#E5E5E5"> provide</font><font color="#CCCCCC"> two for some</font><font color="#E5E5E5"> shameless</font>

788
00:38:36,170 --> 00:38:42,530
self-promotion visit my blog<font color="#E5E5E5"> I blogged</font>

789
00:38:39,440 --> 00:38:46,040
how you can avoid the<font color="#E5E5E5"> ATA last month</font>

790
00:38:42,530 --> 00:38:47,780
that is<font color="#CCCCCC"> the</font><font color="#E5E5E5"> blog walls you a few</font><font color="#CCCCCC"> stay</font><font color="#E5E5E5"> on</font>

791
00:38:46,040 --> 00:38:48,710
the database layer<font color="#E5E5E5"> do not interact with</font>

792
00:38:47,780 --> 00:38:53,330
<font color="#E5E5E5">the</font><font color="#CCCCCC"> d c-- at all</font>

793
00:38:48,710 --> 00:38:57,710
this bastard<font color="#CCCCCC"> works only on</font><font color="#E5E5E5"> DC doesn't</font>

794
00:38:53,330 --> 00:39:01,069
monitor<font color="#CCCCCC"> any other server oh</font><font color="#E5E5E5"> that's it</font>

795
00:38:57,710 --> 00:39:03,140
this is<font color="#E5E5E5"> our user hunting it gets ejected</font>

796
00:39:01,070 --> 00:39:07,280
as you can using<font color="#CCCCCC"> SME session and</font>

797
00:39:03,140 --> 00:39:11,299
immigration which doesn't make things

798
00:39:07,280 --> 00:39:14,210
really easy<font color="#E5E5E5"> as they look like assuming</font>

799
00:39:11,300 --> 00:39:16,940
<font color="#CCCCCC">that</font><font color="#E5E5E5"> we got past</font><font color="#CCCCCC"> that thing it</font><font color="#E5E5E5"> was</font>

800
00:39:14,210 --> 00:39:20,240
marked as<font color="#E5E5E5"> let's say a false positive</font><font color="#CCCCCC"> or</font>

801
00:39:16,940 --> 00:39:23,530
no one<font color="#E5E5E5"> is looking at it in such a case</font>

802
00:39:20,240 --> 00:39:26,540
if we have<font color="#CCCCCC"> a fee</font><font color="#E5E5E5"> escalate or privileges</font>

803
00:39:23,530 --> 00:39:29,120
to domain admin how we are doing<font color="#E5E5E5"> that</font>

804
00:39:26,540 --> 00:39:31,490
<font color="#E5E5E5">once again now we run</font><font color="#CCCCCC"> mimikatz onto the</font>

805
00:39:29,120 --> 00:39:34,370
o PS file where a domain admin was

806
00:39:31,490 --> 00:39:35,779
logged in we pulled the hashes<font color="#CCCCCC"> off a</font>

807
00:39:34,370 --> 00:39:38,890
domain admin<font color="#E5E5E5"> so an assumption that we</font>

808
00:39:35,780 --> 00:39:41,390
<font color="#E5E5E5">know that this guy</font><font color="#CCCCCC"> is a domain admin or</font>

809
00:39:38,890 --> 00:39:43,940
we start<font color="#E5E5E5"> a</font><font color="#CCCCCC"> powershell process with the</font>

810
00:39:41,390 --> 00:39:45,129
privileges of that user would<font color="#CCCCCC"> be domain</font>

811
00:39:43,940 --> 00:39:49,240
admin

812
00:39:45,130 --> 00:39:53,410
<font color="#CCCCCC">looks easy</font><font color="#E5E5E5"> look silent but it is not</font>

813
00:39:49,240 --> 00:39:56,209
<font color="#CCCCCC">once again</font><font color="#E5E5E5"> a TA will kick in and</font>

814
00:39:53,410 --> 00:39:57,799
<font color="#CCCCCC">interestingly it can point out to the</font>

815
00:39:56,210 --> 00:39:59,620
exact name of the<font color="#E5E5E5"> attack the hacker</font>

816
00:39:57,800 --> 00:40:03,380
lingo it's over pass the hash<font color="#CCCCCC"> attack</font>

817
00:39:59,620 --> 00:40:05,839
<font color="#E5E5E5">that is you are</font><font color="#CCCCCC"> using an ntlm hash to</font>

818
00:40:03,380 --> 00:40:09,650
create a Kerberos ticket how do you how

819
00:40:05,840 --> 00:40:14,660
it does<font color="#CCCCCC"> that</font><font color="#E5E5E5"> because generally in case</font>

820
00:40:09,650 --> 00:40:17,510
<font color="#E5E5E5">of a normal ticket</font><font color="#CCCCCC"> a normal</font><font color="#E5E5E5"> TGT the</font>

821
00:40:14,660 --> 00:40:19,940
timestamp<font color="#CCCCCC"> the which</font><font color="#E5E5E5"> you encrypt with</font>

822
00:40:17,510 --> 00:40:23,510
your ntlm hash to authenticate to<font color="#E5E5E5"> the</font>

823
00:40:19,940 --> 00:40:28,070
KDC<font color="#E5E5E5"> is not done using ntlm that's what</font>

824
00:40:23,510 --> 00:40:30,460
that's what it checks for here and shows

825
00:40:28,070 --> 00:40:30,460
<font color="#E5E5E5">an alert</font>

826
00:40:31,630 --> 00:40:36,670
once we are<font color="#CCCCCC"> da the next thing which we</font>

827
00:40:34,120 --> 00:40:39,640
<font color="#CCCCCC">can do is execute stuff on the domain</font>

828
00:40:36,670 --> 00:40:42,850
controller<font color="#CCCCCC"> and persist on it</font><font color="#E5E5E5"> how</font><font color="#CCCCCC"> we can</font>

829
00:40:39,640 --> 00:40:44,830
<font color="#CCCCCC">do that by getting</font><font color="#E5E5E5"> maybe the hash of the</font>

830
00:40:42,850 --> 00:40:48,700
curve with<font color="#E5E5E5"> T DT account which we can use</font>

831
00:40:44,830 --> 00:40:50,200
<font color="#E5E5E5">to create a golden ticket later on when</font>

832
00:40:48,700 --> 00:40:52,299
you create a golden ticket that's

833
00:40:50,200 --> 00:40:53,680
perfectly fine<font color="#CCCCCC"> of course then you</font>

834
00:40:52,300 --> 00:40:57,850
execute stuff on the domain controller

835
00:40:53,680 --> 00:40:59,830
it's not always so does this<font color="#CCCCCC"> any one of</font>

836
00:40:57,850 --> 00:41:01,720
<font color="#E5E5E5">you can can anyone if you tell me if</font>

837
00:40:59,830 --> 00:41:04,210
there is<font color="#CCCCCC"> a replacement for</font><font color="#E5E5E5"> the first</font>

838
00:41:01,720 --> 00:41:05,799
step instead<font color="#E5E5E5"> of executing</font><font color="#CCCCCC"> mimicked edged</font>

839
00:41:04,210 --> 00:41:09,130
<font color="#CCCCCC">onto the domain controller is there</font>

840
00:41:05,800 --> 00:41:15,640
another way of remotely<font color="#E5E5E5"> pulling hashes</font>

841
00:41:09,130 --> 00:41:18,310
from the<font color="#E5E5E5"> DC maybe DC sync so you pose as</font>

842
00:41:15,640 --> 00:41:19,930
a<font color="#CCCCCC"> domain controller</font><font color="#E5E5E5"> tell the domain</font>

843
00:41:18,310 --> 00:41:20,410
control that I am a domain controller as

844
00:41:19,930 --> 00:41:22,240
well

845
00:41:20,410 --> 00:41:24,040
please think<font color="#E5E5E5"> with me send me all</font><font color="#CCCCCC"> the</font>

846
00:41:22,240 --> 00:41:27,520
hashes and<font color="#CCCCCC"> it's n</font><font color="#E5E5E5"> store hashes to you</font>

847
00:41:24,040 --> 00:41:29,680
you can use<font color="#E5E5E5"> that as well of in any case</font>

848
00:41:27,520 --> 00:41:33,630
once you get hashes for the<font color="#CCCCCC"> COBE T DT</font>

849
00:41:29,680 --> 00:41:36,940
account which is this in our lab case

850
00:41:33,630 --> 00:41:40,750
once you do that you can<font color="#E5E5E5"> create a golden</font>

851
00:41:36,940 --> 00:41:42,730
ticket later on which is<font color="#E5E5E5"> generally in my</font>

852
00:41:40,750 --> 00:41:45,310
cases<font color="#CCCCCC"> I have seen working correctly</font><font color="#E5E5E5"> six</font>

853
00:41:42,730 --> 00:41:47,410
months<font color="#E5E5E5"> two</font><font color="#CCCCCC"> months three</font><font color="#E5E5E5"> months it</font>

854
00:41:45,310 --> 00:41:51,900
depends on the environment<font color="#CCCCCC"> which you are</font>

855
00:41:47,410 --> 00:41:56,109
targeting or creating a golden ticket

856
00:41:51,900 --> 00:41:57,670
<font color="#CCCCCC">does not necessarily</font><font color="#E5E5E5"> create any analogs</font>

857
00:41:56,110 --> 00:42:01,270
<font color="#CCCCCC">because you are</font><font color="#E5E5E5"> doing it on your own box</font>

858
00:41:57,670 --> 00:42:03,130
<font color="#E5E5E5">of course if someone looks or does</font>

859
00:42:01,270 --> 00:42:05,470
forensically investigate your box later

860
00:42:03,130 --> 00:42:08,470
on it<font color="#E5E5E5"> would be</font><font color="#CCCCCC"> visible</font><font color="#E5E5E5"> but doesn't do</font>

861
00:42:05,470 --> 00:42:08,859
that in<font color="#E5E5E5"> any</font><font color="#CCCCCC"> other case what if you use</font>

862
00:42:08,470 --> 00:42:12,189
it

863
00:42:08,860 --> 00:42:17,050
same logs<font color="#E5E5E5"> successful admin log on log</font>

864
00:42:12,190 --> 00:42:19,120
<font color="#E5E5E5">off</font><font color="#CCCCCC"> etc and once again</font><font color="#E5E5E5"> a</font><font color="#CCCCCC"> TA why I</font><font color="#E5E5E5"> am</font>

865
00:42:17,050 --> 00:42:21,940
coming<font color="#E5E5E5"> keep I keep</font><font color="#CCCCCC"> coming back to it I</font>

866
00:42:19,120 --> 00:42:25,089
<font color="#CCCCCC">frankly</font><font color="#E5E5E5"> have never seen anything which</font>

867
00:42:21,940 --> 00:42:27,670
<font color="#CCCCCC">detects</font><font color="#E5E5E5"> attacks like this so quickly and</font>

868
00:42:25,090 --> 00:42:31,480
effectively<font color="#E5E5E5"> of course it has</font><font color="#CCCCCC"> its own</font>

869
00:42:27,670 --> 00:42:35,110
<font color="#E5E5E5">flaws but your golden ticket may get</font>

870
00:42:31,480 --> 00:42:37,120
detected as well which<font color="#E5E5E5"> does</font><font color="#CCCCCC"> not</font><font color="#E5E5E5"> make</font>

871
00:42:35,110 --> 00:42:39,670
things really good if your rat<font color="#CCCCCC"> keema</font>

872
00:42:37,120 --> 00:42:42,480
of course why I am and another reason

873
00:42:39,670 --> 00:42:44,650
<font color="#CCCCCC">why I keep coming back</font><font color="#E5E5E5"> to this now</font>

874
00:42:42,480 --> 00:42:45,580
because this is something<font color="#CCCCCC"> which blue</font>

875
00:42:44,650 --> 00:42:47,380
guys can use

876
00:42:45,580 --> 00:42:52,150
of course an expensive<font color="#E5E5E5"> tool but really</font>

877
00:42:47,380 --> 00:42:54,430
<font color="#E5E5E5">really useful now</font><font color="#CCCCCC"> while there are many</font>

878
00:42:52,150 --> 00:42:56,590
<font color="#E5E5E5">ways of acceleration my favorite is</font><font color="#CCCCCC"> to</font>

879
00:42:54,430 --> 00:42:58,690
use Gmail<font color="#E5E5E5"> you can once again use</font>

880
00:42:56,590 --> 00:43:02,110
PowerShell<font color="#E5E5E5"> to exfiltrate things to Gmail</font>

881
00:42:58,690 --> 00:43:03,940
what I am doing here<font color="#CCCCCC"> in case of so they</font>

882
00:43:02,110 --> 00:43:06,220
<font color="#CCCCCC">are depending on</font><font color="#E5E5E5"> the</font><font color="#CCCCCC"> environment if</font><font color="#E5E5E5"> you</font>

883
00:43:03,940 --> 00:43:09,160
<font color="#CCCCCC">affiliate let's say</font><font color="#E5E5E5"> 10 GBS 100 GBS of</font>

884
00:43:06,220 --> 00:43:11,410
data that may get detected<font color="#E5E5E5"> if someone</font>

885
00:43:09,160 --> 00:43:14,589
asks<font color="#CCCCCC"> me that</font><font color="#E5E5E5"> if there is a single thing</font>

886
00:43:11,410 --> 00:43:17,620
I want to<font color="#CCCCCC"> accelerate from an</font><font color="#E5E5E5"> environment</font>

887
00:43:14,590 --> 00:43:22,170
<font color="#E5E5E5">of that would be</font><font color="#CCCCCC"> the hash of</font><font color="#E5E5E5"> the Kobe</font>

888
00:43:17,620 --> 00:43:25,660
DDT account so that's that's how<font color="#E5E5E5"> do we</font>

889
00:43:22,170 --> 00:43:27,580
expect<font color="#CCCCCC"> rate it using</font><font color="#E5E5E5"> Gmail chances of</font>

890
00:43:25,660 --> 00:43:29,980
detection<font color="#CCCCCC"> if you have a deep packet</font>

891
00:43:27,580 --> 00:43:32,830
inspection<font color="#CCCCCC"> setup which looks at even</font>

892
00:43:29,980 --> 00:43:34,870
Gmail<font color="#CCCCCC"> I have seen where of environments</font>

893
00:43:32,830 --> 00:43:39,100
where<font color="#E5E5E5"> HTTP is intercepted but things</font>

894
00:43:34,870 --> 00:43:43,210
like Gmail Google Docs<font color="#E5E5E5"> etc are</font><font color="#CCCCCC"> not so</font>

895
00:43:39,100 --> 00:43:51,069
you may like<font color="#CCCCCC"> to do that as well with any</font>

896
00:43:43,210 --> 00:43:52,870
<font color="#CCCCCC">spam hoped Oh two minutes</font><font color="#E5E5E5"> so if you want</font>

897
00:43:51,070 --> 00:43:55,840
<font color="#E5E5E5">to accelerate the few chunks of data</font>

898
00:43:52,870 --> 00:44:01,690
<font color="#E5E5E5">maybe go for FTP Dropbox Google Drive</font>

899
00:43:55,840 --> 00:44:06,370
maybe so that's<font color="#CCCCCC"> slowly</font><font color="#E5E5E5"> one another one</font>

900
00:44:01,690 --> 00:44:08,470
is to<font color="#CCCCCC"> start up</font><font color="#E5E5E5"> in a once again</font><font color="#CCCCCC"> non-local</font>

901
00:44:06,370 --> 00:44:10,569
admin domain user<font color="#CCCCCC"> maybe</font><font color="#E5E5E5"> use client-side</font>

902
00:44:08,470 --> 00:44:13,149
attack with<font color="#E5E5E5"> PowerShell</font><font color="#CCCCCC"> the THC which is</font>

903
00:44:10,570 --> 00:44:18,340
blocked with<font color="#E5E5E5"> white listing how we can do</font>

904
00:44:13,150 --> 00:44:20,710
<font color="#E5E5E5">that maybe use HT a so if you use HT a</font>

905
00:44:18,340 --> 00:44:22,450
you will see<font color="#CCCCCC"> something like this</font><font color="#E5E5E5"> even</font><font color="#CCCCCC"> if</font>

906
00:44:20,710 --> 00:44:26,670
you<font color="#CCCCCC"> have explicitly blocked PowerShell</font>

907
00:44:22,450 --> 00:44:26,669
you will still<font color="#CCCCCC"> see</font><font color="#E5E5E5"> something like this</font>

908
00:44:31,560 --> 00:44:39,880
if I have that<font color="#CCCCCC"> right now</font>

909
00:44:35,880 --> 00:44:45,640
so this is event<font color="#CCCCCC"> you've run PowerShell</font>

910
00:44:39,880 --> 00:44:47,380
<font color="#CCCCCC">at</font><font color="#E5E5E5"> exe without</font><font color="#CCCCCC"> our FDA and this is when</font>

911
00:44:45,640 --> 00:44:49,480
you run it with<font color="#CCCCCC"> hte</font>

912
00:44:47,380 --> 00:44:51,070
<font color="#E5E5E5">even if you explicitly block PowerShell</font>

913
00:44:49,480 --> 00:44:53,560
it will still<font color="#CCCCCC"> be allowed</font><font color="#E5E5E5"> so there are so</font>

914
00:44:51,070 --> 00:44:56,800
many<font color="#E5E5E5"> ways to actually bypass application</font>

915
00:44:53,560 --> 00:45:00,250
whitelisting<font color="#CCCCCC"> once</font><font color="#E5E5E5"> again what helps here</font>

916
00:44:56,800 --> 00:45:02,110
is<font color="#E5E5E5"> system-wide transcripts for example</font>

917
00:45:00,250 --> 00:45:04,740
if<font color="#E5E5E5"> PowerShell the DX is blocked removed</font>

918
00:45:02,110 --> 00:45:08,650
<font color="#E5E5E5">you can still use something like</font>

919
00:45:04,740 --> 00:45:11,439
<font color="#E5E5E5">msbuild to region it even if you do it</font>

920
00:45:08,650 --> 00:45:13,270
with<font color="#E5E5E5"> msbuild transcript system by</font>

921
00:45:11,440 --> 00:45:18,580
transcripts<font color="#CCCCCC"> you still log each and</font>

922
00:45:13,270 --> 00:45:21,490
everything<font color="#CCCCCC"> so it helps you can use ICMP</font>

923
00:45:18,580 --> 00:45:25,540
<font color="#E5E5E5">HTTP</font><font color="#CCCCCC"> dns shells out of raw tcp or</font><font color="#E5E5E5"> UDP</font>

924
00:45:21,490 --> 00:45:27,520
<font color="#E5E5E5">which are some of the lesser monitored</font>

925
00:45:25,540 --> 00:45:29,470
protocols<font color="#E5E5E5"> there are residual that</font><font color="#CCCCCC"> you</font>

926
00:45:27,520 --> 00:45:31,990
use shells in Nisshin<font color="#CCCCCC"> and in other tools</font>

927
00:45:29,470 --> 00:45:34,120
for<font color="#E5E5E5"> that or maybe just use Empire which</font>

928
00:45:31,990 --> 00:45:38,169
has its<font color="#E5E5E5"> own implementation</font><font color="#CCCCCC"> of encrypted</font>

929
00:45:34,120 --> 00:45:41,049
communications<font color="#CCCCCC"> let me</font><font color="#E5E5E5"> quickly go through</font>

930
00:45:38,170 --> 00:45:43,330
the random<font color="#E5E5E5"> PowerShell things one of the</font>

931
00:45:41,050 --> 00:45:45,160
very interesting<font color="#E5E5E5"> attacks is</font><font color="#CCCCCC"> to done with</font>

932
00:45:43,330 --> 00:45:47,110
<font color="#E5E5E5">two PowerShell version</font><font color="#CCCCCC"> two that's called</font>

933
00:45:45,160 --> 00:45:49,120
the partial downgrade attack that is

934
00:45:47,110 --> 00:45:51,700
even if your environment<font color="#CCCCCC"> has PowerShell</font>

935
00:45:49,120 --> 00:45:54,600
version<font color="#CCCCCC"> five installed someone which may</font>

936
00:45:51,700 --> 00:45:57,189
just<font color="#CCCCCC"> run PowerShell -</font><font color="#E5E5E5"> version</font><font color="#CCCCCC"> two</font><font color="#E5E5E5"> and</font>

937
00:45:54,600 --> 00:45:59,410
remove effectively<font color="#CCCCCC"> MZ the</font><font color="#E5E5E5"> anti-malware</font>

938
00:45:57,190 --> 00:46:02,830
scan interface and hence logging

939
00:45:59,410 --> 00:46:04,899
capabilities<font color="#E5E5E5"> etc although not enabled</font><font color="#CCCCCC"> by</font>

940
00:46:02,830 --> 00:46:07,090
default on Windows 10 you<font color="#CCCCCC"> can installer</font>

941
00:46:04,900 --> 00:46:10,180
and<font color="#CCCCCC"> all the darknet version and still do</font>

942
00:46:07,090 --> 00:46:15,210
it how do<font color="#E5E5E5"> we defend against things like</font>

943
00:46:10,180 --> 00:46:17,710
<font color="#E5E5E5">this Liam's one of the architects of</font>

944
00:46:15,210 --> 00:46:21,690
partials<font color="#CCCCCC"> that I</font><font color="#E5E5E5"> blogged about this</font>

945
00:46:17,710 --> 00:46:25,240
whenever<font color="#E5E5E5"> you run a</font><font color="#CCCCCC"> PowerShell</font><font color="#E5E5E5"> of ill</font>

946
00:46:21,690 --> 00:46:27,160
event or script the in Windows

947
00:46:25,240 --> 00:46:29,770
PowerShell log you will see event ID for

948
00:46:27,160 --> 00:46:32,379
and<font color="#CCCCCC"> edit codes engine version so if you</font>

949
00:46:29,770 --> 00:46:34,770
do not absolutely want PowerShell to<font color="#E5E5E5"> be</font>

950
00:46:32,380 --> 00:46:37,810
<font color="#CCCCCC">- to be executed in your environment</font>

951
00:46:34,770 --> 00:46:41,880
<font color="#E5E5E5">this should be a</font><font color="#CCCCCC"> security alert as soon</font>

952
00:46:37,810 --> 00:46:41,880
<font color="#E5E5E5">as someone runs PowerShell version - oh</font>

953
00:46:42,630 --> 00:46:48,100
yes<font color="#E5E5E5"> if PowerShell that eggsy is blocked</font>

954
00:46:45,610 --> 00:46:48,880
<font color="#E5E5E5">so I had a demonstration</font><font color="#CCCCCC"> for</font><font color="#E5E5E5"> this as</font>

955
00:46:48,100 --> 00:46:51,490
well<font color="#E5E5E5"> but you</font><font color="#CCCCCC"> can</font>

956
00:46:48,880 --> 00:46:54,690
imagine what<font color="#E5E5E5"> happens it just pops open</font>

957
00:46:51,490 --> 00:46:57,040
pouch and even if you block<font color="#CCCCCC"> it already</font>

958
00:46:54,690 --> 00:47:01,330
once<font color="#E5E5E5"> again system by</font><font color="#CCCCCC"> transcripts to the</font>

959
00:46:57,040 --> 00:47:01,960
<font color="#E5E5E5">rescue if you have MZ enable</font><font color="#CCCCCC"> MCD X</font>

960
00:47:01,330 --> 00:47:07,450
partial

961
00:47:01,960 --> 00:47:10,270
vbscript<font color="#CCCCCC"> jscript code from memory or if</font>

962
00:47:07,450 --> 00:47:13,529
you want<font color="#E5E5E5"> to avoid that</font><font color="#CCCCCC"> you can do that</font>

963
00:47:10,270 --> 00:47:16,630
as<font color="#E5E5E5"> well</font><font color="#CCCCCC"> so attack its detection</font>

964
00:47:13,530 --> 00:47:19,960
<font color="#E5E5E5">detection in attack which can disable it</font>

965
00:47:16,630 --> 00:47:22,390
<font color="#E5E5E5">and that is what our</font><font color="#CCCCCC"> purple</font><font color="#E5E5E5"> gaming is</font>

966
00:47:19,960 --> 00:47:24,940
about<font color="#E5E5E5"> if you introduce a</font><font color="#CCCCCC"> new detection</font>

967
00:47:22,390 --> 00:47:28,259
mechanism<font color="#E5E5E5"> the red team should try to</font>

968
00:47:24,940 --> 00:47:30,970
<font color="#E5E5E5">avoid it</font><font color="#CCCCCC"> as soon as the rectum tries to</font>

969
00:47:28,260 --> 00:47:32,590
bypass it<font color="#CCCCCC"> for example this one was</font>

970
00:47:30,970 --> 00:47:35,470
created<font color="#E5E5E5"> by Mike</font><font color="#CCCCCC"> the guy who got power</font>

971
00:47:32,590 --> 00:47:37,260
<font color="#CCCCCC">sploit still an event ID is generated</font><font color="#E5E5E5"> so</font>

972
00:47:35,470 --> 00:47:41,129
<font color="#CCCCCC">maybe look for that event ID as well</font>

973
00:47:37,260 --> 00:47:46,630
<font color="#CCCCCC">depends attack defense keep doing that</font>

974
00:47:41,130 --> 00:47:48,340
<font color="#CCCCCC">now as</font><font color="#E5E5E5"> as a freelancer how I go</font><font color="#CCCCCC"> hide</font>

975
00:47:46,630 --> 00:47:51,370
with purple<font color="#CCCCCC"> dipping as I said in the</font>

976
00:47:48,340 --> 00:47:53,890
<font color="#CCCCCC">beginning</font><font color="#E5E5E5"> I do it more in the form of a</font>

977
00:47:51,370 --> 00:47:56,020
training scenario<font color="#E5E5E5"> maybe three or four</font>

978
00:47:53,890 --> 00:47:58,120
<font color="#CCCCCC">guys of the</font><font color="#E5E5E5"> clients blue team or maybe</font>

979
00:47:56,020 --> 00:47:59,650
<font color="#E5E5E5">red team will sit</font><font color="#CCCCCC"> with me and</font><font color="#E5E5E5"> we do it</font>

980
00:47:58,120 --> 00:48:02,910
together in form of a<font color="#E5E5E5"> training that's</font>

981
00:47:59,650 --> 00:48:05,650
how I've<font color="#CCCCCC"> been</font><font color="#E5E5E5"> doing purple teaming oh</font>

982
00:48:02,910 --> 00:48:07,359
<font color="#E5E5E5">there is actually a valid reason of not</font>

983
00:48:05,650 --> 00:48:09,160
<font color="#CCCCCC">doing</font><font color="#E5E5E5"> it with external</font><font color="#CCCCCC"> writing the</font>

984
00:48:07,360 --> 00:48:10,990
adversarial<font color="#E5E5E5"> nature that is</font><font color="#CCCCCC"> okay why</font>

985
00:48:09,160 --> 00:48:13,420
<font color="#CCCCCC">should I share my techniques with my</font>

986
00:48:10,990 --> 00:48:17,140
clients<font color="#E5E5E5"> Blue team that makes sense</font>

987
00:48:13,420 --> 00:48:20,470
<font color="#CCCCCC">oh and that</font><font color="#E5E5E5"> is why most purple teaming</font>

988
00:48:17,140 --> 00:48:22,839
engagements are not done with with an

989
00:48:20,470 --> 00:48:25,450
external<font color="#CCCCCC"> directing both external red</font>

990
00:48:22,840 --> 00:48:29,740
component<font color="#CCCCCC"> in a purple team provides new</font>

991
00:48:25,450 --> 00:48:32,830
techniques new<font color="#E5E5E5"> perspective so please do</font>

992
00:48:29,740 --> 00:48:37,109
not<font color="#CCCCCC"> take</font><font color="#E5E5E5"> us real answers out we are much</font>

993
00:48:32,830 --> 00:48:40,540
more into the purple<font color="#E5E5E5"> teaming scenario</font>

994
00:48:37,110 --> 00:48:45,280
some of the references would<font color="#E5E5E5"> reach on on</font>

995
00:48:40,540 --> 00:48:48,130
purple teaming if you want to be up so

996
00:48:45,280 --> 00:48:50,950
<font color="#E5E5E5">do conclude purple team aims to bring</font>

997
00:48:48,130 --> 00:48:53,080
rags<font color="#E5E5E5"> and view together so not</font><font color="#CCCCCC"> versus red</font>

998
00:48:50,950 --> 00:48:55,470
<font color="#CCCCCC">versus blue but red and blue so that</font><font color="#E5E5E5"> the</font>

999
00:48:53,080 --> 00:48:57,910
benefits for security are<font color="#E5E5E5"> maximized</font>

1000
00:48:55,470 --> 00:49:00,220
doesn't mean<font color="#E5E5E5"> an ad</font><font color="#CCCCCC"> to red teaming both</font>

1001
00:48:57,910 --> 00:49:01,420
have different<font color="#CCCCCC"> goals of course</font><font color="#E5E5E5"> red</font>

1002
00:49:00,220 --> 00:49:05,250
teaming has its own

1003
00:49:01,420 --> 00:49:07,900
the thing<font color="#E5E5E5"> and structural and cultural of</font>

1004
00:49:05,250 --> 00:49:09,910
<font color="#E5E5E5">what cultural changes are really really</font>

1005
00:49:07,900 --> 00:49:14,160
required to<font color="#E5E5E5"> create an effective purple</font>

1006
00:49:09,910 --> 00:49:21,399
team so and<font color="#E5E5E5"> that would be it from me</font>

1007
00:49:14,160 --> 00:49:21,399
[Applause]

