1
00:00:00,000 --> 00:00:07,580
without any further ado I would like to
introduce Karl who we talking about us

2
00:00:07,580 --> 00:00:10,700
about reverse engineering SCADA networks

3
00:00:10,700 --> 00:00:15,219
alright thanks for coming thanks for
coming to the the final talk of the

4
00:00:15,219 --> 00:00:20,480
building track so today I'm going to
talk about reverse engineering wireless

5
00:00:20,480 --> 00:00:27,029
cable networks so I'm sure most of you
are familiar with what that is but just

6
00:00:27,029 --> 00:00:31,090
in case you aren't stands for
supervisory control and data acquisition

7
00:00:31,090 --> 00:00:35,930
which is basically just a bunch of fancy
word for saying it's you know remote

8
00:00:35,930 --> 00:00:41,140
control and monitoring an industrial
systems and these are you send a lot of

9
00:00:41,140 --> 00:00:47,890
critical infrastructure applications
such as the power grid water supply oil

10
00:00:47,890 --> 00:00:53,930
and gas lines things like that and over
the past few years it seems like it's

11
00:00:53,930 --> 00:01:03,129
become the hot new things so you know
DEFCON and RSA you have the SCADA or ICS

12
00:01:03,129 --> 00:01:11,090
village it's even finding its way into
things like the NDC in CCDC competition

13
00:01:11,090 --> 00:01:16,869
where they have like students try to
hack this big SCADA network and there's

14
00:01:16,869 --> 00:01:24,590
there's been so many talk submitted on
state us that even like the DEFCON and

15
00:01:24,590 --> 00:01:32,759
and black hat CFP Board members are
getting pretty tired at that but this

16
00:01:32,759 --> 00:01:37,520
these issues have actually been around
for a while so I was going back through

17
00:01:37,520 --> 00:01:44,340
through the archives found this great
talk from 2006 which is covers all sorts

18
00:01:44,340 --> 00:01:49,250
of fails with connecting the SCADA
systems to the Internet

19
00:01:49,250 --> 00:01:55,970
their their first example is basically
they hopped on the power power

20
00:01:55,970 --> 00:01:57,350
generation

21
00:01:57,350 --> 00:02:02,580
stations wifi in their conference room
and got to Lake basically close to the

22
00:02:02,580 --> 00:02:13,130
generator and then they were asked to
stop back in 2007 DHS did this fun

23
00:02:13,130 --> 00:02:20,489
project Aurora test where they have this
diesel generator I believe that's

24
00:02:20,489 --> 00:02:27,470
connected to this system and by I
believe what they are doing is

25
00:02:27,470 --> 00:02:36,090
connecting and disconnecting it at
various phases such that it gets out of

26
00:02:36,090 --> 00:02:40,870
sync with the rest of the grid and when
you connect it when it's out of phase

27
00:02:40,870 --> 00:02:51,080
things get very bad very quickly and
then it just goes downhill from there

28
00:02:51,080 --> 00:02:57,700
there's another view of that so now he's
just so you know with some packets

29
00:02:57,700 --> 00:03:02,970
connecting and disconnecting a chorus
now there's things like shown in and

30
00:03:02,970 --> 00:03:09,680
since this where you can just search the
internet for these state of facing

31
00:03:09,680 --> 00:03:16,340
systems either through the three
specific set of protocols like the mp3

32
00:03:16,340 --> 00:03:22,940
or Modbus or sometimes you'll see the
ENT interfaces to what they call the H

33
00:03:22,940 --> 00:03:30,780
Meyer human machine interface and this
is a hobby enjoyed by many so I gave

34
00:03:30,780 --> 00:03:36,310
this loves to scan the internet for open
VNC sessions and check out what what's

35
00:03:36,310 --> 00:03:40,530
going on out there and you know you run
across all sorts of crazy things on

36
00:03:40,530 --> 00:03:49,630
connected to the Internet like I think
this is green power system potato

37
00:03:49,630 --> 00:03:55,829
storage farms yes I mean there's I think
he gave a talk in like five crazy things

38
00:03:55,829 --> 00:03:58,920
that are connected to the internet or
something like skating rink think things

39
00:03:58,920 --> 00:04:03,799
like that so there's been a lot of
attention on

40
00:04:03,800 --> 00:04:08,680
SCADA systems connected to the internet
but the SCADA systems are not just on

41
00:04:08,680 --> 00:04:12,920
the internet there lots of legacy
systems that use things like cereal

42
00:04:12,920 --> 00:04:20,089
lines dial-up modems dedicated leased
lines from the phone company and of

43
00:04:20,089 --> 00:04:27,760
course what we're talking about today
our radios and so around where I live we

44
00:04:27,760 --> 00:04:34,110
were seen these interesting and tennis
sitting next to these interesting

45
00:04:34,110 --> 00:04:39,890
working power boxes and we were
interested in what they were and how

46
00:04:39,890 --> 00:04:46,890
they work and what they were doing as an
aside you'll find lots of interesting

47
00:04:46,890 --> 00:04:52,590
things on the IRS spectrum so you have
like mobile data terminals for taxis

48
00:04:52,590 --> 00:04:59,909
police you have a lot of other things
that are a lot of other utilities do all

49
00:04:59,910 --> 00:05:06,160
sorts of things you have transportation
systems so like a train control things

50
00:05:06,160 --> 00:05:13,990
like that so far this talk is sort of a
case study and and how I approach trying

51
00:05:13,990 --> 00:05:18,900
to reverse engineer these types of radio
systems so that if you see something

52
00:05:18,900 --> 00:05:24,880
interesting on on the spectrum that you
want to you to figure out and listen in

53
00:05:24,880 --> 00:05:32,310
on this might give you some some
starting points but back to skater sight

54
00:05:32,310 --> 00:05:37,350
we saw these boxes and we were curious
what they actually were

55
00:05:37,350 --> 00:05:42,280
and as it turns out at least and
california's required by law that the

56
00:05:42,280 --> 00:05:47,450
utility makes certain documents
available that basically describes

57
00:05:47,450 --> 00:05:57,849
exactly what's in there and these these
documents are for developers

58
00:05:57,849 --> 00:06:01,740
subdivisions for example and they'll
tell him hey you need to acquire this

59
00:06:01,740 --> 00:06:10,179
equipment from us and install it this
way and and set up a certain pattern so

60
00:06:10,179 --> 00:06:18,849
what's actually inside here is a patent
counts which which connects for the

61
00:06:18,849 --> 00:06:25,529
neighborhood to the rest of the power
distribution system and that's that box

62
00:06:25,529 --> 00:06:27,129
on the right there

63
00:06:27,129 --> 00:06:32,229
the control signals for that switch and
they're sending signals for like our

64
00:06:32,229 --> 00:06:33,830
current things like that

65
00:06:33,830 --> 00:06:39,490
go back to this other box and inside
that box is what's known as a remote

66
00:06:39,490 --> 00:06:45,939
terminal unit which does the actual
control of the switch and that

67
00:06:45,939 --> 00:06:53,379
interfaces with a radio which does the
actual wireless link over over the

68
00:06:53,379 --> 00:07:01,139
antenna so we were so we now know what's
what's inside the box so we we started

69
00:07:01,139 --> 00:07:06,819
scanning around the spectrum and we
found some some interesting signals and

70
00:07:06,819 --> 00:07:24,979
I don't think I have audio here but
radio and talking about conveniently

71
00:07:24,979 --> 00:07:28,568
enough you can also look up these
frequencies in one of my favorite

72
00:07:28,569 --> 00:07:35,999
websites the SEC website so you can put
in either your service provider or you

73
00:07:35,999 --> 00:07:43,349
could search for particular frequencies
and see who owns that frequency and what

74
00:07:43,349 --> 00:07:50,800
they're using it for things like that so
the first thing that we did is we used

75
00:07:50,800 --> 00:07:56,379
in your radio to start listening to the
signal and plotting it out and trying to

76
00:07:56,379 --> 00:08:03,539
figure out what it actually is so
because we could hear that with just

77
00:08:03,539 --> 00:08:05,539
sort of a narrowband FM

78
00:08:05,540 --> 00:08:14,020
demodulator in the EP suffer defined
radio tool that we were using that

79
00:08:14,020 --> 00:08:18,440
suggested that it was some sort of we
could use some sort of FM demodulator

80
00:08:18,440 --> 00:08:23,690
and get some sort of signal out of it
and so if you just set up a standard FM

81
00:08:23,690 --> 00:08:28,100
demodulator and radio and then plug the
output you would see something like this

82
00:08:28,100 --> 00:08:34,870
and this looks very interesting because
you can sort of see bits there it looks

83
00:08:34,870 --> 00:08:41,669
very digital but there are some issues
here like what's up with with those

84
00:08:41,669 --> 00:08:46,850
points away where they sort of in the
middle there it's it's not like a 10

85
00:08:46,850 --> 00:08:51,590
they're sorta just in between and doing
some weird things and so we weren't

86
00:08:51,590 --> 00:08:57,860
entirely sure how to decode this actual
signal so we went back to those

87
00:08:57,860 --> 00:09:04,490
documents now as it turns out it says
that the radio is India's radio so we

88
00:09:04,490 --> 00:09:11,970
did some searching on what in India s
radio as turns out in des is cancer

89
00:09:11,970 --> 00:09:16,180
microarray data systems they were
acquired by General Electric many years

90
00:09:16,180 --> 00:09:23,030
ago and they make radios for all sorts
of types of SCADA applications and so we

91
00:09:23,030 --> 00:09:26,449
were hunting through the site and we
found what we thought was the radio that

92
00:09:26,450 --> 00:09:33,990
was used in this in this system and so I
went to my other favorite website which

93
00:09:33,990 --> 00:09:38,600
is still the ICC's website but a
different portion of it now as it turns

94
00:09:38,600 --> 00:09:44,160
out in the us- to to sell anything that
transmits a signal you have to get an

95
00:09:44,160 --> 00:09:50,939
FCC I D and get it approved by the FCC
and for that you have to submit a

96
00:09:50,940 --> 00:09:57,020
boatload of documentation to the SEC
including him a text area of operation

97
00:09:57,020 --> 00:10:03,710
internal photos things like that and
some of it you can request from the FCC

98
00:10:03,710 --> 00:10:12,950
is website now unfortunately for us they
can request confidentiality for certain

99
00:10:12,950 --> 00:10:19,240
certain aspects such as you know the
schematics and things like that on on

100
00:10:19,240 --> 00:10:24,270
trade secret ground so usually you'll
see something and these systems

101
00:10:24,270 --> 00:10:29,750
basically saying that we would like
these documents to be permanently

102
00:10:29,750 --> 00:10:36,790
confidential except sometimes they screw
up and don't send that letter and so

103
00:10:36,790 --> 00:10:41,980
turns out that we got the the theory of
operation and and block diagram for this

104
00:10:41,980 --> 00:10:50,990
particular modem but it was really weird
it's so instead of it said let's see

105
00:10:50,990 --> 00:10:57,380
here and use it as a continuous phase
frequency shift keying modulation that

106
00:10:57,380 --> 00:11:02,110
we knew but it uses this crazy do a
binary encoding that we knew nothing

107
00:11:02,110 --> 00:11:07,100
about there's very little information on
the internet about how that's actually

108
00:11:07,100 --> 00:11:13,760
this dual binary thing what it is and
how it works and so this left us even

109
00:11:13,760 --> 00:11:18,810
more confused because we weren't quite
sure what was going on there now as it

110
00:11:18,810 --> 00:11:25,810
turns out this new binary set up
actually explains the little weirdness

111
00:11:25,810 --> 00:11:33,380
here that's going on and so we actually
had to account for that too

112
00:11:33,380 --> 00:11:40,340
to get bits out and so to explain what
what do binary encoding actually is take

113
00:11:40,340 --> 00:11:44,850
a few minutes to talk about digital
modulation so when year when you're

114
00:11:44,850 --> 00:11:49,440
sending a signal a digital signal
basically you're just sending a square

115
00:11:49,440 --> 00:11:55,680
wave of a bit stream and the square
waves modulate a carrier and and some

116
00:11:55,680 --> 00:11:59,819
some way so you could have amplitude
modulation frequency modulation phase

117
00:11:59,820 --> 00:12:02,360
modulation can

118
00:12:02,360 --> 00:12:07,079
do all sorts of fancy things without
that I won't go into much the problem is

119
00:12:07,079 --> 00:12:12,750
if you just modulated carrier with a
square wave it'll take an infinite

120
00:12:12,750 --> 00:12:17,269
amount of bandwidth and you can actually
experiment with this on your own and the

121
00:12:17,269 --> 00:12:25,519
new radio so on the top here we have the
time domain of a signal that I was

122
00:12:25,519 --> 00:12:31,260
generated basically it was sort of an on
off teen of a certain carrier and below

123
00:12:31,260 --> 00:12:37,410
that is actually the FFT or the
frequency domain of the signal that is

124
00:12:37,410 --> 00:12:41,550
coming out and as you can see it takes
up a whole bunch of bandwidth when

125
00:12:41,550 --> 00:12:45,349
you're doing that and as you mess around
with the frequencies you can see

126
00:12:45,350 --> 00:12:49,110
different things happening in the
frequency domain but it's basically just

127
00:12:49,110 --> 00:12:56,750
all over the spectrum and so the reason
for this is that square waves are some

128
00:12:56,750 --> 00:13:03,940
of harmonics and so it effectively
includes an infinite number of

129
00:13:03,940 --> 00:13:11,190
frequencies so the way around this is to
remove some of those frequencies and

130
00:13:11,190 --> 00:13:16,760
usually do that by by filtering
filtering those frequencies out miss

131
00:13:16,760 --> 00:13:23,970
introduces what's known as interest
symbol interference where the individual

132
00:13:23,970 --> 00:13:30,730
bets start smearing overtime and they
start colliding with each other and when

133
00:13:30,730 --> 00:13:37,050
that happens it you can't tell what what
the bets are the symbols are anymore and

134
00:13:37,050 --> 00:13:39,699
22 sort of explain why that happens

135
00:13:39,699 --> 00:13:48,209
look at a wedding filters impulse
responses so imagine if you had just a a

136
00:13:48,209 --> 00:13:53,779
a signal that was completely constant
except for a single lip at an

137
00:13:53,779 --> 00:14:01,480
instantaneous point in time if you
actually look at what happens and you

138
00:14:01,480 --> 00:14:07,290
put that through the filter you actually
get a signal that is spread over time

139
00:14:07,290 --> 00:14:12,279
coming out of that filter this is known
as the impulse response won't go into

140
00:14:12,279 --> 00:14:17,300
much detail about it but basically if
you have just a single instantaneous

141
00:14:17,300 --> 00:14:22,459
blip it can last for a long time and so
the actual way that you get around

142
00:14:22,459 --> 00:14:27,670
intersymbol interference in making
systems is what's known as a raised

143
00:14:27,670 --> 00:14:33,829
cosine filter and so this is the impulse
response for a raised cosine filter and

144
00:14:33,829 --> 00:14:41,420
the interesting thing here is that so
the the symbol . it's T on this graph

145
00:14:41,420 --> 00:14:49,128
and so at a time zero the impulse
response is is one so you have all the

146
00:14:49,129 --> 00:14:55,769
energy there at multiples of the symbol
period the impulse responses 0 which

147
00:14:55,769 --> 00:15:02,379
means that contributes nothing to the
instantaneous time domain signal and so

148
00:15:02,379 --> 00:15:05,509
if you over ladies on top of each other

149
00:15:05,509 --> 00:15:14,779
you get a bunch of these like nice
shaped sort of curse where the the

150
00:15:14,779 --> 00:15:21,160
contribution from all of the other
curves at precisely the right symbol

151
00:15:21,160 --> 00:15:29,089
time you get no contribution from those
those other those other responses there

152
00:15:29,089 --> 00:15:36,779
and so this is how things are normally
done this modem doesn't do that instead

153
00:15:36,779 --> 00:15:41,959
what it does is it uses what's known as
a controlled intersymbol interference

154
00:15:41,959 --> 00:15:48,819
filter the reason they do that is this
basically doubles their their bandwidth

155
00:15:48,819 --> 00:15:55,729
and gets closer to the theoretical
bandwidth limit of the channel

156
00:15:55,730 --> 00:16:02,260
and the issues what is known as a cosine
filter which has intersymbol

157
00:16:02,260 --> 00:16:06,730
interference at precisely one simple
honorable and so this is what that looks

158
00:16:06,730 --> 00:16:14,079
like so you have the the impulse
response for two different bits here the

159
00:16:14,079 --> 00:16:20,579
blue one which doesn't look very blue on
the screen and the pink one there and so

160
00:16:20,579 --> 00:16:23,680
say time negative one

161
00:16:23,680 --> 00:16:30,339
the blue symbols being set at time 0 the
pink ones being sent and in between they

162
00:16:30,339 --> 00:16:37,920
add up together and then at all other
times they are up 20 they don't

163
00:16:37,920 --> 00:16:45,779
contribute anything and so this means
that the actual signal depends on the

164
00:16:45,779 --> 00:16:49,630
previous bet that you received and so
you can add these up in different ways

165
00:16:49,630 --> 00:16:54,320
if you have one symbol of that sort of
going down and one simple going up then

166
00:16:54,320 --> 00:17:01,389
the when you take a sample the actual
signal is at zero and this partially

167
00:17:01,389 --> 00:17:07,069
explains why you were seeing those those
weird things in the signal there and

168
00:17:07,069 --> 00:17:13,839
because this is a controlled filtering
doesn't last forever if you have like

169
00:17:13,839 --> 00:17:19,040
multiple recurring symbols that are the
same of these positive going bumps then

170
00:17:19,040 --> 00:17:28,610
you just get a nice steady steady signal
there so the other half of this is that

171
00:17:28,610 --> 00:17:38,209
that filter that you apply to smooth out
those bit that you are sending it for

172
00:17:38,210 --> 00:17:43,809
for various reasons its optimal to do
half of the filtering on the center side

173
00:17:43,809 --> 00:17:48,168
and happened to fill teen filtering on
the receiver side and so we actually had

174
00:17:48,169 --> 00:17:56,380
to recreate the filter that they were
using to fully get get this controlled

175
00:17:56,380 --> 00:18:00,520
intersymbol interference and so
basically the way that you do that is

176
00:18:00,520 --> 00:18:02,129
you have you know this

177
00:18:02,130 --> 00:18:03,360
co-sign

178
00:18:03,360 --> 00:18:13,979
function and you just take the square
root of of that because why do you take

179
00:18:13,980 --> 00:18:18,570
the square root of that I forgot
whatever alright so so you can read it

180
00:18:18,570 --> 00:18:23,299
and so they basically two to make a
filter you you take the impulse response

181
00:18:23,299 --> 00:18:28,670
you want and in the time domain he take
enough inverse FFT of that and then you

182
00:18:28,670 --> 00:18:32,210
got your your filter coefficients and so
that sort of looks like this if you do

183
00:18:32,210 --> 00:18:39,540
and and and Python so you have your your
squared cosine function and then you

184
00:18:39,540 --> 00:18:48,399
have your impulse response there and
then you're all good to go and so if you

185
00:18:48,400 --> 00:18:58,510
apply this to a if you play this as your
filter coefficients 24 filtering the new

186
00:18:58,510 --> 00:19:04,030
radio it can improve the signal so on
the middle there was our original signal

187
00:19:04,030 --> 00:19:10,280
and on the top of their is is our newly
filtered signal and you you might notice

188
00:19:10,280 --> 00:19:16,200
that the sort of excursions around zero
around the center are far less

189
00:19:16,200 --> 00:19:21,410
pronounced there some other subtle
subtle improvements there but now it's

190
00:19:21,410 --> 00:19:29,020
starting to to make a lot more sense and
so now we got to sort of the easy part

191
00:19:29,020 --> 00:19:36,080
so few if you see a positive blip the
bits of one if it's negative blip

192
00:19:36,080 --> 00:19:44,460
0 if it's AB 0 than the bed is the
opposite of what you last saw and so you

193
00:19:44,460 --> 00:19:51,429
can actually start decoding this by hand
and coming up with a bit stream and then

194
00:19:51,429 --> 00:19:56,740
you can try to reverse engineer that so
teams you know obvious where to sample

195
00:19:56,740 --> 00:20:04,090
either at the peak Cir zeros but I
actually tried to coding this by hand

196
00:20:04,090 --> 00:20:11,530
and got some weird gibberish out that
didn't really make a whole lot of sense

197
00:20:11,530 --> 00:20:17,720
in fact that looked pretty random and so
what's an entirely sure way way that was

198
00:20:17,720 --> 00:20:23,120
happening the FCC documents actually
explain some of that but not a whole lot

199
00:20:23,120 --> 00:20:29,780
of that so for figuring that out we went
to the MDS website turns out you can

200
00:20:29,780 --> 00:20:35,420
download the firmware for these modems
and these modems if you look at the

201
00:20:35,420 --> 00:20:39,830
internal photos there have to process
areas there is an a bit microcontroller

202
00:20:39,830 --> 00:20:49,449
and then there is a a DSP chip that does
the modulation and demodulation but

203
00:20:49,450 --> 00:20:53,590
there's only one firmware image and so
we had to figure out which bites belong

204
00:20:53,590 --> 00:21:00,409
to which processor so we had to reverse
the eight bit microcontroller that

205
00:21:00,410 --> 00:21:06,230
manages the radio to figure out how to
code into the DSP and so we isolated

206
00:21:06,230 --> 00:21:13,150
what the the the DSP code was then we
brought it and I and holy shit that

207
00:21:13,150 --> 00:21:20,410
looks like a mess so like in this
architecture you can have three

208
00:21:20,410 --> 00:21:24,460
operations per instruction and so you
see a lot of this year in like the

209
00:21:24,460 --> 00:21:30,510
middle where it's going you know
whatever Impey are is on on one offer on

210
00:21:30,510 --> 00:21:36,610
some operations and then simultaneously
it's doing the data transfer between

211
00:21:36,610 --> 00:21:43,149
various registers and it is very messy
working and we couldn't get our heads

212
00:21:43,150 --> 00:21:49,220
around it at all turned out it was an
Indian issues so we just swap the bite

213
00:21:49,220 --> 00:21:55,260
orders and then everything looked a lot
cleaner it was still kind of a nightmare

214
00:21:55,260 --> 00:22:04,190
to reverse engineer so we didn't go a
whole lot down that route but I'll talk

215
00:22:04,190 --> 00:22:09,650
about some things we found in a minute
as it turns out you can also once you

216
00:22:09,650 --> 00:22:16,600
account for the Indian issue if you just
plug the firmware as a bunch of 24 bit

217
00:22:16,600 --> 00:22:19,959
floats you get something

218
00:22:19,960 --> 00:22:23,970
looks like this which is very
interesting because you see those those

219
00:22:23,970 --> 00:22:30,310
nice pulses there that we're like the
filter response that we created earlier

220
00:22:30,310 --> 00:22:35,669
so you could actually just avoid doing
all this math and extracting extracted

221
00:22:35,670 --> 00:22:39,020
out from the firmware just by
visualizing that now there is there some

222
00:22:39,020 --> 00:22:43,139
complexity and there you need to know
the sample rate and things like that so

223
00:22:43,140 --> 00:22:48,540
it's not quite straightforward there's
another part of the firmware memory so

224
00:22:48,540 --> 00:22:58,600
it's nice to be july's things but it was
a pain to reverse engineer so we decided

225
00:22:58,600 --> 00:23:08,449
that so early on we were gonna try to do
this completely justifiable observation

226
00:23:08,450 --> 00:23:14,420
and you know not cheat and get our hands
on an actual modem but we broke down and

227
00:23:14,420 --> 00:23:18,980
and realized that was probably the most
sensible thing to do so we went to

228
00:23:18,980 --> 00:23:23,110
another favorite website in mind eBay
turns out you can buy these radios for

229
00:23:23,110 --> 00:23:30,070
about 50 bucks off of ebay now you might
say that's not fair there's no bids on

230
00:23:30,070 --> 00:23:37,610
that yet you can do a Buy It Now 415
they're pretty easy to acquire and so we

231
00:23:37,610 --> 00:23:45,340
got one and weary tune into the ASM band
so we weren't stomping on any anyone's

232
00:23:45,340 --> 00:23:51,080
licensed frequency and then we turned up
our way down so that we weren't stomping

233
00:23:51,080 --> 00:24:00,100
on any GSM systems and then we started
sending bites through the serial port

234
00:24:00,100 --> 00:24:03,909
care now as it turns out that is not a
standard serial port so you have to

235
00:24:03,910 --> 00:24:10,650
figure that out as well and then we
started laughing the signal back in

236
00:24:10,650 --> 00:24:16,010
canoe radio and you can ignore most of
what's on here except for the Deep

237
00:24:16,010 --> 00:24:21,629
Purple Line they're not sure the colors
come through well on these projectors

238
00:24:21,630 --> 00:24:26,670
but basically we were sending various
characters and we would look at

239
00:24:26,670 --> 00:24:30,340
differences between the signal so for
example this is an A

240
00:24:30,340 --> 00:24:34,699
and this is Abby and you go back and
forth thing he tried to try to see

241
00:24:34,700 --> 00:24:36,179
what's different

242
00:24:36,179 --> 00:24:42,650
and what's what's the same and so from
this week could we could establish a few

243
00:24:42,650 --> 00:24:49,880
things first there was a standard
preamble just like repeating ones and

244
00:24:49,880 --> 00:24:57,240
zeros alternating ones and zeros
followed by some other random sequence

245
00:24:57,240 --> 00:25:04,890
that turns out identifies the type of
the modem no sub sequence of bits in the

246
00:25:04,890 --> 00:25:08,490
bits that we decode it actually
translate that's a ski and we were

247
00:25:08,490 --> 00:25:13,600
sending asked me to this radio so it's
still a bit unclear what what was going

248
00:25:13,600 --> 00:25:21,090
on there if you go back and look at this
there's no room that the packets are

249
00:25:21,090 --> 00:25:27,039
shown up so short that there's no room
for length field so we weren't entirely

250
00:25:27,039 --> 00:25:31,970
sure how they were communicating how
long a packet was there is also no room

251
00:25:31,970 --> 00:25:38,730
for say a CRC or anything like that so
it's starting to look pretty simple and

252
00:25:38,730 --> 00:25:44,380
perhaps more interesting is the fact
that if you send like multiple letters

253
00:25:44,380 --> 00:25:51,450
that are the same like a and AAA AAA is
not just UAE's back-to-back it actually

254
00:25:51,450 --> 00:25:57,179
looks completely different and so this
probably indicates that there are some

255
00:25:57,179 --> 00:26:04,070
sort of scrambling going on and this is
not for security but it's used for sort

256
00:26:04,070 --> 00:26:10,710
of whitening the spectrum and sort of
spreading out making it look more random

257
00:26:10,710 --> 00:26:19,590
for various signal integrity reasons
basically you want to make your your

258
00:26:19,590 --> 00:26:26,379
signal sort of look as uniform as
possible and the frequency domain so to

259
00:26:26,380 --> 00:26:33,340
figure out how they were doing the
splits Grambling we went back to we

260
00:26:33,340 --> 00:26:36,919
actually annotated these functions they
weren't given to us

261
00:26:36,920 --> 00:26:43,350
and the easiest way to find but
scrambling stuff and DSP code is just do

262
00:26:43,350 --> 00:26:48,889
a instructions search for X-ers turns
out that X or is not a very common

263
00:26:48,890 --> 00:26:54,320
instruction and DSP code and so when you
see it it's probably either a CRC or a

264
00:26:54,320 --> 00:26:58,830
bit scrambler or something that does
something interesting with a bit strange

265
00:26:58,830 --> 00:27:06,169
and so we we pretty quickly went through
this list we found you know CRC function

266
00:27:06,170 --> 00:27:12,390
and we also found that scrambler which
is a pretty simple function so it

267
00:27:12,390 --> 00:27:16,520
basically operates as a linear feedback
shift register where you shift bits n

268
00:27:16,520 --> 00:27:22,550
and see some of those bets and shift
register are tapped out an XOR together

269
00:27:22,550 --> 00:27:32,030
and then shifted back into this shift
register and so we can easily account

270
00:27:32,030 --> 00:27:36,370
for this in our software and once we did
that we started getting asked you out

271
00:27:36,370 --> 00:27:40,979
and that was very exciting for us
because now we can start potentially

272
00:27:40,980 --> 00:27:47,440
listening and to the SCADA networks we
found some other interesting things from

273
00:27:47,440 --> 00:27:53,270
disassembling this code so it turns out
they say that their bod rates 9600 well

274
00:27:53,270 --> 00:27:58,550
it isn't and that caused us some
synchronization issues which was driving

275
00:27:58,550 --> 00:28:03,639
me and saying turns out they have like
an off by one error in sending their

276
00:28:03,640 --> 00:28:11,330
clock divider and so it actually
transmits at not 9696 18 which is a

277
00:28:11,330 --> 00:28:16,470
little weird the individual characters
that they send are not your standard a

278
00:28:16,470 --> 00:28:21,010
pic characters but they're actually nine
big characters and they use the most

279
00:28:21,010 --> 00:28:27,440
significant bit to indicate whether it's
sort of an in-band

280
00:28:27,440 --> 00:28:32,509
character that you go out the serial
port or its for some sort of out of band

281
00:28:32,509 --> 00:28:39,299
management turns out you can actually
send commands to these radios over the

282
00:28:39,299 --> 00:28:45,460
same channel as well and we discovered
that there's actually a couple of

283
00:28:45,460 --> 00:28:49,309
different types of preamble that would
identify the modem either saying that

284
00:28:49,309 --> 00:28:55,769
it's the sort of master station or the
the slate stations the master stations

285
00:28:55,769 --> 00:29:00,009
just passed out there packets with idle
characters and it's one of those special

286
00:29:00,009 --> 00:29:05,480
out of bands characters that indicates
that there's nothing to be transmitted

287
00:29:05,480 --> 00:29:10,750
well these Playstations will send a
special out of an character saying I'm

288
00:29:10,750 --> 00:29:14,490
turning off my radio stopped listening
to me because all you're gonna hear is

289
00:29:14,490 --> 00:29:20,649
noise and you'll get garbage trying to
decode that so we wrap this all up any

290
00:29:20,649 --> 00:29:29,689
fun package hold your skater and so if
you contest from from github and compile

291
00:29:29,690 --> 00:29:40,519
it then you should be able to use our
our work to also listen in on these

292
00:29:40,519 --> 00:29:49,200
these modems and get a character stream
out so that was about the modem gonna

293
00:29:49,200 --> 00:29:55,600
switch a bit and talk about how the
modem is actually used in relation with

294
00:29:55,600 --> 00:30:01,809
with the SCADA systems so these these
modems themselves are connected to what

295
00:30:01,809 --> 00:30:07,158
are known as remote terminal units which
implement also known as a multiple

296
00:30:07,159 --> 00:30:14,429
address service which basically means
that they are all listening to a single

297
00:30:14,429 --> 00:30:20,129
master station and the master station
will pull these out stations or send

298
00:30:20,129 --> 00:30:27,779
them or send them command by the
individual stations idea and these out

299
00:30:27,779 --> 00:30:33,460
stations will only transmitted back when
they are polled by the master and this

300
00:30:33,460 --> 00:30:38,410
map swell to the old multi drop serial
buses that were used

301
00:30:38,410 --> 00:30:46,030
hardwired SCADA systems using things
like a bus and mp3 speaking of which

302
00:30:46,030 --> 00:30:52,379
there are two major protocols for a
four-state up at least we we mainly

303
00:30:52,380 --> 00:31:00,270
focused on the mp3 because that was what
was being used by the local utility and

304
00:31:00,270 --> 00:31:05,879
what's interesting about these protocols
is that they were they were designed for

305
00:31:05,880 --> 00:31:13,510
these older wired serial bus system so
they don't really take security into

306
00:31:13,510 --> 00:31:20,310
consideration and so if you want to use
these over wireless links wireless link

307
00:31:20,310 --> 00:31:24,700
itself has to implement security well as
it turned out the wireless link says

308
00:31:24,700 --> 00:31:30,760
securities not my problem it's on the
higher level stuff and as you guess no

309
00:31:30,760 --> 00:31:35,510
one implement security here so it's it's
all out there and the clear unencrypted

310
00:31:35,510 --> 00:31:41,490
on authenticated and conveniently enough
these protocols are actually supported

311
00:31:41,490 --> 00:31:49,430
and wire short and so if you either have
our Dr Stata module or if you go out on

312
00:31:49,430 --> 00:31:55,790
eBay and buy one of these modems you can
just pay pretend to like neck at to turn

313
00:31:55,790 --> 00:32:01,399
it into like UDP packets RTCP packets
and Wireshark will actually start

314
00:32:01,400 --> 00:32:07,910
decoding this for you so might be hard
to read but you can't be highlighted

315
00:32:07,910 --> 00:32:13,940
packet here is a response from station
5338 back to i-81 which is the master

316
00:32:13,940 --> 00:32:20,740
saying I've got a response for a request
that you had some some values changed

317
00:32:20,740 --> 00:32:25,810
probably voltage current terms something
like that so no the interesting question

318
00:32:25,810 --> 00:32:34,560
is well how do you know what these
sources source IDs map too well turns

319
00:32:34,560 --> 00:32:40,010
out that utilities like to label things
and that's actually maps up perfectly so

320
00:32:40,010 --> 00:32:44,879
we initially we weren't sure whether the
mapping was was once when like that but

321
00:32:44,880 --> 00:32:48,710
no it is it's it's very convenient

322
00:32:48,710 --> 00:32:56,820
13 DMP actually defines what are known
as different types of objects and so you

323
00:32:56,820 --> 00:33:05,520
can have like an analog value object or
a binary input or binary output things

324
00:33:05,520 --> 00:33:13,418
like that and so these objects are all
addressed by some numerical I D which

325
00:33:13,419 --> 00:33:19,730
are known as points we weren't really
sure what these points map too and that

326
00:33:19,730 --> 00:33:27,200
sort of implementation specific so we
thought we were onto something based on

327
00:33:27,200 --> 00:33:33,460
also more labeling by the utility which
said exactly what kind of pattern on its

328
00:33:33,460 --> 00:33:40,950
which they had installed if you go and
google the manufacture followed by the

329
00:33:40,950 --> 00:33:46,190
phrase DMP point . list you'll get all
sorts of interesting documents online

330
00:33:46,190 --> 00:33:54,510
that will describe the mapping of these
point IDs to various things like point

331
00:33:54,510 --> 00:34:04,090
for is the current for face a on which
one or status point one that these which

332
00:34:04,090 --> 00:34:05,340
is open

333
00:34:05,340 --> 00:34:11,310
status went to says that the switch is
closed they're also control point so

334
00:34:11,310 --> 00:34:16,580
control point to will let you open and
close the switch by saying change

335
00:34:16,580 --> 00:34:22,290
control point to to either open or close
you can do some other things you know

336
00:34:22,290 --> 00:34:27,330
start battery test other weird things
like found this interesting there is a

337
00:34:27,330 --> 00:34:31,310
control point you enable or disable wifi

338
00:34:31,310 --> 00:34:37,900
there's also a control point to clear
the wifi intrusion alarm I have no idea

339
00:34:37,900 --> 00:34:43,440
what the wifi intrusion alarm is but
it's a single bit that gets set that as

340
00:34:43,440 --> 00:34:47,610
yes someone has tripled wifi intrusion
alarm and then you can send another

341
00:34:47,610 --> 00:34:54,430
signal to clear very weird so
unfortunately these are to use that

342
00:34:54,429 --> 00:35:00,009
we're sold by the the switch
manufacturer an integrated into those

343
00:35:00,010 --> 00:35:05,880
switches as it turns out you don't have
to use the manufacturers are to use and

344
00:35:05,880 --> 00:35:12,250
in our case another party you what was
being used so that none of the points

345
00:35:12,250 --> 00:35:16,770
list that we found actually map to
anything so we decided to get creative

346
00:35:16,770 --> 00:35:21,950
and just start listening to everything
and graphing and so we get these

347
00:35:21,950 --> 00:35:27,439
interesting looking graphs hear it
crashed in the middle so we don't have

348
00:35:27,440 --> 00:35:33,650
some data for a few months there but
basically this is graphing the values

349
00:35:33,650 --> 00:35:42,880
are sort of bouncing around between Lake
negative 6600 and negative 7800 and so i

350
00:35:42,880 --> 00:35:49,480
think thats about in the range of like a
single-phase voltage and a three-phase

351
00:35:49,480 --> 00:35:56,990
13 kilovolt distribution system and so
we could sort of infer from this that

352
00:35:56,990 --> 00:36:03,770
this this corresponds to the actual line
voltage and you can see all these you

353
00:36:03,770 --> 00:36:10,430
know cyclic patterns and dive deep into
it and and have a good ol time but

354
00:36:10,430 --> 00:36:17,529
they're the problem with this approach
is that we were only well we were

355
00:36:17,530 --> 00:36:24,290
listening to everything all the all the
outstation have very directional

356
00:36:24,290 --> 00:36:29,509
antennas and so we weren't getting most
of the packets and we were also getting

357
00:36:29,510 --> 00:36:38,180
some corrupt packet so we weren't seen
everything and so one we have incomplete

358
00:36:38,180 --> 00:36:45,359
data to its a pain to go through and try
to annotate this by hand and so what we

359
00:36:45,360 --> 00:36:49,980
ended up doing is assuming that there
was a handful of similar configurations

360
00:36:49,980 --> 00:36:55,590
and basically just using a simple
clustering algorithm to sort of try to

361
00:36:55,590 --> 00:37:01,800
identify the different types of out
sessions are are to use that we're out

362
00:37:01,800 --> 00:37:08,250
there on the network and so it's still
sort of an open question whether we can

363
00:37:08,250 --> 00:37:12,330
actually map out the SCADA systems just
by observing these packet traces or not

364
00:37:12,330 --> 00:37:20,580
but it's something that we've we thought
about at least so obviously if you can

365
00:37:20,580 --> 00:37:29,870
listen you can also send and so before I
going into this big caveat here I am not

366
00:37:29,870 --> 00:37:34,819
a lawyer but I'm pretty sure that mess
around the power grid is Tom dangerous

367
00:37:34,820 --> 00:37:40,890
and very only go so all these attacks
are theoretical we didn't really have a

368
00:37:40,890 --> 00:37:47,660
way to test any of these so take take
these 44 grain of salt because we just

369
00:37:47,660 --> 00:37:53,870
can't try to implement these attacks so
it's simple attack the obvious one is

370
00:37:53,870 --> 00:37:58,190
you know command injection send send a
package to one of these things to turn

371
00:37:58,190 --> 00:38:03,690
the switch on attorney switch off and
because these are using

372
00:38:03,690 --> 00:38:12,910
FM modulation to send to send their
signals it turns out that you only have

373
00:38:12,910 --> 00:38:17,549
to be a few decibels louder than the
legitimate master to get your signal

374
00:38:17,550 --> 00:38:21,260
through in this is due to what's known
as the FM capture effect where basically

375
00:38:21,260 --> 00:38:26,640
if you are you are slightly louder than
someone else the receiver will lock onto

376
00:38:26,640 --> 00:38:29,400
you and completely ignore

377
00:38:29,400 --> 00:38:36,040
the the other senator and so we just
have to be a little bit louder a

378
00:38:36,040 --> 00:38:41,990
slightly more simplistic slightly less
dumb attack is to do command injection

379
00:38:41,990 --> 00:38:48,729
to the broadcast address so it turns out
mp3 has a special idea of like 65535

380
00:38:48,730 --> 00:38:55,010
which means all our to use and so you
could perhaps and a switch off to me and

381
00:38:55,010 --> 00:38:59,390
to this broadcast eighty I have no idea
what will happen I don't suggest that

382
00:38:59,390 --> 00:39:04,759
anyone try this unless you have your own
like Archie you set up in the lab but

383
00:39:04,760 --> 00:39:08,610
I'll be interesting to know that
actually works and of course the problem

384
00:39:08,610 --> 00:39:12,760
with this is CNN to be line of sight
with all the stations that you want to

385
00:39:12,760 --> 00:39:18,970
fact missus probably out the master
station site again you only need to be a

386
00:39:18,970 --> 00:39:26,859
little bit louder again I've not
verified this so there there's still

387
00:39:26,860 --> 00:39:31,500
some open questions that I have that
might be worth looking into for example

388
00:39:31,500 --> 00:39:35,550
how does the master station get its data
it's on top of the mountain

389
00:39:35,550 --> 00:39:39,830
well that's probably another radio link
and

390
00:39:39,830 --> 00:39:45,370
turned out utilities have all sorts of
radio link some these are like 9600 bps

391
00:39:45,370 --> 00:39:51,799
I've seen some on the SEC website that
are 300 megabits per second and so

392
00:39:51,800 --> 00:39:57,370
that's that's pretty easy orders of
magnitude larger not entirely sure what

393
00:39:57,370 --> 00:40:00,029
that is probably like to use
surveillance or something but I don't

394
00:40:00,030 --> 00:40:08,390
actually know interesting thing we might
look at these out of band characters so

395
00:40:08,390 --> 00:40:15,129
these radios you can manage them over a
serial console but you can also manage

396
00:40:15,130 --> 00:40:20,710
them over the air so could we actually
send commands to these radios over the

397
00:40:20,710 --> 00:40:26,280
air to return them and listen and on a
different frequency and then it doesn't

398
00:40:26,280 --> 00:40:30,820
matter if the master station is trying
to fix things they're not listening to

399
00:40:30,820 --> 00:40:36,050
the master station in another thing that
we want to try doing as its mapping out

400
00:40:36,050 --> 00:40:40,790
exactly where various things are you
know basically doing were driving with

401
00:40:40,790 --> 00:40:49,090
some pseudo doppler radio direction
finding thing so that sort of on the

402
00:40:49,090 --> 00:40:51,850
back burner we'll see we'll see what
happens

403
00:40:51,850 --> 00:40:59,910
so this is all about breaking the speed
skater systems how about fixing it well

404
00:40:59,910 --> 00:41:03,910
and it turned out that utilities are
indeed aware of these vulnerabilities

405
00:41:03,910 --> 00:41:10,890
the problem is that there seems to be
little incentive to to fix these issues

406
00:41:10,890 --> 00:41:16,060
in a reasonable time frame so these
systems that are deployed have like a

407
00:41:16,060 --> 00:41:23,950
thirty year lifetime and so if you very
expensive to go out and replace all this

408
00:41:23,950 --> 00:41:28,359
infrastructure in the middle of its life
it's it's purely a cost for the

409
00:41:28,360 --> 00:41:36,470
utilities you know changing it will not
generate them any more revenue I believe

410
00:41:36,470 --> 00:41:42,200
they're required to do sort of a risk
assessment and report that to regulators

411
00:41:42,200 --> 00:41:48,430
but I believe that most just say it's

412
00:41:48,430 --> 00:41:57,390
an acceptable risk and they're also sort
of in a bind because turns out that the

413
00:41:57,390 --> 00:42:03,589
vendors don't actually think that this
is an issue and so it's very hard to

414
00:42:03,590 --> 00:42:11,790
find both or either secure radios or
secure or to use their they're just very

415
00:42:11,790 --> 00:42:18,190
hard to to find it so even if utilities
wanted to fix this and had incentives to

416
00:42:18,190 --> 00:42:19,330
fix this

417
00:42:19,330 --> 00:42:24,950
not sure they could fix this easily
until they band together and start

418
00:42:24,950 --> 00:42:31,779
pressuring the vendors who make this
equipment so stepping back and looking

419
00:42:31,780 --> 00:42:33,150
at the big picture

420
00:42:33,150 --> 00:42:38,740
curious you know how exactly how
pervasive these systems are so they're

421
00:42:38,740 --> 00:42:43,540
all around my neighborhood in other
areas where i've lived I don't see them

422
00:42:43,540 --> 00:42:55,270
at all I've seen some around Baltimore I
believe but not easy so I'm not sure and

423
00:42:55,270 --> 00:43:00,400
you know a lot of there was a lot of
manual analysis that went into trying to

424
00:43:00,400 --> 00:43:05,630
figure out what these signals are and it
would be nice if there is a tool that we

425
00:43:05,630 --> 00:43:10,150
could just point at an unknown R F
signal and say hey tell me what that is

426
00:43:10,150 --> 00:43:15,780
heart rate so one way that might work is
to try to force combinations of like

427
00:43:15,780 --> 00:43:20,520
rates and modulations gain something and
scrambling patterns and things like that

428
00:43:20,520 --> 00:43:27,630
and try to pull out some some
interesting information so it's very

429
00:43:27,630 --> 00:43:33,220
easy to scan the internet now but it's
not very easy to scan the IRS spectrum

430
00:43:33,220 --> 00:43:38,250
especially over a wide geographic area
so I think it would be interesting

431
00:43:38,250 --> 00:43:42,309
someone were to try to tackle that
problem and

432
00:43:42,309 --> 00:43:48,249
basically do see map of PRS spectrum not
entirely sure how that would work but it

433
00:43:48,249 --> 00:43:49,899
might be interesting

434
00:43:49,900 --> 00:43:57,499
a final point is that our security
through obscurity is basically over with

435
00:43:57,499 --> 00:44:03,288
a new radio you can decode pagers you
can decode cheap GSM traffic you can

436
00:44:03,289 --> 00:44:07,999
decode the project 25 radios which are
sort of the federal standard now for

437
00:44:07,999 --> 00:44:16,859
official use you can Dakota area to be
packets which is like aircraft locations

438
00:44:16,859 --> 00:44:17,910
and things like that

439
00:44:17,910 --> 00:44:23,890
recently it has been working on decoding
Inmarsat an Iridium satellite messages

440
00:44:23,890 --> 00:44:30,799
and and so basically any anything out
there that's not encrypted will probably

441
00:44:30,799 --> 00:44:34,809
get listen to sooner rather than later

442
00:44:34,809 --> 00:44:44,229
through the magic of software-defined
radio surtout to wrap up basically

443
00:44:44,229 --> 00:44:51,448
despite major attention on SCADA
security over the years there's still

444
00:44:51,449 --> 00:44:57,269
critical infrastructure that is exposed
over these non-gaap channels when you're

445
00:44:57,269 --> 00:44:59,488
evaluating the security of the system

446
00:44:59,489 --> 00:45:04,179
you sort of have to look at it
holistically don't rely on other layers

447
00:45:04,179 --> 00:45:10,239
to provide security for you don't just
focus on on IP and again

448
00:45:10,239 --> 00:45:15,299
Aref security through obscurity I
believe is is over so that I'd like to

449
00:45:15,299 --> 00:45:19,229
thank you for your attention and I
believe we have few minutes for

450
00:45:19,229 --> 00:45:28,069
questions

451
00:45:28,069 --> 00:45:46,380
any questions

452
00:45:46,380 --> 00:45:52,380
so the question was do you think it
would be possible to perhaps the

453
00:45:52,380 --> 00:45:59,090
firmware on the radio units to bolster
security I believe the answer is yes

454
00:45:59,090 --> 00:46:07,670
however you either need the cooperation
of be bender and they don't seem

455
00:46:07,670 --> 00:46:12,900
interested or you need to try to hack
something together yourself and if

456
00:46:12,900 --> 00:46:17,970
you're running you know the power grid
you might not want to rely on some happy

457
00:46:17,970 --> 00:46:23,410
that you did yourself so I think
theoretically yes practically probably

458
00:46:23,410 --> 00:46:27,529
not without assistance from the vendors
there is some room in the firmware for

459
00:46:27,530 --> 00:46:29,620
letting you know or something

