1
00:00:00,000 --> 00:00:24,060
all<font color="#CCCCCC"> right all right everybody oh hey</font>

2
00:00:21,689 --> 00:00:27,720
there we go I try<font color="#CCCCCC"> to hold this better</font>

3
00:00:24,060 --> 00:00:31,500
better hi first first<font color="#E5E5E5"> time using a</font>

4
00:00:27,720 --> 00:00:34,680
microphone<font color="#E5E5E5"> all right so thank you all</font>

5
00:00:31,500 --> 00:00:37,530
for coming<font color="#E5E5E5"> I can't promise I'm going to</font>

6
00:00:34,680 --> 00:00:39,059
have the slide transitions that Ben had

7
00:00:37,530 --> 00:00:42,600
that was pretty impressive powerpoint

8
00:00:39,059 --> 00:00:45,360
doesn't have those yet but we'll see

9
00:00:42,600 --> 00:00:49,200
we'll see what we can do maybe that's a

10
00:00:45,360 --> 00:00:51,030
good point but I know this is kind of a

11
00:00:49,200 --> 00:00:53,370
you know<font color="#E5E5E5"> at that point we're</font><font color="#CCCCCC"> all feeling</font>

12
00:00:51,030 --> 00:00:57,719
that sleepy<font color="#E5E5E5"> lunch feeling so hopefully</font>

13
00:00:53,370 --> 00:01:00,209
keep you guys interested so let's get

14
00:00:57,719 --> 00:01:02,309
started<font color="#E5E5E5"> all right so Who am I my name is</font>

15
00:01:00,210 --> 00:01:06,450
Andy rector I'm a consultant out of the

16
00:01:02,309 --> 00:01:09,210
San Francisco office I was a boozer

17
00:01:06,450 --> 00:01:13,049
graduate from 2015 I'd studied digital

18
00:01:09,210 --> 00:01:15,809
forensics and computer science it's my

19
00:01:13,049 --> 00:01:17,490
first<font color="#E5E5E5"> time speaking at a conference so</font>

20
00:01:15,810 --> 00:01:19,439
I'm pretty pumped to be doing it at

21
00:01:17,490 --> 00:01:22,890
<font color="#CCCCCC">Bloomsburg so can't think of a better</font>

22
00:01:19,439 --> 00:01:25,408
venue for that<font color="#CCCCCC"> I'm also applied on</font>

23
00:01:22,890 --> 00:01:26,970
hobbyist I know Dave pany also had had

24
00:01:25,409 --> 00:01:29,909
that on his slides I might have pilfered

25
00:01:26,970 --> 00:01:32,640
that from your slide I'm not sure so my

26
00:01:29,909 --> 00:01:35,579
favorite creation is a highly

27
00:01:32,640 --> 00:01:38,009
sophisticated<font color="#E5E5E5"> Python skype bot that the</font>

28
00:01:35,579 --> 00:01:41,250
man Francisco<font color="#E5E5E5"> ops is absolutely needed</font>

29
00:01:38,009 --> 00:01:44,189
to help<font color="#E5E5E5"> fix lunch every friday we have</font>

30
00:01:41,250 --> 00:01:49,829
we have a challenging problems to solve

31
00:01:44,189 --> 00:01:51,658
at the<font color="#CCCCCC"> san francisco abs so</font><font color="#E5E5E5"> all right so</font>

32
00:01:49,829 --> 00:01:54,029
we're<font color="#CCCCCC"> going</font><font color="#E5E5E5"> to talk about with a like</font>

33
00:01:51,659 --> 00:01:56,189
honey<font color="#CCCCCC"> i stole you know the sea to server</font>

34
00:01:54,030 --> 00:01:58,350
what<font color="#CCCCCC"> we</font><font color="#E5E5E5"> going to talk about so i'm</font><font color="#CCCCCC"> going</font>

35
00:01:56,189 --> 00:02:01,169
to<font color="#E5E5E5"> give you a overview about the</font>

36
00:01:58,350 --> 00:02:03,689
investigation and the attack itself to

37
00:02:01,170 --> 00:02:07,229
kind of set up the actual ceiling of the

38
00:02:03,689 --> 00:02:09,090
sea to server stealing is maybe not the

39
00:02:07,229 --> 00:02:11,160
right word but you'll see what<font color="#E5E5E5"> i mean</font>

40
00:02:09,090 --> 00:02:13,319
obtaining i'm going to<font color="#E5E5E5"> talk about</font><font color="#CCCCCC"> some</font>

41
00:02:11,160 --> 00:02:14,010
of<font color="#E5E5E5"> the challenges faced with analyzing</font>

42
00:02:13,319 --> 00:02:16,950
<font color="#E5E5E5">situ so</font>

43
00:02:14,010 --> 00:02:19,950
pretty exciting<font color="#CCCCCC"> there's a lot of stuff</font>

44
00:02:16,950 --> 00:02:23,849
<font color="#CCCCCC">to talk about and the approach of it was</font>

45
00:02:19,950 --> 00:02:26,310
interesting it's a pretty rare thing to

46
00:02:23,849 --> 00:02:28,649
<font color="#E5E5E5">happen we don't get</font><font color="#CCCCCC"> c2</font><font color="#E5E5E5"> servers to</font>

47
00:02:26,310 --> 00:02:32,069
analyze very often yeah because

48
00:02:28,650 --> 00:02:33,299
attackers own those we<font color="#E5E5E5"> don't and then we</font>

49
00:02:32,069 --> 00:02:36,659
<font color="#CCCCCC">talk about some the victories that we</font>

50
00:02:33,299 --> 00:02:38,700
had just because there's a<font color="#CCCCCC"> lot of cool</font>

51
00:02:36,659 --> 00:02:45,420
things to get from a c2 server as you

52
00:02:38,700 --> 00:02:47,429
might<font color="#E5E5E5"> expect</font><font color="#CCCCCC"> all right so for you guys</font>

53
00:02:45,420 --> 00:02:50,250
<font color="#E5E5E5">to understand how this is different from</font>

54
00:02:47,430 --> 00:02:52,440
a normal investigation kirtu interest in

55
00:02:50,250 --> 00:02:55,440
have to understand how a typical<font color="#E5E5E5"> mandy</font>

56
00:02:52,440 --> 00:02:57,329
investigation runs so first a client is

57
00:02:55,440 --> 00:02:59,579
going<font color="#E5E5E5"> to call us right and what a client</font>

58
00:02:57,329 --> 00:03:02,159
calls us they're not usually in the best

59
00:02:59,579 --> 00:03:03,930
state of mind right there a<font color="#E5E5E5"> little</font>

60
00:03:02,159 --> 00:03:05,819
worried because something bad happened

61
00:03:03,930 --> 00:03:10,170
and they need answers<font color="#E5E5E5"> to</font><font color="#CCCCCC"> questions</font>

62
00:03:05,819 --> 00:03:12,958
really really quickly so they call us we

63
00:03:10,170 --> 00:03:14,159
hear<font color="#E5E5E5"> what they have to say and if we</font>

64
00:03:12,959 --> 00:03:16,650
make a decision<font color="#E5E5E5"> whether or not we need</font>

65
00:03:14,159 --> 00:03:18,569
<font color="#E5E5E5">to deploy technology specifically</font>

66
00:03:16,650 --> 00:03:21,510
<font color="#E5E5E5">something for the network and then also</font>

67
00:03:18,569 --> 00:03:24,208
something for the endpoint so once we

68
00:03:21,510 --> 00:03:26,310
have our technology deployed we find

69
00:03:24,209 --> 00:03:29,940
evil soft crime right that's our tag

70
00:03:26,310 --> 00:03:33,000
line so it's kind of corny but it's kind

71
00:03:29,940 --> 00:03:37,980
of what we do it's<font color="#E5E5E5"> pretty cool this is a</font>

72
00:03:33,000 --> 00:03:39,359
very cyclical proach where we look for

73
00:03:37,980 --> 00:03:41,340
indicators of compromise we find

74
00:03:39,359 --> 00:03:43,620
something we do analysis on a single

75
00:03:41,340 --> 00:03:45,510
system we find more indicators and then

76
00:03:43,620 --> 00:03:47,459
we restart the whole process and start

77
00:03:45,510 --> 00:03:49,560
scanning the environment for additional

78
00:03:47,459 --> 00:03:51,419
indicators based on what we found we

79
00:03:49,560 --> 00:03:53,849
keep pulling that string until there's

80
00:03:51,419 --> 00:03:56,940
<font color="#CCCCCC">nothing else to</font><font color="#E5E5E5"> find right so once we've</font>

81
00:03:53,849 --> 00:03:59,069
found everything we go into<font color="#E5E5E5"> a radicand</font>

82
00:03:56,940 --> 00:04:00,540
boat and its eradication is basically

83
00:03:59,069 --> 00:04:03,599
let's kick the attacker out of the

84
00:04:00,540 --> 00:04:07,048
environment we<font color="#E5E5E5"> don't want you in</font><font color="#CCCCCC"> here</font>

85
00:04:03,599 --> 00:04:08,940
anymore<font color="#E5E5E5"> you're not invited so after</font><font color="#CCCCCC"> that</font>

86
00:04:07,049 --> 00:04:11,940
we<font color="#E5E5E5"> have post remediation monitoring</font>

87
00:04:08,940 --> 00:04:12,900
where we stay in the environment for a

88
00:04:11,940 --> 00:04:15,090
little bit just<font color="#E5E5E5"> to make</font><font color="#CCCCCC"> sure the</font>

89
00:04:12,900 --> 00:04:17,310
attacker does would take a second hack

90
00:04:15,090 --> 00:04:19,889
at it right we got to make<font color="#CCCCCC"> sure</font><font color="#E5E5E5"> that we</font>

91
00:04:17,310 --> 00:04:22,019
didn't miss anything<font color="#E5E5E5"> and the</font><font color="#CCCCCC"> attacker is</font>

92
00:04:19,889 --> 00:04:25,409
actually out of the environment so after

93
00:04:22,019 --> 00:04:27,600
<font color="#CCCCCC">all that we say</font><font color="#E5E5E5"> goodbye</font><font color="#CCCCCC"> sinauer nice</font>

94
00:04:25,409 --> 00:04:29,969
working with you client

95
00:04:27,600 --> 00:04:32,160
let's move on to<font color="#E5E5E5"> our next engagement and</font>

96
00:04:29,970 --> 00:04:37,110
you've usually lasts anywhere from one

97
00:04:32,160 --> 00:04:39,000
to two months generally so this

98
00:04:37,110 --> 00:04:42,030
investigation started<font color="#CCCCCC"> like any other</font>

99
00:04:39,000 --> 00:04:44,340
<font color="#E5E5E5">client calls us they're like hey we're</font>

100
00:04:42,030 --> 00:04:46,590
seeing some really really weird stuff

101
00:04:44,340 --> 00:04:48,359
there's these really weird service

102
00:04:46,590 --> 00:04:51,419
<font color="#CCCCCC">installs so when you</font><font color="#E5E5E5"> guys look at this</font>

103
00:04:48,360 --> 00:04:52,710
big huge ugly blob of stuff and think if

104
00:04:51,420 --> 00:04:53,820
you see anything weird about this

105
00:04:52,710 --> 00:04:56,669
there's<font color="#CCCCCC"> probably a lot</font><font color="#E5E5E5"> of things</font><font color="#CCCCCC"> you</font>

106
00:04:53,820 --> 00:04:59,880
might be<font color="#E5E5E5"> weird about this right base64</font>

107
00:04:56,670 --> 00:05:02,370
are you doing there so<font color="#E5E5E5"> whoa it's</font>

108
00:04:59,880 --> 00:05:04,380
<font color="#E5E5E5">highlighted so you look at all this and</font>

109
00:05:02,370 --> 00:05:06,870
yes there's a lot of really really weird

110
00:05:04,380 --> 00:05:09,450
things so one of the things when you see

111
00:05:06,870 --> 00:05:11,850
base64 blobs like that<font color="#E5E5E5"> being installed</font>

112
00:05:09,450 --> 00:05:14,670
as a service that's not<font color="#E5E5E5"> to normal that's</font>

113
00:05:11,850 --> 00:05:17,370
not a normal thing that<font color="#E5E5E5"> you'll see in a</font>

114
00:05:14,670 --> 00:05:18,540
client's environment additionally some

115
00:05:17,370 --> 00:05:20,850
of the other<font color="#CCCCCC"> things that</font><font color="#E5E5E5"> you see like</font>

116
00:05:18,540 --> 00:05:23,580
<font color="#CCCCCC">con spec which is just</font><font color="#E5E5E5"> an environment</font>

117
00:05:20,850 --> 00:05:25,770
variable for the command prompt and also

118
00:05:23,580 --> 00:05:28,200
PowerShell executing with execution

119
00:05:25,770 --> 00:05:33,270
policy bypasses it's just some weird

120
00:05:28,200 --> 00:05:36,390
stuff<font color="#E5E5E5"> that's not normal anybody want to</font>

121
00:05:33,270 --> 00:05:40,469
take<font color="#E5E5E5"> a guess which penetration testing</font>

122
00:05:36,390 --> 00:05:42,150
platform<font color="#E5E5E5"> this comes from yeah that's</font>

123
00:05:40,470 --> 00:05:45,900
that's<font color="#E5E5E5"> an interpreter payload that's</font>

124
00:05:42,150 --> 00:05:49,289
<font color="#E5E5E5">exactly it is so like okay this looks a</font>

125
00:05:45,900 --> 00:05:52,140
lot like<font color="#CCCCCC"> metasploit right so let's go</font>

126
00:05:49,290 --> 00:05:53,700
ahead and start sweeping for<font color="#CCCCCC"> metasploit</font>

127
00:05:52,140 --> 00:05:59,250
indicators so it medically has a lot<font color="#CCCCCC"> of</font>

128
00:05:53,700 --> 00:06:02,070
things<font color="#CCCCCC"> that are really easy to detect so</font>

129
00:05:59,250 --> 00:06:04,830
one of the things is a workstation name

130
00:06:02,070 --> 00:06:06,450
that is really really<font color="#E5E5E5"> random and by</font>

131
00:06:04,830 --> 00:06:10,859
random<font color="#CCCCCC"> I mean it's a 16 character</font>

132
00:06:06,450 --> 00:06:12,180
alphanumeric string I'm not<font color="#E5E5E5"> saying it's</font>

133
00:06:10,860 --> 00:06:13,770
not possible to have that in your

134
00:06:12,180 --> 00:06:15,390
environment but<font color="#CCCCCC"> when you do see</font>

135
00:06:13,770 --> 00:06:18,870
something<font color="#CCCCCC"> like that it's pretty</font>

136
00:06:15,390 --> 00:06:21,539
weirdness<font color="#CCCCCC"> to trigger some questions at</font>

137
00:06:18,870 --> 00:06:23,550
the very<font color="#E5E5E5"> least secondly one of the</font>

138
00:06:21,540 --> 00:06:25,830
things we like to do is stack service

139
00:06:23,550 --> 00:06:27,690
was installed event log messages because

140
00:06:25,830 --> 00:06:31,440
not because service being installed is

141
00:06:27,690 --> 00:06:33,780
evil necessarily but back to that power

142
00:06:31,440 --> 00:06:36,419
that that basically for slide we<font color="#CCCCCC"> can</font>

143
00:06:33,780 --> 00:06:38,099
search for all service services being

144
00:06:36,419 --> 00:06:41,070
installed that have those strings in it

145
00:06:38,100 --> 00:06:47,730
and find<font color="#CCCCCC"> the number of systems that</font>

146
00:06:41,070 --> 00:06:49,740
been affected potentially so and

147
00:06:47,730 --> 00:06:51,450
basically investigation is able to be

148
00:06:49,740 --> 00:06:54,510
described really really quickly because

149
00:06:51,450 --> 00:06:58,170
medically has<font color="#CCCCCC"> well-known indicators so</font>

150
00:06:54,510 --> 00:07:01,469
we have 129 systems identified as either

151
00:06:58,170 --> 00:07:04,020
accessed or compromised 116 compromised

152
00:07:01,470 --> 00:07:06,540
accounts we also see our DP sessions the

153
00:07:04,020 --> 00:07:09,510
attacker just<font color="#E5E5E5"> our dps into a couple of</font>

154
00:07:06,540 --> 00:07:11,130
different<font color="#CCCCCC"> systems and looks at passwords</font>

155
00:07:09,510 --> 00:07:13,800
that are just stored in plain text on

156
00:07:11,130 --> 00:07:15,570
<font color="#CCCCCC">users</font><font color="#E5E5E5"> desktop and by that</font><font color="#CCCCCC"> I</font><font color="#E5E5E5"> mean stuff</font>

157
00:07:13,800 --> 00:07:20,310
like password text hanging out on

158
00:07:15,570 --> 00:07:23,400
desktop not a great security practice so

159
00:07:20,310 --> 00:07:25,890
that's what the attacker is after they

160
00:07:23,400 --> 00:07:27,750
stole a bunch of creds and we also were

161
00:07:25,890 --> 00:07:30,750
able to<font color="#E5E5E5"> identify the initial tax vector</font>

162
00:07:27,750 --> 00:07:33,150
and this was just a public-facing web

163
00:07:30,750 --> 00:07:36,030
server that<font color="#CCCCCC"> had some really really</font>

164
00:07:33,150 --> 00:07:38,520
poorly written code on it that allowed

165
00:07:36,030 --> 00:07:45,900
for sequel injection kind of a common

166
00:07:38,520 --> 00:07:51,330
attack vector so<font color="#E5E5E5"> yeah sequel injection</font>

167
00:07:45,900 --> 00:07:54,419
don't think so what they actually used

168
00:07:51,330 --> 00:07:57,630
was XD command shell so once they said

169
00:07:54,420 --> 00:07:59,670
they got single injection on the server

170
00:07:57,630 --> 00:08:01,320
itself and they use XP command shell to

171
00:07:59,670 --> 00:08:02,700
actually move laterally and then start

172
00:08:01,320 --> 00:08:08,849
bringing in there like mature Peter

173
00:08:02,700 --> 00:08:11,070
payloads so c2 first those guys who

174
00:08:08,850 --> 00:08:13,770
don't know c2 is commanding control this

175
00:08:11,070 --> 00:08:17,550
is where the attacker is executing their

176
00:08:13,770 --> 00:08:22,109
commands<font color="#E5E5E5"> from let's look at that base 64</font>

177
00:08:17,550 --> 00:08:28,290
blob again so remember<font color="#CCCCCC"> this base 54 blob</font>

178
00:08:22,110 --> 00:08:30,330
it's got a whole lot<font color="#E5E5E5"> of stuff by the way</font>

179
00:08:28,290 --> 00:08:33,659
fun fact actually debating rather than i

180
00:08:30,330 --> 00:08:35,909
should say this but<font color="#E5E5E5"> i left a little</font>

181
00:08:33,659 --> 00:08:38,098
easter egg in here so<font color="#E5E5E5"> if anybody wants</font>

182
00:08:35,909 --> 00:08:40,770
to take a<font color="#E5E5E5"> picture that and then type all</font>

183
00:08:38,099 --> 00:08:42,960
of<font color="#E5E5E5"> that into a interpreter and decode</font>

184
00:08:40,770 --> 00:08:44,790
what that says it'd be kind of fun but

185
00:08:42,960 --> 00:08:46,110
i'll just tell<font color="#CCCCCC"> you it is because</font>

186
00:08:44,790 --> 00:08:48,920
nobody's going to do that that's crazy

187
00:08:46,110 --> 00:08:48,920
<font color="#CCCCCC">okay</font>

188
00:08:49,880 --> 00:08:59,000
yeah so so basically<font color="#CCCCCC"> for is just</font><font color="#E5E5E5"> the</font>

189
00:08:54,620 --> 00:09:01,640
encoding mechanism that can be used

190
00:08:59,000 --> 00:09:04,880
really by anybody and it<font color="#CCCCCC"> just takes text</font>

191
00:09:01,640 --> 00:09:07,880
data and encodes it using like a through

192
00:09:04,880 --> 00:09:16,939
z and then 0 through actually not nice

193
00:09:07,880 --> 00:09:22,430
<font color="#E5E5E5">to see thank you dr.</font><font color="#CCCCCC"> Reilly thanks for</font>

194
00:09:16,940 --> 00:09:25,640
the rescue needs that so anyways so that

195
00:09:22,430 --> 00:09:27,680
basically for blob can be decoded and

196
00:09:25,640 --> 00:09:30,650
when you decode that you get a pretty

197
00:09:27,680 --> 00:09:33,349
lengthy<font color="#E5E5E5"> PowerShell script and this</font>

198
00:09:30,650 --> 00:09:36,439
<font color="#E5E5E5">PowerShell script has some additional</font>

199
00:09:33,350 --> 00:09:39,350
functions that also have bases before in

200
00:09:36,440 --> 00:09:42,800
it so these basic floor functions can be

201
00:09:39,350 --> 00:09:45,350
decoded and<font color="#E5E5E5"> actually you can actually</font>

202
00:09:42,800 --> 00:09:47,719
see what the configurations are for the

203
00:09:45,350 --> 00:09:50,480
mature pure payload and these

204
00:09:47,720 --> 00:09:54,170
configurations have things like ports

205
00:09:50,480 --> 00:09:56,270
and IP addresses so now we've got an IP

206
00:09:54,170 --> 00:09:59,329
address<font color="#E5E5E5"> so usually what we do when we</font>

207
00:09:56,270 --> 00:10:01,189
have an IP<font color="#CCCCCC"> address is send this to the</font>

208
00:09:59,330 --> 00:10:03,620
client and say they can<font color="#E5E5E5"> make a</font>

209
00:10:01,190 --> 00:10:07,700
risk-based decision basically do they

210
00:10:03,620 --> 00:10:09,500
want<font color="#E5E5E5"> to take this IP and block it that's</font>

211
00:10:07,700 --> 00:10:11,540
one possibility we<font color="#E5E5E5"> don't always</font>

212
00:10:09,500 --> 00:10:13,520
recommend that because we like to get<font color="#E5E5E5"> a</font>

213
00:10:11,540 --> 00:10:17,750
full scope of the environment before we

214
00:10:13,520 --> 00:10:19,220
actually start trying<font color="#E5E5E5"> to you know play</font>

215
00:10:17,750 --> 00:10:20,840
our hand that we know<font color="#E5E5E5"> that they're there</font>

216
00:10:19,220 --> 00:10:25,220
<font color="#E5E5E5">and we know where they're connecting to</font>

217
00:10:20,840 --> 00:10:26,900
but either way if we like to give the

218
00:10:25,220 --> 00:10:28,430
client some indicators at least so they

219
00:10:26,900 --> 00:10:32,270
can at least make some internal alerts

220
00:10:28,430 --> 00:10:33,349
or do what they want with it so we

221
00:10:32,270 --> 00:10:39,260
<font color="#E5E5E5">thought they were just going to block it</font>

222
00:10:33,350 --> 00:10:42,410
that's not what they did so instead they

223
00:10:39,260 --> 00:10:44,840
did they used a free tool sure you for

224
00:10:42,410 --> 00:10:47,810
domain tools they did a little who is on

225
00:10:44,840 --> 00:10:53,030
the IP<font color="#CCCCCC"> address and trace this back to a</font>

226
00:10:47,810 --> 00:10:56,900
actual company and the company was a

227
00:10:53,030 --> 00:10:58,699
small-time competitor<font color="#E5E5E5"> okay so let's all</font>

228
00:10:56,900 --> 00:11:00,290
put our tin foil hats on this is<font color="#E5E5E5"> getting</font>

229
00:10:58,700 --> 00:11:03,350
weird is this<font color="#E5E5E5"> like some kind of crazy</font>

230
00:11:00,290 --> 00:11:04,130
espionage thing going on maybe or<font color="#CCCCCC"> maybe</font>

231
00:11:03,350 --> 00:11:06,920
not maybe it's just a coincidence

232
00:11:04,130 --> 00:11:08,689
actually turns out<font color="#E5E5E5"> that their deal had</font>

233
00:11:06,920 --> 00:11:10,400
<font color="#E5E5E5">our their relationship has been</font>

234
00:11:08,690 --> 00:11:12,710
terminated the week before the attack

235
00:11:10,400 --> 00:11:17,930
<font color="#E5E5E5">had started that's kind of interesting</font>

236
00:11:12,710 --> 00:11:21,800
right ok so the clinically just calls of

237
00:11:17,930 --> 00:11:24,079
this third party and they say<font color="#CCCCCC"> hey you're</font>

238
00:11:21,800 --> 00:11:26,329
attacking us there's a server and it's

239
00:11:24,080 --> 00:11:28,070
attacking us we see the<font color="#E5E5E5"> situ we actually</font>

240
00:11:26,330 --> 00:11:30,380
<font color="#CCCCCC">need you to just provide that server to</font>

241
00:11:28,070 --> 00:11:35,600
us so we<font color="#E5E5E5"> can take a forensic image of it</font>

242
00:11:30,380 --> 00:11:37,280
<font color="#CCCCCC">ok so here's this crazy thing actually</font>

243
00:11:35,600 --> 00:11:39,380
just did that that's what they did<font color="#E5E5E5"> they</font>

244
00:11:37,280 --> 00:11:45,020
<font color="#E5E5E5">just went ahead and provided the entire</font>

245
00:11:39,380 --> 00:11:48,860
physical server to our client no

246
00:11:45,020 --> 00:11:51,110
questions asked like what that's what no

247
00:11:48,860 --> 00:11:54,830
<font color="#E5E5E5">legal ramifications like we're worried</font>

248
00:11:51,110 --> 00:11:56,510
really yes they really<font color="#E5E5E5"> did that so when</font>

249
00:11:54,830 --> 00:11:59,060
we heard<font color="#CCCCCC"> about that we're like you did</font>

250
00:11:56,510 --> 00:12:01,340
what we call up our lawyers or like hey

251
00:11:59,060 --> 00:12:03,890
is this<font color="#CCCCCC"> ok like can we even image this</font>

252
00:12:01,340 --> 00:12:04,910
like<font color="#E5E5E5"> that doesn't that this seems</font>

253
00:12:03,890 --> 00:12:06,560
they're just seems like there's

254
00:12:04,910 --> 00:12:08,810
something shady going on like are we

255
00:12:06,560 --> 00:12:11,900
allowed to<font color="#E5E5E5"> actually do this well turns</font>

256
00:12:08,810 --> 00:12:13,969
out they freely gave it away so yeah

257
00:12:11,900 --> 00:12:15,500
there's no problem so what we did is we

258
00:12:13,970 --> 00:12:18,020
actually took we took a couple of our

259
00:12:15,500 --> 00:12:20,330
guys in the LA office they went<font color="#E5E5E5"> on site</font>

260
00:12:18,020 --> 00:12:22,040
with the client and<font color="#CCCCCC"> a client never left</font>

261
00:12:20,330 --> 00:12:26,390
the room<font color="#E5E5E5"> and they actually image the</font>

262
00:12:22,040 --> 00:12:28,010
entire server cool oh this is at this

263
00:12:26,390 --> 00:12:30,050
point<font color="#E5E5E5"> everybody in our office is like</font>

264
00:12:28,010 --> 00:12:31,850
going crazy we're like I want<font color="#E5E5E5"> to see to</font>

265
00:12:30,050 --> 00:12:34,459
server no I want<font color="#E5E5E5"> to see to server we're</font>

266
00:12:31,850 --> 00:12:37,880
like no I get the<font color="#E5E5E5"> c2 server because I've</font>

267
00:12:34,460 --> 00:12:40,670
been there for a year and a half so so

268
00:12:37,880 --> 00:12:43,880
now i<font color="#E5E5E5"> actually just wander around in</font>

269
00:12:40,670 --> 00:12:46,219
<font color="#E5E5E5">mario kart so it gets to see to see to</font>

270
00:12:43,880 --> 00:12:49,790
server so let's<font color="#E5E5E5"> talk about some of the</font>

271
00:12:46,220 --> 00:12:51,620
challenges that I faced one this which

272
00:12:49,790 --> 00:12:53,780
is a<font color="#CCCCCC"> Windows Server so we</font><font color="#E5E5E5"> start with</font>

273
00:12:51,620 --> 00:12:55,910
just some classic file system analysis

274
00:12:53,780 --> 00:12:58,550
right so what kind of things<font color="#E5E5E5"> are</font>

275
00:12:55,910 --> 00:13:00,230
actually seeing on the disk not a whole

276
00:12:58,550 --> 00:13:03,949
lot<font color="#CCCCCC"> of really really interesting things</font>

277
00:13:00,230 --> 00:13:06,950
some privilege escalation tools some

278
00:13:03,950 --> 00:13:09,770
password dumpers such as<font color="#E5E5E5"> Mimi cats</font>

279
00:13:06,950 --> 00:13:11,630
really common stuff that we're seeing is

280
00:13:09,770 --> 00:13:13,910
like<font color="#E5E5E5"> okay not really that interesting</font>

281
00:13:11,630 --> 00:13:16,160
for a c2 server except<font color="#CCCCCC"> for one crazy</font>

282
00:13:13,910 --> 00:13:17,180
thing they downloaded VMware Workstation

283
00:13:16,160 --> 00:13:18,949
a cali

284
00:13:17,180 --> 00:13:21,680
Linux ISO and then installed a vm and

285
00:13:18,950 --> 00:13:25,280
jhalak 2016 that's really aggressive

286
00:13:21,680 --> 00:13:26,599
that intense you're not worried about

287
00:13:25,280 --> 00:13:28,579
anything are you missed your attacker

288
00:13:26,600 --> 00:13:33,050
just going to go and install<font color="#E5E5E5"> a Kali</font>

289
00:13:28,580 --> 00:13:34,910
Linux ISO no questions asked<font color="#CCCCCC"> okay yes oh</font>

290
00:13:33,050 --> 00:13:37,189
right they actually<font color="#E5E5E5"> created their own</font>

291
00:13:34,910 --> 00:13:43,819
user account as well pretty aggressive

292
00:13:37,190 --> 00:13:47,090
stuff<font color="#E5E5E5"> okay yeah yeah well it gets harder</font>

293
00:13:43,820 --> 00:13:49,070
that part was easy so a little

294
00:13:47,090 --> 00:13:50,210
investigation inception going on this is

295
00:13:49,070 --> 00:13:51,500
where the things this is where the

296
00:13:50,210 --> 00:13:53,630
interesting stuff is going to be right

297
00:13:51,500 --> 00:13:55,370
<font color="#E5E5E5">okay they made a kali linux I so I'm</font>

298
00:13:53,630 --> 00:13:56,780
thinking they're probably using that

299
00:13:55,370 --> 00:13:58,130
exploit we already know they're using

300
00:13:56,780 --> 00:14:00,260
the display<font color="#CCCCCC"> metasploit is going to be</font>

301
00:13:58,130 --> 00:14:02,870
really<font color="#E5E5E5"> interesting hopefully</font><font color="#CCCCCC"> this</font><font color="#E5E5E5"> VM has</font>

302
00:14:00,260 --> 00:14:06,710
a lot of really juicy information right

303
00:14:02,870 --> 00:14:10,280
so export the vm let's repeat our file

304
00:14:06,710 --> 00:14:14,000
system process so start looking for some

305
00:14:10,280 --> 00:14:15,260
sources this is a total gear switch at

306
00:14:14,000 --> 00:14:18,290
this point now we're doing Linux

307
00:14:15,260 --> 00:14:20,960
forensics right so start looking for

308
00:14:18,290 --> 00:14:22,640
artifacts that could help us piece

309
00:14:20,960 --> 00:14:27,800
together what the attacker actually did

310
00:14:22,640 --> 00:14:28,880
to our client so secure access logs not

311
00:14:27,800 --> 00:14:31,849
seeing a whole lot<font color="#E5E5E5"> of really interesting</font>

312
00:14:28,880 --> 00:14:34,100
<font color="#E5E5E5">things there lots of login attempts but</font>

313
00:14:31,850 --> 00:14:35,750
it's actually<font color="#E5E5E5"> public facing so they're</font>

314
00:14:34,100 --> 00:14:38,210
getting scanned all the time kind of

315
00:14:35,750 --> 00:14:41,810
makes sense not that interesting on the

316
00:14:38,210 --> 00:14:43,190
trip or configuration file some things

317
00:14:41,810 --> 00:14:45,109
that were already<font color="#E5E5E5"> installed by default</font>

318
00:14:43,190 --> 00:14:49,040
that<font color="#E5E5E5"> we could tell the attacker executed</font>

319
00:14:45,110 --> 00:14:51,350
like thief and sequel map keyword

320
00:14:49,040 --> 00:14:54,290
searches interesting once again we're

321
00:14:51,350 --> 00:14:55,760
seeing a lot<font color="#CCCCCC"> of things</font><font color="#E5E5E5"> that we're seeing</font>

322
00:14:54,290 --> 00:14:58,130
a lot<font color="#CCCCCC"> of</font><font color="#E5E5E5"> things</font><font color="#CCCCCC"> that the attacker that</font>

323
00:14:55,760 --> 00:15:02,210
<font color="#CCCCCC">we are already identified during the</font>

324
00:14:58,130 --> 00:15:05,090
course of<font color="#E5E5E5"> our investigation bash history</font>

325
00:15:02,210 --> 00:15:07,100
not<font color="#E5E5E5"> that interesting except for</font><font color="#CCCCCC"> postgres</font>

326
00:15:05,090 --> 00:15:10,370
past history<font color="#E5E5E5"> I had some interesting</font>

327
00:15:07,100 --> 00:15:11,900
stuff in<font color="#E5E5E5"> it so we</font><font color="#CCCCCC"> all returning so</font>

328
00:15:10,370 --> 00:15:15,440
<font color="#CCCCCC">postgres tells us a little bit of a</font>

329
00:15:11,900 --> 00:15:18,260
story we can tell that the attacker was

330
00:15:15,440 --> 00:15:19,700
using the Postgres database and we know

331
00:15:18,260 --> 00:15:20,870
that they were also<font color="#E5E5E5"> using</font><font color="#CCCCCC"> metasploit</font>

332
00:15:19,700 --> 00:15:25,280
because we see<font color="#E5E5E5"> the mature</font><font color="#CCCCCC"> /</font>

333
00:15:20,870 --> 00:15:26,990
configuration file so so we'll<font color="#E5E5E5"> turning</font>

334
00:15:25,280 --> 00:15:29,390
the wheels well maybe they're actually

335
00:15:26,990 --> 00:15:31,209
<font color="#CCCCCC">just storing all the data from their</font>

336
00:15:29,390 --> 00:15:32,920
attack and then in the post

337
00:15:31,209 --> 00:15:34,300
database which<font color="#CCCCCC"> is actually something</font>

338
00:15:32,920 --> 00:15:36,219
that medically it actually encourages

339
00:15:34,300 --> 00:15:38,109
right because attackers are people too

340
00:15:36,220 --> 00:15:39,670
they have to remember things right and

341
00:15:38,110 --> 00:15:41,050
they're not<font color="#CCCCCC"> going to</font><font color="#E5E5E5"> just remember in</font>

342
00:15:39,670 --> 00:15:45,339
their head put<font color="#E5E5E5"> it in a post ghost</font>

343
00:15:41,050 --> 00:15:47,649
database<font color="#E5E5E5"> okay so let me just you know</font>

344
00:15:45,339 --> 00:15:49,119
export<font color="#CCCCCC"> postgres DB and put it in my</font>

345
00:15:47,649 --> 00:15:52,389
<font color="#CCCCCC">postgres viewer and just export</font>

346
00:15:49,119 --> 00:15:54,610
everything and done right well not<font color="#CCCCCC"> quite</font>

347
00:15:52,389 --> 00:15:57,459
actually<font color="#CCCCCC"> postgres is pretty ugly to deal</font>

348
00:15:54,610 --> 00:16:01,240
with so<font color="#E5E5E5"> postgres stores everything</font>

349
00:15:57,459 --> 00:16:03,368
across hundreds of binary files and

350
00:16:01,240 --> 00:16:11,199
there isn't a publicly available parser

351
00:16:03,369 --> 00:16:13,749
for it so what do we do well it's a vmdk

352
00:16:11,199 --> 00:16:17,199
the attacker<font color="#E5E5E5"> uses the mo workstation</font><font color="#CCCCCC"> i</font>

353
00:16:13,749 --> 00:16:19,119
can use<font color="#E5E5E5"> vmware workstation right so when</font>

354
00:16:17,199 --> 00:16:22,059
we just go ahead and boot this<font color="#CCCCCC"> vmdk up</font>

355
00:16:19,119 --> 00:16:23,980
Sharon todd has a password on it<font color="#E5E5E5"> okay</font>

356
00:16:22,059 --> 00:16:26,499
well<font color="#E5E5E5"> couple google searches of later and</font>

357
00:16:23,980 --> 00:16:28,329
talking with<font color="#E5E5E5"> some of our proactive guys</font>

358
00:16:26,499 --> 00:16:31,660
well it's actually<font color="#CCCCCC"> pretty easy to just</font>

359
00:16:28,329 --> 00:16:37,689
bypass that you can actually<font color="#CCCCCC"> just modify</font>

360
00:16:31,660 --> 00:16:42,040
grub ask it to end it ask it to execute

361
00:16:37,689 --> 00:16:55,240
bash on startup and then you terminal

362
00:16:42,040 --> 00:17:05,559
and then ah sozin those an image so

363
00:16:55,240 --> 00:17:07,720
right i guess but you could also have

364
00:17:05,559 --> 00:17:10,240
just executed so what I did is just

365
00:17:07,720 --> 00:17:13,360
execute past us 4wd or whatever and

366
00:17:10,240 --> 00:17:16,299
change the password and now I have

367
00:17:13,359 --> 00:17:17,469
created<font color="#E5E5E5"> a password</font><font color="#CCCCCC"> route or actually</font>

368
00:17:16,299 --> 00:17:20,260
change the password for<font color="#E5E5E5"> the root account</font>

369
00:17:17,470 --> 00:17:22,120
and well I know what Callie uses by

370
00:17:20,260 --> 00:17:23,919
default<font color="#E5E5E5"> that's a tour so it's like</font>

371
00:17:22,119 --> 00:17:26,708
<font color="#CCCCCC">hounds it's gonna changes the tour so</font>

372
00:17:23,919 --> 00:17:29,710
change<font color="#E5E5E5"> the password and now we're in</font>

373
00:17:26,709 --> 00:17:33,250
we're into the system now so I'm like<font color="#E5E5E5"> oh</font>

374
00:17:29,710 --> 00:17:36,580
my<font color="#E5E5E5"> god I'm the hacker now yes this is a</font>

375
00:17:33,250 --> 00:17:39,429
lot<font color="#CCCCCC"> more exciting than my usual you know</font>

376
00:17:36,580 --> 00:17:42,850
spreadsheets<font color="#E5E5E5"> X Excel spreadsheets is</font>

377
00:17:39,429 --> 00:17:44,650
where I live

378
00:17:42,850 --> 00:17:47,230
but all<font color="#CCCCCC"> the sudden</font><font color="#E5E5E5"> I'm like</font><font color="#CCCCCC"> at a bash</font>

379
00:17:44,650 --> 00:17:50,140
terminal and just like hanging out and

380
00:17:47,230 --> 00:17:52,600
mature in<font color="#CCCCCC"> metasploit and just accessing</font>

381
00:17:50,140 --> 00:17:57,970
post-credits databases this feels pretty

382
00:17:52,600 --> 00:17:59,678
cool and kind of badass like okay so the

383
00:17:57,970 --> 00:18:02,410
postcards database or the postgres

384
00:17:59,679 --> 00:18:03,940
history file had the name of the

385
00:18:02,410 --> 00:18:07,539
database and the username<font color="#CCCCCC"> and password</font>

386
00:18:03,940 --> 00:18:12,520
and it<font color="#E5E5E5"> was super super complicated msf</font>

387
00:18:07,539 --> 00:18:14,410
<font color="#E5E5E5">okay for all three of them great so you</font>

388
00:18:12,520 --> 00:18:18,010
can just<font color="#CCCCCC"> use</font><font color="#E5E5E5"> metasploit to directly</font>

389
00:18:14,410 --> 00:18:21,370
interface with the Postgres database so

390
00:18:18,010 --> 00:18:23,500
boot up<font color="#E5E5E5"> MSF console connect to the</font>

391
00:18:21,370 --> 00:18:25,840
database and<font color="#E5E5E5"> I have a whole</font><font color="#CCCCCC"> bunch of</font>

392
00:18:23,500 --> 00:18:29,530
<font color="#E5E5E5">commands I can execute it can just look</font>

393
00:18:25,840 --> 00:18:31,120
at the creds host<font color="#CCCCCC"> lutz node services all</font>

394
00:18:29,530 --> 00:18:33,460
just giving me a lot of really good

395
00:18:31,120 --> 00:18:38,408
information about what the attacker had

396
00:18:33,460 --> 00:18:40,360
done and the environment so that was

397
00:18:38,409 --> 00:18:42,400
really cool but here's the problem<font color="#E5E5E5"> I</font>

398
00:18:40,360 --> 00:18:43,629
didn't<font color="#E5E5E5"> have any time fans associated</font>

399
00:18:42,400 --> 00:18:45,820
with that and one<font color="#E5E5E5"> of the things we like</font>

400
00:18:43,630 --> 00:18:48,100
<font color="#CCCCCC">to provide as a deliverable is a really</font>

401
00:18:45,820 --> 00:18:49,210
nice time line right so if you<font color="#E5E5E5"> don't</font>

402
00:18:48,100 --> 00:18:51,520
have time stamps you can't make<font color="#E5E5E5"> a</font>

403
00:18:49,210 --> 00:18:52,929
timeline so we could provide is here's

404
00:18:51,520 --> 00:18:55,179
all the credentials that were affected

405
00:18:52,929 --> 00:18:57,190
definitively here's all the systems that

406
00:18:55,179 --> 00:19:00,130
were accessed definitively this is

407
00:18:57,190 --> 00:19:02,950
really<font color="#E5E5E5"> good stuff but still not</font>

408
00:19:00,130 --> 00:19:04,690
answering the question<font color="#CCCCCC"> of did we detect</font>

409
00:19:02,950 --> 00:19:09,309
everything they actually did in the

410
00:19:04,690 --> 00:19:11,740
environment okay so why not just bypass

411
00:19:09,309 --> 00:19:14,470
<font color="#CCCCCC">metasploit like just interact with the</font>

412
00:19:11,740 --> 00:19:19,480
database directly so use P sequel and

413
00:19:14,470 --> 00:19:23,080
connect to the database tons<font color="#E5E5E5"> and tons of</font>

414
00:19:19,480 --> 00:19:25,299
tables lots of<font color="#E5E5E5"> tables so the</font><font color="#CCCCCC"> ones</font><font color="#E5E5E5"> most</font>

415
00:19:23,080 --> 00:19:29,770
important is medically credential ones

416
00:19:25,299 --> 00:19:31,210
tell us everything<font color="#CCCCCC"> that hacker they tell</font>

417
00:19:29,770 --> 00:19:34,270
us everything<font color="#E5E5E5"> that the attacker actually</font>

418
00:19:31,210 --> 00:19:39,610
obtained as farce credentials and

419
00:19:34,270 --> 00:19:41,408
additional data such as the session

420
00:19:39,610 --> 00:19:44,979
events which is like full mature

421
00:19:41,409 --> 00:19:48,400
processions just pretty crazy so there's

422
00:19:44,980 --> 00:19:51,940
some this<font color="#CCCCCC"> is like real data to I use a</font>

423
00:19:48,400 --> 00:19:54,730
hypergate a tool two types of data it's

424
00:19:51,940 --> 00:19:57,640
a Microsoft Paint

425
00:19:54,730 --> 00:20:00,309
select but totally real data from the

426
00:19:57,640 --> 00:20:02,650
actual Postgres database this is a

427
00:20:00,309 --> 00:20:06,250
<font color="#E5E5E5">medical credentials table this is the</font>

428
00:20:02,650 --> 00:20:09,820
realms table which tells you certain

429
00:20:06,250 --> 00:20:11,679
domains that were numerated as well as

430
00:20:09,820 --> 00:20:15,700
the<font color="#E5E5E5"> time stamps you can see and then</font>

431
00:20:11,679 --> 00:20:18,460
this<font color="#E5E5E5"> logins table which gives you</font>

432
00:20:15,700 --> 00:20:21,580
information as far<font color="#E5E5E5"> as which credentials</font>

433
00:20:18,460 --> 00:20:23,740
they<font color="#E5E5E5"> use and then or they attempted to</font>

434
00:20:21,580 --> 00:20:25,960
use or which ones they didn't use or

435
00:20:23,740 --> 00:20:27,340
totally untried last time they attempted

436
00:20:25,960 --> 00:20:29,230
to use it whether<font color="#E5E5E5"> or not they're</font>

437
00:20:27,340 --> 00:20:31,178
successful or not a really really

438
00:20:29,230 --> 00:20:33,970
granular data this<font color="#CCCCCC"> is pretty awesome</font>

439
00:20:31,179 --> 00:20:36,490
this is the mature processions<font color="#E5E5E5"> I was</font>

440
00:20:33,970 --> 00:20:39,460
talking about<font color="#CCCCCC"> so</font><font color="#E5E5E5"> it's pretty amazing</font>

441
00:20:36,490 --> 00:20:42,580
that<font color="#CCCCCC"> postgres is storing entire mature</font>

442
00:20:39,460 --> 00:20:45,549
processions in the database so what this

443
00:20:42,580 --> 00:20:47,980
means is that once you have<font color="#CCCCCC"> your pwned a</font>

444
00:20:45,549 --> 00:20:50,200
box and you're executing different

445
00:20:47,980 --> 00:20:52,270
modules and<font color="#E5E5E5"> metasploit it's storing all</font>

446
00:20:50,200 --> 00:20:54,640
of this including the actual modules

447
00:20:52,270 --> 00:20:58,660
that are being used<font color="#E5E5E5"> and the payloads</font>

448
00:20:54,640 --> 00:21:00,490
that were being delivered<font color="#E5E5E5"> and the post</font>

449
00:20:58,660 --> 00:21:02,710
exploitation<font color="#CCCCCC"> modules like you can say at</font>

450
00:21:00,490 --> 00:21:06,220
the bottom like post windows gather you

451
00:21:02,710 --> 00:21:10,540
know admins just really really granular

452
00:21:06,220 --> 00:21:15,730
data this<font color="#CCCCCC"> is pretty</font><font color="#E5E5E5"> awesome so</font>

453
00:21:10,540 --> 00:21:18,220
<font color="#CCCCCC">post-crash tables have a lot of really</font>

454
00:21:15,730 --> 00:21:19,990
granular data so now<font color="#CCCCCC"> I can</font><font color="#E5E5E5"> build an</font>

455
00:21:18,220 --> 00:21:22,030
actual timeline so we got time stamping

456
00:21:19,990 --> 00:21:24,370
our credentials total<font color="#E5E5E5"> in both mature</font>

457
00:21:22,030 --> 00:21:28,000
processions<font color="#E5E5E5"> I'm considering this victory</font>

458
00:21:24,370 --> 00:21:29,918
feeling pretty good so this<font color="#CCCCCC"> is at the</font>

459
00:21:28,000 --> 00:21:32,980
point where basically we can provide the

460
00:21:29,919 --> 00:21:36,549
<font color="#E5E5E5">client a really nice deliverable entire</font>

461
00:21:32,980 --> 00:21:40,120
and<font color="#CCCCCC"> composting product as</font><font color="#E5E5E5"> what happened</font>

462
00:21:36,549 --> 00:21:43,418
during the attack so we have all<font color="#E5E5E5"> the</font>

463
00:21:40,120 --> 00:21:45,520
systems that were moved to all the

464
00:21:43,419 --> 00:21:48,010
credentials that were taken every file

465
00:21:45,520 --> 00:21:50,049
they access every command they executed

466
00:21:48,010 --> 00:21:54,340
this isn't this is really really good

467
00:21:50,049 --> 00:21:56,658
stuff so I'm pretty happy so happy fine

468
00:21:54,340 --> 00:22:04,970
happy consultant

469
00:21:56,659 --> 00:22:06,529
but as you guys saw before there's some

470
00:22:04,970 --> 00:22:11,210
previous databases that were dropped

471
00:22:06,529 --> 00:22:15,109
right the attacker also installed this

472
00:22:11,210 --> 00:22:18,529
<font color="#E5E5E5">VM and July of 2016 the</font><font color="#CCCCCC"> attack didn't</font>

473
00:22:15,109 --> 00:22:21,499
started to September of 2016 so what was

474
00:22:18,529 --> 00:22:23,389
going on for<font color="#CCCCCC"> this prior two months I'm</font>

475
00:22:21,499 --> 00:22:24,710
pretty curious about this I'm sure you

476
00:22:23,389 --> 00:22:26,508
guys are curious I can tell by your

477
00:22:24,710 --> 00:22:27,979
expressions that you're<font color="#E5E5E5"> crazy curious</font>

478
00:22:26,509 --> 00:22:32,960
about this so I'm going<font color="#CCCCCC"> to</font><font color="#E5E5E5"> go into</font>

479
00:22:27,979 --> 00:22:35,869
detail about it so based on the<font color="#CCCCCC"> postgres</font>

480
00:22:32,960 --> 00:22:38,029
<font color="#E5E5E5">command history we know that there is</font>

481
00:22:35,869 --> 00:22:42,139
extra tables right they had dropped at

482
00:22:38,029 --> 00:22:43,909
least two previous tables so<font color="#E5E5E5"> I'm not</font>

483
00:22:42,139 --> 00:22:45,559
<font color="#CCCCCC">really sure how you're supposed</font><font color="#E5E5E5"> to</font>

484
00:22:43,909 --> 00:22:47,090
recover this I did a bunch of keyword

485
00:22:45,559 --> 00:22:48,859
searches and they all showed up in an

486
00:22:47,090 --> 00:22:50,809
allocated space but an allocated space

487
00:22:48,859 --> 00:22:54,049
does not make for a real nice

488
00:22:50,809 --> 00:22:57,529
deliverable you like it's all

489
00:22:54,049 --> 00:22:59,720
unstructured it's not easy to make sense

490
00:22:57,529 --> 00:23:01,879
of<font color="#E5E5E5"> and once again post</font><font color="#CCCCCC"> coast roads are</font>

491
00:22:59,720 --> 00:23:05,539
stored<font color="#E5E5E5"> in</font><font color="#CCCCCC"> a totally binary format we</font>

492
00:23:01,879 --> 00:23:09,139
have to parse it so I used the Google

493
00:23:05,539 --> 00:23:11,539
science machine and asked Google how do

494
00:23:09,139 --> 00:23:13,309
i recover deleted postcodes database not

495
00:23:11,539 --> 00:23:17,029
awful lot on this but it did the enemy

496
00:23:13,309 --> 00:23:19,999
to a professor alexander<font color="#CCCCCC"> rason he's a</font>

497
00:23:17,029 --> 00:23:21,409
professor of computer security at DePaul

498
00:23:19,999 --> 00:23:23,299
and he was<font color="#CCCCCC"> actually really really</font>

499
00:23:21,409 --> 00:23:26,809
<font color="#E5E5E5">helpful him in a doctoral student or</font>

500
00:23:23,299 --> 00:23:29,210
working on a tool called dice<font color="#CCCCCC"> and that's</font>

501
00:23:26,809 --> 00:23:31,639
database image content explorer and

502
00:23:29,210 --> 00:23:35,419
basically it's a<font color="#E5E5E5"> Python library for</font>

503
00:23:31,639 --> 00:23:39,529
recovering rose from a basically<font color="#E5E5E5"> you</font>

504
00:23:35,419 --> 00:23:42,799
just provided an image and there we go

505
00:23:39,529 --> 00:23:45,109
<font color="#E5E5E5">and provided an image and it will</font>

506
00:23:42,799 --> 00:23:48,499
recover rose from all sorts of<font color="#CCCCCC"> DVA</font>

507
00:23:45,109 --> 00:23:50,928
messes so my sequel<font color="#CCCCCC"> postgres sequel</font>

508
00:23:48,499 --> 00:23:54,649
light sequel server so reach out to them

509
00:23:50,929 --> 00:23:55,909
it's<font color="#E5E5E5"> not a public pool yet but that's</font>

510
00:23:54,649 --> 00:24:00,129
<font color="#E5E5E5">just because it's still on development</font>

511
00:23:55,909 --> 00:24:03,160
but he gave me a prototype so

512
00:24:00,130 --> 00:24:05,830
I ran it and I got a bunch of data from

513
00:24:03,160 --> 00:24:08,260
it this is really cool<font color="#E5E5E5"> I got accounts</font><font color="#CCCCCC"> on</font>

514
00:24:05,830 --> 00:24:10,270
domains that weren't previous available

515
00:24:08,260 --> 00:24:13,960
previously available from the post gross

516
00:24:10,270 --> 00:24:17,350
databases so this is<font color="#CCCCCC"> cool I know</font><font color="#E5E5E5"> that I</font>

517
00:24:13,960 --> 00:24:19,150
was actually<font color="#E5E5E5"> getting data but it</font><font color="#CCCCCC"> also</font>

518
00:24:17,350 --> 00:24:21,459
wasn't parsing time since correctly and

519
00:24:19,150 --> 00:24:25,990
I knew<font color="#CCCCCC"> that you could</font><font color="#E5E5E5"> get extra data</font>

520
00:24:21,460 --> 00:24:28,450
like session data and other other tables

521
00:24:25,990 --> 00:24:34,060
that were available<font color="#CCCCCC"> to solve them know</font>

522
00:24:28,450 --> 00:24:35,860
they exist so what do I do well this is

523
00:24:34,060 --> 00:24:39,940
<font color="#E5E5E5">where I become a Python habias again and</font>

524
00:24:35,860 --> 00:24:45,399
go into<font color="#E5E5E5"> the rabbit hole of</font><font color="#CCCCCC"> postgres so</font>

525
00:24:39,940 --> 00:24:49,570
post-crisis open source so I reading a-c

526
00:24:45,400 --> 00:24:52,690
source code for<font color="#CCCCCC"> postgres but</font><font color="#E5E5E5"> I see</font>

527
00:24:49,570 --> 00:24:54,310
genius so it took<font color="#CCCCCC"> me a while there's a</font>

528
00:24:52,690 --> 00:24:55,780
<font color="#CCCCCC">lot of structures and see that I didn't</font>

529
00:24:54,310 --> 00:24:57,550
just totally understand so it took me

530
00:24:55,780 --> 00:25:00,070
<font color="#E5E5E5">some time but it was a great</font><font color="#CCCCCC"> learning</font>

531
00:24:57,550 --> 00:25:01,930
experience I was like pinging guys like

532
00:25:00,070 --> 00:25:03,909
all the time like hey what is this<font color="#E5E5E5"> Union</font>

533
00:25:01,930 --> 00:25:07,810
struct thing I don't know what<font color="#CCCCCC"> that</font>

534
00:25:03,910 --> 00:25:10,060
means like help and they were really

535
00:25:07,810 --> 00:25:13,929
<font color="#E5E5E5">helpful and was able to actually make a</font>

536
00:25:10,060 --> 00:25:17,230
postgres parser to carve out all rows

537
00:25:13,930 --> 00:25:20,530
from a flat flat binary file or a raw

538
00:25:17,230 --> 00:25:23,500
image so a little bit into that so

539
00:25:20,530 --> 00:25:24,730
<font color="#E5E5E5">postgres has a bit of a structure so</font>

540
00:25:23,500 --> 00:25:28,180
it's<font color="#E5E5E5"> not a header that you can actually</font>

541
00:25:24,730 --> 00:25:31,810
you know just search for<font color="#CCCCCC"> these five</font>

542
00:25:28,180 --> 00:25:33,790
bytes and you gotta post go stable but

543
00:25:31,810 --> 00:25:36,040
it does have a 24 bite header that you

544
00:25:33,790 --> 00:25:37,570
can thats toward certain pieces of

545
00:25:36,040 --> 00:25:41,710
information that you<font color="#CCCCCC"> can use kind of as</font>

546
00:25:37,570 --> 00:25:44,770
an entropy check so basically what my

547
00:25:41,710 --> 00:25:47,920
tool does is look for this PostScript

548
00:25:44,770 --> 00:25:50,290
header and then it parses the road

549
00:25:47,920 --> 00:25:52,090
pointers which follow that these are

550
00:25:50,290 --> 00:25:53,830
four bytes structures and they contain

551
00:25:52,090 --> 00:25:55,899
really important information like the

552
00:25:53,830 --> 00:25:58,570
offset that it's located<font color="#E5E5E5"> at offset</font>

553
00:25:55,900 --> 00:26:02,590
that's a row data is located at as well

554
00:25:58,570 --> 00:26:05,470
<font color="#E5E5E5">as the size of the row so now i have a</font>

555
00:26:02,590 --> 00:26:06,850
photo stable<font color="#E5E5E5"> i have a bunch of rows I</font>

556
00:26:05,470 --> 00:26:10,480
know how big they are I know where

557
00:26:06,850 --> 00:26:12,719
they're located so now I can<font color="#CCCCCC"> look at</font>

558
00:26:10,480 --> 00:26:15,450
actually parsing the row itself so

559
00:26:12,720 --> 00:26:19,559
so these rows have structure as<font color="#CCCCCC"> well</font>

560
00:26:15,450 --> 00:26:24,659
that you have to use to figure out how

561
00:26:19,559 --> 00:26:26,610
long certain fields are in<font color="#E5E5E5"> these in</font>

562
00:26:24,659 --> 00:26:32,039
these in these rows which is pretty

563
00:26:26,610 --> 00:26:35,580
challenging so at the end<font color="#E5E5E5"> of all that</font>

564
00:26:32,039 --> 00:26:39,840
what<font color="#E5E5E5"> I have is a parser that will read a</font>

565
00:26:35,580 --> 00:26:42,210
header read the rows and then also parse

566
00:26:39,840 --> 00:26:46,559
those rows based on the sizes of the the

567
00:26:42,210 --> 00:26:48,090
data that's being read so this is<font color="#E5E5E5"> this</font>

568
00:26:46,559 --> 00:26:49,770
basically<font color="#E5E5E5"> what you have after that is</font>

569
00:26:48,090 --> 00:26:53,459
something<font color="#E5E5E5"> that you can output based on</font>

570
00:26:49,770 --> 00:26:56,400
the roast schema and what it does is

571
00:26:53,460 --> 00:27:00,150
<font color="#CCCCCC">recover all these deleted</font><font color="#E5E5E5"> entry are not</font>

572
00:26:56,400 --> 00:27:05,700
deleted in trees just blankly looking

573
00:27:00,150 --> 00:27:07,470
for postgres rose so there<font color="#CCCCCC"> is still</font>

574
00:27:05,700 --> 00:27:11,610
research going on going<font color="#E5E5E5"> to</font><font color="#CCCCCC"> identify the</font>

575
00:27:07,470 --> 00:27:12,990
<font color="#E5E5E5">number of affected victims for this at</font>

576
00:27:11,610 --> 00:27:15,840
<font color="#CCCCCC">least three victims based on the data</font>

577
00:27:12,990 --> 00:27:17,220
<font color="#E5E5E5">that was recovered but it was awesome</font><font color="#CCCCCC"> to</font>

578
00:27:15,840 --> 00:27:20,399
be able to see<font color="#E5E5E5"> that yeah there was</font>

579
00:27:17,220 --> 00:27:21,900
definitely other campaigns going on

580
00:27:20,400 --> 00:27:27,240
<font color="#E5E5E5">besides the campaign that was going on</font>

581
00:27:21,900 --> 00:27:31,380
on<font color="#CCCCCC"> our client so lastly some attacker</font>

582
00:27:27,240 --> 00:27:34,590
insights right who's<font color="#E5E5E5"> that guy</font><font color="#CCCCCC"> OOP so</font>

583
00:27:31,380 --> 00:27:35,789
medically gets a job done so one of the

584
00:27:34,590 --> 00:27:37,080
things the client actually asked up is

585
00:27:35,789 --> 00:27:39,120
like do you guys do you<font color="#CCCCCC"> think</font><font color="#E5E5E5"> this</font>

586
00:27:37,080 --> 00:27:40,770
attacker is sophisticated and so when I

587
00:27:39,120 --> 00:27:43,678
see<font color="#E5E5E5"> metasploit I don't typically find</font>

588
00:27:40,770 --> 00:27:46,470
that to be a<font color="#E5E5E5"> platform that sophisticated</font>

589
00:27:43,679 --> 00:27:51,179
attackers use however<font color="#E5E5E5"> it gets the job</font>

590
00:27:46,470 --> 00:27:54,210
done right an attacker that<font color="#CCCCCC"> knows how to</font>

591
00:27:51,179 --> 00:27:57,299
use this tool<font color="#CCCCCC"> roots and can exploit</font>

592
00:27:54,210 --> 00:28:00,480
security<font color="#CCCCCC"> falls that should be patched</font>

593
00:27:57,299 --> 00:28:02,580
you know back in like twenty ten can use

594
00:28:00,480 --> 00:28:06,929
<font color="#CCCCCC">metasploit and accomplish their goals</font>

595
00:28:02,580 --> 00:28:08,730
really really effectively additionally

596
00:28:06,929 --> 00:28:10,950
attackers aren't that concerned about

597
00:28:08,730 --> 00:28:12,270
<font color="#E5E5E5">being caught at least some of them once</font>

598
00:28:10,950 --> 00:28:15,090
again<font color="#CCCCCC"> I think</font><font color="#E5E5E5"> it was really really</font>

599
00:28:12,270 --> 00:28:17,158
aggressive to just take control of this

600
00:28:15,090 --> 00:28:19,649
<font color="#E5E5E5">windows server and then download you</font>

601
00:28:17,159 --> 00:28:21,600
download programs like<font color="#CCCCCC"> windows or like</font>

602
00:28:19,650 --> 00:28:24,360
VMware Workstation and a Kali Linux ISO

603
00:28:21,600 --> 00:28:26,370
and then just use<font color="#CCCCCC"> that as a vehicle to</font>

604
00:28:24,360 --> 00:28:29,250
attack other clients

605
00:28:26,370 --> 00:28:31,949
like it just<font color="#CCCCCC"> it seemed really aggressive</font>

606
00:28:29,250 --> 00:28:34,440
and<font color="#CCCCCC"> they didn't</font><font color="#E5E5E5"> take any precautions to</font>

607
00:28:31,950 --> 00:28:36,240
cover up their data right and lastly

608
00:28:34,440 --> 00:28:38,100
well the Tigers like humans and they

609
00:28:36,240 --> 00:28:40,650
made<font color="#E5E5E5"> Kenan mistakes they had a password</font>

610
00:28:38,100 --> 00:28:42,780
on their vm but then they used<font color="#CCCCCC"> msf as</font>

611
00:28:40,650 --> 00:28:44,460
their password for Postgres database had

612
00:28:42,780 --> 00:28:46,800
<font color="#E5E5E5">there</font><font color="#CCCCCC"> been you know some kind of</font>

613
00:28:44,460 --> 00:28:49,260
password protection on those databases

614
00:28:46,800 --> 00:28:50,610
are on the<font color="#CCCCCC"> post office database that</font>

615
00:28:49,260 --> 00:28:52,500
would have<font color="#E5E5E5"> been a</font><font color="#CCCCCC"> lot</font><font color="#E5E5E5"> harder to recover</font>

616
00:28:50,610 --> 00:28:55,350
any kind of data and it would have been

617
00:28:52,500 --> 00:28:56,520
a challenge to say the least and it

618
00:28:55,350 --> 00:29:02,699
might<font color="#E5E5E5"> have a railroad a lot of this</font>

619
00:28:56,520 --> 00:29:13,350
progress so<font color="#CCCCCC"> that is</font><font color="#E5E5E5"> it any questions ah</font>

620
00:29:02,700 --> 00:29:15,360
so so back to<font color="#CCCCCC"> the fact that they act</font>

621
00:29:13,350 --> 00:29:19,080
that the client actually reached out to

622
00:29:15,360 --> 00:29:21,510
the third<font color="#CCCCCC"> party and got the image or got</font>

623
00:29:19,080 --> 00:29:24,720
the physical server from them it

624
00:29:21,510 --> 00:29:29,280
actually makes notification really dicey

625
00:29:24,720 --> 00:29:32,550
because that image has proprietary data

626
00:29:29,280 --> 00:29:35,370
from the third party so we actually<font color="#E5E5E5"> have</font>

627
00:29:32,550 --> 00:29:36,899
to<font color="#E5E5E5"> have their permission to notify other</font>

628
00:29:35,370 --> 00:29:40,229
victims that we identified in the

629
00:29:36,900 --> 00:29:42,210
analysis because it's<font color="#E5E5E5"> not our clients</font>

630
00:29:40,230 --> 00:29:46,470
data it's actually that's third parties

631
00:29:42,210 --> 00:29:56,130
data so the legal use of that is mmm

632
00:29:46,470 --> 00:29:59,700
dicey to leave so yes yes no I think

633
00:29:56,130 --> 00:30:01,950
<font color="#CCCCCC">that's actually a metasploit something</font>

634
00:29:59,700 --> 00:30:04,740
medically yeah metasploit framework yeah

635
00:30:01,950 --> 00:30:07,559
so it's actually yeah<font color="#CCCCCC"> no it's I actually</font>

636
00:30:04,740 --> 00:30:09,270
think<font color="#E5E5E5"> it's a default password for using</font>

637
00:30:07,559 --> 00:30:18,090
the postgis database yeah so it's kind

638
00:30:09,270 --> 00:30:19,889
of goofy yeah so you know it depends on

639
00:30:18,090 --> 00:30:21,389
the groups that we're seeing so a lot of

640
00:30:19,890 --> 00:30:23,640
the financial groups that we track

641
00:30:21,390 --> 00:30:26,220
actually<font color="#E5E5E5"> do rely on readily pretty</font>

642
00:30:23,640 --> 00:30:27,600
heavily and I<font color="#E5E5E5"> think the main reason for</font>

643
00:30:26,220 --> 00:30:30,660
that is because Metis we provides a

644
00:30:27,600 --> 00:30:33,419
really nice vehicle for distributing<font color="#CCCCCC"> or</font>

645
00:30:30,660 --> 00:30:35,460
quickly<font color="#E5E5E5"> moving throughout an environment</font>

646
00:30:33,420 --> 00:30:37,050
it just has it all built in for it it's

647
00:30:35,460 --> 00:30:38,880
<font color="#E5E5E5">just easy to do like lateral movement</font>

648
00:30:37,050 --> 00:30:39,710
using it and it provides a nice

649
00:30:38,880 --> 00:30:42,320
framework

650
00:30:39,710 --> 00:30:45,770
you don't make<font color="#CCCCCC"> any custom backdoors it's</font>

651
00:30:42,320 --> 00:30:49,850
easy and effective for all the apt

652
00:30:45,770 --> 00:30:51,408
groups whose very sophisticated malware

653
00:30:49,850 --> 00:31:06,709
right<font color="#CCCCCC"> that they has actually developed</font>

654
00:30:51,409 --> 00:31:10,850
ourselves yeah I didn't see anything

655
00:31:06,710 --> 00:31:12,649
like<font color="#CCCCCC"> that no yeah I it was crazy I could</font>

656
00:31:10,850 --> 00:31:14,330
we were just we were all just kind of

657
00:31:12,649 --> 00:31:16,459
like and shocked that they had done

658
00:31:14,330 --> 00:31:20,480
something like<font color="#E5E5E5"> that</font><font color="#CCCCCC"> just they didn't</font>

659
00:31:16,460 --> 00:31:24,909
care it's kind<font color="#CCCCCC"> of interesting question I</font>

660
00:31:20,480 --> 00:31:24,909
don't know if I feel<font color="#E5E5E5"> like I'm like oh</font>

