1
00:00:02,870 --> 00:00:11,010
my commute anyway alright so do I blue

2
00:00:08,969 --> 00:00:12,330
teaming so like I'm I know this is a key

3
00:00:11,010 --> 00:00:15,059
now and I'm sorry this isn't more like

4
00:00:12,330 --> 00:00:16,139
soft and leadership II and all of that I

5
00:00:15,059 --> 00:00:20,299
don't really know how to do that I just

6
00:00:16,139 --> 00:00:22,500
know how to break things so I tried to

7
00:00:20,300 --> 00:00:24,150
this is my attempt at doing something

8
00:00:22,500 --> 00:00:25,619
that hopefully is breaking things from a

9
00:00:24,150 --> 00:00:27,810
more like leadership concept because

10
00:00:25,619 --> 00:00:29,580
frankly like I'm gonna give you some

11
00:00:27,810 --> 00:00:30,900
tips and tricks like okay I'm like this

12
00:00:29,580 --> 00:00:33,089
is this is kind of the overview what

13
00:00:30,900 --> 00:00:35,190
we're gonna cover it's it's like kind of

14
00:00:33,090 --> 00:00:37,500
some stuff that I've done at you know

15
00:00:35,190 --> 00:00:39,329
different organizations or like my in my

16
00:00:37,500 --> 00:00:41,219
own like setups at home or stuff that

17
00:00:39,329 --> 00:00:42,300
I've seen or heard of or some of these

18
00:00:41,219 --> 00:00:44,940
things they're ideas that I haven't

19
00:00:42,300 --> 00:00:47,849
liked I've tried them but in very lab

20
00:00:44,940 --> 00:00:49,468
light conditions I just want to say that

21
00:00:47,850 --> 00:00:52,680
like I'm not a blue team ER so there's

22
00:00:49,469 --> 00:00:53,340
tons and there's so much more stuff for

23
00:00:52,680 --> 00:00:55,289
blue teamers

24
00:00:53,340 --> 00:00:57,390
in terms of little scripts that do stuff

25
00:00:55,289 --> 00:00:59,039
for you or things that scale or like

26
00:00:57,390 --> 00:01:02,730
research like the blue team is so much

27
00:00:59,039 --> 00:01:04,619
better at collaborating tricks and

28
00:01:02,730 --> 00:01:06,780
researched and then red team stuff for

29
00:01:04,619 --> 00:01:09,659
obvious reasons so just yeah don't think

30
00:01:06,780 --> 00:01:11,070
that this is exhaustive by any means at

31
00:01:09,659 --> 00:01:13,049
all uh-huh

32
00:01:11,070 --> 00:01:14,759
alright so first thing we talk about is

33
00:01:13,049 --> 00:01:17,220
ways to make malware not work why would

34
00:01:14,760 --> 00:01:18,360
you do that well because usually even if

35
00:01:17,220 --> 00:01:20,460
somebody's using O'Dea on you the

36
00:01:18,360 --> 00:01:22,590
purpose of the OU day is to make malware

37
00:01:20,460 --> 00:01:25,798
run on your computer and now or doesn't

38
00:01:22,590 --> 00:01:28,590
work a like the attacker doesn't can in

39
00:01:25,799 --> 00:01:32,759
or be if they do get in because they get

40
00:01:28,590 --> 00:01:33,720
in you the the malware tends to the

41
00:01:32,759 --> 00:01:35,130
amount we're not working can create

42
00:01:33,720 --> 00:01:38,158
errors and errors are good because

43
00:01:35,130 --> 00:01:40,949
errors mean that you can steal the thing

44
00:01:38,159 --> 00:01:42,840
they're using and you find them very

45
00:01:40,950 --> 00:01:44,820
fast and it kind of turns into that

46
00:01:42,840 --> 00:01:49,530
anyway okay so methods of making my or

47
00:01:44,820 --> 00:01:51,449
network on Linux anybody know what does

48
00:01:49,530 --> 00:01:54,090
this call this yeah

49
00:01:51,450 --> 00:01:55,710
so this calls are like names kind of

50
00:01:54,090 --> 00:01:57,299
like function calls that map to numbers

51
00:01:55,710 --> 00:01:59,579
right it's like it's like the super

52
00:01:57,299 --> 00:02:01,920
secret API that's it's inside of like

53
00:01:59,579 --> 00:02:05,070
every Linux kernel ever so a lot of

54
00:02:01,920 --> 00:02:06,899
programs expect those names and numbers

55
00:02:05,070 --> 00:02:09,090
to always map to the same numbers like

56
00:02:06,899 --> 00:02:11,129
the order is very predictable and people

57
00:02:09,090 --> 00:02:13,230
try to document this but there's there's

58
00:02:11,129 --> 00:02:15,569
no rule about that

59
00:02:13,230 --> 00:02:16,738
and shellcode really expect stuff to be

60
00:02:15,569 --> 00:02:21,200
in the same place so if you just change

61
00:02:16,739 --> 00:02:24,239
the numbers and then reinstall the bots

62
00:02:21,200 --> 00:02:27,119
shellcode tends to not work so that's

63
00:02:24,239 --> 00:02:28,530
the thing this is just like this it's

64
00:02:27,120 --> 00:02:29,970
kind of a visual example so like if you

65
00:02:28,530 --> 00:02:31,560
just take all those numbers on the left

66
00:02:29,970 --> 00:02:32,849
and change them all and then recompile

67
00:02:31,560 --> 00:02:37,290
your kernel like stuff will still work

68
00:02:32,849 --> 00:02:39,119
but she'll go wrong you can remove your

69
00:02:37,290 --> 00:02:44,609
shell this is a trick I do sometimes

70
00:02:39,120 --> 00:02:47,519
when hosting shady crap on like ec2 you

71
00:02:44,610 --> 00:02:49,530
can just remove Bash from the box

72
00:02:47,519 --> 00:02:52,890
entirely so like nothing works and then

73
00:02:49,530 --> 00:02:54,120
what you do is you modify SSH to be like

74
00:02:52,890 --> 00:02:57,390
you know how you can change your SSH

75
00:02:54,120 --> 00:02:59,370
config so like running a program other

76
00:02:57,390 --> 00:03:02,548
than a shell so you do is you Pro you

77
00:02:59,370 --> 00:03:05,280
tell it to run a program that goes and

78
00:03:02,549 --> 00:03:06,989
gets a shell so if somebody doesn't log

79
00:03:05,280 --> 00:03:09,870
in legit somebody uses like shell code

80
00:03:06,989 --> 00:03:14,310
or there's no shell so it just dies and

81
00:03:09,870 --> 00:03:17,700
causes problems yeah okay

82
00:03:14,310 --> 00:03:19,560
apparently I had slides for that sorry

83
00:03:17,700 --> 00:03:21,168
you can backdoor your own utility is

84
00:03:19,560 --> 00:03:25,859
this I love doing this

85
00:03:21,169 --> 00:03:28,230
so okay say you have a box that you want

86
00:03:25,859 --> 00:03:30,389
to be able to SSH into okay so you

87
00:03:28,230 --> 00:03:32,548
change port 22 to go to a honeypot so it

88
00:03:30,389 --> 00:03:36,000
doesn't actually go to SSH right and

89
00:03:32,549 --> 00:03:38,519
then you open up poor 8 4 4 3 and put so

90
00:03:36,000 --> 00:03:41,220
this github link down here is this super

91
00:03:38,519 --> 00:03:45,540
awesome like multiplexer that this guy

92
00:03:41,220 --> 00:03:48,000
wrote it's it'll run SSH and SSL on the

93
00:03:45,540 --> 00:03:50,010
same port at the same time and it's like

94
00:03:48,000 --> 00:03:52,739
a proxy so you can attach a web server

95
00:03:50,010 --> 00:03:54,480
on one end and SSH on the other so you

96
00:03:52,739 --> 00:03:56,010
do on your regular SSH port you put a

97
00:03:54,480 --> 00:03:59,879
blanket honeypot and then on the web

98
00:03:56,010 --> 00:04:02,370
side of the of the proxy you put some

99
00:03:59,879 --> 00:04:04,798
other BS like web based honeypot that

100
00:04:02,370 --> 00:04:06,780
looks like it's the same box as the SSH

101
00:04:04,799 --> 00:04:08,430
thing and then your axel SSH as well if

102
00:04:06,780 --> 00:04:10,319
you SSH into that port it just works so

103
00:04:08,430 --> 00:04:12,750
if an attacker gets in your network

104
00:04:10,319 --> 00:04:15,540
they're like I don't understand why my

105
00:04:12,750 --> 00:04:16,949
SSH is going into BS land and why like

106
00:04:15,540 --> 00:04:21,380
web calls don't work and you're like ha

107
00:04:16,949 --> 00:04:21,380
ha SSH into HTTP thing oh it works

108
00:04:22,000 --> 00:04:26,310
I've actually done that like and cut

109
00:04:24,130 --> 00:04:29,830
people it's pretty funny

110
00:04:26,310 --> 00:04:31,720
so GCC should not be improv it anyway

111
00:04:29,830 --> 00:04:33,550
right because you're all removing GCC

112
00:04:31,720 --> 00:04:37,240
from your fraud boxes because proud

113
00:04:33,550 --> 00:04:38,680
bosses don't need compilers sure so the

114
00:04:37,240 --> 00:04:41,380
cool thing is that if you're doing that

115
00:04:38,680 --> 00:04:46,300
you can replace GCC with something

116
00:04:41,380 --> 00:04:48,909
that's not GCC like maybe it takes a

117
00:04:46,300 --> 00:04:51,400
copy of the source code and since it's

118
00:04:48,910 --> 00:04:52,930
somewhere to some locking box so the

119
00:04:51,400 --> 00:04:54,580
whole time they're like I don't

120
00:04:52,930 --> 00:05:00,700
understand I keep compiling this exploit

121
00:04:54,580 --> 00:05:03,010
I yeah totally works this is this is

122
00:05:00,700 --> 00:05:05,710
kind of like I don't know CCDC stuff

123
00:05:03,010 --> 00:05:07,330
applied to real world so it's super

124
00:05:05,710 --> 00:05:08,950
common in my competitions and the CTS

125
00:05:07,330 --> 00:05:10,840
and stuff that like people give you

126
00:05:08,950 --> 00:05:12,820
totally unusable craptastic shells to

127
00:05:10,840 --> 00:05:15,400
use they have like ponies in them and

128
00:05:12,820 --> 00:05:18,159
bouncing ASCII art and ls3 maps to steam

129
00:05:15,400 --> 00:05:20,799
locomotive and back uh-huh so you can

130
00:05:18,160 --> 00:05:26,440
totally do that and like build like a

131
00:05:20,800 --> 00:05:28,900
shell that's just garbage right and then

132
00:05:26,440 --> 00:05:31,030
you change your login to be like you

133
00:05:28,900 --> 00:05:33,580
know not a shell which is like a usable

134
00:05:31,030 --> 00:05:35,049
shell so anytime anybody that you don't

135
00:05:33,580 --> 00:05:36,460
expect bugs in your box they just get

136
00:05:35,050 --> 00:05:40,450
ridiculousness and produce a bunch of

137
00:05:36,460 --> 00:05:43,090
garbage errors similar is a so like you

138
00:05:40,450 --> 00:05:44,710
can like take CP or MB or Ln I like

139
00:05:43,090 --> 00:05:48,060
these basic Linux utilities and replace

140
00:05:44,710 --> 00:05:50,169
them in the unmov'd shell with like

141
00:05:48,060 --> 00:05:52,000
taking people thing and move it to my

142
00:05:50,169 --> 00:05:53,440
log thing that says that somebody that

143
00:05:52,000 --> 00:05:56,680
should be here is trying to use one of

144
00:05:53,440 --> 00:05:58,600
these utilities you can also backdoor

145
00:05:56,680 --> 00:06:00,220
them sorry I super got ahead of myself

146
00:05:58,600 --> 00:06:02,050
but like when I wrote these slides I had

147
00:06:00,220 --> 00:06:03,280
single ideas in my head so I'm just

148
00:06:02,050 --> 00:06:04,270
figure I'll just talk and the slides

149
00:06:03,280 --> 00:06:07,659
don't make sense so let's get the end

150
00:06:04,270 --> 00:06:09,580
you can ask questions you can also make

151
00:06:07,660 --> 00:06:13,360
us a dyke why would you ever need to

152
00:06:09,580 --> 00:06:16,120
copy at sea shadow right so like maybe

153
00:06:13,360 --> 00:06:16,990
you modify CP to add a flag that says no

154
00:06:16,120 --> 00:06:19,270
I really mean to do this

155
00:06:16,990 --> 00:06:22,660
so anytime any other user ever tries to

156
00:06:19,270 --> 00:06:26,830
copy su shadow you can go wait a minute

157
00:06:22,660 --> 00:06:28,330
so that works this is the fun one you

158
00:06:26,830 --> 00:06:31,659
name strings are arbitrary so you can

159
00:06:28,330 --> 00:06:33,789
make them lie okay like oh I ran you

160
00:06:31,660 --> 00:06:35,960
name and it says arm attacker running

161
00:06:33,789 --> 00:06:39,080
arm exploit against

162
00:06:35,960 --> 00:06:42,080
[Laughter]

163
00:06:39,080 --> 00:06:44,150
this is a super fun one so anybody ever

164
00:06:42,080 --> 00:06:46,639
hacked any do any like hacking on like

165
00:06:44,150 --> 00:06:47,960
console games like like Xboxes or

166
00:06:46,639 --> 00:06:50,960
Playstations or things like that

167
00:06:47,960 --> 00:06:53,448
okay so like the reason those are hard

168
00:06:50,960 --> 00:06:55,669
to hack is not all the exploitation and

169
00:06:53,449 --> 00:06:57,860
the closed system and all that it's

170
00:06:55,669 --> 00:06:59,960
because the processors themselves are

171
00:06:57,860 --> 00:07:01,849
encrypted right so what happens is you

172
00:06:59,960 --> 00:07:03,770
have these binaries at some level where

173
00:07:01,849 --> 00:07:05,628
the instructions go through an

174
00:07:03,770 --> 00:07:08,120
encryption process and the encrypted

175
00:07:05,629 --> 00:07:11,150
instruction gets read by the private key

176
00:07:08,120 --> 00:07:12,590
that's on a chip right so effectively

177
00:07:11,150 --> 00:07:14,770
there is no such thing as decrypted in

178
00:07:12,590 --> 00:07:17,688
memory because the entire system runs on

179
00:07:14,770 --> 00:07:21,099
encrypted throughput so it's madness

180
00:07:17,689 --> 00:07:23,930
right well you can kind of do that with

181
00:07:21,099 --> 00:07:26,569
kernel modules if you have a modular

182
00:07:23,930 --> 00:07:29,509
kernel right so you take mod probe and

183
00:07:26,569 --> 00:07:31,159
you say okay like modify the source of

184
00:07:29,509 --> 00:07:33,080
montreux but all stuffs up inside is is

185
00:07:31,159 --> 00:07:35,090
that's great on Linux so you go take the

186
00:07:33,080 --> 00:07:38,300
source to modprobe and you say you know

187
00:07:35,090 --> 00:07:41,599
prepend all the loading logic with soar

188
00:07:38,300 --> 00:07:42,830
against dead beef right so then you go

189
00:07:41,599 --> 00:07:44,659
through our your kernel modules and use

190
00:07:42,830 --> 00:07:46,250
or them all against deadbeat so anytime

191
00:07:44,659 --> 00:07:49,129
anybody tries to load a kernel module

192
00:07:46,250 --> 00:07:49,550
that isn't encrypted modprobe will screw

193
00:07:49,129 --> 00:07:52,219
it up

194
00:07:49,550 --> 00:07:55,310
OOP is against deadbeat and then it just

195
00:07:52,219 --> 00:07:56,779
won't load and you add a you know check

196
00:07:55,310 --> 00:07:58,969
that says anytime an error you know

197
00:07:56,779 --> 00:08:00,650
anything any time a kernel module won't

198
00:07:58,969 --> 00:08:02,930
load like Senate error or send me the

199
00:08:00,650 --> 00:08:07,219
module and you can find attackers

200
00:08:02,930 --> 00:08:11,479
loading route kids said I had slides for

201
00:08:07,219 --> 00:08:13,580
that and forgot yep totally did this is

202
00:08:11,479 --> 00:08:15,529
my slide where I was talking about

203
00:08:13,580 --> 00:08:20,389
breaking all the shells and totally got

204
00:08:15,529 --> 00:08:22,939
ahead of myself don't do that oh the

205
00:08:20,389 --> 00:08:26,300
internet fest trick this is fun so you

206
00:08:22,939 --> 00:08:31,250
can this is like all of that stuff like

207
00:08:26,300 --> 00:08:33,260
on crack as one trick so if you have a

208
00:08:31,250 --> 00:08:34,698
production server that only needs to one

209
00:08:33,260 --> 00:08:37,218
one application which is pretty typical

210
00:08:34,698 --> 00:08:41,929
right geez like a web server or like a

211
00:08:37,219 --> 00:08:47,300
database box right anybody know the unit

212
00:08:41,929 --> 00:08:48,888
kernel is well other than Merlin okay so

213
00:08:47,300 --> 00:08:50,449
you know kernel is when

214
00:08:48,889 --> 00:08:51,920
like you take a kernel in on application

215
00:08:50,449 --> 00:08:54,258
and merge them into one big blob of code

216
00:08:51,920 --> 00:08:56,779
right or one big binary and there's ways

217
00:08:54,259 --> 00:08:59,059
to do it and it means that there's no

218
00:08:56,779 --> 00:09:01,639
definition between user space and kernel

219
00:08:59,059 --> 00:09:03,709
space it's all just one run time right

220
00:09:01,639 --> 00:09:05,029
now hypothetically this could be really

221
00:09:03,709 --> 00:09:06,799
secure because it would let you build a

222
00:09:05,029 --> 00:09:10,069
very long time environment and Pratt and

223
00:09:06,799 --> 00:09:11,720
in reality all of the documented and

224
00:09:10,069 --> 00:09:14,118
preformed unit kernels that exist are

225
00:09:11,720 --> 00:09:15,439
effing terrible don't ever use them

226
00:09:14,119 --> 00:09:16,459
they're horribly insecure because really

227
00:09:15,439 --> 00:09:17,899
all they do is just put everything in

228
00:09:16,459 --> 00:09:20,059
ring zero um

229
00:09:17,899 --> 00:09:21,169
the init Ram if s trick is that you can

230
00:09:20,059 --> 00:09:23,719
kind of get the same functionality

231
00:09:21,169 --> 00:09:26,329
without actually making the application

232
00:09:23,720 --> 00:09:27,919
and the kernel in the same thing you

233
00:09:26,329 --> 00:09:29,929
just make a kernel that only ones run

234
00:09:27,919 --> 00:09:31,129
program which kind of already does

235
00:09:29,929 --> 00:09:32,600
because it just runs a shell

236
00:09:31,129 --> 00:09:35,209
but instead of running a shell you make

237
00:09:32,600 --> 00:09:37,899
it run like your database hey so you

238
00:09:35,209 --> 00:09:39,768
don't need a computer for all other

239
00:09:37,899 --> 00:09:41,419
definitions of that work you don't need

240
00:09:39,769 --> 00:09:43,790
all the other stuff so what you can do

241
00:09:41,419 --> 00:09:45,350
is there's scripts to do that I actually

242
00:09:43,790 --> 00:09:47,449
should have linked it I was dumb I'll

243
00:09:45,350 --> 00:09:48,649
tweet it something or I'll put it in the

244
00:09:47,449 --> 00:09:50,738
side when I put this when I make the

245
00:09:48,649 --> 00:09:52,850
slides public all the side to be public

246
00:09:50,739 --> 00:09:54,559
but there's like stupid scripts you can

247
00:09:52,850 --> 00:09:56,360
download where you give it a you know an

248
00:09:54,559 --> 00:09:58,069
app you compile an app you give it a

249
00:09:56,360 --> 00:09:59,389
binary you say okay I want to compile

250
00:09:58,069 --> 00:10:00,559
this kernel and I compile this app

251
00:09:59,389 --> 00:10:02,720
against this kernel and I want to build

252
00:10:00,559 --> 00:10:04,189
an init Ram FS which is the file system

253
00:10:02,720 --> 00:10:07,489
that your kernel loads but only has that

254
00:10:04,189 --> 00:10:08,868
program that's it and there you go like

255
00:10:07,489 --> 00:10:11,749
I mean shell code doesn't work because

256
00:10:08,869 --> 00:10:13,249
there's no shell like weak libraries

257
00:10:11,749 --> 00:10:14,629
that aren't necessary to run like

258
00:10:13,249 --> 00:10:16,639
third-party applications don't exist

259
00:10:14,629 --> 00:10:18,759
there's nothing damn right it's like

260
00:10:16,639 --> 00:10:24,290
there's nothing there's nothing to get

261
00:10:18,759 --> 00:10:26,600
that's cool okay windows methods so this

262
00:10:24,290 --> 00:10:31,488
is a document that will tell you how to

263
00:10:26,600 --> 00:10:33,799
modify the registry of a modern Windows

264
00:10:31,489 --> 00:10:38,660
box I think it works up to like seven or

265
00:10:33,799 --> 00:10:40,879
something and then they have where

266
00:10:38,660 --> 00:10:43,879
anytime anything breaks it will take a

267
00:10:40,879 --> 00:10:46,939
full dump of memory and put it in your

268
00:10:43,879 --> 00:10:50,329
crash dump and stick it somewhere which

269
00:10:46,939 --> 00:10:51,998
should be like it should be obvious why

270
00:10:50,329 --> 00:10:58,160
that's awesome

271
00:10:51,999 --> 00:10:59,689
right because but hey it writes to a

272
00:10:58,160 --> 00:11:02,140
file like what you don't have 32 gigs of

273
00:10:59,689 --> 00:11:03,910
hard drive space nothing

274
00:11:02,140 --> 00:11:05,260
actually I have a harddrive trick for

275
00:11:03,910 --> 00:11:09,310
logs at the end of this talk but like

276
00:11:05,260 --> 00:11:10,930
we'll cover anyway yeah so that's that's

277
00:11:09,310 --> 00:11:12,069
the thing and people want to exploit so

278
00:11:10,930 --> 00:11:13,989
when the exploits don't work they

279
00:11:12,070 --> 00:11:15,550
produce bugs and you can totally be like

280
00:11:13,990 --> 00:11:18,070
full crashed I'm sorry I'm gonna speed

281
00:11:15,550 --> 00:11:19,750
up because I'm out of time you can

282
00:11:18,070 --> 00:11:20,860
rename your powershell exe it's kind of

283
00:11:19,750 --> 00:11:23,170
like the bass track with the no shell

284
00:11:20,860 --> 00:11:24,130
thing only like not and so like only you

285
00:11:23,170 --> 00:11:26,439
know that you have to type like

286
00:11:24,130 --> 00:11:28,630
PowerShell or something or some random

287
00:11:26,440 --> 00:11:29,860
man yeah attacker runs powers that we

288
00:11:28,630 --> 00:11:32,590
exist totally back over there's all

289
00:11:29,860 --> 00:11:34,660
kinds of horrible things this is a

290
00:11:32,590 --> 00:11:35,860
document from Microsoft on how to enable

291
00:11:34,660 --> 00:11:37,449
something called over-the-shoulder or

292
00:11:35,860 --> 00:11:39,820
transcription so this will basically log

293
00:11:37,450 --> 00:11:41,440
all the commands and any scripts that

294
00:11:39,820 --> 00:11:43,300
somebody runs in PowerShell so like on

295
00:11:41,440 --> 00:11:44,560
boxes that aren't dead boxes like people

296
00:11:43,300 --> 00:11:46,930
that don't need to be using PowerShell

297
00:11:44,560 --> 00:11:48,939
for admin purposes like log everything

298
00:11:46,930 --> 00:11:52,900
they do because why not and then grep

299
00:11:48,940 --> 00:11:54,370
for badness yeah that's that's

300
00:11:52,900 --> 00:11:55,360
prematurely do it you you make an output

301
00:11:54,370 --> 00:11:56,950
directory and you can make it up a

302
00:11:55,360 --> 00:11:58,750
directory and SMB share so that the

303
00:11:56,950 --> 00:12:03,790
remote and then you can mount this and

304
00:11:58,750 --> 00:12:06,430
share to kind of cool oh this is a yeah

305
00:12:03,790 --> 00:12:08,020
if you did that this is a Linux snippet

306
00:12:06,430 --> 00:12:09,520
that will on directory change run a

307
00:12:08,020 --> 00:12:12,460
thing so you can make a thing bet to

308
00:12:09,520 --> 00:12:14,020
command and you can spot like power

309
00:12:12,460 --> 00:12:17,110
sploit injections and stuff like that

310
00:12:14,020 --> 00:12:18,840
real-time this is cool you can use open

311
00:12:17,110 --> 00:12:21,670
prop you can hook up and profit okay I

312
00:12:18,840 --> 00:12:25,030
should have okay

313
00:12:21,670 --> 00:12:26,740
hooking hooking Windows global functions

314
00:12:25,030 --> 00:12:27,970
is a documented thing if you're an admin

315
00:12:26,740 --> 00:12:29,170
I should have gone into the details on

316
00:12:27,970 --> 00:12:30,400
how to do it I don't know watch my last

317
00:12:29,170 --> 00:12:33,010
year's talk I kind of explain hooking a

318
00:12:30,400 --> 00:12:35,500
little bit better but yeah so if anybody

319
00:12:33,010 --> 00:12:36,520
opens like kelp that exe or notepad or

320
00:12:35,500 --> 00:12:38,830
Explorer like those are pretty much the

321
00:12:36,520 --> 00:12:40,120
big three things that like my pen

322
00:12:38,830 --> 00:12:44,290
testers use although after to hook

323
00:12:40,120 --> 00:12:46,150
because their calc not anymore

324
00:12:44,290 --> 00:12:48,280
but Explorer definitely it's the thing

325
00:12:46,150 --> 00:12:51,040
that the active user will always have

326
00:12:48,280 --> 00:12:52,360
write access permissions so that's what

327
00:12:51,040 --> 00:12:56,589
people use so you can catch stuff doing

328
00:12:52,360 --> 00:12:58,600
that you can backdoor a registry editor

329
00:12:56,590 --> 00:13:00,250
and anytime anybody calls read edit

330
00:12:58,600 --> 00:13:03,070
locally on the machine be like why are

331
00:13:00,250 --> 00:13:06,040
you doing that dump dump stream like

332
00:13:03,070 --> 00:13:07,750
what this one I don't have an active

333
00:13:06,040 --> 00:13:09,490
example yet because the code is still

334
00:13:07,750 --> 00:13:11,500
too buggy to me release and

335
00:13:09,490 --> 00:13:12,399
might release it an in detail at a

336
00:13:11,500 --> 00:13:15,130
different conference but it's kind of

337
00:13:12,399 --> 00:13:16,300
cool so this woman is a genius polish

338
00:13:15,130 --> 00:13:18,300
person who does not know that I exist

339
00:13:16,300 --> 00:13:20,410
and she wrote this really awesome

340
00:13:18,300 --> 00:13:24,760
application called peace Eve well peace

341
00:13:20,410 --> 00:13:26,500
Eve does is it scans the i-80 inside a

342
00:13:24,760 --> 00:13:28,360
PE file which is the thing that tells

343
00:13:26,500 --> 00:13:30,880
you where all the functions are in

344
00:13:28,360 --> 00:13:32,170
memory and it looks for addresses that

345
00:13:30,880 --> 00:13:33,700
don't go to where they should be

346
00:13:32,170 --> 00:13:35,410
this means it finds hoped functions and

347
00:13:33,700 --> 00:13:37,120
it finds hollowed processes well she

348
00:13:35,410 --> 00:13:38,770
recently changed this into being a DLL

349
00:13:37,120 --> 00:13:40,570
so what I did is I wrote my own DLL

350
00:13:38,770 --> 00:13:43,300
around this and then wrote a simple

351
00:13:40,570 --> 00:13:45,790
little like four line GPO patch such

352
00:13:43,300 --> 00:13:48,459
that you can push a GPO to every system

353
00:13:45,790 --> 00:13:51,279
on your entire computer that will add my

354
00:13:48,459 --> 00:13:53,709
DLL which has her deal in it into like

355
00:13:51,279 --> 00:13:55,300
system 32 and then change a registry key

356
00:13:53,709 --> 00:13:58,089
called a pin at DLL which means anytime

357
00:13:55,300 --> 00:14:00,130
the kernel gets loaded in any process it

358
00:13:58,089 --> 00:14:02,140
will also load this thing and every five

359
00:14:00,130 --> 00:14:04,450
minutes it will run scan on her thing

360
00:14:02,140 --> 00:14:06,459
and if result comes back it will send it

361
00:14:04,450 --> 00:14:08,589
to you so this means anytime any malware

362
00:14:06,459 --> 00:14:10,089
ever hooks anything on your entire

363
00:14:08,589 --> 00:14:12,250
environment you will get an alert with a

364
00:14:10,089 --> 00:14:16,959
process dump of the entire malware in it

365
00:14:12,250 --> 00:14:20,500
right like Y by carbons like Apple

366
00:14:16,959 --> 00:14:22,660
methods yeah put-put Samba system like

367
00:14:20,500 --> 00:14:24,610
oh my god like this works so good like

368
00:14:22,660 --> 00:14:25,959
I've totally caught like I can't even do

369
00:14:24,610 --> 00:14:27,459
D F IR and I've totally done like

370
00:14:25,959 --> 00:14:28,630
contests for like hey let's let's like

371
00:14:27,459 --> 00:14:30,219
we think this might be popped let's put

372
00:14:28,630 --> 00:14:31,510
an SMP server I'm like a bunch of Macs

373
00:14:30,220 --> 00:14:32,649
and let's see what connects to it and a

374
00:14:31,510 --> 00:14:36,850
bunch of stuff connects to it you know

375
00:14:32,649 --> 00:14:40,260
like I shouldn't be there yeah you can

376
00:14:36,850 --> 00:14:40,260
write horrible scripts that do things

377
00:14:41,310 --> 00:14:46,719
this is a resource for hardening OS X

378
00:14:45,610 --> 00:14:48,459
stuff but there's a bunch of little like

379
00:14:46,720 --> 00:14:49,750
hacky blue team tools in there if you

380
00:14:48,459 --> 00:14:50,680
read the whole thing so like I just put

381
00:14:49,750 --> 00:14:52,060
them you know I'm not gonna take credit

382
00:14:50,680 --> 00:14:53,489
for somebody else's research to read it

383
00:14:52,060 --> 00:14:58,390
there's there's there's gems

384
00:14:53,490 --> 00:14:59,920
miscellaneous methods yeah so like it's

385
00:14:58,390 --> 00:15:01,480
really cool if you like mate like if you

386
00:14:59,920 --> 00:15:03,339
if you are running a web environment and

387
00:15:01,480 --> 00:15:06,370
you're worried about doing web apps egg

388
00:15:03,339 --> 00:15:08,050
put accounts that aren't real in your

389
00:15:06,370 --> 00:15:09,790
web app that nobody has a reason to

390
00:15:08,050 --> 00:15:12,099
access with really stupid passwords like

391
00:15:09,790 --> 00:15:13,390
I've been password and then when someone

392
00:15:12,100 --> 00:15:17,380
goes to your web app and types admin

393
00:15:13,390 --> 00:15:19,329
password that user only has Metasploit

394
00:15:17,380 --> 00:15:22,029
like samba link there so they

395
00:15:19,329 --> 00:15:24,248
Metasploit of themselves oh we're gonna

396
00:15:22,029 --> 00:15:26,679
break the wall I came to you

397
00:15:24,249 --> 00:15:27,850
same thing canary users you can use

398
00:15:26,679 --> 00:15:29,379
honey tokens to do the same thing oh

399
00:15:27,850 --> 00:15:32,019
this is a fun one like okay so you're

400
00:15:29,379 --> 00:15:33,610
like you you put like fake AWS tokens

401
00:15:32,019 --> 00:15:34,899
like somewhere in your environment and

402
00:15:33,610 --> 00:15:36,189
then people log into a fake AWS

403
00:15:34,899 --> 00:15:37,540
environment and in the mean time you

404
00:15:36,189 --> 00:15:41,610
have like logging turned on you can then

405
00:15:37,540 --> 00:15:43,179
screen top so the cops like is funny

406
00:15:41,610 --> 00:15:45,819
security but security

407
00:15:43,179 --> 00:15:47,290
yeah so I've done this before - so like

408
00:15:45,819 --> 00:15:48,699
you change your web apps it's that every

409
00:15:47,290 --> 00:15:50,379
time somebody reads your robots that

410
00:15:48,699 --> 00:15:56,829
text it changes with different deny

411
00:15:50,379 --> 00:15:58,509
messages like this totally works using

412
00:15:56,829 --> 00:16:00,488
TCP redirect in front of services you're

413
00:15:58,509 --> 00:16:02,170
actually running with a random delay 9

414
00:16:00,489 --> 00:16:03,610
times at a 10 will make an maps not work

415
00:16:02,170 --> 00:16:05,170
because people are spamming you looking

416
00:16:03,610 --> 00:16:06,759
for large stuff and if they have to wait

417
00:16:05,170 --> 00:16:10,540
an extra 5 seconds to find out that port

418
00:16:06,759 --> 00:16:11,949
is open though this closet this is a

419
00:16:10,540 --> 00:16:14,230
little this is a little bit of a story

420
00:16:11,949 --> 00:16:15,729
time so I'll try to move quick so you

421
00:16:14,230 --> 00:16:17,079
used to be able to search for it by

422
00:16:15,730 --> 00:16:18,249
looking for malware blacklists and now

423
00:16:17,079 --> 00:16:20,258
that has a very different term so you

424
00:16:18,249 --> 00:16:21,939
won't find this but there are sites on

425
00:16:20,259 --> 00:16:24,189
the Internet where bad guys hang out

426
00:16:21,939 --> 00:16:25,689
where they list black lists and what

427
00:16:24,189 --> 00:16:27,219
these black lists are is their IP

428
00:16:25,689 --> 00:16:28,660
addresses that if you are in the

429
00:16:27,220 --> 00:16:30,910
business of making a deploying malware

430
00:16:28,660 --> 00:16:33,819
you should not talk to because they are

431
00:16:30,910 --> 00:16:35,410
owned by the FBI or the CIA or antivirus

432
00:16:33,819 --> 00:16:37,329
people running san bosses and those are

433
00:16:35,410 --> 00:16:38,410
the big ones right and they list who

434
00:16:37,329 --> 00:16:40,059
these things belong to you so that you

435
00:16:38,410 --> 00:16:42,639
know who and why to avoid them and

436
00:16:40,059 --> 00:16:43,959
they're you know they're on shady sites

437
00:16:42,639 --> 00:16:47,559
but they're not typically hidden so what

438
00:16:43,959 --> 00:16:49,748
you do is you go get one or a few right

439
00:16:47,559 --> 00:16:53,230
and then you write some software that

440
00:16:49,749 --> 00:16:54,429
takes a picture of a box right to gather

441
00:16:53,230 --> 00:16:56,230
some information

442
00:16:54,429 --> 00:16:59,889
no exploits just gather some information

443
00:16:56,230 --> 00:17:02,649
and then you maybe log into one of these

444
00:16:59,889 --> 00:17:04,480
easily accessible honeypot things with

445
00:17:02,649 --> 00:17:07,029
you're easily finger printable malware

446
00:17:04,480 --> 00:17:09,189
because who cares and you figure out

447
00:17:07,029 --> 00:17:11,679
what their honeypot looks like then you

448
00:17:09,189 --> 00:17:13,569
build that honeypot right or a very

449
00:17:11,679 --> 00:17:15,130
reasonable facsimile and run it

450
00:17:13,569 --> 00:17:17,109
somewhere in your environment in a DMZ

451
00:17:15,130 --> 00:17:18,610
or do it five times or do it 20 times

452
00:17:17,109 --> 00:17:20,678
which is even better right all over your

453
00:17:18,609 --> 00:17:23,109
IP space and then you go to that forum

454
00:17:20,679 --> 00:17:25,630
and say hey it turns out insert

455
00:17:23,109 --> 00:17:27,099
unspecified AV person here is also a

456
00:17:25,630 --> 00:17:29,690
running honey pots in this organization

457
00:17:27,099 --> 00:17:31,219
don't attack them

458
00:17:29,690 --> 00:17:33,679
and people will totally believe you and

459
00:17:31,220 --> 00:17:35,960
it works because the paranoid um very

460
00:17:33,679 --> 00:17:39,559
very similar tactic you can five minutes

461
00:17:35,960 --> 00:17:41,149
you can register like FBI dot your org

462
00:17:39,559 --> 00:17:42,200
name here and then when somebody tries

463
00:17:41,149 --> 00:17:44,090
to log into it thinking it's lawful

464
00:17:42,200 --> 00:17:46,070
interception and it wasn't sweet you

465
00:17:44,090 --> 00:17:49,730
just broke the law like that probably

466
00:17:46,070 --> 00:17:53,899
works warning doing that I I have done

467
00:17:49,730 --> 00:17:55,190
this on home IP space for domains that

468
00:17:53,899 --> 00:17:57,018
were projects I was working on that

469
00:17:55,190 --> 00:18:01,250
weren't technically companies and had

470
00:17:57,019 --> 00:18:03,710
people log in that were attackers but

471
00:18:01,250 --> 00:18:05,480
they had badges and they like didn't

472
00:18:03,710 --> 00:18:06,889
know I wasn't actually running lawful

473
00:18:05,480 --> 00:18:08,840
interception and they found out real

474
00:18:06,889 --> 00:18:11,830
quick and it got real awkward so just

475
00:18:08,840 --> 00:18:14,029
just saying look that's that's the thing

476
00:18:11,830 --> 00:18:16,279
this is the last section I'm gonna burn

477
00:18:14,029 --> 00:18:18,440
through it cuz I'm super at a time so

478
00:18:16,279 --> 00:18:19,759
yeah hack back tricks so somewhere like

479
00:18:18,440 --> 00:18:26,509
in every one of your backups that you

480
00:18:19,759 --> 00:18:28,039
ever do ad like this right oh okay I did

481
00:18:26,509 --> 00:18:29,450
not know that so I can go a little bit

482
00:18:28,039 --> 00:18:31,700
slower or maybe we might actually have

483
00:18:29,450 --> 00:18:33,500
question time so yeah this is a fun one

484
00:18:31,700 --> 00:18:34,549
like I see honey tokens and canary

485
00:18:33,500 --> 00:18:37,700
tokens and all that stuff all the time

486
00:18:34,549 --> 00:18:39,889
screw that take like meterpreter plus

487
00:18:37,700 --> 00:18:42,559
plus put that and like password

488
00:18:39,889 --> 00:18:43,758
backup autoexec dot thing right wait for

489
00:18:42,559 --> 00:18:45,350
the wrong person to download it because

490
00:18:43,759 --> 00:18:47,899
no one should ever open that file

491
00:18:45,350 --> 00:18:49,668
whatever right and if they do you just

492
00:18:47,899 --> 00:18:56,629
have an instance sitting somewhere that

493
00:18:49,669 --> 00:18:59,779
says yeah get ahead of myself you know

494
00:18:56,629 --> 00:19:01,490
be folks and any thanks this is a fun

495
00:18:59,779 --> 00:19:02,929
one to solicit shells in your nose so

496
00:19:01,490 --> 00:19:03,980
you can go on like the bad sites or

497
00:19:02,929 --> 00:19:06,230
people like that there are there are

498
00:19:03,980 --> 00:19:07,309
places where people are like bidding for

499
00:19:06,230 --> 00:19:08,960
shells that people have in other

500
00:19:07,309 --> 00:19:12,408
companies so you can totally try to buy

501
00:19:08,960 --> 00:19:13,340
her own shells than that they're really

502
00:19:12,409 --> 00:19:14,659
not very expensive they're like a

503
00:19:13,340 --> 00:19:17,480
hundred dollars a show with the absolute

504
00:19:14,659 --> 00:19:20,059
most expensive you can distribute this

505
00:19:17,480 --> 00:19:23,539
information about yourself okay so this

506
00:19:20,059 --> 00:19:25,789
is this is the end chunk and probably

507
00:19:23,539 --> 00:19:27,649
the shittiest part of the talk so like

508
00:19:25,789 --> 00:19:29,240
originally when I wrote this talk it was

509
00:19:27,649 --> 00:19:31,299
supposed to be less random hacky stuff

510
00:19:29,240 --> 00:19:33,500
and it was supposed to be more like hey

511
00:19:31,299 --> 00:19:35,179
there's a lot of security tools out

512
00:19:33,500 --> 00:19:37,510
there that cost a lot of money that

513
00:19:35,179 --> 00:19:39,790
don't need to cost a lot of money

514
00:19:37,510 --> 00:19:42,610
and also you can just steal their crap

515
00:19:39,790 --> 00:19:44,320
because they're badly made but I got

516
00:19:42,610 --> 00:19:46,000
yelled at by people who said I can talk

517
00:19:44,320 --> 00:19:47,169
about 1% of that stuff so you know a

518
00:19:46,000 --> 00:19:49,990
little bit of this is I'm doing it

519
00:19:47,170 --> 00:19:51,550
anyway I hope I don't get caught okay so

520
00:19:49,990 --> 00:19:54,340
how to build your own fire I write well

521
00:19:51,550 --> 00:19:58,840
okay like all the fire I actually is is

522
00:19:54,340 --> 00:20:00,340
a relatively beefy computer with some

523
00:19:58,840 --> 00:20:01,750
vm's in it right

524
00:20:00,340 --> 00:20:07,540
that they claim are using machine

525
00:20:01,750 --> 00:20:09,250
learning and special sauce if it worked

526
00:20:07,540 --> 00:20:10,780
that well like a PT's wouldn't happen we

527
00:20:09,250 --> 00:20:13,030
still do so clearly that's crap

528
00:20:10,780 --> 00:20:14,440
right so if you really want all that

529
00:20:13,030 --> 00:20:16,210
tonight I got to go by fire right but if

530
00:20:14,440 --> 00:20:17,620
you really just want like hey man I want

531
00:20:16,210 --> 00:20:20,260
to know that like any time an exe goes

532
00:20:17,620 --> 00:20:21,969
over my network like does a virus total

533
00:20:20,260 --> 00:20:25,120
hash exists for this thing yeah that

534
00:20:21,970 --> 00:20:28,240
takes like an hour okay okay okay that

535
00:20:25,120 --> 00:20:30,459
URL is a super super super easy going

536
00:20:28,240 --> 00:20:33,430
proxy library that like in ten lines of

537
00:20:30,460 --> 00:20:36,190
code you can send up any kind of HTTP or

538
00:20:33,430 --> 00:20:37,990
TCP proxy you want any kind so stick

539
00:20:36,190 --> 00:20:39,670
eleven into your network make it not do

540
00:20:37,990 --> 00:20:42,940
insecure skip verify so that it actually

541
00:20:39,670 --> 00:20:46,210
checks SSL and then anytime you know

542
00:20:42,940 --> 00:20:47,740
have it well okay so that's this is

543
00:20:46,210 --> 00:20:50,170
literally like if you wanted to write

544
00:20:47,740 --> 00:20:52,210
like this is code that will intercept

545
00:20:50,170 --> 00:20:53,590
anything to read it and replace the

546
00:20:52,210 --> 00:20:55,630
response with don't waste your time

547
00:20:53,590 --> 00:20:57,189
right so this is an example of using

548
00:20:55,630 --> 00:21:00,030
this library all you have to do is

549
00:20:57,190 --> 00:21:04,900
modify that line of code to be like

550
00:21:00,030 --> 00:21:08,170
strings dot search for exe right and

551
00:21:04,900 --> 00:21:11,230
then down you know if exe download thing

552
00:21:08,170 --> 00:21:13,630
run it in you know get hash run it

553
00:21:11,230 --> 00:21:17,710
through virus total virus total returns

554
00:21:13,630 --> 00:21:22,480
bad then alert like there you go you

555
00:21:17,710 --> 00:21:24,550
just created it this is the fun one so I

556
00:21:22,480 --> 00:21:26,320
hear a lot of organizations be like but

557
00:21:24,550 --> 00:21:27,970
how do I hold all these logs and like

558
00:21:26,320 --> 00:21:29,980
data storage is the problem and even if

559
00:21:27,970 --> 00:21:31,750
it's not a problem it like exponentially

560
00:21:29,980 --> 00:21:34,270
grows and it's super expensive okay so

561
00:21:31,750 --> 00:21:38,200
this is super shady but did you know

562
00:21:34,270 --> 00:21:39,280
that the free Dropbox account as long as

563
00:21:38,200 --> 00:21:40,750
you stay under the limit and you use a

564
00:21:39,280 --> 00:21:43,590
unique email addresses for a hundred

565
00:21:40,750 --> 00:21:43,590
gigs and never expires

566
00:21:43,850 --> 00:21:49,199
so there's this Linux utility called LVM

567
00:21:46,980 --> 00:21:52,140
that lets you take a bunch of drives and

568
00:21:49,200 --> 00:21:54,210
call them one drive so if you take an e

569
00:21:52,140 --> 00:21:55,890
lk stack and you mount it to an L VM

570
00:21:54,210 --> 00:21:57,330
image that's made of a thousand Dropbox

571
00:21:55,890 --> 00:21:57,750
accounts on a thousand different email

572
00:21:57,330 --> 00:21:59,730
accounts

573
00:21:57,750 --> 00:22:01,050
well on free storage I've actually done

574
00:21:59,730 --> 00:22:03,090
this it actually works

575
00:22:01,050 --> 00:22:04,590
I've done it for like six months like to

576
00:22:03,090 --> 00:22:10,280
make sure it totally works

577
00:22:04,590 --> 00:22:10,280
[Laughter]

578
00:22:11,100 --> 00:22:15,149
Splunk is expensive it turns out Splunk

579
00:22:13,770 --> 00:22:17,220
has a dev license that gives you ten

580
00:22:15,150 --> 00:22:23,040
gigs and it's also free they just don't

581
00:22:17,220 --> 00:22:25,650
tell people about it this is the

582
00:22:23,040 --> 00:22:27,420
shadiest thing in the talk and after

583
00:22:25,650 --> 00:22:30,840
this we'll have questions so how many of

584
00:22:27,420 --> 00:22:33,600
you have ever used apps can okay so

585
00:22:30,840 --> 00:22:35,010
apps can the web app scanner sorry not

586
00:22:33,600 --> 00:22:36,540
the not the other thing that they make

587
00:22:35,010 --> 00:22:38,040
now which is actually pretty cool the

588
00:22:36,540 --> 00:22:41,490
web app scanner the web app scanner it's

589
00:22:38,040 --> 00:22:49,200
written in thought net dotnet is very

590
00:22:41,490 --> 00:22:50,550
easy to analyze right the okay so the

591
00:22:49,200 --> 00:22:53,160
way a web app scanner works right is

592
00:22:50,550 --> 00:22:55,470
it's basically a series of reg X's stuff

593
00:22:53,160 --> 00:22:57,090
like yeah we can talk about Al and

594
00:22:55,470 --> 00:22:59,040
abstraction and solving it straight

595
00:22:57,090 --> 00:23:03,389
solving it it's freaking rad X right

596
00:22:59,040 --> 00:23:05,010
it's looking for a pattern it's possible

597
00:23:03,390 --> 00:23:08,820
that if one were to take the app scan

598
00:23:05,010 --> 00:23:12,930
netfile and look for static entities one

599
00:23:08,820 --> 00:23:14,760
might find a sequel Lite database in

600
00:23:12,930 --> 00:23:19,650
that sequel whit database might be every

601
00:23:14,760 --> 00:23:22,920
regex apps can also there's a demo

602
00:23:19,650 --> 00:23:28,080
license that's free with the same

603
00:23:22,920 --> 00:23:36,710
database on the internet so ya draw your

604
00:23:28,080 --> 00:23:36,710
conclusions questions or random

605
00:23:45,850 --> 00:23:51,169
yeah turns out static I mean I'm on my

606
00:23:49,400 --> 00:23:54,350
personal laptop I just have a monolithic

607
00:23:51,170 --> 00:23:56,150
like no bootloader kernel like just

608
00:23:54,350 --> 00:23:57,649
because it's Gen 2 so it's easier to

609
00:23:56,150 --> 00:23:59,610
keep you stable system that way and like

610
00:23:57,650 --> 00:24:03,250
man all kinds of stuff just doesn't work

611
00:23:59,610 --> 00:24:03,250
[Laughter]

612
00:24:04,960 --> 00:24:12,140
run a bootloader at all yeah yeah it's

613
00:24:09,770 --> 00:24:29,660
it's nothing but waste for people to

614
00:24:12,140 --> 00:24:33,920
mess with you really nothing yes right

615
00:24:29,660 --> 00:24:36,290
so case in point like if you have 2,000

616
00:24:33,920 --> 00:24:37,910
boxes to maintain yeah okay you probably

617
00:24:36,290 --> 00:24:39,530
have a budget to go by at least one

618
00:24:37,910 --> 00:24:41,510
security tool a few of a hundred boxes

619
00:24:39,530 --> 00:24:43,310
to maintain there's probably two admins

620
00:24:41,510 --> 00:24:47,020
in your whole company and both of them

621
00:24:43,310 --> 00:24:47,020
will remember not to type shell code

622
00:24:52,919 --> 00:24:57,520
Roli can I mean like the PC one is like

623
00:24:55,600 --> 00:24:59,260
two lines to a GPO you can do it using

624
00:24:57,520 --> 00:25:00,940
standard utility the Linux stuff like

625
00:24:59,260 --> 00:25:03,730
the modprobe thing like all you need to

626
00:25:00,940 --> 00:25:06,039
do is is go find the source for modprobe

627
00:25:03,730 --> 00:25:08,559
which I publish it a linked you add like

628
00:25:06,039 --> 00:25:10,809
it's 20 lines of C tops to do that Zoar

629
00:25:08,559 --> 00:25:13,720
trick right and then that's a chef's

630
00:25:10,809 --> 00:25:17,039
turret like every time you build a box

631
00:25:13,720 --> 00:25:20,679
add a line of your chef that says Zoar

632
00:25:17,039 --> 00:25:23,860
string against binaries right against

633
00:25:20,679 --> 00:25:26,710
like /live mod right and then our sink

634
00:25:23,860 --> 00:25:28,209
up your your mod pro binary that's your

635
00:25:26,710 --> 00:25:32,080
modified source code like that's that's

636
00:25:28,210 --> 00:25:33,789
maybe 30 lines of chef I mean I guess I

637
00:25:32,080 --> 00:25:35,230
guess I guess if I wanted to be

638
00:25:33,789 --> 00:25:39,760
practical and giving I should have

639
00:25:35,230 --> 00:25:43,350
written that but man busy yeah do hit me

640
00:25:39,760 --> 00:25:43,350
up online buy me a beer maybe I'll do it

641
00:25:43,620 --> 00:25:55,989
anything else really

642
00:25:48,780 --> 00:25:59,309
ha finished early all right sweet I mean

643
00:25:55,990 --> 00:25:59,309
more questions

644
00:26:01,690 --> 00:26:16,559
huh most time you don't have to most the

645
00:26:14,320 --> 00:26:19,000
time they use symbol linking like step

646
00:26:16,559 --> 00:26:21,639
sorry the question was when you rename

647
00:26:19,000 --> 00:26:23,980
syscalls like you know what about stuff

648
00:26:21,639 --> 00:26:25,959
that needs of this is calls most things

649
00:26:23,980 --> 00:26:27,909
that need the SIS calls are built as

650
00:26:25,960 --> 00:26:29,889
part of your operating system against

651
00:26:27,909 --> 00:26:32,110
like the static maps they're not built

652
00:26:29,889 --> 00:26:34,658
against the actual numbers so if you

653
00:26:32,110 --> 00:26:36,279
change the numbers then the only stuff

654
00:26:34,659 --> 00:26:38,620
that doesn't work is stuff that's making

655
00:26:36,279 --> 00:26:42,120
guesses about what thing about where

656
00:26:38,620 --> 00:26:46,840
things are in your kernel ie shell code

657
00:26:42,120 --> 00:26:59,018
yeah am I done

658
00:26:46,840 --> 00:27:01,959
no no that's the question was what

659
00:26:59,019 --> 00:27:03,850
tricks used against me at CCDC are my

660
00:27:01,960 --> 00:27:07,149
veins of existence I'm paraphrasing the

661
00:27:03,850 --> 00:27:08,500
question um I had a team one year at

662
00:27:07,149 --> 00:27:10,809
Nationals who they didn't give them

663
00:27:08,500 --> 00:27:12,309
firewalls and so rather than come up

664
00:27:10,809 --> 00:27:13,570
with a host firewall they took their

665
00:27:12,309 --> 00:27:15,070
Cisco phone and turned it into a

666
00:27:13,570 --> 00:27:17,019
firewall which was super effective

667
00:27:15,070 --> 00:27:18,220
because a falls in the head of firewall

668
00:27:17,019 --> 00:27:21,100
and it was matted and that was annoying

669
00:27:18,220 --> 00:27:23,889
and be because it's a phone so it was

670
00:27:21,100 --> 00:27:28,360
like 10 base T so trying to do recon

671
00:27:23,889 --> 00:27:32,969
from 10 base T's been annoying what else

672
00:27:28,360 --> 00:27:37,120
oh I had a team one year modify their

673
00:27:32,970 --> 00:27:39,940
domain controller such that every system

674
00:27:37,120 --> 00:27:43,090
logged on their domain had to have to

675
00:27:39,940 --> 00:27:44,980
factor off if it was a remote login

676
00:27:43,090 --> 00:27:46,928
because they didn't have to remote login

677
00:27:44,980 --> 00:27:48,789
so it was like you know I would sit

678
00:27:46,929 --> 00:27:49,960
there on remote RDP and try to log into

679
00:27:48,789 --> 00:27:53,279
something and it would be like please

680
00:27:49,960 --> 00:27:58,269
enter your PC card and off dammit

681
00:27:53,279 --> 00:28:01,000
so that was annoying probably I have I

682
00:27:58,269 --> 00:28:02,950
have had I have had teams do the show

683
00:28:01,000 --> 00:28:04,330
like bet shell stuff like I've had teams

684
00:28:02,950 --> 00:28:08,110
do that against me I've had teams like

685
00:28:04,330 --> 00:28:09,789
remap LS to like LSS and have it do like

686
00:28:08,110 --> 00:28:11,229
a snapshot of all the environment

687
00:28:09,789 --> 00:28:12,350
variables so they can totally tell like

688
00:28:11,230 --> 00:28:13,970
what web shell I'm coming in

689
00:28:12,350 --> 00:28:18,678
or what user at back toward or things

690
00:28:13,970 --> 00:28:20,929
like that I've had teams like use my own

691
00:28:18,679 --> 00:28:22,519
Pam back doors against me where they

692
00:28:20,929 --> 00:28:23,840
reversed just where they run strings on

693
00:28:22,519 --> 00:28:25,279
it and they find a random path that

694
00:28:23,840 --> 00:28:27,799
makes no sense and all they do is change

695
00:28:25,279 --> 00:28:29,809
the path so that they get my passwords

696
00:28:27,799 --> 00:28:33,639
as I'm using them to log in rather than

697
00:28:29,809 --> 00:28:36,049
be getting their passwords and it works

698
00:28:33,639 --> 00:28:37,250
totally works because they're trying to

699
00:28:36,049 --> 00:28:38,570
go fast like you don't care you're just

700
00:28:37,250 --> 00:28:39,679
like yeah why doesn't this work and then

701
00:28:38,570 --> 00:28:45,289
like 20 minutes later you're like aw

702
00:28:39,679 --> 00:28:47,539
crap I shouldn't it typed all that yeah

703
00:28:45,289 --> 00:28:48,830
it's mostly just like teams that

704
00:28:47,539 --> 00:28:50,389
actually take the time to like reverse

705
00:28:48,830 --> 00:28:52,129
payloads and fingerprint them like

706
00:28:50,389 --> 00:28:53,899
that's that's annoying because that's I

707
00:28:52,129 --> 00:28:55,370
can't I can't immediately work around

708
00:28:53,899 --> 00:28:56,928
now like if I have one or two payloads

709
00:28:55,370 --> 00:29:00,320
that I'm using to do a thing and as the

710
00:28:56,929 --> 00:29:02,029
game progresses I'm relying on them for

711
00:29:00,320 --> 00:29:03,379
my access and then they actually reverse

712
00:29:02,029 --> 00:29:05,269
one of them long enough to change

713
00:29:03,379 --> 00:29:06,860
something that's like static it's like

714
00:29:05,269 --> 00:29:08,899
well now I have to get back in and swap

715
00:29:06,860 --> 00:29:12,139
it out or recompile that implant because

716
00:29:08,899 --> 00:29:14,000
that's annoying yeah that's the thing oh

717
00:29:12,139 --> 00:29:16,100
I did have one team one year change

718
00:29:14,000 --> 00:29:18,590
their firewall rule to route everything

719
00:29:16,100 --> 00:29:20,059
with a cloud which was annoying it got

720
00:29:18,590 --> 00:29:22,668
around it because I'm just loaded a

721
00:29:20,059 --> 00:29:24,230
server in the cloud but you know it took

722
00:29:22,669 --> 00:29:28,029
some time to figure out like why like

723
00:29:24,230 --> 00:29:28,029
nothing local over silly

724
00:29:34,460 --> 00:29:46,140
sweet alright

725
00:29:36,860 --> 00:29:46,139
[Applause]

