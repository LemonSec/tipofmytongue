1
00:00:00,000 --> 00:00:07,230
user Zoltan balázs speaking on sandbox

2
00:00:03,929 --> 00:00:15,870
detection lick abuse test if<font color="#E5E5E5"> you give</font>

3
00:00:07,230 --> 00:00:17,820
more tools hi everyone how many<font color="#E5E5E5"> of you</font>

4
00:00:15,870 --> 00:00:22,439
know techniques to detect mother

5
00:00:17,820 --> 00:00:25,710
analyzes sandboxes hands up<font color="#CCCCCC"> okay that's</font>

6
00:00:22,439 --> 00:00:29,849
<font color="#E5E5E5">great so this is</font><font color="#CCCCCC"> my</font><font color="#E5E5E5"> name this</font><font color="#CCCCCC"> is where I</font>

7
00:00:25,710 --> 00:00:32,040
work and I'm from Hungary and we are

8
00:00:29,849 --> 00:00:34,500
very small country so we are<font color="#CCCCCC"> very proud</font>

9
00:00:32,040 --> 00:00:36,660
of our achievements for example did you

10
00:00:34,500 --> 00:00:39,239
know that<font color="#CCCCCC"> the Rubik's Cube has been</font>

11
00:00:36,660 --> 00:00:42,989
invented by<font color="#CCCCCC"> the by a Hungarian guy 40</font>

12
00:00:39,239 --> 00:00:46,050
years<font color="#CCCCCC"> ago also the ideal for phone</font>

13
00:00:42,989 --> 00:00:49,019
exchange system was from a Hungarian guy

14
00:00:46,050 --> 00:00:51,629
one<font color="#E5E5E5"> of the developers of</font><font color="#CCCCCC"> visual basic</font>

15
00:00:49,020 --> 00:00:54,539
was Hungarian and last but not least

16
00:00:51,629 --> 00:00:58,440
people who is a very famous for his

17
00:00:54,539 --> 00:01:00,989
Linux hardening security patches and he

18
00:00:58,440 --> 00:01:04,860
achieved a lifetime achievement award at

19
00:01:00,989 --> 00:01:07,880
Def Con he's also a Hungarian guy so we

20
00:01:04,860 --> 00:01:10,350
have a lot<font color="#E5E5E5"> of very cool guys in Hungary</font>

21
00:01:07,880 --> 00:01:13,350
these are the things I'm personally

22
00:01:10,350 --> 00:01:16,860
proud about i vented<font color="#E5E5E5"> I am the developer</font>

23
00:01:13,350 --> 00:01:19,259
of the zombie browser tool kit I have

24
00:01:16,860 --> 00:01:21,900
created<font color="#CCCCCC"> the hardware firewall bypass</font>

25
00:01:19,259 --> 00:01:26,570
tool you can see the presentation about

26
00:01:21,900 --> 00:01:30,689
that on friday from me and i also

27
00:01:26,570 --> 00:01:33,770
implemented some ideas how one can

28
00:01:30,689 --> 00:01:37,589
bypass<font color="#E5E5E5"> the exploit detection of</font>

29
00:01:33,770 --> 00:01:39,329
appliances unfortunately some of the bad

30
00:01:37,590 --> 00:01:43,340
guys read my blog<font color="#CCCCCC"> so they also</font>

31
00:01:39,329 --> 00:01:45,658
implemented my idea but I think

32
00:01:43,340 --> 00:01:49,020
offensives being on the offensive side

33
00:01:45,659 --> 00:01:52,500
helps the evolution of security so this

34
00:01:49,020 --> 00:01:56,429
is not<font color="#E5E5E5"> a bad thing</font><font color="#CCCCCC"> at all I have a very</font>

35
00:01:52,500 --> 00:01:59,040
fun cyber game for you today and you

36
00:01:56,430 --> 00:02:02,610
should look for one of these words on

37
00:01:59,040 --> 00:02:05,100
the slides and whenever you see cyber

38
00:02:02,610 --> 00:02:08,610
phobia or cyber<font color="#E5E5E5"> get</font><font color="#CCCCCC"> done or</font><font color="#E5E5E5"> something</font>

39
00:02:05,100 --> 00:02:12,450
with cyber on the slides just shout that

40
00:02:08,610 --> 00:02:13,360
cyber and you can get a real Hungarian<font color="#CCCCCC"> a</font>

41
00:02:12,450 --> 00:02:25,410
<font color="#E5E5E5">Rubik's Cube</font>

42
00:02:13,360 --> 00:02:28,540
from Hungary<font color="#CCCCCC"> now from now all right so</font>

43
00:02:25,410 --> 00:02:31,570
how many<font color="#E5E5E5"> of you</font><font color="#CCCCCC"> guys are penetration</font>

44
00:02:28,540 --> 00:02:34,959
testers and<font color="#CCCCCC"> root at least once in your</font>

45
00:02:31,570 --> 00:02:39,359
life mother during penetration test ends

46
00:02:34,960 --> 00:02:42,430
up ok how many<font color="#CCCCCC"> of you guys are</font>

47
00:02:39,360 --> 00:02:48,310
developing new mother analyzes sandbox

48
00:02:42,430 --> 00:02:51,160
ends up<font color="#CCCCCC"> ok</font><font color="#E5E5E5"> not many people how many of</font>

49
00:02:48,310 --> 00:02:54,130
you<font color="#CCCCCC"> guys had analyzed mother in your</font>

50
00:02:51,160 --> 00:02:57,430
environment and you so that your mother

51
00:02:54,130 --> 00:03:00,359
was<font color="#E5E5E5"> not</font><font color="#CCCCCC"> running in the sandbox and you</font>

52
00:02:57,430 --> 00:03:04,000
had no<font color="#CCCCCC"> idea why</font><font color="#E5E5E5"> ok quite a few people</font>

53
00:03:00,360 --> 00:03:06,790
good or how many<font color="#E5E5E5"> of you are on the</font>

54
00:03:04,000 --> 00:03:08,890
defensive<font color="#CCCCCC"> side and trying to buy one of</font>

55
00:03:06,790 --> 00:03:11,350
these new shiny appliances which

56
00:03:08,890 --> 00:03:17,440
promised a detection and things like

57
00:03:11,350 --> 00:03:20,109
that<font color="#E5E5E5"> ok great so you might know that the</font>

58
00:03:17,440 --> 00:03:22,450
current mother analyze this word is

59
00:03:20,110 --> 00:03:26,380
basically can be divided into three

60
00:03:22,450 --> 00:03:30,040
<font color="#CCCCCC">parts static automated tests where the</font>

61
00:03:26,380 --> 00:03:33,880
mother is not started and something it

62
00:03:30,040 --> 00:03:38,470
just looks at the code how it looks like

63
00:03:33,880 --> 00:03:40,959
at the binary and it will decide whether

64
00:03:38,470 --> 00:03:44,109
it's<font color="#E5E5E5"> malicious or not for example</font><font color="#CCCCCC"> the</font>

65
00:03:40,959 --> 00:03:47,560
old antivirus engines did that or now

66
00:03:44,110 --> 00:03:51,010
these<font color="#CCCCCC"> next generation thing is there is</font>

67
00:03:47,560 --> 00:03:53,799
<font color="#E5E5E5">the dynamic automated analyzes and my</font>

68
00:03:51,010 --> 00:03:57,100
talk will be about how you can bypass

69
00:03:53,799 --> 00:03:59,920
these dynamic automated analysis when

70
00:03:57,100 --> 00:04:02,590
<font color="#CCCCCC">someone</font><font color="#E5E5E5"> starts the</font><font color="#CCCCCC"> mother in an</font>

71
00:03:59,920 --> 00:04:05,320
environment<font color="#E5E5E5"> and it looks for suspicious</font>

72
00:04:02,590 --> 00:04:08,019
behavior like stealing some files

73
00:04:05,320 --> 00:04:11,560
connecting<font color="#CCCCCC"> to a C&C server things like</font>

74
00:04:08,019 --> 00:04:15,519
that and last but not least we have a

75
00:04:11,560 --> 00:04:17,940
lot of manual analysts but<font color="#CCCCCC"> unfortunately</font>

76
00:04:15,519 --> 00:04:22,050
there are a lot more new model code

77
00:04:17,940 --> 00:04:26,229
daily than the<font color="#E5E5E5"> mavericks can keep up so</font>

78
00:04:22,050 --> 00:04:27,250
even it is very very<font color="#E5E5E5"> hard to deceive or</font>

79
00:04:26,229 --> 00:04:30,070
bypass

80
00:04:27,250 --> 00:04:33,460
real talented neither analyst who is

81
00:04:30,070 --> 00:04:35,500
doing manual analysis but it still

82
00:04:33,460 --> 00:04:40,960
sometimes possible but it's<font color="#E5E5E5"> very hard</font>

83
00:04:35,500 --> 00:04:44,350
work so the name sandbox is a little bit

84
00:04:40,960 --> 00:04:46,359
confusing so I know at least about<font color="#E5E5E5"> three</font>

85
00:04:44,350 --> 00:04:50,190
different sandboxes this is not<font color="#E5E5E5"> the</font>

86
00:04:46,360 --> 00:04:53,170
sandbox<font color="#E5E5E5"> I'm going to talk about</font><font color="#CCCCCC"> today</font>

87
00:04:50,190 --> 00:04:55,090
there are browsers for example which

88
00:04:53,170 --> 00:04:57,700
implements sandbox for example<font color="#E5E5E5"> Chrome</font>

89
00:04:55,090 --> 00:05:00,640
I'm not<font color="#E5E5E5"> going to talk about these kind</font>

90
00:04:57,700 --> 00:05:04,000
of sand boxes I'm going<font color="#E5E5E5"> to talk about</font>

91
00:05:00,640 --> 00:05:06,280
sand boxes which do matter analyzes we

92
00:05:04,000 --> 00:05:09,370
call them bridge detection system or

93
00:05:06,280 --> 00:05:13,270
advanced persistent threat detector or

94
00:05:09,370 --> 00:05:15,490
whatever catchy name they have the main

95
00:05:13,270 --> 00:05:18,810
idea<font color="#CCCCCC"> is that there is</font><font color="#E5E5E5"> mother coming</font>

96
00:05:15,490 --> 00:05:22,930
inside<font color="#CCCCCC"> the box the box does it magic and</font>

97
00:05:18,810 --> 00:05:27,400
you<font color="#E5E5E5"> get an alert or a report that this</font>

98
00:05:22,930 --> 00:05:32,020
is malicious or not so you might see

99
00:05:27,400 --> 00:05:35,770
that sometimes I'm be sarcastic for

100
00:05:32,020 --> 00:05:37,419
about these appliances and actually I

101
00:05:35,770 --> 00:05:40,359
<font color="#CCCCCC">don't have any problems with</font><font color="#E5E5E5"> the</font>

102
00:05:37,419 --> 00:05:43,810
<font color="#CCCCCC">technology itself my problem is usually</font>

103
00:05:40,360 --> 00:05:46,510
the marketing department or the price of

104
00:05:43,810 --> 00:05:48,850
these appliances compared to<font color="#E5E5E5"> the real</font>

105
00:05:46,510 --> 00:05:51,190
value you have to know<font color="#CCCCCC"> that there are</font>

106
00:05:48,850 --> 00:05:54,430
some really good now gore analyzes

107
00:05:51,190 --> 00:05:57,130
appliance since out there but not<font color="#E5E5E5"> all</font><font color="#CCCCCC"> of</font>

108
00:05:54,430 --> 00:06:02,260
them and it is<font color="#CCCCCC"> very hard to compare</font>

109
00:05:57,130 --> 00:06:04,900
these things actually two years<font color="#CCCCCC"> ago me</font>

110
00:06:02,260 --> 00:06:07,539
and some of my colleagues that crisis

111
00:06:04,900 --> 00:06:10,890
love you might have heard about<font color="#E5E5E5"> them had</font>

112
00:06:07,540 --> 00:06:14,919
the idea to create for new mother and

113
00:06:10,890 --> 00:06:19,180
test it against these neither<font color="#CCCCCC"> Alana's</font>

114
00:06:14,919 --> 00:06:22,750
<font color="#CCCCCC">east and boxes and actually we created a</font>

115
00:06:19,180 --> 00:06:26,770
very basic model with a script kiddie

116
00:06:22,750 --> 00:06:30,130
level are two medium ones and one

117
00:06:26,770 --> 00:06:33,039
advanced mother we developed as a small

118
00:06:30,130 --> 00:06:37,150
team in one week and that advanced

119
00:06:33,040 --> 00:06:39,240
mother bypassed all the high-end malware

120
00:06:37,150 --> 00:06:44,250
analysis sandboxes

121
00:06:39,240 --> 00:06:47,370
so it is room for improvement<font color="#E5E5E5"> I would</font>

122
00:06:44,250 --> 00:06:50,130
say also if you<font color="#CCCCCC"> look at</font><font color="#E5E5E5"> the price of</font>

123
00:06:47,370 --> 00:06:54,240
these appliances it can be very

124
00:06:50,130 --> 00:06:56,610
<font color="#CCCCCC">expensive so whenever</font><font color="#E5E5E5"> you are trying to</font>

125
00:06:54,240 --> 00:06:59,130
<font color="#E5E5E5">convince management to buy one of these</font>

126
00:06:56,610 --> 00:07:02,910
<font color="#CCCCCC">boxes you can</font><font color="#E5E5E5"> even try them to convince</font>

127
00:06:59,130 --> 00:07:05,099
to buy this company car for you you can

128
00:07:02,910 --> 00:07:10,710
decide which<font color="#E5E5E5"> is better for you I would</font>

129
00:07:05,099 --> 00:07:14,340
go for<font color="#CCCCCC"> the car so let's meet the hero of</font>

130
00:07:10,710 --> 00:07:16,560
the hour I call him Trevor and trevor is

131
00:07:14,340 --> 00:07:21,119
the<font color="#E5E5E5"> chief of information security</font>

132
00:07:16,560 --> 00:07:23,550
officer at Acme corporation and turbo

133
00:07:21,120 --> 00:07:26,340
has a problem he knows that he's a

134
00:07:23,550 --> 00:07:31,169
current defenses are bypassed whether

135
00:07:26,340 --> 00:07:32,818
it's AV or eat<font color="#E5E5E5"> IDs IPS whatever and he</font>

136
00:07:31,169 --> 00:07:38,130
has the money he wants to do something

137
00:07:32,819 --> 00:07:40,919
<font color="#E5E5E5">but he has no idea what to do and he is</font>

138
00:07:38,130 --> 00:07:43,770
contacted by different vendors and these

139
00:07:40,919 --> 00:07:46,409
vendors tell him that hey we detected

140
00:07:43,770 --> 00:07:48,990
the most 0d exploits last year we are

141
00:07:46,409 --> 00:07:51,479
the best on<font color="#E5E5E5"> the market other vendors can</font>

142
00:07:48,990 --> 00:07:54,479
say we are the most<font color="#E5E5E5"> expensive so you can</font>

143
00:07:51,479 --> 00:07:57,060
be<font color="#CCCCCC"> sure we are the</font><font color="#E5E5E5"> best or other vendors</font>

144
00:07:54,479 --> 00:07:58,710
marketing department can say that we are

145
00:07:57,060 --> 00:08:02,580
<font color="#E5E5E5">the cheapest so you can be still</font>

146
00:07:58,710 --> 00:08:04,620
compliant and save some money so for

147
00:08:02,580 --> 00:08:07,430
Trevor it is a very hard decision which

148
00:08:04,620 --> 00:08:07,430
when door to choose

149
00:08:09,040 --> 00:08:16,460
so travel is very saddened you don't

150
00:08:12,230 --> 00:08:19,220
know what to do so I was<font color="#CCCCCC"> thinking about</font>

151
00:08:16,460 --> 00:08:22,820
<font color="#E5E5E5">how about testing these mother analyzes</font>

152
00:08:19,220 --> 00:08:25,340
sandboxes and it is very important to

153
00:08:22,820 --> 00:08:27,560
say<font color="#CCCCCC"> that there are thousands of expect</font>

154
00:08:25,340 --> 00:08:30,710
how you can test these methanol isaac

155
00:08:27,560 --> 00:08:36,799
stern boxes and i'm only covering a very

156
00:08:30,710 --> 00:08:39,429
small part of it mavar outdoors<font color="#CCCCCC"> know for</font>

157
00:08:36,799 --> 00:08:45,109
a long time that if they can evade these

158
00:08:39,429 --> 00:08:47,839
dynamic analyzes then they can evade

159
00:08:45,110 --> 00:08:50,420
detection for a longer time so they have

160
00:08:47,840 --> 00:08:55,250
implemented tricks to detect these

161
00:08:50,420 --> 00:08:59,240
mother analyzes sandboxes so my research

162
00:08:55,250 --> 00:09:01,760
was focusing on this area<font color="#E5E5E5"> and</font><font color="#CCCCCC"> i have</font>

163
00:08:59,240 --> 00:09:04,010
checked the known techniques how you can

164
00:09:01,760 --> 00:09:07,850
detect<font color="#E5E5E5"> these sand boxes and i also</font>

165
00:09:04,010 --> 00:09:10,340
implemented my idea<font color="#E5E5E5"> and you will see how</font>

166
00:09:07,850 --> 00:09:14,990
<font color="#E5E5E5">these different techniques worked</font>

167
00:09:10,340 --> 00:09:17,690
against these apt detectors but you have

168
00:09:14,990 --> 00:09:21,200
to see that<font color="#CCCCCC"> if very lame and common</font>

169
00:09:17,690 --> 00:09:27,500
mother can evade this apt detector<font color="#E5E5E5"> then</font>

170
00:09:21,200 --> 00:09:30,200
what an intelligence agency can do so if

171
00:09:27,500 --> 00:09:34,310
you are a penetration tester why is it

172
00:09:30,200 --> 00:09:37,790
important to you not getting<font color="#E5E5E5"> detected by</font>

173
00:09:34,310 --> 00:09:40,339
these modernizes sandboxes first of all

174
00:09:37,790 --> 00:09:44,439
your code won't get busted on day one

175
00:09:40,340 --> 00:09:47,300
and you can<font color="#E5E5E5"> continue working and doing</font>

176
00:09:44,440 --> 00:09:51,920
lateral movement privilege escalation

177
00:09:47,300 --> 00:09:55,400
and so on Oh from a developer point of

178
00:09:51,920 --> 00:09:57,650
view it is also<font color="#E5E5E5"> very good idea that if</font>

179
00:09:55,400 --> 00:09:59,720
you can<font color="#E5E5E5"> reuse your mother during</font>

180
00:09:57,650 --> 00:10:05,329
engagements and you don't have to write

181
00:09:59,720 --> 00:10:08,020
<font color="#E5E5E5">new mother from scratch so</font><font color="#CCCCCC"> how many of</font>

182
00:10:05,330 --> 00:10:11,720
you guys<font color="#CCCCCC"> are command and conquer fans</font>

183
00:10:08,020 --> 00:10:15,170
all right very good if you want to

184
00:10:11,720 --> 00:10:18,350
attack the<font color="#CCCCCC"> other team what do you do</font>

185
00:10:15,170 --> 00:10:21,380
first thing send out a scout yet right

186
00:10:18,350 --> 00:10:22,370
you want to know<font color="#E5E5E5"> what's happening inside</font>

187
00:10:21,380 --> 00:10:27,260
<font color="#E5E5E5">his base</font>

188
00:10:22,370 --> 00:10:29,920
you just don't shoot everywhere at<font color="#E5E5E5"> the</font>

189
00:10:27,260 --> 00:10:33,110
beginning of the game you have this very

190
00:10:29,920 --> 00:10:34,880
basic trooper at the end<font color="#E5E5E5"> of the game you</font>

191
00:10:33,110 --> 00:10:37,580
can have the spy plane which is kind of

192
00:10:34,880 --> 00:10:39,890
cool but one thing is sure if you have

193
00:10:37,580 --> 00:10:43,310
the atomic bomb you just don't drop

194
00:10:39,890 --> 00:10:45,980
randomly on the map right you know where

195
00:10:43,310 --> 00:10:49,550
your target is you have mapped his

196
00:10:45,980 --> 00:10:54,680
infrastructure and you send it where you

197
00:10:49,550 --> 00:10:57,680
<font color="#CCCCCC">can really make damage so as I mentioned</font>

198
00:10:54,680 --> 00:11:02,540
the detecting never analyzes sandboxes

199
00:10:57,680 --> 00:11:05,689
it's a not a new idea but as<font color="#E5E5E5"> I have seen</font>

200
00:11:02,540 --> 00:11:10,069
in<font color="#E5E5E5"> the past there is a too much focus on</font>

201
00:11:05,690 --> 00:11:11,960
virtualization detection doing

202
00:11:10,070 --> 00:11:14,510
visualization in the matter<font color="#CCCCCC"> analyzing</font>

203
00:11:11,960 --> 00:11:17,690
sandbox is pretty common because you

204
00:11:14,510 --> 00:11:21,740
want<font color="#CCCCCC"> to save money and it's not a</font>

205
00:11:17,690 --> 00:11:24,350
<font color="#E5E5E5">problem at all but nowadays most of</font>

206
00:11:21,740 --> 00:11:26,839
these mother analyzes sandboxes they

207
00:11:24,350 --> 00:11:31,420
don't see<font color="#E5E5E5"> they don't act like</font>

208
00:11:26,839 --> 00:11:34,750
virtualized environments so even if<font color="#E5E5E5"> i</font>

209
00:11:31,420 --> 00:11:37,760
think i<font color="#CCCCCC"> will tell</font><font color="#E5E5E5"> about this later but</font>

210
00:11:34,750 --> 00:11:41,540
the biggest issue is that there is a

211
00:11:37,760 --> 00:11:43,850
very limited list how you can find out

212
00:11:41,540 --> 00:11:48,469
that Marvel is running inside<font color="#CCCCCC"> the</font>

213
00:11:43,850 --> 00:11:51,560
virtualized environment and if you use

214
00:11:48,470 --> 00:11:54,440
these known techniques to detect it then

215
00:11:51,560 --> 00:11:56,779
your mother will<font color="#CCCCCC"> be flagged as malicious</font>

216
00:11:54,440 --> 00:11:59,959
because it's trying to detect the

217
00:11:56,779 --> 00:12:02,270
virtualized environment so it might have

218
00:11:59,959 --> 00:12:08,510
<font color="#CCCCCC">worked in the past but I'm pretty</font><font color="#E5E5E5"> sure</font>

219
00:12:02,270 --> 00:12:11,720
it won't work<font color="#E5E5E5"> nowadays let me tell you a</font>

220
00:12:08,510 --> 00:12:14,630
very small example on the left you can

221
00:12:11,720 --> 00:12:20,840
see a very<font color="#E5E5E5"> common red remote access</font>

222
00:12:14,630 --> 00:12:22,970
trojan yes cybergate it was not sorry

223
00:12:20,840 --> 00:12:25,400
it was not written on the first slide

224
00:12:22,970 --> 00:12:30,800
you have to look for that specific one

225
00:12:25,400 --> 00:12:35,540
but good catch you can have the fall off

226
00:12:30,800 --> 00:12:38,680
of the Rubik's Cube so and here when you

227
00:12:35,540 --> 00:12:42,680
<font color="#E5E5E5">are creating your Trojan you can click</font>

228
00:12:38,680 --> 00:12:46,640
how well so you can evade all of these

229
00:12:42,680 --> 00:12:48,979
<font color="#E5E5E5">sand boxes like</font><font color="#CCCCCC"> VMware or on obese or CV</font>

230
00:12:46,640 --> 00:12:52,910
sandbox jobox it's a pretty<font color="#E5E5E5"> old one but</font>

231
00:12:48,980 --> 00:12:56,990
it worked at the time but nowadays there

232
00:12:52,910 --> 00:12:59,920
are endpoint protection systems which do

233
00:12:56,990 --> 00:13:03,140
this so called vaccination technique and

234
00:12:59,920 --> 00:13:05,660
<font color="#E5E5E5">it creates an environment for processes</font>

235
00:13:03,140 --> 00:13:09,170
that it looks<font color="#CCCCCC"> like it is a virtualized</font>

236
00:13:05,660 --> 00:13:13,040
environment but it is not it is can be

237
00:13:09,170 --> 00:13:19,520
any notebook or desktop and whenever

238
00:13:13,040 --> 00:13:23,300
this mother is trying to detect this

239
00:13:19,520 --> 00:13:25,790
virtualized environment this endpoint

240
00:13:23,300 --> 00:13:28,250
protection system will fake it it is a

241
00:13:25,790 --> 00:13:31,490
virtualized environment so the mother

242
00:13:28,250 --> 00:13:35,930
put you up wit and also mean vehicles is

243
00:13:31,490 --> 00:13:40,750
monitoring this event it can kill the

244
00:13:35,930 --> 00:13:42,859
mother<font color="#CCCCCC"> and alert and so so on so on so</font>

245
00:13:40,750 --> 00:13:46,640
detecting virtualization<font color="#E5E5E5"> is not a good</font>

246
00:13:42,860 --> 00:13:50,930
idea<font color="#E5E5E5"> I'm pretty sure you all heard about</font>

247
00:13:46,640 --> 00:13:53,960
<font color="#E5E5E5">the hacking team league it was</font><font color="#CCCCCC"> a</font><font color="#E5E5E5"> very</font>

248
00:13:50,930 --> 00:13:57,979
good treasure I would say and reading

249
00:13:53,960 --> 00:14:01,610
all things with what they did there so

250
00:13:57,980 --> 00:14:06,140
if you check what hacking team did they

251
00:14:01,610 --> 00:14:08,870
are also doing this kind of attack where

252
00:14:06,140 --> 00:14:11,689
first they've sent a very tiny piece of

253
00:14:08,870 --> 00:14:15,200
mother this mother checks the

254
00:14:11,690 --> 00:14:19,370
environment like CPU architecture ram

255
00:14:15,200 --> 00:14:23,300
installed installed application and so

256
00:14:19,370 --> 00:14:26,090
handsome<font color="#E5E5E5"> and then it sends this</font>

257
00:14:23,300 --> 00:14:28,310
information to the server at the server

258
00:14:26,090 --> 00:14:30,950
they decide whether this is<font color="#E5E5E5"> their real</font>

259
00:14:28,310 --> 00:14:33,888
target or not and if it's the REE otra

260
00:14:30,950 --> 00:14:38,109
target then they will upgrade this

261
00:14:33,889 --> 00:14:41,480
<font color="#CCCCCC">scout to a light or a sniper agent</font>

262
00:14:38,109 --> 00:14:44,239
soldiers room but they are also doing

263
00:14:41,480 --> 00:14:47,749
this<font color="#CCCCCC"> viendo and virtualbox detection</font>

264
00:14:44,239 --> 00:14:51,709
which is kind of stupid<font color="#E5E5E5"> I'm sure you</font>

265
00:14:47,749 --> 00:14:54,069
<font color="#E5E5E5">cannot see the code here but I have</font><font color="#CCCCCC"> also</font>

266
00:14:51,709 --> 00:14:57,018
written there actually they have

267
00:14:54,069 --> 00:15:01,128
implemented new ways to detect

268
00:14:57,019 --> 00:15:03,529
virtualization but not not the<font color="#E5E5E5"> best way</font>

269
00:15:01,129 --> 00:15:06,949
for example there is a very great

270
00:15:03,529 --> 00:15:13,040
project on github called vbox<font color="#CCCCCC"> hardened</font>

271
00:15:06,949 --> 00:15:17,329
loader and if you use this virtual book

272
00:15:13,040 --> 00:15:19,488
patched VirtualBox this code won't

273
00:15:17,329 --> 00:15:22,189
detect that it is<font color="#E5E5E5"> running inside</font>

274
00:15:19,489 --> 00:15:26,059
virtualized environment I myself<font color="#E5E5E5"> using</font>

275
00:15:22,189 --> 00:15:28,488
this vbox hard and loader project for

276
00:15:26,059 --> 00:15:36,259
malware analysis it's a free and very

277
00:15:28,489 --> 00:15:39,379
good program now let's talk what<font color="#E5E5E5"> I have</font>

278
00:15:36,259 --> 00:15:43,100
created<font color="#CCCCCC"> I have developed</font><font color="#E5E5E5"> a piece of</font>

279
00:15:39,379 --> 00:15:46,459
marble which i upload somehow to these

280
00:15:43,100 --> 00:15:49,009
malware analysis<font color="#CCCCCC"> turn boxes the mother</font>

281
00:15:46,459 --> 00:15:53,319
checks the environment it is<font color="#E5E5E5"> running</font>

282
00:15:49,009 --> 00:15:56,540
inside and it will extract all the

283
00:15:53,319 --> 00:15:59,748
interesting information and send it to

284
00:15:56,540 --> 00:16:02,569
<font color="#E5E5E5">my server there are different</font><font color="#CCCCCC"> ways how</font>

285
00:15:59,749 --> 00:16:05,839
you can extract this information for

286
00:16:02,569 --> 00:16:08,389
example the easiest way if there is a

287
00:16:05,839 --> 00:16:10,759
direct internet connection from the

288
00:16:08,389 --> 00:16:13,910
sandbox to the<font color="#CCCCCC"> Internet in that way i</font>

289
00:16:10,759 --> 00:16:19,459
can easily post any environment data to

290
00:16:13,910 --> 00:16:22,549
my server or sometimes there is no

291
00:16:19,459 --> 00:16:25,488
direct connection but the<font color="#CCCCCC"> maverick lysis</font>

292
00:16:22,549 --> 00:16:29,929
sandbox is resolving the host names to

293
00:16:25,489 --> 00:16:32,689
IP addresses<font color="#E5E5E5"> and here i did this</font><font color="#CCCCCC"> DNS</font>

294
00:16:29,929 --> 00:16:34,730
stone electric so let's say<font color="#CCCCCC"> I'm</font>

295
00:16:32,689 --> 00:16:39,349
controlling the attacker dot-com domain

296
00:16:34,730 --> 00:16:41,299
and whenever my mother checks what is

297
00:16:39,350 --> 00:16:43,910
the IP<font color="#CCCCCC"> address for</font><font color="#E5E5E5"> the host name</font>

298
00:16:41,299 --> 00:16:47,310
microsoft<font color="#E5E5E5"> office is installed on this</font>

299
00:16:43,910 --> 00:16:50,850
computer dot attacker<font color="#CCCCCC"> comb</font>

300
00:16:47,310 --> 00:16:54,060
this query will go through all the<font color="#E5E5E5"> DNS</font>

301
00:16:50,850 --> 00:16:56,370
servers to my server so i will know<font color="#E5E5E5"> that</font>

302
00:16:54,060 --> 00:17:00,630
microsoft office is installed on that

303
00:16:56,370 --> 00:17:03,690
computer sometimes<font color="#E5E5E5"> i have used the</font>

304
00:17:00,630 --> 00:17:06,150
report to leak this information for

305
00:17:03,690 --> 00:17:10,680
example sometimes it creates screenshots

306
00:17:06,150 --> 00:17:12,810
so<font color="#E5E5E5"> i can put all the information and on</font>

307
00:17:10,680 --> 00:17:16,140
the screenshots or sometimes i have

308
00:17:12,810 --> 00:17:18,438
<font color="#CCCCCC">created new files with special file</font>

309
00:17:16,140 --> 00:17:21,870
names like microsoft office installed

310
00:17:18,439 --> 00:17:26,300
<font color="#CCCCCC">Exe so there</font><font color="#E5E5E5"> are many many ways how you</font>

311
00:17:21,869 --> 00:17:28,229
can leak data from these sandboxes

312
00:17:26,300 --> 00:17:32,909
unfortunately i'm not going to<font color="#E5E5E5"> show you</font>

313
00:17:28,230 --> 00:17:39,350
any live demo today but i have a small

314
00:17:32,910 --> 00:17:43,200
video about this so here you can see<font color="#E5E5E5"> a</font>

315
00:17:39,350 --> 00:17:45,919
free very basic<font color="#CCCCCC"> mavar analyzes sandbox</font>

316
00:17:43,200 --> 00:17:48,420
called mother is based on<font color="#E5E5E5"> cuckoo</font>

317
00:17:45,920 --> 00:17:52,320
sometimes<font color="#CCCCCC"> I use it it's it's a good</font>

318
00:17:48,420 --> 00:17:54,630
service and it's free and here you can

319
00:17:52,320 --> 00:17:58,169
see<font color="#CCCCCC"> that i have uploaded my mother to</font>

320
00:17:54,630 --> 00:18:02,750
this matter analyzes sandbox now let's

321
00:17:58,170 --> 00:18:02,750
see what<font color="#CCCCCC"> i can see on my attacker server</font>

322
00:18:03,080 --> 00:18:10,110
you can see that<font color="#E5E5E5"> the mother started to</font>

323
00:18:06,750 --> 00:18:13,230
run and it is leaking all the different

324
00:18:10,110 --> 00:18:16,560
information to my server for example you

325
00:18:13,230 --> 00:18:24,150
<font color="#E5E5E5">can see that the video bios version is</font>

326
00:18:16,560 --> 00:18:33,540
virtual box what else you can see here

327
00:18:24,150 --> 00:18:37,350
that it is a xeon processor here you can

328
00:18:33,540 --> 00:18:40,409
<font color="#E5E5E5">see it is moving the mouse so a lot of</font>

329
00:18:37,350 --> 00:18:45,409
lot of different information can be

330
00:18:40,410 --> 00:18:45,410
found in my server

331
00:18:47,240 --> 00:18:58,040
and now if<font color="#CCCCCC"> we check the report what</font>

332
00:18:52,309 --> 00:19:01,940
happened<font color="#E5E5E5"> here then you will see that it</font>

333
00:18:58,040 --> 00:19:05,270
flagged my mother as malicious because i

334
00:19:01,940 --> 00:19:11,830
was doing too many things here you can

335
00:19:05,270 --> 00:19:16,129
<font color="#E5E5E5">see that it conducted two domains and</font>

336
00:19:11,830 --> 00:19:18,620
here you can<font color="#CCCCCC"> see that</font><font color="#E5E5E5"> for example it</font>

337
00:19:16,130 --> 00:19:28,790
collects information to fingerprint the

338
00:19:18,620 --> 00:19:30,830
system which is true<font color="#CCCCCC"> i did that so one</font>

339
00:19:28,790 --> 00:19:34,100
very important thing is that when you

340
00:19:30,830 --> 00:19:37,669
try to detect the mother<font color="#E5E5E5"> and eliza's</font>

341
00:19:34,100 --> 00:19:40,189
sandbox you shouldn't really use too

342
00:19:37,670 --> 00:19:44,540
much checks because too much checks can

343
00:19:40,190 --> 00:19:50,630
be noisy so you better implement a few

344
00:19:44,540 --> 00:19:55,220
but better checks i have uploaded my

345
00:19:50,630 --> 00:19:59,360
mother<font color="#E5E5E5"> to maybe 60 different sand boxes</font>

346
00:19:55,220 --> 00:20:02,270
and i have<font color="#CCCCCC"> created statistics how the</font>

347
00:19:59,360 --> 00:20:05,928
different sandbox detection techniques

348
00:20:02,270 --> 00:20:09,559
worked and i will use<font color="#E5E5E5"> these two small</font>

349
00:20:05,929 --> 00:20:15,880
icons on the<font color="#E5E5E5"> next slides about the</font>

350
00:20:09,559 --> 00:20:21,110
effectiveness so if you see this big red

351
00:20:15,880 --> 00:20:23,660
icon it means it is a good effective and

352
00:20:21,110 --> 00:20:27,678
so my very malicious sandbox detection

353
00:20:23,660 --> 00:20:31,520
effectiveness but if you see this big

354
00:20:27,679 --> 00:20:36,710
trap it means that<font color="#E5E5E5"> it</font><font color="#CCCCCC"> is very</font><font color="#E5E5E5"> easy to</font>

355
00:20:31,520 --> 00:20:39,800
catch this technique if the red icon is

356
00:20:36,710 --> 00:20:43,190
small it means it's not<font color="#E5E5E5"> a very effective</font>

357
00:20:39,800 --> 00:20:46,970
technique to<font color="#CCCCCC"> detection</font><font color="#E5E5E5"> boxes and if the</font>

358
00:20:43,190 --> 00:20:50,380
trap is small it means that sandboxes

359
00:20:46,970 --> 00:20:53,390
cannot really detect this technique

360
00:20:50,380 --> 00:20:56,419
first and easiest technique was check

361
00:20:53,390 --> 00:20:59,750
for screen resolution on the top<font color="#CCCCCC"> you can</font>

362
00:20:56,419 --> 00:21:03,770
see a statistics from browsers

363
00:20:59,750 --> 00:21:07,010
and as you can see only let them know

364
00:21:03,770 --> 00:21:12,710
seven percent of the users used these

365
00:21:07,010 --> 00:21:14,629
small resolutions and it is a very

366
00:21:12,710 --> 00:21:17,690
<font color="#CCCCCC">interesting technique because you can</font>

367
00:21:14,630 --> 00:21:21,110
even<font color="#E5E5E5"> do this screen resolution detection</font>

368
00:21:17,690 --> 00:21:24,040
even from<font color="#E5E5E5"> the browser itself so if we</font>

369
00:21:21,110 --> 00:21:27,649
<font color="#CCCCCC">are talking about exploit kids it is</font>

370
00:21:24,040 --> 00:21:32,330
very easy to detect this is a sandbox<font color="#E5E5E5"> at</font>

371
00:21:27,650 --> 00:21:36,920
the very beginning of the attack and<font color="#CCCCCC"> the</font>

372
00:21:32,330 --> 00:21:40,699
results were that almost eighty percent

373
00:21:36,920 --> 00:21:43,880
of the sandbox is used very very low

374
00:21:40,700 --> 00:21:49,580
resolution I mean I have no<font color="#CCCCCC"> idea who is</font>

375
00:21:43,880 --> 00:21:52,850
using 640 x screen resolution on his

376
00:21:49,580 --> 00:21:58,159
desktop but some of the matter and Alice

377
00:21:52,850 --> 00:22:01,159
did so it is<font color="#CCCCCC"> a quite huge problem but as</font>

378
00:21:58,160 --> 00:22:05,410
you can see there were sand boxes which

379
00:22:01,160 --> 00:22:08,510
used very high resolution which is good

380
00:22:05,410 --> 00:22:11,990
next I checked for<font color="#CCCCCC"> the install software</font>

381
00:22:08,510 --> 00:22:15,379
and here i have listed some of<font color="#E5E5E5"> the</font>

382
00:22:11,990 --> 00:22:19,340
<font color="#E5E5E5">software's which you usually don't find</font>

383
00:22:15,380 --> 00:22:22,640
on a typical desktop and the last one is

384
00:22:19,340 --> 00:22:26,090
<font color="#E5E5E5">the most interesting</font><font color="#CCCCCC"> one because it was</font>

385
00:22:22,640 --> 00:22:30,200
ve<font color="#CCCCCC"> ver tools and the story behind this</font>

386
00:22:26,090 --> 00:22:33,560
that some mother checked for<font color="#CCCCCC"> the string</font>

387
00:22:30,200 --> 00:22:37,400
<font color="#E5E5E5">we and their tools so the sandbox</font>

388
00:22:33,560 --> 00:22:41,240
developers tried to bypass this and they

389
00:22:37,400 --> 00:22:43,730
renamed<font color="#E5E5E5"> VMware tools to vivere tools but</font>

390
00:22:41,240 --> 00:22:46,160
if you are<font color="#E5E5E5"> leaking this data to a server</font>

391
00:22:43,730 --> 00:22:48,470
and check it manually you<font color="#CCCCCC"> can be one</font>

392
00:22:46,160 --> 00:22:50,750
hundred percent sure<font color="#E5E5E5"> that this is not a</font>

393
00:22:48,470 --> 00:22:54,560
desktop this is a<font color="#E5E5E5"> never</font><font color="#CCCCCC"> analyzes</font>

394
00:22:50,750 --> 00:22:58,700
environment<font color="#E5E5E5"> I have also checked the</font>

395
00:22:54,560 --> 00:23:02,240
running processes I'm not sure you can

396
00:22:58,700 --> 00:23:07,880
see dumper or fake server on any real

397
00:23:02,240 --> 00:23:10,870
desktop<font color="#E5E5E5"> I have also checked the cpu type</font>

398
00:23:07,880 --> 00:23:13,389
and this turned out quite interesting

399
00:23:10,870 --> 00:23:19,580
because

400
00:23:13,389 --> 00:23:22,279
usually the fact that this system is

401
00:23:19,580 --> 00:23:25,820
virtualized is he done very well but

402
00:23:22,279 --> 00:23:28,130
they don't fake the processor so if you

403
00:23:25,820 --> 00:23:30,320
are attacking for example desktop users

404
00:23:28,130 --> 00:23:34,480
through the browser you can be sure that

405
00:23:30,320 --> 00:23:38,330
<font color="#CCCCCC">it is not</font><font color="#E5E5E5"> a xeon processor right or a</font>

406
00:23:34,480 --> 00:23:40,340
quad core opteron or whatever what's

407
00:23:38,330 --> 00:23:43,549
strange that<font color="#CCCCCC"> i have found some pentium</font>

408
00:23:40,340 --> 00:23:46,428
pro and pentium two processors I have no

409
00:23:43,549 --> 00:23:50,600
<font color="#E5E5E5">idea what's going on there but again</font>

410
00:23:46,429 --> 00:23:54,679
there were some sand boxes which either

411
00:23:50,600 --> 00:23:58,189
<font color="#E5E5E5">fake or were really using desktop CPUs</font>

412
00:23:54,679 --> 00:23:59,840
like at home or core<font color="#E5E5E5"> 2 duo so this</font>

413
00:23:58,190 --> 00:24:03,409
technique turned out to be a<font color="#E5E5E5"> very</font>

414
00:23:59,840 --> 00:24:05,178
effective one it is also a known

415
00:24:03,409 --> 00:24:08,919
technique to check for the number of

416
00:24:05,179 --> 00:24:11,899
course dedicated to the system and

417
00:24:08,919 --> 00:24:15,139
unfortunately most of the<font color="#E5E5E5"> free sandboxes</font>

418
00:24:11,899 --> 00:24:19,279
use only one core which is not common in

419
00:24:15,139 --> 00:24:21,289
a new modern desktop but<font color="#CCCCCC"> I have seen for</font>

420
00:24:19,279 --> 00:24:26,409
<font color="#E5E5E5">example sandbox in Ukraine which were</font>

421
00:24:21,289 --> 00:24:30,129
using four cores<font color="#E5E5E5"> that was pretty cool I</font>

422
00:24:26,409 --> 00:24:33,980
have also checked the computer system

423
00:24:30,129 --> 00:24:36,439
it's more<font color="#E5E5E5"> or less virtualization</font>

424
00:24:33,980 --> 00:24:40,190
<font color="#E5E5E5">detection but again this turned out to</font>

425
00:24:36,440 --> 00:24:44,600
<font color="#CCCCCC">be very interesting for example if you</font>

426
00:24:40,190 --> 00:24:48,950
see box or kvm you can be sure<font color="#CCCCCC"> that this</font>

427
00:24:44,600 --> 00:24:51,980
is a mother analyzes sandbox and here

428
00:24:48,950 --> 00:24:55,759
again I i saw that these kind of

429
00:24:51,980 --> 00:24:58,190
<font color="#E5E5E5">information is not faked or simulated by</font>

430
00:24:55,759 --> 00:25:00,830
the<font color="#CCCCCC"> sand boxes</font><font color="#E5E5E5"> at all so you can see a</font>

431
00:24:58,190 --> 00:25:02,600
lot of server platform and again if you

432
00:25:00,830 --> 00:25:05,779
know<font color="#CCCCCC"> that your target is another desktop</font>

433
00:25:02,600 --> 00:25:11,178
you can be sure that<font color="#CCCCCC"> the server platform</font>

434
00:25:05,779 --> 00:25:14,169
is not your target a very<font color="#E5E5E5"> old technique</font>

435
00:25:11,179 --> 00:25:17,419
is to check for the mouse movement and

436
00:25:14,169 --> 00:25:20,000
it turned out that eighty percent of the

437
00:25:17,419 --> 00:25:24,169
sandboxes had no mouse movement at all

438
00:25:20,000 --> 00:25:26,870
and only temp twenty percent simulated

439
00:25:24,169 --> 00:25:30,050
the mouse movement also<font color="#E5E5E5"> it was easy</font>

440
00:25:26,870 --> 00:25:37,580
catch that some of the coordinates were

441
00:25:30,050 --> 00:25:41,750
not very human-like like 00<font color="#CCCCCC"> I also</font>

442
00:25:37,580 --> 00:25:44,540
checked for<font color="#CCCCCC"> the RAM size because</font>

443
00:25:41,750 --> 00:25:48,590
nowadays no one can use the internet

444
00:25:44,540 --> 00:25:52,370
with two gigabyte of RAM and it turned

445
00:25:48,590 --> 00:25:57,409
out that again most of these sandboxes

446
00:25:52,370 --> 00:25:59,989
are using very small amount of<font color="#CCCCCC"> RAM but</font>

447
00:25:57,410 --> 00:26:02,750
<font color="#E5E5E5">again there were some</font><font color="#CCCCCC"> goods</font><font color="#E5E5E5"> and boxes</font>

448
00:25:59,990 --> 00:26:06,290
which used for example<font color="#CCCCCC"> 4 gigabyte of</font><font color="#E5E5E5"> RAM</font>

449
00:26:02,750 --> 00:26:12,710
so it's not<font color="#CCCCCC"> the best way to detect some</font>

450
00:26:06,290 --> 00:26:16,270
boxes but it's a good one i have also

451
00:26:12,710 --> 00:26:20,660
checked the machine name yeah exactly

452
00:26:16,270 --> 00:26:26,300
you can decide whoever wants the<font color="#CCCCCC"> Rubik's</font>

453
00:26:20,660 --> 00:26:29,360
<font color="#CCCCCC">Cube best so I did this just for fun but</font>

454
00:26:26,300 --> 00:26:31,760
naming your sandbox as sandbox.a or

455
00:26:29,360 --> 00:26:34,909
<font color="#E5E5E5">vinick's</font><font color="#CCCCCC"> pamela test is not the</font><font color="#E5E5E5"> best</font>

456
00:26:31,760 --> 00:26:39,170
idea but if you really know your target

457
00:26:34,910 --> 00:26:41,870
and<font color="#E5E5E5"> you hard code your machine name in</font>

458
00:26:39,170 --> 00:26:48,559
your mother it it will only run on that

459
00:26:41,870 --> 00:26:53,600
machine that can be very powerful I will

460
00:26:48,559 --> 00:26:56,360
share my slides with you at the end of

461
00:26:53,600 --> 00:26:59,330
the presentation and I have a whole lot

462
00:26:56,360 --> 00:27:02,479
<font color="#CCCCCC">of collection of nether analyzes</font>

463
00:26:59,330 --> 00:27:05,960
sandboxes screenshots this is a one<font color="#CCCCCC"> of</font>

464
00:27:02,480 --> 00:27:09,170
them and I need your help<font color="#E5E5E5"> to analyze</font>

465
00:27:05,960 --> 00:27:11,300
with me why this is<font color="#CCCCCC"> mavar analyzes</font>

466
00:27:09,170 --> 00:27:16,120
sandbox and not a desktop user

467
00:27:11,300 --> 00:27:16,120
workstation yes

468
00:27:19,540 --> 00:27:26,810
yes it's a yes it's a default background

469
00:27:23,740 --> 00:27:28,520
that's what you are saying right yes so

470
00:27:26,810 --> 00:27:34,190
it<font color="#CCCCCC"> nobody's using that default</font>

471
00:27:28,520 --> 00:27:46,550
background right and no no icons on the

472
00:27:34,190 --> 00:27:48,770
desktop usually it's full sorry I'm

473
00:27:46,550 --> 00:28:01,760
sorry I can't hear you but I'm sure you

474
00:27:48,770 --> 00:28:07,879
<font color="#CCCCCC">are right empty recycle bin exactly the</font>

475
00:28:01,760 --> 00:28:10,220
old<font color="#CCCCCC"> version of adobe reader yes now the</font>

476
00:28:07,880 --> 00:28:17,780
<font color="#E5E5E5">question mark I think it's legit I</font><font color="#CCCCCC"> would</font>

477
00:28:10,220 --> 00:28:20,810
say no it's a screenshot so no running

478
00:28:17,780 --> 00:28:22,790
applications so there<font color="#CCCCCC"> are so many things</font>

479
00:28:20,810 --> 00:28:25,370
happening on this screenshot that you

480
00:28:22,790 --> 00:28:27,080
can tell this is not this is another

481
00:28:25,370 --> 00:28:30,590
<font color="#E5E5E5">analysis sandbox and not a desktop</font>

482
00:28:27,080 --> 00:28:34,490
environment here<font color="#E5E5E5"> the</font><font color="#CCCCCC"> I didn't even try</font>

483
00:28:30,590 --> 00:28:38,270
to hide anything what's going on again

484
00:28:34,490 --> 00:28:40,250
this<font color="#CCCCCC"> is another sandbox and I think if</font>

485
00:28:38,270 --> 00:28:43,490
you are<font color="#CCCCCC"> developing another</font><font color="#E5E5E5"> analysis</font>

486
00:28:40,250 --> 00:28:45,800
sandbox this is how your sandbox should

487
00:28:43,490 --> 00:28:50,090
look like actually this is real

488
00:28:45,800 --> 00:28:52,629
screenshot if you download the hacked

489
00:28:50,090 --> 00:28:55,970
team torrent and browse for the

490
00:28:52,630 --> 00:28:58,190
administrator see Posey and check for

491
00:28:55,970 --> 00:29:00,350
the screenshots you can see a whole

492
00:28:58,190 --> 00:29:03,170
bunch of these screenshots that he was

493
00:29:00,350 --> 00:29:08,209
the very busy hardening their network

494
00:29:03,170 --> 00:29:10,550
against the attackers so if you see this

495
00:29:08,210 --> 00:29:13,160
you can be sure this is a real user and

496
00:29:10,550 --> 00:29:17,629
this is how your mother analyzes sandbox

497
00:29:13,160 --> 00:29:22,610
should look like<font color="#E5E5E5"> I have also checked for</font>

498
00:29:17,630 --> 00:29:26,510
<font color="#E5E5E5">ten drives of flash drives and i have</font>

499
00:29:22,610 --> 00:29:31,539
seen free sandboxes and in these free

500
00:29:26,510 --> 00:29:34,340
set boxes there was only one flash drive

501
00:29:31,539 --> 00:29:36,799
and there were no sandbox is at all of

502
00:29:34,340 --> 00:29:40,459
which had at least two if you check a

503
00:29:36,799 --> 00:29:44,059
<font color="#E5E5E5">real desktop user you will see 10 or 20</font>

504
00:29:40,460 --> 00:29:47,029
<font color="#CCCCCC">or 100 or whatever this is my best</font>

505
00:29:44,059 --> 00:29:51,139
technique to check for the printer and

506
00:29:47,029 --> 00:29:54,230
if you filter out the default ones like

507
00:29:51,139 --> 00:29:57,139
<font color="#CCCCCC">Windows printers</font><font color="#E5E5E5"> Adobe or office there</font>

508
00:29:54,230 --> 00:30:00,259
was no sand box on the world which had

509
00:29:57,139 --> 00:30:03,350
printers at art but most of the desktop

510
00:30:00,259 --> 00:30:06,409
users has there are a bunch of not

511
00:30:03,350 --> 00:30:09,049
effective ways to detect some boxes I

512
00:30:06,409 --> 00:30:11,779
have also checked for the<font color="#E5E5E5"> number of</font>

513
00:30:09,049 --> 00:30:14,840
recently modified created files it

514
00:30:11,779 --> 00:30:19,360
turned out<font color="#CCCCCC"> to be a good and effective</font>

515
00:30:14,840 --> 00:30:22,449
way but it's quite slow unfortunately

516
00:30:19,360 --> 00:30:24,439
you can implement your mother analyzes

517
00:30:22,450 --> 00:30:29,509
sandbox detection techniques in

518
00:30:24,440 --> 00:30:35,059
different layers and best the best is to

519
00:30:29,509 --> 00:30:38,450
implement your decision on the first

520
00:30:35,059 --> 00:30:40,999
<font color="#E5E5E5">layer and implement all ears so for</font>

521
00:30:38,450 --> 00:30:44,799
<font color="#E5E5E5">example you can have an automated</font>

522
00:30:40,999 --> 00:30:47,149
decision in the matter itself which has

523
00:30:44,799 --> 00:30:50,840
which<font color="#CCCCCC"> is good because you won't you</font>

524
00:30:47,149 --> 00:30:53,119
won't leak the<font color="#E5E5E5"> CNC server but you cannot</font>

525
00:30:50,840 --> 00:30:54,980
implement many things here and<font color="#E5E5E5"> also the</font>

526
00:30:53,119 --> 00:30:58,220
<font color="#E5E5E5">analyst will know what you are checking</font>

527
00:30:54,980 --> 00:31:01,899
<font color="#E5E5E5">for</font><font color="#CCCCCC"> you can leave</font><font color="#E5E5E5"> some information</font><font color="#CCCCCC"> to</font>

528
00:30:58,220 --> 00:31:04,850
the CNC server and do automated<font color="#E5E5E5"> the</font>

529
00:31:01,899 --> 00:31:10,100
decision there but now you are leaking

530
00:31:04,850 --> 00:31:13,730
the CNC server you<font color="#CCCCCC"> can also do things</font>

531
00:31:10,100 --> 00:31:16,789
like stealing screenshots for for

532
00:31:13,730 --> 00:31:18,759
<font color="#E5E5E5">example days and after one day you can</font>

533
00:31:16,789 --> 00:31:22,759
decide whether this is a real user

534
00:31:18,759 --> 00:31:25,490
workstation or not but as<font color="#E5E5E5"> I said the</font>

535
00:31:22,759 --> 00:31:32,529
best is to implement all and acquit on

536
00:31:25,490 --> 00:31:36,110
the first detection there are some<font color="#E5E5E5"> very</font>

537
00:31:32,529 --> 00:31:39,289
interesting techniques which<font color="#E5E5E5"> I can i</font>

538
00:31:36,110 --> 00:31:42,740
think is<font color="#E5E5E5"> very hard to solve for sandbox</font>

539
00:31:39,289 --> 00:31:44,629
developers one of the most<font color="#E5E5E5"> interesting</font>

540
00:31:42,740 --> 00:31:44,899
questions is whether the<font color="#CCCCCC"> sleeve</font><font color="#E5E5E5"> function</font>

541
00:31:44,629 --> 00:31:48,228
is

542
00:31:44,899 --> 00:31:51,080
related or not very<font color="#CCCCCC"> old technique is to</font>

543
00:31:48,229 --> 00:31:53,419
start the<font color="#E5E5E5"> Maverick seclusion with a long</font>

544
00:31:51,080 --> 00:31:57,619
sleep if you start<font color="#E5E5E5"> it with the long</font>

545
00:31:53,419 --> 00:32:00,759
sleep it will the sandbox will timeout

546
00:31:57,619 --> 00:32:03,468
after five minutes<font color="#E5E5E5"> or two minutes and</font>

547
00:32:00,759 --> 00:32:07,309
there will be<font color="#E5E5E5"> no malicious behavior at</font>

548
00:32:03,469 --> 00:32:10,159
all so sandboxes started to simulate the

549
00:32:07,309 --> 00:32:15,339
sleep call so it will say to the matter

550
00:32:10,159 --> 00:32:18,589
hey seven days already passed but the

551
00:32:15,339 --> 00:32:21,440
problem<font color="#CCCCCC"> here is that I some other</font>

552
00:32:18,589 --> 00:32:25,460
developer can easily detect that the

553
00:32:21,440 --> 00:32:28,059
sleep is emulated on this box what I

554
00:32:25,460 --> 00:32:31,969
<font color="#E5E5E5">implemented is I start two frets</font>

555
00:32:28,059 --> 00:32:34,908
simultaneously one<font color="#CCCCCC"> thread is doing some</font>

556
00:32:31,969 --> 00:32:38,229
hard calculations for example hashing

557
00:32:34,909 --> 00:32:41,869
for hundreds of thousands of time and

558
00:32:38,229 --> 00:32:47,269
the other fred is sleeping<font color="#E5E5E5"> and whenever</font>

559
00:32:41,869 --> 00:32:52,849
sleep is simulated or not the threads

560
00:32:47,269 --> 00:32:56,629
viola and differently<font color="#E5E5E5"> and by checking</font>

561
00:32:52,849 --> 00:32:59,119
which Fred<font color="#CCCCCC"> ended the first finish the</font>

562
00:32:56,629 --> 00:33:01,279
execution first I will note that sleep

563
00:32:59,119 --> 00:33:04,039
is simulated or not and if<font color="#E5E5E5"> it's slim</font>

564
00:33:01,279 --> 00:33:09,080
elated I can be sure that<font color="#E5E5E5"> this was a</font>

565
00:33:04,039 --> 00:33:13,639
<font color="#CCCCCC">sound box I have a lot of lessons</font>

566
00:33:09,080 --> 00:33:16,668
<font color="#E5E5E5">learned for example if you are mother</font>

567
00:33:13,639 --> 00:33:19,968
brighter it is very easy to find out

568
00:33:16,669 --> 00:33:23,359
<font color="#CCCCCC">different ways</font><font color="#E5E5E5"> to</font><font color="#CCCCCC"> detect these matter</font>

569
00:33:19,969 --> 00:33:26,599
and isaac stern boxes but if you<font color="#CCCCCC"> are a</font>

570
00:33:23,359 --> 00:33:29,418
sandbox developer and you are selling

571
00:33:26,599 --> 00:33:33,499
your sandbox for hard money then you

572
00:33:29,419 --> 00:33:37,309
<font color="#E5E5E5">should really really do research how</font>

573
00:33:33,499 --> 00:33:39,830
your sandbox can be detected and one of

574
00:33:37,309 --> 00:33:43,428
my best advice is to dump a real user

575
00:33:39,830 --> 00:33:45,830
workstation sanitize it like removing or

576
00:33:43,429 --> 00:33:48,799
confidential data and then<font color="#E5E5E5"> you should</font>

577
00:33:45,830 --> 00:33:53,389
update this real desktop workstation

578
00:33:48,799 --> 00:33:58,100
with user activity so after<font color="#CCCCCC"> a good test</font>

579
00:33:53,389 --> 00:34:03,610
I think Trevor can choose wisely

580
00:33:58,100 --> 00:34:07,928
the witch apt detector he wants to buy

581
00:34:03,610 --> 00:34:11,149
so that's all<font color="#E5E5E5"> folks on the first link</font>

582
00:34:07,929 --> 00:34:14,540
you can download my mother which<font color="#CCCCCC"> I have</font>

583
00:34:11,149 --> 00:34:18,350
created<font color="#E5E5E5"> it's open source you</font><font color="#CCCCCC"> can contact</font>

584
00:34:14,540 --> 00:34:22,340
me<font color="#E5E5E5"> on Twitter on SlideShare you can see</font>

585
00:34:18,350 --> 00:34:25,639
my slides or you can see also this

586
00:34:22,340 --> 00:34:28,840
screenshot collection<font color="#CCCCCC"> I had and last but</font>

587
00:34:25,639 --> 00:34:32,060
not least in<font color="#E5E5E5"> Hungary we have a great</font>

588
00:34:28,840 --> 00:34:34,790
hacker conference call activity so<font color="#CCCCCC"> I</font>

589
00:34:32,060 --> 00:34:37,520
invite all of you to come<font color="#E5E5E5"> there it's a</font>

590
00:34:34,790 --> 00:34:44,750
very great conference thank you for<font color="#E5E5E5"> your</font>

591
00:34:37,520 --> 00:34:46,340
attention sorry and if anyone<font color="#E5E5E5"> has any</font>

592
00:34:44,750 --> 00:34:48,168
<font color="#CCCCCC">questions that they have want to ask if</font>

593
00:34:46,340 --> 00:34:50,419
they want to<font color="#E5E5E5"> join zalto know the odds</font>

594
00:34:48,168 --> 00:34:51,589
third booth you'll have about nine

595
00:34:50,418 --> 00:34:53,509
minutes or so just before<font color="#E5E5E5"> the next</font>

596
00:34:51,590 --> 00:34:56,050
<font color="#E5E5E5">presentation once again if you can give</font>

597
00:34:53,510 --> 00:34:56,050
a big thank<font color="#E5E5E5"> you</font>

