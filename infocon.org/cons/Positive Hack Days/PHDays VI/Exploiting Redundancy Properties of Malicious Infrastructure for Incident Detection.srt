1
00:00:00,000 --> 00:00:07,470
manager at fidelis cybersecurity and i'm
here to talk about exploiting redundancy

2
00:00:07,470 --> 00:00:12,210
properties in malicious infrastructure
so brief introduction

3
00:00:12,210 --> 00:00:16,560
I do work for security company fidelis i
also teach at the University of Illinois

4
00:00:16,560 --> 00:00:23,400
hands on security course I run several
private groups for threat intelligence

5
00:00:23,400 --> 00:00:28,320
sharing and some targeted operations
against various malware families

6
00:00:28,320 --> 00:00:34,170
professionally I generally focus only on
criminal threats not espionage or apt

7
00:00:34,170 --> 00:00:38,219
stuff so that does color a little bit of
what I do

8
00:00:39,000 --> 00:00:44,219
so here's kind of just a brief highlight
of what we're going to talk about today

9
00:00:44,219 --> 00:00:48,780
talking about single point of failure vs
redundancy and then going down of

10
00:00:48,780 --> 00:00:54,180
various different ways that you can
exploit redundancy to either effect

11
00:00:54,180 --> 00:00:58,260
malicious networks detect them detect
unknown threats

12
00:00:58,260 --> 00:01:01,260
I'm going on - surveillance and more
effective takedowns

13
00:01:03,059 --> 00:01:08,729
so what I mean by redundancy right is a
similar similar thing an IT

14
00:01:08,729 --> 00:01:12,090
infrastructure of not having single
points of failure

15
00:01:12,090 --> 00:01:18,630
there are many malware families in our
campaigns that use a single single

16
00:01:18,630 --> 00:01:24,270
method of communication a given IP
address a static hostname something

17
00:01:24,270 --> 00:01:30,420
along those lines so the state of of a
c2 is either up or down right there is

18
00:01:30,420 --> 00:01:32,220
no ambiguity of things there

19
00:01:32,220 --> 00:01:35,939
it's very easy to set up low cost to
maintain right

20
00:01:35,939 --> 00:01:41,970
entry-level adversaries tend to do this
because they don't have a lot of time or

21
00:01:41,970 --> 00:01:46,679
experience in setting up SI toos
correctly they just want to make money

22
00:01:46,680 --> 00:01:49,320
quickly or commit crimes quickly

23
00:01:49,320 --> 00:01:53,189
you know the downside is if there's any
kind of disruption right it's the

24
00:01:53,189 --> 00:01:55,529
network the c2 is either up or down

25
00:01:55,530 --> 00:02:00,210
so you know if there is a malicious
hostname at no IP

26
00:02:00,210 --> 00:02:05,190
no IP suspends it well the adversary is
completely out of luck there's there are

27
00:02:05,190 --> 00:02:10,079
their victims are unavailable to them
right though the one thing i want to

28
00:02:10,080 --> 00:02:14,880
emphasize throughout throughout this
talk right is the idea that a single

29
00:02:14,880 --> 00:02:18,780
data point you can establish a pattern
based on that right

30
00:02:18,780 --> 00:02:22,710
you know there's no line there's not
there's nothing to correlate to

31
00:02:22,710 --> 00:02:25,620
something else so if somebody is using a
host name right there is no way to

32
00:02:25,620 --> 00:02:27,720
create a pattern out of that behavior

33
00:02:27,720 --> 00:02:32,430
you need multiple data points right so
the creation that pattern is some

34
00:02:32,430 --> 00:02:38,940
creation of patterns as we'll talk about
of as we go on and what we're exploiting

35
00:02:38,940 --> 00:02:39,810
right

36
00:02:39,810 --> 00:02:42,960
the longer an attacker right

37
00:02:42,960 --> 00:02:46,830
you know is in the game committing
criminal activity the more likely they

38
00:02:46,830 --> 00:02:51,900
are to enhance their operations to
persist over the long term

39
00:02:51,900 --> 00:02:56,160
I you know most attackers want to keep
committing crimes and not just in it to

40
00:02:56,160 --> 00:02:57,630
hit something to go away

41
00:02:57,630 --> 00:03:04,290
right as a counterpoint espionage apt
type actors they're more likely to have

42
00:03:04,290 --> 00:03:09,420
their c2 is only open or uh up for small
periods of time when their operational

43
00:03:09,420 --> 00:03:13,859
criminal actors tend to want to be up
persistently and over the long term

44
00:03:14,400 --> 00:03:20,850
I'm so as an example of c2 configuration
and this is an example for a system will

45
00:03:20,850 --> 00:03:23,880
talk about a little bit more as we go on
in barn cat

46
00:03:23,880 --> 00:03:29,190
I'm not sure that this is as easily
viewed by everybody in the audience but

47
00:03:29,190 --> 00:03:34,079
basically this little JSON blob is a
configuration for dark comment and

48
00:03:34,080 --> 00:03:38,940
there's only 1 C 2 in this right here is
this IP address

49
00:03:38,940 --> 00:03:42,870
so if that IP is taken down right this
malware campaign is over

50
00:03:43,380 --> 00:03:47,760
you know dark , it also has the ability
to have multiple see - so in this case

51
00:03:47,760 --> 00:03:53,190
you're seeing several they're all know I
p but i think this one was like 12

52
00:03:53,190 --> 00:03:59,280
different host names of crazy month you
on crazy monkey to up to like 12 and no

53
00:03:59,280 --> 00:04:00,090
IP

54
00:04:00,090 --> 00:04:05,370
so all of those can point to different
places you know so if one word we're

55
00:04:05,370 --> 00:04:08,850
taking down or the computer behind one
we're taking down

56
00:04:08,850 --> 00:04:11,850
they can simply just reassert control
other ways

57
00:04:13,260 --> 00:04:16,700
there's several different techniques
that that now authors and

58
00:04:16,700 --> 00:04:21,229
adversary's use to establish redundancy
right now and none of this should be

59
00:04:21,230 --> 00:04:22,460
particularly new right

60
00:04:22,460 --> 00:04:27,469
the first right is just multiple
hostname or IP addresses in a static

61
00:04:27,470 --> 00:04:29,750
list what you saw on the previous slide
right

62
00:04:29,750 --> 00:04:33,800
you know very rudimentary right there is
a use of fast flux or double flux

63
00:04:33,800 --> 00:04:40,070
networks domain generation algorithms
tour in the various animals ation

64
00:04:40,070 --> 00:04:42,230
protocols

65
00:04:42,230 --> 00:04:48,350
many will do multiple different methods
right so it was in some banking about

66
00:04:48,350 --> 00:04:53,870
families banking now where families will
see the use of some static lists DJs and

67
00:04:53,870 --> 00:04:57,470
tour as a third-level fall back right

68
00:04:57,470 --> 00:05:00,830
ideally if the adversary is doing this
right

69
00:05:00,830 --> 00:05:04,250
you know all of this will point to
different places so on that previous

70
00:05:04,250 --> 00:05:06,950
slide all the hostnames pointed to know
I p

71
00:05:06,950 --> 00:05:10,610
so I'm going to know IP and just to
spend all of that wholesale and then the

72
00:05:10,610 --> 00:05:15,530
actor is down more sophisticated
adversaries will have you know IP

73
00:05:15,530 --> 00:05:18,950
address is sitting and moat multiple
hosting providers in multiple

74
00:05:18,950 --> 00:05:23,360
jurisdictions in multiple countries so
that it's more difficult though not

75
00:05:23,360 --> 00:05:25,880
impossible to take all of their
infrastructure down

76
00:05:25,880 --> 00:05:30,830
it's just a way of making life more
difficult for us ok so one of the first

77
00:05:30,830 --> 00:05:36,229
things you can do with redundancy is it
creates some possibilities to increase

78
00:05:36,230 --> 00:05:40,940
detection of unknown stuff you know for
a static indicator a hostname or IP

79
00:05:40,940 --> 00:05:41,780
address

80
00:05:41,780 --> 00:05:45,559
you have to know that it's malicious
otherwise you just have no information

81
00:05:46,280 --> 00:05:49,460
you know but in redundancy properties
you have patterns that you can look for

82
00:05:49,460 --> 00:05:54,049
and we'll talk we'll talk about a couple
of those right so it helps you spot

83
00:05:54,050 --> 00:05:58,700
unknown threats and like for instance
domain generation algorithms often it's

84
00:05:58,700 --> 00:06:04,280
not normal user behavior to attempt to
resolve a thousand domains that look

85
00:06:04,280 --> 00:06:07,039
randomly generated you know very quickly

86
00:06:07,040 --> 00:06:10,370
right it's it's pathological behavior
you might not know anything about

87
00:06:10,370 --> 00:06:12,080
underlying what's going on

88
00:06:12,080 --> 00:06:15,380
but you know machine shouldn't do that
it gives you something to look for

89
00:06:15,380 --> 00:06:18,500
you know so the idea

90
00:06:18,500 --> 00:06:20,810
you know behind us is trying to

91
00:06:20,810 --> 00:06:24,620
either one force an adversary to adopt
some redundancy stuff so we have things

92
00:06:24,620 --> 00:06:28,940
to look for or simply just abusing or
using the fact that they're doing

93
00:06:28,940 --> 00:06:33,919
they're doing redundancy to find the
patterns of behavior so you can do data

94
00:06:33,919 --> 00:06:36,919
mining in statistical analysis right

95
00:06:38,720 --> 00:06:42,080
the reason of doing that right

96
00:06:42,080 --> 00:06:46,880
as I focus on criminal threats I I tend
to like doing prosecution's if i can get

97
00:06:46,880 --> 00:06:52,010
law enforcement to be helpful on things
you know and the key to every successful

98
00:06:52,010 --> 00:06:53,599
criminal prosecution

99
00:06:53,600 --> 00:07:00,380
you know even even in normal crimes but
very much true for computer crimes is is

100
00:07:00,380 --> 00:07:03,680
finding a pattern of what somebody's
done over the long term to find the one

101
00:07:03,680 --> 00:07:05,570
time that they screwed up right

102
00:07:05,570 --> 00:07:12,440
so you know and that you know i said at
that point lets you attribute who they

103
00:07:12,440 --> 00:07:18,380
are and get a successful prosecution and
now that being said you know and i will

104
00:07:18,380 --> 00:07:22,310
do take down start law enforcement
related but there is there is some risk

105
00:07:22,310 --> 00:07:25,669
there right if there's a static
indicator of an IP address

106
00:07:25,669 --> 00:07:30,859
that's easy to take down for four most
hosting providers anyway say hey this is

107
00:07:30,860 --> 00:07:33,590
a malicious IP used only for criminal
purposes

108
00:07:33,590 --> 00:07:37,909
here's all the data a hosting provider
off and take that offline right right

109
00:07:37,910 --> 00:07:43,160
there is some transitory impact but an
adversary will often just say okay well

110
00:07:43,160 --> 00:07:45,860
i'm just going to get another virtual
private server on another hosting

111
00:07:45,860 --> 00:07:46,580
provider

112
00:07:46,580 --> 00:07:50,900
they've got a backup of your data and
they're up and running in hours if not

113
00:07:50,900 --> 00:07:51,739
days

114
00:07:51,740 --> 00:07:54,740
so the impact is is very short-lived

115
00:07:56,030 --> 00:07:59,119
the other problem is that once that
happens then you usually lose visibility

116
00:07:59,120 --> 00:08:02,660
into what they're doing and you have to
redo all your research again right

117
00:08:02,660 --> 00:08:07,970
however if there's patterns that you can
observe usually those patterns exist

118
00:08:07,970 --> 00:08:12,710
over the long term so even if they move
their infrastructure around if you know

119
00:08:12,710 --> 00:08:16,280
what the patterns to look for your able
to still maintain surveillance as they

120
00:08:16,280 --> 00:08:17,539
change and adapt

121
00:08:17,539 --> 00:08:23,360
alright so as an example of detection
right in double flux or fast flux and

122
00:08:23,360 --> 00:08:24,919
double flux networks

123
00:08:24,919 --> 00:08:30,109
you know very generally easy to spot
relies on you know multiple a records

124
00:08:30,110 --> 00:08:31,550
for the same

125
00:08:31,550 --> 00:08:37,909
host name that . IP addresses in very
divergent areas with short time to live

126
00:08:37,909 --> 00:08:44,689
in this case 1800 seconds and only five
IP addresses but if you resolve that

127
00:08:44,690 --> 00:08:49,580
repeatedly over the course of 30 minutes
once those TD tl's expire

128
00:08:49,580 --> 00:08:55,220
you'll see other IP addresses that gets
cycled and cycled out so it's common to

129
00:08:55,220 --> 00:09:00,470
have hundreds or thousands of IP
addresses for a single dns indicator so

130
00:09:00,470 --> 00:09:05,090
the idea is right for the attacker is
that if i take down any of those IP

131
00:09:05,090 --> 00:09:09,380
addresses well the time-to-live expires
30 minutes later and then they just

132
00:09:09,380 --> 00:09:14,270
cycle in new IP addresses so they
maintain control that way

133
00:09:14,270 --> 00:09:19,340
however there is a definite pattern here
right most are it's common for fast flux

134
00:09:19,340 --> 00:09:25,760
networks to have specifically five IP
addresses for a given hostname you know

135
00:09:25,760 --> 00:09:31,640
generally in consumer IP space with
short time to live so you can

136
00:09:31,640 --> 00:09:34,699
programmatically say you know what I'm
resolving something or one of my

137
00:09:34,700 --> 00:09:37,790
constituent computers is resolving
something

138
00:09:37,790 --> 00:09:41,900
this is what comes back I may not know
anything about what dive with sharks is

139
00:09:41,900 --> 00:09:45,680
but I know that that's pathological
behavior and say I have a machine that I

140
00:09:45,680 --> 00:09:51,319
need to take a look at the only real use
case for doing behavior like this is

141
00:09:51,320 --> 00:09:52,940
content delivery networks

142
00:09:52,940 --> 00:09:57,110
there's a finite number of those that
you would have to whitelist you know but

143
00:09:57,110 --> 00:10:01,040
that said very few people will have name
server records with short time to live

144
00:10:01,040 --> 00:10:05,630
for a record it's very useful for
content delivery networks cloudflare d

145
00:10:05,630 --> 00:10:07,730
das providers in the light

146
00:10:07,730 --> 00:10:11,720
but there's not really so much of a use
case to do that four main servers right

147
00:10:11,720 --> 00:10:15,830
so again seeing that pattern of how fast
flux networks work right

148
00:10:15,830 --> 00:10:19,760
you can combine it with some other
things domain or IP reputation and say

149
00:10:19,760 --> 00:10:21,350
you know what this is maliciousness

150
00:10:21,350 --> 00:10:24,080
I don't know anything about it but I
know that there's something malicious

151
00:10:24,080 --> 00:10:27,150
going on to go find unknown threats
program

152
00:10:27,150 --> 00:10:31,860
play the second example is domain
generation algorithms right which is

153
00:10:31,860 --> 00:10:34,500
which is a big area of if of my research

154
00:10:34,500 --> 00:10:39,780
DJ is basically random generated host
names or domains usually hundreds of

155
00:10:39,780 --> 00:10:44,790
thousands sometimes done on a daily
basis attackers will only register a

156
00:10:44,790 --> 00:10:48,390
couple of these and many will be
unregistered right

157
00:10:48,390 --> 00:10:52,170
so they only need to control one of
those domains so that if i take down a

158
00:10:52,170 --> 00:10:56,910
given domain based on a complaint to a
registrar they register another domain

159
00:10:56,910 --> 00:11:00,930
they're still in business right so it's
an idea of them keeping some resiliency

160
00:11:00,930 --> 00:11:01,709
right

161
00:11:01,710 --> 00:11:06,060
you know but again it forces them or it
by its very nature forces them to create

162
00:11:06,060 --> 00:11:09,000
create a pattern of behavior that you
can look at

163
00:11:09,000 --> 00:11:15,510
so this is an example of five domains as
part of timber or tiny banker right

164
00:11:15,510 --> 00:11:20,550
so if you know about the dgs right you
can load that into dns dns response

165
00:11:20,550 --> 00:11:23,130
policies own and just prevent
resolutions right

166
00:11:23,130 --> 00:11:26,130
you know that's very easy but you have
to know about it first

167
00:11:26,760 --> 00:11:30,960
you know the other thing that this does
is make it easy to find

168
00:11:30,960 --> 00:11:35,100
otherwise unknown domain generation
algorithms as I said it's not very

169
00:11:35,100 --> 00:11:40,410
common for a machine to resolve lots of
domains quickly and it's certainly not

170
00:11:40,410 --> 00:11:44,550
common for machine to resolve lots of
domains and get NX domain which is

171
00:11:44,550 --> 00:11:51,060
basically you know record not found a
response code dns so you know on the

172
00:11:51,060 --> 00:11:54,390
previous slide right you see five tiny
banker domains

173
00:11:54,390 --> 00:11:58,020
you know but there's thousands that are
otherwise unregistered

174
00:11:58,020 --> 00:12:03,810
so what the most common response to a
machine that's got Malware that's

175
00:12:03,810 --> 00:12:08,579
enabled with the DGA as you're going to
see tons of an ex domain or response not

176
00:12:08,580 --> 00:12:09,810
found records

177
00:12:09,810 --> 00:12:13,290
you don't know anything about it but
that's pathological behavior even for

178
00:12:13,290 --> 00:12:16,949
machines that resolve DNS requests
quickly

179
00:12:16,950 --> 00:12:20,430
you know the typical response is that
they resolved there's something in there

180
00:12:20,430 --> 00:12:24,420
configured it a lot of NX domains is
something pathological and it gives you

181
00:12:24,420 --> 00:12:30,000
a pattern pattern to look for you can
look in dns laws for that repetitive

182
00:12:30,000 --> 00:12:34,530
queries and also there are many security
companies that do sinkholes we'll talk

183
00:12:34,530 --> 00:12:38,910
about that open in a couple of slides
but if you know what sinkhole IP

184
00:12:38,910 --> 00:12:40,050
addresses are out there on the

185
00:12:40,050 --> 00:12:44,550
internet it's a finite list but then
anything that resolves to those IP

186
00:12:44,550 --> 00:12:45,149
addresses

187
00:12:45,149 --> 00:12:48,149
even though that's a security researcher
doing some :

188
00:12:48,149 --> 00:12:52,350
well it's not normal pc behavior to
beacon out to a sinkhole you know

189
00:12:52,350 --> 00:12:56,579
something that's infected with something
and you may know and not know anything

190
00:12:56,579 --> 00:12:59,459
about except they're reaching out to a
single so it's a very good thing to

191
00:12:59,459 --> 00:13:03,329
detect on you know for incident response
or at least incident detection

192
00:13:04,110 --> 00:13:11,610
ok some other things that you can do
right for dgs is looking for you know

193
00:13:11,610 --> 00:13:17,970
high entropy domain names you know every
language has a certain statistical

194
00:13:17,970 --> 00:13:23,579
pattern of the letters that are commonly
used write in english right T is one of

195
00:13:23,579 --> 00:13:29,430
the most common t + s + E are our common
letters right Q is not a common letter

196
00:13:29,430 --> 00:13:33,899
when using random formulas however if
you did a histogram of the use of

197
00:13:33,899 --> 00:13:36,810
various letters right it would it would
be flat

198
00:13:36,810 --> 00:13:40,920
the the letters are all equally
statistically occurred right so you know

199
00:13:40,920 --> 00:13:43,529
it's not human language that's creating
it

200
00:13:43,529 --> 00:13:47,250
you might not know anything else about
it but it's pathological right

201
00:13:47,250 --> 00:13:52,020
you can also do things like Ngram
analysis of taking character

202
00:13:52,020 --> 00:13:56,790
combinations and then looking to
statistical patterns of you know in

203
00:13:56,790 --> 00:14:01,500
domain names versus what would normally
occur in natural human languages right

204
00:14:01,500 --> 00:14:06,360
so you're looking for sequences of
letters you know that are otherwise not

205
00:14:06,360 --> 00:14:11,279
common and that would indicate not
necessarily prove the presence of a DGA

206
00:14:11,279 --> 00:14:16,140
so again using this pattern of behavior
of a machine to say you know what I

207
00:14:16,140 --> 00:14:19,140
don't know anything about what's going
on I just know this is not normal

208
00:14:19,709 --> 00:14:24,719
so you know for the English language
right th that letter combination is very

209
00:14:24,720 --> 00:14:26,550
common in English right

210
00:14:26,550 --> 00:14:31,979
you know but TQ is not common at all
right so if I see something with

211
00:14:31,980 --> 00:14:36,089
uncommon letter combinations right i can
create some waiting algorithm and

212
00:14:36,089 --> 00:14:40,850
scoring and say you know what this is
not normally naturally occurring in late

213
00:14:40,850 --> 00:14:44,569
which that there's something else there
as long as you've got domains of

214
00:14:44,569 --> 00:14:46,069
sufficient length

215
00:14:46,069 --> 00:14:49,430
you don't have to deal with problems of
like acronyms write a 20 character

216
00:14:49,430 --> 00:14:54,620
domain name will often be based on
whatever words are common in a given

217
00:14:54,620 --> 00:14:56,000
language right

218
00:14:56,000 --> 00:15:01,730
so some care needs to be done is at
these the the statistical likelihood of

219
00:15:01,730 --> 00:15:06,800
various letter combinations varies
between between language so it's common

220
00:15:06,800 --> 00:15:11,569
to if you're if you're using a data set
of doing then Graham analysis based on

221
00:15:11,569 --> 00:15:16,939
just english words you may have false
positives on Chinese or Russian or other

222
00:15:16,940 --> 00:15:22,069
domains that that have different letter
frequencies right but it gives you a

223
00:15:22,069 --> 00:15:25,819
good tool to start detecting you know
those unknown threats

224
00:15:25,819 --> 00:15:31,189
right it's not one hundred percent right
but it gives you some some pattern with

225
00:15:31,190 --> 00:15:35,540
which to find the signal and the noise
right and there's a good paper out there

226
00:15:35,540 --> 00:15:38,540
the use of n grand models for DG a
detection

227
00:15:39,170 --> 00:15:43,040
that was written by future you're your
own chicken

228
00:15:43,040 --> 00:15:47,029
hopefully I'm pronouncing that right and
once it's published be a good thing to

229
00:15:47,029 --> 00:15:52,310
take a look at the other thing you do
once you I said you've established

230
00:15:52,310 --> 00:15:56,930
patterns right is then you can kind of
do things that are more you know

231
00:15:56,930 --> 00:15:59,779
proactive on adversaries

232
00:15:59,779 --> 00:16:04,970
so there is the use of sync holy for dgs
this is a very easy thing to do is if I

233
00:16:04,970 --> 00:16:09,319
said most domains and a DTR on
registered which means i don't require

234
00:16:09,319 --> 00:16:12,529
any special legal sanction I don't need
to get court orders or anything like

235
00:16:12,529 --> 00:16:13,250
that

236
00:16:13,250 --> 00:16:17,779
I just coded GoDaddy or whoever and
register a domain and then victims start

237
00:16:17,779 --> 00:16:20,779
contacting me right and get some
information

238
00:16:21,290 --> 00:16:25,670
so all it takes is registration right
very useful for getting telemetry data

239
00:16:25,670 --> 00:16:26,420
right

240
00:16:26,420 --> 00:16:30,469
you know that that point I start getting
you know relatively high reliability

241
00:16:30,470 --> 00:16:34,310
data on how many victims and where those
victims are located

242
00:16:34,310 --> 00:16:37,579
you know I'll see their IP addresses so
it's very useful and talking to

243
00:16:37,579 --> 00:16:41,420
law-enforcement say hey you know what
there's a thousand infected machines in

244
00:16:41,420 --> 00:16:43,310
Brussels

245
00:16:43,310 --> 00:16:43,768
you know

246
00:16:43,769 --> 00:16:47,069
you know you know Belgian belgium you
should take care of that problem right

247
00:16:48,300 --> 00:16:51,899
that being said there are some
adversaries you create sinkhole aware

248
00:16:51,899 --> 00:16:52,920
malware

249
00:16:52,920 --> 00:16:57,300
it's not terribly common in the sinkhole
detection rudimentary but it does exist

250
00:16:57,300 --> 00:17:02,368
out there because the adversary knows
their IP addresses if they see other

251
00:17:02,369 --> 00:17:08,250
other IP addresses resolving to their
DGA then they know somebody is paying

252
00:17:08,250 --> 00:17:09,419
attention to that

253
00:17:09,419 --> 00:17:14,220
ok there are some other uses you know a
sinkhole in however right

254
00:17:14,220 --> 00:17:17,579
you know you can to an extent control
the victim

255
00:17:17,579 --> 00:17:21,688
if you wanted to write so I mean the
first use case of single and it's just

256
00:17:21,689 --> 00:17:24,779
seeing the patterns of network behavior
and you can write network protection

257
00:17:24,779 --> 00:17:29,549
rules based on that you know but you can
also control victim end points right now

258
00:17:29,549 --> 00:17:32,370
some require encryption keys that you
may have

259
00:17:32,370 --> 00:17:35,459
there's proprietary protocols and light
so this other steps you have to go

260
00:17:35,460 --> 00:17:39,000
through right to mimic the sea to
protocol

261
00:17:39,000 --> 00:17:44,010
now things you could do here is that
many botnets for instance not all of

262
00:17:44,010 --> 00:17:48,899
them but many have you know a kind of
self removal command that you can send

263
00:17:48,899 --> 00:17:52,860
the victims and say you know what you
know i want to uninstall for whatever

264
00:17:52,860 --> 00:17:53,610
reason

265
00:17:53,610 --> 00:17:58,229
so if i were a researcher I could simply
basically take down a botnet by forcing

266
00:17:58,230 --> 00:18:01,500
all of the infected machines to
uninstall themselves right

267
00:18:01,500 --> 00:18:04,770
you can also push software down right

268
00:18:06,110 --> 00:18:09,350
which we'll talk about the next slide
you know but this self-destruction thing

269
00:18:09,350 --> 00:18:13,879
is often been part of takedowns in the
past you know where it's an option to

270
00:18:13,880 --> 00:18:20,120
clean up machines you know after after
after one of these activities again

271
00:18:20,120 --> 00:18:23,809
the second part of pushing software down
to the end victims

272
00:18:24,320 --> 00:18:28,669
this has happened i think twice so far
this year where somebody has taken

273
00:18:28,670 --> 00:18:32,540
gotten a foothold and malicious
infrastructure and then instead of

274
00:18:32,540 --> 00:18:34,909
having it push you know

275
00:18:34,910 --> 00:18:39,500
ransomware whatever it was designed to
push they pushed a viewer antivirus i

276
00:18:39,500 --> 00:18:43,400
believe was severe that they used so
that the the victims go out and say hey

277
00:18:43,400 --> 00:18:46,340
give me my malware and they get
antivirus delivered

278
00:18:46,340 --> 00:18:49,399
you know as as a response to that right

279
00:18:49,400 --> 00:18:54,620
transient impact right you know because
you know the the attacker catches on to

280
00:18:54,620 --> 00:18:59,449
that relatively quickly but also all
attackers generally make sure they're

281
00:18:59,450 --> 00:19:04,460
malware's antivirus is is fully
undetectable in AV anyway so pushing

282
00:19:04,460 --> 00:19:08,179
things like a very don't matter right if
if I were in this business

283
00:19:08,179 --> 00:19:12,890
I'd be pushing updates to flash or java
or whatever to actually Harden and

284
00:19:12,890 --> 00:19:16,549
harden machines instead of instead of
pushing just AV right

285
00:19:16,549 --> 00:19:19,850
that would give you a little bit more
persistent benefit right

286
00:19:19,850 --> 00:19:23,209
but the important note of this right is
that if you're controlling victim

287
00:19:23,210 --> 00:19:24,110
machines

288
00:19:24,110 --> 00:19:28,219
I can't think of a jurisdiction where
that's legal right that is that is

289
00:19:28,220 --> 00:19:29,990
criminal behavior right

290
00:19:29,990 --> 00:19:34,730
you know there are people who have done
it right you know but you know that wood

291
00:19:34,730 --> 00:19:35,879
is

292
00:19:35,879 --> 00:19:40,918
- I said that that that's prosecutable
behavior so i wouldn't recommend that is

293
00:19:40,919 --> 00:19:43,889
the course of action of pack patching a
bunch of machines on the internet you

294
00:19:43,889 --> 00:19:48,448
don't control you know but it is
something that can be done and in some

295
00:19:48,449 --> 00:19:52,379
countries you can get legal sanction to
do that kind of activity right

296
00:19:54,269 --> 00:19:58,469
so another thing you know that you can
do why is is once you kind of establish

297
00:19:58,469 --> 00:20:03,089
some of those patterns as do what i like
to call targeted intelligence operations

298
00:20:03,089 --> 00:20:09,479
very often in you know in computer crime
right computer crime knows no political

299
00:20:09,479 --> 00:20:16,019
boundaries you know I can infect
machines and and get victims all over

300
00:20:16,019 --> 00:20:17,009
the world

301
00:20:17,009 --> 00:20:21,239
you know without any respect to what the
laws or a political situation of

302
00:20:21,239 --> 00:20:24,449
whatever country that I'm in right

303
00:20:24,449 --> 00:20:29,039
it makes it very difficult to get
information right because you know once

304
00:20:29,039 --> 00:20:32,908
you start dealing with national
boundaries foreign policy considerations

305
00:20:32,909 --> 00:20:34,559
come come into play

306
00:20:34,559 --> 00:20:40,769
so it is very difficult for the United
States government to get legal process

307
00:20:40,769 --> 00:20:44,609
to get a wiretap on a machine in Russia
and vice versa right thats that's just

308
00:20:44,609 --> 00:20:47,129
the nature of the beast right you know

309
00:20:47,129 --> 00:20:51,779
so doing targeted intelligence
operations right is is is doing subtle

310
00:20:51,779 --> 00:20:53,849
ways to get information

311
00:20:53,849 --> 00:21:02,729
usually when more direct and legal means
aren't really available right so the

312
00:21:02,729 --> 00:21:07,139
other aspect of this right is even if
there are legal means available

313
00:21:07,739 --> 00:21:11,609
there is a lot of privacy protections
that are available

314
00:21:12,359 --> 00:21:15,928
you know for internet you know in our
internet connected world kind of as a

315
00:21:15,929 --> 00:21:20,249
consequence of the amount of data that's
just generated every day for people who

316
00:21:20,249 --> 00:21:25,769
use you know social media or gmail or
you know taking pictures

317
00:21:25,769 --> 00:21:30,059
the metadata just and pictures from your
phone there's tons of data there right

318
00:21:30,059 --> 00:21:34,019
you know there's been you know an
explosion of privacy privacy

319
00:21:34,019 --> 00:21:38,219
technologies that even given legal
sanction right it makes difficult to get

320
00:21:38,219 --> 00:21:39,269
some information

321
00:21:39,269 --> 00:21:45,269
so there is there is a place of doing it
doing some intelligence collection with

322
00:21:45,269 --> 00:21:46,780
legal means aren't available to

323
00:21:46,780 --> 00:21:53,050
it right so when you have just a single
IP address or hostname you know your

324
00:21:53,050 --> 00:21:56,050
ability to do anything is somewhat
limited right

325
00:21:56,050 --> 00:21:59,290
you can turn you can get it taken down
or suspended whatever right

326
00:21:59,290 --> 00:22:02,470
and then it's just down there is no more
data collection there that can be done

327
00:22:03,010 --> 00:22:07,780
you know or you get a wiretap right or
of whatever jurisdiction you happen to

328
00:22:07,780 --> 00:22:12,280
be in right but you don't really have
any other tracking ability or anything

329
00:22:12,280 --> 00:22:18,310
any easy way to do a manipulation right
and doing some of these things right if

330
00:22:18,310 --> 00:22:21,310
take it down right you may break your
visibility and that's bad right

331
00:22:21,880 --> 00:22:26,110
however when an attacker uses redundant
command and control things you've got

332
00:22:26,110 --> 00:22:29,949
subtle ways when you don't take down
everything but you can manipulate part

333
00:22:29,950 --> 00:22:35,590
of it just to figure out how they react
or force them to to follow a line that

334
00:22:35,590 --> 00:22:37,689
you want them to go down right

335
00:22:37,690 --> 00:22:43,900
so for dgs for example you know I can
take down a domain and not all of the

336
00:22:43,900 --> 00:22:48,700
domains or not to spend the entire list
of domains that would generate just to

337
00:22:48,700 --> 00:22:50,350
see how they change

338
00:22:50,350 --> 00:22:55,570
registered details over time or if they
change in payment methods or the light

339
00:22:55,570 --> 00:23:00,879
right so the key to doing this kind of
thing right is to have you know enough

340
00:23:00,880 --> 00:23:04,930
impact where they notice but not enough
impact where they just disappear and

341
00:23:04,930 --> 00:23:06,400
stop operating right

342
00:23:06,400 --> 00:23:11,440
you know it is possible to do something
kind of you know overtly destructive to

343
00:23:11,440 --> 00:23:15,820
their operations where they just tear
everything down and start over you know

344
00:23:15,820 --> 00:23:17,379
and then break your visibility

345
00:23:17,380 --> 00:23:21,580
you know the key is doing something just
enough to get them to make decisions

346
00:23:21,580 --> 00:23:24,010
that aren't in their in their benefit
will

347
00:23:24,010 --> 00:23:29,410
we'll do a couple of examples right so
the first units during cryptolocker

348
00:23:29,410 --> 00:23:36,040
which was active from 2013 to 2014 for a
period of time there registrar they were

349
00:23:36,040 --> 00:23:41,770
using was as a company called dns pod
right and that's all that they used for

350
00:23:41,770 --> 00:23:46,389
the domain registered it's also that
that register happens to be fairly

351
00:23:46,390 --> 00:23:50,590
popular for chinese apt actors but it's
a chinese company so that that probably

352
00:23:50,590 --> 00:23:55,419
doesn't mean much right at this point
you know China in America you know

353
00:23:56,039 --> 00:24:00,479
as as countries weren't overly
cooperative right

354
00:24:00,479 --> 00:24:05,100
you know now what my government does and
what I do want the same thing right

355
00:24:05,100 --> 00:24:08,580
because as a private sector actor i'm
not bound by foreign policy

356
00:24:08,580 --> 00:24:13,019
considerations you know so what I wanted
to do is build some relationships with

357
00:24:13,019 --> 00:24:18,509
organizations inside of China to work on
issues and solve mutual problems of a

358
00:24:18,509 --> 00:24:19,830
criminal nature right

359
00:24:19,830 --> 00:24:23,249
you know because crime is crime is crime
there's this victim you know and we can

360
00:24:23,249 --> 00:24:24,989
work through those problems right

361
00:24:24,989 --> 00:24:30,509
you know but I also wanted to see that
if I started taking down their domains

362
00:24:30,509 --> 00:24:34,559
if they would go to another register a
registrar how they would react and get

363
00:24:34,559 --> 00:24:41,519
them to use increased you know more
payment methods that we might be able to

364
00:24:41,519 --> 00:24:45,509
get some intelligence on them so i built
a relationship with the NS pod and then

365
00:24:45,509 --> 00:24:48,629
started suspending their domains as I
observe them right

366
00:24:48,629 --> 00:24:51,629
so for a couple of days this happened
they didn't do much

367
00:24:52,169 --> 00:24:58,320
and then they moved to another another
registrar after after about a week of

368
00:24:58,320 --> 00:25:02,789
doing this every day then they hopped to
a different registers godaddy for a

369
00:25:02,789 --> 00:25:03,989
little while right

370
00:25:03,989 --> 00:25:07,739
what about two weeks to a month later
than they have back to dns pot they

371
00:25:07,739 --> 00:25:09,989
didn't they didn't really care that much

372
00:25:09,989 --> 00:25:13,739
that had happened it was just kind of
the cost of doing business for them you

373
00:25:13,739 --> 00:25:18,119
know but that said then having to cycle
their accounts for domain registration

374
00:25:18,119 --> 00:25:21,689
using a different register are allowed
four different

375
00:25:23,580 --> 00:25:27,330
lead generation opportunities for law
enforcement that were available to

376
00:25:27,330 --> 00:25:31,860
Western governments at this point you
know with with cryptolocker anyway there

377
00:25:31,860 --> 00:25:35,699
wasn't any cooperation with Russian or
Chinese law enforcement was just a

378
00:25:35,700 --> 00:25:38,520
private sector and Western law
enforcement right

379
00:25:38,520 --> 00:25:44,220
so was able to force the attacker to
make changes to the behavior that led to

380
00:25:44,220 --> 00:25:49,530
ultimately attributing the individual
behind that right and open the door of

381
00:25:49,530 --> 00:25:53,550
private sector cooperation between
between organizations in those countries

382
00:25:53,550 --> 00:25:54,510
right

383
00:25:54,510 --> 00:26:01,530
a second example is there is a you know
another criminal actor I was tracking

384
00:26:01,530 --> 00:26:05,850
more of a service provider than that a
malware adversary

385
00:26:05,850 --> 00:26:11,459
you know but they had all of their stuff
that that operated their service on a

386
00:26:11,460 --> 00:26:16,110
shared hosting provider right so that it
was there

387
00:26:16,110 --> 00:26:19,139
we gave and it was a shared hosting
provider gave me the opportunity to

388
00:26:19,140 --> 00:26:23,880
simply just say hey hosting provider i
want an account on that same machine and

389
00:26:23,880 --> 00:26:27,060
if you've ever been on a shared hosting
provider

390
00:26:27,060 --> 00:26:30,750
you know linux box permissions are often
insecure you get all sorts of

391
00:26:30,750 --> 00:26:34,890
information in subtle ways that would
alert the adversary

392
00:26:34,890 --> 00:26:39,570
if that were true you know in this case
the hosting provider did have some some

393
00:26:39,570 --> 00:26:43,560
hardening in place so i really wasn't
able to gather what I wanted to do you

394
00:26:43,560 --> 00:26:46,440
know but the adversary didn't know that
right

395
00:26:46,440 --> 00:26:51,780
you know so at a certain point you know
I said the this particular adversary

396
00:26:51,780 --> 00:26:56,460
knew who I was and that I was actively
looking at them you know so i was able

397
00:26:56,460 --> 00:26:59,070
to say all right i got an account on
that machine

398
00:26:59,070 --> 00:27:03,030
I said hey by the way you know very
subtly communicated to him by the way I

399
00:27:03,030 --> 00:27:07,350
have an account on the same machine
you're running things on right which got

400
00:27:07,350 --> 00:27:11,580
him to move his his stuff to a dedicated
bonds right

401
00:27:11,580 --> 00:27:15,870
it had no particular impact to me that
he was on a dedicated vs share because

402
00:27:15,870 --> 00:27:20,219
that the collection i was doing wasn't
successful anyway but him moving and

403
00:27:20,220 --> 00:27:26,370
using that move function that's often
like cpanel or hosting provider accounts

404
00:27:26,370 --> 00:27:31,739
they often do not delete the data behind
them so he moved all of his operations

405
00:27:31,740 --> 00:27:36,090
to another server left all the data
behind which meant legal process was

406
00:27:36,090 --> 00:27:41,280
available to get that in a non-obtrusive
way whenever a search warrant is served

407
00:27:41,280 --> 00:27:44,760
on a hosting provider and you've got a
dedicated box right there turning the

408
00:27:44,760 --> 00:27:47,129
box off their imaging the drives

409
00:27:47,130 --> 00:27:52,980
you know it is very is very obtrusive
the adversary knows that their boxes

410
00:27:52,980 --> 00:27:58,140
being searched in this case he just left
all the data behind moved his operations

411
00:27:58,140 --> 00:28:02,550
so that when that box was searched the
adversary was none the wiser and got all

412
00:28:02,550 --> 00:28:08,070
sorts of great information out of that
his home IP address IP addresses of of

413
00:28:08,070 --> 00:28:10,950
other associates usernames passwords

414
00:28:10,950 --> 00:28:15,450
bitcoin wallets it was a lot a lot of
data that was left on that machine that

415
00:28:15,450 --> 00:28:19,620
that doing this allowed us to collect a
lot of intelligence in a non-obtrusive

416
00:28:19,620 --> 00:28:23,909
way on with redundancy

417
00:28:23,910 --> 00:28:27,060
you know also kind of comes more
fingerprints and things that you can

418
00:28:27,060 --> 00:28:28,560
look for right

419
00:28:28,560 --> 00:28:33,300
and more importantly not just for
identifying otherwise unknown infected

420
00:28:33,300 --> 00:28:37,500
machines are known malware you know but
these fingerprints will help identify

421
00:28:37,500 --> 00:28:43,650
food the adversary is right and using
the example of dgs we were you have lots

422
00:28:43,650 --> 00:28:44,970
of domain registrar

423
00:28:44,970 --> 00:28:49,740
registration is going on right there's a
lot of registrant details that happened

424
00:28:49,740 --> 00:28:55,170
to be created along the way and that
allows for finding and tracking you know

425
00:28:55,170 --> 00:29:00,060
a specific individual throughout all of
the operations they go down right

426
00:29:00,060 --> 00:29:03,600
you know I mean not not not be able to
take some of these details and say I

427
00:29:03,600 --> 00:29:06,330
know it's this person in this country
lives at this address

428
00:29:06,330 --> 00:29:11,189
but I could see everything associated
with them and correlate domains to the

429
00:29:11,190 --> 00:29:15,240
same actor with it so that we'll talk
about that a little bit for just who is

430
00:29:15,240 --> 00:29:20,460
information right for whatever
particular reason some top-level domains

431
00:29:20,460 --> 00:29:22,140
don't have who is protection

432
00:29:22,140 --> 00:29:27,690
you know but a lot of adversaries don't
use who is protection for for whatever

433
00:29:27,690 --> 00:29:28,830
reason right

434
00:29:28,830 --> 00:29:33,750
so as an example right the name of David
Bowers and this email address behind us

435
00:29:33,750 --> 00:29:34,830
is

436
00:29:34,830 --> 00:29:39,689
what was used until several months ago
anyway for the depth which is a click

437
00:29:39,690 --> 00:29:42,179
fraud based based malware

438
00:29:42,179 --> 00:29:46,890
but all the domain registrant
registration details all had that name

439
00:29:47,399 --> 00:29:50,399
all had that email address for the gap

440
00:29:51,240 --> 00:29:55,409
so it's a very clear pattern of behavior
that you could you could look at right

441
00:29:55,409 --> 00:29:59,190
so you know so going from there right

442
00:29:59,190 --> 00:30:03,330
I i know that this person is using this
very specific name and very specific

443
00:30:03,330 --> 00:30:04,678
email addresses

444
00:30:04,679 --> 00:30:08,700
I'd like to see what else is associated
with this person right

445
00:30:08,700 --> 00:30:11,880
there's a service called domaintools
highly recommend it

446
00:30:11,880 --> 00:30:16,019
right I have no professional affiliation
with them i just use their product but

447
00:30:16,019 --> 00:30:21,899
it's possible to simply search on a main
or an email address and then correlate

448
00:30:21,899 --> 00:30:25,739
all of those domains into it into one
list right

449
00:30:25,740 --> 00:30:30,779
so from just the observation of the
redundancy they had to adapt I was able

450
00:30:30,779 --> 00:30:34,200
to get the who is registration details
which are consistent of David Bowers

451
00:30:34,200 --> 00:30:38,460
pump that into domaintools and then I
see domains that are also associated

452
00:30:38,460 --> 00:30:41,190
with necker's an angler in that list

453
00:30:41,190 --> 00:30:46,049
so now I'm identifying this particular
actor is involved with now several other

454
00:30:46,049 --> 00:30:51,658
different campaigns and the unifying
link is the the fingerprints are

455
00:30:51,659 --> 00:30:56,519
creating with redundancy right and last
with domaintools you can also create a

456
00:30:56,519 --> 00:30:59,970
registrant alert so anytime this person
registered a domain

457
00:30:59,970 --> 00:31:04,230
you know within the next day I'll get an
email says here's all the domains this

458
00:31:04,230 --> 00:31:08,250
person register so it gives me kind of
enhanced intelligence collection i can

459
00:31:08,250 --> 00:31:13,649
do on that probably not the most visible
slide but in here you'll see 24 some odd

460
00:31:13,649 --> 00:31:18,120
domains of the several thousand that
were registered to David Bowers right

461
00:31:18,120 --> 00:31:21,389
and you see a variety of different
things in here

462
00:31:21,389 --> 00:31:25,110
you know some are very clearly DGA are
oriented up to the top we see these kind

463
00:31:25,110 --> 00:31:30,479
of random sequences of characters the
fourth from the bottom says a stash Nate

464
00:31:30,480 --> 00:31:35,789
- raid which is a word list based DGA
the one above that says accident

465
00:31:35,789 --> 00:31:40,590
muscle right so wordlist random
generation stuff you know what gives you

466
00:31:40,590 --> 00:31:44,158
a lot of information right that that
allows you to correlate things and say

467
00:31:44,159 --> 00:31:48,299
okay I know this is individuals involved
in this and now i was able to track them

468
00:31:48,299 --> 00:31:53,100
to other campaigns right and this is an
example of a registered alert email you

469
00:31:53,100 --> 00:31:58,559
know for David Bowers and and Jenna t to
Boris off both are used by the same

470
00:31:58,559 --> 00:32:01,529
person registered this this one day

471
00:32:01,529 --> 00:32:06,359
carolina upstate properties com which is
anger off the top of my head but I could

472
00:32:06,359 --> 00:32:07,590
be wrong right

473
00:32:07,590 --> 00:32:12,899
so gives you a lot of information that
you could work with ya

474
00:32:12,899 --> 00:32:20,219
as an example number to the use of ssl
encryption right is you know encryption

475
00:32:20,220 --> 00:32:24,539
is a good thing you know also have some
consequences of if it's done right you

476
00:32:24,539 --> 00:32:30,179
know the inability to see what's going
on in a in an encrypted session right

477
00:32:30,179 --> 00:32:33,299
provide some advantages to people who
engage in crime you know

478
00:32:33,840 --> 00:32:38,039
however right with the use of an of a
certificate right there are details in

479
00:32:38,039 --> 00:32:41,220
that certificate right for a single
machine

480
00:32:41,220 --> 00:32:45,359
you know I can't give you a pattern of
behaviour is a certificate one use or is

481
00:32:45,359 --> 00:32:48,359
there a common private key that they're
using are the details

482
00:32:49,139 --> 00:32:55,590
you know we used or they is it generated
a new each time right for multiple SI

483
00:32:55,590 --> 00:32:59,220
toos I can take a look and so say all
right you know what I see three

484
00:32:59,220 --> 00:33:03,210
SI toos here all of them are using the
same search despite being different IP

485
00:33:03,210 --> 00:33:04,139
addresses

486
00:33:04,139 --> 00:33:11,070
you know now I've got patterns to look
at just with an ssl right there is some

487
00:33:11,070 --> 00:33:15,450
malware that does certificate pinning
which make sure that you know the victim

488
00:33:15,450 --> 00:33:20,489
verifies that they are being presented
the right digital certificate before it

489
00:33:20,489 --> 00:33:25,499
communicates to a c2 to prevent SL
man-in-the-middle web proxy type of

490
00:33:25,499 --> 00:33:26,279
behavior

491
00:33:26,279 --> 00:33:29,999
so there's some of that going on but
with that certificate pinning right that

492
00:33:29,999 --> 00:33:35,159
binds them to use a specific cert even
if they're moving IP addresses so it

493
00:33:35,159 --> 00:33:40,200
really a while it gives them the benefit
of having the use of encryption in ways

494
00:33:40,200 --> 00:33:43,970
that are difficult to intercept you know

495
00:33:43,970 --> 00:33:48,650
ties them to a specific digital search
specific details and that pattern

496
00:33:48,650 --> 00:33:52,190
you know allows you that to start
programmatically hunting and looking for

497
00:33:52,190 --> 00:33:53,450
other things

498
00:33:53,450 --> 00:33:58,550
so in this particular example this is
used in android malware but is very

499
00:33:58,550 --> 00:33:59,419
consistent

500
00:33:59,420 --> 00:34:03,170
it's always the same number or always
the same certificate

501
00:34:03,170 --> 00:34:08,180
despite being you know every time a new
android malware was generated with this

502
00:34:08,179 --> 00:34:12,319
tool would still use the same digital
certificate so i was able to go to the

503
00:34:12,320 --> 00:34:17,270
google play store and say hey you know I
want to see any any presence of that SL

504
00:34:17,270 --> 00:34:24,290
serial number or that issuer information
which you know there at one point in

505
00:34:24,290 --> 00:34:29,659
time was a Cincinnati in the state of
Oregon but Oregon is not in the european

506
00:34:29,659 --> 00:34:33,770
union right it's there will be order in
the United States so obviously you know

507
00:34:33,770 --> 00:34:39,830
made up register a certificate details
also you know but able to one if you're

508
00:34:39,830 --> 00:34:44,690
looking for just the presence of network
SL right you can use showdown or other

509
00:34:44,690 --> 00:34:48,710
tools to simply find where this stuff is
you let you may have no of other

510
00:34:48,710 --> 00:34:53,330
observable data . but you can span scan
the entire internet for a given

511
00:34:53,330 --> 00:34:55,610
certificates serial number right

512
00:34:55,610 --> 00:35:01,730
you know for signing certs right for
android malware others right you can

513
00:35:01,730 --> 00:35:05,960
hunt application stores to find that
were created by this tool even though

514
00:35:05,960 --> 00:35:08,780
you don't have an observable of the
observable that

515
00:35:08,780 --> 00:35:13,160
so on that previous example with that
certificate i was you i use that to find

516
00:35:13,160 --> 00:35:15,350
this the this mad

517
00:35:15,350 --> 00:35:19,730
the use of now we're using this builder
in the google play store that was

518
00:35:19,730 --> 00:35:24,260
otherwise before then unknown to google
so found many applications that were

519
00:35:24,260 --> 00:35:25,970
available for download

520
00:35:25,970 --> 00:35:30,919
you know verified by google so you
didn't have to go do the install maps

521
00:35:30,920 --> 00:35:34,580
from untrusted sources setting and
settings this is something that people

522
00:35:34,580 --> 00:35:37,890
can get now we're on phones immediately
indirectly

523
00:35:37,890 --> 00:35:41,370
right so gave the ability to find that
stuff in the play store

524
00:35:42,360 --> 00:35:47,400
ok some other things that redundancy
provide you some ability to do is is

525
00:35:47,400 --> 00:35:50,220
surveillance right with a static
indicator right

526
00:35:50,220 --> 00:35:54,209
I mean yeah you can surveil it but it's
either up or down there's no changes to

527
00:35:54,210 --> 00:35:55,260
keep track of

528
00:35:55,260 --> 00:35:59,940
right you know that being said DNS data
can change right if you control the dns

529
00:35:59,940 --> 00:36:05,280
server you can move IP addresses at will
at any time you really want to write you

530
00:36:05,280 --> 00:36:10,200
know IP addresses also can come and go
because boxes get suspended or use of

531
00:36:10,200 --> 00:36:12,060
compromise domains or whatever it is

532
00:36:12,060 --> 00:36:19,650
right so either with dgs you know or
with malware configs can use a dns tools

533
00:36:19,650 --> 00:36:25,590
asynchronous dns to just bulk resolve
this stuff you know every every hour or

534
00:36:25,590 --> 00:36:28,920
30 minutes and then just look for
changes right

535
00:36:28,920 --> 00:36:33,810
just based on dns resolutions right
which is essentially what my DGA feeds

536
00:36:33,810 --> 00:36:37,890
that we'll talk about a little bit later
do is just all it does is take a list of

537
00:36:37,890 --> 00:36:42,750
malicious domains in a DGA resolve them
all and then just figure out what's

538
00:36:42,750 --> 00:36:45,630
what's listening and what's not and as
that changes are made give some

539
00:36:45,630 --> 00:36:52,230
notifications right so I said SI toos
can start stop in anytime you know you

540
00:36:52,230 --> 00:36:56,220
know they could stop issuing
instructions at any time so keeping

541
00:36:56,220 --> 00:37:00,720
surveillance up to see how these things
change over time is important right

542
00:37:01,230 --> 00:37:05,370
and those changes and certainly like the
related metadata you know it's very

543
00:37:05,370 --> 00:37:09,270
important investigation right there are
there are several malware add

544
00:37:09,270 --> 00:37:15,630
adversaries who will have their SI toos
resolve only for 15 or 30 minutes while

545
00:37:15,630 --> 00:37:19,230
their operational and they'll point to
private IP address space or just not

546
00:37:19,230 --> 00:37:24,000
resolve at all when they aren't actively
an operation right so the ability is

547
00:37:24,000 --> 00:37:30,330
seeing that stuff is also important can
now that said you know both resolving

548
00:37:30,330 --> 00:37:31,560
domains

549
00:37:31,560 --> 00:37:36,660
you know is is creation of feeds right
you know and you know and doing that

550
00:37:36,660 --> 00:37:39,600
intake is still more or less a passive
tactic right

551
00:37:39,600 --> 00:37:44,700
you know it's not it's not useless right
it has its uses and you know but you

552
00:37:44,700 --> 00:37:48,330
know it's still you know you you pump it
into a firewall you do something on it

553
00:37:48,330 --> 00:37:52,770
but it's it's retroactive or so you know

554
00:37:52,770 --> 00:37:57,030
however doing this bulk resolution on a
frequent basis right

555
00:37:57,030 --> 00:38:00,510
you can start seeing the sea to changes
in in real time and that's the

556
00:38:00,510 --> 00:38:05,310
interesting stuff and then do
notifications which I'll show in a slide

557
00:38:05,310 --> 00:38:05,880
here

558
00:38:05,880 --> 00:38:10,950
right i use a little app called pushover
which is just essentially a push app

559
00:38:10,950 --> 00:38:18,210
available for Apple and Android phones
of the simple API that I dump any time a

560
00:38:18,210 --> 00:38:23,610
new domain and a DGA shows up i push
notification by phone with some details

561
00:38:23,610 --> 00:38:26,400
which is what you see behind me right

562
00:38:26,400 --> 00:38:29,490
so this is an example of three mats new
domains

563
00:38:30,030 --> 00:38:34,200
Matt's news a word list EGA and that
gives me some several pieces of

564
00:38:34,200 --> 00:38:37,799
information right you know the IP
addresses at points to but nameservers

565
00:38:37,800 --> 00:38:43,800
it's using and what the name server eye
peas are using the blood registrar the

566
00:38:43,800 --> 00:38:49,140
two on the left are actual valid Matt's
new the third one on the right

567
00:38:49,140 --> 00:38:53,279
organization , is a collision with a
real domain

568
00:38:53,910 --> 00:38:57,060
Matt's new being word lists a word list

569
00:38:57,060 --> 00:39:02,910
DGA eventually Clyde's with with actual
real domains because it's it's based off

570
00:39:02,910 --> 00:39:08,040
of a real words but just looking at the
data on those first two on the left

571
00:39:08,040 --> 00:39:14,550
there I see the nameservers of j manage
. com Andy fancast.com right which are

572
00:39:14,550 --> 00:39:19,080
dedicated name servers or at least they
were at the time dedicated name service

573
00:39:19,080 --> 00:39:22,529
to matts news so very quickly able to
say you know what the two on the left

574
00:39:22,530 --> 00:39:23,430
are valid

575
00:39:23,430 --> 00:39:27,060
the one on the right is is a false
positive you know and clean up Dana

576
00:39:27,060 --> 00:39:28,380
proactively right

577
00:39:28,380 --> 00:39:31,650
also provides some ability of saying hey
you know this is something i'm

578
00:39:31,650 --> 00:39:32,730
investigating

579
00:39:32,730 --> 00:39:36,030
you know hey FBI whatever law
enforcement body

580
00:39:36,030 --> 00:39:40,500
I'm now seeing this malicious domain
resolved to a US IP address

581
00:39:40,500 --> 00:39:42,520
why don't we go ahead and take action on

582
00:39:42,520 --> 00:39:47,680
that box and very quick turnaround right
you know within within an hour

583
00:39:47,680 --> 00:39:51,520
I'll see a notification of something
that comes live and then we can act on

584
00:39:51,520 --> 00:39:52,660
it fairly quickly

585
00:39:52,660 --> 00:39:57,190
you know if this you know and engage the
legal process so provides a lot of

586
00:39:57,190 --> 00:40:00,100
ability for for quick turnaround

587
00:40:00,100 --> 00:40:05,110
so very easy API all you got to do it
passes an application key a user key and

588
00:40:05,110 --> 00:40:08,110
then whatever message and then you just
pump it out right

589
00:40:08,110 --> 00:40:14,230
so very easy to do that kind of stuff
but also right

590
00:40:14,230 --> 00:40:16,750
you know what you could do with some of
the redundancy properties to start

591
00:40:16,750 --> 00:40:22,510
pairing it with other data and other
data sets right so early on there was

592
00:40:22,510 --> 00:40:24,520
slides of network configuration

593
00:40:24,520 --> 00:40:28,570
internally we call that system barn cat
where it just does a lot of static

594
00:40:28,570 --> 00:40:35,140
config extraction from now we're and
just the it does this kind of on a bolt

595
00:40:35,140 --> 00:40:40,720
scale of the system has almost a hundred
thousand now we're configs in there but

596
00:40:40,720 --> 00:40:45,459
it also has a lot of metadata that would
otherwise be unavailable with just

597
00:40:45,460 --> 00:40:52,330
sandboxing so settings like campaign I d
new text file pass see to information

598
00:40:52,330 --> 00:40:58,660
all that stuff can also be correlated
with other things to start seeing

599
00:40:58,660 --> 00:41:02,740
patterns of behavior and and that's kind
of a talk in its own right but for

600
00:41:02,740 --> 00:41:07,750
instance campaign ID many though not all
malware families have free form text

601
00:41:07,750 --> 00:41:12,970
fields with somebody can just name their
now our campaign whatever they want and

602
00:41:12,970 --> 00:41:17,410
it's very difficult when you know you're
putting something in a free form text

603
00:41:17,410 --> 00:41:21,940
field not to put something of yourself
in there that would otherwise help me

604
00:41:21,940 --> 00:41:24,220
figure out you know who you are

605
00:41:24,220 --> 00:41:27,939
ok so ultimately right

606
00:41:27,940 --> 00:41:33,130
the goal is to be you know that to have
more effective disruption of adversaries

607
00:41:33,130 --> 00:41:38,650
right so the kind of a takedown business
of taking down a domain or an IP address

608
00:41:38,650 --> 00:41:43,360
or whatever has some transit that you
have transient impact right but the

609
00:41:43,360 --> 00:41:46,560
attacker can change and then otherwise

610
00:41:46,560 --> 00:41:54,000
be invisible to us right however you
know if there's patterns and redundancy

611
00:41:54,000 --> 00:41:55,440
right there

612
00:41:55,440 --> 00:41:58,530
having to do the same thing over and
over again right

613
00:41:58,530 --> 00:42:02,520
they're registering lots of domains you
know or or different services or

614
00:42:02,520 --> 00:42:06,210
whatever they're doing it on a
repetitive basis because by the nature

615
00:42:06,210 --> 00:42:08,610
of redundancy they have to do that right

616
00:42:08,610 --> 00:42:14,850
you know in you know in kind of in
context of an investigation right

617
00:42:15,360 --> 00:42:17,970
you know as

618
00:42:17,970 --> 00:42:22,379
the good guys right you know people law
enforcement prosecution really only have

619
00:42:22,380 --> 00:42:26,430
to be lucky one time to be able to
attribute to an actor is we just have to

620
00:42:26,430 --> 00:42:31,049
find the one time that they screwed up
right and almost always there is that

621
00:42:31,050 --> 00:42:32,280
over the long term

622
00:42:32,280 --> 00:42:37,980
so having the ability to have they don't
have a track and adversary know the

623
00:42:37,980 --> 00:42:41,609
patterns of the behavior and then map it
back retro actively to see what they've

624
00:42:41,609 --> 00:42:45,930
been doing for the last year two years
three years to find that one point where

625
00:42:45,930 --> 00:42:47,310
they screwed up right

626
00:42:47,310 --> 00:42:50,849
the core layer is you know the criminal
has to be lucky all the time they have

627
00:42:50,849 --> 00:42:54,660
to get you know their operational
security perfect

628
00:42:54,660 --> 00:42:57,810
each and every time that they do
something and over the long term that's

629
00:42:57,810 --> 00:43:02,730
very difficult right it it's it's it's
not hard to do it once or twice

630
00:43:02,730 --> 00:43:06,900
correctly but when you're doing that
hundreds hundreds of times with

631
00:43:06,900 --> 00:43:09,780
thousands of times over the course of
years

632
00:43:09,780 --> 00:43:12,810
you know you may not notice right you
registered a domain and you didn't know

633
00:43:12,810 --> 00:43:16,259
to set your VPN client dropped and now
you're exposing your private IP address

634
00:43:16,260 --> 00:43:17,760
or something along those lines

635
00:43:17,760 --> 00:43:21,570
alright so the more they have to do
right

636
00:43:21,570 --> 00:43:25,440
the more likely it is there to make
mistakes which goes into why the

637
00:43:25,440 --> 00:43:28,050
targeted intelligence operations are so
valuable

638
00:43:28,050 --> 00:43:31,980
you're provoking them to make changes to
hopefully make an operational security

639
00:43:31,980 --> 00:43:35,430
screw up that allows attribution right

640
00:43:35,430 --> 00:43:40,859
so I said all successful criminal
prosecutions right involve that

641
00:43:40,859 --> 00:43:45,598
monitoring right and and and getting a
good view of everything that they're up

642
00:43:45,599 --> 00:43:49,290
to and then finding the time that they
screwed up to identify who they are

643
00:43:49,290 --> 00:43:50,190
right

644
00:43:50,190 --> 00:43:54,210
so exploiting redundancy right provides
some of the opportunity to make this

645
00:43:54,210 --> 00:43:54,780
happen

646
00:43:54,780 --> 00:43:59,130
right you know it's it's still possible
when they do single point of stuff but

647
00:43:59,130 --> 00:44:02,220
the more that you're doing more
frequently right increases the odds that

648
00:44:02,220 --> 00:44:04,410
they're going to screw up

649
00:44:04,410 --> 00:44:05,450
ok

650
00:44:05,450 --> 00:44:10,609
so a couple of free resources right you
know last year I talked about my DGA

651
00:44:10,609 --> 00:44:14,359
feeds right there still free there's no
authentication you go to that URL and

652
00:44:14,359 --> 00:44:21,500
download that now for our static now
we're configs you know we have a the

653
00:44:21,500 --> 00:44:26,240
mist instance up at barn cat federal
security com

654
00:44:26,240 --> 00:44:30,319
if you would like access and me an email
is about a hundred thousand our configs

655
00:44:30,320 --> 00:44:33,800
over the past year that we've observed
from the sources that we have

656
00:44:34,430 --> 00:44:37,790
ok so that's you know my presentation

657
00:44:37,790 --> 00:44:40,790
spacibo and any questions

658
00:44:47,220 --> 00:44:52,169
good day thanks just fall thanks for
great presentation a lot of new things

659
00:44:52,830 --> 00:44:59,730
I know a quick side note that we endorse
a great but uh recently i find out that

660
00:44:59,730 --> 00:45:07,050
they have not for database and try to
google some email so we were distant and

661
00:45:07,050 --> 00:45:13,500
you will find in other services we've
more my way down my name's and my

662
00:45:13,500 --> 00:45:22,260
question is do have some experience to
with domain name all the arrogant are

663
00:45:22,260 --> 00:45:28,619
getting we've works like like words like
love create where the first and it's

664
00:45:28,619 --> 00:45:32,010
randomly generated and reduce to do have
something to

665
00:45:33,670 --> 00:45:41,530
we deal with it the guy at the word list
based DGA is right there is matt's new

666
00:45:41,530 --> 00:45:43,329
Rob Knicks

667
00:45:43,329 --> 00:45:46,780
I want to say the third one whose name
escapes me right doing the Ngram

668
00:45:46,780 --> 00:45:50,559
analysis won't work because they're
using real words right

669
00:45:50,559 --> 00:45:55,390
however the pattern you still can use
this is a lot of NX domain requests

670
00:45:55,390 --> 00:45:55,990
right

671
00:45:55,990 --> 00:45:59,890
the at least Matthew I think only
generates nine a day

672
00:45:59,890 --> 00:46:03,098
so even that you'd be hard-pressed to
detect it

673
00:46:03,099 --> 00:46:06,520
you know but for Rob next I want to say
it's the several hundred a day

674
00:46:07,210 --> 00:46:11,290
so even though it's worthless based
generation right

675
00:46:11,290 --> 00:46:14,349
the most common response you're going to
get a xanex domain so you can still use

676
00:46:14,349 --> 00:46:17,470
that specific pattern to find it

677
00:46:17,470 --> 00:46:24,759
where do get the this domain name query
do crafts like main server

678
00:46:24,760 --> 00:46:28,150
oh yeah yeah yeah if you're running out
of it for an enterprise he's got their

679
00:46:28,150 --> 00:46:32,410
own dns resolver or for that matter if
you're just running an IDs to our

680
00:46:32,410 --> 00:46:37,779
signatures and the most ideas to just
assuming it sees the DNS traffic on the

681
00:46:37,780 --> 00:46:43,869
wire it would say that that's too many
too many NX domains so but you have to

682
00:46:43,869 --> 00:46:47,559
have access to your own resolver you're
seeing the logs or if you have access to

683
00:46:47,559 --> 00:46:48,970
the network traffic

684
00:46:48,970 --> 00:46:55,540
ok thanks ok thank you other questions

685
00:46:58,230 --> 00:47:00,730
ok

686
00:47:00,730 --> 00:47:06,460
John you've been talking a lot about our
law enforcement could please commend the

687
00:47:06,460 --> 00:47:14,290
situation one for example a hacker hard
to put properly protected Wi-Fi network

688
00:47:14,290 --> 00:47:18,520
of his neighbor for example and
committed and attack

689
00:47:19,030 --> 00:47:23,860
so is this neighbor in danger should be
afraid of persecution

690
00:47:24,430 --> 00:47:29,890
thank you ok so if I understand the
question of somebody kind of deliciously

691
00:47:29,890 --> 00:47:32,020
using somebody's home network

692
00:47:32,020 --> 00:47:35,230
there's two schools of thought

693
00:47:35,230 --> 00:47:41,320
right there's the first you know you
probably would like to say for the

694
00:47:41,320 --> 00:47:44,140
purposes like Real criminal behavior
right

695
00:47:44,140 --> 00:47:47,680
you know somebody's going to come in and
do an investigation will eventually

696
00:47:47,680 --> 00:47:48,520
figure that out

697
00:47:48,520 --> 00:47:52,060
they may search your home in the process
you may have to deal with hassle but

698
00:47:52,060 --> 00:47:55,000
they're going to eventually see an open
wireless network and know that you

699
00:47:55,000 --> 00:47:56,290
weren't responsible

700
00:47:56,290 --> 00:48:01,090
now that being said for at least for
copyright infringement in the United

701
00:48:01,090 --> 00:48:05,680
States you know the various record
labels and movie labels really don't

702
00:48:05,680 --> 00:48:06,609
care

703
00:48:06,610 --> 00:48:11,680
they'll just see you anyway because they
that's the IP address they see software

704
00:48:11,680 --> 00:48:12,819
piracy going on

705
00:48:12,820 --> 00:48:16,510
so from that same i mean it would give
you a hassle but really I think you only

706
00:48:16,510 --> 00:48:19,810
have to worry about toppy right
infringement it at least four places

707
00:48:19,810 --> 00:48:25,480
reachable by the US record labels and in
the light right

708
00:48:25,480 --> 00:48:28,900
the other school of thought is if I were
a criminal

709
00:48:28,900 --> 00:48:33,850
right I would definitely have my home
wireless network be unprotected and open

710
00:48:33,850 --> 00:48:36,700
because well it's an open wireless
network

711
00:48:36,700 --> 00:48:40,450
there's no logs how do you attribute the
network traffic is actually me

712
00:48:40,450 --> 00:48:44,140
so if i were a criminal I'd have I'd
have my home network

713
00:48:44,140 --> 00:48:49,900
open wide open all the time just to make
attribution more difficult that answer

714
00:48:49,900 --> 00:48:52,300
questions are perfect

715
00:48:52,300 --> 00:48:57,220
hi thanks so much for your presentation
I a spare double flux network how many

716
00:48:57,220 --> 00:49:01,600
operators of double flux natural do you
know and what do you do what measures do

717
00:49:01,600 --> 00:49:03,730
take to defeat those

718
00:49:03,730 --> 00:49:06,990
so how many how many double flux
networks there are I mean

719
00:49:06,990 --> 00:49:11,970
there are several gangs who operate our
first flax net for similar are you aware

720
00:49:11,970 --> 00:49:16,230
of several of those are only once or
dude where you do not differentiate

721
00:49:16,230 --> 00:49:23,070
between those and like just any how
deeply your search double flux now I

722
00:49:23,070 --> 00:49:29,610
researched it more deeply kind of years
ago and I haven't done much recently in

723
00:49:29,610 --> 00:49:30,300
years

724
00:49:30,300 --> 00:49:33,660
I mean I know there are several but i
don't really discriminate at this point

725
00:49:33,660 --> 00:49:38,040
saying this double flux is this guy or
this double flux is that guy usually

726
00:49:38,040 --> 00:49:42,600
most of our service providers and they
provide to multiple people so I i tend

727
00:49:42,600 --> 00:49:47,880
to be more tracking you know malware
adversaries than then service providers

728
00:49:47,880 --> 00:49:53,010
there was a second part of your question
was I would just ask you another one and

729
00:49:53,010 --> 00:49:59,250
offer as per DGA do you defeat dgs by
means of register pre-registering those

730
00:49:59,250 --> 00:50:02,369
or you just monitor dose and that's all

731
00:50:02,369 --> 00:50:06,270
and if yes if you do did you defeat
somehow

732
00:50:06,270 --> 00:50:13,410
how do you do the bulk registrations of
tons of the Germans something I do

733
00:50:14,130 --> 00:50:19,950
rarely but i will take out an entire DGA
right from time to time

734
00:50:20,580 --> 00:50:26,250
first I I want to be sure that it really
impactful many djs like tenba right

735
00:50:26,250 --> 00:50:30,540
there's just a static seed and they
could just turn around and just we ship

736
00:50:30,540 --> 00:50:34,770
out with another static seed or if
they're using multiple see two methods

737
00:50:34,770 --> 00:50:39,930
of dgs and tour and Static lists and I I
wouldn't do it because they simply just

738
00:50:39,930 --> 00:50:42,868
reassert control immediately and push a
new version right

739
00:50:42,869 --> 00:50:48,030
you know but that said if if for
cryptolocker how we and for GAMEOVER

740
00:50:48,030 --> 00:50:55,770
Zeus right with operation tow bar in
2014 and involved basically the FBI

741
00:50:55,770 --> 00:51:01,320
seizing all the domains as property and
then for Nick . are you just having an

742
00:51:01,320 --> 00:51:03,270
agreement of them

743
00:51:03,270 --> 00:51:07,259
no longer registering those domains are
allowing them to be registered right

744
00:51:07,260 --> 00:51:15,780
I can do bulk registration there is a
registrar with shadow server they they

745
00:51:15,780 --> 00:51:21,180
have their own registrar for this
purpose where they get heavily heavily

746
00:51:21,180 --> 00:51:25,560
discounted like you know pennies or or
free in some case domain registration

747
00:51:25,560 --> 00:51:30,029
but it has to be for security purposes
right so i would use a register i like

748
00:51:30,030 --> 00:51:32,700
that if I was doing kind of a bulk
registration campaign

749
00:51:32,700 --> 00:51:39,930
do you have single infrastructure in GDS
and what what technologist deputies and

750
00:51:39,930 --> 00:51:46,379
if you operate one of the I do sing :
but i do it on an ad hoc basis I don't

751
00:51:46,380 --> 00:51:50,010
kind of persistently sinkhole things I
just gather some information for

752
00:51:50,010 --> 00:51:52,920
whatever purpose i have and then do it
that do it down

753
00:51:52,920 --> 00:51:56,800
software i use for the most part many or

754
00:51:56,800 --> 00:52:01,870
it seemed like a disproportionate amount
of DGA based malware that I wasn't

755
00:52:01,870 --> 00:52:06,850
calling used HTTP is a protocol so I
just used a web server and then I've got

756
00:52:06,850 --> 00:52:12,970
the access logs right but for for some
rats dark , and i think there's you can

757
00:52:12,970 --> 00:52:18,939
put up a you know a fake c22 to get
beginning information were

758
00:52:20,430 --> 00:52:24,960
there was an old port century if you're
familiar with that it that listens on a

759
00:52:24,960 --> 00:52:29,340
port only for the purposes of finding
people who are scanning you know if

760
00:52:29,340 --> 00:52:32,970
that's all the information I just run
port SportsCentury on every port and

761
00:52:32,970 --> 00:52:33,870
then just listen to this

762
00:52:33,870 --> 00:52:40,020
and you know what hits okay i think i
may have time for one more question if

763
00:52:40,020 --> 00:52:42,990
somebody's interested

764
00:52:42,990 --> 00:52:46,770
all right thank you

