1
00:00:00,709 --> 00:00:09,389
well as I said I'm them and it is not

2
00:00:05,430 --> 00:00:12,719
often in my life that I get to give all

3
00:00:09,389 --> 00:00:16,470
presentation that revolves in essence

4
00:00:12,719 --> 00:00:17,340
around a single image but today is one

5
00:00:16,470 --> 00:00:19,710
of those days

6
00:00:17,340 --> 00:00:23,730
so I felt that it would be fitting to

7
00:00:19,710 --> 00:00:26,250
open with this image there it is some of

8
00:00:23,730 --> 00:00:28,529
you may be familiar with this image and

9
00:00:26,250 --> 00:00:31,619
other images like it and some of you may

10
00:00:28,529 --> 00:00:34,739
not be but whichever way you look at it

11
00:00:31,619 --> 00:00:37,980
this image is kind of strange because it

12
00:00:34,739 --> 00:00:41,040
is asking you to enable macros / editing

13
00:00:37,980 --> 00:00:43,769
/ content / whatever in order to view a

14
00:00:41,040 --> 00:00:46,789
document from an earlier version of

15
00:00:43,770 --> 00:00:48,809
Microsoft Word now if you go look at the

16
00:00:46,789 --> 00:00:52,020
functionality that is offered by

17
00:00:48,809 --> 00:00:54,209
Microsoft Word macros you'll find that

18
00:00:52,020 --> 00:00:57,030
it enables document to communicate with

19
00:00:54,210 --> 00:00:59,100
the world wide web to interact with the

20
00:00:57,030 --> 00:01:01,590
user and to automate some tasks that the

21
00:00:59,100 --> 00:01:03,989
user would be otherwise have to repeat

22
00:01:01,590 --> 00:01:05,909
again and again but one thing that

23
00:01:03,989 --> 00:01:08,340
Microsoft swarm across definitely do not

24
00:01:05,909 --> 00:01:11,369
do is enable backwards compatibility and

25
00:01:08,340 --> 00:01:14,130
at this point you would start getting

26
00:01:11,369 --> 00:01:16,380
the correct suspicion that this image is

27
00:01:14,130 --> 00:01:18,449
not actually Microsoft addressing you

28
00:01:16,380 --> 00:01:20,729
and asked you to do something it is

29
00:01:18,450 --> 00:01:23,009
someone else pretending to be Microsoft

30
00:01:20,729 --> 00:01:28,289
trying to ask you to do something

31
00:01:23,009 --> 00:01:29,729
instead now actually and I believe a lot

32
00:01:28,290 --> 00:01:32,970
of you have already guessed this or

33
00:01:29,729 --> 00:01:34,799
already know this the people behind this

34
00:01:32,970 --> 00:01:36,240
image are actually malicious actors

35
00:01:34,799 --> 00:01:38,850
trying to get you to run code on your

36
00:01:36,240 --> 00:01:40,798
machine and this is really a strange

37
00:01:38,850 --> 00:01:43,259
state of affairs that we got ourselves

38
00:01:40,799 --> 00:01:46,079
into where it makes sense for you to

39
00:01:43,259 --> 00:01:48,390
open a document and see someone who is

40
00:01:46,079 --> 00:01:50,490
not Microsoft pretending to be Microsoft

41
00:01:48,390 --> 00:01:52,049
asking you to enable a feature to do

42
00:01:50,490 --> 00:01:55,890
something that the feature does not

43
00:01:52,049 --> 00:01:58,469
actually do and at this point we are

44
00:01:55,890 --> 00:02:01,950
forced to ask ourselves how did we get

45
00:01:58,469 --> 00:02:04,890
here right how did we end up in this

46
00:02:01,950 --> 00:02:06,180
strange state of affairs so it's kind of

47
00:02:04,890 --> 00:02:10,080
a long story and it

48
00:02:06,180 --> 00:02:13,620
in 1994 with this guy named John

49
00:02:10,080 --> 00:02:16,770
McNamara who came up with an idea he was

50
00:02:13,620 --> 00:02:19,560
the first to think of the idea that you

51
00:02:16,770 --> 00:02:20,370
could write a virus based on a Microsoft

52
00:02:19,560 --> 00:02:22,500
Word macro

53
00:02:20,370 --> 00:02:24,420
his idea was very simple the mikvah

54
00:02:22,500 --> 00:02:26,790
would simply the moment it ran and back

55
00:02:24,420 --> 00:02:29,100
then macros would immediately run the

56
00:02:26,790 --> 00:02:32,130
moment you open a document the macro

57
00:02:29,100 --> 00:02:34,290
would overwrite the default template for

58
00:02:32,130 --> 00:02:36,269
new Microsoft Word documents and that

59
00:02:34,290 --> 00:02:38,100
way the moment that you opened the

60
00:02:36,270 --> 00:02:39,930
document you became infected yourself

61
00:02:38,100 --> 00:02:41,880
and every new document that you created

62
00:02:39,930 --> 00:02:44,520
would also be an infected document and

63
00:02:41,880 --> 00:02:47,989
that way the virus would propagate now

64
00:02:44,520 --> 00:02:51,330
McLamore a-- was he had a conscious and

65
00:02:47,989 --> 00:02:53,160
he decided it is not going to spread

66
00:02:51,330 --> 00:02:55,440
this innovation he just sat on it and

67
00:02:53,160 --> 00:02:58,079
insert himself wow this is really

68
00:02:55,440 --> 00:02:59,010
dangerous I hope no one else ever gets

69
00:02:58,080 --> 00:03:01,500
the same idea

70
00:02:59,010 --> 00:03:04,980
a year later someone else about the same

71
00:03:01,500 --> 00:03:06,900
idea and this group of guys designed the

72
00:03:04,980 --> 00:03:10,070
concept virus which is really not that

73
00:03:06,900 --> 00:03:13,080
different from McNamara's invention this

74
00:03:10,070 --> 00:03:15,600
macro model also worked more or less

75
00:03:13,080 --> 00:03:17,870
exactly the same way with two

76
00:03:15,600 --> 00:03:21,959
differences one difference is that it

77
00:03:17,870 --> 00:03:25,080
contained a line basically code that

78
00:03:21,959 --> 00:03:27,150
said that this proves our point so it

79
00:03:25,080 --> 00:03:29,070
shows how much of a proof-of-concept it

80
00:03:27,150 --> 00:03:32,040
really was but the other difference is

81
00:03:29,070 --> 00:03:34,980
they set it loose in the wild and it

82
00:03:32,040 --> 00:03:37,410
ended up infecting 35,000 computers or

83
00:03:34,980 --> 00:03:42,170
so which is not much in today's terms

84
00:03:37,410 --> 00:03:46,920
but in 1995 terms that's a lot and these

85
00:03:42,170 --> 00:03:50,010
two early prototypes halted the era they

86
00:03:46,920 --> 00:03:52,589
basically the golden age of microsoft

87
00:03:50,010 --> 00:03:56,130
word macro malware there was a constant

88
00:03:52,590 --> 00:03:57,600
influx of power based on the same idea

89
00:03:56,130 --> 00:04:01,620
back then which culminated with the

90
00:03:57,600 --> 00:04:04,170
Melissa Moore which was an infamous warm

91
00:04:01,620 --> 00:04:05,230
that is said to have caused like 1.5

92
00:04:04,170 --> 00:04:09,399
billion dollars

93
00:04:05,230 --> 00:04:11,200
and damages which additionally to

94
00:04:09,400 --> 00:04:14,230
all the features that we discussed

95
00:04:11,200 --> 00:04:17,019
earlier with those two prototypes it had

96
00:04:14,230 --> 00:04:18,880
two additional features one is that it

97
00:04:17,019 --> 00:04:20,709
enticed people to open it by pretending

98
00:04:18,880 --> 00:04:22,600
to be a list of pornographic websites

99
00:04:20,709 --> 00:04:24,820
and the other is that it aggressively

100
00:04:22,600 --> 00:04:26,290
emailed itself people on the victims

101
00:04:24,820 --> 00:04:31,389
address book the moment the metro

102
00:04:26,290 --> 00:04:33,610
started to run now following this great

103
00:04:31,389 --> 00:04:35,229
success because Melissa really really

104
00:04:33,610 --> 00:04:38,080
infected lots of machines and did lots

105
00:04:35,229 --> 00:04:41,229
of damage you would expect expect there

106
00:04:38,080 --> 00:04:43,960
to be some kind of even greater golden

107
00:04:41,229 --> 00:04:47,469
age of Microsoft Word model for malware

108
00:04:43,960 --> 00:04:50,710
a macro following this but it didn't

109
00:04:47,470 --> 00:04:52,990
happen instead of this huge additional

110
00:04:50,710 --> 00:04:58,330
golden age what happened is some kind of

111
00:04:52,990 --> 00:05:01,750
law between 2000 and 2015 there was a

112
00:04:58,330 --> 00:05:04,690
lull in macro malware instead of the

113
00:05:01,750 --> 00:05:06,669
huge explosion that we expected there

114
00:05:04,690 --> 00:05:08,830
really was some kind of a decline in

115
00:05:06,669 --> 00:05:11,049
Microsoft for lower and half of the

116
00:05:08,830 --> 00:05:12,909
security industry gotta said the state

117
00:05:11,050 --> 00:05:15,520
where they kind of forgot about it

118
00:05:12,910 --> 00:05:17,919
why well there were all sorts of reasons

119
00:05:15,520 --> 00:05:20,049
but I think the biggest reason was that

120
00:05:17,919 --> 00:05:22,359
it was at that point that cyber

121
00:05:20,050 --> 00:05:24,400
criminals realized that they are not

122
00:05:22,360 --> 00:05:27,160
content with just infecting machines

123
00:05:24,400 --> 00:05:29,380
they want to make money and Melissa

124
00:05:27,160 --> 00:05:31,210
Warren for all this great success in

125
00:05:29,380 --> 00:05:33,310
infecting machines the guy who wrote it

126
00:05:31,210 --> 00:05:36,190
ended up doing jail time but he didn't

127
00:05:33,310 --> 00:05:38,139
earn a penny for writing Lisa malware

128
00:05:36,190 --> 00:05:39,639
cyber tremulous decided that they want

129
00:05:38,139 --> 00:05:41,800
to create malware death will urge and

130
00:05:39,639 --> 00:05:44,260
money and they will then go on to invent

131
00:05:41,800 --> 00:05:46,330
banking Trojans and ransomware and

132
00:05:44,260 --> 00:05:48,880
crypto miners and all that complex

133
00:05:46,330 --> 00:05:51,460
software that requires complex logic and

134
00:05:48,880 --> 00:05:55,419
direct interfacing with the windows API

135
00:05:51,460 --> 00:05:57,969
and so forth and so on and they sat and

136
00:05:55,419 --> 00:06:00,549
thought what programming language do we

137
00:05:57,970 --> 00:06:02,880
want to write this in well back then

138
00:06:00,550 --> 00:06:05,800
there was no going and there was no rust

139
00:06:02,880 --> 00:06:07,510
and stuff like that they went with the

140
00:06:05,800 --> 00:06:08,860
sensible choice of writing the malware

141
00:06:07,510 --> 00:06:11,889
in C language

142
00:06:08,860 --> 00:06:14,530
and maybe C++ but the tenor rate they

143
00:06:11,889 --> 00:06:16,750
very quickly realized that they do not

144
00:06:14,530 --> 00:06:19,090
want to be writing this sort of software

145
00:06:16,750 --> 00:06:25,750
in VBA in Visual Basic for applications

146
00:06:19,090 --> 00:06:28,929
in inside of ms word macros so this was

147
00:06:25,750 --> 00:06:31,599
one reason why these macros kind of fell

148
00:06:28,930 --> 00:06:35,159
off the radar and another reason to add

149
00:06:31,599 --> 00:06:38,229
insult to injury was that around 2010

150
00:06:35,159 --> 00:06:41,438
Microsoft introduced this mitigation

151
00:06:38,229 --> 00:06:43,599
right it's called protected view what it

152
00:06:41,439 --> 00:06:45,819
does is that the moment that you

153
00:06:43,599 --> 00:06:48,479
download the document that originates in

154
00:06:45,819 --> 00:06:51,969
a place which Microsoft deems a

155
00:06:48,479 --> 00:06:53,680
suspicious place of origin such as an

156
00:06:51,969 --> 00:06:56,229
email attachment or somewhere on the

157
00:06:53,680 --> 00:06:58,599
World Wide Web the document is loaded in

158
00:06:56,229 --> 00:07:01,300
this mode which means that it cannot be

159
00:06:58,599 --> 00:07:03,250
edited and macros are disabled by

160
00:07:01,300 --> 00:07:05,110
default so now there was another

161
00:07:03,250 --> 00:07:09,129
obstacle if you wanted to write with

162
00:07:05,110 --> 00:07:12,310
game hour now this meant that if you

163
00:07:09,129 --> 00:07:14,949
wanted to create Microsoft world malware

164
00:07:12,310 --> 00:07:17,169
now you needed to use some kind of

165
00:07:14,949 --> 00:07:18,520
exploit right use one of the

166
00:07:17,169 --> 00:07:20,080
vulnerabilities and the work on the

167
00:07:18,520 --> 00:07:22,359
build is floating around in a theory

168
00:07:20,080 --> 00:07:24,580
someone could have used one of those in

169
00:07:22,360 --> 00:07:26,680
order to create a Miss World lower but

170
00:07:24,580 --> 00:07:30,008
we just said that no one really wanted

171
00:07:26,680 --> 00:07:32,770
to do this right no one wanted to be

172
00:07:30,009 --> 00:07:35,050
writing a Microsoft Word map from our in

173
00:07:32,770 --> 00:07:38,169
the first place anyway so it kind of

174
00:07:35,050 --> 00:07:40,710
remade the theoretical possibility and

175
00:07:38,169 --> 00:07:42,789
the breakthrough came when the bad guys

176
00:07:40,710 --> 00:07:44,349
unfortunately for all of us realized

177
00:07:42,789 --> 00:07:46,330
that additionally to the three

178
00:07:44,349 --> 00:07:48,759
vulnerabilities listed here and maybe

179
00:07:46,330 --> 00:07:50,409
some others there was one additional

180
00:07:48,759 --> 00:07:53,680
vulnerability that they could take

181
00:07:50,409 --> 00:07:55,960
advantage of and this vulnerability is

182
00:07:53,680 --> 00:07:58,449
very easy to exploit and is impossible

183
00:07:55,960 --> 00:08:01,930
to patch and it goes by many names one

184
00:07:58,449 --> 00:08:03,400
of them is c0 also known as usual clicks

185
00:08:01,930 --> 00:08:07,930
on something that they should not have

186
00:08:03,400 --> 00:08:10,029
right impossible to patch and what the

187
00:08:07,930 --> 00:08:12,580
cyber criminals figured is that if you

188
00:08:10,029 --> 00:08:15,699
want to get people to disable protector

189
00:08:12,580 --> 00:08:18,310
mode and get your malicious macros to

190
00:08:15,699 --> 00:08:20,110
run all you have to do is ask nicely

191
00:08:18,310 --> 00:08:21,820
like this and we

192
00:08:20,110 --> 00:08:24,310
back to the image from the beginning of

193
00:08:21,820 --> 00:08:26,409
the presentation there was suddenly a

194
00:08:24,310 --> 00:08:28,690
huge influx of malware likeness because

195
00:08:26,410 --> 00:08:31,630
the moment this problem the problem of

196
00:08:28,690 --> 00:08:33,520
bypassing protected mode was resolved

197
00:08:31,630 --> 00:08:36,549
the cyber criminals sat down and forth

198
00:08:33,520 --> 00:08:39,100
wait now all the remaining problems we

199
00:08:36,549 --> 00:08:41,140
have basically boiled down to that we

200
00:08:39,100 --> 00:08:44,350
don't want to route right all our

201
00:08:41,140 --> 00:08:46,210
malware in VBA but hey this is a problem

202
00:08:44,350 --> 00:08:50,470
we can work with we don't have to write

203
00:08:46,210 --> 00:08:52,720
all our malware in VBA we can use all

204
00:08:50,470 --> 00:08:55,690
sorts of bypasses to not have to do that

205
00:08:52,720 --> 00:08:57,250
for example they figured out that they

206
00:08:55,690 --> 00:08:59,590
can write most or malware in another

207
00:08:57,250 --> 00:09:01,930
programming language and only have a

208
00:08:59,590 --> 00:09:04,810
short stop written VBA that downloads

209
00:09:01,930 --> 00:09:07,120
and executes the malware that's one

210
00:09:04,810 --> 00:09:09,609
bypasses the found another is simply

211
00:09:07,120 --> 00:09:11,410
embedding an executable into the

212
00:09:09,610 --> 00:09:13,360
Microsoft Word document that's a more

213
00:09:11,410 --> 00:09:17,920
exotic approach used by honey Couture

214
00:09:13,360 --> 00:09:19,990
for example then they use some sort of

215
00:09:17,920 --> 00:09:23,770
really really strange obscure and exotic

216
00:09:19,990 --> 00:09:25,360
API PO to transfer the execution to the

217
00:09:23,770 --> 00:09:28,510
entry point of the shellcode that they

218
00:09:25,360 --> 00:09:31,630
had compiled so one of those days I was

219
00:09:28,510 --> 00:09:34,840
sitting in my office late at evening and

220
00:09:31,630 --> 00:09:39,520
staring at this image and I thought to

221
00:09:34,840 --> 00:09:41,140
myself really this is actually this

222
00:09:39,520 --> 00:09:43,120
thing is a feature of the moral

223
00:09:41,140 --> 00:09:46,720
landscape that we have to deal with in

224
00:09:43,120 --> 00:09:49,180
the euro for all 2019 because as reverse

225
00:09:46,720 --> 00:09:52,120
engineers we have to deal with so many

226
00:09:49,180 --> 00:09:55,469
complex problems like unpacking and

227
00:09:52,120 --> 00:09:57,250
attribution and symbolic execution and

228
00:09:55,470 --> 00:09:58,990
generally the problem of reverse

229
00:09:57,250 --> 00:10:02,190
engineer is full of very very difficult

230
00:09:58,990 --> 00:10:06,400
challenges and here's this super simple

231
00:10:02,190 --> 00:10:08,440
bamboozled that announces itself to the

232
00:10:06,400 --> 00:10:10,780
world in very very obvious terms all you

233
00:10:08,440 --> 00:10:12,610
have to do is look at it for half a

234
00:10:10,780 --> 00:10:14,980
second and with an experience of three

235
00:10:12,610 --> 00:10:17,620
days as a mall runners you're going to

236
00:10:14,980 --> 00:10:19,240
realize that this is malware and we

237
00:10:17,620 --> 00:10:21,790
figured that

238
00:10:19,240 --> 00:10:24,070
maybe we could try and approach taking

239
00:10:21,790 --> 00:10:26,430
advantage of this being such a simple

240
00:10:24,070 --> 00:10:29,230
problem floating out there and we should

241
00:10:26,430 --> 00:10:31,270
take a look at those documents that

242
00:10:29,230 --> 00:10:32,680
perform social engineering on people and

243
00:10:31,270 --> 00:10:34,720
see what we can find

244
00:10:32,680 --> 00:10:36,099
now I'm going to say up front it usually

245
00:10:34,720 --> 00:10:37,839
in this kind of lecture you would right

246
00:10:36,100 --> 00:10:39,910
now I dive into the technical details

247
00:10:37,839 --> 00:10:42,670
and the problems that we faced and some

248
00:10:39,910 --> 00:10:44,560
of the juicier bits we found and this is

249
00:10:42,670 --> 00:10:46,240
going to happen later and I thought it

250
00:10:44,560 --> 00:10:47,949
would be more appropriate to open with

251
00:10:46,240 --> 00:10:51,250
the punchline and the punchline is that

252
00:10:47,950 --> 00:10:53,589
we did do what I just suggested we took

253
00:10:51,250 --> 00:10:55,570
field of Microsoft Word documents we

254
00:10:53,589 --> 00:10:58,300
search them for the words enable macros

255
00:10:55,570 --> 00:11:00,930
or enable editing and so for and so on

256
00:10:58,300 --> 00:11:03,310
this field that we got from virustotal

257
00:11:00,930 --> 00:11:05,290
again there were all sorts of technical

258
00:11:03,310 --> 00:11:08,949
details hiding in here and we're going

259
00:11:05,290 --> 00:11:13,630
to get to them later and we did get the

260
00:11:08,950 --> 00:11:16,480
stream of files that contain these

261
00:11:13,630 --> 00:11:19,480
malicious socially engineering keywords

262
00:11:16,480 --> 00:11:21,910
such as for example this sample for like

263
00:11:19,480 --> 00:11:24,430
from like a week ago that I grabbed very

264
00:11:21,910 --> 00:11:25,990
easily from the top of the field when I

265
00:11:24,430 --> 00:11:28,810
was putting together this presentation

266
00:11:25,990 --> 00:11:31,000
and we looked at the documents

267
00:11:28,810 --> 00:11:33,670
themselves and we were able to visually

268
00:11:31,000 --> 00:11:35,410
verify that this was indeed a piece of

269
00:11:33,670 --> 00:11:38,649
malware I mean look at this it can be

270
00:11:35,410 --> 00:11:41,350
really anything else and the next thing

271
00:11:38,649 --> 00:11:43,000
we did is that we went to check with

272
00:11:41,350 --> 00:11:45,100
virustotal for a moment to verify that

273
00:11:43,000 --> 00:11:47,790
all the security vendors are on the same

274
00:11:45,100 --> 00:11:50,290
page and obviously they can also see

275
00:11:47,790 --> 00:11:52,480
really easily and immediately that this

276
00:11:50,290 --> 00:11:57,099
is mower and instead what we saw was

277
00:11:52,480 --> 00:11:59,260
this right and almost completely clean

278
00:11:57,100 --> 00:12:00,700
slate except for one vendor equalist

279
00:11:59,260 --> 00:12:03,910
I've never heard of them until this

280
00:12:00,700 --> 00:12:06,490
projects a way to go in chorus and this

281
00:12:03,910 --> 00:12:11,459
really got me thinking looking staring

282
00:12:06,490 --> 00:12:15,520
into this image because maybe how many

283
00:12:11,459 --> 00:12:16,899
simple problems with simple solutions do

284
00:12:15,520 --> 00:12:18,939
exist out there that were simply

285
00:12:16,899 --> 00:12:21,490
ignoring because we're then we follow

286
00:12:18,940 --> 00:12:23,560
those complex sexy problems in the realm

287
00:12:21,490 --> 00:12:26,170
of perverse engineering that I mentioned

288
00:12:23,560 --> 00:12:28,420
earlier I mean how many problems such as

289
00:12:26,170 --> 00:12:29,660
this order the just aren't sexy enough

290
00:12:28,420 --> 00:12:32,449
for us to deal with

291
00:12:29,660 --> 00:12:34,250
and all they have going for them is like

292
00:12:32,449 --> 00:12:37,758
this long ago legible detail that if you

293
00:12:34,250 --> 00:12:39,860
solve the problem you do prevent people

294
00:12:37,759 --> 00:12:42,680
from getting infected with malware which

295
00:12:39,860 --> 00:12:45,380
supposedly is what we are here to do so

296
00:12:42,680 --> 00:12:47,120
now that we've somehow established that

297
00:12:45,380 --> 00:12:48,709
simply looking at the stream of wipers

298
00:12:47,120 --> 00:12:51,079
of war documents looking for the words

299
00:12:48,709 --> 00:12:52,910
enable editing gives you a leg up on the

300
00:12:51,079 --> 00:12:55,459
current model landscape which should not

301
00:12:52,910 --> 00:12:57,589
be true in any sane universe that is

302
00:12:55,459 --> 00:13:00,109
apparently tree in this universe let's

303
00:12:57,589 --> 00:13:02,990
talk about some of the deeper technical

304
00:13:00,110 --> 00:13:04,880
details that this project entailed we're

305
00:13:02,990 --> 00:13:06,399
going to talk about why we generally

306
00:13:04,880 --> 00:13:09,350
like this approach and think it is

307
00:13:06,399 --> 00:13:11,000
decently robust mitigation we're going

308
00:13:09,350 --> 00:13:12,410
to talk about the implementation

309
00:13:11,000 --> 00:13:14,360
challenges that we face we're going to

310
00:13:12,410 --> 00:13:15,800
talk about the actual challenges that we

311
00:13:14,360 --> 00:13:17,959
face that for not implementation

312
00:13:15,800 --> 00:13:20,329
challenges we're going to show you some

313
00:13:17,959 --> 00:13:21,739
of the juicy documents that we

314
00:13:20,329 --> 00:13:23,959
encountered and a really really really

315
00:13:21,740 --> 00:13:25,699
short overview of the results and we're

316
00:13:23,959 --> 00:13:29,329
going to share some thoughts about how

317
00:13:25,699 --> 00:13:32,990
this approach can be extended to create

318
00:13:29,329 --> 00:13:35,209
even more value in the future now we're

319
00:13:32,990 --> 00:13:37,300
going to start with this tragic view of

320
00:13:35,209 --> 00:13:39,880
why we think this is a decently robust

321
00:13:37,300 --> 00:13:42,560
mitigation to be used in this situation

322
00:13:39,880 --> 00:13:44,689
now how do you judge a mitigation how do

323
00:13:42,560 --> 00:13:47,599
you tell if mitigation is robust or not

324
00:13:44,689 --> 00:13:49,670
I suppose your many schools of thought

325
00:13:47,600 --> 00:13:51,860
but my favorite school of thought is

326
00:13:49,670 --> 00:13:53,719
that the mitigation sits on in here ok

327
00:13:51,860 --> 00:13:55,790
and they are judged based on how easy

328
00:13:53,720 --> 00:13:57,560
they are to bypass it's kind of a

329
00:13:55,790 --> 00:13:59,029
spectrum at the bottom at the bottom you

330
00:13:57,560 --> 00:14:01,489
have integrations that are really really

331
00:13:59,029 --> 00:14:02,870
trivial to bypass a little top you have

332
00:14:01,490 --> 00:14:07,250
integrations that are really difficult

333
00:14:02,870 --> 00:14:09,290
to bypass right litigations where the

334
00:14:07,250 --> 00:14:11,180
attacker ultimately at the very very top

335
00:14:09,290 --> 00:14:13,069
of this fury you get the situation where

336
00:14:11,180 --> 00:14:14,359
the attacker just gives up and says ok

337
00:14:13,069 --> 00:14:16,370
I'm going to try a different attack

338
00:14:14,360 --> 00:14:20,269
vector this isn't going to work

339
00:14:16,370 --> 00:14:22,370
so our suggested mitigation of just

340
00:14:20,269 --> 00:14:24,860
looking for the words enable editing or

341
00:14:22,370 --> 00:14:27,439
enable macros unable whatever where does

342
00:14:24,860 --> 00:14:29,810
it sit on this hierarchy well let's put

343
00:14:27,439 --> 00:14:31,790
ourselves in the shoes of someone trying

344
00:14:29,810 --> 00:14:34,638
to craft a malicious document trying to

345
00:14:31,790 --> 00:14:37,519
bypass this mitigation what do they need

346
00:14:34,639 --> 00:14:39,920
to do they need to craft the document

347
00:14:37,519 --> 00:14:42,589
such that the hapless human victim

348
00:14:39,920 --> 00:14:45,079
taking a look at this document we

349
00:14:42,589 --> 00:14:46,939
realize that they have to enable editing

350
00:14:45,079 --> 00:14:48,618
enable macros and so forth and so on and

351
00:14:46,939 --> 00:14:51,349
understand that this is what they are

352
00:14:48,619 --> 00:14:54,529
looking at but an automated script a

353
00:14:51,350 --> 00:14:56,629
machine looking at the same input will

354
00:14:54,529 --> 00:14:58,609
not understand what is happening and

355
00:14:56,629 --> 00:15:01,189
will understand some kind of a different

356
00:14:58,609 --> 00:15:03,019
input in other words as the attacker

357
00:15:01,189 --> 00:15:05,498
what you would be trying to craft is

358
00:15:03,019 --> 00:15:07,579
some kind of a completely automatic

359
00:15:05,499 --> 00:15:09,859
public Turing test to tell apart

360
00:15:07,579 --> 00:15:11,628
computers and humans and if you take the

361
00:15:09,859 --> 00:15:13,189
first letter of every word in the

362
00:15:11,629 --> 00:15:16,669
sentence that I just said you get

363
00:15:13,189 --> 00:15:17,899
capture right this is essentially what

364
00:15:16,669 --> 00:15:20,929
you would be trying to do is the

365
00:15:17,899 --> 00:15:22,730
attacker and this is how the state of

366
00:15:20,929 --> 00:15:24,319
the art more or less in creating

367
00:15:22,730 --> 00:15:26,419
captions look some CAPTCHAs are even

368
00:15:24,319 --> 00:15:28,339
more gnarly than this but it is

369
00:15:26,419 --> 00:15:30,559
generally consensus that captures have

370
00:15:28,339 --> 00:15:34,220
to look at least as good gnarly as this

371
00:15:30,559 --> 00:15:35,719
which means that it seems that is the as

372
00:15:34,220 --> 00:15:38,269
the attacker you're going to have to

373
00:15:35,720 --> 00:15:41,600
craft social engineering images that

374
00:15:38,269 --> 00:15:43,249
look like this now maybe I am kind of

375
00:15:41,600 --> 00:15:46,160
biased but I am not feeling very

376
00:15:43,249 --> 00:15:48,559
convinced looking at this I believe a

377
00:15:46,160 --> 00:15:51,169
potential victim would also get kind of

378
00:15:48,559 --> 00:15:54,169
suspicious looking at this thing and the

379
00:15:51,169 --> 00:15:56,089
amazing thing that fortunately for the

380
00:15:54,169 --> 00:15:58,129
attackers they didn't know that they

381
00:15:56,089 --> 00:16:00,589
were trying to tackle a ridiculously

382
00:15:58,129 --> 00:16:03,019
difficult problem so they try it anyway

383
00:16:00,589 --> 00:16:06,499
and we're going to see some of their

384
00:16:03,019 --> 00:16:09,679
attempts later so regarding the

385
00:16:06,499 --> 00:16:13,429
implementation challenges that we ran

386
00:16:09,679 --> 00:16:15,860
across the first of those was basically

387
00:16:13,429 --> 00:16:18,470
a problem of hide-and-seek at first we

388
00:16:15,860 --> 00:16:20,989
thought that the message to enable

389
00:16:18,470 --> 00:16:24,019
macros will only appear in the text body

390
00:16:20,989 --> 00:16:26,209
but actually it also present pictures as

391
00:16:24,019 --> 00:16:27,769
we just saw and sometimes we got some

392
00:16:26,209 --> 00:16:29,508
really really strange false negatives

393
00:16:27,769 --> 00:16:31,039
where people were hiding it in the style

394
00:16:29,509 --> 00:16:34,269
sheet or in the document header or

395
00:16:31,039 --> 00:16:37,999
footer and so forth and so on and we

396
00:16:34,269 --> 00:16:40,039
chased all of those special cases until

397
00:16:37,999 --> 00:16:42,109
at some point we just got tired and said

398
00:16:40,039 --> 00:16:44,269
we are going to just search everything

399
00:16:42,109 --> 00:16:45,859
the moment we have reasonable data and

400
00:16:44,269 --> 00:16:48,130
not compressed data which is pointless

401
00:16:45,859 --> 00:16:49,600
to search we are going to

402
00:16:48,130 --> 00:16:51,520
regular expression on the entire

403
00:16:49,600 --> 00:16:53,470
document I don't care where you put the

404
00:16:51,520 --> 00:16:56,620
words enable editing I'm going to find

405
00:16:53,470 --> 00:16:58,900
them there but we are still left with

406
00:16:56,620 --> 00:17:00,880
the question of images because you can't

407
00:16:58,900 --> 00:17:02,560
really run a regular expression directly

408
00:17:00,880 --> 00:17:04,510
on an image unless you're using like a

409
00:17:02,560 --> 00:17:06,429
really really really really loosely

410
00:17:04,510 --> 00:17:08,050
typed language and even then you're

411
00:17:06,430 --> 00:17:12,730
probably not going to get the results

412
00:17:08,050 --> 00:17:14,560
that you want so how do you even extract

413
00:17:12,730 --> 00:17:17,230
images from a Microsoft Word document

414
00:17:14,560 --> 00:17:19,869
you would expect this to be a simple

415
00:17:17,230 --> 00:17:23,230
problem again and in fact I almost

416
00:17:19,869 --> 00:17:26,050
fought to not talk about this part but I

417
00:17:23,230 --> 00:17:29,440
feel a moral obligation a duty to

418
00:17:26,050 --> 00:17:31,450
explain the course of obstacles that we

419
00:17:29,440 --> 00:17:33,460
had to go through just for any future

420
00:17:31,450 --> 00:17:37,390
person who gets the same idea wants to

421
00:17:33,460 --> 00:17:39,790
try so the problem is this there's the

422
00:17:37,390 --> 00:17:42,340
newer document format that Microsoft

423
00:17:39,790 --> 00:17:44,980
uses the docx format and then you have

424
00:17:42,340 --> 00:17:47,490
the older format docx format which has

425
00:17:44,980 --> 00:17:50,860
only been deprecated for around 16 years

426
00:17:47,490 --> 00:17:53,560
but people are still using it I went to

427
00:17:50,860 --> 00:17:55,030
Google and asked why people are still

428
00:17:53,560 --> 00:17:57,610
using it and why just so many legitimate

429
00:17:55,030 --> 00:18:00,820
documents and malware floating around

430
00:17:57,610 --> 00:18:03,280
using this deprecated format and I

431
00:18:00,820 --> 00:18:05,070
quickly found this bigshot IT guy saying

432
00:18:03,280 --> 00:18:07,690
candidly and I appreciate it for

433
00:18:05,070 --> 00:18:11,020
appreciate him for it it says I never

434
00:18:07,690 --> 00:18:12,460
found really good reason to convert like

435
00:18:11,020 --> 00:18:14,230
docx format doesn't have a killer

436
00:18:12,460 --> 00:18:17,230
feature and I was used to using the old

437
00:18:14,230 --> 00:18:18,040
format so that's why I kept using so if

438
00:18:17,230 --> 00:18:20,350
this bigshot

439
00:18:18,040 --> 00:18:22,330
IT guy never bothered to convert how can

440
00:18:20,350 --> 00:18:24,250
we expect the average user to just

441
00:18:22,330 --> 00:18:27,310
magically stop using doc format and

442
00:18:24,250 --> 00:18:30,910
start using docx so wherever we like it

443
00:18:27,310 --> 00:18:32,860
or not we are stuck having to parse docx

444
00:18:30,910 --> 00:18:34,420
format files and extract with pictures

445
00:18:32,860 --> 00:18:36,729
from there all right

446
00:18:34,420 --> 00:18:40,240
let's google it how to extract images

447
00:18:36,730 --> 00:18:42,790
from a Word document and the response to

448
00:18:40,240 --> 00:18:44,770
this highest rated apparently a stack

449
00:18:42,790 --> 00:18:46,720
overflow question which is low rated

450
00:18:44,770 --> 00:18:49,480
relatively to a highest rated question

451
00:18:46,720 --> 00:18:51,340
is that if you're trying to parse the

452
00:18:49,480 --> 00:18:52,930
newer docx format then you'll find

453
00:18:51,340 --> 00:18:54,790
because it is a zip file you can just

454
00:18:52,930 --> 00:18:56,519
rename it to zip and extract it and

455
00:18:54,790 --> 00:18:59,799
you're going to find the images there

456
00:18:56,519 --> 00:19:02,320
of course it doesn't exactly answer our

457
00:18:59,799 --> 00:19:04,629
question because we also want to handle

458
00:19:02,320 --> 00:19:08,289
the older format and someone else

459
00:19:04,630 --> 00:19:12,190
another user quickly notices this and

460
00:19:08,289 --> 00:19:14,110
says let's write the docx format doesn't

461
00:19:12,190 --> 00:19:16,179
behave the same way you're going to have

462
00:19:14,110 --> 00:19:19,209
slightly more difficulties and you're

463
00:19:16,179 --> 00:19:21,429
welcome to read about it here the link

464
00:19:19,210 --> 00:19:24,309
here leads to the format's Wikipedia

465
00:19:21,429 --> 00:19:26,470
page well basically wikipedia tells you

466
00:19:24,309 --> 00:19:29,200
that when Microsoft was putting together

467
00:19:26,470 --> 00:19:30,759
this format they heard about four things

468
00:19:29,200 --> 00:19:33,610
which is performance performance

469
00:19:30,759 --> 00:19:35,740
features and performance and none of

470
00:19:33,610 --> 00:19:38,709
those things was elegance simplicity or

471
00:19:35,740 --> 00:19:41,710
ease of parsing staring at this

472
00:19:38,710 --> 00:19:45,250
Wikipedia article we got kind of

473
00:19:41,710 --> 00:19:47,639
discouraged but we found link to a last

474
00:19:45,250 --> 00:19:50,830
ray of hope which is an actual

475
00:19:47,639 --> 00:19:52,629
specification for this old format we

476
00:19:50,830 --> 00:19:54,668
click through to the link and we thought

477
00:19:52,629 --> 00:19:56,199
well maybe we could actually work with

478
00:19:54,669 --> 00:19:57,789
this right this is a full specification

479
00:19:56,200 --> 00:20:00,850
is going to explain to us how to build

480
00:19:57,789 --> 00:20:05,440
our own parser to pull the pictures out

481
00:20:00,850 --> 00:20:09,519
now it was a full three seconds of

482
00:20:05,440 --> 00:20:11,529
optimism before I our eyes wandered to

483
00:20:09,519 --> 00:20:13,960
the top left of the screen where we saw

484
00:20:11,529 --> 00:20:16,059
the page count on this thing five

485
00:20:13,960 --> 00:20:18,580
hundred and seventy-five pages and at

486
00:20:16,059 --> 00:20:20,620
this point we became we started to

487
00:20:18,580 --> 00:20:22,799
internalize the fact that we are

488
00:20:20,620 --> 00:20:26,979
probably not going to write our own

489
00:20:22,799 --> 00:20:28,840
deprecated docx format parcel now given

490
00:20:26,980 --> 00:20:32,919
the above we were left with the

491
00:20:28,840 --> 00:20:35,220
following options we could use all sorts

492
00:20:32,919 --> 00:20:37,389
of snippets of third-party code

493
00:20:35,220 --> 00:20:39,389
unmaintained floating around the

494
00:20:37,389 --> 00:20:42,399
internet and we tried some of those and

495
00:20:39,389 --> 00:20:44,049
either they didn't work or they did work

496
00:20:42,399 --> 00:20:46,120
and they didn't do what we needed them

497
00:20:44,049 --> 00:20:49,418
to do because after we tried doing

498
00:20:46,120 --> 00:20:52,750
anything with the result that needs to

499
00:20:49,419 --> 00:20:54,399
gave us we couldn't find anything we

500
00:20:52,750 --> 00:20:55,770
couldn't find the original images we

501
00:20:54,399 --> 00:20:58,289
couldn't

502
00:20:55,770 --> 00:20:59,760
maybe we misunderstood by those tools

503
00:20:58,289 --> 00:21:01,679
were promising to do but the 10 rate

504
00:20:59,760 --> 00:21:04,710
didn't do what we needed them to do

505
00:21:01,679 --> 00:21:07,049
another option was using one of those WS

506
00:21:04,710 --> 00:21:08,669
online sites if you search convert

507
00:21:07,049 --> 00:21:10,110
anything - anything else basically

508
00:21:08,669 --> 00:21:12,870
you're going to run across one of those

509
00:21:10,110 --> 00:21:14,820
sites that promises to convert and

510
00:21:12,870 --> 00:21:18,178
extract anything that you want as long

511
00:21:14,820 --> 00:21:20,908
as you give them your files but we

512
00:21:18,179 --> 00:21:23,700
weren't sure how those sites were going

513
00:21:20,909 --> 00:21:25,890
to work if we try to automate access to

514
00:21:23,700 --> 00:21:28,080
them and you know what we weren't really

515
00:21:25,890 --> 00:21:30,450
sure if the people behind those sites

516
00:21:28,080 --> 00:21:31,168
wanted us to actually erect this huge

517
00:21:30,450 --> 00:21:33,480
project

518
00:21:31,169 --> 00:21:35,490
the trouts thousands of documents per

519
00:21:33,480 --> 00:21:37,649
day through their servers I mean either

520
00:21:35,490 --> 00:21:39,270
they're going to be really happy that

521
00:21:37,649 --> 00:21:41,489
we're giving them all those documents or

522
00:21:39,270 --> 00:21:43,470
they're gonna be really angry that we're

523
00:21:41,490 --> 00:21:46,409
giving them all those documents and we

524
00:21:43,470 --> 00:21:49,260
weren't interested in finding out so the

525
00:21:46,409 --> 00:21:52,980
third and final option is what basically

526
00:21:49,260 --> 00:21:57,240
anyone sane tells you to do if you try

527
00:21:52,980 --> 00:21:59,669
googling parsing docx format documents

528
00:21:57,240 --> 00:22:03,260
online which is just converted in your

529
00:21:59,669 --> 00:22:06,690
format this also would have been swell

530
00:22:03,260 --> 00:22:08,908
except if you try to use Microsoft Word

531
00:22:06,690 --> 00:22:11,789
to do this the only way is to do it

532
00:22:08,909 --> 00:22:13,200
manually you have to open the file you

533
00:22:11,789 --> 00:22:16,320
have to click save as there's also

534
00:22:13,200 --> 00:22:18,179
another way which involves VBA and Comm

535
00:22:16,320 --> 00:22:20,460
objects and the moment we saw the pair

536
00:22:18,179 --> 00:22:22,860
of words comma objects our brains kind

537
00:22:20,460 --> 00:22:25,020
of shut down and we said let's put there

538
00:22:22,860 --> 00:22:27,120
let's put a pin on that right if we

539
00:22:25,020 --> 00:22:28,440
can't find literally any other solution

540
00:22:27,120 --> 00:22:32,340
that works we're going to come back to

541
00:22:28,440 --> 00:22:34,649
the commo objects so eventually what we

542
00:22:32,340 --> 00:22:36,809
ended up doing amazingly the easiest way

543
00:22:34,649 --> 00:22:41,510
that we found to extract the images from

544
00:22:36,809 --> 00:22:44,879
this older deprecated format was to use

545
00:22:41,510 --> 00:22:47,250
LibreOffice write so every step of this

546
00:22:44,880 --> 00:22:49,740
chain of reasoning seems kind of

547
00:22:47,250 --> 00:22:51,179
legitimate and sensible but you end up

548
00:22:49,740 --> 00:22:53,250
with the idea that the easiest way to

549
00:22:51,179 --> 00:22:56,520
extract images from a Microsoft Word

550
00:22:53,250 --> 00:22:58,830
document is to use a third-party tool

551
00:22:56,520 --> 00:23:00,600
which is open source and was created to

552
00:22:58,830 --> 00:23:03,399
kind of imitate the functionality of

553
00:23:00,600 --> 00:23:05,589
word I mean I think

554
00:23:03,399 --> 00:23:07,029
that's really messed up but now if you

555
00:23:05,589 --> 00:23:09,879
ever want to do the same thing you're

556
00:23:07,029 --> 00:23:12,729
going to not have to pass through the

557
00:23:09,879 --> 00:23:16,449
same obstacle course and frustration

558
00:23:12,729 --> 00:23:18,429
that we had so now that we had the

559
00:23:16,450 --> 00:23:25,960
images no matter which format they can

560
00:23:18,429 --> 00:23:29,619
eat on us the East German national and

561
00:23:25,960 --> 00:23:31,989
not easily shaken zero it's an actual

562
00:23:29,619 --> 00:23:35,289
scientific challenge embedded into it

563
00:23:31,989 --> 00:23:37,029
it's easier than extracting images out

564
00:23:35,289 --> 00:23:38,589
of a Microsoft Word document because it

565
00:23:37,029 --> 00:23:40,960
is a well understood problem

566
00:23:38,589 --> 00:23:43,779
it has solutions that work decently well

567
00:23:40,960 --> 00:23:45,969
one of them being tesseract free and

568
00:23:43,779 --> 00:23:48,279
open source Orange which was created

569
00:23:45,969 --> 00:23:51,070
like many many many years ago before I

570
00:23:48,279 --> 00:23:53,139
was born and nowadays it is maintained

571
00:23:51,070 --> 00:23:55,178
by Google and we gave it a test run and

572
00:23:53,139 --> 00:23:58,539
we also looked up other people giving

573
00:23:55,179 --> 00:24:00,940
this thing a test run and we found that

574
00:23:58,539 --> 00:24:02,320
it seems to be working decently well at

575
00:24:00,940 --> 00:24:05,259
least for some of the images that we

576
00:24:02,320 --> 00:24:07,239
tried and take this image noise image to

577
00:24:05,259 --> 00:24:09,429
test a Zurich OCR and maybe the font is

578
00:24:07,239 --> 00:24:15,249
too small but it outputs the exact text

579
00:24:09,429 --> 00:24:17,019
there so now we had the images and we

580
00:24:15,249 --> 00:24:20,529
had a way to retexe out of the images

581
00:24:17,019 --> 00:24:23,320
and we were mentally ready to search

582
00:24:20,529 --> 00:24:25,779
every single byte of the file format

583
00:24:23,320 --> 00:24:28,149
that we got the moment it was ready to

584
00:24:25,779 --> 00:24:30,070
be parsed and we were ready to cast our

585
00:24:28,149 --> 00:24:30,639
net and see what documents we were going

586
00:24:30,070 --> 00:24:35,439
to find

587
00:24:30,639 --> 00:24:38,349
now what we found a short overview is

588
00:24:35,440 --> 00:24:40,419
that about fifty thousand documents

589
00:24:38,349 --> 00:24:42,399
really really really low false positive

590
00:24:40,419 --> 00:24:46,149
rates most of the malicious especially

591
00:24:42,399 --> 00:24:47,709
after we applied some fixes and fixed

592
00:24:46,149 --> 00:24:50,830
some Kings that you're going to see

593
00:24:47,710 --> 00:24:52,749
later mostly it's a motif right I spent

594
00:24:50,830 --> 00:24:54,968
a good while sitting down and

595
00:24:52,749 --> 00:24:58,839
downloading those documents and seen for

596
00:24:54,969 --> 00:25:01,779
myself what the payload at the tail end

597
00:24:58,839 --> 00:25:04,389
of them was and it was a motet almost

598
00:25:01,779 --> 00:25:07,629
every time and when it wasn't a motet it

599
00:25:04,389 --> 00:25:09,099
was gang crime so we're going to release

600
00:25:07,629 --> 00:25:10,418
the documents actually I wanted

601
00:25:09,099 --> 00:25:11,918
originally to have the link right here

602
00:25:10,419 --> 00:25:13,659
in the slide but we ran into some

603
00:25:11,919 --> 00:25:15,190
technical difficulties is that what

604
00:25:13,659 --> 00:25:16,350
we're going to release the link in the

605
00:25:15,190 --> 00:25:20,100
slide running late

606
00:25:16,350 --> 00:25:21,539
and in checkpoint research return in in

607
00:25:20,100 --> 00:25:23,189
my personal Twitter believe me if you

608
00:25:21,539 --> 00:25:24,750
want to go through browse through those

609
00:25:23,190 --> 00:25:27,450
documents you're going to have the

610
00:25:24,750 --> 00:25:29,759
opportunity to but in case you don't and

611
00:25:27,450 --> 00:25:31,500
I can't blame you it's not the most fun

612
00:25:29,759 --> 00:25:33,450
experience in the world opening document

613
00:25:31,500 --> 00:25:34,860
after document telling you to enable

614
00:25:33,450 --> 00:25:37,500
macros and then clicking it and getting

615
00:25:34,860 --> 00:25:38,879
affected by mo tests and we're going to

616
00:25:37,500 --> 00:25:41,789
give you some of the highlights the

617
00:25:38,880 --> 00:25:44,970
juiciest bits of malicious documents

618
00:25:41,789 --> 00:25:47,610
that we ran across while running this

619
00:25:44,970 --> 00:25:50,789
project and searching our field of

620
00:25:47,610 --> 00:25:53,789
malicious documents so the first thing

621
00:25:50,789 --> 00:25:55,679
the three ran across was this this piece

622
00:25:53,789 --> 00:25:58,980
of minimalist art are you feeling

623
00:25:55,679 --> 00:26:03,840
convinced by that message I'm not really

624
00:25:58,980 --> 00:26:06,000
sure I've seen messages telling you to

625
00:26:03,840 --> 00:26:08,970
enable macros which had more effort than

626
00:26:06,000 --> 00:26:11,759
that put into them if you look at the

627
00:26:08,970 --> 00:26:13,830
actual script that's being run when you

628
00:26:11,759 --> 00:26:17,129
enable mockers in this document you're

629
00:26:13,830 --> 00:26:19,139
going to see is that all it does is send

630
00:26:17,129 --> 00:26:22,889
the get request to a local IP address

631
00:26:19,139 --> 00:26:24,689
and download the file so this is

632
00:26:22,889 --> 00:26:26,789
probably some kind of proof of concept

633
00:26:24,690 --> 00:26:30,539
that some person put together imitating

634
00:26:26,789 --> 00:26:32,730
John McNamara and he's a 1994 in ventral

635
00:26:30,539 --> 00:26:36,169
spirit I don't know why someone felt the

636
00:26:32,730 --> 00:26:39,360
need to create something such as this in

637
00:26:36,169 --> 00:26:41,639
2019 and I really don't get how this

638
00:26:39,360 --> 00:26:43,769
thing ended up in virustotal but it did

639
00:26:41,639 --> 00:26:46,918
and we're going to later see things

640
00:26:43,769 --> 00:26:50,539
which make even less sense for them to

641
00:26:46,919 --> 00:26:52,950
end up in virustotal so we had this

642
00:26:50,539 --> 00:26:54,690
relatively harmless proof of concept and

643
00:26:52,950 --> 00:26:58,379
we also had slightly more insidious

644
00:26:54,690 --> 00:27:00,210
efforts such as this one really this one

645
00:26:58,379 --> 00:27:02,759
tells you that the document was created

646
00:27:00,210 --> 00:27:05,820
in an online version of Microsoft Word

647
00:27:02,759 --> 00:27:08,220
really the the range long list the

648
00:27:05,820 --> 00:27:10,139
endless list of different or sensible

649
00:27:08,220 --> 00:27:12,360
reasons for write the document isn't

650
00:27:10,139 --> 00:27:14,428
displayed correctly it's like it could

651
00:27:12,360 --> 00:27:16,289
be a lecture all of its own these people

652
00:27:14,429 --> 00:27:18,809
get really creative and to play on all

653
00:27:16,289 --> 00:27:21,269
of your fears and all your paranoia's of

654
00:27:18,809 --> 00:27:25,049
lack of compatibility between Microsoft

655
00:27:21,269 --> 00:27:27,840
software anyway if you take a look at

656
00:27:25,049 --> 00:27:29,220
the street being run from this malicious

657
00:27:27,840 --> 00:27:32,459
document that we found

658
00:27:29,220 --> 00:27:36,330
you're going to see a relatively small

659
00:27:32,460 --> 00:27:39,900
snippet of code which basically composes

660
00:27:36,330 --> 00:27:41,580
and sends out an email in Polish we got

661
00:27:39,900 --> 00:27:44,280
kind of curious or we run this thing

662
00:27:41,580 --> 00:27:46,530
through Google and Google Translate can

663
00:27:44,280 --> 00:27:48,809
you guys guess what this is maybe some

664
00:27:46,530 --> 00:27:50,668
of you can we found out that this is the

665
00:27:48,809 --> 00:27:52,408
email address of a Polish IT vendor and

666
00:27:50,669 --> 00:27:54,690
the email simply contains the subject

667
00:27:52,409 --> 00:27:57,179
line I have opened the attachment right

668
00:27:54,690 --> 00:27:58,799
so this is an awareness check by some IT

669
00:27:57,179 --> 00:27:59,580
vendor that somehow ended up on

670
00:27:58,799 --> 00:28:02,429
virustotal

671
00:27:59,580 --> 00:28:04,830
and I really feel sorry for the employee

672
00:28:02,429 --> 00:28:08,400
who uploaded they think about that this

673
00:28:04,830 --> 00:28:10,080
person got an email asking with a

674
00:28:08,400 --> 00:28:12,809
document asking them to enable macros

675
00:28:10,080 --> 00:28:14,730
and they didn't just click through they

676
00:28:12,809 --> 00:28:16,620
sent it they uploaded it to virustotal

677
00:28:14,730 --> 00:28:18,240
like a responsible person to try and

678
00:28:16,620 --> 00:28:21,030
understand where a smaller or not and

679
00:28:18,240 --> 00:28:22,919
virustotal as we saw earlier told them

680
00:28:21,030 --> 00:28:25,200
yes this is clean and you know this is

681
00:28:22,919 --> 00:28:27,809
technically the truth this is not

682
00:28:25,200 --> 00:28:29,309
malware and this person said to

683
00:28:27,809 --> 00:28:31,500
themselves all right since this is not

684
00:28:29,309 --> 00:28:34,139
Maura I'm just going to click enable

685
00:28:31,500 --> 00:28:36,419
macros and boom busted they got a stern

686
00:28:34,140 --> 00:28:38,039
talking-to and if I were in that

687
00:28:36,419 --> 00:28:41,400
person's shoes I would be really really

688
00:28:38,039 --> 00:28:44,129
really depressed after this really

689
00:28:41,400 --> 00:28:47,220
unfortunate chain of events now probably

690
00:28:44,130 --> 00:28:51,090
my favorite category in my favorite

691
00:28:47,220 --> 00:28:54,809
example in this category of strange not

692
00:28:51,090 --> 00:28:56,820
exactly instances of flour is this one

693
00:28:54,809 --> 00:29:02,220
right I was browsing through the field

694
00:28:56,820 --> 00:29:05,070
and suddenly this came up an image

695
00:29:02,220 --> 00:29:07,770
pretending to be a part of checkpoints

696
00:29:05,070 --> 00:29:09,530
capsule docks product which basically

697
00:29:07,770 --> 00:29:12,870
increased documents and pretends

698
00:29:09,530 --> 00:29:16,260
prevents people from reading it if they

699
00:29:12,870 --> 00:29:18,539
are not authorized to now I work for

700
00:29:16,260 --> 00:29:21,419
checkpoints so I was kind of taken aback

701
00:29:18,539 --> 00:29:23,340
by that I got up and I went to the room

702
00:29:21,419 --> 00:29:24,990
by my room I spoke to my group manager

703
00:29:23,340 --> 00:29:27,840
and even I said you know it looks like

704
00:29:24,990 --> 00:29:31,440
someone is trying to Spearfish us or one

705
00:29:27,840 --> 00:29:33,270
of our clients because we are be gonna

706
00:29:31,440 --> 00:29:35,549
dogfooding a checkpoint and we use

707
00:29:33,270 --> 00:29:37,740
capsule docks all the time now you are

708
00:29:35,549 --> 00:29:39,190
welcome to try and spot the differences

709
00:29:37,740 --> 00:29:40,780
between

710
00:29:39,190 --> 00:29:43,750
legitimate message and the illegitimate

711
00:29:40,780 --> 00:29:46,090
message and this story behind this and

712
00:29:43,750 --> 00:29:48,760
it raises eyebrow and he started an

713
00:29:46,090 --> 00:29:51,510
investigation and after this

714
00:29:48,760 --> 00:29:54,160
investigation got quite a bit rolling

715
00:29:51,510 --> 00:29:56,200
eventually what we found out is that the

716
00:29:54,160 --> 00:29:58,960
year before there was a security analyst

717
00:29:56,200 --> 00:30:01,060
course at checkpoint and the course

718
00:29:58,960 --> 00:30:03,580
included the final exam and the final

719
00:30:01,060 --> 00:30:05,740
exam was reverse engineering a full

720
00:30:03,580 --> 00:30:07,449
piece of malware and someone thought it

721
00:30:05,740 --> 00:30:10,480
would be really really really clever and

722
00:30:07,450 --> 00:30:13,600
ironic to stylize this piece of toy

723
00:30:10,480 --> 00:30:15,310
malware for researching as if it were

724
00:30:13,600 --> 00:30:17,770
designed to Spearfish checkpoint

725
00:30:15,310 --> 00:30:20,260
employees right so this document was

726
00:30:17,770 --> 00:30:23,680
created that checkpoint then was upload

727
00:30:20,260 --> 00:30:25,990
to to virustotal again I can only guess

728
00:30:23,680 --> 00:30:28,570
which clever student fought to do that

729
00:30:25,990 --> 00:30:30,610
and then it went in a round big circle

730
00:30:28,570 --> 00:30:34,120
right back to us it's the circle of life

731
00:30:30,610 --> 00:30:37,320
so summarizing all of those not quite

732
00:30:34,120 --> 00:30:40,810
more examples our conclusion is that

733
00:30:37,320 --> 00:30:42,700
let's say women to do that right if

734
00:30:40,810 --> 00:30:44,350
something is really really working hard

735
00:30:42,700 --> 00:30:46,210
to pretend that it is malware I mean

736
00:30:44,350 --> 00:30:49,120
those awareness checks the point of them

737
00:30:46,210 --> 00:30:50,860
is that they pretend to be more then I'm

738
00:30:49,120 --> 00:30:53,469
not going to feel really guilty flagging

739
00:30:50,860 --> 00:30:55,780
them a smaller and the people who

740
00:30:53,470 --> 00:30:57,520
offered the doors awareness checks are

741
00:30:55,780 --> 00:30:59,110
probably going to agree with me that was

742
00:30:57,520 --> 00:31:01,000
the point they expected you to decide

743
00:30:59,110 --> 00:31:03,570
that this is smaller now unfortunately

744
00:31:01,000 --> 00:31:04,990
this is great excuse but it's not

745
00:31:03,570 --> 00:31:08,919
working so well

746
00:31:04,990 --> 00:31:11,980
for some of the other examples that we

747
00:31:08,920 --> 00:31:14,710
ran across such as these false positives

748
00:31:11,980 --> 00:31:17,260
which mentions words enable editing but

749
00:31:14,710 --> 00:31:19,450
completely outside of the context of a

750
00:31:17,260 --> 00:31:22,030
Microsoft Word or enabling macros or

751
00:31:19,450 --> 00:31:24,010
even worse and I really really really

752
00:31:22,030 --> 00:31:26,740
felt guilty about this before we fixed

753
00:31:24,010 --> 00:31:29,110
it various documents telling people to

754
00:31:26,740 --> 00:31:31,300
be vigilant because cyber criminals are

755
00:31:29,110 --> 00:31:32,800
going to tell them to enable macros and

756
00:31:31,300 --> 00:31:34,510
please don't do that because that's how

757
00:31:32,800 --> 00:31:36,280
you get infected with banking Trojans

758
00:31:34,510 --> 00:31:38,590
right our engine was flagging that and

759
00:31:36,280 --> 00:31:40,600
we felt kind of silly and we said okay

760
00:31:38,590 --> 00:31:43,240
we're not going to flag your document if

761
00:31:40,600 --> 00:31:46,270
it doesn't actually contains macros or

762
00:31:43,240 --> 00:31:48,899
other active content that will get

763
00:31:46,270 --> 00:31:53,639
triggered the moment that you click this

764
00:31:48,899 --> 00:31:54,779
of words now the next example that we

765
00:31:53,639 --> 00:31:56,369
run across and I think it's the most

766
00:31:54,779 --> 00:31:59,219
substantial obstacle and most

767
00:31:56,369 --> 00:32:01,139
interesting example that we ran across

768
00:31:59,219 --> 00:32:03,629
while running this project and really

769
00:32:01,139 --> 00:32:07,799
didn't expect to run across something

770
00:32:03,629 --> 00:32:11,089
like this is this example right this may

771
00:32:07,799 --> 00:32:14,309
look to you like completely legitimate

772
00:32:11,089 --> 00:32:16,859
relatively speaking image at least you

773
00:32:14,309 --> 00:32:18,839
can read what's written here but if you

774
00:32:16,859 --> 00:32:22,799
try running tesseract on this you're

775
00:32:18,839 --> 00:32:26,039
going to get this output it almost looks

776
00:32:22,799 --> 00:32:27,960
like English this is basically what you

777
00:32:26,039 --> 00:32:29,789
get if you try to read out deep wanted

778
00:32:27,960 --> 00:32:32,549
or original image with your mouth full

779
00:32:29,789 --> 00:32:34,460
of marbles right it's garbled beyond

780
00:32:32,549 --> 00:32:37,379
recognition that the editing could not

781
00:32:34,460 --> 00:32:40,049
at all realize what's going on and if

782
00:32:37,379 --> 00:32:42,978
you think that's the worst no there's

783
00:32:40,049 --> 00:32:47,099
something worse there was this example

784
00:32:42,979 --> 00:32:49,109
it is blurry because it is brutal by

785
00:32:47,099 --> 00:32:51,359
design right this is not a resolution

786
00:32:49,109 --> 00:32:53,428
issue and if you try running tesseract

787
00:32:51,359 --> 00:32:56,339
on this what you're going to get is just

788
00:32:53,429 --> 00:32:59,629
complete gibberish right there there was

789
00:32:56,339 --> 00:33:02,190
a semblance of English before but now

790
00:32:59,629 --> 00:33:05,399
there's like no semblance of English

791
00:33:02,190 --> 00:33:07,440
left we could very easily conclude that

792
00:33:05,399 --> 00:33:09,268
there is no original text in the image

793
00:33:07,440 --> 00:33:12,570
at all if we didn't have the image

794
00:33:09,269 --> 00:33:14,489
staring us in the face so we sat there

795
00:33:12,570 --> 00:33:15,269
kind of stunned first of all we said to

796
00:33:14,489 --> 00:33:17,639
ourselves wow

797
00:33:15,269 --> 00:33:20,759
cybercriminals are really paranoid they

798
00:33:17,639 --> 00:33:24,478
anticipate these sorts of approaches and

799
00:33:20,759 --> 00:33:26,669
they try to prevent people like us from

800
00:33:24,479 --> 00:33:30,179
searching for their malicious documents

801
00:33:26,669 --> 00:33:32,249
using methods such as this so that shows

802
00:33:30,179 --> 00:33:33,989
a lot of dedication and the next thing

803
00:33:32,249 --> 00:33:37,649
we thought is how do we get around this

804
00:33:33,989 --> 00:33:39,839
right how do we manage to mitigate those

805
00:33:37,649 --> 00:33:40,889
false negatives and find those malicious

806
00:33:39,839 --> 00:33:42,500
documents anyway

807
00:33:40,889 --> 00:33:45,780
and

808
00:33:42,500 --> 00:33:48,600
answer that we eventually were able to

809
00:33:45,780 --> 00:33:54,060
find is to pre-process the image using

810
00:33:48,600 --> 00:33:55,740
some free Linux magic and a software

811
00:33:54,060 --> 00:33:58,919
called image magic that can be installed

812
00:33:55,740 --> 00:34:02,340
and was installed or on Ubuntu server

813
00:33:58,920 --> 00:34:04,380
running the project we tinkered and

814
00:34:02,340 --> 00:34:06,209
toyed with some of the settings of how

815
00:34:04,380 --> 00:34:10,380
to manipulate the image and eventually

816
00:34:06,210 --> 00:34:13,020
we settled on enlarging the image up to

817
00:34:10,380 --> 00:34:14,520
some certain threshold of larger size

818
00:34:13,020 --> 00:34:16,380
because we didn't want to choke the

819
00:34:14,520 --> 00:34:18,030
struct and make it die and then

820
00:34:16,380 --> 00:34:20,640
converting the image to grayscale and

821
00:34:18,030 --> 00:34:23,040
then turning the contrast up to the

822
00:34:20,639 --> 00:34:24,600
maximum anything which was slightly more

823
00:34:23,040 --> 00:34:28,139
black than white was converted to black

824
00:34:24,600 --> 00:34:31,170
and vice-versa and the result is that if

825
00:34:28,139 --> 00:34:34,290
this is the original blurry image after

826
00:34:31,170 --> 00:34:37,170
manipulation the image looked like this

827
00:34:34,290 --> 00:34:39,929
now you might not see a lot of a

828
00:34:37,170 --> 00:34:41,370
difference but tesseracts is plenty of a

829
00:34:39,929 --> 00:34:43,799
difference because if you right run

830
00:34:41,370 --> 00:34:46,500
tesseract on this newly manipulated

831
00:34:43,800 --> 00:34:48,120
image you get something very very much

832
00:34:46,500 --> 00:34:49,679
resembling English and you are able to

833
00:34:48,120 --> 00:34:53,549
actually fish out the words enable

834
00:34:49,679 --> 00:34:55,319
content again and catch the this

835
00:34:53,550 --> 00:34:58,350
document even though it's offers got so

836
00:34:55,320 --> 00:35:01,830
very clever and try to bust our OCR

837
00:34:58,350 --> 00:35:04,460
methods now we could just celebrate and

838
00:35:01,830 --> 00:35:07,069
call it a day but

839
00:35:04,460 --> 00:35:10,220
we felt kind of uncomfortable with one

840
00:35:07,069 --> 00:35:12,380
thing and that's that if you look

841
00:35:10,220 --> 00:35:15,169
closely at the text there's also this

842
00:35:12,380 --> 00:35:17,170
piece where they originally said enable

843
00:35:15,170 --> 00:35:21,140
editing but we didn't catch it because

844
00:35:17,170 --> 00:35:22,279
through the OCR and the anti OCR and all

845
00:35:21,140 --> 00:35:25,098
of that battle of wits

846
00:35:22,279 --> 00:35:26,390
the phrase got kind of mangled you as a

847
00:35:25,099 --> 00:35:29,150
human looking at it can immediately

848
00:35:26,390 --> 00:35:31,670
guess what it was supposed to be but the

849
00:35:29,150 --> 00:35:33,980
stripped won't unless we tell it to so

850
00:35:31,670 --> 00:35:37,160
we decided to tell it to and the way we

851
00:35:33,980 --> 00:35:41,630
decided to do it was to allow certain

852
00:35:37,160 --> 00:35:44,390
relaxation we decided to match not only

853
00:35:41,630 --> 00:35:46,940
the exact words enable content or enable

854
00:35:44,390 --> 00:35:50,450
macros and so forth and so on we decided

855
00:35:46,940 --> 00:35:53,180
to allow a certain radius search among a

856
00:35:50,450 --> 00:35:55,399
certain margin of error based on the

857
00:35:53,180 --> 00:35:57,230
added distance now as you may know the

858
00:35:55,400 --> 00:35:58,880
added distance between two words is

859
00:35:57,230 --> 00:36:01,490
basically the amount of one letter

860
00:35:58,880 --> 00:36:03,049
modifications that you need to do in

861
00:36:01,490 --> 00:36:05,509
order to get from one world to the other

862
00:36:03,049 --> 00:36:08,900
such as removing a letter deleting a

863
00:36:05,510 --> 00:36:11,390
letter or switching a letter and so we

864
00:36:08,900 --> 00:36:14,079
decided that we're going to match not

865
00:36:11,390 --> 00:36:18,410
only the phrase enable editing but also

866
00:36:14,079 --> 00:36:20,299
any two words in succession immediate

867
00:36:18,410 --> 00:36:23,328
succession each of which was within an

868
00:36:20,299 --> 00:36:27,710
edit distance of free of enable and

869
00:36:23,329 --> 00:36:33,950
editing and as a result we were able to

870
00:36:27,710 --> 00:36:36,410
also catch the enable audio example from

871
00:36:33,950 --> 00:36:39,470
before and others false negatives that

872
00:36:36,410 --> 00:36:41,598
we later saw that we earlier were

873
00:36:39,470 --> 00:36:44,270
missing because the OCR and the own anti

874
00:36:41,599 --> 00:36:47,869
OCR just almost canceled each other out

875
00:36:44,270 --> 00:36:50,119
and not completely now another category

876
00:36:47,869 --> 00:36:52,400
that I was really really sad to come

877
00:36:50,119 --> 00:36:55,700
across within our field of ostensibly

878
00:36:52,400 --> 00:36:58,460
malicious documents is what I would like

879
00:36:55,700 --> 00:37:00,500
to call worst practices and we found

880
00:36:58,460 --> 00:37:04,339
plenty of those not only fluor field but

881
00:37:00,500 --> 00:37:05,960
also by simply searching google for docx

882
00:37:04,339 --> 00:37:07,849
files which contain the words enable

883
00:37:05,960 --> 00:37:10,579
editing if you do that we're going to

884
00:37:07,849 --> 00:37:12,440
find a lot of documents we found macros

885
00:37:10,579 --> 00:37:13,890
that we would have safely ignored like I

886
00:37:12,440 --> 00:37:17,520
mentioned earlier

887
00:37:13,890 --> 00:37:20,460
and unfortunately apart from all the

888
00:37:17,520 --> 00:37:24,210
actual malware you're going to find a

889
00:37:20,460 --> 00:37:26,460
lot of I wanted to be more generic but

890
00:37:24,210 --> 00:37:29,580
I'm just going to say universities and

891
00:37:26,460 --> 00:37:32,250
colleges telling people to enable macros

892
00:37:29,580 --> 00:37:34,410
inside documents that they tell them to

893
00:37:32,250 --> 00:37:37,860
download from their website like here

894
00:37:34,410 --> 00:37:40,049
and here and here and this is a disaster

895
00:37:37,860 --> 00:37:42,210
right these universities and colleges

896
00:37:40,050 --> 00:37:42,930
they are teaching people to be easy

897
00:37:42,210 --> 00:37:45,210
victims

898
00:37:42,930 --> 00:37:47,339
stop doing that stop training your

899
00:37:45,210 --> 00:37:49,620
customers and stop training people in

900
00:37:47,340 --> 00:37:52,350
general to be easy victims to just give

901
00:37:49,620 --> 00:37:54,390
out information without you properly

902
00:37:52,350 --> 00:37:56,580
verifying yourself and certainly don't

903
00:37:54,390 --> 00:37:58,170
train people to just click enable

904
00:37:56,580 --> 00:38:02,330
editing on a document because you've

905
00:37:58,170 --> 00:38:04,860
told them to write stop doing it please

906
00:38:02,330 --> 00:38:09,110
another interesting thing the tree came

907
00:38:04,860 --> 00:38:12,300
across is apparently and enable macros

908
00:38:09,110 --> 00:38:14,610
attack that did not involve macros you

909
00:38:12,300 --> 00:38:18,360
may recognize this image from earlier it

910
00:38:14,610 --> 00:38:20,160
is the anti OCR image that caused the

911
00:38:18,360 --> 00:38:22,500
English to come out completely garbled

912
00:38:20,160 --> 00:38:25,290
the interest thing the interesting thing

913
00:38:22,500 --> 00:38:27,690
about this is that if you take a look at

914
00:38:25,290 --> 00:38:30,570
the actual macro that's being run if you

915
00:38:27,690 --> 00:38:34,560
enable if you disable protected mode

916
00:38:30,570 --> 00:38:36,870
here you will find this it's completely

917
00:38:34,560 --> 00:38:38,549
empty right who in the right mind would

918
00:38:36,870 --> 00:38:41,580
create a malware with all of this effort

919
00:38:38,550 --> 00:38:45,720
the anti OCR and everything just to run

920
00:38:41,580 --> 00:38:48,480
no code at all we mulled over this for a

921
00:38:45,720 --> 00:38:50,339
while until we find out the answer by

922
00:38:48,480 --> 00:38:52,200
digging enough into the document and

923
00:38:50,340 --> 00:38:54,570
running behavior analysis on it and so

924
00:38:52,200 --> 00:38:57,180
forth and so on and the answer was that

925
00:38:54,570 --> 00:39:00,630
code was running it just wasn't macro

926
00:38:57,180 --> 00:39:03,060
code how is it possible because as we

927
00:39:00,630 --> 00:39:06,300
mentioned earlier Microsoft docx format

928
00:39:03,060 --> 00:39:09,630
and later docx format ooh were really

929
00:39:06,300 --> 00:39:12,390
big on features right and one of those

930
00:39:09,630 --> 00:39:14,400
features is something called dynamic

931
00:39:12,390 --> 00:39:17,460
data exchange of which I've never heard

932
00:39:14,400 --> 00:39:21,390
of my animal life before this project

933
00:39:17,460 --> 00:39:23,340
started it was introduced in 1987 and it

934
00:39:21,390 --> 00:39:25,589
wat unquote allows transferring data

935
00:39:23,340 --> 00:39:29,100
between applications which

936
00:39:25,590 --> 00:39:31,620
in common English means that you can

937
00:39:29,100 --> 00:39:35,339
create a document and put something like

938
00:39:31,620 --> 00:39:38,520
this in it and get an arbitrary code

939
00:39:35,340 --> 00:39:41,610
execution on the victim machine so this

940
00:39:38,520 --> 00:39:44,820
is kind of insane and it worked right up

941
00:39:41,610 --> 00:39:46,800
until late 2017 where Microsoft caught

942
00:39:44,820 --> 00:39:51,420
wind of this and they said that's not

943
00:39:46,800 --> 00:39:54,360
good and they put dde also behind this

944
00:39:51,420 --> 00:39:56,700
protection but the lesson that we take

945
00:39:54,360 --> 00:39:58,410
from this is that if you use the word

946
00:39:56,700 --> 00:40:00,480
approach to a problem you're going to

947
00:39:58,410 --> 00:40:02,339
catch some weird fish right before that

948
00:40:00,480 --> 00:40:04,170
we're only going to catch macro malware

949
00:40:02,340 --> 00:40:05,700
but we ended up catching all sorts of

950
00:40:04,170 --> 00:40:07,800
things because we weren't looking for

951
00:40:05,700 --> 00:40:10,649
the markers themselves we were looking

952
00:40:07,800 --> 00:40:14,610
for the social engineering now two final

953
00:40:10,650 --> 00:40:18,630
kind of jocular examples the three run

954
00:40:14,610 --> 00:40:22,290
across is first of all this this

955
00:40:18,630 --> 00:40:24,900
triggered our malicious document

956
00:40:22,290 --> 00:40:27,960
detector and for a while we did not

957
00:40:24,900 --> 00:40:29,760
understand why now you technically have

958
00:40:27,960 --> 00:40:33,300
all the information that you need to

959
00:40:29,760 --> 00:40:37,620
realize why our malicious document

960
00:40:33,300 --> 00:40:39,450
detector was flagging this document but

961
00:40:37,620 --> 00:40:41,490
I can't blame you if you can't see it

962
00:40:39,450 --> 00:40:43,379
right away because we couldn't ever and

963
00:40:41,490 --> 00:40:44,120
it took some vicious debugging to figure

964
00:40:43,380 --> 00:40:46,680
it out

965
00:40:44,120 --> 00:40:49,950
actually what triggered it was this

966
00:40:46,680 --> 00:40:51,870
phrase right we allowed the fudge factor

967
00:40:49,950 --> 00:40:55,259
and the next thing that happened is that

968
00:40:51,870 --> 00:40:57,900
very very very rarely you would get a

969
00:40:55,260 --> 00:41:00,360
phrase like cable testing that because

970
00:40:57,900 --> 00:41:03,390
of the fudge factor was close enough to

971
00:41:00,360 --> 00:41:05,760
enable editing to decide to make the

972
00:41:03,390 --> 00:41:08,759
classifier decide that this document was

973
00:41:05,760 --> 00:41:12,630
malicious so we talked a short we took a

974
00:41:08,760 --> 00:41:14,460
short look at this and we click quickly

975
00:41:12,630 --> 00:41:18,120
decided that we're not going to actually

976
00:41:14,460 --> 00:41:21,960
allow a fudge factor for texts just for

977
00:41:18,120 --> 00:41:23,460
images were the use case that caused us

978
00:41:21,960 --> 00:41:25,620
to introduce the fudge factor is

979
00:41:23,460 --> 00:41:27,390
relevant in the first place right when

980
00:41:25,620 --> 00:41:30,509
you're looking at the text itself

981
00:41:27,390 --> 00:41:33,620
there's no problem of fudging going on

982
00:41:30,510 --> 00:41:37,940
because of anti OCR interacting with OCR

983
00:41:33,620 --> 00:41:40,490
and now I am going to show my thing my

984
00:41:37,940 --> 00:41:42,050
favorite my single favorite example of a

985
00:41:40,490 --> 00:41:44,089
malicious document that we ran across

986
00:41:42,050 --> 00:41:46,190
during the course of this project out of

987
00:41:44,090 --> 00:41:51,350
all the malicious documents which is

988
00:41:46,190 --> 00:41:54,380
this one I feel that going through all

989
00:41:51,350 --> 00:41:56,779
of this MS world malware was worth it

990
00:41:54,380 --> 00:41:59,510
just for this experience alone of

991
00:41:56,780 --> 00:42:01,880
staring at this thing but I said that

992
00:41:59,510 --> 00:42:05,150
they get really really creative and they

993
00:42:01,880 --> 00:42:07,160
do right this makes zero sense this

994
00:42:05,150 --> 00:42:09,470
message and the more you stir it the

995
00:42:07,160 --> 00:42:13,339
less sense it makes but somehow people

996
00:42:09,470 --> 00:42:17,480
clicked enable content after viewing

997
00:42:13,340 --> 00:42:20,330
this so here are some final thoughts

998
00:42:17,480 --> 00:42:22,220
after we've seen all of those strange

999
00:42:20,330 --> 00:42:23,540
and peculiar and juicy examples of

1000
00:42:22,220 --> 00:42:29,060
malicious and not quite malicious

1001
00:42:23,540 --> 00:42:31,670
documents that we ran across collecting

1002
00:42:29,060 --> 00:42:33,560
hashes which we is what we did and then

1003
00:42:31,670 --> 00:42:37,040
knowing in advance that those documents

1004
00:42:33,560 --> 00:42:40,370
were malicious is nice but how about we

1005
00:42:37,040 --> 00:42:44,420
give the user bigger and better warning

1006
00:42:40,370 --> 00:42:46,790
then giving them this nebulous phrase of

1007
00:42:44,420 --> 00:42:48,860
words you're enabling content because

1008
00:42:46,790 --> 00:42:50,480
users I don't think they really

1009
00:42:48,860 --> 00:42:52,700
understand what you are doing when

1010
00:42:50,480 --> 00:42:54,890
they're clicking enable content we've

1011
00:42:52,700 --> 00:42:57,319
educated users after years and years of

1012
00:42:54,890 --> 00:42:59,960
years of drilling it into their heads

1013
00:42:57,320 --> 00:43:01,820
that executable files are dangerous that

1014
00:42:59,960 --> 00:43:03,920
you're not supposed to run every

1015
00:43:01,820 --> 00:43:06,230
executable file out there just like that

1016
00:43:03,920 --> 00:43:06,590
without really considering where it came

1017
00:43:06,230 --> 00:43:09,830
from

1018
00:43:06,590 --> 00:43:12,320
but somehow this same awareness doesn't

1019
00:43:09,830 --> 00:43:16,400
exist for ordinary users when they're

1020
00:43:12,320 --> 00:43:19,220
enabling macros in Microsoft Word now if

1021
00:43:16,400 --> 00:43:22,330
you work in a big organization and you

1022
00:43:19,220 --> 00:43:25,279
you're lucky maybe your sis Atman can

1023
00:43:22,330 --> 00:43:28,549
disable this whole option to enable

1024
00:43:25,280 --> 00:43:31,430
macros or at least to disable protected

1025
00:43:28,550 --> 00:43:34,610
mode as a matter of general organization

1026
00:43:31,430 --> 00:43:36,410
wide policy which is all well a nice but

1027
00:43:34,610 --> 00:43:38,480
what about the average user right what

1028
00:43:36,410 --> 00:43:41,359
about the common for those people who

1029
00:43:38,480 --> 00:43:42,270
don't have a sysadmin to disable this

1030
00:43:41,360 --> 00:43:46,619
thing

1031
00:43:42,270 --> 00:43:50,250
as a policy wise decision and I'm going

1032
00:43:46,619 --> 00:43:51,570
to end with this single fault that has

1033
00:43:50,250 --> 00:43:55,650
haunted me throughout this entire

1034
00:43:51,570 --> 00:43:58,500
project how about this why don't we do

1035
00:43:55,650 --> 00:44:00,510
this right why don't we actually tell

1036
00:43:58,500 --> 00:44:02,849
users what they're going to do and give

1037
00:44:00,510 --> 00:44:05,700
them some kind of warning in terms that

1038
00:44:02,849 --> 00:44:08,760
they will actually internalize that

1039
00:44:05,700 --> 00:44:10,319
clicking enable macros is not a decision

1040
00:44:08,760 --> 00:44:12,720
that they should make light headed Li

1041
00:44:10,320 --> 00:44:14,820
and it is equivalent to run an

1042
00:44:12,720 --> 00:44:17,240
executable file on their machine right

1043
00:44:14,820 --> 00:44:19,950
we can run all of those clever projects

1044
00:44:17,240 --> 00:44:20,490
looking for malicious documents after

1045
00:44:19,950 --> 00:44:22,859
the fact

1046
00:44:20,490 --> 00:44:25,618
but I think the real advancement will

1047
00:44:22,859 --> 00:44:27,390
happen when a user the moment they open

1048
00:44:25,619 --> 00:44:29,880
a document and the moment the document

1049
00:44:27,390 --> 00:44:31,799
contains an image that contains the

1050
00:44:29,880 --> 00:44:34,410
Microsoft Word logo and says enable

1051
00:44:31,800 --> 00:44:38,400
macros this huge fat warning will pop up

1052
00:44:34,410 --> 00:44:40,730
and tell them please don't so thank you

1053
00:44:38,400 --> 00:44:40,730
very much

1054
00:44:46,580 --> 00:44:49,679
[Applause]

1055
00:44:57,320 --> 00:45:00,439
[Applause]

1056
00:45:07,460 --> 00:45:15,590
which are semi-transparent or warm like

1057
00:45:11,190 --> 00:45:17,340
a grass pattern look when I was giving

1058
00:45:15,590 --> 00:45:19,170
remember we talked earlier about

1059
00:45:17,340 --> 00:45:21,150
mitigations and how easy they are to

1060
00:45:19,170 --> 00:45:23,340
bypass and I remember thinking to myself

1061
00:45:21,150 --> 00:45:25,200
oh boy I can think exactly of the next

1062
00:45:23,340 --> 00:45:27,930
thing I would do if I were the attacker

1063
00:45:25,200 --> 00:45:30,060
but I decided to shut my mouth but you

1064
00:45:27,930 --> 00:45:30,779
went and said it well I can't really

1065
00:45:30,060 --> 00:45:33,690
blame you

1066
00:45:30,780 --> 00:45:35,850
and the next counter mitigation to this

1067
00:45:33,690 --> 00:45:37,920
is that you take a print screen of the

1068
00:45:35,850 --> 00:45:43,410
screen and then you run the algorithm on

1069
00:45:37,920 --> 00:45:45,720
that yeah I thought about that but I

1070
00:45:43,410 --> 00:45:47,250
didn't want to tip off people what they

1071
00:45:45,720 --> 00:45:51,419
have to do to bypass this before we

1072
00:45:47,250 --> 00:45:53,550
actually implement it ok so just you

1073
00:45:51,420 --> 00:45:55,590
know nobody here spread the word about

1074
00:45:53,550 --> 00:45:58,160
this and we'll get it working like a

1075
00:45:55,590 --> 00:45:58,160
week or so

1076
00:46:02,490 --> 00:46:07,009
and what else no all right thank you

1077
00:46:07,100 --> 00:46:10,700
[Music]

1078
00:46:07,700 --> 00:46:10,700
[Applause]

