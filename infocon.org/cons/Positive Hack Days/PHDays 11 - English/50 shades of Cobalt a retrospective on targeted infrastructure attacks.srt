1
00:00:04,960 --> 00:00:06,879
technical issues have been resolved so

2
00:00:06,879 --> 00:00:08,559
let's get going

3
00:00:08,559 --> 00:00:10,320
this time i want to talk about cobbled

4
00:00:10,320 --> 00:00:13,200
strike most of you know about it mostly

5
00:00:13,200 --> 00:00:15,280
you heard about it

6
00:00:15,280 --> 00:00:17,840
but why we as blue teamers may be

7
00:00:17,840 --> 00:00:21,039
interested in cobble strike

8
00:00:21,039 --> 00:00:22,560
let me start with this sort of

9
00:00:22,560 --> 00:00:25,090
introduction about detection philosophy

10
00:00:25,090 --> 00:00:27,359
[Music]

11
00:00:27,359 --> 00:00:30,240
detection philosophy from elasticsearch

12
00:00:30,240 --> 00:00:33,200
is a you know a relatively new

13
00:00:33,200 --> 00:00:35,680
phenomenon they've started sharing their

14
00:00:35,680 --> 00:00:37,200
content

15
00:00:37,200 --> 00:00:39,600
i'm not a big fan of sharing

16
00:00:39,600 --> 00:00:41,520
you would i didn't exclude generally but

17
00:00:41,520 --> 00:00:44,719
sharing ideas is certainly a great idea

18
00:00:44,719 --> 00:00:46,160
so one of the key

19
00:00:46,160 --> 00:00:47,039
tenets

20
00:00:47,039 --> 00:00:49,440
is that

21
00:00:50,559 --> 00:00:54,079
detection must be driven by tactics and

22
00:00:54,079 --> 00:00:58,600
techniques as opposed to tools

23
00:01:09,280 --> 00:01:11,280
if you know we have things like mimikets

24
00:01:11,280 --> 00:01:13,360
which we use pretty much every day isn't

25
00:01:13,360 --> 00:01:15,280
it

26
00:01:15,280 --> 00:01:18,000
easier to actually you know write a

27
00:01:18,000 --> 00:01:21,119
solution that will attract

28
00:01:25,040 --> 00:01:26,720
well because you foreign rat timbers

29
00:01:26,720 --> 00:01:30,240
they will build uh breadcrumbs like this

30
00:01:30,240 --> 00:01:32,400
into their products wouldn't it be

31
00:01:32,400 --> 00:01:34,640
easier to you know monitor for such

32
00:01:34,640 --> 00:01:37,759
patterns regardless of the tactics and

33
00:01:37,759 --> 00:01:41,840
techniques they will deploy

34
00:01:43,200 --> 00:01:44,880
i think that is uh comparable to

35
00:01:44,880 --> 00:01:47,920
mimikots in its popularity

36
00:01:47,920 --> 00:01:50,640
is cobbled straight

37
00:02:04,079 --> 00:02:06,799
and all of them are saying that you know

38
00:02:06,799 --> 00:02:08,720
at the early stage or in post

39
00:02:08,720 --> 00:02:12,400
exploitation cobble strike gets used

40
00:02:12,400 --> 00:02:14,640
so detection of cobblestrike keeps

41
00:02:14,640 --> 00:02:16,959
growing we keep saying it everywhere you

42
00:02:16,959 --> 00:02:20,000
know from scripps kitties

43
00:02:20,000 --> 00:02:22,879
to initial access brokers you know from

44
00:02:22,879 --> 00:02:25,519
encrypters

45
00:02:30,160 --> 00:02:32,480
we do see it everywhere all over the

46
00:02:32,480 --> 00:02:33,599
board

47
00:02:33,599 --> 00:02:35,599
which is sort of weird because i

48
00:02:35,599 --> 00:02:37,760
personally think that cobbles is

49
00:02:37,760 --> 00:02:40,320
something back from 2017

50
00:02:40,320 --> 00:02:43,448
[Music]

51
00:02:45,120 --> 00:02:48,160
and a group id back then

52
00:02:48,160 --> 00:02:50,160
you know published their reports on

53
00:02:50,160 --> 00:02:53,920
cobalts and we're thinking

54
00:02:54,879 --> 00:02:56,640
back then you know we kept saying that

55
00:02:56,640 --> 00:02:57,840
it's a weird

56
00:02:57,840 --> 00:03:00,080
case of actually a group being called

57
00:03:00,080 --> 00:03:01,840
after their till at the same time this

58
00:03:01,840 --> 00:03:04,720
framework keeps gaining popularity it

59
00:03:04,720 --> 00:03:08,000
keeps being used it is still on the rise

60
00:03:08,000 --> 00:03:11,200
and it is actually being used

61
00:03:11,200 --> 00:03:13,599
a lot

62
00:03:15,040 --> 00:03:17,519
is also a household name

63
00:03:17,519 --> 00:03:19,440
and back in

64
00:03:19,440 --> 00:03:22,480
2010 you know old phages well remember

65
00:03:22,480 --> 00:03:25,360
this girl so there was a gooey

66
00:03:25,360 --> 00:03:26,640
interface

67
00:03:26,640 --> 00:03:31,480
for a meta split called hermitage

68
00:03:44,080 --> 00:03:44,840
ever

69
00:03:44,840 --> 00:03:46,799
opportunity

70
00:03:46,799 --> 00:03:50,000
to work with numerous targets through

71
00:03:50,000 --> 00:03:53,440
the same team server

72
00:03:53,840 --> 00:03:55,200
well in fact

73
00:03:55,200 --> 00:03:56,560
managing

74
00:03:56,560 --> 00:03:58,560
teamwork of several red teamers or

75
00:03:58,560 --> 00:04:01,560
hackers

76
00:04:02,959 --> 00:04:05,200
this gave us you know the main tool for

77
00:04:05,200 --> 00:04:06,959
post exploitation

78
00:04:06,959 --> 00:04:08,239
launched by

79
00:04:08,239 --> 00:04:10,319
same raphael mod

80
00:04:10,319 --> 00:04:11,760
in 2012

81
00:04:11,760 --> 00:04:15,200
and it did become the standard

82
00:04:15,200 --> 00:04:18,798
team exploitation it became a proper

83
00:04:18,798 --> 00:04:21,120
commercial tool for

84
00:04:21,120 --> 00:04:23,440
cyber security assessment

85
00:04:23,440 --> 00:04:25,520
it has been used a lot now it's

86
00:04:25,520 --> 00:04:27,440
enterprise level

87
00:04:27,440 --> 00:04:28,479
in my opinion

88
00:04:28,479 --> 00:04:31,440
what helped this colossal growth was

89
00:04:31,440 --> 00:04:33,520
that back in 2012

90
00:04:33,520 --> 00:04:37,199
it was built on evasion philosophy

91
00:04:37,199 --> 00:04:39,919
it was built on the understanding that

92
00:04:39,919 --> 00:04:41,440
mutability

93
00:04:41,440 --> 00:04:43,120
is something that needs to be

94
00:04:43,120 --> 00:04:44,560
omnipresent

95
00:04:44,560 --> 00:04:46,080
in kabul strike

96
00:04:46,080 --> 00:04:48,639
so that you should be able

97
00:04:48,639 --> 00:04:51,199
to customize and fine-tune these

98
00:04:51,199 --> 00:04:53,880
elements so that they actually do

99
00:04:53,880 --> 00:04:57,040
randomization on their own

100
00:04:57,040 --> 00:05:01,680
so that every component is polymorphic

101
00:05:02,160 --> 00:05:03,919
what's also important is that this

102
00:05:03,919 --> 00:05:06,560
framework started gaining popularity not

103
00:05:06,560 --> 00:05:08,400
just among red teamers but also among

104
00:05:08,400 --> 00:05:10,320
hackers

105
00:05:10,320 --> 00:05:12,960
so we are saying today

106
00:05:12,960 --> 00:05:15,360
that uh you know even in triple and

107
00:05:15,360 --> 00:05:16,639
europol

108
00:05:16,639 --> 00:05:18,639
are saying how about we prohibit kabul

109
00:05:18,639 --> 00:05:20,639
strike completely

110
00:05:20,639 --> 00:05:22,800
because it's uh giving us too much

111
00:05:22,800 --> 00:05:25,520
headache you know it's associated with

112
00:05:25,520 --> 00:05:27,919
too much malicious activity

113
00:05:27,919 --> 00:05:30,560
and it does seem to overweigh

114
00:05:30,560 --> 00:05:33,360
the benefits that we can get for rat

115
00:05:33,360 --> 00:05:34,560
teamers

116
00:05:34,560 --> 00:05:38,160
it's weird i guess i mean

117
00:05:39,360 --> 00:05:41,840
can you really change the level of uh

118
00:05:41,840 --> 00:05:43,600
cyber security maturity with

119
00:05:43,600 --> 00:05:46,000
prohibitions like this but it is quite

120
00:05:46,000 --> 00:05:47,520
telling

121
00:05:47,520 --> 00:05:49,280
nonetheless

122
00:05:49,280 --> 00:05:51,600
what is kabul strike like so to speak

123
00:05:51,600 --> 00:05:53,919
internally the whole incident life cycle

124
00:05:53,919 --> 00:05:56,479
can be supported with cobalt strike you

125
00:05:56,479 --> 00:05:57,440
know

126
00:05:57,440 --> 00:06:00,639
from intelligence and reconnaissance

127
00:06:00,639 --> 00:06:03,680
you know weaponizing and

128
00:06:03,680 --> 00:06:06,720
fading dangerous payloads and creating

129
00:06:06,720 --> 00:06:08,960
spear fishing templates

130
00:06:08,960 --> 00:06:11,840
supporting collaboration

131
00:06:11,840 --> 00:06:14,400
how numerous shall i say employees or

132
00:06:14,400 --> 00:06:17,520
teamers and post exploitation as well

133
00:06:17,520 --> 00:06:19,600
so from persistence to privilege

134
00:06:19,600 --> 00:06:21,520
escalation

135
00:06:21,520 --> 00:06:24,800
a lateral movement i love so much

136
00:06:24,800 --> 00:06:27,120
all the way to golden ticket

137
00:06:27,120 --> 00:06:30,960
all this is available out of the box

138
00:06:30,960 --> 00:06:34,160
easily clickable with the you know right

139
00:06:34,160 --> 00:06:35,440
mouse click

140
00:06:35,440 --> 00:06:36,400
instrument

141
00:06:36,400 --> 00:06:39,199
all this you know has uh beacons

142
00:06:39,199 --> 00:06:42,080
associated with it

143
00:06:42,080 --> 00:06:44,240
and they will be communicating you know

144
00:06:44,240 --> 00:06:48,800
between the cnc and all the notes

145
00:06:48,800 --> 00:06:51,440
we've been able to compromise in the

146
00:06:51,440 --> 00:06:54,639
infrastructure we're talking

147
00:06:54,720 --> 00:06:58,400
now if we look at coverage

148
00:07:00,560 --> 00:07:02,720
no other framework

149
00:07:02,720 --> 00:07:06,080
will give you this kind of coverage

150
00:07:06,720 --> 00:07:07,919
user guide

151
00:07:07,919 --> 00:07:09,440
that's a miracle

152
00:07:09,440 --> 00:07:11,599
if you haven't checked out

153
00:07:11,599 --> 00:07:14,880
coupled strike user guide please do

154
00:07:14,880 --> 00:07:17,840
not

155
00:07:22,319 --> 00:07:25,199
carefully crafted to documentation

156
00:07:25,199 --> 00:07:27,680
videos and references

157
00:07:27,680 --> 00:07:30,880
it's a pleasure to use it

158
00:07:30,880 --> 00:07:33,759
actually same is true for a command

159
00:07:33,759 --> 00:07:37,360
it's as simple as a writing script

160
00:07:37,360 --> 00:07:40,560
for a minecraft server

161
00:07:41,360 --> 00:07:43,199
and this is all you need for lateral

162
00:07:43,199 --> 00:07:45,280
movement download

163
00:07:45,280 --> 00:07:48,080
i'm sorry upload get system

164
00:07:48,080 --> 00:07:51,199
get hash get password done get golden

165
00:07:51,199 --> 00:07:54,319
ticket this is it

166
00:07:56,000 --> 00:07:57,599
this is something i want to stress again

167
00:07:57,599 --> 00:08:00,750
because it's uber important

168
00:08:00,750 --> 00:08:03,879
[Music]

169
00:08:06,400 --> 00:08:09,360
it has made offensive

170
00:08:09,360 --> 00:08:11,280
industrially possible you know just like

171
00:08:11,280 --> 00:08:13,759
henry ford created conveyor in

172
00:08:13,759 --> 00:08:15,520
manufacturing

173
00:08:15,520 --> 00:08:18,720
cobblestrike brought the conveyor belt

174
00:08:18,720 --> 00:08:21,280
to exploitation uh reconnaissance or

175
00:08:21,280 --> 00:08:22,879
what have you so some people are doing

176
00:08:22,879 --> 00:08:24,400
initial access others are sending out

177
00:08:24,400 --> 00:08:26,000
phishing messengers yet others are

178
00:08:26,000 --> 00:08:28,400
creating fake websites

179
00:08:28,400 --> 00:08:30,720
while others will be setting up cobble

180
00:08:30,720 --> 00:08:33,679
servers and doing configurations

181
00:08:33,679 --> 00:08:36,159
and others you know will be selling

182
00:08:36,159 --> 00:08:39,599
their services uh it's an initial access

183
00:08:39,599 --> 00:08:42,000
exchange or maybe they're doing lateral

184
00:08:42,000 --> 00:08:44,720
access and compromising and exfiltration

185
00:08:44,720 --> 00:08:47,040
of data and stealing of money and this

186
00:08:47,040 --> 00:08:48,640
whole industry

187
00:08:48,640 --> 00:08:49,440
is

188
00:08:49,440 --> 00:08:54,040
possible thanks to team server

189
00:08:56,880 --> 00:08:58,720
special i mean you probably don't want

190
00:08:58,720 --> 00:09:00,800
uh those who are trying to protect

191
00:09:00,800 --> 00:09:02,320
against it to know about it that's why

192
00:09:02,320 --> 00:09:04,399
there are so many redirectors

193
00:09:04,399 --> 00:09:06,880
and redirectors without creating extra

194
00:09:06,880 --> 00:09:09,519
information load create proxies

195
00:09:09,519 --> 00:09:12,080
so that you know you can forward this

196
00:09:12,080 --> 00:09:14,480
traffic to the main team server while

197
00:09:14,480 --> 00:09:16,800
also having the pool of ip addresses and

198
00:09:16,800 --> 00:09:17,920
domains

199
00:09:17,920 --> 00:09:20,320
even if some of them are blocked you

200
00:09:20,320 --> 00:09:23,040
will still be connected to the beacon

201
00:09:23,040 --> 00:09:26,719
that is the compromise host

202
00:09:29,680 --> 00:09:31,519
from the same theory reports

203
00:09:31,519 --> 00:09:33,680
i'm uh showing you know this compromise

204
00:09:33,680 --> 00:09:36,000
change

205
00:09:48,839 --> 00:09:53,200
payload gets executed

206
00:09:54,080 --> 00:09:56,160
will be propagated over somebody from no

207
00:09:56,160 --> 00:09:58,000
mistake and then it

208
00:09:58,000 --> 00:10:00,480
finds a server where zero logon can be

209
00:10:00,480 --> 00:10:01,680
exploited

210
00:10:01,680 --> 00:10:04,959
voila we have the golden

211
00:10:17,040 --> 00:10:19,680
encoding

212
00:10:19,680 --> 00:10:21,279
powershell

213
00:10:21,279 --> 00:10:22,959
where we can you know propagate further

214
00:10:22,959 --> 00:10:26,479
through smp powershell

215
00:10:28,399 --> 00:10:30,160
are extremely important for the kabul

216
00:10:30,160 --> 00:10:33,120
strike infrastructure

217
00:10:33,120 --> 00:10:35,920
now this is in fact the payload that

218
00:10:35,920 --> 00:10:36,959
will be

219
00:10:36,959 --> 00:10:40,399
fired up in on victim hosts they can be

220
00:10:40,399 --> 00:10:43,760
simple http and gtbs beacons for over

221
00:10:43,760 --> 00:10:45,680
the internet communication

222
00:10:45,680 --> 00:10:49,440
just but also smb and ldap beacons for

223
00:10:49,440 --> 00:10:51,680
internet communications they're also

224
00:10:51,680 --> 00:10:53,440
hidden beacons

225
00:10:53,440 --> 00:10:55,360
like i said you know for the local

226
00:10:55,360 --> 00:10:59,320
network that's held up

227
00:11:02,959 --> 00:11:06,480
and hybrid dns http for the internet

228
00:11:06,480 --> 00:11:08,880
all these beacons are configured with

229
00:11:08,880 --> 00:11:10,480
the help of the so-called mobile

230
00:11:10,480 --> 00:11:12,079
profiles

231
00:11:12,079 --> 00:11:12,839
this

232
00:11:12,839 --> 00:11:14,640
configuration

233
00:11:14,640 --> 00:11:17,279
enables us to maintain you know this

234
00:11:17,279 --> 00:11:19,600
initial configurations and settings that

235
00:11:19,600 --> 00:11:21,360
will support for the communications and

236
00:11:21,360 --> 00:11:23,519
they contain the ip address for example

237
00:11:23,519 --> 00:11:26,720
that the bacon will be talking to

238
00:11:26,720 --> 00:11:28,240
but it also contains numerous

239
00:11:28,240 --> 00:11:31,040
randomization tools that will help it

240
00:11:31,040 --> 00:11:32,959
stay hidden

241
00:11:32,959 --> 00:11:34,720
this way for example you know you will

242
00:11:34,720 --> 00:11:37,120
be able to set up the frequency and also

243
00:11:37,120 --> 00:11:38,399
the jitter

244
00:11:38,399 --> 00:11:41,680
so that you know we don't see this uh

245
00:11:41,680 --> 00:11:44,079
spikes in traffic every minute or so but

246
00:11:44,079 --> 00:11:47,600
you know this spikes will be randomized

247
00:11:47,600 --> 00:11:51,279
same is true for user agents

248
00:11:54,079 --> 00:11:57,920
we can in fact use projects of github

249
00:11:57,920 --> 00:11:59,440
that will help us automatically

250
00:11:59,440 --> 00:12:02,160
randomize it all

251
00:12:02,880 --> 00:12:06,399
how do we hunt this infrastructure

252
00:12:06,720 --> 00:12:09,040
how do we find online

253
00:12:09,040 --> 00:12:10,240
stuff that at least looks like

254
00:12:10,240 --> 00:12:12,720
cobblestone

255
00:12:12,720 --> 00:12:14,880
you know many hackers are lazy and they

256
00:12:14,880 --> 00:12:17,519
will be using kabul strike which is uh

257
00:12:17,519 --> 00:12:19,279
pirate sets because otherwise it's only

258
00:12:19,279 --> 00:12:21,440
commercially available

259
00:12:21,440 --> 00:12:24,480
and this may actually help us identify

260
00:12:24,480 --> 00:12:27,200
their cnc's

261
00:12:27,200 --> 00:12:28,720
by default

262
00:12:28,720 --> 00:12:31,279
and default is the key word here

263
00:12:31,279 --> 00:12:34,480
word 5050 will be used

264
00:12:34,480 --> 00:12:38,720
by default nano hdpd will be used

265
00:12:38,720 --> 00:12:40,959
by defaults

266
00:12:40,959 --> 00:12:42,639
there is a serial number for the

267
00:12:42,639 --> 00:12:43,760
certificate

268
00:12:43,760 --> 00:12:47,360
and we can look for all this

269
00:12:47,680 --> 00:12:50,160
at the moment both shoden

270
00:12:50,160 --> 00:12:52,719
and spy

271
00:13:01,040 --> 00:13:02,959
they will you know already you know give

272
00:13:02,959 --> 00:13:05,839
us sounds of them they've already built

273
00:13:05,839 --> 00:13:08,720
into you know their systems

274
00:13:08,720 --> 00:13:11,200
searched by this you know

275
00:13:11,200 --> 00:13:13,839
default configurations

276
00:13:13,839 --> 00:13:15,600
this stuff is currently available out of

277
00:13:15,600 --> 00:13:17,200
the box

278
00:13:17,200 --> 00:13:19,360
so if you go looking for a couple strike

279
00:13:19,360 --> 00:13:21,440
beacon config you will see the service

280
00:13:21,440 --> 00:13:23,440
not to match the default settings but

281
00:13:23,440 --> 00:13:27,040
also the configurations inside them

282
00:13:30,320 --> 00:13:34,000
now a j3 has been mentioned previously

283
00:13:34,000 --> 00:13:36,959
this is actually a combination of cypher

284
00:13:36,959 --> 00:13:39,199
seeds of ssl

285
00:13:39,199 --> 00:13:42,480
and other parameters of ssl sessions

286
00:13:42,480 --> 00:13:43,920
which can be used to create a

287
00:13:43,920 --> 00:13:46,320
fingerprint both for the client and the

288
00:13:46,320 --> 00:13:47,600
server

289
00:13:47,600 --> 00:13:49,600
on the basis of which

290
00:13:49,600 --> 00:13:51,680
we can determine that a particular

291
00:13:51,680 --> 00:13:53,920
server is exactly what we are looking

292
00:13:53,920 --> 00:13:55,279
for

293
00:13:55,279 --> 00:13:57,920
because hackers are lazy

294
00:13:57,920 --> 00:14:00,839
it is easier for them to clone virtual

295
00:14:00,839 --> 00:14:03,360
machines rather than you know

296
00:14:03,360 --> 00:14:05,199
configure everything from scratch so if

297
00:14:05,199 --> 00:14:07,760
these are default settings

298
00:14:07,760 --> 00:14:10,079
if this infrastructure has already been

299
00:14:10,079 --> 00:14:13,279
involved in infection we should be able

300
00:14:13,279 --> 00:14:16,160
to identify the server that the bacon

301
00:14:16,160 --> 00:14:17,839
was um you know

302
00:14:17,839 --> 00:14:19,440
corresponding with and we can also

303
00:14:19,440 --> 00:14:21,600
identify the beacon then we should be

304
00:14:21,600 --> 00:14:25,120
able to find it on the traffic logs of

305
00:14:25,120 --> 00:14:26,639
our firewalls

306
00:14:26,639 --> 00:14:30,240
and we can also find it actively by

307
00:14:30,240 --> 00:14:32,720
asking so to speak the servers or we can

308
00:14:32,720 --> 00:14:34,880
find it passively using tools like

309
00:14:34,880 --> 00:14:37,839
shodhan same is true for germ

310
00:14:37,839 --> 00:14:39,760
charm is actually using a slightly

311
00:14:39,760 --> 00:14:42,160
different way

312
00:14:42,160 --> 00:14:45,639
of combining

313
00:14:57,199 --> 00:14:58,880
intelligence tools

314
00:14:58,880 --> 00:15:00,399
these are the results

315
00:15:00,399 --> 00:15:01,680
so we can uh

316
00:15:01,680 --> 00:15:05,279
search on shortened by hashes or charm

317
00:15:05,279 --> 00:15:07,760
or open ports

318
00:15:07,760 --> 00:15:09,440
and in the end we see the configuration

319
00:15:09,440 --> 00:15:12,959
of beacon servers this way

320
00:15:16,240 --> 00:15:18,959
iocs that will be used we can also see

321
00:15:18,959 --> 00:15:20,880
indicators of attack

322
00:15:20,880 --> 00:15:22,959
such as namepipe

323
00:15:22,959 --> 00:15:25,600
and the names of processes where carbon

324
00:15:25,600 --> 00:15:27,760
strike will be i'm sorry the beacon will

325
00:15:27,760 --> 00:15:30,880
be spawned in and injected in

326
00:15:30,880 --> 00:15:32,110
ti feeds

327
00:15:32,110 --> 00:15:35,040
[Music]

328
00:15:35,040 --> 00:15:38,399
the previous speaker talked about

329
00:15:43,279 --> 00:15:45,920
you should be able to get the

330
00:15:45,920 --> 00:15:46,639
j

331
00:15:46,639 --> 00:15:50,320
j arm and j threes

332
00:15:50,800 --> 00:15:52,720
so if you want to check something do

333
00:15:52,720 --> 00:15:55,120
this that would be a way to go the way

334
00:15:55,120 --> 00:15:57,440
to do it

335
00:15:58,160 --> 00:15:59,360
so with ali

336
00:15:59,360 --> 00:16:01,440
subscription that would actually make it

337
00:16:01,440 --> 00:16:05,279
an active monitoring tool right

338
00:16:06,160 --> 00:16:08,399
this is how you can go about uh looking

339
00:16:08,399 --> 00:16:10,160
on a regular basis

340
00:16:10,160 --> 00:16:13,120
for default coupled strike servers

341
00:16:13,120 --> 00:16:14,560
and this provides you with a lot of

342
00:16:14,560 --> 00:16:17,120
analytics so this is a great project by

343
00:16:17,120 --> 00:16:19,839
iran nuts they actually scan the whole

344
00:16:19,839 --> 00:16:22,800
internet for us you probably cannot read

345
00:16:22,800 --> 00:16:25,519
it but let me rephrase it for you so

346
00:16:25,519 --> 00:16:26,959
here

347
00:16:26,959 --> 00:16:28,780
really see all charm hashes

348
00:16:28,780 --> 00:16:34,880
[Music]

349
00:16:34,880 --> 00:16:37,519
and listed here all the urls these are

350
00:16:37,519 --> 00:16:40,079
all the guts and all the posts

351
00:16:40,079 --> 00:16:42,320
all the ais is here

352
00:16:42,320 --> 00:16:43,920
that you can block

353
00:16:43,920 --> 00:16:46,639
just like that they're all chinese

354
00:16:46,639 --> 00:16:48,800
and lots of other great things lots of

355
00:16:48,800 --> 00:16:51,079
other goodies 32-bit

356
00:16:51,079 --> 00:16:55,279
64-bit processes to be injected in

357
00:16:55,279 --> 00:16:58,720
locations where it's going to be spooned

358
00:16:58,720 --> 00:17:01,440
finally we have ti

359
00:17:01,440 --> 00:17:04,319
which is no longer at armory like the

360
00:17:04,319 --> 00:17:06,559
pyramid of fame

361
00:17:06,559 --> 00:17:08,480
you know something that you know has

362
00:17:08,480 --> 00:17:12,799
been promised to us for such a long time

363
00:17:13,199 --> 00:17:16,720
http traffic is not used anymore

364
00:17:16,720 --> 00:17:19,119
and if we see that communication is

365
00:17:19,119 --> 00:17:23,039
really happening through dns tunnels

366
00:17:23,280 --> 00:17:25,760
well there is still the opportunity to

367
00:17:25,760 --> 00:17:28,240
identify this traffic if you can sell

368
00:17:28,240 --> 00:17:30,720
the table but you know nobody care to

369
00:17:30,720 --> 00:17:32,480
change and the parameters that stay

370
00:17:32,480 --> 00:17:33,600
default

371
00:17:33,600 --> 00:17:35,200
now all these parameters they come

372
00:17:35,200 --> 00:17:37,200
straight from the couple strike user

373
00:17:37,200 --> 00:17:38,880
guide

374
00:17:38,880 --> 00:17:40,559
but you can also use statistics to the

375
00:17:40,559 --> 00:17:41,360
same

376
00:17:41,360 --> 00:17:42,640
end

377
00:17:42,640 --> 00:17:47,120
so i'm showing sigma as an example here

378
00:17:47,120 --> 00:17:48,960
we can either look for patterns in the

379
00:17:48,960 --> 00:17:54,080
configuration or we can try calculating

380
00:17:54,640 --> 00:17:57,919
you know the overall scope of uh request

381
00:17:57,919 --> 00:18:01,400
to subdomain

382
00:18:13,120 --> 00:18:15,120
hosts like dell machines that will be

383
00:18:15,120 --> 00:18:17,440
using these tunnels

384
00:18:17,440 --> 00:18:20,799
and one of the tools of profiling

385
00:18:20,799 --> 00:18:23,360
that should help us you know understand

386
00:18:23,360 --> 00:18:26,480
how it can work with a network telemetry

387
00:18:26,480 --> 00:18:28,160
this is actually writer real

388
00:18:28,160 --> 00:18:31,440
intelligence throughout analytics

389
00:18:34,400 --> 00:18:36,559
on a one hour long you know one hour

390
00:18:36,559 --> 00:18:38,480
worth so to speak of normal traffic and

391
00:18:38,480 --> 00:18:40,400
that already will tell you a lot that

392
00:18:40,400 --> 00:18:43,840
she can trust

393
00:18:54,000 --> 00:18:56,000
there is this malicious file we are

394
00:18:56,000 --> 00:18:58,960
getting we are seeing in our perimeter

395
00:18:58,960 --> 00:19:01,360
well if you are prepared to send it to a

396
00:19:01,360 --> 00:19:04,160
cloud sandbox i would certainly

397
00:19:04,160 --> 00:19:05,919
recommend triage but if you are not

398
00:19:05,919 --> 00:19:07,520
prepared to do that you may want to

399
00:19:07,520 --> 00:19:11,160
analyze it manually

400
00:19:17,760 --> 00:19:19,600
because there's so much you can find

401
00:19:19,600 --> 00:19:22,160
there on triad g

402
00:19:22,160 --> 00:19:25,440
you know the chain of processes and uh

403
00:19:25,440 --> 00:19:27,600
deciphering of the configuration you

404
00:19:27,600 --> 00:19:29,440
know it you know works it looks like a

405
00:19:29,440 --> 00:19:31,840
miracle

406
00:19:31,840 --> 00:19:34,080
so you can see the configuration you see

407
00:19:34,080 --> 00:19:36,799
the process chain here

408
00:19:36,799 --> 00:19:38,879
and

409
00:19:51,440 --> 00:19:53,120
quite naturally they will be sitting

410
00:19:53,120 --> 00:19:55,760
inside it or in the operating memory

411
00:19:55,760 --> 00:19:57,919
after it has been executed and we can

412
00:19:57,919 --> 00:20:00,160
parse this memory areas

413
00:20:00,160 --> 00:20:01,520
and then decrypt them that's not

414
00:20:01,520 --> 00:20:03,120
difficult they exhort you know with a

415
00:20:03,120 --> 00:20:06,678
four byte key

416
00:20:21,520 --> 00:20:23,760
we can extract indicators of attack from

417
00:20:23,760 --> 00:20:24,480
them

418
00:20:24,480 --> 00:20:26,880
and see which projects these uh

419
00:20:26,880 --> 00:20:28,880
processes i'm sorry this beacon will be

420
00:20:28,880 --> 00:20:31,120
injected in and identified cnc's and

421
00:20:31,120 --> 00:20:33,360
user agents

422
00:20:33,360 --> 00:20:36,080
thus we actually update our database of

423
00:20:36,080 --> 00:20:38,960
indicators of attack

424
00:20:39,200 --> 00:20:42,880
a great project called 1768

425
00:20:42,880 --> 00:20:45,600
this is actually cobalt melting

426
00:20:45,600 --> 00:20:49,639
temperature in kelvin

427
00:20:51,039 --> 00:20:54,080
so it contains the default keys for a

428
00:20:54,080 --> 00:20:56,480
cobbled strike you can actually find you

429
00:20:56,480 --> 00:20:58,559
know in uh the copies of a couple

430
00:20:58,559 --> 00:21:00,960
strikes

431
00:21:04,720 --> 00:21:06,480
so you can actually you know use these

432
00:21:06,480 --> 00:21:08,400
keys to interact with another beacon

433
00:21:08,400 --> 00:21:10,720
pretending you are a beacon

434
00:21:10,720 --> 00:21:12,880
and thus requesting its configuration

435
00:21:12,880 --> 00:21:14,400
files

436
00:21:14,400 --> 00:21:16,559
or alternatively you can actually find

437
00:21:16,559 --> 00:21:18,960
them on 1768 and

438
00:21:18,960 --> 00:21:20,400
like i said

439
00:21:20,400 --> 00:21:21,919
this information can be found in the

440
00:21:21,919 --> 00:21:24,240
memory

441
00:21:28,799 --> 00:21:30,880
regardless of the type of the bacon

442
00:21:30,880 --> 00:21:32,559
being used

443
00:21:32,559 --> 00:21:35,600
its interaction will be encrypted in the

444
00:21:35,600 --> 00:21:38,320
ask which is stored in the server and in

445
00:21:38,320 --> 00:21:40,799
the beacon itself

446
00:21:40,799 --> 00:21:45,559
so if we intercept this key

447
00:22:01,790 --> 00:22:04,159
[Music]

448
00:22:04,159 --> 00:22:05,919
we can actually see which kind of

449
00:22:05,919 --> 00:22:07,760
commands were sent by the bacon and

450
00:22:07,760 --> 00:22:11,440
which files were leaked and we can also

451
00:22:11,440 --> 00:22:13,520
get access to you know the encryption

452
00:22:13,520 --> 00:22:15,520
keys that we used to well decrypt our

453
00:22:15,520 --> 00:22:17,440
files for example

454
00:22:17,440 --> 00:22:19,120
so we just you know use

455
00:22:19,120 --> 00:22:21,039
these values and we put them into the

456
00:22:21,039 --> 00:22:23,679
pickup files

457
00:22:24,559 --> 00:22:27,559
premiere

458
00:22:30,960 --> 00:22:33,200
we can actually find the patterns in

459
00:22:33,200 --> 00:22:35,600
operating memory

460
00:22:35,600 --> 00:22:38,400
that will serve correspond with a bacon

461
00:22:38,400 --> 00:22:40,720
being injected in a given process until

462
00:22:40,720 --> 00:22:42,400
version 4

463
00:22:42,400 --> 00:22:44,880
it was a stationary pattern you would

464
00:22:44,880 --> 00:22:48,640
simply look for a particular pattern

465
00:22:50,400 --> 00:22:52,720
with this you know encryption key you

466
00:22:52,720 --> 00:22:54,720
could actually decrypt it and check the

467
00:22:54,720 --> 00:22:56,559
configuration now

468
00:22:56,559 --> 00:22:58,320
this string is random

469
00:22:58,320 --> 00:23:00,320
however the format is pretty

470
00:23:00,320 --> 00:23:03,280
standardized so you can actually test

471
00:23:03,280 --> 00:23:05,440
different combinations

472
00:23:05,440 --> 00:23:08,559
and in the end you will find something

473
00:23:08,559 --> 00:23:10,000
that's readable such as bacon

474
00:23:10,000 --> 00:23:13,919
configuration what are we looking for

475
00:23:15,840 --> 00:23:18,799
we're effectively looking for the forest

476
00:23:18,799 --> 00:23:22,000
where the bacon will be spawned and what

477
00:23:22,000 --> 00:23:24,080
it is going to get in touch with and

478
00:23:24,080 --> 00:23:27,039
also the name pipes

479
00:23:28,320 --> 00:23:30,640
there are two types of payloads with a

480
00:23:30,640 --> 00:23:32,320
couple strikes

481
00:23:32,320 --> 00:23:35,280
one is staged the other is stageless

482
00:23:35,280 --> 00:23:39,520
staged is really small it was designed

483
00:23:39,520 --> 00:23:42,720
not to be detected

484
00:23:43,679 --> 00:23:46,480
once it's launched

485
00:23:46,480 --> 00:23:48,320
it will actually download the rest of

486
00:23:48,320 --> 00:23:51,360
the payloads so for example here we're

487
00:23:51,360 --> 00:23:52,880
seeing the exploitation of a

488
00:23:52,880 --> 00:23:55,520
vulnerability and microsoft's words

489
00:23:55,520 --> 00:23:59,520
which will then inject files

490
00:24:01,919 --> 00:24:05,360
subsidiary process where we shall see

491
00:24:05,360 --> 00:24:07,520
you know the download of payload

492
00:24:07,520 --> 00:24:09,918
happening

493
00:24:10,799 --> 00:24:13,279
however the staged beacon will be

494
00:24:13,279 --> 00:24:16,080
limited and we cannot build keys into

495
00:24:16,080 --> 00:24:17,520
that which means the communication will

496
00:24:17,520 --> 00:24:21,520
not be secure in lots of other things

497
00:24:21,520 --> 00:24:23,840
cannot be built into that so it may have

498
00:24:23,840 --> 00:24:28,000
a difficult time hiding from avs

499
00:24:28,000 --> 00:24:30,320
and again we cannot insert a string like

500
00:24:30,320 --> 00:24:33,039
this in b64 simply because common line

501
00:24:33,039 --> 00:24:35,679
will not be enough for that that's why

502
00:24:35,679 --> 00:24:38,960
stage attacks are used more and more

503
00:24:38,960 --> 00:24:40,799
often

504
00:24:40,799 --> 00:24:43,520
at this stage of the stage attack we are

505
00:24:43,520 --> 00:24:46,400
already see creation of a named pipe and

506
00:24:46,400 --> 00:24:48,799
what is a named pipe

507
00:24:48,799 --> 00:24:51,039
as you can see here

508
00:24:51,039 --> 00:24:53,279
yes you know all those who

509
00:24:53,279 --> 00:24:56,640
scan their network with balance scanners

510
00:24:56,640 --> 00:24:58,559
must have seen that you know sometimes

511
00:24:58,559 --> 00:25:00,400
we know nothing about a windows machine

512
00:25:00,400 --> 00:25:03,120
except for open boards

513
00:25:03,120 --> 00:25:05,120
except for you know

514
00:25:05,120 --> 00:25:07,840
slash rpc and whatever

515
00:25:07,840 --> 00:25:11,360
so this is part of the smb standard

516
00:25:11,360 --> 00:25:14,400
and thanks to both local processes and

517
00:25:14,400 --> 00:25:17,840
online hosts can communicate

518
00:25:17,840 --> 00:25:21,039
this what you can see in the video here

519
00:25:21,039 --> 00:25:23,279
so we see the active listener of the

520
00:25:23,279 --> 00:25:25,840
name pipe

521
00:25:25,840 --> 00:25:29,760
is actually transmitting information

522
00:25:29,760 --> 00:25:31,840
the same can be done by other devices it

523
00:25:31,840 --> 00:25:34,559
requires no authentication it requires

524
00:25:34,559 --> 00:25:37,490
no additional ports this is not natcat

525
00:25:37,490 --> 00:25:39,840
[Music]

526
00:25:39,840 --> 00:25:42,000
we're effectively using the same samba

527
00:25:42,000 --> 00:25:43,440
board

528
00:25:43,440 --> 00:25:47,600
and detecting it is nearly impossible

529
00:25:47,679 --> 00:25:49,919
if you don't have six months

530
00:25:49,919 --> 00:25:52,799
all the devices running it you're not

531
00:25:52,799 --> 00:25:56,600
going to see

532
00:26:01,600 --> 00:26:04,480
18 and 17 that should help you do that

533
00:26:04,480 --> 00:26:09,400
they would help you register creation

534
00:26:10,080 --> 00:26:11,760
like profiling of something like this

535
00:26:11,760 --> 00:26:14,159
because name pipes are used by everybody

536
00:26:14,159 --> 00:26:16,400
like even chrome design

537
00:26:16,400 --> 00:26:18,559
but we can identify it as something

538
00:26:18,559 --> 00:26:20,720
weird

539
00:26:20,960 --> 00:26:22,640
you know when it's say an anonymous

540
00:26:22,640 --> 00:26:25,640
pipeline

541
00:26:27,760 --> 00:26:31,089
[Music]

542
00:26:35,120 --> 00:26:38,678
ldap right

543
00:26:40,150 --> 00:26:43,319
[Music]

544
00:26:51,200 --> 00:26:53,279
instructions to another compromise

545
00:26:53,279 --> 00:26:55,760
device and this can be detected without

546
00:26:55,760 --> 00:26:57,919
any special settings

547
00:26:57,919 --> 00:27:01,919
thanks to 5135 thanks to

548
00:27:01,919 --> 00:27:06,279
you know additions to active directory

549
00:27:10,400 --> 00:27:13,279
so we see a primary internal as the

550
00:27:13,279 --> 00:27:15,679
number has been

551
00:27:15,679 --> 00:27:18,159
expanded with new attributes and these

552
00:27:18,159 --> 00:27:19,919
new attributes are indeed the executable

553
00:27:19,919 --> 00:27:22,000
instruction

554
00:27:22,000 --> 00:27:24,159
and what everybody loves cobble strike

555
00:27:24,159 --> 00:27:28,000
fool is naturally arsenal kits

556
00:27:31,120 --> 00:27:36,399
device so easily compromised can then be

557
00:27:36,559 --> 00:27:38,000
you know

558
00:27:38,000 --> 00:27:40,240
leveraged even further where you can you

559
00:27:40,240 --> 00:27:41,120
know

560
00:27:41,120 --> 00:27:43,840
do privilege escalation you can dump

561
00:27:43,840 --> 00:27:46,240
account details and credentials or you

562
00:27:46,240 --> 00:27:48,799
can do lateral movement or increase

563
00:27:48,799 --> 00:27:50,960
everything all this is available through

564
00:27:50,960 --> 00:27:53,679
arsenal kids

565
00:27:55,360 --> 00:27:57,440
we are showing an example of mimikaz

566
00:27:57,440 --> 00:27:59,600
here

567
00:28:00,799 --> 00:28:03,760
where it's used to compromise uh local

568
00:28:03,760 --> 00:28:06,240
credentials but also dc sync and this

569
00:28:06,240 --> 00:28:10,240
thing was properly covered yesterday

570
00:28:11,840 --> 00:28:13,840
lateral movement kits

571
00:28:13,840 --> 00:28:17,840
require a separate mention

572
00:28:35,919 --> 00:28:39,600
such as a tusk scheduler dcom services

573
00:28:39,600 --> 00:28:42,240
you name it all this stuff is available

574
00:28:42,240 --> 00:28:44,640
off the shelf outside the box out of the

575
00:28:44,640 --> 00:28:46,250
box i'm sorry

576
00:28:46,250 --> 00:28:49,120
[Music]

577
00:28:49,120 --> 00:28:51,760
fancy tools very popular now

578
00:28:51,760 --> 00:28:54,240
such as powershell winramps are also

579
00:28:54,240 --> 00:28:55,440
there

580
00:28:55,440 --> 00:28:58,640
and even kerberos will not stop us

581
00:28:58,640 --> 00:29:01,039
stay i'm sorry same is true first take

582
00:29:01,039 --> 00:29:03,760
it this is effective modification of the

583
00:29:03,760 --> 00:29:05,600
lateral movement kids

584
00:29:05,600 --> 00:29:08,799
so it helps us with persistence so task

585
00:29:08,799 --> 00:29:11,600
scheduler and services

586
00:29:11,600 --> 00:29:15,360
and after runs and log on scripts

587
00:29:15,360 --> 00:29:18,159
or wmi event subscription then you

588
00:29:18,159 --> 00:29:20,000
fingels like the new kid on the block

589
00:29:20,000 --> 00:29:24,640
they all can be used with those kits

590
00:29:24,640 --> 00:29:28,399
so how do we detect this stuff

591
00:29:29,440 --> 00:29:31,600
now the tool that is used

592
00:29:31,600 --> 00:29:33,440
pretty much everywhere that was uh

593
00:29:33,440 --> 00:29:35,679
covered uh yesterday

594
00:29:35,679 --> 00:29:40,080
it's a bloodhound and i'd find

595
00:29:44,630 --> 00:29:47,360
[Music]

596
00:29:47,360 --> 00:29:50,640
whenever tgt is being requested

597
00:29:50,640 --> 00:29:52,799
and it's built into

598
00:29:52,799 --> 00:29:55,360
various kits uh actually

599
00:29:55,360 --> 00:29:57,200
available in kabul strike and it can be

600
00:29:57,200 --> 00:29:59,679
detected

601
00:30:01,440 --> 00:30:02,640
when you

602
00:30:02,640 --> 00:30:05,679
monitor for weird activity through cli

603
00:30:05,679 --> 00:30:09,520
or you can also monitor all the

604
00:30:09,520 --> 00:30:12,399
uh requests to enterprise admins and

605
00:30:12,399 --> 00:30:15,360
local admins groups

606
00:30:15,360 --> 00:30:18,799
defense evasion now

607
00:30:19,679 --> 00:30:20,799
pasqual

608
00:30:20,799 --> 00:30:22,880
tv

609
00:30:22,880 --> 00:30:26,139
[Music]

610
00:30:29,200 --> 00:30:31,520
should be rewritten particularly if you

611
00:30:31,520 --> 00:30:34,000
go into operating memory right

612
00:30:34,000 --> 00:30:36,399
so you may want to check the names of

613
00:30:36,399 --> 00:30:38,399
all the functions and then you know

614
00:30:38,399 --> 00:30:41,039
somebody leaks your sample to virustotal

615
00:30:41,039 --> 00:30:42,799
and you need to do it all over again

616
00:30:42,799 --> 00:30:45,279
however

617
00:30:45,720 --> 00:30:48,799
windows.net is still available right

618
00:30:48,799 --> 00:30:50,399
and dotnet

619
00:30:50,399 --> 00:30:52,399
doesn't really have

620
00:30:52,399 --> 00:30:55,520
in-bet tools for defense evaluation

621
00:30:55,520 --> 00:30:58,000
you know clr can be used you know with a

622
00:30:58,000 --> 00:31:00,880
single command to execute assembly

623
00:31:00,880 --> 00:31:04,600
he can be monitored

624
00:31:12,880 --> 00:31:14,640
everything that's available at the

625
00:31:14,640 --> 00:31:16,399
moment such as you know giving yourself

626
00:31:16,399 --> 00:31:19,519
system rights uh using stolen tokens

627
00:31:19,519 --> 00:31:21,679
from privileged processes all this stuff

628
00:31:21,679 --> 00:31:23,120
is available

629
00:31:23,120 --> 00:31:24,640
out of the box which means that

630
00:31:24,640 --> 00:31:27,039
everything needs to be monitored at all

631
00:31:27,039 --> 00:31:28,960
times particularly when it comes to

632
00:31:28,960 --> 00:31:32,440
service launches

633
00:31:32,440 --> 00:31:35,760
46.97 this is something that every cm

634
00:31:35,760 --> 00:31:37,840
should be looking for

635
00:31:37,840 --> 00:31:40,000
you know this way you will be able to

636
00:31:40,000 --> 00:31:41,519
know you know what's happening you know

637
00:31:41,519 --> 00:31:43,679
what kind of services are being launched

638
00:31:43,679 --> 00:31:45,519
installed by users

639
00:31:45,519 --> 00:31:47,360
because you know the surface of attack

640
00:31:47,360 --> 00:31:50,320
there is colossal

641
00:31:50,320 --> 00:31:52,240
credential access

642
00:31:52,240 --> 00:31:54,480
it is no secret

643
00:31:54,480 --> 00:31:57,919
that all this stuff is used

644
00:31:58,159 --> 00:32:01,279
yeah this is true for local dumps

645
00:32:01,279 --> 00:32:03,679
and domain credentials dome so if you

646
00:32:03,679 --> 00:32:06,159
want to craft something

647
00:32:06,159 --> 00:32:07,519
online

648
00:32:07,519 --> 00:32:10,880
there are also tools like ntlm relay

649
00:32:10,880 --> 00:32:16,080
where you create a fake shared resource

650
00:32:16,080 --> 00:32:18,480
and you lure users there

651
00:32:18,480 --> 00:32:21,600
final finally lateral movement lost lots

652
00:32:21,600 --> 00:32:24,399
of options here

653
00:32:24,480 --> 00:32:28,720
and like i said we can detect it by for

654
00:32:28,720 --> 00:32:32,000
example privilege tokens 4624 should be

655
00:32:32,000 --> 00:32:33,840
the event to look for

656
00:32:33,840 --> 00:32:36,559
or also we can look for access to file

657
00:32:36,559 --> 00:32:39,559
shares

658
00:32:42,159 --> 00:32:44,480
we will see for example here

659
00:32:44,480 --> 00:32:46,559
that a potentially malicious tool is

660
00:32:46,559 --> 00:32:48,960
being used

661
00:32:49,200 --> 00:32:53,039
it could be for example a case of uh

662
00:32:53,200 --> 00:32:56,480
when we are trying to create a name pipe

663
00:32:56,480 --> 00:32:59,760
using logon type 9.

664
00:33:01,840 --> 00:33:04,879
service execution

665
00:33:05,120 --> 00:33:07,600
so here we'll also be monitoring for a

666
00:33:07,600 --> 00:33:10,559
creation or modification or termination

667
00:33:10,559 --> 00:33:11,840
of services

668
00:33:11,840 --> 00:33:15,039
we will be seeing the network telemetry

669
00:33:15,039 --> 00:33:17,440
and out of the network traffic we should

670
00:33:17,440 --> 00:33:19,200
be able to see

671
00:33:19,200 --> 00:33:23,519
requests to admin file shares

672
00:33:36,080 --> 00:33:38,320
attackers have created a reverse proxy

673
00:33:38,320 --> 00:33:40,480
to make it more convenient

674
00:33:40,480 --> 00:33:44,240
and they're trying to log on through rdb

675
00:33:49,760 --> 00:33:52,000
that a connection is coming from a local

676
00:33:52,000 --> 00:33:55,919
address like ips 127

677
00:33:55,919 --> 00:33:58,320
and finally sigma rules

678
00:33:58,320 --> 00:34:01,360
my recommendation

679
00:34:02,240 --> 00:34:04,399
to check what they should be for couples

680
00:34:04,399 --> 00:34:05,200
right

681
00:34:05,200 --> 00:34:07,760
note the default parameters the default

682
00:34:07,760 --> 00:34:12,079
settings which are often kept as such

683
00:34:12,079 --> 00:34:14,399
so amazon

684
00:34:14,399 --> 00:34:18,638
default strike profile for example

685
00:34:26,079 --> 00:34:27,760
now for profiling purposes there are

686
00:34:27,760 --> 00:34:30,000
lots and lots of user agents

687
00:34:30,000 --> 00:34:31,599
to look out for

688
00:34:31,599 --> 00:34:33,679
you may want to profile your system on

689
00:34:33,679 --> 00:34:35,918
the basis of which user agents you're

690
00:34:35,918 --> 00:34:38,159
actually using in your infrastructure

691
00:34:38,159 --> 00:34:39,918
and what kind of anomalies therefore you

692
00:34:39,918 --> 00:34:42,399
would like to watch out for

693
00:34:42,399 --> 00:34:44,079
malicious service installation are

694
00:34:44,079 --> 00:34:45,119
actually

695
00:34:45,119 --> 00:34:47,900
ready-made profiles to use

696
00:34:47,900 --> 00:34:51,079
[Music]

697
00:34:59,680 --> 00:35:01,760
you will need to generate lots and lots

698
00:35:01,760 --> 00:35:03,599
of roles

699
00:35:03,599 --> 00:35:05,599
because it could be end codes or it can

700
00:35:05,599 --> 00:35:07,359
be ang

701
00:35:07,359 --> 00:35:09,280
you know there is a lot of room for

702
00:35:09,280 --> 00:35:10,400
maneuver

703
00:35:10,400 --> 00:35:13,280
for the perpetrators here

704
00:35:13,280 --> 00:35:14,880
but all this can actually be well

705
00:35:14,880 --> 00:35:17,440
covered with sigma rules

706
00:35:17,440 --> 00:35:20,160
like i said services are indeed very

707
00:35:20,160 --> 00:35:23,118
very sensitive

708
00:35:27,040 --> 00:35:30,040
um

709
00:35:30,410 --> 00:35:33,660
[Music]

710
00:35:40,800 --> 00:35:42,839
and the audit of uh

711
00:35:42,839 --> 00:35:46,079
4697 is uh helping us find the pipes and

712
00:35:46,079 --> 00:35:48,800
the echoes

713
00:35:50,240 --> 00:35:52,800
which are often used for initial

714
00:35:52,800 --> 00:35:55,800
injections

715
00:35:56,400 --> 00:35:59,610
[Music]

716
00:36:07,839 --> 00:36:09,359
most of the injections are going into

717
00:36:09,359 --> 00:36:11,520
run dll32

718
00:36:11,520 --> 00:36:13,440
although you can actually inject in any

719
00:36:13,440 --> 00:36:15,040
process which is guaranteed to be on the

720
00:36:15,040 --> 00:36:17,119
system

721
00:36:17,119 --> 00:36:20,720
ntlm relay which i mentioned previously

722
00:36:20,720 --> 00:36:23,280
in connection to credential access

723
00:36:23,280 --> 00:36:24,720
driver

724
00:36:24,720 --> 00:36:26,960
you need monitoring here she'll focus on

725
00:36:26,960 --> 00:36:29,599
the driver which supports initiation of

726
00:36:29,599 --> 00:36:33,359
collection of ntlm hashes

727
00:36:34,000 --> 00:36:36,000
oh and thus you can therefore locally

728
00:36:36,000 --> 00:36:39,359
monitor for things like that

729
00:36:53,200 --> 00:36:54,800
tools for that

730
00:36:54,800 --> 00:36:56,000
i mean

731
00:36:56,000 --> 00:36:57,920
embedded tools of dotnet can be used for

732
00:36:57,920 --> 00:36:59,839
that

733
00:36:59,839 --> 00:37:02,720
so there are some commands in clr which

734
00:37:02,720 --> 00:37:05,759
need to be monitored

735
00:37:07,040 --> 00:37:09,119
i mean if you want to detect the tools

736
00:37:09,119 --> 00:37:11,040
that are trying to abuse your dot nut

737
00:37:11,040 --> 00:37:14,400
and finally couple strike b connectivity

738
00:37:14,400 --> 00:37:16,240
it's common knowledge really

739
00:37:16,240 --> 00:37:18,560
everybody knows uh it's important to

740
00:37:18,560 --> 00:37:23,320
monitor for who am i and echo

741
00:37:23,599 --> 00:37:27,200
and you know run once is also a pretty

742
00:37:27,200 --> 00:37:30,480
commonly used utilities

743
00:37:31,200 --> 00:37:35,960
the mind map for detection purposes

744
00:37:37,680 --> 00:37:40,000
so you may want to may want to keep it

745
00:37:40,000 --> 00:37:41,839
if you believe you are investing in

746
00:37:41,839 --> 00:37:43,599
something like to buy a couple stripe

747
00:37:43,599 --> 00:37:44,960
case

748
00:37:44,960 --> 00:37:48,160
so network indicators stuff you can get

749
00:37:48,160 --> 00:37:50,400
from active lookups or through ti

750
00:37:50,400 --> 00:37:53,040
platforms and manual searches or manual

751
00:37:53,040 --> 00:37:56,640
exploration investigations

752
00:38:12,160 --> 00:38:14,640
an extraction of keys and configurations

753
00:38:14,640 --> 00:38:15,680
from it

754
00:38:15,680 --> 00:38:18,680
um

755
00:38:31,359 --> 00:38:33,839
so you will be checking full dumps and

756
00:38:33,839 --> 00:38:35,599
process dumps

757
00:38:35,599 --> 00:38:37,920
looking for specific patterns

758
00:38:37,920 --> 00:38:40,000
attributability gobble strike and also

759
00:38:40,000 --> 00:38:41,270
live analysis

760
00:38:41,270 --> 00:38:43,520
[Music]

761
00:38:43,520 --> 00:38:45,359
so this could be a process start vlog

762
00:38:45,359 --> 00:38:47,359
analysis

763
00:38:47,359 --> 00:38:50,000
and service analysis like i previously

764
00:38:50,000 --> 00:38:52,720
said as well as analysis of

765
00:38:52,720 --> 00:38:55,839
events related to service emergence

766
00:38:55,839 --> 00:38:58,400
that's it for me thank you very much

767
00:38:58,400 --> 00:39:02,709
[Applause]

768
00:39:12,720 --> 00:39:14,160
thank you very much for such an

769
00:39:14,160 --> 00:39:15,839
energetic speech

770
00:39:15,839 --> 00:39:18,900
will there be a promo code

771
00:39:18,900 --> 00:39:21,599
[Music]

772
00:39:21,599 --> 00:39:25,880
contact me on telegram okay

773
00:39:44,320 --> 00:39:47,440
you know some people like opening rjp

774
00:39:47,440 --> 00:39:49,520
words and they think that it's if it's a

775
00:39:49,520 --> 00:39:53,200
five-digit port it's safe

776
00:39:53,200 --> 00:39:55,119
so if we are running you know windows

777
00:39:55,119 --> 00:39:58,880
server latest one and rdp is the only

778
00:39:58,880 --> 00:40:02,560
thing exposed online

779
00:40:02,640 --> 00:40:04,800
do you think strike will be able to find

780
00:40:04,800 --> 00:40:07,599
its way inside

781
00:40:16,720 --> 00:40:18,560
doesn't really mean nobody knows about

782
00:40:18,560 --> 00:40:23,400
it and eventually it will be known

783
00:40:36,720 --> 00:40:39,119
so sooner or later you will be hacked

784
00:40:39,119 --> 00:40:41,040
like even if you have sophisticated

785
00:40:41,040 --> 00:40:44,400
passwords and two-factor authentication

786
00:40:44,400 --> 00:40:46,480
unfortunately the quality of microsoft's

787
00:40:46,480 --> 00:40:48,880
code is such that sooner or later there

788
00:40:48,880 --> 00:40:51,119
will be a hole there

789
00:40:51,119 --> 00:40:53,119
and you know

790
00:40:53,119 --> 00:40:54,640
people in the know

791
00:40:54,640 --> 00:40:57,680
know what to do about it

792
00:41:04,079 --> 00:41:05,920
what about armitage is it supported

793
00:41:05,920 --> 00:41:08,400
anymore i think the latest release dates

794
00:41:08,400 --> 00:41:11,520
back to 2019.

795
00:41:11,680 --> 00:41:14,960
and if the system is behind a nut

796
00:41:14,960 --> 00:41:16,800
of approach

797
00:41:16,800 --> 00:41:18,880
there is no way of breaking through it

798
00:41:18,880 --> 00:41:20,480
although you know we can attack it from

799
00:41:20,480 --> 00:41:22,160
the inside

800
00:41:22,160 --> 00:41:25,520
email is still the way

801
00:41:27,359 --> 00:41:28,880
we are talking about gaining some

802
00:41:28,880 --> 00:41:30,480
initial access it could be external

803
00:41:30,480 --> 00:41:34,880
services it could be email it could be

804
00:41:46,480 --> 00:41:49,760
is fully customizable

805
00:41:49,760 --> 00:41:51,599
and effectively you can do whatever you

806
00:41:51,599 --> 00:41:54,800
like in order to bypass a signature

807
00:41:54,800 --> 00:41:57,680
search does it mean that a hacker would

808
00:41:57,680 --> 00:41:59,599
be you know

809
00:41:59,599 --> 00:42:01,680
nearly impossible to catch if he

810
00:42:01,680 --> 00:42:03,599
customizes everything

811
00:42:03,599 --> 00:42:06,319
while security operations santra will

812
00:42:06,319 --> 00:42:07,680
have to sit on their hands and

813
00:42:07,680 --> 00:42:09,520
effectively wait for hackers to get this

814
00:42:09,520 --> 00:42:12,480
customization wrong

815
00:42:12,480 --> 00:42:14,480
okay we've got signature analysis but

816
00:42:14,480 --> 00:42:17,200
there is also behavior analysis

817
00:42:17,200 --> 00:42:20,480
if we only count on signature analysis

818
00:42:20,480 --> 00:42:22,240
if we believe that you know there will

819
00:42:22,240 --> 00:42:25,599
be a hash or a string that we know by

820
00:42:25,599 --> 00:42:28,160
this signature and we better farm on

821
00:42:28,160 --> 00:42:30,960
that as a

822
00:42:32,640 --> 00:42:34,000
if the hacker

823
00:42:34,000 --> 00:42:36,960
does customize every sample

824
00:42:36,960 --> 00:42:39,200
you know from initial access to all the

825
00:42:39,200 --> 00:42:43,720
tools used for lateral movements

826
00:42:46,079 --> 00:42:48,800
without behavioral analysis

827
00:42:48,800 --> 00:42:51,440
without checking the locks of services

828
00:42:51,440 --> 00:42:54,560
and active directory

829
00:42:54,800 --> 00:42:56,480
we will be screwed

830
00:42:56,480 --> 00:42:58,400
or a little bit differently

831
00:42:58,400 --> 00:43:01,359
we won't be safe

832
00:43:03,280 --> 00:43:06,160
so there are tactics and techniques

833
00:43:06,160 --> 00:43:09,680
if the service is installed

834
00:43:11,599 --> 00:43:13,839
you can actually kill for example log

835
00:43:13,839 --> 00:43:16,799
creation in the system

836
00:43:19,040 --> 00:43:21,040
you know as a saw campaign

837
00:43:21,040 --> 00:43:22,800
you know you need to be

838
00:43:22,800 --> 00:43:24,640
you know mindful of that like if you see

839
00:43:24,640 --> 00:43:26,400
there are no locks coming

840
00:43:26,400 --> 00:43:29,680
wouldn't that be a

841
00:43:29,680 --> 00:43:31,119
suspicious

842
00:43:31,119 --> 00:43:33,920
turn of events

843
00:43:36,560 --> 00:43:38,800
it's not a technical question

844
00:43:38,800 --> 00:43:40,400
i guess that for all

845
00:43:40,400 --> 00:43:42,560
interested in

846
00:43:42,560 --> 00:43:45,440
iocs

847
00:43:46,319 --> 00:43:47,920
we're all wondering if the

848
00:43:47,920 --> 00:43:49,839
rules are in sigma repository yes they

849
00:43:49,839 --> 00:43:50,640
are

850
00:43:50,640 --> 00:43:54,200
will there be a link

851
00:44:00,560 --> 00:44:04,319
so it's not a proprietary database no

852
00:44:04,319 --> 00:44:07,040
this is sigma hq oh right i got you

853
00:44:07,040 --> 00:44:09,839
thank you

854
00:44:18,560 --> 00:44:22,359
okay thank you very much

855
00:44:24,270 --> 00:44:27,409
[Music]

856
00:44:28,560 --> 00:44:32,440
and to the german over here

