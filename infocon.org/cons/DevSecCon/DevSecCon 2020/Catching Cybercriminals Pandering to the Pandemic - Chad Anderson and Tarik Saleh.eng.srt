1
00:00:00,080 --> 00:00:02,879
uh we have our next speakers lined up uh

2
00:00:02,879 --> 00:00:03,520
we've got

3
00:00:03,520 --> 00:00:06,879
uh tariq saleh who is a senior security

4
00:00:06,879 --> 00:00:09,040
engineer and malware researcher and chad

5
00:00:09,040 --> 00:00:10,880
anderson who is a senior security

6
00:00:10,880 --> 00:00:11,920
researcher

7
00:00:11,920 --> 00:00:15,040
both for domain tools so we're gonna go

8
00:00:15,040 --> 00:00:16,880
ahead and turn things

9
00:00:16,880 --> 00:00:20,160
over to those guys i

10
00:00:20,160 --> 00:00:23,039
appreciate that

11
00:00:26,960 --> 00:00:28,880
hi everybody and welcome to discovering

12
00:00:28,880 --> 00:00:30,960
covedlock i'm chad anderson senior

13
00:00:30,960 --> 00:00:32,238
security researcher at

14
00:00:32,238 --> 00:00:34,480
domain tools and with me is tar salah

15
00:00:34,480 --> 00:00:36,399
our senior security engineer and malware

16
00:00:36,399 --> 00:00:37,360
researcher

17
00:00:37,360 --> 00:00:38,399
we're going to talk to you a little bit

18
00:00:38,399 --> 00:00:41,120
today about the android ransomware that

19
00:00:41,120 --> 00:00:43,040
we discovered i'm leveraging

20
00:00:43,040 --> 00:00:45,360
chronovirus lures to pull people in um

21
00:00:45,360 --> 00:00:47,120
but before we do that we'd like to

22
00:00:47,120 --> 00:00:49,120
give a shout out to all the folks at all

23
00:00:49,120 --> 00:00:50,719
the talks um for

24
00:00:50,719 --> 00:00:52,480
uh having this event and organizing

25
00:00:52,480 --> 00:00:54,399
everything and having us here today we

26
00:00:54,399 --> 00:00:56,879
really appreciate being here with that

27
00:00:56,879 --> 00:00:57,920
we'll go ahead and jump

28
00:00:57,920 --> 00:01:01,760
on in um so you know when we

29
00:01:01,760 --> 00:01:03,680
started to see a lot more coronavirus

30
00:01:03,680 --> 00:01:06,240
related uh domains registered in january

31
00:01:06,240 --> 00:01:07,200
and february

32
00:01:07,200 --> 00:01:08,880
we threw them into our product we call

33
00:01:08,880 --> 00:01:10,640
fisheye it's a

34
00:01:10,640 --> 00:01:12,560
kind of like a really souped-up version

35
00:01:12,560 --> 00:01:15,040
of uh dns twist and it lets us monitor a

36
00:01:15,040 --> 00:01:16,320
lot of different terms

37
00:01:16,320 --> 00:01:18,400
um we we quickly realized that there

38
00:01:18,400 --> 00:01:20,560
were massive amounts of domains being

39
00:01:20,560 --> 00:01:22,080
registered each day and

40
00:01:22,080 --> 00:01:24,400
more than any researcher could really

41
00:01:24,400 --> 00:01:26,000
manage to investigate on their own

42
00:01:26,000 --> 00:01:28,799
so um most of them turned out to be

43
00:01:28,799 --> 00:01:30,400
simple amazon affiliate links

44
00:01:30,400 --> 00:01:32,560
or you know websites that were just

45
00:01:32,560 --> 00:01:33,840
parking pages

46
00:01:33,840 --> 00:01:35,280
but we kind of decided that we needed a

47
00:01:35,280 --> 00:01:37,520
way to prioritize and

48
00:01:37,520 --> 00:01:38,880
you know that cue and we needed to

49
00:01:38,880 --> 00:01:40,400
develop a way to do that quickly if we

50
00:01:40,400 --> 00:01:41,200
were going to find

51
00:01:41,200 --> 00:01:44,560
any sort of interesting domains in this

52
00:01:44,560 --> 00:01:46,479
so what we did is just made some simple

53
00:01:46,479 --> 00:01:48,960
prioritization heuristics for this

54
00:01:48,960 --> 00:01:51,520
we took all domains that were on asn's

55
00:01:51,520 --> 00:01:53,360
that are known for parking domains or

56
00:01:53,360 --> 00:01:54,000
shopify

57
00:01:54,000 --> 00:01:56,320
which is a lot of small time scams we

58
00:01:56,320 --> 00:01:58,320
ignored all domains that have multiple a

59
00:01:58,320 --> 00:02:00,560
records in dns it's a lot of malicious

60
00:02:00,560 --> 00:02:02,240
infrastructure rarely do they set up

61
00:02:02,240 --> 00:02:03,759
that kind of redundancy you know

62
00:02:03,759 --> 00:02:06,799
typically ovh or digital ocean something

63
00:02:06,799 --> 00:02:08,080
along those lines

64
00:02:08,080 --> 00:02:09,840
we ignored all domains that didn't have

65
00:02:09,840 --> 00:02:11,760
any passive dns injuries and far side

66
00:02:11,760 --> 00:02:12,879
passive dns

67
00:02:12,879 --> 00:02:14,720
um you know that shows they hadn't been

68
00:02:14,720 --> 00:02:16,080
weaponized or anything yet

69
00:02:16,080 --> 00:02:17,760
but let a lot of things fall off for us

70
00:02:17,760 --> 00:02:19,680
and then bubbled up a lot of domains

71
00:02:19,680 --> 00:02:21,840
that are from known gray area registrars

72
00:02:21,840 --> 00:02:23,840
and name servers like nyala

73
00:02:23,840 --> 00:02:25,599
if you're aware of doing any hunting

74
00:02:25,599 --> 00:02:26,959
there's there's always some sort of

75
00:02:26,959 --> 00:02:28,640
maliciousness registered on that name

76
00:02:28,640 --> 00:02:29,840
server every day

77
00:02:29,840 --> 00:02:31,200
and there's several others out there

78
00:02:31,200 --> 00:02:33,120
that are just known for that

79
00:02:33,120 --> 00:02:35,200
um and then prior to prioritize any

80
00:02:35,200 --> 00:02:36,720
domains that are on high potential for

81
00:02:36,720 --> 00:02:39,120
badness hosting providers like ovh

82
00:02:39,120 --> 00:02:41,840
um you know there's there's uh just

83
00:02:41,840 --> 00:02:44,800
several out there for that

84
00:02:44,800 --> 00:02:46,959
once we prioritize those we wrote a

85
00:02:46,959 --> 00:02:48,720
little script that did the following it

86
00:02:48,720 --> 00:02:50,480
took all the domains and sorted them by

87
00:02:50,480 --> 00:02:52,160
risk score that's a

88
00:02:52,160 --> 00:02:54,000
our risk score internally is something

89
00:02:54,000 --> 00:02:56,239
that our data science team builds and

90
00:02:56,239 --> 00:02:57,840
applies a different machine learning

91
00:02:57,840 --> 00:02:59,599
models to all these domains to determine

92
00:02:59,599 --> 00:03:00,720
based upon their age

93
00:03:00,720 --> 00:03:02,640
infrastructure where they are in the

94
00:03:02,640 --> 00:03:04,000
world you know whether

95
00:03:04,000 --> 00:03:06,480
or not they're riskier or not um and

96
00:03:06,480 --> 00:03:08,239
once sorted by that we queued them all

97
00:03:08,239 --> 00:03:09,720
up for a scan on

98
00:03:09,720 --> 00:03:12,239
urlscan.io to grab the full dom

99
00:03:12,239 --> 00:03:14,239
screenshot and everything from their api

100
00:03:14,239 --> 00:03:14,720
a

101
00:03:14,720 --> 00:03:17,840
big shout out to the folks over at

102
00:03:17,840 --> 00:03:20,159
i'm looking forward to when they go to

103
00:03:20,159 --> 00:03:22,000
their premium service here in this uh

104
00:03:22,000 --> 00:03:22,879
next year

105
00:03:22,879 --> 00:03:25,599
so after that we pulled a scan um after

106
00:03:25,599 --> 00:03:26,640
completion and

107
00:03:26,640 --> 00:03:27,760
quickly looked over all those

108
00:03:27,760 --> 00:03:29,519
screenshots on the page just a real

109
00:03:29,519 --> 00:03:30,080
quick

110
00:03:30,080 --> 00:03:33,280
um you know loaded up a a quick script

111
00:03:33,280 --> 00:03:34,799
to make an html document that you can

112
00:03:34,799 --> 00:03:36,239
just view in the browser tons of little

113
00:03:36,239 --> 00:03:37,200
screenshots

114
00:03:37,200 --> 00:03:38,720
scroll through as quick as we could and

115
00:03:38,720 --> 00:03:40,560
then pull the w get archive of any of

116
00:03:40,560 --> 00:03:42,319
the pages that had anything interesting

117
00:03:42,319 --> 00:03:43,680
on there and then further dug into

118
00:03:43,680 --> 00:03:45,200
passive dns to see

119
00:03:45,200 --> 00:03:47,040
if it was malicious you know what people

120
00:03:47,040 --> 00:03:48,640
were setting up and if it was

121
00:03:48,640 --> 00:03:50,560
interesting beyond being say a phishing

122
00:03:50,560 --> 00:03:51,760
kit or just some

123
00:03:51,760 --> 00:03:53,680
you know spam email or something like

124
00:03:53,680 --> 00:03:55,840
that

125
00:03:56,319 --> 00:03:58,560
so that was when we came across this

126
00:03:58,560 --> 00:04:01,519
site um that had a map that i'd seen

127
00:04:01,519 --> 00:04:02,959
elsewhere developed by an independent

128
00:04:02,959 --> 00:04:04,400
developer on reddit he

129
00:04:04,400 --> 00:04:05,840
he posted this map and i thought it was

130
00:04:05,840 --> 00:04:07,760
an interesting way to display all the

131
00:04:07,760 --> 00:04:09,599
information since the ones i'd seen so

132
00:04:09,599 --> 00:04:10,799
far were kind of

133
00:04:10,799 --> 00:04:13,680
clunky i mean on that page was an iframe

134
00:04:13,680 --> 00:04:15,280
that embedded

135
00:04:15,280 --> 00:04:17,680
the map page the original but at the top

136
00:04:17,680 --> 00:04:18,798
you'll notice there it asks

137
00:04:18,798 --> 00:04:21,040
you to install an android apk that

138
00:04:21,040 --> 00:04:23,680
looked a little suspicious to me

139
00:04:23,680 --> 00:04:25,440
you know immediately i pulled that down

140
00:04:25,440 --> 00:04:27,040
and sent it over to tarek who

141
00:04:27,040 --> 00:04:29,759
was able to start taking a look but

142
00:04:29,759 --> 00:04:31,680
before we go into his analysis there

143
00:04:31,680 --> 00:04:32,880
i do want to say that due to this

144
00:04:32,880 --> 00:04:34,880
proactive hunting we found this before a

145
00:04:34,880 --> 00:04:35,680
single

146
00:04:35,680 --> 00:04:37,440
victim and within hours of this page

147
00:04:37,440 --> 00:04:39,040
coming online i'm just

148
00:04:39,040 --> 00:04:41,919
being able to see with our tool every

149
00:04:41,919 --> 00:04:44,240
single domain that's registered

150
00:04:44,240 --> 00:04:47,040
you know is it just allows us to hop on

151
00:04:47,040 --> 00:04:48,479
them a lot quicker so

152
00:04:48,479 --> 00:04:50,000
we were able to find this yeah before

153
00:04:50,000 --> 00:04:52,080
any victims

154
00:04:52,080 --> 00:04:55,520
diving a little bit deeper we found that

155
00:04:55,520 --> 00:04:57,280
on this site you know uh

156
00:04:57,280 --> 00:05:00,639
there's all the privacy uh information

157
00:05:00,639 --> 00:05:02,960
from or all the information from gdpr is

158
00:05:02,960 --> 00:05:04,479
you know obfuscated for

159
00:05:04,479 --> 00:05:06,880
privacy reasons but um it doesn't quite

160
00:05:06,880 --> 00:05:08,800
matter as much with how many other data

161
00:05:08,800 --> 00:05:10,000
points there are out there

162
00:05:10,000 --> 00:05:11,759
and how you know easy to say to use a

163
00:05:11,759 --> 00:05:13,840
tool like census like you can see here

164
00:05:13,840 --> 00:05:15,600
um through that certificate in it's a

165
00:05:15,600 --> 00:05:17,120
let's encrypt certificate and we're able

166
00:05:17,120 --> 00:05:18,080
to see that

167
00:05:18,080 --> 00:05:20,000
that key was also matched to other

168
00:05:20,000 --> 00:05:21,199
domains um

169
00:05:21,199 --> 00:05:22,880
the one that was on there we ended up

170
00:05:22,880 --> 00:05:25,120
throwing into our iris investigate tool

171
00:05:25,120 --> 00:05:27,360
which lets us to look at several domains

172
00:05:27,360 --> 00:05:28,800
and their properties that

173
00:05:28,800 --> 00:05:30,240
um you know how they're all

174
00:05:30,240 --> 00:05:32,240
interconnected

175
00:05:32,240 --> 00:05:34,560
um and and that kind of let us go led to

176
00:05:34,560 --> 00:05:36,320
historical who is which

177
00:05:36,320 --> 00:05:38,240
had additional information revealed the

178
00:05:38,240 --> 00:05:40,080
address for rolling eight dice at

179
00:05:40,080 --> 00:05:43,199
gmail.com which had about 154 other

180
00:05:43,199 --> 00:05:44,560
previous domains

181
00:05:44,560 --> 00:05:46,960
mostly relating to sex scams and fan

182
00:05:46,960 --> 00:05:48,400
guides that came through there and

183
00:05:48,400 --> 00:05:49,840
you can kind of see our risk score on

184
00:05:49,840 --> 00:05:52,080
the right um you know it

185
00:05:52,080 --> 00:05:54,479
it rated most of those is pretty bad but

186
00:05:54,479 --> 00:05:56,080
um 100 would be a black list

187
00:05:56,080 --> 00:05:58,080
all the ones um below that are not on

188
00:05:58,080 --> 00:05:59,680
actual black list so

189
00:05:59,680 --> 00:06:01,199
um searching across the internet though

190
00:06:01,199 --> 00:06:02,560
for all these domains we're able to find

191
00:06:02,560 --> 00:06:04,080
this scammer had a history of posting

192
00:06:04,080 --> 00:06:06,000
these with explicit images on

193
00:06:06,000 --> 00:06:08,560
different subreddits on uh on reddit and

194
00:06:08,560 --> 00:06:10,160
an attempt to garner traffic to their

195
00:06:10,160 --> 00:06:11,919
other sites which also in the past

196
00:06:11,919 --> 00:06:13,919
contained malicious um either

197
00:06:13,919 --> 00:06:15,919
pornography or dating and sex android

198
00:06:15,919 --> 00:06:18,240
apks

199
00:06:18,240 --> 00:06:19,919
so from there we were able to go and

200
00:06:19,919 --> 00:06:22,080
pull all of this extra infrastructure

201
00:06:22,080 --> 00:06:23,520
and we were able to find one of these

202
00:06:23,520 --> 00:06:24,880
sites had an open directory which

203
00:06:24,880 --> 00:06:25,919
allowed us to pull down all the

204
00:06:25,919 --> 00:06:26,800
artifacts

205
00:06:26,800 --> 00:06:29,039
and other files that they had uploaded

206
00:06:29,039 --> 00:06:30,960
and this led to enough data to tie them

207
00:06:30,960 --> 00:06:32,560
to several other domains

208
00:06:32,560 --> 00:06:35,199
that would lead to attribution notice

209
00:06:35,199 --> 00:06:37,039
the update times here you know these

210
00:06:37,039 --> 00:06:38,240
directories were being

211
00:06:38,240 --> 00:06:40,000
frequently modified and we were able to

212
00:06:40,000 --> 00:06:43,840
see that based upon this open directory

213
00:06:43,840 --> 00:06:45,199
with that i'll go ahead and hand it over

214
00:06:45,199 --> 00:06:46,960
to tarek here is going to talk a little

215
00:06:46,960 --> 00:06:48,319
bit more about

216
00:06:48,319 --> 00:06:51,680
the malware and how it works

217
00:06:51,680 --> 00:06:54,639
perfect hey thanks chad um so yeah like

218
00:06:54,639 --> 00:06:56,560
judd mentioned i'm going to talk about

219
00:06:56,560 --> 00:06:59,280
um what i noticed and discovered with

220
00:06:59,280 --> 00:07:00,800
covidlock from a

221
00:07:00,800 --> 00:07:02,479
malware analysis perspective so we're

222
00:07:02,479 --> 00:07:03,759
going to take a look at some of the

223
00:07:03,759 --> 00:07:04,720
static and

224
00:07:04,720 --> 00:07:06,479
behavioral analysis and then i want to

225
00:07:06,479 --> 00:07:07,840
dive into

226
00:07:07,840 --> 00:07:10,800
some details around the ransom payments

227
00:07:10,800 --> 00:07:11,360
um

228
00:07:11,360 --> 00:07:13,440
a little bit of deep dive in there too

229
00:07:13,440 --> 00:07:17,840
next slide

230
00:07:18,479 --> 00:07:21,680
so um as a bit of a background

231
00:07:21,680 --> 00:07:23,759
android apk files are really nothing

232
00:07:23,759 --> 00:07:25,599
more than just a zip file containing

233
00:07:25,599 --> 00:07:28,560
resources and assembled java code

234
00:07:28,560 --> 00:07:31,039
so if you were to unzip an apk you'd be

235
00:07:31,039 --> 00:07:31,680
left with

236
00:07:31,680 --> 00:07:34,800
um file types called dex files uh among

237
00:07:34,800 --> 00:07:35,599
other things

238
00:07:35,599 --> 00:07:37,360
which are just inflated compiled

239
00:07:37,360 --> 00:07:40,160
resources not necessarily human readable

240
00:07:40,160 --> 00:07:43,520
um so the apk tool is a really um first

241
00:07:43,520 --> 00:07:45,599
step that i think anybody handling

242
00:07:45,599 --> 00:07:47,440
android malware analysis should do and

243
00:07:47,440 --> 00:07:49,039
that's kind of what i did in this case

244
00:07:49,039 --> 00:07:52,160
so um when beginning uh the dig into

245
00:07:52,160 --> 00:07:52,879
cobia lock

246
00:07:52,879 --> 00:07:55,039
this is the beginning stages of uh

247
00:07:55,039 --> 00:07:56,639
static analysis

248
00:07:56,639 --> 00:07:59,840
uh go ahead next slide

249
00:08:02,479 --> 00:08:04,960
and now that we've decoded covered lock

250
00:08:04,960 --> 00:08:06,879
and converted a lot of those dex files

251
00:08:06,879 --> 00:08:07,440
into

252
00:08:07,440 --> 00:08:09,440
a human readable java code i began to

253
00:08:09,440 --> 00:08:12,160
analyze copilock's resources to

254
00:08:12,160 --> 00:08:14,560
understand how it operates and really

255
00:08:14,560 --> 00:08:15,840
the goal is to

256
00:08:15,840 --> 00:08:17,840
understand the capabilities how it

257
00:08:17,840 --> 00:08:19,039
operates and

258
00:08:19,039 --> 00:08:22,080
extract any noteworthy iocs and let's go

259
00:08:22,080 --> 00:08:24,840
and go on to the next

260
00:08:24,840 --> 00:08:26,560
slide

261
00:08:26,560 --> 00:08:28,479
for those of you that have done uh

262
00:08:28,479 --> 00:08:30,000
malibu uh malware

263
00:08:30,000 --> 00:08:32,799
analysis on android devices uh you'd be

264
00:08:32,799 --> 00:08:33,919
familiar with what a

265
00:08:33,919 --> 00:08:36,640
manifest is uh for others to help level

266
00:08:36,640 --> 00:08:37,039
set

267
00:08:37,039 --> 00:08:39,839
all apks contain a manifest file which

268
00:08:39,839 --> 00:08:41,760
provides information to the android

269
00:08:41,760 --> 00:08:43,760
operating system on how to handle

270
00:08:43,760 --> 00:08:46,399
uh this application um there are several

271
00:08:46,399 --> 00:08:48,399
data fields inside of a manifest that

272
00:08:48,399 --> 00:08:50,320
are interesting

273
00:08:50,320 --> 00:08:52,240
but specifically the ones that i always

274
00:08:52,240 --> 00:08:53,440
start digging into first

275
00:08:53,440 --> 00:08:55,360
are the requested permissions but you

276
00:08:55,360 --> 00:08:57,120
can see some of the output

277
00:08:57,120 --> 00:08:59,440
on the screen there uh analyzing the

278
00:08:59,440 --> 00:09:01,120
manifest can tell me what permissions

279
00:09:01,120 --> 00:09:03,279
codelock is requesting against android's

280
00:09:03,279 --> 00:09:03,920
uh

281
00:09:03,920 --> 00:09:07,279
apis and doing this kind of permission

282
00:09:07,279 --> 00:09:08,959
analysis tells me a lot of things as a

283
00:09:08,959 --> 00:09:10,080
malware researcher

284
00:09:10,080 --> 00:09:12,399
this really helps me understand um how

285
00:09:12,399 --> 00:09:13,680
cobid lock does its per

286
00:09:13,680 --> 00:09:15,680
uh privilege escalation uh its

287
00:09:15,680 --> 00:09:17,120
persistence mechanism

288
00:09:17,120 --> 00:09:19,279
and really other important capabilities

289
00:09:19,279 --> 00:09:21,360
too this also tells me what cobloc

290
00:09:21,360 --> 00:09:22,000
generally does

291
00:09:22,000 --> 00:09:25,360
not do we don't see any permissions to

292
00:09:25,360 --> 00:09:28,640
sms or contact information or reading

293
00:09:28,640 --> 00:09:31,279
external storage apis

294
00:09:31,279 --> 00:09:33,519
so this kind of tells us a little bit

295
00:09:33,519 --> 00:09:35,920
about what kovalk can't do

296
00:09:35,920 --> 00:09:38,399
next slide

297
00:09:39,680 --> 00:09:42,320
um so let's talk about kovitlux

298
00:09:42,320 --> 00:09:44,560
persistence mechanism

299
00:09:44,560 --> 00:09:47,040
kovidlock uses the android feature boot

300
00:09:47,040 --> 00:09:48,320
completed

301
00:09:48,320 --> 00:09:50,399
which is a permission to establish its

302
00:09:50,399 --> 00:09:52,080
persistence on victims phones

303
00:09:52,080 --> 00:09:53,279
uh for those of you that are more

304
00:09:53,279 --> 00:09:54,880
familiar with windows based threats this

305
00:09:54,880 --> 00:09:56,800
is really similar to

306
00:09:56,800 --> 00:09:59,519
operationally speaking how the windows

307
00:09:59,519 --> 00:10:01,200
registry run keys

308
00:10:01,200 --> 00:10:03,279
uh used as a persistence mechanism

309
00:10:03,279 --> 00:10:05,360
operate or even a windows service that

310
00:10:05,360 --> 00:10:06,800
runs malware in the background upon

311
00:10:06,800 --> 00:10:07,680
reboot

312
00:10:07,680 --> 00:10:09,120
um there are some other really

313
00:10:09,120 --> 00:10:11,760
noteworthy um android based threats that

314
00:10:11,760 --> 00:10:13,440
also leverage this

315
00:10:13,440 --> 00:10:16,800
such as pegasus spynote and flexispy

316
00:10:16,800 --> 00:10:18,399
so this is actually a really common

317
00:10:18,399 --> 00:10:19,920
persistence mechanism that we see in

318
00:10:19,920 --> 00:10:21,040
android malware

319
00:10:21,040 --> 00:10:24,160
and let's go to the next slide

320
00:10:24,320 --> 00:10:26,079
uh so we were able to determine rather

321
00:10:26,079 --> 00:10:27,839
quickly how cobid lock maintains its

322
00:10:27,839 --> 00:10:29,760
persistence on victims phones

323
00:10:29,760 --> 00:10:31,760
uh we can also see this manifest itself

324
00:10:31,760 --> 00:10:33,839
when we run cobin lock and do dynamic

325
00:10:33,839 --> 00:10:35,600
analysis of it in a virtual environment

326
00:10:35,600 --> 00:10:37,920
which you can see on the screen up above

327
00:10:37,920 --> 00:10:41,279
um but uh bind device admin

328
00:10:41,279 --> 00:10:42,880
uh this was a previous permission

329
00:10:42,880 --> 00:10:44,480
requested by covidlock

330
00:10:44,480 --> 00:10:47,519
we saw that in the manifest file what

331
00:10:47,519 --> 00:10:49,440
this does is this allows access to the

332
00:10:49,440 --> 00:10:51,360
administrator api of android

333
00:10:51,360 --> 00:10:54,720
which and also um allows cover lock to

334
00:10:54,720 --> 00:10:56,079
really do what it does best

335
00:10:56,079 --> 00:10:58,399
and become ransomware by locking out

336
00:10:58,399 --> 00:10:59,519
your screen

337
00:10:59,519 --> 00:11:01,680
um and here's how we determined what

338
00:11:01,680 --> 00:11:03,040
kovidlock does

339
00:11:03,040 --> 00:11:05,120
we can see the apa calls uh being made

340
00:11:05,120 --> 00:11:06,320
above there

341
00:11:06,320 --> 00:11:09,279
to the lock screen api as well as

342
00:11:09,279 --> 00:11:10,320
resetting

343
00:11:10,320 --> 00:11:11,920
the pin number for the phone which is

344
00:11:11,920 --> 00:11:14,320
done by the set storage encryption

345
00:11:14,320 --> 00:11:16,480
functionality and let's go to the next

346
00:11:16,480 --> 00:11:18,800
slide

347
00:11:18,800 --> 00:11:20,560
um i'm not going to spend too much time

348
00:11:20,560 --> 00:11:22,240
here but i did want to kind of show

349
00:11:22,240 --> 00:11:25,120
how covered lock here's some of the

350
00:11:25,120 --> 00:11:27,279
decoded code from kovidlock highlighting

351
00:11:27,279 --> 00:11:28,320
how it checks for

352
00:11:28,320 --> 00:11:30,000
if the user is an administrator on the

353
00:11:30,000 --> 00:11:31,360
phone or not

354
00:11:31,360 --> 00:11:34,959
um and let's move on to the next line

355
00:11:34,959 --> 00:11:36,880
and what we see here here's how codelock

356
00:11:36,880 --> 00:11:38,720
presents itself to the victim

357
00:11:38,720 --> 00:11:41,440
upon uh app launch uh the kovalok

358
00:11:41,440 --> 00:11:43,279
malware author did a really good job

359
00:11:43,279 --> 00:11:45,040
of preying on people's fear of the

360
00:11:45,040 --> 00:11:47,040
coronavirus uh here

361
00:11:47,040 --> 00:11:48,560
kovalok states that if you want to see

362
00:11:48,560 --> 00:11:51,120
if there's any coronavirus infected

363
00:11:51,120 --> 00:11:53,440
uh people in your area to click activate

364
00:11:53,440 --> 00:11:54,720
or to click grant

365
00:11:54,720 --> 00:11:57,360
to see the coronavirus stats but in

366
00:11:57,360 --> 00:11:58,320
reality clicking

367
00:11:58,320 --> 00:12:00,399
those buttons are what actually

368
00:12:00,399 --> 00:12:02,240
activates those api calls that we looked

369
00:12:02,240 --> 00:12:03,120
at earlier

370
00:12:03,120 --> 00:12:04,560
accessing those administrator

371
00:12:04,560 --> 00:12:06,880
permissions and thus beginning covet

372
00:12:06,880 --> 00:12:07,839
locks

373
00:12:07,839 --> 00:12:10,399
encryption and ransom routine let's move

374
00:12:10,399 --> 00:12:13,040
on to the next slide

375
00:12:13,440 --> 00:12:16,079
um if you've ever reverse engineered a

376
00:12:16,079 --> 00:12:17,920
malware sample that involves encryption

377
00:12:17,920 --> 00:12:19,839
specifically with ransomware one of the

378
00:12:19,839 --> 00:12:21,519
biggest things to look out for is how

379
00:12:21,519 --> 00:12:22,160
the

380
00:12:22,160 --> 00:12:23,839
encryption keys are generated and where

381
00:12:23,839 --> 00:12:25,760
they're stored at uh in this case

382
00:12:25,760 --> 00:12:27,440
kovidlock's author didn't go beyond

383
00:12:27,440 --> 00:12:29,839
statically embedding the decryption key

384
00:12:29,839 --> 00:12:32,079
which we released publicly on domain

385
00:12:32,079 --> 00:12:34,160
tools blog

386
00:12:34,160 --> 00:12:36,240
to help mitigate any damages this

387
00:12:36,240 --> 00:12:38,320
attacker may have caused uh some can

388
00:12:38,320 --> 00:12:39,680
call this sloppy from

389
00:12:39,680 --> 00:12:41,600
a malware development perspective but

390
00:12:41,600 --> 00:12:42,880
it's really important to keep in mind

391
00:12:42,880 --> 00:12:44,320
and chad mentioned this earlier

392
00:12:44,320 --> 00:12:46,000
this doesn't impede covet lock from

393
00:12:46,000 --> 00:12:48,079
being effective at locking out people's

394
00:12:48,079 --> 00:12:49,760
devices

395
00:12:49,760 --> 00:12:52,880
let's go to the next slide

396
00:12:52,880 --> 00:12:54,399
i'm going to talk a little bit about the

397
00:12:54,399 --> 00:12:56,720
network operations

398
00:12:56,720 --> 00:12:59,519
of cobid lock so codelock made a lot of

399
00:12:59,519 --> 00:13:00,160
standard

400
00:13:00,160 --> 00:13:02,480
benign dns requests mainly to google

401
00:13:02,480 --> 00:13:03,600
services but

402
00:13:03,600 --> 00:13:06,240
on dynamic analysis i did notice one

403
00:13:06,240 --> 00:13:08,000
anomaly which was a query

404
00:13:08,000 --> 00:13:11,360
to a bitly url shortening service

405
00:13:11,360 --> 00:13:14,399
let's move to the next slide

406
00:13:14,399 --> 00:13:16,880
um following the trail i was able to

407
00:13:16,880 --> 00:13:17,600
uncover

408
00:13:17,600 --> 00:13:19,519
kobeluck's ransomware note which is

409
00:13:19,519 --> 00:13:21,440
dynamically generated and pulled from

410
00:13:21,440 --> 00:13:24,320
those bitly url shortening services

411
00:13:24,320 --> 00:13:27,279
which ended up redirecting the victim to

412
00:13:27,279 --> 00:13:27,920
a

413
00:13:27,920 --> 00:13:31,120
specific pastebin pace site

414
00:13:31,120 --> 00:13:32,639
this is also important to note because

415
00:13:32,639 --> 00:13:34,800
the attacker has the ability to modify

416
00:13:34,800 --> 00:13:37,040
two components of kovidlock on the fly

417
00:13:37,040 --> 00:13:38,720
to change aocs like

418
00:13:38,720 --> 00:13:41,680
the email address or the bitcoin wallet

419
00:13:41,680 --> 00:13:44,719
let's move to the next slide

420
00:13:44,800 --> 00:13:47,040
and what we see here is part of the

421
00:13:47,040 --> 00:13:48,720
actual ransom note that's

422
00:13:48,720 --> 00:13:51,279
that gets displayed on victim's um lock

423
00:13:51,279 --> 00:13:52,079
screens

424
00:13:52,079 --> 00:13:54,639
um what was interesting is that the uh

425
00:13:54,639 --> 00:13:56,720
covertlock author statically embedded

426
00:13:56,720 --> 00:13:59,839
but dynamically called this ransom note

427
00:13:59,839 --> 00:14:02,560
and there's uh several pieces of this

428
00:14:02,560 --> 00:14:03,760
ransom note that are pulled together

429
00:14:03,760 --> 00:14:04,800
dynamically as well

430
00:14:04,800 --> 00:14:06,399
some from pastebin some that are

431
00:14:06,399 --> 00:14:07,920
statically stored

432
00:14:07,920 --> 00:14:09,199
but it's important to note that the

433
00:14:09,199 --> 00:14:11,120
attacker claims you could see at the

434
00:14:11,120 --> 00:14:12,240
very bottom there

435
00:14:12,240 --> 00:14:15,440
the attacker claims to monitor your gps

436
00:14:15,440 --> 00:14:18,800
but we previously saw in the android

437
00:14:18,800 --> 00:14:21,120
manifest and other api calls that that's

438
00:14:21,120 --> 00:14:22,880
actually a false claim

439
00:14:22,880 --> 00:14:26,079
but this kind of speaks to the um the

440
00:14:26,079 --> 00:14:27,120
sophistication

441
00:14:27,120 --> 00:14:29,279
of social engineering and luring and

442
00:14:29,279 --> 00:14:30,160
phishing that the

443
00:14:30,160 --> 00:14:32,560
copenhagen author is going to to get

444
00:14:32,560 --> 00:14:34,160
victims to actually pay the ransom

445
00:14:34,160 --> 00:14:37,279
and let's move to the next slide

446
00:14:37,600 --> 00:14:39,360
and so on the left hand side is what you

447
00:14:39,360 --> 00:14:41,440
can see when covered lock

448
00:14:41,440 --> 00:14:44,480
successfully executes and locks out the

449
00:14:44,480 --> 00:14:45,440
user after

450
00:14:45,440 --> 00:14:48,560
approximately 60 seconds after being run

451
00:14:48,560 --> 00:14:51,600
um the ransom note content is both

452
00:14:51,600 --> 00:14:53,920
statically and dynamically called

453
00:14:53,920 --> 00:14:56,000
there's a little bit of unintuitiveness

454
00:14:56,000 --> 00:14:57,120
with covered lock

455
00:14:57,120 --> 00:14:59,600
um in order to actually see the uh

456
00:14:59,600 --> 00:15:00,399
bitcoin

457
00:15:00,399 --> 00:15:03,199
wallet id and the uh attacker's email

458
00:15:03,199 --> 00:15:04,480
address you have to click that web

459
00:15:04,480 --> 00:15:05,600
designers button

460
00:15:05,600 --> 00:15:08,240
so not that intuitive i'm not going to

461
00:15:08,240 --> 00:15:09,680
make any comments about the

462
00:15:09,680 --> 00:15:11,680
anonymous logo but it is up there for

463
00:15:11,680 --> 00:15:13,199
everybody to see

464
00:15:13,199 --> 00:15:17,439
um and let's move on to the next slide

465
00:15:17,600 --> 00:15:19,120
so tracking some of the financial

466
00:15:19,120 --> 00:15:21,040
operations of covered lock

467
00:15:21,040 --> 00:15:23,120
uh we're keeping a eye on kobilux

468
00:15:23,120 --> 00:15:24,320
wallets

469
00:15:24,320 --> 00:15:26,480
bitcoin wallets um there's only been two

470
00:15:26,480 --> 00:15:28,480
transactions as of today to the wallet

471
00:15:28,480 --> 00:15:29,600
which is good

472
00:15:29,600 --> 00:15:32,959
um because the transaction values are

473
00:15:32,959 --> 00:15:35,279
uh approximately under three dollars in

474
00:15:35,279 --> 00:15:37,279
total so this is likely canary

475
00:15:37,279 --> 00:15:39,040
transactions of some sorts and not

476
00:15:39,040 --> 00:15:42,000
actual ransom victim payments uh my

477
00:15:42,000 --> 00:15:43,600
theory um is that

478
00:15:43,600 --> 00:15:45,440
with the publication of the decryption

479
00:15:45,440 --> 00:15:47,360
keys and the traction of

480
00:15:47,360 --> 00:15:50,560
the covidlock in the media really led to

481
00:15:50,560 --> 00:15:52,240
the domain being blacklisted really

482
00:15:52,240 --> 00:15:53,199
quickly

483
00:15:53,199 --> 00:15:55,040
being propagated inside of google safe

484
00:15:55,040 --> 00:15:56,320
browsing list and

485
00:15:56,320 --> 00:16:00,079
the covet lock apk being submitted to

486
00:16:00,079 --> 00:16:01,440
google play

487
00:16:01,440 --> 00:16:04,800
google play protect the apk

488
00:16:04,800 --> 00:16:07,440
was flagged relatively quickly um in

489
00:16:07,440 --> 00:16:08,800
fact in a matter of days

490
00:16:08,800 --> 00:16:11,120
uh being published to google play

491
00:16:11,120 --> 00:16:12,000
product

492
00:16:12,000 --> 00:16:13,759
so i think all those factors combined

493
00:16:13,759 --> 00:16:16,240
really uh helped us mitigate uh covered

494
00:16:16,240 --> 00:16:17,199
locks

495
00:16:17,199 --> 00:16:19,759
um from being a lot more successful than

496
00:16:19,759 --> 00:16:21,120
it could have been

497
00:16:21,120 --> 00:16:24,720
let's go to the next slide so cover lock

498
00:16:24,720 --> 00:16:26,480
wasn't necessarily an apt

499
00:16:26,480 --> 00:16:28,399
sophisticated threat but it really

500
00:16:28,399 --> 00:16:29,920
highlights how effective android

501
00:16:29,920 --> 00:16:31,199
ransomware can be

502
00:16:31,199 --> 00:16:32,959
one of the big call outs about kovalok

503
00:16:32,959 --> 00:16:34,639
is its impact to the end user

504
00:16:34,639 --> 00:16:36,959
or the victims in this case if someone

505
00:16:36,959 --> 00:16:38,480
does not have access to their bank

506
00:16:38,480 --> 00:16:40,240
accounts or their mobile device when in

507
00:16:40,240 --> 00:16:41,199
a quarantine

508
00:16:41,199 --> 00:16:43,600
they can't make phone calls they likely

509
00:16:43,600 --> 00:16:45,199
can't order food

510
00:16:45,199 --> 00:16:46,480
they can't even check their bank of

511
00:16:46,480 --> 00:16:48,079
statements or any of their medical

512
00:16:48,079 --> 00:16:49,279
information

513
00:16:49,279 --> 00:16:51,839
so koblak had the potential to really

514
00:16:51,839 --> 00:16:53,279
prey on victims that are

515
00:16:53,279 --> 00:16:55,120
extremely vulnerable during this

516
00:16:55,120 --> 00:16:57,120
coronavirus pandemic and

517
00:16:57,120 --> 00:16:58,880
thankfully with all of our efforts we

518
00:16:58,880 --> 00:17:00,160
were able to

519
00:17:00,160 --> 00:17:01,680
mitigate any damages that could have

520
00:17:01,680 --> 00:17:04,799
been done potentially

521
00:17:04,799 --> 00:17:07,919
and let's move to the next slide

522
00:17:07,919 --> 00:17:12,000
with that we are open for q a

523
00:17:16,240 --> 00:17:17,760
all right so let's bring our speakers

524
00:17:17,760 --> 00:17:19,599
back in here uh

525
00:17:19,599 --> 00:17:23,839
so we've got tarik and chad and uh

526
00:17:23,839 --> 00:17:26,480
so yes if you guys have questions for

527
00:17:26,480 --> 00:17:28,400
these gentlemen please go ahead and ask

528
00:17:28,400 --> 00:17:28,799
them

529
00:17:28,799 --> 00:17:31,440
in the q a panel which i'm going to pull

530
00:17:31,440 --> 00:17:33,679
up here now and see where we're at

531
00:17:33,679 --> 00:17:38,080
um not seeing any new

532
00:17:38,080 --> 00:17:41,679
questions there um

533
00:17:41,679 --> 00:17:43,600
let's take a look quick on the slack

534
00:17:43,600 --> 00:17:44,880
side

535
00:17:44,880 --> 00:17:49,360
uh see great talk you guys um

536
00:17:49,360 --> 00:17:51,280
will the slides be available somewhere

537
00:17:51,280 --> 00:17:52,559
and it looks like that actually looks

538
00:17:52,559 --> 00:17:54,000
like you guys already answered that

539
00:17:54,000 --> 00:17:57,440
so oh yeah um

540
00:17:58,240 --> 00:17:59,840
so anything you guys want to share real

541
00:17:59,840 --> 00:18:01,600
briefly about the work you did here i

542
00:18:01,600 --> 00:18:02,880
mean this is actually some

543
00:18:02,880 --> 00:18:04,160
pretty impressive stuff and some

544
00:18:04,160 --> 00:18:07,760
obviously later breaking stuff as well

545
00:18:07,760 --> 00:18:10,160
yeah there's a a couple of things um i'd

546
00:18:10,160 --> 00:18:10,799
like to mention

547
00:18:10,799 --> 00:18:13,440
if um you know as i posted in the slash

548
00:18:13,440 --> 00:18:14,080
channel there

549
00:18:14,080 --> 00:18:16,720
um feel free to read the um blog that we

550
00:18:16,720 --> 00:18:18,799
posted that's a little bit more in depth

551
00:18:18,799 --> 00:18:21,600
um and then also if you're interested in

552
00:18:21,600 --> 00:18:22,240
um

553
00:18:22,240 --> 00:18:24,880
hunting uh doing any threat hunting with

554
00:18:24,880 --> 00:18:25,280
uh

555
00:18:25,280 --> 00:18:27,360
covet and coronavirus related domains we

556
00:18:27,360 --> 00:18:28,480
are releasing a list

557
00:18:28,480 --> 00:18:31,600
on um our website of all the domains

558
00:18:31,600 --> 00:18:33,679
that we find newly registered each day

559
00:18:33,679 --> 00:18:34,960
from a number of terms and their

560
00:18:34,960 --> 00:18:36,720
permutations um all related to the

561
00:18:36,720 --> 00:18:37,600
chronovirus

562
00:18:37,600 --> 00:18:39,280
and so um it would be awesome if you

563
00:18:39,280 --> 00:18:41,679
want to assist in helping to

564
00:18:41,679 --> 00:18:43,600
track down maliciousness um that's a

565
00:18:43,600 --> 00:18:45,200
that's a decent place to start

566
00:18:45,200 --> 00:18:49,280
um and go to domaintools.com for that

567
00:18:49,280 --> 00:18:52,640
very cool and we have um some published

568
00:18:52,640 --> 00:18:55,679
iocs in the blog post the chat link that

569
00:18:55,679 --> 00:18:57,600
um if any uh you know threat

570
00:18:57,600 --> 00:18:59,440
intelligence researchers want to keep

571
00:18:59,440 --> 00:19:00,880
expanding on

572
00:19:00,880 --> 00:19:02,640
uh any investigations with that and

573
00:19:02,640 --> 00:19:04,240
would be happy to share their data with

574
00:19:04,240 --> 00:19:05,200
us we'd be

575
00:19:05,200 --> 00:19:06,640
uh more than happy to work with you on

576
00:19:06,640 --> 00:19:08,880
that

577
00:19:09,120 --> 00:19:11,840
okay awesome well thank you guys for a

578
00:19:11,840 --> 00:19:14,080
great talk really appreciate it

579
00:19:14,080 --> 00:19:16,080
um and you guys will be around i assume

580
00:19:16,080 --> 00:19:18,000
in slack for a little while that people

581
00:19:18,000 --> 00:19:18,480
can

582
00:19:18,480 --> 00:19:20,640
address questions to you there as well

583
00:19:20,640 --> 00:19:22,320
absolutely we'll be hanging out

584
00:19:22,320 --> 00:19:24,559
yeah awesome thanks for having us sounds

585
00:19:24,559 --> 00:19:26,559
good

586
00:19:26,559 --> 00:19:29,360
all right so folks we will go ahead

587
00:19:29,360 --> 00:19:32,879
we're going to take a short break here

