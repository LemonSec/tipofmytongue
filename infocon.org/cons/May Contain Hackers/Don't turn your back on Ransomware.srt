1
00:00:01,280 --> 00:00:12,559
[Music]

2
00:00:15,440 --> 00:00:16,960
i'm going to keep it short because he

3
00:00:16,960 --> 00:00:18,880
has lots of interesting things to tell

4
00:00:18,880 --> 00:00:21,199
um just want to tell you what he does he

5
00:00:21,199 --> 00:00:23,600
is a senior cyber security consultant at

6
00:00:23,600 --> 00:00:25,840
the lemon shark dutch company

7
00:00:25,840 --> 00:00:27,920
and he has lots of interest i mean from

8
00:00:27,920 --> 00:00:30,400
seam and sock to pen testing to

9
00:00:30,400 --> 00:00:33,040
compliance i asked him why and he says i

10
00:00:33,040 --> 00:00:35,200
just like too many things well that's

11
00:00:35,200 --> 00:00:37,280
what we recognize right we like to so

12
00:00:37,280 --> 00:00:38,640
many things that's why this whole

13
00:00:38,640 --> 00:00:40,480
program is so diverse that's why we'd

14
00:00:40,480 --> 00:00:42,079
like to have you on stage so please a

15
00:00:42,079 --> 00:00:44,079
warm welcome for don't turn your back on

16
00:00:44,079 --> 00:00:47,070
ransomware eric

17
00:00:47,070 --> 00:00:50,160
[Applause]

18
00:00:50,160 --> 00:00:52,960
hi everyone i hope you have a good time

19
00:00:52,960 --> 00:00:55,039
i'm definitely enjoying myself and

20
00:00:55,039 --> 00:00:57,600
absolutely fantastic these things

21
00:00:57,600 --> 00:01:00,079
are being okay now again to meet each

22
00:01:00,079 --> 00:01:02,719
other in person absolutely great so

23
00:01:02,719 --> 00:01:04,479
today we're going to have a talk about

24
00:01:04,479 --> 00:01:06,799
ransomware and you probably know what it

25
00:01:06,799 --> 00:01:09,600
is and i first have a question for you

26
00:01:09,600 --> 00:01:12,640
can i see some hands who actually was

27
00:01:12,640 --> 00:01:16,080
involved with a real ransomware attack

28
00:01:16,080 --> 00:01:19,039
in some way

29
00:01:19,840 --> 00:01:23,200
definitely a couple of us are so

30
00:01:23,200 --> 00:01:25,920
i was a victim and as well i've been

31
00:01:25,920 --> 00:01:28,640
performing these exercises like tabletop

32
00:01:28,640 --> 00:01:31,680
exercises and it isn't as exciting as it

33
00:01:31,680 --> 00:01:32,560
sounds

34
00:01:32,560 --> 00:01:33,920
but anyway

35
00:01:33,920 --> 00:01:35,280
ransomware

36
00:01:35,280 --> 00:01:37,680
is still here and the attacks are only

37
00:01:37,680 --> 00:01:39,280
increasing and i think i'm not

38
00:01:39,280 --> 00:01:41,520
exaggerating

39
00:01:41,520 --> 00:01:43,200
as you take all

40
00:01:43,200 --> 00:01:45,040
of the computer systems in the world it

41
00:01:45,040 --> 00:01:46,799
might be the case that

42
00:01:46,799 --> 00:01:49,680
50 or more are involved with some kind

43
00:01:49,680 --> 00:01:52,840
of ransomware attack

44
00:01:52,840 --> 00:01:56,240
now let's have um

45
00:01:56,240 --> 00:01:57,920
a view of what we're going to talk today

46
00:01:57,920 --> 00:02:00,320
about i'm going to show you some

47
00:02:00,320 --> 00:02:02,560
ransomware history i'm going to

48
00:02:02,560 --> 00:02:05,280
show some examples of ransomware

49
00:02:05,280 --> 00:02:06,479
obviously i'm going to give a

50
00:02:06,479 --> 00:02:08,800
demonstration and at the end we're going

51
00:02:08,800 --> 00:02:11,440
to look at what we can do to defend

52
00:02:11,440 --> 00:02:13,520
ourselves and to put some eyes and

53
00:02:13,520 --> 00:02:15,840
detection on ransomware indicator force

54
00:02:15,840 --> 00:02:17,520
compromise

55
00:02:17,520 --> 00:02:20,160
so let's start

56
00:02:20,160 --> 00:02:21,680
yeah ransomware you probably know what

57
00:02:21,680 --> 00:02:23,200
it is

58
00:02:23,200 --> 00:02:25,280
it is a digital

59
00:02:25,280 --> 00:02:28,800
way of well you can say hijacking but i

60
00:02:28,800 --> 00:02:30,400
like to call it

61
00:02:30,400 --> 00:02:31,519
um

62
00:02:31,519 --> 00:02:34,840
a digital way of

63
00:02:34,840 --> 00:02:38,879
extortion usually um the bitcoin is a

64
00:02:38,879 --> 00:02:41,280
very popular way to

65
00:02:41,280 --> 00:02:46,239
release whatever what has been hijacked

66
00:02:46,239 --> 00:02:48,000
so what the attacker will do

67
00:02:48,000 --> 00:02:50,239
when he is encrypting the files he will

68
00:02:50,239 --> 00:02:53,040
use a form of hybrid encryption

69
00:02:53,040 --> 00:02:55,200
that means that he will benefit from

70
00:02:55,200 --> 00:02:56,879
both the speed from the somatic

71
00:02:56,879 --> 00:02:58,080
algorithm

72
00:02:58,080 --> 00:02:59,599
has the

73
00:02:59,599 --> 00:03:01,519
comfortability and integrity which

74
00:03:01,519 --> 00:03:03,360
involves the

75
00:03:03,360 --> 00:03:06,159
asymmetrical algorithm so we basically

76
00:03:06,159 --> 00:03:07,840
will first encrypt everything with a

77
00:03:07,840 --> 00:03:09,920
somatic algorithm and that encryption

78
00:03:09,920 --> 00:03:12,400
key will be encrypted with an asymmetric

79
00:03:12,400 --> 00:03:15,040
algorithm

80
00:03:15,280 --> 00:03:18,319
all right so here is a timeline of all

81
00:03:18,319 --> 00:03:19,040
the

82
00:03:19,040 --> 00:03:21,040
a lot of ransomware species that

83
00:03:21,040 --> 00:03:22,239
occurred

84
00:03:22,239 --> 00:03:24,720
around the globe and it's quite a lot

85
00:03:24,720 --> 00:03:27,360
and if i am going to

86
00:03:27,360 --> 00:03:30,400
summarize all of these then i i think we

87
00:03:30,400 --> 00:03:32,080
can stay here for hours so i'm not going

88
00:03:32,080 --> 00:03:33,519
to do that but

89
00:03:33,519 --> 00:03:35,760
keep in mind that before

90
00:03:35,760 --> 00:03:38,319
all these ransomware species

91
00:03:38,319 --> 00:03:39,920
were released

92
00:03:39,920 --> 00:03:41,680
it was i think in the 80s there was a

93
00:03:41,680 --> 00:03:44,080
guy who went to a

94
00:03:44,080 --> 00:03:47,040
conference and it had a list of anyone

95
00:03:47,040 --> 00:03:48,239
intended

96
00:03:48,239 --> 00:03:51,120
and was giving handing out free software

97
00:03:51,120 --> 00:03:52,720
to all of them

98
00:03:52,720 --> 00:03:54,799
now next when you install this software

99
00:03:54,799 --> 00:03:57,360
your computer was automatically rebooted

100
00:03:57,360 --> 00:03:59,599
and there was a system displayed well if

101
00:03:59,599 --> 00:04:01,840
you like your software please

102
00:04:01,840 --> 00:04:03,760
put some money in an envelope and send

103
00:04:03,760 --> 00:04:06,799
it over to me and then i will release it

104
00:04:06,799 --> 00:04:09,519
so eventually there was joseph pop he

105
00:04:09,519 --> 00:04:12,560
got caught and i think that was the

106
00:04:12,560 --> 00:04:15,840
first ransomware

107
00:04:16,000 --> 00:04:17,759
attempt ever

108
00:04:17,759 --> 00:04:20,120
and next there were also a

109
00:04:20,120 --> 00:04:22,240
non-encrypting kind of ransomware like

110
00:04:22,240 --> 00:04:23,840
the screen lockers you have seen

111
00:04:23,840 --> 00:04:26,160
probably a threatening messages from the

112
00:04:26,160 --> 00:04:29,040
police or from the fbi fbi

113
00:04:29,040 --> 00:04:30,880
ar explorer

114
00:04:30,880 --> 00:04:33,680
with the message to pay a fine or you

115
00:04:33,680 --> 00:04:35,680
will get prosecuted anything like that

116
00:04:35,680 --> 00:04:38,160
very scary but actually it was harmless

117
00:04:38,160 --> 00:04:39,759
it was a browser message you can click

118
00:04:39,759 --> 00:04:41,199
it away

119
00:04:41,199 --> 00:04:43,040
and then nothing happens but actually

120
00:04:43,040 --> 00:04:45,199
some people fall for it and either pay

121
00:04:45,199 --> 00:04:48,000
the fine or showed up at the fbi to turn

122
00:04:48,000 --> 00:04:50,960
themselves in now

123
00:04:50,960 --> 00:04:52,800
if you look at the cryptolocker for

124
00:04:52,800 --> 00:04:55,680
instance um

125
00:04:55,680 --> 00:04:56,479
uh

126
00:04:56,479 --> 00:04:59,600
was the first edition ever making use of

127
00:04:59,600 --> 00:05:02,720
bitcoin as payment and introducing the

128
00:05:02,720 --> 00:05:05,360
zeus banking troian as

129
00:05:05,360 --> 00:05:07,919
extra addition to extort

130
00:05:07,919 --> 00:05:09,520
even more money by

131
00:05:09,520 --> 00:05:12,720
attacking for financial gain

132
00:05:12,720 --> 00:05:15,919
and then a lot of species um

133
00:05:15,919 --> 00:05:18,160
arise like the server tesla crypts we've

134
00:05:18,160 --> 00:05:20,800
got into the wannacry misery where a lot

135
00:05:20,800 --> 00:05:24,320
of financial damage also in holland

136
00:05:24,320 --> 00:05:25,520
occurred

137
00:05:25,520 --> 00:05:28,080
and the ransomware also started to

138
00:05:28,080 --> 00:05:31,440
advance like spreading over the network

139
00:05:31,440 --> 00:05:34,639
making use of data filtration

140
00:05:34,639 --> 00:05:37,360
and trying to disable your backups like

141
00:05:37,360 --> 00:05:41,440
happened in maze and grand crab club etc

142
00:05:41,440 --> 00:05:42,720
and now we

143
00:05:42,720 --> 00:05:45,680
had some incidents with lapse installer

144
00:05:45,680 --> 00:05:47,759
we have a lot bet black cats and the

145
00:05:47,759 --> 00:05:52,000
list goes on and on

146
00:05:52,000 --> 00:05:52,800
so

147
00:05:52,800 --> 00:05:55,360
lately we had an incident with microsoft

148
00:05:55,360 --> 00:05:57,120
that was the lapse installer group and

149
00:05:57,120 --> 00:05:59,840
they were also be able to exfiltrate

150
00:05:59,840 --> 00:06:02,240
some of their code

151
00:06:02,240 --> 00:06:04,160
we had an incident with the media market

152
00:06:04,160 --> 00:06:06,479
in november twenty thousand

153
00:06:06,479 --> 00:06:08,880
one which was done by renzo the group

154
00:06:08,880 --> 00:06:12,000
the hive and the hive will also

155
00:06:12,000 --> 00:06:15,440
attack a hospital if they got a chance

156
00:06:15,440 --> 00:06:18,000
we got a supply chain attack organized

157
00:06:18,000 --> 00:06:21,600
by our evil and that means that uh

158
00:06:21,600 --> 00:06:23,120
cassia is actually the software

159
00:06:23,120 --> 00:06:24,319
maintaining

160
00:06:24,319 --> 00:06:26,720
other clients infrastructure and they

161
00:06:26,720 --> 00:06:28,960
managed to encrypt all their clients

162
00:06:28,960 --> 00:06:30,960
infrastructure by means of that exploit

163
00:06:30,960 --> 00:06:31,919
and then

164
00:06:31,919 --> 00:06:34,880
the way the faster it came the fast it

165
00:06:34,880 --> 00:06:37,840
also ends because the decryption key was

166
00:06:37,840 --> 00:06:40,960
eventually disclosed

167
00:06:40,960 --> 00:06:43,199
the colonial pipeline

168
00:06:43,199 --> 00:06:46,880
to have an idea about the impact

169
00:06:47,039 --> 00:06:49,039
is providing the fuel for the plane so

170
00:06:49,039 --> 00:06:51,120
in washington the planes were kept on

171
00:06:51,120 --> 00:06:54,240
the ground as a result of that attack

172
00:06:54,240 --> 00:06:57,599
and obviously uh ryuk also a very fierce

173
00:06:57,599 --> 00:07:01,120
one attacks from hospitals uh in america

174
00:07:01,120 --> 00:07:03,599
and there is even a rumor that it

175
00:07:03,599 --> 00:07:06,960
actually also caused a human casualty

176
00:07:06,960 --> 00:07:10,080
i don't know if that's true

177
00:07:10,080 --> 00:07:12,560
okido so if you

178
00:07:12,560 --> 00:07:14,960
combine all the services

179
00:07:14,960 --> 00:07:18,400
they join their forces uh even they have

180
00:07:18,400 --> 00:07:20,720
all these elements like the one who is

181
00:07:20,720 --> 00:07:22,800
uh providing the software

182
00:07:22,800 --> 00:07:24,880
doing the negotiations

183
00:07:24,880 --> 00:07:26,560
and etc

184
00:07:26,560 --> 00:07:28,240
you put all the elements in a big bowl

185
00:07:28,240 --> 00:07:30,080
and stir it you have something that is

186
00:07:30,080 --> 00:07:32,240
ransomware as a service and as you can

187
00:07:32,240 --> 00:07:34,400
see that is a really money making

188
00:07:34,400 --> 00:07:35,520
product

189
00:07:35,520 --> 00:07:37,919
and also ransomware groups are now

190
00:07:37,919 --> 00:07:39,199
combining

191
00:07:39,199 --> 00:07:40,800
and buying stuff

192
00:07:40,800 --> 00:07:42,400
from each other

193
00:07:42,400 --> 00:07:44,879
and handing out knowledge to become even

194
00:07:44,879 --> 00:07:48,960
bigger to be more successful

195
00:07:50,000 --> 00:07:51,039
um

196
00:07:51,039 --> 00:07:53,360
as you look there's this skill chain it

197
00:07:53,360 --> 00:07:56,840
kind of likes look a cyber kill

198
00:07:56,840 --> 00:08:00,720
chain it also starts with a

199
00:08:00,720 --> 00:08:03,520
um delivery where you can first send an

200
00:08:03,520 --> 00:08:05,440
email for us in a phishing attack

201
00:08:05,440 --> 00:08:07,199
with an attachment to gain foothold to

202
00:08:07,199 --> 00:08:10,360
your system

203
00:08:14,080 --> 00:08:14,879
oh

204
00:08:14,879 --> 00:08:18,360
sorry about that

205
00:08:28,240 --> 00:08:30,319
yeah sorry about that

206
00:08:30,319 --> 00:08:33,120
that was in the wrong hole

207
00:08:33,120 --> 00:08:35,120
now

208
00:08:35,120 --> 00:08:37,360
after having the foothold

209
00:08:37,360 --> 00:08:39,519
and there is a callback to the attacker

210
00:08:39,519 --> 00:08:41,919
server all the files will be encrypted

211
00:08:41,919 --> 00:08:44,240
by means of that asymmetric algorithm

212
00:08:44,240 --> 00:08:47,360
and the renderer will actually show a

213
00:08:47,360 --> 00:08:49,440
message in order to

214
00:08:49,440 --> 00:08:50,560
pay

215
00:08:50,560 --> 00:08:52,240
now if this table happens on a single

216
00:08:52,240 --> 00:08:54,480
system it could be a server or a network

217
00:08:54,480 --> 00:08:56,160
device anything like that well we call

218
00:08:56,160 --> 00:08:59,360
that an attack type one

219
00:08:59,360 --> 00:09:02,000
when the attack will also try to do some

220
00:09:02,000 --> 00:09:04,000
lateral movement we're going to look for

221
00:09:04,000 --> 00:09:05,680
that later in the demonstration and

222
00:09:05,680 --> 00:09:07,040
we'll try to

223
00:09:07,040 --> 00:09:09,839
exfoliate sensitive information

224
00:09:09,839 --> 00:09:12,720
and also make sure that the backups are

225
00:09:12,720 --> 00:09:14,320
unusable we

226
00:09:14,320 --> 00:09:17,839
call that a type 2 attack

227
00:09:18,399 --> 00:09:20,399
so for the demonstration we're going to

228
00:09:20,399 --> 00:09:23,279
first have a look at a victim which we

229
00:09:23,279 --> 00:09:25,440
can't fish with an

230
00:09:25,440 --> 00:09:26,720
email attachment we'd have some

231
00:09:26,720 --> 00:09:29,040
microfarads in it and

232
00:09:29,040 --> 00:09:32,720
some malware for to gain some foothold

233
00:09:32,720 --> 00:09:34,640
next we're going to look for

234
00:09:34,640 --> 00:09:36,720
some accounts which are on that system

235
00:09:36,720 --> 00:09:39,360
and try to raise our privileges and see

236
00:09:39,360 --> 00:09:41,120
if there are more accounts we are

237
00:09:41,120 --> 00:09:43,600
interested in and eventually we're going

238
00:09:43,600 --> 00:09:45,680
to target a domain controller and the

239
00:09:45,680 --> 00:09:47,600
end goal is to encrypt the domain

240
00:09:47,600 --> 00:09:49,040
controller

241
00:09:49,040 --> 00:09:52,800
and to deploy our malware over there

242
00:09:52,800 --> 00:09:56,640
so i would say just sit back and relax

243
00:09:56,640 --> 00:09:58,160
then we're going to start the

244
00:09:58,160 --> 00:10:01,160
demonstration

245
00:10:06,079 --> 00:10:08,240
so in this first step

246
00:10:08,240 --> 00:10:10,160
we're creating a phishing email

247
00:10:10,160 --> 00:10:12,320
and that phishing email

248
00:10:12,320 --> 00:10:14,800
could have some social engineering as

249
00:10:14,800 --> 00:10:18,160
well because the receiver might expect

250
00:10:18,160 --> 00:10:20,160
an email from someone

251
00:10:20,160 --> 00:10:23,519
with sending in a presentation

252
00:10:26,160 --> 00:10:30,439
take some time to type this message

253
00:10:35,040 --> 00:10:38,320
okay now the email has been sent

254
00:10:38,320 --> 00:10:40,000
not sure if you see this red dot

255
00:10:40,000 --> 00:10:42,560
probably not

256
00:10:44,160 --> 00:10:46,480
it arrives in the index in inbox of the

257
00:10:46,480 --> 00:10:50,079
victim try to open it

258
00:10:50,959 --> 00:10:53,040
it seems that it's coming from a trusted

259
00:10:53,040 --> 00:10:55,439
sender

260
00:10:57,920 --> 00:11:01,160
and next

261
00:11:01,279 --> 00:11:02,880
the email attachment is opened and there

262
00:11:02,880 --> 00:11:06,480
is a powerpoint presentation in it

263
00:11:06,560 --> 00:11:09,279
okay so let's see what's going to happen

264
00:11:09,279 --> 00:11:11,519
now

265
00:11:12,000 --> 00:11:13,920
the victim enables the content very

266
00:11:13,920 --> 00:11:16,800
smart thing to do

267
00:11:17,519 --> 00:11:19,200
and in the meanwhile

268
00:11:19,200 --> 00:11:20,560
well we all know

269
00:11:20,560 --> 00:11:22,320
the victim cats debate in the background

270
00:11:22,320 --> 00:11:24,720
there was already a listener started and

271
00:11:24,720 --> 00:11:26,000
now we have a

272
00:11:26,000 --> 00:11:28,160
reverse shell and this is the first step

273
00:11:28,160 --> 00:11:30,719
of the attack

274
00:11:35,040 --> 00:11:37,279
okay so the connection has been enabled

275
00:11:37,279 --> 00:11:40,640
going to move to the next one

276
00:11:40,839 --> 00:11:44,160
however in my example i use the macro

277
00:11:44,160 --> 00:11:47,040
and doesn't necessarily have to be so

278
00:11:47,040 --> 00:11:49,279
not so long ago there was a

279
00:11:49,279 --> 00:11:51,760
zero day vulnerability you probably have

280
00:11:51,760 --> 00:11:53,680
seen it the folena

281
00:11:53,680 --> 00:11:55,680
which is making use of the microsoft

282
00:11:55,680 --> 00:11:58,320
diagnostic diagnostic tool and that's

283
00:11:58,320 --> 00:12:01,760
also a way to provide foothold

284
00:12:02,079 --> 00:12:06,160
so the victim opens this word document

285
00:12:06,639 --> 00:12:08,240
and in this scenario

286
00:12:08,240 --> 00:12:10,880
also a reverse shell is being set up in

287
00:12:10,880 --> 00:12:13,959
the background

288
00:12:20,100 --> 00:12:23,460
[Music]

289
00:12:29,519 --> 00:12:31,600
okay and that's that we're going to look

290
00:12:31,600 --> 00:12:33,519
at the next step and that is privilege

291
00:12:33,519 --> 00:12:34,880
escalation now

292
00:12:34,880 --> 00:12:36,720
privilege escalation is quite a complex

293
00:12:36,720 --> 00:12:39,360
thing so i took some shortcuts here and

294
00:12:39,360 --> 00:12:43,200
there also in order to save time

295
00:12:43,200 --> 00:12:45,600
in this example we're going to look

296
00:12:45,600 --> 00:12:47,360
to listen on the network for events we

297
00:12:47,360 --> 00:12:50,800
can use in order to

298
00:12:51,040 --> 00:12:53,680
catch some event which will

299
00:12:53,680 --> 00:12:56,000
give us the password of a particular

300
00:12:56,000 --> 00:12:58,880
user we're after

301
00:13:00,399 --> 00:13:03,120
so this user is trying to look for a

302
00:13:03,120 --> 00:13:05,120
particular server on the network

303
00:13:05,120 --> 00:13:07,360
however there is no such server but in

304
00:13:07,360 --> 00:13:09,360
the background negotiation will take

305
00:13:09,360 --> 00:13:11,040
place anyway

306
00:13:11,040 --> 00:13:14,319
so there is a listener running

307
00:13:14,800 --> 00:13:17,600
if am i correct there is also a hash

308
00:13:17,600 --> 00:13:19,600
being captured by the tool

309
00:13:19,600 --> 00:13:22,480
and disclosed the user's password

310
00:13:22,480 --> 00:13:26,079
so now we have a user's password

311
00:13:28,000 --> 00:13:29,839
next a very nice feature

312
00:13:29,839 --> 00:13:32,079
in windows is auto logon

313
00:13:32,079 --> 00:13:34,639
and when you enable that

314
00:13:34,639 --> 00:13:36,240
for the attacker can look for that

315
00:13:36,240 --> 00:13:39,440
registry key and see if actually someone

316
00:13:39,440 --> 00:13:42,000
enabled that with a clear text password

317
00:13:42,000 --> 00:13:44,880
it's a very easy thing

318
00:13:44,880 --> 00:13:47,440
to extract the information and to have

319
00:13:47,440 --> 00:13:50,720
the administration password

320
00:13:51,120 --> 00:13:53,360
i'm not saying that it will happen

321
00:13:53,360 --> 00:13:56,800
often but it can be the case

322
00:13:56,800 --> 00:13:58,480
so and there we go

323
00:13:58,480 --> 00:14:00,399
we've got also now the local admin

324
00:14:00,399 --> 00:14:03,399
password

325
00:14:03,920 --> 00:14:05,440
so we already have a running shell on

326
00:14:05,440 --> 00:14:06,959
the background now

327
00:14:06,959 --> 00:14:10,000
we want to upgrade that shell with that

328
00:14:10,000 --> 00:14:11,920
administration password to raise our

329
00:14:11,920 --> 00:14:14,920
privileges

330
00:14:24,720 --> 00:14:27,120
so we're still the demo user we put it

331
00:14:27,120 --> 00:14:28,800
in the background

332
00:14:28,800 --> 00:14:31,680
and then we run our script

333
00:14:31,680 --> 00:14:35,279
which includes our new username and

334
00:14:35,279 --> 00:14:37,839
password

335
00:14:39,279 --> 00:14:41,519
this is a post attack on the existing

336
00:14:41,519 --> 00:14:43,120
shell

337
00:14:43,120 --> 00:14:44,800
and we'll create a new shell and then we

338
00:14:44,800 --> 00:14:46,720
have administrator

339
00:14:46,720 --> 00:14:49,360
permissions

340
00:14:49,839 --> 00:14:51,920
okay so this one workstation that we

341
00:14:51,920 --> 00:14:53,199
have compromised

342
00:14:53,199 --> 00:14:56,320
and now we wanted to move around to look

343
00:14:56,320 --> 00:14:58,480
for better targets that's what we're

344
00:14:58,480 --> 00:15:01,199
going to do now

345
00:15:03,680 --> 00:15:05,519
so first we're going to

346
00:15:05,519 --> 00:15:07,120
deploy our

347
00:15:07,120 --> 00:15:09,519
tool which is going to map out the

348
00:15:09,519 --> 00:15:13,639
network with a sharp mount

349
00:15:15,199 --> 00:15:17,600
the sharp hound will create some files

350
00:15:17,600 --> 00:15:19,839
and the files the json files we're going

351
00:15:19,839 --> 00:15:21,360
to import

352
00:15:21,360 --> 00:15:23,360
into bloodhound and bloodhound will give

353
00:15:23,360 --> 00:15:24,839
us the

354
00:15:24,839 --> 00:15:27,680
visibility we need to have

355
00:15:27,680 --> 00:15:30,560
in order to find the shortest path

356
00:15:30,560 --> 00:15:32,880
to our best target which is the domain

357
00:15:32,880 --> 00:15:35,439
controller

358
00:15:37,680 --> 00:15:41,800
so there we go we started bloodhounds

359
00:15:45,040 --> 00:15:48,240
the files are important

360
00:15:51,920 --> 00:15:55,440
and we have our attack path

361
00:15:55,440 --> 00:15:56,720
a visual

362
00:15:56,720 --> 00:15:58,639
is there

363
00:15:58,639 --> 00:16:00,000
okay

364
00:16:00,000 --> 00:16:01,360
so next

365
00:16:01,360 --> 00:16:03,279
we're going to combine

366
00:16:03,279 --> 00:16:05,600
the information we already extracted

367
00:16:05,600 --> 00:16:07,120
from the user accounts we've got the

368
00:16:07,120 --> 00:16:09,920
hashes and we're going to combine all

369
00:16:09,920 --> 00:16:12,079
that information also with other

370
00:16:12,079 --> 00:16:14,160
accounts we have found

371
00:16:14,160 --> 00:16:15,920
and combine that into a ticket we're

372
00:16:15,920 --> 00:16:17,680
going to create and the ticket is going

373
00:16:17,680 --> 00:16:19,839
to grant us access to the domain

374
00:16:19,839 --> 00:16:21,839
controller so are able to create a

375
00:16:21,839 --> 00:16:23,759
remote connection with that ticket and

376
00:16:23,759 --> 00:16:26,720
deploy our malware

377
00:16:30,959 --> 00:16:34,839
so first we need the hash

378
00:16:39,519 --> 00:16:42,160
and there it is

379
00:16:48,240 --> 00:16:51,759
then we go into the shell

380
00:16:53,519 --> 00:16:56,800
and we start up mimikats

381
00:16:58,480 --> 00:17:01,360
and we combine the hash

382
00:17:01,360 --> 00:17:03,759
with the user we want and we have a

383
00:17:03,759 --> 00:17:05,839
ticket to be able to use for the domain

384
00:17:05,839 --> 00:17:08,319
controller

385
00:17:08,959 --> 00:17:10,720
so the only thing we have to do now is

386
00:17:10,720 --> 00:17:12,319
create a remote connection with the

387
00:17:12,319 --> 00:17:14,480
domain controller copy our malware to a

388
00:17:14,480 --> 00:17:16,000
system

389
00:17:16,000 --> 00:17:18,160
we can copy it from and from there we

390
00:17:18,160 --> 00:17:19,839
copy it over to the main controller and

391
00:17:19,839 --> 00:17:22,399
execute it

392
00:17:29,600 --> 00:17:31,280
so it's already now being copied over

393
00:17:31,280 --> 00:17:33,440
the main controller the malware is named

394
00:17:33,440 --> 00:17:36,400
new.exe

395
00:17:37,039 --> 00:17:38,960
and in the powershell

396
00:17:38,960 --> 00:17:40,799
window we can just

397
00:17:40,799 --> 00:17:44,440
execute this file

398
00:17:52,640 --> 00:17:54,880
and there it is you can notice the

399
00:17:54,880 --> 00:17:57,280
system has been encrypted with grand

400
00:17:57,280 --> 00:18:00,600
crab ransomware

401
00:18:01,039 --> 00:18:02,480
and the ransomware node is being

402
00:18:02,480 --> 00:18:04,960
displayed

403
00:18:05,120 --> 00:18:06,480
okay

404
00:18:06,480 --> 00:18:09,760
so what we can do now is to see if there

405
00:18:09,760 --> 00:18:14,280
is any evidence of this attack

406
00:18:14,640 --> 00:18:16,320
and therefore we're going to use a seam

407
00:18:16,320 --> 00:18:17,840
system

408
00:18:17,840 --> 00:18:19,840
and a subsystem will

409
00:18:19,840 --> 00:18:22,160
have all the logs of all the endpoint

410
00:18:22,160 --> 00:18:24,480
devices of all the servers in the

411
00:18:24,480 --> 00:18:26,720
network that's the way how it's been

412
00:18:26,720 --> 00:18:28,480
traditionally done

413
00:18:28,480 --> 00:18:30,480
and when you're configuring all this

414
00:18:30,480 --> 00:18:32,160
stuff together to make sure the log

415
00:18:32,160 --> 00:18:34,000
folders are forwarding the right

416
00:18:34,000 --> 00:18:35,280
information

417
00:18:35,280 --> 00:18:40,120
then at the end you look like this

418
00:18:42,320 --> 00:18:43,600
so

419
00:18:43,600 --> 00:18:46,080
we have a ransomware node as evidence

420
00:18:46,080 --> 00:18:48,160
and that is something which is where we

421
00:18:48,160 --> 00:18:50,000
are interesting in to start our research

422
00:18:50,000 --> 00:18:52,000
with

423
00:18:52,000 --> 00:18:54,080
so we're going to start a query which is

424
00:18:54,080 --> 00:18:57,840
going to look for that information

425
00:18:57,840 --> 00:18:59,120
and in this

426
00:18:59,120 --> 00:19:01,679
example you will notice we have find

427
00:19:01,679 --> 00:19:05,039
some ransomware nodes

428
00:19:08,160 --> 00:19:10,080
other indicators of compromise we are

429
00:19:10,080 --> 00:19:12,799
interested in are for instance

430
00:19:12,799 --> 00:19:14,160
the

431
00:19:14,160 --> 00:19:16,320
clearing of the event log because an

432
00:19:16,320 --> 00:19:18,720
attacker will probably try to hide the

433
00:19:18,720 --> 00:19:19,760
traces

434
00:19:19,760 --> 00:19:22,720
and that will also leave an event behind

435
00:19:22,720 --> 00:19:25,600
we can use as an evidence

436
00:19:25,600 --> 00:19:27,039
next we are interested if there is

437
00:19:27,039 --> 00:19:29,840
macrophiles are being used or

438
00:19:29,840 --> 00:19:31,840
malicious tools like sharp hounds or

439
00:19:31,840 --> 00:19:33,679
anything like that are being used is

440
00:19:33,679 --> 00:19:37,200
also a nice way to thread hand on

441
00:19:37,200 --> 00:19:38,799
not mentioned here

442
00:19:38,799 --> 00:19:40,720
the disabling of anti-fires for instance

443
00:19:40,720 --> 00:19:42,240
can also be a nice indicator of

444
00:19:42,240 --> 00:19:45,840
compromise to search for

445
00:19:45,840 --> 00:19:47,919
so what we've seen until now is a red

446
00:19:47,919 --> 00:19:49,440
teaming exercise and a blue team

447
00:19:49,440 --> 00:19:51,360
exercise and in the red teaming part

448
00:19:51,360 --> 00:19:53,440
we're doing the offense kind of game

449
00:19:53,440 --> 00:19:56,160
where we're going to an attacking system

450
00:19:56,160 --> 00:19:59,120
and see if we can try to maintain access

451
00:19:59,120 --> 00:20:00,799
and to deploy our malware

452
00:20:00,799 --> 00:20:03,919
and in the blue team we'll try to

453
00:20:03,919 --> 00:20:05,760
see if they're able to detect this kind

454
00:20:05,760 --> 00:20:06,480
of

455
00:20:06,480 --> 00:20:07,520
attacks

456
00:20:07,520 --> 00:20:11,440
and if they're able to mitigate them

457
00:20:14,799 --> 00:20:16,000
okay

458
00:20:16,000 --> 00:20:19,039
and if that all goes well

459
00:20:19,039 --> 00:20:22,080
then at the end you can have a really

460
00:20:22,080 --> 00:20:23,760
good backup

461
00:20:23,760 --> 00:20:25,600
after such an attack you can use in

462
00:20:25,600 --> 00:20:28,000
order to go to a previous known goodness

463
00:20:28,000 --> 00:20:30,960
state but what happens that

464
00:20:30,960 --> 00:20:33,840
when a backup could also be infected

465
00:20:33,840 --> 00:20:36,000
with a certain

466
00:20:36,000 --> 00:20:38,320
malware that will execute after some

467
00:20:38,320 --> 00:20:40,240
time and then all your backups are

468
00:20:40,240 --> 00:20:42,640
encrypted as well

469
00:20:42,640 --> 00:20:44,880
also what can go wrong is humans

470
00:20:44,880 --> 00:20:46,720
obviously can make mistakes they can

471
00:20:46,720 --> 00:20:49,760
click on the link for instance and then

472
00:20:49,760 --> 00:20:52,320
you can have as much as defense kind of

473
00:20:52,320 --> 00:20:54,159
mechanisms in your network but when a

474
00:20:54,159 --> 00:20:56,080
user clicks on a link

475
00:20:56,080 --> 00:20:59,039
then you have an incident

476
00:21:00,480 --> 00:21:02,799
if you are in a ransomware attack

477
00:21:02,799 --> 00:21:04,799
usually there is panic and in a panic

478
00:21:04,799 --> 00:21:07,200
situation um could be that you don't

479
00:21:07,200 --> 00:21:09,919
have access anymore to a server or to a

480
00:21:09,919 --> 00:21:12,880
data center and if it's not clear in the

481
00:21:12,880 --> 00:21:15,200
procedure who do you need to contact or

482
00:21:15,200 --> 00:21:17,440
where do you need to go you can run to

483
00:21:17,440 --> 00:21:20,400
in a lot of problems

484
00:21:20,799 --> 00:21:23,679
obviously malware will eventually run on

485
00:21:23,679 --> 00:21:26,159
workstations the obfuscation techniques

486
00:21:26,159 --> 00:21:28,240
will be better better in the examples i

487
00:21:28,240 --> 00:21:30,400
just showed you there was no obfuscation

488
00:21:30,400 --> 00:21:32,880
at all but be aware that's the case in

489
00:21:32,880 --> 00:21:35,200
in real life and then we just have to

490
00:21:35,200 --> 00:21:36,960
deal with that and also

491
00:21:36,960 --> 00:21:39,200
to prepare

492
00:21:39,200 --> 00:21:41,679
and as you've just shown zero day for

493
00:21:41,679 --> 00:21:44,080
mobility it was there a microsoft word

494
00:21:44,080 --> 00:21:44,799
so

495
00:21:44,799 --> 00:21:48,240
we have to deal with these as well

496
00:21:49,440 --> 00:21:52,080
so what we were going to do then

497
00:21:52,080 --> 00:21:54,320
i must admit that in the most exercises

498
00:21:54,320 --> 00:21:57,679
i did the end advice was to provide

499
00:21:57,679 --> 00:21:59,440
multi-factor authentication and it's

500
00:21:59,440 --> 00:22:01,919
often being used as a silver bullet to

501
00:22:01,919 --> 00:22:03,760
take all your problems away now i was

502
00:22:03,760 --> 00:22:07,280
still wanted to point out that

503
00:22:07,280 --> 00:22:09,360
multi-factor rotation is very good to

504
00:22:09,360 --> 00:22:12,159
have but it's not magic so you should

505
00:22:12,159 --> 00:22:14,240
really be aware

506
00:22:14,240 --> 00:22:16,080
how to apply this

507
00:22:16,080 --> 00:22:19,039
so for instance if you have a system

508
00:22:19,039 --> 00:22:20,720
with high privileged accounts in active

509
00:22:20,720 --> 00:22:22,559
directory for instance

510
00:22:22,559 --> 00:22:23,840
and you want to protect these with

511
00:22:23,840 --> 00:22:27,120
multi-factor location from azure

512
00:22:27,120 --> 00:22:29,280
and synchronize all your high privilege

513
00:22:29,280 --> 00:22:31,840
accounts to azure in order to be able to

514
00:22:31,840 --> 00:22:33,440
make use of that service you might

515
00:22:33,440 --> 00:22:35,520
consider yourself thinking if that would

516
00:22:35,520 --> 00:22:38,720
be a good idea or not

517
00:22:38,799 --> 00:22:41,120
so yes in order to

518
00:22:41,120 --> 00:22:43,280
prevent the things you will have in your

519
00:22:43,280 --> 00:22:45,679
backups with a logic bomb for instance

520
00:22:45,679 --> 00:22:47,600
make sure you have your backups right

521
00:22:47,600 --> 00:22:50,640
protected and at least

522
00:22:50,640 --> 00:22:53,520
use any form of immutable data

523
00:22:53,520 --> 00:22:55,840
or even better put them offline

524
00:22:55,840 --> 00:22:57,440
somewhere

525
00:22:57,440 --> 00:22:59,280
obviously

526
00:22:59,280 --> 00:23:02,000
you should use practice cyber resilience

527
00:23:02,000 --> 00:23:03,039
and

528
00:23:03,039 --> 00:23:06,080
basically that means run the patches

529
00:23:06,080 --> 00:23:08,159
make sure you apply these privileges and

530
00:23:08,159 --> 00:23:09,440
all that

531
00:23:09,440 --> 00:23:11,600
i think i don't have to tell you it's

532
00:23:11,600 --> 00:23:14,400
just do the right thing

533
00:23:14,400 --> 00:23:17,120
okay that's easy to say and in large

534
00:23:17,120 --> 00:23:19,760
corporations usually that is the case

535
00:23:19,760 --> 00:23:20,559
but

536
00:23:20,559 --> 00:23:22,640
if you look at small organizations

537
00:23:22,640 --> 00:23:25,120
security doesn't necessarily

538
00:23:25,120 --> 00:23:27,120
has to be a priority right

539
00:23:27,120 --> 00:23:29,039
so therefore

540
00:23:29,039 --> 00:23:31,360
if you're in such situation

541
00:23:31,360 --> 00:23:33,280
i would advise so make use of the things

542
00:23:33,280 --> 00:23:35,440
you already know and apply that into

543
00:23:35,440 --> 00:23:38,880
your own exercises

544
00:23:39,200 --> 00:23:42,799
so i wasn't ready yet

545
00:23:43,279 --> 00:23:45,840
what about cloud well cloud could be a

546
00:23:45,840 --> 00:23:49,360
gift and a curse and i would say

547
00:23:49,360 --> 00:23:50,559
a gift

548
00:23:50,559 --> 00:23:53,840
because the cloud like azure and aws

549
00:23:53,840 --> 00:23:56,400
they have fantastic tools you can use to

550
00:23:56,400 --> 00:23:58,960
even improve your security like security

551
00:23:58,960 --> 00:24:02,240
app for instance azure as defender adp

552
00:24:02,240 --> 00:24:03,679
but be aware

553
00:24:03,679 --> 00:24:05,919
if you're on a public cloud that there

554
00:24:05,919 --> 00:24:07,120
are

555
00:24:07,120 --> 00:24:10,400
multiple challenges you need to take

556
00:24:10,400 --> 00:24:11,760
obviously

557
00:24:11,760 --> 00:24:14,559
detection we've seen and if my example i

558
00:24:14,559 --> 00:24:16,880
shot a traditional scene

559
00:24:16,880 --> 00:24:19,200
but they're also a way to protect

560
00:24:19,200 --> 00:24:21,200
your endpoints with edr

561
00:24:21,200 --> 00:24:24,000
and a couple of years ago or maybe even

562
00:24:24,000 --> 00:24:28,080
longer edr was just beginning and it

563
00:24:28,080 --> 00:24:30,000
wasn't nice to have and nowadays you

564
00:24:30,000 --> 00:24:31,360
can't even

565
00:24:31,360 --> 00:24:34,480
think you can do without

566
00:24:34,480 --> 00:24:36,400
obviously use

567
00:24:36,400 --> 00:24:38,880
proper network segmentation in order to

568
00:24:38,880 --> 00:24:41,360
prevent lateral movement from happening

569
00:24:41,360 --> 00:24:43,520
and i would say document

570
00:24:43,520 --> 00:24:45,440
when you ever get attacked document

571
00:24:45,440 --> 00:24:46,400
every step

572
00:24:46,400 --> 00:24:48,320
and then you can prepare for a next

573
00:24:48,320 --> 00:24:50,159
attack

574
00:24:50,159 --> 00:24:52,880
and privilege you mentioned don't

575
00:24:52,880 --> 00:24:56,000
bet only on one horse don't think mfa or

576
00:24:56,000 --> 00:24:58,080
edr will take off your all of your

577
00:24:58,080 --> 00:25:00,080
problems away combine all these

578
00:25:00,080 --> 00:25:01,279
strategies

579
00:25:01,279 --> 00:25:03,679
and make sure you apply defense in depth

580
00:25:03,679 --> 00:25:06,799
and do the proper thing

581
00:25:07,120 --> 00:25:10,799
so i hope you enjoyed it this was it

582
00:25:10,799 --> 00:25:12,640
and if there are any questions

583
00:25:12,640 --> 00:25:15,279
i will i will be around

584
00:25:15,279 --> 00:25:17,919
and i can answer them if anyone has one

585
00:25:17,919 --> 00:25:18,960
thank you

586
00:25:18,960 --> 00:25:21,679
there is some time for questions just a

587
00:25:21,679 --> 00:25:23,600
few so if someone has one please yeah i

588
00:25:23,600 --> 00:25:24,960
see one from the back walk to the

589
00:25:24,960 --> 00:25:27,120
microphone great and see a second person

590
00:25:27,120 --> 00:25:28,480
coming to the microphone let's see who's

591
00:25:28,480 --> 00:25:30,240
first let's use first yeah the person in

592
00:25:30,240 --> 00:25:31,919
the back is first

593
00:25:31,919 --> 00:25:34,880
hey everybody um see always practice

594
00:25:34,880 --> 00:25:36,559
running that way you get to get to the

595
00:25:36,559 --> 00:25:39,039
microphone first and ask your question

596
00:25:39,039 --> 00:25:41,120
in all seriousness um

597
00:25:41,120 --> 00:25:43,200
i've heard some very interesting but

598
00:25:43,200 --> 00:25:45,760
super anecdotal case studies of

599
00:25:45,760 --> 00:25:49,120
ransomware being used by apts that have

600
00:25:49,120 --> 00:25:51,279
been extracting data and then actually

601
00:25:51,279 --> 00:25:53,919
using ransomware attacks to hide the

602
00:25:53,919 --> 00:25:56,400
traces that an apt has been there or to

603
00:25:56,400 --> 00:25:58,400
essentially disguise an apt as a

604
00:25:58,400 --> 00:26:00,880
ransomware gang rather than a serious

605
00:26:00,880 --> 00:26:02,159
attack by a foreign government to

606
00:26:02,159 --> 00:26:04,720
extract data and i'm just curious if as

607
00:26:04,720 --> 00:26:06,000
i said the date i heard about it has

608
00:26:06,000 --> 00:26:07,840
been super anecdotal so i'm just curious

609
00:26:07,840 --> 00:26:11,120
if you've witnessed it in your work

610
00:26:11,120 --> 00:26:12,480
um

611
00:26:12,480 --> 00:26:14,720
can you look me up after this talk

612
00:26:14,720 --> 00:26:16,240
because there are a lot of things i

613
00:26:16,240 --> 00:26:18,799
don't want to disclose here for a large

614
00:26:18,799 --> 00:26:20,000
public

615
00:26:20,000 --> 00:26:21,520
but i've i definitely have some

616
00:26:21,520 --> 00:26:22,880
experience with the advanced precision

617
00:26:22,880 --> 00:26:25,039
threat yes

618
00:26:25,039 --> 00:26:26,480
cool all right

619
00:26:26,480 --> 00:26:27,840
next one

620
00:26:27,840 --> 00:26:30,799
run not the question only two comments

621
00:26:30,799 --> 00:26:32,720
thank you for your demonstration here

622
00:26:32,720 --> 00:26:34,480
brought sharphound don't need local

623
00:26:34,480 --> 00:26:36,320
administrative permission you can run it

624
00:26:36,320 --> 00:26:38,960
as a user i think you know it

625
00:26:38,960 --> 00:26:41,760
but you demonstrate to be local

626
00:26:41,760 --> 00:26:43,840
administrator first and after that you

627
00:26:43,840 --> 00:26:46,960
run sharp round but it runs directly

628
00:26:46,960 --> 00:26:49,279
and the other point

629
00:26:49,279 --> 00:26:50,240
the

630
00:26:50,240 --> 00:26:51,679
ransomware

631
00:26:51,679 --> 00:26:53,679
yeah that

632
00:26:53,679 --> 00:26:56,000
attacks the entire active directory and

633
00:26:56,000 --> 00:26:58,320
therefore it's a good recommendation to

634
00:26:58,320 --> 00:27:00,559
separate the backup system out from the

635
00:27:00,559 --> 00:27:02,720
active directory yeah

636
00:27:02,720 --> 00:27:04,400
that's it thanks

637
00:27:04,400 --> 00:27:06,960
two comments oh there was no question oh

638
00:27:06,960 --> 00:27:08,159
no no

639
00:27:08,159 --> 00:27:10,559
thanks a lot thanks for that yeah or you

640
00:27:10,559 --> 00:27:13,200
should have any reaction on that

641
00:27:13,200 --> 00:27:15,200
uh if there is still time uh i don't

642
00:27:15,200 --> 00:27:16,720
know other questions we've got two

643
00:27:16,720 --> 00:27:18,159
minutes i don't know if there's another

644
00:27:18,159 --> 00:27:20,000
question from the audience at this

645
00:27:20,000 --> 00:27:22,000
moment

646
00:27:22,000 --> 00:27:23,279
i don't

647
00:27:23,279 --> 00:27:25,760
see anyone so then

648
00:27:25,760 --> 00:27:27,520
if you want to react on that

649
00:27:27,520 --> 00:27:29,760
you have still one minute or

650
00:27:29,760 --> 00:27:31,200
you can then join the discussion with

651
00:27:31,200 --> 00:27:33,760
that person or perhaps other person's

652
00:27:33,760 --> 00:27:35,840
it's okay yeah let's uh wrap up then

653
00:27:35,840 --> 00:27:37,919
that's good for that yeah okay

654
00:27:37,919 --> 00:27:39,200
instead of curious so thank you very

655
00:27:39,200 --> 00:27:43,240
much yeah thank you everyone

656
00:27:50,720 --> 00:27:52,799
you

