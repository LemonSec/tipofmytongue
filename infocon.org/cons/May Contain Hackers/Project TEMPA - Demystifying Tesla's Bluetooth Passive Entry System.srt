1
00:00:01,280 --> 00:00:12,559
[Music]

2
00:00:15,759 --> 00:00:19,920
good evening and welcome to mch 2022 day

3
00:00:19,920 --> 00:00:22,240
4 intent battery

4
00:00:22,240 --> 00:00:24,240
um

5
00:00:24,240 --> 00:00:27,039
you probably know that battery i mean

6
00:00:27,039 --> 00:00:29,279
battery no we have we are talking we are

7
00:00:29,279 --> 00:00:31,039
not talking about batteries but battery

8
00:00:31,039 --> 00:00:34,000
powered cars so here with me on stage is

9
00:00:34,000 --> 00:00:36,800
martin hereford uh to talk to you about

10
00:00:36,800 --> 00:00:37,840
um

11
00:00:37,840 --> 00:00:40,320
demystifying tesla's bluetooth ii

12
00:00:40,320 --> 00:00:41,680
passive entry

13
00:00:41,680 --> 00:00:44,800
entry system please give him a very warm

14
00:00:44,800 --> 00:00:47,760
round of applause

15
00:00:51,199 --> 00:00:53,280
thank you very much for the introduction

16
00:00:53,280 --> 00:00:56,079
and thank you for being here

17
00:00:56,079 --> 00:00:58,399
i'm talking about project temper today

18
00:00:58,399 --> 00:01:00,480
and this is as you can see here about

19
00:01:00,480 --> 00:01:01,920
tesla cars

20
00:01:01,920 --> 00:01:03,760
it's the fourth time that i'm giving

21
00:01:03,760 --> 00:01:06,000
this talk but actually i was adding

22
00:01:06,000 --> 00:01:08,080
quite some new stuff as well every time

23
00:01:08,080 --> 00:01:09,200
i did it

24
00:01:09,200 --> 00:01:11,520
i tried to make an effort and add some

25
00:01:11,520 --> 00:01:13,760
new things

26
00:01:13,760 --> 00:01:15,280
right

27
00:01:15,280 --> 00:01:16,000
so

28
00:01:16,000 --> 00:01:17,759
about trifani.org you might have seen

29
00:01:17,759 --> 00:01:20,240
the logo in the lower right it's it's a

30
00:01:20,240 --> 00:01:23,360
group logo that is almost pretty retro

31
00:01:23,360 --> 00:01:26,400
already because that was 18 years ago

32
00:01:26,400 --> 00:01:28,560
when we started together or more than

33
00:01:28,560 --> 00:01:29,759
that

34
00:01:29,759 --> 00:01:32,320
together with colin mulliner

35
00:01:32,320 --> 00:01:34,479
and me and we did a lot of bluetooth

36
00:01:34,479 --> 00:01:36,079
related research

37
00:01:36,079 --> 00:01:37,840
back then of course mainly bluetooth

38
00:01:37,840 --> 00:01:39,040
classic

39
00:01:39,040 --> 00:01:42,079
and we were participating in some test

40
00:01:42,079 --> 00:01:44,240
events with the bluetooth sig which is

41
00:01:44,240 --> 00:01:45,840
the standardization body for the

42
00:01:45,840 --> 00:01:47,680
bluetooth protocol

43
00:01:47,680 --> 00:01:48,560
and

44
00:01:48,560 --> 00:01:50,880
we were helping vendors back then with

45
00:01:50,880 --> 00:01:52,720
their smartphone not smartphones with

46
00:01:52,720 --> 00:01:54,799
their feature phones and symbian phones

47
00:01:54,799 --> 00:01:57,200
stuff like that in order to

48
00:01:57,200 --> 00:01:58,560
have like

49
00:01:58,560 --> 00:02:01,040
not the easy low hangings of bluetooth

50
00:02:01,040 --> 00:02:03,759
vulnerabilities

51
00:02:03,759 --> 00:02:06,399
so and about me i'm from salzburg

52
00:02:06,399 --> 00:02:08,800
austria pretty much like the herald he's

53
00:02:08,800 --> 00:02:10,720
not from salzburg though he's from

54
00:02:10,720 --> 00:02:12,160
vienna

55
00:02:12,160 --> 00:02:14,800
and i'm a regular participant and also

56
00:02:14,800 --> 00:02:17,760
speaker at some instances at c3 in

57
00:02:17,760 --> 00:02:20,840
germany so which is the yearly ccc

58
00:02:20,840 --> 00:02:23,200
congress since

59
00:02:23,200 --> 00:02:26,959
98 without missing even one

60
00:02:26,959 --> 00:02:28,319
and i also

61
00:02:28,319 --> 00:02:31,599
am the author of the tesla radar app

62
00:02:31,599 --> 00:02:33,920
which i will talk a little bit about

63
00:02:33,920 --> 00:02:34,800
later

64
00:02:34,800 --> 00:02:36,879
and of course i own a tesla myself

65
00:02:36,879 --> 00:02:38,080
because

66
00:02:38,080 --> 00:02:40,720
always renting or having to rent one in

67
00:02:40,720 --> 00:02:42,879
order to do tests just didn't

68
00:02:42,879 --> 00:02:45,440
work out for me

69
00:02:45,440 --> 00:02:48,000
and a little bit of memory lane my first

70
00:02:48,000 --> 00:02:51,040
camp that i participated was actually in

71
00:02:51,040 --> 00:02:53,599
2005 it was what the heck it was in

72
00:02:53,599 --> 00:02:56,480
linde also in in the netherlands and i

73
00:02:56,480 --> 00:02:59,360
found a picture of me talking

74
00:02:59,360 --> 00:03:01,760
like in in one of the old flickr

75
00:03:01,760 --> 00:03:03,840
accounts that is still linked up in the

76
00:03:03,840 --> 00:03:06,319
page and as you can tell no difference

77
00:03:06,319 --> 00:03:07,200
right

78
00:03:07,200 --> 00:03:09,440
and back then i was talking not only

79
00:03:09,440 --> 00:03:11,599
about bluetooth security and stuff we

80
00:03:11,599 --> 00:03:14,239
found one of the projects i was talking

81
00:03:14,239 --> 00:03:16,159
about back then was also

82
00:03:16,159 --> 00:03:19,680
car whisperer my first project that went

83
00:03:19,680 --> 00:03:22,239
into the automotive direction and what i

84
00:03:22,239 --> 00:03:24,239
did there we were injecting audio

85
00:03:24,239 --> 00:03:27,200
messages into cars with hand presets and

86
00:03:27,200 --> 00:03:29,440
that was a lot of fun that was possible

87
00:03:29,440 --> 00:03:31,200
back then because of standard pin

88
00:03:31,200 --> 00:03:32,560
everybody used

89
00:03:32,560 --> 00:03:34,720
so it got a little more complicated with

90
00:03:34,720 --> 00:03:37,920
teslas they use obviously not a standard

91
00:03:37,920 --> 00:03:39,840
four-digit pass key in order to unlock

92
00:03:39,840 --> 00:03:41,280
the car

93
00:03:41,280 --> 00:03:43,440
they do it for

94
00:03:43,440 --> 00:03:46,080
driving though as you might know maybe

95
00:03:46,080 --> 00:03:48,239
as a show of hands how many how many of

96
00:03:48,239 --> 00:03:52,560
you do have a tesla or driver tester

97
00:03:52,560 --> 00:03:55,280
all right so that's like 500 percent

98
00:03:55,280 --> 00:03:57,439
more than usual because usually it's

99
00:03:57,439 --> 00:03:58,640
just one guy

100
00:03:58,640 --> 00:03:59,439
me

101
00:03:59,439 --> 00:04:01,680
all right but that's at least some more

102
00:04:01,680 --> 00:04:03,920
that's cool

103
00:04:03,920 --> 00:04:06,959
and um this talk is about

104
00:04:06,959 --> 00:04:08,640
telling you why you should be really

105
00:04:08,640 --> 00:04:11,439
careful using the tesla phone as a key

106
00:04:11,439 --> 00:04:13,360
and also like the nfc

107
00:04:13,360 --> 00:04:15,200
some of the things

108
00:04:15,200 --> 00:04:16,959
have been mitigated

109
00:04:16,959 --> 00:04:19,680
but project tamper was investigating the

110
00:04:19,680 --> 00:04:21,918
bluetooth low energy interface that

111
00:04:21,918 --> 00:04:24,800
tesla has in their cars

112
00:04:24,800 --> 00:04:26,880
and this interface that i'm talking

113
00:04:26,880 --> 00:04:29,919
about is primarily found in all tesla

114
00:04:29,919 --> 00:04:32,560
model 3 and y

115
00:04:32,560 --> 00:04:34,880
but also on the new facelift variants of

116
00:04:34,880 --> 00:04:38,400
model s and x so it turned out that this

117
00:04:38,400 --> 00:04:41,040
phone key feature which got introduced

118
00:04:41,040 --> 00:04:43,840
with tesla model 3 turned out to be a

119
00:04:43,840 --> 00:04:46,960
kind quite popular thing and it's i i

120
00:04:46,960 --> 00:04:48,400
believe it's also going to be in the

121
00:04:48,400 --> 00:04:50,880
roadster whenever this appears

122
00:04:50,880 --> 00:04:52,560
and um

123
00:04:52,560 --> 00:04:55,040
it's it's like the thing that tesla puts

124
00:04:55,040 --> 00:04:57,600
all their effort on

125
00:04:57,600 --> 00:04:58,400
and

126
00:04:58,400 --> 00:05:00,960
it's just an estimation that about two

127
00:05:00,960 --> 00:05:04,240
million cars to date do have that

128
00:05:04,240 --> 00:05:04,800
feature

129
00:05:04,800 --> 00:05:07,680
[Music]

130
00:05:07,680 --> 00:05:10,720
and what it also allows is not unlocking

131
00:05:10,720 --> 00:05:12,400
the car or like

132
00:05:12,400 --> 00:05:15,199
driving it it's also like

133
00:05:15,199 --> 00:05:18,639
having a continuous id so tracking

134
00:05:18,639 --> 00:05:21,199
and identifying vehicles on the radio

135
00:05:21,199 --> 00:05:24,400
level is pretty easy

136
00:05:24,400 --> 00:05:26,639
and also you can like send messages

137
00:05:26,639 --> 00:05:28,800
there and how you do that i'm going to

138
00:05:28,800 --> 00:05:30,720
show you

139
00:05:30,720 --> 00:05:33,759
so most are not most some of the things

140
00:05:33,759 --> 00:05:36,320
have been fixed by tesla over the time

141
00:05:36,320 --> 00:05:38,880
some of them partially so i talked about

142
00:05:38,880 --> 00:05:41,840
one thing that got mitigated but kind of

143
00:05:41,840 --> 00:05:44,160
reopened by one of the attacks i'm going

144
00:05:44,160 --> 00:05:46,320
to show today

145
00:05:46,320 --> 00:05:49,280
and other or most things are findings

146
00:05:49,280 --> 00:05:50,240
that

147
00:05:50,240 --> 00:05:52,400
came from reverse engineering the

148
00:05:52,400 --> 00:05:54,560
official tesla app which is an easy

149
00:05:54,560 --> 00:05:56,639
process as you might know the only thing

150
00:05:56,639 --> 00:05:58,960
is of course they use obfuscation so you

151
00:05:58,960 --> 00:06:01,120
have a lot of guesswork as well

152
00:06:01,120 --> 00:06:02,319
so

153
00:06:02,319 --> 00:06:04,479
the original research started with tesla

154
00:06:04,479 --> 00:06:06,639
radar in 19 but it

155
00:06:06,639 --> 00:06:10,160
it intensified in 2021 when playing a

156
00:06:10,160 --> 00:06:11,759
little more with the app and looking

157
00:06:11,759 --> 00:06:13,580
into that communication

158
00:06:13,580 --> 00:06:15,600
[Music]

159
00:06:15,600 --> 00:06:17,280
all right phone key

160
00:06:17,280 --> 00:06:19,919
what is it it's like the the big

161
00:06:19,919 --> 00:06:22,080
innovation that they had you use your

162
00:06:22,080 --> 00:06:22,960
phone

163
00:06:22,960 --> 00:06:24,960
as your car key

164
00:06:24,960 --> 00:06:27,280
and that's a pretty good idea

165
00:06:27,280 --> 00:06:29,440
and i said it's going to be part of

166
00:06:29,440 --> 00:06:30,960
future models

167
00:06:30,960 --> 00:06:33,280
so what's like the ways to unlock a

168
00:06:33,280 --> 00:06:35,360
tesla of course you guys that own the

169
00:06:35,360 --> 00:06:37,680
tesla already know that but for the for

170
00:06:37,680 --> 00:06:40,000
the ones that don't i explained that in

171
00:06:40,000 --> 00:06:42,880
a short slide here so you have like your

172
00:06:42,880 --> 00:06:45,199
phone which is pretty capable of using

173
00:06:45,199 --> 00:06:48,240
like the network based api which you

174
00:06:48,240 --> 00:06:50,639
require to have internet for

175
00:06:50,639 --> 00:06:53,280
then it's the nfc

176
00:06:53,280 --> 00:06:55,759
protocol which is in purple here which

177
00:06:55,759 --> 00:06:58,400
is used for directly interacting with

178
00:06:58,400 --> 00:06:59,280
the car

179
00:06:59,280 --> 00:07:01,919
and then you have bluetooth with kind of

180
00:07:01,919 --> 00:07:05,599
in the middle and as said here vcsec is

181
00:07:05,599 --> 00:07:07,599
the protocol which is spoken from the

182
00:07:07,599 --> 00:07:09,840
phone and also from the key fob via

183
00:07:09,840 --> 00:07:14,919
pluto's low energy to your car

184
00:07:18,720 --> 00:07:20,800
all right nfc card

185
00:07:20,800 --> 00:07:22,800
these are the ways you can read that

186
00:07:22,800 --> 00:07:24,080
later on

187
00:07:24,080 --> 00:07:25,039
um

188
00:07:25,039 --> 00:07:28,240
to unlock or just summarize that here

189
00:07:28,240 --> 00:07:30,000
a little bit and due to timely

190
00:07:30,000 --> 00:07:32,000
constraints i'm also not going to show

191
00:07:32,000 --> 00:07:34,560
the videos which i have like linked in

192
00:07:34,560 --> 00:07:36,800
the in the presentation and that's going

193
00:07:36,800 --> 00:07:39,919
to be your homework to show afterwards

194
00:07:39,919 --> 00:07:42,479
or to watch afterwards

195
00:07:42,479 --> 00:07:45,280
so a little paul for the five people

196
00:07:45,280 --> 00:07:48,560
with teslas so how would you unlock your

197
00:07:48,560 --> 00:07:51,759
tesla usually like with the key fob with

198
00:07:51,759 --> 00:07:54,479
the phone key or with the nfc card show

199
00:07:54,479 --> 00:07:55,920
of hands like key fob

200
00:07:55,920 --> 00:07:57,039
[Music]

201
00:07:57,039 --> 00:07:59,599
one two three

202
00:07:59,599 --> 00:08:01,759
and with the phone key

203
00:08:01,759 --> 00:08:02,639
one

204
00:08:02,639 --> 00:08:05,680
two three four is that right all right

205
00:08:05,680 --> 00:08:08,080
and with the nfc card

206
00:08:08,080 --> 00:08:09,599
still one

207
00:08:09,599 --> 00:08:11,520
one all right good

208
00:08:11,520 --> 00:08:14,160
so that was uh the official result from

209
00:08:14,160 --> 00:08:16,960
the tesla from the twitter poll i did so

210
00:08:16,960 --> 00:08:19,840
like 83 percent back then are using

211
00:08:19,840 --> 00:08:22,879
phone key including myself i do own a

212
00:08:22,879 --> 00:08:25,599
key fob though which costs a fortune for

213
00:08:25,599 --> 00:08:27,360
i think what it is

214
00:08:27,360 --> 00:08:28,800
and

215
00:08:28,800 --> 00:08:30,879
right phone key is the thing that most

216
00:08:30,879 --> 00:08:31,780
people use

217
00:08:31,780 --> 00:08:33,200
[Music]

218
00:08:33,200 --> 00:08:35,039
usually how does that work the

219
00:08:35,039 --> 00:08:37,360
smartphone finds the vehicle it has some

220
00:08:37,360 --> 00:08:39,599
indicators that show that this is the

221
00:08:39,599 --> 00:08:42,000
right vehicle to talk to

222
00:08:42,000 --> 00:08:43,679
and it connects

223
00:08:43,679 --> 00:08:46,320
because the car would act as a ble

224
00:08:46,320 --> 00:08:48,720
peripheral implementing a generic

225
00:08:48,720 --> 00:08:51,279
attribute service that you can interact

226
00:08:51,279 --> 00:08:52,720
with

227
00:08:52,720 --> 00:08:55,200
and there's no pairing required and this

228
00:08:55,200 --> 00:08:57,200
has also some background maybe why this

229
00:08:57,200 --> 00:08:59,440
is not required and of course you can

230
00:08:59,440 --> 00:09:02,000
unlock unlock your car you can start

231
00:09:02,000 --> 00:09:03,680
you can open the franc

232
00:09:03,680 --> 00:09:07,399
do stuff like that

233
00:09:08,480 --> 00:09:10,000
so whenever

234
00:09:10,000 --> 00:09:13,200
this car advertises a gut service there

235
00:09:13,200 --> 00:09:16,320
will be a name like a standard attribute

236
00:09:16,320 --> 00:09:17,920
or carrick

237
00:09:17,920 --> 00:09:20,160
a service and also a two-week

238
00:09:20,160 --> 00:09:22,480
characteristic and the from vehicle

239
00:09:22,480 --> 00:09:24,640
characteristic and pretty much also is

240
00:09:24,640 --> 00:09:26,800
very intuitive what's going to be done

241
00:09:26,800 --> 00:09:29,360
with these characteristics i guess

242
00:09:29,360 --> 00:09:31,279
as well it's exposing an

243
00:09:31,279 --> 00:09:33,040
ie beacon structure and i think that's

244
00:09:33,040 --> 00:09:35,440
mainly done in order to have iphones

245
00:09:35,440 --> 00:09:38,000
natively detect the car with all that

246
00:09:38,000 --> 00:09:40,560
background process optimization i think

247
00:09:40,560 --> 00:09:42,640
they built that in because apple makes

248
00:09:42,640 --> 00:09:44,480
it really hard to have a background

249
00:09:44,480 --> 00:09:46,720
process that does not rely on apple

250
00:09:46,720 --> 00:09:47,540
technology

251
00:09:47,540 --> 00:09:49,680
[Music]

252
00:09:49,680 --> 00:09:51,600
yeah and the advertisement is like

253
00:09:51,600 --> 00:09:53,760
pretty easy to find out so there's this

254
00:09:53,760 --> 00:09:55,839
uuid and then they have a major and

255
00:09:55,839 --> 00:09:58,160
minor id which is part of the ibeacon

256
00:09:58,160 --> 00:10:00,160
specification and these are like the

257
00:10:00,160 --> 00:10:03,040
attributes that an iphone along with the

258
00:10:03,040 --> 00:10:04,880
device address of the car would

259
00:10:04,880 --> 00:10:08,440
recognize the car for it to be connected

260
00:10:08,440 --> 00:10:10,640
[Music]

261
00:10:10,640 --> 00:10:12,720
and as well the name

262
00:10:12,720 --> 00:10:16,800
of the vehicle has some cryptic input

263
00:10:16,800 --> 00:10:19,519
or in

264
00:10:19,519 --> 00:10:21,760
cryptic stuff right so

265
00:10:21,760 --> 00:10:24,959
whoever scans for ble devices next to a

266
00:10:24,959 --> 00:10:28,000
tesla will find a few of like these

267
00:10:28,000 --> 00:10:30,320
names starting with an s and then

268
00:10:30,320 --> 00:10:33,120
there's an eight bytes hex

269
00:10:33,120 --> 00:10:35,519
sequence hex encoded sequence ending

270
00:10:35,519 --> 00:10:37,920
with a c in the most case i guess most

271
00:10:37,920 --> 00:10:41,839
of you found that already so c i believe

272
00:10:41,839 --> 00:10:44,399
stands for the center interface then we

273
00:10:44,399 --> 00:10:46,160
have a driver side passenger side and

274
00:10:46,160 --> 00:10:48,880
the rear side but these names are guests

275
00:10:48,880 --> 00:10:50,800
because like passengers side on the

276
00:10:50,800 --> 00:10:52,480
right-hand drive would be the driver's

277
00:10:52,480 --> 00:10:54,240
side so i think they kind of messed up

278
00:10:54,240 --> 00:10:55,600
there already

279
00:10:55,600 --> 00:10:56,959
so

280
00:10:56,959 --> 00:10:59,279
but the thing the eight bytes in the hex

281
00:10:59,279 --> 00:11:01,360
seemed random to me at first

282
00:11:01,360 --> 00:11:04,320
and they seem to be unique to a vehicle

283
00:11:04,320 --> 00:11:05,360
and

284
00:11:05,360 --> 00:11:07,519
they are always turned on

285
00:11:07,519 --> 00:11:09,200
and unique to the vehicle and that kind

286
00:11:09,200 --> 00:11:10,959
of led to the thing with the permanent

287
00:11:10,959 --> 00:11:13,839
id so anybody with a phone could tell

288
00:11:13,839 --> 00:11:16,399
whether my car is in the proximity of

289
00:11:16,399 --> 00:11:18,560
bluetooth or not

290
00:11:18,560 --> 00:11:21,120
which is a privacy privacy issue which i

291
00:11:21,120 --> 00:11:24,320
pointed out in 2019 to tesla and that's

292
00:11:24,320 --> 00:11:25,680
also when i

293
00:11:25,680 --> 00:11:28,000
published the tesla radar app which is a

294
00:11:28,000 --> 00:11:30,720
showcase for how easy it would be to

295
00:11:30,720 --> 00:11:33,519
spot a tesla over a larger

296
00:11:33,519 --> 00:11:35,760
area given that there's enough people

297
00:11:35,760 --> 00:11:37,839
with a bluetooth phone participating in

298
00:11:37,839 --> 00:11:40,800
the tesla radar

299
00:11:40,839 --> 00:11:42,959
ecosystem and

300
00:11:42,959 --> 00:11:45,680
in a way it is allowing to stalk people

301
00:11:45,680 --> 00:11:48,320
right and even though the apple air tech

302
00:11:48,320 --> 00:11:50,959
implements way more security and privacy

303
00:11:50,959 --> 00:11:53,440
features in their tech technology

304
00:11:53,440 --> 00:11:55,680
so they randomize their ids they are

305
00:11:55,680 --> 00:11:57,760
really hard to really

306
00:11:57,760 --> 00:12:00,639
track and then reliably track but even

307
00:12:00,639 --> 00:12:02,480
this caused a

308
00:12:02,480 --> 00:12:04,800
massive outcry in the in the privacy

309
00:12:04,800 --> 00:12:07,040
community that this is not a thing that

310
00:12:07,040 --> 00:12:08,880
they should do of course

311
00:12:08,880 --> 00:12:11,360
slipping a tesla into somebody's purse

312
00:12:11,360 --> 00:12:13,360
is hard but

313
00:12:13,360 --> 00:12:15,839
that would be the maybe the reason that

314
00:12:15,839 --> 00:12:19,040
tesla permanent id never got that of an

315
00:12:19,040 --> 00:12:21,439
issue

316
00:12:21,519 --> 00:12:24,160
so i had a correspondence with tesla and

317
00:12:24,160 --> 00:12:26,240
they said well

318
00:12:26,240 --> 00:12:28,160
we know that is the case but we don't

319
00:12:28,160 --> 00:12:30,320
change it because as long as there's

320
00:12:30,320 --> 00:12:33,279
camera cameras everywhere that also film

321
00:12:33,279 --> 00:12:35,440
your number plate we don't see a reason

322
00:12:35,440 --> 00:12:37,519
of changing anything there

323
00:12:37,519 --> 00:12:39,040
so i think

324
00:12:39,040 --> 00:12:41,200
that was the reason when i made that app

325
00:12:41,200 --> 00:12:42,240
public

326
00:12:42,240 --> 00:12:44,880
and kind of show how big of a thing that

327
00:12:44,880 --> 00:12:46,240
could be

328
00:12:46,240 --> 00:12:48,639
and first it was for showcasing privacy

329
00:12:48,639 --> 00:12:51,279
issues then it was a game for tesla fans

330
00:12:51,279 --> 00:12:53,360
so there's some gamification in there

331
00:12:53,360 --> 00:12:55,040
there's a ranking actually tom is right

332
00:12:55,040 --> 00:12:57,279
here in the second row he's like the

333
00:12:57,279 --> 00:13:00,160
number one tesla spotter for a long long

334
00:13:00,160 --> 00:13:01,519
long time

335
00:13:01,519 --> 00:13:02,880
and

336
00:13:02,880 --> 00:13:05,519
yeah give him

337
00:13:05,680 --> 00:13:07,760
and i i don't know how many ten

338
00:13:07,760 --> 00:13:10,000
thousands of teslas you spotted but

339
00:13:10,000 --> 00:13:13,200
you're like the number one spotter even

340
00:13:13,200 --> 00:13:14,959
though you're not on that ranking list

341
00:13:14,959 --> 00:13:16,959
anymore because your super observer is

342
00:13:16,959 --> 00:13:19,120
currently under maintenance right

343
00:13:19,120 --> 00:13:21,920
right but very good work

344
00:13:21,920 --> 00:13:23,519
and of course it's a it's a big data

345
00:13:23,519 --> 00:13:25,440
collection for work i think there's a

346
00:13:25,440 --> 00:13:27,680
statistic from may and there was about

347
00:13:27,680 --> 00:13:29,360
154

348
00:13:29,360 --> 00:13:32,320
unique cars in the network from about 15

349
00:13:32,320 --> 00:13:34,639
in the meantime 50 different countries

350
00:13:34,639 --> 00:13:35,519
so

351
00:13:35,519 --> 00:13:38,160
there's a lot of players and if you

352
00:13:38,160 --> 00:13:41,600
found this interesting i have to say at

353
00:13:41,600 --> 00:13:43,680
the moment i'm having technical issues

354
00:13:43,680 --> 00:13:45,680
with the app so just allow it

355
00:13:45,680 --> 00:13:48,240
communicating on wi-fi please if you

356
00:13:48,240 --> 00:13:49,839
want to use it

357
00:13:49,839 --> 00:13:51,920
because it kind of re-transmitted a lot

358
00:13:51,920 --> 00:13:54,079
and causes a lot of and i have to find

359
00:13:54,079 --> 00:13:56,320
out about that

360
00:13:56,320 --> 00:13:58,800
so but back to the thing with the eight

361
00:13:58,800 --> 00:14:01,120
eight characters that are hex encoded or

362
00:14:01,120 --> 00:14:03,440
eight bytes that are hex encoded and of

363
00:14:03,440 --> 00:14:05,360
course it's unique to the vehicle and

364
00:14:05,360 --> 00:14:07,760
the win would also be like the vehicle

365
00:14:07,760 --> 00:14:09,920
identification number is also a thing

366
00:14:09,920 --> 00:14:12,560
that is unique to vehicle so it encodes

367
00:14:12,560 --> 00:14:16,240
a manufacturer id a model type and so on

368
00:14:16,240 --> 00:14:17,519
and

369
00:14:17,519 --> 00:14:21,279
that is hashed i found out

370
00:14:21,600 --> 00:14:24,160
hashed with the sha-1 and then they cut

371
00:14:24,160 --> 00:14:26,720
out like the they butcher it up and say

372
00:14:26,720 --> 00:14:28,800
only the eight bytes are taken for the

373
00:14:28,800 --> 00:14:31,360
vehicle and the identification

374
00:14:31,360 --> 00:14:33,040
so it's really hard to reverse that

375
00:14:33,040 --> 00:14:34,959
process since it's a cryptographic hash

376
00:14:34,959 --> 00:14:37,440
right so what i did is creating a rather

377
00:14:37,440 --> 00:14:39,839
small rainbow table of about

378
00:14:39,839 --> 00:14:40,800
um

379
00:14:40,800 --> 00:14:44,079
20 gigabytes and it has a pretty high

380
00:14:44,079 --> 00:14:47,440
hit rate so i can track back from that

381
00:14:47,440 --> 00:14:51,120
eight bytes uh hexing code

382
00:14:51,120 --> 00:14:53,440
i can see what the win is and can also

383
00:14:53,440 --> 00:14:55,440
see what the model would be of that kind

384
00:14:55,440 --> 00:14:58,800
of identifier i also could find out like

385
00:14:58,800 --> 00:15:01,040
if it's a performance model or worth

386
00:15:01,040 --> 00:15:03,279
stealing if i'm behind a locked garage

387
00:15:03,279 --> 00:15:04,720
door

388
00:15:04,720 --> 00:15:06,480
so it's a pretty high hit rate at the

389
00:15:06,480 --> 00:15:09,120
moment i will have to add new wins to

390
00:15:09,120 --> 00:15:11,760
the index so the austin gigafactory has

391
00:15:11,760 --> 00:15:13,920
a different signature i would have to

392
00:15:13,920 --> 00:15:17,040
add that i didn't even do that now but

393
00:15:17,040 --> 00:15:18,639
there's a little room for improvement

394
00:15:18,639 --> 00:15:20,959
but it works rather well

395
00:15:20,959 --> 00:15:22,000
and

396
00:15:22,000 --> 00:15:23,680
also what i did at christmas when i

397
00:15:23,680 --> 00:15:25,519
found out that

398
00:15:25,519 --> 00:15:28,800
key bin or like this vin reversing thing

399
00:15:28,800 --> 00:15:30,399
i thought it would be interesting to

400
00:15:30,399 --> 00:15:31,839
take my new

401
00:15:31,839 --> 00:15:34,320
tripod and mount an antenna on top

402
00:15:34,320 --> 00:15:36,240
and put it in my car

403
00:15:36,240 --> 00:15:38,320
so the side pocket of the model 3 is

404
00:15:38,320 --> 00:15:40,880
ideal for doing that so i put that with

405
00:15:40,880 --> 00:15:42,560
the antenna and went through a whole

406
00:15:42,560 --> 00:15:45,440
germany to the gigafactory four

407
00:15:45,440 --> 00:15:47,759
and because i'm in salzburg which is way

408
00:15:47,759 --> 00:15:49,120
down there

409
00:15:49,120 --> 00:15:51,360
and i drove along where the new battery

410
00:15:51,360 --> 00:15:53,839
factory is going to be and also giga4

411
00:15:53,839 --> 00:15:56,000
and there's the highway and always

412
00:15:56,000 --> 00:15:58,720
aiming my my antenna inwards right to

413
00:15:58,720 --> 00:16:00,399
the to the premises

414
00:16:00,399 --> 00:16:02,320
and what i found there was of a lot of

415
00:16:02,320 --> 00:16:04,399
research prototypes and you know from

416
00:16:04,399 --> 00:16:06,880
the wind they do have an r which is

417
00:16:06,880 --> 00:16:09,279
interesting but was also was interesting

418
00:16:09,279 --> 00:16:12,240
there was a lot of ble like carjacking

419
00:16:12,240 --> 00:16:14,639
devices things that could be when you

420
00:16:14,639 --> 00:16:16,560
tamper with them pretty dangerous for

421
00:16:16,560 --> 00:16:18,399
the people working there

422
00:16:18,399 --> 00:16:20,800
but as everybody knows tesla doesn't

423
00:16:20,800 --> 00:16:24,399
care a lot of people working there right

424
00:16:24,399 --> 00:16:27,360
so and actually this is a video that got

425
00:16:27,360 --> 00:16:30,720
presented in may and it's been a similar

426
00:16:30,720 --> 00:16:33,199
video two days earlier so that's part of

427
00:16:33,199 --> 00:16:35,279
your homework you have to watch that

428
00:16:35,279 --> 00:16:37,519
several times for the youtube algorithm

429
00:16:37,519 --> 00:16:40,959
please and it's about how you would pull

430
00:16:40,959 --> 00:16:42,800
off the

431
00:16:42,800 --> 00:16:45,680
relay attack i i will talk about that a

432
00:16:45,680 --> 00:16:47,440
little later

433
00:16:47,440 --> 00:16:50,639
and also there being able to do a relay

434
00:16:50,639 --> 00:16:52,800
kind of triggered me and said that's too

435
00:16:52,800 --> 00:16:55,040
easy right

436
00:16:55,040 --> 00:16:57,120
i contacted the buck bounty team at

437
00:16:57,120 --> 00:16:58,720
tesla again

438
00:16:58,720 --> 00:17:00,880
and told them that i believe this is an

439
00:17:00,880 --> 00:17:02,959
issue because what really happened i

440
00:17:02,959 --> 00:17:04,559
tried that the first day and i had like

441
00:17:04,559 --> 00:17:07,679
this two raspberry pies connected and i

442
00:17:07,679 --> 00:17:10,000
had one in the car trunk and one in my

443
00:17:10,000 --> 00:17:12,880
office and i was able to just drive

444
00:17:12,880 --> 00:17:14,959
around as long as in the office my phone

445
00:17:14,959 --> 00:17:17,359
was close to that

446
00:17:17,359 --> 00:17:19,919
relay right i was able to drive to

447
00:17:19,919 --> 00:17:22,079
salzburg like 20 kilometers away i

448
00:17:22,079 --> 00:17:24,480
always had my key card with me because i

449
00:17:24,480 --> 00:17:26,959
just as a fallback solution just to be

450
00:17:26,959 --> 00:17:30,000
able to drive it without the phone

451
00:17:30,000 --> 00:17:33,039
but thing was that was too easy because

452
00:17:33,039 --> 00:17:34,799
it was an attacker set up with two

453
00:17:34,799 --> 00:17:37,520
raspberry pi's like really really cheap

454
00:17:37,520 --> 00:17:39,600
and tesla says yeah

455
00:17:39,600 --> 00:17:42,320
it's a known limitation of the protocol

456
00:17:42,320 --> 00:17:45,120
but in order to be safe please use pin

457
00:17:45,120 --> 00:17:47,360
to drive which is a four digit

458
00:17:47,360 --> 00:17:49,360
numerical pin that you would have to

459
00:17:49,360 --> 00:17:51,600
enter before you are able to drive the

460
00:17:51,600 --> 00:17:52,799
car

461
00:17:52,799 --> 00:17:55,200
which does not really mitigate the risk

462
00:17:55,200 --> 00:17:57,280
of being rubbed right there's also a lot

463
00:17:57,280 --> 00:17:59,760
of stuff in the car which is unsafe in

464
00:17:59,760 --> 00:18:01,120
the end right

465
00:18:01,120 --> 00:18:04,720
but um also i had a similar attack and

466
00:18:04,720 --> 00:18:06,960
also i tried to present that at pound to

467
00:18:06,960 --> 00:18:09,600
own and they said no it's out of scope

468
00:18:09,600 --> 00:18:11,280
because it's not

469
00:18:11,280 --> 00:18:13,520
it's not too binary or it's like you

470
00:18:13,520 --> 00:18:15,600
have to have a key for that and we don't

471
00:18:15,600 --> 00:18:17,919
even have that

472
00:18:17,919 --> 00:18:19,440
right

473
00:18:19,440 --> 00:18:22,080
so and i i was interested then so what

474
00:18:22,080 --> 00:18:24,160
are the security features that you have

475
00:18:24,160 --> 00:18:26,720
enabled in your car is it one

476
00:18:26,720 --> 00:18:27,520
none

477
00:18:27,520 --> 00:18:30,559
is it two sentry mode is it three pin to

478
00:18:30,559 --> 00:18:34,480
drive or is it for both so one non who

479
00:18:34,480 --> 00:18:36,559
has none you have no none of these

480
00:18:36,559 --> 00:18:37,840
features

481
00:18:37,840 --> 00:18:39,520
all right two

482
00:18:39,520 --> 00:18:42,880
sentry mode who's using that

483
00:18:42,880 --> 00:18:44,880
all right one and

484
00:18:44,880 --> 00:18:48,400
who's using pin to drive

485
00:18:48,559 --> 00:18:50,799
one two yeah quite some

486
00:18:50,799 --> 00:18:52,240
and both

487
00:18:52,240 --> 00:18:54,640
send remote and pin to drive

488
00:18:54,640 --> 00:18:56,480
all right so that's a little bit of a

489
00:18:56,480 --> 00:18:58,320
trick question because twitter only

490
00:18:58,320 --> 00:19:01,120
allows one answer so combine the the

491
00:19:01,120 --> 00:19:04,080
lower two showed that only one third is

492
00:19:04,080 --> 00:19:06,240
protecting the car with pin to drive

493
00:19:06,240 --> 00:19:08,720
that means like in many cases attackers

494
00:19:08,720 --> 00:19:10,960
would be able to drive your car away

495
00:19:10,960 --> 00:19:14,080
just by doing a relay

496
00:19:15,760 --> 00:19:17,919
and for some reason sometimes this other

497
00:19:17,919 --> 00:19:19,840
raspberry pi on the picture disappears

498
00:19:19,840 --> 00:19:21,679
it's libreoffice i don't know why that

499
00:19:21,679 --> 00:19:22,720
is

500
00:19:22,720 --> 00:19:25,600
but that was the setup for the thing so

501
00:19:25,600 --> 00:19:27,520
to the left side you see the phone then

502
00:19:27,520 --> 00:19:29,280
you see the raspberry pi number one

503
00:19:29,280 --> 00:19:31,600
which is running attacker on the right

504
00:19:31,600 --> 00:19:33,039
hand side there would have been the

505
00:19:33,039 --> 00:19:34,960
other raspberry pi also with a bluetooth

506
00:19:34,960 --> 00:19:38,080
dongle and talking to the car right

507
00:19:38,080 --> 00:19:39,919
gateker allows you to see all the

508
00:19:39,919 --> 00:19:42,160
messages flying by there like hex

509
00:19:42,160 --> 00:19:43,760
encoded bytes

510
00:19:43,760 --> 00:19:46,240
uh stuff right which didn't make a lot

511
00:19:46,240 --> 00:19:48,320
of sense but you could intercept that

512
00:19:48,320 --> 00:19:50,160
and you could also inspect that and

513
00:19:50,160 --> 00:19:52,799
inject that and you could some do some

514
00:19:52,799 --> 00:19:53,600
on

515
00:19:53,600 --> 00:19:55,760
real-time modification of the stuff you

516
00:19:55,760 --> 00:19:56,880
see

517
00:19:56,880 --> 00:19:59,200
but it started making sense when i was

518
00:19:59,200 --> 00:20:00,880
digging a little into that and i said

519
00:20:00,880 --> 00:20:02,640
there's these characteristics and can

520
00:20:02,640 --> 00:20:05,280
pretty much tell that this one is like

521
00:20:05,280 --> 00:20:07,039
in direction of the car and the other

522
00:20:07,039 --> 00:20:09,280
one comes from the car

523
00:20:09,280 --> 00:20:11,280
but what really turned out to be

524
00:20:11,280 --> 00:20:13,760
happening there there was a protocol and

525
00:20:13,760 --> 00:20:16,159
that's the vc sac protocol

526
00:20:16,159 --> 00:20:18,720
and that's a protobuf-based bot protocol

527
00:20:18,720 --> 00:20:21,679
and um you found it's easy to have found

528
00:20:21,679 --> 00:20:24,240
like indications that this is used for

529
00:20:24,240 --> 00:20:25,039
that

530
00:20:25,039 --> 00:20:28,000
and it's it's used for phone key key fob

531
00:20:28,000 --> 00:20:30,720
for the tire pressure subsystem

532
00:20:30,720 --> 00:20:32,880
maybe for uh back-end communication

533
00:20:32,880 --> 00:20:34,320
because there's some messages in there

534
00:20:34,320 --> 00:20:36,799
that would imply that and also maybe for

535
00:20:36,799 --> 00:20:39,520
other use cases

536
00:20:39,520 --> 00:20:40,320
so

537
00:20:40,320 --> 00:20:43,440
it started in app version 335 and you

538
00:20:43,440 --> 00:20:45,039
have to see that the tesla app the

539
00:20:45,039 --> 00:20:47,039
official tester app is for a lot of more

540
00:20:47,039 --> 00:20:49,120
products than just for the model three

541
00:20:49,120 --> 00:20:51,440
so that's why it's not version one so

542
00:20:51,440 --> 00:20:53,200
they use it for the power wall they use

543
00:20:53,200 --> 00:20:55,120
it for s and x and all the models of the

544
00:20:55,120 --> 00:20:58,320
car and also now for the model three and

545
00:20:58,320 --> 00:20:59,120
why

546
00:20:59,120 --> 00:21:00,799
that have that phone key feature and

547
00:21:00,799 --> 00:21:02,640
that way this is

548
00:21:02,640 --> 00:21:06,799
just been introduced in april 2018

549
00:21:06,799 --> 00:21:09,760
and i said this protobuf file which is

550
00:21:09,760 --> 00:21:12,080
like a description of the protocol was

551
00:21:12,080 --> 00:21:14,799
really easy to instruct with the pbtk

552
00:21:14,799 --> 00:21:17,039
tool in the beginning but they made that

553
00:21:17,039 --> 00:21:18,720
a little bit harder with version four

554
00:21:18,720 --> 00:21:21,280
when they switched library to to wire

555
00:21:21,280 --> 00:21:23,679
which is also the same kind of protobuf

556
00:21:23,679 --> 00:21:25,679
implementation but just by another

557
00:21:25,679 --> 00:21:28,159
vendor and different regime because

558
00:21:28,159 --> 00:21:31,280
protobuf is google right and

559
00:21:31,280 --> 00:21:33,919
it has a very similar output and i'm

560
00:21:33,919 --> 00:21:35,360
going to show you a little more of these

561
00:21:35,360 --> 00:21:36,799
messages soon

562
00:21:36,799 --> 00:21:39,600
so i said this is the history so i just

563
00:21:39,600 --> 00:21:42,159
took like one protocol file of each

564
00:21:42,159 --> 00:21:44,080
version and you see there's quite some

565
00:21:44,080 --> 00:21:46,480
growth over time at the moment is i

566
00:21:46,480 --> 00:21:48,240
think this is not even up to date

567
00:21:48,240 --> 00:21:50,799
anymore so it's been two months or two

568
00:21:50,799 --> 00:21:52,799
and a half months since there

569
00:21:52,799 --> 00:21:56,559
77 messages 45 enums which i craft out

570
00:21:56,559 --> 00:21:59,919
on this really small small small image

571
00:21:59,919 --> 00:22:01,120
the blue

572
00:22:01,120 --> 00:22:02,480
things are the things that are

573
00:22:02,480 --> 00:22:04,400
referenced in the code on the android

574
00:22:04,400 --> 00:22:06,799
app because that was easy to find out so

575
00:22:06,799 --> 00:22:09,280
what's actually active code use

576
00:22:09,280 --> 00:22:11,280
and these of course were the interesting

577
00:22:11,280 --> 00:22:12,880
bits to look at

578
00:22:12,880 --> 00:22:13,760
and

579
00:22:13,760 --> 00:22:16,080
also like if you see and that's like the

580
00:22:16,080 --> 00:22:18,480
first example here

581
00:22:18,480 --> 00:22:20,880
you see like with the green prefix this

582
00:22:20,880 --> 00:22:23,200
is the length of the thing

583
00:22:23,200 --> 00:22:24,159
coming

584
00:22:24,159 --> 00:22:26,480
and it's not easy just to modify the

585
00:22:26,480 --> 00:22:28,240
length and do some buffer overflow so

586
00:22:28,240 --> 00:22:30,880
this is optional right but there from

587
00:22:30,880 --> 00:22:31,840
there on

588
00:22:31,840 --> 00:22:35,039
there the message is encoded and having

589
00:22:35,039 --> 00:22:37,120
that proto file that you were able to

590
00:22:37,120 --> 00:22:39,440
extract and now is also like available

591
00:22:39,440 --> 00:22:41,919
in the vc seg archive on github

592
00:22:41,919 --> 00:22:43,760
you can decode that message with the

593
00:22:43,760 --> 00:22:45,679
product tool

594
00:22:45,679 --> 00:22:47,679
and what's happening is like one of the

595
00:22:47,679 --> 00:22:50,080
easiest requests is to see

596
00:22:50,080 --> 00:22:51,919
what are the whitelisted keys in that

597
00:22:51,919 --> 00:22:53,760
vehicle and that's an information

598
00:22:53,760 --> 00:22:55,600
request and you do not have to be

599
00:22:55,600 --> 00:22:57,919
authenticated for that it tells you all

600
00:22:57,919 --> 00:23:00,880
the key ids and you could also get the

601
00:23:00,880 --> 00:23:02,240
the um

602
00:23:02,240 --> 00:23:04,640
the public keys of the of the enrolled

603
00:23:04,640 --> 00:23:06,559
keys which is not a big deal because

604
00:23:06,559 --> 00:23:08,559
it's a public key half but what's

605
00:23:08,559 --> 00:23:10,799
interesting to have seen is that there

606
00:23:10,799 --> 00:23:12,720
is a service key in every vehicle you

607
00:23:12,720 --> 00:23:14,640
can like use it and it looks like from

608
00:23:14,640 --> 00:23:19,039
the signature as if it was an nfc key

609
00:23:19,039 --> 00:23:22,159
and this nfc key has a public key that

610
00:23:22,159 --> 00:23:24,480
did not change a lot so i think for

611
00:23:24,480 --> 00:23:26,400
years and years they're using the same

612
00:23:26,400 --> 00:23:28,320
service key which makes it a little bit

613
00:23:28,320 --> 00:23:30,880
of a risk that once one of these service

614
00:23:30,880 --> 00:23:31,840
keys

615
00:23:31,840 --> 00:23:34,400
surfaces on ebay this is going to be a

616
00:23:34,400 --> 00:23:36,720
problem but this is not what we are

617
00:23:36,720 --> 00:23:39,760
talking about so we have like also

618
00:23:39,760 --> 00:23:42,960
uh nfc keys the ones that you get as an

619
00:23:42,960 --> 00:23:45,279
owner these are looking like that they

620
00:23:45,279 --> 00:23:47,520
do not have a crypto counter

621
00:23:47,520 --> 00:23:49,840
the phone key does have a crypto counter

622
00:23:49,840 --> 00:23:51,760
is a rolling key thing

623
00:23:51,760 --> 00:23:53,840
and that has to do with being able to

624
00:23:53,840 --> 00:23:56,159
have the passive unlock functions

625
00:23:56,159 --> 00:23:58,720
enabled so like without touching your

626
00:23:58,720 --> 00:24:01,279
phone you would be able to enter the car

627
00:24:01,279 --> 00:24:04,799
like in any other keyless systems

628
00:24:04,799 --> 00:24:06,640
and that's what a key fob would look

629
00:24:06,640 --> 00:24:09,360
like on that level

630
00:24:09,360 --> 00:24:10,880
of course these

631
00:24:10,880 --> 00:24:13,039
whitelist entries are connected with

632
00:24:13,039 --> 00:24:15,760
roles that imply permissions and the

633
00:24:15,760 --> 00:24:17,679
service key would have all of the

634
00:24:17,679 --> 00:24:19,440
permissions all the nine permissions

635
00:24:19,440 --> 00:24:21,679
that are defined in the protocol are

636
00:24:21,679 --> 00:24:23,600
given to the service key makes a lot of

637
00:24:23,600 --> 00:24:26,080
sense and usually as a phone you just

638
00:24:26,080 --> 00:24:28,799
have four of those it would be the local

639
00:24:28,799 --> 00:24:31,600
drive local unlock lock and the remote

640
00:24:31,600 --> 00:24:33,600
unlock and remote drive

641
00:24:33,600 --> 00:24:35,760
the nfc cards also have the permissions

642
00:24:35,760 --> 00:24:39,279
of adding stuff to the whitelist because

643
00:24:39,279 --> 00:24:41,520
it's got a it's necessary once you have

644
00:24:41,520 --> 00:24:43,679
that nfc card you use it in order to

645
00:24:43,679 --> 00:24:46,799
whitelist your key

646
00:24:46,799 --> 00:24:49,039
and there's a message type from vcsac

647
00:24:49,039 --> 00:24:50,960
which is pretty comprehensive because it

648
00:24:50,960 --> 00:24:53,200
contains all the kind of submerged

649
00:24:53,200 --> 00:24:55,440
message types that are possible to be

650
00:24:55,440 --> 00:24:58,080
sent from the car to your phone

651
00:24:58,080 --> 00:25:00,480
and of course there's also like one of

652
00:25:00,480 --> 00:25:02,960
the most common examples you see

653
00:25:02,960 --> 00:25:04,960
authentication request here that's

654
00:25:04,960 --> 00:25:07,279
whenever you pull the handle

655
00:25:07,279 --> 00:25:09,279
it's from vc second you message to your

656
00:25:09,279 --> 00:25:11,039
phone and you would have to answer it

657
00:25:11,039 --> 00:25:13,600
correctly for the car to unlock

658
00:25:13,600 --> 00:25:15,840
and also there's like a command status a

659
00:25:15,840 --> 00:25:17,360
vehicle status where it tells you

660
00:25:17,360 --> 00:25:19,360
whether it's locked or unlocked stuff

661
00:25:19,360 --> 00:25:21,440
like that and then the other side of the

662
00:25:21,440 --> 00:25:24,559
spectrum you have the 2vcs message

663
00:25:24,559 --> 00:25:27,440
message which embeds all kind of stuff

664
00:25:27,440 --> 00:25:30,240
so unsigned messages come also in a few

665
00:25:30,240 --> 00:25:31,760
different things

666
00:25:31,760 --> 00:25:34,960
and these are used for messages without

667
00:25:34,960 --> 00:25:37,840
a direct security context but are also

668
00:25:37,840 --> 00:25:40,960
used in order to encapsulate messages in

669
00:25:40,960 --> 00:25:43,520
a signed message that do have a security

670
00:25:43,520 --> 00:25:44,880
context

671
00:25:44,880 --> 00:25:46,880
and that's some assigned message there

672
00:25:46,880 --> 00:25:49,279
and as the name implies you've got to

673
00:25:49,279 --> 00:25:51,279
have cryptographic keys in order to do

674
00:25:51,279 --> 00:25:54,080
that and vcsec uses asymmetric keys

675
00:25:54,080 --> 00:25:56,559
based on the elliptic curve cryptography

676
00:25:56,559 --> 00:25:59,279
key pairs and that's like the open ssl

677
00:25:59,279 --> 00:26:01,120
command in order to generate a key for

678
00:26:01,120 --> 00:26:03,039
that yourself

679
00:26:03,039 --> 00:26:05,279
and what then happens once you whitelist

680
00:26:05,279 --> 00:26:07,360
that key and you know the protocol you

681
00:26:07,360 --> 00:26:10,240
would have to tap your nfc card but then

682
00:26:10,240 --> 00:26:12,960
a shared secret is derived by the tiffy

683
00:26:12,960 --> 00:26:15,279
helmet key protocol and then you can use

684
00:26:15,279 --> 00:26:17,200
your key with the car once it's right

685
00:26:17,200 --> 00:26:20,159
listed and send signed messages to it so

686
00:26:20,159 --> 00:26:22,480
that was a lot of guesswork but i

687
00:26:22,480 --> 00:26:25,279
finally got that working and the crypto

688
00:26:25,279 --> 00:26:27,279
algorithm used for the

689
00:26:27,279 --> 00:26:30,640
whole process is the galway counter mode

690
00:26:30,640 --> 00:26:33,600
with associated data it's best known

691
00:26:33,600 --> 00:26:36,159
from ssh because it's a really stable

692
00:26:36,159 --> 00:26:38,159
implementation it's really secure and

693
00:26:38,159 --> 00:26:42,159
it's a very good match for the use case

694
00:26:42,159 --> 00:26:44,240
it implements a rolling code so you have

695
00:26:44,240 --> 00:26:46,240
the crypto counter that always has to

696
00:26:46,240 --> 00:26:48,400
increase and then you have additional

697
00:26:48,400 --> 00:26:50,720
data which is used as a challenge

698
00:26:50,720 --> 00:26:55,360
response for the passive entry functions

699
00:26:55,360 --> 00:26:56,880
and

700
00:26:56,880 --> 00:26:59,120
it's intending to

701
00:26:59,120 --> 00:27:01,360
prevent replay attacks of course

702
00:27:01,360 --> 00:27:03,600
also the rolling code

703
00:27:03,600 --> 00:27:05,760
there's some differences though the

704
00:27:05,760 --> 00:27:09,760
shared stickers is 16 octets but the

705
00:27:09,760 --> 00:27:12,000
invocation counter or the crypto counter

706
00:27:12,000 --> 00:27:15,360
for the gcm usually is eight bytes

707
00:27:15,360 --> 00:27:18,640
tesla is using four bytes for that and

708
00:27:18,640 --> 00:27:21,120
that's also making sense because eight

709
00:27:21,120 --> 00:27:23,279
bytes if you see like every keystroke

710
00:27:23,279 --> 00:27:26,799
with ssh needs a next value and here

711
00:27:26,799 --> 00:27:28,640
like every signed message that you send

712
00:27:28,640 --> 00:27:31,520
to the car is like one counter up so

713
00:27:31,520 --> 00:27:33,279
it's like four bytes already a lot for

714
00:27:33,279 --> 00:27:34,480
that

715
00:27:34,480 --> 00:27:36,159
right and there's different

716
00:27:36,159 --> 00:27:39,120
signature types that also became become

717
00:27:39,120 --> 00:27:41,360
important later on so you have like ones

718
00:27:41,360 --> 00:27:44,080
of the gcm with and without a token or

719
00:27:44,080 --> 00:27:46,960
like the present key also as a signing

720
00:27:46,960 --> 00:27:49,039
method

721
00:27:49,039 --> 00:27:50,880
there's like different actions i don't

722
00:27:50,880 --> 00:27:52,880
go too much into detail here you can

723
00:27:52,880 --> 00:27:54,640
read that on the slides which are online

724
00:27:54,640 --> 00:27:56,720
already and also like in the vc sec

725
00:27:56,720 --> 00:27:58,399
project called archive

726
00:27:58,399 --> 00:27:59,760
different things

727
00:27:59,760 --> 00:28:01,840
signed message example you see there's a

728
00:28:01,840 --> 00:28:04,640
pro tool above message as bytes encoded

729
00:28:04,640 --> 00:28:07,440
in here then you see the signature type

730
00:28:07,440 --> 00:28:09,919
it has there's the signature key id

731
00:28:09,919 --> 00:28:12,240
things for the car to verify the phone

732
00:28:12,240 --> 00:28:14,720
i'm talking to possesses the secret key

733
00:28:14,720 --> 00:28:18,799
that i do know the public key of

734
00:28:18,960 --> 00:28:20,720
what can you do with that

735
00:28:20,720 --> 00:28:22,039
since

736
00:28:22,039 --> 00:28:24,720
unrestricted requests include that you

737
00:28:24,720 --> 00:28:26,720
can enumerate the keys you can see how

738
00:28:26,720 --> 00:28:28,799
many keys are enrolled for this device

739
00:28:28,799 --> 00:28:30,480
for this vehicle

740
00:28:30,480 --> 00:28:32,559
how many apple how many android devices

741
00:28:32,559 --> 00:28:34,640
are there how many nfcs

742
00:28:34,640 --> 00:28:36,880
you can find out about that

743
00:28:36,880 --> 00:28:38,080
and

744
00:28:38,080 --> 00:28:40,399
the process of whitelisting a key just

745
00:28:40,399 --> 00:28:42,320
requires you to have

746
00:28:42,320 --> 00:28:45,440
like that nfc card

747
00:28:45,440 --> 00:28:47,520
and usually you log into your tesla

748
00:28:47,520 --> 00:28:49,279
account so that's what the official app

749
00:28:49,279 --> 00:28:52,880
is doing and since you have like access

750
00:28:52,880 --> 00:28:55,279
to the owner api with your login you get

751
00:28:55,279 --> 00:28:58,080
a token you get the win identifiers for

752
00:28:58,080 --> 00:29:00,000
all the cars that you are permitted to

753
00:29:00,000 --> 00:29:02,320
lock and unlock

754
00:29:02,320 --> 00:29:04,240
and finally your app goes ahead and

755
00:29:04,240 --> 00:29:06,559
finds the vehicle and begins the white

756
00:29:06,559 --> 00:29:07,919
listing process

757
00:29:07,919 --> 00:29:10,080
it would send an information request and

758
00:29:10,080 --> 00:29:12,880
get like the public key of the car

759
00:29:12,880 --> 00:29:15,360
receives that and also then sends

760
00:29:15,360 --> 00:29:18,000
information requests to get the list of

761
00:29:18,000 --> 00:29:21,840
white listed keys then it tries or it it

762
00:29:21,840 --> 00:29:24,880
asks the owner to tap the key card

763
00:29:24,880 --> 00:29:28,720
and then with that authorization

764
00:29:28,720 --> 00:29:30,720
on the b pillar or fast care blade in

765
00:29:30,720 --> 00:29:31,840
the middle

766
00:29:31,840 --> 00:29:34,960
this car is getting in the car finally

767
00:29:34,960 --> 00:29:37,600
the the phone asks again show me again

768
00:29:37,600 --> 00:29:40,159
the white list of keys and once this key

769
00:29:40,159 --> 00:29:44,240
is on there the process is done

770
00:29:46,399 --> 00:29:48,399
and there you go with the authorization

771
00:29:48,399 --> 00:29:50,960
timer attack so out of convenience tessa

772
00:29:50,960 --> 00:29:53,919
decided in august last year that it

773
00:29:53,919 --> 00:29:57,360
would be really great if i was

774
00:29:57,440 --> 00:30:00,320
if i was like as a car owner

775
00:30:00,320 --> 00:30:02,399
tapping the nfc card would get in the

776
00:30:02,399 --> 00:30:03,679
car

777
00:30:03,679 --> 00:30:05,360
it would be so great for the owners

778
00:30:05,360 --> 00:30:07,360
using the nfc card just to be able to

779
00:30:07,360 --> 00:30:09,520
drive without any any further action

780
00:30:09,520 --> 00:30:11,360
without any further key card action

781
00:30:11,360 --> 00:30:12,159
right

782
00:30:12,159 --> 00:30:13,600
so what they introduced was the

783
00:30:13,600 --> 00:30:17,360
authorization timer 130 seconds that do

784
00:30:17,360 --> 00:30:20,320
not require an extra tab for that

785
00:30:20,320 --> 00:30:22,720
bad news because during this time frame

786
00:30:22,720 --> 00:30:24,480
attackers were able

787
00:30:24,480 --> 00:30:26,640
to also enroll their own key in your

788
00:30:26,640 --> 00:30:29,200
vehicle without you really

789
00:30:29,200 --> 00:30:30,720
noticing it right there was no

790
00:30:30,720 --> 00:30:32,880
indication on the screen and actually

791
00:30:32,880 --> 00:30:35,120
there's also a presentation in that

792
00:30:35,120 --> 00:30:37,200
video it's also linked on the trifonite

793
00:30:37,200 --> 00:30:38,399
page

794
00:30:38,399 --> 00:30:40,799
also homework please watch it several

795
00:30:40,799 --> 00:30:43,360
times and give it a thumb

796
00:30:43,360 --> 00:30:45,200
and this is about

797
00:30:45,200 --> 00:30:48,000
the staged thing where you can also

798
00:30:48,000 --> 00:30:51,440
force a user to use the nfc card because

799
00:30:51,440 --> 00:30:53,200
usually if you do have a phone you won't

800
00:30:53,200 --> 00:30:55,600
bother using your nfc card but there's

801
00:30:55,600 --> 00:30:58,159
some situations where you in the easiest

802
00:30:58,159 --> 00:31:01,840
case just use it a 2.4 gigahertz jamming

803
00:31:01,840 --> 00:31:04,640
jamming device and would just jam the

804
00:31:04,640 --> 00:31:06,640
frequency and the phone would disconnect

805
00:31:06,640 --> 00:31:09,120
and in order to get into the car you

806
00:31:09,120 --> 00:31:11,440
would have to use your nfc card for

807
00:31:11,440 --> 00:31:12,640
tapping it

808
00:31:12,640 --> 00:31:15,200
and there you go the the

809
00:31:15,200 --> 00:31:17,600
authorization timer attack would have

810
00:31:17,600 --> 00:31:19,519
become possible

811
00:31:19,519 --> 00:31:22,240
and owning a key on the device does

812
00:31:22,240 --> 00:31:24,880
allow you to lock and unlock the vehicle

813
00:31:24,880 --> 00:31:27,120
and to drive the vehicle

814
00:31:27,120 --> 00:31:28,480
but

815
00:31:28,480 --> 00:31:30,559
that's also when tesla said yeah use pin

816
00:31:30,559 --> 00:31:32,720
to drive so people with the key cannot

817
00:31:32,720 --> 00:31:34,960
drive your car they can rob everything

818
00:31:34,960 --> 00:31:36,640
from the interior but not driving

819
00:31:36,640 --> 00:31:37,840
because you have to enter that four

820
00:31:37,840 --> 00:31:39,440
digit key

821
00:31:39,440 --> 00:31:42,159
and that's when i did another video that

822
00:31:42,159 --> 00:31:45,440
shows how easy it is to bypass this pin

823
00:31:45,440 --> 00:31:48,880
entry just by sending that remote drive

824
00:31:48,880 --> 00:31:51,840
command to the car which intended was

825
00:31:51,840 --> 00:31:54,159
intended to be used in the summon

826
00:31:54,159 --> 00:31:55,760
feature where you can say like in the

827
00:31:55,760 --> 00:31:58,080
parking lot police car backed out of

828
00:31:58,080 --> 00:32:00,559
that really narrow space because i want

829
00:32:00,559 --> 00:32:02,320
to get into that

830
00:32:02,320 --> 00:32:03,600
and

831
00:32:03,600 --> 00:32:05,679
this pin to drive dialog just disappears

832
00:32:05,679 --> 00:32:08,480
when you send that command so

833
00:32:08,480 --> 00:32:10,799
tesla was not really happy about that

834
00:32:10,799 --> 00:32:12,880
information getting into public but

835
00:32:12,880 --> 00:32:14,559
right

836
00:32:14,559 --> 00:32:16,080
and then there's something else which is

837
00:32:16,080 --> 00:32:18,080
fun to play with tesla has a really

838
00:32:18,080 --> 00:32:21,519
broken authori uh trust model so i i put

839
00:32:21,519 --> 00:32:24,640
in here cartman there you know that

840
00:32:24,640 --> 00:32:26,799
and it's like that cars

841
00:32:26,799 --> 00:32:29,600
the tesla car always would say respect

842
00:32:29,600 --> 00:32:32,399
or torrija and then would not even

843
00:32:32,399 --> 00:32:33,519
ask

844
00:32:33,519 --> 00:32:34,880
that or

845
00:32:34,880 --> 00:32:37,360
so every message that is sent from the

846
00:32:37,360 --> 00:32:39,360
car to the phone

847
00:32:39,360 --> 00:32:41,679
is trusted by default so the car never

848
00:32:41,679 --> 00:32:44,240
has to prove to the phone that it's

849
00:32:44,240 --> 00:32:47,039
really the car right so this is an issue

850
00:32:47,039 --> 00:32:48,720
the other way around of course the phone

851
00:32:48,720 --> 00:32:51,760
would always have to prove by by signing

852
00:32:51,760 --> 00:32:53,360
a message it would have to prove i'm the

853
00:32:53,360 --> 00:32:57,679
real device right but not vice versa

854
00:32:57,679 --> 00:33:00,399
and of course that's like the next step

855
00:33:00,399 --> 00:33:03,279
was how to emulate it a a car

856
00:33:03,279 --> 00:33:05,679
so the phones will talk to me instead of

857
00:33:05,679 --> 00:33:06,799
the car

858
00:33:06,799 --> 00:33:08,720
and of course you would have to expose

859
00:33:08,720 --> 00:33:10,960
an iep construction like the car also

860
00:33:10,960 --> 00:33:12,880
would do and then it was a little bit

861
00:33:12,880 --> 00:33:14,720
tricky because you would use the

862
00:33:14,720 --> 00:33:17,360
extended inquiry

863
00:33:17,360 --> 00:33:19,600
format in order to

864
00:33:19,600 --> 00:33:22,880
the extended enquiry response which is

865
00:33:22,880 --> 00:33:25,600
not easy to do with the blue blue z d

866
00:33:25,600 --> 00:33:28,960
bus api which i was first trying to use

867
00:33:28,960 --> 00:33:29,919
there

868
00:33:29,919 --> 00:33:32,320
i ended up using

869
00:33:32,320 --> 00:33:34,320
a python library

870
00:33:34,320 --> 00:33:36,720
which is able to do that and there you

871
00:33:36,720 --> 00:33:40,080
go and you can look like that test the

872
00:33:40,080 --> 00:33:42,960
car and you also would have to use a bd

873
00:33:42,960 --> 00:33:44,080
address

874
00:33:44,080 --> 00:33:45,679
and set your bluetooth address

875
00:33:45,679 --> 00:33:47,120
accordingly

876
00:33:47,120 --> 00:33:49,440
but once you did that any phone would

877
00:33:49,440 --> 00:33:51,760
talk to you thinking you're the car

878
00:33:51,760 --> 00:33:53,279
and since you never have to prove you

879
00:33:53,279 --> 00:33:54,480
are the car

880
00:33:54,480 --> 00:33:57,600
you can tell it

881
00:33:57,600 --> 00:34:00,240
like hey your key is not valid anymore

882
00:34:00,240 --> 00:34:03,120
so once i the the phone would connect i

883
00:34:03,120 --> 00:34:04,840
would say please send me an

884
00:34:04,840 --> 00:34:06,799
authorization and the phone would go

885
00:34:06,799 --> 00:34:09,040
ahead send that or with authorization

886
00:34:09,040 --> 00:34:12,560
next thing happening the car says

887
00:34:12,560 --> 00:34:15,199
sorry you're not on the list it's like a

888
00:34:15,199 --> 00:34:17,440
bouncer at the disco right

889
00:34:17,440 --> 00:34:19,918
and the problem would go ahead and say

890
00:34:19,918 --> 00:34:21,918
show me the guest list i'm sure i'm on

891
00:34:21,918 --> 00:34:24,239
there and the bouncer would go

892
00:34:24,239 --> 00:34:27,359
see it's an almost empty guest list

893
00:34:27,359 --> 00:34:28,639
you're not there

894
00:34:28,639 --> 00:34:30,719
and then the phone is convinced and says

895
00:34:30,719 --> 00:34:33,199
right i dropped the key and i say

896
00:34:33,199 --> 00:34:35,918
goodbye you i don't bother you anymore

897
00:34:35,918 --> 00:34:38,879
and that's how the key drop attack works

898
00:34:38,879 --> 00:34:40,879
users locked out would have to use the

899
00:34:40,879 --> 00:34:42,960
nfc card in order to get back into the

900
00:34:42,960 --> 00:34:45,119
car which opens that window of that

901
00:34:45,119 --> 00:34:47,119
authorization attack where attackers

902
00:34:47,119 --> 00:34:48,960
could put their key in the in the car

903
00:34:48,960 --> 00:34:51,440
right again it's like a little tricky so

904
00:34:51,440 --> 00:34:53,839
be careful when having like issues like

905
00:34:53,839 --> 00:34:55,520
that

906
00:34:55,520 --> 00:34:58,160
but turned out that the key that was

907
00:34:58,160 --> 00:34:59,280
stored

908
00:34:59,280 --> 00:35:02,240
in the device in your phone was not

909
00:35:02,240 --> 00:35:04,240
really deleted so

910
00:35:04,240 --> 00:35:06,160
it was dropped but it was not really

911
00:35:06,160 --> 00:35:08,400
deleted that means next time you talk to

912
00:35:08,400 --> 00:35:10,880
the car it would be clear in a short

913
00:35:10,880 --> 00:35:12,640
time that the car

914
00:35:12,640 --> 00:35:14,240
knows the

915
00:35:14,240 --> 00:35:16,640
the key and your phone still knows the

916
00:35:16,640 --> 00:35:19,440
key so it's kind of a soft red

917
00:35:19,440 --> 00:35:21,440
restoration and not a full key

918
00:35:21,440 --> 00:35:23,839
enrollment so again

919
00:35:23,839 --> 00:35:25,780
this could be attacked

920
00:35:25,780 --> 00:35:27,359
[Music]

921
00:35:27,359 --> 00:35:30,320
by oh there's a small demo i will skip

922
00:35:30,320 --> 00:35:32,800
that this just shows how the tool works

923
00:35:32,800 --> 00:35:35,280
in order to drop the key of a car pretty

924
00:35:35,280 --> 00:35:37,599
easy here with the evil bit this is not

925
00:35:37,599 --> 00:35:40,640
anymore in the in the current version

926
00:35:40,640 --> 00:35:42,640
so it's like a little different naming

927
00:35:42,640 --> 00:35:44,720
there but you see how you present that

928
00:35:44,720 --> 00:35:46,960
car with that almost empty guest list in

929
00:35:46,960 --> 00:35:51,119
a way and the phone just disconnects

930
00:35:51,119 --> 00:35:53,440
so but there's a new attack as well

931
00:35:53,440 --> 00:35:55,920
that's new for this conference here it's

932
00:35:55,920 --> 00:35:58,400
the crypto counter confusion attack and

933
00:35:58,400 --> 00:36:00,000
the thing is that

934
00:36:00,000 --> 00:36:02,320
you cannot only tell the phone that

935
00:36:02,320 --> 00:36:04,480
you're not on the guest list sorry you

936
00:36:04,480 --> 00:36:07,200
could also say well that crypto counter

937
00:36:07,200 --> 00:36:08,960
you used is a little bit

938
00:36:08,960 --> 00:36:12,880
smaller than expected i could make up an

939
00:36:12,880 --> 00:36:15,599
analogy story for that shorter than

940
00:36:15,599 --> 00:36:18,400
smaller than expected i don't do that

941
00:36:18,400 --> 00:36:20,000
so

942
00:36:20,000 --> 00:36:22,000
the phone key will ask

943
00:36:22,000 --> 00:36:24,160
and when you tell it right so this

944
00:36:24,160 --> 00:36:26,320
crypto value is too little too small

945
00:36:26,320 --> 00:36:28,000
because it's not allowed to roll back

946
00:36:28,000 --> 00:36:30,960
that counter for for a reason

947
00:36:30,960 --> 00:36:32,640
and tess is really strict with that and

948
00:36:32,640 --> 00:36:34,960
does not allow the crypto

949
00:36:34,960 --> 00:36:36,960
counter to be lower than last time

950
00:36:36,960 --> 00:36:39,119
because of replay attacks

951
00:36:39,119 --> 00:36:41,280
and of course there's also confusion

952
00:36:41,280 --> 00:36:43,839
going on so the phone app will ask the

953
00:36:43,839 --> 00:36:46,560
card so all right it's smaller value as

954
00:36:46,560 --> 00:36:48,720
you expected so what is the value that i

955
00:36:48,720 --> 00:36:50,880
should use in order to send you signed

956
00:36:50,880 --> 00:36:52,400
messages

957
00:36:52,400 --> 00:36:55,599
and the phone uh the vehicle or the fake

958
00:36:55,599 --> 00:36:57,119
vehicle would say

959
00:36:57,119 --> 00:36:57,920
well

960
00:36:57,920 --> 00:37:01,200
how about 4.2 billion

961
00:37:01,200 --> 00:37:03,599
and that works right you can set all the

962
00:37:03,599 --> 00:37:06,960
32 bit value to to the maximum

963
00:37:06,960 --> 00:37:09,359
and that is putting also some trouble

964
00:37:09,359 --> 00:37:11,839
onto the owners because as you know the

965
00:37:11,839 --> 00:37:14,160
key is not deleted even when you say in

966
00:37:14,160 --> 00:37:15,680
the app or right i delete the key

967
00:37:15,680 --> 00:37:18,000
re-enroll it it's still in there and the

968
00:37:18,000 --> 00:37:19,839
counter is still that high

969
00:37:19,839 --> 00:37:20,640
so

970
00:37:20,640 --> 00:37:22,240
usually the owner would have to

971
00:37:22,240 --> 00:37:24,160
reinstall the app in order to get rid of

972
00:37:24,160 --> 00:37:26,560
that old key and been able to enroll a

973
00:37:26,560 --> 00:37:29,760
new key for the same car

974
00:37:29,760 --> 00:37:32,000
and if you combine that with the key

975
00:37:32,000 --> 00:37:34,960
drop attack this is even faster so it

976
00:37:34,960 --> 00:37:37,119
really is a mess at the moment so the

977
00:37:37,119 --> 00:37:39,599
state model of the car just do not play

978
00:37:39,599 --> 00:37:41,599
very well with that

979
00:37:41,599 --> 00:37:42,960
and

980
00:37:42,960 --> 00:37:45,839
it's funny to have seen that the ios app

981
00:37:45,839 --> 00:37:48,720
allows a maximum value of 4.29

982
00:37:48,720 --> 00:37:52,480
an unsigned in 32 but the android app is

983
00:37:52,480 --> 00:37:54,880
using a signed in for that verification

984
00:37:54,880 --> 00:37:57,920
so just half of the value is allowed as

985
00:37:57,920 --> 00:38:01,280
a maximum value to tell the phone to be

986
00:38:01,280 --> 00:38:03,839
using the next

987
00:38:03,839 --> 00:38:05,680
and what's what's happening if it's at

988
00:38:05,680 --> 00:38:07,760
the highest value so the counter cannot

989
00:38:07,760 --> 00:38:10,000
be increased anymore so the phone is no

990
00:38:10,000 --> 00:38:12,480
longer able to send signed messages it's

991
00:38:12,480 --> 00:38:16,960
pretty much useless for that purpose

992
00:38:16,960 --> 00:38:20,079
but if you have if you really de-install

993
00:38:20,079 --> 00:38:22,560
the app reinstall that have a new key

994
00:38:22,560 --> 00:38:24,640
enrolled with the white listing process

995
00:38:24,640 --> 00:38:26,240
of course you expose yourself there

996
00:38:26,240 --> 00:38:28,800
again but also if there's two devices

997
00:38:28,800 --> 00:38:31,119
with the exact same name which usually

998
00:38:31,119 --> 00:38:33,200
doesn't happen in teslas when you enroll

999
00:38:33,200 --> 00:38:36,480
keys i observed that every time i unlock

1000
00:38:36,480 --> 00:38:39,599
the car with my new key which has the

1001
00:38:39,599 --> 00:38:41,520
same name there seems to be some

1002
00:38:41,520 --> 00:38:43,839
security mechanism to be kicking in

1003
00:38:43,839 --> 00:38:46,079
because what the car then does is for

1004
00:38:46,079 --> 00:38:49,119
some reason it asks me to tap my nfc

1005
00:38:49,119 --> 00:38:52,000
card on the b-pillar in order to drive

1006
00:38:52,000 --> 00:38:54,800
there you go key injection again so this

1007
00:38:54,800 --> 00:38:57,520
is opening up again that vector that

1008
00:38:57,520 --> 00:38:59,200
every time the owner gets in the car

1009
00:38:59,200 --> 00:39:01,599
once the drive has to tap the nfc card

1010
00:39:01,599 --> 00:39:03,200
the attacker could enroll a new key

1011
00:39:03,200 --> 00:39:04,079
again

1012
00:39:04,079 --> 00:39:07,920
so this is not good in a way

1013
00:39:08,000 --> 00:39:08,960
and

1014
00:39:08,960 --> 00:39:11,359
this is another example for a message

1015
00:39:11,359 --> 00:39:13,280
here it's when

1016
00:39:13,280 --> 00:39:16,079
the car wants to know like about the

1017
00:39:16,079 --> 00:39:19,280
current counter value so where the the

1018
00:39:19,280 --> 00:39:22,160
the temporary tool would say is like 4.2

1019
00:39:22,160 --> 00:39:24,480
billion what else does it tell you it

1020
00:39:24,480 --> 00:39:26,800
tells you about the token which is used

1021
00:39:26,800 --> 00:39:28,640
for that

1022
00:39:28,640 --> 00:39:31,440
passive entry

1023
00:39:32,160 --> 00:39:34,720
a passive entry thing right so

1024
00:39:34,720 --> 00:39:37,598
i said earlier

1025
00:39:37,680 --> 00:39:40,000
passive entry is relying on a challenge

1026
00:39:40,000 --> 00:39:41,520
response scheme

1027
00:39:41,520 --> 00:39:44,960
so it would ask for authorization at the

1028
00:39:44,960 --> 00:39:47,920
car the car would then reply back with

1029
00:39:47,920 --> 00:39:49,839
the correct counter number

1030
00:39:49,839 --> 00:39:51,200
and also

1031
00:39:51,200 --> 00:39:52,720
within

1032
00:39:52,720 --> 00:39:54,880
with the challenge which is in the token

1033
00:39:54,880 --> 00:39:58,720
here built into the answer so that means

1034
00:39:58,720 --> 00:39:59,920
whenever

1035
00:39:59,920 --> 00:40:04,319
the car asks me to do the passive entry

1036
00:40:04,319 --> 00:40:06,560
the phone would use that encrypt the

1037
00:40:06,560 --> 00:40:08,640
answer so there you go challenge

1038
00:40:08,640 --> 00:40:11,359
response and of course this relies or

1039
00:40:11,359 --> 00:40:13,200
this process relies not only on the

1040
00:40:13,200 --> 00:40:15,680
counter being increasing but also about

1041
00:40:15,680 --> 00:40:18,079
the token being changed very often

1042
00:40:18,079 --> 00:40:21,359
because once this token is not changing

1043
00:40:21,359 --> 00:40:24,480
you can just take that and be offline

1044
00:40:24,480 --> 00:40:25,520
and ask

1045
00:40:25,520 --> 00:40:27,359
be the evil car again

1046
00:40:27,359 --> 00:40:29,040
and ask the car

1047
00:40:29,040 --> 00:40:32,079
for authorization responses

1048
00:40:32,079 --> 00:40:34,079
and that's what the authorization replay

1049
00:40:34,079 --> 00:40:36,319
attack or key extra or authorization

1050
00:40:36,319 --> 00:40:40,160
response extract extraction attack does

1051
00:40:40,160 --> 00:40:43,200
it's just that so you get that token

1052
00:40:43,200 --> 00:40:45,200
from the vehicle and then you go to a

1053
00:40:45,200 --> 00:40:47,680
restaurant wherever this owner sits or

1054
00:40:47,680 --> 00:40:49,520
in the airport

1055
00:40:49,520 --> 00:40:51,520
and you ask and you just pretend to be

1056
00:40:51,520 --> 00:40:53,599
the car again and you keep asking the

1057
00:40:53,599 --> 00:40:56,000
phone for authorization responses with

1058
00:40:56,000 --> 00:40:57,839
that token that you have in the car

1059
00:40:57,839 --> 00:40:59,839
because it turned out it doesn't change

1060
00:40:59,839 --> 00:41:02,560
over days so it's really a long time

1061
00:41:02,560 --> 00:41:04,000
same token

1062
00:41:04,000 --> 00:41:06,000
pretty bad right and then what you do

1063
00:41:06,000 --> 00:41:07,520
you collect these authorization

1064
00:41:07,520 --> 00:41:10,319
responses via the temporary tool

1065
00:41:10,319 --> 00:41:12,960
a temporary tool and then you dispense

1066
00:41:12,960 --> 00:41:14,880
it with a temporary tool both these

1067
00:41:14,880 --> 00:41:17,280
tools are on github by the way

1068
00:41:17,280 --> 00:41:19,359
so that's that's how easy that would

1069
00:41:19,359 --> 00:41:21,200
work

1070
00:41:21,200 --> 00:41:23,920
and that's been it for the new attacks

1071
00:41:23,920 --> 00:41:25,760
and of course there's some tools and

1072
00:41:25,760 --> 00:41:28,079
resources on github during the talk i

1073
00:41:28,079 --> 00:41:30,640
was mentioning the vcseg archive a

1074
00:41:30,640 --> 00:41:32,720
collection of all the protofiles

1075
00:41:32,720 --> 00:41:34,480
extracted so far

1076
00:41:34,480 --> 00:41:36,400
there's like

1077
00:41:36,400 --> 00:41:39,760
the temporary tool where you temporarily

1078
00:41:39,760 --> 00:41:41,760
impersonate a tester and do like stuff

1079
00:41:41,760 --> 00:41:43,760
like the key drop attack and the crypto

1080
00:41:43,760 --> 00:41:46,319
counter tag and you can also you see

1081
00:41:46,319 --> 00:41:48,880
like the message you receive

1082
00:41:48,880 --> 00:41:51,760
encoded like to human readable form

1083
00:41:51,760 --> 00:41:54,079
so it's pretty neat maybe if you need

1084
00:41:54,079 --> 00:41:55,119
help

1085
00:41:55,119 --> 00:41:57,440
just contact me and of course the other

1086
00:41:57,440 --> 00:41:59,520
side the vc set line would be the

1087
00:41:59,520 --> 00:42:01,200
tempora tool

1088
00:42:01,200 --> 00:42:02,400
and

1089
00:42:02,400 --> 00:42:04,400
you use that in order to send messages

1090
00:42:04,400 --> 00:42:06,560
to the car that you craft yourself

1091
00:42:06,560 --> 00:42:08,240
there's also some

1092
00:42:08,240 --> 00:42:09,920
authorization collection mode

1093
00:42:09,920 --> 00:42:11,839
implemented in the news version where

1094
00:42:11,839 --> 00:42:13,440
you just dump the authorization

1095
00:42:13,440 --> 00:42:16,400
responses to a file that you or that you

1096
00:42:16,400 --> 00:42:18,160
read from a file and just dispense them

1097
00:42:18,160 --> 00:42:20,079
from there

1098
00:42:20,079 --> 00:42:22,319
and there's this vcsek archive which

1099
00:42:22,319 --> 00:42:24,160
also comes with a decode script that

1100
00:42:24,160 --> 00:42:26,240
help you read the messages that you

1101
00:42:26,240 --> 00:42:28,160
receive

1102
00:42:28,160 --> 00:42:30,400
and there's also that tool which is

1103
00:42:30,400 --> 00:42:33,520
basically a wrapper for the api that i

1104
00:42:33,520 --> 00:42:36,079
made public on rapid api where you can

1105
00:42:36,079 --> 00:42:37,440
put these eight

1106
00:42:37,440 --> 00:42:39,440
hex encoded bytes to and it would spit

1107
00:42:39,440 --> 00:42:40,319
out

1108
00:42:40,319 --> 00:42:41,359
a win

1109
00:42:41,359 --> 00:42:43,839
maybe also the model for sure but the

1110
00:42:43,839 --> 00:42:47,119
win is a premium feature

1111
00:42:47,680 --> 00:42:51,040
and last but not least there is an app

1112
00:42:51,040 --> 00:42:53,920
which is planned i plan to program that

1113
00:42:53,920 --> 00:42:57,440
it's like 80 ready it's called tesla key

1114
00:42:57,440 --> 00:42:59,520
and it doesn't talk to strangers because

1115
00:42:59,520 --> 00:43:03,280
root of all evil if you may agree or not

1116
00:43:03,280 --> 00:43:05,920
is that the official app talks to

1117
00:43:05,920 --> 00:43:08,480
anybody also at moments when this is not

1118
00:43:08,480 --> 00:43:10,960
even plausible so like why should my

1119
00:43:10,960 --> 00:43:12,640
phone open the car when i'm not even

1120
00:43:12,640 --> 00:43:14,960
close to it question number one

1121
00:43:14,960 --> 00:43:16,960
question number two why should that be

1122
00:43:16,960 --> 00:43:19,440
at three o'clock in the morning when my

1123
00:43:19,440 --> 00:43:21,280
phone is on the charger and in the home

1124
00:43:21,280 --> 00:43:24,560
network or why should it talk back to a

1125
00:43:24,560 --> 00:43:26,880
alleged car when it when it's booked

1126
00:43:26,880 --> 00:43:29,680
into the office network so like a lot of

1127
00:43:29,680 --> 00:43:32,400
plausibility checks with which are

1128
00:43:32,400 --> 00:43:34,400
pretty easy to implement actually and

1129
00:43:34,400 --> 00:43:36,960
these will be part of the tester key app

1130
00:43:36,960 --> 00:43:38,560
which you can

1131
00:43:38,560 --> 00:43:40,400
follow on twitter in order to get

1132
00:43:40,400 --> 00:43:43,520
informed so it's still i i think i put

1133
00:43:43,520 --> 00:43:46,000
some much pressure on me saying that

1134
00:43:46,000 --> 00:43:46,960
this is

1135
00:43:46,960 --> 00:43:50,640
released in q3 of 2022 but uh

1136
00:43:50,640 --> 00:43:52,880
i'm not losing the hope right so

1137
00:43:52,880 --> 00:43:55,520
conclusions relay attacks are possible

1138
00:43:55,520 --> 00:43:57,760
nfc key cards are dangerous

1139
00:43:57,760 --> 00:44:00,160
and the app should be improved in many

1140
00:44:00,160 --> 00:44:02,319
many parts right

1141
00:44:02,319 --> 00:44:05,440
and also the vcsec does not stand for

1142
00:44:05,440 --> 00:44:08,640
vehicle control security as many and i

1143
00:44:08,640 --> 00:44:11,200
did assume i was hoping it stands for

1144
00:44:11,200 --> 00:44:14,240
security it stands for vehicle control

1145
00:44:14,240 --> 00:44:16,560
secondary which explains a lot by the

1146
00:44:16,560 --> 00:44:17,359
way

1147
00:44:17,359 --> 00:44:19,680
and again we see that here in that use

1148
00:44:19,680 --> 00:44:23,280
case also convenience like the 130

1149
00:44:23,280 --> 00:44:25,760
second counter the inability to switch

1150
00:44:25,760 --> 00:44:28,800
off the permanent id things like that

1151
00:44:28,800 --> 00:44:29,839
are

1152
00:44:29,839 --> 00:44:32,720
like really bad for security again

1153
00:44:32,720 --> 00:44:34,720
so

1154
00:44:34,720 --> 00:44:36,560
you might ask yourself so we were

1155
00:44:36,560 --> 00:44:38,720
talking about the nfc card and also the

1156
00:44:38,720 --> 00:44:41,359
phone as a key what about the key far so

1157
00:44:41,359 --> 00:44:43,200
the key fob is a little bit special i

1158
00:44:43,200 --> 00:44:45,760
found out i got one as said but it's not

1159
00:44:45,760 --> 00:44:47,760
talking to me so i don't know what i'm

1160
00:44:47,760 --> 00:44:50,400
doing wrong i'm always nice i'm getting

1161
00:44:50,400 --> 00:44:52,319
i got it a new battery even

1162
00:44:52,319 --> 00:44:54,720
and it doesn't really want to talk to me

1163
00:44:54,720 --> 00:44:58,240
but i'm on that and working on that

1164
00:44:58,240 --> 00:45:01,359
also some credits there is very similar

1165
00:45:01,359 --> 00:45:04,800
work by a guy called dax in ireland big

1166
00:45:04,800 --> 00:45:06,640
credit to him because we got in touch

1167
00:45:06,640 --> 00:45:09,040
and turns out he's an amazing guy

1168
00:45:09,040 --> 00:45:11,920
also to the maker of attacker

1169
00:45:11,920 --> 00:45:14,560
sandeep who did the noble blino

1170
00:45:14,560 --> 00:45:17,200
framework which gatek is using

1171
00:45:17,200 --> 00:45:20,000
and and also to josh belder who helped

1172
00:45:20,000 --> 00:45:22,640
me with knowing about that remote drive

1173
00:45:22,640 --> 00:45:25,119
in the command that makes the pin to

1174
00:45:25,119 --> 00:45:28,079
drive dialogue disappear

1175
00:45:28,079 --> 00:45:30,480
so you might think well i got that

1176
00:45:30,480 --> 00:45:33,680
implant in my hand for starting my car

1177
00:45:33,680 --> 00:45:35,440
is it too late

1178
00:45:35,440 --> 00:45:37,680
and the answer is no it's not too late

1179
00:45:37,680 --> 00:45:41,359
you can chop off your hand anytime

1180
00:45:41,359 --> 00:45:43,680
or you just know the protocol and delete

1181
00:45:43,680 --> 00:45:45,280
it from the white list right also

1182
00:45:45,280 --> 00:45:47,520
possible whatever convenes

1183
00:45:47,520 --> 00:45:49,599
so thanks for your attention i think we

1184
00:45:49,599 --> 00:45:52,240
have like three minutes left for q a and

1185
00:45:52,240 --> 00:45:54,160
also here there's a lot of links that

1186
00:45:54,160 --> 00:45:55,920
you can follow in order to see the

1187
00:45:55,920 --> 00:45:57,119
slides

1188
00:45:57,119 --> 00:45:59,359
to to get in touch with me

1189
00:45:59,359 --> 00:46:03,040
to fund my research on patreon all there

1190
00:46:03,040 --> 00:46:07,720
thanks very much for your attention

1191
00:46:17,040 --> 00:46:19,440
we actually got four minutes for q a so

1192
00:46:19,440 --> 00:46:21,119
please queue up at the microphones in

1193
00:46:21,119 --> 00:46:23,040
the middle um if you keep your egg

1194
00:46:23,040 --> 00:46:25,119
questions short and the answers as well

1195
00:46:25,119 --> 00:46:27,040
we can fit everybody in and i think

1196
00:46:27,040 --> 00:46:29,280
there's also a little surprise maybe for

1197
00:46:29,280 --> 00:46:31,520
sure for quick and short questions

1198
00:46:31,520 --> 00:46:33,359
there's might be a surprise in it for

1199
00:46:33,359 --> 00:46:36,400
you so please usually i have motor balls

1200
00:46:36,400 --> 00:46:38,960
with me but it's too hot for that now

1201
00:46:38,960 --> 00:46:41,040
there are stickers tesla radar stickers

1202
00:46:41,040 --> 00:46:43,359
and every questioner gets one and you

1203
00:46:43,359 --> 00:46:45,040
also find them on the sticker tables if

1204
00:46:45,040 --> 00:46:47,839
you don't want to ask a question

1205
00:46:47,839 --> 00:46:50,160
all right

1206
00:46:51,040 --> 00:46:53,040
questions please

1207
00:46:53,040 --> 00:46:56,440
don't be afraid

1208
00:46:56,880 --> 00:46:57,839
well

1209
00:46:57,839 --> 00:46:59,680
all right so maybe we have some time for

1210
00:46:59,680 --> 00:47:00,560
demo

1211
00:47:00,560 --> 00:47:03,440
no i'm just kidding

1212
00:47:03,440 --> 00:47:04,560
so

1213
00:47:04,560 --> 00:47:08,480
thanks for the talk a short question

1214
00:47:08,480 --> 00:47:11,280
can you make a very easy automation that

1215
00:47:11,280 --> 00:47:13,119
just turns off your bluetooth when it's

1216
00:47:13,119 --> 00:47:14,960
on the charger and and it's after a

1217
00:47:14,960 --> 00:47:17,440
certain time and turns off uh turns it

1218
00:47:17,440 --> 00:47:18,960
on again automatically in the morning

1219
00:47:18,960 --> 00:47:21,119
that would mitigate a whole lot with the

1220
00:47:21,119 --> 00:47:22,960
whole of that effort

1221
00:47:22,960 --> 00:47:24,880
it would be possible to mitigate a lot

1222
00:47:24,880 --> 00:47:27,040
but usually people are really used to

1223
00:47:27,040 --> 00:47:28,480
using bluetooth because of the

1224
00:47:28,480 --> 00:47:30,480
smartwatch they have things like that it

1225
00:47:30,480 --> 00:47:32,160
would be inconvenient to disable

1226
00:47:32,160 --> 00:47:35,040
bluetooth in for everything what i would

1227
00:47:35,040 --> 00:47:36,640
like to see is a little switch in the

1228
00:47:36,640 --> 00:47:39,599
app right temporarily disable that would

1229
00:47:39,599 --> 00:47:41,440
help a lot as well

1230
00:47:41,440 --> 00:47:44,160
it is what i do my bluetooth turns off

1231
00:47:44,160 --> 00:47:46,079
off at 10 o'clock at night and on again

1232
00:47:46,079 --> 00:47:48,640
at 7 in the morning

1233
00:47:48,640 --> 00:47:50,319
makes a lot of sense

1234
00:47:50,319 --> 00:47:53,720
half your sticker

1235
00:47:54,800 --> 00:47:56,559
it's a special one i signed it for you

1236
00:47:56,559 --> 00:47:57,160
later

1237
00:47:57,160 --> 00:47:59,040
[Laughter]

1238
00:47:59,040 --> 00:48:00,960
all right any more questions there's one

1239
00:48:00,960 --> 00:48:02,240
more please

1240
00:48:02,240 --> 00:48:05,359
close to the microphone okay thanks uh

1241
00:48:05,359 --> 00:48:08,160
first of all great talk thank you um did

1242
00:48:08,160 --> 00:48:10,880
you take a look at the implementation of

1243
00:48:10,880 --> 00:48:14,800
ble and especially the proximity

1244
00:48:14,800 --> 00:48:17,680
implementation of the protocol itself um

1245
00:48:17,680 --> 00:48:19,440
yes actually they

1246
00:48:19,440 --> 00:48:21,520
is still on there

1247
00:48:21,520 --> 00:48:23,520
this is an interesting message i because

1248
00:48:23,520 --> 00:48:25,200
there was too many messages in the

1249
00:48:25,200 --> 00:48:27,680
presentation already so this is about an

1250
00:48:27,680 --> 00:48:31,119
alert that you get or that i got when um

1251
00:48:31,119 --> 00:48:33,599
the signal strength or the proximity was

1252
00:48:33,599 --> 00:48:35,920
wrong the readout for all the sensors

1253
00:48:35,920 --> 00:48:38,960
was too high actually this is not the

1254
00:48:38,960 --> 00:48:41,440
there you go so we have an alert there

1255
00:48:41,440 --> 00:48:43,839
and it shows that the readout of all the

1256
00:48:43,839 --> 00:48:47,040
rs's eyes was too too high for this to

1257
00:48:47,040 --> 00:48:49,839
be a real unlock event so there's

1258
00:48:49,839 --> 00:48:52,000
something to it but i think it's not

1259
00:48:52,000 --> 00:48:54,240
security related it's just for the

1260
00:48:54,240 --> 00:48:56,240
upcoming roadster that does not have

1261
00:48:56,240 --> 00:48:58,160
door handles anymore so you get there

1262
00:48:58,160 --> 00:48:59,440
with your key

1263
00:48:59,440 --> 00:49:01,599
and the right door opens i think that's

1264
00:49:01,599 --> 00:49:03,520
what this is for and this was just the

1265
00:49:03,520 --> 00:49:05,359
confusion that turned out to be

1266
00:49:05,359 --> 00:49:07,440
generating that alert so there is

1267
00:49:07,440 --> 00:49:09,280
something about proximity maybe we talk

1268
00:49:09,280 --> 00:49:11,359
about later a little bit more if you

1269
00:49:11,359 --> 00:49:13,839
like i will be around yeah sure yeah i i

1270
00:49:13,839 --> 00:49:16,400
read somewhere online that the blm

1271
00:49:16,400 --> 00:49:17,920
implementation was

1272
00:49:17,920 --> 00:49:20,559
it would also be a good mitigation yeah

1273
00:49:20,559 --> 00:49:23,119
i i'm able to fit the last one in if

1274
00:49:23,119 --> 00:49:25,680
it's a short question and a short answer

1275
00:49:25,680 --> 00:49:28,640
i will try my best i have i have two

1276
00:49:28,640 --> 00:49:32,319
short questions oh

1277
00:49:32,800 --> 00:49:34,800
don't they use

1278
00:49:34,800 --> 00:49:37,040
measurements of time to reply to

1279
00:49:37,040 --> 00:49:39,839
mitigate a replay attack

1280
00:49:39,839 --> 00:49:41,280
and

1281
00:49:41,280 --> 00:49:44,160
the modern car keys use an accelerometer

1282
00:49:44,160 --> 00:49:46,800
so if you don't have your car moving

1283
00:49:46,800 --> 00:49:48,640
your key moving it

1284
00:49:48,640 --> 00:49:50,800
doesn't work

1285
00:49:50,800 --> 00:49:52,720
questions i do my best to be really

1286
00:49:52,720 --> 00:49:54,880
short in the answer the first question

1287
00:49:54,880 --> 00:49:56,720
is like time of flight how long is the

1288
00:49:56,720 --> 00:49:58,960
delay tesla in the protocol is very

1289
00:49:58,960 --> 00:50:00,880
generous with that so it's like about

1290
00:50:00,880 --> 00:50:04,160
more than 100 milliseconds maybe 200 in

1291
00:50:04,160 --> 00:50:07,040
order to also have like old phones being

1292
00:50:07,040 --> 00:50:08,720
able to play the game right they have to

1293
00:50:08,720 --> 00:50:11,040
be really generous there and that also

1294
00:50:11,040 --> 00:50:13,200
played out very well with using a vpn

1295
00:50:13,200 --> 00:50:15,359
which also introduces delay

1296
00:50:15,359 --> 00:50:17,920
second question was

1297
00:50:17,920 --> 00:50:21,200
ah what was that

1298
00:50:21,599 --> 00:50:23,760
can we app disable the

1299
00:50:23,760 --> 00:50:26,880
unlocking if they

1300
00:50:27,440 --> 00:50:29,680
so so it's in the protocol already so

1301
00:50:29,680 --> 00:50:31,839
the phone may tell the car whoa i've

1302
00:50:31,839 --> 00:50:34,880
been moving so i have movement good the

1303
00:50:34,880 --> 00:50:36,960
car would then decide whether it would

1304
00:50:36,960 --> 00:50:39,680
allow unlock but the thing is this

1305
00:50:39,680 --> 00:50:43,200
message from the phone i'm moving is an

1306
00:50:43,200 --> 00:50:45,520
unsigned message so you can inject that

1307
00:50:45,520 --> 00:50:47,599
and the overall decision is taken by the

1308
00:50:47,599 --> 00:50:48,400
car

1309
00:50:48,400 --> 00:50:50,240
right so it's like a stupid approach

1310
00:50:50,240 --> 00:50:51,599
again

1311
00:50:51,599 --> 00:50:53,839
and on that bombshell i will end this

1312
00:50:53,839 --> 00:50:56,319
talk please give a very warm applause to

1313
00:50:56,319 --> 00:50:59,720
martin harford

1314
00:51:10,800 --> 00:51:12,880
you

