1
00:00:01,280 --> 00:00:12,559
[Music]

2
00:00:15,519 --> 00:00:16,960
so i'm going to talk to you about uh

3
00:00:16,960 --> 00:00:19,119
hacking train tickets in the uk um

4
00:00:19,119 --> 00:00:21,600
they're a bit different uh from train

5
00:00:21,600 --> 00:00:22,960
tickets in the netherlands you have chip

6
00:00:22,960 --> 00:00:26,000
cart we don't we have magnetic stripe

7
00:00:26,000 --> 00:00:27,760
things that look like this i have quite

8
00:00:27,760 --> 00:00:29,920
a lot um so that's what we're talking

9
00:00:29,920 --> 00:00:30,880
about here

10
00:00:30,880 --> 00:00:33,280
uh who am i so i'm a site reliability

11
00:00:33,280 --> 00:00:35,680
engineer at worth we have a

12
00:00:35,680 --> 00:00:38,160
dutch office and a reading office um i

13
00:00:38,160 --> 00:00:40,079
do lots of um

14
00:00:40,079 --> 00:00:41,920
hackathons and stuff i still have come

15
00:00:41,920 --> 00:00:44,239
to mch 2022 in here from the emf side

16
00:00:44,239 --> 00:00:46,280
deck uh obviously we're all here at

17
00:00:46,280 --> 00:00:49,039
mch-2022 so i should remove that um and

18
00:00:49,039 --> 00:00:52,719
i also uh like design systems um so

19
00:00:52,719 --> 00:00:54,800
the the things that you see particularly

20
00:00:54,800 --> 00:00:57,360
around um ns they have a really strong

21
00:00:57,360 --> 00:00:58,719
you know design system we don't have

22
00:00:58,719 --> 00:01:00,640
that in the uk it's it's a bit rubbish

23
00:01:00,640 --> 00:01:02,320
um everything looks a bit weird um on

24
00:01:02,320 --> 00:01:04,640
the railway network um so why why are we

25
00:01:04,640 --> 00:01:05,840
talking about hacking training tickets

26
00:01:05,840 --> 00:01:08,720
so back in 2016 it was a long time ago i

27
00:01:08,720 --> 00:01:10,960
read this article about people that were

28
00:01:10,960 --> 00:01:12,400
forging rail tickets

29
00:01:12,400 --> 00:01:13,680
um i thought that was kind of

30
00:01:13,680 --> 00:01:15,920
interesting you know if you can uh make

31
00:01:15,920 --> 00:01:17,520
your own rail ticket that

32
00:01:17,520 --> 00:01:18,479
you know

33
00:01:18,479 --> 00:01:20,159
season tickets are expensive in the uk

34
00:01:20,159 --> 00:01:23,600
it's uh maybe 5 000 pounds 8 000 euro

35
00:01:23,600 --> 00:01:25,759
for a yearly season ticket that's not

36
00:01:25,759 --> 00:01:27,680
uncommon so if you can make your own

37
00:01:27,680 --> 00:01:29,520
that that's quite interesting and if you

38
00:01:29,520 --> 00:01:31,280
can write the mag stripe that's even

39
00:01:31,280 --> 00:01:33,280
more interesting but it turns out that's

40
00:01:33,280 --> 00:01:36,240
not what they're doing um they were just

41
00:01:36,240 --> 00:01:38,240
printing the thermal print on the front

42
00:01:38,240 --> 00:01:39,600
so they would take it put it through a

43
00:01:39,600 --> 00:01:41,119
thermal printer

44
00:01:41,119 --> 00:01:43,200
photoshop nice but it won't go through a

45
00:01:43,200 --> 00:01:44,240
barrier

46
00:01:44,240 --> 00:01:45,119
and

47
00:01:45,119 --> 00:01:47,439
that's not that's not so exciting so how

48
00:01:47,439 --> 00:01:50,000
do we write the mag stripe well

49
00:01:50,000 --> 00:01:53,119
we can foi uh transport for london uh

50
00:01:53,119 --> 00:01:56,159
who have lots of gate lines and are a

51
00:01:56,159 --> 00:01:57,920
public authority so you can use the

52
00:01:57,920 --> 00:02:00,159
freedom of information act and ask them

53
00:02:00,159 --> 00:02:02,000
you know what's on the mag stripe what's

54
00:02:02,000 --> 00:02:03,759
the specification

55
00:02:03,759 --> 00:02:05,600
but they didn't want to say because they

56
00:02:05,600 --> 00:02:07,040
felt you know

57
00:02:07,040 --> 00:02:09,119
people might copy them which

58
00:02:09,119 --> 00:02:11,680
in fairness is fairly reasonable so we

59
00:02:11,680 --> 00:02:14,319
have to work it out ourselves

60
00:02:14,319 --> 00:02:15,120
so

61
00:02:15,120 --> 00:02:17,280
the agenda for today uh we will do a bit

62
00:02:17,280 --> 00:02:20,560
of history uh just because i spent a lot

63
00:02:20,560 --> 00:02:22,720
a long time in the national archives uh

64
00:02:22,720 --> 00:02:25,360
working out how how all this worked uh

65
00:02:25,360 --> 00:02:26,959
we'll have a little look at the data go

66
00:02:26,959 --> 00:02:29,120
out um and how you actually read one of

67
00:02:29,120 --> 00:02:31,360
these it's not not quite so simple and

68
00:02:31,360 --> 00:02:33,200
what we're doing about digital ticketing

69
00:02:33,200 --> 00:02:35,440
in the in the uk because we don't do

70
00:02:35,440 --> 00:02:38,080
chip cards as i said so you know

71
00:02:38,080 --> 00:02:39,680
sadly we don't do chip card maybe we

72
00:02:39,680 --> 00:02:41,440
will in the future but

73
00:02:41,440 --> 00:02:43,200
how do we do that currently and then

74
00:02:43,200 --> 00:02:45,040
we'll talk about some conclusions i

75
00:02:45,040 --> 00:02:46,080
guess

76
00:02:46,080 --> 00:02:48,800
um so these are laws in the uk if you're

77
00:02:48,800 --> 00:02:50,400
going to do this please read them

78
00:02:50,400 --> 00:02:52,480
because they are relevant and

79
00:02:52,480 --> 00:02:55,040
you know you don't want to end up uh

80
00:02:55,040 --> 00:02:58,080
like getting getting in prison uh

81
00:02:58,080 --> 00:02:59,680
things like like writing your own mag

82
00:02:59,680 --> 00:03:01,040
stripe and putting it through a barrier

83
00:03:01,040 --> 00:03:03,360
is apparently not legal so i don't know

84
00:03:03,360 --> 00:03:04,480
i'm not a lawyer

85
00:03:04,480 --> 00:03:05,280
um

86
00:03:05,280 --> 00:03:07,840
this talk isn't comprehensive it's um

87
00:03:07,840 --> 00:03:10,400
my own opinion please don't sue me

88
00:03:10,400 --> 00:03:12,879
uh so the history uh if you don't know

89
00:03:12,879 --> 00:03:14,560
about the uk railways it's all a bit

90
00:03:14,560 --> 00:03:15,840
weird

91
00:03:15,840 --> 00:03:18,560
we had private companies then we had

92
00:03:18,560 --> 00:03:20,159
public companies

93
00:03:20,159 --> 00:03:22,640
then we had privatization again and now

94
00:03:22,640 --> 00:03:24,080
now that's all gone wrong so they're

95
00:03:24,080 --> 00:03:26,319
nationalizing it again

96
00:03:26,319 --> 00:03:28,080
we're sort of looking in the periods

97
00:03:28,080 --> 00:03:31,280
between 1948 to 1994 which is when these

98
00:03:31,280 --> 00:03:33,040
tickets were sort of designed back in

99
00:03:33,040 --> 00:03:35,440
the 70s that's where the the magnetic

100
00:03:35,440 --> 00:03:37,040
stripe comes from

101
00:03:37,040 --> 00:03:39,280
the 1970s

102
00:03:39,280 --> 00:03:41,920
it hasn't changed and that's really part

103
00:03:41,920 --> 00:03:44,239
of the problem

104
00:03:44,239 --> 00:03:46,799
before the 1960s before british rail we

105
00:03:46,799 --> 00:03:48,959
had these so these were like

106
00:03:48,959 --> 00:03:51,360
um you you go to a station you buy them

107
00:03:51,360 --> 00:03:53,040
they're pre-printed they have a serial

108
00:03:53,040 --> 00:03:55,439
number um but the the station would just

109
00:03:55,439 --> 00:03:57,360
have like a massive rack of them and

110
00:03:57,360 --> 00:03:58,959
they would pick one off there's no

111
00:03:58,959 --> 00:04:00,640
accounting accounting is done manually

112
00:04:00,640 --> 00:04:02,560
in the ledger so they write it down

113
00:04:02,560 --> 00:04:04,480
which tickets they sold

114
00:04:04,480 --> 00:04:07,200
it's not great um

115
00:04:07,200 --> 00:04:08,959
they were still using this in the 60s

116
00:04:08,959 --> 00:04:11,120
even when there was some computerization

117
00:04:11,120 --> 00:04:13,120
and it became a bit of a problem

118
00:04:13,120 --> 00:04:14,799
so what they did do was they made it

119
00:04:14,799 --> 00:04:17,839
look different they redesigned it um

120
00:04:17,839 --> 00:04:19,680
they didn't change anything else

121
00:04:19,680 --> 00:04:22,000
so we went into the sort of late 60s

122
00:04:22,000 --> 00:04:23,919
early 70s using tickets that were

123
00:04:23,919 --> 00:04:26,400
completely untraceable

124
00:04:26,400 --> 00:04:28,240
the only method of security was they

125
00:04:28,240 --> 00:04:31,040
collected them back at the end so if you

126
00:04:31,040 --> 00:04:32,560
uh kept your ticket you could have

127
00:04:32,560 --> 00:04:34,000
another ride

128
00:04:34,000 --> 00:04:35,520
which wasn't so great

129
00:04:35,520 --> 00:04:36,800
uh

130
00:04:36,800 --> 00:04:38,320
and this actually continued well into

131
00:04:38,320 --> 00:04:39,919
the 80s because as we'll see the

132
00:04:39,919 --> 00:04:41,759
computerization was not not quite so

133
00:04:41,759 --> 00:04:43,600
simple as they thought

134
00:04:43,600 --> 00:04:44,880
but we did start to get some

135
00:04:44,880 --> 00:04:48,240
computerization in the 60s and 70s so

136
00:04:48,240 --> 00:04:49,840
they started to look a bit like this so

137
00:04:49,840 --> 00:04:52,639
these are printed by computers

138
00:04:52,639 --> 00:04:55,440
they are mechanical computers though so

139
00:04:55,440 --> 00:04:56,800
they're printing very limited

140
00:04:56,800 --> 00:04:58,880
information and they are doing some sort

141
00:04:58,880 --> 00:05:00,800
of tallying so they collect some

142
00:05:00,800 --> 00:05:03,280
information about what ticket they sold

143
00:05:03,280 --> 00:05:05,199
who they where it was sold you know that

144
00:05:05,199 --> 00:05:07,039
kind of stuff and then it still goes

145
00:05:07,039 --> 00:05:08,880
into you know manual ledger reporting

146
00:05:08,880 --> 00:05:11,520
gets sent off to an office they work out

147
00:05:11,520 --> 00:05:12,960
you know how much money they've made all

148
00:05:12,960 --> 00:05:15,199
that kind of stuff

149
00:05:15,199 --> 00:05:17,759
still not great and one of the real

150
00:05:17,759 --> 00:05:20,080
problems here was that everyone was

151
00:05:20,080 --> 00:05:21,759
using a different

152
00:05:21,759 --> 00:05:26,320
system so you can see two types here um

153
00:05:26,320 --> 00:05:28,720
we have another two types here

154
00:05:28,720 --> 00:05:30,800
uh all of them different these all come

155
00:05:30,800 --> 00:05:33,199
from a ticketing manual by the way

156
00:05:33,199 --> 00:05:34,400
it's quite thick

157
00:05:34,400 --> 00:05:36,320
they had to have an entire manual to

158
00:05:36,320 --> 00:05:38,000
tell people how to read the tickets

159
00:05:38,000 --> 00:05:40,800
because there were so many of them

160
00:05:40,800 --> 00:05:43,039
and we have even more here

161
00:05:43,039 --> 00:05:44,160
so

162
00:05:44,160 --> 00:05:46,080
huge number of tickets huge number of

163
00:05:46,080 --> 00:05:50,320
systems that kind of dealt with them

164
00:05:50,320 --> 00:05:51,360
and

165
00:05:51,360 --> 00:05:53,280
they were all going a bit wrong uh by

166
00:05:53,280 --> 00:05:54,800
the time we got to the 80s these

167
00:05:54,800 --> 00:05:56,800
machines they were mechanical

168
00:05:56,800 --> 00:05:58,880
um some of them were sort of a veteran

169
00:05:58,880 --> 00:06:00,479
mechanical as well but

170
00:06:00,479 --> 00:06:02,400
they were not not doing so well they

171
00:06:02,400 --> 00:06:03,600
were starting to fall apart the

172
00:06:03,600 --> 00:06:05,199
manufacturers didn't want to support

173
00:06:05,199 --> 00:06:06,960
them

174
00:06:06,960 --> 00:06:09,280
so the british rail as it was then the

175
00:06:09,280 --> 00:06:10,639
train company

176
00:06:10,639 --> 00:06:12,800
wanted to sort that out

177
00:06:12,800 --> 00:06:14,880
so they came up with a list of all their

178
00:06:14,880 --> 00:06:16,240
printers they had

179
00:06:16,240 --> 00:06:18,639
as you can see quite a lot of different

180
00:06:18,639 --> 00:06:20,560
printing machines quite a lot of

181
00:06:20,560 --> 00:06:23,120
different companies well i guess

182
00:06:23,120 --> 00:06:24,560
four companies

183
00:06:24,560 --> 00:06:26,720
and quite a lot of machines

184
00:06:26,720 --> 00:06:29,120
um they managed to introduce computers

185
00:06:29,120 --> 00:06:31,199
in other parts of the rail network so

186
00:06:31,199 --> 00:06:33,120
managing the trains that ran around and

187
00:06:33,120 --> 00:06:35,280
all that kind of stuff but they hadn't

188
00:06:35,280 --> 00:06:36,800
managed to do it for ticketing ticketing

189
00:06:36,800 --> 00:06:38,880
was still too much of a problem

190
00:06:38,880 --> 00:06:40,400
so

191
00:06:40,400 --> 00:06:41,840
british rail decided to do something

192
00:06:41,840 --> 00:06:43,199
about this and they started an

193
00:06:43,199 --> 00:06:45,840
experiment and it's called intus

194
00:06:45,840 --> 00:06:48,720
intermediate ticket issuing system

195
00:06:48,720 --> 00:06:50,800
no one really knows a huge amount about

196
00:06:50,800 --> 00:06:52,720
this there isn't very much about it in

197
00:06:52,720 --> 00:06:55,680
the archives um but some of the tickets

198
00:06:55,680 --> 00:06:58,000
do still exist so they look like this

199
00:06:58,000 --> 00:07:00,000
and these are fairly similar to the

200
00:07:00,000 --> 00:07:02,319
tickets that we have today like this and

201
00:07:02,319 --> 00:07:03,840
this is back in the 70s it hasn't

202
00:07:03,840 --> 00:07:06,880
changed um the really interesting

203
00:07:06,880 --> 00:07:09,039
slash important thing is the code at the

204
00:07:09,039 --> 00:07:10,800
top right eight three five five that's

205
00:07:10,800 --> 00:07:13,039
called the national location code

206
00:07:13,039 --> 00:07:16,800
um this is a database of locations

207
00:07:16,800 --> 00:07:18,160
obviously

208
00:07:18,160 --> 00:07:20,240
it also includes other weird edge cases

209
00:07:20,240 --> 00:07:23,440
but it is essentially a list of offices

210
00:07:23,440 --> 00:07:25,919
so places that could issue tickets

211
00:07:25,919 --> 00:07:29,599
and they all had a four digit code

212
00:07:29,680 --> 00:07:31,280
and you can see this ticket is printed

213
00:07:31,280 --> 00:07:34,400
in 1984 apparently um it does have a

214
00:07:34,400 --> 00:07:36,160
manual here so you can tell what

215
00:07:36,160 --> 00:07:37,199
everything is

216
00:07:37,199 --> 00:07:38,639
again this comes from the ticketing

217
00:07:38,639 --> 00:07:39,680
manual

218
00:07:39,680 --> 00:07:42,319
uh but this was just a piece of card it

219
00:07:42,319 --> 00:07:44,720
had no mag stripe on it all it had was

220
00:07:44,720 --> 00:07:47,120
what was printed on the front uh they

221
00:07:47,120 --> 00:07:50,080
did have a central audit functionality

222
00:07:50,080 --> 00:07:51,440
for this that they were trying out you

223
00:07:51,440 --> 00:07:52,720
know they had a

224
00:07:52,720 --> 00:07:54,879
obviously a computer was printing this

225
00:07:54,879 --> 00:07:56,319
not a very advanced one and it had a

226
00:07:56,319 --> 00:07:58,319
tape deck the tape deck would get pulled

227
00:07:58,319 --> 00:08:00,240
out it would get posted off that kind of

228
00:08:00,240 --> 00:08:02,160
thing it was apparently unreliable they

229
00:08:02,160 --> 00:08:03,680
didn't they didn't like it what they

230
00:08:03,680 --> 00:08:05,440
wanted to be able to do was have

231
00:08:05,440 --> 00:08:07,280
computers in all the offices they would

232
00:08:07,280 --> 00:08:08,960
all talk to a central mainframe because

233
00:08:08,960 --> 00:08:12,879
that was cool in the 70s and 80s and

234
00:08:12,879 --> 00:08:13,840
they would

235
00:08:13,840 --> 00:08:16,479
not have to deal with posting tape decks

236
00:08:16,479 --> 00:08:18,879
tape cartridges all over the place

237
00:08:18,879 --> 00:08:21,759
um so they made a few hundred of these

238
00:08:21,759 --> 00:08:23,280
as an experiment

239
00:08:23,280 --> 00:08:25,280
it was not a particularly mainstream

240
00:08:25,280 --> 00:08:29,120
thing but they then decided you know we

241
00:08:29,120 --> 00:08:30,479
have all these different ticket machines

242
00:08:30,479 --> 00:08:31,360
we have all these different

243
00:08:31,360 --> 00:08:34,559
specifications so surely what we need is

244
00:08:34,559 --> 00:08:35,919
yeah another one

245
00:08:35,919 --> 00:08:37,760
so they made aptis

246
00:08:37,760 --> 00:08:40,320
so aptis is the all-purpose ticket

247
00:08:40,320 --> 00:08:41,760
issuing system

248
00:08:41,760 --> 00:08:44,000
it also has a portable version because

249
00:08:44,000 --> 00:08:44,959
why not

250
00:08:44,959 --> 00:08:48,320
uh we won't talk too much about that

251
00:08:48,320 --> 00:08:49,760
because i don't actually think they made

252
00:08:49,760 --> 00:08:51,279
very many of them they weren't very

253
00:08:51,279 --> 00:08:53,600
portable you know electronics in the in

254
00:08:53,600 --> 00:08:56,240
the 70s weren't portable uh

255
00:08:56,240 --> 00:08:58,480
yeah it didn't that bit didn't go away

256
00:08:58,480 --> 00:09:00,320
quite quite so well

257
00:09:00,320 --> 00:09:01,360
so

258
00:09:01,360 --> 00:09:03,839
aptis was supposed to do pretty much

259
00:09:03,839 --> 00:09:04,720
everything

260
00:09:04,720 --> 00:09:07,200
so they would be able to take the ticket

261
00:09:07,200 --> 00:09:09,120
machine put it in the ticket office it

262
00:09:09,120 --> 00:09:11,200
would issue pretty much everything they

263
00:09:11,200 --> 00:09:13,040
sold which was quite a lot so you have

264
00:09:13,040 --> 00:09:14,640
to remember at the time the railway

265
00:09:14,640 --> 00:09:16,000
company was

266
00:09:16,000 --> 00:09:18,720
like they did a lot of transportation

267
00:09:18,720 --> 00:09:21,680
not just people but also ships also

268
00:09:21,680 --> 00:09:24,240
goods also selling you

269
00:09:24,240 --> 00:09:26,080
food and drink also selling you car

270
00:09:26,080 --> 00:09:28,080
parking tickets all that kind of stuff

271
00:09:28,080 --> 00:09:29,519
and they wanted it to all go through

272
00:09:29,519 --> 00:09:30,720
this machine

273
00:09:30,720 --> 00:09:33,440
even international tickets

274
00:09:33,440 --> 00:09:34,240
so

275
00:09:34,240 --> 00:09:35,519
this was actually quite a big

276
00:09:35,519 --> 00:09:36,640
undertaking

277
00:09:36,640 --> 00:09:38,000
and they were using their knowledge from

278
00:09:38,000 --> 00:09:40,640
the previous experiments to try and to

279
00:09:40,640 --> 00:09:41,680
try and

280
00:09:41,680 --> 00:09:43,760
do this properly you know not have to go

281
00:09:43,760 --> 00:09:46,240
back to having 50 different machines

282
00:09:46,240 --> 00:09:48,320
across the regions that no one

283
00:09:48,320 --> 00:09:49,839
understood no one could maintain and

284
00:09:49,839 --> 00:09:51,120
didn't work

285
00:09:51,120 --> 00:09:52,240
um

286
00:09:52,240 --> 00:09:54,800
they really wanted auditing as well

287
00:09:54,800 --> 00:09:55,680
so

288
00:09:55,680 --> 00:09:57,519
this is the specimen

289
00:09:57,519 --> 00:09:59,360
uh for an aptus

290
00:09:59,360 --> 00:10:00,320
ticket

291
00:10:00,320 --> 00:10:01,680
uh it looks pretty much like this

292
00:10:01,680 --> 00:10:04,399
because it is the same specification

293
00:10:04,399 --> 00:10:06,560
and this dates from the

294
00:10:06,560 --> 00:10:10,079
i think this this document is 1986. so

295
00:10:10,079 --> 00:10:13,279
oh it does say 1986 nice uh so this the

296
00:10:13,279 --> 00:10:15,519
the ticket that people in the uk will

297
00:10:15,519 --> 00:10:17,279
recognize today if you go to a station

298
00:10:17,279 --> 00:10:19,040
you buy a ticket you'll get one that

299
00:10:19,040 --> 00:10:20,399
prints out a bit like this it won't say

300
00:10:20,399 --> 00:10:22,079
british rail because the government got

301
00:10:22,079 --> 00:10:24,240
rid of that but it will have all of this

302
00:10:24,240 --> 00:10:27,519
information on it and it will have

303
00:10:27,519 --> 00:10:30,839
the double arrow at the bottom

304
00:10:30,839 --> 00:10:33,760
uh there's a comparison for you

305
00:10:33,760 --> 00:10:36,800
they are pretty much the same

306
00:10:37,680 --> 00:10:38,959
they also printed them in different

307
00:10:38,959 --> 00:10:42,000
colors because why not um and these

308
00:10:42,000 --> 00:10:43,600
denote different things so network

309
00:10:43,600 --> 00:10:46,399
southeast was like a particular division

310
00:10:46,399 --> 00:10:47,519
and this is what you would get things

311
00:10:47,519 --> 00:10:49,120
like a season ticket on you can see on

312
00:10:49,120 --> 00:10:50,720
the back it does have the mag stripe on

313
00:10:50,720 --> 00:10:52,320
this one we'll talk a bit about that in

314
00:10:52,320 --> 00:10:54,880
a minute and also like the uh reference

315
00:10:54,880 --> 00:10:58,640
number so 4599 is the br reference

316
00:10:58,640 --> 00:10:59,839
on the back of these it will tell you

317
00:10:59,839 --> 00:11:03,279
it's uh rsp9599

318
00:11:03,279 --> 00:11:05,519
but they are the same ticket

319
00:11:05,519 --> 00:11:07,040
um

320
00:11:07,040 --> 00:11:08,560
the future requirements was the really

321
00:11:08,560 --> 00:11:10,320
interesting bit so they developed this

322
00:11:10,320 --> 00:11:11,760
computer system called adapters they

323
00:11:11,760 --> 00:11:13,279
made a few of them but they had some

324
00:11:13,279 --> 00:11:14,560
things they wanted to be able to do so

325
00:11:14,560 --> 00:11:15,760
they wanted to be able to take credit

326
00:11:15,760 --> 00:11:16,880
cards

327
00:11:16,880 --> 00:11:19,279
so they wanted the machine to phone up

328
00:11:19,279 --> 00:11:21,200
the credit card company like american

329
00:11:21,200 --> 00:11:23,519
express and check you know do they have

330
00:11:23,519 --> 00:11:25,440
enough money to buy the ticket and they

331
00:11:25,440 --> 00:11:27,279
also want to do that for checks because

332
00:11:27,279 --> 00:11:30,959
back in the in the 80s we used checks

333
00:11:30,959 --> 00:11:31,880
the

334
00:11:31,880 --> 00:11:34,880
7.1.3 is issuing london underground

335
00:11:34,880 --> 00:11:36,640
tickets uic

336
00:11:36,640 --> 00:11:37,519
so

337
00:11:37,519 --> 00:11:40,000
being able to take your ticket

338
00:11:40,000 --> 00:11:41,440
go through the barrier on the london

339
00:11:41,440 --> 00:11:43,279
underground and go out the other side of

340
00:11:43,279 --> 00:11:45,120
london um if you've ever been on the

341
00:11:45,120 --> 00:11:46,880
british railways you'll know that most

342
00:11:46,880 --> 00:11:49,040
things start and end in london so that's

343
00:11:49,040 --> 00:11:50,800
actually quite a big thing

344
00:11:50,800 --> 00:11:54,000
and the top one 7.1.1 was the ability to

345
00:11:54,000 --> 00:11:57,360
magnetically encode these tickets

346
00:11:57,360 --> 00:11:58,560
and it's really interesting to think

347
00:11:58,560 --> 00:12:00,160
about why they actually wanted to do

348
00:12:00,160 --> 00:12:01,920
this because that's quite an expensive

349
00:12:01,920 --> 00:12:04,160
thing to do back in the 80s you have to

350
00:12:04,160 --> 00:12:06,160
have the computer processing you have to

351
00:12:06,160 --> 00:12:09,040
have the hardware mag stripe is not

352
00:12:09,040 --> 00:12:11,040
hugely common

353
00:12:11,040 --> 00:12:12,959
it's on credit cards and stuff and on

354
00:12:12,959 --> 00:12:14,800
tape decks but you know single-use

355
00:12:14,800 --> 00:12:16,240
tickets that's

356
00:12:16,240 --> 00:12:18,480
quite expensive

357
00:12:18,480 --> 00:12:20,880
and they saw it very much as

358
00:12:20,880 --> 00:12:22,720
a anti-fraud thing

359
00:12:22,720 --> 00:12:25,120
not in the sense that people

360
00:12:25,120 --> 00:12:26,720
could wouldn't know what was written on

361
00:12:26,720 --> 00:12:29,200
it but more in the sense that at that

362
00:12:29,200 --> 00:12:30,480
time people were getting personal

363
00:12:30,480 --> 00:12:32,240
computers and personal computers come

364
00:12:32,240 --> 00:12:34,560
with printers and printers can be used

365
00:12:34,560 --> 00:12:37,440
to print these sort of tickets

366
00:12:37,440 --> 00:12:40,880
they also thought that people might uh

367
00:12:40,880 --> 00:12:42,160
they they could use like different

368
00:12:42,160 --> 00:12:43,920
colors on the tickets you know like

369
00:12:43,920 --> 00:12:45,519
different color ribbons because they

370
00:12:45,519 --> 00:12:47,279
didn't it wasn't thermally printed

371
00:12:47,279 --> 00:12:48,800
apparently it was um

372
00:12:48,800 --> 00:12:51,040
you know a ribbon stamping through the

373
00:12:51,040 --> 00:12:52,320
ribbon onto the ticket so they thought

374
00:12:52,320 --> 00:12:53,920
they could use different colors as well

375
00:12:53,920 --> 00:12:55,760
but the main thing was um

376
00:12:55,760 --> 00:12:58,399
just to to check that uh

377
00:12:58,399 --> 00:12:59,760
you know does it have a mag strap on the

378
00:12:59,760 --> 00:13:00,800
back because they figured people

379
00:13:00,800 --> 00:13:02,320
wouldn't be able to make those tickets

380
00:13:02,320 --> 00:13:03,600
that they wouldn't be able certainly

381
00:13:03,600 --> 00:13:05,360
wouldn't be able to write them and that

382
00:13:05,360 --> 00:13:09,519
might go some way to reducing fraud

383
00:13:09,519 --> 00:13:10,880
and they wanted to have these handheld

384
00:13:10,880 --> 00:13:12,800
verifiers as well so you could someone

385
00:13:12,800 --> 00:13:14,959
on the train they put it in

386
00:13:14,959 --> 00:13:17,200
and it would verify the mag stripe i

387
00:13:17,200 --> 00:13:19,680
don't believe that ever has existed

388
00:13:19,680 --> 00:13:22,480
no one has ever bothered doing that um

389
00:13:22,480 --> 00:13:24,399
only at the gate line when you get to

390
00:13:24,399 --> 00:13:25,760
the station

391
00:13:25,760 --> 00:13:29,600
um it wasn't the only reason though so

392
00:13:29,600 --> 00:13:32,480
they realized that uh

393
00:13:32,480 --> 00:13:35,200
i know this is quite small so you can

394
00:13:35,200 --> 00:13:37,920
not bother to read it um

395
00:13:37,920 --> 00:13:39,199
they they realized that the london

396
00:13:39,199 --> 00:13:40,399
underground thing was going to be a bit

397
00:13:40,399 --> 00:13:42,480
of a problem so london underground at

398
00:13:42,480 --> 00:13:44,399
the time were introducing big gate lines

399
00:13:44,399 --> 00:13:46,880
and they wanted to make sure london

400
00:13:46,880 --> 00:13:48,959
underground being a separate you know

401
00:13:48,959 --> 00:13:50,880
department i guess

402
00:13:50,880 --> 00:13:52,240
that people were

403
00:13:52,240 --> 00:13:54,079
using modern tickets they would develop

404
00:13:54,079 --> 00:13:55,839
a mag stripe ticket

405
00:13:55,839 --> 00:13:57,040
and it would go through the london

406
00:13:57,040 --> 00:13:58,720
underground barriers

407
00:13:58,720 --> 00:14:00,079
but that's all completely separate to

408
00:14:00,079 --> 00:14:01,519
the national network but the national

409
00:14:01,519 --> 00:14:03,120
network still needs to use london

410
00:14:03,120 --> 00:14:05,040
underground to get people across london

411
00:14:05,040 --> 00:14:07,040
from one terminal to another everything

412
00:14:07,040 --> 00:14:08,560
starts and ends in london

413
00:14:08,560 --> 00:14:10,399
so they had to

414
00:14:10,399 --> 00:14:12,880
uh discuss with london underground and

415
00:14:12,880 --> 00:14:14,320
come to some agreement

416
00:14:14,320 --> 00:14:15,680
and they actually managed

417
00:14:15,680 --> 00:14:17,760
the ground to pay

418
00:14:17,760 --> 00:14:20,079
for the entire implementation of the mag

419
00:14:20,079 --> 00:14:21,680
stripe on these tickets so all the

420
00:14:21,680 --> 00:14:23,440
software changes they had to have more

421
00:14:23,440 --> 00:14:25,120
memory they had to

422
00:14:25,120 --> 00:14:25,920
uh

423
00:14:25,920 --> 00:14:27,760
you know add the mag stripe print

424
00:14:27,760 --> 00:14:29,760
magstripe encoder on the printer all

425
00:14:29,760 --> 00:14:31,279
that kind of stuff and they managed to

426
00:14:31,279 --> 00:14:32,000
get

427
00:14:32,000 --> 00:14:33,040
the

428
00:14:33,040 --> 00:14:34,959
the other company to pay for it which i

429
00:14:34,959 --> 00:14:37,360
think is kind of amazing that they did

430
00:14:37,360 --> 00:14:38,240
but

431
00:14:38,240 --> 00:14:39,680
just so that people could use their

432
00:14:39,680 --> 00:14:41,360
tickets to cross london

433
00:14:41,360 --> 00:14:44,560
i guess that's really quite important

434
00:14:44,560 --> 00:14:47,440
um so we come to the specification so

435
00:14:47,440 --> 00:14:50,000
this is from the national archives

436
00:14:50,000 --> 00:14:51,760
and this tells us actually really quite

437
00:14:51,760 --> 00:14:53,760
a lot of information that

438
00:14:53,760 --> 00:14:56,079
isn't necessarily known i'm afraid it's

439
00:14:56,079 --> 00:14:56,880
in

440
00:14:56,880 --> 00:15:02,240
imperial inches because 1970s 1980s

441
00:15:02,240 --> 00:15:04,320
the really interesting thing about this

442
00:15:04,320 --> 00:15:07,839
is the data content that it tells us so

443
00:15:07,839 --> 00:15:08,639
uh

444
00:15:08,639 --> 00:15:10,560
it's telling us that we have 19 bytes on

445
00:15:10,560 --> 00:15:13,760
there with two clock syncs so

446
00:15:13,760 --> 00:15:16,160
some space for the clock to check that

447
00:15:16,160 --> 00:15:18,800
it's um aligned with the data and we

448
00:15:18,800 --> 00:15:20,240
have a forward direction inverse

449
00:15:20,240 --> 00:15:22,959
direction and a checksum so that's

450
00:15:22,959 --> 00:15:24,399
actually really really interesting

451
00:15:24,399 --> 00:15:25,519
information when you're trying to

452
00:15:25,519 --> 00:15:27,040
actually understand what's on one of

453
00:15:27,040 --> 00:15:28,800
these

454
00:15:28,800 --> 00:15:29,600
and

455
00:15:29,600 --> 00:15:31,680
the encoding density encoding standard

456
00:15:31,680 --> 00:15:34,880
is fairly standard but the

457
00:15:34,880 --> 00:15:37,440
the actual layout you know how many

458
00:15:37,440 --> 00:15:39,120
people have a magstripe writer that can

459
00:15:39,120 --> 00:15:40,480
read that

460
00:15:40,480 --> 00:15:42,240
right it's not on the edge it's in the

461
00:15:42,240 --> 00:15:45,839
middle london underground standard

462
00:15:45,839 --> 00:15:48,720
as you can see it has a 0.3 inch nominal

463
00:15:48,720 --> 00:15:51,759
track width again not massively standard

464
00:15:51,759 --> 00:15:52,639
so

465
00:15:52,639 --> 00:15:53,600
very

466
00:15:53,600 --> 00:15:55,839
non-standard ticket

467
00:15:55,839 --> 00:15:58,720
very interesting data content

468
00:15:58,720 --> 00:16:01,040
so how do we read it

469
00:16:01,040 --> 00:16:03,839
well first we visualize the data layout

470
00:16:03,839 --> 00:16:04,720
so

471
00:16:04,720 --> 00:16:06,720
the header we have a payload in the

472
00:16:06,720 --> 00:16:08,480
middle the checksum i mentioned and then

473
00:16:08,480 --> 00:16:10,240
the footer at the end

474
00:16:10,240 --> 00:16:12,720
and some example data so

475
00:16:12,720 --> 00:16:14,639
this is the interpretation of the

476
00:16:14,639 --> 00:16:16,880
document you just saw so zero's at the

477
00:16:16,880 --> 00:16:18,480
beginning for clock sync then the

478
00:16:18,480 --> 00:16:20,320
forward direction indicator one zero one

479
00:16:20,320 --> 00:16:22,800
zero and at the photo you have

480
00:16:22,800 --> 00:16:25,600
the reverse clock sync and one one one

481
00:16:25,600 --> 00:16:27,920
one so you can put it in two ways the

482
00:16:27,920 --> 00:16:29,440
machine can tell

483
00:16:29,440 --> 00:16:31,440
actually quite an important feature

484
00:16:31,440 --> 00:16:33,279
so as i say reading writing how do we do

485
00:16:33,279 --> 00:16:36,399
that so you can't use one of these uh

486
00:16:36,399 --> 00:16:38,000
well apparently you can i'm told that

487
00:16:38,000 --> 00:16:40,639
people have made this work with some

488
00:16:40,639 --> 00:16:42,000
nasty hacks

489
00:16:42,000 --> 00:16:43,519
but you can't just chop it off and stick

490
00:16:43,519 --> 00:16:45,519
it through a standard card reader it

491
00:16:45,519 --> 00:16:46,880
just doesn't work

492
00:16:46,880 --> 00:16:48,959
they're designed to read iso standard

493
00:16:48,959 --> 00:16:50,800
cards like your credit cards they're not

494
00:16:50,800 --> 00:16:52,720
designed to read weird mag stripes from

495
00:16:52,720 --> 00:16:54,079
the 1970s

496
00:16:54,079 --> 00:16:55,920
just ain't gonna work

497
00:16:55,920 --> 00:16:58,320
um there is this really interesting talk

498
00:16:58,320 --> 00:17:01,440
from uh i think about 2005 which talks

499
00:17:01,440 --> 00:17:04,880
about making your own uh

500
00:17:04,880 --> 00:17:06,480
with a magstripe reader with a

501
00:17:06,480 --> 00:17:08,160
microphone input

502
00:17:08,160 --> 00:17:10,319
so you get like a read head you plug it

503
00:17:10,319 --> 00:17:11,760
in you stick it through audacity or

504
00:17:11,760 --> 00:17:12,880
something

505
00:17:12,880 --> 00:17:15,199
and out out comes the data that you're

506
00:17:15,199 --> 00:17:16,799
looking for

507
00:17:16,799 --> 00:17:18,400
you don't get a clock in that sense you

508
00:17:18,400 --> 00:17:19,919
don't get um

509
00:17:19,919 --> 00:17:21,760
like the bits that you see so you get no

510
00:17:21,760 --> 00:17:23,919
clock um but

511
00:17:23,919 --> 00:17:25,280
this is

512
00:17:25,280 --> 00:17:27,119
this was used i think on the new york

513
00:17:27,119 --> 00:17:30,400
trans metro network um to to have a look

514
00:17:30,400 --> 00:17:32,160
at their magstripe data and it did work

515
00:17:32,160 --> 00:17:34,559
but that was 2005 and

516
00:17:34,559 --> 00:17:36,480
i'm not sure i can be bothered with that

517
00:17:36,480 --> 00:17:38,320
so i went and did some googling

518
00:17:38,320 --> 00:17:43,919
and this is the nd 4020 ticket printer

519
00:17:43,919 --> 00:17:46,640
this is made by newbury data and it

520
00:17:46,640 --> 00:17:47,919
prints tickets

521
00:17:47,919 --> 00:17:49,840
it also encodes them

522
00:17:49,840 --> 00:17:52,240
and this is also available on ebay

523
00:17:52,240 --> 00:17:54,400
quite readily as it seems for a hundred

524
00:17:54,400 --> 00:17:55,840
quid

525
00:17:55,840 --> 00:17:57,360
so for a hundred quid you can buy your

526
00:17:57,360 --> 00:18:00,720
own magstripe um

527
00:18:00,720 --> 00:18:04,080
reader writer it can read it can write

528
00:18:04,080 --> 00:18:05,840
it can even be extended with a massive

529
00:18:05,840 --> 00:18:07,919
hopper so you can print lots of tickets

530
00:18:07,919 --> 00:18:10,000
it's really quite a versatile piece of

531
00:18:10,000 --> 00:18:11,039
kit

532
00:18:11,039 --> 00:18:12,559
and this is what it looks like

533
00:18:12,559 --> 00:18:13,520
i have a

534
00:18:13,520 --> 00:18:14,880
one of them here

535
00:18:14,880 --> 00:18:18,080
uh this is the main board um it's a

536
00:18:18,080 --> 00:18:19,120
fairly

537
00:18:19,120 --> 00:18:20,240
standard

538
00:18:20,240 --> 00:18:21,600
uh

539
00:18:21,600 --> 00:18:23,679
like uh

540
00:18:23,679 --> 00:18:25,440
machine of its era

541
00:18:25,440 --> 00:18:27,440
it's not particularly powerful

542
00:18:27,440 --> 00:18:28,799
and the

543
00:18:28,799 --> 00:18:31,360
unfortunately the rom is soldered so you

544
00:18:31,360 --> 00:18:33,360
can't uh pull it off and and have a look

545
00:18:33,360 --> 00:18:34,320
without

546
00:18:34,320 --> 00:18:36,880
breaking stuff um which i didn't want to

547
00:18:36,880 --> 00:18:38,240
do because i wanted to to use the

548
00:18:38,240 --> 00:18:40,320
transport mechanism that's inside it

549
00:18:40,320 --> 00:18:42,400
it's a very well made machine by the way

550
00:18:42,400 --> 00:18:44,320
um so i took it along to the hackerspace

551
00:18:44,320 --> 00:18:45,919
and we plugged it into the uh

552
00:18:45,919 --> 00:18:47,280
oscilloscope and

553
00:18:47,280 --> 00:18:49,360
put some voltages through it and tried

554
00:18:49,360 --> 00:18:51,600
to get it to talk on the serial

555
00:18:51,600 --> 00:18:52,720
which was actually really quite

556
00:18:52,720 --> 00:18:54,799
difficult um there's no documentation

557
00:18:54,799 --> 00:18:56,320
for this thing it's not designed to be

558
00:18:56,320 --> 00:18:57,840
sold to the public it's not you're not

559
00:18:57,840 --> 00:18:59,440
supposed to have it

560
00:18:59,440 --> 00:19:01,200
as i say it's readily available on ebay

561
00:19:01,200 --> 00:19:02,559
but you're not supposed to have it so

562
00:19:02,559 --> 00:19:04,080
there's no drivers

563
00:19:04,080 --> 00:19:06,160
but you can eventually get it to talk

564
00:19:06,160 --> 00:19:08,240
serial so at the bottom you can see it's

565
00:19:08,240 --> 00:19:11,120
giving its version number um which is

566
00:19:11,120 --> 00:19:11,919
uh

567
00:19:11,919 --> 00:19:13,679
some kind of software version on the

568
00:19:13,679 --> 00:19:14,880
machine

569
00:19:14,880 --> 00:19:16,799
um so we have serial

570
00:19:16,799 --> 00:19:18,880
so we can then talk to it and it has

571
00:19:18,880 --> 00:19:21,360
this menu system in it you can see the

572
00:19:21,360 --> 00:19:24,240
start dates around 2009 it's a mark two

573
00:19:24,240 --> 00:19:26,240
one um and you can go through all of

574
00:19:26,240 --> 00:19:28,240
this so that's got loads of cool stuff

575
00:19:28,240 --> 00:19:30,000
like being able to set the clock being

576
00:19:30,000 --> 00:19:32,400
able to read all of its registers

577
00:19:32,400 --> 00:19:35,039
um i'm sure really useful information

578
00:19:35,039 --> 00:19:36,480
uh

579
00:19:36,480 --> 00:19:38,799
and the at the really interesting thing

580
00:19:38,799 --> 00:19:40,799
on this is being able to to just write

581
00:19:40,799 --> 00:19:42,640
stuff into different registers this is

582
00:19:42,640 --> 00:19:44,080
designed to be a printer it's designed

583
00:19:44,080 --> 00:19:45,919
to interface with other software so it's

584
00:19:45,919 --> 00:19:47,679
not designed for random people who don't

585
00:19:47,679 --> 00:19:49,679
have the drivers to just show up and

586
00:19:49,679 --> 00:19:50,400
like

587
00:19:50,400 --> 00:19:53,440
tell it uh which which bit of the memory

588
00:19:53,440 --> 00:19:56,080
you would like to write um but you know

589
00:19:56,080 --> 00:19:57,600
you could dump

590
00:19:57,600 --> 00:19:59,360
uh the entire memory location which

591
00:19:59,360 --> 00:20:00,640
gives you all of the data that's in

592
00:20:00,640 --> 00:20:03,200
there um which is

593
00:20:03,200 --> 00:20:04,960
kind of interesting until i accident

594
00:20:04,960 --> 00:20:06,880
accidentally overwrote it but you know i

595
00:20:06,880 --> 00:20:08,880
guess we can ocr

596
00:20:08,880 --> 00:20:10,159
um

597
00:20:10,159 --> 00:20:11,760
but we don't know what any of this means

598
00:20:11,760 --> 00:20:14,400
um you can i did try and have a look at

599
00:20:14,400 --> 00:20:16,799
what all the hex is it doesn't seem to

600
00:20:16,799 --> 00:20:19,760
be anything particularly readable

601
00:20:19,760 --> 00:20:21,200
unfortunately

602
00:20:21,200 --> 00:20:23,760
so what we did try and do was uh

603
00:20:23,760 --> 00:20:28,320
put some random stuff through the uh

604
00:20:28,320 --> 00:20:30,400
the execution so you can execute a

605
00:20:30,400 --> 00:20:32,080
script on this you can tell it i want to

606
00:20:32,080 --> 00:20:37,600
execute a memory location i want to

607
00:20:37,600 --> 00:20:39,039
print to something

608
00:20:39,039 --> 00:20:41,039
unfortunately that resulted in the

609
00:20:41,039 --> 00:20:42,960
entire thing crashing

610
00:20:42,960 --> 00:20:45,600
it didn't like that because i guess we

611
00:20:45,600 --> 00:20:46,960
did not give it a valid function we

612
00:20:46,960 --> 00:20:48,880
didn't write valid data

613
00:20:48,880 --> 00:20:49,919
so

614
00:20:49,919 --> 00:20:51,679
i did some googling and the way this

615
00:20:51,679 --> 00:20:52,960
probably works is some with something

616
00:20:52,960 --> 00:20:55,280
called pektab it's a kind of markup

617
00:20:55,280 --> 00:20:58,400
language for airline tickets and stuff

618
00:20:58,400 --> 00:20:59,760
they have some templates they fill up

619
00:20:59,760 --> 00:21:01,120
with some data they load it into the

620
00:21:01,120 --> 00:21:04,320
machine and they execute it as i say

621
00:21:04,320 --> 00:21:05,760
i don't have any of that software i

622
00:21:05,760 --> 00:21:07,840
don't know how any of it works i did try

623
00:21:07,840 --> 00:21:10,080
and decompile some stuff but again it's

624
00:21:10,080 --> 00:21:12,559
not really very readily available

625
00:21:12,559 --> 00:21:15,520
so the alternative approach is to make

626
00:21:15,520 --> 00:21:18,080
the machine think that it's um

627
00:21:18,080 --> 00:21:19,120
just uh

628
00:21:19,120 --> 00:21:20,240
you know you're just putting a ticket

629
00:21:20,240 --> 00:21:22,400
through and take the data raw off the

630
00:21:22,400 --> 00:21:23,760
mag stripe bus

631
00:21:23,760 --> 00:21:24,880
so

632
00:21:24,880 --> 00:21:27,919
um it does it's a 12 volt system so you

633
00:21:27,919 --> 00:21:29,120
can

634
00:21:29,120 --> 00:21:32,159
just feed the motors here with 12 volts

635
00:21:32,159 --> 00:21:34,240
and stick a ticket in

636
00:21:34,240 --> 00:21:35,760
that end and it will just run through

637
00:21:35,760 --> 00:21:37,520
the transport mechanism

638
00:21:37,520 --> 00:21:39,200
when you have it turned on the right way

639
00:21:39,200 --> 00:21:40,960
if you turn it on minus 12 volts it will

640
00:21:40,960 --> 00:21:42,640
go the other way back

641
00:21:42,640 --> 00:21:44,640
and that means that you can then get

642
00:21:44,640 --> 00:21:46,640
some data out because as you can see we

643
00:21:46,640 --> 00:21:47,840
have um

644
00:21:47,840 --> 00:21:48,720
some

645
00:21:48,720 --> 00:21:50,960
patch leads into the mag stripe uh

646
00:21:50,960 --> 00:21:53,440
reader output um and as long as it's

647
00:21:53,440 --> 00:21:55,200
connected to the main board and you give

648
00:21:55,200 --> 00:21:57,120
the main board the correct voltage so it

649
00:21:57,120 --> 00:21:58,720
starts

650
00:21:58,720 --> 00:22:01,039
it will do some magical stuff to

651
00:22:01,039 --> 00:22:02,640
initialize this

652
00:22:02,640 --> 00:22:04,480
daughter board in here which has the

653
00:22:04,480 --> 00:22:07,360
reader and you get data which looks a

654
00:22:07,360 --> 00:22:09,120
bit like this

655
00:22:09,120 --> 00:22:10,159
so

656
00:22:10,159 --> 00:22:11,200
that is

657
00:22:11,200 --> 00:22:13,360
looking kind of useful we can see at the

658
00:22:13,360 --> 00:22:14,960
top we have the clock at the bottom we

659
00:22:14,960 --> 00:22:16,159
have data

660
00:22:16,159 --> 00:22:18,559
um but again how do we get that off in

661
00:22:18,559 --> 00:22:20,880
the oscilloscope oscilloscope is not

662
00:22:20,880 --> 00:22:24,080
very useful for 192 bits of magstrike

663
00:22:24,080 --> 00:22:25,600
data

664
00:22:25,600 --> 00:22:27,120
there is something called

665
00:22:27,120 --> 00:22:29,919
the screen capture for the uh rigel

666
00:22:29,919 --> 00:22:30,960
scopes

667
00:22:30,960 --> 00:22:32,400
it does work quite well it gives you

668
00:22:32,400 --> 00:22:35,840
this a massive csv of voltages

669
00:22:35,840 --> 00:22:37,440
but that's actually

670
00:22:37,440 --> 00:22:39,039
really quite difficult to interpret what

671
00:22:39,039 --> 00:22:40,880
you're looking for is to align the

672
00:22:40,880 --> 00:22:42,320
rising edge of a clock with the rising

673
00:22:42,320 --> 00:22:44,720
edge of the data byte and then the

674
00:22:44,720 --> 00:22:45,919
falling edge of the clock with the

675
00:22:45,919 --> 00:22:47,760
falling edge of a data byte

676
00:22:47,760 --> 00:22:49,520
actually quite difficult to do and you

677
00:22:49,520 --> 00:22:51,520
end up with data that looks like this it

678
00:22:51,520 --> 00:22:53,520
does not look like the data that we

679
00:22:53,520 --> 00:22:56,960
expect is not 192 bits and it definitely

680
00:22:56,960 --> 00:22:59,440
doesn't really have any pattern to it

681
00:22:59,440 --> 00:23:01,280
it's fairly random

682
00:23:01,280 --> 00:23:04,159
um this was also the point where i

683
00:23:04,159 --> 00:23:06,559
accidentally misread at the back of the

684
00:23:06,559 --> 00:23:07,520
machine

685
00:23:07,520 --> 00:23:08,400
the

686
00:23:08,400 --> 00:23:12,559
the ticket printer and put 240 volts ac

687
00:23:12,559 --> 00:23:15,760
into the 24 volts dc

688
00:23:15,760 --> 00:23:18,320
so it went bang quite loudly

689
00:23:18,320 --> 00:23:20,400
made a lot of magic smoke

690
00:23:20,400 --> 00:23:22,080
but luckily as i say these are readily

691
00:23:22,080 --> 00:23:23,840
available on ebay so

692
00:23:23,840 --> 00:23:26,080
you know you can buy another one

693
00:23:26,080 --> 00:23:27,919
um which is the one i was holding up a

694
00:23:27,919 --> 00:23:30,000
minute ago and

695
00:23:30,000 --> 00:23:31,520
do it again so this one does actually

696
00:23:31,520 --> 00:23:33,039
have roms that you can take off it's a

697
00:23:33,039 --> 00:23:35,280
slightly older one it has bodge wires on

698
00:23:35,280 --> 00:23:37,120
the back so i guess they're fairly low

699
00:23:37,120 --> 00:23:38,159
volume

700
00:23:38,159 --> 00:23:40,559
um and with a bit of

701
00:23:40,559 --> 00:23:42,640
faffing around with the micro

702
00:23:42,640 --> 00:23:45,200
python circuit python um

703
00:23:45,200 --> 00:23:47,440
literally all it does is it just checks

704
00:23:47,440 --> 00:23:49,360
for rising and pulling edges

705
00:23:49,360 --> 00:23:51,039
it's just much easier to do it on an

706
00:23:51,039 --> 00:23:53,919
embedded device than with um

707
00:23:53,919 --> 00:23:56,640
with a csv of

708
00:23:56,640 --> 00:23:59,039
like screen capture data from the scope

709
00:23:59,039 --> 00:24:00,480
you can actually get data that looks

710
00:24:00,480 --> 00:24:03,600
about right so this is ticket data

711
00:24:03,600 --> 00:24:05,200
um from a random ticket that i put

712
00:24:05,200 --> 00:24:06,240
through

713
00:24:06,240 --> 00:24:08,000
you can see there we have the clock sync

714
00:24:08,000 --> 00:24:10,000
bikes we have a start start forward

715
00:24:10,000 --> 00:24:12,400
indicator one zero zero one and the

716
00:24:12,400 --> 00:24:16,000
reverse we have zeros and four ones

717
00:24:16,000 --> 00:24:17,520
nice looks good

718
00:24:17,520 --> 00:24:18,400
so

719
00:24:18,400 --> 00:24:19,919
what i did is i put a load of travel

720
00:24:19,919 --> 00:24:21,360
cards through it so a travel card is

721
00:24:21,360 --> 00:24:23,279
like a type of ticket in the uk

722
00:24:23,279 --> 00:24:24,080
so

723
00:24:24,080 --> 00:24:26,000
i put them through and you can see they

724
00:24:26,000 --> 00:24:27,520
kind of align right

725
00:24:27,520 --> 00:24:29,279
so we're obviously getting valid data

726
00:24:29,279 --> 00:24:30,080
now

727
00:24:30,080 --> 00:24:32,159
um you can see where stuff has gone

728
00:24:32,159 --> 00:24:35,200
wrong that's i know the code on that is

729
00:24:35,200 --> 00:24:36,480
not particularly

730
00:24:36,480 --> 00:24:38,320
particularly great sometimes it goes a

731
00:24:38,320 --> 00:24:41,279
bit too slow a bit too fast um yeah

732
00:24:41,279 --> 00:24:43,279
sometimes you get bad reads

733
00:24:43,279 --> 00:24:45,039
uh but you can remove those you can

734
00:24:45,039 --> 00:24:46,880
identify them fairly easily

735
00:24:46,880 --> 00:24:48,080
and then you can start doing some

736
00:24:48,080 --> 00:24:50,080
comparisons so

737
00:24:50,080 --> 00:24:51,840
here you can see

738
00:24:51,840 --> 00:24:53,840
uh at the very bottom we have two

739
00:24:53,840 --> 00:24:56,240
tickets from so reading to hook they're

740
00:24:56,240 --> 00:24:58,799
like towns in the uk

741
00:24:58,799 --> 00:25:00,480
and hook two headings and you can see

742
00:25:00,480 --> 00:25:02,400
that one of those strings those sub

743
00:25:02,400 --> 00:25:04,960
strings this is truncated obviously um

744
00:25:04,960 --> 00:25:06,559
is repeated in the data it's not

745
00:25:06,559 --> 00:25:08,480
repeated anywhere else in that string

746
00:25:08,480 --> 00:25:10,640
but that looks kind of like a start and

747
00:25:10,640 --> 00:25:12,480
an end like where i would start my

748
00:25:12,480 --> 00:25:14,159
journey where i would end my journey so

749
00:25:14,159 --> 00:25:15,600
presumably

750
00:25:15,600 --> 00:25:18,320
the reading that that money's reading

751
00:25:18,320 --> 00:25:20,159
and it's transposed there to say you're

752
00:25:20,159 --> 00:25:21,679
coming back

753
00:25:21,679 --> 00:25:23,360
because it's a return ticket

754
00:25:23,360 --> 00:25:26,159
and they're two separate tickets

755
00:25:26,159 --> 00:25:29,279
and you can see here uh again we have

756
00:25:29,279 --> 00:25:31,440
uh this this is a uh different ticket

757
00:25:31,440 --> 00:25:35,120
here uh from oxford uh it's a return um

758
00:25:35,120 --> 00:25:36,480
and again you can see in the return

759
00:25:36,480 --> 00:25:38,880
field um that the uh

760
00:25:38,880 --> 00:25:41,919
the reading part is again set similarly

761
00:25:41,919 --> 00:25:43,919
so it looks like we can actually read

762
00:25:43,919 --> 00:25:46,559
data and it looks like

763
00:25:46,559 --> 00:25:48,480
it is actually validator which is really

764
00:25:48,480 --> 00:25:50,000
good um

765
00:25:50,000 --> 00:25:51,520
because these are really difficult

766
00:25:51,520 --> 00:25:52,720
tickets to read

767
00:25:52,720 --> 00:25:54,000
as i mentioned

768
00:25:54,000 --> 00:25:56,880
and again you know the inverse is true

769
00:25:56,880 --> 00:25:58,240
so what do these

770
00:25:58,240 --> 00:26:00,240
bytes actually mean

771
00:26:00,240 --> 00:26:02,000
so

772
00:26:02,000 --> 00:26:04,240
on the left on the far right you can see

773
00:26:04,240 --> 00:26:05,840
the national location codes for those

774
00:26:05,840 --> 00:26:08,240
stations so three one four nine with

775
00:26:08,240 --> 00:26:10,640
some zeros is reading et cetera

776
00:26:10,640 --> 00:26:12,880
those are the strings the substrings

777
00:26:12,880 --> 00:26:15,840
extracted from some tickets i don't

778
00:26:15,840 --> 00:26:18,159
quite know how they map i think they map

779
00:26:18,159 --> 00:26:20,240
in some sort of proprietary way

780
00:26:20,240 --> 00:26:22,159
but you know

781
00:26:22,159 --> 00:26:24,000
we we will work that out at some point

782
00:26:24,000 --> 00:26:25,279
in the future

783
00:26:25,279 --> 00:26:26,159
and

784
00:26:26,159 --> 00:26:27,600
when you look at this on the sort of

785
00:26:27,600 --> 00:26:28,960
bigger scale

786
00:26:28,960 --> 00:26:30,400
looking across the whole data you can

787
00:26:30,400 --> 00:26:32,559
definitely start to see patterns um i

788
00:26:32,559 --> 00:26:34,080
don't think this comes out very well but

789
00:26:34,080 --> 00:26:37,679
the green block um is all set to zeros

790
00:26:37,679 --> 00:26:40,400
um and the red block is um some bit

791
00:26:40,400 --> 00:26:41,600
valid data

792
00:26:41,600 --> 00:26:43,600
uh for the type of ticket that they are

793
00:26:43,600 --> 00:26:45,360
we when you sort of start to look at

794
00:26:45,360 --> 00:26:47,840
this across tens hundreds thousands of

795
00:26:47,840 --> 00:26:50,240
tickets um it's actually really easy to

796
00:26:50,240 --> 00:26:53,679
start seeing the patterns here and it is

797
00:26:53,679 --> 00:26:55,520
probably possible to reverse and

798
00:26:55,520 --> 00:26:57,520
engineer quite a lot of

799
00:26:57,520 --> 00:27:00,000
exactly what this data does

800
00:27:00,000 --> 00:27:03,200
so what did i learn by doing this um

801
00:27:03,200 --> 00:27:06,640
this is not encrypted it is raw data

802
00:27:06,640 --> 00:27:08,480
which isn't surprising from the era they

803
00:27:08,480 --> 00:27:10,400
didn't really do encryption

804
00:27:10,400 --> 00:27:12,320
and there wasn't really a huge need for

805
00:27:12,320 --> 00:27:13,120
it

806
00:27:13,120 --> 00:27:14,720
but there is this checksum so as i

807
00:27:14,720 --> 00:27:17,279
mentioned at the end there is a checksum

808
00:27:17,279 --> 00:27:20,159
for data validity purposes

809
00:27:20,159 --> 00:27:21,679
we don't know how to calculate that it's

810
00:27:21,679 --> 00:27:23,520
not public i guess if you get enough

811
00:27:23,520 --> 00:27:25,760
tickets you can work out how to do that

812
00:27:25,760 --> 00:27:27,760
but it's not something that

813
00:27:27,760 --> 00:27:30,159
currently is is public or particularly

814
00:27:30,159 --> 00:27:31,919
public knowledge

815
00:27:31,919 --> 00:27:33,360
as i say pattern matching is really

816
00:27:33,360 --> 00:27:34,960
really doable when you start getting a

817
00:27:34,960 --> 00:27:37,840
huge number of these tickets and you

818
00:27:37,840 --> 00:27:40,480
could start to actually

819
00:27:40,480 --> 00:27:42,960
as i say probably reverse engineer

820
00:27:42,960 --> 00:27:44,799
what what is going on

821
00:27:44,799 --> 00:27:45,679
um

822
00:27:45,679 --> 00:27:47,200
the ticket printers should not be on

823
00:27:47,200 --> 00:27:49,840
ebay i think that they are fairly

824
00:27:49,840 --> 00:27:52,000
controlled items i don't quite know how

825
00:27:52,000 --> 00:27:54,240
they're ending up on ebay but when you

826
00:27:54,240 --> 00:27:56,960
have one of these it is possible to just

827
00:27:56,960 --> 00:27:59,200
use it to write these really obscure

828
00:27:59,200 --> 00:28:01,200
tickets you can just get one read it and

829
00:28:01,200 --> 00:28:02,960
write the data to another

830
00:28:02,960 --> 00:28:05,440
and if you know um

831
00:28:05,440 --> 00:28:07,120
say like something like a season ticket

832
00:28:07,120 --> 00:28:09,600
which is valid for a year you could

833
00:28:09,600 --> 00:28:11,360
duplicate that on one of these fairly

834
00:28:11,360 --> 00:28:12,720
easily it's not difficult you don't need

835
00:28:12,720 --> 00:28:14,240
to know what the data is to duplicate

836
00:28:14,240 --> 00:28:17,520
one of those so i don't think

837
00:28:17,520 --> 00:28:19,600
these should be ending up like so easily

838
00:28:19,600 --> 00:28:21,679
on ebay because it would make

839
00:28:21,679 --> 00:28:23,840
duplicating tickets really quite

840
00:28:23,840 --> 00:28:25,919
not difficult at all um of course you

841
00:28:25,919 --> 00:28:27,360
can't change the data without knowing

842
00:28:27,360 --> 00:28:29,600
how to recalculate the checksum but you

843
00:28:29,600 --> 00:28:31,760
know that's not not always

844
00:28:31,760 --> 00:28:33,279
a requirement

845
00:28:33,279 --> 00:28:34,320
and yes

846
00:28:34,320 --> 00:28:38,240
24 volts dcn does not mean mains voltage

847
00:28:38,240 --> 00:28:40,159
that causes bad things

848
00:28:40,159 --> 00:28:42,399
so what can you do next with this so you

849
00:28:42,399 --> 00:28:44,960
know if you get loads of data you could

850
00:28:44,960 --> 00:28:46,640
do a better job of reverse engineering

851
00:28:46,640 --> 00:28:48,000
it um

852
00:28:48,000 --> 00:28:50,080
i did this in a couple of

853
00:28:50,080 --> 00:28:53,600
weeks before emf and then after emf

854
00:28:53,600 --> 00:28:55,760
i did planning for mch so i haven't

855
00:28:55,760 --> 00:28:59,120
really done anything else with this um

856
00:28:59,120 --> 00:29:01,039
the thing like the data clock alignment

857
00:29:01,039 --> 00:29:03,120
is a bit of a problem it's a bit sketchy

858
00:29:03,120 --> 00:29:05,679
i think it sits in random bytes um every

859
00:29:05,679 --> 00:29:07,440
so often because it's not really very

860
00:29:07,440 --> 00:29:08,559
advanced

861
00:29:08,559 --> 00:29:10,559
um things like blast and faster they're

862
00:29:10,559 --> 00:29:12,480
used for bioinformatics they can

863
00:29:12,480 --> 00:29:14,159
definitely be used to align some of

864
00:29:14,159 --> 00:29:15,760
these strings and particularly

865
00:29:15,760 --> 00:29:17,279
substrings so when you're searching

866
00:29:17,279 --> 00:29:19,200
through thousands of

867
00:29:19,200 --> 00:29:20,640
rows of data

868
00:29:20,640 --> 00:29:22,720
you should be able to

869
00:29:22,720 --> 00:29:24,559
use those tools if you can work out how

870
00:29:24,559 --> 00:29:26,320
to load the data into it in the first

871
00:29:26,320 --> 00:29:27,760
place

872
00:29:27,760 --> 00:29:30,799
pretending it's like dna

873
00:29:30,799 --> 00:29:32,320
you should be able to use those to speed

874
00:29:32,320 --> 00:29:33,679
this up a bit

875
00:29:33,679 --> 00:29:35,039
dumping the roms is something that's on

876
00:29:35,039 --> 00:29:36,480
my list to do it'd be really interesting

877
00:29:36,480 --> 00:29:38,159
to see the software that's on this and

878
00:29:38,159 --> 00:29:40,399
how exactly it's supposed to work again

879
00:29:40,399 --> 00:29:43,200
there's no documentation for it um and

880
00:29:43,200 --> 00:29:45,120
writing these tickets as i say you can

881
00:29:45,120 --> 00:29:46,480
use these to write the tickets i haven't

882
00:29:46,480 --> 00:29:48,880
done it yet um but it should be pretty

883
00:29:48,880 --> 00:29:49,919
easy

884
00:29:49,919 --> 00:29:52,080
it has the the hardware there you just

885
00:29:52,080 --> 00:29:53,200
need to

886
00:29:53,200 --> 00:29:55,440
reverse the process of reading it

887
00:29:55,440 --> 00:29:57,840
um i have like

888
00:29:57,840 --> 00:30:00,080
five seconds left so

889
00:30:00,080 --> 00:30:02,640
things like iso it's so and e-ticket are

890
00:30:02,640 --> 00:30:05,200
the supposed replacement for these it so

891
00:30:05,200 --> 00:30:08,799
has its own problems he took it again as

892
00:30:08,799 --> 00:30:11,520
several other issues with it

893
00:30:11,520 --> 00:30:14,480
we currently don't have a replacement

894
00:30:14,480 --> 00:30:16,480
the government has not decided on

895
00:30:16,480 --> 00:30:18,799
anything to do about this they are still

896
00:30:18,799 --> 00:30:20,880
issuing orange tickets on credit card

897
00:30:20,880 --> 00:30:22,080
mag stripe tickets and they will

898
00:30:22,080 --> 00:30:23,520
continue to do so for the foreseeable

899
00:30:23,520 --> 00:30:25,600
future as we can see they are not

900
00:30:25,600 --> 00:30:27,760
particularly secure and it's really

901
00:30:27,760 --> 00:30:30,240
quite easy to read and potentially write

902
00:30:30,240 --> 00:30:31,200
them now

903
00:30:31,200 --> 00:30:34,240
um the specification for these i i am

904
00:30:34,240 --> 00:30:36,399
told floats around on the internet so it

905
00:30:36,399 --> 00:30:40,080
is kind of public knowledge now uh

906
00:30:40,080 --> 00:30:41,200
yeah

907
00:30:41,200 --> 00:30:42,960
i think this is probably a bad thing i

908
00:30:42,960 --> 00:30:44,159
think someone should probably do

909
00:30:44,159 --> 00:30:46,720
something about it uh because

910
00:30:46,720 --> 00:30:48,240
we

911
00:30:48,240 --> 00:30:50,080
these are common in circulation in the

912
00:30:50,080 --> 00:30:52,320
uk you use an orange ticket for pretty

913
00:30:52,320 --> 00:30:53,679
much every journey

914
00:30:53,679 --> 00:30:54,559
and

915
00:30:54,559 --> 00:30:57,760
uh they are now really really quite easy

916
00:30:57,760 --> 00:30:59,840
uh and out of date

917
00:30:59,840 --> 00:31:00,640
and

918
00:31:00,640 --> 00:31:02,000
yeah

919
00:31:02,000 --> 00:31:06,480
i think that's pretty much it thank you

920
00:31:11,200 --> 00:31:13,440
cool

921
00:31:14,080 --> 00:31:16,080
unfortunately there's no time left for a

922
00:31:16,080 --> 00:31:18,559
q a a public q a here if you have

923
00:31:18,559 --> 00:31:21,200
questions about this amazing talk by you

924
00:31:21,200 --> 00:31:24,000
you can look him up outside the tent

925
00:31:24,000 --> 00:31:26,240
after this talk

926
00:31:26,240 --> 00:31:31,080
once again give it up for you thank you

927
00:31:39,120 --> 00:31:41,199
you

