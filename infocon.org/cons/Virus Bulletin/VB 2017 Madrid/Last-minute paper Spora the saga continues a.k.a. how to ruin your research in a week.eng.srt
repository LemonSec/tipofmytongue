1
00:00:00,030 --> 00:00:03,990
okay hello everyone as has been said I'm

2
00:00:03,990 --> 00:00:08,820
acoustic from a bust this is a lot

3
00:00:08,820 --> 00:00:11,309
kuransky we used to be colleagues but

4
00:00:11,309 --> 00:00:15,199
right now it is a joint presentation and

5
00:00:15,199 --> 00:00:18,740
you may be wondering why such a silly

6
00:00:18,740 --> 00:00:22,199
subtitle of this presentation to be

7
00:00:22,199 --> 00:00:24,480
honest we already had one presentation

8
00:00:24,480 --> 00:00:26,640
about spora this year during the

9
00:00:26,640 --> 00:00:29,090
conference maybe some of you attended

10
00:00:29,090 --> 00:00:34,050
anyone oh right so I hope you will enjoy

11
00:00:34,050 --> 00:00:38,040
it even this part too and the motivation

12
00:00:38,040 --> 00:00:40,620
for this presentation is that suddenly

13
00:00:40,620 --> 00:00:43,290
after our presentation everything has

14
00:00:43,290 --> 00:00:45,320
changed

15
00:00:46,280 --> 00:00:50,129
once again I'm from I was previously

16
00:00:50,129 --> 00:00:53,100
from AVG I'm in this industry not that

17
00:00:53,100 --> 00:00:55,289
long for seven years I'm mostly

18
00:00:55,289 --> 00:00:59,309
interested in ransomware and providing

19
00:00:59,309 --> 00:01:01,530
the free decryption tools but I love

20
00:01:01,530 --> 00:01:06,689
also the other kinds of malware hi my

21
00:01:06,689 --> 00:01:09,180
name is eric kieron ski I've been in the

22
00:01:09,180 --> 00:01:13,470
AV industry for 12 years mostly with AVG

23
00:01:13,470 --> 00:01:17,100
where I started as a software developer

24
00:01:17,100 --> 00:01:19,979
and later on I was responsible for the

25
00:01:19,979 --> 00:01:23,130
behavioral detection and then I was with

26
00:01:23,130 --> 00:01:26,670
a vast and recently I joined the ESET as

27
00:01:26,670 --> 00:01:30,020
head of core technology development

28
00:01:30,020 --> 00:01:36,509
sorry the agent of this presentation as

29
00:01:36,509 --> 00:01:39,960
I said the first part we need to recap

30
00:01:39,960 --> 00:01:42,899
some of our findings from the Cairo

31
00:01:42,899 --> 00:01:44,790
conference we will try to make it short

32
00:01:44,790 --> 00:01:47,189
but some of these details are necessary

33
00:01:47,189 --> 00:01:50,820
for the later part where we depict the

34
00:01:50,820 --> 00:01:53,009
complete changelog of Sporus since its

35
00:01:53,009 --> 00:01:56,100
very first version and because every

36
00:01:56,100 --> 00:01:58,200
presentation needs some statistics right

37
00:01:58,200 --> 00:02:01,920
we will provide some of them all right

38
00:02:01,920 --> 00:02:04,860
so why is for interesting first of all

39
00:02:04,860 --> 00:02:07,020
it's one of the first runs firmware

40
00:02:07,020 --> 00:02:12,030
that's our new trademark here and but

41
00:02:12,030 --> 00:02:13,319
really so

42
00:02:13,319 --> 00:02:16,140
it was it started to spread from Russia

43
00:02:16,140 --> 00:02:18,690
which was which was quite uncommon

44
00:02:18,690 --> 00:02:22,260
because most of the ransomware

45
00:02:22,260 --> 00:02:24,810
try to avoid Russia and the post-soviet

46
00:02:24,810 --> 00:02:27,239
countries so that was that was one of

47
00:02:27,239 --> 00:02:28,709
the things that made Spore a really

48
00:02:28,709 --> 00:02:32,280
interesting also it was from the

49
00:02:32,280 --> 00:02:35,160
beginning of designed to be fully

50
00:02:35,160 --> 00:02:39,500
offline so it never had any CNC servers

51
00:02:39,500 --> 00:02:45,599
or whatsoever and and it had a very

52
00:02:45,599 --> 00:02:48,629
simple and minimalistic design an

53
00:02:48,629 --> 00:02:51,390
effective code - and some interesting

54
00:02:51,390 --> 00:02:54,299
business models we will talk about those

55
00:02:54,299 --> 00:02:57,239
later and and the most important thing

56
00:02:57,239 --> 00:03:00,120
is that they got the encryption right

57
00:03:00,120 --> 00:03:02,430
from the beginning it's not perfect but

58
00:03:02,430 --> 00:03:04,859
it's good enough so it's it's it's so

59
00:03:04,859 --> 00:03:08,340
far unbreakable yeah so this is the

60
00:03:08,340 --> 00:03:13,859
recap about spreading spora love scripts

61
00:03:13,859 --> 00:03:17,599
scripts of all kinds java scripts HD a

62
00:03:17,599 --> 00:03:21,230
windows script files VBS you name it

63
00:03:21,230 --> 00:03:24,930
usually they are spreading spora in a

64
00:03:24,930 --> 00:03:28,139
way that the scripts contain the actual

65
00:03:28,139 --> 00:03:30,150
payload which is the spore executable

66
00:03:30,150 --> 00:03:32,310
over another script that contains the

67
00:03:32,310 --> 00:03:34,709
Spore executable which is somehow

68
00:03:34,709 --> 00:03:37,650
obfuscated it can be encoded it can be

69
00:03:37,650 --> 00:03:42,000
cryptid whatever sometimes they drop

70
00:03:42,000 --> 00:03:44,510
from this script also a decoy document

71
00:03:44,510 --> 00:03:48,530
just to look more legit

72
00:03:48,530 --> 00:03:52,620
also there was a chrome phone or Hoffler

73
00:03:52,620 --> 00:03:55,709
phone campaign that is still in still in

74
00:03:55,709 --> 00:03:57,780
use and still running that they used to

75
00:03:57,780 --> 00:04:02,190
spread the payloads and the days

76
00:04:02,190 --> 00:04:04,200
sometimes have creative crypt usage too

77
00:04:04,200 --> 00:04:07,470
so just real pretty quickly this is the

78
00:04:07,470 --> 00:04:11,220
first spreading mechanism that we saw

79
00:04:11,220 --> 00:04:15,180
which poor odds pretty simple just a zip

80
00:04:15,180 --> 00:04:16,589
attachment in

81
00:04:16,589 --> 00:04:18,750
in the mail that will drop you an HD a

82
00:04:18,750 --> 00:04:20,730
file that will drop you a highly

83
00:04:20,730 --> 00:04:23,100
obfuscated J's file that will drop you a

84
00:04:23,100 --> 00:04:25,790
decoy document and the spore executable

85
00:04:25,790 --> 00:04:30,690
this is the hofler font scheme it's just

86
00:04:30,690 --> 00:04:34,470
a trick they trick the user basically to

87
00:04:34,470 --> 00:04:38,340
to believe they are installing a missing

88
00:04:38,340 --> 00:04:40,880
font instead of that they are basically

89
00:04:40,880 --> 00:04:44,310
downloading and running the actual Spore

90
00:04:44,310 --> 00:04:47,430
executable yeah and the creative script

91
00:04:47,430 --> 00:04:50,010
usage this may look like a header of a

92
00:04:50,010 --> 00:04:54,750
PE file and it is a PE file but in the

93
00:04:54,750 --> 00:04:58,290
overlay it has an H th script so this

94
00:04:58,290 --> 00:04:59,700
was one of the things that they used

95
00:04:59,700 --> 00:05:03,360
also and I don't know why but this file

96
00:05:03,360 --> 00:05:06,150
is an HT a and the PE file in one you

97
00:05:06,150 --> 00:05:09,900
can you can run it as an HT a if you see

98
00:05:09,900 --> 00:05:15,750
it will just run itself through CNBC and

99
00:05:15,750 --> 00:05:20,370
it's an actual B file - yeah those

100
00:05:20,370 --> 00:05:22,800
scripts who love script no one but

101
00:05:22,800 --> 00:05:25,110
what's most important is the PE file

102
00:05:25,110 --> 00:05:28,410
right what's inside of spora executable

103
00:05:28,410 --> 00:05:31,440
most of its versions Purab behaved like

104
00:05:31,440 --> 00:05:34,380
some kind of twisted finite state

105
00:05:34,380 --> 00:05:37,410
machine which tried to travel from the

106
00:05:37,410 --> 00:05:41,580
initial state encrypt some files do some

107
00:05:41,580 --> 00:05:44,760
spreading and finally exit with your pc

108
00:05:44,760 --> 00:05:47,490
being unusable there was some

109
00:05:47,490 --> 00:05:49,710
interesting fact that spora was able to

110
00:05:49,710 --> 00:05:52,680
resume its execution from the last

111
00:05:52,680 --> 00:05:55,560
executed state so it was some

112
00:05:55,560 --> 00:05:58,380
somehow context-aware how was that

113
00:05:58,380 --> 00:06:01,470
possible spur I used four different

114
00:06:01,470 --> 00:06:05,370
types of files to store its details

115
00:06:05,370 --> 00:06:07,260
about the infected machine and the

116
00:06:07,260 --> 00:06:09,479
others it was a state file which is our

117
00:06:09,479 --> 00:06:12,360
naming which contains most importantly

118
00:06:12,360 --> 00:06:15,450
the last executed state also the list

119
00:06:15,450 --> 00:06:18,539
file which contained the list of files

120
00:06:18,539 --> 00:06:20,550
that will be encrypted or that were

121
00:06:20,550 --> 00:06:23,639
already encrypted the key file with a

122
00:06:23,639 --> 00:06:26,039
unique description of each victim

123
00:06:26,039 --> 00:06:28,500
and finally neurons on payment nodes

124
00:06:28,500 --> 00:06:29,940
inside of

125
00:06:29,940 --> 00:06:32,670
htm' of most of the time in software

126
00:06:32,670 --> 00:06:36,420
inside of the HTML there was one

127
00:06:36,420 --> 00:06:39,240
important record we call it victim

128
00:06:39,240 --> 00:06:42,020
record which contained most of the

129
00:06:42,020 --> 00:06:46,680
necessary decryption keys the state file

130
00:06:46,680 --> 00:06:50,580
the first one was quite easy to be used

131
00:06:50,580 --> 00:06:54,090
for detection of spora and we did that

132
00:06:54,090 --> 00:06:56,670
it is located inside of your update a

133
00:06:56,670 --> 00:06:59,580
roaming directory with the name derived

134
00:06:59,580 --> 00:07:01,680
from volume serial number of your drive

135
00:07:01,680 --> 00:07:04,440
and inside of this encrypted file

136
00:07:04,440 --> 00:07:07,860
encrypted because spora allowed set of

137
00:07:07,860 --> 00:07:10,140
scripts but it also lost encryption and

138
00:07:10,140 --> 00:07:12,930
everything is encrypted so it contains

139
00:07:12,930 --> 00:07:15,840
the last executed state as well as some

140
00:07:15,840 --> 00:07:19,440
of the encryption keys the other file

141
00:07:19,440 --> 00:07:23,010
the list file contains files that will

142
00:07:23,010 --> 00:07:23,870
be encrypted

143
00:07:23,870 --> 00:07:27,690
spora chooses those files based on their

144
00:07:27,690 --> 00:07:30,020
extension just like any other ransomware

145
00:07:30,020 --> 00:07:33,210
what is interesting about spora it will

146
00:07:33,210 --> 00:07:36,000
calculate your ransom payment based on a

147
00:07:36,000 --> 00:07:39,000
number of files that are encrypted in

148
00:07:39,000 --> 00:07:44,370
each group and the victim record as I

149
00:07:44,370 --> 00:07:48,810
said this is the pure gold of spora

150
00:07:48,810 --> 00:07:52,860
it contains the local RSA private key

151
00:07:52,860 --> 00:07:55,169
this is mostly important this complete

152
00:07:55,169 --> 00:07:58,410
record for ransom our operators to at

153
00:07:58,410 --> 00:08:00,900
first calculate your ransom payment and

154
00:08:00,900 --> 00:08:05,100
also after extracting this key they will

155
00:08:05,100 --> 00:08:07,620
be able to provide you a paid decryption

156
00:08:07,620 --> 00:08:11,310
tool enough about those four files

157
00:08:11,310 --> 00:08:14,730
what spora does with your files that

158
00:08:14,730 --> 00:08:17,220
will be encrypted sapore use a script

159
00:08:17,220 --> 00:08:19,980
API for everything started from

160
00:08:19,980 --> 00:08:23,340
generation of keys encryption export of

161
00:08:23,340 --> 00:08:26,040
keys all of them by using crypto ok so

162
00:08:26,040 --> 00:08:28,290
spora executables are really tiny

163
00:08:28,290 --> 00:08:30,810
because there are no other external

164
00:08:30,810 --> 00:08:35,520
libraries the encryption was really

165
00:08:35,520 --> 00:08:39,150
solid from the first version so if I'm

166
00:08:39,150 --> 00:08:39,780
correct

167
00:08:39,780 --> 00:08:41,729
there are no free decryption tools

168
00:08:41,729 --> 00:08:42,729
available for

169
00:08:42,729 --> 00:08:46,440
fora no one was able to break it and

170
00:08:46,440 --> 00:08:48,670
there are some glitches in the

171
00:08:48,670 --> 00:08:50,920
encryption algorithm used across the

172
00:08:50,920 --> 00:08:53,230
spora code however those glitches are

173
00:08:53,230 --> 00:08:56,680
just small corner cases that cannot be

174
00:08:56,680 --> 00:08:59,610
used for providing a free decryption to

175
00:08:59,610 --> 00:09:03,399
each file encrypted by spora useless a

176
00:09:03,399 --> 00:09:07,029
unique randomly generated aes-256

177
00:09:07,029 --> 00:09:11,399
encryption key which will be after that

178
00:09:11,399 --> 00:09:14,110
appended to the encrypted file together

179
00:09:14,110 --> 00:09:16,899
with some chicks some for checking

180
00:09:16,899 --> 00:09:18,760
whether the file was already encrypted

181
00:09:18,760 --> 00:09:22,990
or not so they use some kind of safe

182
00:09:22,990 --> 00:09:24,970
coding to protect the files for being

183
00:09:24,970 --> 00:09:29,110
encrypted again I skipped some of the

184
00:09:29,110 --> 00:09:31,930
states which we've described in detail

185
00:09:31,930 --> 00:09:33,490
at Carrow because those are not so

186
00:09:33,490 --> 00:09:36,370
important the last state I will mention

187
00:09:36,370 --> 00:09:39,550
is the link form spreading this is

188
00:09:39,550 --> 00:09:42,010
actually nothing new because the malware

189
00:09:42,010 --> 00:09:44,820
forms are using this technique for years

190
00:09:44,820 --> 00:09:48,990
it just means that spora tries to create

191
00:09:48,990 --> 00:09:52,870
shortcuts that look alike folders in

192
00:09:52,870 --> 00:09:55,810
your on your PC and if you double-click

193
00:09:55,810 --> 00:09:59,100
those shortcuts spora will be executed

194
00:09:59,100 --> 00:10:03,190
so actually those are all shortcuts and

195
00:10:03,190 --> 00:10:05,860
those are the original folders so they

196
00:10:05,860 --> 00:10:09,670
really look the same way by using this

197
00:10:09,670 --> 00:10:13,269
method spora tries to spread to all

198
00:10:13,269 --> 00:10:16,240
local drives but more importantly to

199
00:10:16,240 --> 00:10:18,279
network drives to flash drives so

200
00:10:18,279 --> 00:10:21,040
everyone everywhere this was actually

201
00:10:21,040 --> 00:10:23,709
quite new for ransomware

202
00:10:23,709 --> 00:10:27,519
so this was worm like spreading months

203
00:10:27,519 --> 00:10:30,040
before gonna cry so wanna cry was not

204
00:10:30,040 --> 00:10:34,240
the first worm in a case of run summer I

205
00:10:34,240 --> 00:10:36,760
think it was poorer but maybe there are

206
00:10:36,760 --> 00:10:40,870
also the others encryption madness used

207
00:10:40,870 --> 00:10:43,690
by spora bear with me please this will

208
00:10:43,690 --> 00:10:45,069
be a little bit technical

209
00:10:45,069 --> 00:10:47,889
I would like to depict how spora

210
00:10:47,889 --> 00:10:50,560
encrypts files so just imagine you've

211
00:10:50,560 --> 00:10:53,890
got your fancy new PC or your documents

212
00:10:53,890 --> 00:10:55,269
and suddenly you download its poor

213
00:10:55,269 --> 00:10:56,330
executable

214
00:10:56,330 --> 00:11:00,770
which contains a config this config is

215
00:11:00,770 --> 00:11:03,260
once again encrypted and it contains

216
00:11:03,260 --> 00:11:06,580
most importantly RSA master public key

217
00:11:06,580 --> 00:11:10,400
its private version is only owned by us

218
00:11:10,400 --> 00:11:13,370
power operators it will never reach the

219
00:11:13,370 --> 00:11:16,940
infected PC and after the executions

220
00:11:16,940 --> 00:11:19,820
pora will generate a new pair of RSA

221
00:11:19,820 --> 00:11:24,140
keys we call them local keys each of

222
00:11:24,140 --> 00:11:26,380
them is stored in a different location

223
00:11:26,380 --> 00:11:29,270
the public key is stored inside of the

224
00:11:29,270 --> 00:11:32,200
state file once again encrypted and

225
00:11:32,200 --> 00:11:35,090
private key is stored inside of ransom

226
00:11:35,090 --> 00:11:38,330
notes guess what it will be encrypted

227
00:11:38,330 --> 00:11:42,140
again this is really over complicated by

228
00:11:42,140 --> 00:11:46,030
spora operators they are using one-time

229
00:11:46,030 --> 00:11:49,850
AES key for encrypting this private key

230
00:11:49,850 --> 00:11:54,290
but if they they need to be able to

231
00:11:54,290 --> 00:11:56,720
decrypt it so they need to store this

232
00:11:56,720 --> 00:11:58,880
key once again inside over the ransom

233
00:11:58,880 --> 00:12:02,510
note but once again not in an plaint

234
00:12:02,510 --> 00:12:05,030
form but this will be encrypted by using

235
00:12:05,030 --> 00:12:08,660
the master public key so that's why it

236
00:12:08,660 --> 00:12:15,710
is transferred to the config so this

237
00:12:15,710 --> 00:12:18,410
this part is really over complicated we

238
00:12:18,410 --> 00:12:20,900
told us so at the Cairo conference and

239
00:12:20,900 --> 00:12:23,830
the other day they fix that

240
00:12:23,830 --> 00:12:27,680
but what's per our la loves to do is to

241
00:12:27,680 --> 00:12:29,510
encrypt your files of course it's around

242
00:12:29,510 --> 00:12:35,300
somewhere it uses a unique AES 256 key

243
00:12:35,300 --> 00:12:38,780
as I said for encrypting each file the

244
00:12:38,780 --> 00:12:41,030
key will be stored at the end of the

245
00:12:41,030 --> 00:12:43,630
file and once again it will be encrypted

246
00:12:43,630 --> 00:12:47,420
encrypted by what by the local RSA

247
00:12:47,420 --> 00:12:52,250
public key so really complex everything

248
00:12:52,250 --> 00:12:55,300
is encrypted encryption is everywhere

249
00:12:55,300 --> 00:12:58,700
the last missing part is how to provide

250
00:12:58,700 --> 00:13:02,060
a decryption tool all you need to do is

251
00:13:02,060 --> 00:13:04,520
to go to the payment page by

252
00:13:04,520 --> 00:13:07,210
double-clicking that HTML document and

253
00:13:07,210 --> 00:13:09,740
those victim records will be passed

254
00:13:09,740 --> 00:13:14,980
by using the HTTP GET or post request

255
00:13:14,980 --> 00:13:18,560
from there the outers of spora will be

256
00:13:18,560 --> 00:13:22,400
able to retrieve the RSA local private

257
00:13:22,400 --> 00:13:26,030
key by using their master key and they

258
00:13:26,030 --> 00:13:28,040
will be able to provide to the

259
00:13:28,040 --> 00:13:31,100
decryption tool so it's payment time

260
00:13:31,100 --> 00:13:35,930
yeah so spora authors did everything to

261
00:13:35,930 --> 00:13:41,199
have the payment from the UX perspective

262
00:13:42,400 --> 00:13:47,030
improve it and and so that the users

263
00:13:47,030 --> 00:13:48,950
don't have to install anything on the

264
00:13:48,950 --> 00:13:55,250
user's sorry victims yeah don't don't

265
00:13:55,250 --> 00:13:56,900
have to install anything on their

266
00:13:56,900 --> 00:14:00,260
computers the payment side itself is

267
00:14:00,260 --> 00:14:03,500
hosted in tour and they registered

268
00:14:03,500 --> 00:14:09,070
several proxy site proxy domains through

269
00:14:09,070 --> 00:14:13,880
which you can very easily access the de

270
00:14:13,880 --> 00:14:18,290
onion payment site yeah they were also

271
00:14:18,290 --> 00:14:20,660
using 25-meter come for for some time

272
00:14:20,660 --> 00:14:22,940
and now this this is this is really

273
00:14:22,940 --> 00:14:25,280
changing now this the the payment side

274
00:14:25,280 --> 00:14:27,530
is really really volatile right now

275
00:14:27,530 --> 00:14:30,170
because they are changing it so this is

276
00:14:30,170 --> 00:14:34,700
how it looked like at the beginning

277
00:14:34,700 --> 00:14:38,360
spora just dropped an HTML file that had

278
00:14:38,360 --> 00:14:40,970
amended all the information that they

279
00:14:40,970 --> 00:14:44,090
needed to calculate the ransom to

280
00:14:44,090 --> 00:14:47,390
decrypt your files and so on and so on

281
00:14:47,390 --> 00:14:51,590
there is the unique user ID and if you

282
00:14:51,590 --> 00:14:53,890
go further you you'll find this really

283
00:14:53,890 --> 00:14:58,210
nice nicely looking page they had it

284
00:14:58,210 --> 00:15:01,190
bilingual it was in Russian and in

285
00:15:01,190 --> 00:15:02,170
English

286
00:15:02,170 --> 00:15:06,890
you see they have a customer support

287
00:15:06,890 --> 00:15:09,200
they had like purchase you can purchase

288
00:15:09,200 --> 00:15:11,750
removal you can purchase immunity forest

289
00:15:11,750 --> 00:15:15,470
or decryption anything and you are

290
00:15:15,470 --> 00:15:19,040
paying with Bitcoin of course so this

291
00:15:19,040 --> 00:15:22,550
this is the past then they they change

292
00:15:22,550 --> 00:15:23,540
it a little bit

293
00:15:23,540 --> 00:15:26,389
so so the the initial ransom message

294
00:15:26,389 --> 00:15:31,370
looked like this only in Russia and when

295
00:15:31,370 --> 00:15:34,730
you go further you will see the payment

296
00:15:34,730 --> 00:15:37,370
side has also a slight redesign they

297
00:15:37,370 --> 00:15:39,980
started to use the spora dot help at

298
00:15:39,980 --> 00:15:45,860
gmail.com email address and this

299
00:15:45,860 --> 00:15:48,019
basically says drop here an encrypted

300
00:15:48,019 --> 00:15:50,870
file and I will tell you what you need

301
00:15:50,870 --> 00:15:54,589
to do and you get into this side

302
00:15:54,589 --> 00:15:57,069
notice the change there are only three

303
00:15:57,069 --> 00:15:59,990
purchase options right now so they

304
00:15:59,990 --> 00:16:04,130
basically removed the immunity and also

305
00:16:04,130 --> 00:16:05,959
I think the removal from that package

306
00:16:05,959 --> 00:16:08,660
and everything is in Russian you can

307
00:16:08,660 --> 00:16:10,550
cannot change the language back to

308
00:16:10,550 --> 00:16:16,459
English and if you encounter the new

309
00:16:16,459 --> 00:16:20,540
West spohrer variants samples you will

310
00:16:20,540 --> 00:16:23,569
most likely see this message this is an

311
00:16:23,569 --> 00:16:26,720
HD a script that were that will drop

312
00:16:26,720 --> 00:16:30,670
this message to you probably says

313
00:16:30,670 --> 00:16:35,560
contacts for adult help at gmail.com and

314
00:16:35,560 --> 00:16:38,540
the reason why why it's happening is

315
00:16:38,540 --> 00:16:41,360
they used that onion site that's the

316
00:16:41,360 --> 00:16:44,089
payment site actually in the HDA and

317
00:16:44,089 --> 00:16:46,610
they they proxy it through a proxy

318
00:16:46,610 --> 00:16:50,230
server that is most likely of fly

319
00:16:50,230 --> 00:16:52,399
currently so then they have a fallback

320
00:16:52,399 --> 00:16:56,959
to fall back to that message yeah and if

321
00:16:56,959 --> 00:16:58,819
you go to that onion side you see

322
00:16:58,819 --> 00:17:03,079
basically the redesign or or in progress

323
00:17:03,079 --> 00:17:05,720
payment side I would say and it has a

324
00:17:05,720 --> 00:17:09,530
nice message that says pora 2.0 so

325
00:17:09,530 --> 00:17:11,299
that's that's the second version it's

326
00:17:11,299 --> 00:17:13,490
non-functional currently so if you drop

327
00:17:13,490 --> 00:17:17,059
a encrypted file there they will tell

328
00:17:17,059 --> 00:17:19,880
you sorry an error in count we

329
00:17:19,880 --> 00:17:22,459
encountered an error send us an email to

330
00:17:22,459 --> 00:17:26,270
that email address okay so the Christian

331
00:17:26,270 --> 00:17:27,799
decryption is really simple the

332
00:17:27,799 --> 00:17:29,260
decryption tool is just a

333
00:17:29,260 --> 00:17:33,230
self-extracting archives that will drop

334
00:17:33,230 --> 00:17:36,540
you basically a Decrypter

335
00:17:36,540 --> 00:17:39,810
see your key that can be used for

336
00:17:39,810 --> 00:17:43,020
decrypting all your files and the CMD

337
00:17:43,020 --> 00:17:45,170
file that CMD file you can see here

338
00:17:45,170 --> 00:17:48,300
really simple because the the actual

339
00:17:48,300 --> 00:17:52,140
Decrypter exe only knows how to decrypt

340
00:17:52,140 --> 00:17:54,840
one file so they basically in the CMD

341
00:17:54,840 --> 00:17:57,390
they implemented the enumeration of all

342
00:17:57,390 --> 00:18:00,240
the local and network drives and all the

343
00:18:00,240 --> 00:18:03,930
targeted extensions and they try to

344
00:18:03,930 --> 00:18:07,890
decrypt every one every file on every

345
00:18:07,890 --> 00:18:13,470
Drive basically and the most interesting

346
00:18:13,470 --> 00:18:18,360
thing is immunization until until May it

347
00:18:18,360 --> 00:18:22,770
was it was oh you were able to immunize

348
00:18:22,770 --> 00:18:28,530
your computer against spora that'sthat's

349
00:18:28,530 --> 00:18:30,780
the immunity immunity package there it

350
00:18:30,780 --> 00:18:34,320
was really simple basically you have two

351
00:18:34,320 --> 00:18:36,480
options you either could create the

352
00:18:36,480 --> 00:18:38,580
mutex that they use that was generated

353
00:18:38,580 --> 00:18:43,950
from the volume volume ID or even better

354
00:18:43,950 --> 00:18:47,760
you could generate the state file and

355
00:18:47,760 --> 00:18:49,590
basically you could mark in the state

356
00:18:49,590 --> 00:18:51,810
file that you are in the last state so

357
00:18:51,810 --> 00:18:54,450
everything went okay and then if you

358
00:18:54,450 --> 00:18:57,060
place it in the directory spora will

359
00:18:57,060 --> 00:19:00,900
read it and say okay I'm done so I have

360
00:19:00,900 --> 00:19:03,500
nothing to do here

361
00:19:03,620 --> 00:19:08,160
so some recap about spora I've been

362
00:19:08,160 --> 00:19:10,890
digging deeper into spora and what I did

363
00:19:10,890 --> 00:19:14,550
was that I basically unpacked each poor

364
00:19:14,550 --> 00:19:16,590
executable that we've seen that means

365
00:19:16,590 --> 00:19:18,810
thousands of samples and extracted the

366
00:19:18,810 --> 00:19:23,730
inner packed samples from there I tried

367
00:19:23,730 --> 00:19:26,900
to extract the compiler the compilation

368
00:19:26,900 --> 00:19:30,150
timestamp this might be faked quite

369
00:19:30,150 --> 00:19:32,940
easily but I think that this is not what

370
00:19:32,940 --> 00:19:37,500
was done and I was able to restore some

371
00:19:37,500 --> 00:19:40,320
kind of unofficial change lock of Sporus

372
00:19:40,320 --> 00:19:43,410
comets I promise I'm not outer of Spira

373
00:19:43,410 --> 00:19:45,870
I don't have access to their gate or

374
00:19:45,870 --> 00:19:48,180
whatever repository they are using so

375
00:19:48,180 --> 00:19:49,360
this is only my

376
00:19:49,360 --> 00:19:51,850
library construction so everything

377
00:19:51,850 --> 00:19:54,240
started at the beginning of January

378
00:19:54,240 --> 00:20:00,490
where they released their bump new

379
00:20:00,490 --> 00:20:03,910
consumer out there and what is important

380
00:20:03,910 --> 00:20:06,309
to say is that everything was already

381
00:20:06,309 --> 00:20:09,070
included in it at the time it was using

382
00:20:09,070 --> 00:20:12,490
all those four files it was able to vibe

383
00:20:12,490 --> 00:20:15,070
your shadow copies it was able to spread

384
00:20:15,070 --> 00:20:19,140
like warm everything was in there

385
00:20:19,140 --> 00:20:22,270
another interesting fact is that since

386
00:20:22,270 --> 00:20:24,490
then spora outers are not adding new

387
00:20:24,490 --> 00:20:27,760
features they are just removing them so

388
00:20:27,760 --> 00:20:29,919
they are cutting down the code base into

389
00:20:29,919 --> 00:20:33,940
the skeleton as I will show you so at

390
00:20:33,940 --> 00:20:36,309
that time there was only a Russian

391
00:20:36,309 --> 00:20:38,650
translation and the only thing they

392
00:20:38,650 --> 00:20:41,380
added was after a few hours after the

393
00:20:41,380 --> 00:20:43,419
initial release they've added the

394
00:20:43,419 --> 00:20:45,549
English translation so it was a

395
00:20:45,549 --> 00:20:46,440
billingual

396
00:20:46,440 --> 00:20:49,390
after that they were trying to provide

397
00:20:49,390 --> 00:20:52,210
test versions with and without the links

398
00:20:52,210 --> 00:20:53,070
worth spreading

399
00:20:53,070 --> 00:20:56,260
sometimes they created a new executable

400
00:20:56,260 --> 00:20:58,630
without any changes and the first

401
00:20:58,630 --> 00:21:01,600
remarkable thing that has changed was at

402
00:21:01,600 --> 00:21:04,720
the beginning of the February that they

403
00:21:04,720 --> 00:21:07,840
removed first of those four files they

404
00:21:07,840 --> 00:21:11,140
try to minimize the food stamp footprint

405
00:21:11,140 --> 00:21:15,429
of their code to be less detectable so

406
00:21:15,429 --> 00:21:18,700
they removed LST files with a list of

407
00:21:18,700 --> 00:21:22,179
encrypted files after that they were

408
00:21:22,179 --> 00:21:25,600
trying also to reduce the other file the

409
00:21:25,600 --> 00:21:28,270
key file they were not able at that time

410
00:21:28,270 --> 00:21:31,150
to provide a functional solution so they

411
00:21:31,150 --> 00:21:33,850
removed only part of it and the complete

412
00:21:33,850 --> 00:21:36,340
file has been removed at the end of

413
00:21:36,340 --> 00:21:39,250
February together with some kind I I'd

414
00:21:39,250 --> 00:21:44,679
say it release 1.2 they even speeded up

415
00:21:44,679 --> 00:21:46,929
the encryption a little bit by removing

416
00:21:46,929 --> 00:21:50,700
some code checks so slicing down

417
00:21:50,700 --> 00:21:54,570
something what is really functional and

418
00:21:54,570 --> 00:21:57,850
after that that was all for three months

419
00:21:57,850 --> 00:22:00,790
no changes we were quite happy to

420
00:22:00,790 --> 00:22:02,770
provide a presentation back at Cairo

421
00:22:02,770 --> 00:22:06,070
called spore a new kid on the block we

422
00:22:06,070 --> 00:22:08,400
really enjoyed the after party at Cairo

423
00:22:08,400 --> 00:22:11,140
the band was really great I'm not sure

424
00:22:11,140 --> 00:22:14,260
whether some of them are in here so the

425
00:22:14,260 --> 00:22:18,550
performance great big heart and after

426
00:22:18,550 --> 00:22:22,770
our hangover this was probably our

427
00:22:22,770 --> 00:22:26,170
expression when we've seen that spore

428
00:22:26,170 --> 00:22:28,480
are released just one day after our

429
00:22:28,480 --> 00:22:30,880
presentation a totally different and

430
00:22:30,880 --> 00:22:33,880
totally updated version I call it

431
00:22:33,880 --> 00:22:38,140
release 2.0 in there everything has

432
00:22:38,140 --> 00:22:41,470
changes has changed the code similarity

433
00:22:41,470 --> 00:22:45,310
measured by Ben Dave was like 50% so

434
00:22:45,310 --> 00:22:48,730
they removed or totally redone half of

435
00:22:48,730 --> 00:22:51,900
the code so it was not a minor change

436
00:22:51,900 --> 00:22:54,520
they stopped using for example the

437
00:22:54,520 --> 00:22:56,680
mutexes so mutex based detection of

438
00:22:56,680 --> 00:23:00,340
spora was no longer possible well it was

439
00:23:00,340 --> 00:23:03,340
but it took you much time to track all

440
00:23:03,340 --> 00:23:05,700
the versions and all the differences

441
00:23:05,700 --> 00:23:09,580
also the encryption of files was really

442
00:23:09,580 --> 00:23:12,160
reward the content the structure the

443
00:23:12,160 --> 00:23:14,890
limits everything was different the even

444
00:23:14,890 --> 00:23:20,050
was able to remove the state file so one

445
00:23:20,050 --> 00:23:24,580
was file and its content is from now on

446
00:23:24,580 --> 00:23:26,620
stored at the end of the encrypted file

447
00:23:26,620 --> 00:23:28,900
so they moved all the content to

448
00:23:28,900 --> 00:23:31,690
encrypted files if you want if you want

449
00:23:31,690 --> 00:23:34,540
to login into the payment site you need

450
00:23:34,540 --> 00:23:37,480
to upload encrypted file from this

451
00:23:37,480 --> 00:23:40,780
version and finally they removed also

452
00:23:40,780 --> 00:23:43,390
the complete content of the ransom notes

453
00:23:43,390 --> 00:23:46,420
inside of the HTML files which in this

454
00:23:46,420 --> 00:23:49,780
version contained only a redirection to

455
00:23:49,780 --> 00:23:52,120
payment side so they reduced four files

456
00:23:52,120 --> 00:23:57,270
into zero so this was a drastic change

457
00:23:57,270 --> 00:24:00,970
we were really shocked after that we've

458
00:24:00,970 --> 00:24:03,370
been tracking down all the other changes

459
00:24:03,370 --> 00:24:08,650
a lot was quiet lucky to intercept an

460
00:24:08,650 --> 00:24:11,170
another attempt how to minimize porous

461
00:24:11,170 --> 00:24:15,520
code during June this is the complete

462
00:24:15,520 --> 00:24:16,509
code objects

463
00:24:16,509 --> 00:24:18,729
the cue table just five kilobytes of

464
00:24:18,729 --> 00:24:22,089
code just five functions that's it

465
00:24:22,089 --> 00:24:24,489
nothing more you've got a fully

466
00:24:24,489 --> 00:24:26,619
functional around somewhere on five

467
00:24:26,619 --> 00:24:30,909
kilobytes how they did so the trick is

468
00:24:30,909 --> 00:24:33,099
that they moved the complexity from

469
00:24:33,099 --> 00:24:36,609
executable inside of a JavaScript so the

470
00:24:36,609 --> 00:24:39,999
JavaScript dropped this executable and

471
00:24:39,999 --> 00:24:43,599
it also executed spora by using

472
00:24:43,599 --> 00:24:46,019
different arguments like generate

473
00:24:46,019 --> 00:24:49,029
encryption key encrypt files and so on

474
00:24:49,029 --> 00:24:51,489
but the main executable only contained

475
00:24:51,489 --> 00:24:53,349
five kilobytes of code really

476
00:24:53,349 --> 00:24:57,009
minimalistic however they were not

477
00:24:57,009 --> 00:24:59,559
satisfied with the solution so the other

478
00:24:59,559 --> 00:25:02,309
day they reverted this change and

479
00:25:02,309 --> 00:25:06,789
continued to slice the code in a

480
00:25:06,789 --> 00:25:11,199
different matter so this was the last

481
00:25:11,199 --> 00:25:14,619
major change inside of spora which we

482
00:25:14,619 --> 00:25:17,739
intercepted at the end of July

483
00:25:17,739 --> 00:25:20,199
they removed even more checks so from

484
00:25:20,199 --> 00:25:22,059
now on spora is no longer checking

485
00:25:22,059 --> 00:25:23,969
whether the file was encrypted or not

486
00:25:23,969 --> 00:25:28,089
they don't care also quite interesting

487
00:25:28,089 --> 00:25:31,419
they removed the English translation why

488
00:25:31,419 --> 00:25:35,319
would you do so so from now on it is

489
00:25:35,319 --> 00:25:39,779
once again in Russian only again and

490
00:25:39,779 --> 00:25:42,519
another changes and other changes they

491
00:25:42,519 --> 00:25:45,129
also switched to HTA

492
00:25:45,129 --> 00:25:48,159
from HTML because it was trendy at the

493
00:25:48,159 --> 00:25:51,969
time between ransomware outers and the

494
00:25:51,969 --> 00:25:54,369
last change we've noticed is from the

495
00:25:54,369 --> 00:25:58,509
end of august waved when they released

496
00:25:58,509 --> 00:26:01,209
probably by accident built with the

497
00:26:01,209 --> 00:26:03,999
boxspring printout you can quite easily

498
00:26:03,999 --> 00:26:06,639
analyze what's going on inside of code

499
00:26:06,639 --> 00:26:09,299
thanks to their English commands and

500
00:26:09,299 --> 00:26:15,159
yeah that's it to show you in a more

501
00:26:15,159 --> 00:26:17,709
graphical way what is really changing in

502
00:26:17,709 --> 00:26:20,649
Saito's pora this is some graph with

503
00:26:20,649 --> 00:26:23,079
number of user functions contained

504
00:26:23,079 --> 00:26:25,779
inside of spora they started back in

505
00:26:25,779 --> 00:26:28,719
January with something like 50 functions

506
00:26:28,719 --> 00:26:30,380
and they are reducing this

507
00:26:30,380 --> 00:26:33,560
code complexity from a day-to-day up to

508
00:26:33,560 --> 00:26:36,050
the five functions as I said but this

509
00:26:36,050 --> 00:26:39,680
was reverted so now they are fine with

510
00:26:39,680 --> 00:26:43,220
20 functions if you compare that number

511
00:26:43,220 --> 00:26:46,280
with the other ransomware strains such

512
00:26:46,280 --> 00:26:49,280
as scriptable Rocky crisis those are

513
00:26:49,280 --> 00:26:53,300
hundreds of user functions so spora is

514
00:26:53,300 --> 00:26:55,940
able to do the same thing but with only

515
00:26:55,940 --> 00:26:59,980
minimum number of code so kudos to them

516
00:26:59,980 --> 00:27:07,300
and what had happened in this met graph

517
00:27:07,300 --> 00:27:10,580
so as I said the mutex name generation

518
00:27:10,580 --> 00:27:13,580
is no longer possible and its detection

519
00:27:13,580 --> 00:27:16,070
they also removed all of those four

520
00:27:16,070 --> 00:27:18,860
files and their encryption so no longer

521
00:27:18,860 --> 00:27:22,010
in use everything has been moved inside

522
00:27:22,010 --> 00:27:25,100
of the encrypted files so the structure

523
00:27:25,100 --> 00:27:27,860
is once again totally different and they

524
00:27:27,860 --> 00:27:30,460
no longer providing a free initial

525
00:27:30,460 --> 00:27:33,770
immunization tool they don't want to be

526
00:27:33,770 --> 00:27:36,350
detected by us so they had to remove

527
00:27:36,350 --> 00:27:39,290
that but at the same time they have no

528
00:27:39,290 --> 00:27:43,310
product to be a salt so it's up to them

529
00:27:43,310 --> 00:27:47,540
so everything has really changed okay so

530
00:27:47,540 --> 00:27:51,380
I don't know if we have time but word of

531
00:27:51,380 --> 00:27:53,990
warning before statistics those are just

532
00:27:53,990 --> 00:27:55,240
lies of course

533
00:27:55,240 --> 00:27:59,720
so statistics per month these are unique

534
00:27:59,720 --> 00:28:04,940
users that were in the way where we

535
00:28:04,940 --> 00:28:06,130
detected spora

536
00:28:06,130 --> 00:28:10,160
so you can see in January Russia stands

537
00:28:10,160 --> 00:28:12,560
out so it was going out from Russia but

538
00:28:12,560 --> 00:28:15,440
right after that in February they they

539
00:28:15,440 --> 00:28:18,020
spread all across the globe mainly

540
00:28:18,020 --> 00:28:22,580
Poland Spain Italy France and and Brazil

541
00:28:22,580 --> 00:28:24,950
Brazil was really really badly infected

542
00:28:24,950 --> 00:28:30,530
and then they had lower numbers but

543
00:28:30,530 --> 00:28:31,940
basically the graph looks the same

544
00:28:31,940 --> 00:28:35,210
brazil is always always the first and

545
00:28:35,210 --> 00:28:40,039
they had a new campaign in May where the

546
00:28:40,039 --> 00:28:43,879
the numbers again went up but still

547
00:28:43,879 --> 00:28:48,950
Brazil in the lead and then fall back to

548
00:28:48,950 --> 00:28:52,580
Russia when they remove the English

549
00:28:52,580 --> 00:28:54,769
language and they basically fall back to

550
00:28:54,769 --> 00:29:01,029
Russia in June in July and August yeah

551
00:29:01,029 --> 00:29:02,539
summary

552
00:29:02,539 --> 00:29:04,850
yeah we've pretty much covered

553
00:29:04,850 --> 00:29:07,129
everything what's here

554
00:29:07,129 --> 00:29:10,269
I expect that the spohrer outdoors will

555
00:29:10,269 --> 00:29:13,429
are preparing for for a new campaign

556
00:29:13,429 --> 00:29:15,979
probably this this is of course just

557
00:29:15,979 --> 00:29:17,899
speculation about what but from what

558
00:29:17,899 --> 00:29:19,849
they do with the payment site and with

559
00:29:19,849 --> 00:29:24,470
the executable I pretty much expect that

560
00:29:24,470 --> 00:29:26,210
they are preparing for a new campaign

561
00:29:26,210 --> 00:29:28,970
and of course tomorrow there will be a

562
00:29:28,970 --> 00:29:32,809
total rewrite because we presented this

563
00:29:32,809 --> 00:29:36,139
presentation so thank you very much I

564
00:29:36,139 --> 00:29:37,999
don't know if we have time for questions

565
00:29:37,999 --> 00:29:41,619
but we are happy to answer

