1
00:00:00,030 --> 00:00:02,220
okay we have one more session to go

2
00:00:02,220 --> 00:00:04,470
before we have lunch but it's going to

3
00:00:04,470 --> 00:00:06,290
be an interesting presentation I think

4
00:00:06,290 --> 00:00:09,480
shedding skin tone as fresh faces done

5
00:00:09,480 --> 00:00:11,340
by good Baumgartner and Mike's good from

6
00:00:11,340 --> 00:00:14,130
kaspersky lab's gentlemen all right

7
00:00:14,130 --> 00:00:16,289
Thank You Ricard good morning everyone

8
00:00:16,289 --> 00:00:18,300
thank you for attending today we're here

9
00:00:18,300 --> 00:00:21,210
to talk about turtle activity that we've

10
00:00:21,210 --> 00:00:24,570
been seeing in 2018 some of it is

11
00:00:24,570 --> 00:00:27,269
preceded by activity and informed by

12
00:00:27,269 --> 00:00:29,340
activity we've been seeing in 2016 2017

13
00:00:29,340 --> 00:00:33,149
so we'll talk about some of that

14
00:00:33,149 --> 00:00:35,100
activity as well but we're focused on

15
00:00:35,100 --> 00:00:38,040
the here and now I'm Kurt Baumgartner

16
00:00:38,040 --> 00:00:40,469
I'm a global or principal security

17
00:00:40,469 --> 00:00:42,690
researcher with Kaspersky Labs global

18
00:00:42,690 --> 00:00:44,219
research and analysis team I've been

19
00:00:44,219 --> 00:00:47,100
part of the team since 2010 and I'm

20
00:00:47,100 --> 00:00:48,690
happy to introduce a new member of the

21
00:00:48,690 --> 00:00:51,510
team Mike Scott oh yeah hi Mike Scott

22
00:00:51,510 --> 00:00:53,910
I'd fairly new to the team middle of

23
00:00:53,910 --> 00:00:55,020
this year

24
00:00:55,020 --> 00:00:57,270
previous to that I spent about a dozen

25
00:00:57,270 --> 00:00:59,010
years in the US defense industry doing

26
00:00:59,010 --> 00:01:00,780
network defense and Incident Response

27
00:01:00,780 --> 00:01:04,979
and basically decided that I got tired

28
00:01:04,979 --> 00:01:06,420
of working nights and weekends and on

29
00:01:06,420 --> 00:01:08,520
actors time and switched over to the

30
00:01:08,520 --> 00:01:10,380
threat Intel and threat actor tracking

31
00:01:10,380 --> 00:01:11,580
side and I've been doing that for about

32
00:01:11,580 --> 00:01:16,890
seven years and Allison alright so yeah

33
00:01:16,890 --> 00:01:20,360
we're here today to talk about a large

34
00:01:20,360 --> 00:01:23,820
threat actor they're capable well

35
00:01:23,820 --> 00:01:27,210
resourced and they go back decades we're

36
00:01:27,210 --> 00:01:29,490
gonna again talk about their activity in

37
00:01:29,490 --> 00:01:33,180
2018 but we're going to sort of cluster

38
00:01:33,180 --> 00:01:35,369
talk about clusters of activity Turla is

39
00:01:35,369 --> 00:01:35,970
so large

40
00:01:35,970 --> 00:01:37,650
they've many different things going on

41
00:01:37,650 --> 00:01:40,439
at once and really this talk will focus

42
00:01:40,439 --> 00:01:44,399
on some of their JavaScript or Kopi

43
00:01:44,399 --> 00:01:47,250
Luwak and iced coffee activity and then

44
00:01:47,250 --> 00:01:49,649
also what we've been seeing as far as

45
00:01:49,649 --> 00:01:53,100
carbon mosquito Turla and it's some of

46
00:01:53,100 --> 00:01:55,649
how it ties together related to wipe

47
00:01:55,649 --> 00:02:00,840
backdoor we call the White Bear so this

48
00:02:00,840 --> 00:02:04,020
is the sort of the larger mess that

49
00:02:04,020 --> 00:02:06,930
Turla is and again we're gonna pick and

50
00:02:06,930 --> 00:02:09,060
choose a few things that we're going to

51
00:02:09,060 --> 00:02:10,929
focus on related to 20

52
00:02:10,929 --> 00:02:14,950
teen activity this is not Turla this is

53
00:02:14,950 --> 00:02:17,859
other stuff whether it's the Dukes sofa

54
00:02:17,859 --> 00:02:21,849
see other russian-speaking apt if you're

55
00:02:21,849 --> 00:02:23,859
paying attention to the news today you

56
00:02:23,859 --> 00:02:26,260
may have forgotten that there is another

57
00:02:26,260 --> 00:02:30,659
russian-speaking apt called Turla but

58
00:02:30,659 --> 00:02:33,489
the sofa see and these guys are total

59
00:02:33,489 --> 00:02:35,560
are somewhat separate and we have an

60
00:02:35,560 --> 00:02:37,870
interesting finding about how separate

61
00:02:37,870 --> 00:02:42,970
they are from Turla in 2018 the

62
00:02:42,970 --> 00:02:45,519
targeting that we're seeing you can view

63
00:02:45,519 --> 00:02:48,040
this map if you can't really read what's

64
00:02:48,040 --> 00:02:50,829
going on here on secure list we've got

65
00:02:50,829 --> 00:02:52,569
the link there for you

66
00:02:52,569 --> 00:02:57,909
but generally Turla has been targeting

67
00:02:57,909 --> 00:03:00,359
both remote and local organizations

68
00:03:00,359 --> 00:03:04,480
foreign affairs organizations diplomatic

69
00:03:04,480 --> 00:03:06,480
organizations government related

70
00:03:06,480 --> 00:03:09,329
scientific and technical organizations

71
00:03:09,329 --> 00:03:13,719
all over the world and this is simply

72
00:03:13,719 --> 00:03:15,400
what we've been seeing towards the end

73
00:03:15,400 --> 00:03:19,750
of 2017 and 2018 others we've seen other

74
00:03:19,750 --> 00:03:22,419
public reporting on this group so in

75
00:03:22,419 --> 00:03:25,180
some cases the problem is bigger than

76
00:03:25,180 --> 00:03:27,629
our visibility than what we're seeing

77
00:03:27,629 --> 00:03:31,739
and we'll point that out as this goes on

78
00:03:31,739 --> 00:03:35,199
so related to Turrell is PE malware in

79
00:03:35,199 --> 00:03:37,720
2018 we've been seeing new versions of

80
00:03:37,720 --> 00:03:40,329
carbon and this is unusual this was

81
00:03:40,329 --> 00:03:44,079
surprising to me we see carbon is

82
00:03:44,079 --> 00:03:47,250
something that we mentioned back in 2014

83
00:03:47,250 --> 00:03:52,239
as a part of the epic Turla operation we

84
00:03:52,239 --> 00:03:55,959
posted on it back in yeah again 2014 and

85
00:03:55,959 --> 00:03:58,180
we found multiple components to this

86
00:03:58,180 --> 00:04:01,290
framework it's a it's a backdoor

87
00:04:01,290 --> 00:04:05,109
framework the newest versions in 2018 we

88
00:04:05,109 --> 00:04:08,379
see a new Orchestrator version 3 a 2 and

89
00:04:08,379 --> 00:04:12,909
a new of injected object 4 0 5 some of

90
00:04:12,909 --> 00:04:14,530
the new functionality that they bring

91
00:04:14,530 --> 00:04:16,899
with it I have to do with anonymous

92
00:04:16,899 --> 00:04:19,060
pipes and inter-process communications

93
00:04:19,060 --> 00:04:21,310
so they are building and modifying on

94
00:04:21,310 --> 00:04:23,500
something that's years old

95
00:04:23,500 --> 00:04:26,860
it's interesting that we're also we also

96
00:04:26,860 --> 00:04:28,720
happen to be seeing interpreter and

97
00:04:28,720 --> 00:04:31,720
other open-source tools being used by

98
00:04:31,720 --> 00:04:34,630
these guys to distribute and push the

99
00:04:34,630 --> 00:04:37,389
new versions of carbon and in particular

100
00:04:37,389 --> 00:04:39,610
we're seeing it in Central Asia they're

101
00:04:39,610 --> 00:04:43,540
very selective about how their what

102
00:04:43,540 --> 00:04:46,300
systems they're pushing it to so it may

103
00:04:46,300 --> 00:04:50,710
be so it's it's just rare to find this

104
00:04:50,710 --> 00:04:53,440
framework in the wild we'll talk a

105
00:04:53,440 --> 00:04:55,780
little bit more about mosquito it's a

106
00:04:55,780 --> 00:04:57,850
modified version of comrat that we

107
00:04:57,850 --> 00:04:59,350
continue to see there's a lot of

108
00:04:59,350 --> 00:05:01,510
activity from these guys and from this

109
00:05:01,510 --> 00:05:03,070
operation in particular throughout the

110
00:05:03,070 --> 00:05:06,610
world in 2017 and 2018 and again we're

111
00:05:06,610 --> 00:05:08,110
seeing meterpreter and open-source

112
00:05:08,110 --> 00:05:11,350
tooling being bundled into this mosquito

113
00:05:11,350 --> 00:05:14,979
package and again it's remote and local

114
00:05:14,979 --> 00:05:17,680
organizations that are Foreign Affairs

115
00:05:17,680 --> 00:05:20,229
related and diplomatic in in these

116
00:05:20,229 --> 00:05:22,660
regions and then finally we'll reflect a

117
00:05:22,660 --> 00:05:25,060
little bit on white their sort of their

118
00:05:25,060 --> 00:05:27,100
initial scripting efforts related to

119
00:05:27,100 --> 00:05:27,850
spearfishing

120
00:05:27,850 --> 00:05:32,560
and then and sort of their third Jase

121
00:05:32,560 --> 00:05:34,240
that well the jscript of their building

122
00:05:34,240 --> 00:05:38,889
into their their tooling okay yes Kurt

123
00:05:38,889 --> 00:05:41,530
mentioned trellis used a lot of jscript

124
00:05:41,530 --> 00:05:43,240
in javascript and in some of their

125
00:05:43,240 --> 00:05:44,770
previous tools but iced coffee

126
00:05:44,770 --> 00:05:48,729
aka Cheramie which some people and

127
00:05:48,729 --> 00:05:49,990
including actors that's what they call

128
00:05:49,990 --> 00:05:51,580
it that was kind of their first foray

129
00:05:51,580 --> 00:05:55,660
into fully JavaScript backdoors this we

130
00:05:55,660 --> 00:05:57,400
these initial samples were dropped by

131
00:05:57,400 --> 00:06:00,250
and weaponized RTF and then some macro

132
00:06:00,250 --> 00:06:04,349
alpha stocks and XLS the macro code was

133
00:06:04,349 --> 00:06:06,970
very similar to what was dropping white

134
00:06:06,970 --> 00:06:09,669
Alice also known as skipper so that was

135
00:06:09,669 --> 00:06:11,860
kind of our early at you know way to say

136
00:06:11,860 --> 00:06:14,889
hey this looks a lot like Lake Turla and

137
00:06:14,889 --> 00:06:17,500
then fire I also blogged less 2017 I

138
00:06:17,500 --> 00:06:22,300
think about some that 2702 61 and 27001

139
00:06:22,300 --> 00:06:25,120
which was a prove esque that apparently

140
00:06:25,120 --> 00:06:26,740
Turla and one other crime war actor

141
00:06:26,740 --> 00:06:29,530
we're the first had the only access to

142
00:06:29,530 --> 00:06:31,840
that zero day when I came out and one of

143
00:06:31,840 --> 00:06:35,030
those was used to drop Jeremy

144
00:06:35,030 --> 00:06:36,980
what's interesting is the macro code in

145
00:06:36,980 --> 00:06:38,320
that they actually added a beacon

146
00:06:38,320 --> 00:06:42,350
capability in the macro itself so when

147
00:06:42,350 --> 00:06:44,780
the macro runs this it generates a

148
00:06:44,780 --> 00:06:46,100
little bit of system information and

149
00:06:46,100 --> 00:06:49,310
then sends beacon up to a c2 server and

150
00:06:49,310 --> 00:06:50,720
we could work kind of hypothesizing that

151
00:06:50,720 --> 00:06:53,000
perhaps that was a way to see you know

152
00:06:53,000 --> 00:06:54,890
kind of gauge their delivery like the

153
00:06:54,890 --> 00:06:57,560
effectiveness of their of their

154
00:06:57,560 --> 00:06:59,540
exploitation and possibly the

155
00:06:59,540 --> 00:07:01,430
gullibility of their targets you know if

156
00:07:01,430 --> 00:07:03,980
the if the macro ran and we they got the

157
00:07:03,980 --> 00:07:05,960
initial c2 then they'd know that the

158
00:07:05,960 --> 00:07:07,910
microgram and it got a beacon was

159
00:07:07,910 --> 00:07:09,890
successful but if then the system never

160
00:07:09,890 --> 00:07:11,960
checked in fully with the back with the

161
00:07:11,960 --> 00:07:14,810
ice coffee backdoor then either the you

162
00:07:14,810 --> 00:07:17,060
know it was detected or failed or

163
00:07:17,060 --> 00:07:19,070
whatever reason so kind of a interesting

164
00:07:19,070 --> 00:07:20,780
tactic that they've started using that

165
00:07:20,780 --> 00:07:23,450
Kopi Luwak did the same thing sort of as

166
00:07:23,450 --> 00:07:27,620
well not a very robust backdoor I mean

167
00:07:27,620 --> 00:07:30,919
it's it's fairly you know not very

168
00:07:30,919 --> 00:07:31,610
feature-rich

169
00:07:31,610 --> 00:07:34,160
it did a lot of use what WMI for

170
00:07:34,160 --> 00:07:35,240
collecting a whole bunch of system

171
00:07:35,240 --> 00:07:36,620
information that it's stored in a big

172
00:07:36,620 --> 00:07:39,169
JSON blob and then uploaded it encrypted

173
00:07:39,169 --> 00:07:41,780
it and and uploaded it to the c2 server

174
00:07:41,780 --> 00:07:44,660
and but then it didn't really have any

175
00:07:44,660 --> 00:07:46,940
command functionality per se all I do it

176
00:07:46,940 --> 00:07:48,650
would just it would check into the c2

177
00:07:48,650 --> 00:07:50,030
server and then depending on the

178
00:07:50,030 --> 00:07:51,650
response from a server it could download

179
00:07:51,650 --> 00:07:53,960
additional JavaScript and that qudoos to

180
00:07:53,960 --> 00:07:56,210
run and then seven it was also backup it

181
00:07:56,210 --> 00:08:00,890
you know not not very feature-rich Kopi

182
00:08:00,890 --> 00:08:02,450
Luwak on the other hand was a kind of

183
00:08:02,450 --> 00:08:04,190
the next generation if you will

184
00:08:04,190 --> 00:08:07,370
different a totally different code they

185
00:08:07,370 --> 00:08:10,610
overlapped in time a little bit but

186
00:08:10,610 --> 00:08:13,130
similar kind of thing of drop initially

187
00:08:13,130 --> 00:08:15,169
dropped by office docs proof point

188
00:08:15,169 --> 00:08:16,790
actually logged on one that was dropped

189
00:08:16,790 --> 00:08:18,890
by at dropper and then I was we'll talk

190
00:08:18,890 --> 00:08:20,560
about later we've sought dropped by some

191
00:08:20,560 --> 00:08:24,830
office shortcut link files the macro

192
00:08:24,830 --> 00:08:26,330
code again was very similar to the white

193
00:08:26,330 --> 00:08:28,520
atlas skipper stuff but then they had

194
00:08:28,520 --> 00:08:31,100
actually added some new tricks to it a

195
00:08:31,100 --> 00:08:33,110
new X or routine and some other things

196
00:08:33,110 --> 00:08:35,929
for decoding the payload that JavaScript

197
00:08:35,929 --> 00:08:39,229
itself is much more complicated than a

198
00:08:39,229 --> 00:08:41,620
nice coffee was

199
00:08:41,620 --> 00:08:43,149
and the way it works is it actually

200
00:08:43,149 --> 00:08:45,730
drops a JavaScript to disk and then sets

201
00:08:45,730 --> 00:08:47,740
up persistence and then the proof one

202
00:08:47,740 --> 00:08:51,040
that when the it calls it actually

203
00:08:51,040 --> 00:08:53,350
writes another level of JavaScript

204
00:08:53,350 --> 00:08:54,999
that's run at runtime is decrypted with

205
00:08:54,999 --> 00:08:57,790
rc4 and runs at memory so it makes it a

206
00:08:57,790 --> 00:08:59,170
little bit harder to do forensics and

207
00:08:59,170 --> 00:09:00,850
whatnot if you only have the JavaScript

208
00:09:00,850 --> 00:09:03,189
you have to know the rc4 key to actually

209
00:09:03,189 --> 00:09:07,569
run it this one news it does use the WMI

210
00:09:07,569 --> 00:09:09,430
a little bit for system profiling but it

211
00:09:09,430 --> 00:09:11,319
basically runs this huge giant block of

212
00:09:11,319 --> 00:09:13,870
like net user IP config all the the

213
00:09:13,870 --> 00:09:15,550
typical kind of host and network

214
00:09:15,550 --> 00:09:17,949
forensics activity that writes it to a

215
00:09:17,949 --> 00:09:21,100
file and Cripps it sends it up to the c2

216
00:09:21,100 --> 00:09:22,749
server and then immediately deletes it

217
00:09:22,749 --> 00:09:26,139
so similar kind of tactic to ice coffees

218
00:09:26,139 --> 00:09:28,389
alieve tries to leave a very little no

219
00:09:28,389 --> 00:09:29,889
you know very little footprint on disk

220
00:09:29,889 --> 00:09:31,740
and leave very little behind for

221
00:09:31,740 --> 00:09:35,589
forensics to discover kopi blog did have

222
00:09:35,589 --> 00:09:37,360
the first version had about i think of

223
00:09:37,360 --> 00:09:39,879
four commands that are supported that it

224
00:09:39,879 --> 00:09:42,249
would based on the response from the c2

225
00:09:42,249 --> 00:09:45,370
ver c2 server other uh-huh one of leg

226
00:09:45,370 --> 00:09:47,829
you know it could it everything was

227
00:09:47,829 --> 00:09:49,540
happy we just sit there and pause and it

228
00:09:49,540 --> 00:09:50,889
would wait i think like three or four

229
00:09:50,889 --> 00:09:52,629
minutes as somewhat randomization has a

230
00:09:52,629 --> 00:09:53,889
little bit of randomization on how long

231
00:09:53,889 --> 00:09:55,959
it would wait to beacon again they could

232
00:09:55,959 --> 00:09:57,939
actually tell it to just kill itself and

233
00:09:57,939 --> 00:10:00,370
wait until the server reboots or the

234
00:10:00,370 --> 00:10:01,899
system reboots and then the persistence

235
00:10:01,899 --> 00:10:04,089
will kick it on again if they wanted to

236
00:10:04,089 --> 00:10:06,009
go quiet for a while it also had a mode

237
00:10:06,009 --> 00:10:06,610
to just fully

238
00:10:06,610 --> 00:10:09,610
you know remove itself completely and

239
00:10:09,610 --> 00:10:12,309
delete all evidence of persistence and

240
00:10:12,309 --> 00:10:15,129
then i'd also had a command command

241
00:10:15,129 --> 00:10:17,170
capability similar to iced coffee where

242
00:10:17,170 --> 00:10:19,329
it could run could download files get

243
00:10:19,329 --> 00:10:20,680
download additional scripts things like

244
00:10:20,680 --> 00:10:24,929
that all right

245
00:10:24,929 --> 00:10:29,230
lots of scripting so moving back to

246
00:10:29,230 --> 00:10:32,199
carbon and the carbon framework its

247
00:10:32,199 --> 00:10:34,120
deployment really what it looks like

248
00:10:34,120 --> 00:10:36,600
it's there are a couple of interesting

249
00:10:36,600 --> 00:10:38,439
characteristics about carbon that are

250
00:10:38,439 --> 00:10:41,769
unusual one is its unusually explicit

251
00:10:41,769 --> 00:10:45,209
installer when we see the loader itself

252
00:10:45,209 --> 00:10:47,980
it coincides with the presence of

253
00:10:47,980 --> 00:10:50,290
meterpreter in some form which is really

254
00:10:50,290 --> 00:10:53,370
unusual you've got amateur

255
00:10:53,370 --> 00:10:55,440
functional and really interesting

256
00:10:55,440 --> 00:10:57,060
codebase that they've been using for

257
00:10:57,060 --> 00:11:00,690
years alongside meterpreter which is an

258
00:11:00,690 --> 00:11:03,200
open-source freely distributed

259
00:11:03,200 --> 00:11:08,040
Metasploit tool the carbon code when the

260
00:11:08,040 --> 00:11:11,400
loader drops other components to disk it

261
00:11:11,400 --> 00:11:13,890
uses the familiar sort of Turla

262
00:11:13,890 --> 00:11:14,730
potty-mouth

263
00:11:14,730 --> 00:11:17,370
error code messages in this case when it

264
00:11:17,370 --> 00:11:20,220
succeeds it says hey lucky strike but if

265
00:11:20,220 --> 00:11:22,170
they don't if they don't obtain

266
00:11:22,170 --> 00:11:25,620
privileges to drop files to appropriate

267
00:11:25,620 --> 00:11:28,950
locations they complain why the why the

268
00:11:28,950 --> 00:11:32,100
F naught and then think other error

269
00:11:32,100 --> 00:11:34,620
messages continue after that which is

270
00:11:34,620 --> 00:11:36,620
kind of what you expect from Turla

271
00:11:36,620 --> 00:11:39,300
certainly not a military discipline to

272
00:11:39,300 --> 00:11:42,230
how they're deploying in writing code

273
00:11:42,230 --> 00:11:49,320
the the loader is SRV RS RS vc dll

274
00:11:49,320 --> 00:11:51,120
that's a file name that's been pretty

275
00:11:51,120 --> 00:11:53,190
common across deployment so that's

276
00:11:53,190 --> 00:11:54,840
nothing new but all the all the file

277
00:11:54,840 --> 00:11:57,990
names mutex names everything they they

278
00:11:57,990 --> 00:12:00,090
bundle into this package that could be

279
00:12:00,090 --> 00:12:02,250
used as an indicator has been changing

280
00:12:02,250 --> 00:12:05,310
across these minor increments so you

281
00:12:05,310 --> 00:12:07,110
can't really use them from one release

282
00:12:07,110 --> 00:12:11,780
to another to detect or identify carbon

283
00:12:11,780 --> 00:12:15,720
it also suggests that somebody or that

284
00:12:15,720 --> 00:12:18,870
the loader is being run manually and

285
00:12:18,870 --> 00:12:20,130
somebody is inspecting the error

286
00:12:20,130 --> 00:12:23,160
messages as they're running so the

287
00:12:23,160 --> 00:12:26,330
loader that we were looking at is 621

288
00:12:26,330 --> 00:12:31,650
621 K or 620 1000 bytes and here all the

289
00:12:31,650 --> 00:12:34,920
filenames and internal component names

290
00:12:34,920 --> 00:12:36,630
that they've been using and you can see

291
00:12:36,630 --> 00:12:40,530
if well from earlier versions of carbon

292
00:12:40,530 --> 00:12:42,810
they usually maintain these older

293
00:12:42,810 --> 00:12:45,390
internal names and they just don't

294
00:12:45,390 --> 00:12:47,730
bother to update the internal names when

295
00:12:47,730 --> 00:12:49,470
they compile the code and push it out

296
00:12:49,470 --> 00:12:52,710
which is unusual but that's what they're

297
00:12:52,710 --> 00:12:58,500
doing so I guess one other interesting

298
00:12:58,500 --> 00:13:01,020
thing to note about this file listing

299
00:13:01,020 --> 00:13:03,990
and what you see on the screen here is

300
00:13:03,990 --> 00:13:05,270
that

301
00:13:05,270 --> 00:13:08,210
are multiple injected carbon libraries

302
00:13:08,210 --> 00:13:10,640
it used to be simply an Orchestrator an

303
00:13:10,640 --> 00:13:12,800
encrypted blob or a config file

304
00:13:12,800 --> 00:13:16,040
encrypted with caste 128 and then and

305
00:13:16,040 --> 00:13:18,800
then a transport library injected into a

306
00:13:18,800 --> 00:13:22,790
browser an email client or I am but now

307
00:13:22,790 --> 00:13:25,730
they've got an additional library and

308
00:13:25,730 --> 00:13:29,810
it's it's large or I should say it's

309
00:13:29,810 --> 00:13:33,440
smaller than the coinciding code that

310
00:13:33,440 --> 00:13:35,300
had been previous really previously

311
00:13:35,300 --> 00:13:37,010
released this is where there including

312
00:13:37,010 --> 00:13:40,070
the anonymous pipes code the additional

313
00:13:40,070 --> 00:13:42,080
stuff that they supplemented the older

314
00:13:42,080 --> 00:13:48,710
code base with so mosquito has mosquito

315
00:13:48,710 --> 00:13:53,420
is another package and another set of

316
00:13:53,420 --> 00:13:55,250
activity that we're seeing globally from

317
00:13:55,250 --> 00:13:58,390
Turla it's focused on diplomatic and

318
00:13:58,390 --> 00:14:00,680
governmental organizations they're very

319
00:14:00,680 --> 00:14:03,650
consistent about the target profiling

320
00:14:03,650 --> 00:14:07,100
and they're less consistent about

321
00:14:07,100 --> 00:14:08,600
locations in the world where they're

322
00:14:08,600 --> 00:14:11,390
delivering it something that's not on

323
00:14:11,390 --> 00:14:14,470
the slide has to do with their

324
00:14:14,470 --> 00:14:17,720
man-in-the-middle techniques now when we

325
00:14:17,720 --> 00:14:21,170
originally notified customers and Senta

326
00:14:21,170 --> 00:14:24,350
and reported on this activity we noted

327
00:14:24,350 --> 00:14:25,400
that there were men in the middle

328
00:14:25,400 --> 00:14:27,770
attacks going on wood that we suspected

329
00:14:27,770 --> 00:14:32,240
this was late 2016 early 2017 another

330
00:14:32,240 --> 00:14:34,850
report came out towards the end of 2017

331
00:14:34,850 --> 00:14:37,730
reporting on almost the same stuff so we

332
00:14:37,730 --> 00:14:39,380
weren't the only ones seeing it and this

333
00:14:39,380 --> 00:14:41,000
was a bit larger of a problem than we

334
00:14:41,000 --> 00:14:45,800
expected interesting thing about the

335
00:14:45,800 --> 00:14:47,840
installers that we had been seeing that

336
00:14:47,840 --> 00:14:50,180
would support the hypothesis that these

337
00:14:50,180 --> 00:14:52,220
guys are performing men in the middle

338
00:14:52,220 --> 00:14:56,060
techniques that are Wi-Fi based have to

339
00:14:56,060 --> 00:14:58,180
do with some of the installers gathering

340
00:14:58,180 --> 00:15:02,030
and dumping all of the Wi-Fi profiles on

341
00:15:02,030 --> 00:15:04,280
the system to an XML file and

342
00:15:04,280 --> 00:15:05,870
immediately sending that back to the

343
00:15:05,870 --> 00:15:08,030
situ that's followed up with a

344
00:15:08,030 --> 00:15:10,250
collection of IP config information and

345
00:15:10,250 --> 00:15:13,520
ARP - a or all of the MAC addresses that

346
00:15:13,520 --> 00:15:15,470
the system has access to on the network

347
00:15:15,470 --> 00:15:17,450
so they'll know what the

348
00:15:17,450 --> 00:15:19,910
the Gateway mac should look like and

349
00:15:19,910 --> 00:15:22,820
they'll know what the Gateway Wi-Fi

350
00:15:22,820 --> 00:15:26,360
password should be so our flooding or

351
00:15:26,360 --> 00:15:30,170
tools like silica or pineapples can help

352
00:15:30,170 --> 00:15:31,640
you perform man-in-the-middle of

353
00:15:31,640 --> 00:15:34,400
techniques if you ever lose access or

354
00:15:34,400 --> 00:15:36,800
perhaps hit another organization or

355
00:15:36,800 --> 00:15:41,210
location from the same organization so

356
00:15:41,210 --> 00:15:43,400
in all likelihood we suspect and we have

357
00:15:43,400 --> 00:15:47,570
data that that suggests Wi-Fi based men

358
00:15:47,570 --> 00:15:49,250
in the midle techniques are going on and

359
00:15:49,250 --> 00:15:51,790
not necessarily ISP level

360
00:15:51,790 --> 00:15:54,170
man-in-the-middle techniques other

361
00:15:54,170 --> 00:15:56,030
interesting things we saw with mosquito

362
00:15:56,030 --> 00:15:58,070
and the sort of custom comrade modules

363
00:15:58,070 --> 00:15:59,900
that they've been delivering is that now

364
00:15:59,900 --> 00:16:02,780
they also are bundling in Metasploit

365
00:16:02,780 --> 00:16:05,690
code it looked like they were tinkering

366
00:16:05,690 --> 00:16:10,010
with challenges in injecting 64-bit

367
00:16:10,010 --> 00:16:13,070
processes from 32-bit modules and they

368
00:16:13,070 --> 00:16:15,580
started moving that into their code

369
00:16:15,580 --> 00:16:19,220
later in 2018 so their use of Metasploit

370
00:16:19,220 --> 00:16:21,260
has been documented publicly but

371
00:16:21,260 --> 00:16:23,780
specifics like this just aren't

372
00:16:23,780 --> 00:16:25,940
necessarily available so that's that's

373
00:16:25,940 --> 00:16:28,010
interesting and it also is interesting

374
00:16:28,010 --> 00:16:30,350
because it overlaps with what those guys

375
00:16:30,350 --> 00:16:32,390
are doing with carbon they're also

376
00:16:32,390 --> 00:16:34,310
delivering things with an interpreter

377
00:16:34,310 --> 00:16:35,810
and the meta and components from the

378
00:16:35,810 --> 00:16:39,710
Metasploit project real quickly I want

379
00:16:39,710 --> 00:16:42,920
to mention white there is precedes all

380
00:16:42,920 --> 00:16:45,140
this activity and this is where we see

381
00:16:45,140 --> 00:16:48,140
some initial funky Java scourge a script

382
00:16:48,140 --> 00:16:50,680
that they're delivering and using for

383
00:16:50,680 --> 00:16:53,360
spearfishing targets so this is prior to

384
00:16:53,360 --> 00:16:56,300
the iced coffee and Kopi Luwak stuff so

385
00:16:56,300 --> 00:16:58,790
it's loosely connected through this new

386
00:16:58,790 --> 00:17:02,000
scripting but one thing we also saw and

387
00:17:02,000 --> 00:17:04,970
here's simply some more of their their J

388
00:17:04,970 --> 00:17:07,190
script that they use in order to deliver

389
00:17:07,190 --> 00:17:09,890
droppers to a system another interesting

390
00:17:09,890 --> 00:17:13,130
point about white bear is that back in

391
00:17:13,130 --> 00:17:16,940
2017 both white bear and Kopi Luwak

392
00:17:16,940 --> 00:17:18,709
we're sharing the same command and

393
00:17:18,709 --> 00:17:21,770
control server of a compromised work

394
00:17:21,770 --> 00:17:24,130
WordPress site that they they

395
00:17:24,130 --> 00:17:32,470
we use so it is tied of course it's not

396
00:17:32,470 --> 00:17:34,120
a good technical presentation unless you

397
00:17:34,120 --> 00:17:36,160
have some pie chart that nobody from the

398
00:17:36,160 --> 00:17:38,620
back can read so I had to include one so

399
00:17:38,620 --> 00:17:41,260
this is the UH knob this gated version

400
00:17:41,260 --> 00:17:44,050
of an early iced coffee sample just kind

401
00:17:44,050 --> 00:17:45,820
of show you it's a little little

402
00:17:45,820 --> 00:17:47,860
daunting at first but as you can see

403
00:17:47,860 --> 00:17:49,240
that that first function at the top

404
00:17:49,240 --> 00:17:51,670
basically is a decoder for all of the

405
00:17:51,670 --> 00:17:54,010
remaining lines at least a first stage

406
00:17:54,010 --> 00:17:56,770
decode turlet loves to have multiple

407
00:17:56,770 --> 00:18:00,610
levels of decoding and you know various

408
00:18:00,610 --> 00:18:02,890
levels of a 64 and rc4 and all kinds of

409
00:18:02,890 --> 00:18:05,050
crazy stuff they come up with for the

410
00:18:05,050 --> 00:18:06,370
opposite for obfuscating their scripts

411
00:18:06,370 --> 00:18:09,100
but it's really you know not a fairly a

412
00:18:09,100 --> 00:18:11,160
simple decolo

413
00:18:11,160 --> 00:18:14,110
and then you can see it applies to all

414
00:18:14,110 --> 00:18:16,210
those lines below that first loop all

415
00:18:16,210 --> 00:18:19,230
that this whatever and then that escaped

416
00:18:19,230 --> 00:18:21,910
text and then the arguments that are

417
00:18:21,910 --> 00:18:24,910
passed for the math functions and then

418
00:18:24,910 --> 00:18:27,190
that's kind of what it looks like after

419
00:18:27,190 --> 00:18:28,630
the first level of decoding you can at

420
00:18:28,630 --> 00:18:30,490
least get a good idea what the scripts

421
00:18:30,490 --> 00:18:32,110
doing you see they'll see - I actually

422
00:18:32,110 --> 00:18:33,460
cleaned that up a little bit - made that

423
00:18:33,460 --> 00:18:34,720
make the colors better I stuck some

424
00:18:34,720 --> 00:18:36,280
quotes in there and stuff to make it a

425
00:18:36,280 --> 00:18:41,350
little more readable that typical of

426
00:18:41,350 --> 00:18:44,530
Turla almost all the c2 are compromised

427
00:18:44,530 --> 00:18:48,730
legitimate servers a nice copy has it

428
00:18:48,730 --> 00:18:50,830
some some help samples have like add up

429
00:18:50,830 --> 00:18:52,810
to a dozen or so different c2 s they use

430
00:18:52,810 --> 00:18:54,850
obviously compromise sites you don't

431
00:18:54,850 --> 00:18:56,020
know how long you're gonna have control

432
00:18:56,020 --> 00:19:00,280
over them so it's decent practice and

433
00:19:00,280 --> 00:19:02,200
then at the bottom you can see the you

434
00:19:02,200 --> 00:19:04,510
know the actors do call it Cheramie I

435
00:19:04,510 --> 00:19:08,290
think that there is a V version 1.0.1

436
00:19:08,290 --> 00:19:10,780
zero zero one well you see the first one

437
00:19:10,780 --> 00:19:15,130
we saw I think 1.00 four is the most

438
00:19:15,130 --> 00:19:18,010
recent I've seen anybody has anything

439
00:19:18,010 --> 00:19:20,710
later than that I'd love to see it

440
00:19:20,710 --> 00:19:23,650
I work traffic this is so this is that

441
00:19:23,650 --> 00:19:25,150
first beacon that's generated by the

442
00:19:25,150 --> 00:19:27,580
macro code itself it's not actually iced

443
00:19:27,580 --> 00:19:30,970
coffee the interesting part is is at the

444
00:19:30,970 --> 00:19:32,350
end of the get line you can see there's

445
00:19:32,350 --> 00:19:35,170
a little bit of data that's there that

446
00:19:35,170 --> 00:19:37,360
basic amount of system profiling

447
00:19:37,360 --> 00:19:39,880
whereas that the ex may equals x and

448
00:19:39,880 --> 00:19:41,080
then that next number is the process

449
00:19:41,080 --> 00:19:43,690
idea of W script dot exe that's running

450
00:19:43,690 --> 00:19:46,420
it should be running the backdoor the

451
00:19:46,420 --> 00:19:48,840
next bunch of bytes are just a series of

452
00:19:48,840 --> 00:19:50,710
queries about different registry

453
00:19:50,710 --> 00:19:52,690
settings and things and then that last

454
00:19:52,690 --> 00:19:55,420
word before the jpg is the like the

455
00:19:55,420 --> 00:19:57,040
first two characters of the host name

456
00:19:57,040 --> 00:19:59,320
that a username and then don't the

457
00:19:59,320 --> 00:20:02,290
domain or one some combination of those

458
00:20:02,290 --> 00:20:04,120
three just a unique somewhat unique

459
00:20:04,120 --> 00:20:06,190
identifier for the machine that is

460
00:20:06,190 --> 00:20:07,720
running on so that they could use

461
00:20:07,720 --> 00:20:09,250
obviously use that to compare against

462
00:20:09,250 --> 00:20:12,160
the beacon once know it you know if and

463
00:20:12,160 --> 00:20:13,780
when that the actual JavaScript backdoor

464
00:20:13,780 --> 00:20:19,360
starts starts working and here is the

465
00:20:19,360 --> 00:20:21,630
actual beacon for the malware itself

466
00:20:21,630 --> 00:20:24,220
really an interesting bit here is that

467
00:20:24,220 --> 00:20:27,070
setcookie session equals if you base64

468
00:20:27,070 --> 00:20:29,710
that decode that that is the rc4 key

469
00:20:29,710 --> 00:20:32,460
which is then used for the the payload

470
00:20:32,460 --> 00:20:35,140
which is all of that system information

471
00:20:35,140 --> 00:20:37,510
that you know that the WMI queries that

472
00:20:37,510 --> 00:20:40,750
it runs to generate a big JSON file it

473
00:20:40,750 --> 00:20:43,150
then it are it RC for encrypt and then

474
00:20:43,150 --> 00:20:46,150
base 64 encode x' and it sends it up so

475
00:20:46,150 --> 00:20:50,430
it's nothing nothing super fancy there

476
00:20:51,330 --> 00:20:54,010
the most recent Kopi Luwak that we saw

477
00:20:54,010 --> 00:20:58,060
was late this summer or early this

478
00:20:58,060 --> 00:21:00,160
summer I was kind of interesting we only

479
00:21:00,160 --> 00:21:06,520
saw two targets scientific energy kind

480
00:21:06,520 --> 00:21:09,510
of targeting government related but not

481
00:21:09,510 --> 00:21:11,680
specifically government in Syria and

482
00:21:11,680 --> 00:21:14,520
Afghanistan so two very interesting

483
00:21:14,520 --> 00:21:18,640
targets in the way this works it was a

484
00:21:18,640 --> 00:21:22,210
it was a zip link and you know with a

485
00:21:22,210 --> 00:21:25,810
it's CV it with a document or at CV doc

486
00:21:25,810 --> 00:21:28,600
or CV one one was disguised as a resume

487
00:21:28,600 --> 00:21:31,320
one was disguised as a spreadsheet and

488
00:21:31,320 --> 00:21:33,610
then within that there's PowerShell

489
00:21:33,610 --> 00:21:35,530
within the the link file which you can

490
00:21:35,530 --> 00:21:37,510
see is encoded first level of encoding

491
00:21:37,510 --> 00:21:40,330
just simple base64 within that there's

492
00:21:40,330 --> 00:21:43,150
more PowerShell which does the actual

493
00:21:43,150 --> 00:21:45,010
carving the payload out of the link file

494
00:21:45,010 --> 00:21:48,590
itself writes it to disk all that

495
00:21:48,590 --> 00:21:52,970
there's just multiple levels and you can

496
00:21:52,970 --> 00:21:55,490
see it'll write off SJS to disk and then

497
00:21:55,490 --> 00:21:59,990
the decoy doclist XLS we get so you know

498
00:21:59,990 --> 00:22:01,940
displayed to the end-user to you know

499
00:22:01,940 --> 00:22:03,230
look like it actually did something

500
00:22:03,230 --> 00:22:07,820
valid you know some of their code so

501
00:22:07,820 --> 00:22:11,480
what the office J us does is it runs it

502
00:22:11,480 --> 00:22:13,100
does all of the system profiling

503
00:22:13,100 --> 00:22:15,560
commands it does it sets up persistence

504
00:22:15,560 --> 00:22:18,530
in this case it uses a it sets up a log

505
00:22:18,530 --> 00:22:20,570
on task that runs immediately and then

506
00:22:20,570 --> 00:22:23,300
every 10 minutes so that'll keep you

507
00:22:23,300 --> 00:22:25,280
know the main maintain the persistence

508
00:22:25,280 --> 00:22:27,200
and keep it running and then it also

509
00:22:27,200 --> 00:22:30,710
writes out this do you see that app data

510
00:22:30,710 --> 00:22:32,750
roaming Microsoft chess stick check disk

511
00:22:32,750 --> 00:22:36,320
j/s that's the actual of the actual

512
00:22:36,320 --> 00:22:39,320
payload itself and then that persistence

513
00:22:39,320 --> 00:22:41,390
that scheduled task will run

514
00:22:41,390 --> 00:22:45,650
check this J s with a passphrase which

515
00:22:45,650 --> 00:22:48,020
is the rc4 key that it uses to decrypt

516
00:22:48,020 --> 00:22:50,110
within J when check this runs there's a

517
00:22:50,110 --> 00:22:53,420
RC 4 encoded blob in the middle it is

518
00:22:53,420 --> 00:22:55,850
actually the the money part of the the

519
00:22:55,850 --> 00:23:00,740
payload and here is a sample of the copy

520
00:23:00,740 --> 00:23:03,260
network traffic a little bit different

521
00:23:03,260 --> 00:23:05,060
than some of the early versions actually

522
00:23:05,060 --> 00:23:10,850
had a per user unique user agent the

523
00:23:10,850 --> 00:23:12,470
latest version got rid of that it you

524
00:23:12,470 --> 00:23:15,460
know looks a lot more legit again

525
00:23:15,460 --> 00:23:21,560
compromised C 2 infrastructure and idea

526
00:23:21,560 --> 00:23:25,220
I liked not gonna go and the payload

527
00:23:25,220 --> 00:23:26,780
encryption is a lot more complicated

528
00:23:26,780 --> 00:23:28,700
than with iced coffee then it's been

529
00:23:28,700 --> 00:23:30,260
wild it was well documented by us as

530
00:23:30,260 --> 00:23:33,230
well as a proof point later on so if

531
00:23:33,230 --> 00:23:35,060
you're interested gotcha check out those

532
00:23:35,060 --> 00:23:38,930
blogs we have references at the end but

533
00:23:38,930 --> 00:23:40,630
what was really interesting is that

534
00:23:40,630 --> 00:23:44,060
about two weeks or so before we found

535
00:23:44,060 --> 00:23:47,240
these Kopi Luwak being dropped by the

536
00:23:47,240 --> 00:23:47,930
link files

537
00:23:47,930 --> 00:23:50,810
we'd reported on zebra c using linked

538
00:23:50,810 --> 00:23:54,470
files to drop their their malware and

539
00:23:54,470 --> 00:23:57,110
when we looked at it we've this that

540
00:23:57,110 --> 00:23:58,710
third layer in of code

541
00:23:58,710 --> 00:24:01,549
you can see they are exactly the same I

542
00:24:01,549 --> 00:24:03,630
think there's one or two words that have

543
00:24:03,630 --> 00:24:05,700
a slight case insensitivity difference

544
00:24:05,700 --> 00:24:07,890
but all the variable names are the same

545
00:24:07,890 --> 00:24:10,919
everything else it could be

546
00:24:10,919 --> 00:24:12,899
you know I've ously it looks like some

547
00:24:12,899 --> 00:24:14,250
kind of builder or some kind of tool

548
00:24:14,250 --> 00:24:16,140
that's generating these because all you

549
00:24:16,140 --> 00:24:18,210
have to do is change the you know change

550
00:24:18,210 --> 00:24:19,500
the offsets and the payload and it

551
00:24:19,500 --> 00:24:20,850
doesn't matter you know it's it'll work

552
00:24:20,850 --> 00:24:22,950
from one to the next but I haven't been

553
00:24:22,950 --> 00:24:24,210
able to find any other samples that

554
00:24:24,210 --> 00:24:27,240
match these so either they're sharing

555
00:24:27,240 --> 00:24:29,429
the same weaponize er tool or they're

556
00:24:29,429 --> 00:24:32,610
you know perhaps like totally guys just

557
00:24:32,610 --> 00:24:35,010
actually saw the does ever see one in

558
00:24:35,010 --> 00:24:36,510
the wild and grabbed it and made their

559
00:24:36,510 --> 00:24:39,179
changes to it or or they're sharing

560
00:24:39,179 --> 00:24:41,010
tools or collaborating or buddies or you

561
00:24:41,010 --> 00:24:42,210
know talked about it over beers one

562
00:24:42,210 --> 00:24:47,490
night or something who knows yeah thanks

563
00:24:47,490 --> 00:24:49,890
yeah that overlap is fascinating I

564
00:24:49,890 --> 00:24:54,510
haven't seen that before so so to wrap

565
00:24:54,510 --> 00:24:57,630
it up well there's some things that we

566
00:24:57,630 --> 00:24:59,370
expect to see on the malware set side

567
00:24:59,370 --> 00:25:03,029
and on the targeting set in for the rest

568
00:25:03,029 --> 00:25:07,289
of 2018 and into 2019 from Turla we're

569
00:25:07,289 --> 00:25:09,840
seeing increased open-source tooling in

570
00:25:09,840 --> 00:25:13,110
malware this is surprising from Turla

571
00:25:13,110 --> 00:25:15,840
and you know this is the group who

572
00:25:15,840 --> 00:25:19,140
carried out epic Turla and was deploying

573
00:25:19,140 --> 00:25:22,799
snake this incredibly complex route

574
00:25:22,799 --> 00:25:25,350
kernel-mode rootkit for years had

575
00:25:25,350 --> 00:25:27,149
hundreds of victims all over the world

576
00:25:27,149 --> 00:25:29,760
really hyper high-profile interesting

577
00:25:29,760 --> 00:25:33,260
targets and they're moving to scripts

578
00:25:33,260 --> 00:25:37,409
and open source stuff they're continuing

579
00:25:37,409 --> 00:25:39,299
to maintain and modify their older

580
00:25:39,299 --> 00:25:41,159
elegant code like the carbon framework

581
00:25:41,159 --> 00:25:43,529
but again deployment is rare we don't

582
00:25:43,529 --> 00:25:46,230
see a whole lot of this in the wild but

583
00:25:46,230 --> 00:25:50,130
we do expect to see more of it there are

584
00:25:50,130 --> 00:25:52,340
indications that we're seeing a limited

585
00:25:52,340 --> 00:25:55,649
subset of a new family of malware that

586
00:25:55,649 --> 00:26:01,980
we haven't really digested but we do

587
00:26:01,980 --> 00:26:04,529
expect to see a new family in towards

588
00:26:04,529 --> 00:26:07,830
the end of 2018 we don't expect to see a

589
00:26:07,830 --> 00:26:09,480
whole lot of zero-day from these guys

590
00:26:09,480 --> 00:26:11,160
this is something they

591
00:26:11,160 --> 00:26:14,580
we're capable of back in 2014 but maybe

592
00:26:14,580 --> 00:26:16,350
in the past year we've only seen a zero

593
00:26:16,350 --> 00:26:19,680
day from them nothing in 2018 I don't

594
00:26:19,680 --> 00:26:22,650
think no water holing we haven't been

595
00:26:22,650 --> 00:26:25,080
seeing them and certainly no kernel

596
00:26:25,080 --> 00:26:28,620
rootkits so something is shifting and

597
00:26:28,620 --> 00:26:30,930
changing within the group but they're

598
00:26:30,930 --> 00:26:33,180
shedding all of their older skin and

599
00:26:33,180 --> 00:26:35,310
then the newer stuff that we may not be

600
00:26:35,310 --> 00:26:38,910
seeing that there's a lot of speculation

601
00:26:38,910 --> 00:26:40,980
about why we might not be seeing some of

602
00:26:40,980 --> 00:26:42,630
the newer more complex stuff from them

603
00:26:42,630 --> 00:26:45,120
well maybe they're using BGP Heitkamp

604
00:26:45,120 --> 00:26:48,120
hijacks boot kits maybe they're down at

605
00:26:48,120 --> 00:26:50,820
the AMT level we don't know but it's

606
00:26:50,820 --> 00:26:53,280
possibly something we can't see or some

607
00:26:53,280 --> 00:26:54,990
of the mobile exploitation that we hear

608
00:26:54,990 --> 00:26:57,780
about in the news and as far as

609
00:26:57,780 --> 00:26:59,760
targeting goes it's probably going to

610
00:26:59,760 --> 00:27:02,130
remain the same for the rest of 2018

611
00:27:02,130 --> 00:27:04,560
the stands have always been a target of

612
00:27:04,560 --> 00:27:06,300
these guys so sent all of Central Asia

613
00:27:06,300 --> 00:27:09,450
sort of on a rotating basis takes on

614
00:27:09,450 --> 00:27:13,590
targeting and it seems to rotate

615
00:27:13,590 --> 00:27:15,930
throughout the year all of these other

616
00:27:15,930 --> 00:27:18,300
regions in the world have been hotspots

617
00:27:18,300 --> 00:27:22,440
in 2017 2018 we expect to see more of

618
00:27:22,440 --> 00:27:27,030
that into 2019 so with that I'm gonna

619
00:27:27,030 --> 00:27:28,530
wrap it up do you have any closing

620
00:27:28,530 --> 00:27:30,750
thoughts all right thank you very much

621
00:27:30,750 --> 00:27:32,040
for your time if there are any questions

622
00:27:32,040 --> 00:27:36,649
oh okay thank you

