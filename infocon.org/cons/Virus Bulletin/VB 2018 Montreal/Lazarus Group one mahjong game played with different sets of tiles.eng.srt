1
00:00:00,290 --> 00:00:04,589
all right we will continue in the red

2
00:00:04,589 --> 00:00:07,200
room with the North Korean malware

3
00:00:07,200 --> 00:00:10,080
attacks please join me in welcoming

4
00:00:10,080 --> 00:00:13,620
Peter from ESET who will talk about the

5
00:00:13,620 --> 00:00:15,330
Lazarus group and their latest

6
00:00:15,330 --> 00:00:20,130
operations Peter yeah thank you hello

7
00:00:20,130 --> 00:00:21,720
welcome to our talk my name is Peter

8
00:00:21,720 --> 00:00:23,369
this research was done together with

9
00:00:23,369 --> 00:00:25,350
Michelle pollution II we are from ESET

10
00:00:25,350 --> 00:00:27,390
Czech Republic we have a lot of slides

11
00:00:27,390 --> 00:00:30,150
so let's go straight to the point

12
00:00:30,150 --> 00:00:32,460
Lazaro's group in action game played

13
00:00:32,460 --> 00:00:34,559
with different sets of tiles what does

14
00:00:34,559 --> 00:00:37,070
it mean what's the idea behind the title

15
00:00:37,070 --> 00:00:39,809
mahjong is a game

16
00:00:39,809 --> 00:00:43,020
today's game originated in China in the

17
00:00:43,020 --> 00:00:45,149
early 20th century for three or four

18
00:00:45,149 --> 00:00:48,629
players and basically it later spreads

19
00:00:48,629 --> 00:00:51,000
to the neighborhood countries in the in

20
00:00:51,000 --> 00:00:53,070
the East Asian region and during our

21
00:00:53,070 --> 00:00:55,110
malware investigation we have found a

22
00:00:55,110 --> 00:00:57,449
lot of traces that were associated with

23
00:00:57,449 --> 00:01:00,449
exactly this part of the world like many

24
00:01:00,449 --> 00:01:03,000
victims CNC servers lung language and

25
00:01:03,000 --> 00:01:06,990
cultural references so we had some kind

26
00:01:06,990 --> 00:01:10,140
of geographical reason next there is a

27
00:01:10,140 --> 00:01:12,299
simplified computerized version of the

28
00:01:12,299 --> 00:01:16,170
game called maximum soul eater this is

29
00:01:16,170 --> 00:01:18,780
kind of new game and it's a single

30
00:01:18,780 --> 00:01:22,409
player matching game and what's the what

31
00:01:22,409 --> 00:01:24,119
the rules are as follows you have the

32
00:01:24,119 --> 00:01:26,430
board with blunt lot of tiles and if you

33
00:01:26,430 --> 00:01:28,680
have two unblocked tiles with the same

34
00:01:28,680 --> 00:01:31,259
image on them you can like pair them and

35
00:01:31,259 --> 00:01:33,470
remove them from the board so you

36
00:01:33,470 --> 00:01:36,270
unblock more tiles and you continue in

37
00:01:36,270 --> 00:01:38,610
this manner until you clear the board

38
00:01:38,610 --> 00:01:40,920
and at that point you've just solved the

39
00:01:40,920 --> 00:01:44,270
puzzle what's the analogy here actually

40
00:01:44,270 --> 00:01:47,880
we imagine of the tiles as relevant

41
00:01:47,880 --> 00:01:50,520
static properties from Lazarus binaries

42
00:01:50,520 --> 00:01:55,140
mostly reported in big cases and like

43
00:01:55,140 --> 00:01:57,360
for example C&C servers and chunks of

44
00:01:57,360 --> 00:01:57,899
codes

45
00:01:57,899 --> 00:02:01,020
character strings and the goal was to

46
00:02:01,020 --> 00:02:04,259
find a match with the tiles extracted

47
00:02:04,259 --> 00:02:06,899
from new unrelated incoming binaries so

48
00:02:06,899 --> 00:02:10,288
we could like enlarge the pile that we

49
00:02:10,288 --> 00:02:13,420
briefly mentioned as Lazarus to set

50
00:02:13,420 --> 00:02:15,400
so that's the idea and why the word

51
00:02:15,400 --> 00:02:18,190
different in the title because this is

52
00:02:18,190 --> 00:02:20,110
relative to the peerage headers analysis

53
00:02:20,110 --> 00:02:21,700
and we mentioned it in the second

54
00:02:21,700 --> 00:02:24,430
section so let's briefly mention the

55
00:02:24,430 --> 00:02:28,690
outline we start with the reported cases

56
00:02:28,690 --> 00:02:31,090
these are not known so we try to spend

57
00:02:31,090 --> 00:02:32,950
as little time as possible with this

58
00:02:32,950 --> 00:02:35,670
section then we will mention main

59
00:02:35,670 --> 00:02:37,870
characteristics that helped us to play

60
00:02:37,870 --> 00:02:40,930
the game the matching game and finally

61
00:02:40,930 --> 00:02:44,110
we will conclude with six case studies

62
00:02:44,110 --> 00:02:46,540
of Lazarus attacks that we believe are

63
00:02:46,540 --> 00:02:51,610
not well known so let's move to the

64
00:02:51,610 --> 00:02:52,650
first part

65
00:02:52,650 --> 00:02:56,769
Lazaro's group is the most direct apt

66
00:02:56,769 --> 00:02:59,350
actor nowadays and if you wonder what

67
00:02:59,350 --> 00:03:01,330
those Korean symbols under the title

68
00:03:01,330 --> 00:03:05,860
means it's kim hume ball and it is a

69
00:03:05,860 --> 00:03:08,950
virtual alter-ego of a real person a

70
00:03:08,950 --> 00:03:11,620
programmer from north korea living in

71
00:03:11,620 --> 00:03:17,829
china who was recently inducted by the

72
00:03:17,829 --> 00:03:21,060
FBI in this criminal complaint and

73
00:03:21,060 --> 00:03:25,150
actually it has 179 pages

74
00:03:25,150 --> 00:03:27,760
did anybody go through the text please

75
00:03:27,760 --> 00:03:31,018
raise your hand okay

76
00:03:32,320 --> 00:03:35,950
the report is extensive it's precise

77
00:03:35,950 --> 00:03:40,079
it's reasonable and the FBI

78
00:03:40,079 --> 00:03:42,100
investigation details very well

79
00:03:42,100 --> 00:03:45,280
components traces that we see as mobile

80
00:03:45,280 --> 00:03:47,799
researches so I really recommend to read

81
00:03:47,799 --> 00:03:53,500
this this is document basically the FBI

82
00:03:53,500 --> 00:03:55,780
investigators also played magazine

83
00:03:55,780 --> 00:03:58,180
solitaire but the tiles were email

84
00:03:58,180 --> 00:04:01,269
addresses and boards where address books

85
00:04:01,269 --> 00:04:03,760
related to these email addresses those

86
00:04:03,760 --> 00:04:05,680
inner addresses were from Hotmail and

87
00:04:05,680 --> 00:04:09,190
Gmail accounts so they got visibility in

88
00:04:09,190 --> 00:04:11,470
those by the way there's a book online

89
00:04:11,470 --> 00:04:13,840
kim jongseo leadership of North Korea

90
00:04:13,840 --> 00:04:16,899
and on page 101 there's a fact that the

91
00:04:16,899 --> 00:04:18,690
second supreme leader of North Korea

92
00:04:18,690 --> 00:04:23,519
fancied mahjong in his free time so

93
00:04:24,120 --> 00:04:26,590
briefly mention the most important

94
00:04:26,590 --> 00:04:27,070
report

95
00:04:27,070 --> 00:04:30,340
operation what Buster February 2016 epic

96
00:04:30,340 --> 00:04:33,580
hundreds of pages like this was a source

97
00:04:33,580 --> 00:04:35,970
for future reference for future work and

98
00:04:35,970 --> 00:04:38,650
there was a description not just the

99
00:04:38,650 --> 00:04:40,030
binaries from Sony Pictures

100
00:04:40,030 --> 00:04:42,880
Entertainment hack but also many others

101
00:04:42,880 --> 00:04:44,860
may be other similar Marv

102
00:04:44,860 --> 00:04:47,740
starting from rats through spreaders up

103
00:04:47,740 --> 00:04:52,080
to Dido spots and is that defects

104
00:04:52,080 --> 00:04:55,780
Lazarus toolset binaries as architecture

105
00:04:55,780 --> 00:04:58,210
plus nukes pet and I guess Microsoft

106
00:04:58,210 --> 00:05:00,910
invented this name and it could be very

107
00:05:00,910 --> 00:05:02,830
likely it was created like Sony picture

108
00:05:02,830 --> 00:05:07,840
internet and data nuked next important

109
00:05:07,840 --> 00:05:09,430
attacks with the tags already mentioned

110
00:05:09,430 --> 00:05:11,890
in my my predecessor the attackers

111
00:05:11,890 --> 00:05:13,450
wanted to use not corrupted but

112
00:05:13,450 --> 00:05:15,670
fraudulent Swift payment messages

113
00:05:15,670 --> 00:05:19,390
against five five banks and actually

114
00:05:19,390 --> 00:05:21,610
they wanted to defraud 1 billion dollars

115
00:05:21,610 --> 00:05:23,590
in transactions but they were successful

116
00:05:23,590 --> 00:05:26,470
only in 8% of cases which is still quite

117
00:05:26,470 --> 00:05:30,040
a good heist and this heist was later

118
00:05:30,040 --> 00:05:32,500
laundered through multiple bank accounts

119
00:05:32,500 --> 00:05:34,300
and money renting businesses and casino

120
00:05:34,300 --> 00:05:37,420
junkets and this fact is from the FBI

121
00:05:37,420 --> 00:05:41,020
report and you can see on the slide like

122
00:05:41,020 --> 00:05:44,650
the main traces that were sourced for

123
00:05:44,650 --> 00:05:49,930
attribution another big important attack

124
00:05:49,930 --> 00:05:51,820
firstly reported by cell phone app

125
00:05:51,820 --> 00:05:52,600
strategist Rana

126
00:05:52,600 --> 00:05:56,110
it states that watering hole campaigns

127
00:05:56,110 --> 00:05:58,510
against polish banks were one of the

128
00:05:58,510 --> 00:05:59,830
most serious cyber attacks in the

129
00:05:59,830 --> 00:06:01,810
history of Poland regarding critical

130
00:06:01,810 --> 00:06:05,230
infrastructure and and banking sector

131
00:06:05,230 --> 00:06:07,780
and I guess everybody knows details

132
00:06:07,780 --> 00:06:10,480
about this what was interesting that you

133
00:06:10,480 --> 00:06:12,160
know the attackers who are successful

134
00:06:12,160 --> 00:06:14,290
against banks in Bangladesh in Vietnam

135
00:06:14,290 --> 00:06:16,060
and Mexico and it was kind of surprising

136
00:06:16,060 --> 00:06:18,610
that were also successful to get onto

137
00:06:18,610 --> 00:06:20,320
infrastructure of a member of European

138
00:06:20,320 --> 00:06:25,900
Union okay I don't need to introduce

139
00:06:25,900 --> 00:06:28,510
this place screen wanna crypto outbreak

140
00:06:28,510 --> 00:06:33,190
twelve of May 2017 what's interesting

141
00:06:33,190 --> 00:06:35,440
that peat understand is obviously

142
00:06:35,440 --> 00:06:38,740
modified it says November 2010 okay so

143
00:06:38,740 --> 00:06:39,729
that does not

144
00:06:39,729 --> 00:06:45,939
it's the intuition and everybody I guess

145
00:06:45,939 --> 00:06:49,270
know how the threat was was distributed

146
00:06:49,270 --> 00:06:52,150
through exploit the initial attribution

147
00:06:52,150 --> 00:06:54,129
was done by a Google engineer with a

148
00:06:54,129 --> 00:06:56,080
cryptic tweet he mentioned to threaten

149
00:06:56,080 --> 00:06:59,110
to hashes and offsets of the P files and

150
00:06:59,110 --> 00:07:02,020
you can see Ida Pro output the

151
00:07:02,020 --> 00:07:04,449
disassembly of the code at-least these

152
00:07:04,449 --> 00:07:07,259
offsets Kaspersky Labs later added

153
00:07:07,259 --> 00:07:09,729
hexadecimal string from the data section

154
00:07:09,729 --> 00:07:11,800
that was like shared basic title they

155
00:07:11,800 --> 00:07:15,639
the table for TLS communication so quite

156
00:07:15,639 --> 00:07:19,899
a strong links I guess okay that we

157
00:07:19,899 --> 00:07:22,029
conclude the first part and we move to

158
00:07:22,029 --> 00:07:25,330
the second one sources of Lazarus

159
00:07:25,330 --> 00:07:27,399
hacking tools seem to be modified with

160
00:07:27,399 --> 00:07:34,330
every attack as we mentioned already

161
00:07:34,330 --> 00:07:36,909
other install set is huge there's no

162
00:07:36,909 --> 00:07:39,039
such thing as a general scheme that

163
00:07:39,039 --> 00:07:41,289
could cover all binaries from the

164
00:07:41,289 --> 00:07:43,539
toolset but let's take a look at this

165
00:07:43,539 --> 00:07:45,370
dropper it's from watering hole

166
00:07:45,370 --> 00:07:48,789
campaigns against polish banks the

167
00:07:48,789 --> 00:07:51,490
invisible number 1 that feature is that

168
00:07:51,490 --> 00:07:54,669
the threat executor cascade will explain

169
00:07:54,669 --> 00:07:57,520
in a while number two is that it is a

170
00:07:57,520 --> 00:08:00,370
console application except accepting

171
00:08:00,370 --> 00:08:02,789
several parameters number three is that

172
00:08:02,789 --> 00:08:06,669
the binary resolves windows API

173
00:08:06,669 --> 00:08:09,879
functions dynamically one library after

174
00:08:09,879 --> 00:08:13,719
another and finally number four that it

175
00:08:13,719 --> 00:08:16,870
uses rc4 like cipher to extract

176
00:08:16,870 --> 00:08:19,569
additional stages from the resources are

177
00:08:19,569 --> 00:08:21,490
from the overlay or from the data

178
00:08:21,490 --> 00:08:27,459
sections let's explain the number one

179
00:08:27,459 --> 00:08:29,589
execution in a cascade this slides

180
00:08:29,589 --> 00:08:32,139
this slide shows various moods of

181
00:08:32,139 --> 00:08:34,589
matryoshka doll it's a Russian toy

182
00:08:34,589 --> 00:08:36,940
basically you have one layer you uncover

183
00:08:36,940 --> 00:08:38,919
it you have another layer you uncover it

184
00:08:38,919 --> 00:08:41,889
too and you continue in this manner so

185
00:08:41,889 --> 00:08:43,448
let's take look at the first layer a

186
00:08:43,448 --> 00:08:46,120
dropper looks pretty benign innocent you

187
00:08:46,120 --> 00:08:48,670
know and it is actually because there's

188
00:08:48,670 --> 00:08:51,579
no obfuscation no signs of polymorphism

189
00:08:51,579 --> 00:08:52,200
no

190
00:08:52,200 --> 00:08:54,990
the analysis it just extracts additional

191
00:08:54,990 --> 00:08:58,340
air the next stage a loader that

192
00:08:58,340 --> 00:09:00,600
displays some kind of maliciousness

193
00:09:00,600 --> 00:09:02,730
because it could load as a Windows

194
00:09:02,730 --> 00:09:04,860
service with persistence it could load

195
00:09:04,860 --> 00:09:07,890
additional stages from the registry or

196
00:09:07,890 --> 00:09:10,920
from Windows system files and finally a

197
00:09:10,920 --> 00:09:13,830
module the payload it could be anything

198
00:09:13,830 --> 00:09:21,060
from a DDoS bot to write let's take look

199
00:09:21,060 --> 00:09:23,580
at dynamic resolutions of Windows api's

200
00:09:23,580 --> 00:09:27,870
we extracted eggs windows api's that

201
00:09:27,870 --> 00:09:30,390
were kind of similar to many of the

202
00:09:30,390 --> 00:09:33,000
source binaries like windows exec

203
00:09:33,000 --> 00:09:35,490
connect get logical drives get adapters

204
00:09:35,490 --> 00:09:39,750
info and we tried to find variations of

205
00:09:39,750 --> 00:09:42,000
these and which kind of like encoding or

206
00:09:42,000 --> 00:09:44,160
encryption the guys used to obfuscate

207
00:09:44,160 --> 00:09:47,760
these function names and what do the

208
00:09:47,760 --> 00:09:50,310
colours mean here the red cells

209
00:09:50,310 --> 00:09:53,610
represent function names used in the big

210
00:09:53,610 --> 00:09:57,780
famous cases and the blue ones are from

211
00:09:57,780 --> 00:10:00,480
the cases that were not reported and but

212
00:10:00,480 --> 00:10:03,510
we attributed them to lazarus and the

213
00:10:03,510 --> 00:10:06,270
yellow one is from operation Troy it

214
00:10:06,270 --> 00:10:08,340
dates back to two thousand nine or ten

215
00:10:08,340 --> 00:10:10,830
but the binaries from this operation

216
00:10:10,830 --> 00:10:14,280
displayed a lot of anomalies that we

217
00:10:14,280 --> 00:10:17,570
kind of very confused and so we excluded

218
00:10:17,570 --> 00:10:20,400
binaries from operation Troy within our

219
00:10:20,400 --> 00:10:26,850
consideration this is an a logic table

220
00:10:26,850 --> 00:10:32,070
for format strings the writers of Osiris

221
00:10:32,070 --> 00:10:34,470
tools love to format strings especially

222
00:10:34,470 --> 00:10:37,470
a command that would run a console

223
00:10:37,470 --> 00:10:40,020
application and collects its output and

224
00:10:40,020 --> 00:10:42,600
we have found twenty or thirty groups or

225
00:10:42,600 --> 00:10:45,300
methods how to how they office cated

226
00:10:45,300 --> 00:10:50,220
this formatting string and you can find

227
00:10:50,220 --> 00:10:52,080
more in the paper because this is just

228
00:10:52,080 --> 00:10:54,510
an extract there are many more methods

229
00:10:54,510 --> 00:10:57,120
how they did it this is that these are

230
00:10:57,120 --> 00:11:00,980
just the main known cases

231
00:11:01,770 --> 00:11:04,570
let's say a few words about fake TLS

232
00:11:04,570 --> 00:11:07,090
protocol on the screen you can see how

233
00:11:07,090 --> 00:11:10,570
how our prepares a buffer on the stack

234
00:11:10,570 --> 00:11:13,780
that would represent like like

235
00:11:13,780 --> 00:11:15,340
connection malicious connection

236
00:11:15,340 --> 00:11:17,860
it looks like TLS protocol but it isn't

237
00:11:17,860 --> 00:11:21,040
and it uses it uses some popular domain

238
00:11:21,040 --> 00:11:23,380
to mimic a mimic the connection so

239
00:11:23,380 --> 00:11:24,580
perhaps some intrusion prevention

240
00:11:24,580 --> 00:11:27,070
systems would not recognize this as a

241
00:11:27,070 --> 00:11:30,220
malicious connection and we have found

242
00:11:30,220 --> 00:11:32,620
various different sets of popular

243
00:11:32,620 --> 00:11:34,930
domains that were like misused in this

244
00:11:34,930 --> 00:11:38,140
sense for example by dude regarding the

245
00:11:38,140 --> 00:11:40,810
popularity baidu.com is number one in

246
00:11:40,810 --> 00:11:44,110
China navcom is number three in South

247
00:11:44,110 --> 00:11:48,100
Korea vk.com is number one in Russia so

248
00:11:48,100 --> 00:11:50,280
the conclusion is that the attackers

249
00:11:50,280 --> 00:11:54,400
haven't excluded fixed victims for the

250
00:11:54,400 --> 00:11:57,700
victims who would be like who could use

251
00:11:57,700 --> 00:12:04,030
this kind of services another very

252
00:12:04,030 --> 00:12:05,650
interesting feature self-deleting

253
00:12:05,650 --> 00:12:07,540
matches the purpose of these batches

254
00:12:07,540 --> 00:12:11,110
were to delete stages of malware that

255
00:12:11,110 --> 00:12:13,840
were not useful in the stages of attack

256
00:12:13,840 --> 00:12:17,410
and these batches played a key role in

257
00:12:17,410 --> 00:12:20,740
many attribution cases again I refer to

258
00:12:20,740 --> 00:12:22,810
the paper we have found far more

259
00:12:22,810 --> 00:12:24,820
examples than they are displayed in this

260
00:12:24,820 --> 00:12:30,790
slide and let's say a few words about

261
00:12:30,790 --> 00:12:33,100
our p rich headers the research are

262
00:12:33,100 --> 00:12:35,970
mostly mostly linker versions of

263
00:12:35,970 --> 00:12:40,260
binaries that were attributed to others

264
00:12:40,260 --> 00:12:43,840
we took 32-bit files from the toolset

265
00:12:43,840 --> 00:12:46,630
and were curious about which visual

266
00:12:46,630 --> 00:12:49,390
studio produced linked linked these

267
00:12:49,390 --> 00:12:51,790
binaries and we found out that 95

268
00:12:51,790 --> 00:12:55,660
percent of 32-bit binaries were linked

269
00:12:55,660 --> 00:12:59,590
with Visual Studio 98 and 2010 and the

270
00:12:59,590 --> 00:13:02,020
rest were some anomalies like 2012 and

271
00:13:02,020 --> 00:13:06,520
we as 2013 what's interesting that if we

272
00:13:06,520 --> 00:13:10,959
if we did it for the 64-bit landscape

273
00:13:10,959 --> 00:13:15,529
we arrived at 95% of binaries linked

274
00:13:15,529 --> 00:13:18,199
with v3 as 2010 which is a good

275
00:13:18,199 --> 00:13:21,639
agreement and again some anomalies like

276
00:13:21,639 --> 00:13:31,220
2012 and vs 2013 so however we have

277
00:13:31,220 --> 00:13:33,859
found many different anomalies so if we

278
00:13:33,859 --> 00:13:36,109
could just very roughly classify cells

279
00:13:36,109 --> 00:13:40,009
like operating by the cells of Lazarus

280
00:13:40,009 --> 00:13:41,749
operating it could be one cell that uses

281
00:13:41,749 --> 00:13:45,109
Visual Studio 98 then then the cell

282
00:13:45,109 --> 00:13:47,600
using is a Studio 2010 and then a few

283
00:13:47,600 --> 00:13:50,449
cells that we don't know which entities

284
00:13:50,449 --> 00:13:53,059
they are and we found more these kind of

285
00:13:53,059 --> 00:13:56,749
anomalies as as I mentioned already

286
00:13:56,749 --> 00:13:59,289
operation Troy and binaries from it

287
00:13:59,289 --> 00:14:02,829
really didn't fit the whole scheme

288
00:14:02,829 --> 00:14:05,600
however manuscript mentioned by my

289
00:14:05,600 --> 00:14:08,809
predecessor aka thought you was also

290
00:14:08,809 --> 00:14:12,829
produced by DES 2012 which does not fit

291
00:14:12,829 --> 00:14:16,850
the scheme and also the recent Bitcoin

292
00:14:16,850 --> 00:14:19,129
oriented attacks and binaries used in

293
00:14:19,129 --> 00:14:24,109
them using vs 2015 were also do not fit

294
00:14:24,109 --> 00:14:27,339
the scheme what was even more

295
00:14:27,339 --> 00:14:29,899
disappointing that we have found what I

296
00:14:29,899 --> 00:14:33,529
would call mixed Cascades so imagine you

297
00:14:33,529 --> 00:14:37,549
have a dropper linked with vs 98 that

298
00:14:37,549 --> 00:14:40,009
drops like two loaders that were linked

299
00:14:40,009 --> 00:14:44,419
with 2013 and a load final payload at

300
00:14:44,419 --> 00:14:46,309
first but were a grant compiled with

301
00:14:46,309 --> 00:14:51,409
vsauce2 the old 98 and what I would call

302
00:14:51,409 --> 00:14:53,839
only issue architectures so as I thought

303
00:14:53,839 --> 00:14:55,569
before there was an agreement between

304
00:14:55,569 --> 00:15:00,859
like Visual Studio 98 and 19 2010

305
00:15:00,859 --> 00:15:03,049
however we have found exactly same

306
00:15:03,049 --> 00:15:06,589
project compiled as our length as Smith

307
00:15:06,589 --> 00:15:10,939
was to do 98 in 32 bit like landscape

308
00:15:10,939 --> 00:15:16,089
and not 2010 but 2013 so another another

309
00:15:16,089 --> 00:15:21,069
like anomaly that we couldn't explain

310
00:15:21,900 --> 00:15:25,200
and let's move to the final part our 6/6

311
00:15:25,200 --> 00:15:34,890
case studies I guess you recognize this

312
00:15:34,890 --> 00:15:37,830
team if variations of Marilyn Monroe by

313
00:15:37,830 --> 00:15:42,390
Andy Warhol a pop art piece this is like

314
00:15:42,390 --> 00:15:44,640
instead of Marilyn you can see like

315
00:15:44,640 --> 00:15:50,460
splash from one cry 2.0 and but if you

316
00:15:50,460 --> 00:15:53,520
go like a few weeks earlier than the

317
00:15:53,520 --> 00:15:56,340
outbreak time you would arrive at what

318
00:15:56,340 --> 00:15:59,940
people call version 1 of honor wanna cry

319
00:15:59,940 --> 00:16:03,210
it was like Pete Einstein said March

320
00:16:03,210 --> 00:16:06,420
2017 it was not spread by the exploit of

321
00:16:06,420 --> 00:16:10,440
course it was spread by the stolen

322
00:16:10,440 --> 00:16:14,490
credentials of SMB logins so the impact

323
00:16:14,490 --> 00:16:16,890
was pretty low the design is roughly the

324
00:16:16,890 --> 00:16:19,200
same except the title which says the

325
00:16:19,200 --> 00:16:23,070
version number if you move one month

326
00:16:23,070 --> 00:16:25,980
earlier you would arrive at this this

327
00:16:25,980 --> 00:16:29,160
piece so-called version zero or the beta

328
00:16:29,160 --> 00:16:31,350
version peaked on stem cells February

329
00:16:31,350 --> 00:16:35,550
2017 design slightly changed not red but

330
00:16:35,550 --> 00:16:40,830
green colors but static aesthetically

331
00:16:40,830 --> 00:16:43,620
the foul was also like similar to

332
00:16:43,620 --> 00:16:45,360
version one and distributed in the same

333
00:16:45,360 --> 00:16:48,150
way but I'm not sure if you know this

334
00:16:48,150 --> 00:16:51,090
this one I would call it version minus

335
00:16:51,090 --> 00:16:53,430
one we haven't seen any reports about

336
00:16:53,430 --> 00:16:57,650
this one and the P time stamp says like

337
00:16:57,650 --> 00:17:02,130
August August 2016 and of course we

338
00:17:02,130 --> 00:17:04,800
Thompson could be modified however the

339
00:17:04,800 --> 00:17:06,300
first submission date to the virus total

340
00:17:06,300 --> 00:17:10,800
service says September 2016 the design

341
00:17:10,800 --> 00:17:12,390
is roughly the same as the version zero

342
00:17:12,390 --> 00:17:16,260
so the conclusion is that the concept

343
00:17:16,260 --> 00:17:19,680
for one cry existed already in 2016 on

344
00:17:19,680 --> 00:17:24,510
virustotal let's move to the second case

345
00:17:24,510 --> 00:17:26,550
this is a glitched version of a banner

346
00:17:26,550 --> 00:17:30,390
that we used in our watering hole report

347
00:17:30,390 --> 00:17:34,669
on the attacks against Polish banks

348
00:17:34,669 --> 00:17:37,409
while we choose such picture because we

349
00:17:37,409 --> 00:17:39,330
found this attack at the same time it's

350
00:17:39,330 --> 00:17:42,630
February 2017 and several Java

351
00:17:42,630 --> 00:17:45,570
downloaders like hosted on this remote

352
00:17:45,570 --> 00:17:48,299
storage and you can see the Java code

353
00:17:48,299 --> 00:17:51,630
it's basically just it prepares prepares

354
00:17:51,630 --> 00:17:55,110
the payload and on the right of the Java

355
00:17:55,110 --> 00:17:57,510
code you can see a switch it checks the

356
00:17:57,510 --> 00:18:00,389
victims environment if it's Windows then

357
00:18:00,389 --> 00:18:03,510
it will do what what one expects but if

358
00:18:03,510 --> 00:18:06,840
it's not then it would download download

359
00:18:06,840 --> 00:18:08,820
the binary called something like

360
00:18:08,820 --> 00:18:12,029
Lionel's have been and we weren't able

361
00:18:12,029 --> 00:18:15,600
to acquire this binary and actually it's

362
00:18:15,600 --> 00:18:18,029
very really like it's suspicious that

363
00:18:18,029 --> 00:18:20,370
the decode does not check the

364
00:18:20,370 --> 00:18:22,649
architecture in this case because you

365
00:18:22,649 --> 00:18:25,169
know in linux environment the the

366
00:18:25,169 --> 00:18:27,630
architecture of elf binary needs to fit

367
00:18:27,630 --> 00:18:30,419
to fit the environment of operating

368
00:18:30,419 --> 00:18:33,029
system so we believe that this is just

369
00:18:33,029 --> 00:18:35,190
the testing code and there's no real

370
00:18:35,190 --> 00:18:36,870
mechanism there was no real mechanism

371
00:18:36,870 --> 00:18:43,529
this is how we did the attribution so

372
00:18:43,529 --> 00:18:45,690
for the for the windows binaries we were

373
00:18:45,690 --> 00:18:48,539
able to acquire those and we found a

374
00:18:48,539 --> 00:18:51,630
dropper there we extracted the modules

375
00:18:51,630 --> 00:18:54,659
one of the modules were a keylogger but

376
00:18:54,659 --> 00:18:58,460
one of the binaries were was backdoor

377
00:18:58,460 --> 00:19:01,620
very likely very very similar to one

378
00:19:01,620 --> 00:19:04,559
that was reported in operation

379
00:19:04,559 --> 00:19:06,269
blockbuster so we concluded that the

380
00:19:06,269 --> 00:19:12,350
whole attack is attributed to lazarus

381
00:19:13,909 --> 00:19:17,100
case number 4 3 i guess what do you see

382
00:19:17,100 --> 00:19:19,440
on the picture grave a tree growing out

383
00:19:19,440 --> 00:19:22,110
of the grave having big black poisonous

384
00:19:22,110 --> 00:19:24,809
fruits the guardian hiding behind the

385
00:19:24,809 --> 00:19:27,419
grave and snake in front what does this

386
00:19:27,419 --> 00:19:33,809
mean in September 2017 the core image of

387
00:19:33,809 --> 00:19:36,720
the previous you see we reported about

388
00:19:36,720 --> 00:19:39,289
this monitor minor like it was spread

389
00:19:39,289 --> 00:19:42,330
through remote code execution against

390
00:19:42,330 --> 00:19:45,570
32-bit Windows Server servers 2003 and

391
00:19:45,570 --> 00:19:46,840
ancient

392
00:19:46,840 --> 00:19:51,460
that since July 20 2015 and the proof of

393
00:19:51,460 --> 00:19:55,480
concept was published in May 2017 and we

394
00:19:55,480 --> 00:19:57,970
were able to capture the whole chain so

395
00:19:57,970 --> 00:20:00,460
we concluded that there could be a

396
00:20:00,460 --> 00:20:02,800
single actor behind this attack because

397
00:20:02,800 --> 00:20:05,650
the final payload was just modified open

398
00:20:05,650 --> 00:20:08,410
source project for mana remaining and

399
00:20:08,410 --> 00:20:10,600
the exploit was just a copy of the proof

400
00:20:10,600 --> 00:20:14,700
of concept so no circus fish knows no

401
00:20:14,700 --> 00:20:17,770
complicated like approach so it was just

402
00:20:17,770 --> 00:20:20,620
collecting low-hanging fruit fruits from

403
00:20:20,620 --> 00:20:24,250
the internet what does do this with

404
00:20:24,250 --> 00:20:26,760
Lazarus

405
00:20:27,510 --> 00:20:31,990
we found another bailout and we detected

406
00:20:31,990 --> 00:20:34,270
as nukes pet Bo as we mentioned earlier

407
00:20:34,270 --> 00:20:39,030
we detect Lazarus stuff as nukes pet and

408
00:20:39,030 --> 00:20:42,040
these were the remote storages that

409
00:20:42,040 --> 00:20:45,400
distributed the payload however they

410
00:20:45,400 --> 00:20:48,340
didn't capture the exploit itself so it

411
00:20:48,340 --> 00:20:50,080
was really like log prevalent

412
00:20:50,080 --> 00:20:52,900
however the metadata regarding the

413
00:20:52,900 --> 00:20:55,390
attack they're very very like persuading

414
00:20:55,390 --> 00:20:58,690
convincing that it was remote code

415
00:20:58,690 --> 00:21:03,210
execution against those ancient systems

416
00:21:03,900 --> 00:21:06,340
the attribution was done through two

417
00:21:06,340 --> 00:21:09,250
traces the first one shared network its

418
00:21:09,250 --> 00:21:11,890
infrastructure from a different Lazarus

419
00:21:11,890 --> 00:21:14,890
file and these to debug strings that

420
00:21:14,890 --> 00:21:18,400
were that were found only in binaries

421
00:21:18,400 --> 00:21:22,030
related to Lazarus what what was

422
00:21:22,030 --> 00:21:24,340
interesting about this that the the

423
00:21:24,340 --> 00:21:26,440
dropper was not benign that much

424
00:21:26,440 --> 00:21:28,240
actually there was a compression layer

425
00:21:28,240 --> 00:21:32,320
over the dropper it was a source open

426
00:21:32,320 --> 00:21:34,840
source project called the expec there's

427
00:21:34,840 --> 00:21:37,840
a series of blog post from 2014 that

428
00:21:37,840 --> 00:21:40,060
that gives you instructions how to

429
00:21:40,060 --> 00:21:42,790
create your own malware Packer so I

430
00:21:42,790 --> 00:21:45,400
guess the attackers just just followed

431
00:21:45,400 --> 00:21:49,360
these hints and there's no not much

432
00:21:49,360 --> 00:21:51,670
obfuscation not much ante analysis not

433
00:21:51,670 --> 00:21:55,080
much polymorphism it's just you px like

434
00:21:55,080 --> 00:21:57,799
compression without a static unpacker

435
00:21:57,799 --> 00:22:03,139
available let's move to the case number

436
00:22:03,139 --> 00:22:06,860
four but do see I can see Lazaro's with

437
00:22:06,860 --> 00:22:09,619
his eyes colored with a vial and the

438
00:22:09,619 --> 00:22:11,629
hidden Cobra behind him and a Chinese

439
00:22:11,629 --> 00:22:15,259
lettuce what do those Chinese letters

440
00:22:15,259 --> 00:22:17,509
mean if we want to understand this

441
00:22:17,509 --> 00:22:23,149
scenario we need to switch to Chinese we

442
00:22:23,149 --> 00:22:25,549
found a very rare very strange binary

443
00:22:25,549 --> 00:22:28,009
which was a server part of a remote

444
00:22:28,009 --> 00:22:30,830
access tool and this binary of was

445
00:22:30,830 --> 00:22:33,919
expecting an eye and eye configuration

446
00:22:33,919 --> 00:22:37,129
file is the section named fubuki which

447
00:22:37,129 --> 00:22:39,919
is a pin in romanization of those

448
00:22:39,919 --> 00:22:43,450
Chinese letters and it means server and

449
00:22:43,450 --> 00:22:46,789
the attribution to the one a cry or two

450
00:22:46,789 --> 00:22:49,009
the last two Lazarus was done through

451
00:22:49,009 --> 00:22:51,769
the list of big corporations embedded in

452
00:22:51,769 --> 00:22:54,859
the binary and actually there were lot

453
00:22:54,859 --> 00:22:57,619
more traces like we also found client

454
00:22:57,619 --> 00:22:59,239
part that was distributed in the pre

455
00:22:59,239 --> 00:23:02,899
outbreak period and what was really like

456
00:23:02,899 --> 00:23:05,299
strange there was a list of South Korean

457
00:23:05,299 --> 00:23:08,539
TV series embedded in the binary you can

458
00:23:08,539 --> 00:23:14,450
see them on the right we reconstructed

459
00:23:14,450 --> 00:23:17,359
some of those those series like I don't

460
00:23:17,359 --> 00:23:24,830
know this it's like pieces case number 5

461
00:23:24,830 --> 00:23:29,119
what do you see I see anxiety maybe

462
00:23:29,119 --> 00:23:31,940
depression death I see a lot of sad

463
00:23:31,940 --> 00:23:34,399
faces like around the central aggressive

464
00:23:34,399 --> 00:23:38,749
theme and perhaps this is the same thing

465
00:23:38,749 --> 00:23:44,119
that the the people people from online

466
00:23:44,119 --> 00:23:47,029
casino in Central America had when their

467
00:23:47,029 --> 00:23:50,899
infrastructure got kill disks and the

468
00:23:50,899 --> 00:23:53,359
distribution method was was known it was

469
00:23:53,359 --> 00:23:55,489
weak logins through these remote access

470
00:23:55,489 --> 00:24:00,559
tools like the attackers dropped a lot

471
00:24:00,559 --> 00:24:02,570
of files on the infrastructure of the

472
00:24:02,570 --> 00:24:05,840
casino TCP backdoors session hijackers

473
00:24:05,840 --> 00:24:09,770
virus loaders and kill disks of course

474
00:24:09,770 --> 00:24:13,220
what was strange that the binaries were

475
00:24:13,220 --> 00:24:15,710
office gated with the end product recent

476
00:24:15,710 --> 00:24:19,730
versions and stamina and when we blocked

477
00:24:19,730 --> 00:24:22,280
about this many many people who I know

478
00:24:22,280 --> 00:24:25,100
that that tried to track Lazarus were

479
00:24:25,100 --> 00:24:27,920
not really convinced that it was ours so

480
00:24:27,920 --> 00:24:32,200
I I had to explain them more carefully

481
00:24:32,590 --> 00:24:37,429
and basically it was done through to two

482
00:24:37,429 --> 00:24:40,490
main like traces the first one if you if

483
00:24:40,490 --> 00:24:44,090
you like unprotected altimeter files you

484
00:24:44,090 --> 00:24:47,600
would find these like TCP backdoors

485
00:24:47,600 --> 00:24:53,360
and format strings that they use but

486
00:24:53,360 --> 00:24:55,820
more strongly there was a session

487
00:24:55,820 --> 00:24:58,670
hijacker reported by Kaspersky related

488
00:24:58,670 --> 00:25:01,400
to watering hall attacks against Polish

489
00:25:01,400 --> 00:25:04,550
and Mexican banks and it was Tammy

490
00:25:04,550 --> 00:25:07,309
deprotected variety of the exactly

491
00:25:07,309 --> 00:25:10,670
Center they reported so we concluded

492
00:25:10,670 --> 00:25:12,679
that these two links are strong enough

493
00:25:12,679 --> 00:25:17,260
to attribute the attack towards Earth

494
00:25:18,490 --> 00:25:21,530
perhaps the attackers were a little bit

495
00:25:21,530 --> 00:25:23,960
cynical because they chose love but

496
00:25:23,960 --> 00:25:28,070
public VN calm as a C&C server and this

497
00:25:28,070 --> 00:25:30,679
is another another Trace that the

498
00:25:30,679 --> 00:25:32,600
attackers built their toes in front of

499
00:25:32,600 --> 00:25:35,720
before every attack and these are some

500
00:25:35,720 --> 00:25:37,990
of those indicators of compromised and

501
00:25:37,990 --> 00:25:42,410
the attackers mimic file names with

502
00:25:42,410 --> 00:25:48,020
those three letter shortcuts DRV SVC crv

503
00:25:48,020 --> 00:25:51,520
which like could mimic windows files

504
00:25:51,520 --> 00:25:54,380
moreover however two interesting files

505
00:25:54,380 --> 00:25:57,440
diamonds dot exe which was reported by

506
00:25:57,440 --> 00:25:59,540
Trend Micro in connection with attacks

507
00:25:59,540 --> 00:26:02,450
against financial institutions and an

508
00:26:02,450 --> 00:26:05,570
assault dot exe which was reported like

509
00:26:05,570 --> 00:26:07,520
the same file name was Val could be

510
00:26:07,520 --> 00:26:10,130
found in the report by Kaspersky in

511
00:26:10,130 --> 00:26:13,309
their lasers under the hood report it

512
00:26:13,309 --> 00:26:17,179
was it those were swift attacks

513
00:26:17,179 --> 00:26:21,480
and the final case unlike the previous

514
00:26:21,480 --> 00:26:24,600
previous cases we have only weak to

515
00:26:24,600 --> 00:26:28,110
medium confidence about this one let's

516
00:26:28,110 --> 00:26:32,669
explain why it's a strange combining :

517
00:26:32,669 --> 00:26:34,919
minor the distribution in the first

518
00:26:34,919 --> 00:26:37,370
phase of the attack it was really rare

519
00:26:37,370 --> 00:26:40,200
vulnerability through managed engine

520
00:26:40,200 --> 00:26:42,870
service decibels we couldn't confirm

521
00:26:42,870 --> 00:26:44,789
that it's exactly this distribution but

522
00:26:44,789 --> 00:26:47,760
our customer reported that it was the

523
00:26:47,760 --> 00:26:52,799
way how they got in but we checked the

524
00:26:52,799 --> 00:26:55,590
monarch wallet and it was like almost

525
00:26:55,590 --> 00:26:58,799
empty however in the second phase the

526
00:26:58,799 --> 00:27:01,049
manarola increased his 10 times but we

527
00:27:01,049 --> 00:27:03,480
didn't know distribution method in the

528
00:27:03,480 --> 00:27:05,399
second phase but small and medium-sized

529
00:27:05,399 --> 00:27:09,630
businesses were affected and this is the

530
00:27:09,630 --> 00:27:13,279
attribution we based it on which header

531
00:27:13,279 --> 00:27:16,799
metadata like basically these two

532
00:27:16,799 --> 00:27:19,350
projects one this bit combining service

533
00:27:19,350 --> 00:27:22,169
and one installer from the multiple

534
00:27:22,169 --> 00:27:23,940
multi platform Java download this case

535
00:27:23,940 --> 00:27:26,429
were roughly this of the same size and

536
00:27:26,429 --> 00:27:29,159
linked with the exactly same version of

537
00:27:29,159 --> 00:27:33,919
Visual Studio both used rc4 encryption

538
00:27:33,919 --> 00:27:37,380
however the bit combining service we

539
00:27:37,380 --> 00:27:39,450
will see in a while used a little bit

540
00:27:39,450 --> 00:27:40,889
different rc4

541
00:27:40,889 --> 00:27:43,860
it was not exactly the one that we know

542
00:27:43,860 --> 00:27:47,610
and both of these loaders use SDP file

543
00:27:47,610 --> 00:27:49,950
names to store encrypted content on the

544
00:27:49,950 --> 00:27:53,279
file system not exactly the same but

545
00:27:53,279 --> 00:27:56,610
however the file path was the same and

546
00:27:56,610 --> 00:28:01,950
the service name differed and this is

547
00:28:01,950 --> 00:28:06,600
the rc4 normal one there's a brand

548
00:28:06,600 --> 00:28:08,789
incineration part and decryption itself

549
00:28:08,789 --> 00:28:14,039
and the attackers added one command like

550
00:28:14,039 --> 00:28:17,279
they skipped every even iteration of the

551
00:28:17,279 --> 00:28:19,620
so the random generation part so normal

552
00:28:19,620 --> 00:28:23,600
decryption tools for rc4 didn't work so

553
00:28:23,779 --> 00:28:27,750
let's summarize what we heard

554
00:28:27,750 --> 00:28:31,150
Lazaro's is the mouth strength apt actor

555
00:28:31,150 --> 00:28:33,340
nowadays which is good because if you

556
00:28:33,340 --> 00:28:36,059
shine on the cyber crime scene you

557
00:28:36,059 --> 00:28:38,679
decreases the possibility that that you

558
00:28:38,679 --> 00:28:43,059
sleep through defenses certificates of

559
00:28:43,059 --> 00:28:44,830
hacking tools seem to be modified with

560
00:28:44,830 --> 00:28:47,980
every attack loved-ed cnc we have found

561
00:28:47,980 --> 00:28:50,080
a lot of not a lot of several cases

562
00:28:50,080 --> 00:28:52,710
binaries from virustotal that contained

563
00:28:52,710 --> 00:28:56,400
user username embedded in the binary

564
00:28:56,400 --> 00:29:02,110
username of the victim and there are

565
00:29:02,110 --> 00:29:04,240
quite a lot of instances of loss arrows

566
00:29:04,240 --> 00:29:06,490
that have not been completely resolved

567
00:29:06,490 --> 00:29:08,679
completely reported completely

568
00:29:08,679 --> 00:29:13,050
attributed so really huge tool set and

569
00:29:13,050 --> 00:29:19,870
not everything is clear I guess that's

570
00:29:19,870 --> 00:29:25,750
all from me and actually this year VARs

571
00:29:25,750 --> 00:29:28,600
button does not have table foosball

572
00:29:28,600 --> 00:29:30,970
table however we we are preparing a

573
00:29:30,970 --> 00:29:33,970
meeting tonight at fitzroyce and you can

574
00:29:33,970 --> 00:29:38,280
join our slack Slyke group channel and

575
00:29:38,280 --> 00:29:42,610
perhaps we'll meet there if you have any

576
00:29:42,610 --> 00:29:44,260
questions I'll be glad to answer them

577
00:29:44,260 --> 00:29:47,460
picture credits for these artists and

578
00:29:47,460 --> 00:29:50,610
that's all thank you

579
00:29:50,610 --> 00:29:58,849
[Applause]

