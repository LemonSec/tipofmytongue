1
00:00:00,060 --> 00:00:03,540
help me welcome pierre-luc and oliviere

2
00:00:03,540 --> 00:00:15,329
from zero spam security and enjoy the

3
00:00:15,330 --> 00:00:22,590
talk on a motet thank you very pretty to

4
00:00:22,590 --> 00:00:27,750
be here to present you this stock it's

5
00:00:27,750 --> 00:00:29,580
funny because the last talk was about

6
00:00:29,580 --> 00:00:33,630
also using machine learning to help

7
00:00:33,630 --> 00:00:36,420
security experts do their job and that's

8
00:00:36,420 --> 00:00:38,190
okay that's going to be the case again

9
00:00:38,190 --> 00:00:41,129
here how are we going to talk about how

10
00:00:41,129 --> 00:00:43,050
we were able to detect and block and

11
00:00:43,050 --> 00:00:45,989
emote at carrying email conversation

12
00:00:45,989 --> 00:00:48,570
thread like jacking campaign through our

13
00:00:48,570 --> 00:00:55,559
use of clustering my name is Khaled vu3

14
00:00:55,559 --> 00:00:58,710
and this is a live equal to we're both

15
00:00:58,710 --> 00:01:00,960
working at zero spam which is an email

16
00:01:00,960 --> 00:01:03,180
security company that offers an email

17
00:01:03,180 --> 00:01:04,229
filtering service that's available

18
00:01:04,229 --> 00:01:06,750
globally and basically we filter

19
00:01:06,750 --> 00:01:10,439
millions of emails per day an August job

20
00:01:10,439 --> 00:01:16,200
is to adapt our filters on daily basis

21
00:01:16,200 --> 00:01:20,340
to keep them up to date with always

22
00:01:20,340 --> 00:01:23,670
evolving threats and my job as a

23
00:01:23,670 --> 00:01:26,939
director is to research anything AI

24
00:01:26,939 --> 00:01:30,119
related and to better support the

25
00:01:30,119 --> 00:01:34,740
operations team I now give the floor to

26
00:01:34,740 --> 00:01:37,770
Ali G for the first part which will be

27
00:01:37,770 --> 00:01:42,840
about the story about about how we were

28
00:01:42,840 --> 00:01:44,759
able to detect and block this email

29
00:01:44,759 --> 00:01:47,700
question tracking campaign and I'll give

30
00:01:47,700 --> 00:01:51,119
the second part in which will go hundred

31
00:01:51,119 --> 00:01:53,990
hood to see how we did it

32
00:01:53,990 --> 00:01:58,770
ready Jake Thank You P Alec so indeed

33
00:01:58,770 --> 00:02:00,630
this is a bit of a story story with two

34
00:02:00,630 --> 00:02:03,149
things in my tests and the second is

35
00:02:03,149 --> 00:02:04,860
what we call email conversation thread

36
00:02:04,860 --> 00:02:06,930
email conversations thread hijacking

37
00:02:06,930 --> 00:02:08,639
that's a big word we're gonna explain

38
00:02:08,639 --> 00:02:10,979
exactly what that what this is with

39
00:02:10,979 --> 00:02:13,440
really a story of two people

40
00:02:13,440 --> 00:02:15,990
Ivan from company cargo Inc and Jane

41
00:02:15,990 --> 00:02:18,120
from let's say shipping company here and

42
00:02:18,120 --> 00:02:19,950
these people have been talking over

43
00:02:19,950 --> 00:02:22,770
email know regularly for quite some time

44
00:02:22,770 --> 00:02:24,690
if we look back at an email a

45
00:02:24,690 --> 00:02:26,850
conversation they had in April so April

46
00:02:26,850 --> 00:02:30,570
17th this year hi Jane I hope you have a

47
00:02:30,570 --> 00:02:33,900
nice day and then Jane replies yes thank

48
00:02:33,900 --> 00:02:36,030
you for the asterisk all best wishes to

49
00:02:36,030 --> 00:02:38,130
you - you know a really regular email

50
00:02:38,130 --> 00:02:41,340
conversation so that's an April and and

51
00:02:41,340 --> 00:02:44,220
20th of September Ivan

52
00:02:44,220 --> 00:02:47,970
answers another email morning please see

53
00:02:47,970 --> 00:02:51,480
attach and confirm zip past 777 so

54
00:02:51,480 --> 00:02:52,740
that's really an answer of the previous

55
00:02:52,740 --> 00:02:54,510
threat same subject good signature

56
00:02:54,510 --> 00:02:56,280
everything something's a little weird

57
00:02:56,280 --> 00:02:58,620
though if you look at the attachment

58
00:02:58,620 --> 00:03:00,780
name it's the name of his company dot

59
00:03:00,780 --> 00:03:03,210
zip and you know why would they why

60
00:03:03,210 --> 00:03:05,190
would I even send an email at that time

61
00:03:05,190 --> 00:03:07,200
layer well we're not too sure yet let's

62
00:03:07,200 --> 00:03:10,260
look at another email here Ivan

63
00:03:10,260 --> 00:03:12,720
same Ivan is also corresponding was Tom

64
00:03:12,720 --> 00:03:17,130
from Pharma vision unrelated here and at

65
00:03:17,130 --> 00:03:18,360
the beginning of September they were

66
00:03:18,360 --> 00:03:20,660
talking about another project completely

67
00:03:20,660 --> 00:03:23,310
hi even can I get an update on this and

68
00:03:23,310 --> 00:03:27,750
on the 20th Ivan answers exactly the

69
00:03:27,750 --> 00:03:30,030
same answer please see attached and

70
00:03:30,030 --> 00:03:33,060
confirms it passed 777 same attached

71
00:03:33,060 --> 00:03:35,850
file now something is definitely wrong

72
00:03:35,850 --> 00:03:39,390
here and indeed what happened Ivan got

73
00:03:39,390 --> 00:03:42,270
infected so how does this work this is

74
00:03:42,270 --> 00:03:43,860
what we call email conversations - right

75
00:03:43,860 --> 00:03:46,230
hijacking how does it work well the user

76
00:03:46,230 --> 00:03:48,480
gets infected it might be the server it

77
00:03:48,480 --> 00:03:50,520
might be weak credentials it might be

78
00:03:50,520 --> 00:03:52,200
fishing you can mean a lot of things but

79
00:03:52,200 --> 00:03:55,230
a user gets infected and that users

80
00:03:55,230 --> 00:03:57,360
emails are all siphoned out they're sent

81
00:03:57,360 --> 00:04:00,959
out to the attacker to be replayed at

82
00:04:00,959 --> 00:04:03,390
some other point in time might be weeks

83
00:04:03,390 --> 00:04:06,000
might be months and so there's this new

84
00:04:06,000 --> 00:04:08,130
email is sent as a reply to the previous

85
00:04:08,130 --> 00:04:10,320
one that looks very legitimate it's

86
00:04:10,320 --> 00:04:12,060
going to include the signature it can

87
00:04:12,060 --> 00:04:13,560
include an attached file that references

88
00:04:13,560 --> 00:04:15,720
the name of the company so something

89
00:04:15,720 --> 00:04:18,298
that is very very convincing to the

90
00:04:18,298 --> 00:04:20,370
end-user and of course in this case that

91
00:04:20,370 --> 00:04:22,500
contains a motet so that's not something

92
00:04:22,500 --> 00:04:25,949
that you want to open now this type of

93
00:04:25,949 --> 00:04:29,400
attack is not exactly new if we look

94
00:04:29,400 --> 00:04:31,530
back in time the first reported instance

95
00:04:31,530 --> 00:04:33,599
we could find was by people at Palo Alto

96
00:04:33,599 --> 00:04:37,680
Network in 2017 that reported that North

97
00:04:37,680 --> 00:04:41,000
Korean hackers were using this type of

98
00:04:41,000 --> 00:04:44,400
fake reply there two real conversations

99
00:04:44,400 --> 00:04:47,189
for to gain intelligence on high-value

100
00:04:47,189 --> 00:04:49,800
targets but that was very very low

101
00:04:49,800 --> 00:04:51,870
volume that was something more akin to

102
00:04:51,870 --> 00:04:55,139
spearfishing than the MAL spam campaigns

103
00:04:55,139 --> 00:05:00,090
such as imitates it took actually almost

104
00:05:00,090 --> 00:05:03,270
a year 2018 to start seeing zero spam

105
00:05:03,270 --> 00:05:05,430
something like that appear and it's

106
00:05:05,430 --> 00:05:08,090
quite interesting how this happened

107
00:05:08,090 --> 00:05:10,710
usually what would happen in a typical

108
00:05:10,710 --> 00:05:13,439
case of a new spam campaign is we're

109
00:05:13,439 --> 00:05:15,870
going our daily daily lives and then our

110
00:05:15,870 --> 00:05:17,699
users call us and they say hey you're

111
00:05:17,699 --> 00:05:19,529
willing something through and then and

112
00:05:19,529 --> 00:05:21,659
then we see what's up but in this case

113
00:05:21,659 --> 00:05:24,689
what we found is that users were

114
00:05:24,689 --> 00:05:27,090
releasing emails from their quarantine

115
00:05:27,090 --> 00:05:30,000
with what we thought were no potentially

116
00:05:30,000 --> 00:05:32,699
malicious files so we thought well maybe

117
00:05:32,699 --> 00:05:34,199
we're wrong these emails look quite

118
00:05:34,199 --> 00:05:37,110
legitimate but stepping back with this

119
00:05:37,110 --> 00:05:39,509
bird's-eye view we could see that

120
00:05:39,509 --> 00:05:41,279
something was amiss by seeing those

121
00:05:41,279 --> 00:05:43,889
multiple emails that from unrelated

122
00:05:43,889 --> 00:05:45,419
conversations with the same answer that

123
00:05:45,419 --> 00:05:49,020
something was definitely wrong now at

124
00:05:49,020 --> 00:05:52,710
that point we would only see half a

125
00:05:52,710 --> 00:05:55,050
dozen such emails every week so very low

126
00:05:55,050 --> 00:05:56,339
volume compared to the millions of

127
00:05:56,339 --> 00:05:58,529
emails that we filter every day but you

128
00:05:58,529 --> 00:06:00,120
know we kind of kept an eye out on this

129
00:06:00,120 --> 00:06:01,919
this type of campaign so what was

130
00:06:01,919 --> 00:06:04,379
happening now at that date we had never

131
00:06:04,379 --> 00:06:06,300
heard of imited I had never heard of a

132
00:06:06,300 --> 00:06:08,339
maquette personally it was being a sniff

133
00:06:08,339 --> 00:06:10,379
that was being pushed by these these

134
00:06:10,379 --> 00:06:13,139
emails but fast forward a few months and

135
00:06:13,139 --> 00:06:15,569
if my pet is making the news the phone

136
00:06:15,569 --> 00:06:16,229
is ringing

137
00:06:16,229 --> 00:06:18,389
people call us hey hey hey do you block

138
00:06:18,389 --> 00:06:21,740
imitates and at that point the the

139
00:06:21,740 --> 00:06:24,719
Trojan was very effective but it was

140
00:06:24,719 --> 00:06:28,050
being sent through cruder means regular

141
00:06:28,050 --> 00:06:31,370
fake invoices annoying hard to block

142
00:06:31,370 --> 00:06:33,810
somewhat convincing but still kind of

143
00:06:33,810 --> 00:06:35,849
out of the blue so not really as

144
00:06:35,849 --> 00:06:37,450
convincing as

145
00:06:37,450 --> 00:06:42,970
reply to a previous email and so we're

146
00:06:42,970 --> 00:06:45,250
ZDNet reported in April of this year

147
00:06:45,250 --> 00:06:47,710
that Emma's dead had started using this

148
00:06:47,710 --> 00:06:50,380
mo this way of sending those emails to

149
00:06:50,380 --> 00:06:52,240
to infect its victims and at that point

150
00:06:52,240 --> 00:06:55,270
we were seeing hundreds of such emails

151
00:06:55,270 --> 00:06:58,720
that were blocked every every week in a

152
00:06:58,720 --> 00:07:00,700
quarantine so definitely there was it

153
00:07:00,700 --> 00:07:03,160
was picking up some momentum and finally

154
00:07:03,160 --> 00:07:07,810
in in August of this year we played

155
00:07:07,810 --> 00:07:09,850
picked up our first cluster our first

156
00:07:09,850 --> 00:07:11,980
sizable wave of such emails using

157
00:07:11,980 --> 00:07:15,040
clustering now this is kind of the

158
00:07:15,040 --> 00:07:16,690
reason we're here really because it's

159
00:07:16,690 --> 00:07:17,770
very interesting their clustering

160
00:07:17,770 --> 00:07:19,180
algorithm was not looking for something

161
00:07:19,180 --> 00:07:20,680
like that we'll get into the details a

162
00:07:20,680 --> 00:07:22,660
little later exactly how it did it but

163
00:07:22,660 --> 00:07:24,160
just to give you some context on the

164
00:07:24,160 --> 00:07:26,320
next slide what we're going to see is we

165
00:07:26,320 --> 00:07:28,690
have a lot of car dealerships as

166
00:07:28,690 --> 00:07:30,340
customers and car dealerships tend to

167
00:07:30,340 --> 00:07:31,690
send emails to one another

168
00:07:31,690 --> 00:07:34,210
and what happened is there was a dealer

169
00:07:34,210 --> 00:07:35,830
that was not protected through her

170
00:07:35,830 --> 00:07:37,600
service that are connected and started

171
00:07:37,600 --> 00:07:40,930
sending these infected replies to her

172
00:07:40,930 --> 00:07:44,440
customers and what we saw was that there

173
00:07:44,440 --> 00:07:46,390
were within 10 minutes ban there were 45

174
00:07:46,390 --> 00:07:48,070
emails that were sent to our customers

175
00:07:48,070 --> 00:07:51,340
with very different subjects if we look

176
00:07:51,340 --> 00:07:54,550
at this reply new car catalog reply

177
00:07:54,550 --> 00:07:57,310
forward updated priceless and even in

178
00:07:57,310 --> 00:07:59,470
French reply problem the Neha wall

179
00:07:59,470 --> 00:08:02,740
Medeiros evade sits now these completely

180
00:08:02,740 --> 00:08:05,350
different bodies there looks very

181
00:08:05,350 --> 00:08:06,240
different

182
00:08:06,240 --> 00:08:08,200
individually looked at one but then if

183
00:08:08,200 --> 00:08:10,180
you look at the big picture something

184
00:08:10,180 --> 00:08:13,180
was happening now an important part that

185
00:08:13,180 --> 00:08:15,400
we don't see on the slide is that what

186
00:08:15,400 --> 00:08:17,590
helped us identify that was that all the

187
00:08:17,590 --> 00:08:19,420
attached files had the same name they

188
00:08:19,420 --> 00:08:20,830
had the name of the company that was

189
00:08:20,830 --> 00:08:24,370
infected in this case you might be

190
00:08:24,370 --> 00:08:28,840
wondering why would a email security

191
00:08:28,840 --> 00:08:30,640
company be interested in putting

192
00:08:30,640 --> 00:08:33,010
together clustering emails or job is

193
00:08:33,010 --> 00:08:34,840
really around blocking them more than

194
00:08:34,840 --> 00:08:36,280
than understanding the threats usually

195
00:08:36,280 --> 00:08:38,250
but those are actually closely related

196
00:08:38,250 --> 00:08:41,590
now you see in most cases

197
00:08:41,590 --> 00:08:43,809
you know if we're doing with such an

198
00:08:43,809 --> 00:08:46,750
insecure medium as email we're going

199
00:08:46,750 --> 00:08:48,220
there's going to be some cat-and-mouse

200
00:08:48,220 --> 00:08:50,080
going on between the security companies

201
00:08:50,080 --> 00:08:51,550
and the spammers that find new ways to

202
00:08:51,550 --> 00:08:53,620
you know send their spam and send their

203
00:08:53,620 --> 00:08:55,780
malware campaigns so what used to happen

204
00:08:55,780 --> 00:08:57,640
is that there was a new campaign that

205
00:08:57,640 --> 00:08:59,290
was launched and then we were blissfully

206
00:08:59,290 --> 00:09:01,570
unaware until her customers call started

207
00:09:01,570 --> 00:09:02,830
calling us saying hey there's something

208
00:09:02,830 --> 00:09:04,810
you're not blocking and then her rules

209
00:09:04,810 --> 00:09:06,340
engineering team had to scramble and

210
00:09:06,340 --> 00:09:08,020
really understand what was happening

211
00:09:08,020 --> 00:09:10,840
what was the scope what was the what

212
00:09:10,840 --> 00:09:12,520
were the indicators compromised and

213
00:09:12,520 --> 00:09:14,770
develop a patch test it and deploy it

214
00:09:14,770 --> 00:09:16,930
and this would take at least 30 minutes

215
00:09:16,930 --> 00:09:19,630
and could go to in two hours territory

216
00:09:19,630 --> 00:09:22,960
so that is definitely longer than what

217
00:09:22,960 --> 00:09:23,590
we wanted

218
00:09:23,590 --> 00:09:26,590
now what clustering LS what clustering

219
00:09:26,590 --> 00:09:29,650
allows us to do is that within a few

220
00:09:29,650 --> 00:09:32,230
minutes of the new campaign being

221
00:09:32,230 --> 00:09:34,780
launched or clustering algorithms detect

222
00:09:34,780 --> 00:09:38,170
that something is unusual it's happening

223
00:09:38,170 --> 00:09:40,690
and at that point that can advise our

224
00:09:40,690 --> 00:09:42,880
team that is able to really react to

225
00:09:42,880 --> 00:09:45,940
this with extra information because you

226
00:09:45,940 --> 00:09:47,650
already have all that information that

227
00:09:47,650 --> 00:09:49,510
was produced by the clustering algorithm

228
00:09:49,510 --> 00:09:51,850
and the result is that we were reduced

229
00:09:51,850 --> 00:09:53,260
and we were able to reduce week all the

230
00:09:53,260 --> 00:09:56,020
time to block this time before full

231
00:09:56,020 --> 00:09:59,110
patching to under 20 minutes and so the

232
00:09:59,110 --> 00:10:02,080
customer receives fewer emails and is

233
00:10:02,080 --> 00:10:05,800
much happier and much more secure you

234
00:10:05,800 --> 00:10:07,540
might be thinking 20 minutes that's

235
00:10:07,540 --> 00:10:10,330
still kind of long and it's much surer

236
00:10:10,330 --> 00:10:11,710
than you used to be but I think we can

237
00:10:11,710 --> 00:10:14,050
do better and eventually we want to

238
00:10:14,050 --> 00:10:16,270
really reduce that second part where the

239
00:10:16,270 --> 00:10:19,060
clustering if it's certain enough it

240
00:10:19,060 --> 00:10:20,680
doesn't need to go to the humans and it

241
00:10:20,680 --> 00:10:28,020
would block on its own before we go into

242
00:10:28,020 --> 00:10:30,670
understanding how the clustering is done

243
00:10:30,670 --> 00:10:33,370
I just like you to to take a minute for

244
00:10:33,370 --> 00:10:35,080
everybody to understand how they can

245
00:10:35,080 --> 00:10:37,839
defend against email conversations

246
00:10:37,839 --> 00:10:40,510
thread hijacking the first thing I would

247
00:10:40,510 --> 00:10:42,820
recommend would be do not whitelist your

248
00:10:42,820 --> 00:10:46,300
contacts we have some people that's some

249
00:10:46,300 --> 00:10:48,040
some customers that get on board and say

250
00:10:48,040 --> 00:10:51,550
hey can I whitelist my 2,000 contacts

251
00:10:51,550 --> 00:10:53,140
and that's going to be a bad idea

252
00:10:53,140 --> 00:10:54,520
because in these case

253
00:10:54,520 --> 00:10:56,730
these are your legitimate business

254
00:10:56,730 --> 00:10:59,170
contacts sending you email so that's not

255
00:10:59,170 --> 00:11:02,380
something that you want to do second

256
00:11:02,380 --> 00:11:03,700
thing would be to make sure to

257
00:11:03,700 --> 00:11:08,380
quarantine suspicious files and ideally

258
00:11:08,380 --> 00:11:10,089
if you can make sure that only your

259
00:11:10,089 --> 00:11:12,430
admins are able to release them that

260
00:11:12,430 --> 00:11:15,220
just is better because the admins have

261
00:11:15,220 --> 00:11:17,110
access to what I called earlier the

262
00:11:17,110 --> 00:11:19,810
bird's-eye view this idea of seeing why

263
00:11:19,810 --> 00:11:22,750
would I get so many similar emails

264
00:11:22,750 --> 00:11:25,720
together whereas if the users only see

265
00:11:25,720 --> 00:11:28,300
their own reply to a conversation

266
00:11:28,300 --> 00:11:30,190
they've had before they're much more

267
00:11:30,190 --> 00:11:33,310
likely to release these very convincing

268
00:11:33,310 --> 00:11:37,630
emails with these dangerous files my

269
00:11:37,630 --> 00:11:39,250
third suggestion would be to enable

270
00:11:39,250 --> 00:11:42,250
Demark verification for those of you who

271
00:11:42,250 --> 00:11:45,550
are not aware Demark could be considered

272
00:11:45,550 --> 00:11:49,589
the child of SPF and DKIM signing and

273
00:11:49,589 --> 00:11:54,420
together they allow a very robust a

274
00:11:54,420 --> 00:11:57,010
defense against spoofing of the domain

275
00:11:57,010 --> 00:11:58,839
name and we've seen a lot of those

276
00:11:58,839 --> 00:12:00,730
emails blocked through Demark

277
00:12:00,730 --> 00:12:03,190
verification and even more would have

278
00:12:03,190 --> 00:12:04,570
been blocked if people had correctly

279
00:12:04,570 --> 00:12:06,810
published their d mark records to

280
00:12:06,810 --> 00:12:11,440
prevent spoofing in this case oh one

281
00:12:11,440 --> 00:12:14,620
last thing if there's any AV vendors in

282
00:12:14,620 --> 00:12:16,300
here on the floor I would recommend

283
00:12:16,300 --> 00:12:20,050
trying passwords 1 2 3 4 or 7 7 7 by

284
00:12:20,050 --> 00:12:21,760
default because they seem to be very

285
00:12:21,760 --> 00:12:25,329
popular with spammers pass it over to

286
00:12:25,329 --> 00:12:29,980
gelik under the hood Thank You Ellie yay

287
00:12:29,980 --> 00:12:32,649
now as I said earlier we're going to go

288
00:12:32,649 --> 00:12:34,390
under the hood to see how this

289
00:12:34,390 --> 00:12:36,279
clustering based campaign detection

290
00:12:36,279 --> 00:12:39,790
scheme works but first why use

291
00:12:39,790 --> 00:12:41,980
clustering in the first place for email

292
00:12:41,980 --> 00:12:47,020
filtering let me present you with three

293
00:12:47,020 --> 00:12:49,329
definitions which would be a phone

294
00:12:49,329 --> 00:12:52,000
answering that question first clustering

295
00:12:52,000 --> 00:12:53,920
is an unsupervised machine learning

296
00:12:53,920 --> 00:12:55,570
tasks and it's the task of grouping

297
00:12:55,570 --> 00:12:58,200
objects that are similar in some sense

298
00:12:58,200 --> 00:13:00,220
together into groups that we call

299
00:13:00,220 --> 00:13:02,890
clusters the in some sense is important

300
00:13:02,890 --> 00:13:04,810
here because we want to define our

301
00:13:04,810 --> 00:13:07,590
similarities so that we can and

302
00:13:07,590 --> 00:13:10,710
up with clusters that correspond nicely

303
00:13:10,710 --> 00:13:13,290
to email campaigns and here an email

304
00:13:13,290 --> 00:13:15,770
campaign is a coordinated set of

305
00:13:15,770 --> 00:13:18,480
individual email messages that are

306
00:13:18,480 --> 00:13:20,190
deployed across a specific period of

307
00:13:20,190 --> 00:13:23,640
time with one specific purpose and the

308
00:13:23,640 --> 00:13:25,680
fact that they are coordinated and they

309
00:13:25,680 --> 00:13:29,610
have one specific purpose will have the

310
00:13:29,610 --> 00:13:31,590
consequence that they will have things

311
00:13:31,590 --> 00:13:34,830
in common that we use to cluster them

312
00:13:34,830 --> 00:13:37,800
and the fact that they are were specific

313
00:13:37,800 --> 00:13:40,560
period of time will enable us to pick a

314
00:13:40,560 --> 00:13:42,810
slice of time and use that as data for

315
00:13:42,810 --> 00:13:46,320
our input for our clustering and once

316
00:13:46,320 --> 00:13:48,360
we've got our clusters that correspond

317
00:13:48,360 --> 00:13:51,510
to camp email campaigns in general we

318
00:13:51,510 --> 00:13:53,730
can always analyze the content of those

319
00:13:53,730 --> 00:13:55,920
clusters to determine if they are spam

320
00:13:55,920 --> 00:13:59,340
campaigns or legitimate campaigns and in

321
00:13:59,340 --> 00:14:03,030
that I mean by spanking satire by spam

322
00:14:03,030 --> 00:14:05,250
campaign I've just been a personal case

323
00:14:05,250 --> 00:14:08,040
of an email campaign that where the

324
00:14:08,040 --> 00:14:12,630
means or purpose are not legitimate so

325
00:14:12,630 --> 00:14:15,600
that's nice we have we know how in

326
00:14:15,600 --> 00:14:19,500
theory we could use clustering to to

327
00:14:19,500 --> 00:14:23,190
help in email filtering but does that

328
00:14:23,190 --> 00:14:27,030
work in practice well yes it works

329
00:14:27,030 --> 00:14:30,540
pretty well in fact so here you can see

330
00:14:30,540 --> 00:14:33,060
the interface our own email clustering

331
00:14:33,060 --> 00:14:35,640
implementation you can stare there's a

332
00:14:35,640 --> 00:14:39,830
list of clusters that correspond to

333
00:14:39,830 --> 00:14:44,670
email campaigns and if we look at the

334
00:14:44,670 --> 00:14:48,270
third third one from the bottom here you

335
00:14:48,270 --> 00:14:51,240
can see that's any a spam campaign and I

336
00:14:51,240 --> 00:14:57,950
totally blocked the second one here is

337
00:14:58,040 --> 00:15:00,960
legitimate commercial campaign and it's

338
00:15:00,960 --> 00:15:03,690
not black at all but if you look at the

339
00:15:03,690 --> 00:15:06,600
first one you can you see that it's

340
00:15:06,600 --> 00:15:09,410
partially blocked and that's a red flag

341
00:15:09,410 --> 00:15:12,570
and we can set alarms on that and that's

342
00:15:12,570 --> 00:15:16,710
exactly what happened with the car

343
00:15:16,710 --> 00:15:20,840
dealers that got infected

344
00:15:21,090 --> 00:15:24,630
and we can also analyze other

345
00:15:24,630 --> 00:15:26,880
characteristics of the clusters for

346
00:15:26,880 --> 00:15:28,710
example we have the cell networks column

347
00:15:28,710 --> 00:15:31,080
here where we can see the number of sub

348
00:15:31,080 --> 00:15:34,080
networks the emails come from inside the

349
00:15:34,080 --> 00:15:37,680
cluster and we also have the number of

350
00:15:37,680 --> 00:15:41,670
organizations to where to which the

351
00:15:41,670 --> 00:15:44,910
emails go to and if those numbers are

352
00:15:44,910 --> 00:15:47,370
high we can set an hour on that because

353
00:15:47,370 --> 00:15:50,070
it's suspicious so that our rules

354
00:15:50,070 --> 00:15:51,540
engineering team can do something about

355
00:15:51,540 --> 00:15:57,000
it and if we zoom in for example the

356
00:15:57,000 --> 00:16:01,140
third one the spam campaign here's what

357
00:16:01,140 --> 00:16:04,950
we can fix to what we would see so here

358
00:16:04,950 --> 00:16:07,440
we can see that we've got various

359
00:16:07,440 --> 00:16:11,040
attributes and we use various attributes

360
00:16:11,040 --> 00:16:14,010
because for depending on the campaign

361
00:16:14,010 --> 00:16:16,740
the the attributes that will be similar

362
00:16:16,740 --> 00:16:18,960
inside the cluster will be different and

363
00:16:18,960 --> 00:16:21,480
so only a subset of that the the

364
00:16:21,480 --> 00:16:24,090
attributes need dissimilar to be so that

365
00:16:24,090 --> 00:16:27,600
emails can be clustered together in that

366
00:16:27,600 --> 00:16:31,500
case of that spam cluster the subject

367
00:16:31,500 --> 00:16:33,510
lines are different so you can see for

368
00:16:33,510 --> 00:16:36,840
example an example 100% safe to take

369
00:16:36,840 --> 00:16:39,600
with no side which is pretty different

370
00:16:39,600 --> 00:16:43,200
from a man must get a stiffy or to be

371
00:16:43,200 --> 00:16:45,300
like Aaron your loving device needs this

372
00:16:45,300 --> 00:16:49,290
total hardening so then they use pretty

373
00:16:49,290 --> 00:16:53,460
different vocabulary and also you can

374
00:16:53,460 --> 00:16:57,510
see that the sender is pretty varied

375
00:16:57,510 --> 00:17:02,280
also well whereas if you can see in the

376
00:17:02,280 --> 00:17:09,030
next view the sizes here in this disco

377
00:17:09,030 --> 00:17:11,069
ylim and the local part of the message

378
00:17:11,069 --> 00:17:16,890
IDs I've shown some similarity we also

379
00:17:16,890 --> 00:17:18,630
look at the attachments in the last

380
00:17:18,630 --> 00:17:22,470
column and in case of the email

381
00:17:22,470 --> 00:17:25,319
conversations that I jacking there were

382
00:17:25,319 --> 00:17:29,179
similar use in the attachment names

383
00:17:33,480 --> 00:17:35,100
it's really interesting to see the

384
00:17:35,100 --> 00:17:37,050
variation that we can find in these

385
00:17:37,050 --> 00:17:39,570
these particular emails that I'll refer

386
00:17:39,570 --> 00:17:41,130
to some blue pill that is never named

387
00:17:41,130 --> 00:17:44,250
and its effects and and so in some way

388
00:17:44,250 --> 00:17:47,160
it makes our job a little harder no pun

389
00:17:47,160 --> 00:17:47,700
intended

390
00:17:47,700 --> 00:17:50,580
but on the other side it really gives us

391
00:17:50,580 --> 00:17:52,560
the chuckle on the idea that we have to

392
00:17:52,560 --> 00:17:55,830
deal with such over-the-top strings on a

393
00:17:55,830 --> 00:18:02,310
daily basis thank you led and so I can

394
00:18:02,310 --> 00:18:04,440
also point out that we are able to

395
00:18:04,440 --> 00:18:06,930
achieve this basically just by looking

396
00:18:06,930 --> 00:18:09,810
at the metadata of the email and later

397
00:18:09,810 --> 00:18:13,770
on we plan to look also into the the

398
00:18:13,770 --> 00:18:16,500
text of the emails to improve our

399
00:18:16,500 --> 00:18:21,630
results so if we go fast if you look

400
00:18:21,630 --> 00:18:25,860
behind that interface what do we see we

401
00:18:25,860 --> 00:18:29,070
see this clustering pipeline and so

402
00:18:29,070 --> 00:18:31,770
discussion pipeline runs in cycle every

403
00:18:31,770 --> 00:18:34,140
two to three minutes and it takes us

404
00:18:34,140 --> 00:18:36,870
input the data from the last about 12

405
00:18:36,870 --> 00:18:40,350
minutes and it computes first a linear

406
00:18:40,350 --> 00:18:42,900
combinations of several stimuli scores

407
00:18:42,900 --> 00:18:44,850
based on the different attributes that

408
00:18:44,850 --> 00:18:49,350
you saw plus some others and it gives

409
00:18:49,350 --> 00:18:52,170
that as input to the DB scan clustering

410
00:18:52,170 --> 00:18:56,250
algorithm this customer gives gives us

411
00:18:56,250 --> 00:18:59,100
output a series of clusters we do some

412
00:18:59,100 --> 00:19:02,490
analysis of those clusters to derive for

413
00:19:02,490 --> 00:19:04,200
example the number of some networks the

414
00:19:04,200 --> 00:19:08,160
emails come from and lastly we align the

415
00:19:08,160 --> 00:19:11,640
recurrent clusters with previous results

416
00:19:11,640 --> 00:19:17,040
of our custom cycle to be able to follow

417
00:19:17,040 --> 00:19:19,580
over time the evolution of campaigns and

418
00:19:19,580 --> 00:19:24,810
then we output that to the interface so

419
00:19:24,810 --> 00:19:28,470
now we have this pipeline you can see at

420
00:19:28,470 --> 00:19:31,800
the core the pipeline there lies the DB

421
00:19:31,800 --> 00:19:34,050
scan clustering algorithm we didn't

422
00:19:34,050 --> 00:19:35,640
invent that of course but why do we

423
00:19:35,640 --> 00:19:38,300
choose it to put in our pipeline

424
00:19:38,300 --> 00:19:42,930
well this clustering algorithm has three

425
00:19:42,930 --> 00:19:44,580
properties are very important for email

426
00:19:44,580 --> 00:19:45,990
clustering

427
00:19:45,990 --> 00:19:49,200
now the first one is that I take a can

428
00:19:49,200 --> 00:19:51,510
take as input a pre-computed distance

429
00:19:51,510 --> 00:19:56,429
matrix and this this as matrix need that

430
00:19:56,429 --> 00:19:59,039
be a real distance it can be a pseudo

431
00:19:59,039 --> 00:20:01,980
distance and in our case we use that too

432
00:20:01,980 --> 00:20:05,130
to include our similarity score which

433
00:20:05,130 --> 00:20:06,690
gives a nice property that as I said

434
00:20:06,690 --> 00:20:10,500
earlier only a subset of the attributes

435
00:20:10,500 --> 00:20:14,159
that we look at need be similar for two

436
00:20:14,159 --> 00:20:18,419
emails to be clustered together and if

437
00:20:18,419 --> 00:20:20,159
we give that input to the algorithm

438
00:20:20,159 --> 00:20:24,450
let's see what happens so you can see

439
00:20:24,450 --> 00:20:27,809
that the algorithm is trying to see

440
00:20:27,809 --> 00:20:32,850
whether some point is as a dense enough

441
00:20:32,850 --> 00:20:35,250
neighborhood of points around it so that

442
00:20:35,250 --> 00:20:37,409
it's constant does it see that it is

443
00:20:37,409 --> 00:20:40,740
included in the cluster and that's a

444
00:20:40,740 --> 00:20:42,240
nice property of the algorithm that we

445
00:20:42,240 --> 00:20:45,899
want also the second one the that it has

446
00:20:45,899 --> 00:20:48,980
the concept of outliers so that emails

447
00:20:48,980 --> 00:20:51,600
not all emails are part of a campaign

448
00:20:51,600 --> 00:20:53,640
and here know how emails would be part

449
00:20:53,640 --> 00:20:59,279
of a cluster also if you look at the

450
00:20:59,279 --> 00:21:03,750
purple cluster here you can see that

451
00:21:03,750 --> 00:21:07,080
there's an email at the top and another

452
00:21:07,080 --> 00:21:09,210
one that I wanted resistant to the email

453
00:21:09,210 --> 00:21:11,190
at the bottom and they are not

454
00:21:11,190 --> 00:21:14,340
considered similar however the second

455
00:21:14,340 --> 00:21:16,950
one here for the bottom is considered

456
00:21:16,950 --> 00:21:20,370
similar to this one and likewise there

457
00:21:20,370 --> 00:21:23,250
is a chain of similarity from the bottom

458
00:21:23,250 --> 00:21:24,990
to the top of the cluster and that

459
00:21:24,990 --> 00:21:27,510
enables us to capture variability in

460
00:21:27,510 --> 00:21:35,309
spam campaigns that the that exists

461
00:21:35,309 --> 00:21:38,970
because for example this the subject

462
00:21:38,970 --> 00:21:41,220
line here might have some words in

463
00:21:41,220 --> 00:21:44,220
covering this subject line and the other

464
00:21:44,220 --> 00:21:46,200
subject line of the third one here may

465
00:21:46,200 --> 00:21:51,720
have other words in common so now we

466
00:21:51,720 --> 00:21:54,570
have this nice clustering pipeline now

467
00:21:54,570 --> 00:21:58,289
how do we make sure that it performs

468
00:21:58,289 --> 00:22:00,919
correctly

469
00:22:01,020 --> 00:22:04,330
here's how we evaluate objectively and

470
00:22:04,330 --> 00:22:07,710
optimize our clustering pipeline well

471
00:22:07,710 --> 00:22:12,130
first what we did was that we adjusted

472
00:22:12,130 --> 00:22:14,530
manually the parent is our of our

473
00:22:14,530 --> 00:22:18,549
pipeline by looking at the output and

474
00:22:18,549 --> 00:22:21,940
adding one attribute at a time and once

475
00:22:21,940 --> 00:22:23,740
we were satisfied with the old manually

476
00:22:23,740 --> 00:22:26,799
adjusted parameters we collected a

477
00:22:26,799 --> 00:22:30,039
metadata corpus we applied the manually

478
00:22:30,039 --> 00:22:31,990
adjusted clustering pipeline at Daniel

479
00:22:31,990 --> 00:22:35,590
corpus and we asked our experts like

480
00:22:35,590 --> 00:22:39,549
Olivier to correct those clustering

481
00:22:39,549 --> 00:22:41,890
results and so that we get a reference

482
00:22:41,890 --> 00:22:44,650
clustering and once we get that

483
00:22:44,650 --> 00:22:47,919
reference clustering we can compute a

484
00:22:47,919 --> 00:22:51,130
Rand score that gives us an idea of the

485
00:22:51,130 --> 00:22:53,140
performance of our of any clustering we

486
00:22:53,140 --> 00:22:55,600
want to do given that reference

487
00:22:55,600 --> 00:22:59,020
clustering and once we can do that we

488
00:22:59,020 --> 00:23:02,230
can use an optimization algorithm to

489
00:23:02,230 --> 00:23:04,210
optimize our pairs for the best Rhine

490
00:23:04,210 --> 00:23:06,490
score on the corrected clustering

491
00:23:06,490 --> 00:23:08,770
however for that we cannot use gradient

492
00:23:08,770 --> 00:23:11,919
descent because we cannot Ritu we cannot

493
00:23:11,919 --> 00:23:14,470
back propagate the gradient through the

494
00:23:14,470 --> 00:23:18,370
DB scan algorithm but we can use that

495
00:23:18,370 --> 00:23:20,710
genetic algorithm algorithm and that's

496
00:23:20,710 --> 00:23:26,110
what we did so now we've got discussed

497
00:23:26,110 --> 00:23:27,730
on a pipeline that works well we have an

498
00:23:27,730 --> 00:23:31,539
interface and we can optimize it do we

499
00:23:31,539 --> 00:23:35,830
stop there well no we have lots of ideas

500
00:23:35,830 --> 00:23:37,390
of what to do next

501
00:23:37,390 --> 00:23:40,049
first we want to improve campaign

502
00:23:40,049 --> 00:23:42,100
characterizations so how we analyze the

503
00:23:42,100 --> 00:23:44,320
clusters we want to improve we monitor

504
00:23:44,320 --> 00:23:47,110
campaigns over time I want to be able to

505
00:23:47,110 --> 00:23:48,850
block an entire campaign based on the

506
00:23:48,850 --> 00:23:51,010
result of clustering and we know to do

507
00:23:51,010 --> 00:23:53,559
that automatically and we also want to

508
00:23:53,559 --> 00:23:57,070
take those campaign characterizations

509
00:23:57,070 --> 00:23:59,950
and publish indicators of compromise so

510
00:23:59,950 --> 00:24:01,510
that other organizations can benefit

511
00:24:01,510 --> 00:24:06,909
from what we found and if you have any

512
00:24:06,909 --> 00:24:10,360
of ideas on the format or the content

513
00:24:10,360 --> 00:24:11,110
that

514
00:24:11,110 --> 00:24:13,680
those indicators compromise could take

515
00:24:13,680 --> 00:24:17,500
please come and see us unless you want

516
00:24:17,500 --> 00:24:24,760
to improve our own filtering to conclude

517
00:24:24,760 --> 00:24:28,180
we showed you how we're about to detect

518
00:24:28,180 --> 00:24:31,420
and blood this imitate carrying email

519
00:24:31,420 --> 00:24:33,630
conversation thread I jackin campaign

520
00:24:33,630 --> 00:24:36,970
using a clustering based detect campaign

521
00:24:36,970 --> 00:24:42,520
detection scheme but the truth is we

522
00:24:42,520 --> 00:24:45,310
were not really looking for in a motet

523
00:24:45,310 --> 00:24:47,710
or email conversation thread by dragging

524
00:24:47,710 --> 00:24:48,640
in the first place

525
00:24:48,640 --> 00:24:51,880
and that's the strength of a generic

526
00:24:51,880 --> 00:24:55,260
method like restoring it can detect very

527
00:24:55,260 --> 00:24:59,830
diverse emerging threats and those this

528
00:24:59,830 --> 00:25:01,840
information can later be passed down to

529
00:25:01,840 --> 00:25:04,600
more generic resources to more

530
00:25:04,600 --> 00:25:09,250
specialized resources sorry and also

531
00:25:09,250 --> 00:25:11,950
because it's generic it can be applied

532
00:25:11,950 --> 00:25:14,170
to many other kinds of data streams or

533
00:25:14,170 --> 00:25:16,510
in an email so we can think of nature's

534
00:25:16,510 --> 00:25:19,960
connection to a server or budget with

535
00:25:19,960 --> 00:25:22,150
comments for example and lastly it was

536
00:25:22,150 --> 00:25:24,130
really quickly implemented it took only

537
00:25:24,130 --> 00:25:27,640
a few months to get a prototype that was

538
00:25:27,640 --> 00:25:31,300
already useful in practice for our rules

539
00:25:31,300 --> 00:25:35,200
and dream team we want to take two

540
00:25:35,200 --> 00:25:37,180
people who helped us in advising the

541
00:25:37,180 --> 00:25:39,310
attach files so first our own Vlad

542
00:25:39,310 --> 00:25:41,710
tamati who's security analyst and

543
00:25:41,710 --> 00:25:44,470
secondly Lutz annoyed who's a threat

544
00:25:44,470 --> 00:25:47,530
researcher at sophist lab I invite you

545
00:25:47,530 --> 00:25:50,890
to to attend or talk tomorrow afternoon

546
00:25:50,890 --> 00:25:53,260
at 2:30 in the green room where we'll

547
00:25:53,260 --> 00:25:57,420
probably learn a lot more about Imhotep

548
00:25:58,470 --> 00:26:00,970
if you want to learn more here are some

549
00:26:00,970 --> 00:26:05,530
references and I wish to thank you and

550
00:26:05,530 --> 00:26:07,510
if you have any questions I'll be happy

551
00:26:07,510 --> 00:26:09,670
to answer energy too so thank you for

552
00:26:09,670 --> 00:26:10,660
the great job

553
00:26:10,660 --> 00:26:13,769
[Music]

