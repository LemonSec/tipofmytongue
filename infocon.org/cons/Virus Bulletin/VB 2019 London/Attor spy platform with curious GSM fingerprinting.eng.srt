1
00:00:00,000 --> 00:00:03,990
zuzana autumn soda please welcome her

2
00:00:03,990 --> 00:00:05,500
thank you everybody

3
00:00:05,500 --> 00:00:12,860
[Applause]

4
00:00:12,860 --> 00:00:14,700
okay hi everyone

5
00:00:14,700 --> 00:00:17,670
thanks for coming so I'm Susanna I work

6
00:00:17,670 --> 00:00:20,369
for yourself oh okay you already see the

7
00:00:20,369 --> 00:00:23,039
slides so I work in easy as a malware

8
00:00:23,039 --> 00:00:25,710
analyst and today I'd like to talk about

9
00:00:25,710 --> 00:00:28,050
an espionage platform that we discovered

10
00:00:28,050 --> 00:00:30,779
we named it at all but just before I

11
00:00:30,779 --> 00:00:33,899
start I want to ask you a question how

12
00:00:33,899 --> 00:00:36,420
many of you remember 80 comments please

13
00:00:36,420 --> 00:00:38,850
raise your hand okay some of you

14
00:00:38,850 --> 00:00:41,370
remember so for those of you who know

15
00:00:41,370 --> 00:00:42,930
you will know that these comments were

16
00:00:42,930 --> 00:00:45,840
created in the 80s and they were used

17
00:00:45,840 --> 00:00:48,480
subsequently and maybe you will not be

18
00:00:48,480 --> 00:00:50,640
so surprised to learn that I'm too young

19
00:00:50,640 --> 00:00:52,649
to remember these commands I wasn't even

20
00:00:52,649 --> 00:00:55,469
born in the 80s so when I first seen

21
00:00:55,469 --> 00:00:57,750
these strings in some malware sample I

22
00:00:57,750 --> 00:01:00,510
didn't really know what was going on it

23
00:01:00,510 --> 00:01:02,789
didn't really ring a bell but of course

24
00:01:02,789 --> 00:01:04,500
I have some older colleagues who did

25
00:01:04,500 --> 00:01:06,960
recognize these commands and even they

26
00:01:06,960 --> 00:01:08,760
were wondering what are these commands

27
00:01:08,760 --> 00:01:10,890
doing in some malware sample this is not

28
00:01:10,890 --> 00:01:12,780
something you are seeing every day right

29
00:01:12,780 --> 00:01:15,930
so we started to looking to look into it

30
00:01:15,930 --> 00:01:17,759
and we started to analyze this malware

31
00:01:17,759 --> 00:01:20,340
and then we realized that the fact that

32
00:01:20,340 --> 00:01:22,560
something is old doesn't necessarily

33
00:01:22,560 --> 00:01:25,140
mean it cannot be used today or in this

34
00:01:25,140 --> 00:01:28,530
case surprise misused so let's meet at

35
00:01:28,530 --> 00:01:32,790
or so just a start when we started

36
00:01:32,790 --> 00:01:35,159
looking into the after our malware we

37
00:01:35,159 --> 00:01:39,540
were able to trace it back to 2013 so it

38
00:01:39,540 --> 00:01:41,820
has been undercover for quite some time

39
00:01:41,820 --> 00:01:44,640
now we have analyzed several different

40
00:01:44,640 --> 00:01:46,740
versions but the most important one was

41
00:01:46,740 --> 00:01:50,759
released in 2018 when the developers of

42
00:01:50,759 --> 00:01:53,549
atour released some new improvements

43
00:01:53,549 --> 00:01:56,100
some more structured architecture and

44
00:01:56,100 --> 00:01:58,500
really just more professional code and

45
00:01:58,500 --> 00:02:00,899
this version is the fact that one that

46
00:02:00,899 --> 00:02:03,119
is still used nowadays we detected two

47
00:02:03,119 --> 00:02:05,880
last samples in July this year so this

48
00:02:05,880 --> 00:02:07,290
is the one we are going to talk about

49
00:02:07,290 --> 00:02:10,080
today because it called our attention

50
00:02:10,080 --> 00:02:13,410
with its functionality and complexity

51
00:02:13,410 --> 00:02:15,150
and this is what we are going to talk

52
00:02:15,150 --> 00:02:17,790
about so this dog will be first about

53
00:02:17,790 --> 00:02:20,550
the espionage campaign itself we are

54
00:02:20,550 --> 00:02:23,370
going to look into what a tor is spying

55
00:02:23,370 --> 00:02:26,340
on and who is spying on and then of

56
00:02:26,340 --> 00:02:28,440
course we'll talk about how its

57
00:02:28,440 --> 00:02:30,360
implemented because that's interesting

58
00:02:30,360 --> 00:02:34,020
about it and then we will talk about two

59
00:02:34,020 --> 00:02:36,180
notable features that gave a tour its

60
00:02:36,180 --> 00:02:38,790
name and that's the elaborate network

61
00:02:38,790 --> 00:02:42,000
communication using tor and then the AP

62
00:02:42,000 --> 00:02:45,600
commands used for GSM fingerprinting so

63
00:02:45,600 --> 00:02:47,940
let's start with the targets the first

64
00:02:47,940 --> 00:02:50,070
thing we knew about at all is that it's

65
00:02:50,070 --> 00:02:52,640
highly targeted we only had some

66
00:02:52,640 --> 00:02:54,980
twenty-something targets detected and

67
00:02:54,980 --> 00:02:57,570
among these targets there were some

68
00:02:57,570 --> 00:03:01,050
high-profile users in Eastern Europe of

69
00:03:01,050 --> 00:03:03,240
course this is only our telemetry we're

70
00:03:03,240 --> 00:03:05,220
likely only seeing some part of the

71
00:03:05,220 --> 00:03:08,430
picture so that's why we had to look

72
00:03:08,430 --> 00:03:10,980
further and we wanted to know more about

73
00:03:10,980 --> 00:03:13,650
other targets that we do not see so we

74
00:03:13,650 --> 00:03:15,900
analyze the code of this malware and we

75
00:03:15,900 --> 00:03:18,390
were actually able to learn something

76
00:03:18,390 --> 00:03:20,820
more about the intended targets of a

77
00:03:20,820 --> 00:03:21,330
Thor

78
00:03:21,330 --> 00:03:24,209
so I'm going to talk something about how

79
00:03:24,209 --> 00:03:26,610
the platform looks like so that you can

80
00:03:26,610 --> 00:03:29,810
understand how we were going with this

81
00:03:29,810 --> 00:03:32,910
discovery so first thing you need to

82
00:03:32,910 --> 00:03:35,910
know is that this platform consists of a

83
00:03:35,910 --> 00:03:38,670
dispatcher about 32 and 64-bit version

84
00:03:38,670 --> 00:03:41,130
and then it comes with the series of

85
00:03:41,130 --> 00:03:42,780
plugins with some additional

86
00:03:42,780 --> 00:03:45,690
functionality so how do this platform

87
00:03:45,690 --> 00:03:48,900
comes to life is that first dispatcher

88
00:03:48,900 --> 00:03:51,330
is injected into all running processes

89
00:03:51,330 --> 00:03:53,820
and subsequently it loads all the

90
00:03:53,820 --> 00:03:56,640
plugins into these processes and the

91
00:03:56,640 --> 00:03:58,830
thing about ether is that each of these

92
00:03:58,830 --> 00:04:01,260
individual plugins then decides in which

93
00:04:01,260 --> 00:04:04,200
of the processes it will be activated so

94
00:04:04,200 --> 00:04:06,090
for example the plugins that are

95
00:04:06,090 --> 00:04:08,160
responsible for network communication

96
00:04:08,160 --> 00:04:10,890
are only activated in applications that

97
00:04:10,890 --> 00:04:13,350
already communicate over the Internet

98
00:04:13,350 --> 00:04:15,570
this is a clear attempt to hide the

99
00:04:15,570 --> 00:04:17,579
malicious communication within a regular

100
00:04:17,579 --> 00:04:20,548
stream or network traffic so similarly

101
00:04:20,548 --> 00:04:23,160
for example the plug-in responsible for

102
00:04:23,160 --> 00:04:25,560
audio recording is activated in

103
00:04:25,560 --> 00:04:27,300
applications like Skype

104
00:04:27,300 --> 00:04:30,509
or some VoIP applications again these

105
00:04:30,509 --> 00:04:32,940
applications are likely already using

106
00:04:32,940 --> 00:04:35,250
the microphone so this is also saying

107
00:04:35,250 --> 00:04:37,889
for other and other plugins what we are

108
00:04:37,889 --> 00:04:40,169
concerned about here is the plugin that

109
00:04:40,169 --> 00:04:42,870
is responsible for taking screenshots of

110
00:04:42,870 --> 00:04:45,629
individual applications in which it is

111
00:04:45,629 --> 00:04:48,569
activated and then to be able to report

112
00:04:48,569 --> 00:04:51,300
on victims activities so this cling

113
00:04:51,300 --> 00:04:53,400
grabbing plugin is again

114
00:04:53,400 --> 00:04:55,080
not activated in all of the processes

115
00:04:55,080 --> 00:04:58,310
just some applications of interest and

116
00:04:58,310 --> 00:05:01,289
we are going to look further into it you

117
00:05:01,289 --> 00:05:03,449
just need to know that this plug-in

118
00:05:03,449 --> 00:05:06,000
contains a list of some strings which

119
00:05:06,000 --> 00:05:08,909
are then of being looked for in process

120
00:05:08,909 --> 00:05:11,069
names and windows titles and if these

121
00:05:11,069 --> 00:05:13,740
strings are found then this plugin is

122
00:05:13,740 --> 00:05:16,500
activated and is taking screenshots of

123
00:05:16,500 --> 00:05:18,900
these apps so first when you look at the

124
00:05:18,900 --> 00:05:21,750
list of these apps no surprise here what

125
00:05:21,750 --> 00:05:24,030
you'd expect some social networks email

126
00:05:24,030 --> 00:05:27,120
services and maybe some office apps but

127
00:05:27,120 --> 00:05:28,979
when you look further you can find

128
00:05:28,979 --> 00:05:31,409
strings like big lashing it through

129
00:05:31,409 --> 00:05:34,889
sheet or Yandex pasta and all these

130
00:05:34,889 --> 00:05:36,870
strings are actually associated with

131
00:05:36,870 --> 00:05:39,300
some applications that are used in

132
00:05:39,300 --> 00:05:41,699
Russia and they include the two most

133
00:05:41,699 --> 00:05:43,919
popular Russian social networks or a

134
00:05:43,919 --> 00:05:47,969
VoIP app that is provided by Russian

135
00:05:47,969 --> 00:05:52,349
telecom operator so our conclusion here

136
00:05:52,349 --> 00:05:55,020
is that after is specifically searching

137
00:05:55,020 --> 00:05:57,150
for users that are russian-speaking

138
00:05:57,150 --> 00:05:59,430
and this conclusion is further supported

139
00:05:59,430 --> 00:06:02,610
by our telemetry indeed most of the

140
00:06:02,610 --> 00:06:05,819
targets were located in Russia so

141
00:06:05,819 --> 00:06:08,219
further about the targets we are looking

142
00:06:08,219 --> 00:06:11,610
at the strings in the same plugin and we

143
00:06:11,610 --> 00:06:13,889
discovered it was interested in some

144
00:06:13,889 --> 00:06:15,900
other applications like digital

145
00:06:15,900 --> 00:06:18,900
signature creation applications or VPN

146
00:06:18,900 --> 00:06:22,229
application secure email or TrueCrypt so

147
00:06:22,229 --> 00:06:24,960
it seems like a tour is also concerned

148
00:06:24,960 --> 00:06:27,469
about privacy concerned users and

149
00:06:27,469 --> 00:06:29,699
actually when we looked further in the

150
00:06:29,699 --> 00:06:32,789
code we see some other traces of a tour

151
00:06:32,789 --> 00:06:34,500
being interested in through crypt

152
00:06:34,500 --> 00:06:36,300
so this is a part of the code where

153
00:06:36,300 --> 00:06:38,960
author is trying to detect a true crypt

154
00:06:38,960 --> 00:06:40,420
driver

155
00:06:40,420 --> 00:06:43,240
on the compromised computer and then

156
00:06:43,240 --> 00:06:45,700
some control send some control codes to

157
00:06:45,700 --> 00:06:47,740
the driver and when you look at these

158
00:06:47,740 --> 00:06:49,810
control codes these are not standard

159
00:06:49,810 --> 00:06:53,380
codes they are TrueCrypt specific so and

160
00:06:53,380 --> 00:06:56,020
these are used to recover the actual

161
00:06:56,020 --> 00:06:57,910
version of TrueCrypt installed on the

162
00:06:57,910 --> 00:07:00,970
computer and this case say two things

163
00:07:00,970 --> 00:07:03,820
first of all indeed it seems like a Thor

164
00:07:03,820 --> 00:07:06,250
is interested in privacy concerned users

165
00:07:06,250 --> 00:07:09,310
on the other hand we can see something

166
00:07:09,310 --> 00:07:11,380
about the skills of the authors of this

167
00:07:11,380 --> 00:07:15,040
malware because this is not a very usual

168
00:07:15,040 --> 00:07:18,250
technique it's actually pretty rare so

169
00:07:18,250 --> 00:07:23,250
as to recap we have seen the others is

170
00:07:23,250 --> 00:07:26,890
pretty highly targeted it has some

171
00:07:26,890 --> 00:07:29,440
targets in Eastern Europe which I which

172
00:07:29,440 --> 00:07:32,440
are high profile users also it targets

173
00:07:32,440 --> 00:07:34,930
individual russian-speaking privacy

174
00:07:34,930 --> 00:07:37,810
concerned users we are also seeing that

175
00:07:37,810 --> 00:07:40,390
a tour is using quite some interesting

176
00:07:40,390 --> 00:07:44,140
tricks to do this Spang and this is

177
00:07:44,140 --> 00:07:46,330
actually what the next part of the

178
00:07:46,330 --> 00:07:48,670
presentation will be about we are going

179
00:07:48,670 --> 00:07:51,130
to talk about how these platform is

180
00:07:51,130 --> 00:07:52,690
implemented how it works

181
00:07:52,690 --> 00:07:56,230
and what's interesting about it so as I

182
00:07:56,230 --> 00:07:58,840
already mentioned the core of the other

183
00:07:58,840 --> 00:08:01,630
platform is the dispatcher which is a

184
00:08:01,630 --> 00:08:05,650
DLL first loaded and then it works with

185
00:08:05,650 --> 00:08:07,810
the other plugins but there are also

186
00:08:07,810 --> 00:08:10,840
some other notable features and parts of

187
00:08:10,840 --> 00:08:12,820
the platform the inter process

188
00:08:12,820 --> 00:08:14,620
communication between all these

189
00:08:14,620 --> 00:08:17,740
components is done via some shared local

190
00:08:17,740 --> 00:08:19,780
folders meaning that some of the

191
00:08:19,780 --> 00:08:21,880
components write files to these folders

192
00:08:21,880 --> 00:08:24,010
other reads from them and this is how

193
00:08:24,010 --> 00:08:26,050
they can all communicate so these are

194
00:08:26,050 --> 00:08:27,910
the four folders that were used by the

195
00:08:27,910 --> 00:08:30,340
plugins and then now for the plugins

196
00:08:30,340 --> 00:08:33,610
there is a installer plugging that takes

197
00:08:33,610 --> 00:08:35,650
care of the persistence of the whole

198
00:08:35,650 --> 00:08:39,010
platform and there is a set of some say

199
00:08:39,010 --> 00:08:41,380
espionage plugins that collect sensitive

200
00:08:41,380 --> 00:08:43,360
information and store this information

201
00:08:43,360 --> 00:08:47,320
in the upload folder and now you could

202
00:08:47,320 --> 00:08:49,000
imagine that all these information

203
00:08:49,000 --> 00:08:51,250
should be ultimately exfiltrated to a

204
00:08:51,250 --> 00:08:53,060
remote server

205
00:08:53,060 --> 00:08:54,680
but none of these plugins actually

206
00:08:54,680 --> 00:08:56,420
communicate with this server directly

207
00:08:56,420 --> 00:08:57,980
they're all offline

208
00:08:57,980 --> 00:09:00,620
there is another infrastructure full for

209
00:09:00,620 --> 00:09:03,260
talking to the server as you can see

210
00:09:03,260 --> 00:09:06,230
it's a tourist service so it cannot be

211
00:09:06,230 --> 00:09:09,110
done directly so what happens here is

212
00:09:09,110 --> 00:09:12,260
that a file uploader plugin monitors the

213
00:09:12,260 --> 00:09:14,390
upload folder and if there's some new

214
00:09:14,390 --> 00:09:16,670
information some new data it then

215
00:09:16,670 --> 00:09:18,830
prepares the data for exfiltration and

216
00:09:18,830 --> 00:09:21,650
to be able to reach out to the remote

217
00:09:21,650 --> 00:09:25,280
server it uses two other plugins this is

218
00:09:25,280 --> 00:09:27,860
just simplified graphics but basically

219
00:09:27,860 --> 00:09:30,500
it uses a tour client to be able to

220
00:09:30,500 --> 00:09:33,050
resolve the onion domain and of course

221
00:09:33,050 --> 00:09:35,120
to choose the circuit and crypt the data

222
00:09:35,120 --> 00:09:37,940
and then relay the communication so this

223
00:09:37,940 --> 00:09:40,460
is one part of how a tower communicates

224
00:09:40,460 --> 00:09:42,770
with the C&C server but of course

225
00:09:42,770 --> 00:09:44,780
there's there is the other part of the

226
00:09:44,780 --> 00:09:47,330
communication where the server wants to

227
00:09:47,330 --> 00:09:49,160
reach back to the platform and to the

228
00:09:49,160 --> 00:09:51,650
compromised computer and maybe send some

229
00:09:51,650 --> 00:09:53,600
additional instructions or tools that

230
00:09:53,600 --> 00:09:56,240
are to be deployed on the machine so

231
00:09:56,240 --> 00:09:58,730
again it uses the same infrastructure

232
00:09:58,730 --> 00:10:01,730
with Thor but the data is a relay to it

233
00:10:01,730 --> 00:10:04,130
another plug-in which we called command

234
00:10:04,130 --> 00:10:07,630
dispatcher and then this plug-in can

235
00:10:07,630 --> 00:10:10,580
interpret the instructions and if there

236
00:10:10,580 --> 00:10:12,710
are any new files or updates and these

237
00:10:12,710 --> 00:10:15,170
files get stored in these shared folders

238
00:10:15,170 --> 00:10:17,840
and how it works then is that the

239
00:10:17,840 --> 00:10:19,850
dispatcher then can monitor these

240
00:10:19,850 --> 00:10:22,640
folders and if there is some new plugin

241
00:10:22,640 --> 00:10:24,710
then this plug-in will get loaded so

242
00:10:24,710 --> 00:10:27,560
that you can always have your malware

243
00:10:27,560 --> 00:10:30,260
platform up-to-date so this is how it

244
00:10:30,260 --> 00:10:32,240
works I would just like to point out

245
00:10:32,240 --> 00:10:34,520
that none of these plugins on the Left

246
00:10:34,520 --> 00:10:36,440
communicate with the internet directly

247
00:10:36,440 --> 00:10:38,840
they just use these shared folders so

248
00:10:38,840 --> 00:10:40,850
that they can communicate with the

249
00:10:40,850 --> 00:10:43,100
actual plugins that are responsible for

250
00:10:43,100 --> 00:10:45,980
the network communication so if we just

251
00:10:45,980 --> 00:10:48,950
concentrate on these plugins we can see

252
00:10:48,950 --> 00:10:50,830
the communication is split into four

253
00:10:50,830 --> 00:10:54,080
components each of them is implementing

254
00:10:54,080 --> 00:10:56,840
a different layer and these components

255
00:10:56,840 --> 00:10:58,360
communicate with each other these two

256
00:10:58,360 --> 00:11:01,400
create or local servers that the other

257
00:11:01,400 --> 00:11:06,740
components can then connect to and only

258
00:11:06,740 --> 00:11:08,480
some of them are communicating with the

259
00:11:08,480 --> 00:11:11,120
control server directly using FTP

260
00:11:11,120 --> 00:11:14,270
protocol in passive mode I already

261
00:11:14,270 --> 00:11:16,310
mentioned that these plugins are only

262
00:11:16,310 --> 00:11:18,830
activated in applications that already

263
00:11:18,830 --> 00:11:20,899
communicate with the internet which is

264
00:11:20,899 --> 00:11:22,730
one of the tricks that Atari uses

265
00:11:22,730 --> 00:11:25,250
another trick is of course that it uses

266
00:11:25,250 --> 00:11:28,279
audience service protocol for its CNC

267
00:11:28,279 --> 00:11:30,890
server aiming for anonymity and and

268
00:11:30,890 --> 00:11:33,980
traceability so this is how Network

269
00:11:33,980 --> 00:11:36,709
communication works in a tour now let's

270
00:11:36,709 --> 00:11:38,899
look closer at how the individual

271
00:11:38,899 --> 00:11:42,410
plugins are implemented so when you look

272
00:11:42,410 --> 00:11:45,620
at some of the plugins of a tour you can

273
00:11:45,620 --> 00:11:49,220
see that it's not so easy to analyze

274
00:11:49,220 --> 00:11:51,830
them without having some further context

275
00:11:51,830 --> 00:11:54,050
because there are a lot of calls to some

276
00:11:54,050 --> 00:11:56,240
mysterious function that you don't know

277
00:11:56,240 --> 00:11:59,300
anything about but if you have access to

278
00:11:59,300 --> 00:12:01,490
all the other components you can

279
00:12:01,490 --> 00:12:03,110
actually see that this function is

280
00:12:03,110 --> 00:12:05,149
implemented in the dispatcher so the

281
00:12:05,149 --> 00:12:08,180
main part of the platform and it serves

282
00:12:08,180 --> 00:12:11,029
like as a proxy for Windows API

283
00:12:11,029 --> 00:12:13,070
functions for cryptographic functions

284
00:12:13,070 --> 00:12:16,490
etc so instead of calling these

285
00:12:16,490 --> 00:12:19,399
functions directly the plugins will call

286
00:12:19,399 --> 00:12:22,600
the function of the dispatcher and then

287
00:12:22,600 --> 00:12:26,060
use some indices to tell the dispatcher

288
00:12:26,060 --> 00:12:28,880
which functions should be used and then

289
00:12:28,880 --> 00:12:30,740
the dispatcher can then translate the

290
00:12:30,740 --> 00:12:33,140
function to some meaningful code and

291
00:12:33,140 --> 00:12:35,450
only if you have access to all of these

292
00:12:35,450 --> 00:12:38,240
components you are able to tell what

293
00:12:38,240 --> 00:12:41,690
these plugins are actually doing so an

294
00:12:41,690 --> 00:12:44,029
important thing here is that remember

295
00:12:44,029 --> 00:12:46,310
that all these plugins are injected into

296
00:12:46,310 --> 00:12:48,380
the same process as the dispatcher

297
00:12:48,380 --> 00:12:50,570
itself which means that they share the

298
00:12:50,570 --> 00:12:52,640
same address space and that's why it's

299
00:12:52,640 --> 00:12:54,529
possible to call these functions like

300
00:12:54,529 --> 00:12:56,480
that to reference each other's functions

301
00:12:56,480 --> 00:12:58,940
and the reference to this function is

302
00:12:58,940 --> 00:13:01,579
passed to the plugins onload by the

303
00:13:01,579 --> 00:13:04,310
dispatcher and this is how it looks like

304
00:13:04,310 --> 00:13:07,279
when you look at the plugins it's also

305
00:13:07,279 --> 00:13:08,300
dll's

306
00:13:08,300 --> 00:13:10,850
nothing special at the first site they

307
00:13:10,850 --> 00:13:13,850
use these export names that are pretty

308
00:13:13,850 --> 00:13:16,100
common but when you look at this expert

309
00:13:16,100 --> 00:13:18,070
DLL getclass object

310
00:13:18,070 --> 00:13:20,620
the most important one so what it does

311
00:13:20,620 --> 00:13:23,920
here as I said this petrol pass is a

312
00:13:23,920 --> 00:13:26,830
pointer to the most important function

313
00:13:26,830 --> 00:13:29,530
and then the plug-in stores reference to

314
00:13:29,530 --> 00:13:32,890
this function in global variable and

315
00:13:32,890 --> 00:13:35,560
another thing which happens here is that

316
00:13:35,560 --> 00:13:38,980
the plug-in then returns it's bugging ID

317
00:13:38,980 --> 00:13:41,110
and the actual version back to the

318
00:13:41,110 --> 00:13:41,920
dispatcher

319
00:13:41,920 --> 00:13:44,290
so the dispatcher can keep track of all

320
00:13:44,290 --> 00:13:46,540
the plugins that are loaded and if there

321
00:13:46,540 --> 00:13:48,400
is some update it can decide whether

322
00:13:48,400 --> 00:13:51,040
this is a newer version or not so this

323
00:13:51,040 --> 00:13:52,540
is how it looks like all the plugins

324
00:13:52,540 --> 00:13:55,750
have this kind of exported function so

325
00:13:55,750 --> 00:13:57,880
it was the same for all the plugins that

326
00:13:57,880 --> 00:14:01,090
we analyzed and these are all the planes

327
00:14:01,090 --> 00:14:03,520
that we are able to collect to recover

328
00:14:03,520 --> 00:14:07,270
you can see all the IDS and versions and

329
00:14:07,270 --> 00:14:09,970
maybe an interesting thing here is that

330
00:14:09,970 --> 00:14:14,290
the IDS seem to be continuous and you

331
00:14:14,290 --> 00:14:16,180
can see that we probably don't have all

332
00:14:16,180 --> 00:14:19,060
the versions it's not surprising at all

333
00:14:19,060 --> 00:14:22,210
because these after campaign is highly

334
00:14:22,210 --> 00:14:25,240
targeted so probably the attackers use

335
00:14:25,240 --> 00:14:28,180
different sets of plugins per victim so

336
00:14:28,180 --> 00:14:30,550
we didn't see all the victims of course

337
00:14:30,550 --> 00:14:32,400
we don't have all the plugins and

338
00:14:32,400 --> 00:14:34,810
another thing is that it's pretty

339
00:14:34,810 --> 00:14:37,150
complicated to collect these plugins

340
00:14:37,150 --> 00:14:39,280
because they are DLLs but they are

341
00:14:39,280 --> 00:14:42,580
encrypted on disk isometrically and if

342
00:14:42,580 --> 00:14:44,260
you don't have access to the dispatcher

343
00:14:44,260 --> 00:14:47,200
which has the decryption key you can

344
00:14:47,200 --> 00:14:49,420
really recover the plugins so they are

345
00:14:49,420 --> 00:14:51,340
only fully recovered in memory if you

346
00:14:51,340 --> 00:14:53,830
also have the dispatcher so this is just

347
00:14:53,830 --> 00:14:56,650
another complication that the developers

348
00:14:56,650 --> 00:15:00,610
of after created for us so these are

349
00:15:00,610 --> 00:15:02,830
other plugins that we recovered and

350
00:15:02,830 --> 00:15:05,830
we're going to talk about the key logger

351
00:15:05,830 --> 00:15:08,020
and the screen grabber and plugins like

352
00:15:08,020 --> 00:15:10,690
that exciting you've seen quite a lot of

353
00:15:10,690 --> 00:15:13,600
these but let's just focus this one

354
00:15:13,600 --> 00:15:16,390
plug-in that we call device monitor for

355
00:15:16,390 --> 00:15:19,840
some reasons for example it has plug-in

356
00:15:19,840 --> 00:15:22,570
ID number one and this is a prominent

357
00:15:22,570 --> 00:15:26,020
spot right so maybe this is some plug-in

358
00:15:26,020 --> 00:15:29,740
of importance for the other form

359
00:15:29,740 --> 00:15:33,460
again it has a version number 14 which

360
00:15:33,460 --> 00:15:35,170
means that there were quite a few

361
00:15:35,170 --> 00:15:37,000
versions of this plugin

362
00:15:37,000 --> 00:15:38,980
it's the highest number that we have

363
00:15:38,980 --> 00:15:41,710
seen among all the versions so maybe it

364
00:15:41,710 --> 00:15:44,320
means that the developers behind a Thor

365
00:15:44,320 --> 00:15:46,990
boots some effort into developing this

366
00:15:46,990 --> 00:15:50,620
plugin so I not look closer and the most

367
00:15:50,620 --> 00:15:52,720
important reason why we are going to

368
00:15:52,720 --> 00:15:54,880
look into this device monitor plugin is

369
00:15:54,880 --> 00:15:57,670
that it's responsible for the most

370
00:15:57,670 --> 00:15:59,740
important functionality that we have

371
00:15:59,740 --> 00:16:03,010
seen in a tour the GSM fingerprinting

372
00:16:03,010 --> 00:16:07,150
so let's look closer you have already

373
00:16:07,150 --> 00:16:10,300
seen this flight these strings now let's

374
00:16:10,300 --> 00:16:13,030
put some meaning to these strings so as

375
00:16:13,030 --> 00:16:15,280
some of you know these correspond to

376
00:16:15,280 --> 00:16:17,680
commands from so-called haste command

377
00:16:17,680 --> 00:16:20,770
set or 80 comments and they were created

378
00:16:20,770 --> 00:16:24,580
in the 1980s to communicate with modems

379
00:16:24,580 --> 00:16:27,850
or some older phones and to be able to

380
00:16:27,850 --> 00:16:30,390
change connection settings or to dial-up

381
00:16:30,390 --> 00:16:33,400
but later there were other comments

382
00:16:33,400 --> 00:16:36,760
added the set was extended both by some

383
00:16:36,760 --> 00:16:38,290
proprietary commands and some

384
00:16:38,290 --> 00:16:41,290
standardized so there are quite a few 80

385
00:16:41,290 --> 00:16:43,840
commands now and what this actually

386
00:16:43,840 --> 00:16:45,580
means these are the commands that the

387
00:16:45,580 --> 00:16:48,940
actor was using so this command is used

388
00:16:48,940 --> 00:16:50,740
when you want to start a communication

389
00:16:50,740 --> 00:16:52,510
with a device that is connected to the

390
00:16:52,510 --> 00:16:55,660
computer ad for attention and if you

391
00:16:55,660 --> 00:16:57,760
want to use the extended commands as

392
00:16:57,760 --> 00:17:00,820
well then you use this command and the

393
00:17:00,820 --> 00:17:03,370
other commands are used for querying

394
00:17:03,370 --> 00:17:06,310
some data from the device such as the

395
00:17:06,310 --> 00:17:09,220
model number or the device manufacturer

396
00:17:09,220 --> 00:17:13,210
or the software version and then there

397
00:17:13,210 --> 00:17:15,760
are more important or more interesting

398
00:17:15,760 --> 00:17:18,190
commands for example this one which is

399
00:17:18,190 --> 00:17:20,980
requesting the IMEI number from the

400
00:17:20,980 --> 00:17:23,859
device this is a unique identifier of

401
00:17:23,859 --> 00:17:27,280
the device further it requests I am si

402
00:17:27,280 --> 00:17:30,010
number which can identify this device

403
00:17:30,010 --> 00:17:33,310
subscriber or it's the owner of the SIM

404
00:17:33,310 --> 00:17:35,400
card that is put into the device and

405
00:17:35,400 --> 00:17:38,160
also it's asking for the

406
00:17:38,160 --> 00:17:41,230
msisdn number this is a number which is

407
00:17:41,230 --> 00:17:42,760
responsible for mapping

408
00:17:42,760 --> 00:17:45,100
between the identity of the owner and

409
00:17:45,100 --> 00:17:47,830
detail a phone number so this is the

410
00:17:47,830 --> 00:17:50,190
kind of information that a tour is after

411
00:17:50,190 --> 00:17:53,920
let's just quickly recap what I saw does

412
00:17:53,920 --> 00:17:56,080
is that when it detects a device

413
00:17:56,080 --> 00:17:58,570
connected to the computer it starts

414
00:17:58,570 --> 00:18:01,540
sending 80 comments and then by these 80

415
00:18:01,540 --> 00:18:03,550
comments it is able to learn information

416
00:18:03,550 --> 00:18:06,730
about both the device and the subscriber

417
00:18:06,730 --> 00:18:09,340
of the device so the owner of the SIM

418
00:18:09,340 --> 00:18:12,520
card now you may have noticed that I

419
00:18:12,520 --> 00:18:14,800
mentioned the word device quite a few

420
00:18:14,800 --> 00:18:17,470
times but I never said mean when I say

421
00:18:17,470 --> 00:18:19,870
device and this is actually a question

422
00:18:19,870 --> 00:18:22,150
that we were asking what kind of device

423
00:18:22,150 --> 00:18:25,660
is at or looking for is it some old

424
00:18:25,660 --> 00:18:28,540
modems because first the IP commands

425
00:18:28,540 --> 00:18:31,180
were used for communication with modems

426
00:18:31,180 --> 00:18:34,300
so maybe this is the case or is it some

427
00:18:34,300 --> 00:18:37,600
older false these also have support for

428
00:18:37,600 --> 00:18:40,180
80 commands and SIM cards so maybe this

429
00:18:40,180 --> 00:18:43,050
is what authority but then we're

430
00:18:43,050 --> 00:18:45,790
thinking maybe it's also some more

431
00:18:45,790 --> 00:18:48,970
modern devices which also use SIM cards

432
00:18:48,970 --> 00:18:51,460
such as smart cameras smart worksheets

433
00:18:51,460 --> 00:18:54,820
or even modern smartphones so is it

434
00:18:54,820 --> 00:18:57,250
possible that 80 commands are still

435
00:18:57,250 --> 00:18:59,650
supported by these devices and is it

436
00:18:59,650 --> 00:19:01,390
possible that this is what a tour is

437
00:19:01,390 --> 00:19:05,680
after so we were looking and we found

438
00:19:05,680 --> 00:19:08,470
this paper which was published last year

439
00:19:08,470 --> 00:19:12,370
and give us some answer so actually the

440
00:19:12,370 --> 00:19:14,590
80 commands are still supported on

441
00:19:14,590 --> 00:19:17,380
modern smartphones there are thousands

442
00:19:17,380 --> 00:19:19,390
of these commands supported different

443
00:19:19,390 --> 00:19:21,940
for different manufacturers and firmware

444
00:19:21,940 --> 00:19:24,340
but more importantly and more

445
00:19:24,340 --> 00:19:26,980
disturbingly it still poses a security

446
00:19:26,980 --> 00:19:30,250
risk if you are connecting your device

447
00:19:30,250 --> 00:19:33,250
by an USB interface to the computer and

448
00:19:33,250 --> 00:19:35,620
then sending 80 comments you are able to

449
00:19:35,620 --> 00:19:38,590
change the device firmware inject touch

450
00:19:38,590 --> 00:19:42,550
events or quick query some interesting

451
00:19:42,550 --> 00:19:44,920
data from the device so actually this

452
00:19:44,920 --> 00:19:46,420
paper showed us that it's still possible

453
00:19:46,420 --> 00:19:49,090
to communicate with the modern

454
00:19:49,090 --> 00:19:52,210
smartphones just via the 80 commands so

455
00:19:52,210 --> 00:19:54,840
we were really interested in what

456
00:19:54,840 --> 00:19:57,810
this is what adores after so we look at

457
00:19:57,810 --> 00:20:01,890
the code and this is a code for checking

458
00:20:01,890 --> 00:20:04,770
whether a third be sending the eighty

459
00:20:04,770 --> 00:20:07,680
commands to the connected devices and we

460
00:20:07,680 --> 00:20:09,330
can see that it checks the friend the

461
00:20:09,330 --> 00:20:12,390
name of the device and it should have

462
00:20:12,390 --> 00:20:16,590
come substring in the name well if you

463
00:20:16,590 --> 00:20:18,990
connect a smartphone to your computer

464
00:20:18,990 --> 00:20:22,590
usually use a USB port and what you see

465
00:20:22,590 --> 00:20:24,660
in the name is some strings like USB

466
00:20:24,660 --> 00:20:27,380
vite or maybe the name of the smartphone

467
00:20:27,380 --> 00:20:30,060
so unless you are connecting your

468
00:20:30,060 --> 00:20:34,170
smartphone via some serial cable or some

469
00:20:34,170 --> 00:20:38,460
USB to comm adapter or some special set

470
00:20:38,460 --> 00:20:40,800
up probably this is not what usually

471
00:20:40,800 --> 00:20:44,460
happens so come is probably just after

472
00:20:44,460 --> 00:20:46,890
some device is connected to the serial

473
00:20:46,890 --> 00:20:50,160
port or virtual serial port so it seems

474
00:20:50,160 --> 00:20:52,770
like maybe this is not the main focus of

475
00:20:52,770 --> 00:20:55,980
the utters after authors maybe just in

476
00:20:55,980 --> 00:20:59,130
some special configurations so we had to

477
00:20:59,130 --> 00:21:02,550
think of some more explanations and we

478
00:21:02,550 --> 00:21:05,280
actually considered the totally opposite

479
00:21:05,280 --> 00:21:09,720
in explanation maybe this code is just

480
00:21:09,720 --> 00:21:12,120
some residual from some older versions

481
00:21:12,120 --> 00:21:14,760
we have seen that this platform has been

482
00:21:14,760 --> 00:21:19,170
around since 2013 maybe even older so

483
00:21:19,170 --> 00:21:21,510
maybe if you look at the code it only

484
00:21:21,510 --> 00:21:26,550
target the serial port and you can

485
00:21:26,550 --> 00:21:29,070
remember that the modems and some older

486
00:21:29,070 --> 00:21:32,220
phones support 80 commands so maybe it's

487
00:21:32,220 --> 00:21:35,700
just all that it's about but then when

488
00:21:35,700 --> 00:21:38,400
we look at our telemetry we learned that

489
00:21:38,400 --> 00:21:40,440
actually this plugin is still included

490
00:21:40,440 --> 00:21:42,750
in the newest version that was released

491
00:21:42,750 --> 00:21:46,860
in 2018 and we never seen an old version

492
00:21:46,860 --> 00:21:51,450
of this plug-in and also we have seen a

493
00:21:51,450 --> 00:21:53,910
64-bit version of this plugin detected

494
00:21:53,910 --> 00:21:57,090
in this year so to us it seems like the

495
00:21:57,090 --> 00:22:00,240
developers of out otter know what they

496
00:22:00,240 --> 00:22:02,370
are doing it doesn't seem like they are

497
00:22:02,370 --> 00:22:05,670
just releasing 64-bit versions of some

498
00:22:05,670 --> 00:22:07,000
old plugin

499
00:22:07,000 --> 00:22:09,309
so we had to look in some more

500
00:22:09,309 --> 00:22:12,610
explanations and another hypothesis is

501
00:22:12,610 --> 00:22:15,429
that there is actually a device that can

502
00:22:15,429 --> 00:22:18,190
be both connected to a serial port or a

503
00:22:18,190 --> 00:22:21,549
virtual serial port and can answer 280

504
00:22:21,549 --> 00:22:24,039
comments maybe it's some device that the

505
00:22:24,039 --> 00:22:27,130
victims organization or the victim

506
00:22:27,130 --> 00:22:29,890
itself is using maybe we don't know

507
00:22:29,890 --> 00:22:32,830
about this kind of devices but we can

508
00:22:32,830 --> 00:22:35,770
assume that the actors behind a tor

509
00:22:35,770 --> 00:22:38,020
could learn about these devices via some

510
00:22:38,020 --> 00:22:41,289
other techniques of reconnaissance we

511
00:22:41,289 --> 00:22:44,110
don't know but what we can tell is that

512
00:22:44,110 --> 00:22:46,210
if this is true then this is just the

513
00:22:46,210 --> 00:22:47,100
beginning

514
00:22:47,100 --> 00:22:50,320
because there are further 80 comments

515
00:22:50,320 --> 00:22:52,900
that we haven't seen used in a tour as

516
00:22:52,900 --> 00:22:55,090
you can remember the commands that were

517
00:22:55,090 --> 00:22:58,360
used or only used for queer acquiring

518
00:22:58,360 --> 00:23:01,260
some basic information such as device ID

519
00:23:01,260 --> 00:23:04,120
manufacturer subscriber ID and stuff

520
00:23:04,120 --> 00:23:06,600
like that so it seems like some

521
00:23:06,600 --> 00:23:08,590
fingerprinting of these connected

522
00:23:08,590 --> 00:23:11,169
devices but when you look at all the

523
00:23:11,169 --> 00:23:14,980
other commands that are supported in all

524
00:23:14,980 --> 00:23:17,440
the different devices there are

525
00:23:17,440 --> 00:23:20,260
thousands of under specific 80 comments

526
00:23:20,260 --> 00:23:24,669
and if the actors behind author learn

527
00:23:24,669 --> 00:23:27,070
about what kind of device is connected

528
00:23:27,070 --> 00:23:29,950
to the computer of the victim then they

529
00:23:29,950 --> 00:23:32,559
can create other customized plugins and

530
00:23:32,559 --> 00:23:34,120
push them back to the victims computer

531
00:23:34,120 --> 00:23:36,970
we have seen that there are mechanisms

532
00:23:36,970 --> 00:23:39,490
in place so that these plugins can be

533
00:23:39,490 --> 00:23:41,950
downloaded and used and this can be

534
00:23:41,950 --> 00:23:45,280
actually used as a base for further data

535
00:23:45,280 --> 00:23:48,669
theft so this was about the GSM

536
00:23:48,669 --> 00:23:51,299
fingerprinting now let's wrap it all up

537
00:23:51,299 --> 00:23:54,760
we were just talking about an espionage

538
00:23:54,760 --> 00:23:58,390
platform that we called a tour we have

539
00:23:58,390 --> 00:24:01,480
seen that this malware is targeting both

540
00:24:01,480 --> 00:24:03,880
high profile targets in Eastern Europe

541
00:24:03,880 --> 00:24:07,030
and privacy concerned individual

542
00:24:07,030 --> 00:24:10,390
russian-speaking users now we don't know

543
00:24:10,390 --> 00:24:13,059
who is behind at all but what we can say

544
00:24:13,059 --> 00:24:15,580
is that it was professionally written it

545
00:24:15,580 --> 00:24:19,110
had some unusual functionality and

546
00:24:19,110 --> 00:24:22,100
there must have been invested substance

547
00:24:22,100 --> 00:24:24,600
substantial resources into developing

548
00:24:24,600 --> 00:24:28,080
this kind of malware another thing as

549
00:24:28,080 --> 00:24:31,350
usual with a PT's we don't have all the

550
00:24:31,350 --> 00:24:33,210
pieces of the puzzle so we don't know

551
00:24:33,210 --> 00:24:35,669
everything but what we can tell from

552
00:24:35,669 --> 00:24:39,239
what we see is that at or malware is

553
00:24:39,239 --> 00:24:41,279
worth further tracking and it could be

554
00:24:41,279 --> 00:24:43,230
interesting to collect the other

555
00:24:43,230 --> 00:24:46,049
remaining planes and to see what else it

556
00:24:46,049 --> 00:24:50,340
has as its tricks so this was for my

557
00:24:50,340 --> 00:24:52,859
presentation today I would like to know

558
00:24:52,859 --> 00:24:55,169
that this was a last minute talk so if

559
00:24:55,169 --> 00:24:57,359
you're interested in more details there

560
00:24:57,359 --> 00:24:59,369
won't be a paper in the conference

561
00:24:59,369 --> 00:25:01,859
proceedings but we are going to publish

562
00:25:01,859 --> 00:25:04,470
a comprehensive white paper with more

563
00:25:04,470 --> 00:25:07,889
details so stay tuned and that's it

564
00:25:07,889 --> 00:25:10,200
thanks for your attention there are any

565
00:25:10,200 --> 00:25:13,520
questions I will be happy to answer them

566
00:25:13,520 --> 00:25:18,829
[Applause]

