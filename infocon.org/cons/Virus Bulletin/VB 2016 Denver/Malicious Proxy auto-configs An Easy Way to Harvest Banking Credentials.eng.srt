1
00:00:00,030 --> 00:00:02,280
well good morning everyone welcome back

2
00:00:02,280 --> 00:00:03,990
to the second day of fibers bulletin

3
00:00:03,990 --> 00:00:06,120
welcome in the Red Room where we

4
00:00:06,120 --> 00:00:07,589
actually are starting our last minute

5
00:00:07,589 --> 00:00:10,769
presentation series I know that like me

6
00:00:10,769 --> 00:00:12,330
you all a cell phones can you please put

7
00:00:12,330 --> 00:00:14,009
them on like this silence so we are not

8
00:00:14,009 --> 00:00:15,990
interrupted thank you for that

9
00:00:15,990 --> 00:00:18,750
the first task minute presentation is by

10
00:00:18,750 --> 00:00:20,699
genre and young from a first about

11
00:00:20,699 --> 00:00:25,470
malicious proxy auto-config time good

12
00:00:25,470 --> 00:00:26,939
morning everybody I hope you feel there

13
00:00:26,939 --> 00:00:30,029
of texture day and the main topic in

14
00:00:30,029 --> 00:00:31,260
these days is without doubt the

15
00:00:31,260 --> 00:00:33,390
ransomware for example to Loki and this

16
00:00:33,390 --> 00:00:36,149
new warrior FICA Zepto Odin but we

17
00:00:36,149 --> 00:00:37,829
should not forget even on the other

18
00:00:37,829 --> 00:00:41,820
mugger and like mother like using the

19
00:00:41,820 --> 00:00:43,860
malicious Otto proxy conflicts etcetera

20
00:00:43,860 --> 00:00:46,050
just really easy way how to harvest

21
00:00:46,050 --> 00:00:48,180
banking credentials from the another

22
00:00:48,180 --> 00:00:52,710
users so today we like oh actually sorry

23
00:00:52,710 --> 00:00:56,510
the guys can you please stop the screen

24
00:00:56,510 --> 00:00:59,809
I'm sorry

25
00:01:05,710 --> 00:01:08,840
so today I would like to talk about

26
00:01:08,840 --> 00:01:12,500
proxy auto-config then because we choose

27
00:01:12,500 --> 00:01:14,900
the rectify banker which is all a clip

28
00:01:14,900 --> 00:01:17,750
in these days Newark so would like to

29
00:01:17,750 --> 00:01:18,890
tell us something about the history of

30
00:01:18,890 --> 00:01:21,229
ratify banker and we'll compare with the

31
00:01:21,229 --> 00:01:24,530
new version which appears this year and

32
00:01:24,530 --> 00:01:26,300
my colleague Jeremy will tell you

33
00:01:26,300 --> 00:01:27,530
something about the infection vector

34
00:01:27,530 --> 00:01:30,470
ratify and about the installation of the

35
00:01:30,470 --> 00:01:34,160
marver and we show you two examples of

36
00:01:34,160 --> 00:01:35,810
the fake Bank from the new countries

37
00:01:35,810 --> 00:01:38,270
affected by this malware and for the

38
00:01:38,270 --> 00:01:40,040
return for resetting study statistics

39
00:01:40,040 --> 00:01:43,580
and their questions so I thought proxy

40
00:01:43,580 --> 00:01:45,050
auto-config the proxy auto-config

41
00:01:45,050 --> 00:01:47,030
defines how web browser automatically

42
00:01:47,030 --> 00:01:51,220
choose the proxy to fetch a given URL

43
00:01:51,220 --> 00:01:53,899
okay it is really useless things have

44
00:01:53,899 --> 00:01:55,910
server paraffin functions which can be

45
00:01:55,910 --> 00:02:00,440
very useful when you working with that

46
00:02:00,440 --> 00:02:03,170
but I'm sure it can be easily misused by

47
00:02:03,170 --> 00:02:05,540
the malware authors it must contain

48
00:02:05,540 --> 00:02:08,179
JavaScript function find proxy for URL

49
00:02:08,179 --> 00:02:10,940
with two parameters URL host which

50
00:02:10,940 --> 00:02:13,460
returns three is keratin three different

51
00:02:13,460 --> 00:02:16,010
values the direct that the connection

52
00:02:16,010 --> 00:02:17,690
should be made directly without any

53
00:02:17,690 --> 00:02:20,690
proxies in the proxy which must contain

54
00:02:20,690 --> 00:02:23,420
host and port we specifies which proxy

55
00:02:23,420 --> 00:02:25,730
should be used or the stock book which

56
00:02:25,730 --> 00:02:28,280
also have two similar values the host

57
00:02:28,280 --> 00:02:29,900
and port and we specify which soap

58
00:02:29,900 --> 00:02:33,590
server will be used to fetch the given

59
00:02:33,590 --> 00:02:37,459
URL proxy auto-config can be set up

60
00:02:37,459 --> 00:02:41,500
manually in each browser or it can be

61
00:02:41,500 --> 00:02:44,230
set up automatically from the peripheral

62
00:02:44,230 --> 00:02:48,050
addresses so you can see that there is

63
00:02:48,050 --> 00:02:50,390
the proxy conflict for Internet Explorer

64
00:02:50,390 --> 00:02:53,390
Chrome cetera so let's start with the

65
00:02:53,390 --> 00:02:55,430
history of a rectifier banker in the

66
00:02:55,430 --> 00:02:57,230
past it used to be the oily file and

67
00:02:57,230 --> 00:02:59,830
embedding executable file rar SFX

68
00:02:59,830 --> 00:03:03,440
malicious CPA etc and the reported

69
00:03:03,440 --> 00:03:04,880
countries targeted by smuggler or

70
00:03:04,880 --> 00:03:08,900
Switzerland Austria Sweden and Japan the

71
00:03:08,900 --> 00:03:11,090
first mention about rectifier was in

72
00:03:11,090 --> 00:03:13,120
February 2014 on the Microsoft block

73
00:03:13,120 --> 00:03:15,840
then the first white paper was published

74
00:03:15,840 --> 00:03:19,200
on the plant microblog and the first

75
00:03:19,200 --> 00:03:21,480
talk about rectifier called the circle

76
00:03:21,480 --> 00:03:22,290
around rectifiable

77
00:03:22,290 --> 00:03:24,420
was published by the Peter Cruz on the

78
00:03:24,420 --> 00:03:28,110
Caravaggio in 2015 when we compare it

79
00:03:28,110 --> 00:03:31,019
with nowadays it's still too early but

80
00:03:31,019 --> 00:03:33,840
embedding JavaScript and it's looks

81
00:03:33,840 --> 00:03:36,750
PowerShell scripts to install fake

82
00:03:36,750 --> 00:03:40,410
certificate and the ball the JavaScript

83
00:03:40,410 --> 00:03:42,750
and the proxy auto-config is very

84
00:03:42,750 --> 00:03:46,110
simplification but there's some changes

85
00:03:46,110 --> 00:03:47,580
it might install additional tools like

86
00:03:47,580 --> 00:03:50,880
the poor proxy file etc and also the

87
00:03:50,880 --> 00:03:53,370
persistence may be added which are the

88
00:03:53,370 --> 00:03:55,079
biggest changes from the older version

89
00:03:55,079 --> 00:03:59,670
to the retina so from nowadays the first

90
00:03:59,670 --> 00:04:00,780
mention about the new version of

91
00:04:00,780 --> 00:04:04,620
ratified was in April 2016 she referred

92
00:04:04,620 --> 00:04:06,120
to her interesting blog post about it

93
00:04:06,120 --> 00:04:09,060
and since the June 2016 dirt the first

94
00:04:09,060 --> 00:04:10,680
our target in the united kingdom banks

95
00:04:10,680 --> 00:04:14,400
on laws also sorry and it was described

96
00:04:14,400 --> 00:04:15,959
in our blog post in the june and july

97
00:04:15,959 --> 00:04:20,579
2016 and now Michael Akira meal will

98
00:04:20,579 --> 00:04:21,600
tell you something about infection

99
00:04:21,600 --> 00:04:23,850
vector I will go through the technical

100
00:04:23,850 --> 00:04:28,289
details of it okay thank you so now

101
00:04:28,289 --> 00:04:30,780
let's look at the infection vector so

102
00:04:30,780 --> 00:04:33,900
basically ratify is distributed via spam

103
00:04:33,900 --> 00:04:36,450
emails so the victims usually get email

104
00:04:36,450 --> 00:04:38,010
and there is the attachment with

105
00:04:38,010 --> 00:04:40,139
document and when we open the document

106
00:04:40,139 --> 00:04:43,590
you can see that there is that there is

107
00:04:43,590 --> 00:04:46,650
a small picture and others picture there

108
00:04:46,650 --> 00:04:48,510
is the written message double click on

109
00:04:48,510 --> 00:04:50,639
this picture to see it bigger to see it

110
00:04:50,639 --> 00:04:53,099
more clear so you can see the screenshot

111
00:04:53,099 --> 00:04:56,669
on the right side of of this page so

112
00:04:56,669 --> 00:04:59,160
when user clicks on double clicks on

113
00:04:59,160 --> 00:05:00,570
this picture

114
00:05:00,570 --> 00:05:03,389
it tells into six unsecured 'ti warning

115
00:05:03,389 --> 00:05:05,970
that he tries to open the the ODA

116
00:05:05,970 --> 00:05:09,120
package content and it might be it might

117
00:05:09,120 --> 00:05:11,910
not be safe but still if the user double

118
00:05:11,910 --> 00:05:15,150
clicks on clicks on the ok' button the

119
00:05:15,150 --> 00:05:18,330
infection starts there's like one thing

120
00:05:18,330 --> 00:05:20,880
like it doesn't use any exploit gates

121
00:05:20,880 --> 00:05:24,630
and nowadays we see a lot of documents

122
00:05:24,630 --> 00:05:28,469
we choose macros and are usually like

123
00:05:28,469 --> 00:05:29,310
some

124
00:05:29,310 --> 00:05:32,700
no like open open the document enable

125
00:05:32,700 --> 00:05:34,980
macros enable content this is not the

126
00:05:34,980 --> 00:05:37,340
case there are no macros just embedded

127
00:05:37,340 --> 00:05:42,990
JavaScript JavaScript file the document

128
00:05:42,990 --> 00:05:45,450
is document X which is basically zip

129
00:05:45,450 --> 00:05:47,760
file and if you look inside of the zip

130
00:05:47,760 --> 00:05:51,120
file there are like many other files now

131
00:05:51,120 --> 00:05:53,130
use some XML files which we are not

132
00:05:53,130 --> 00:05:54,960
interested now we are the most

133
00:05:54,960 --> 00:05:57,660
interested in one file usually called

134
00:05:57,660 --> 00:06:00,270
like our object bin which is like binary

135
00:06:00,270 --> 00:06:04,320
package and this package contains the

136
00:06:04,320 --> 00:06:07,350
JavaScript file itself we have see very

137
00:06:07,350 --> 00:06:08,700
many different campaigns they are

138
00:06:08,700 --> 00:06:10,650
usually targeting german-speaking

139
00:06:10,650 --> 00:06:13,710
countries and the name of the file in

140
00:06:13,710 --> 00:06:15,240
this package usually contains some

141
00:06:15,240 --> 00:06:17,460
German names like rec noon vegetal psalm

142
00:06:17,460 --> 00:06:19,560
quitting the health bucket they are

143
00:06:19,560 --> 00:06:22,110
usually in translation to English it's

144
00:06:22,110 --> 00:06:25,110
like invoice order package and something

145
00:06:25,110 --> 00:06:28,680
like that so now if you want to look

146
00:06:28,680 --> 00:06:30,990
inside the document inside the

147
00:06:30,990 --> 00:06:33,900
JavaScript file what we can see so there

148
00:06:33,900 --> 00:06:36,570
is usually some some kind of text or

149
00:06:36,570 --> 00:06:37,650
some kind of document which is

150
00:06:37,650 --> 00:06:39,960
obfuscated in the screenshot which I am

151
00:06:39,960 --> 00:06:43,530
showing is the obfuscated by online tool

152
00:06:43,530 --> 00:06:45,750
called hasta coffee skater but of course

153
00:06:45,750 --> 00:06:47,400
you can see different obfuscator

154
00:06:47,400 --> 00:06:49,890
the Association is very simple so there

155
00:06:49,890 --> 00:06:52,050
are no other tricks so if you wanna

156
00:06:52,050 --> 00:06:54,570
unpack it they are skated manually you

157
00:06:54,570 --> 00:06:56,940
can replace evolve by document right and

158
00:06:56,940 --> 00:07:00,990
you get lead alpha skated content from

159
00:07:00,990 --> 00:07:03,390
the obfuscated content we can quickly

160
00:07:03,390 --> 00:07:05,460
notice that there is like one kind of

161
00:07:05,460 --> 00:07:08,310
class or variable core config and it has

162
00:07:08,310 --> 00:07:13,200
some other variables or values and from

163
00:07:13,200 --> 00:07:15,930
the meaning of the values we can very

164
00:07:15,930 --> 00:07:18,840
easily identify what it is about so the

165
00:07:18,840 --> 00:07:21,210
first one is DL there are some onion

166
00:07:21,210 --> 00:07:24,060
domain so these are CNC servers from way

167
00:07:24,060 --> 00:07:25,770
to the mother downloads the latest

168
00:07:25,770 --> 00:07:29,370
configuration there is one value called

169
00:07:29,370 --> 00:07:32,520
third which is the certificate which it

170
00:07:32,520 --> 00:07:36,870
later uses for signing the sake Bank

171
00:07:36,870 --> 00:07:40,020
website and they're also tours in some

172
00:07:40,020 --> 00:07:42,050
versions of three files in this

173
00:07:42,050 --> 00:07:45,080
screen shot it showed its named like PS

174
00:07:45,080 --> 00:07:47,210
or PS f there are some partial files

175
00:07:47,210 --> 00:07:49,310
which has some additional functionality

176
00:07:49,310 --> 00:07:53,780
which I will describe later for the core

177
00:07:53,780 --> 00:07:56,530
function of this javascript file

178
00:07:56,530 --> 00:07:59,629
basically the malware targets the three

179
00:07:59,629 --> 00:08:02,750
main web browsers which are Internet

180
00:08:02,750 --> 00:08:05,870
Explorer Chrome and Firefox and for each

181
00:08:05,870 --> 00:08:08,930
of them it calls the two functions like

182
00:08:08,930 --> 00:08:11,330
install certificate and installed proxy

183
00:08:11,330 --> 00:08:14,479
auto-config it also to refresh the

184
00:08:14,479 --> 00:08:16,849
configuration it needs to kill the

185
00:08:16,849 --> 00:08:19,370
current open browsers so there is some

186
00:08:19,370 --> 00:08:21,620
function called close all browsers which

187
00:08:21,620 --> 00:08:24,229
kills all the open browsers diet a skill

188
00:08:24,229 --> 00:08:31,819
and so on so for case in case of Firefox

189
00:08:31,819 --> 00:08:34,880
in Firefox the configuration is stored

190
00:08:34,880 --> 00:08:38,690
in press dot JS file which is saved on

191
00:08:38,690 --> 00:08:41,599
the disk somewhere on profiles directory

192
00:08:41,599 --> 00:08:45,140
in Mozilla directory somewhere in users

193
00:08:45,140 --> 00:08:47,839
profile and it needs to change some

194
00:08:47,839 --> 00:08:51,350
configuration because in Firefox it can

195
00:08:51,350 --> 00:08:54,140
have its own default Network proxy

196
00:08:54,140 --> 00:08:58,180
settings and if these settings are set

197
00:08:58,180 --> 00:09:00,709
basically mother needs to DVD settings

198
00:09:00,709 --> 00:09:02,750
and after that the Firefox will use

199
00:09:02,750 --> 00:09:05,690
default windows proxy settings so it

200
00:09:05,690 --> 00:09:07,670
goes through the presence of J s it

201
00:09:07,670 --> 00:09:10,790
deletes all the all the lines or all all

202
00:09:10,790 --> 00:09:13,279
those values which contains Network the

203
00:09:13,279 --> 00:09:16,010
proxy and also there is the value called

204
00:09:16,010 --> 00:09:18,410
blog dot on the end so to be able to

205
00:09:18,410 --> 00:09:21,860
access dot only on donate domain this

206
00:09:21,860 --> 00:09:25,810
this item needs to be deleted if present

207
00:09:25,810 --> 00:09:27,970
for installation of this certificate

208
00:09:27,970 --> 00:09:30,980
they use 30 tail utility with some

209
00:09:30,980 --> 00:09:34,399
parameters like ed store - f - user and

210
00:09:34,399 --> 00:09:34,880
so on

211
00:09:34,880 --> 00:09:40,339
and when you use this this tool and try

212
00:09:40,339 --> 00:09:42,320
to install new certificate it usually

213
00:09:42,320 --> 00:09:44,320
displays this kind of security warning

214
00:09:44,320 --> 00:09:47,329
studying that installing some new in

215
00:09:47,329 --> 00:09:49,130
this case certificate authority and if

216
00:09:49,130 --> 00:09:50,440
you agree or not

217
00:09:50,440 --> 00:09:53,779
so this would happen this shows to the

218
00:09:53,779 --> 00:09:54,709
user

219
00:09:54,709 --> 00:09:57,499
this is shown to the user but only for a

220
00:09:57,499 --> 00:10:00,920
short while time because like one of the

221
00:10:00,920 --> 00:10:03,680
Paris PowerShell scripts which I

222
00:10:03,680 --> 00:10:07,249
mentioned contains some functions and if

223
00:10:07,249 --> 00:10:09,290
I want to describe these functions you

224
00:10:09,290 --> 00:10:11,839
can see in this slide so first it

225
00:10:11,839 --> 00:10:13,850
enumerates all the processes which are

226
00:10:13,850 --> 00:10:17,689
currently running on the computer and it

227
00:10:17,689 --> 00:10:20,329
finds or it if it founds the process

228
00:10:20,329 --> 00:10:23,540
either CS RSS or cert you tale then we

229
00:10:23,540 --> 00:10:26,119
go to goes further and enumerate all the

230
00:10:26,119 --> 00:10:28,639
windows which are associated to these

231
00:10:28,639 --> 00:10:30,410
processes and there is a curve

232
00:10:30,410 --> 00:10:33,529
comparison if the malware wants to see

233
00:10:33,529 --> 00:10:36,470
was to identify the currently displayed

234
00:10:36,470 --> 00:10:39,589
I out box it has some predefined class

235
00:10:39,589 --> 00:10:42,529
value so it compares this value in this

236
00:10:42,529 --> 00:10:44,899
particular case according to an SDN

237
00:10:44,899 --> 00:10:47,360
documentation it's three two seven zero

238
00:10:47,360 --> 00:10:50,119
which is class for the dialog box dialog

239
00:10:50,119 --> 00:10:53,269
box and if this one is found then it

240
00:10:53,269 --> 00:10:55,519
uses the handle of this dialogue box

241
00:10:55,519 --> 00:10:58,730
window as one parameter to send message

242
00:10:58,730 --> 00:11:02,829
and send message command use this

243
00:11:02,829 --> 00:11:05,449
another parameter bien click which

244
00:11:05,449 --> 00:11:07,399
basically simulates the clicking of user

245
00:11:07,399 --> 00:11:10,189
to do yes button so if you are on the

246
00:11:10,189 --> 00:11:12,709
infected machine if you study infection

247
00:11:12,709 --> 00:11:17,660
it very shortly this appears and after a

248
00:11:17,660 --> 00:11:20,449
short while the dialog box disappears

249
00:11:20,449 --> 00:11:23,769
and basically certificate gets installed

250
00:11:23,769 --> 00:11:27,050
if we if now you wanna see all the

251
00:11:27,050 --> 00:11:28,850
installed certificates from for example

252
00:11:28,850 --> 00:11:30,920
chrome web browser we can open these

253
00:11:30,920 --> 00:11:34,279
settings and see the trusted root

254
00:11:34,279 --> 00:11:37,249
certificate authorities so these in the

255
00:11:37,249 --> 00:11:39,949
in the red mark there is like some one

256
00:11:39,949 --> 00:11:43,129
new extra certificate which is like some

257
00:11:43,129 --> 00:11:46,249
Komodo certificate and the issuer value

258
00:11:46,249 --> 00:11:50,120
has me at my host of my domain so which

259
00:11:50,120 --> 00:11:52,699
is clearly something suspicious so this

260
00:11:52,699 --> 00:11:57,019
this new certificate is added those

261
00:11:57,019 --> 00:12:00,529
description of adding certificate to

262
00:12:00,529 --> 00:12:02,959
default Windows Store which is valid or

263
00:12:02,959 --> 00:12:06,520
which is used by Internet Explorer

264
00:12:06,520 --> 00:12:09,400
and chrome but for Firefox it's

265
00:12:09,400 --> 00:12:10,900
something different it works a little

266
00:12:10,900 --> 00:12:13,360
bit different because Firefox has its

267
00:12:13,360 --> 00:12:16,300
own certificate store so mother needs to

268
00:12:16,300 --> 00:12:19,630
use and other specific functions to

269
00:12:19,630 --> 00:12:22,000
include this malicious certificate into

270
00:12:22,000 --> 00:12:24,850
Firefox Earth store for days there is

271
00:12:24,850 --> 00:12:26,230
like in the beginning I managed that

272
00:12:26,230 --> 00:12:29,170
there are few PowerShell scripts and one

273
00:12:29,170 --> 00:12:32,290
of these grids it was called BSS like

274
00:12:32,290 --> 00:12:35,290
FES like Firefox and this one adds the

275
00:12:35,290 --> 00:12:38,320
certificate to Firefox it calls few

276
00:12:38,320 --> 00:12:41,410
functions from NSS 3 DLL library and

277
00:12:41,410 --> 00:12:45,400
there are 3 main functions all of them

278
00:12:45,400 --> 00:12:47,830
start with certain underscore prefix

279
00:12:47,830 --> 00:12:50,500
there is a function called search get

280
00:12:50,500 --> 00:12:53,290
default cert DB which which gets handle

281
00:12:53,290 --> 00:12:55,930
to this certificate database that

282
00:12:55,930 --> 00:12:58,120
function import certs imports this

283
00:12:58,120 --> 00:13:00,670
malicious certificate and then when this

284
00:13:00,670 --> 00:13:03,280
certificate is imported it needs to

285
00:13:03,280 --> 00:13:05,230
change some flag or some bit which is

286
00:13:05,230 --> 00:13:08,260
called third DB trusted CA so it said

287
00:13:08,260 --> 00:13:10,540
this bit import the certificate and

288
00:13:10,540 --> 00:13:12,430
marshal certificate is also included

289
00:13:12,430 --> 00:13:19,060
into the Firefox we when we are looking

290
00:13:19,060 --> 00:13:21,430
at this part of code I found it

291
00:13:21,430 --> 00:13:23,890
part of the code was probably inspired

292
00:13:23,890 --> 00:13:26,890
by some threat or in some forum in

293
00:13:26,890 --> 00:13:30,370
exploited in and one guy had in the same

294
00:13:30,370 --> 00:13:33,640
code written in C++ or something and he

295
00:13:33,640 --> 00:13:35,650
wanted to port it to other language and

296
00:13:35,650 --> 00:13:38,020
it looked very similar so it's possible

297
00:13:38,020 --> 00:13:40,750
that mother authors often share some

298
00:13:40,750 --> 00:13:43,710
parts of code so it might be inspired by

299
00:13:43,710 --> 00:13:47,110
by this thread or by people active for

300
00:13:47,110 --> 00:13:49,090
this forum but just speculation

301
00:13:49,090 --> 00:13:52,840
we cannot edit for sure for the proxy

302
00:13:52,840 --> 00:13:55,390
auto-config URL it's starting registry

303
00:13:55,390 --> 00:13:59,770
in value called Auto config URL which is

304
00:13:59,770 --> 00:14:04,270
like in underlined in this figure and if

305
00:14:04,270 --> 00:14:06,040
you look at it there like few like

306
00:14:06,040 --> 00:14:08,170
static static

307
00:14:08,170 --> 00:14:11,530
strings like that only NJ s IP equals

308
00:14:11,530 --> 00:14:14,170
something and the rest rest is random

309
00:14:14,170 --> 00:14:16,720
the domain before the tone in is random

310
00:14:16,720 --> 00:14:18,490
the name of the

311
00:14:18,490 --> 00:14:21,930
the scientists random and IP address is

312
00:14:21,930 --> 00:14:25,060
something specific is the current IP

313
00:14:25,060 --> 00:14:29,670
address of of the use of the victim

314
00:14:29,670 --> 00:14:32,140
it's also important like which IP

315
00:14:32,140 --> 00:14:34,510
address you enter because we were

316
00:14:34,510 --> 00:14:37,810
researching the threat targeting UK

317
00:14:37,810 --> 00:14:40,540
customers UK bank customers and if you

318
00:14:40,540 --> 00:14:43,000
put there any different IP address from

319
00:14:43,000 --> 00:14:45,190
UK which it doesn't belong to UK IP

320
00:14:45,190 --> 00:14:48,160
range it displays some error like

321
00:14:48,160 --> 00:14:50,830
nothing found however if you try the

322
00:14:50,830 --> 00:14:53,500
correct IP address which we found

323
00:14:53,500 --> 00:14:56,020
basically you can enter something and if

324
00:14:56,020 --> 00:14:58,120
any IP address which belongs to UK IP

325
00:14:58,120 --> 00:14:58,600
range

326
00:14:58,600 --> 00:15:01,000
we got something which we can see in

327
00:15:01,000 --> 00:15:03,310
this in the figure below there is the

328
00:15:03,310 --> 00:15:05,140
configuration file it's very small one

329
00:15:05,140 --> 00:15:08,620
again obfuscated by something something

330
00:15:08,620 --> 00:15:11,530
like Dean Edward Spectre which is which

331
00:15:11,530 --> 00:15:14,470
is easily recognizable the file is small

332
00:15:14,470 --> 00:15:16,300
usually a few hundred bytes or a few

333
00:15:16,300 --> 00:15:19,840
hundred or few kilobytes maximum and

334
00:15:19,840 --> 00:15:21,880
after the obfuscation it looks like this

335
00:15:21,880 --> 00:15:24,100
there is I mentioned in the beginning

336
00:15:24,100 --> 00:15:28,990
sign proxy for URL function then there

337
00:15:28,990 --> 00:15:31,420
is proxy variable which tells what is

338
00:15:31,420 --> 00:15:32,890
the proxy server which should be used

339
00:15:32,890 --> 00:15:36,370
there is an array of bank websites which

340
00:15:36,370 --> 00:15:40,530
are targeted so if any of if address URL

341
00:15:40,530 --> 00:15:44,350
if URL is an address bar corresponds one

342
00:15:44,350 --> 00:15:48,670
of these host addresses then the proxy

343
00:15:48,670 --> 00:15:51,130
is used otherwise as you can see in the

344
00:15:51,130 --> 00:15:53,650
end there is return direct then nothing

345
00:15:53,650 --> 00:15:57,670
nothing is used we've seen like few

346
00:15:57,670 --> 00:15:59,290
different versions some of them are like

347
00:15:59,290 --> 00:16:02,680
simplify described but in one case or in

348
00:16:02,680 --> 00:16:05,740
few few cases we saw that the Reta set

349
00:16:05,740 --> 00:16:07,480
downloaded additional tools and

350
00:16:07,480 --> 00:16:10,150
additional programs like one of them

351
00:16:10,150 --> 00:16:13,330
will store another another one was

352
00:16:13,330 --> 00:16:15,700
proxifier one thing which we should

353
00:16:15,700 --> 00:16:17,920
mention about the tour if you download

354
00:16:17,920 --> 00:16:20,320
it and run it you can usually see like

355
00:16:20,320 --> 00:16:24,250
like a small like black window of

356
00:16:24,250 --> 00:16:27,730
command-line and in case of infection we

357
00:16:27,730 --> 00:16:29,740
couldn't see anything because it calls

358
00:16:29,740 --> 00:16:32,170
the show window function and

359
00:16:32,170 --> 00:16:35,890
put their parameter to hide it so so the

360
00:16:35,890 --> 00:16:38,020
tour was running in the background and

361
00:16:38,020 --> 00:16:40,390
nothing was visible to the victim when

362
00:16:40,390 --> 00:16:43,030
you are using tour and when you try to

363
00:16:43,030 --> 00:16:44,650
access the web

364
00:16:44,650 --> 00:16:47,170
you usually get some random IP address

365
00:16:47,170 --> 00:16:49,990
so at one time it can be in one country

366
00:16:49,990 --> 00:16:52,750
and after some time your IP address is

367
00:16:52,750 --> 00:16:54,670
changed to another country and so on it

368
00:16:54,670 --> 00:16:56,350
of course it depends on your settings

369
00:16:56,350 --> 00:17:00,760
but is the default one so they need to

370
00:17:00,760 --> 00:17:02,590
they also need to know I go to your

371
00:17:02,590 --> 00:17:04,839
current IP address so they use proxifier

372
00:17:04,839 --> 00:17:07,900
and is the screen shot in the right that

373
00:17:07,900 --> 00:17:10,630
there are like some targets and for few

374
00:17:10,630 --> 00:17:12,730
targets the action is like direct so

375
00:17:12,730 --> 00:17:14,709
basically the tour procs is not used and

376
00:17:14,709 --> 00:17:17,230
one of these IP addresses is called API

377
00:17:17,230 --> 00:17:19,810
dot IP Phi dot org which is the service

378
00:17:19,810 --> 00:17:22,060
which tells you your current IP address

379
00:17:22,060 --> 00:17:24,099
so they need to know if you are in UK

380
00:17:24,099 --> 00:17:26,500
they need to know that you have like UK

381
00:17:26,500 --> 00:17:28,960
IP address so they put a few exclusions

382
00:17:28,960 --> 00:17:31,210
to be proxifier and we think that is the

383
00:17:31,210 --> 00:17:35,680
reason why they use it also torrent

384
00:17:35,680 --> 00:17:39,240
iceberg on tour and proxifier could be

385
00:17:39,240 --> 00:17:43,140
disabled or found or deleted by users or

386
00:17:43,140 --> 00:17:46,870
alright or indeed this process could be

387
00:17:46,870 --> 00:17:50,440
ended by user and to avoid this they add

388
00:17:50,440 --> 00:17:52,570
some persistence and for persistence

389
00:17:52,570 --> 00:17:55,180
they went to one website code called

390
00:17:55,180 --> 00:17:55,990
codeplex

391
00:17:55,990 --> 00:17:58,630
and on this website they have the

392
00:17:58,630 --> 00:18:00,940
project called task scheduler manager

393
00:18:00,940 --> 00:18:04,960
which is project we had few DLL files

394
00:18:04,960 --> 00:18:07,540
and they are installed into the system

395
00:18:07,540 --> 00:18:11,470
it allows them in PowerShell to simply

396
00:18:11,470 --> 00:18:13,900
call function at task with two

397
00:18:13,900 --> 00:18:15,790
parameters the first parameter is name

398
00:18:15,790 --> 00:18:18,460
of the task and the second parameter is

399
00:18:18,460 --> 00:18:20,800
the path of the file which should be

400
00:18:20,800 --> 00:18:24,220
started so as you can see like in these

401
00:18:24,220 --> 00:18:27,040
screenshots the the bottom one is the

402
00:18:27,040 --> 00:18:29,470
adding the persistence then the name of

403
00:18:29,470 --> 00:18:31,960
the persistence or the name of the task

404
00:18:31,960 --> 00:18:34,570
is called like Google update task or

405
00:18:34,570 --> 00:18:38,470
Adobe Flash Player something you can

406
00:18:38,470 --> 00:18:40,330
notice like this the second line Adobe

407
00:18:40,330 --> 00:18:42,880
Flash's without the space which is in

408
00:18:42,880 --> 00:18:45,389
the regular one and in

409
00:18:45,389 --> 00:18:48,359
blue bracket there is the name of the

410
00:18:48,359 --> 00:18:50,399
file which has been executed like

411
00:18:50,399 --> 00:18:53,190
proxifier dxz and all this happens with

412
00:18:53,190 --> 00:18:57,029
period of 30 minutes so if any of these

413
00:18:57,029 --> 00:19:00,839
services is not running after after how

414
00:19:00,839 --> 00:19:05,149
it's half an hour its restarted again

415
00:19:05,239 --> 00:19:07,979
unfortunately but surprisingly the

416
00:19:07,979 --> 00:19:09,389
ratified banker doesn't use an

417
00:19:09,389 --> 00:19:11,639
additional key loggers etc so they are

418
00:19:11,639 --> 00:19:14,129
the only harvest the data from the fine

419
00:19:14,129 --> 00:19:17,039
fake Bank sides news early records

420
00:19:17,039 --> 00:19:18,959
credentials are the credit card number

421
00:19:18,959 --> 00:19:20,999
Social Security number a mobile phone

422
00:19:20,999 --> 00:19:23,009
number of say critical etc these are the

423
00:19:23,009 --> 00:19:25,979
data which are need to access to the to

424
00:19:25,979 --> 00:19:29,159
the bank side also they are using the

425
00:19:29,159 --> 00:19:30,869
fake certificate so it's really hard for

426
00:19:30,869 --> 00:19:32,669
the victims to recognize they fall into

427
00:19:32,669 --> 00:19:36,599
drop this banker because virtually

428
00:19:36,599 --> 00:19:37,769
sometimes you can see the banks using

429
00:19:37,769 --> 00:19:39,509
the certificate with extended validation

430
00:19:39,509 --> 00:19:42,119
like the Barclays Bank there is a small

431
00:19:42,119 --> 00:19:43,849
chance that the user can notice the

432
00:19:43,849 --> 00:19:46,169
external validation marker is missing

433
00:19:46,169 --> 00:19:49,769
but usually people do not pay an update

434
00:19:49,769 --> 00:19:53,190
and attention Vista also the outers of

435
00:19:53,190 --> 00:19:55,079
the rectifier using the really simple

436
00:19:55,079 --> 00:19:57,659
social engineering so they are using the

437
00:19:57,659 --> 00:20:00,209
counter to d'lai a user action so if

438
00:20:00,209 --> 00:20:02,399
your ratio of the 3-minute marker or

439
00:20:02,399 --> 00:20:06,299
counter to delight the all user section

440
00:20:06,299 --> 00:20:09,239
like to closing the website etc so they

441
00:20:09,239 --> 00:20:12,239
can use the harvested credentials to

442
00:20:12,239 --> 00:20:14,999
steal the money from the account are you

443
00:20:14,999 --> 00:20:17,459
looking to do some Bank sides for

444
00:20:17,459 --> 00:20:18,839
example this is the intelligent finance

445
00:20:18,839 --> 00:20:21,299
is the legitimate website this also

446
00:20:21,299 --> 00:20:23,639
already contains the warning about the

447
00:20:23,639 --> 00:20:25,999
new model targeting United Kingdom banks

448
00:20:25,999 --> 00:20:28,529
but only compared to the fake website

449
00:20:28,529 --> 00:20:31,619
it's very similar only the changes are

450
00:20:31,619 --> 00:20:34,169
there is no warning of course and when

451
00:20:34,169 --> 00:20:36,989
the user fill up all the data the

452
00:20:36,989 --> 00:20:40,649
counter appears so they have a time to

453
00:20:40,649 --> 00:20:44,129
steal your money extra and this counter

454
00:20:44,129 --> 00:20:47,159
stop and to reach one second and so it

455
00:20:47,159 --> 00:20:49,259
can be suspicious for the user so in the

456
00:20:49,259 --> 00:20:51,299
new version for example Santander bank

457
00:20:51,299 --> 00:20:54,119
they use something like simmer again the

458
00:20:54,119 --> 00:20:56,369
user input all the data there is the

459
00:20:56,369 --> 00:20:59,190
timer but when the counter ends

460
00:20:59,190 --> 00:21:00,900
the user is redirected to the error

461
00:21:00,900 --> 00:21:02,550
pages or something some maintenance or

462
00:21:02,550 --> 00:21:04,500
some error on the page so they should

463
00:21:04,500 --> 00:21:05,640
try to come back later

464
00:21:05,640 --> 00:21:08,610
I can sell ours we give the author's the

465
00:21:08,610 --> 00:21:11,010
additional time to work with your with

466
00:21:11,010 --> 00:21:15,060
the stolen bank account click on some

467
00:21:15,060 --> 00:21:17,340
more effective banks this for example

468
00:21:17,340 --> 00:21:19,560
this is the legitimate website again you

469
00:21:19,560 --> 00:21:21,210
can notice there are some small

470
00:21:21,210 --> 00:21:22,860
differences between the fake website and

471
00:21:22,860 --> 00:21:26,340
the original website but what's more

472
00:21:26,340 --> 00:21:27,720
interesting for us when we discovered

473
00:21:27,720 --> 00:21:29,730
there was also the Desco Bank affected

474
00:21:29,730 --> 00:21:33,000
when we open the debugger we notice

475
00:21:33,000 --> 00:21:36,170
there is a sign the certificate is valid

476
00:21:36,170 --> 00:21:38,820
but there are some debugging errors like

477
00:21:38,820 --> 00:21:44,550
the debug the parse the font or the HTTP

478
00:21:44,550 --> 00:21:47,910
request was invalid etc but sorry hard

479
00:21:47,910 --> 00:21:52,470
for the user or victims to recognize

480
00:21:52,470 --> 00:21:55,830
this marker only compare the certificate

481
00:21:55,830 --> 00:21:59,820
on the sorry on the left side on the

482
00:21:59,820 --> 00:22:01,760
left side there is a legitimize

483
00:22:01,760 --> 00:22:04,020
certificate of the Barclays Bank with

484
00:22:04,020 --> 00:22:05,970
the external validation marker on the

485
00:22:05,970 --> 00:22:09,060
right side there is the fake certificate

486
00:22:09,060 --> 00:22:11,340
signed by tomorrow or issued by

487
00:22:11,340 --> 00:22:13,290
co-signed by come on certificate

488
00:22:13,290 --> 00:22:16,560
authority well when I try to analyze

489
00:22:16,560 --> 00:22:18,810
this Marber we return unfortunately the

490
00:22:18,810 --> 00:22:21,480
same IP address like two days later and

491
00:22:21,480 --> 00:22:24,390
we recognize you already our iPad is

492
00:22:24,390 --> 00:22:26,670
already banned by the attackers so the

493
00:22:26,670 --> 00:22:28,110
European intention was happening there

494
00:22:28,110 --> 00:22:30,660
and when we joined the really tight

495
00:22:30,660 --> 00:22:33,990
connect to the website the proxy

496
00:22:33,990 --> 00:22:35,670
auto-config return are the direct value

497
00:22:35,670 --> 00:22:37,620
so we were sent to the legitimate

498
00:22:37,620 --> 00:22:40,820
website which returned as the for error

499
00:22:40,820 --> 00:22:43,290
error website which there's the

500
00:22:43,290 --> 00:22:46,950
technical problem etc so from the data

501
00:22:46,950 --> 00:22:50,790
in our user base we can recognize the UK

502
00:22:50,790 --> 00:22:53,790
users are like only 4% but it's still

503
00:22:53,790 --> 00:22:55,950
growing this number and still the most

504
00:22:55,950 --> 00:22:57,240
affected users are in the

505
00:22:57,240 --> 00:22:58,940
german-speaking countries like

506
00:22:58,940 --> 00:23:04,020
Switzerland Austria Deutschland so but

507
00:23:04,020 --> 00:23:06,900
still this is a warning for us that this

508
00:23:06,900 --> 00:23:09,330
model can spread up even to the

509
00:23:09,330 --> 00:23:11,160
different countries because we found

510
00:23:11,160 --> 00:23:13,200
some people from the France

511
00:23:13,200 --> 00:23:15,340
receive this email with the rest as a

512
00:23:15,340 --> 00:23:19,030
banker so we expecting there will be

513
00:23:19,030 --> 00:23:21,760
some evolution of the banker so we need

514
00:23:21,760 --> 00:23:25,330
to refocus on the smaller also let me

515
00:23:25,330 --> 00:23:26,950
check our data the numbers are not so

516
00:23:26,950 --> 00:23:29,770
big index like the hundreds or sometimes

517
00:23:29,770 --> 00:23:31,240
thousands of people affected by this

518
00:23:31,240 --> 00:23:33,310
marker and we can see there are the

519
00:23:33,310 --> 00:23:34,230
campaign's peak

520
00:23:34,230 --> 00:23:37,060
drinka days this is these are data from

521
00:23:37,060 --> 00:23:39,490
the last five months now you can see

522
00:23:39,490 --> 00:23:41,950
this already like ten thousands of

523
00:23:41,950 --> 00:23:43,750
people who receive the email will be

524
00:23:43,750 --> 00:23:48,370
directed by or the rectifier was run on

525
00:23:48,370 --> 00:23:52,600
their computer so the rest of a banker

526
00:23:52,600 --> 00:23:54,640
used to rely simple but still effective

527
00:23:54,640 --> 00:23:57,010
social engineering tactic used to trick

528
00:23:57,010 --> 00:24:00,700
banking customers they are not using the

529
00:24:00,700 --> 00:24:02,950
macro so there is no enable content or

530
00:24:02,950 --> 00:24:06,040
enable macros needed the in the new

531
00:24:06,040 --> 00:24:07,960
version there was a new target country

532
00:24:07,960 --> 00:24:10,810
the United Kingdom they completely move

533
00:24:10,810 --> 00:24:13,090
from the executable file to the scripts

534
00:24:13,090 --> 00:24:15,900
by the PowerShell scripts JavaScript and

535
00:24:15,900 --> 00:24:18,430
also the additional tools like the door

536
00:24:18,430 --> 00:24:21,370
Roxy fight straw or a date and also the

537
00:24:21,370 --> 00:24:23,140
persistence was added to this new

538
00:24:23,140 --> 00:24:26,500
versions and both proxy and config you

539
00:24:26,500 --> 00:24:28,930
are L right now are behind it all so it

540
00:24:28,930 --> 00:24:33,070
makes much harder to analyze so thank

541
00:24:33,070 --> 00:24:35,260
you very much for a time and if you some

542
00:24:35,260 --> 00:24:37,380
questions

543
00:24:37,380 --> 00:24:40,350
well thank you and anybody has questions

544
00:24:40,350 --> 00:24:43,980
for the speakers

545
00:24:46,410 --> 00:24:49,940
see that side of this

546
00:24:53,550 --> 00:24:55,740
now I couldn't see that side because of

547
00:24:55,740 --> 00:24:59,760
the desk one there is no longer okay so

548
00:24:59,760 --> 00:25:02,760
we can actually see that there's a lot

549
00:25:02,760 --> 00:25:04,370
of progress in the development of this

550
00:25:04,370 --> 00:25:07,410
can you elaborate a little bit on what

551
00:25:07,410 --> 00:25:10,020
banks could do to hard and their

552
00:25:10,020 --> 00:25:11,850
processes to that this would actually be

553
00:25:11,850 --> 00:25:16,230
much more difficult to be used by banks

554
00:25:16,230 --> 00:25:17,670
okay yeah thanks

555
00:25:17,670 --> 00:25:19,440
all right shape for banks very hard

556
00:25:19,440 --> 00:25:21,780
actually they can use the like oh sorry

557
00:25:21,780 --> 00:25:24,210
huh so the question was for banks yeah

558
00:25:24,210 --> 00:25:26,280
so the banks can start using the

559
00:25:26,280 --> 00:25:28,800
certificated external validation which

560
00:25:28,800 --> 00:25:31,650
is really recognizable because the new

561
00:25:31,650 --> 00:25:34,500
circuit doesn't used it this one part of

562
00:25:34,500 --> 00:25:36,690
the banks can do and I think the second

563
00:25:36,690 --> 00:25:40,110
party should like try two more total

564
00:25:40,110 --> 00:25:43,350
customers like show them how to as you

565
00:25:43,350 --> 00:25:45,660
can educate the customers mislead more

566
00:25:45,660 --> 00:25:47,300
other than it's really hard because

567
00:25:47,300 --> 00:25:49,410
people are don't want to educate

568
00:25:49,410 --> 00:25:52,350
themselves usually a same problem in

569
00:25:52,350 --> 00:25:55,680
this industry everybody else has a

570
00:25:55,680 --> 00:25:58,140
question for you Jeremy on a discretion

571
00:25:58,140 --> 00:26:01,140
there yeah

572
00:26:01,140 --> 00:26:03,540
is there any of these banks that have

573
00:26:03,540 --> 00:26:07,190
you seen using pinning that avoids this

574
00:26:07,190 --> 00:26:10,050
is man-in-the-middle using what I didn't

575
00:26:10,050 --> 00:26:19,410
hear pinning H certificate pin all right

576
00:26:19,410 --> 00:26:21,660
I think like certificate the will

577
00:26:21,660 --> 00:26:24,330
be different it's not used in this case

578
00:26:24,330 --> 00:26:27,720
when did they use HP AP or something

579
00:26:27,720 --> 00:26:28,110
like that

580
00:26:28,110 --> 00:26:31,860
the banks are they the pros are left

581
00:26:31,860 --> 00:26:35,510
side they're not the real certificate

582
00:26:35,510 --> 00:26:39,530
producing any case in this no VX PNC

583
00:26:39,530 --> 00:26:42,530
okay

584
00:26:43,490 --> 00:26:48,320
any further questions if not please join

585
00:26:48,320 --> 00:26:49,910
me in thanking John the Jaromir

586
00:26:49,910 --> 00:26:53,859
[Applause]

