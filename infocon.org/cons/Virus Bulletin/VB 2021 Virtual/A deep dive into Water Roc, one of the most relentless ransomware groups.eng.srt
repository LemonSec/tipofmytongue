1
00:00:02,640 --> 00:00:05,819
[Music]

2
00:00:12,480 --> 00:00:13,280
hi

3
00:00:13,280 --> 00:00:14,880
my name is ian kenovic and i'm a tread

4
00:00:14,880 --> 00:00:16,560
hunter director in micro

5
00:00:16,560 --> 00:00:18,480
today my colleagues and i will discuss

6
00:00:18,480 --> 00:00:20,240
the ransomware group which we call water

7
00:00:20,240 --> 00:00:21,039
rock

8
00:00:21,039 --> 00:00:22,480
we're going to show you why we believe

9
00:00:22,480 --> 00:00:24,320
water rock is one of the most relentless

10
00:00:24,320 --> 00:00:26,560
ransomware groups that we've seen today

11
00:00:26,560 --> 00:00:28,320
but firstly let's have a really quick

12
00:00:28,320 --> 00:00:29,840
recap of the last couple of years in

13
00:00:29,840 --> 00:00:31,439
ransomware which has evolved in this

14
00:00:31,439 --> 00:00:33,440
relatively short space of time but not

15
00:00:33,440 --> 00:00:35,440
necessarily the ransomware itself but

16
00:00:35,440 --> 00:00:37,360
rather in what happens before and after

17
00:00:37,360 --> 00:00:38,640
the ransomware is deployed in the

18
00:00:38,640 --> 00:00:39,600
network

19
00:00:39,600 --> 00:00:41,840
in the years 2012 to 2017 we were

20
00:00:41,840 --> 00:00:44,079
fighting mass male ransomware campaigns

21
00:00:44,079 --> 00:00:46,000
these campaigns would infect

22
00:00:46,000 --> 00:00:47,760
endpoints and they were capable of

23
00:00:47,760 --> 00:00:49,120
identifying network shares and

24
00:00:49,120 --> 00:00:50,800
encrypting those as well taking

25
00:00:50,800 --> 00:00:52,160
advantage of companies who lacked

26
00:00:52,160 --> 00:00:54,000
business continuity measures such as

27
00:00:54,000 --> 00:00:56,399
backups at the same time businesses and

28
00:00:56,399 --> 00:00:58,239
security companies were adapting and

29
00:00:58,239 --> 00:00:59,760
working to improve defenses and

30
00:00:59,760 --> 00:01:01,760
proactive detection capabilities for

31
00:01:01,760 --> 00:01:03,039
ransomware

32
00:01:03,039 --> 00:01:05,600
in 2017 we had two significant events in

33
00:01:05,600 --> 00:01:08,000
the forms of wannacry and apetia where

34
00:01:08,000 --> 00:01:09,760
the malicious use of encryption was

35
00:01:09,760 --> 00:01:11,760
coupled with exploits and automated

36
00:01:11,760 --> 00:01:14,000
propagation routines leveraging mimikatz

37
00:01:14,000 --> 00:01:15,360
and ps exec

38
00:01:15,360 --> 00:01:17,200
these catastrophic incidents put

39
00:01:17,200 --> 00:01:19,520
ransomware vulnerabilities network and

40
00:01:19,520 --> 00:01:20,880
system architecture weaknesses that

41
00:01:20,880 --> 00:01:22,880
enable them in the spotlight never

42
00:01:22,880 --> 00:01:24,720
before and this really did drive

43
00:01:24,720 --> 00:01:26,240
improvements in companies that started

44
00:01:26,240 --> 00:01:27,920
to have an impact in the volume of

45
00:01:27,920 --> 00:01:29,439
successful opportunities to grants more

46
00:01:29,439 --> 00:01:31,520
attacks we were seeing and this began to

47
00:01:31,520 --> 00:01:32,560
change

48
00:01:32,560 --> 00:01:34,479
in 2018 we started seeing attackers

49
00:01:34,479 --> 00:01:36,720
pivot away from opportunistic attacks

50
00:01:36,720 --> 00:01:38,159
and begin to pay real attention to

51
00:01:38,159 --> 00:01:40,159
internet exposed systems they began

52
00:01:40,159 --> 00:01:41,840
exploiting vulnerabilities in remote

53
00:01:41,840 --> 00:01:44,000
desktop protocol services and they also

54
00:01:44,000 --> 00:01:45,920
began leveraging weaknesses in

55
00:01:45,920 --> 00:01:48,159
credential management

56
00:01:48,159 --> 00:01:50,320
and that brings us to modern ransomware

57
00:01:50,320 --> 00:01:52,320
today we have a combination of attack

58
00:01:52,320 --> 00:01:54,079
vectors fueled by an underground supply

59
00:01:54,079 --> 00:01:55,920
chain made up of access brokers

60
00:01:55,920 --> 00:01:57,759
ransomware service providers and

61
00:01:57,759 --> 00:01:59,920
affiliates then we also have malware

62
00:01:59,920 --> 00:02:01,759
installation as a service this is the

63
00:02:01,759 --> 00:02:04,079
cooperation between botnet operators and

64
00:02:04,079 --> 00:02:06,320
malware as a service affiliates malware

65
00:02:06,320 --> 00:02:08,399
installation is a service operators drop

66
00:02:08,399 --> 00:02:10,080
second stage loaders that steal

67
00:02:10,080 --> 00:02:12,080
sensitive data and place back doors in

68
00:02:12,080 --> 00:02:13,599
compromised environments for further

69
00:02:13,599 --> 00:02:16,400
attacks the now defunct imitech botnet

70
00:02:16,400 --> 00:02:17,920
that dominated the space until its

71
00:02:17,920 --> 00:02:19,599
takedown by law enforcement earlier this

72
00:02:19,599 --> 00:02:21,440
year is a prime example of malware

73
00:02:21,440 --> 00:02:23,280
installation as a service

74
00:02:23,280 --> 00:02:25,120
we've seen others namely trick bot

75
00:02:25,120 --> 00:02:27,440
icesteady and quackbot attempt to fill

76
00:02:27,440 --> 00:02:29,760
the void left by emmitat in other words

77
00:02:29,760 --> 00:02:31,440
this is a problem that is not going away

78
00:02:31,440 --> 00:02:33,280
anytime soon

79
00:02:33,280 --> 00:02:35,200
so this is where we are today

80
00:02:35,200 --> 00:02:37,200
we have a cooperation between access

81
00:02:37,200 --> 00:02:39,840
brokers botnet operators and ransomware

82
00:02:39,840 --> 00:02:42,080
as service operators all working in

83
00:02:42,080 --> 00:02:44,000
unison to identify weaknesses in

84
00:02:44,000 --> 00:02:46,319
organizations networks globally this

85
00:02:46,319 --> 00:02:48,319
mind map is non-exhaustive but it does

86
00:02:48,319 --> 00:02:49,599
serve to illustrate the breadth of

87
00:02:49,599 --> 00:02:51,840
different malwares groups and attack

88
00:02:51,840 --> 00:02:54,239
factors aimed at companies today

89
00:02:54,239 --> 00:02:56,080
the outsourcing model leads to a higher

90
00:02:56,080 --> 00:02:58,000
success rate where the required skills

91
00:02:58,000 --> 00:02:59,440
are offered and recruited in the

92
00:02:59,440 --> 00:03:01,360
underground

93
00:03:01,360 --> 00:03:03,040
so let's take a closer look at water

94
00:03:03,040 --> 00:03:04,879
rock well we first observed this

95
00:03:04,879 --> 00:03:07,360
intrusion set in 2020 when we analyzed

96
00:03:07,360 --> 00:03:09,440
the nephilim ransomware as a service

97
00:03:09,440 --> 00:03:11,280
when we took a look at the early victims

98
00:03:11,280 --> 00:03:12,560
we found that they were generally one

99
00:03:12,560 --> 00:03:13,920
billion dollar plus revenue

100
00:03:13,920 --> 00:03:15,440
organizations

101
00:03:15,440 --> 00:03:17,280
like other targeted ransomware attacks

102
00:03:17,280 --> 00:03:19,599
the criminals leveraged double extortion

103
00:03:19,599 --> 00:03:21,680
with ransomware for impact and stolen

104
00:03:21,680 --> 00:03:23,680
data for additional leverage

105
00:03:23,680 --> 00:03:25,200
as is the case with other targeted

106
00:03:25,200 --> 00:03:27,360
ransomware groups such as ryuk

107
00:03:27,360 --> 00:03:28,799
water rock victims were named and

108
00:03:28,799 --> 00:03:31,200
chained on a leak site

109
00:03:31,200 --> 00:03:33,360
with nephilim we observe similarities

110
00:03:33,360 --> 00:03:35,040
with another ransomware as a service

111
00:03:35,040 --> 00:03:37,840
offering an empty an empty was the

112
00:03:37,840 --> 00:03:39,440
ransomware as a service offering which

113
00:03:39,440 --> 00:03:42,159
we first spotted in 2019

114
00:03:42,159 --> 00:03:44,400
and with no film we have obvious cool

115
00:03:44,400 --> 00:03:46,720
similarities with an empty quote

116
00:03:46,720 --> 00:03:48,959
we also know two aliases with this group

117
00:03:48,959 --> 00:03:51,280
namely js forum and jingo at the time

118
00:03:51,280 --> 00:03:53,120
nemti was shutting down the same actors

119
00:03:53,120 --> 00:03:54,560
were actively recruiting for a new

120
00:03:54,560 --> 00:03:56,799
private ransomware as a service offering

121
00:03:56,799 --> 00:03:58,720
the adverts feature in addition an

122
00:03:58,720 --> 00:04:00,879
initial profit split between operators

123
00:04:00,879 --> 00:04:03,760
and affiliates of 70 30 moving to 9010

124
00:04:03,760 --> 00:04:05,280
for affiliates who can bring a higher

125
00:04:05,280 --> 00:04:07,280
number of victims this is similar to

126
00:04:07,280 --> 00:04:08,560
that of an empty and we believe the

127
00:04:08,560 --> 00:04:11,120
actors here are recruiting for nephilim

128
00:04:11,120 --> 00:04:12,879
so let's talk about how water rock gains

129
00:04:12,879 --> 00:04:14,959
initial access to the network

130
00:04:14,959 --> 00:04:16,880
so we can think of modern ransomware

131
00:04:16,880 --> 00:04:18,639
initial access techniques and our skill

132
00:04:18,639 --> 00:04:20,478
sets to be at least on par with that of

133
00:04:20,478 --> 00:04:22,560
professional penetration testers in the

134
00:04:22,560 --> 00:04:24,880
case of water rock we observed that they

135
00:04:24,880 --> 00:04:26,479
used a citrix vulnerability that first

136
00:04:26,479 --> 00:04:28,960
appeared in december 2019

137
00:04:28,960 --> 00:04:30,720
at that time on disclosure there was

138
00:04:30,720 --> 00:04:32,560
approximately 80 000 organizations

139
00:04:32,560 --> 00:04:34,560
running vulnerable instances

140
00:04:34,560 --> 00:04:36,160
citrix disclosed the vulnerability with

141
00:04:36,160 --> 00:04:39,360
mitigations on the 17th of december 2019

142
00:04:39,360 --> 00:04:41,120
a first public proof of concept code

143
00:04:41,120 --> 00:04:43,600
appeared on the 10th of january in 2020

144
00:04:43,600 --> 00:04:45,120
but crucially the vulnerability was not

145
00:04:45,120 --> 00:04:47,759
fixed until the 19th of january 2020.

146
00:04:47,759 --> 00:04:49,919
the expectations are the gap between

147
00:04:49,919 --> 00:04:51,600
vulnerability disclosures and the

148
00:04:51,600 --> 00:04:54,160
availability of a fix the availability

149
00:04:54,160 --> 00:04:55,919
of proof of concept code and then the

150
00:04:55,919 --> 00:04:57,600
usual lag between the deployment of

151
00:04:57,600 --> 00:04:59,919
mitigations has become a stable tactic

152
00:04:59,919 --> 00:05:01,680
exploited by criminals in target

153
00:05:01,680 --> 00:05:03,600
ransomware attacks we also believe that

154
00:05:03,600 --> 00:05:05,759
there were other exploits likely used to

155
00:05:05,759 --> 00:05:07,919
gain initial access to victims

156
00:05:07,919 --> 00:05:09,759
for internet exposed systems this is

157
00:05:09,759 --> 00:05:11,520
especially critical our advice to

158
00:05:11,520 --> 00:05:14,639
customers is drop tools mitigate patch

159
00:05:14,639 --> 00:05:16,080
and treat these vulnerable assets as

160
00:05:16,080 --> 00:05:18,000
potentially compromised

161
00:05:18,000 --> 00:05:19,759
after gaining an initial foothold in the

162
00:05:19,759 --> 00:05:21,600
network attackers deployed

163
00:05:21,600 --> 00:05:23,199
post-exploitation tools to begin

164
00:05:23,199 --> 00:05:25,440
borrowing deeper into that network we

165
00:05:25,440 --> 00:05:27,840
found the usual suspects cobalt strike

166
00:05:27,840 --> 00:05:29,600
was used in every intrusion that we've

167
00:05:29,600 --> 00:05:30,479
seen

168
00:05:30,479 --> 00:05:31,919
in an early case we found that the

169
00:05:31,919 --> 00:05:33,440
deployment of the cobalt strike beacon

170
00:05:33,440 --> 00:05:35,199
didn't always go smoothly we found that

171
00:05:35,199 --> 00:05:37,440
water rock deployed an unsigned cobalt

172
00:05:37,440 --> 00:05:39,520
strike beacon that was detected by an

173
00:05:39,520 --> 00:05:40,880
anti-malware software running on the

174
00:05:40,880 --> 00:05:42,800
compromised server there were turns and

175
00:05:42,800 --> 00:05:44,800
ten days later deployed a signed beacon

176
00:05:44,800 --> 00:05:46,639
which was again detected but they

177
00:05:46,639 --> 00:05:49,440
persisted until av was evaded a full 17

178
00:05:49,440 --> 00:05:51,520
days after gaining the initial access

179
00:05:51,520 --> 00:05:53,120
yes we have seen that ransomware

180
00:05:53,120 --> 00:05:54,880
attackers go from initial access to

181
00:05:54,880 --> 00:05:56,800
ransomware deployment in the same day

182
00:05:56,800 --> 00:05:58,479
but if with effective monitoring and

183
00:05:58,479 --> 00:06:00,560
instant response plan there is time to

184
00:06:00,560 --> 00:06:02,639
minimize the impact and to boot the bad

185
00:06:02,639 --> 00:06:04,160
guys out of your network

186
00:06:04,160 --> 00:06:06,160
for defenders this also demonstrate the

187
00:06:06,160 --> 00:06:07,759
value of monitoring certain noteworth

188
00:06:07,759 --> 00:06:09,280
detections which may indicate a

189
00:06:09,280 --> 00:06:11,440
particular attack phase what's more it's

190
00:06:11,440 --> 00:06:12,880
worth pointing out that the attackers

191
00:06:12,880 --> 00:06:14,880
persisted in the network of further weak

192
00:06:14,880 --> 00:06:18,160
before deploying any ransomware at all

193
00:06:18,160 --> 00:06:19,919
so let's talk about how water rock moves

194
00:06:19,919 --> 00:06:21,600
laterally in the network using

195
00:06:21,600 --> 00:06:23,360
vulnerabilities

196
00:06:23,360 --> 00:06:25,360
critical bugs such as remote execution

197
00:06:25,360 --> 00:06:26,800
vulnerabilities rightfully get the

198
00:06:26,800 --> 00:06:28,560
attention that they deserve to gain

199
00:06:28,560 --> 00:06:30,720
widespread coverage in the media but

200
00:06:30,720 --> 00:06:32,080
with new vulnerabilities gaining

201
00:06:32,080 --> 00:06:34,080
notoriety almost every month they

202
00:06:34,080 --> 00:06:36,080
quickly get forgotten about patch

203
00:06:36,080 --> 00:06:37,680
management for older vulnerabilities

204
00:06:37,680 --> 00:06:40,400
continues to plague organizations

205
00:06:40,400 --> 00:06:42,639
water rock for instance leverages

206
00:06:42,639 --> 00:06:44,479
elevation of privilege vulnerability

207
00:06:44,479 --> 00:06:46,400
from 2017 which was discovered by

208
00:06:46,400 --> 00:06:48,400
researchers at google almost a full

209
00:06:48,400 --> 00:06:50,080
three years prior to the water rock

210
00:06:50,080 --> 00:06:52,319
intrusion the code used was the actual

211
00:06:52,319 --> 00:06:54,639
proof of concept code released by google

212
00:06:54,639 --> 00:06:56,400
other vulnerabilities are also used

213
00:06:56,400 --> 00:06:58,880
namely eternal blue and smb ghost to

214
00:06:58,880 --> 00:07:01,199
move laterally across the network let's

215
00:07:01,199 --> 00:07:03,440
take a look at some of the tooling used

216
00:07:03,440 --> 00:07:04,560
by water

217
00:07:04,560 --> 00:07:06,080
from water rock we found a couple of

218
00:07:06,080 --> 00:07:08,880
commonalities outside of cobalt strike

219
00:07:08,880 --> 00:07:10,479
so process hacker

220
00:07:10,479 --> 00:07:12,080
a tool that's used by defenders and

221
00:07:12,080 --> 00:07:13,520
malware analysts and systems

222
00:07:13,520 --> 00:07:16,160
administrators in this case uh it was

223
00:07:16,160 --> 00:07:17,759
used to kill security software and

224
00:07:17,759 --> 00:07:20,080
monitoring tools for credential access

225
00:07:20,080 --> 00:07:21,440
we found the usual suspects with

226
00:07:21,440 --> 00:07:23,520
mimikatz used for credential dumping but

227
00:07:23,520 --> 00:07:25,120
we also found tools that we don't see in

228
00:07:25,120 --> 00:07:26,720
many targeted ransomware attacks these

229
00:07:26,720 --> 00:07:29,440
days such as nl brute which attackers

230
00:07:29,440 --> 00:07:31,759
used to brute force rtp services

231
00:07:31,759 --> 00:07:33,440
for discovery of other systems

232
00:07:33,440 --> 00:07:35,039
bloodhound was used for attack pack

233
00:07:35,039 --> 00:07:37,680
discovery sharpound was used to dump the

234
00:07:37,680 --> 00:07:39,520
ad structure which was then analyzed

235
00:07:39,520 --> 00:07:42,720
off-site adfind another ad enumeration

236
00:07:42,720 --> 00:07:44,960
tool was also found in multiple

237
00:07:44,960 --> 00:07:46,160
intrusions

238
00:07:46,160 --> 00:07:47,840
smb tools additionally was used to

239
00:07:47,840 --> 00:07:49,199
perform reconnaissance across the

240
00:07:49,199 --> 00:07:52,000
network using smb this tool uses ntlm

241
00:07:52,000 --> 00:07:54,080
hashes as well as domain credentials to

242
00:07:54,080 --> 00:07:56,800
access remote hosts using smb so a wide

243
00:07:56,800 --> 00:07:58,879
variety of tooling was used to achieve

244
00:07:58,879 --> 00:08:00,400
their objectives

245
00:08:00,400 --> 00:08:01,680
and that brings us to the ransomware

246
00:08:01,680 --> 00:08:03,919
deployment so in the case of water rock

247
00:08:03,919 --> 00:08:05,360
nephilim was deployed using a

248
00:08:05,360 --> 00:08:08,639
combination of psx and batch grips and

249
00:08:08,639 --> 00:08:10,960
brass scripts were used to kill

250
00:08:10,960 --> 00:08:12,800
interesting processes to avoid things

251
00:08:12,800 --> 00:08:14,960
like access violations or potentially

252
00:08:14,960 --> 00:08:17,599
security software finally before

253
00:08:17,599 --> 00:08:21,039
executing the malicious nephilim binary

254
00:08:21,039 --> 00:08:23,440
so for data exfiltration the attackers

255
00:08:23,440 --> 00:08:26,080
used two primary mechanisms in early

256
00:08:26,080 --> 00:08:28,800
attacks we observed the water rock using

257
00:08:28,800 --> 00:08:30,879
a combination of collection scripts with

258
00:08:30,879 --> 00:08:33,519
ftp so these commands were executed via

259
00:08:33,519 --> 00:08:35,440
cobalt strike

260
00:08:35,440 --> 00:08:37,839
where 7-zip compressed archives were

261
00:08:37,839 --> 00:08:41,519
uploaded to a remote host using ftp

262
00:08:41,519 --> 00:08:43,200
but the attackers also leveraged mega

263
00:08:43,200 --> 00:08:44,159
sync

264
00:08:44,159 --> 00:08:46,800
and we noted that they used a mega sync

265
00:08:46,800 --> 00:08:49,040
to exfoliate large volumes of data as

266
00:08:49,040 --> 00:08:50,880
mega provides 20 gigabytes of free

267
00:08:50,880 --> 00:08:53,279
storage the tooling to compress the

268
00:08:53,279 --> 00:08:55,200
stolen data was dropped earlier on in

269
00:08:55,200 --> 00:08:57,120
the attack phase

270
00:08:57,120 --> 00:08:59,200
hello my name is fernando mercedes and

271
00:08:59,200 --> 00:09:00,880
i'm a senior threat researcher with

272
00:09:00,880 --> 00:09:03,200
trend micro we'll now have a look at the

273
00:09:03,200 --> 00:09:05,440
inner workings of the

274
00:09:05,440 --> 00:09:08,399
nephilim rancher itself

275
00:09:08,399 --> 00:09:12,160
the main payload behind this attack so

276
00:09:12,160 --> 00:09:14,240
let's start

277
00:09:14,240 --> 00:09:17,200
so first i've prepared

278
00:09:17,200 --> 00:09:19,920
two documents two files one is a

279
00:09:19,920 --> 00:09:22,080
document.rtf

280
00:09:22,080 --> 00:09:24,160
it's a text file

281
00:09:24,160 --> 00:09:28,000
as a testing document

282
00:09:28,560 --> 00:09:30,640
and we're going to use this first one

283
00:09:30,640 --> 00:09:32,080
with the first

284
00:09:32,080 --> 00:09:35,279
nafflin operation mode which is

285
00:09:35,279 --> 00:09:37,680
basically providing

286
00:09:37,680 --> 00:09:40,399
to the netherlands executable a file

287
00:09:40,399 --> 00:09:43,200
path or a directory path

288
00:09:43,200 --> 00:09:47,519
this is going to work this way

289
00:09:47,519 --> 00:09:48,480
and

290
00:09:48,480 --> 00:09:51,440
as you can see the file was encrypted

291
00:09:51,440 --> 00:09:56,320
and the kiano extension was added

292
00:09:56,480 --> 00:09:58,080
but there is also

293
00:09:58,080 --> 00:09:59,360
a regular

294
00:09:59,360 --> 00:10:00,800
working mode

295
00:10:00,800 --> 00:10:03,200
which is actually just executing the

296
00:10:03,200 --> 00:10:04,720
transfer

297
00:10:04,720 --> 00:10:05,839
so just

298
00:10:05,839 --> 00:10:06,959
the

299
00:10:06,959 --> 00:10:08,399
binary

300
00:10:08,399 --> 00:10:10,880
and then well before that let's look at

301
00:10:10,880 --> 00:10:13,440
the image it's a test image

302
00:10:13,440 --> 00:10:16,079
and it opens normally and then after i

303
00:10:16,079 --> 00:10:17,680
press enter

304
00:10:17,680 --> 00:10:20,640
well nephiline complains about a couple

305
00:10:20,640 --> 00:10:23,120
of files and folders it couldn't open

306
00:10:23,120 --> 00:10:25,440
because i didn't run it with elevated

307
00:10:25,440 --> 00:10:26,720
privileges

308
00:10:26,720 --> 00:10:29,839
but it actually worked encrypting

309
00:10:29,839 --> 00:10:32,959
the bitmap file

310
00:10:32,959 --> 00:10:35,040
you can actually

311
00:10:35,040 --> 00:10:38,959
see this by trying to open it

312
00:10:38,959 --> 00:10:40,240
it doesn't work

313
00:10:40,240 --> 00:10:42,399
and it also creates the renson node in

314
00:10:42,399 --> 00:10:45,360
this mode it creates the renson node so

315
00:10:45,360 --> 00:10:47,120
you can see the

316
00:10:47,120 --> 00:10:49,920
blog where they leak data

317
00:10:49,920 --> 00:10:52,000
and yeah so that's

318
00:10:52,000 --> 00:10:55,600
basically what happens

319
00:10:55,839 --> 00:10:59,120
now let's debug it let's see how it

320
00:10:59,120 --> 00:11:02,560
works i will first load a

321
00:11:02,560 --> 00:11:03,920
map file

322
00:11:03,920 --> 00:11:07,200
which i exported from ida

323
00:11:07,200 --> 00:11:08,399
so i have

324
00:11:08,399 --> 00:11:10,480
labels here

325
00:11:10,480 --> 00:11:13,760
in the debugging session as well

326
00:11:13,760 --> 00:11:17,120
especially the main underscore labels

327
00:11:17,120 --> 00:11:19,760
for go programs are really useful so i'm

328
00:11:19,760 --> 00:11:21,839
going to put a breakpoint on main

329
00:11:21,839 --> 00:11:23,680
in the main function and also in that

330
00:11:23,680 --> 00:11:26,240
unix file function you're going to see

331
00:11:26,240 --> 00:11:28,640
why in a minute

332
00:11:28,640 --> 00:11:31,600
so here we are at the main function

333
00:11:31,600 --> 00:11:33,519
and the first interesting thing we see

334
00:11:33,519 --> 00:11:37,120
is that ctr encrypt

335
00:11:37,120 --> 00:11:38,240
call

336
00:11:38,240 --> 00:11:41,279
so i'm going to break it here and

337
00:11:41,279 --> 00:11:44,000
we note that there are actually

338
00:11:44,000 --> 00:11:46,640
two parameters

339
00:11:46,640 --> 00:11:48,800
uh to this function

340
00:11:48,800 --> 00:11:50,720
uh among others actually

341
00:11:50,720 --> 00:11:52,480
and uh it's

342
00:11:52,480 --> 00:11:54,880
actually decrypting

343
00:11:54,880 --> 00:11:56,639
uh something that looks like a

344
00:11:56,639 --> 00:11:58,399
configuration

345
00:11:58,399 --> 00:12:01,920
so let's copy this

346
00:12:02,000 --> 00:12:05,760
whatever was decrypted here

347
00:12:05,760 --> 00:12:07,760
it is

348
00:12:07,760 --> 00:12:13,600
a bit lengthy yeah so we have b0a bytes

349
00:12:13,600 --> 00:12:16,720
i'm gonna copy this data

350
00:12:16,720 --> 00:12:19,600
as a string

351
00:12:20,399 --> 00:12:22,800
and

352
00:12:22,959 --> 00:12:24,639
i'm gonna use now

353
00:12:24,639 --> 00:12:27,440
cyber chef

354
00:12:27,600 --> 00:12:29,440
just because it's

355
00:12:29,440 --> 00:12:32,240
a very nice tool

356
00:12:34,240 --> 00:12:38,160
to do some beautifying of this json

357
00:12:38,160 --> 00:12:40,639
output

358
00:12:40,880 --> 00:12:46,560
that's it so i have a well identity json

359
00:12:46,560 --> 00:12:49,199
file here

360
00:12:49,760 --> 00:12:52,079
and we can add it as a note

361
00:12:52,079 --> 00:12:55,040
in the debut key

362
00:12:57,839 --> 00:13:00,000
then we see there is something

363
00:13:00,000 --> 00:13:01,440
that

364
00:13:01,440 --> 00:13:04,560
seems to be encoded in base 64.

365
00:13:04,560 --> 00:13:07,440
the actually the field name is base64

366
00:13:07,440 --> 00:13:09,360
note

367
00:13:09,360 --> 00:13:13,920
so we can use cyber chef as well just to

368
00:13:13,920 --> 00:13:16,880
see what's in there

369
00:13:18,800 --> 00:13:21,279
and we get the ransom note

370
00:13:21,279 --> 00:13:23,680
i'm going to copy that also

371
00:13:23,680 --> 00:13:27,040
paste into the notes of the debuggie

372
00:13:27,040 --> 00:13:28,320
so

373
00:13:28,320 --> 00:13:30,079
yeah that's the rest of notes the email

374
00:13:30,079 --> 00:13:33,359
addresses and the blog

375
00:13:33,680 --> 00:13:37,439
so i keep it for later

376
00:13:37,519 --> 00:13:39,600
now let's continue

377
00:13:39,600 --> 00:13:41,920
with the debugging

378
00:13:41,920 --> 00:13:45,279
we have some json parsing and then

379
00:13:45,279 --> 00:13:50,639
go to other functions and i hit f9 and

380
00:13:50,639 --> 00:13:53,199
we can see it opening a couple of files

381
00:13:53,199 --> 00:13:55,279
let's look at this one

382
00:13:55,279 --> 00:13:57,040
because it seems like it's a file it's

383
00:13:57,040 --> 00:13:59,600
going to encrypt it's not a directory

384
00:13:59,600 --> 00:14:03,839
so i'm going to copy the file path

385
00:14:04,480 --> 00:14:06,160
and just to have a look at the file

386
00:14:06,160 --> 00:14:08,560
first

387
00:14:09,600 --> 00:14:14,399
okay seems fine so it's a text file

388
00:14:14,399 --> 00:14:16,880
no problem with this so it's opening the

389
00:14:16,880 --> 00:14:18,639
file

390
00:14:18,639 --> 00:14:19,680
we can

391
00:14:19,680 --> 00:14:22,720
have a look at what happens here

392
00:14:22,720 --> 00:14:25,839
and then we see some interesting stuff

393
00:14:25,839 --> 00:14:27,040
which is

394
00:14:27,040 --> 00:14:31,120
this call to generate random bytes

395
00:14:31,120 --> 00:14:33,920
so it's called once

396
00:14:33,920 --> 00:14:37,920
now i later realized that in edx

397
00:14:37,920 --> 00:14:40,480
you get the address where the bytes were

398
00:14:40,480 --> 00:14:42,720
written to

399
00:14:42,720 --> 00:14:45,199
so that's the first sequence of bytes

400
00:14:45,199 --> 00:14:47,839
generated and then let's look at the

401
00:14:47,839 --> 00:14:50,560
second it actually

402
00:14:50,560 --> 00:14:53,519
right after this so i have two numbers

403
00:14:53,519 --> 00:14:56,079
let's add a label to make things easier

404
00:14:56,079 --> 00:15:00,880
this i'm going call rando number one

405
00:15:01,519 --> 00:15:04,480
and the next one i'm gonna call it

406
00:15:04,480 --> 00:15:07,519
rainbow number two

407
00:15:07,519 --> 00:15:08,480
okay

408
00:15:08,480 --> 00:15:10,800
so going forward

409
00:15:10,800 --> 00:15:13,199
we see some

410
00:15:13,199 --> 00:15:14,959
interesting

411
00:15:14,959 --> 00:15:16,800
key handling here

412
00:15:16,800 --> 00:15:20,959
so it's an rsa key this is actually the

413
00:15:20,959 --> 00:15:23,120
rsa public key

414
00:15:23,120 --> 00:15:25,839
that is present in the configuration

415
00:15:25,839 --> 00:15:27,519
that was decrypted

416
00:15:27,519 --> 00:15:29,920
before

417
00:15:29,920 --> 00:15:32,880
so this key is actually used to encrypt

418
00:15:32,880 --> 00:15:35,759
something here in this call and uh what

419
00:15:35,759 --> 00:15:38,000
is this is going to encrypt render

420
00:15:38,000 --> 00:15:40,079
number one

421
00:15:40,079 --> 00:15:42,800
done so uh we can actually look at the

422
00:15:42,800 --> 00:15:44,240
results

423
00:15:44,240 --> 00:15:45,360
this

424
00:15:45,360 --> 00:15:47,600
we can add a label

425
00:15:47,600 --> 00:15:49,759
and because that's the encrypt

426
00:15:49,759 --> 00:15:51,759
render number one so let's call it inc

427
00:15:51,759 --> 00:15:52,839
render

428
00:15:52,839 --> 00:15:56,160
one a similar structure

429
00:15:56,160 --> 00:15:57,680
follows

430
00:15:57,680 --> 00:16:01,279
next so that's again encrypting but this

431
00:16:01,279 --> 00:16:04,320
time random number two

432
00:16:04,320 --> 00:16:05,040
we

433
00:16:05,040 --> 00:16:06,880
gonna add uh

434
00:16:06,880 --> 00:16:08,480
another label

435
00:16:08,480 --> 00:16:11,360
that's random number two

436
00:16:11,360 --> 00:16:12,399
and then

437
00:16:12,399 --> 00:16:15,600
we follow with the execution

438
00:16:15,600 --> 00:16:18,959
and now it's easier to see in the

439
00:16:18,959 --> 00:16:20,399
right column

440
00:16:20,399 --> 00:16:22,560
when random number either render number

441
00:16:22,560 --> 00:16:24,320
one or two are used

442
00:16:24,320 --> 00:16:26,720
so now there's a call to read

443
00:16:26,720 --> 00:16:29,120
and this is actually reading the

444
00:16:29,120 --> 00:16:31,680
contents of the file we can see here and

445
00:16:31,680 --> 00:16:33,440
dump

446
00:16:33,440 --> 00:16:35,120
that's really the content

447
00:16:35,120 --> 00:16:37,120
of the file that

448
00:16:37,120 --> 00:16:40,399
we saw before

449
00:16:40,399 --> 00:16:41,519
and

450
00:16:41,519 --> 00:16:42,560
now

451
00:16:42,560 --> 00:16:45,680
we have a call to ctr and crypt using

452
00:16:45,680 --> 00:16:48,480
both window number one and two

453
00:16:48,480 --> 00:16:51,040
this is actually encrypting the file

454
00:16:51,040 --> 00:16:52,560
content

455
00:16:52,560 --> 00:16:56,479
that's the encrypted version of it

456
00:16:56,560 --> 00:16:57,759
okay so

457
00:16:57,759 --> 00:17:02,399
this is now written back to the file

458
00:17:02,639 --> 00:17:05,439
and then there is another

459
00:17:05,439 --> 00:17:07,439
data being written which is actually the

460
00:17:07,439 --> 00:17:09,760
encrypted version of random number one

461
00:17:09,760 --> 00:17:12,000
and also random number two

462
00:17:12,000 --> 00:17:14,400
afterwards so that's exactly how nafling

463
00:17:14,400 --> 00:17:15,280
works

464
00:17:15,280 --> 00:17:16,319
it

465
00:17:16,319 --> 00:17:17,760
writes

466
00:17:17,760 --> 00:17:18,640
the

467
00:17:18,640 --> 00:17:21,359
generated random number

468
00:17:21,359 --> 00:17:22,240
to

469
00:17:22,240 --> 00:17:25,119
the end of the file then

470
00:17:25,119 --> 00:17:27,679
it does the same for the second one

471
00:17:27,679 --> 00:17:29,280
and finally

472
00:17:29,280 --> 00:17:31,600
he also adds a marker

473
00:17:31,600 --> 00:17:34,880
which in that case is kiano

474
00:17:34,880 --> 00:17:37,120
and this is also written

475
00:17:37,120 --> 00:17:39,280
through the file

476
00:17:39,280 --> 00:17:42,640
now we can have a look at the file

477
00:17:42,640 --> 00:17:44,559
it doesn't really exist

478
00:17:44,559 --> 00:17:49,520
because it was renamed to dot kayano

479
00:17:49,520 --> 00:17:54,400
and we see the file is now encrypted

480
00:17:54,400 --> 00:17:56,960
okay so let's look at this file

481
00:17:56,960 --> 00:17:58,400
in a

482
00:17:58,400 --> 00:18:01,520
more interesting way maybe with a

483
00:18:01,520 --> 00:18:05,280
hexadecimal editor

484
00:18:07,280 --> 00:18:09,600
okay

485
00:18:10,799 --> 00:18:12,320
so

486
00:18:12,320 --> 00:18:15,120
we can go to the end of the file it's

487
00:18:15,120 --> 00:18:16,080
actually

488
00:18:16,080 --> 00:18:17,600
easier this way

489
00:18:17,600 --> 00:18:22,480
because the two numbers are actually 256

490
00:18:22,480 --> 00:18:23,360
byte

491
00:18:23,360 --> 00:18:25,200
each so we can just

492
00:18:25,200 --> 00:18:28,640
select uh 512 bytes

493
00:18:28,640 --> 00:18:30,480
and then the rest

494
00:18:30,480 --> 00:18:32,640
is going to be our

495
00:18:32,640 --> 00:18:35,600
encrypted data

496
00:18:35,760 --> 00:18:39,120
we can just use a cyber chef as well to

497
00:18:39,120 --> 00:18:41,679
put that encrypted data here the idea is

498
00:18:41,679 --> 00:18:43,760
to decrypt it so we're going to need

499
00:18:43,760 --> 00:18:46,559
that previously generated random

500
00:18:46,559 --> 00:18:48,559
numbers which are actually

501
00:18:48,559 --> 00:18:49,280
the

502
00:18:49,280 --> 00:18:50,640
aes

503
00:18:50,640 --> 00:18:55,640
keys so let's copy the first one

504
00:18:56,799 --> 00:18:58,160
and

505
00:18:58,160 --> 00:19:01,919
we're gonna need uh recycle here for

506
00:19:01,919 --> 00:19:02,880
hex

507
00:19:02,880 --> 00:19:04,720
hexadecimal

508
00:19:04,720 --> 00:19:08,160
so convert into raw and then an aes

509
00:19:08,160 --> 00:19:10,559
decrypt reside

510
00:19:10,559 --> 00:19:12,320
so we have the key

511
00:19:12,320 --> 00:19:14,640
that's in hex

512
00:19:14,640 --> 00:19:17,600
and then the second random number

513
00:19:17,600 --> 00:19:20,400
it's actually the iv or in that case

514
00:19:20,400 --> 00:19:23,440
which since it's aes ctr

515
00:19:23,440 --> 00:19:24,880
it's also called

516
00:19:24,880 --> 00:19:27,280
nonce

517
00:19:27,679 --> 00:19:30,960
so here the iv we change the mode to ctr

518
00:19:30,960 --> 00:19:32,960
we change the inputs for

519
00:19:32,960 --> 00:19:33,919
role

520
00:19:33,919 --> 00:19:36,799
and we have the file contents

521
00:19:36,799 --> 00:19:38,960
and that concludes our

522
00:19:38,960 --> 00:19:41,919
analysis of the main range for payloads

523
00:19:41,919 --> 00:19:43,679
it's important to say though that the

524
00:19:43,679 --> 00:19:47,200
decryption methods are shown here they

525
00:19:47,200 --> 00:19:49,039
they were only possible because i was

526
00:19:49,039 --> 00:19:50,320
debugging

527
00:19:50,320 --> 00:19:51,039
a

528
00:19:51,039 --> 00:19:53,200
particular session of the execution of

529
00:19:53,200 --> 00:19:54,960
this ranger

530
00:19:54,960 --> 00:19:58,160
while it was generating the keys

531
00:19:58,160 --> 00:20:02,480
so this is not really feasible

532
00:20:02,480 --> 00:20:03,840
for past

533
00:20:03,840 --> 00:20:06,320
attacks so we are not aware of any way

534
00:20:06,320 --> 00:20:08,720
of decrypting

535
00:20:08,720 --> 00:20:12,320
files encrypted by nephiline rensser

536
00:20:12,320 --> 00:20:13,919
to date

537
00:20:13,919 --> 00:20:16,320
now i call my colleague fikey

538
00:20:16,320 --> 00:20:18,320
who is going to give you even more

539
00:20:18,320 --> 00:20:20,880
details behind this operation

540
00:20:20,880 --> 00:20:22,880
hello everybody my name is feika

541
00:20:22,880 --> 00:20:24,000
huckabout

542
00:20:24,000 --> 00:20:26,960
my teammate fernando has just explained

543
00:20:26,960 --> 00:20:29,520
the inner workings of the ransomware

544
00:20:29,520 --> 00:20:33,440
binaries of the water rock actor

545
00:20:33,440 --> 00:20:36,799
i will now talk about the victims of the

546
00:20:36,799 --> 00:20:38,880
water rock actor

547
00:20:38,880 --> 00:20:41,360
the victims of waterrock are distributed

548
00:20:41,360 --> 00:20:43,520
over various industries

549
00:20:43,520 --> 00:20:46,240
but most of the victims are located in

550
00:20:46,240 --> 00:20:48,400
the u.s

551
00:20:48,400 --> 00:20:51,280
this is consistent with postings in

552
00:20:51,280 --> 00:20:54,960
underground forms we have been seeing

553
00:20:54,960 --> 00:20:58,320
in these postings in underground forums

554
00:20:58,320 --> 00:21:01,120
water rock related actors are

555
00:21:01,120 --> 00:21:04,000
interested in buying access to

556
00:21:04,000 --> 00:21:07,039
compromised networks of companies mainly

557
00:21:07,039 --> 00:21:10,000
in the us and australia

558
00:21:10,000 --> 00:21:12,400
they also request

559
00:21:12,400 --> 00:21:13,840
a revenue

560
00:21:13,840 --> 00:21:16,080
of companies of at least 200 million

561
00:21:16,080 --> 00:21:17,520
dollars

562
00:21:17,520 --> 00:21:20,320
this is also consistent with data we

563
00:21:20,320 --> 00:21:22,159
have been seeing

564
00:21:22,159 --> 00:21:24,640
the median revenue of the victimized

565
00:21:24,640 --> 00:21:27,120
companies of water rock is about 900

566
00:21:27,120 --> 00:21:29,679
million us dollar

567
00:21:29,679 --> 00:21:32,960
once water rock starts to publish stolen

568
00:21:32,960 --> 00:21:35,760
data on their tor hidden web server

569
00:21:35,760 --> 00:21:38,080
the actor shows a rather relentless

570
00:21:38,080 --> 00:21:39,679
behavior

571
00:21:39,679 --> 00:21:42,960
for about 75 percent of these victims

572
00:21:42,960 --> 00:21:45,760
this ransomware actor is leaking data

573
00:21:45,760 --> 00:21:48,559
over a period of one to two months

574
00:21:48,559 --> 00:21:51,280
but for the remaining 25 percent of the

575
00:21:51,280 --> 00:21:53,679
victimized companies the actor is

576
00:21:53,679 --> 00:21:56,559
leaking parts of the stolen data during

577
00:21:56,559 --> 00:22:01,440
a period that varies from 4 to 13 months

578
00:22:01,440 --> 00:22:03,679
for about all of the victimized

579
00:22:03,679 --> 00:22:08,080
companies lead data remained online

580
00:22:08,080 --> 00:22:11,200
from the first day the leak appeared and

581
00:22:11,200 --> 00:22:14,159
there's no indication the data will be

582
00:22:14,159 --> 00:22:17,280
removed from the tor hidden surfer of

583
00:22:17,280 --> 00:22:18,720
water rock

584
00:22:18,720 --> 00:22:21,200
we do not know what the rationale is

585
00:22:21,200 --> 00:22:24,799
behind this behind leaking new data over

586
00:22:24,799 --> 00:22:28,320
extended periods of times

587
00:22:28,320 --> 00:22:32,720
for example from 4 to 13 months

588
00:22:32,720 --> 00:22:34,960
we think victims will not be more

589
00:22:34,960 --> 00:22:37,919
inclined to pay a ransom

590
00:22:37,919 --> 00:22:41,280
but rather this is a message to future

591
00:22:41,280 --> 00:22:42,720
victims

592
00:22:42,720 --> 00:22:45,679
when they wouldn't pay a ransom

593
00:22:45,679 --> 00:22:48,080
to our knowledge there's no other

594
00:22:48,080 --> 00:22:51,760
ransomware as a service actor that is so

595
00:22:51,760 --> 00:22:54,720
relentless in exposing new sensitive

596
00:22:54,720 --> 00:22:57,600
data victim data over extended periods

597
00:22:57,600 --> 00:22:58,960
of time

598
00:22:58,960 --> 00:23:01,679
we will now talk about a study we have

599
00:23:01,679 --> 00:23:05,280
done where we compared 16 different

600
00:23:05,280 --> 00:23:07,440
ransomware as a service actors with each

601
00:23:07,440 --> 00:23:08,559
other

602
00:23:08,559 --> 00:23:10,480
there appear to be significant

603
00:23:10,480 --> 00:23:12,400
differences between

604
00:23:12,400 --> 00:23:17,120
different ransomware sa service actors

605
00:23:17,120 --> 00:23:19,919
we have been looking at the median

606
00:23:19,919 --> 00:23:22,559
revenue of different ransomware as a

607
00:23:22,559 --> 00:23:25,919
service actors but also at the number of

608
00:23:25,919 --> 00:23:29,440
victims it appears that nephilim has

609
00:23:29,440 --> 00:23:32,720
relatively few victims on their

610
00:23:32,720 --> 00:23:35,840
website on their website where they post

611
00:23:35,840 --> 00:23:37,840
stolen data

612
00:23:37,840 --> 00:23:40,240
about 30 early this year and in the

613
00:23:40,240 --> 00:23:43,279
summer about 50 victims there are some

614
00:23:43,279 --> 00:23:45,760
other ransomware as a service groups

615
00:23:45,760 --> 00:23:47,679
that have far more

616
00:23:47,679 --> 00:23:49,600
victims on their website

617
00:23:49,600 --> 00:23:52,559
sometimes a few hundred but it appears

618
00:23:52,559 --> 00:23:56,640
that these actors are not that selective

619
00:23:56,640 --> 00:23:58,640
in choosing their victims

620
00:23:58,640 --> 00:24:01,440
nephilim and other ransomware as the

621
00:24:01,440 --> 00:24:02,559
service

622
00:24:02,559 --> 00:24:04,400
groups are much more

623
00:24:04,400 --> 00:24:08,080
selective as you can see on this slide

624
00:24:08,080 --> 00:24:10,880
the median revenue of the victims of

625
00:24:10,880 --> 00:24:14,880
water rock is almost 900 million dollars

626
00:24:14,880 --> 00:24:15,679
and

627
00:24:15,679 --> 00:24:19,679
for a lot of the other ransomware actors

628
00:24:19,679 --> 00:24:22,960
the median revenue is much lower

629
00:24:22,960 --> 00:24:24,240
basically

630
00:24:24,240 --> 00:24:26,960
their victims is a mixed bag of

631
00:24:26,960 --> 00:24:29,919
companies of different sizes and with

632
00:24:29,919 --> 00:24:31,600
different

633
00:24:31,600 --> 00:24:32,880
revenues

634
00:24:32,880 --> 00:24:36,159
about all of the

635
00:24:36,159 --> 00:24:38,720
ransomware as a service groups say that

636
00:24:38,720 --> 00:24:40,400
they will

637
00:24:40,400 --> 00:24:43,760
keep online the stolen data for months

638
00:24:43,760 --> 00:24:47,120
but it appears that some of the

639
00:24:47,120 --> 00:24:48,960
more infamous

640
00:24:48,960 --> 00:24:51,520
rensover as a service groups

641
00:24:51,520 --> 00:24:54,320
are not able to keep their data online

642
00:24:54,320 --> 00:24:56,480
for a long time

643
00:24:56,480 --> 00:24:58,720
because they are hosting

644
00:24:58,720 --> 00:24:59,520
their

645
00:24:59,520 --> 00:25:03,120
stolen data on file sharing platforms

646
00:25:03,120 --> 00:25:05,520
that are usually quite fast in taking

647
00:25:05,520 --> 00:25:06,559
down

648
00:25:06,559 --> 00:25:08,320
the stolen

649
00:25:08,320 --> 00:25:10,159
contents

650
00:25:10,159 --> 00:25:12,799
we have seen that these ransomware as a

651
00:25:12,799 --> 00:25:15,039
service groups

652
00:25:15,039 --> 00:25:18,400
do not update their own website with new

653
00:25:18,400 --> 00:25:20,480
links for example that links are not

654
00:25:20,480 --> 00:25:23,760
removed nephilim however

655
00:25:23,760 --> 00:25:25,919
so the water rock actor

656
00:25:25,919 --> 00:25:28,720
is keeping online

657
00:25:28,720 --> 00:25:31,840
victim data for a long time and they

658
00:25:31,840 --> 00:25:34,080
have no issue

659
00:25:34,080 --> 00:25:36,559
hosting their contents on their tor

660
00:25:36,559 --> 00:25:38,080
hidden server

661
00:25:38,080 --> 00:25:39,919
of course

662
00:25:39,919 --> 00:25:40,880
the

663
00:25:40,880 --> 00:25:43,679
usage of store hidden servers

664
00:25:43,679 --> 00:25:46,640
has its negative size for example

665
00:25:46,640 --> 00:25:50,400
it takes a long time to download huge

666
00:25:50,400 --> 00:25:53,760
archives with stolen data it might take

667
00:25:53,760 --> 00:25:58,320
days before you have the complete file

668
00:25:58,320 --> 00:26:00,080
while ransomware attacks have an

669
00:26:00,080 --> 00:26:02,000
enormous impact on victimized

670
00:26:02,000 --> 00:26:03,520
corporations

671
00:26:03,520 --> 00:26:06,320
both in monetary losses and reputational

672
00:26:06,320 --> 00:26:07,440
damage

673
00:26:07,440 --> 00:26:09,440
there are good opportunities

674
00:26:09,440 --> 00:26:12,720
to defend and to fight back

675
00:26:12,720 --> 00:26:15,039
the threshold for attackers can be made

676
00:26:15,039 --> 00:26:17,360
significantly higher and there are some

677
00:26:17,360 --> 00:26:20,159
points where

678
00:26:20,159 --> 00:26:22,559
researchers or law enforcement can start

679
00:26:22,559 --> 00:26:24,400
an investigation

680
00:26:24,400 --> 00:26:26,400
for defenders there are at least three

681
00:26:26,400 --> 00:26:28,960
points where alarm bells could ring for

682
00:26:28,960 --> 00:26:31,440
a upcoming ransomware attack

683
00:26:31,440 --> 00:26:33,840
first is the reconnaissance and

684
00:26:33,840 --> 00:26:36,559
exploitation phase where an attacker

685
00:26:36,559 --> 00:26:39,200
attempts to get access to the target

686
00:26:39,200 --> 00:26:40,400
network

687
00:26:40,400 --> 00:26:43,279
these attacks can be stopped

688
00:26:43,279 --> 00:26:46,080
by a intrusion prevention system an ips

689
00:26:46,080 --> 00:26:47,440
system

690
00:26:47,440 --> 00:26:50,080
an ips system can shield a potentially

691
00:26:50,080 --> 00:26:53,919
vulnerable system by using filters to

692
00:26:53,919 --> 00:26:56,640
prevent exports to be used against that

693
00:26:56,640 --> 00:26:58,960
network or system

694
00:26:58,960 --> 00:27:02,159
an ips system can also provide virtual

695
00:27:02,159 --> 00:27:04,000
patching

696
00:27:04,000 --> 00:27:06,080
that is particularly important when a

697
00:27:06,080 --> 00:27:08,400
patch is not available and ransomware

698
00:27:08,400 --> 00:27:11,440
actors are known to be quite fast

699
00:27:11,440 --> 00:27:13,360
in using newly discovered

700
00:27:13,360 --> 00:27:15,520
vulnerabilities

701
00:27:15,520 --> 00:27:17,840
second is the phase

702
00:27:17,840 --> 00:27:20,159
when the attacker did succeed in getting

703
00:27:20,159 --> 00:27:23,200
access to the target network

704
00:27:23,200 --> 00:27:26,159
ransomware attackers often use a tool

705
00:27:26,159 --> 00:27:28,240
called cobalt

706
00:27:28,240 --> 00:27:30,640
strike

707
00:27:30,720 --> 00:27:33,440
for the phase of a

708
00:27:33,440 --> 00:27:35,679
lateral movement

709
00:27:35,679 --> 00:27:39,760
faux cobalt strike is designed for red

710
00:27:39,760 --> 00:27:42,080
teams and

711
00:27:42,080 --> 00:27:44,159
penetration testers ransomware actors

712
00:27:44,159 --> 00:27:45,760
are using it too

713
00:27:45,760 --> 00:27:48,480
but in practice we see that ransomware

714
00:27:48,480 --> 00:27:51,039
actors are not using this tool to the

715
00:27:51,039 --> 00:27:53,760
fullest extent they are not using all

716
00:27:53,760 --> 00:27:55,840
the evasion techniques that are

717
00:27:55,840 --> 00:27:57,039
available

718
00:27:57,039 --> 00:28:00,720
so a defender can potentially detect a

719
00:28:00,720 --> 00:28:03,200
cobalt strike in a network

720
00:28:03,200 --> 00:28:04,720
and

721
00:28:04,720 --> 00:28:07,360
use something simple as a block list of

722
00:28:07,360 --> 00:28:08,399
known

723
00:28:08,399 --> 00:28:11,360
ip addresses known c c i p

724
00:28:11,360 --> 00:28:12,720
addresses

725
00:28:12,720 --> 00:28:16,320
whenever a defender detects a cobalt

726
00:28:16,320 --> 00:28:19,760
strike in a network he has a small

727
00:28:19,760 --> 00:28:21,520
window to

728
00:28:21,520 --> 00:28:23,840
fight back to fight back against the

729
00:28:23,840 --> 00:28:25,840
ransomware actor that window could be

730
00:28:25,840 --> 00:28:27,679
just a few minutes

731
00:28:27,679 --> 00:28:29,520
could be a few hours it could be a few

732
00:28:29,520 --> 00:28:31,919
days but there is the opportunity to

733
00:28:31,919 --> 00:28:33,919
fight back

734
00:28:33,919 --> 00:28:36,640
then there's the data exfiltration phase

735
00:28:36,640 --> 00:28:38,880
for double extortion

736
00:28:38,880 --> 00:28:40,960
most ransomware attackers

737
00:28:40,960 --> 00:28:43,919
will try to find sensitive data in a

738
00:28:43,919 --> 00:28:46,559
victimized corporation network

739
00:28:46,559 --> 00:28:47,440
and

740
00:28:47,440 --> 00:28:51,200
they will try to exfoliate the data that

741
00:28:51,200 --> 00:28:53,679
expectation of data can be detected as

742
00:28:53,679 --> 00:28:57,120
well in a network

743
00:28:57,120 --> 00:28:58,720
when

744
00:28:58,720 --> 00:29:00,399
none of these

745
00:29:00,399 --> 00:29:02,640
warning signs were picked up and the

746
00:29:02,640 --> 00:29:04,720
attacker was able

747
00:29:04,720 --> 00:29:08,159
to load ransomware binaries onto the

748
00:29:08,159 --> 00:29:10,159
victimized system

749
00:29:10,159 --> 00:29:11,360
then

750
00:29:11,360 --> 00:29:13,360
well you would say it's too late but

751
00:29:13,360 --> 00:29:15,919
actually there are still some points

752
00:29:15,919 --> 00:29:16,799
where

753
00:29:16,799 --> 00:29:18,799
corporations law enforcement and

754
00:29:18,799 --> 00:29:21,840
researchers can fight back

755
00:29:21,840 --> 00:29:24,000
for example in the double extortion

756
00:29:24,000 --> 00:29:26,480
phase where a ransomware

757
00:29:26,480 --> 00:29:28,880
actor is

758
00:29:28,880 --> 00:29:31,679
making public some of the stolen data of

759
00:29:31,679 --> 00:29:32,960
a victim

760
00:29:32,960 --> 00:29:35,679
he can make mistakes opsec mistakes for

761
00:29:35,679 --> 00:29:36,880
example

762
00:29:36,880 --> 00:29:38,960
by uploading it to a third party he

763
00:29:38,960 --> 00:29:42,000
might use a ip address that shouldn't be

764
00:29:42,000 --> 00:29:44,080
in the hands of law enforcement

765
00:29:44,080 --> 00:29:47,120
or when he is uploading it to his own

766
00:29:47,120 --> 00:29:49,840
ransomware as a service website

767
00:29:49,840 --> 00:29:52,720
he might have made mistakes in setting

768
00:29:52,720 --> 00:29:55,039
up a tor hidden server

769
00:29:55,039 --> 00:29:58,480
more than once we were able to determine

770
00:29:58,480 --> 00:30:01,360
the real ip address of the tor hidden

771
00:30:01,360 --> 00:30:03,919
surfer of a ransomware actor and that

772
00:30:03,919 --> 00:30:05,760
includes water rock

773
00:30:05,760 --> 00:30:08,480
i can explain this a bit further in the

774
00:30:08,480 --> 00:30:10,880
following table

775
00:30:10,880 --> 00:30:13,039
in this table you will see some ip

776
00:30:13,039 --> 00:30:15,200
addresses that are involved

777
00:30:15,200 --> 00:30:18,799
the bold ip addresses were

778
00:30:18,799 --> 00:30:21,679
confirmed to be related to water rock

779
00:30:21,679 --> 00:30:23,919
for example we found a few

780
00:30:23,919 --> 00:30:25,200
cobalt

781
00:30:25,200 --> 00:30:28,240
strike cnc servers related to water rock

782
00:30:28,240 --> 00:30:30,799
but they also found the back end servers

783
00:30:30,799 --> 00:30:33,279
of their

784
00:30:33,279 --> 00:30:35,520
rent server as a service website where

785
00:30:35,520 --> 00:30:38,480
they put stolen data

786
00:30:38,480 --> 00:30:40,320
when we were looking in a neighborhood

787
00:30:40,320 --> 00:30:42,640
of these ip addresses we found many

788
00:30:42,640 --> 00:30:45,919
other ips's that could have been used in

789
00:30:45,919 --> 00:30:48,080
other phases of the ransomware attack

790
00:30:48,080 --> 00:30:51,440
for example the exploitation phase

791
00:30:51,440 --> 00:30:54,720
uh the uh reconnaissance phase but also

792
00:30:54,720 --> 00:30:57,120
in the data exfiltration phase

793
00:30:57,120 --> 00:30:58,640
we are not

794
00:30:58,640 --> 00:31:01,200
uh 100

795
00:31:01,200 --> 00:31:03,360
percent sure that these appearances were

796
00:31:03,360 --> 00:31:06,720
actually being used by water rock but

797
00:31:06,720 --> 00:31:09,600
these ipads so this ip range is

798
00:31:09,600 --> 00:31:12,240
definitely a good starting point

799
00:31:12,240 --> 00:31:14,960
for researchers and law enforcement to

800
00:31:14,960 --> 00:31:16,000
get

801
00:31:16,000 --> 00:31:18,880
to know the actors better to

802
00:31:18,880 --> 00:31:20,640
know more details about the actual

803
00:31:20,640 --> 00:31:22,240
actors

804
00:31:22,240 --> 00:31:23,360
then

805
00:31:23,360 --> 00:31:25,679
there's still a opportunity to fight

806
00:31:25,679 --> 00:31:28,320
back and that is the almost the last

807
00:31:28,320 --> 00:31:30,559
phase i would say that is the money

808
00:31:30,559 --> 00:31:33,600
laundering phase whenever a victim

809
00:31:33,600 --> 00:31:36,720
pays a ransom to the rent survey actor

810
00:31:36,720 --> 00:31:38,799
the ransomware act will usually receive

811
00:31:38,799 --> 00:31:41,120
that ransom in bitcoins

812
00:31:41,120 --> 00:31:45,360
but those bitcoins somehow have to be

813
00:31:45,360 --> 00:31:48,480
laundered into real money because the

814
00:31:48,480 --> 00:31:51,679
the actor wants real money in his pocket

815
00:31:51,679 --> 00:31:54,240
then he can make mistakes as well

816
00:31:54,240 --> 00:31:56,320
in the money laundering phase and that

817
00:31:56,320 --> 00:31:59,440
is evidenced by a recent case where the

818
00:31:59,440 --> 00:32:02,399
fbi was able to cease a significant

819
00:32:02,399 --> 00:32:05,200
amount of the ransom that was paid by a

820
00:32:05,200 --> 00:32:07,519
large u.s

821
00:32:07,519 --> 00:32:08,880
company to

822
00:32:08,880 --> 00:32:11,360
a ransomware actor the fbi was able to

823
00:32:11,360 --> 00:32:13,440
seize some of the money that was

824
00:32:13,440 --> 00:32:15,440
actually paid

825
00:32:15,440 --> 00:32:17,919
um so this concludes our presentation

826
00:32:17,919 --> 00:32:19,519
about water rock

827
00:32:19,519 --> 00:32:21,519
i hope you enjoyed it and that you

828
00:32:21,519 --> 00:32:24,480
learned something new water rock is a

829
00:32:24,480 --> 00:32:26,080
clear example

830
00:32:26,080 --> 00:32:27,360
of a

831
00:32:27,360 --> 00:32:30,080
ransomware actor that was not very good

832
00:32:30,080 --> 00:32:32,640
at its job a few years ago

833
00:32:32,640 --> 00:32:35,440
but it has um

834
00:32:35,440 --> 00:32:39,200
evolved into a well one of the most

835
00:32:39,200 --> 00:32:42,480
relentless and ransomware actors

836
00:32:42,480 --> 00:32:44,720
that is active

837
00:32:44,720 --> 00:32:47,279
today and it is actually

838
00:32:47,279 --> 00:32:49,840
attacking multi-billion companies

839
00:32:49,840 --> 00:32:52,399
nowadays if you want to learn more you

840
00:32:52,399 --> 00:32:54,640
can read our paper we have published on

841
00:32:54,640 --> 00:32:56,880
our own website but we also have a

842
00:32:56,880 --> 00:32:59,679
shorter paper with a bit

843
00:32:59,679 --> 00:33:02,559
of new details on the website of

844
00:33:02,559 --> 00:33:04,720
firespirit10 thank you very much and

845
00:33:04,720 --> 00:33:08,440
thank you for your time

846
00:33:11,960 --> 00:33:15,039
[Music]

847
00:33:15,039 --> 00:33:17,120
you

