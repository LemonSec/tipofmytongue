1
00:00:02,640 --> 00:00:05,819
[Music]

2
00:00:08,639 --> 00:00:10,000
hello all

3
00:00:10,000 --> 00:00:12,960
i'm ben right next to me is gil

4
00:00:12,960 --> 00:00:15,040
and we're here to tell you about pay to

5
00:00:15,040 --> 00:00:17,760
key the newly discovered runs of request

6
00:00:17,760 --> 00:00:20,160
all the way to iran conveniently also

7
00:00:20,160 --> 00:00:22,080
spelled out for you in this opening

8
00:00:22,080 --> 00:00:23,439
slide

9
00:00:23,439 --> 00:00:25,680
well before i say anything

10
00:00:25,680 --> 00:00:28,160
i have to ask the following question

11
00:00:28,160 --> 00:00:30,000
which is why would you want to hear it

12
00:00:30,000 --> 00:00:32,558
talk about a ransomware at all we're

13
00:00:32,558 --> 00:00:35,200
drowning in ransomware there's our evil

14
00:00:35,200 --> 00:00:38,719
conti doppel payment maze mespinosa i

15
00:00:38,719 --> 00:00:41,120
could stand here and read out loud names

16
00:00:41,120 --> 00:00:44,480
of ransomware strains all day

17
00:00:44,480 --> 00:00:46,079
but

18
00:00:46,079 --> 00:00:48,640
after all we did decide that this talk

19
00:00:48,640 --> 00:00:50,640
would be worthwhile

20
00:00:50,640 --> 00:00:53,360
and the reason is every piece of malware

21
00:00:53,360 --> 00:00:54,719
no matter how

22
00:00:54,719 --> 00:00:57,039
pedestrian at first sight has something

23
00:00:57,039 --> 00:00:59,520
new to tell us and in this case if

24
00:00:59,520 --> 00:01:01,600
you're listening to this talk you ought

25
00:01:01,600 --> 00:01:04,479
to be interested in two aspects

26
00:01:04,479 --> 00:01:07,200
of the ransomware the first of which is

27
00:01:07,200 --> 00:01:09,439
if there is anything technically

28
00:01:09,439 --> 00:01:11,760
interesting about it anything it does

29
00:01:11,760 --> 00:01:14,799
differently from the usual ransomware

30
00:01:14,799 --> 00:01:17,840
and the second is if there are any juicy

31
00:01:17,840 --> 00:01:20,400
or interesting details surrounding the

32
00:01:20,400 --> 00:01:21,439
attack

33
00:01:21,439 --> 00:01:25,119
attack the who the why the how

34
00:01:25,119 --> 00:01:26,479
so

35
00:01:26,479 --> 00:01:28,400
and broadly speaking

36
00:01:28,400 --> 00:01:30,560
i'm going to tell you about the first

37
00:01:30,560 --> 00:01:32,479
part the technical part because that's

38
00:01:32,479 --> 00:01:34,960
my job looking at assembly all day and

39
00:01:34,960 --> 00:01:36,479
gil will later tell you about the

40
00:01:36,479 --> 00:01:38,320
actually interesting part the all the

41
00:01:38,320 --> 00:01:40,479
juicy details surrounding the

42
00:01:40,479 --> 00:01:42,159
attack story

43
00:01:42,159 --> 00:01:45,200
and where should i begin telling the

44
00:01:45,200 --> 00:01:47,040
story of pedophilia well i should begin

45
00:01:47,040 --> 00:01:49,840
at the beginning it was a nice day

46
00:01:49,840 --> 00:01:52,399
during late 2020 we were all drinking

47
00:01:52,399 --> 00:01:55,119
our cocktails and suddenly we

48
00:01:55,119 --> 00:01:57,439
were horrified to learn that there's

49
00:01:57,439 --> 00:01:59,119
been an attack and multiple israeli

50
00:01:59,119 --> 00:02:02,000
companies were compromised and

51
00:02:02,000 --> 00:02:04,320
getting hit with ransomware you have

52
00:02:04,320 --> 00:02:07,200
heard of before is bad enough but

53
00:02:07,200 --> 00:02:09,038
getting hit with ransomware you haven't

54
00:02:09,038 --> 00:02:12,239
heard of before is somehow adding insult

55
00:02:12,239 --> 00:02:13,920
to injury you don't even know who these

56
00:02:13,920 --> 00:02:15,280
guys are

57
00:02:15,280 --> 00:02:17,520
we could only speculate when we stepped

58
00:02:17,520 --> 00:02:20,640
into this incident what their motive was

59
00:02:20,640 --> 00:02:22,319
usually ransomware is financially

60
00:02:22,319 --> 00:02:24,319
motivated but still we could only

61
00:02:24,319 --> 00:02:25,760
speculate

62
00:02:25,760 --> 00:02:29,680
and before i get into the technical

63
00:02:29,680 --> 00:02:32,560
details that were interesting about this

64
00:02:32,560 --> 00:02:34,800
specific malware i would just like to

65
00:02:34,800 --> 00:02:38,080
say that i think i will remember it as

66
00:02:38,080 --> 00:02:40,480
the milestone it was during the rise to

67
00:02:40,480 --> 00:02:42,720
prominence of double extortion

68
00:02:42,720 --> 00:02:44,720
you heard of double extortion it used to

69
00:02:44,720 --> 00:02:46,800
be that attackers were threatened

70
00:02:46,800 --> 00:02:48,560
victims with their data being lost

71
00:02:48,560 --> 00:02:50,640
forever but then we all discovered

72
00:02:50,640 --> 00:02:51,760
backups

73
00:02:51,760 --> 00:02:54,640
and now what attackers do is threaten

74
00:02:54,640 --> 00:02:56,480
victims with their data being shared

75
00:02:56,480 --> 00:02:59,120
with the public with competitors with

76
00:02:59,120 --> 00:03:00,640
the highest bidder

77
00:03:00,640 --> 00:03:03,519
and this is a much easier threat

78
00:03:03,519 --> 00:03:05,519
because your backups are not going to

79
00:03:05,519 --> 00:03:06,879
save you anymore

80
00:03:06,879 --> 00:03:08,720
really if you're looking for a solution

81
00:03:08,720 --> 00:03:10,400
to double extortion then it's pretty

82
00:03:10,400 --> 00:03:13,040
simple don't have secrets and don't get

83
00:03:13,040 --> 00:03:14,159
hacked

84
00:03:14,159 --> 00:03:14,879
so

85
00:03:14,879 --> 00:03:16,720
now that we have that sorted out i mean

86
00:03:16,720 --> 00:03:19,760
seriously this is a major inflection

87
00:03:19,760 --> 00:03:22,879
point in the evolution of ransomware

88
00:03:22,879 --> 00:03:25,200
you can divide ransomware into before

89
00:03:25,200 --> 00:03:27,280
double extortion and after double

90
00:03:27,280 --> 00:03:29,440
extortion the earliest known instance of

91
00:03:29,440 --> 00:03:33,200
double extortion was laid in 2019

92
00:03:33,200 --> 00:03:36,000
by the maze ransomware gang it was a

93
00:03:36,000 --> 00:03:38,959
whole big deal you can go look it up

94
00:03:38,959 --> 00:03:40,319
if you'd like

95
00:03:40,319 --> 00:03:41,599
and

96
00:03:41,599 --> 00:03:43,200
since then

97
00:03:43,200 --> 00:03:45,519
from then until

98
00:03:45,519 --> 00:03:47,840
late 2020 when these beta key incidents

99
00:03:47,840 --> 00:03:48,720
happened

100
00:03:48,720 --> 00:03:51,760
there was like some kind of a slow drip

101
00:03:51,760 --> 00:03:53,680
of more and more double extortion and

102
00:03:53,680 --> 00:03:56,400
the pay-to-key attacks were a milestone

103
00:03:56,400 --> 00:03:58,159
during that entire period where we

104
00:03:58,159 --> 00:04:00,319
started to internalize the fact that

105
00:04:00,319 --> 00:04:01,920
this is the future this is where

106
00:04:01,920 --> 00:04:03,840
ransomware is going

107
00:04:03,840 --> 00:04:05,519
so

108
00:04:05,519 --> 00:04:07,439
if i had to name one

109
00:04:07,439 --> 00:04:09,200
aspect where

110
00:04:09,200 --> 00:04:11,360
he was technically important then

111
00:04:11,360 --> 00:04:13,439
this would certainly make the top of the

112
00:04:13,439 --> 00:04:14,480
list

113
00:04:14,480 --> 00:04:15,360
but

114
00:04:15,360 --> 00:04:16,959
it would not constitute of course the

115
00:04:16,959 --> 00:04:18,639
entire list or the

116
00:04:18,639 --> 00:04:20,798
wouldn't be a talk

117
00:04:20,798 --> 00:04:23,680
so what is technically interesting about

118
00:04:23,680 --> 00:04:25,120
this ransomware

119
00:04:25,120 --> 00:04:26,720
broadly speaking

120
00:04:26,720 --> 00:04:29,120
the answer is divided into three parts

121
00:04:29,120 --> 00:04:30,639
the first is

122
00:04:30,639 --> 00:04:32,479
five reads and rights where there should

123
00:04:32,479 --> 00:04:35,199
not be five reads and rights the second

124
00:04:35,199 --> 00:04:37,520
is cnc communication where there should

125
00:04:37,520 --> 00:04:40,160
not be studency communication and the

126
00:04:40,160 --> 00:04:42,160
third is interesting and creative

127
00:04:42,160 --> 00:04:44,320
choices when implementing cryptography

128
00:04:44,320 --> 00:04:46,880
which is personally my favorite category

129
00:04:46,880 --> 00:04:49,120
so since we don't have much time let's

130
00:04:49,120 --> 00:04:51,199
dive into the first category which is

131
00:04:51,199 --> 00:04:53,040
fire reads and rights where there should

132
00:04:53,040 --> 00:04:56,400
not be five reads and rights

133
00:04:56,400 --> 00:04:58,400
this ransomware this is a very

134
00:04:58,400 --> 00:05:00,400
interesting fact about it it does not

135
00:05:00,400 --> 00:05:01,199
run

136
00:05:01,199 --> 00:05:02,560
if you double click it it will do

137
00:05:02,560 --> 00:05:04,000
nothing because it is looking for a

138
00:05:04,000 --> 00:05:05,600
configuration file

139
00:05:05,600 --> 00:05:07,360
called config.ini and if the

140
00:05:07,360 --> 00:05:09,280
configuration is not there or is not

141
00:05:09,280 --> 00:05:11,440
formed or i don't know what the malware

142
00:05:11,440 --> 00:05:14,000
will not run now this is weird because

143
00:05:14,000 --> 00:05:16,160
it makes things more complicated now

144
00:05:16,160 --> 00:05:17,680
suddenly because you need this whole

145
00:05:17,680 --> 00:05:19,680
environment for the malware to run half

146
00:05:19,680 --> 00:05:21,919
your favorite

147
00:05:21,919 --> 00:05:24,160
malicious tools like downloaders and

148
00:05:24,160 --> 00:05:26,320
exploit kits and i don't know what

149
00:05:26,320 --> 00:05:28,160
will not work out of the box and this is

150
00:05:28,160 --> 00:05:29,759
a shame for this guy you know subway

151
00:05:29,759 --> 00:05:32,080
criminals they like nothing more than to

152
00:05:32,080 --> 00:05:34,000
copy paste and forget

153
00:05:34,000 --> 00:05:36,479
but it also leaves hints around for

154
00:05:36,479 --> 00:05:38,400
incident response teams and the like and

155
00:05:38,400 --> 00:05:41,280
it just goes generally against all

156
00:05:41,280 --> 00:05:43,360
common folk wisdom of

157
00:05:43,360 --> 00:05:44,720
threat acting

158
00:05:44,720 --> 00:05:46,720
in the modern day and age because

159
00:05:46,720 --> 00:05:49,120
nowadays every malware almost every

160
00:05:49,120 --> 00:05:51,520
malware the configuration is encrypted

161
00:05:51,520 --> 00:05:53,759
and obfuscated in a really nasty and

162
00:05:53,759 --> 00:05:56,080
time-consuming way but these guys they

163
00:05:56,080 --> 00:05:58,080
just put it in a separate file in plain

164
00:05:58,080 --> 00:06:00,800
text right they they are either mad men

165
00:06:00,800 --> 00:06:03,280
or geniuses there is really no in

166
00:06:03,280 --> 00:06:04,560
between

167
00:06:04,560 --> 00:06:05,759
and

168
00:06:05,759 --> 00:06:09,120
if you want an argument in favor of the

169
00:06:09,120 --> 00:06:11,520
geniuses hypothesis take a look at this

170
00:06:11,520 --> 00:06:13,919
screenshot where which we obtained when

171
00:06:13,919 --> 00:06:14,639
we

172
00:06:14,639 --> 00:06:17,039
uploaded a pay-to-key sample first to

173
00:06:17,039 --> 00:06:20,240
virustotal no detections

174
00:06:20,240 --> 00:06:22,000
one detection right

175
00:06:22,000 --> 00:06:24,400
probably by an engine that just reports

176
00:06:24,400 --> 00:06:26,160
everything is positive

177
00:06:26,160 --> 00:06:27,680
and then it never has any false

178
00:06:27,680 --> 00:06:28,880
negatives

179
00:06:28,880 --> 00:06:31,039
great technical achievements so

180
00:06:31,039 --> 00:06:33,919
no detections and you're asking yourself

181
00:06:33,919 --> 00:06:36,240
why are there no detections but that's

182
00:06:36,240 --> 00:06:37,759
the wrong question you should be asking

183
00:06:37,759 --> 00:06:39,280
yourself why would there be any

184
00:06:39,280 --> 00:06:41,039
detections and where do you get

185
00:06:41,039 --> 00:06:43,759
detections what are your main tools uh

186
00:06:43,759 --> 00:06:46,960
in a security solution the sandbox and

187
00:06:46,960 --> 00:06:49,120
static signatures based on yara rules

188
00:06:49,120 --> 00:06:52,160
and regular expressions and whatnot but

189
00:06:52,160 --> 00:06:54,000
the file is not going to run inside the

190
00:06:54,000 --> 00:06:55,759
sandbox the sandbox is going to take the

191
00:06:55,759 --> 00:06:58,800
file isolated from it it's expected

192
00:06:58,800 --> 00:07:00,800
environment the configuration file just

193
00:07:00,800 --> 00:07:02,639
run it and there's going to be no

194
00:07:02,639 --> 00:07:04,400
behavior the model is not going to run

195
00:07:04,400 --> 00:07:06,800
so that you won't get the detection now

196
00:07:06,800 --> 00:07:09,599
you're left with only static signatures

197
00:07:09,599 --> 00:07:12,160
like it's 1998

198
00:07:12,160 --> 00:07:14,720
but you know this is a new strain of

199
00:07:14,720 --> 00:07:16,720
ransomware at least back then it was so

200
00:07:16,720 --> 00:07:18,080
of course there were no static

201
00:07:18,080 --> 00:07:20,800
signatures and so the answer to the

202
00:07:20,800 --> 00:07:22,960
question where are you going to get

203
00:07:22,960 --> 00:07:24,639
detections for this

204
00:07:24,639 --> 00:07:26,560
both in theory and in practice the

205
00:07:26,560 --> 00:07:28,880
answer appears to be from nowhere

206
00:07:28,880 --> 00:07:31,599
so by mistake or not these guys stumbled

207
00:07:31,599 --> 00:07:34,080
onto what could and when we find become

208
00:07:34,080 --> 00:07:36,560
a really really nasty trick of bypassing

209
00:07:36,560 --> 00:07:37,759
sandboxes

210
00:07:37,759 --> 00:07:39,919
and i'll just put it in the very large

211
00:07:39,919 --> 00:07:40,720
bin

212
00:07:40,720 --> 00:07:43,039
of stuff that i've run across in malware

213
00:07:43,039 --> 00:07:45,360
and then sat down and silently prayed i

214
00:07:45,360 --> 00:07:47,759
hope this doesn't catch on

215
00:07:47,759 --> 00:07:49,199
well

216
00:07:49,199 --> 00:07:51,360
in the department of writing to files

217
00:07:51,360 --> 00:07:53,759
and reading from files were not strictly

218
00:07:53,759 --> 00:07:56,240
necessary these guys also had their

219
00:07:56,240 --> 00:07:58,400
ransomware write everything it does to a

220
00:07:58,400 --> 00:08:00,720
nice plain text log at this point this

221
00:08:00,720 --> 00:08:02,720
is no surprise you know the victims can

222
00:08:02,720 --> 00:08:04,879
just sit down and read in a convenient

223
00:08:04,879 --> 00:08:07,280
plain text how screwed they were

224
00:08:07,280 --> 00:08:09,840
this was a work in progress some earlier

225
00:08:09,840 --> 00:08:12,000
versions had stubs and declared

226
00:08:12,000 --> 00:08:14,080
functionality that was only implemented

227
00:08:14,080 --> 00:08:16,479
later this is not unheard of we've seen

228
00:08:16,479 --> 00:08:18,720
it in a much more intensive way

229
00:08:18,720 --> 00:08:21,680
in for example gun crop but it's still

230
00:08:21,680 --> 00:08:24,400
interesting a lot of ransomware is just

231
00:08:24,400 --> 00:08:27,520
right once and keep infecting people

232
00:08:27,520 --> 00:08:30,319
later without any further updates so

233
00:08:30,319 --> 00:08:32,719
it's nice that they kept putting work

234
00:08:32,719 --> 00:08:35,599
into it it shows they occurred

235
00:08:35,599 --> 00:08:38,240
this malware and this is the second

236
00:08:38,240 --> 00:08:41,039
category i mentioned earlier it

237
00:08:41,039 --> 00:08:44,000
communicates with a c2 server now

238
00:08:44,000 --> 00:08:45,760
usually for a lot

239
00:08:45,760 --> 00:08:47,920
of types of malware this is standard but

240
00:08:47,920 --> 00:08:49,600
for ransomware it's not strictly

241
00:08:49,600 --> 00:08:52,320
necessary this is not crypto 101 it's

242
00:08:52,320 --> 00:08:54,800
not introduction to public cryptography

243
00:08:54,800 --> 00:08:57,680
so i'm not going to explain in full why

244
00:08:57,680 --> 00:09:00,399
exactly it's not necessary i'll just say

245
00:09:00,399 --> 00:09:02,480
that you can have a perfectly working

246
00:09:02,480 --> 00:09:04,560
ransomware operation by just taking an

247
00:09:04,560 --> 00:09:07,200
rsa public key and embedding it in

248
00:09:07,200 --> 00:09:10,320
embedding it in the executable you use

249
00:09:10,320 --> 00:09:12,959
to infect your victims so if you have a

250
00:09:12,959 --> 00:09:15,680
c2 server up and running it's probably

251
00:09:15,680 --> 00:09:18,320
it should be due to curiosity

252
00:09:18,320 --> 00:09:20,959
these guys they actually

253
00:09:20,959 --> 00:09:23,360
when the ransomware runs it asks the

254
00:09:23,360 --> 00:09:26,080
secret server for a public key for an

255
00:09:26,080 --> 00:09:28,080
hour say publicly and i'll touch later

256
00:09:28,080 --> 00:09:31,519
on why what's so strange about that

257
00:09:31,519 --> 00:09:33,120
apart from the fact that it's not

258
00:09:33,120 --> 00:09:34,240
necessary

259
00:09:34,240 --> 00:09:35,360
at all

260
00:09:35,360 --> 00:09:36,720
so

261
00:09:36,720 --> 00:09:39,440
and now that they have cnc communication

262
00:09:39,440 --> 00:09:41,519
which they didn't have to do they are of

263
00:09:41,519 --> 00:09:43,279
course they are worried about the

264
00:09:43,279 --> 00:09:46,720
communication being intercepted so they

265
00:09:46,720 --> 00:09:48,399
use this trick which you see on screen

266
00:09:48,399 --> 00:09:50,640
and really the less said about this the

267
00:09:50,640 --> 00:09:53,519
better it communicates using

268
00:09:53,519 --> 00:09:55,760
a non-standard hard-coded port which is

269
00:09:55,760 --> 00:09:58,000
there in the plaintext configuration

270
00:09:58,000 --> 00:10:00,399
maybe even they felt sort of weird about

271
00:10:00,399 --> 00:10:03,279
that so they arranged for an additional

272
00:10:03,279 --> 00:10:06,240
nice and nifty trick where if you go to

273
00:10:06,240 --> 00:10:08,160
an infected machine double click the

274
00:10:08,160 --> 00:10:10,640
plain text configuration and look for

275
00:10:10,640 --> 00:10:13,360
the c2 server id address actually

276
00:10:13,360 --> 00:10:16,079
chances are you'll find an ip address of

277
00:10:16,079 --> 00:10:18,320
one of the of the infected machines

278
00:10:18,320 --> 00:10:20,720
inside the network

279
00:10:20,720 --> 00:10:23,040
which is you know strange it's like one

280
00:10:23,040 --> 00:10:24,079
of

281
00:10:24,079 --> 00:10:26,240
those horror movie cliches the calls are

282
00:10:26,240 --> 00:10:28,640
coming from inside the house how is the

283
00:10:28,640 --> 00:10:31,760
c2 server inside the network actually

284
00:10:31,760 --> 00:10:34,560
what happens is that they designate one

285
00:10:34,560 --> 00:10:37,040
of the infected machines as a proxy

286
00:10:37,040 --> 00:10:39,440
server and then all the other machines

287
00:10:39,440 --> 00:10:42,399
have that ip address of the

288
00:10:42,399 --> 00:10:46,000
designated machine as their c2 server

289
00:10:46,000 --> 00:10:46,920
address they

290
00:10:46,920 --> 00:10:48,079
[Music]

291
00:10:48,079 --> 00:10:50,399
communicate with it and it communicates

292
00:10:50,399 --> 00:10:53,040
with the cpu server on their behalf so

293
00:10:53,040 --> 00:10:54,800
now it's a two-step process you want to

294
00:10:54,800 --> 00:10:57,440
see the c2ip you open the config you

295
00:10:57,440 --> 00:10:59,519
find the ip address of the designated

296
00:10:59,519 --> 00:11:01,839
proxy then you find that physical

297
00:11:01,839 --> 00:11:03,680
machine and you double click the config

298
00:11:03,680 --> 00:11:04,560
there

299
00:11:04,560 --> 00:11:07,200
and now you have the c2 address was it

300
00:11:07,200 --> 00:11:09,839
worth it well you'd be surprised

301
00:11:09,839 --> 00:11:12,720
hurling inconveniences at people

302
00:11:12,720 --> 00:11:15,839
often works when in theory it shouldn't

303
00:11:15,839 --> 00:11:16,959
and

304
00:11:16,959 --> 00:11:19,279
okay these guys their attack went

305
00:11:19,279 --> 00:11:21,360
phenomenally well so we can't argue with

306
00:11:21,360 --> 00:11:22,720
success

307
00:11:22,720 --> 00:11:25,279
what can this ransomware do

308
00:11:25,279 --> 00:11:27,440
a lot of stuff a lot of stuff most of

309
00:11:27,440 --> 00:11:29,440
which is standard by the way i'm going

310
00:11:29,440 --> 00:11:32,240
to touch on the non-standardness of some

311
00:11:32,240 --> 00:11:34,240
of it in a moment

312
00:11:34,240 --> 00:11:35,360
uh

313
00:11:35,360 --> 00:11:37,440
one of the things i mentioned earlier is

314
00:11:37,440 --> 00:11:40,000
receiving an rsa public key from the cnc

315
00:11:40,000 --> 00:11:42,480
server which is mighty strange if you're

316
00:11:42,480 --> 00:11:44,480
doing it in order to use the key to

317
00:11:44,480 --> 00:11:47,360
encrypt files i or like i already said

318
00:11:47,360 --> 00:11:49,440
it's not necessary uh

319
00:11:49,440 --> 00:11:51,920
around 2012 this was all the rage for

320
00:11:51,920 --> 00:11:53,760
ransomware to contact the c2 server and

321
00:11:53,760 --> 00:11:56,160
receive a public key and then five while

322
00:11:56,160 --> 00:11:57,600
firewalls started blocking the

323
00:11:57,600 --> 00:11:59,120
communication

324
00:11:59,120 --> 00:12:00,480
so

325
00:12:00,480 --> 00:12:02,480
this is where ransomware offers

326
00:12:02,480 --> 00:12:04,000
collectively realize that they don't

327
00:12:04,000 --> 00:12:05,279
have to talk to

328
00:12:05,279 --> 00:12:08,480
snc so seeing this again

329
00:12:08,480 --> 00:12:09,200
in

330
00:12:09,200 --> 00:12:11,279
modern ransomware it's kind of jarring

331
00:12:11,279 --> 00:12:13,839
and if they're doing it in order to

332
00:12:13,839 --> 00:12:16,959
communicate with the cnc server in an

333
00:12:16,959 --> 00:12:18,079
encrypted

334
00:12:18,079 --> 00:12:19,120
fashion

335
00:12:19,120 --> 00:12:21,440
it's kind of like a re-implementation of

336
00:12:21,440 --> 00:12:23,519
ssl i don't know which scenario is the

337
00:12:23,519 --> 00:12:25,839
walk here among the two

338
00:12:25,839 --> 00:12:26,959
so

339
00:12:26,959 --> 00:12:29,279
apart from that it's all standard here

340
00:12:29,279 --> 00:12:30,639
you know you can't have a run away

341
00:12:30,639 --> 00:12:33,040
without changing the victim's background

342
00:12:33,040 --> 00:12:35,120
picture i mean come on

343
00:12:35,120 --> 00:12:36,639
but

344
00:12:36,639 --> 00:12:38,639
one thing that's hidden here and is

345
00:12:38,639 --> 00:12:40,959
worth mentioning is rod functionality

346
00:12:40,959 --> 00:12:42,959
you know having a c2 server for

347
00:12:42,959 --> 00:12:45,680
ransomware is not necessary but having

348
00:12:45,680 --> 00:12:47,839
rad functionality is way beyond not

349
00:12:47,839 --> 00:12:49,360
necessary it's

350
00:12:49,360 --> 00:12:50,880
almost unheard of

351
00:12:50,880 --> 00:12:53,519
honestly for a ransomware ransomware

352
00:12:53,519 --> 00:12:56,000
usually does not bother but these guys

353
00:12:56,000 --> 00:12:58,480
let's not means words they were control

354
00:12:58,480 --> 00:13:00,160
freaks they wanted to know who was

355
00:13:00,160 --> 00:13:02,639
infected and they wanted to be able to

356
00:13:02,639 --> 00:13:06,000
tell the ransomware to do

357
00:13:06,000 --> 00:13:08,959
things on the fly post infection and the

358
00:13:08,959 --> 00:13:12,079
moment the fancy strike them

359
00:13:12,079 --> 00:13:14,160
so

360
00:13:14,160 --> 00:13:16,160
this is a

361
00:13:16,160 --> 00:13:18,240
somewhat of a testament to their frame

362
00:13:18,240 --> 00:13:19,440
of mind

363
00:13:19,440 --> 00:13:20,959
and from

364
00:13:20,959 --> 00:13:24,240
this final and over the top instance of

365
00:13:24,240 --> 00:13:26,000
cnc communication and general

366
00:13:26,000 --> 00:13:27,760
communication where communication is not

367
00:13:27,760 --> 00:13:30,240
necessary we'll move on to my favorite

368
00:13:30,240 --> 00:13:33,279
category which is strange as choices

369
00:13:33,279 --> 00:13:35,680
when implementing cryptography

370
00:13:35,680 --> 00:13:38,079
the first among those is the use of rc4

371
00:13:38,079 --> 00:13:41,680
now rc4 is very popular in malware

372
00:13:41,680 --> 00:13:43,440
malware offers use it all the time

373
00:13:43,440 --> 00:13:45,680
simply because it's easy to implement it

374
00:13:45,680 --> 00:13:48,160
is also much easier to shoot yourself in

375
00:13:48,160 --> 00:13:50,639
the foot when using rc4 as opposed to

376
00:13:50,639 --> 00:13:52,079
let's say aes

377
00:13:52,079 --> 00:13:54,000
but a lot of malware offers again they

378
00:13:54,000 --> 00:13:55,760
want something easy to implement so they

379
00:13:55,760 --> 00:13:57,519
go with rc4

380
00:13:57,519 --> 00:14:00,320
and the interesting thing is that

381
00:14:00,320 --> 00:14:02,240
the offers of pay2key did not implement

382
00:14:02,240 --> 00:14:04,399
anything themselves which is commendable

383
00:14:04,399 --> 00:14:06,720
actually they went to the windows crypto

384
00:14:06,720 --> 00:14:09,440
api and they asked it to give them a

385
00:14:09,440 --> 00:14:12,240
cryptographic context and did everything

386
00:14:12,240 --> 00:14:13,600
by the book

387
00:14:13,600 --> 00:14:14,639
so

388
00:14:14,639 --> 00:14:17,120
this is fine and using rc4 like i said

389
00:14:17,120 --> 00:14:19,680
earlier is also fine out of necessity

390
00:14:19,680 --> 00:14:22,000
because if you're a malware offer you're

391
00:14:22,000 --> 00:14:24,880
not going to re-implement aes

392
00:14:24,880 --> 00:14:27,360
but the combination of those two aspects

393
00:14:27,360 --> 00:14:28,720
is really strange

394
00:14:28,720 --> 00:14:31,279
they went to the cryptographic service

395
00:14:31,279 --> 00:14:34,160
provider and they saw the entire world

396
00:14:34,160 --> 00:14:36,480
of well-implemented and well-regarded

397
00:14:36,480 --> 00:14:39,279
cryptography out there and then they

398
00:14:39,279 --> 00:14:41,519
picked rc4

399
00:14:41,519 --> 00:14:43,199
what for i don't know

400
00:14:43,199 --> 00:14:45,760
i would have picked aes if i were them

401
00:14:45,760 --> 00:14:47,440
but

402
00:14:47,440 --> 00:14:49,440
who knows what the motivation was i

403
00:14:49,440 --> 00:14:51,680
don't think i've ever seen it in my life

404
00:14:51,680 --> 00:14:53,920
before this malware

405
00:14:53,920 --> 00:14:56,240
creating an instance of the

406
00:14:56,240 --> 00:14:57,920
service provider the crypto service

407
00:14:57,920 --> 00:14:59,920
provider then asking it to encrypt using

408
00:14:59,920 --> 00:15:02,560
rc4 i haven't seen it before in malware

409
00:15:02,560 --> 00:15:04,000
it's really something

410
00:15:04,000 --> 00:15:07,120
and in general it shows somewhat of a

411
00:15:07,120 --> 00:15:09,120
familiarity and a close relationship

412
00:15:09,120 --> 00:15:11,680
with the cryptographic provider

413
00:15:11,680 --> 00:15:13,680
for them to ask to make such an

414
00:15:13,680 --> 00:15:15,120
unorthodox

415
00:15:15,120 --> 00:15:16,480
request of it

416
00:15:16,480 --> 00:15:17,440
so

417
00:15:17,440 --> 00:15:19,519
naturally it isn't the only instance of

418
00:15:19,519 --> 00:15:20,639
that

419
00:15:20,639 --> 00:15:22,639
when they invoke the cryptographic

420
00:15:22,639 --> 00:15:25,040
context the first time they do something

421
00:15:25,040 --> 00:15:27,040
i also haven't seen before in any

422
00:15:27,040 --> 00:15:29,279
ransomware and i've seen quite a lot of

423
00:15:29,279 --> 00:15:32,399
them they actually put something other

424
00:15:32,399 --> 00:15:34,399
than the now value in the container

425
00:15:34,399 --> 00:15:35,600
parameter

426
00:15:35,600 --> 00:15:40,000
now the code for creating the

427
00:15:40,000 --> 00:15:42,959
cryptographic provider context is copy

428
00:15:42,959 --> 00:15:45,040
and pasted and copy and pasted and copy

429
00:15:45,040 --> 00:15:47,920
and pasted in all runs or wherever and

430
00:15:47,920 --> 00:15:50,560
the parameter is always null

431
00:15:50,560 --> 00:15:52,160
actually

432
00:15:52,160 --> 00:15:54,320
every parameter that can be now usually

433
00:15:54,320 --> 00:15:56,800
is null in this copy page these guys

434
00:15:56,800 --> 00:15:59,120
don't want to deal with the windows

435
00:15:59,120 --> 00:16:01,440
crypto api and honestly i don't really

436
00:16:01,440 --> 00:16:04,160
blame them but these guys the ptp guys

437
00:16:04,160 --> 00:16:06,240
they actually i don't know someone there

438
00:16:06,240 --> 00:16:09,040
actually sat down and read the docs

439
00:16:09,040 --> 00:16:11,440
and they realized that hey by setting a

440
00:16:11,440 --> 00:16:14,000
null value for the parameter

441
00:16:14,000 --> 00:16:16,639
we are using the default container what

442
00:16:16,639 --> 00:16:18,399
should we use why should we use the

443
00:16:18,399 --> 00:16:20,880
default container when we can name our

444
00:16:20,880 --> 00:16:23,199
own specific container

445
00:16:23,199 --> 00:16:25,279
so that's what they did

446
00:16:25,279 --> 00:16:26,639
and

447
00:16:26,639 --> 00:16:28,959
i've seen very rarely this piece of code

448
00:16:28,959 --> 00:16:31,519
in its non-copy-pasted form and i have

449
00:16:31,519 --> 00:16:33,759
to say that it is glorious

450
00:16:33,759 --> 00:16:34,839
now

451
00:16:34,839 --> 00:16:37,839
finally in the category of real crypto

452
00:16:37,839 --> 00:16:41,040
choices there's this uh block of code

453
00:16:41,040 --> 00:16:43,360
which is really a significant

454
00:16:43,360 --> 00:16:45,120
achievement in that you can look at it

455
00:16:45,120 --> 00:16:46,959
completely out of context and

456
00:16:46,959 --> 00:16:49,279
immediately be able to tell what is

457
00:16:49,279 --> 00:16:51,839
wrong here a cryptographic key is

458
00:16:51,839 --> 00:16:54,480
derived deterministically from a hash

459
00:16:54,480 --> 00:16:57,040
which is also derived deterministically

460
00:16:57,040 --> 00:16:58,160
from a

461
00:16:58,160 --> 00:17:00,959
victim machine characteristics such as

462
00:17:00,959 --> 00:17:04,000
you know the hdd serial number and

463
00:17:04,000 --> 00:17:05,839
whatnot there's all sorts of parameters

464
00:17:05,839 --> 00:17:08,000
these guys like to use for that sort of

465
00:17:08,000 --> 00:17:09,039
thing

466
00:17:09,039 --> 00:17:10,079
and

467
00:17:10,079 --> 00:17:12,400
what's frustrating about this

468
00:17:12,400 --> 00:17:14,799
is that it's a demonstration of how

469
00:17:14,799 --> 00:17:16,640
crypto is hard when you're writing

470
00:17:16,640 --> 00:17:19,039
crypto but you know what crypto is even

471
00:17:19,039 --> 00:17:20,720
harder sometimes when you're attacking

472
00:17:20,720 --> 00:17:23,199
crypto because this is a mistake what

473
00:17:23,199 --> 00:17:24,799
you're seeing on screen that if there

474
00:17:24,799 --> 00:17:28,000
were a big red book of what not to do in

475
00:17:28,000 --> 00:17:30,480
crypto this would be on page like four

476
00:17:30,480 --> 00:17:31,520
or five

477
00:17:31,520 --> 00:17:34,240
but still somehow they managed to

478
00:17:34,240 --> 00:17:37,440
stumble uh forward uh by writing this

479
00:17:37,440 --> 00:17:40,799
code into a ransomware that still could

480
00:17:40,799 --> 00:17:42,880
not be broken no one was able to write a

481
00:17:42,880 --> 00:17:45,440
decryptor for the pay-to-key ransomware

482
00:17:45,440 --> 00:17:46,420
which

483
00:17:46,420 --> 00:17:47,520
[Music]

484
00:17:47,520 --> 00:17:50,000
just goes to show you how sometimes life

485
00:17:50,000 --> 00:17:52,160
really is not fair you can look at a

486
00:17:52,160 --> 00:17:55,360
piece of cryptographic code and say wow

487
00:17:55,360 --> 00:17:58,559
by sheer pure luck these guys

488
00:17:58,559 --> 00:18:00,400
were able to write a

489
00:18:00,400 --> 00:18:02,559
crypto implementation that i am not able

490
00:18:02,559 --> 00:18:06,160
to break it was this close but no

491
00:18:06,160 --> 00:18:08,080
so

492
00:18:08,080 --> 00:18:10,559
this is the type of despair that as i am

493
00:18:10,559 --> 00:18:12,840
our researchers we have to do

494
00:18:12,840 --> 00:18:16,400
regularly so uh with on this very

495
00:18:16,400 --> 00:18:19,200
optimistic note i am now going to pass

496
00:18:19,200 --> 00:18:21,600
the presentation on to gil we will talk

497
00:18:21,600 --> 00:18:23,440
to you about the actually interesting uh

498
00:18:23,440 --> 00:18:25,919
parts and aspects of the bay to

499
00:18:25,919 --> 00:18:27,679
kiranjuri campaign

500
00:18:27,679 --> 00:18:30,480
your turn guild

501
00:18:30,480 --> 00:18:32,320
hi everyone my name is gilman shaw and

502
00:18:32,320 --> 00:18:34,000
i'm a malware analyst in checkpoint

503
00:18:34,000 --> 00:18:35,919
sport intelligence team

504
00:18:35,919 --> 00:18:37,679
until now we cover the technical aspect

505
00:18:37,679 --> 00:18:39,760
of the campaign it's time to dig deeper

506
00:18:39,760 --> 00:18:41,120
analyze the campaign and see how it

507
00:18:41,120 --> 00:18:43,840
actually works

508
00:18:43,840 --> 00:18:45,840
so every time we analyzing campaign

509
00:18:45,840 --> 00:18:48,080
focusing on several main questions the

510
00:18:48,080 --> 00:18:50,799
first question is who are the targets

511
00:18:50,799 --> 00:18:53,679
the second question is who is behind it

512
00:18:53,679 --> 00:18:56,160
the third question is how did they do it

513
00:18:56,160 --> 00:18:58,160
and of course why did they do it and

514
00:18:58,160 --> 00:19:00,480
what is their motive i'll try to answer

515
00:19:00,480 --> 00:19:04,000
these questions in the next slides

516
00:19:04,559 --> 00:19:06,400
the first question that we'll try to

517
00:19:06,400 --> 00:19:09,520
answer is who are the targets

518
00:19:09,520 --> 00:19:12,000
so who are the targets

519
00:19:12,000 --> 00:19:14,080
most of the victims are companies based

520
00:19:14,080 --> 00:19:16,640
in israel and there's also one company

521
00:19:16,640 --> 00:19:18,559
in italy that was compromised

522
00:19:18,559 --> 00:19:20,240
like a typical double extortion

523
00:19:20,240 --> 00:19:21,600
operation the attackers leaked

524
00:19:21,600 --> 00:19:23,679
information from the victims into a

525
00:19:23,679 --> 00:19:26,320
tall-based server

526
00:19:26,320 --> 00:19:27,840
we could find some of the victims there

527
00:19:27,840 --> 00:19:30,000
by looking at the folder names

528
00:19:30,000 --> 00:19:32,000
all the companies that we see here are

529
00:19:32,000 --> 00:19:34,320
based in israel so we know that this is

530
00:19:34,320 --> 00:19:38,160
what these companies have in common

531
00:19:38,160 --> 00:19:40,000
the next question that we try to answer

532
00:19:40,000 --> 00:19:43,120
is who is behind it

533
00:19:43,440 --> 00:19:45,520
usually ransomware operators attach

534
00:19:45,520 --> 00:19:47,520
contact information on the ransom node

535
00:19:47,520 --> 00:19:50,160
for communication with the victims

536
00:19:50,160 --> 00:19:52,000
communication with the victims is very

537
00:19:52,000 --> 00:19:54,240
important for negotiations and queries

538
00:19:54,240 --> 00:19:55,760
the victim should trust the attacker

539
00:19:55,760 --> 00:19:57,280
that the files will be decrypted after

540
00:19:57,280 --> 00:19:59,760
the payment

541
00:19:59,760 --> 00:20:02,559
so accept email pay to key operators use

542
00:20:02,559 --> 00:20:05,600
key base as a communication method

543
00:20:05,600 --> 00:20:07,760
so what is keybase

544
00:20:07,760 --> 00:20:10,320
keybase is a platform for secure and

545
00:20:10,320 --> 00:20:12,240
private messaging with end-to-end

546
00:20:12,240 --> 00:20:13,360
encryption

547
00:20:13,360 --> 00:20:15,600
pay-to-key used key base in order to

548
00:20:15,600 --> 00:20:18,480
hide their identity

549
00:20:18,480 --> 00:20:20,480
interesting thing to note is that the

550
00:20:20,480 --> 00:20:21,760
key base account of paid to key

551
00:20:21,760 --> 00:20:24,720
operators was opened in june 2020 which

552
00:20:24,720 --> 00:20:26,480
is four or five months before the first

553
00:20:26,480 --> 00:20:27,360
attack

554
00:20:27,360 --> 00:20:29,280
it means that paytock operators prepare

555
00:20:29,280 --> 00:20:31,120
the attack infrastructure for more than

556
00:20:31,120 --> 00:20:34,439
four months

557
00:20:34,559 --> 00:20:36,080
eventually

558
00:20:36,080 --> 00:20:37,760
we understood that it will be hard to

559
00:20:37,760 --> 00:20:39,520
track pay to keep operators based on the

560
00:20:39,520 --> 00:20:41,039
contact information

561
00:20:41,039 --> 00:20:43,280
so we decided to follow the monitoring

562
00:20:43,280 --> 00:20:46,000
left by the pain victims

563
00:20:46,000 --> 00:20:48,159
first of all each ransom note of pay to

564
00:20:48,159 --> 00:20:50,080
key contained a bitcoin wallet to

565
00:20:50,080 --> 00:20:52,159
transfer the money

566
00:20:52,159 --> 00:20:54,240
we already have few ransom notes of pay

567
00:20:54,240 --> 00:20:56,720
to key which means that maybe we can

568
00:20:56,720 --> 00:20:58,400
track few of the bitcoin wallets of the

569
00:20:58,400 --> 00:21:02,880
attackers so this is what we did

570
00:21:02,880 --> 00:21:05,039
first of all we already had wallets of

571
00:21:05,039 --> 00:21:07,919
the attackers from the ransom nodes

572
00:21:07,919 --> 00:21:10,720
we also saw incoming transactions from

573
00:21:10,720 --> 00:21:13,600
ransomware victims to these wallets

574
00:21:13,600 --> 00:21:16,080
from there the money is transferred

575
00:21:16,080 --> 00:21:19,360
to an intermediate vault

576
00:21:19,840 --> 00:21:21,840
which is the same wallet for both

577
00:21:21,840 --> 00:21:23,679
wallets

578
00:21:23,679 --> 00:21:25,840
from there the money is transferred to a

579
00:21:25,840 --> 00:21:28,400
final wallet

580
00:21:28,400 --> 00:21:30,559
the final wallet is part of an iranian

581
00:21:30,559 --> 00:21:35,520
cryptocurrency exchange named ex coino

582
00:21:36,080 --> 00:21:38,320
so how can we confirm that the final

583
00:21:38,320 --> 00:21:39,440
word is part of the iranian

584
00:21:39,440 --> 00:21:41,840
cryptocurrency exchange exponent

585
00:21:41,840 --> 00:21:43,760
stay with me here because it's a bit

586
00:21:43,760 --> 00:21:45,360
complicated

587
00:21:45,360 --> 00:21:47,840
first of all we need to find a confirmed

588
00:21:47,840 --> 00:21:50,480
wallet of exchange

589
00:21:50,480 --> 00:21:52,240
the way we chose is to watch a youtube

590
00:21:52,240 --> 00:21:55,200
tutorial for experiment

591
00:21:55,200 --> 00:21:57,120
during the video tutorial we saw the

592
00:21:57,120 --> 00:21:59,360
wallet that used to demonstrate proper

593
00:21:59,360 --> 00:22:02,480
usage of xcoding platform

594
00:22:02,480 --> 00:22:04,480
so now we have a confirmed wallet of

595
00:22:04,480 --> 00:22:05,760
exponent

596
00:22:05,760 --> 00:22:07,520
luckily for us we can use known

597
00:22:07,520 --> 00:22:08,880
techniques of blockchain network

598
00:22:08,880 --> 00:22:10,960
clustering in order to check which

599
00:22:10,960 --> 00:22:12,799
cluster the confirmed exchange world

600
00:22:12,799 --> 00:22:15,360
belongs to

601
00:22:15,520 --> 00:22:17,440
we also checked which class there the

602
00:22:17,440 --> 00:22:20,080
final wallet of peterki belongs to

603
00:22:20,080 --> 00:22:21,760
and we can see that it belongs to the

604
00:22:21,760 --> 00:22:24,080
same cluster as the confirmed white of x

605
00:22:24,080 --> 00:22:26,480
coil

606
00:22:26,480 --> 00:22:28,960
so in conclusion we can say with a very

607
00:22:28,960 --> 00:22:31,039
high probability that the final vote of

608
00:22:31,039 --> 00:22:33,120
pay to key is part of excluding an

609
00:22:33,120 --> 00:22:36,799
iranian cryptocurrency exchange

610
00:22:37,280 --> 00:22:39,600
now let's talk more about excluding the

611
00:22:39,600 --> 00:22:41,120
cryptocurrency exchange that peter

612
00:22:41,120 --> 00:22:43,360
cuberators are using

613
00:22:43,360 --> 00:22:44,559
first of all

614
00:22:44,559 --> 00:22:46,559
hexcoin is an iranian cryptocurrency

615
00:22:46,559 --> 00:22:48,960
exchange in order to confirm it we can

616
00:22:48,960 --> 00:22:50,799
take a look in the terms of fuse page in

617
00:22:50,799 --> 00:22:53,120
x coin website

618
00:22:53,120 --> 00:22:54,880
we can see that it's written in person

619
00:22:54,880 --> 00:22:57,360
that this site is for iranian users

620
00:22:57,360 --> 00:22:59,200
under the laws of the islamic republic

621
00:22:59,200 --> 00:23:00,880
of iran

622
00:23:00,880 --> 00:23:02,640
second of all you must have an iranian

623
00:23:02,640 --> 00:23:04,799
id and phone number in order to use

624
00:23:04,799 --> 00:23:06,400
excluding

625
00:23:06,400 --> 00:23:09,120
again in its time in its levels of views

626
00:23:09,120 --> 00:23:11,039
excluder states that you need to be

627
00:23:11,039 --> 00:23:14,559
identified in order to use its platform

628
00:23:14,559 --> 00:23:16,880
another interesting thing to note is

629
00:23:16,880 --> 00:23:18,480
that excluding states that the first

630
00:23:18,480 --> 00:23:20,240
transaction and any suspicious

631
00:23:20,240 --> 00:23:22,240
transaction will be reported to the

632
00:23:22,240 --> 00:23:24,960
iranian cyber police

633
00:23:24,960 --> 00:23:26,799
the meaning is that the iranian service

634
00:23:26,799 --> 00:23:28,559
police should have been informed on the

635
00:23:28,559 --> 00:23:31,200
first transaction of petrukhi operators

636
00:23:31,200 --> 00:23:32,799
important thing to mention is that one

637
00:23:32,799 --> 00:23:34,320
of the most significant aspects of

638
00:23:34,320 --> 00:23:36,720
attribution is the targeting and in this

639
00:23:36,720 --> 00:23:39,280
case almost all the attacks exclusively

640
00:23:39,280 --> 00:23:41,760
targeted israel

641
00:23:41,760 --> 00:23:44,640
our evidence on pay-to-key and ex-coino

642
00:23:44,640 --> 00:23:46,799
along with the targeting makes it more

643
00:23:46,799 --> 00:23:49,840
evident that iranian citizens are behind

644
00:23:49,840 --> 00:23:51,840
and maybe in this case the iranian cyber

645
00:23:51,840 --> 00:23:55,039
police will turn a blind eye

646
00:23:55,919 --> 00:23:59,200
okay so we trace the attack back to iran

647
00:23:59,200 --> 00:24:01,120
from here let's jump straight into one

648
00:24:01,120 --> 00:24:02,799
of the more interesting aspects of this

649
00:24:02,799 --> 00:24:04,960
campaign and is the extensive public

650
00:24:04,960 --> 00:24:07,279
relations effort which is quite unusual

651
00:24:07,279 --> 00:24:10,000
to run solo campaigns

652
00:24:10,000 --> 00:24:12,000
first of all why would the attackers

653
00:24:12,000 --> 00:24:14,880
invest their time on media coverage

654
00:24:14,880 --> 00:24:17,279
the simple answer is that media coverage

655
00:24:17,279 --> 00:24:19,360
that could add extra pressure on the

656
00:24:19,360 --> 00:24:21,679
victims especially if the victim is a

657
00:24:21,679 --> 00:24:24,320
well-known organization

658
00:24:24,320 --> 00:24:26,880
another possible reason is that the goal

659
00:24:26,880 --> 00:24:28,880
of pay to kill paretos is to cause

660
00:24:28,880 --> 00:24:30,840
damage to the image of known israeli

661
00:24:30,840 --> 00:24:32,720
organizations in order to hand the

662
00:24:32,720 --> 00:24:34,880
israeli image in general

663
00:24:34,880 --> 00:24:37,279
so how pay-to-key leverage their

664
00:24:37,279 --> 00:24:40,000
achievements into media coverage

665
00:24:40,000 --> 00:24:42,240
the first method is by creating twitter

666
00:24:42,240 --> 00:24:44,480
polls and make the readers involved

667
00:24:44,480 --> 00:24:46,400
the second method is mentioning and

668
00:24:46,400 --> 00:24:49,440
tagging known israeli media accounts

669
00:24:49,440 --> 00:24:51,520
in addition we can understand that media

670
00:24:51,520 --> 00:24:53,440
coverage is important to pay tokyo

671
00:24:53,440 --> 00:24:55,440
operators because every time their

672
00:24:55,440 --> 00:24:57,440
twitter account is getting suspended

673
00:24:57,440 --> 00:24:59,440
they immediately create a new account in

674
00:24:59,440 --> 00:25:01,600
order to maintain the hype around their

675
00:25:01,600 --> 00:25:04,080
attacks

676
00:25:04,799 --> 00:25:06,960
we mentioned the double extolsion tactic

677
00:25:06,960 --> 00:25:09,360
patokia operators are using

678
00:25:09,360 --> 00:25:11,440
part of this tactic includes leaking

679
00:25:11,440 --> 00:25:14,159
information from the victims

680
00:25:14,159 --> 00:25:16,000
pato key operators created a simple

681
00:25:16,000 --> 00:25:18,159
website to look information

682
00:25:18,159 --> 00:25:19,840
we can see that the website has a

683
00:25:19,840 --> 00:25:22,159
structure of a file system with a

684
00:25:22,159 --> 00:25:25,120
directory for each organization

685
00:25:25,120 --> 00:25:26,159
however

686
00:25:26,159 --> 00:25:28,080
the user interface of the website is

687
00:25:28,080 --> 00:25:30,000
very simple and if you want media

688
00:25:30,000 --> 00:25:31,679
copyright for the website it's not

689
00:25:31,679 --> 00:25:33,679
enough

690
00:25:33,679 --> 00:25:36,320
so what did pay2key operators do

691
00:25:36,320 --> 00:25:38,080
they upgraded the website

692
00:25:38,080 --> 00:25:40,400
and now it has more visual interface

693
00:25:40,400 --> 00:25:42,559
that includes the map of israel

694
00:25:42,559 --> 00:25:44,240
when we see the new website with the map

695
00:25:44,240 --> 00:25:46,400
of israel in it we can say that beyond

696
00:25:46,400 --> 00:25:48,320
any doubt this campaign is targeting

697
00:25:48,320 --> 00:25:50,480
israel

698
00:25:50,480 --> 00:25:53,200
so after pay to key operators made a lot

699
00:25:53,200 --> 00:25:55,200
of effort in order to get media coverage

700
00:25:55,200 --> 00:25:58,559
we can ask ourselves did it work

701
00:25:58,559 --> 00:26:01,679
let's judge the results

702
00:26:01,679 --> 00:26:03,440
we can see that pay-to-keep operators

703
00:26:03,440 --> 00:26:05,039
get media coverage for hacking and

704
00:26:05,039 --> 00:26:08,159
israeli intel acquire stata

705
00:26:08,159 --> 00:26:10,400
another example

706
00:26:10,400 --> 00:26:12,159
is that media coverage for their claims

707
00:26:12,159 --> 00:26:13,919
to hack botnocks in israel a cyber

708
00:26:13,919 --> 00:26:15,760
security fear

709
00:26:15,760 --> 00:26:18,320
and the last example shows that awaiting

710
00:26:18,320 --> 00:26:20,480
the leaks website was a smart investment

711
00:26:20,480 --> 00:26:22,480
as it got media coverage for clearly

712
00:26:22,480 --> 00:26:25,840
targeting israel

713
00:26:26,720 --> 00:26:28,640
in this moment we already know that

714
00:26:28,640 --> 00:26:30,720
israel was the target of the attacks and

715
00:26:30,720 --> 00:26:32,320
the source of the attacks is probably

716
00:26:32,320 --> 00:26:34,240
from iran

717
00:26:34,240 --> 00:26:35,679
before we dig in deeper into the

718
00:26:35,679 --> 00:26:37,600
campaign let's take a wider look and

719
00:26:37,600 --> 00:26:39,200
examine this campaign in reflection to

720
00:26:39,200 --> 00:26:42,640
iran israel's cyber conflict timeline

721
00:26:42,640 --> 00:26:45,440
back in 2010 stuxnet probably the most

722
00:26:45,440 --> 00:26:47,360
sophisticated piece of malware in that

723
00:26:47,360 --> 00:26:49,360
time was discovered in iran's nuclear

724
00:26:49,360 --> 00:26:50,880
reactors

725
00:26:50,880 --> 00:26:52,720
the development of stuxnet along with

726
00:26:52,720 --> 00:26:54,720
the infection of iran's nuclear reactors

727
00:26:54,720 --> 00:26:56,960
with it are attributed to united states

728
00:26:56,960 --> 00:26:58,880
and israel

729
00:26:58,880 --> 00:27:01,440
on april 2020 there was a report on a

730
00:27:01,440 --> 00:27:03,760
cyber attack on israel's water system

731
00:27:03,760 --> 00:27:06,799
the attack has been attributed to iran

732
00:27:06,799 --> 00:27:08,960
in this attack there was an attempt to

733
00:27:08,960 --> 00:27:12,960
raise the clone levels in the water

734
00:27:13,279 --> 00:27:16,320
few weeks later on may 2020 there was a

735
00:27:16,320 --> 00:27:18,080
report on a cyber attack on the naval

736
00:27:18,080 --> 00:27:20,240
port in iran the attack has been

737
00:27:20,240 --> 00:27:22,320
attributed to israel

738
00:27:22,320 --> 00:27:24,080
this attack has shut down the activity

739
00:27:24,080 --> 00:27:26,000
on this port and disrupted the movements

740
00:27:26,000 --> 00:27:28,000
of ships nearby

741
00:27:28,000 --> 00:27:30,399
more than a month later on june 25 there

742
00:27:30,399 --> 00:27:32,880
was a report on explosion in an iranian

743
00:27:32,880 --> 00:27:35,360
military base according to few reports

744
00:27:35,360 --> 00:27:37,440
the explosion has been caused by a cyber

745
00:27:37,440 --> 00:27:41,600
attack attributed to israel

746
00:27:41,600 --> 00:27:44,159
three days later after the attack on

747
00:27:44,159 --> 00:27:46,960
june 28th peter key operators created

748
00:27:46,960 --> 00:27:48,480
their key base account used to

749
00:27:48,480 --> 00:27:50,240
communicate with the victims of the

750
00:27:50,240 --> 00:27:52,640
ransomware

751
00:27:52,640 --> 00:27:55,440
few months later on november 2020 the

752
00:27:55,440 --> 00:27:57,279
first wave of pay to key

753
00:27:57,279 --> 00:27:59,360
has been seen in israel encrypting and

754
00:27:59,360 --> 00:28:00,720
leaking information from few

755
00:28:00,720 --> 00:28:04,320
organizations based in israel

756
00:28:04,720 --> 00:28:07,360
on december 2020 the second wave of p2k

757
00:28:07,360 --> 00:28:09,360
attacks has been seen as well

758
00:28:09,360 --> 00:28:11,200
one thing to note is that in the second

759
00:28:11,200 --> 00:28:12,559
wave of the attacks the pay-to-kill

760
00:28:12,559 --> 00:28:14,559
ransomware was already known by the

761
00:28:14,559 --> 00:28:16,559
cyber security industry

762
00:28:16,559 --> 00:28:18,640
in this way there were no reports on

763
00:28:18,640 --> 00:28:20,880
ransomware infections but only reports

764
00:28:20,880 --> 00:28:22,320
on netherlands from israeli

765
00:28:22,320 --> 00:28:24,640
organizations using pay to key twitter

766
00:28:24,640 --> 00:28:27,039
accounts

767
00:28:28,080 --> 00:28:30,559
we saw that peter key is under active

768
00:28:30,559 --> 00:28:34,399
development but in april 2021 we had a

769
00:28:34,399 --> 00:28:36,080
ransomware incident in an israeli

770
00:28:36,080 --> 00:28:38,000
company that looked familiar and it

771
00:28:38,000 --> 00:28:41,360
called itself network

772
00:28:41,360 --> 00:28:43,440
when we analyzed the run software we saw

773
00:28:43,440 --> 00:28:45,360
that it shares a lot of code with pay to

774
00:28:45,360 --> 00:28:47,600
key and our conclusion was that this

775
00:28:47,600 --> 00:28:50,480
runs over called networm is an evolution

776
00:28:50,480 --> 00:28:52,880
of pay2key

777
00:28:52,880 --> 00:28:54,960
besides encrypting files it seems that

778
00:28:54,960 --> 00:28:56,559
network one somewhere used another

779
00:28:56,559 --> 00:28:59,200
custom made tool called free space

780
00:28:59,200 --> 00:29:00,720
worker

781
00:29:00,720 --> 00:29:03,039
what this tool does well it just creates

782
00:29:03,039 --> 00:29:05,120
zero fill temporary files and deletes

783
00:29:05,120 --> 00:29:06,559
them

784
00:29:06,559 --> 00:29:08,880
this way the ransomware makes sure that

785
00:29:08,880 --> 00:29:10,480
the free space in the hard disk is

786
00:29:10,480 --> 00:29:12,720
filled with zeros which makes it harder

787
00:29:12,720 --> 00:29:16,559
to recover the files from the hard disk

788
00:29:16,880 --> 00:29:18,960
so far we analyzed the run server and

789
00:29:18,960 --> 00:29:21,440
the campaign itself the last question

790
00:29:21,440 --> 00:29:26,360
left is why did they do it

791
00:29:26,399 --> 00:29:29,360
the first option is activism maybe

792
00:29:29,360 --> 00:29:31,039
patokia operators attacked israeli

793
00:29:31,039 --> 00:29:33,120
organizations as a result of an

794
00:29:33,120 --> 00:29:36,000
anti-israel agenda

795
00:29:36,000 --> 00:29:38,480
when talking activism operations against

796
00:29:38,480 --> 00:29:40,799
israel the most notable operation is

797
00:29:40,799 --> 00:29:42,720
known as op israel

798
00:29:42,720 --> 00:29:45,440
and it mostly includes ddos attacks and

799
00:29:45,440 --> 00:29:48,000
website corruptions

800
00:29:48,000 --> 00:29:49,919
in the recent opius world we saw an

801
00:29:49,919 --> 00:29:52,799
attack similar to peyto key where a

802
00:29:52,799 --> 00:29:55,120
hacking group named black shadow hacked

803
00:29:55,120 --> 00:29:57,840
into an israeli insurance company named

804
00:29:57,840 --> 00:29:59,039
sherbet

805
00:29:59,039 --> 00:30:02,799
and lex licked its information

806
00:30:02,799 --> 00:30:04,640
the attack happened few weeks after the

807
00:30:04,640 --> 00:30:07,360
first wave of the petrol key attacks and

808
00:30:07,360 --> 00:30:09,919
maybe black shadow the attackers

809
00:30:09,919 --> 00:30:11,760
absorbed inspiration from pay-to-keep

810
00:30:11,760 --> 00:30:13,840
operators after the media coverage it

811
00:30:13,840 --> 00:30:16,320
received

812
00:30:16,399 --> 00:30:18,559
but not only pay to key operators

813
00:30:18,559 --> 00:30:20,799
receive media coverage black shadow

814
00:30:20,799 --> 00:30:22,399
leaked information from a known israeli

815
00:30:22,399 --> 00:30:24,480
insurance company putting sensitive

816
00:30:24,480 --> 00:30:28,320
information of its customers in risk

817
00:30:29,440 --> 00:30:31,760
but activism is not the only option for

818
00:30:31,760 --> 00:30:34,480
the motive of p2k operators

819
00:30:34,480 --> 00:30:36,480
first of all we know that there is cyber

820
00:30:36,480 --> 00:30:39,520
conflict between israel and iran

821
00:30:39,520 --> 00:30:42,399
second petuke operators claim to hack an

822
00:30:42,399 --> 00:30:45,360
israeli defense company named elta

823
00:30:45,360 --> 00:30:47,840
which belongs to the israeli government

824
00:30:47,840 --> 00:30:49,440
in this case we understand that

825
00:30:49,440 --> 00:30:51,200
pay-to-care purposes aren't targeting

826
00:30:51,200 --> 00:30:53,120
only organizations from the israeli

827
00:30:53,120 --> 00:30:54,640
private sector

828
00:30:54,640 --> 00:30:56,559
the meaning is that petruchio operator's

829
00:30:56,559 --> 00:30:59,360
motive might be espionage which raises

830
00:30:59,360 --> 00:31:01,120
the possibility for a state-sponsored

831
00:31:01,120 --> 00:31:02,799
attack

832
00:31:02,799 --> 00:31:04,960
and third clear sky who also

833
00:31:04,960 --> 00:31:06,799
investigated this attack attributed

834
00:31:06,799 --> 00:31:09,360
pay-to-key to fox kitten with a medium

835
00:31:09,360 --> 00:31:11,840
to high confidence

836
00:31:11,840 --> 00:31:13,679
for those of you that aren't familiar

837
00:31:13,679 --> 00:31:16,320
with fox kitten group fox kitten is

838
00:31:16,320 --> 00:31:18,000
known as an iranian state-sponsored

839
00:31:18,000 --> 00:31:20,320
aptigou which means that this attack

840
00:31:20,320 --> 00:31:24,000
might be state-sponsored

841
00:31:24,640 --> 00:31:27,120
so patrick operators might be activists

842
00:31:27,120 --> 00:31:30,240
or state-sponsored but after the attacks

843
00:31:30,240 --> 00:31:33,840
there was an interesting plot twist

844
00:31:33,840 --> 00:31:35,919
an israeli account on twitter claimed to

845
00:31:35,919 --> 00:31:39,120
have information on pay to key operators

846
00:31:39,120 --> 00:31:40,799
some of the information given by this

847
00:31:40,799 --> 00:31:43,039
account mentions the usage of excluding

848
00:31:43,039 --> 00:31:45,039
by petroche operators and it claims to

849
00:31:45,039 --> 00:31:49,120
uncover the identity of p2k operators

850
00:31:49,120 --> 00:31:51,279
but whoever behind this account can't

851
00:31:51,279 --> 00:31:53,760
work alone and it seems to recruit

852
00:31:53,760 --> 00:31:55,600
israeli hackers for revenge on pay to

853
00:31:55,600 --> 00:31:58,080
key operators

854
00:31:58,080 --> 00:31:59,679
we can see here that this account

855
00:31:59,679 --> 00:32:01,919
created another account that should hunt

856
00:32:01,919 --> 00:32:04,320
iranian apt groups

857
00:32:04,320 --> 00:32:06,480
however we don't know if these twitter

858
00:32:06,480 --> 00:32:08,480
accounts are reliable but we might be

859
00:32:08,480 --> 00:32:10,159
witnessing a rising trend where

860
00:32:10,159 --> 00:32:11,919
individuals notice a cyber attack on

861
00:32:11,919 --> 00:32:14,080
their country and decide to react to it

862
00:32:14,080 --> 00:32:16,159
by themselves think that if they won't

863
00:32:16,159 --> 00:32:19,760
react to it no one will react to it

864
00:32:21,360 --> 00:32:23,120
after we published our port on

865
00:32:23,120 --> 00:32:25,519
pay-to-key more and more information

866
00:32:25,519 --> 00:32:29,360
started to come up regarding the initial

867
00:32:29,360 --> 00:32:31,519
access to the victims network it seems

868
00:32:31,519 --> 00:32:33,600
that one of the methods used by pay to

869
00:32:33,600 --> 00:32:35,600
keep operators to infertility networks

870
00:32:35,600 --> 00:32:40,320
is by using compromised rdp credentials

871
00:32:40,320 --> 00:32:42,559
more important methods are exploitation

872
00:32:42,559 --> 00:32:46,480
of exchange servers rdp and vpn like 14

873
00:32:46,480 --> 00:32:49,200
at ssl

874
00:32:49,600 --> 00:32:52,159
and for lateral movement pay2key makes

875
00:32:52,159 --> 00:32:54,559
use of the ps exec tool created by sysed

876
00:32:54,559 --> 00:32:57,559
terminals

877
00:32:58,159 --> 00:33:00,320
to conclude we saw a new ransomware

878
00:33:00,320 --> 00:33:02,799
strain named pay-to-key which is

879
00:33:02,799 --> 00:33:05,600
targeting israeli organizations

880
00:33:05,600 --> 00:33:08,080
the ransomware is considered simple not

881
00:33:08,080 --> 00:33:10,640
packed with clear text strings and yet

882
00:33:10,640 --> 00:33:13,440
it was very effective

883
00:33:13,440 --> 00:33:15,840
the targets were israeli organizations

884
00:33:15,840 --> 00:33:17,840
and by following the trace of money and

885
00:33:17,840 --> 00:33:19,519
the possible attackers it seems that

886
00:33:19,519 --> 00:33:21,840
pato key operators are probably iranian

887
00:33:21,840 --> 00:33:24,559
citizens

888
00:33:24,559 --> 00:33:26,559
ransomware parallels evolved and double

889
00:33:26,559 --> 00:33:28,640
extortion is used as a strategy to make

890
00:33:28,640 --> 00:33:32,559
sure that the victim pays the rental

891
00:33:32,799 --> 00:33:34,640
creating hype in social media and

892
00:33:34,640 --> 00:33:36,480
gaining media coverage were essential

893
00:33:36,480 --> 00:33:38,559
part of this campaign

894
00:33:38,559 --> 00:33:40,640
and finally we saw that hacktivist

895
00:33:40,640 --> 00:33:42,399
groups may rise and strike back when

896
00:33:42,399 --> 00:33:44,399
there is no sin reaction for a cyber

897
00:33:44,399 --> 00:33:47,760
attack of a rival nation

898
00:33:48,799 --> 00:33:50,799
before we finish we want to thank

899
00:33:50,799 --> 00:33:52,960
clarity research in western for their

900
00:33:52,960 --> 00:33:54,960
contribution to this research and to our

901
00:33:54,960 --> 00:33:57,600
colleague itai who work with us on this

902
00:33:57,600 --> 00:33:59,440
research and we couldn't done it without

903
00:33:59,440 --> 00:34:01,600
him

904
00:34:01,679 --> 00:34:04,320
and that's all for now if you want to

905
00:34:04,320 --> 00:34:06,679
read more from our work you can visit

906
00:34:06,679 --> 00:34:08,800
research.checkpoint.com or follow us in

907
00:34:08,800 --> 00:34:11,599
cpa research if you have any additional

908
00:34:11,599 --> 00:34:13,199
questions you are more than welcome to

909
00:34:13,199 --> 00:34:14,960
contact us on our personal twitter

910
00:34:14,960 --> 00:34:15,918
account

911
00:34:15,918 --> 00:34:19,158
thank you

912
00:34:19,280 --> 00:34:22,399
[Music]

913
00:34:22,399 --> 00:34:24,480
you

