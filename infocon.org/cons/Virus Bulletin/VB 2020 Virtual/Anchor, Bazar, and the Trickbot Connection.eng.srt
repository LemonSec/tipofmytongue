1
00:00:08,960 --> 00:00:10,080
hi everyone

2
00:00:10,080 --> 00:00:11,599
thank you for having us we are very

3
00:00:11,599 --> 00:00:13,440
excited to be here and present our talk

4
00:00:13,440 --> 00:00:17,120
about tanko bazaar and the truckwood

5
00:00:18,000 --> 00:00:20,960
so a little bit about us my name is leo

6
00:00:20,960 --> 00:00:22,960
and i'm a senior threat researcher and a

7
00:00:22,960 --> 00:00:24,960
threat hunter at cyber reason

8
00:00:24,960 --> 00:00:27,199
most of my work is around threat hunting

9
00:00:27,199 --> 00:00:28,400
marvel analysis

10
00:00:28,400 --> 00:00:31,119
and open source intelligence before

11
00:00:31,119 --> 00:00:32,960
joining cyberism i was a security

12
00:00:32,960 --> 00:00:35,440
analyst in the israeli air force

13
00:00:35,440 --> 00:00:37,280
hi everybody my name is daniel i'm a

14
00:00:37,280 --> 00:00:39,440
senior marvel researcher at cyber reason

15
00:00:39,440 --> 00:00:41,360
i cyber reason i specialize in reverse

16
00:00:41,360 --> 00:00:42,800
engineering malware and

17
00:00:42,800 --> 00:00:44,879
tracking various threats such as nation

18
00:00:44,879 --> 00:00:48,559
state and cyber crime groups

19
00:00:48,559 --> 00:00:51,039
today we have a very packed agenda we

20
00:00:51,039 --> 00:00:52,719
will start by discussing the trickbot

21
00:00:52,719 --> 00:00:53,280
gang

22
00:00:53,280 --> 00:00:56,320
describing the group and its operations

23
00:00:56,320 --> 00:00:58,000
and give you some history about the

24
00:00:58,000 --> 00:01:00,800
group uh we will later recover tomorrow

25
00:01:00,800 --> 00:01:02,000
in the arsenal

26
00:01:02,000 --> 00:01:03,920
uh starting with anko that was

27
00:01:03,920 --> 00:01:05,438
discovered last year

28
00:01:05,438 --> 00:01:08,000
and continuing with bazaar with the

29
00:01:08,000 --> 00:01:09,200
bazaar family that

30
00:01:09,200 --> 00:01:12,240
emerged in 2020 we will then continue

31
00:01:12,240 --> 00:01:14,240
the talk by discussing code and ttp

32
00:01:14,240 --> 00:01:16,880
similarities uh showing how all of them

33
00:01:16,880 --> 00:01:18,960
are connected to the same actor uh one

34
00:01:18,960 --> 00:01:20,320
of the most interesting things

35
00:01:20,320 --> 00:01:22,000
uh in the overview of both anchor and

36
00:01:22,000 --> 00:01:23,600
bazaar mother families

37
00:01:23,600 --> 00:01:25,600
are the development cycles which will be

38
00:01:25,600 --> 00:01:27,119
discussed in each section

39
00:01:27,119 --> 00:01:28,880
uh we will then discuss similarities in

40
00:01:28,880 --> 00:01:31,439
mongol three and uh finally review

41
00:01:31,439 --> 00:01:34,000
uh how we pivot iocs and using bt

42
00:01:34,000 --> 00:01:37,119
queries to track them down

43
00:01:37,119 --> 00:01:38,840
um so let's start with the trig but

44
00:01:38,840 --> 00:01:40,799
again

45
00:01:40,799 --> 00:01:43,360
the trick pod game or as other vendors

46
00:01:43,360 --> 00:01:45,840
may refer to as a wizard spider

47
00:01:45,840 --> 00:01:47,680
is one of the biggest cyber crime groups

48
00:01:47,680 --> 00:01:49,680
operating in the world today

49
00:01:49,680 --> 00:01:51,439
the key members are thought to be

50
00:01:51,439 --> 00:01:53,360
russian speaking

51
00:01:53,360 --> 00:01:55,840
and they are involved in a wide range of

52
00:01:55,840 --> 00:01:57,759
cyber crime activities

53
00:01:57,759 --> 00:02:00,000
uh their tools are known to check for

54
00:02:00,000 --> 00:02:02,320
russian language presence on the system

55
00:02:02,320 --> 00:02:04,159
uh which is also known for other uh

56
00:02:04,159 --> 00:02:05,600
russian threat actors

57
00:02:05,600 --> 00:02:08,080
uh intermittent execution in case it

58
00:02:08,080 --> 00:02:09,199
does

59
00:02:09,199 --> 00:02:11,440
this way they try to evade infecting

60
00:02:11,440 --> 00:02:14,239
russian users

61
00:02:14,800 --> 00:02:17,200
the group is also known to develop their

62
00:02:17,200 --> 00:02:18,480
own tools

63
00:02:18,480 --> 00:02:21,760
including the most famous trigbat

64
00:02:21,760 --> 00:02:23,760
uh we can even say that the triggerbot

65
00:02:23,760 --> 00:02:26,400
gang is a sword of our cartel

66
00:02:26,400 --> 00:02:28,400
uh they have our ecosystem and a

67
00:02:28,400 --> 00:02:29,760
partnership with other

68
00:02:29,760 --> 00:02:32,319
threat actors and gangs uh and the whole

69
00:02:32,319 --> 00:02:33,840
arsenal of tours

70
00:02:33,840 --> 00:02:36,400
um posing is one of the biggest threats

71
00:02:36,400 --> 00:02:38,319
to organizations and their businesses

72
00:02:38,319 --> 00:02:40,000
worldwide

73
00:02:40,000 --> 00:02:42,560
these gangs that they partner with they

74
00:02:42,560 --> 00:02:43,440
vary from

75
00:02:43,440 --> 00:02:46,720
ransomware operators to online spammers

76
00:02:46,720 --> 00:02:50,000
fosters and more actors

77
00:02:50,000 --> 00:02:52,879
release tools from the trackpad game can

78
00:02:52,879 --> 00:02:54,879
use the trig but trojan to install their

79
00:02:54,879 --> 00:02:56,319
own malware

80
00:02:56,319 --> 00:02:59,040
or to use the available trigger modules

81
00:02:59,040 --> 00:02:59,920
depending on

82
00:02:59,920 --> 00:03:01,680
what operation they want to carry out on

83
00:03:01,680 --> 00:03:04,319
the infected hose

84
00:03:04,319 --> 00:03:06,720
it is also worth to mention that they do

85
00:03:06,720 --> 00:03:07,440
not list

86
00:03:07,440 --> 00:03:09,840
their tools and services to any

87
00:03:09,840 --> 00:03:11,120
protector

88
00:03:11,120 --> 00:03:13,840
the trick but gang are not using the

89
00:03:13,840 --> 00:03:14,800
classic

90
00:03:14,800 --> 00:03:18,159
mass module but instead they choose the

91
00:03:18,159 --> 00:03:19,440
customer

92
00:03:19,440 --> 00:03:22,319
and partnership very carefully uh in

93
00:03:22,319 --> 00:03:24,319
fact it is not open to everyone

94
00:03:24,319 --> 00:03:26,480
and in order to work with the trigger

95
00:03:26,480 --> 00:03:27,760
can

96
00:03:27,760 --> 00:03:30,480
one must go through a validation process

97
00:03:30,480 --> 00:03:31,519
and also have

98
00:03:31,519 --> 00:03:34,879
someone vouching for them besides strict

99
00:03:34,879 --> 00:03:35,280
bot

100
00:03:35,280 --> 00:03:38,080
the group is also responsible for other

101
00:03:38,080 --> 00:03:39,280
malware

102
00:03:39,280 --> 00:03:42,640
such as the anko and codianes and bazaar

103
00:03:42,640 --> 00:03:43,360
loader

104
00:03:43,360 --> 00:03:45,280
which we'll talk about a bit more and

105
00:03:45,280 --> 00:03:47,280
present the connection among

106
00:03:47,280 --> 00:03:50,480
all of them if we want to build a

107
00:03:50,480 --> 00:03:52,239
timeline for the tripod gang

108
00:03:52,239 --> 00:03:55,519
it will look something as follows uh the

109
00:03:55,519 --> 00:03:56,560
initial emerge of

110
00:03:56,560 --> 00:04:01,040
trigbot in 2016 and in 2018

111
00:04:01,040 --> 00:04:04,480
angkor dioness in 2019 and finally the

112
00:04:04,480 --> 00:04:08,079
bazaar loader in 2020

113
00:04:09,120 --> 00:04:11,280
so uh let's talk about the trick what uh

114
00:04:11,280 --> 00:04:12,400
the drug but malware

115
00:04:12,400 --> 00:04:14,879
the oldest malware in the gang's arsenal

116
00:04:14,879 --> 00:04:15,840
that also gave

117
00:04:15,840 --> 00:04:18,560
the theme its nickname uh trigger is

118
00:04:18,560 --> 00:04:21,120
usually referred to as a banking trojan

119
00:04:21,120 --> 00:04:23,759
but it's actually more than that it is a

120
00:04:23,759 --> 00:04:25,840
modular information stealer

121
00:04:25,840 --> 00:04:28,320
that has modules for reconnaissance

122
00:04:28,320 --> 00:04:29,280
credentials and

123
00:04:29,280 --> 00:04:32,000
sensitive information harvesting and in

124
00:04:32,000 --> 00:04:33,199
addition as modules

125
00:04:33,199 --> 00:04:34,880
the target specifically banking

126
00:04:34,880 --> 00:04:36,800
information

127
00:04:36,800 --> 00:04:40,160
clickbot was first discovered in 2016

128
00:04:40,160 --> 00:04:42,479
mainly targeting individual users and

129
00:04:42,479 --> 00:04:45,360
stealing financial information

130
00:04:45,360 --> 00:04:48,479
later around 2017 2018

131
00:04:48,479 --> 00:04:51,360
uh we started notice a shift in reports

132
00:04:51,360 --> 00:04:52,479
targets

133
00:04:52,479 --> 00:04:54,800
as they became more business and

134
00:04:54,800 --> 00:04:57,120
organization oriented

135
00:04:57,120 --> 00:04:59,680
one of the most famous example perhaps

136
00:04:59,680 --> 00:05:01,520
happened in 2018

137
00:05:01,520 --> 00:05:03,759
uh involving the infamous triple threat

138
00:05:03,759 --> 00:05:05,120
of malware

139
00:05:05,120 --> 00:05:08,400
emote at the trigbet in ryok that caused

140
00:05:08,400 --> 00:05:11,600
substantial damage worldwide

141
00:05:11,600 --> 00:05:13,680
during an investigation we came across

142
00:05:13,680 --> 00:05:15,039
this attack tree

143
00:05:15,039 --> 00:05:17,520
the way the trigbot operates is that it

144
00:05:17,520 --> 00:05:19,120
injects its malicious modules

145
00:05:19,120 --> 00:05:21,680
into another process and as we can see

146
00:05:21,680 --> 00:05:22,160
here

147
00:05:22,160 --> 00:05:25,840
trigbot injected modules into svcos

148
00:05:25,840 --> 00:05:27,919
and uses it to carry out the malicious

149
00:05:27,919 --> 00:05:29,759
activities

150
00:05:29,759 --> 00:05:32,720
one of threebot's module is a model that

151
00:05:32,720 --> 00:05:34,240
is in charge of the reconnaissance

152
00:05:34,240 --> 00:05:35,840
activity

153
00:05:35,840 --> 00:05:39,360
this module uses built-in tools such as

154
00:05:39,360 --> 00:05:42,880
net commands and ipconfig in

155
00:05:42,880 --> 00:05:45,759
anal test to collect information about

156
00:05:45,759 --> 00:05:47,759
the network and the users

157
00:05:47,759 --> 00:05:50,320
and the reconnaissance activity helps to

158
00:05:50,320 --> 00:05:52,160
determine who is the victim

159
00:05:52,160 --> 00:05:55,360
an individual or an organization and the

160
00:05:55,360 --> 00:05:56,639
results will send it back to the

161
00:05:56,639 --> 00:05:57,840
attackers

162
00:05:57,840 --> 00:05:59,680
which based on that choose their next

163
00:05:59,680 --> 00:06:00,960
steps

164
00:06:00,960 --> 00:06:02,880
if the victim turned out to be a worth

165
00:06:02,880 --> 00:06:04,319
infecting or high

166
00:06:04,319 --> 00:06:07,199
profile target an interactive operation

167
00:06:07,199 --> 00:06:08,639
will take place

168
00:06:08,639 --> 00:06:10,800
such as the one in this scenario where

169
00:06:10,800 --> 00:06:13,759
um the attacker used the interpreter

170
00:06:13,759 --> 00:06:16,080
to deploy secondary tools and

171
00:06:16,080 --> 00:06:17,919
cobblestrike to move laterally within

172
00:06:17,919 --> 00:06:21,759
the attack network

173
00:06:21,759 --> 00:06:24,560
now that we've got some background and

174
00:06:24,560 --> 00:06:26,479
we saw how trig bot infection

175
00:06:26,479 --> 00:06:29,440
led to an interactive hacking operation

176
00:06:29,440 --> 00:06:31,199
let's have a look at another touring

177
00:06:31,199 --> 00:06:32,400
against arsenal

178
00:06:32,400 --> 00:06:35,840
then come our world family

179
00:06:36,080 --> 00:06:38,160
so we've shown you this attack tree that

180
00:06:38,160 --> 00:06:39,680
we've investigated

181
00:06:39,680 --> 00:06:42,319
and maybe the sharp item one you have

182
00:06:42,319 --> 00:06:43,600
noticed that

183
00:06:43,600 --> 00:06:45,280
one of the tools delivered in this

184
00:06:45,280 --> 00:06:47,919
incident was a marvel from the encore

185
00:06:47,919 --> 00:06:50,318
family

186
00:06:51,199 --> 00:06:54,000
ankur's is a backdoor that again was

187
00:06:54,000 --> 00:06:54,880
saved against

188
00:06:54,880 --> 00:06:57,520
high profile targets it was observed

189
00:06:57,520 --> 00:06:59,280
infecting victims across the united

190
00:06:59,280 --> 00:07:00,560
states in europe

191
00:07:00,560 --> 00:07:02,720
however the main targets were companies

192
00:07:02,720 --> 00:07:04,240
in the financial

193
00:07:04,240 --> 00:07:07,440
manufacturing and in retail sectors

194
00:07:07,440 --> 00:07:10,479
um it was first observed in 2018 uh when

195
00:07:10,479 --> 00:07:11,919
it seems that the trek but

196
00:07:11,919 --> 00:07:14,880
gang wanted to expand the arsenal a bit

197
00:07:14,880 --> 00:07:16,639
and from the detection rate on

198
00:07:16,639 --> 00:07:18,720
various total it appears that they

199
00:07:18,720 --> 00:07:19,919
worked very hard

200
00:07:19,919 --> 00:07:23,039
to keep it under the radar it was almost

201
00:07:23,039 --> 00:07:25,680
completely undetected for almost two

202
00:07:25,680 --> 00:07:26,080
years

203
00:07:26,080 --> 00:07:28,960
by various security tools and the

204
00:07:28,960 --> 00:07:29,919
different attacks

205
00:07:29,919 --> 00:07:31,680
involving encore it was observed

206
00:07:31,680 --> 00:07:33,360
delivering a pos

207
00:07:33,360 --> 00:07:36,240
a point of cell a malware from the

208
00:07:36,240 --> 00:07:37,759
gangster sonar

209
00:07:37,759 --> 00:07:41,840
that was used to seal credit card data

210
00:07:43,280 --> 00:07:45,520
um the trickbot gang has a pretty decent

211
00:07:45,520 --> 00:07:47,039
development cycle

212
00:07:47,039 --> 00:07:49,199
as we have seen they work very hard to

213
00:07:49,199 --> 00:07:50,800
try to avoid detection

214
00:07:50,800 --> 00:07:54,080
and adding more capabilities to tomorrow

215
00:07:54,080 --> 00:07:56,319
one year after anko was first observed

216
00:07:56,319 --> 00:07:57,599
in the wild

217
00:07:57,599 --> 00:07:59,840
a new evolved version of it was

218
00:07:59,840 --> 00:08:00,720
discovered

219
00:08:00,720 --> 00:08:04,319
and called on core dns angle dns

220
00:08:04,319 --> 00:08:06,720
was added with the dns tunneling cto

221
00:08:06,720 --> 00:08:08,080
communication

222
00:08:08,080 --> 00:08:10,800
and other features in the tweaks such as

223
00:08:10,800 --> 00:08:12,160
stream encryption and

224
00:08:12,160 --> 00:08:15,199
code obfuscation as we have seen with

225
00:08:15,199 --> 00:08:15,840
anco and

226
00:08:15,840 --> 00:08:18,160
since it was used for the same purpose

227
00:08:18,160 --> 00:08:20,800
uh just with the enhanced capabilities

228
00:08:20,800 --> 00:08:22,400
it was also deployed as a secondary

229
00:08:22,400 --> 00:08:23,840
payload of trigbot

230
00:08:23,840 --> 00:08:25,919
and was used to target the same sectors

231
00:08:25,919 --> 00:08:28,799
in the same regions

232
00:08:29,440 --> 00:08:31,440
another cool feature that we've seen in

233
00:08:31,440 --> 00:08:33,919
encore and definitely contributed

234
00:08:33,919 --> 00:08:36,719
to it remaining undetected for so long

235
00:08:36,719 --> 00:08:37,919
is the usage of

236
00:08:37,919 --> 00:08:40,958
flags to operate in order to execute

237
00:08:40,958 --> 00:08:42,000
properly

238
00:08:42,000 --> 00:08:43,760
command and arguments had to be supplied

239
00:08:43,760 --> 00:08:46,480
to the anchor executable

240
00:08:46,480 --> 00:08:48,480
this way each execution without the

241
00:08:48,480 --> 00:08:51,120
correct flags or without any flex

242
00:08:51,120 --> 00:08:53,519
will result in the sample not running

243
00:08:53,519 --> 00:08:55,839
which helped it to evade the sandboxes

244
00:08:55,839 --> 00:08:56,240
and

245
00:08:56,240 --> 00:08:58,160
also making it harder to analyze

246
00:08:58,160 --> 00:09:00,720
manually

247
00:09:00,720 --> 00:09:02,240
so we've talked a bit about the

248
00:09:02,240 --> 00:09:04,240
development cycle of fanco

249
00:09:04,240 --> 00:09:06,880
during our research we came across two

250
00:09:06,880 --> 00:09:09,200
variants of fun codings

251
00:09:09,200 --> 00:09:10,959
here are some of the main tweaks and

252
00:09:10,959 --> 00:09:14,240
improvements between the variants

253
00:09:14,240 --> 00:09:16,720
and the first uncoverian discovered in

254
00:09:16,720 --> 00:09:18,080
2018

255
00:09:18,080 --> 00:09:20,720
the code was saved in cleartext it had

256
00:09:20,720 --> 00:09:22,080
some

257
00:09:22,080 --> 00:09:25,279
and it uses a standard https protocol

258
00:09:25,279 --> 00:09:28,560
for c2 communication

259
00:09:28,880 --> 00:09:31,360
in the older anchor dns variant

260
00:09:31,360 --> 00:09:33,519
discovered in may 2019

261
00:09:33,519 --> 00:09:36,560
the grid was encrypted using base64

262
00:09:36,560 --> 00:09:39,360
it had some code officiation as well and

263
00:09:39,360 --> 00:09:40,480
it started to use

264
00:09:40,480 --> 00:09:43,680
dns tunneling for cto communication

265
00:09:43,680 --> 00:09:46,000
this was a step forward in making the

266
00:09:46,000 --> 00:09:48,480
malware less durable to analyze

267
00:09:48,480 --> 00:09:50,640
and in addition i avoid communication

268
00:09:50,640 --> 00:09:53,199
detection

269
00:09:53,360 --> 00:09:55,519
in the new encode dns variant it was uh

270
00:09:55,519 --> 00:09:57,839
discovered in november 2019

271
00:09:57,839 --> 00:09:59,680
uh the code was the grid was uh

272
00:09:59,680 --> 00:10:02,959
encrypted uh using vex 64 as well

273
00:10:02,959 --> 00:10:06,160
and the code was massively obfuscated

274
00:10:06,160 --> 00:10:08,959
the development the developmental step

275
00:10:08,959 --> 00:10:10,240
was made to hide

276
00:10:10,240 --> 00:10:12,800
the malware's call functionalities and

277
00:10:12,800 --> 00:10:14,320
together with the network detection

278
00:10:14,320 --> 00:10:16,640
invasion and the previously mentioned

279
00:10:16,640 --> 00:10:19,120
necessary command line arguments anka

280
00:10:19,120 --> 00:10:19,680
remained

281
00:10:19,680 --> 00:10:23,439
under the radar for a long time

282
00:10:24,079 --> 00:10:26,959
in 2020 a linux variant of anchor was

283
00:10:26,959 --> 00:10:28,399
discovered

284
00:10:28,399 --> 00:10:30,959
from looking at its code it is clear

285
00:10:30,959 --> 00:10:32,640
that it resembles its

286
00:10:32,640 --> 00:10:36,079
older brother uh windows variant

287
00:10:36,079 --> 00:10:38,800
this is yet another successful result of

288
00:10:38,800 --> 00:10:40,399
the encores family

289
00:10:40,399 --> 00:10:43,680
latest development cycle on the left

290
00:10:43,680 --> 00:10:44,320
image

291
00:10:44,320 --> 00:10:46,320
you can see the hardcoded anchor linux

292
00:10:46,320 --> 00:10:48,320
name and on the right

293
00:10:48,320 --> 00:10:51,120
you can see the command line parameters

294
00:10:51,120 --> 00:10:52,560
are passed to the linux

295
00:10:52,560 --> 00:10:55,920
binary both of these characteristics are

296
00:10:55,920 --> 00:10:58,399
resembled to the windows variant

297
00:10:58,399 --> 00:11:01,839
that we have mentioned earlier

298
00:11:02,240 --> 00:11:04,240
and now we'll hand it over to daniel to

299
00:11:04,240 --> 00:11:05,519
present the bazaar

300
00:11:05,519 --> 00:11:07,279
and discuss the connection to trigbet

301
00:11:07,279 --> 00:11:09,519
and hong kong

302
00:11:09,519 --> 00:11:11,920
um thank you leo so the next step of the

303
00:11:11,920 --> 00:11:13,040
trick board gang was

304
00:11:13,040 --> 00:11:14,959
developing another malware that was also

305
00:11:14,959 --> 00:11:17,120
used against high profile targets

306
00:11:17,120 --> 00:11:19,600
in the u.s and in europe since it used

307
00:11:19,600 --> 00:11:21,519
demarco in bazaar domains uh it was

308
00:11:21,519 --> 00:11:23,920
named by researchers as bizarre loader

309
00:11:23,920 --> 00:11:25,519
the usage of bizarre domains started to

310
00:11:25,519 --> 00:11:28,079
become more popular with red actors and

311
00:11:28,079 --> 00:11:28,959
here's why

312
00:11:28,959 --> 00:11:31,519
a quoting from ambercoin.com website

313
00:11:31,519 --> 00:11:32,880
because of emercoins

314
00:11:32,880 --> 00:11:36,240
secure and distributed blockchain uh the

315
00:11:36,240 --> 00:11:37,839
domain name records are completely

316
00:11:37,839 --> 00:11:40,320
decentralized and unsensible and cannot

317
00:11:40,320 --> 00:11:41,279
be altered

318
00:11:41,279 --> 00:11:44,320
revoked or suspended by any authority

319
00:11:44,320 --> 00:11:46,320
so you can see the appeal here for uh

320
00:11:46,320 --> 00:11:47,839
threat actors

321
00:11:47,839 --> 00:11:50,160
uh the first variant emerged around

322
00:11:50,160 --> 00:11:53,200
march 2020 and the last one in june 21.

323
00:11:53,200 --> 00:11:55,360
as we can see in the graph depicting the

324
00:11:55,360 --> 00:11:56,399
infection chain

325
00:11:56,399 --> 00:11:58,560
like many other attacks it all starts

326
00:11:58,560 --> 00:12:00,000
with a phishing email that lures the

327
00:12:00,000 --> 00:12:01,600
victim into downloading

328
00:12:01,600 --> 00:12:03,680
bazaar order from google docs while the

329
00:12:03,680 --> 00:12:04,800
executable itself

330
00:12:04,800 --> 00:12:08,160
is masked as a pdf file

331
00:12:08,160 --> 00:12:10,240
one of the first things we noticed uh is

332
00:12:10,240 --> 00:12:11,920
that developers

333
00:12:11,920 --> 00:12:14,000
um had rapid development cycles they

334
00:12:14,000 --> 00:12:15,440
have clearly evolved and learned

335
00:12:15,440 --> 00:12:16,079
themselves

336
00:12:16,079 --> 00:12:18,720
uh through the whole process um now

337
00:12:18,720 --> 00:12:20,560
let's have a brief let's uh let's have a

338
00:12:20,560 --> 00:12:21,279
brief look at

339
00:12:21,279 --> 00:12:24,160
um the bazaar family development cycles

340
00:12:24,160 --> 00:12:25,440
and uh discuss

341
00:12:25,440 --> 00:12:27,360
uh some of the changes implemented is

342
00:12:27,360 --> 00:12:29,360
the malware's variance advanced

343
00:12:29,360 --> 00:12:31,519
uh so the bizarre family is both the

344
00:12:31,519 --> 00:12:32,880
loader and the back door

345
00:12:32,880 --> 00:12:35,839
uh we'll focus on the load in general

346
00:12:35,839 --> 00:12:36,720
it's clear that

347
00:12:36,720 --> 00:12:38,800
that the others invested a lot of time

348
00:12:38,800 --> 00:12:41,040
into off scaling them up

349
00:12:41,040 --> 00:12:43,360
the first debug variant uh that was

350
00:12:43,360 --> 00:12:45,040
first seen in april 9th

351
00:12:45,040 --> 00:12:47,040
uh somewhat in parallel with the first

352
00:12:47,040 --> 00:12:48,880
operational loader variant

353
00:12:48,880 --> 00:12:50,880
uh was relatively easy to analyze it was

354
00:12:50,880 --> 00:12:52,880
wasn't obfuscated or encrypted

355
00:12:52,880 --> 00:12:54,639
it actually had a very clear log file

356
00:12:54,639 --> 00:12:56,320
that showed the malware's operation

357
00:12:56,320 --> 00:12:57,839
it didn't try to hide itself from

358
00:12:57,839 --> 00:13:00,240
analysis um it also had the

359
00:13:00,240 --> 00:13:02,079
team nine debug strings uh from which

360
00:13:02,079 --> 00:13:04,000
the name team nine was derived

361
00:13:04,000 --> 00:13:06,160
more on that in the next section uh the

362
00:13:06,160 --> 00:13:07,680
second variant which is the first

363
00:13:07,680 --> 00:13:09,040
operational loader

364
00:13:09,040 --> 00:13:10,880
uh was active between the end of march

365
00:13:10,880 --> 00:13:12,720
and the middle of april uh

366
00:13:12,720 --> 00:13:14,560
and it started implementing uh heavier

367
00:13:14,560 --> 00:13:15,920
fuscation

368
00:13:15,920 --> 00:13:17,680
this was expressed in multiple

369
00:13:17,680 --> 00:13:20,720
algorithms to high strings and to also

370
00:13:20,720 --> 00:13:22,560
hide api calls

371
00:13:22,560 --> 00:13:24,480
after almost two months of silence a new

372
00:13:24,480 --> 00:13:26,959
variant emerged in june 21. this variant

373
00:13:26,959 --> 00:13:28,560
was featuring heavy obfuscation

374
00:13:28,560 --> 00:13:30,800
as the previous one but also implemented

375
00:13:30,800 --> 00:13:32,000
new features such as

376
00:13:32,000 --> 00:13:34,320
the main generation algorithm or dga and

377
00:13:34,320 --> 00:13:35,839
the api hammering technique which

378
00:13:35,839 --> 00:13:37,920
creates thousands of redundant api calls

379
00:13:37,920 --> 00:13:38,720
to spam

380
00:13:38,720 --> 00:13:41,440
sandbox's report and also delay the

381
00:13:41,440 --> 00:13:43,920
sample's execution

382
00:13:43,920 --> 00:13:45,600
in conclusion each development cycle was

383
00:13:45,600 --> 00:13:46,880
productive for the developers

384
00:13:46,880 --> 00:13:49,360
introducing new features to serve

385
00:13:49,360 --> 00:13:51,440
their purpose of analysis and detection

386
00:13:51,440 --> 00:13:53,680
work

387
00:13:53,760 --> 00:13:56,639
so up until now we talked about the

388
00:13:56,639 --> 00:13:57,600
ankor

389
00:13:57,600 --> 00:13:59,440
reviewed the bazaar loader and also

390
00:13:59,440 --> 00:14:00,880
mentioned trigbot

391
00:14:00,880 --> 00:14:02,160
as you may notice there are several

392
00:14:02,160 --> 00:14:03,920
interesting similarities they all share

393
00:14:03,920 --> 00:14:05,519
let's move on to exploring some of these

394
00:14:05,519 --> 00:14:07,519
similarities the first noticeable

395
00:14:07,519 --> 00:14:09,199
similarity is the initial infection

396
00:14:09,199 --> 00:14:11,120
vector of trigbot and bazaar loader

397
00:14:11,120 --> 00:14:12,800
which is pretty much the same

398
00:14:12,800 --> 00:14:14,800
it consists of a phishing email that

399
00:14:14,800 --> 00:14:16,639
instead of an attachment contains a link

400
00:14:16,639 --> 00:14:18,079
to a google doc

401
00:14:18,079 --> 00:14:20,160
once the user browses to read the google

402
00:14:20,160 --> 00:14:21,920
doc they will be presented with a

403
00:14:21,920 --> 00:14:23,920
message instructing them to download the

404
00:14:23,920 --> 00:14:25,839
document and open it locally on their

405
00:14:25,839 --> 00:14:27,680
computer

406
00:14:27,680 --> 00:14:30,160
to learn the victim the bizarre trigger

407
00:14:30,160 --> 00:14:31,440
flaw there is masquerading as a

408
00:14:31,440 --> 00:14:32,240
microsoft

409
00:14:32,240 --> 00:14:35,040
office or adobe pdf file by using their

410
00:14:35,040 --> 00:14:36,959
icons sometimes it will double extension

411
00:14:36,959 --> 00:14:41,839
such as pdf dxe or dot dot exe

412
00:14:41,839 --> 00:14:44,399
since common extensions are not usually

413
00:14:44,399 --> 00:14:45,920
presented by default

414
00:14:45,920 --> 00:14:47,760
that suspecting user will simply double

415
00:14:47,760 --> 00:14:50,480
click on the file

416
00:14:52,639 --> 00:14:54,800
both anchor and bazaar loader in their

417
00:14:54,800 --> 00:14:55,680
early variants

418
00:14:55,680 --> 00:14:57,360
exhibit verbose logging of their

419
00:14:57,360 --> 00:14:59,360
activity on the infected machine

420
00:14:59,360 --> 00:15:01,440
giving the developer but also the

421
00:15:01,440 --> 00:15:02,399
analyst

422
00:15:02,399 --> 00:15:04,560
a clear view of what the malware is up

423
00:15:04,560 --> 00:15:07,279
to in this snapshot of anchor dns log

424
00:15:07,279 --> 00:15:09,519
we can see the guide created for this

425
00:15:09,519 --> 00:15:10,639
particular machine

426
00:15:10,639 --> 00:15:14,320
and other file related activity

427
00:15:14,639 --> 00:15:17,680
in this log file of the early bazaar t9

428
00:15:17,680 --> 00:15:18,480
loader

429
00:15:18,480 --> 00:15:20,399
we can see a nice log that shows the

430
00:15:20,399 --> 00:15:22,160
communication to the c2

431
00:15:22,160 --> 00:15:23,760
followed by downloading and decrypting

432
00:15:23,760 --> 00:15:26,079
its payload which is the bazaar vector

433
00:15:26,079 --> 00:15:27,519
it will even show the size of the

434
00:15:27,519 --> 00:15:29,839
backdoor and if the payload is okay or

435
00:15:29,839 --> 00:15:30,240
not

436
00:15:30,240 --> 00:15:33,040
and if it was verified successfully

437
00:15:33,040 --> 00:15:34,959
another notable similarity

438
00:15:34,959 --> 00:15:37,519
is the usage of signed samples in some

439
00:15:37,519 --> 00:15:38,079
cases

440
00:15:38,079 --> 00:15:40,000
trigbot and anchor samples were signed

441
00:15:40,000 --> 00:15:41,680
with the same certificates

442
00:15:41,680 --> 00:15:44,079
these certificates can be used as a good

443
00:15:44,079 --> 00:15:45,839
detection mechanism for a further

444
00:15:45,839 --> 00:15:49,120
triggerbot related model

445
00:15:50,079 --> 00:15:52,160
another very strong connection is a

446
00:15:52,160 --> 00:15:53,759
shared c2 server

447
00:15:53,759 --> 00:15:56,240
between trigbot and encore this ip

448
00:15:56,240 --> 00:15:57,040
address that

449
00:15:57,040 --> 00:15:59,519
is shown on the slide was hard coded in

450
00:15:59,519 --> 00:16:00,720
both malware

451
00:16:00,720 --> 00:16:03,279
trigbot and anco which leaves no room

452
00:16:03,279 --> 00:16:04,959
for a doubt about their marvel's

453
00:16:04,959 --> 00:16:06,839
connections and their shared

454
00:16:06,839 --> 00:16:09,120
infrastructure you can also see here the

455
00:16:09,120 --> 00:16:10,720
virustotal graph

456
00:16:10,720 --> 00:16:13,279
that shows that both trig button and

457
00:16:13,279 --> 00:16:14,320
samples

458
00:16:14,320 --> 00:16:17,440
share the same c2

459
00:16:17,680 --> 00:16:20,160
another another similarity is that all

460
00:16:20,160 --> 00:16:22,320
of the discussed variants

461
00:16:22,320 --> 00:16:24,880
are using a very similar pattern to

462
00:16:24,880 --> 00:16:26,720
create a unique identifier

463
00:16:26,720 --> 00:16:29,120
for each infected machine and then

464
00:16:29,120 --> 00:16:32,160
access it as a resource in the c2

465
00:16:32,160 --> 00:16:34,480
most likely creating a separate folder

466
00:16:34,480 --> 00:16:37,040
on the server for each infection

467
00:16:37,040 --> 00:16:39,120
this is a known pattern of the trigbot

468
00:16:39,120 --> 00:16:41,199
gang and can be seen in

469
00:16:41,199 --> 00:16:44,880
multiple communication logs

470
00:16:44,880 --> 00:16:47,120
um here we can see the known trigbot

471
00:16:47,120 --> 00:16:48,079
decryptor

472
00:16:48,079 --> 00:16:50,000
on the right using the virtual alloy key

473
00:16:50,000 --> 00:16:51,440
x number api

474
00:16:51,440 --> 00:16:53,360
uh to allocate memory used to run the

475
00:16:53,360 --> 00:16:54,880
decrypted shell code

476
00:16:54,880 --> 00:16:56,720
on the left is bazaar loader which is

477
00:16:56,720 --> 00:16:57,920
very similar if not

478
00:16:57,920 --> 00:17:00,320
almost identical to the trig boot loader

479
00:17:00,320 --> 00:17:01,040
both of them

480
00:17:01,040 --> 00:17:03,440
will load the above mentioned api

481
00:17:03,440 --> 00:17:05,039
encrypted shellcode and

482
00:17:05,039 --> 00:17:08,160
also a pe together with their sizes and

483
00:17:08,160 --> 00:17:09,599
the decryption key

484
00:17:09,599 --> 00:17:11,760
finally the decryption routine will be

485
00:17:11,760 --> 00:17:13,919
executed and decrypt the shellcode which

486
00:17:13,919 --> 00:17:14,640
in turn

487
00:17:14,640 --> 00:17:17,679
will run the pe the and b

488
00:17:17,679 --> 00:17:20,240
are both further obfuscated with dynamic

489
00:17:20,240 --> 00:17:21,679
um api loading

490
00:17:21,679 --> 00:17:23,520
and other strings of fuscation used to

491
00:17:23,520 --> 00:17:25,679
um hinder analysis and detection as we

492
00:17:25,679 --> 00:17:27,839
saw

493
00:17:28,240 --> 00:17:30,640
um last but not least instead of using

494
00:17:30,640 --> 00:17:33,360
the standard c2 communication

495
00:17:33,360 --> 00:17:37,200
such as http or https both anchor dns

496
00:17:37,200 --> 00:17:38,640
and bazaar loader

497
00:17:38,640 --> 00:17:40,559
make an effort of evading cto

498
00:17:40,559 --> 00:17:42,160
communication detection

499
00:17:42,160 --> 00:17:45,120
and by using more advanced techniques

500
00:17:45,120 --> 00:17:47,360
such as dns tunneling

501
00:17:47,360 --> 00:17:50,880
dns and domain generation algorithm

502
00:17:50,880 --> 00:17:53,120
it is worth to mention that the uncle

503
00:17:53,120 --> 00:17:54,160
family was

504
00:17:54,160 --> 00:17:56,400
also seen at some point using the bazaar

505
00:17:56,400 --> 00:17:58,160
domains

506
00:17:58,160 --> 00:17:59,919
as you may notice their communication

507
00:17:59,919 --> 00:18:01,919
protocols are not the same

508
00:18:01,919 --> 00:18:04,240
but both are oriented to avoid the

509
00:18:04,240 --> 00:18:07,919
network communication detection

510
00:18:08,799 --> 00:18:10,880
so we mentioned briefly the use of

511
00:18:10,880 --> 00:18:12,559
aristotle

512
00:18:12,559 --> 00:18:14,640
let's see how we use uh vt in our

513
00:18:14,640 --> 00:18:16,000
investigation

514
00:18:16,000 --> 00:18:18,320
and show you some tricks and the handy

515
00:18:18,320 --> 00:18:21,280
queries that we use

516
00:18:22,240 --> 00:18:25,280
uh so as part of our research process uh

517
00:18:25,280 --> 00:18:26,160
we use different

518
00:18:26,160 --> 00:18:28,000
awesome tools to collect additional

519
00:18:28,000 --> 00:18:30,160
information about the group

520
00:18:30,160 --> 00:18:32,320
or the malware we want to investigate

521
00:18:32,320 --> 00:18:34,480
and hunt for additional samples and

522
00:18:34,480 --> 00:18:38,080
ttps related to data one of the most

523
00:18:38,080 --> 00:18:41,840
the more known tools is a virustotal

524
00:18:41,840 --> 00:18:44,559
is um is a platform that we use to run

525
00:18:44,559 --> 00:18:46,240
advanced hunting queries

526
00:18:46,240 --> 00:18:49,120
and the hours to search for files with a

527
00:18:49,120 --> 00:18:51,039
specific metadata

528
00:18:51,039 --> 00:18:54,960
content file type behavior and more

529
00:18:54,960 --> 00:18:58,240
aristotle has a variety of data points

530
00:18:58,240 --> 00:19:01,280
and filters that can assist

531
00:19:01,280 --> 00:19:04,559
finding additional iocs which can later

532
00:19:04,559 --> 00:19:07,360
be pivoted and extended

533
00:19:07,360 --> 00:19:10,960
in our research we often use static data

534
00:19:10,960 --> 00:19:11,679
queries

535
00:19:11,679 --> 00:19:14,000
along with behavioral information

536
00:19:14,000 --> 00:19:14,720
supplied by

537
00:19:14,720 --> 00:19:18,559
verisotal and adult sandbox vendors

538
00:19:18,559 --> 00:19:20,880
for example the investigation of

539
00:19:20,880 --> 00:19:22,640
different samples were observed in the

540
00:19:22,640 --> 00:19:24,720
drinkbot anchor campaign

541
00:19:24,720 --> 00:19:27,919
led us to create a list of signals which

542
00:19:27,919 --> 00:19:29,280
we used to hunt for

543
00:19:29,280 --> 00:19:30,880
other samples related to the same

544
00:19:30,880 --> 00:19:33,840
campaign using the signature filter in

545
00:19:33,840 --> 00:19:35,520
vt

546
00:19:35,520 --> 00:19:37,919
we can also use the viticult feature to

547
00:19:37,919 --> 00:19:38,559
search for

548
00:19:38,559 --> 00:19:40,320
connection between samples and

549
00:19:40,320 --> 00:19:41,679
infrastructure

550
00:19:41,679 --> 00:19:43,840
is shown here and as we have discussed

551
00:19:43,840 --> 00:19:46,160
in the section of the c2 overlap

552
00:19:46,160 --> 00:19:49,280
here with encore and that report

553
00:19:49,280 --> 00:19:50,880
there is a lot more we can do with

554
00:19:50,880 --> 00:19:53,919
virustotal and since we don't have uh

555
00:19:53,919 --> 00:19:56,720
all the time to to show you all of this

556
00:19:56,720 --> 00:19:58,080
in this presentation

557
00:19:58,080 --> 00:20:00,320
we have you we highly recommend you uh

558
00:20:00,320 --> 00:20:01,919
to learn more about it and

559
00:20:01,919 --> 00:20:04,240
become familiar with the capabilities

560
00:20:04,240 --> 00:20:06,880
and the filter hops and options

561
00:20:06,880 --> 00:20:09,760
um so uh let's wrap things up in today's

562
00:20:09,760 --> 00:20:11,679
talk we discussed uh how the trig boot

563
00:20:11,679 --> 00:20:13,120
gang also operates

564
00:20:13,120 --> 00:20:14,480
together with other directors by

565
00:20:14,480 --> 00:20:16,799
providing them with infrastructure or by

566
00:20:16,799 --> 00:20:19,360
allowing them access to infected hosts

567
00:20:19,360 --> 00:20:21,520
this model of malware as a service or

568
00:20:21,520 --> 00:20:22,559
mass

569
00:20:22,559 --> 00:20:24,559
is gaining more popularity and allows

570
00:20:24,559 --> 00:20:26,559
threat actors to collaborate among them

571
00:20:26,559 --> 00:20:28,480
to increase the revenue

572
00:20:28,480 --> 00:20:30,640
the trick with genga in particular is

573
00:20:30,640 --> 00:20:31,520
interesting

574
00:20:31,520 --> 00:20:33,840
because of their development cycles of

575
00:20:33,840 --> 00:20:35,120
custom-built tools

576
00:20:35,120 --> 00:20:37,360
as well as their expertise in evading

577
00:20:37,360 --> 00:20:39,760
security solutions

578
00:20:39,760 --> 00:20:41,520
one of the most important words of

579
00:20:41,520 --> 00:20:43,600
advice of advice we can give you

580
00:20:43,600 --> 00:20:45,440
our fellow researchers and analysts is

581
00:20:45,440 --> 00:20:47,120
to focus

582
00:20:47,120 --> 00:20:50,320
on ttps rather than uh just uh chasing

583
00:20:50,320 --> 00:20:52,320
iocs or relying uh too much on av

584
00:20:52,320 --> 00:20:53,200
signatures

585
00:20:53,200 --> 00:20:54,880
um attackers can offscate and pack their

586
00:20:54,880 --> 00:20:56,720
payloads but no matter how offscated or

587
00:20:56,720 --> 00:20:58,080
encrypted the payload is

588
00:20:58,080 --> 00:21:00,480
it has to interact with uh the operating

589
00:21:00,480 --> 00:21:01,760
system at some point

590
00:21:01,760 --> 00:21:03,440
this is where behavioral base detection

591
00:21:03,440 --> 00:21:05,039
comes to play

592
00:21:05,039 --> 00:21:07,600
finally in the world of uh in a world of

593
00:21:07,600 --> 00:21:09,520
nation state malware and apts

594
00:21:09,520 --> 00:21:11,919
it's sometimes easy for us as analysts

595
00:21:11,919 --> 00:21:13,679
or researchers to

596
00:21:13,679 --> 00:21:15,520
underestimate the potential damage that

597
00:21:15,520 --> 00:21:17,600
the commodity melbourne can cause

598
00:21:17,600 --> 00:21:18,880
similar to what trigbot and other

599
00:21:18,880 --> 00:21:21,280
malware taught us what starts as a small

600
00:21:21,280 --> 00:21:22,960
and trivial infection can later turn

601
00:21:22,960 --> 00:21:24,880
into a fully fledged hacking operation

602
00:21:24,880 --> 00:21:27,840
with the zest result

603
00:21:28,000 --> 00:21:29,919
so we've covered a lot in this uh short

604
00:21:29,919 --> 00:21:32,400
session uh for those of you who are

605
00:21:32,400 --> 00:21:34,080
interested in learning more about the

606
00:21:34,080 --> 00:21:35,280
trig bodkin

607
00:21:35,280 --> 00:21:37,600
and the new malware and tools we

608
00:21:37,600 --> 00:21:39,600
encourage you to visit our blog

609
00:21:39,600 --> 00:21:41,840
and reach out to us on social media if

610
00:21:41,840 --> 00:21:43,600
you have any questions

611
00:21:43,600 --> 00:21:45,840
that's all from us thank you and stay

612
00:21:45,840 --> 00:21:47,360
safe

613
00:21:47,360 --> 00:21:59,840
thanks again for having us bye everyone

